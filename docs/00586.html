<html>
<head>
<title>Methods to reduce runtime memory while using Pandas, PyArrow, Scikit learn in Machine learning.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在机器学习中使用Pandas，PyArrow，Scikit learn时减少运行时内存的方法。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/methods-to-reduce-ram-consumption-while-using-pandas-pyarrow-and-scikit-learn-in-machine-learning-7927a092559a?source=collection_archive---------1-----------------------#2019-08-08">https://medium.com/analytics-vidhya/methods-to-reduce-ram-consumption-while-using-pandas-pyarrow-and-scikit-learn-in-machine-learning-7927a092559a?source=collection_archive---------1-----------------------#2019-08-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/de1e21890f21c060f498aa0f56a1b45e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XeLL5G0VcrUVWUyq"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://unsplash.com/@tongs?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Xtina Yu </a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h2 id="47c2" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">对使用的记录数量配置任意限制</h2><p id="ed1d" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">在使用PyArrow将拼花文件转换为数据框时，我们可能会被实际拼花文件的大小所欺骗。因为300万行数据可能占用不到400MB的实际文件内存。但是，这些数据在转换为数据帧时会占用多达5 GB的处理内存。只有当进程完成时，内存才会被释放。</p><p id="4d15" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">在多处理环境中，这可能会增加处理内存的压力，随着我们不断处理数据，这种压力可能会不断增加，最终导致应用服务器的高内存使用率。因此，最好对获取的记录数量进行限制。</p><h2 id="e0ba" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">尽可能使用类别类型而不是对象类型</h2><p id="0b3a" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">与“类别”数据类型相比，“对象”数据类型的特性消耗大量内存并占用RAM中的不同片段。类别字段在内部用数字对数据进行编码，并维护一个类似字典的结构来引用实际值。此外，类别特征的数值存储在连续的存储器位置中。从而减少处理和查找时间。</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/ad7f255907c1b2b5bd45624042940999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vBI-mr6Vi56ctKl1P7KnEA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">演职员表:<a class="ae iu" href="https://jakevdp.github.io/blog/2014/05/09/why-python-is-slow/" rel="noopener ugc nofollow" target="_blank">https://jakevdp . github . io/blog/2014/05/09/why-python-is-slow/</a></figcaption></figure><p id="9e36" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">但是，在将所有对象列转换为类别时应该小心，因为具有超过50%唯一值的对象列作为对象类型本身往往比转换为类别类型占用更少的内存。</p><h2 id="2809" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">向下转换数字特征:</h2><p id="df16" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">类型特征占用的内存</p><blockquote class="ky kz la"><p id="b248" class="jt ju lb jv b jw ko jy jz ka kp kc kd lc kq kf kg ld kr ki kj le ks kl km kn hb bi translated">Int 64 &gt; Int 32 &gt; Int 16 &gt; Int 8<br/>float 64&gt;float 32&gt;float 16<br/>Int&gt;unsigned Int(仅正值)</p></blockquote><p id="e078" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">因此，应该尽可能为每个字段选择合适的数据类型。<br/>向下转换时应小心，因为如果数据点值超出数据类型的范围，它们可能会被修剪。然而，我们可以采用一些技术，比如找出一个特征的最小值、最大值，然后决定是否向下转换。此外，领域知识可能有助于确定数值字段的取值范围，进而有助于选择数据类型。</p><h2 id="ba9b" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">Scikit的标签编码器非常耗时:</h2><p id="2c8a" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">看起来Scikit-learn的标签编码器在拟合数据时使用了排序搜索。这可以通过将对象转换为分类变量，然后应用pandas <strong class="jv hj"> cat.codes </strong>来代替，它使用哈希技术，在编码方面非常快。如前所述，在某些情况下，将变量转换为非对象数据类型会更有效。</p><p id="c8b9" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj"> <em class="lb">演职员表:</em></strong><br/><a class="ae iu" href="https://www.dataquest.io/blog/pandas-big-data/" rel="noopener ugc nofollow" target="_blank">https://www.dataquest.io/blog/pandas-big-data/</a><br/><a class="ae iu" href="https://stackoverflow.com/questions/39475187/how-to-speed-labelencoder-up-recoding-a-categorical-variable-into-integers?answertab=votes#tab-top" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/39475187/how-to-speed-labelen coder-up-recoding-a-categorical-variable-into-integers？answertab=votes#tab-top </a></p></div></div>    
</body>
</html>