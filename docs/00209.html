<html>
<head>
<title>Getting Started with TensorFlow the Easy Way (Part 4)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以最简单的方式开始使用TensorFlow(第4部分)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/getting-started-with-tensorflow-the-easy-way-part-4-b468d99b06?source=collection_archive---------0-----------------------#2018-12-12">https://medium.com/analytics-vidhya/getting-started-with-tensorflow-the-easy-way-part-4-b468d99b06?source=collection_archive---------0-----------------------#2018-12-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="92b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">这是关于如何开始使用Tensorflow的系列文章的第4部分——“在TensorFlow中实现分类示例”。</em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="ab fe cl jj"><img src="../Images/ebf4927d0990320e2ea53ff45302048f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*PM4dqcAe6N7kWRpXKwgWag.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">来源:<a class="ae jq" href="https://towardsdatascience.com/machine-learning-classifiers-a5cc4e1b0623" rel="noopener" target="_blank">https://towards data science . com/machine-learning-classifiers-a 5c C4 E1 b 0623</a></figcaption></figure><p id="3488" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用机器学习和深度学习技术来解决分类挑战是非常令人兴奋的。分类算法有各种业务用例，从流失预测到调节垃圾邮件/火腿的文本评论。</p><p id="cb14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一部分中，我们将编写一个Tensorflow线性分类示例，分析我们的预测并验证我们的模型在未知数据上的表现。所有常规的张量流函数在这一部分都将被跳过，因为我们已经在之前的文章中讨论过了。如果您觉得缺少tensorflow中的概念和变量，请随意查看本系列的前几部分。</p></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><p id="21ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第1部分:<a class="ae jq" rel="noopener" href="/analytics-vidhya/series-learning-tensorflow-the-easy-way-dcc5be834d74"> Tensorflow安装和设置、语法和图形</a></p><p id="2de5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第2部分:<a class="ae jq" rel="noopener" href="/analytics-vidhya/getting-started-with-tensorflow-the-easy-way-part-2-30e83830bd25">tensor flow中的变量和占位符</a></p><p id="1ce9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第3部分:<a class="ae jq" rel="noopener" href="/@shaz13/getting-started-with-tensorflow-the-easy-way-part-3-9714a09af723">在Tensorflow中实现回归示例</a></p><h2 id="9146" class="jy jz hi bd ka kb kc kd ke kf kg kh ki iq kj kk kl iu km kn ko iy kp kq kr ks bi translated"><strong class="ak">问题陈述</strong></h2><p id="3d6b" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated"><em class="jd">给出个人的各种特征，预测其属于哪个收入阶层(&gt; 50k或&lt; =50k)。数据集可以从</em> <a class="ae jq" href="https://archive.ics.uci.edu/ml/datasets/census+income" rel="noopener ugc nofollow" target="_blank"> <em class="jd">这里</em> </a>下载</p><p id="07cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是数据列的概述</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ky"><img src="../Images/b8836655c0b63a6df3379148e1837223.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NcFAsAm-CAdIX3pGHJr8fA.png"/></div></div></figure><p id="f94c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们开始使用pandas加载数据集</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="e36d" class="jy jz hi le b fi li lj l lk ll">import pandas as pd<br/>import tensorflow as tf</span></pre><p id="21e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">来自UCI的数据集通常没有标准的csv格式。因此，让我们根据数据页面上提供的信息来重命名这些列。</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="d02b" class="jy jz hi le b fi li lj l lk ll">census = pd.read_csv("adult.csv", header=None)<br/>census.columns = ['age', 'workclass','fnlwgt', 'education', 'education_num', 'marital_status',<br/>       'occupation', 'relationship', 'race', 'gender', 'capital_gain',<br/>       'capital_loss', 'hours_per_week', 'native_country', 'income_bracket']</span></pre><p id="8a80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查标题，看看我们的表格数据框架。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lm"><img src="../Images/4e0f34058c12dd5571e2750aa146c643.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GtTO__Y48x_4OxJRYeuJ4w.png"/></div></div></figure><p id="6b56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种情况下，我们的目标变量是一个字符串，即&gt; 50K，&lt;=50K. Unfortunately, TensorFlow won’t be able to understand strings as labels, we need to use pandas .apply() method to apply a custom function that converts them to 0s and 1s.</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="d762" class="jy jz hi le b fi li lj l lk ll">def label_fix(label):<br/>    if label==' &lt;=50K':<br/>        return 0<br/>    else:<br/>        return 1<br/>census['income_bracket'] = census['income_bracket'].apply(label_fix)<br/>census['income_bracket'].unique()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ln"><img src="../Images/d373831c3f4e8543a0f08ef2b38b9a80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T6JImC4XZTSELRfxHJ7QFg.png"/></div></div></figure><p id="2f30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">The output should be either 0 or 1. Now, we are set to code out the tensorflow pipeline followed by splitting our data into train and test sets.</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="9495" class="jy jz hi le b fi li lj l lk ll">from sklearn.model_selection import train_test_split</span><span id="2977" class="jy jz hi le b fi lo lj l lk ll">x_data = census.drop('income_bracket',axis=1)<br/>y_labels = census['income_bracket']</span><span id="c619" class="jy jz hi le b fi lo lj l lk ll">X_train, X_test, y_train, y_test = train_test_split(x_data,y_labels,test_size=0.3,random_state=101)</span></pre><p id="e4c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">If you have followed through the previous parts you must have noticed that we didn’t use any sort of strings as features before. How do you think we can pass categorical features into a tensorflow model? There are actually two methods</p><ol class=""><li id="8ad1" class="lp lq hi ih b ii ij im in iq lr iu ls iy lt jc lu lv lw lx bi translated">Vocabulary List</li><li id="070d" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">Hash Bucket</li></ol><h1 id="3d67" class="md jz hi bd ka me mf mg ke mh mi mj ki mk ml mm kl mn mo mp ko mq mr ms kr mt bi translated"><strong class="ak">词汇表</strong></h1><p id="202b" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">在词汇表方法中，我们必须传递列名和该列的所有惟一标签。这对于用2–4个唯一值对列进行编码是可行的。</p><h1 id="ff9a" class="md jz hi bd ka me mf mg ke mh mi mj ki mk ml mm kl mn mo mp ko mq mr ms kr mt bi translated">哈希桶</h1><p id="bc13" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">在这种方法中，计算所有唯一值的散列并用标签替换。当您有高基数的列，无法传递所有唯一值的列表时，这很方便。</p><p id="cbab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于性别让我们，使用词汇列表法</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="8147" class="jy jz hi le b fi li lj l lk ll">gender = tf.feature_column.categorical_column_with_vocabulary_list("gender", ["Female", "Male"])</span></pre><p id="d234" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于基数较高的列，使用哈希桶；</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="2715" class="jy jz hi le b fi li lj l lk ll">occupation = tf.feature_column.categorical_column_with_hash_bucket("occupation", hash_bucket_size=1000)<br/>marital_status = tf.feature_column.categorical_column_with_hash_bucket("marital_status", hash_bucket_size=1000)<br/>relationship = tf.feature_column.categorical_column_with_hash_bucket("relationship", hash_bucket_size=1000)<br/>education = tf.feature_column.categorical_column_with_hash_bucket("education", hash_bucket_size=1000)<br/>workclass = tf.feature_column.categorical_column_with_hash_bucket("workclass", hash_bucket_size=1000)<br/>native_country = tf.feature_column.categorical_column_with_hash_bucket("native_country", hash_bucket_size=1000)</span></pre><p id="8bad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">连续数字列很简单，类似于上面的<code class="du mu mv mw le b">tf.feature_columns.numeric_column</code></p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="4f85" class="jy jz hi le b fi li lj l lk ll">age = tf.feature_column.numeric_column("age")<br/>education_num = tf.feature_column.numeric_column("education_num")<br/>capital_gain = tf.feature_column.numeric_column("capital_gain")<br/>capital_loss = tf.feature_column.numeric_column("capital_loss")<br/>hours_per_week = tf.feature_column.numeric_column("hours_per_week")</span></pre><p id="9c60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们都准备好了。现在，使用下面一行代码将所有这些特性包装在一个列表对象中</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="f2ba" class="jy jz hi le b fi li lj l lk ll">feat_cols = [gender,occupation,marital_status,relationship,education,workclass,native_country, age,education_num,capital_gain,capital_loss,hours_per_week]</span><span id="94f0" class="jy jz hi le b fi lo lj l lk ll">input_func=tf.estimator.inputs.pandas_input_fn(x=X_train,y=y_train,batch_size=100,num_epochs=None,shuffle=True)</span></pre><p id="8b22" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们已经准备好数据拆分和要使用的功能，让我们来训练模型。</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="7967" class="jy jz hi le b fi li lj l lk ll">input_func=tf.estimator.inputs.pandas_input_fn(x=X_train,y=y_train,batch_size=100,num_epochs=None,shuffle=True)</span><span id="a42b" class="jy jz hi le b fi lo lj l lk ll">model = tf.estimator.LinearClassifier(feature_columns=feat_cols)<br/>model.train(input_fn=input_func,steps=5000)</span></pre><p id="62f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在成功的训练中，你应该得到每个步骤/时期的损失和训练分数</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es mx"><img src="../Images/2430d81ed8c128c39375e58a93c02cb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lu8bCXhxaoU1jTOqlX7yjg.png"/></div></div></figure><p id="146b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们制作<code class="du mu mv mw le b">pred_fn</code>来保存我们的测试数据集，以便用<code class="du mu mv mw le b">shuffle=False</code>进行预测</p><p id="8449" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">重要提示:在训练模型时，您可以使用</em> <code class="du mu mv mw le b"><em class="jd">shuffle=True</em></code> <em class="jd">。通常使用shuffle来训练模型是有好处的。但是，在进行预测时，要确保你有</em> <code class="du mu mv mw le b"><em class="jd">shuffle=False</em></code> <em class="jd">，因为随机预测顺序你永远无法验证或衡量你的结果。</em></p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="21f3" class="jy jz hi le b fi li lj l lk ll">pred_fn = tf.estimator.inputs.pandas_input_fn(x=X_test,batch_size=len(X_test),shuffle=False)</span><span id="ca97" class="jy jz hi le b fi lo lj l lk ll">predictions = list(model.predict(input_fn=pred_fn))<br/>final_preds = []<br/>for pred in predictions:<br/>    final_preds.append(pred['class_ids'][0])</span></pre><p id="deb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预言已经准备好了。下一步是找出我们的张量流模型表现如何。</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="817c" class="jy jz hi le b fi li lj l lk ll">from sklearn.metrics import classification_report<br/>print(classification_report(y_test,final_preds))</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es my"><img src="../Images/1f33d5b1ff9c4ebea9468acaa297f841.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KG7-oNnKLVHhwdp0anbd8A.png"/></div></div></figure><p id="26e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">哇哦。对于一个普通的基线模型来说，这是一个很好的F1分数。现在，让我们看看我们模型的AUC指标。</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="a97b" class="jy jz hi le b fi li lj l lk ll">from sklearn.metrics import roc_curve, auc<br/>fpr, tpr, thresholds = roc_curve(y_test,final_preds)<br/>roc_auc = auc(fpr, tpr)<br/>print("ROC AUC Score: {}".format(roc_auc))<br/>plt.figure()<br/>plt.plot(fpr, tpr, color='green', lw=1, label='ROC curve (area = %0.2f)' % roc_auc)<br/>plt.plot([0, 1], [0, 1], color='navy', linestyle='--')<br/>plt.xlim([0.0, 1.0])<br/>plt.ylim([0.0, 1.05])<br/>plt.xlabel('False Positive Rate')<br/>plt.ylabel('True Positive Rate')<br/>plt.title('Receiver operating characteristic')<br/>plt.legend(loc="lower right")<br/>plt.show()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es mz"><img src="../Images/429ac055a2ff267081b1b535d8f309b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fj6aPEVPl269rqHFBPnpCw.png"/></div></div></figure><p id="2b25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们也获得了可接受的AUC分数0.738。为了调整分数，我们可以增加纪元或者进行特征工程，比如:</p><ol class=""><li id="bb47" class="lp lq hi ih b ii ij im in iq lr iu ls iy lt jc lu lv lw lx bi translated">使用年龄栏创建类别</li><li id="ca4c" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">计算平均工作时间</li><li id="eadb" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">教育的平均资本收益..等等</li></ol><p id="e0e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我把剩下的调整留给你。这个系列就说到这里。恭喜你用vanilla TensorFlow构建了你的第一个分类模型。干得好！</p><p id="847c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请在下面的评论中鼓掌、评论并分享你的想法。跟随<a class="ae jq" href="https://medium.com/analytics-vidhya" rel="noopener"> Analytics Vidhya </a>并关注即将到来的激动人心的系列文章</p></div></div>    
</body>
</html>