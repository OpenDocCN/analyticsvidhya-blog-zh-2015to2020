<html>
<head>
<title>Create a Django API in These 5 Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在这5个步骤中创建Django API</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/create-a-django-api-in-these-5-steps-cbd00d43c7ce?source=collection_archive---------6-----------------------#2020-11-28">https://medium.com/analytics-vidhya/create-a-django-api-in-these-5-steps-cbd00d43c7ce?source=collection_archive---------6-----------------------#2020-11-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="3c4b" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">更新网页元素而不刷新</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/0f72f4a9e3ac3d50a333af037749fbb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_AtSOlTCnn9wcncW5cP1UQ.jpeg"/></div></div></figure><p id="5958" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi kf translated">也许你想对数据库进行修改，并通过点击按钮将修改反映到网页上；就像一个应用程序，对吗？你要找的是<strong class="jl hj"> AJAX(异步JavaScript和XML) </strong>。</p><p id="1493" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">基本上我们要做两件事:</p><ol class=""><li id="a5f9" class="ko kp hi jl b jm jn jp jq js kq jw kr ka ks ke kt ku kv kw bi translated">跟你的项目一起调用一个用Django写的<strong class="jl hj"> API(应用编程接口)</strong>(没错，你现在就要做API！呀呀呀！).API将对数据库执行一些操作。</li><li id="0740" class="ko kp hi jl b jm kx jp ky js kz jw la ka lb ke kt ku kv kw bi translated">然后我们的API，以<strong class="jl hj">JSON(JavaScript Object Notation)</strong>格式发回数据；<strong class="jl hj"> </strong>表示存储在键-值对中的数据的好方法。然后使用这些数据更新DOM元素。</li></ol><blockquote class="lc ld le"><p id="5ed3" class="jj jk lf jl b jm jn ij jo jp jq im jr lg jt ju jv lh jx jy jz li kb kc kd ke hb bi translated">为什么不是XML？</p></blockquote><p id="b677" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">因为JSON在JavaScript中的表现方式，类似于Python数据结构“Dictionary”的创建方式；所以在编写API的时候会变得简单一点。</p><p id="c896" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">让我们开始吧。</p></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><h1 id="dcff" class="lq lr hi bd ls lt lu lv lw lx ly lz ma io mb ip mc ir md is me iu mf iv mg mh bi translated">第一步</h1><p id="b3e3" class="pw-post-body-paragraph jj jk hi jl b jm mi ij jo jp mj im jr js mk ju jv jw ml jy jz ka mm kc kd ke hb bi translated">我将给出一个例子。假设一个用户想在愿望列表中添加一个项目。现在我们需要知道两件事:</p><ol class=""><li id="3a52" class="ko kp hi jl b jm jn jp jq js kq jw kr ka ks ke kt ku kv kw bi translated">什么是<em class="lf">产品ID </em>？</li><li id="236b" class="ko kp hi jl b jm kx jp ky js kz jw la ka lb ke kt ku kv kw bi translated">什么是<em class="lf">行动</em>？</li></ol><p id="7c03" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">现在的行动将是<em class="lf">添加。</em></p><blockquote class="lc ld le"><p id="9787" class="jj jk lf jl b jm jn ij jo jp jq im jr lg jt ju jv lh jx jy jz li kb kc kd ke hb bi translated">我应该把这个值保存在哪里？</p></blockquote><p id="6b00" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们将在HTML中保存产品ID和动作，并使用自定义数据属性将它与特定按钮相关联，在我们的示例中是模板中的<code class="du mn mo mp mq b"><em class="lf">data-product</em></code>和<code class="du mn mo mp mq b"><em class="lf">data-action</em></code>。</p><p id="da70" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">还要添加一个类，以便我们可以在JavaScript中查找这个按钮。我用了<code class="du mn mo mp mq b"><em class="lf">update-wishlist</em></code>。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mr ms l"/></div></figure></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><h1 id="7088" class="lq lr hi bd ls lt lu lv lw lx ly lz ma io mb ip mc ir md is me iu mf iv mg mh bi translated">第二步</h1><blockquote class="lc ld le"><p id="de7f" class="jj jk lf jl b jm jn ij jo jp jq im jr lg jt ju jv lh jx jy jz li kb kc kd ke hb bi translated">好的，但是我们如何把这个值传递给服务器呢？</p></blockquote><p id="cc5a" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">使用JavaScript。</p><p id="212b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">记得我们给按钮添加了一个类<code class="du mn mo mp mq b"><em class="lf">update-wishlist</em> </code>。我们可以使用<code class="du mn mo mp mq b">getElementsByClassName</code>或<code class="du mn mo mp mq b">querySelectorAll</code>函数给我们的按钮添加一个事件监听器。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="bb5e" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">现在，一旦页面加载完毕，脚本就会运行，并使用类<code class="du mn mo mp mq b"><em class="lf">update-wishlist</em></code>将事件监听器添加到我们所有的按钮中。</p><blockquote class="lc ld le"><p id="51ec" class="jj jk lf jl b jm jn ij jo jp jq im jr lg jt ju jv lh jx jy jz li kb kc kd ke hb bi translated">但是等等，我们还没写函数<code class="du mn mo mp mq b">updateUserWishlist</code>！</p></blockquote><p id="298b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">是的，这就是我们要调用我们的API并获取一些数据的地方。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mr ms l"/></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">索引. js</figcaption></figure><blockquote class="lc ld le"><p id="8d36" class="jj jk lf jl b jm jn ij jo jp jq im jr lg jt ju jv lh jx jy jz li kb kc kd ke hb bi translated">这是怎么回事？</p></blockquote><p id="9bf0" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">基本上，我们使用<a class="ae mx" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" rel="noopener ugc nofollow" target="_blank">获取API </a>从URI获取资源，这是我们API的端点。</p><p id="d923" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">方法</strong>(第5行)为你从API发出的请求提供信息。根据使用情况，它可以是其中之一。</p><ul class=""><li id="2892" class="ko kp hi jl b jm jn jp jq js kq jw kr ka ks ke my ku kv kw bi translated"><strong class="jl hj"> GET </strong>:执行“读取”操作</li><li id="ad05" class="ko kp hi jl b jm kx jp ky js kz jw la ka lb ke my ku kv kw bi translated"><strong class="jl hj"> POST </strong>:执行“创建”操作</li><li id="721c" class="ko kp hi jl b jm kx jp ky js kz jw la ka lb ke my ku kv kw bi translated"><strong class="jl hj">放</strong> &amp; <strong class="jl hj">补丁</strong>:执行“更新”操作</li><li id="264e" class="ko kp hi jl b jm kx jp ky js kz jw la ka lb ke my ku kv kw bi translated"><strong class="jl hj">删除</strong>:执行“删除”操作</li></ul><p id="15c8" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">但是要记住每个方法都指定了一个只能在数据库上执行的特定操作。如果API不接受您指定的方法，您将在控制台中得到类似这样的错误。</strong></p><pre class="iy iz ja jb fd mz mq na nb aw nc bi"><span id="017d" class="nd lr hi mq b fi ne nf l ng nh">405 (Method Not Allowed)</span></pre><p id="be74" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj"> Headers </strong>(第6行)代表响应/请求头，允许您查询它们并根据结果采取不同的行动。</p><p id="f8c2" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">主体</strong>(第7行)代表对请求的响应。</p><p id="6bc8" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这个fetch方法返回一个包含响应的承诺(一个<code class="du mn mo mp mq b">Response</code>对象)。目前，我们将发送产品ID和操作。</p><p id="eb01" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">然后，必须将响应读取为JSON，并将其传递给另一个函数<code class="du mn mo mp mq b">updateNavbar</code>，我们将在那里更新navbar。用你自己的更新DOM元素的函数替换它。</p><p id="420f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">将该文件与其他JavaScript文件一起添加到index.html的末尾。</p></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><h1 id="8d24" class="lq lr hi bd ls lt lu lv lw lx ly lz ma io mb ip mc ir md is me iu mf iv mg mh bi translated">第三步</h1><p id="902d" class="pw-post-body-paragraph jj jk hi jl b jm mi ij jo jp mj im jr js mk ju jv jw ml jy jz ka mm kc kd ke hb bi translated">现在我们需要处理我们的数据，但首先我们需要设置一些东西。在您最喜欢的IDE/文本编辑器中打开您的项目，然后跟着做。</p><h2 id="5059" class="nd lr hi bd ls ni nj nk lw nl nm nn ma js no np mc jw nq nr me ka ns nt mg nu bi translated">第一步:安装<a class="ae mx" href="https://www.django-rest-framework.org/" rel="noopener ugc nofollow" target="_blank"> Django Rest框架</a>。</h2><p id="0a29" class="pw-post-body-paragraph jj jk hi jl b jm mi ij jo jp mj im jr js mk ju jv jw ml jy jz ka mm kc kd ke hb bi translated">从您的项目根目录运行一个终端，并编写以下命令来安装pip包</p><pre class="iy iz ja jb fd mz mq na nb aw nc bi"><span id="0109" class="nd lr hi mq b fi ne nf l ng nh">pip install djangorestframework</span></pre><h2 id="b880" class="nd lr hi bd ls ni nj nk lw nl nm nn ma js no np mc jw nq nr me ka ns nt mg nu bi translated">第二步:让我们从创建一个新的应用程序开始。</h2><p id="13d7" class="pw-post-body-paragraph jj jk hi jl b jm mi ij jo jp mj im jr js mk ju jv jw ml jy jz ka mm kc kd ke hb bi translated">我们首先需要创建一个新的应用程序，我将命名为<code class="du mn mo mp mq b">serverapi</code>。因此，我们将在终端中再次运行一个命令。</p><pre class="iy iz ja jb fd mz mq na nb aw nc bi"><span id="ab8e" class="nd lr hi mq b fi ne nf l ng nh">python manage.py startapp serverapi</span></pre><h2 id="d8bb" class="nd lr hi bd ls ni nj nk lw nl nm nn ma js no np mc jw nq nr me ka ns nt mg nu bi translated">步骤3:将app和rest_framework添加到您的Django settings.py文件INSTALLED_APPS列表中</h2><p id="309b" class="pw-post-body-paragraph jj jk hi jl b jm mi ij jo jp mj im jr js mk ju jv jw ml jy jz ka mm kc kd ke hb bi translated">与其他应用程序一起，以这种方式添加服务器API应用程序，</p><p id="08dd" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><code class="du mn mo mp mq b">appname.apps.AppnameConfig</code></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mr ms l"/></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">settings.py</figcaption></figure><h2 id="f4f3" class="nd lr hi bd ls ni nj nk lw nl nm nn ma js no np mc jw nq nr me ka ns nt mg nu bi translated">步骤4:将URL添加到项目的主urls.py和新应用程序的urls.py文件中。</h2><p id="404e" class="pw-post-body-paragraph jj jk hi jl b jm mi ij jo jp mj im jr js mk ju jv jw ml jy jz ka mm kc kd ke hb bi translated">在您的主urls.py文件中，添加您新创建的应用程序的URL文件的路径以及其他URL。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mr ms l"/></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">主urls.py文件</figcaption></figure><p id="95c5" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">现在，我们将在您新创建的应用程序中添加路径查看功能。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mr ms l"/></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">创建的应用程序的urls.py文件</figcaption></figure></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><h1 id="6b3d" class="lq lr hi bd ls lt lu lv lw lx ly lz ma io mb ip mc ir md is me iu mf iv mg mh bi translated">第四步</h1><p id="83b0" class="pw-post-body-paragraph jj jk hi jl b jm mi ij jo jp mj im jr js mk ju jv jw ml jy jz ka mm kc kd ke hb bi translated">现在，我们已经设置好了一切，我们现在可以编写我们的视图了。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mr ms l"/></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">serverapi/views.py</figcaption></figure><p id="4faf" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><code class="du mn mo mp mq b">api_view</code>装饰器接受一个你的视图应该响应的HTTP方法列表。然后我们继续访问来自request的数据，这样我们就可以看到传递给服务器的内容。这是您需要确保只允许那些为其编写视图的方法的地方。</p><p id="dbfd" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">现在，就像普通视图一样，我们继续基于动作处理数据库，一旦完成，我们返回一个<code class="du mn mo mp mq b">JsonResponse</code>，然后可以在我们的JavaScript中接收到它。</p></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><h1 id="36f3" class="lq lr hi bd ls lt lu lv lw lx ly lz ma io mb ip mc ir md is me iu mf iv mg mh bi translated">第五步</h1><blockquote class="lc ld le"><p id="6365" class="jj jk lf jl b jm jn ij jo jp jq im jr lg jt ju jv lh jx jy jz li kb kc kd ke hb bi translated">好的，但是我们什么时候更新了DOM元素？</p></blockquote><p id="b325" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">还记得我们在步骤2中将<code class="du mn mo mp mq b">Response</code>传递给了<code class="du mn mo mp mq b">updateNavbar</code>吗。您可以随意使用传递的数据。现在我将更新导航条。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mr ms l"/></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">索引. js</figcaption></figure><p id="503f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">还有，我们还没有添加<a class="ae mx" href="https://docs.djangoproject.com/en/3.1/ref/csrf/" rel="noopener ugc nofollow" target="_blank"><strong class="jl hj">【CSRF】(跨站点请求防伪)</strong> </a>令牌。通俗地说，我们希望只接受来自原始应用程序的请求，而不是假装来自原始应用程序的外部站点的请求；以避免攻击者执行恶意动作。</p><p id="25c9" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">所以，要么直接在你的index.html里面添加下面的线，要么创建一个新的。js文件并将其添加到head标签中。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mr ms l"/></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">csrf.js</figcaption></figure></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nv"><img src="../Images/130060c4c058d6d176870ac09a7a50e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*tyV9wf9Jo8xyopbGwkJRBg.gif"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">结果</figcaption></figure><p id="d67b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这是我最近参与的一个项目的一部分。<a class="ae mx" href="https://github.com/Anurag-117/Shopiva" rel="noopener ugc nofollow" target="_blank"> Shopiva </a>。</p><p id="5e7b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">关注我，分享我的<strong class="jl hj">旅程</strong>，你也可以在<strong class="jl hj"/><a class="ae mx" href="https://www.linkedin.com/in/anuragdhadse/" rel="noopener ugc nofollow" target="_blank"><strong class="jl hj">LinkedIn</strong></a>|<a class="ae mx" href="https://github.com/adhadse" rel="noopener ugc nofollow" target="_blank"><strong class="jl hj">Github</strong></a><strong class="jl hj"/>上联系我。</p></div></div>    
</body>
</html>