<html>
<head>
<title>Interpreting ACF or Auto-correlation plot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解读ACF或自相关图</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/interpreting-acf-or-auto-correlation-plot-d12e9051cd14?source=collection_archive---------0-----------------------#2020-11-25">https://medium.com/analytics-vidhya/interpreting-acf-or-auto-correlation-plot-d12e9051cd14?source=collection_archive---------0-----------------------#2020-11-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2857" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">时间序列与其自身的滞后版本线性相关。</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/800459ed843c8f342eadf70eb4b67882.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/0*j-VmEGMEBYr23Qhx.gif"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated"><a class="ae jq" href="https://www.aridhia.com/blog/creating-animated-time-series-charts-with-dygraphs-and-htmlwidgets/" rel="noopener ugc nofollow" target="_blank">图片由</a>提供</figcaption></figure><blockquote class="jr js jt"><p id="172e" class="if ig jd ih b ii ij ik il im in io ip ju ir is it jv iv iw ix jw iz ja jb jc hb bi translated">什么是ACF情节？</p></blockquote><p id="47b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">时间序列</strong>是一段时间内对相同变量的一系列测量。通常，测量在均匀间隔的时间进行，例如，每月或每年。时间序列中两个值之间的相关系数称为<strong class="ih hj">自相关函数</strong> ( <strong class="ih hj"> ACF </strong>)。换句话说，</p><p id="f10a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd"> &gt;自相关表示给定时间序列与其自身在连续时间间隔内的滞后版本之间的相似程度。</em></p><p id="8b2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd"> &gt;自相关测量变量的当前值与其过去值之间的关系。</em></p><p id="93f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd"> &gt;自相关+1代表完全正相关，自相关-1代表完全负相关。</em></p><blockquote class="jr js jt"><p id="a1ac" class="if ig jd ih b ii ij ik il im in io ip ju ir is it jv iv iw ix jw iz ja jb jc hb bi translated">为什么有用？</p></blockquote><ol class=""><li id="a7ad" class="jx jy hi ih b ii ij im in iq jz iu ka iy kb jc kc kd ke kf bi translated">帮助我们发现数据中隐藏的模式，并帮助我们选择正确的预测方法。</li><li id="606c" class="jx jy hi ih b ii kg im kh iq ki iu kj iy kk jc kc kd ke kf bi translated">帮助识别时间序列数据中的季节性。</li><li id="2f7b" class="jx jy hi ih b ii kg im kh iq ki iu kj iy kk jc kc kd ke kf bi translated">分析自相关函数(ACF)和偏自相关函数(PACF)对于选择合适的ARIMA模型进行时间序列预测是必要的。</li></ol><blockquote class="jr js jt"><p id="15c7" class="if ig jd ih b ii ij ik il im in io ip ju ir is it jv iv iw ix jw iz ja jb jc hb bi translated">ACF有什么假设吗？</p></blockquote><p id="1596" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">弱平稳—意味着均值、方差没有系统性变化，也没有系统性波动。</p><p id="6351" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，在执行ACF时，建议消除数据中存在的任何趋势，并确保数据是稳定的。</p><blockquote class="jr js jt"><p id="0599" class="if ig jd ih b ii ij ik il im in io ip ju ir is it jv iv iw ix jw iz ja jb jc hb bi translated">用真实数据集试试？</p></blockquote></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><pre class="jf jg jh ji fd ks kt ku kv aw kw bi"><span id="9f24" class="kx ky hi kt b fi kz la l lb lc">data = pd.read_csv(<strong class="kt hj">'data.csv'</strong>,<br/>                   engine=<strong class="kt hj">'python'</strong>,parse_dates=[0], <br/>                   index_col = <strong class="kt hj">'Time'</strong>, <br/>                  date_parser = parser)<br/><br/>st_date = pd.to_datetime(<strong class="kt hj">"2008-01-01"</strong>)<br/>data = data[st_date:]</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ld"><img src="../Images/fc24762184b8e345c47ae7fd91920f99.png" data-original-src="https://miro.medium.com/v2/resize:fit:388/format:webp/1*QJZsThxjFM_D3_JIqQT5Ow.png"/></div></figure><p id="915f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据的曲线图如下所示:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es le"><img src="../Images/83b5ddd53f4b05c519794bc799cfa075.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J9pnjzxTRduj6iAW15RfMw.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">从2008年到2018年</figcaption></figure><p id="b851" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，在执行ACF之前，让我们移除趋势，看看它是什么样子的:</p><pre class="jf jg jh ji fd ks kt ku kv aw kw bi"><span id="1a18" class="kx ky hi kt b fi kz la l lb lc"><em class="jd">#acf -&gt; remove trend <br/></em>data[<strong class="kt hj">"diff"</strong>] = data.diff()<br/><br/>ax = data.plot()<br/>ax.legend(ncol=5, <br/>          loc=<strong class="kt hj">'upper center'</strong>,<br/>          bbox_to_anchor=(0.5, 1.0),<br/>          bbox_transform=plt.gcf().transFigure)<br/><strong class="kt hj">for </strong>yr <strong class="kt hj">in </strong>range(2008, 2018):<br/>    ax.axvline(pd.to_datetime(str(yr)+<strong class="kt hj">"-01-01"</strong>), color =<strong class="kt hj">"red"</strong>, linestyle = <strong class="kt hj">"--"</strong>, alpha = 0.2)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es lj"><img src="../Images/4f406009d4180e6163c4ac26438681eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oanuZb640uHlbD-W3Kf2PA.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">使用pandas的diff()方法移除趋势，该方法查找上个月和当前月值之间的差异</figcaption></figure><p id="9ee2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们应用ACF:</p><pre class="jf jg jh ji fd ks kt ku kv aw kw bi"><span id="0275" class="kx ky hi kt b fi kz la l lb lc"><strong class="kt hj">from </strong>statsmodels.graphics.tsaplots <strong class="kt hj">import </strong>plot_acf<br/>data[<strong class="kt hj">"diff"</strong>].iloc[0] = 0<br/>plot_acf(data["diff"])<br/>plt.show()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es lk"><img src="../Images/1dddd2c51fa0ddb6d690002a2c0c1ac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D47OrJDcue-6y9Hbiu8ANg.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">x轴&gt;滞后月数，y轴&gt;相关系数</figcaption></figure><blockquote class="jr js jt"><p id="5085" class="if ig jd ih b ii ij ik il im in io ip ju ir is it jv iv iw ix jw iz ja jb jc hb bi translated">你能看到现在的季节性吗？</p></blockquote><p id="c60b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意滞后3，6，9，12时的系数有多高。就月份而言，如果我不得不说，三月，六月，九月，十二月的相关性很高，而一月，二月和四月的相关性很低，但这也会随着时间的推移而消失。我们将重点关注蓝色区域以外的点，因为它们具有很强的统计学意义。</p><p id="dfc0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">重要提示:<strong class="ih hj">确保你的数据没有NA值，否则ACF会失败。</strong></p><blockquote class="jr js jt"><p id="c2aa" class="if ig jd ih b ii ij ik il im in io ip ju ir is it jv iv iw ix jw iz ja jb jc hb bi translated">我们能不能分开看趋势和季节性来深入研究数据？</p></blockquote><p id="dc78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是的，我们来分解数据。为此，我将使用一个统计模型API，但是也可以使用NumPy和Pandas来分解时间序列的三个部分——趋势、季节性和剩余。</p><pre class="jf jg jh ji fd ks kt ku kv aw kw bi"><span id="f39f" class="kx ky hi kt b fi kz la l lb lc"><strong class="kt hj">from </strong>statsmodels.tsa.seasonal <strong class="kt hj">import </strong>seasonal_decompose<br/><br/>res = seasonal_decompose(data, model = <strong class="kt hj">"additive"</strong>,period = 30)<br/><br/>fig, (ax1,ax2,ax3) = plt.subplots(3,1, figsize=(15,8))<br/>res.trend.plot(ax=ax1,ylabel = <strong class="kt hj">"trend"</strong>)<br/>res.resid.plot(ax=ax2,ylabel = <strong class="kt hj">"seasoanlity"</strong>)<br/>res.seasonal.plot(ax=ax3,ylabel = <strong class="kt hj">"residual"</strong>)<br/>plt.show()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es ll"><img src="../Images/fd3ff353ff389ada04bdb0bc9b06fe77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sTDzf6i5ejD7PG6tNb6uEw.png"/></div></div></figure><p id="7918" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，我选择了加法而不是乘法，因为幅度不会随时间呈指数增长。</p><p id="f47c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，如果我对API生成的res.seasonal组件运行相同的ACF图，我们将获得与之前相同的系数。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es lm"><img src="../Images/bd4785408309ef72bd87875510c170bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B0P9YDqiAL0qzZ2U3uMaBA.png"/></div></div></figure></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><p id="5c18" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这有帮助。时间序列分析可能会令人困惑和费时。因此，有必要明确基本概念。我自己也在学习的过程中。所以，在你离开之前，请留下你的评论或有价值的反馈。:)</p><p id="5fe6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">参考文献</em>:</p><div class="ln lo ez fb lp lq"><a href="https://dzone.com/articles/autocorrelation-in-time-series-data" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hj fi z dy lv ea eb lw ed ef hh bi translated">时间序列数据中的自相关</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">时间序列是一系列按时间索引的数据点。时间序列数据是有序的这一事实使得它在…</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">dzone.com</p></div></div><div class="lz l"><div class="ma l mb mc md lz me jk lq"/></div></div></a></div><p id="5ff4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jq" href="https://github.com/bhattbhavesh91/time-series-decomposition-from-scratch/blob/master/time-series-decomposition-from-scratch.ipynb" rel="noopener ugc nofollow" target="_blank">T3】https://github . com/bhattbhavesh 91/time-series-decomposition-from scratch/blob/master/time-series-decomposition-from scratch . ipynbT5】</a></p><p id="8068" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jq" href="https://github.com/ritvikmath/Time-Series-Analysis/blob/master/Time%20Series%20Data.ipynb" rel="noopener ugc nofollow" target="_blank"><em class="jd">https://github . com/ritvikmath/Time-Series-Analysis/blob/master/Time % 20 Series % 20 data . ipynb</em></a></p></div></div>    
</body>
</html>