<html>
<head>
<title>Pandas: Pivot &amp; Multiindex</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫:透视和多索引</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/pandas-stack-unstack-pivot-table-crosstab-5cb9a16fe020?source=collection_archive---------3-----------------------#2019-09-14">https://medium.com/analytics-vidhya/pandas-stack-unstack-pivot-table-crosstab-5cb9a16fe020?source=collection_archive---------3-----------------------#2019-09-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="9aae" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">数据透视表、堆叠/拆分是处理多索引对象的基本方法</h2></div><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es iy"><img src="../Images/78e55368e80e163b5faa2d7cab0d217c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4g0BlUo7Hd7Flru1"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">从杂乱中找到简单</figcaption></figure><p id="2d94" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">创建强大的预测引擎始于创建正确的数据集。在大多数现实生活中的数据科学问题中，我们没有一个干净的和准备好的数据集来建立模型。在整个过程中，</p><ul class=""><li id="1d2d" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated">我们定义问题和范围，</li><li id="8c1d" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">定义和创建响应变量，派生新功能，</li><li id="edee" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">做大量的数据处理和可视化。</li></ul><p id="191b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">而以上步骤又都需要熊猫。在上一个练习中，我们讨论了指数P <a class="ae ky" href="https://towardsdatascience.com/pandas-index-explained-b131beaf6f7b" rel="noopener" target="_blank">和as指数解释</a>，这对更好地了解熊猫至关重要。上一篇文章解释了选择和过滤的索引用法。在本练习中，我们看到了使用<em class="kz">堆栈/拆分、Pivot_table、交叉表</em>进行数据处理&amp;可视化。我们将使用<em class="kz"> UCI机器学习成人数据集</em></p><blockquote class="la lb lc"><p id="de1d" class="jo jp kz jq b jr js ij jt ju jv im jw ld jy jz ka le kc kd ke lf kg kh ki kj hb bi translated"><strong class="jq hj">业务问题:</strong>分类(一个人收入50k以上或以下)；<strong class="jq hj">响应特征:</strong>标签；<strong class="jq hj">预测因素</strong>:国家、年龄、教育、职业、婚姻状况等。</p></blockquote></div><div class="ab cl lg lh gp li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="hb hc hd he hf"><p id="30f6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">以下是解释笔记本的片段，GitHub repo的这个练习可以从最后的链接中克隆。正在读取数据😌</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es ln"><img src="../Images/256e3e243c304a3c0c2e4602858f981b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uEVGdbJc1tQZpR7CwgaBmQ.png"/></div></div></figure><p id="1f3e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一些预测特征是年龄、<em class="kz">工作阶级</em>、<em class="kz">教育程度</em>、<em class="kz">婚姻状况</em>、<em class="kz">种族、性别、原籍国、每周小时数</em>，而响应特征是<em class="kz">标签</em>。另外，我们将标签值<em class="kz"> &lt; =50K、&gt; 50K </em>分别替换为<em class="kz"> 0 </em>和<em class="kz"> 1 </em>。</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es lo"><img src="../Images/e94c1801feb26f59fb65f987278d34fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sks2YDEJEc4R-a7P3abYIw.png"/></div></div></figure><p id="a742" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="kz">双变量分析</em>解释并验证特征之间的关系。分类特征需要<em class="kz"> groupby </em>并应用函数来理解它们与数字和其他分类特征的关系。在这种情况下，Pandas Pivot_table、Stack/ Unstack &amp;交叉表方法非常强大。</p><h1 id="8c89" class="lp lq hi bd lr ls lt lu lv lw lx ly lz io ma ip mb ir mc is md iu me iv mf mg bi translated">数据透视表_表格</h1><p id="dbfd" class="pw-post-body-paragraph jo jp hi jq b jr mh ij jt ju mi im jw jx mj jz ka kb mk kd ke kf ml kh ki kj hb bi translated">它有三个参数，名称如下:索引、列和值。数据集的分类特征可以在索引和列中传递。新表格的单元格值取自作为values参数给出的列。</p><p id="d735" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">回到我们的数据集，通常，收入经常与职业相关。那么，我们就以职业为支点，看看哪些职业有高收入人群。</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es mm"><img src="../Images/419588b799802720b9a8e6e9c6a3b5d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-lMX3ma3CQI9U049StWCsw.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">高管、专业人士和销售人员中收入超过5万英镑的男性和女性人数最多，这可能会成为一个重要特征。</figcaption></figure><p id="53b5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在旋转过程中也可以使用多列，我们可以使用pivot_table，如下所示。</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es mn"><img src="../Images/891c541023106add7e99d79241ce47a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8q0jHjSh2YhCOoRQCWZAWQ.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">多索引列</figcaption></figure><p id="76bd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">另外，检查<strong class="jq hj">点索引</strong>和<strong class="jq hj">点列，</strong>将打印pivot_table的索引和列。多索引列可以简化为一个级别，也可以像下面这样重命名:-</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es mo"><img src="../Images/3552567469c0a0b3fa92e859f382492e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*--ioPqCGpveCIFHpXzbH5w.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">合并前两层后的单层柱</figcaption></figure><h1 id="77b8" class="lp lq hi bd lr ls lt lu lv lw lx ly lz io ma ip mb ir mc is md iu me iv mf mg bi translated">交叉表</h1><p id="0bd7" class="pw-post-body-paragraph jo jp hi jq b jr mh ij jt ju mi im jw jx mj jz ka kb mk kd ke kf ml kh ki kj hb bi translated"><em class="kz"> pd.crosstab </em>可以像<em class="kz"> pivot_table </em>一样使用，但是默认情况下，它计算两个(或更多)<strong class="jq hj">分类特性的简单频率表。</strong>因为<em class="kz">值</em>对于交叉表不是强制的，但是<em class="kz">值</em>和<em class="kz">聚合函数</em>可以被传递，如果需要的话。<br/>让我们看一个简单的<em class="kz">交叉表</em>的例子，并绘制它。教育也是估算收入的一个重要因素。</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es mn"><img src="../Images/9834992f078552e286336d0ae7d24ee0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O1DjxikykP3G5GkiMrsjEw.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">教育和性别频率表</figcaption></figure><p id="db9a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">通过传递<em class="kz">值</em>和<em class="kz">聚集</em>参数，可以像pivot_table一样使用交叉表。下面是在交叉表的帮助下，跨越教育和性别(男/女)特征的收入超过50K的人的条形图</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es mp"><img src="../Images/c2103af05db00736df4d739b353682f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ozV8sz563AoEM0L-vi8edg.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">十字选项卡图:x轴上的索引和y轴上的值</figcaption></figure><p id="c8f2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">pd.cross tab还有一个参数<em class="kz">归一化</em>。当我们进行双变量分析时，频率表也可以标准化以显示百分比<em class="kz">而不是计数:</em></p><pre class="iz ja jb jc fd mq mr ms mt aw mu bi"><span id="6569" class="mv lq hi mr b fi mw mx l my mz">pd.crosstab(adult.education,adult.label_50, normalize = True)</span></pre><h1 id="c8b8" class="lp lq hi bd lr ls lt lu lv lw lx ly lz io ma ip mb ir mc is md iu me iv mf mg bi translated">堆叠/拆分</h1><p id="3d78" class="pw-post-body-paragraph jo jp hi jq b jr mh ij jt ju mi im jw jx mj jz ka kb mk kd ke kf ml kh ki kj hb bi translated">堆叠一个数据帧意味着移动<em class="kz">最里面的列</em>索引成为<em class="kz">最里面的行索引</em>。相反的操作称为拆垛。<br/> <strong class="jq hj">什么是堆叠</strong>？-如果我们有多个索引列，并且通过将最内部的列级别移动到最内部的行级别来减少数据集列。所以堆栈是<em class="kz">列到行(最里面)。<br/> </em> <strong class="jq hj">什么是拆垛？- </strong>如果我们有多个索引行，并且我们通过将最内部的行级别移动到最内部的列级别来减少数据集行。所以<em class="kz">拆垛</em>是<em class="kz">行到列(最里面)。<br/> </em>在我们下载的数据中，我们没有任何多重索引，但是我们的透视数据集有多重索引。查看数据透视表数据集</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es ln"><img src="../Images/2b1324f10a625f578ffe06e1699b5a1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-YQNezcvy84O1kBEMKOACw.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">初始数据透视表</figcaption></figure><p id="c2e3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="kz"> stack </em>将内部级别列移动到内部级别行，并且可以再次取消堆叠，使其回到原始的枢轴形状。</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es na"><img src="../Images/ca7bb28cdeac4eab751a235716397b2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xQ7eDYNExPh_NTLJ94NJ6Q.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">堆叠后的数据透视表</figcaption></figure><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es nb"><img src="../Images/334774c7e8d9dae1915dff772b42c11d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gUn6Z4BlMwrUs6bX0j_LRA.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">堆叠和拆分带来了原始数据透视表</figcaption></figure><p id="a3c0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">通过参数<em class="kz">级别，可直接在不同级别进行堆叠/拆堆。</em></p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es lo"><img src="../Images/2ac3758b011ae6187c5f81b8d278b0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D0PbQE00I-2bLNthi825Kg.png"/></div></div></figure><p id="c0ff" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这些方法真的帮助我们把那些见解和模型解释带出来。分层/多级索引非常令人兴奋，因为它为一些非常复杂的数据分析和操作打开了大门，特别是对于处理更高维度的数据。这个练习的Jupyter nb可以从<a class="ae ky" href="https://github.com/manu007sharma/PandasAll" rel="noopener ugc nofollow" target="_blank"> Github repo下载。</a></p></div><div class="ab cl lg lh gp li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="hb hc hd he hf"><p id="6a00" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">感谢阅读。如果你喜欢过这篇文章，你可能也会喜欢<a class="ae ky" href="https://towardsdatascience.com/pandas-index-explained-b131beaf6f7b" rel="noopener" target="_blank"> <em class="kz">熊猫指数——隐形</em> </a> <em class="kz">灵魂、</em> <a class="ae ky" href="https://towardsdatascience.com/transformation-scaling-of-numeric-features-intuition-7f4436e8e074" rel="noopener" target="_blank"> <em class="kz">缩放&amp;变换&amp; </em> </a> <em class="kz">哪里</em></p><ul class=""><li id="f9a7" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated"><em class="kz">更多请关注我上</em> <a class="ae ky" rel="noopener" href="/@manusharma_66718"> <em class="kz">中</em> </a></li><li id="ec53" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated"><em class="kz">让我们连线上</em><a class="ae ky" href="http://www.linkedin.com/in/data2datasciences/" rel="noopener ugc nofollow" target="_blank"><em class="kz">Linkedin</em></a></li></ul></div></div>    
</body>
</html>