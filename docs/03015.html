<html>
<head>
<title>Joins in Spark — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">加入Spark —第二部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/joins-in-spark-7594d0027031?source=collection_archive---------10-----------------------#2020-01-12">https://medium.com/analytics-vidhya/joins-in-spark-7594d0027031?source=collection_archive---------10-----------------------#2020-01-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bed1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文解释了spark应用程序中发生的连接类型。</p><p id="e543" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">排序合并连接</strong></p><p id="1895" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">排序合并连接是最基本的连接类型，可以追溯到Map Reduce基础。</p><p id="5d2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">混洗散列连接的第一步是Spark将<strong class="ih hj">通过两个表映射</strong>，并创建一个<strong class="ih hj">输出键</strong>。输出键是连接表的字段。使用输出键，Spark将对数据进行混洗。</p><p id="fcd3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Spark将挑选每个键并在其上创建一个散列，决定该键应该放入哪个分区，然后排序、<strong class="ih hj">洗牌</strong>并将数据加载到各自的分区。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/3abd764e8f32a81a6202b65ecbeb7d1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FypSoWx-_XU2BQdxxQyYhw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">排序合并联接</figcaption></figure><p id="a8d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj">减少</strong>阶段，具有相同关键字的两个表的任何一行都在同一台机器上并被排序。Reduce阶段是连接实际发生的阶段，因为一个键的两个表中的数据在同一台机器上，所以连接可以并行运行。</p><p id="6027" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">性能:</strong></p><p id="932b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您拥有的数据是以下情况时，排序合并联接效果最佳</p><ul class=""><li id="9349" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">与要连接的键均匀分布。</li><li id="b774" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">拥有足够数量的并行键。</li></ul><p id="a9bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">广播哈希连接</strong></p><p id="5f8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当其中一个数据帧小到足以容纳单个执行器的工作内存时，您可以强制Spark广播该数据。10mb是<code class="du kh ki kj kk b">spark.sql.autoBroadcastJoinThreshold</code>的默认值</p><p id="57d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您仍然可以根据您的执行者大小来增加这个阈值。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kl"><img src="../Images/f99542cfa45d757c8908fc80723ef31b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6gM0HVWelq2P20Bh4c4Mwg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">广播加入</figcaption></figure><p id="3c4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在小数据集被广播之后，连接并行运行，然后结果被传递给驱动程序。这成倍地增加了火花处理，因为它消除了洗牌阶段。</p><blockquote class="km kn ko"><p id="4190" class="if ig kp ih b ii ij ik il im in io ip kq ir is it kr iv iw ix ks iz ja jb jc hb bi translated">有关广播的更多信息，请参考本文<a class="ae kt" rel="noopener" href="/analytics-vidhya/persistence-vs-broadcast-625265320bf9">文章</a>。</p></blockquote></div></div>    
</body>
</html>