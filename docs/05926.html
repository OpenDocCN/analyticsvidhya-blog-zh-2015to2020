<html>
<head>
<title>Django + React, Redux and JWT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">姜戈+ React，Redux和JWT</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/django-react-redux-and-jwt-728e284c5bc9?source=collection_archive---------4-----------------------#2020-05-06">https://medium.com/analytics-vidhya/django-react-redux-and-jwt-728e284c5bc9?source=collection_archive---------4-----------------------#2020-05-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="0fec" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">走向全栈开发</h2></div><h1 id="3fc4" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">前言</h1><p id="5209" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">在过去的4年里，我一直在用Python编程，当涉及到web时，我总是用Django + Bootstrap和jQuery。我也知道如何用css来设计一个页面，但是没有什么特别的。我总是远离现代spa和它们的框架/库，如React、Angular或Vue。我试过一次，体验很恐怖。我对babel、webpack、yarn以及它们是如何粘在一起的一无所知。更不用说JS中的箭头函数和析构了。但最终我决定再试一次，并花了不知多少时间观看React上的教程。所以现在这是我尝试让Django后端与React前端一起工作。</p><p id="d47b" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">本文的目标是拥有一个带有JSON Web Token身份验证的最小后端，一个带有登录/注销功能的简单前端，以及一个只为登录用户提供的受保护页面。对我来说，这主要是为了让一切顺利进行。因此，如果将来我需要重复这些步骤，我可以回顾我所做的并重复这些步骤。因此，我决定:</p><ul class=""><li id="ee59" class="kq kr hi jr b js kl jv km jy ks kc kt kg ku kk kv kw kx ky bi translated">保留默认的SQLite数据库，以便可以根据需要替换它</li><li id="b4ae" class="kq kr hi jr b js kz jv la jy lb kc lc kg ld kk kv kw kx ky bi translated">不要使用任何UI框架或任何样式，因为那样会显得固执己见，而且不适合每个项目</li></ul><p id="b7eb" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">还有一点要注意。我不会详细讨论这里列出的代码。如果你想真正理解事物，有大量有用的信息。我会列出每一个对我有帮助的资源。这只是一个操作指南。完整的代码可以在我的<a class="ae le" href="https://github.com/c-v-ya/djact" rel="noopener ugc nofollow" target="_blank"> github </a>和<a class="ae le" href="https://gitlab.com/c.v.ya/djact" rel="noopener ugc nofollow" target="_blank"> gitlab </a>上找到。</p><p id="2fd6" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">所有这些都过去了，拥抱你自己去做一个长篇阅读吧！我希望这对你有用😊</p><h1 id="ed8f" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">先决条件</h1><p id="5099" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">您需要在系统上安装以下软件包:python(版本3，这里没有遗留代码😎)，pip，node，npm，yarn。我使用的是Arch linux，所以列出的命令应该与任何其他类似Unix的系统相同或相似。</p><p id="e495" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">让我们从创建一个项目目录开始，将<code class="du lf lg lh li b">mkdir djact</code>和<code class="du lf lg lh li b">cd</code>放入其中。然后用<code class="du lf lg lh li b">python -m venv venv</code>创建虚拟环境并激活它— <code class="du lf lg lh li b">source venv/bin/activate</code>。</p><h1 id="8edd" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">创建Django项目</h1><p id="be94" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">用<code class="du lf lg lh li b">pip install django djangorestframework djangorestframework-simplejwt django-cors-headers</code>安装Django、REST框架和JWT处理。最后一个包是允许我们的开发react服务器与Django应用程序交互所必需的。让我们在安装一些东西之后保存我们的依赖关系:<code class="du lf lg lh li b">pip freeze &gt; requirements.txt</code>。现在开始一个新项目<code class="du lf lg lh li b">django-admin startproject djact .</code>。注意最后的<code class="du lf lg lh li b">.</code>，它告诉Django在当前目录下创建项目。</p><h1 id="08c1" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">应用程序</h1><p id="a57b" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我喜欢把我所有的应用程序和设置放在一个单独的目录里。那么就让它:<code class="du lf lg lh li b">mkdir djact/{apps, settings}</code>。并将<code class="du lf lg lh li b">setting.py</code>移动到新创建的设置目录中。将<code class="du lf lg lh li b">settings</code>做成一个包<code class="du lf lg lh li b">touch djact/settings/__init__.py</code>，并在其中插入以下代码行:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="560b" class="lr iy hi li b fi ls lt l lu lv"># djact/settings/__init__.py<br/>from .settings import *</span></pre><p id="b78f" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">在这里和每个文件列表中，第一行是一个注释，带有文件的相对路径。只是想让你知道。</p><p id="25af" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">这样我们就不需要覆盖<code class="du lf lg lh li b">DJANGO_SETTINGS_MODULE</code>变量。</p><h1 id="0264" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">核心</h1><p id="8d0d" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">现在为核心应用程序<code class="du lf lg lh li b">mkdir djact/apps/core</code>和应用程序本身<code class="du lf lg lh li b">python manage.py startapp core djact/apps/core</code>创建一个目录。在这个新创建的目录<code class="du lf lg lh li b">mkdir {templates,templatetags}</code>中。<br/>创建一个空的<code class="du lf lg lh li b">__init__.py</code>并在<code class="du lf lg lh li b">templatetags</code>目录中反应加载器模板标签<code class="du lf lg lh li b">load_react.py</code>:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="17e2" class="lr iy hi li b fi ls lt l lu lv"># djact/apps/core/templatetags/load_react.py<br/>from django import template<br/>from django.conf import settings<br/>from django.utils.safestring import mark_safe</span><span id="4071" class="lr iy hi li b fi lw lt l lu lv">register = template.Library()</span><span id="af78" class="lr iy hi li b fi lw lt l lu lv">@register.simple_tag<br/>def load_react():<br/>    css = load_css()<br/>    js = load_js()<br/>    return mark_safe(''.join(css + js))</span><span id="648d" class="lr iy hi li b fi lw lt l lu lv">def load_css():<br/>    return [<br/>        f'&lt;link rel="stylesheet" href="/static/{asset}"/&gt;'<br/>        for asset in load_files('.css')<br/>    ]</span><span id="debc" class="lr iy hi li b fi lw lt l lu lv">def load_js():<br/>    return [<br/>        f'&lt;script type="text/javascript" src="/static/{asset}"&gt;&lt;/script&gt;'<br/>        for asset in load_files('.js')<br/>    ]</span><span id="9687" class="lr iy hi li b fi lw lt l lu lv">def load_files(extension: str):<br/>    files = []<br/>    for path in settings.STATICFILES_DIRS:<br/>        for file_name in path.iterdir():<br/>            if file_name.name.endswith(extension):<br/>                files.append(file_name.name)</span><span id="eb65" class="lr iy hi li b fi lw lt l lu lv">return files</span></pre><p id="f06e" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">我知道有一个<a class="ae le" href="https://github.com/owais/django-webpack-loader" rel="noopener ugc nofollow" target="_blank"> django-webpack-loader，</a>但是我更喜欢一个像上面这样简单的方法。</p><p id="a2f4" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">接下来在<code class="du lf lg lh li b">templates</code>目录中创建包含以下内容的<code class="du lf lg lh li b">index.html</code>:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="e6cc" class="lr iy hi li b fi ls lt l lu lv">{# djact/apps/core/templates/index.html #}<br/>{% load static %}<br/>{% load load_react %}<br/>&lt;!doctype html&gt;<br/>&lt;html lang="en"&gt;<br/>    &lt;head&gt;<br/>        &lt;meta charset="utf-8"/&gt;<br/>        &lt;title&gt;Djact&lt;/title&gt;<br/>        &lt;link rel="icon" href="{% static 'favicon.ico' %}"&gt;<br/>    &lt;/head&gt;<br/>    &lt;body&gt;<br/>        &lt;div id="app"&gt;&lt;/div&gt;<br/>        {% load_react %}<br/>    &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><h1 id="7d5c" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">证明</h1><p id="82af" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">接下来我们需要一个app进行认证，所以<code class="du lf lg lh li b">mkdir djact/apps/authentication</code>和<code class="du lf lg lh li b">python manage.py startapp authentication djact/apps/authentication</code>。在这个目录中编辑<code class="du lf lg lh li b">models.py</code>文件:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="8799" class="lr iy hi li b fi ls lt l lu lv"># djact/apps/authentication/models.py<br/>from django.contrib.auth.models import AbstractUser</span><span id="ad7e" class="lr iy hi li b fi lw lt l lu lv">class User(AbstractUser):<br/>    class Meta:<br/>        verbose_name = 'User'<br/>        verbose_name_plural = 'Users'</span><span id="fac1" class="lr iy hi li b fi lw lt l lu lv">    def __str__(self):<br/>        return f'&lt;{self.id}&gt; {self.username}'</span></pre><p id="5be7" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">接下来，我们需要一个用户注册的序列化器:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="c64a" class="lr iy hi li b fi ls lt l lu lv"># djact/apps/authentication/serializers.py<br/>from rest_framework import serializers</span><span id="1e09" class="lr iy hi li b fi lw lt l lu lv">from .models import User</span><span id="b13e" class="lr iy hi li b fi lw lt l lu lv">class UserSerializer(serializers.ModelSerializer):<br/>    email = serializers.EmailField(required=True)<br/>    username = serializers.CharField()<br/>    password = serializers.CharField(min_length=8, write_only=True)</span><span id="afb4" class="lr iy hi li b fi lw lt l lu lv">    class Meta:<br/>        model = User<br/>        fields = ('email', 'username', 'password')<br/>        extra_kwargs = {'password': {'write_only': True}}</span><span id="4874" class="lr iy hi li b fi lw lt l lu lv">    def create(self, validated_data):<br/>        password = validated_data.pop('password', None)<br/>        instance = self.Meta.model(**validated_data)<br/>        if password is not None:<br/>            instance.set_password(password)</span><span id="e586" class="lr iy hi li b fi lw lt l lu lv">        instance.save()</span><span id="e7bf" class="lr iy hi li b fi lw lt l lu lv">        return instance</span></pre><p id="b08d" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">然后查看<code class="du lf lg lh li b">djact/apps/authentication/views.py</code>:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="d64a" class="lr iy hi li b fi ls lt l lu lv"># djact/apps/authentication/views.py<br/>from rest_framework import permissions<br/>from rest_framework.generics import CreateAPIView<br/>from rest_framework.response import Response<br/>from rest_framework.views import APIView</span><span id="8a78" class="lr iy hi li b fi lw lt l lu lv">from .serializers import UserSerializer</span><span id="51bf" class="lr iy hi li b fi lw lt l lu lv">class UserCreate(CreateAPIView):<br/>    permission_classes = (permissions.AllowAny,)<br/>    authentication_classes = ()<br/>    serializer_class = UserSerializer</span><span id="6733" class="lr iy hi li b fi lw lt l lu lv">    user_create = UserCreate.as_view()</span><span id="31cf" class="lr iy hi li b fi lw lt l lu lv">class Protected(APIView):<br/>    def get(self, request):<br/>        return Response(data={'type': 'protected'})</span><span id="3420" class="lr iy hi li b fi lw lt l lu lv">protected = Protected.as_view()</span></pre><p id="6433" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated"><code class="du lf lg lh li b">Protected</code>视图是检查我们只有登录后才能访问页面。</p><p id="17fa" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">对于URL，我们将有到两个视图的路径，还可以获取和刷新JWT:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="9dac" class="lr iy hi li b fi ls lt l lu lv"># djact/apps/authentication/urls.py<br/>from django.urls import path<br/>from rest_framework_simplejwt import views as jwt_views</span><span id="1470" class="lr iy hi li b fi lw lt l lu lv">from . import views</span><span id="79fd" class="lr iy hi li b fi lw lt l lu lv">app_name = 'authentication'<br/>urlpatterns = [<br/>    path(<br/>        'users/create/',<br/>        views.user_create,<br/>        name='sign-up'<br/>    ),<br/>    path(<br/>        'token/obtain/',<br/>        jwt_views.TokenObtainPairView.as_view(),<br/>        name='token-create'<br/>    ),<br/>    path(<br/>        'token/refresh/',<br/>        jwt_views.TokenRefreshView.as_view(),<br/>        name='token-refresh'<br/>    ),<br/>    path(<br/>        'protected/',<br/>        views.protected,<br/>        name='protected'<br/>    )<br/>]</span></pre><p id="9134" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">在<code class="du lf lg lh li b">djact</code>处更新主<code class="du lf lg lh li b">urls.py</code>:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="a51d" class="lr iy hi li b fi ls lt l lu lv"># djact/urls.py<br/>from django.contrib import admin<br/>from django.urls import path, include</span><span id="4866" class="lr iy hi li b fi lw lt l lu lv">urlpatterns = [<br/>    path('admin/', admin.site.urls),<br/>    path('api/', include('djact.apps.authentication.urls')),<br/>]</span></pre><h1 id="120e" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">设置</h1><p id="22b9" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我喜欢新的<code class="du lf lg lh li b">Pathlib</code>模块，所以让我们用它代替<code class="du lf lg lh li b">os</code>来重写一切。我使用<code class="du lf lg lh li b">django-environ</code>来处理环境变量，所以让我们安装那个<code class="du lf lg lh li b">pip install django-environ &amp;&amp; pip freeze &gt; requirements.txt</code>。从现有的配置中复制<code class="du lf lg lh li b">DJANGO_SECRET_KEY</code>，这样你就不需要生成一个新的了(尽管这很容易)。我们将把它放在一个<code class="du lf lg lh li b">.env</code>文件中。</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="545d" class="lr iy hi li b fi ls lt l lu lv"># djact/settings/settings.py<br/>import pathlib<br/>from datetime import timedelta</span><span id="a4a4" class="lr iy hi li b fi lw lt l lu lv">import environ</span><span id="ab3c" class="lr iy hi li b fi lw lt l lu lv">BASE_DIR = pathlib.Path(__file__).parent.parent<br/>PROJECT_ROOT = BASE_DIR.parent</span><span id="768e" class="lr iy hi li b fi lw lt l lu lv">env = environ.Env()</span><span id="c38e" class="lr iy hi li b fi lw lt l lu lv"># Quick-start development settings - unsuitable for production<br/># See <a class="ae le" href="https://docs.djangoproject.com/en/3.0/howto/deployment/checklist/" rel="noopener ugc nofollow" target="_blank">https://docs.djangoproject.com/en/3.0/howto/deployment/checklist/</a></span><span id="513c" class="lr iy hi li b fi lw lt l lu lv"># SECURITY WARNING: keep the secret key used in production secret!<br/>SECRET_KEY = env.str('DJANGO_SECRET_KEY')</span><span id="49f6" class="lr iy hi li b fi lw lt l lu lv"># SECURITY WARNING: don't run with debug turned on in production!<br/>DEBUG = env.bool('DJANGO_DEBUG', False)</span><span id="742e" class="lr iy hi li b fi lw lt l lu lv">ALLOWED_HOSTS = env.list('DJANGO_ALLOWED_HOSTS', default=list())</span><span id="43eb" class="lr iy hi li b fi lw lt l lu lv"># Application definition</span><span id="a9b9" class="lr iy hi li b fi lw lt l lu lv">INSTALLED_APPS = [<br/>    'djact.apps.authentication',<br/>    'djact.apps.core',</span><span id="3dca" class="lr iy hi li b fi lw lt l lu lv">'rest_framework',</span><span id="aeb0" class="lr iy hi li b fi lw lt l lu lv">'django.contrib.admin',<br/>    'django.contrib.auth',<br/>    'django.contrib.contenttypes',<br/>    'django.contrib.sessions',<br/>    'django.contrib.messages',<br/>    'django.contrib.staticfiles',<br/>]</span><span id="4248" class="lr iy hi li b fi lw lt l lu lv">MIDDLEWARE = [<br/>    'django.middleware.security.SecurityMiddleware',<br/>    'django.contrib.sessions.middleware.SessionMiddleware',<br/>    'django.middleware.common.CommonMiddleware',<br/>    'django.middleware.csrf.CsrfViewMiddleware',<br/>    'django.contrib.auth.middleware.AuthenticationMiddleware',<br/>    'django.contrib.messages.middleware.MessageMiddleware',<br/>    'django.middleware.clickjacking.XFrameOptionsMiddleware',<br/>]</span><span id="292d" class="lr iy hi li b fi lw lt l lu lv">ROOT_URLCONF = 'djact.urls'</span><span id="c056" class="lr iy hi li b fi lw lt l lu lv">TEMPLATES = [<br/>    {<br/>        'BACKEND': 'django.template.backends.django.DjangoTemplates',<br/>        'APP_DIRS': True,<br/>        'OPTIONS': {<br/>            'context_processors': [<br/>                'django.template.context_processors.debug',<br/>                'django.template.context_processors.request',<br/>                'django.contrib.auth.context_processors.auth',<br/>                'django.contrib.messages.context_processors.messages',<br/>            ],<br/>        },<br/>    },<br/>]</span><span id="048e" class="lr iy hi li b fi lw lt l lu lv">WSGI_APPLICATION = 'djact.wsgi.application'</span><span id="737b" class="lr iy hi li b fi lw lt l lu lv"># Database<br/># <a class="ae le" href="https://docs.djangoproject.com/en/3.0/ref/settings/#databases" rel="noopener ugc nofollow" target="_blank">https://docs.djangoproject.com/en/3.0/ref/settings/#databases</a></span><span id="5150" class="lr iy hi li b fi lw lt l lu lv">DATABASES = {<br/>    'default': {<br/>        'ENGINE': 'django.db.backends.sqlite3',<br/>        'NAME': str(BASE_DIR.joinpath('db.sqlite3')),<br/>    }<br/>}</span><span id="bb5e" class="lr iy hi li b fi lw lt l lu lv"># Password validation<br/># <a class="ae le" href="https://docs.djangoproject.com/en/3.0/ref/settings/#auth-password-validators" rel="noopener ugc nofollow" target="_blank">https://docs.djangoproject.com/en/3.0/ref/settings/#auth-password-validators</a></span><span id="1601" class="lr iy hi li b fi lw lt l lu lv">AUTH_PASSWORD_VALIDATORS = [<br/>    {<br/>        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',<br/>    },<br/>    {<br/>        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',<br/>    },<br/>    {<br/>        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',<br/>    },<br/>    {<br/>        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',<br/>    },<br/>]</span><span id="b166" class="lr iy hi li b fi lw lt l lu lv">AUTH_USER_MODEL = 'authentication.User'</span><span id="e94d" class="lr iy hi li b fi lw lt l lu lv">REST_FRAMEWORK = {<br/>    'DEFAULT_PERMISSION_CLASSES': (<br/>        'rest_framework.permissions.IsAuthenticated',<br/>    ),<br/>    'DEFAULT_AUTHENTICATION_CLASSES': (<br/>        'rest_framework_simplejwt.authentication.JWTAuthentication',<br/>    ),  #<br/>}<br/>SIMPLE_JWT = {<br/>    'ACCESS_TOKEN_LIFETIME': timedelta(minutes=30),<br/>    'REFRESH_TOKEN_LIFETIME': timedelta(days=30),<br/>    'ROTATE_REFRESH_TOKENS': True,<br/>    'BLACKLIST_AFTER_ROTATION': False,<br/>    'ALGORITHM': 'HS256',<br/>    'SIGNING_KEY': SECRET_KEY,<br/>    'VERIFYING_KEY': None,<br/>    'AUTH_HEADER_TYPES': ('JWT',),<br/>    'USER_ID_FIELD': 'id',<br/>    'USER_ID_CLAIM': 'user_id',<br/>    'AUTH_TOKEN_CLASSES': ('rest_framework_simplejwt.tokens.AccessToken',),<br/>    'TOKEN_TYPE_CLAIM': 'token_type',<br/>}</span><span id="57ba" class="lr iy hi li b fi lw lt l lu lv">LOGIN_URL = '/login'<br/>LOGIN_REDIRECT_URL = '/'<br/>LOGOUT_REDIRECT_URL = '/login'</span><span id="2bcc" class="lr iy hi li b fi lw lt l lu lv"># Internationalization<br/># <a class="ae le" href="https://docs.djangoproject.com/en/3.0/topics/i18n/" rel="noopener ugc nofollow" target="_blank">https://docs.djangoproject.com/en/3.0/topics/i18n/</a></span><span id="391e" class="lr iy hi li b fi lw lt l lu lv">LANGUAGE_CODE = 'ru'</span><span id="d76d" class="lr iy hi li b fi lw lt l lu lv">TIME_ZONE = 'Europe/Moscow'</span><span id="299b" class="lr iy hi li b fi lw lt l lu lv">USE_I18N = True</span><span id="0388" class="lr iy hi li b fi lw lt l lu lv">USE_L10N = True</span><span id="642a" class="lr iy hi li b fi lw lt l lu lv">USE_TZ = True</span><span id="324a" class="lr iy hi li b fi lw lt l lu lv"># Static files (CSS, JavaScript, Images)<br/># <a class="ae le" href="https://docs.djangoproject.com/en/3.0/howto/static-files/" rel="noopener ugc nofollow" target="_blank">https://docs.djangoproject.com/en/3.0/howto/static-files/</a></span><span id="17f3" class="lr iy hi li b fi lw lt l lu lv">STATIC_URL = '/static/'<br/>STATICFILES_DIRS = [<br/>    PROJECT_ROOT.joinpath('static'),<br/>]</span><span id="8d95" class="lr iy hi li b fi lw lt l lu lv">STATIC_ROOT = PROJECT_ROOT / 'public' / 'static'<br/>pathlib.Path(STATIC_ROOT).mkdir(exist_ok=True, parents=True)</span><span id="d447" class="lr iy hi li b fi lw lt l lu lv">MEDIA_URL = '/media/'<br/>MEDIA_ROOT = PROJECT_ROOT / 'public' / 'media'<br/>pathlib.Path(MEDIA_ROOT).mkdir(exist_ok=True, parents=True)</span><span id="c1c9" class="lr iy hi li b fi lw lt l lu lv"># Logging</span><span id="832f" class="lr iy hi li b fi lw lt l lu lv">LOG_DIR = PROJECT_ROOT / 'log'<br/>LOG_DIR.mkdir(exist_ok=True)</span><span id="e2df" class="lr iy hi li b fi lw lt l lu lv">LOGGING = {<br/>    'version': 1,<br/>    'disable_existing_loggers': False,<br/>    'formatters': {<br/>        'console': {<br/>            'format': '%(levelname)-8s %(name)-12s %(module)s:%(lineno)s\n'<br/>                      '%(message)s'<br/>        },<br/>        'file': {<br/>            'format': '%(asctime)s %(levelname)-8s %(name)-12s '<br/>                      '%(module)s:%(lineno)s\n%(message)s'<br/>        },<br/>    },<br/>    'handlers': {<br/>        'console': {<br/>            'class': 'logging.StreamHandler',<br/>            'formatter': 'console',<br/>        },<br/>        'file': {<br/>            'class': 'logging.handlers.RotatingFileHandler',<br/>            'formatter': 'file',<br/>            'filename': LOG_DIR / 'django.log',<br/>            'backupCount': 10,  # keep at most 10 files<br/>            'maxBytes': 5 * 1024 * 1024  # 5MB<br/>        },<br/>    },<br/>    'loggers': {<br/>        'django.request': {<br/>            'handlers': ['console', 'file'],<br/>            'level': 'DEBUG',<br/>            'propagate': True,<br/>        },<br/>    },<br/>}</span><span id="ee36" class="lr iy hi li b fi lw lt l lu lv">LOGGING['loggers'].update(<br/>    {app: {<br/>        'handlers': ['console', 'file'],<br/>        'level': 'DEBUG',<br/>        'propagate': True,<br/>    } for app in INSTALLED_APPS}<br/>)</span><span id="da1d" class="lr iy hi li b fi lw lt l lu lv"># Load dev config</span><span id="434f" class="lr iy hi li b fi lw lt l lu lv">if DEBUG:<br/>    try:<br/>        from .dev import *<br/>    except ModuleNotFoundError:<br/>        print('Dev config not found')</span></pre><p id="e6ec" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">我们可以在<code class="du lf lg lh li b">djact/settings/dev.py</code>中覆盖一些设置或添加一些只与开发环境相关的东西，这就是为什么我们需要最后5行。我的<code class="du lf lg lh li b">dev.py</code>长这样:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="52c0" class="lr iy hi li b fi ls lt l lu lv"># djact/settings/dev.py<br/>from .settings import LOGGING, INSTALLED_APPS, MIDDLEWARE</span><span id="5471" class="lr iy hi li b fi lw lt l lu lv">LOGGING['handlers']['file']['backupCount'] = 1</span><span id="89c6" class="lr iy hi li b fi lw lt l lu lv">INSTALLED_APPS += ['corsheaders']<br/>CORS_ORIGIN_ALLOW_ALL = True<br/>MIDDLEWARE.insert(2, 'corsheaders.middleware.CorsMiddleware')</span></pre><p id="5d07" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">这里我们告诉Django允许与我们的react dev服务器交互，它将运行在不同的端口上，因此被认为是跨源的。</p><p id="a00c" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">我们的<code class="du lf lg lh li b">.env.example</code>文件是这样的:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="f980" class="lr iy hi li b fi ls lt l lu lv">&lt;!-- .env.example --&gt;<br/>PYTHONDONTWRITEBYTECODE=1</span><span id="3fcc" class="lr iy hi li b fi lw lt l lu lv">DJANGO_SECRET_KEY=random long string<br/>DJANGO_DEBUG=True for dev environment|False or omit completely for production<br/>DJANGO_ALLOWED_HOSTS=localhost,127.0.0.1:8000,0.0.0.0:8000</span></pre><p id="0bc7" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">因此，用这些变量创建一个<code class="du lf lg lh li b">.env</code>文件。</p><p id="6a8f" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">现在在包含以下内容的<code class="du lf lg lh li b">djact/apps/core/</code>目录中创建<code class="du lf lg lh li b">urls.py</code>:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="1deb" class="lr iy hi li b fi ls lt l lu lv"># djact/apps/core/urls.py<br/>from django.urls import re_path<br/>from django.views.generic import TemplateView</span><span id="1942" class="lr iy hi li b fi lw lt l lu lv">app_name = 'core'<br/>urlpatterns = [<br/>    re_path(r'^.*$', TemplateView.as_view(template_name='index.html'), name='index'),<br/>]</span></pre><p id="ebdc" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">并更新主URL文件:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="2bd4" class="lr iy hi li b fi ls lt l lu lv"># djact/urls.py<br/>from django.contrib import admin<br/>from django.urls import path, include</span><span id="a360" class="lr iy hi li b fi lw lt l lu lv">urlpatterns = [<br/>    path('admin/', admin.site.urls),<br/>    path('api/', include('djact.apps.authentication.urls')),<br/>    path('', include('djact.apps.core.urls')),<br/>]</span></pre><p id="38b2" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">然后运行<code class="du lf lg lh li b">python manage.py makemigrations</code>和<code class="du lf lg lh li b">python manage.py migrate</code>。</p><p id="543f" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">我们的目录结构应该如下所示:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="5003" class="lr iy hi li b fi ls lt l lu lv">.<br/>├── djact<br/>│   ├── apps<br/>│   │   ├── authentication<br/>│   │   │   ├── admin.py<br/>│   │   │   ├── apps.py<br/>│   │   │   ├── __init__.py<br/>│   │   │   ├── migrations<br/>│   │   │   │   ├── 0001_initial.py<br/>│   │   │   │   └── __init__.py<br/>│   │   │   ├── models.py<br/>│   │   │   ├── serializers.py<br/>│   │   │   ├── urls.py<br/>│   │   │   └── views.py<br/>│   │   └── core<br/>│   │       ├── admin.py<br/>│   │       ├── apps.py<br/>│   │       ├── __init__.py<br/>│   │       ├── migrations<br/>│   │       │   └── __init__.py<br/>│   │       ├── templates<br/>│   │       │   └── index.html<br/>│   │       ├── templatetags<br/>│   │       │   ├── __init__.py<br/>│   │       │   └── load_react.py<br/>│   │       └── urls.py<br/>│   ├── asgi.py<br/>│   ├── __init__.py<br/>│   ├── settings<br/>│   │   ├── dev.py<br/>│   │   ├── __init__.py<br/>│   │   └── settings.py<br/>│   ├── urls.py<br/>│   └── wsgi.py<br/>├── .env<br/>├── .env.example<br/>├── manage.py<br/>└── requirements.txt</span></pre><h1 id="6e13" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">创建React应用程序</h1><p id="d32e" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">让我们<code class="du lf lg lh li b">mkdir</code>看看我们的React前端，并深入了解它— <code class="du lf lg lh li b">mkdir frontend &amp;&amp; cd frontend</code>。</p><p id="73c0" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">首先用<code class="du lf lg lh li b">yarn init</code>初始化前端项目，回答问题。以下是我的例子:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="6139" class="lr iy hi li b fi ls lt l lu lv">$ yarn init<br/>yarn init v1.22.4<br/>question name (frontend): djact<br/>question version (1.0.0):<br/>question description: Django + React<br/>question entry point (index.js):<br/>question repository url:<br/>question author: Constantine<br/>question license (MIT):<br/>question private:<br/>success Saved package.json<br/>Done in 34.53s.</span></pre><p id="91be" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">现在我们可以用<code class="du lf lg lh li b">yarn add react react-dom axios react-redux redux redux-thunk reselect</code>添加依赖项。以及我们对<code class="du lf lg lh li b">yarn add -D eslint babel-eslint babel-polyfill eslint-plugin-import eslint-plugin-react eslint-plugin-react-hooks eslint-loader style-loader css-loader postcss-loader webpack-dev-server mini-css-extract-plugin cssnano html-webpack-plugin npm-run-all rimraf redux-immutable-state-invariant webpack webpack-cli babel-loader @babel/core @babel/node @babel/preset-env @babel/preset-react</code>的开发依赖。</p><h1 id="774e" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">配置</h1><p id="2a67" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">在当前目录下创建<code class="du lf lg lh li b">.eslintrc.js</code>，内容如下:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="fd7c" class="lr iy hi li b fi ls lt l lu lv">// frontend/.eslintrc.js<br/>module.exports = {<br/>  parser: "babel-eslint",<br/>  env: {<br/>    browser: true,<br/>    commonjs: true,<br/>    es6: true,<br/>    node: true,<br/>    jest: true,<br/>  },<br/>  parserOptions: {<br/>    ecmaVersion: 2020,<br/>    ecmaFeatures: {<br/>      impliedStrict: true,<br/>      jsx: true,<br/>    },<br/>    sourceType: "module",<br/>  },<br/>  plugins: ["react", "react-hooks"],<br/>  extends: [<br/>    "eslint:recommended",<br/>    "plugin:react/recommended",<br/>    "plugin:react-hooks/recommended",<br/>  ],<br/>  settings: {<br/>    react: {<br/>      version: "detect",<br/>    },<br/>  },<br/>  rules: {<br/>    "no-debugger": "off",<br/>    "no-console": "off",<br/>    "no-unused-vars": "warn",<br/>    "react/prop-types": "warn",<br/>  },<br/>};</span></pre><p id="fcc4" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">Babel配置存储在<code class="du lf lg lh li b">babel.config.js</code>中:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="bb4f" class="lr iy hi li b fi ls lt l lu lv">// frontend/babel.config.js<br/>module.exports = {<br/>  presets: ["<a class="ae le" href="http://twitter.com/babel/preset-env" rel="noopener ugc nofollow" target="_blank">@babel/preset-env</a>", "<a class="ae le" href="http://twitter.com/babel/preset-react" rel="noopener ugc nofollow" target="_blank">@babel/preset-react</a>"],<br/>};</span></pre><p id="009c" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">存储在<code class="du lf lg lh li b">webpack.config.dev.js</code>中的开发环境的Webpack配置:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="1679" class="lr iy hi li b fi ls lt l lu lv">// frontend/webpack.config.dev.js<br/>const webpack = require("webpack");<br/>const path = require("path");<br/>const HtmlWebpackPlugin = require("html-webpack-plugin");</span><span id="de5a" class="lr iy hi li b fi lw lt l lu lv">process.env.NODE_ENV = "development";</span><span id="3e44" class="lr iy hi li b fi lw lt l lu lv">module.exports = {<br/>  mode: "development",<br/>  target: "web",<br/>  devtool: "cheap-module-source-map",<br/>  entry: ["babel-polyfill", "./src/index"],<br/>  output: {<br/>    path: path.resolve(__dirname),<br/>    publicPath: "/",<br/>    filename: "bundle.js",<br/>  },<br/>  devServer: {<br/>    stats: "minimal",<br/>    overlay: true,<br/>    historyApiFallback: true,<br/>    disableHostCheck: true,<br/>    headers: { "Access-Control-Allow-Origin": "*" },<br/>    https: false,<br/>  },<br/>  plugins: [<br/>    new webpack.DefinePlugin({<br/>      "process.env.API_URL": JSON.stringify("http://localhost:8000/api/"),<br/>    }),<br/>    new HtmlWebpackPlugin({<br/>      template: "./src/index.html",<br/>      favicon: "./src/favicon.ico",<br/>    }),<br/>  ],<br/>  module: {<br/>    rules: [<br/>      {<br/>        test: /\.(js|jsx)$/,<br/>        exclude: /node_modules/,<br/>        use: [<br/>          {<br/>            loader: "babel-loader",<br/>          },<br/>          "eslint-loader",<br/>        ],<br/>      },<br/>      {<br/>        test: /(\.css)$/,<br/>        use: ["style-loader", "css-loader"],<br/>      },<br/>    ],<br/>  },<br/>};</span></pre><p id="e8e4" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">并编辑<code class="du lf lg lh li b">package.json</code> <code class="du lf lg lh li b">scripts</code>部分，使其看起来像这样:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="9fb2" class="lr iy hi li b fi ls lt l lu lv">// frontend/package.json<br/>{<br/>  "name": "djact",<br/>  "version": "1.0.0",<br/>  "description": "Django + React",<br/>  "scripts": {<br/>    "start:dev": "webpack-dev-server --config webpack.config.dev.js --port 3000",<br/>    "clean:build": "rimraf ../static &amp;&amp; mkdir ../static",<br/>    "prebuild": "run-p clean:build",<br/>    "build": "webpack --config webpack.config.prod.js",<br/>    "postbuild": "rimraf ../static/index.html"<br/>  },<br/>  "main": "index.js",<br/>  "author": "Constantine",<br/>  "license": "MIT",<br/>  "dependencies": {<br/>    ...<br/>  },<br/>  "devDependencies": {<br/>    ...<br/>  }<br/>}</span></pre><p id="282f" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">现在让我们为前端源代码添加一个目录:<code class="du lf lg lh li b">mkdir -p src/components</code>。还要为React — <code class="du lf lg lh li b">touch src/index.js</code>创建入口点，内容如下:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="4fad" class="lr iy hi li b fi ls lt l lu lv">// frontend/src/index.js<br/>import React from "react";<br/>import { render } from "react-dom";<br/>import { BrowserRouter as Router } from "react-router-dom";<br/>import App from "./components/App";</span><span id="2412" class="lr iy hi li b fi lw lt l lu lv">render(<br/>  &lt;Router&gt;<br/>    &lt;App /&gt;<br/>  &lt;/Router&gt;,<br/>  document.getElementById("app")<br/>);</span></pre><p id="f51d" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">创建<code class="du lf lg lh li b">html</code>模板— <code class="du lf lg lh li b">touch src/index.html</code>:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="b116" class="lr iy hi li b fi ls lt l lu lv">&lt;!-- frontend/src/index.html --&gt;<br/>&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="utf-8" /&gt;<br/>    &lt;title&gt;Djact&lt;/title&gt;<br/>  &lt;/head&gt;</span><span id="2bbd" class="lr iy hi li b fi lw lt l lu lv">&lt;body&gt;<br/>    &lt;div id="app"&gt;&lt;/div&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="05e7" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">如果你喜欢，你可以在<code class="du lf lg lh li b">src</code>目录中添加一个图标。</p><p id="9a92" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">然后创建<code class="du lf lg lh li b">App</code>组件— <code class="du lf lg lh li b">touch src/components/App.js</code>。让它返回一些简单的东西:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="4a7d" class="lr iy hi li b fi ls lt l lu lv">// frontend/src/components/App.js<br/>import React from "react";</span><span id="de4c" class="lr iy hi li b fi lw lt l lu lv">function App() {<br/>  return &lt;h1&gt;Hello from React!&lt;/h1&gt;;<br/>}</span><span id="fd2b" class="lr iy hi li b fi lw lt l lu lv">export default App;</span></pre><p id="088d" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">我们现在可以测试我们的应用程序与<code class="du lf lg lh li b">yarn start:dev</code>一起工作。在导航到http://localhost:3000 之后，我们应该会看到一个“来自React的Hello！”问候！</p><p id="a27f" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">这里是一部作品<code class="du lf lg lh li b">webpack.config.prod.js</code>:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="19cd" class="lr iy hi li b fi ls lt l lu lv">// frontend/webpack.config.prod.js<br/>const webpack = require("webpack");<br/>const path = require("path");<br/>const HtmlWebpackPlugin = require("html-webpack-plugin");<br/>const MiniCssExtractPlugin = require("mini-css-extract-plugin");</span><span id="b32c" class="lr iy hi li b fi lw lt l lu lv">process.env.NODE_ENV = "production";</span><span id="af8f" class="lr iy hi li b fi lw lt l lu lv">module.exports = {<br/>  mode: "production",<br/>  target: "web",<br/>  devtool: "source-map",<br/>  entry: {<br/>    vendor: ["react", "react-dom", "prop-types"],<br/>    bundle: ["babel-polyfill", "./src/index"],<br/>  },<br/>  output: {<br/>    path: path.resolve(__dirname, "../static"),<br/>    publicPath: "/",<br/>    filename: "[name].[contenthash].js",<br/>  },<br/>  plugins: [<br/>    new MiniCssExtractPlugin({<br/>      filename: "[name].[contenthash].css",<br/>    }),<br/>    new webpack.DefinePlugin({<br/>      // This global makes sure React is built in prod mode.<br/>      "process.env.NODE_ENV": JSON.stringify(process.env.NODE_ENV),<br/>      "process.env.API_URL": JSON.stringify("<a class="ae le" href="http://localhost:8000/api/" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/api/</a>"),<br/>    }),<br/>    new HtmlWebpackPlugin({<br/>      template: "src/index.html",<br/>      favicon: "./src/favicon.ico",<br/>      minify: {<br/>        // see <a class="ae le" href="https://github.com/kangax/html-minifier#options-quick-reference" rel="noopener ugc nofollow" target="_blank">https://github.com/kangax/html-minifier#options-quick-reference</a><br/>        removeComments: true,<br/>        collapseWhitespace: true,<br/>        removeRedundantAttributes: true,<br/>        useShortDoctype: true,<br/>        removeEmptyAttributes: true,<br/>        removeStyleLinkTypeAttributes: true,<br/>        keepClosingSlash: true,<br/>        minifyJS: true,<br/>        minifyCSS: true,<br/>        minifyURLs: true,<br/>      },<br/>    }),<br/>  ],<br/>  module: {<br/>    rules: [<br/>      {<br/>        test: /\.(js|jsx)$/,<br/>        exclude: /node_modules/,<br/>        use: [<br/>          {<br/>            loader: "babel-loader",<br/>          },<br/>          "eslint-loader",<br/>        ],<br/>      },<br/>      {<br/>        test: /(\.css)$/,<br/>        use: [<br/>          MiniCssExtractPlugin.loader,<br/>          {<br/>            loader: "css-loader",<br/>            options: {<br/>              sourceMap: true,<br/>            },<br/>          },<br/>          {<br/>            loader: "postcss-loader",<br/>            options: {<br/>              plugins: () =&gt; [require("cssnano")],<br/>              sourceMap: true,<br/>            },<br/>          },<br/>        ],<br/>      },<br/>    ],<br/>  },<br/>};</span></pre><p id="5aec" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">现在我们可以<code class="du lf lg lh li b">yarn build</code>并在<code class="du lf lg lh li b">static</code>目录中看到我们的捆绑文件。如果我们通过<code class="du lf lg lh li b">python manage.py runserver 0.0.0.0:8000</code>启动Django应用程序，我们会看到完全相同的东西，但是是在生产模式下运行。</p><p id="5927" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">我们的项目目录应该如下所示:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="437d" class="lr iy hi li b fi ls lt l lu lv">.<br/>├── djact<br/>│   ├── apps<br/>│   │   ├── authentication<br/>│   │   │   ├── admin.py<br/>│   │   │   ├── apps.py<br/>│   │   │   ├── __init__.py<br/>│   │   │   ├── migrations<br/>│   │   │   │   ├── 0001_initial.py<br/>│   │   │   │   └── __init__.py<br/>│   │   │   ├── models.py<br/>│   │   │   ├── serializers.py<br/>│   │   │   ├── urls.py<br/>│   │   │   └── views.py<br/>│   │   └── core<br/>│   │       ├── admin.py<br/>│   │       ├── apps.py<br/>│   │       ├── __init__.py<br/>│   │       ├── migrations<br/>│   │       │   └── __init__.py<br/>│   │       ├── templates<br/>│   │       │   └── index.html<br/>│   │       ├── templatetags<br/>│   │       │   ├── __init__.py<br/>│   │       │   └── load_react.py<br/>│   │       └── urls.py<br/>│   ├── asgi.py<br/>│   ├── db.sqlite3<br/>│   ├── __init__.py<br/>│   ├── settings<br/>│   │   ├── dev.py<br/>│   │   ├── __init__.py<br/>│   │   └── settings.py<br/>│   ├── urls.py<br/>│   └── wsgi.py<br/>├── .env<br/>├── .env.example<br/>├── frontend<br/>│   ├── babel.config.js<br/>│   ├── package.json<br/>│   ├── src<br/>│   │   ├── components<br/>│   │   │   └── App.js<br/>│   │   ├── favicon.ico<br/>│   │   ├── index.html<br/>│   │   └── index.js<br/>│   ├── webpack.config.dev.js<br/>│   ├── webpack.config.prod.js<br/>│   └── yarn.lock<br/>├── log<br/>│   └── django.log<br/>├── manage.py<br/>├── public<br/>│   ├── media<br/>│   └── static<br/>├── requirements.txt<br/>└── static<br/>    ├── bundle.76ba356d74f1017eda2f.js<br/>    ├── bundle.76ba356d74f1017eda2f.js.map<br/>    ├── favicon.ico<br/>    ├── vendor.9245c714f84f4bbf6bdc.js<br/>    └── vendor.9245c714f84f4bbf6bdc.js.map</span></pre><h1 id="4bea" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">API服务</h1><p id="8373" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">在<code class="du lf lg lh li b">components</code>目录内创建<code class="du lf lg lh li b">axiosApi.js</code>:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="e87a" class="lr iy hi li b fi ls lt l lu lv">// frontend/src/components/api/axiosApi.js<br/>import axios from "axios";</span><span id="86c1" class="lr iy hi li b fi lw lt l lu lv">const baseURL = process.env.API_URL;<br/>const accessToken = localStorage.getItem("access_token");</span><span id="abce" class="lr iy hi li b fi lw lt l lu lv">const axiosAPI = axios.create({<br/>  baseURL: baseURL,<br/>  timeout: 5000,<br/>  headers: {<br/>    Authorization: accessToken ? "JWT " + accessToken : null,<br/>    "Content-Type": "application/json",<br/>    accept: "application/json",<br/>  },<br/>});</span><span id="5064" class="lr iy hi li b fi lw lt l lu lv">axiosAPI.interceptors.response.use(<br/>  (response) =&gt; response,<br/>  async (error) =&gt; {<br/>    const originalRequest = error.config;</span><span id="5e70" class="lr iy hi li b fi lw lt l lu lv">// Prevent infinite loops<br/>    if (<br/>      error.response.status === 401 &amp;&amp;<br/>      originalRequest.url === baseURL + "token/refresh/"<br/>    ) {<br/>      window.location.href = "/login/";<br/>      return Promise.reject(error);<br/>    }</span><span id="b46a" class="lr iy hi li b fi lw lt l lu lv">if (<br/>      error.response.status === 401 &amp;&amp;<br/>      error.response.statusText === "Unauthorized"<br/>    ) {<br/>      const refresh = localStorage.getItem("refresh_token");</span><span id="26f0" class="lr iy hi li b fi lw lt l lu lv">if (refresh) {<br/>        const tokenParts = JSON.parse(atob(refresh.split(".")[1]));</span><span id="1ece" class="lr iy hi li b fi lw lt l lu lv">// exp date in token is expressed in seconds, while now() returns milliseconds:<br/>        const now = Math.ceil(Date.now() / 1000);</span><span id="e466" class="lr iy hi li b fi lw lt l lu lv">if (tokenParts.exp &gt; now) {<br/>          try {<br/>            const response = await axiosAPI.post("/token/refresh/", {<br/>              refresh,<br/>            });<br/>            setNewHeaders(response);<br/>            originalRequest.headers["Authorization"] =<br/>              "JWT " + response.data.access;<br/>            return axiosAPI(originalRequest);<br/>          } catch (error) {<br/>            console.log(error);<br/>          }<br/>        } else {<br/>          console.log("Refresh token is expired", tokenParts.exp, now);<br/>          window.location.href = "/login/";<br/>        }<br/>      } else {<br/>        console.log("Refresh token not available.");<br/>        window.location.href = "/login/";<br/>      }<br/>    }</span><span id="3534" class="lr iy hi li b fi lw lt l lu lv">// specific error handling done elsewhere<br/>    return Promise.reject(error);<br/>  }<br/>);</span><span id="c223" class="lr iy hi li b fi lw lt l lu lv">export function setNewHeaders(response) {<br/>  axiosAPI.defaults.headers["Authorization"] = "JWT " + response.data.access;<br/>  localStorage.setItem("access_token", response.data.access);<br/>  localStorage.setItem("refresh_token", response.data.refresh);<br/>}</span><span id="981f" class="lr iy hi li b fi lw lt l lu lv">export default axiosAPI;</span></pre><p id="f8cb" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">和<code class="du lf lg lh li b">authenticationApi.js</code>:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="46f6" class="lr iy hi li b fi ls lt l lu lv">// frontend/src/components/api/authenticationApi.js<br/>import axiosAPI, { setNewHeaders } from "./axiosApi";</span><span id="3dc2" class="lr iy hi li b fi lw lt l lu lv">export async function signUp(email, username, password) {<br/>  const response = await axiosAPI.post("users/create/", {<br/>    email,<br/>    username,<br/>    password,<br/>  });<br/>  localStorage.setItem("user", response.data);<br/>  return response;<br/>}</span><span id="de76" class="lr iy hi li b fi lw lt l lu lv">export async function obtainToken(username, password) {<br/>  const response = await axiosAPI.post("token/obtain/", {<br/>    username,<br/>    password,<br/>  });<br/>  setNewHeaders(response);<br/>  return response;<br/>}</span><span id="c2d8" class="lr iy hi li b fi lw lt l lu lv">export async function refreshToken(refresh) {<br/>  const response = await axiosAPI.post("token/refresh/", {<br/>    refresh,<br/>  });<br/>  setNewHeaders(response);<br/>  return response;<br/>}</span><span id="5554" class="lr iy hi li b fi lw lt l lu lv">// eslint-disable-next-line<br/>export async function logout(accessToken) {<br/>  localStorage.removeItem("access_token");<br/>  localStorage.removeItem("refresh_token");<br/>  // TODO: invalidate token on backend<br/>}</span><span id="e3c7" class="lr iy hi li b fi lw lt l lu lv">export const isAuthenticated = () =&gt; {<br/>  const token = localStorage.getItem("access_token");<br/>  return !!token;<br/>};</span></pre><h1 id="411a" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">Redux</h1><p id="d4f8" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">首先在<code class="du lf lg lh li b">djact/frontend/src/</code>下创建<code class="du lf lg lh li b">redux</code>目录，放入以下文件:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="f626" class="lr iy hi li b fi ls lt l lu lv">// frontend/src/redux/configureStore.dev.js<br/>import { createStore, applyMiddleware, compose } from "redux";<br/>import rootReducer from "./reducers";<br/>import reduxImmutableStateInvariant from "redux-immutable-state-invariant";<br/>import thunk from "redux-thunk";</span><span id="da22" class="lr iy hi li b fi lw lt l lu lv">export default function configureStore(initialState) {<br/>  const composeEnhancers =<br/>    window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose; // add support for Redux dev tools</span><span id="06f7" class="lr iy hi li b fi lw lt l lu lv">return createStore(<br/>    rootReducer,<br/>    initialState,<br/>    composeEnhancers(applyMiddleware(thunk, reduxImmutableStateInvariant()))<br/>  );<br/>}</span></pre></div><div class="ab cl lx ly gp lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hb hc hd he hf"><pre class="ln li lo lp aw lq bi"><span id="cade" class="lr iy hi li b fi me mf mg mh mi lt l lu lv">// frontend/src/redux/configureStore.prod.js<br/>import { createStore, applyMiddleware } from "redux";<br/>import rootReducer from "./reducers";<br/>import thunk from "redux-thunk";</span><span id="8755" class="lr iy hi li b fi lw lt l lu lv">export default function configureStore(initialState) {<br/>  return createStore(rootReducer, initialState, applyMiddleware(thunk));<br/>}</span></pre></div><div class="ab cl lx ly gp lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hb hc hd he hf"><pre class="ln li lo lp aw lq bi"><span id="4bcb" class="lr iy hi li b fi me mf mg mh mi lt l lu lv">// frontend/src/redux/configureStore.js<br/>// Use CommonJS require below so we can dynamically import during build-time.<br/>if (process.env.NODE_ENV === "production") {<br/>  module.exports = require("./configureStore.prod");<br/>} else {<br/>  module.exports = require("./configureStore.dev");<br/>}</span></pre><p id="bdeb" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">商店已配置，现在开始行动！用以下文件在<code class="du lf lg lh li b">redux</code>中创建<code class="du lf lg lh li b">actions</code>目录:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="d8fe" class="lr iy hi li b fi ls lt l lu lv">// frontend/src/redux/actions/types.js<br/>export const LOGIN_USER_SUCCESS = "LOGIN_USER_SUCCESS";<br/>export const LOGOUT_USER = "LOGOUT_USER";</span></pre></div><div class="ab cl lx ly gp lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hb hc hd he hf"><pre class="ln li lo lp aw lq bi"><span id="eac2" class="lr iy hi li b fi me mf mg mh mi lt l lu lv">// frontend/src/redux/actions/auth.js<br/>import { LOGIN_USER_SUCCESS, LOGOUT_USER } from "./types";<br/>import { obtainToken, logout } from "../../components/api/authenticationApi";</span><span id="f566" class="lr iy hi li b fi lw lt l lu lv">export function loginUserSuccess(token) {<br/>  return { type: LOGIN_USER_SUCCESS, token };<br/>}</span><span id="37ea" class="lr iy hi li b fi lw lt l lu lv">export function loginUser(username, password) {<br/>  return async function (dispatch) {<br/>    try {<br/>      const response = await obtainToken(username, password);<br/>      dispatch(loginUserSuccess(response.data.access));<br/>    } catch (error) {<br/>      console.log("Error obtaining token. " + error);<br/>    }<br/>  };<br/>}</span><span id="10f7" class="lr iy hi li b fi lw lt l lu lv">export function logoutUserSuccess() {<br/>  return { type: LOGOUT_USER };<br/>}</span><span id="2e92" class="lr iy hi li b fi lw lt l lu lv">export function logoutUser() {<br/>  return async function (dispatch) {<br/>    await logout();<br/>    dispatch(logoutUserSuccess());<br/>  };<br/>}</span></pre><p id="9f88" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">redux的最后一步是reducers本身，在<code class="du lf lg lh li b">frontend/src/redux/reducers</code>目录中。</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="981c" class="lr iy hi li b fi ls lt l lu lv">// frontend/src/redux/reducers/initialState.js<br/>export default {<br/>  accessToken: localStorage.getItem("access_token"),<br/>};</span></pre></div><div class="ab cl lx ly gp lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hb hc hd he hf"><pre class="ln li lo lp aw lq bi"><span id="31e2" class="lr iy hi li b fi me mf mg mh mi lt l lu lv">// frontend/src/redux/reducers/auth.js<br/>import * as types from "../actions/types";<br/>import initialState from "./initialState";</span><span id="a646" class="lr iy hi li b fi lw lt l lu lv">export default function authReducer(state = initialState.accessToken, action) {<br/>  switch (action.type) {<br/>    case types.LOGIN_USER_SUCCESS:<br/>      return action.token;<br/>    case types.LOGOUT_USER:<br/>      return "";<br/>    default:<br/>      return state;<br/>  }<br/>}</span></pre></div><div class="ab cl lx ly gp lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hb hc hd he hf"><pre class="ln li lo lp aw lq bi"><span id="0c4a" class="lr iy hi li b fi me mf mg mh mi lt l lu lv">// frontend/src/redux/reducers/index.js<br/>import { combineReducers } from "redux";<br/>import auth from "./auth";</span><span id="85ff" class="lr iy hi li b fi lw lt l lu lv">const rootReducer = combineReducers({<br/>  auth,<br/>});</span><span id="9a65" class="lr iy hi li b fi lw lt l lu lv">export default rootReducer;</span></pre><p id="5c93" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">现在我们需要在<code class="du lf lg lh li b">index.js</code>中注册所有内容:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="14b6" class="lr iy hi li b fi ls lt l lu lv">import React from "react";<br/>import {render} from "react-dom";<br/>import {BrowserRouter as Router} from "react-router-dom";<br/>import {Provider as ReduxProvider} from "react-redux";<br/>import App from "./components/App";<br/>import configureStore from "./redux/configureStore";</span><span id="f1a1" class="lr iy hi li b fi lw lt l lu lv"><em class="mj">const</em> store = configureStore();</span><span id="b998" class="lr iy hi li b fi lw lt l lu lv">render(<br/>  &lt;<em class="mj">ReduxProvider</em> store={store}&gt;<br/>    &lt;<em class="mj">Router</em>&gt;<br/>      &lt;<em class="mj">App</em>/&gt;<br/>    &lt;/<em class="mj">Router</em>&gt;<br/>  &lt;/<em class="mj">ReduxProvider</em>&gt;,<br/>  document.getElementById("app")<br/>);</span></pre><h1 id="1e7b" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">成分</h1><h2 id="1389" class="lr iy hi bd iz mk ml mm jd mn mo mp jh jy mq mr jj kc ms mt jl kg mu mv jn mw bi translated">证明</h2><p id="8113" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我们已经准备好了减速器，现在我们需要把它们投入使用。所以让我们在<code class="du lf lg lh li b">frontend/src/components</code>中创建<code class="du lf lg lh li b">authentication</code>目录，并将接下来的三个文件放在那里。</p><p id="5699" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">这将是我们专用路由的包装:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="5919" class="lr iy hi li b fi ls lt l lu lv">// frontend/src/components/authentication/PrivateRoute.js<br/>import React from "react";<br/>import { Redirect, Route } from "react-router-dom";<br/>import PropTypes from "prop-types";<br/>import { isAuthenticated } from "../api/authenticationApi";</span><span id="4cbd" class="lr iy hi li b fi lw lt l lu lv">const PrivateRoute = ({ component: Component, ...rest }) =&gt; (<br/>  &lt;Route<br/>    {...rest}<br/>    render={(props) =&gt;<br/>      isAuthenticated() ? (<br/>        &lt;Component {...props} /&gt;<br/>      ) : (<br/>        &lt;Redirect<br/>          to={{ pathname: "/login", state: { from: props.location } }}<br/>        /&gt;<br/>      )<br/>    }<br/>  /&gt;<br/>);</span><span id="ab7d" class="lr iy hi li b fi lw lt l lu lv">PrivateRoute.propTypes = {<br/>  component: PropTypes.func.isRequired,<br/>  location: PropTypes.object,<br/>};</span><span id="da6e" class="lr iy hi li b fi lw lt l lu lv">export default PrivateRoute;</span></pre></div><div class="ab cl lx ly gp lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hb hc hd he hf"><pre class="ln li lo lp aw lq bi"><span id="1df6" class="lr iy hi li b fi me mf mg mh mi lt l lu lv">// frontend/src/components/authentication/LoginPage.js<br/>import React, { useState } from "react";<br/>import { connect } from "react-redux";<br/>import PropTypes from "prop-types";<br/>import { loginUser } from "../../redux/actions/auth";</span><span id="e04d" class="lr iy hi li b fi lw lt l lu lv">const LoginPage = ({ loginUser, history }) =&gt; {<br/>  const [state, setState] = useState({<br/>    username: "",<br/>    password: "",<br/>  });</span><span id="f78c" class="lr iy hi li b fi lw lt l lu lv">const handleChange = (event) =&gt; {<br/>    const { name, value } = event.target;<br/>    setState({ ...state, [name]: value });<br/>  };</span><span id="ce71" class="lr iy hi li b fi lw lt l lu lv">const login = async (event) =&gt; {<br/>    event.preventDefault();<br/>    const { username, password } = state;</span><span id="7dbf" class="lr iy hi li b fi lw lt l lu lv">await loginUser(username, password);<br/>    history.push("/");<br/>  };</span><span id="4af4" class="lr iy hi li b fi lw lt l lu lv">return (<br/>    &lt;div&gt;<br/>      &lt;h1&gt;Login page&lt;/h1&gt;<br/>      &lt;form onSubmit={login}&gt;<br/>        &lt;label&gt;<br/>          Username:<br/>          &lt;input<br/>            name="username"<br/>            type="text"<br/>            value={state.username}<br/>            onChange={handleChange}<br/>          /&gt;<br/>        &lt;/label&gt;<br/>        &lt;label&gt;<br/>          Password:<br/>          &lt;input<br/>            name="password"<br/>            type="password"<br/>            value={state.password}<br/>            onChange={handleChange}<br/>          /&gt;<br/>        &lt;/label&gt;<br/>        &lt;input type="submit" value="Submit" /&gt;<br/>      &lt;/form&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="cbd0" class="lr iy hi li b fi lw lt l lu lv">LoginPage.propTypes = {<br/>  loginUser: PropTypes.func.isRequired,<br/>  history: PropTypes.object.isRequired,<br/>};</span><span id="c474" class="lr iy hi li b fi lw lt l lu lv">const mapDispatchToProps = {<br/>  loginUser,<br/>};</span><span id="6485" class="lr iy hi li b fi lw lt l lu lv">export default connect(null, mapDispatchToProps)(LoginPage);</span></pre><p id="3567" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">注册组件很简单，因为我不想实现它，但是应该很简单:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="b877" class="lr iy hi li b fi ls lt l lu lv">// frontend/src/components/authentication/SignUpPage.js<br/>import React from "react";<br/>import { useHistory } from "react-router-dom";</span><span id="01fa" class="lr iy hi li b fi lw lt l lu lv">const SignUpPage = () =&gt; {<br/>  const history = useHistory();</span><span id="2d02" class="lr iy hi li b fi lw lt l lu lv">const handleClick = () =&gt; {<br/>    history.push("/");<br/>  };</span><span id="31b9" class="lr iy hi li b fi lw lt l lu lv">return (<br/>    &lt;div&gt;<br/>      &lt;h1&gt;Sign Up page&lt;/h1&gt;<br/>      &lt;button onClick={handleClick}&gt;sign up&lt;/button&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="f66d" class="lr iy hi li b fi lw lt l lu lv">export default SignUpPage;</span></pre><h2 id="b8c6" class="lr iy hi bd iz mk ml mm jd mn mo mp jh jy mq mr jj kc ms mt jl kg mu mv jn mw bi translated">普通的</h2><p id="ee84" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">通用组件将只包含标题。但是从理论上讲，这里可以生活任何东西..你是知道的..常见。</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="4fdc" class="lr iy hi li b fi ls lt l lu lv">// frontend/src/components/common/Header.js<br/>import React from "react";<br/>import { connect } from "react-redux";<br/>import PropTypes from "prop-types";<br/>import { NavLink, useHistory } from "react-router-dom";<br/>import { logoutUser } from "../../redux/actions/auth";</span><span id="988b" class="lr iy hi li b fi lw lt l lu lv">const Header = ({ accessToken, logoutUser }) =&gt; {<br/>  const history = useHistory();</span><span id="7689" class="lr iy hi li b fi lw lt l lu lv">const handleLogout = async () =&gt; {<br/>    await logoutUser();<br/>    history.push("login/");<br/>  };</span><span id="ab91" class="lr iy hi li b fi lw lt l lu lv">return (<br/>    &lt;nav&gt;<br/>      {accessToken ? (<br/>        &lt;&gt;<br/>          &lt;NavLink to="/"&gt;Profile&lt;/NavLink&gt;<br/>          {" | "}<br/>          &lt;NavLink to="/logout" onClick={handleLogout}&gt;<br/>            Logout<br/>          &lt;/NavLink&gt;<br/>        &lt;/&gt;<br/>      ) : (<br/>        &lt;&gt;<br/>          &lt;NavLink to="/login"&gt;Login&lt;/NavLink&gt;<br/>          {" | "}<br/>          &lt;NavLink to="/sign-up"&gt;SignUp&lt;/NavLink&gt;<br/>        &lt;/&gt;<br/>      )}<br/>    &lt;/nav&gt;<br/>  );<br/>};</span><span id="85b4" class="lr iy hi li b fi lw lt l lu lv">Header.propTypes = {<br/>  accessToken: PropTypes.string,<br/>  logoutUser: PropTypes.func.isRequired,<br/>};</span><span id="9d9f" class="lr iy hi li b fi lw lt l lu lv">function mapStateToProps(state) {<br/>  return {<br/>    accessToken: state.auth,<br/>  };<br/>}</span><span id="147d" class="lr iy hi li b fi lw lt l lu lv">const mapDispatchToProps = {<br/>  logoutUser,<br/>};</span><span id="cabc" class="lr iy hi li b fi lw lt l lu lv">export default connect(mapStateToProps, mapDispatchToProps)(Header);</span></pre><h2 id="bdaa" class="lr iy hi bd iz mk ml mm jd mn mo mp jh jy mq mr jj kc ms mt jl kg mu mv jn mw bi translated">核心</h2><p id="9ca8" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">最后一部分是具有应用程序逻辑的核心组件。这里我们将有我们的受保护页面:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="1b26" class="lr iy hi li b fi ls lt l lu lv">// frontend/src/components/core/ProfilePage.js<br/>import React from "react";<br/>import axiosAPI from "../api/axiosApi";</span><span id="f121" class="lr iy hi li b fi lw lt l lu lv">const ProfilePage = () =&gt; {<br/>  const handleClick = async () =&gt; {<br/>    const response = await axiosAPI.get("protected/");<br/>    alert(JSON.stringify(response.data));<br/>  };<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;h1&gt;Profile page&lt;/h1&gt;<br/>      &lt;p&gt;Only logged in users should see this&lt;/p&gt;<br/>      &lt;button onClick={handleClick}&gt;GET protected&lt;/button&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="dbc6" class="lr iy hi li b fi lw lt l lu lv">export default ProfilePage;</span></pre><p id="02fe" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">最后要做的是更新我们的<code class="du lf lg lh li b">App.js</code>:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="7b59" class="lr iy hi li b fi ls lt l lu lv">// frontend/src/components/App.js<br/>import React from "react";<br/>import {Route, Switch} from "react-router-dom";</span><span id="86ed" class="lr iy hi li b fi lw lt l lu lv">import PageNotFound from "./PageNotFound";<br/>import Header from "./common/Header";<br/>import ProfilePage from "./core/ProfilePage";<br/>import PrivateRoute from "./authentication/PrivateRoute";<br/>import LoginPage from "./authentication/LoginPage";<br/>import SignUpPage from "./authentication/SignUpPage";</span><span id="e8c4" class="lr iy hi li b fi lw lt l lu lv">function App() {<br/>  return (<br/>    &lt;&gt;<br/>      &lt;Header/&gt;<br/>      &lt;Switch&gt;<br/>        &lt;PrivateRoute exact path="/" component={ProfilePage}/&gt;<br/>        &lt;Route path="/login" component={LoginPage}/&gt;<br/>        &lt;Route path="/sign-up" component={SignUpPage}/&gt;<br/>        &lt;Route component={PageNotFound}/&gt;<br/>      &lt;/Switch&gt;<br/>    &lt;/&gt;<br/>  );<br/>}</span><span id="bd63" class="lr iy hi li b fi lw lt l lu lv">export default App;</span></pre><p id="3a4a" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">我们最终的项目结构应该是这样的:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="0fc4" class="lr iy hi li b fi ls lt l lu lv">.<br/>├── blogpost.md<br/>├── djact<br/>│   ├── apps<br/>│   │   ├── authentication<br/>│   │   │   ├── admin.py<br/>│   │   │   ├── apps.py<br/>│   │   │   ├── __init__.py<br/>│   │   │   ├── migrations<br/>│   │   │   │   ├── 0001_initial.py<br/>│   │   │   │   └── __init__.py<br/>│   │   │   ├── models.py<br/>│   │   │   ├── serializers.py<br/>│   │   │   ├── urls.py<br/>│   │   │   └── views.py<br/>│   │   └── core<br/>│   │       ├── admin.py<br/>│   │       ├── apps.py<br/>│   │       ├── __init__.py<br/>│   │       ├── migrations<br/>│   │       │   └── __init__.py<br/>│   │       ├── templates<br/>│   │       │   └── index.html<br/>│   │       ├── templatetags<br/>│   │       │   ├── __init__.py<br/>│   │       │   └── load_react.py<br/>│   │       └── urls.py<br/>│   ├── asgi.py<br/>│   ├── db.sqlite3<br/>│   ├── __init__.py<br/>│   ├── settings<br/>│   │   ├── dev.py<br/>│   │   ├── __init__.py<br/>│   │   └── settings.py<br/>│   ├── urls.py<br/>│   └── wsgi.py<br/>├── .env<br/>├── .env.example<br/>├── frontend<br/>│   ├── babel.config.js<br/>│   ├── package.json<br/>│   ├── src<br/>│   │   ├── components<br/>│   │   │   ├── api<br/>│   │   │   │   ├── authenticationApi.js<br/>│   │   │   │   └── axiosApi.js<br/>│   │   │   ├── App.js<br/>│   │   │   ├── authentication<br/>│   │   │   │   ├── LoginPage.js<br/>│   │   │   │   ├── PrivateRoute.js<br/>│   │   │   │   └── SignUpPage.js<br/>│   │   │   ├── common<br/>│   │   │   │   └── Header.js<br/>│   │   │   ├── core<br/>│   │   │   │   └── ProfilePage.js<br/>│   │   │   └── PageNotFound.js<br/>│   │   ├── favicon.ico<br/>│   │   ├── index.html<br/>│   │   ├── index.js<br/>│   │   └── redux<br/>│   │       ├── actions<br/>│   │       │   ├── auth.js<br/>│   │       │   └── types.js<br/>│   │       ├── configureStore.dev.js<br/>│   │       ├── configureStore.js<br/>│   │       ├── configureStore.prod.js<br/>│   │       └── reducers<br/>│   │           ├── auth.js<br/>│   │           ├── index.js<br/>│   │           └── initialState.js<br/>│   ├── webpack.config.dev.js<br/>│   ├── webpack.config.prod.js<br/>│   ├── yarn-error.log<br/>│   └── yarn.lock<br/>├── log<br/>│   └── django.log<br/>├── manage.py<br/>├── public<br/>│   ├── media<br/>│   └── static<br/>├── requirements.txt<br/>└── static<br/>    ├── bundle.c86ace9a42dd5bd70a59.js<br/>    ├── bundle.c86ace9a42dd5bd70a59.js.map<br/>    ├── favicon.ico<br/>    ├── vendor.0d40e04c29796a70dc89.js<br/>    └── vendor.0d40e04c29796a70dc89.js.map</span></pre><h1 id="be1b" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">运转</h1><p id="9c37" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">现在，设置环境变量<code class="du lf lg lh li b">export $(cat .env | xargs)</code>。构建前端部分<code class="du lf lg lh li b">cd frontend &amp;&amp; yarn:build</code>。用<code class="du lf lg lh li b">cd ../ &amp;&amp; python manage.py createsuperuser</code>创建超级用户进行测试，并按照说明操作。运行Django app <code class="du lf lg lh li b">python manage.py runserver</code>，导航到<a class="ae le" href="http://localhost:8000" rel="noopener ugc nofollow" target="_blank"> http://localhost:8000 </a>。我们应该会看到我们的登录页面。输入您在创建超级用户时提供的凭证，我们将进入受保护的配置文件页面。如果我们点击一个<code class="du lf lg lh li b">GET protected</code>按钮，我们会看到来自服务器的响应警告。</p><p id="9519" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">就是这样！如果你大老远来到这里..哇！如果你真的实现了所有这些..哇！！干得好，我的朋友！希望你学到了新东西或者解决了你的一个问题🚀</p><p id="b4aa" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">谢谢大家，编码快乐！</p><h1 id="62aa" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">资源</h1><p id="bb78" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">正如我在本文开始时所承诺的，这里列出了帮助我构建这一切的所有资源:</p><p id="a917" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated"><a class="ae le" href="https://pluralsight.com/" rel="noopener ugc nofollow" target="_blank"> PluralSight </a>课程:</p><ul class=""><li id="2319" class="kq kr hi jr b js kl jv km jy ks kc kt kg ku kk kv kw kx ky bi translated"><a class="ae le" href="https://app.pluralsight.com/library/courses/react-redux-react-router-es6/table-of-contents" rel="noopener ugc nofollow" target="_blank">Cory House<a class="ae le" href="https://app.pluralsight.com/profile/author/cory-house" rel="noopener ugc nofollow" target="_blank">使用React和Redux </a>构建应用程序</a></li><li id="07e0" class="kq kr hi jr b js kz jv la jy lb kc lc kg ld kk kv kw kx ky bi translated"><a class="ae le" href="https://app.pluralsight.com/library/courses/react-auth0-authentication-security/table-of-contents" rel="noopener ugc nofollow" target="_blank">由<a class="ae le" href="https://app.pluralsight.com/profile/author/cory-house" rel="noopener ugc nofollow" target="_blank"> Cory House </a>使用Auth0 </a>保护React应用</li><li id="90a1" class="kq kr hi jr b js kz jv la jy lb kc lc kg ld kk kv kw kx ky bi translated"><a class="ae le" href="https://app.pluralsight.com/library/courses/reactjs-advanced/table-of-contents" rel="noopener ugc nofollow" target="_blank">高级React.js </a>作者<a class="ae le" href="https://app.pluralsight.com/profile/author/samer-buna" rel="noopener ugc nofollow" target="_blank">萨梅尔布纳</a></li></ul><p id="3ef7" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">文章:</p><ul class=""><li id="310a" class="kq kr hi jr b js kl jv km jy ks kc kt kg ku kk kv kw kx ky bi translated"><a class="ae le" href="https://hackernoon.com/110percent-complete-jwt-authentication-with-django-and-react-2020-iejq34ta" rel="noopener ugc nofollow" target="_blank"> 110%完成与Django的JWT认证&amp; React — 2020 </a>作者<a class="ae le" href="https://hackernoon.com/u/Toruitas" rel="noopener ugc nofollow" target="_blank">斯图尔特·莱奇</a> <br/> - <a class="ae le" href="https://jasonwatmore.com/post/2017/12/07/react-redux-jwt-authentication-tutorial-example" rel="noopener ugc nofollow" target="_blank"> React + Redux — JWT认证教程&amp;示例</a>作者<a class="ae le" href="https://jasonwatmore.com/" rel="noopener ugc nofollow" target="_blank">杰森·瓦特莫尔</a> <br/> - <a class="ae le" href="https://levelup.gitconnected.com/using-jwt-in-your-react-redux-app-for-authorization-d31be51a50d2" rel="noopener ugc nofollow" target="_blank">在React + Redux应用中使用JWT进行授权</a>作者<a class="ae le" href="https://levelup.gitconnected.com/@leizl.samano" rel="noopener ugc nofollow" target="_blank">莱兹尔·萨马诺</a></li></ul></div></div>    
</body>
</html>