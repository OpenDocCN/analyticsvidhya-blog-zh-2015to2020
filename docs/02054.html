<html>
<head>
<title>Pandas Tutorial II — Filtering DataFrames</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫教程II —过滤数据帧</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/pandas-tutorial-ii-filtering-dataframes-7e430a196336?source=collection_archive---------17-----------------------#2019-11-27">https://medium.com/analytics-vidhya/pandas-tutorial-ii-filtering-dataframes-7e430a196336?source=collection_archive---------17-----------------------#2019-11-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/3a45906c3d010e9e263c94503a316a04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mPJnM0T-HbZlA8TQltpj_A.png"/></div></div></figure><div class=""/><p id="d418" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">过滤是用于选择数据帧部分的更通用的工具。与传统的切片或索引不同，过滤不基于标签或位置。在过滤中，基于数据本身的感兴趣的属性来选择数据帧的部分。</p><p id="77e3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用Pandas库，有几种特殊的过滤方法。我很快会谈到其中的一些。</p><p id="aad1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇教程文章中，我将使用与上一篇文章中相同的“销售”数据集。这是某一年1月至6月当地商店出售的鸡蛋、盐和鱼的数量数据。</p><p id="3d64" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我会加载数据，然后我们用它弄脏我们的手。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="3a3e" class="jx jy ht jt b fi jz ka l kb kc">In [1]: import pandas as pd<br/>In [2]: df = pd.read_csv('sales.csv', index_col='month')<br/>In [3]: df<br/>Out[3]:            eggs    salt    fish<br/>        month<br/>        Jan          47     12.0    17<br/>        Feb         110     50.0    31<br/>        Mar         221     89.0    72<br/>        Apr          77     87.0    20<br/>        May         132      NaN    52<br/>        Jun         205     60.0    55</span></pre><h2 id="5d5f" class="jx jy ht bd kd ke kf kg kh ki kj kk kl jb km kn ko jf kp kq kr jj ks kt ku kv bi translated">布尔级数</h2><p id="d054" class="pw-post-body-paragraph iq ir ht is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">过滤数据帧的几种方法之一是使用布尔级数。使用布尔值从一个系列或一个数据帧中进行选择是非常强大的。</p><p id="9724" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">布尔</strong>指的是一个逻辑思维系统，用来创建真或假的语句。一个<strong class="is hu">布尔</strong>值表示一个真值。<strong class="is hu">布尔</strong>表达式使用运算符<code class="du lb lc ld jt b">AND</code>、<code class="du lb lc ld jt b">OR</code>和<code class="du lb lc ld jt b">NOT</code>来比较值并返回true或false结果。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="28d4" class="jx jy ht jt b fi jz ka l kb kc">In [4]: df.salt&gt;60<br/>Out[4]: False<br/>        False<br/>        True<br/>        True<br/>        False<br/>        False</span></pre><p id="e579" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，我们问的是盐这一栏中销售额超过60的地方。销售额超过60的月份返回True，其他月份返回False。</p><p id="aef7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">除此之外，布尔数组还可以用于从一个系列或一个数据帧中进行选择。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="706a" class="jx jy ht jt b fi jz ka l kb kc">In [5]: df[df.salt&gt;60]<br/>Out[5]:       eggs     salt    fish<br/>       month  <br/>       Mar    221      89.0     72<br/>       Apr     77      87.0     20</span></pre><p id="23e3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将返回盐销售额高于60的所有列和月份。</p><p id="e3c1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当用于进行选择时，布尔序列称为过滤器。</p><h2 id="1a14" class="jx jy ht bd kd ke kf kg kh ki kj kk kl jb km kn ko jf kp kq kr jj ks kt ku kv bi translated"><strong class="ak"> <em class="le">组合滤镜</em> </strong></h2><p id="28fa" class="pw-post-body-paragraph iq ir ht is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">在组合过滤器时，我们可以使用<code class="du lb lc ld jt b">AND</code>操作符或<code class="du lb lc ld jt b">OR</code>操作符。&amp;符号<code class="du lb lc ld jt b">&amp;</code>用于表示<code class="du lb lc ld jt b">AND</code>操作符，而一个简单的竖线<code class="du lb lc ld jt b">|</code>表示<code class="du lb lc ld jt b">OR</code>操作符。</p><p id="de3b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在两个布尔序列都满足的条件下,<code class="du lb lc ld jt b">AND</code>运算符返回一个结果。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="8ce4" class="jx jy ht jt b fi jz ka l kb kc">In [6]: df[(df.salt&gt;=50)&amp;(df.eggs&lt;200)]<br/>Out[6]:         egg   salt   fish<br/>       month                           <br/>       Feb      110   50.0     31 <br/>       Apr       77   87.0     20</span></pre><p id="927b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将返回一个数据框架，其中盐的销售额至少为50，而鸡蛋的销售额低于200。例如，6月份的盐销售额超过50，鸡蛋销售额超过200，但是第二个条件被忽略，所以6月份的数据没有返回。要返回结果，这两个条件都必须为真。</p><p id="b993" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lb lc ld jt b">OR</code>操作符需要至少满足任一方的一个条件才能返回结果。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="7847" class="jx jy ht jt b fi jz ka l kb kc">In [7]: df[(df.salt&gt;=50)|(df.eggs&lt;200)]<br/>Out[7]:            eggs    salt    fish<br/>        month<br/>        Jan          47     12.0    17<br/>        Feb         110     50.0    31<br/>        Mar         221     89.0    72<br/>        Apr          77     87.0    20<br/>        May         132      NaN    52<br/>        Jun         205     60.0    55</span></pre><p id="ac29" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">返回所有月份和列，因为它们都至少满足一个布尔序列条件。要返回结果，这两个条件中的任何一个都必须为真。</p><h2 id="1a8d" class="jx jy ht bd kd ke kf kg kh ki kj kk kl jb km kn ko jf kp kq kr jj ks kt ku kv bi translated">带有零和nan的数据帧</h2><p id="108e" class="pw-post-body-paragraph iq ir ht is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">我将使用熊猫复制原始数据帧<code class="du lb lc ld jt b">df</code>。<code class="du lb lc ld jt b">copy()</code>方法。然后，我将继续添加另一列，并在零和NaNs上工作。稍后我们将回到原始数据帧</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="4c98" class="jx jy ht jt b fi jz ka l kb kc">In  [8]: df2=df.copy()<br/>In  [9]: df2['bacon']=[0,0,50,60,70,80]<br/>In [10]: df2<br/>Out[10]:          eggs    salt    fish   bacon<br/>        month<br/>        Jan          47     12.0    17     0<br/>        Feb         110     50.0    31     0<br/>        Mar         221     89.0    72    50<br/>        Apr          77     87.0    20    60<br/>        May         132      NaN    52    70<br/>        Jun         205     60.0    55    80</span></pre><p id="bdee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们来探索如何处理零和NaNs</p><ul class=""><li id="c31a" class="lf lg ht is b it iu ix iy jb lh jf li jj lj jn lk ll lm ln bi translated">我们可能会问哪些月份的值都不为零</li></ul><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="83eb" class="jx jy ht jt b fi jz ka l kb kc">In [11]: df2.loc[:,df2.all()]<br/>Out[11]:            eggs    salt    fish<br/>        month<br/>        Jan          47     12.0    17<br/>        Feb         110     50.0    31<br/>        Mar         221     89.0    72<br/>        Apr          77     87.0    20<br/>        May         132      NaN    52<br/>        Jun         205     60.0    55</span></pre><ul class=""><li id="53b4" class="lf lg ht is b it iu ix iy jb lh jf li jj lj jn lk ll lm ln bi translated">我们可能还想检查哪些月份有非零值</li></ul><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="8f40" class="jx jy ht jt b fi jz ka l kb kc">In [12]: df2.loc[:,df2.any()]<br/>Out[12]:          eggs    salt    fish   bacon<br/>        month<br/>        Jan          47     12.0    17     0<br/>        Feb         110     50.0    31     0<br/>        Mar         221     89.0    72    50<br/>        Apr          77     87.0    20    60<br/>        May         132      NaN    52    70<br/>        Jun         205     60.0    55    80</span></pre><ul class=""><li id="9098" class="lf lg ht is b it iu ix iy jb lh jf li jj lj jn lk ll lm ln bi translated">我们可能还想检查哪些行和列有NaN</li></ul><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="ee45" class="jx jy ht jt b fi jz ka l kb kc">In [13]: df.loc[:,df.isnull().any()]<br/>Out[13]:        salt<br/>        month   <br/>          Jan   12.0 <br/>          Feb   50.0<br/>          Mar   89.0 <br/>          Apr   87.0<br/>          May    NaN<br/>          Jun   60.0</span></pre><ul class=""><li id="b071" class="lf lg ht is b it iu ix iy jb lh jf li jj lj jn lk ll lm ln bi translated">所有条目显示的所有列</li></ul><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="5041" class="jx jy ht jt b fi jz ka l kb kc">In [14]: df.loc[:, df.notnull().all()]<br/>Out[14]:          eggs       fish   <br/>        month<br/>        Jan          47       17     <br/>        Feb         110       31     <br/>        Mar         221       72   <br/>        Apr          77       20   <br/>        May         132       52   <br/>        Jun         205       55   </span></pre><ul class=""><li id="6dcf" class="lf lg ht is b it iu ix iy jb lh jf li jj lj jn lk ll lm ln bi translated">删除带有任何NaNs的行</li></ul><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="cbbd" class="jx jy ht jt b fi jz ka l kb kc">In [15]: df2.dropna(how='any']<br/>Out[15]:          eggs    salt    fish   bacon<br/>        month<br/>        Jan          47     12.0    17     0<br/>        Feb         110     50.0    31     0<br/>        Mar         221     89.0    72    50<br/>        Apr          77     87.0    20    60<br/>        Jun         205     60.0    55    80</span></pre><p id="2485" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">五月已经被放弃了。这是因为5月份的盐销售额缺失。<code class="du lb lc ld jt b">how='any'</code>将确保删除任何缺少值的行。另一种方法是<code class="du lb lc ld jt b">how='all'</code>，这将保留所有行，即使只有一个非缺失的列条目。这会将五月的行保留在数据帧中。</p><h2 id="1181" class="jx jy ht bd kd ke kf kg kh ki kj kk kl jb km kn ko jf kp kq kr jj ks kt ku kv bi translated">基于另一列筛选一列</h2><p id="19a8" class="pw-post-body-paragraph iq ir ht is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">可以基于另一列的过滤器来过滤数据帧的一列。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="4405" class="jx jy ht jt b fi jz ka l kb kc">In [16]: df.eggs[df.salt&gt;55]<br/>out[16]: month<br/>         Mar      221<br/>         Apr       77<br/>         Jun      205</span></pre><p id="4989" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，我过滤了盐的销售额高于55的月份的鸡蛋销售额。它返回了3月、4月和6月的鸡蛋销售额。它可以复制到数据的任何部分。您所需要做的就是指定感兴趣的列和您想要取出的列的过滤器。</p><h2 id="c9d5" class="jx jy ht bd kd ke kf kg kh ki kj kk kl jb km kn ko jf kp kq kr jj ks kt ku kv bi translated">基于另一列修改列</h2><p id="bc70" class="pw-post-body-paragraph iq ir ht is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">我们还可以基于另一列的过滤器来修改一列。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="a175" class="jx jy ht jt b fi jz ka l kb kc">In [17]: df.eggs[df.salt&gt;55]+=5<br/>In [18]: df<br/>Out[10]:          eggs    salt    fish  <br/>        month<br/>        Jan          47     12.0    17     <br/>        Feb         110     50.0    31     <br/>        Mar         225     89.0    72   <br/>        Apr          82     87.0    20   <br/>        May         132      NaN    52    <br/>        Jun         210     60.0    55   </span></pre><p id="6d52" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面的代码过滤了盐销售额大于55的月份的鸡蛋销售额，并在这些月份的鸡蛋销售额中增加了5。在返回的新数据框架中，三月、四月和六月的鸡蛋销售额增加了5英镑。</p><p id="87c4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可能有一个促销活动，如果盐的销量超过55，就额外增加5个鸡蛋。每个人都喜欢偶尔的升职，不是吗？熊猫在这方面为我们提供了保障。</p><p id="3b94" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好了，这就是本教程的全部内容。有很多东西需要咀嚼和消化。这需要一点时间和一些练习。</p><p id="2a7f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请投入一些工作，你会好起来的。下次见，编码快乐！</p></div></div>    
</body>
</html>