<html>
<head>
<title>Folium and Choropleth. Weird Names, Cool Graph.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">叶和茎。奇怪的名字，很酷的图表。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/folium-and-choropleth-weird-names-cool-graph-4f9b99b99190?source=collection_archive---------34-----------------------#2020-04-26">https://medium.com/analytics-vidhya/folium-and-choropleth-weird-names-cool-graph-4f9b99b99190?source=collection_archive---------34-----------------------#2020-04-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="586b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们就做点酷的，然后收工吧。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jk"><img src="../Images/355fae3cfd3d893251a6b11f2694c610.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aI818h03sqqsklWP5fKb-w.jpeg"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">曼哈顿哈德逊码头的船只</figcaption></figure><p id="b278" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我是一名数据科学家。我是一名数据科学家，目前正在开发一个时间序列异常检测工具。我是一名数据科学家，也很怀念为sh摆弄数据集的日子！ts和笑声。因此，我在<a class="ae ka" href="https://www.kaggle.com/dgomonov/new-york-city-airbnb-open-data" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上找到了一个相对较小的数据集，其中包含(呵呵，机器学习双关语)2019年以来纽约市(NYC)的一些Airbnb房源和指标。我完全打算花上几个小时来分析数据集，并提供非常详细的答案来回答Kaggle提出的问题。大约一个小时后，我没有抽出时间来回答一个问题……<strong class="io hj">相反，我做了一个看起来很酷的图表！</strong></p><p id="2ee8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对你们中的一些人来说，choropleth图可能看起来有点“嗯”。但我个人认为这是一件很酷的事情。事实上，这太酷了，以至于我决定推迟对Airbnb数据集的分析，并创建一个教程，介绍我如何使用一个名为Folium的Python模块制作choropleth图。</p><p id="4091" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我知道你在想什么。Choropleth和leav？什么鬼东西？尽管听起来像草类型的口袋妖怪，但它们实际上是Python/数据科学相关的。Choropleth是一种表示地理空间的图表，其中子区域以与一些总体统计数据成比例的方式进行着色，如旧金山湾区不同区域的着色，基于有多少人在玩《动物穿越:新视野》(请随意给我发送一些铁木家具)。Folium是一个Python包，可以让您轻松地创建交互式地图，恰好具有内置的choropleth功能。</p><p id="1858" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Kaggle页面问道:“我们可以从不同的领域了解到什么？”。好吧，让我们看看纽约不同社区的Airbnb平均价格/住宿的图表能告诉我们什么！</p><p id="ee51" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">闲聊结束了。我们开始吧，好吗？</p><h1 id="e3cc" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">数据</h1><p id="cdda" class="pw-post-body-paragraph im in hi io b ip kz ir is it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj hb bi translated">从这个<a class="ae ka" href="https://www.kaggle.com/dgomonov/new-york-city-airbnb-open-data" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>链接下载‘AB _ NYC _ 2019 . CSV’。</p><p id="8451" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从<a class="ae ka" href="https://data.beta.nyc/dataset/pediacities-nyc-neighborhoods/resource/35dd04fb-81b3-479b-a074-a27a37888ce7" rel="noopener ugc nofollow" target="_blank"> BetaNYC的</a>网站下载GeoJSON文件。</p><h1 id="af36" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">代码</h1><p id="5f71" class="pw-post-body-paragraph im in hi io b ip kz ir is it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj hb bi translated">让我们导入我们的包</p><pre class="jl jm jn jo fd le lf lg lh aw li bi"><span id="de4c" class="lj kc hi lf b fi lk ll l lm ln">import numpy as np<br/>import pandas as pd<br/>import folium</span></pre><p id="a4f8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后导入并查看我们的csv文件:</p><pre class="jl jm jn jo fd le lf lg lh aw li bi"><span id="8a8b" class="lj kc hi lf b fi lk ll l lm ln">path = &lt;path_to_csv_file&gt;<br/>raw_df = pd.read_csv(path)<br/>raw_df.head()</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es lo"><img src="../Images/c87a3b915499c488cb892bd6c0420a3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rsYwHTHO35qNRWV90a7qmw.png"/></div></div></figure><p id="5dfb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们想要的是一个给出每个邻域平均价格的数据框架，这可以使用“groupby”命令轻松实现:</p><pre class="jl jm jn jo fd le lf lg lh aw li bi"><span id="fce2" class="lj kc hi lf b fi lk ll l lm ln">choro_df = raw_df.copy()<br/>choro_df = choro_df[['price','neighbourhood']].groupby('neighbourhood').mean().reset_index()<br/>choro_df = choro_df.dropna(subset=['price'])<br/>choro_df.rename(columns={'price':'avg_price'}, inplace=True)<br/>choro_df.head()</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es lp"><img src="../Images/62643ad30717f7cf8c51803d8e5ed81f.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*CFLImiMLtGflSrxFeoV_aQ.png"/></div></figure><p id="e480" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">完美。现在，在我们开始绘制图表之前，我们必须绑定“avg_price”列。每个箱子代表一种不同的颜色，这种颜色将会出现在choropleth上！此外，在这篇文章发表时(2020年4月24日)，follow最多只接受6个bin值。</p><pre class="jl jm jn jo fd le lf lg lh aw li bi"><span id="148e" class="lj kc hi lf b fi lk ll l lm ln">bins = list(choro_df['avg_price'].quantile([0, 0.25, 0.50, 0.75, 1.0]))</span></pre><p id="e1c7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">很简单，对吧？现在我们可以开始编写教程的图形部分了。首先定义一个简单的函数来创建一个默认的叶子贴图对象:</p><pre class="jl jm jn jo fd le lf lg lh aw li bi"><span id="32c7" class="lj kc hi lf b fi lk ll l lm ln">def get_base_map(default_location, default_zoom_start=11):<br/>    """<br/>        default_location: [latitude, longitude]<br/>    """<br/>    base_map = folium.Map(width=800, <br/>                          height=600, <br/>                          location=default_location, <br/>                          control_scale=True, <br/>                          zoom_start=default_zoom_start)<br/>    return base_map</span></pre><p id="3130" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们需要为我们的地图计算一个默认的开始位置，所以让我们简单地计算数据集中提供给我们的Airbnb的所有坐标的质心:</p><pre class="jl jm jn jo fd le lf lg lh aw li bi"><span id="0b05" class="lj kc hi lf b fi lk ll l lm ln">avg_lat = raw_df['latitude'].mean()<br/>avg_long = raw_df['longitude'].mean()</span></pre><p id="f8d5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，我们可以创建默认的Map对象，并在其上添加一个choropleth！</p><pre class="jl jm jn jo fd le lf lg lh aw li bi"><span id="ecbf" class="lj kc hi lf b fi lk ll l lm ln">base_map = get_base_map(default_location=[avg_lat, avg_long])<br/>folium.Choropleth(geo_data=&lt;location_of_geoJSON_file&gt;,<br/>                 name='choropleth',<br/>                 data=choro_df,<br/>                 columns=['neighbourhood', 'avg_price'],<br/>                 key_on='feature.properties.neighborhood',<br/>                 fill_opacity=0.5,<br/>                 fill_color='Spectral',<br/>                 line_opacity=1,<br/>                 bins=bins,<br/>                 nan_fill_color='white',<br/>                 nan_fill_opacity=0,<br/>                 legend_name='Price/Night [$]').add_to(base_map)<br/>base_map</span></pre><p id="b1bb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">除了“key_on”参数的之外，所有参数都很简单<strong class="io hj">。它接受JavaScript对象符号，该符号表示在关联我们的“choro_df”数据帧中的值和我们下载的geoJSON文件中包含的对象时要键入哪一列。由于我们希望将每个邻域的坐标链接到特定的价格，因此我们使用“feature . properties . neighborhood”对象作为我们的“key_on”值。</strong></p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es lq"><img src="../Images/2d3d47a9389d94e873a8b9cf36b4d9ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aFoG0LtZ2tX-ultN-0llFg.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">当您在Jupyter笔记本中运行代码时，地图实际上是交互式的！</figcaption></figure><p id="85b3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">作为一个完美主义者，我立刻意识到这个图例的色标并没有以一种非常用户友好的方式显示出来。我还没有完全弄清楚如何改变图例的比例，但是如果你在评论里有，请让我知道(拜托…真是要命…)。</p><p id="42af" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">但是，就是这样！很简单吧？</p><p id="2d58" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请在评论部分随意提及其他存在于普通EDA领域之外的很酷的图表，如箱线图和直方图…我很乐意听到您在剖析数据集时使用的那些图表！</p><p id="5b84" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">直到下一次，和平！</p></div></div>    
</body>
</html>