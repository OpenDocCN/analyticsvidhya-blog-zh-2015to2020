<html>
<head>
<title>Visualize multi-dimension datasets in a 2D graph using t-SNE (Airbnb bookings dataset as an example)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用t-SNE在2D图中可视化多维数据集(以Airbnb预订数据集为例)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/note-visualize-multi-dimension-datasets-in-a-2d-graph-using-t-sne-airbnb-bookings-dataset-as-824541cc5388?source=collection_archive---------9-----------------------#2020-01-15">https://medium.com/analytics-vidhya/note-visualize-multi-dimension-datasets-in-a-2d-graph-using-t-sne-airbnb-bookings-dataset-as-824541cc5388?source=collection_archive---------9-----------------------#2020-01-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="ab fe cl ij"><img src="../Images/d09a7661456782540080ef98b32dd16e.png" data-original-src="https://miro.medium.com/v2/format:webp/0*tw8rByZKcj-Njpow.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">使用用户预订数据集中的31个数字特征进行预测，该数据集中有12个不同的旅行目的地——是的，我知道这真的很混乱，至少我们立即知道我们有一些特征工程工作要做:D</figcaption></figure><h2 id="f607" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">t分布随机邻居嵌入(t-SNE)算法</h2><p id="3f5a" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki hb bi translated">首先，<strong class="jq hj">什么是t-SNE </strong>和<strong class="jq hj">我们什么时候为什么要用它</strong>？这是一个<code class="du kj kk kl km b">unsupervised</code>和<code class="du kj kk kl km b">non-linear</code> <code class="du kj kk kl km b">dimension reduction</code>算法，人们通常在<code class="du kj kk kl km b">exploratory data analysis</code>期间使用它，这是整个机器学习管道的早期阶段。它帮助我们通过2D或3D图(或其他相对较低的数字)来显示高维数据集(例如，许多要素)，从而快速直观地了解数据。它不是以直接将其应用于分类任务的方式设计的。</p><p id="2e97" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated"><strong class="jq hj">PCA怎么样？</strong>在降维区，人们常将其与<code class="du kj kk kl km b">PCA</code>，或<code class="du kj kk kl km b">Principal Component Analysis</code>相提并论。实际上，<code class="du kj kk kl km b">t-SNE</code>是一种更新的方法，由Laurens van der Maatens和Geoffrey Hinton在2008年开发(参见论文<a class="ae ks" href="http://www.jmlr.org/papers/volume9/vandermaaten08a/vandermaaten08a.pdf" rel="noopener ugc nofollow" target="_blank"> <em class="kt">“使用t-SNE可视化数据”此处</em> </a>)，而PCA是由Hotelling H .早在1933年(<a class="ae ks" href="https://psycnet.apa.org/record/1934-00645-001" rel="noopener ugc nofollow" target="_blank"> <em class="kt">将复杂的统计变量分析成主成分</em> </a>)开发的，几乎是三代之前！</p><p id="67f5" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated">正如t-SNE论文中提到的，线性类型的模型肯定有一些限制，如PCA、<em class="kt">“对于位于或接近于</em> <strong class="jq hj"> <em class="kt">低维</em> </strong> <em class="kt">、</em> <strong class="jq hj"> <em class="kt">非线性流形</em> </strong> <em class="kt">的高维数据，通常更重要的是将非常相似的数据点的低维表示保持在一起，</em> <strong class="jq hj"> <em class="kt">，这对于线性映射通常是不可能的</em></strong>T39】</p><p id="734d" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated">为了更好地理解这一点，我们可以看看底层算法(以及许多在线的伟大的“PCA vs t-SNE”文章)，除了原始论文中的算法部分，我还强烈推荐这本<a class="ae ks" href="https://www.oreilly.com/learning/an-illustrated-introduction-to-the-t-sne-algorithm" rel="noopener ugc nofollow" target="_blank"><em class="kt">t-SNE算法</em> </a>的图解介绍读物，它为模型提供了非常直观但数学的视角。为了继续讨论编码部分，在这里，我们只能说与<code class="du kj kk kl km b">PCA</code>的线性方法相比，<code class="du kj kk kl km b">t-SNE</code>在处理某些类型的复杂数据时更有效。如下图所示，一个由<em class="kt"> puyokw </em>创作的<a class="ae ks" href="https://www.kaggle.com/puyokw/clustering-in-2-dimension-using-tsne/code" rel="noopener ugc nofollow" target="_blank"> Kaggle脚本</a>清晰地展示了t-SNE的能力。</p><figure class="kv kw kx ky fd ii er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ku"><img src="../Images/212f099680356d15cac9537026c5fc26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*J9GheNoUin8lTS1F.png"/></div></div></figure><figure class="kv kw kx ky fd ii er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ku"><img src="../Images/39cda99130424ecc9511b443bbc065f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qsheIf9Voh9IuJ0j.png"/></div></div></figure><h2 id="02be" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">密码</h2><p id="4ad5" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki hb bi translated">对于R</p><p id="00ab" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated"><strong class="jq hj">步骤1 </strong>:安装并加载<code class="du kj kk kl km b">Rtsne</code>包</p><pre class="kv kw kx ky fd ld km le lf aw lg bi"><span id="9726" class="iq ir hi km b fi lh li l lj lk">install.packages("Rtsne")  # Install Rtsne from CRAN library<br/>library(Rtsne)</span></pre><p id="1d9b" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated"><strong class="jq hj">第二步</strong>。为我们的示例用例加载数据集</p><pre class="kv kw kx ky fd ld km le lf aw lg bi"><span id="a28e" class="iq ir hi km b fi lh li l lj lk">&gt; iris_unique &lt;- unique(iris) # remove duplicate rows <br/>&gt; head(iris_unique)</span><span id="20e8" class="iq ir hi km b fi ll li l lj lk">Sepal.Length Sepal.Width Petal.Length Petal.Width Species <br/>1 5.1 3.5 1.4 0.2 setosa <br/>2 4.9 3.0 1.4 0.2 setosa <br/>3 4.7 3.2 1.3 0.2 setosa <br/>4 4.6 3.1 1.5 0.2 setosa <br/>5 5.0 3.6 1.4 0.2 setosa</span></pre><p id="424c" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated"><strong class="jq hj">第三步</strong>。适应t-SNE和视觉化</p><p id="afd5" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated">是的——真的就这么简单</p><pre class="kv kw kx ky fd ld km le lf aw lg bi"><span id="698c" class="iq ir hi km b fi lh li l lj lk">&gt; iris_matrix = as.matrix(iris_unique[,1:4]) # note: we can only pass in numeric columns<br/>&gt; tsne_out &lt;- Rtsne(iris_matrix) <br/>&gt; plot(tsne_out$Y,col=iris$Species) # graph is now generated</span></pre><figure class="kv kw kx ky fd ii er es paragraph-image"><div class="ab fe cl ij"><img src="../Images/4e1f871445aa52c9c3c610d28205421a.png" data-original-src="https://miro.medium.com/v2/format:webp/0*r3I3DJjIBagYPw6S.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">t-SNE可视化对于简单的虹膜数据集，三种类型的花被清楚地分成不同的3个簇</figcaption></figure><p id="50c6" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated">现在，让我们尝试另一个真实世界的数据集，但要复杂得多——Kaggle比赛中的<em class="kt"> Airbnb的用户预订数据集</em>。通过下面的代码，我们可以查看它在2D空间中的可视化效果。</p><p id="8888" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated"><strong class="jq hj">第一步。</strong>加载数据:<a class="ae ks" href="https://www.kaggle.com/c/airbnb-recruiting-new-user-bookings/data" rel="noopener ugc nofollow" target="_blank"> <em class="kt"> Airbnb数据集</em> </a> <em class="kt">(训练数据集中有213451行)</em></p><pre class="kv kw kx ky fd ld km le lf aw lg bi"><span id="9c95" class="iq ir hi km b fi lh li l lj lk">&gt; library(readr) <br/>&gt; df_train = read_csv(“train_users.csv”) </span><span id="0210" class="iq ir hi km b fi ll li l lj lk"># subset numerical features<br/>&gt; numeric_columns = sapply(df_train, is.numeric) <br/>&gt; countries = as.factor(df_train$country_destination) <br/>&gt; df_train = df_train[, numeric_columns] <br/>&gt; df_train$country_destination = countries # put destination column back <br/>&gt; df_train_unique &lt;- unique(train) # de-duplication<br/>&gt; dim(df_train_unique)</span><span id="0941" class="iq ir hi km b fi ll li l lj lk">[1] 213451 31</span></pre><p id="50f1" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated"><strong class="jq hj">第二步</strong>。拟合t-SNE并生成图</p><pre class="kv kw kx ky fd ld km le lf aw lg bi"><span id="d00b" class="iq ir hi km b fi lh li l lj lk">&gt; matrx = as.matrix(df_train_unique) <br/>&gt; tsne_out &lt;- Rtsne(matrx) <br/>&gt; plot(tsne_out$Y, col=countries, main=’t-SNE of airbnb dataset on Kaggle (31 features)’)</span></pre><figure class="kv kw kx ky fd ii er es paragraph-image"><div class="ab fe cl ij"><img src="../Images/d09a7661456782540080ef98b32dd16e.png" data-original-src="https://miro.medium.com/v2/format:webp/0*tw8rByZKcj-Njpow.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">31个数字特征和12个不同的目标变量</figcaption></figure><p id="78bc" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated">在<code class="du kj kk kl km b">Rtsne()</code>和<code class="du kj kk kl km b">unique()</code>上花了20-30分钟，得到的图形很糟糕，这意味着我还没有想出好的功能来区分<strong class="jq hj"> 12个不同国家的目的地</strong>以进行准确的预测。<br/>(可以通过<em class="kt">θ</em>、<em class="kt"> max_iter </em>等参数提高速度。)</p><pre class="kv kw kx ky fd ld km le lf aw lg bi"><span id="a3dc" class="iq ir hi km b fi lh li l lj lk">&gt; colnames(df_train)</span><span id="a33c" class="iq ir hi km b fi ll li l lj lk">[1] “timestamp_first_active” “age” [3] “signup_flow” “-unknown-” [5] “Android App Unknown Phone/Tablet” “Android Phone” [7] “Blackberry” “Chromebook” [9] “Linux Desktop” “Mac Desktop” [11] “Opera Phone” “Tablet” [13] “Windows Desktop” “Windows Phone” [15] “iPad Tablet” “iPhone” [17] “iPodtouch” “total_elapsed_time” [19] “-unknown-_pct” “Android App Unknown Phone/Tablet_pct” [21] “Android Phone_pct” “Blackberry_pct” [23] “Chromebook_pct” “Linux Desktop_pct” [25] “Mac Desktop_pct” “Opera Phone_pct” [27] “Tablet_pct” “Windows Desktop_pct” [29] “Windows Phone_pct” “iPad Tablet_pct” [31] “iPhone_pct”</span></pre><p id="a234" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated"><strong class="jq hj"> Python代码</strong></p><p id="c6dd" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated">对于Python人员来说，我们将使用<code class="du kj kk kl km b">sklearn.manifold</code>下的<code class="du kj kk kl km b">TSNE</code>包，一个简单的用例如下所示，其中有可选参数，包括<strong class="jq hj"><em class="kt"/>，<em class="kt"> n_components </em> </strong> <em class="kt">(嵌入空间的维度，默认=2) </em>，<strong class="jq hj"> <em class="kt"> n_iter </em> </strong> <em class="kt">(优化的最大迭代次数)</em></p><pre class="kv kw kx ky fd ld km le lf aw lg bi"><span id="f13d" class="iq ir hi km b fi lh li l lj lk">from sklearn.manifold import TSNE<br/>import matplotlib.pyplot as plt</span><span id="120d" class="iq ir hi km b fi ll li l lj lk">X_tsne = TSNE().fit_transform(df_train_unique)<br/>scatter(X_tsne[:, 0], X_tsne[:, 1],<br/>        c=countries,cmap=plt.cm.spectral,alpha=.4,<br/>        edgecolor='k')</span></pre><p id="9a41" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated"><strong class="jq hj">权衡:高时间和空间复杂度</strong></p><p id="ad58" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated">当我传入20万个数据点的完整的<strong class="jq hj"> 150+ </strong>特征(包括<code class="du kj kk kl km b">dummyVars()</code>添加的分类字段)来构建2D t-SNE可视化时，它花费了很长时间，并耗尽了我的MBP的<strong class="jq hj"> 25GB </strong>内存，相当可怕…！</p><figure class="kv kw kx ky fd ii er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lm"><img src="../Images/64ce7ab3d6f93a407d8155c17f87d9c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SX5z1Dy2yUyz52fO.png"/></div></div></figure><p id="ae2b" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated">除此之外，<strong class="jq hj"> t-SNE算法的计算量非常大</strong>。如<a class="ae ks" href="https://scikit-learn.org/stable/modules/manifold.html" rel="noopener ugc nofollow" target="_blank"> <em class="kt"> sklearn文档</em> </a>所示，在同一个<em class="kt">流形学习(非线性降维)</em>家族中，<strong class="jq hj"><em class="kt"/>t-SNE<strong class="jq hj">可以比<em class="kt">【SE】</em><em class="kt">【MDS】</em>等其他</strong>模型多取6-100倍</strong><strong class="jq hj"/>。</p><figure class="kv kw kx ky fd ii er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ln"><img src="../Images/8f9a4bcde734409d4b3623ee11c59169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ny1QIfHIxyvjNiIC.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">即使与其他非线性降维模型相比，t-SNE也是非常计算密集型的</figcaption></figure><p id="c2f7" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated">当我们考虑底层算法时，t-SNE必须计算所有点之间的距离，并维护一个成对的<em class="kt"> N乘N </em>距离矩阵(N = #个示例)。<strong class="jq hj">因此，它的空间和时间复杂度都在二次水平，<em class="kt"> O(n ) </em> </strong>，这个问题自然成为人们试图优化的另一个热门研究领域，一个例子是<a class="ae ks" href="https://github.com/KlugerLab/FIt-SNE" rel="noopener ugc nofollow" target="_blank"> <em class="kt">基于快速傅立叶变换加速插值的t-SNE (FIt-SNE) </em> </a>，详细内容可以在论文<a class="ae ks" href="https://arxiv.org/abs/1712.09005" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="bab2" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">未完待续<strong class="ak"> …… </strong></h2><p id="6161" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki hb bi translated">回到Airbnb数据集的例子，我们应该能够用t-SNE生成更好的可视化结果——请继续关注，下次让我分享更多！</p><h2 id="1086" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">参考</h2><ul class=""><li id="ce30" class="lo lp hi jq b jr js jv jw jb lq jf lr jj ls ki lt lu lv lw bi translated"><a class="ae ks" href="https://scikit-learn.org/stable/modules/generated/sklearn.manifold.TSNE.html" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj">【Python】</strong>sk learn . manifold TSNE</a></li><li id="60a6" class="lo lp hi jq b jr lx jv ly jb lz jf ma jj mb ki lt lu lv lw bi translated"><a class="ae ks" href="http://www.inside-r.org/packages/cran/Rtsne/docs/Rtsne" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj">【R】</strong>Rtsne { Rtsne }文档</a> <a class="ae ks" href="https://cran.r-project.org/web/packages/Rtsne/Rtsne.pdf" rel="noopener ugc nofollow" target="_blank"> pdf </a></li><li id="3add" class="lo lp hi jq b jr lx jv ly jb lz jf ma jj mb ki lt lu lv lw bi translated"><a class="ae ks" href="https://www.youtube.com/watch?v=7rgzCjrIA-o" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj">【R】</strong>dummy vars()—将分类数据转换为数值数据，以用于建模目的</a> ( <a class="ae ks" href="http://www.inside-r.org/packages/cran/caret/docs/dummyVars" rel="noopener ugc nofollow" target="_blank"> doc </a>)</li><li id="847d" class="lo lp hi jq b jr lx jv ly jb lz jf ma jj mb ki lt lu lv lw bi translated"><strong class="jq hj"/><a class="ae ks" href="https://www.kaggle.com/benhamner/otto-group-product-classification-challenge/t-sne-visualization/code" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj">ka ggle script】</strong>—t-SNE可视化，奥托竞赛</a></li><li id="00f1" class="lo lp hi jq b jr lx jv ly jb lz jf ma jj mb ki lt lu lv lw bi translated"><strong class="jq hj">[</strong><a class="ae ks" href="https://www.kaggle.com/puyokw/digit-recognizer/clustering-in-2-dimension-using-tsne/code" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj">【ka ggle script】</strong>—2D的集群，采用tsne VS pca，数字识别器</a></li><li id="ac28" class="lo lp hi jq b jr lx jv ly jb lz jf ma jj mb ki lt lu lv lw bi translated"><a class="ae ks" href="https://www.analyticsvidhya.com/blog/2017/01/t-sne-implementation-r-python/" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">【文章】</strong>关于t-SNE算法的综合指南，用R &amp; Python </a>实现，由Analytics Vidhya提供</li><li id="fec5" class="lo lp hi jq b jr lx jv ly jb lz jf ma jj mb ki lt lu lv lw bi translated"><a class="ae ks" href="https://distill.pub/2016/misread-tsne/" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">【文章】</strong>如何有效使用t-SNE</a></li><li id="b658" class="lo lp hi jq b jr lx jv ly jb lz jf ma jj mb ki lt lu lv lw bi translated"><a class="ae ks" href="http://www.jmlr.org/papers/volume9/vandermaaten08a/vandermaaten08a.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">【论文】</strong>马滕，L. V. D .，&amp;辛顿，G. (2008)。使用t-SNE可视化数据。<em class="kt">机器学习研究杂志</em>，<em class="kt">9</em>(11月)，2579–2605。</a></li></ul><h2 id="4093" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated"><strong class="ak">结尾备注:</strong></h2><blockquote class="mc md me"><p id="1483" class="jo jp kt jq b jr kn jt ju jv ko jx jy mf kp ka kb mg kq kd ke mh kr kg kh ki hb bi translated">感谢您阅读本文，非常感谢您的任何反馈/问题。请随时寻求进一步的合作😃</p></blockquote></div><div class="ab cl mi mj gp mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="hb hc hd he hf"><p id="00f7" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jb kp ka kb jf kq kd ke jj kr kg kh ki hb bi translated">【paullo.myvnc.com/blog/】<em class="kt">早在2016年</em> <a class="ae ks" href="http://45.55.83.242:4000/blog/2015/12/24/note-Use-t-SNE-to-visualize-multi-dimension-dataset-to-2D-graph/" rel="noopener ugc nofollow" target="_blank"> <em class="kt">同一作者发表了一篇相关文章但只是简单版本)</em></a></p></div></div>    
</body>
</html>