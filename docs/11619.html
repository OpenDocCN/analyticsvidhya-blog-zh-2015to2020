<html>
<head>
<title>Emotion Analysis with building an Artificial Neural Network using ML.NET with Tensorflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åŸºäºå¼ é‡æµ ML.NET æ„å»ºäººå·¥ç¥ç»ç½‘ç»œçš„æƒ…æ„Ÿåˆ†æ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/analytics-vidhya/emotion-analysis-with-building-an-artificial-neural-network-using-ml-net-powered-by-tensorflow-dd08aeb9aad7?source=collection_archive---------4-----------------------#2020-12-11">https://medium.com/analytics-vidhya/emotion-analysis-with-building-an-artificial-neural-network-using-ml-net-powered-by-tensorflow-dd08aeb9aad7?source=collection_archive---------4-----------------------#2020-12-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b6fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœºå™¨å­¦ä¹ å’Œäººå·¥æ™ºèƒ½æ˜¯ä¿¡æ¯æŠ€æœ¯çš„æ–°äº®ç‚¹ã€‚å¾®è½¯ä½œä¸ºå…¶æœ€å¤§çš„å¸‚åœºä»½é¢ä¹‹ä¸€ï¼Œç»ˆäºåœ¨ 2018 å¹´ 5 æœˆå®£å¸ƒæ´åŠ© ML.NETã€‚Net å¼€å‘äººå‘˜æ¥å®ç°ä»–ä»¬çš„ç›®æ ‡ã€‚ä½†æ˜¯ä¸ Pythonã€Javaã€LISP ç­‰å…¶ä»–æŠ€æœ¯ç›¸æ¯”ï¼Œå®ƒè¿˜æ˜¯ç›¸å½“æ–°çš„ã€‚å°±å¼€æºé¡¹ç›®ã€åº“æˆ–ç¬¬ä¸‰æ–¹å·¥å…·è€Œè¨€ï¼Œè¿˜æ²¡æœ‰è¶³å¤Ÿçš„èµ„æºã€‚è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚Net èµ¶ä¸Šå…¶ä»–å¤§çš„æŠ€æœ¯å…¬å¸æ¥å‘å±•å®ƒçš„ç¤¾åŒº</p><p id="26bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸å¿…ç­‰åˆ°è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œæ„Ÿè°¢å¾®è½¯çš„å·¥ç¨‹å¸ˆï¼Œä»–ä»¬ä½¿ ML.NET è·å¾—äº†è‡ªé€‚åº”çš„å¼€å‘ä½“éªŒï¼Œå¹¶åœ¨ä¸ NimbusML ä¸€èµ·ä½¿ç”¨æ—¶æ”¯æŒ<a class="ae jd" href="https://en.wikipedia.org/wiki/Python_(programming_language)" rel="noopener ugc nofollow" target="_blank"> Python </a>æ¨¡å‹ã€‚<br/>æˆ‘ä»¬éƒ½åº”è¯¥æ„Ÿè°¢å¾®è½¯çš„æƒŠäººå·¥ä½œï¼</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/9ca4f23c9296275e5e6e4332f1c8351d.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/1*FWFN3hFVYuuIB2CQSpdZBg.gif"/></div></div></figure><p id="da6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœ‰äº›äººæ›´å–œæ¬¢çœ‹è€Œä¸æ˜¯è¯»ï¼Œä¹Ÿåˆ¶ä½œä¸€ä¸ªè§†é¢‘æ¥æ¼”ç¤ºè¿™ç§ä¸œè¥¿åœ¨è¡ŒåŠ¨ä¸­å¾€å¾€æ˜¯æœ‰æ„ä¹‰çš„ï¼Œæ­£å› ä¸ºå¦‚æ­¤ï¼Œä¸‹é¢çš„è§†é¢‘çš„å­˜åœ¨ã€‚</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jq jr l"/></div></figure><p id="6d52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç°æœ‰çš„é¢„è®­ç»ƒ Tensorflow æ¨¡å‹ï¼Œè¯¥æ¨¡å‹ç”±å…·æœ‰æ•°åƒå¹…å›¾åƒçš„ç¥ç»ç½‘ç»œæ„å»ºï¼Œå¹¶é©»ç•™åœ¨è°·æ­Œçš„ä¸€ä¸ªæœåŠ¡å™¨ä¸­ï¼Œå¹¶åˆ©ç”¨<strong class="ih hj"> </strong> <a class="ae jd" href="https://en.wikipedia.org/wiki/Deep_learning" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">æ·±åº¦å­¦ä¹ </strong> </a>æ¥æ„å»ºæˆ‘ä»¬è‡ªå·±çš„ç¥ç»ç½‘ç»œï¼Œä»¥æé«˜æˆ‘ä»¬çš„å‡†ç¡®æ€§å¹¶åŠ å¿«è®­ç»ƒè¿‡ç¨‹ã€‚æˆ‘å°†åˆ›å»ºä¸€ä¸ª. Net æ ¸å¿ƒæ§åˆ¶å°åº”ç”¨ç¨‹åºæ¥å®ç°è¿™ä¸€ç‚¹ï¼Œå½“æ–‡ç« ç»“æŸæ—¶ï¼Œæˆ‘ä»¬å°†æœ‰ä¸€ä¸ªè·¨å¹³å°çš„å¯æ‰§è¡Œåº”ç”¨ç¨‹åºã€‚</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es js"><img src="../Images/c2a254f10c6db95dc7aa58dcef6158cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NZ_u3dMeTqh31q2pN9GNQQ.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">ä¸Šå›¾å±•ç¤ºäº† ML.NET åº”ç”¨ç¨‹åºçš„æ‹“æ‰‘ç»“æ„</figcaption></figure><p id="213d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è®©æˆ‘è¯´ï¼Œè¿™ç¯‡æ–‡ç« å—åˆ°äº†å¾®è½¯å®˜æ–¹æ–‡æ¡£çš„å¼ºçƒˆå¯å‘ã€‚è¯´å¾—å¤Ÿå¤šäº†ï¼Œè®©æˆ‘ä»¬å¼€å§‹è¡ŒåŠ¨å§ã€‚</p><p id="bd41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘å·²ç»æ›´æ”¹äº†è¾“å…¥æ•°æ®é›†å¹¶åŒ…å«äº†å¸®åŠ©å™¨æ–¹æ³•ï¼Œ<br/>æœ€åï¼Œä¸ºäº†å‡†ç¡®èµ·è§ï¼Œé€šè¿‡é‡æ–°æ ¼å¼åŒ–å’Œç°åº¦åŒ–æ¯ä¸ªå›¾åƒæ¥æ ‡å‡†åŒ–æ¨¡å‹ï¼Œä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼›</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jx"><img src="../Images/fc1448066b8d2c3be7b75aa114266152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a9rHxs6184R3mRojdmBK_g.png"/></div></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jy"><img src="../Images/ad9557f304462f228c8a54bf1bd693b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PSMBUAS86qRllwvaS0aaEA.png"/></div></div></figure><p id="49a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™ç§ç¼–è¾‘æ˜¯å¦‚æ­¤ç®€å•ï¼Œç”±äºã€‚Net æ ¸å¿ƒçš„å›¾åƒå¤„ç†åº“ã€‚ç»˜å›¾å‘½åç©ºé—´ï¼Œæˆ‘ä»¬æ‰€åšçš„åªæ˜¯é¦–å…ˆè°ƒæ•´å›¾åƒå¤§å°ä¸º 48x48ï¼Œç„¶åè½¬æ¢ä¸ºç°åº¦ã€‚ä¸‹é¢è¿™äº›ä»£ç ä¼˜é›…åœ°æ»¡è¶³äº†æˆ‘ä»¬çš„éœ€æ±‚ï¼›</p><pre class="jf jg jh ji fd jz ka kb kc aw kd bi"><span id="d94d" class="ke kf hi ka b fi kg kh l ki kj">public static Bitmap TranformToGrayscale(Bitmap original)<br/>        {<br/>            //create a blank bitmap the same size as original<br/>            Bitmap newBitmap = new Bitmap(original.Width, original.Height);</span><span id="8e20" class="ke kf hi ka b fi kk kh l ki kj">//get a graphics object from the new image<br/>            using (Graphics g = Graphics.FromImage(newBitmap))<br/>            {<br/>                //create the grayscale ColorMatrix<br/>                System.Drawing.Imaging.ColorMatrix colorMatrix = new System.Drawing.Imaging.ColorMatrix(<br/>                   new float[][]<br/>                   {<br/>             new float[] {.3f, .3f, .3f, 0, 0},<br/>             new float[] {.59f, .59f, .59f, 0, 0},<br/>             new float[] {.11f, .11f, .11f, 0, 0},<br/>             new float[] {0, 0, 0, 1, 0},<br/>             new float[] {0, 0, 0, 0, 1}<br/>                   });</span><span id="232d" class="ke kf hi ka b fi kk kh l ki kj">//create some image attributes<br/>                using (ImageAttributes attributes = new ImageAttributes())<br/>                {<br/>                    //set the color matrix attribute<br/>                    attributes.SetColorMatrix(colorMatrix);</span><span id="7594" class="ke kf hi ka b fi kk kh l ki kj">//draw the original image on the new image<br/>                    //using the grayscale color matrix<br/>                    g.DrawImage(original, new System.Drawing.Rectangle(0, 0, original.Width, original.Height),<br/>                                0, 0, original.Width, original.Height, GraphicsUnit.Pixel, attributes);<br/>                }<br/>            }<br/>            return newBitmap;<br/>        }</span><span id="dcca" class="ke kf hi ka b fi kk kh l ki kj">public static Bitmap ResizeImage(System.Drawing.Image image, int width, int height)<br/>        {<br/>            var destRect = new System.Drawing.Rectangle(0, 0, width, height);<br/>            var destImage = new Bitmap(width, height);</span><span id="5381" class="ke kf hi ka b fi kk kh l ki kj">destImage.SetResolution(image.HorizontalResolution, image.VerticalResolution);</span><span id="3c95" class="ke kf hi ka b fi kk kh l ki kj">using (var graphics = Graphics.FromImage(destImage))<br/>            {<br/>                graphics.CompositingMode = CompositingMode.SourceCopy;<br/>                graphics.CompositingQuality = CompositingQuality.HighQuality;<br/>                graphics.InterpolationMode = InterpolationMode.HighQualityBicubic;<br/>                graphics.SmoothingMode = SmoothingMode.HighQuality;<br/>                graphics.PixelOffsetMode = PixelOffsetMode.HighQuality;</span><span id="e644" class="ke kf hi ka b fi kk kh l ki kj">using (var wrapMode = new ImageAttributes())<br/>                {<br/>                    wrapMode.SetWrapMode(WrapMode.TileFlipXY);<br/>                    graphics.DrawImage(image, destRect, 0, 0, image.Width, image.Height, GraphicsUnit.Pixel, wrapMode);<br/>                }<br/>            }</span><span id="b1fc" class="ke kf hi ka b fi kk kh l ki kj">return destImage;<br/>        }To improve the accuracy of our model we standardize images as greyscaled and 48x48 length no matter the size of the original image</span></pre><p id="8d0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™å¯ä»¥æ¶ˆé™¤æ•°æ®ä¸­çš„å™ªå£°ï¼ŒåŠ å¿«è®­ç»ƒè¿‡ç¨‹ï¼Œå¹¶æ›´å¿«åœ°æ‰§è¡Œé¢„æµ‹ã€‚</p><p id="9b81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬å°†éµå¾ªä»¥ä¸‹æ­¥éª¤æ¥å®ç°å®ƒ:</p><h1 id="a714" class="kl kf hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">1.å»ºç«‹æ¨¡å‹</h1><p id="c806" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">æ„å»ºæ¨¡å‹åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤:</p><ul class=""><li id="38fa" class="ln lo hi ih b ii ij im in iq lp iu lq iy lr jc ls lt lu lv bi translated">ä»åˆå§‹æ•°æ®è§†å›¾çš„æ–‡ä»¶å¤¹ä¸­åŠ è½½å›¾åƒè·¯å¾„å’Œç›¸å…³æ ‡ç­¾</li><li id="4792" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">æ ¹æ®ä½¿ç”¨çš„ TensorFlow é¢„è®­ç»ƒæ¨¡å‹(å¦‚ InceptionV3)çš„éœ€è¦è¿›è¡Œå˜æ¢æ—¶ï¼Œå°†å›¾åƒåŠ è½½åˆ°å†…å­˜ä¸­ã€‚(æ ¹æ®æ‰€ä½¿ç”¨çš„æ·±åº¦ç¥ç»ç½‘ç»œçš„è¦æ±‚ï¼Œè°ƒæ•´åƒç´ å€¼çš„å¤§å°å¹¶ä½¿å…¶æ­£å¸¸åŒ–)</li><li id="fb98" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">å›¾åƒ<em class="mb">ä½¿ç”¨æ·±åº¦ç¥ç»ç½‘ç»œæ¨¡å‹çš„ç‰¹å¾åŒ–</em></li><li id="9d19" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">åŸºäº LbfgsMaximumEntropy çš„å›¾åƒåˆ†ç±»</li></ul><p id="eee0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸æ˜¯:ä½ å¯ä»¥è®¿é—®é¢„å…ˆè®­ç»ƒå¥½çš„ Tensorflow æ¨¡å‹çš„æ•°æ®åº“<a class="ae jd" href="https://www.tensorflow.org/resources/models-datasets" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a></p><p id="8b39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨ç±»ç±»å‹ä¸­å®šä¹‰æ•°æ®çš„æ¨¡å¼ï¼Œå¹¶åœ¨ä½¿ç”¨ TextLoader åŠ è½½æ•°æ®æ—¶å¼•ç”¨è¯¥ç±»å‹ã€‚è¿™é‡Œçš„ç±»ç±»å‹æ˜¯ ImageNetDataã€‚</p><pre class="jf jg jh ji fd jz ka kb kc aw kd bi"><span id="153e" class="ke kf hi ka b fi kg kh l ki kj">public class ImageData<br/>    {<br/>        [LoadColumn(0)]<br/>        public string ImagePath;</span><span id="9b19" class="ke kf hi ka b fi kk kh l ki kj">        [LoadColumn(1)]<br/>        public string Label;<br/>    }</span></pre><p id="6191" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">é€šè¿‡ LoadImagesFromDirectory()ä½¿ç”¨å®ç”¨æ–¹æ³•å°†æ‰€æœ‰è®­ç»ƒå’Œæµ‹è¯•å›¾åƒåˆ†åˆ«åŠ è½½åˆ°æ•°æ®è§†å›¾ä¸­:</p><pre class="jf jg jh ji fd jz ka kb kc aw kd bi"><span id="4660" class="ke kf hi ka b fi kg kh l ki kj">IEnumerable&lt;ImageData&gt; allImages = LoadImagesFromDirectory(folder: imagesDownloadFolderPath, useFolderNameasLabel: true);</span><span id="95a4" class="ke kf hi ka b fi kk kh l ki kj">IEnumerable&lt;ImageData&gt; testImages = LoadImagesFromDirectory(folder: testimagesDownloadFolderPath);</span></pre><p id="cc37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨å°†æ•°æ®é›†æ‹†åˆ†ä¸ºä¸¤ä¸ªæ•°æ®é›†(è®­ç»ƒæ•°æ®é›†å’Œæµ‹è¯•æ•°æ®é›†)ä¹‹å‰ï¼Œå¯¹å›¾åƒè¿›è¡Œæ··æ´—ï¼Œä»¥ä¾¿é€šè¿‡æ ‡æ³¨åˆ†ç±»æ›´å¥½åœ°å¹³è¡¡æ•°æ®é›†ã€‚</p><pre class="jf jg jh ji fd jz ka kb kc aw kd bi"><span id="6cf3" class="ke kf hi ka b fi kg kh l ki kj">ConsoleHelper.ConsoleWriteHeader("Read model");<br/>Console.WriteLine($"Model location: {inputTensorFlowModelFilePath}");<br/>Console.WriteLine($"Training file: {dataLocation}");</span><span id="fcb3" class="ke kf hi ka b fi kk kh l ki kj">// 1. Load images information (filenames and labels) in IDataView</span><span id="0883" class="ke kf hi ka b fi kk kh l ki kj">//Load the initial single full Image-Set<br/>IDataView fullImagesDataset = mlContext.Data.LoadFromEnumerable(imageSet);<br/>IDataView trainDataView = mlContext.Data.ShuffleRows(fullImagesDataset);<br/>IDataView testDataView = mlContext.Data.LoadFromEnumerable(testSet);</span></pre><p id="f908" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä»¥ä¸‹æ­¥éª¤å®šä¹‰äº†åŸ¹è®­ç®¡é“ã€‚é€šå¸¸ï¼Œåœ¨å¤„ç†æ·±åº¦ç¥ç»ç½‘ç»œæ—¶ï¼Œæ‚¨å¿…é¡»ä½¿å›¾åƒé€‚åº”ç½‘ç»œé¢„æœŸçš„æ ¼å¼ã€‚è¿™å°±æ˜¯å›¾åƒè¢«è°ƒæ•´å¤§å°ç„¶åå˜æ¢çš„åŸå› ã€‚</p><pre class="jf jg jh ji fd jz ka kb kc aw kd bi"><span id="3041" class="ke kf hi ka b fi kg kh l ki kj">// 2. Load images in-memory while applying image transformations <br/>// Input and output column names have to coincide with the input and output tensor names of the TensorFlow model<br/>// You can check out those tensor names by opening the Tensorflow .pb model with a visual tool like Netron: <a class="ae jd" href="https://github.com/lutzroeder/netron" rel="noopener ugc nofollow" target="_blank">https://github.com/lutzroeder/netron</a><br/>// TF .pb model --&gt; input node --&gt; INPUTS --&gt; input --&gt; id: "input" <br/>// TF .pb model --&gt; Softmax node --&gt; INPUTS --&gt; logits --&gt; id: "softmax2_pre_activation" (Inceptionv1) or "InceptionV3/Predictions/Reshape" (Inception v3)</span><span id="c185" class="ke kf hi ka b fi kk kh l ki kj">var dataProcessPipeline = mlContext.Transforms.Conversion.MapValueToKey(outputColumnName: LabelAsKey, inputColumnName: "Label")<br/>                .Append(mlContext.Transforms.LoadImages(outputColumnName: "image_object", imageFolder: imagesFolder, inputColumnName: nameof(DataModels.ImageData.ImagePath)))<br/>                .Append(mlContext.Transforms.ResizeImages(outputColumnName: "image_object_resized", <br/>                                                            imageWidth: ImageSettingsForTFModel.imageWidth, imageHeight: ImageSettingsForTFModel.imageHeight, <br/>                                                            inputColumnName: "image_object"))<br/>                .Append(mlContext.Transforms.ExtractPixels(outputColumnName:"input", inputColumnName:"image_object_resized", <br/>                                                            interleavePixelColors:ImageSettingsForTFModel.channelsLast, <br/>                                                            offsetImage:ImageSettingsForTFModel.mean, <br/>                                                            scaleImage:ImageSettingsForTFModel.scale))  //for Inception v3 needs scaleImage: set to 1/255f. Not needed for InceptionV1. <br/>                .Append(mlContext.Model.LoadTensorFlowModel(inputTensorFlowModelFilePath).<br/>                        ScoreTensorFlowModel(outputColumnNames: new[] { "InceptionV3/Predictions/Reshape" }, <br/>                                            inputColumnNames: new[] { "input" }, <br/>                                            addBatchDimensionInput: false));  // (For Inception v1 --&gt; addBatchDimensionInput: true)  (For Inception v3 --&gt; addBatchDimensionInput: false)</span></pre><p id="d17d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœ€åï¼Œæ·»åŠ  ML.NET åˆ†çº§åŸ¹è®­å¸ˆ(LbfgsMaximumEntropy)ä»¥æœ€ç»ˆç¡®å®šåŸ¹è®­æ¸ é“:</p><pre class="jf jg jh ji fd jz ka kb kc aw kd bi"><span id="e3cb" class="ke kf hi ka b fi kg kh l ki kj">// Set the training algorithm and convert back the key to the categorical values (original labels)                            <br/>var trainer = mlContext.MulticlassClassification.Trainers.LbfgsMaximumEntropy(labelColumnName: LabelAsKey, featureColumnName: "InceptionV3/Predictions/Reshape");  //"softmax2_pre_activation" for Inception v1<br/>var trainingPipeline = dataProcessPipeline.Append(trainer)<br/>                                            .Append(mlContext.Transforms.Conversion.MapKeyToValue(PredictedLabelValue, "PredictedLabel"));</span></pre><h1 id="d1da" class="kl kf hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">2.ç«è½¦æ¨¡å‹</h1><p id="061a" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">ä¸ºäº†å¼€å§‹åŸ¹è®­ï¼Œåœ¨å·²å»ºç®¡é“ä¸Šæ‰§è¡Œ<code class="du mc md me ka b">Fit</code>:</p><pre class="jf jg jh ji fd jz ka kb kc aw kd bi"><span id="d6d0" class="ke kf hi ka b fi kg kh l ki kj">ITransformer model = trainingPipeline.Fit(trainingDataView);</span></pre><h1 id="b6f2" class="kl kf hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">3.è¯„ä¼°æ¨¡å‹</h1><p id="b43f" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">è®­ç»ƒç»“æŸåï¼Œæˆ‘ä»¬ä½¿ç”¨è®­ç»ƒæ•°æ®å¯¹æ¨¡å‹è¿›è¡Œè¯„ä¼°ã€‚<code class="du mc md me ka b">Evaluate</code>å‡½æ•°éœ€è¦ä¸€ä¸ª<code class="du mc md me ka b">IDataView</code>ä½œä¸ºå‚æ•°ï¼Œå®ƒåŒ…å«ä½¿ç”¨æµ‹è¯•æ•°æ®é›†åˆ†å‰²çš„æ‰€æœ‰é¢„æµ‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†<code class="du mc md me ka b">Transform</code>åº”ç”¨äºæ¨¡å‹ï¼Œç„¶åå–<code class="du mc md me ka b">AsDynamic</code>å€¼ã€‚</p><pre class="jf jg jh ji fd jz ka kb kc aw kd bi"><span id="fd14" class="ke kf hi ka b fi kg kh l ki kj">// Make bulk predictions and calculate quality metrics<br/>ConsoleWriteHeader("Create Predictions and Evaluate the model quality");<br/>IDataView predictionsDataView = model.Transform(testDataView);<br/>           <br/>// Show the performance metrics for the multi-class classification            <br/>var classificationContext = mlContext.MulticlassClassification;<br/>var metrics = classificationContext.Evaluate(predictionsDataView, labelColumnName: LabelAsKey, predictedLabelColumnName: "PredictedLabel");<br/>ConsoleHelper.PrintMultiClassClassificationMetrics(trainer.ToString(), metrics);</span></pre><p id="355f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœ€åï¼Œæˆ‘ä»¬ä¿å­˜æ¨¡å‹:</p><pre class="jf jg jh ji fd jz ka kb kc aw kd bi"><span id="8c67" class="ke kf hi ka b fi kg kh l ki kj">mlContext.Model.Save(model, predictionsDataView.Schema, outputMlNetModelFilePath);</span></pre><h2 id="d93a" class="ke kf hi bd km mf mg mh kq mi mj mk ku iq ml mm ky iu mn mo lc iy mp mq lg mr bi translated">è¿è¡Œåº”ç”¨ç¨‹åºæ¥è®­ç»ƒæ¨¡å‹</h2><p id="1dc1" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">ä¸ºäº†è®­ç»ƒæ‚¨çš„æ¨¡å‹ï¼Œæ‚¨åº”è¯¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œ:</p><ol class=""><li id="383a" class="ln lo hi ih b ii ij im in iq lp iu lq iy lr jc ms lt lu lv bi translated">åœ¨ Visual Studio ä¸­å°†<code class="du mc md me ka b">ImageClassification.Train</code>è®¾ç½®ä¸ºå¯åŠ¨é¡¹ç›®</li><li id="8470" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ms lt lu lv bi translated">åœ¨ Visual Studio ä¸­æŒ‰ F5ã€‚è®­ç»ƒè¿‡ç¨‹å°†å¼€å§‹ï¼Œå¹¶ä¼šèŠ±è´¹æˆ–å¤šæˆ–å°‘çš„æ—¶é—´ï¼Œè¿™å–å†³äºæ‚¨è®­ç»ƒçš„å›¾åƒæ•°é‡ã€‚</li><li id="5b7e" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ms lt lu lv bi translated">è®­ç»ƒè¿‡ç¨‹å®Œæˆåï¼Œä¸ºäº†ä½¿ç”¨æ–°çš„è®­ç»ƒæ¨¡å‹æ›´æ–°æ¶ˆè´¹åº”ç”¨ç¨‹åºï¼Œæ‚¨å¿…é¡»å¤åˆ¶/ç²˜è´´ç”Ÿæˆçš„ ML.NET æ¨¡å‹æ–‡ä»¶(assets/inputs/image classifier . zip)å¹¶å°†å…¶ç²˜è´´åˆ°æ¶ˆè´¹åº”ç”¨ç¨‹åºé¡¹ç›®(assets/inputs/MLNETModel)ä¸­ï¼Œè¯¥é¡¹ç›®æ¨¡æ‹Ÿä»…è¿è¡Œæ¨¡å‹è¿›è¡Œé¢„æµ‹çš„æœ€ç»ˆç”¨æˆ·åº”ç”¨ç¨‹åºã€‚</li></ol><h1 id="5d2a" class="kl kf hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">4.æ¨¡å‹æ¶ˆè€—ä»£ç </h1><p id="382c" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">é¦–å…ˆï¼Œæ‚¨éœ€è¦åŠ è½½åœ¨æ¨¡å‹è®­ç»ƒæœŸé—´åˆ›å»ºçš„æ¨¡å‹</p><pre class="jf jg jh ji fd jz ka kb kc aw kd bi"><span id="5083" class="ke kf hi ka b fi kg kh l ki kj">ITransformer loadedModel = mlContext.Model.Load(modelLocation,out var modelInputSchema);</span></pre><p id="ab08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç„¶åï¼Œåˆ›å»ºä¸€ä¸ªé¢„æµ‹å™¨å¼•æ“ï¼Œå¹¶è¿›è¡Œç¤ºä¾‹é¢„æµ‹:</p><pre class="jf jg jh ji fd jz ka kb kc aw kd bi"><span id="75a1" class="ke kf hi ka b fi kg kh l ki kj">var predictionEngine = mlContext.Model.CreatePredictionEngine&lt;ImageData, ImagePrediction&gt;(loadedModel);</span><span id="e4be" class="ke kf hi ka b fi kk kh l ki kj">IEnumerable&lt;ImageData&gt; imagesToPredict = LoadImagesFromDirectory(imagesFolder, true);</span><span id="1bae" class="ke kf hi ka b fi kk kh l ki kj">//Predict the first image in the folder<br/>//<br/>ImageData imageToPredict = new ImageData<br/>{<br/>    ImagePath = imagesToPredict.First().ImagePath<br/>};</span><span id="b6ba" class="ke kf hi ka b fi kk kh l ki kj">var prediction = predictionEngine.Predict(imageToPredict);</span><span id="9d4f" class="ke kf hi ka b fi kk kh l ki kj">Console.WriteLine("");<br/>Console.WriteLine($"ImageFile : [{Path.GetFileName(imageToPredict.ImagePath)}], " +<br/>                    $"Scores : [{string.Join(",", prediction.Score)}], " +<br/>                    $"Predicted Label : {prediction.PredictedLabelValue}");</span></pre><p id="e59e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">é¢„æµ‹å¼•æ“æ¥æ”¶ç±»å‹ä¸º<code class="du mc md me ka b">ImageData</code>çš„å¯¹è±¡ä½œä¸ºå‚æ•°(åŒ…å«ä¸¤ä¸ªå±æ€§:<code class="du mc md me ka b">ImagePath</code>å’Œ<code class="du mc md me ka b">Label</code>)ã€‚ç„¶åè¿”å›ä¸€ä¸ªç±»å‹ä¸º<code class="du mc md me ka b">ImagePrediction</code>çš„å¯¹è±¡ï¼Œå®ƒä¿å­˜äº†<code class="du mc md me ka b">PredictedLabel</code>å’Œ<code class="du mc md me ka b">Score</code> ( <em class="mb">æ¦‚ç‡</em>å€¼åœ¨ 0 å’Œ 1 ä¹‹é—´)å±æ€§ã€‚</p><p id="8992" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è®©æˆ‘ä»¬è¿è¡Œåº”ç”¨ç¨‹åºå¹¶æ£€æŸ¥æˆ‘ä»¬çš„æ¨¡å‹æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œå¯¹äºè¿™æ¬¡æ‰§è¡Œï¼Œæˆ‘ä¸ä¼šé‡æ–°æ ¼å¼åŒ–æµ‹è¯•å›¾åƒï¼Œå°†å®ƒä»¬æŒ‰å…¶åŸå§‹å½¢çŠ¶æ¨é€åˆ°è®­ç»ƒç®¡é“ï¼Œä¹‹åæˆ‘å°†é‡æ–°å¼€å§‹æ‰§è¡Œã€‚</p><p id="8347" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™ä¸¤ç§ç»“æœéƒ½å‡ºç°åœ¨ä¸‹é¢çš„å›¾ç‰‡ä¸­ï¼›</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mt"><img src="../Images/478e659a8724bd8c14c522cfa6ad9879.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z2SfowViaHzDrWhFs-mIPA.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">ç»“æœ:1 ä¸ªæ­£ç¡®ï¼Œ3 ä¸ªé”™è¯¯</figcaption></figure><p id="04c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ­£å¦‚ä½ åœ¨ä¸Šé¢çœ‹åˆ°çš„ï¼Œè¿™å¹¶ä¸åƒé¢„æœŸçš„é‚£æ ·å¥½ï¼Œæˆ‘å’Œå®å®è¿˜å¥½ï¼Œä½†å¸•å…‹å…ˆç”Ÿåœ¨è¿™é‡Œæ„Ÿè§‰ä¸åˆ°å¹³é™(èœ˜è››ä¾ ç”µå½±ä¸­çš„åœºæ™¯ï¼Œå½“ä»–çš„çˆ¶äº²å‘ç”Ÿè½¦ç¥¸ï¼Œæ­»åœ¨ä»–é¢å‰ï¼Œæ˜¯çš„ï¼Œåº”è¯¥æ˜¯æ‚²ä¼¤çš„ï¼ğŸ¤¬)</p><p id="be3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ›´ç³Ÿç³•çš„æ˜¯ï¼Œæˆ‘ä»¬çš„ç½‘ç»œè®¤ä¸ºæ‹œç™»åœ¨è¿™é‡Œæ„Ÿåˆ°æ‚²ä¼¤â€¦æˆ‘è®¤ä¸ºè¿™ä¸åº”è¯¥æ˜¯ä½ èµ¢å¾—é€‰ä¸¾å¹¶æˆä¸ºç¾å›½æ€»ç»Ÿæ—¶çš„æ„Ÿå—ã€‚</p><blockquote class="mu mv mw"><p id="76b1" class="if ig mb ih b ii ij ik il im in io ip mx ir is it my iv iw ix mz iz ja jb jc hb bi translated">æ‰€ä»¥å¾ˆæ˜æ˜¾æˆ‘ä»¬çš„æ¨¡å‹æœ‰é—®é¢˜ï¼Œæˆ‘åœ¨äº’è”ç½‘ä¸Šæœç´¢äººå·¥ç¥ç»ç½‘ç»œçš„åŸç†å’Œå»ºç«‹è®­ç»ƒæ¨¡å‹çš„æœ€ä½³å®è·µï¼Œæœ€ç»ˆå¾—å‡ºäº†æ ‡å‡†åŒ–æ‰€æœ‰å›¾åƒçš„æƒ³æ³•ã€‚æˆ‘å·²ç»åœ¨ä¸Šé¢æåˆ°äº†å®ƒæ˜¯å¦‚ä½•åšåˆ°çš„ï¼Œåœ¨æ–‡ç« çš„æœ€åè¿˜æœ‰ä¸€ä¸ªé“¾æ¥å¯ä»¥ä¸‹è½½å®Œæ•´çš„æºä»£ç </p></blockquote><p id="1bcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è®©æˆ‘ä»¬é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œè¿™ä¸€æ¬¡å›¾åƒå°†åœ¨é¢„æµ‹ä¹‹å‰ç»è¿‡è°ƒæ•´å¤§å°å’Œç°åº¦çš„å¤„ç†</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es na"><img src="../Images/569af45f3b60b2b700e6bb78f93f4b26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a82CJ78OR2LrvwQlXeDJ6w.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">ç»“æœ:3 ä¸ªæ­£ç¡®ï¼Œ1 ä¸ªé”™è¯¯</figcaption></figure><p id="1c4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œ<a class="ae jd" href="https://www.ijsr.net/archive/v6i3/25031706.pdf" rel="noopener ugc nofollow" target="_blank">å›¾åƒé™å™ª</a>å¦‚ä½•æé«˜å‡†ç¡®æ€§å’Œé¢„æµ‹ä»¥åŠæ€§èƒ½(å®ƒçš„è¿è¡Œé€Ÿåº¦å‡ ä¹å¿«äº† 4 å€ï¼)çš„é‡è¦æ€§ã€‚</p><p id="e363" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä¸æƒ³å†çœ‹åˆ°è¿™ç¯‡æ–‡ç« äº†ï¼Œæˆ‘ä»¬æ­£å¤„åœ¨ä¸€ä¸ªç»“æŸçš„å¥½æ—¶æœºã€‚<br/>æ‚¨å¯ä»¥ä¸‹è½½å®Œæ•´çš„<a class="ae jd" href="https://github.com/y3n3rrr/EmotionAnalysisWithMLNET" rel="noopener ugc nofollow" target="_blank">æºä»£ç </a>å¹¶å°è¯•ä½¿ç”¨æ‚¨è‡ªå·±çš„å®šåˆ¶å›¾åƒï¼Œå®ƒå‡ ä¹å¯ä»¥å‘å¸ƒç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œä½†å¦‚æœæ‚¨å¸Œæœ›æ›´å‡†ç¡®åœ°è¿›è¡Œæ›´å¥½çš„é¢„æµ‹ï¼Œæˆ‘å¼ºçƒˆå»ºè®®æ‚¨ä½¿ç”¨è®­ç»ƒæœ‰ç´ çš„æ¨¡å‹</p><p id="07dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™æ˜¯æˆ‘æ­£åœ¨æ€è€ƒçš„é—®é¢˜ï¼Œæˆ‘æƒ³ç”¨æˆ‘æœ€è¿‘æ‰¾åˆ°çš„è®­ç»ƒé›†å†™ä¸€ç¯‡æ–°æ–‡ç« ã€‚æ¥è‡ª Kaggle çš„è¿™ä¸ªæ ·æœ¬åŒ…å«æ•°ä»¥åƒè®¡çš„å›¾åƒï¼Œå¯ä»¥ç”¨æ¥è®­ç»ƒç¥ç»ç½‘ç»œã€‚è¿™ç¯‡ä¸é”™çš„<a class="ae jd" rel="noopener" href="/@jsflo.dev/training-a-tensorflow-model-to-recognize-emotions-a20c3bcd6468">æ–‡ç« </a>ä¹Ÿæ¶µç›–äº†å®ƒã€‚æ‚¨å¯ä»¥è·Ÿè¿›åŸºäº python çš„å·¥ä½œï¼Œæˆ–è€…ç­‰æˆ‘æ¥å¤„ç†ï¼Œåœ¨å†…éƒ¨é‡æ–°åˆ›å»ºå®ƒã€‚Net æ ¸å¿ƒçš„æ–¹æ³•ã€‚ç½‘</p><p id="676a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å½“ç„¶ï¼Œæˆ‘å¯¹ä½ çš„æƒ³æ³•æŒå¼€æ”¾æ€åº¦ï¼Œæˆ‘å¾ˆä¹æ„çŸ¥é“ä½ å¸Œæœ›æˆ‘ä¸ºä¸€ç¯‡æ–°æ–‡ç« é€‰æ‹©ä»€ä¹ˆä¸»é¢˜ï¼Œåªè¦å®ƒæ˜¯ä¸€ä¸ªæ¸¸ä¹åœºã€‚ç½‘ç»œæ ¸å¿ƒå’Œååº”âš›ï¸.ä½ å¯ä»¥åœ¨ä¸‹é¢çš„ç‰ˆå—å‘è¡¨è¯„è®ºï¼Œæˆ–è€…åœ¨<a class="ae jd" href="https://www.linkedin.com/in/mehmet-yener-yilmaz-833a07101/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>æˆ–<a class="ae jd" href="https://twitter.com/myeneryilmaz" rel="noopener ugc nofollow" target="_blank"> Twitter </a>ä¸Šå‘é€æ¶ˆæ¯</p><p id="7115" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœªå®Œå¾…ç»­â€¦</p><p id="59d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å›è§ï¼Œ<br/>ç©†ç½•é»˜å¾·Â·è€¶çº³å°”Â·è€¶å°”é©¬å…¹</p></div></div>    
</body>
</html>