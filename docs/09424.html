<html>
<head>
<title>Spark Parallel Job Execution</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Sparkå¹¶è¡Œä½œä¸šæ‰§è¡Œ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/analytics-vidhya/spark-parallel-job-submission-38b41220397b?source=collection_archive---------0-----------------------#2020-09-06">https://medium.com/analytics-vidhya/spark-parallel-job-submission-38b41220397b?source=collection_archive---------0-----------------------#2020-09-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8dd7c094cf6a4df5e5387e8807183b66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cVZgaMA_9uL2IVPR6zKYqw.jpeg"/></div></div></figure><p id="c251" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Sparkä»¥åˆ†è§£å¤§ä»»åŠ¡å’Œå¹¶è¡Œè¿è¡Œå•ä¸ªä»»åŠ¡è€Œé—»åã€‚ä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ„å‘³ç€å®ƒå¯ä»¥å¹¶è¡Œè¿è¡Œä¸¤ä¸ªç‹¬ç«‹çš„ä½œä¸šã€‚æœ¬æ–‡å°†å¸®åŠ©æ‚¨æœ€å¤§é™åº¦åœ°æé«˜Sparkçš„å¹¶è¡Œæ€§ã€‚</p><h2 id="1ade" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">å¼‚æ­¥ç¼–ç¨‹</h2><p id="008d" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">è¿™æ˜¯ä¸€ç§å¹¶è¡Œç¼–ç¨‹ï¼Œå…è®¸ä¸€ä¸ªå·¥ä½œå•å…ƒç‹¬ç«‹äºä¸»åº”ç”¨ç¨‹åºçº¿ç¨‹è¿è¡Œã€‚å½“å·¥ä½œå®Œæˆæ—¶ï¼Œå®ƒé€šçŸ¥ä¸»çº¿ç¨‹å·¥ä½œçº¿ç¨‹çš„å®Œæˆæˆ–å¤±è´¥ã€‚åœ¨Scalaä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨<em class="ko"> Future </em>æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p><h2 id="b9aa" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">ScalaæœŸè´§</h2><p id="9535" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">æœŸè´§æ˜¯Scalaä¸­æ‰§è¡Œå¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§æ–¹å¼ã€‚ä¸€ä¸ª<em class="ko"> Future </em>ä¸ºæ‚¨æä¾›äº†ä¸€ç§åœ¨sparkåº”ç”¨ç¨‹åºä¸­å¹¶å‘è¿è¡Œä½œä¸šçš„ç®€å•æ–¹æ³•ã€‚</p><p id="3510" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬ç¼–å†™Sparkä»£ç çš„é€šå¸¸æ–¹å¼ï¼Œç„¶åçœ‹çœ‹<em class="ko">æœªæ¥</em>èƒ½å¦‚ä½•å¸®åŠ©æˆ‘ä»¬ã€‚</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="32da" class="jo jp hi ku b fi ky kz l la lb"><em class="ko">val </em>employee = spark.read.parquet("s3://****/employee")<br/><em class="ko">val </em>salary = spark.read.parquet("s3://****/salary")<br/><em class="ko">val </em>ratings = spark.read.parquet("s3://****/ratings")<br/><br/><em class="ko">println</em>("Joining employee with salary")<br/>employee.join(salary, Seq("employee_id"))<br/>  .exportToS3AndJSON("s3://****/employee_salary")<br/><br/><em class="ko">println</em>("Joining employee with ratings")<br/>employee.join(ratings, Seq("employee_id"))<br/>  .exportToS3AndJSON("s3://****/employee_ratings")</span></pre><p id="a28d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬è¯»å–äº†3ä¸ªæ•°æ®é›†â€”â€”å‘˜å·¥ã€å·¥èµ„å’Œè¯„çº§ã€‚</p><ul class=""><li id="3309" class="lc ld hi is b it iu ix iy jb le jf lf jj lg jn lh li lj lk bi translated">åœ¨ç¬¬ä¸€ä¸ªè¯­å¥ä¸­ï¼Œæˆ‘ä»¬åŸºäºEmployee_IDè¿æ¥Employeeå’ŒSalaryè¡¨ï¼Œå¹¶å°†ç»“æœä¿å­˜ä¸ºparquetå’ŒJSONæ ¼å¼ã€‚</li><li id="cac9" class="lc ld hi is b it ll ix lm jb ln jf lo jj lp jn lh li lj lk bi translated">åœ¨ç¬¬äºŒä¸ªè¯­å¥ä¸­ï¼Œæˆ‘ä»¬åŸºäºEmployee_IDè¿æ¥Employeeå’ŒRatingsè¡¨ï¼Œå¹¶å†æ¬¡ä»¥parquetå’ŒJSONæ ¼å¼ä¿å­˜ç»“æœã€‚</li></ul><p id="2b48" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªè¯­å¥æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œä½†æ˜¯Sparkä¼šæŒ‰é¡ºåºè¿è¡Œå®ƒã€‚å¦‚æœä½ çœ‹ä¸€ä¸‹Spark UIçš„å›¾ç‰‡ï¼Œä½ ä¼šå¯¹æ­¤æœ‰ä¸€ä¸ªæ›´å¥½çš„äº†è§£ã€‚</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/5728feddf07de60613c71b4874d31ea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fBh5o_bziFOktAga1CRx0g.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">Spark UI</figcaption></figure><p id="ba05" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ä½œä¸šID 0 â€”é¦–å…ˆå¯åŠ¨å¹¶è¿è¡Œ5.5åˆ†é’Ÿï¼Œç¬¬ä¸€ä¸ªä½œä¸šå®Œæˆåï¼Œå°†å¼€å§‹ç¬¬äºŒä¸ªä½œä¸šï¼Œä¾æ­¤ç±»æ¨ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥çœ‹äº‹ä»¶æ—¶é—´è¡¨æ¥æ¨æ–­å‡ºåŒæ ·çš„ç»“è®ºã€‚æ‰€æœ‰ä½œä¸šéƒ½ä¸ä¼šé‡å ï¼Œæ¯ä¸ªä½œä¸šéƒ½æ˜¯åœ¨å‰ä¸€ä¸ªä½œä¸šå®Œæˆåæ‹¾å–çš„ã€‚</p><p id="a6e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">å¦‚æœä½œä¸š0åˆ©ç”¨äº†50%çš„ç¾¤é›†ï¼Œåˆ™å‰©ä½™çš„50%å°†æœªè¢«åˆ©ç”¨ã€‚</p></div><div class="ab cl lv lw gp lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="hb hc hd he hf"><p id="2acb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">è®©æˆ‘ä»¬äº†è§£å¦‚ä½•é€šè¿‡ä½¿ç”¨scala futuresæ¥æé«˜åˆ©ç”¨ç‡ã€‚ä¸‹é¢æ˜¯åŒæ ·çš„ä»£ç ï¼Œä½†æ˜¯åŠ å…¥äº†æœªæ¥çš„ã€‚</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="5765" class="jo jp hi ku b fi ky kz l la lb"><em class="ko">import </em>java.util.concurrent.Executors<br/><em class="ko">import </em>scala.concurrent.duration.Duration<br/><em class="ko">import </em>scala.concurrent.{Await, ExecutionContext, Future}</span><span id="5484" class="jo jp hi ku b fi mc kz l la lb"><em class="ko">//Allowing a maximum of 2 threads to run<br/>val </em>executorService = Executors.<em class="ko">newFixedThreadPool</em>(2)<br/><em class="ko">implicit val </em>executionContext = ExecutionContext.<em class="ko">fromExecutorService</em>(executorService)</span><span id="4975" class="jo jp hi ku b fi mc kz l la lb"><em class="ko">val </em>employee = spark.read.parquet("s3://****/employee")<br/><em class="ko">val </em>salary = spark.read.parquet("s3://****/salary")<br/><em class="ko">val </em>ratings = spark.read.parquet("s3://****/ratings")</span><span id="0d87" class="jo jp hi ku b fi mc kz l la lb"><em class="ko">val futureA = Future {<br/>   println</em>("Joining employee with salary")<br/>   employee.join(salary, Seq("employee_id"))<br/>     .exportToS3AndJSON("s3://****/employee_salary")<br/>   <em class="ko">println</em>("Future A Complete")<br/>   }</span><span id="dbce" class="jo jp hi ku b fi mc kz l la lb">val futureB = Future {<br/>   <em class="ko">println</em>("Joining employee with ratings")<br/>   employee.join(ratings, Seq("employee_id"))<br/>     .exportToS3AndJSON("s3://****/employee_ratings")<br/>   <em class="ko">println</em>("Future B Complete")<br/>   }</span><span id="9297" class="jo jp hi ku b fi mc kz l la lb">Await.result(futureA, Duration.inf)<br/>Await.result(futureB, Duration.inf)</span></pre><p id="f93d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">è¿™äº›å˜åŒ–åŒ…æ‹¬</p><ul class=""><li id="78b4" class="lc ld hi is b it iu ix iy jb le jf lf jj lg jn lh li lj lk bi translated">å¯¼å…¥ExecutionContextä»¥è®¿é—®çº¿ç¨‹æ± ã€‚</li><li id="f92f" class="lc ld hi is b it ll ix lm jb ln jf lo jj lp jn lh li lj lk bi translated">å®šä¹‰è¦è¿è¡Œçš„çº¿ç¨‹æ•°é‡ã€‚</li><li id="3d4d" class="lc ld hi is b it ll ix lm jb ln jf lo jj lp jn lh li lj lk bi translated">å°†è½¬æ¢åŒ…å«åœ¨æœªæ¥çš„æ„é€ ä¸­ã€‚</li><li id="45e7" class="lc ld hi is b it ll ix lm jb ln jf lo jj lp jn lh li lj lk bi translated">Await.resultæ–¹æ³•è°ƒç”¨å£°æ˜å®ƒå°†ç­‰å¾…æœªæ¥æ‰§è¡Œã€‚</li></ul><p id="6daa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">è®©æˆ‘ä»¬é€šè¿‡æŸ¥çœ‹Spark UIæ¥äº†è§£ä¸€ä¸‹è¿™é¡¹å·¥ä½œç°åœ¨æ˜¯å¦‚ä½•æ‰§è¡Œçš„ã€‚</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/33716f179e3639310b1734b5b205f6bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wJ_GhaiPiEQ05q4L7afzrw.png"/></div></div></figure><p id="6836" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä½œä¸š0å’Œ1å‡ ä¹åŒæ—¶å¼€å§‹ã€‚æ‚¨è¿˜å¯ä»¥ä»äº‹ä»¶æ—¶é—´çº¿ä¸­çœ‹åˆ°ï¼Œè¿™ä¸¤ä¸ªä½œä¸šæ­£åœ¨å¹¶è¡Œè¿è¡Œã€‚</p></div><div class="ab cl lv lw gp lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="hb hc hd he hf"><p id="cacb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·ç‚¹å‡»ğŸ‘æ‰€ä»¥å…¶ä»–äººä¼šåœ¨åª’ä½“ä¸Šçœ‹åˆ°å®ƒã€‚</p></div></div>    
</body>
</html>