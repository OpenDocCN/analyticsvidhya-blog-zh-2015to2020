<html>
<head>
<title>SAKK: An Open-Source Tool to Deploy EKS clusters with Kubeflow at Scale</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SAKK:一个使用 Kubeflow 大规模部署 EKS 集群的开源工具</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploy-amazon-eks-clusters-with-kubeflow-at-scale-with-swiss-army-kube-27f8a47861e9?source=collection_archive---------11-----------------------#2020-12-22">https://medium.com/analytics-vidhya/deploy-amazon-eks-clusters-with-kubeflow-at-scale-with-swiss-army-kube-27f8a47861e9?source=collection_archive---------11-----------------------#2020-12-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d78f7deb576807bf6e3405e23601449f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OAU43NNRiwPZVCocQrT4CQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">使用 Terraform <em class="iu">和 SAKK blueprint 在 EKS 内部部署了 Kubeflow 和 Argo CD 的声明式管理的 GitOps 集群示意图。图片作者。</em></figcaption></figure><h2 id="c561" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">介绍</h2><p id="64da" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">在过去的几年中，ML 的采用在众多行业中持续稳定的增长。随着生产 ML 项目数量的增长，在云中运行 ML 的采用也在增长。公司为其 AI/ML 堆栈选择的最著名的 ML 工具包之一 Kubeflow 正在被知名科技巨头越来越多地采用和贡献。</p><p id="446e" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">最初于 2017 年 12 月开源，Kubeflow 在最近 2 年获得了显著的发展势头。亚马逊是主要的云平台之一，它提供亚马逊 EKS(弹性 Kubernetes 服务)作为一种灵活的方式，在 AWS 中运行和扩展 Kubernetes 上的应用程序。亚马逊 EKS 在 2018 年开始普遍可用，现在是 Kubernetes 的领先环境之一，经常用于运行 Kubeflow。</p><p id="f5f8" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">然而，尽管有如此强大的工具可用，对于许多企业 ML 团队来说，在 EKS 上快速有效地启动和运行生产 Kubeflow 集群仍然是一个挑战，因为缺乏实现这一目标的明确路径。在<a class="ae kt" href="https://provectus.com/" rel="noopener ugc nofollow" target="_blank"> Provectus </a>，我们基于自己的最佳实践和通过我们的 ML 团队获得的知识，构建了一个简单的开源工具，我们希望与大家分享。</p><h2 id="6d76" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">为什么要大规模部署带有 Kubeflow 的亚马逊 EKS？</h2><p id="a9eb" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">许多从事 ML/AI 项目的公司(无论是客户还是内部)经常不得不部署多个类似的 Kubeflow 集群，然后随着他们的训练和推理工作量的增长，管理和增加新的资源。当几个团队在一个项目上工作时，出于效率和安全性的原因，他们可能还需要隔离访问 Kubeflow 管道。</p><p id="5002" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">虽然在一个 Kubeflow 实例中可以有几个管道，但是目前在 Kubeflow 中没有办法向在一个 Kubeflow 集群上工作的团队授予隔离的安全访问权限。此外，每个 Kubeflow 实例都需要一个单独的亚马逊 EKS 集群。设置和部署 Kubeflow EKS 集群的现有方法需要使用 Kubeflow 和 Kubernetes 的几个本机工具，这些工具不允许您在以后向已部署的集群添加非本机资源。</p><p id="5a3d" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">例如，如果您的公司从事许多 ML/AI 项目，它至少需要几个带有 Kubeflow 实例的集群(开发、测试、生产环境、客户平台等)。)对于每个项目，并且通常对于每个项目团队。所有这些部署都需要您安装几个 CLI 工具，分别配置它们以描述您想要部署的所有 Kubernetes 和 Kubeflow 资源，并对您的每个集群重复这个过程。</p><p id="ba13" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">这意味着你可能必须分配高素质的工程师来处理 ML 基础设施的部署和维护。他们将手动或通过编写大量 bash 脚本来设置多个集群配置。这同样适用于进一步的集群支持和升级。</p><h2 id="1c55" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">什么是瑞士陆军 Kube 为 Kubeflow</h2><p id="d772" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">瑞士陆军 Kube for Kubeflow 通过提供基于最佳 DevOps 实践的简单蓝图，弥合了这一差距。它使您不必再分别部署和管理 Kubeflow、亚马逊 EKS 和其他资源，您可能需要将这些资源带到您的集群中，以实现您想要的 ML 工作流。</p><p id="531a" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">SAKK 存储库的<a class="ae kt" href="https://github.com/provectus/sak-kubeflow/tree/init/examples/simple" rel="noopener ugc nofollow" target="_blank">示例文件夹扮演一个现成的项目模板的角色。你所需要做的就是在每次你想用 Kubeflow 部署亚马逊 EKS 的时候检查分支并设置它。ML 团队可以通过在存储库根目录下的单个</a><a class="ae kt" href="https://github.com/provectus/sak-kubeflow/blob/init/main.tf" rel="noopener ugc nofollow" target="_blank"> main.tf 文件</a>中设置变量来配置集群，并使用几个 Terraform 命令进行部署。使用 Terraform 作为单一入口点，您可以在几分钟内多次重复这个简单的过程，以建立和运行多个 ML 集群。</p><figure class="kv kw kx ky fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ku"><img src="../Images/b8d285f940c83f850ebd63517f224477.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RM9l7UAGNLy2W5KGL9U5zA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">亚马逊 EKS 集群，带有 Kubeflow 和 Argo CD，这是您使用 SAKK 通过 Terraform 配置和部署 ML 基础架构的结果。<em class="iu">作者图片。</em></figcaption></figure><p id="b942" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">部署后，可以使用 Argo CD CLI 或 UI 管理集群。它们的状态通过有组织的 CI/CD 管道存储在 GitHub 存储库中。这种方法不仅允许用户享受 Kubernetes 和亚马逊 EKS 的所有可移植性和标准化优势，还可以向集群添加资源，超越本地 Kubeflow、Kubernetes 或亚马逊 EKS CLI 工具的限制，而无需编写自定义代码。</p><p id="633b" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">使用 SAKK 进行集群配置和部署不需要丰富的 DevOps 工具知识，因此，它可以帮助节省 DevOps 工程师的时间来完成更重要的任务。它提供了一个机会，可以大大减少与 ML 基础设施的部署和维护以及管理人员的培训相关的时间、资源和成本。一些主要亮点是:</p><p id="497c" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">使用 Argo CD 的集群自动化</strong></p><p id="0c0b" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">SAKK 使用 Argo CD 来自动化应用程序状态，并提供 GitOps 方法。你的集群的状态将被存储在一个 GitHub 存储库和 S3 桶中，描述为代码。</p><p id="60d4" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">地形的优势</strong></p><p id="c6f2" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">Terraform 用于通过 IaC 统一和标准化云基础设施部署，IaC 是一个首选标准，目前是 ML DevOps (MLOps)的最佳实践之一。目前，Terraform 是这一领域的领先软件。Terraform 配置的 HCL (HashiCorp 配置语言)语法易于学习，是处理集群的随机脚本的更好替代方案。此外，Terraform 有很好的文档和充满活力的社区。</p><p id="093c" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">Amazon Cognito 的内置身份管理</strong></p><p id="596c" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">对于 AWS 上的身份管理，SAKK 使用 Cognito 用户池。在下面的快速入门中，Cognito 用于创建一个安全的环境，在一个地方管理所有访问权限。但是，SAKK 不会锁定您的供应商，因为它可以使用任何其他身份提供者。</p><h1 id="8d21" class="kz iw hi bd ix la lb lc jb ld le lf jf lg lh li jj lj lk ll jn lm ln lo jr lp bi translated">快速入门:使用 Kubeflow 部署 EKS 集群</h1><figure class="kv kw kx ky fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/799e5ac938d5a57005fe51fc3e325ba6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q0st5cPI73qZ87Ayg2yjdA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><em class="iu">图片作者。</em></figcaption></figure><p id="ddfb" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">使用瑞士陆军 Kube 在 EKS 部署 Kubeflow 非常简单。除了先决条件之外，还需要几个步骤:</p><ul class=""><li id="ade3" class="lr ls hi jv b jw ko ka kp jg lt jk lu jo lv kn lw lx ly lz bi translated">配置您的集群部署(在一个文件中设置大约 5 个变量)</li><li id="e1ec" class="lr ls hi jv b jw ma ka mb jg mc jk md jo me kn lw lx ly lz bi translated">使用两个 Terraform 命令(init 和 apply)部署集群</li></ul><p id="e5a6" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">之后，您将获得一个可供访问和进一步管理的集群。</p><h2 id="121e" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">先决条件</h2><ol class=""><li id="4ad0" class="lr ls hi jv b jw jx ka kb jg mf jk mg jo mh kn mi lx ly lz bi translated">对于这个简短的教程，您需要有一个安装了 IAM 用户和 AWS CLI 的 AWS 帐户。如果您还没有，请使用 AWS 的这些官方指南:</li></ol><ul class=""><li id="a6eb" class="lr ls hi jv b jw ko ka kp jg lt jk lu jo lv kn lw lx ly lz bi translated"><a class="ae kt" href="https://docs.aws.amazon.com/polly/latest/dg/setting-up.html" rel="noopener ugc nofollow" target="_blank">建立 AWS 账户并创建用户</a></li><li id="453c" class="lr ls hi jv b jw ma ka mb jg mc jk md jo me kn lw lx ly lz bi translated"><a class="ae kt" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html" rel="noopener ugc nofollow" target="_blank">安装、更新和卸载 AWS CLI </a></li></ul><p id="2ec4" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">2.接下来，使用官方指南安装 Terraform:</p><ul class=""><li id="891b" class="lr ls hi jv b jw ko ka kp jg lt jk lu jo lv kn lw lx ly lz bi translated"><a class="ae kt" href="https://learn.hashicorp.com/tutorials/terraform/install-cli" rel="noopener ugc nofollow" target="_blank">安装地形</a></li></ul><p id="a5d4" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">3.分叉和克隆瑞士陆军 Kube for Kubeflow 官方资源库:</p><ul class=""><li id="35b1" class="lr ls hi jv b jw ko ka kp jg lt jk lu jo lv kn lw lx ly lz bi translated"><a class="ae kt" href="https://github.com/provectus/sak-kubeflow/blob/init/custom.tf" rel="noopener ugc nofollow" target="_blank">瑞士陆军 Kube for Kubeflow on Github </a></li></ul><p id="8e8b" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">就是这样！现在让我们配置和部署亚马逊 EKS Kubeflow 集群。</p><h2 id="797e" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">1.配置群集部署</h2><p id="2812" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">您在一个单独的 Terraform 文件中设置了您的集群:<code class="du mj mk ml mm b">main.tf</code>。这里需要配置的最少内容如下:</p><ul class=""><li id="eac1" class="lr ls hi jv b jw ko ka kp jg lt jk lu jo lv kn lw lx ly lz bi translated"><code class="du mj mk ml mm b">cluster_name</code>(集群的名称)</li><li id="6677" class="lr ls hi jv b jw ma ka mb jg mc jk md jo me kn lw lx ly lz bi translated"><code class="du mj mk ml mm b">mainzoneid</code>(主干道 53 区 id)</li><li id="e6a4" class="lr ls hi jv b jw ma ka mb jg mc jk md jo me kn lw lx ly lz bi translated"><code class="du mj mk ml mm b">domains</code>(端点域名)</li><li id="6c7e" class="lr ls hi jv b jw ma ka mb jg mc jk md jo me kn lw lx ly lz bi translated"><code class="du mj mk ml mm b">admin_arns</code>(将拥有管理员权限的用户的 ARNs)</li><li id="a711" class="lr ls hi jv b jw ma ka mb jg mc jk md jo me kn lw lx ly lz bi translated"><code class="du mj mk ml mm b">cert_manager_email</code>(lets encrypt 通知邮件)</li><li id="d896" class="lr ls hi jv b jw ma ka mb jg mc jk md jo me kn lw lx ly lz bi translated"><code class="du mj mk ml mm b">cognito_users</code>(cogn ITO 池用户列表)</li></ul><p id="e247" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><code class="du mj mk ml mm b">main.tf</code>的配置示例:</p><pre class="kv kw kx ky fd mn mm mo mp aw mq bi"><span id="e23e" class="iv iw hi mm b fi mr ms l mt mu">terraform {<br/>  backend s3 {}<br/>}</span><span id="cd4c" class="iv iw hi mm b fi mv ms l mt mu">module "sak_kubeflow" {<br/>  source = "git::https://github.com/provectus/sak-kubeflow.git?ref=init"</span><span id="0978" class="iv iw hi mm b fi mv ms l mt mu">  cluster_name = "simple"</span><span id="dae5" class="iv iw hi mm b fi mv ms l mt mu">  owner      = "github-repo-owner"<br/>  repository = "github-repo-name"<br/>  branch     = "branch-name"</span><span id="cdab" class="iv iw hi mm b fi mv ms l mt mu">  #Main route53 zone id if exist (Change It)<br/>  mainzoneid = "id-of-route53-zone"</span><span id="b32f" class="iv iw hi mm b fi mv ms l mt mu">  # Name of domains aimed for endpoints<br/>  domains = ["sandbox.some.domain.local"]</span><span id="22aa" class="iv iw hi mm b fi mv ms l mt mu">  # ARNs of users who will have admin permissions.<br/>  admin_arns = [<br/>    {<br/>      userarn  = "arn:aws:iam::&lt;aws-account-id&gt;:user/&lt;username&gt;"<br/>      username = "&lt;username&gt;"<br/>      groups   = ["system:masters"]<br/>    }<br/>  ]</span><span id="4309" class="iv iw hi mm b fi mv ms l mt mu">  # Email that would be used for LetsEncrypt notifications<br/>  cert_manager_email = "info@some.domain.local"</span><span id="074c" class="iv iw hi mm b fi mv ms l mt mu">  # An optional list of users for Cognito Pool<br/>  cognito_users = [<br/>    {<br/>      email    = "qa@some.domain.local"<br/>      username = "qa"<br/>      group    = "masters"<br/>    },<br/>    {<br/>      email    = "developer@some.domain.local"<br/>      username = "developer"<br/>    }<br/>  ]</span><span id="4159" class="iv iw hi mm b fi mv ms l mt mu">  argo_path_prefix = "examples/simple/"<br/>  argo_apps_dir    = "argocd-applications"<br/>}</span></pre><p id="d8e4" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">在大多数情况下，您还需要在<code class="du mj mk ml mm b">main.tf</code>中覆盖与 GitHub 库相关的变量(<code class="du mj mk ml mm b">repository</code>、<code class="du mj mk ml mm b">branch</code>、<code class="du mj mk ml mm b">owner</code>)。</p><p id="1355" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">接下来，您可能想要配置存储地形状态的<code class="du mj mk ml mm b">backend.hcl</code>。<code class="du mj mk ml mm b">backend.hcl</code>的配置示例:</p><pre class="kv kw kx ky fd mn mm mo mp aw mq bi"><span id="2515" class="iv iw hi mm b fi mr ms l mt mu">bucket         = "bucket-with-terraform-states"<br/>key            = "some-key/kubeflow-sandbox"<br/>region         = "region-where-bucket-placed"<br/>dynamodb_table = "dynamodb-table-for-locks"</span></pre><h2 id="5848" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">2.部署您的 AWS EKS Kubeflow 集群</h2><p id="f9ce" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">使用以下 Terraform 命令部署刚刚配置的集群:</p><pre class="kv kw kx ky fd mn mm mo mp aw mq bi"><span id="6297" class="iv iw hi mm b fi mr ms l mt mu">terraform init<br/>terraform apply<br/>aws --region &lt;region&gt; eks update-kubeconfig --name &lt;cluster-name&gt;</span></pre><p id="f374" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">这些命令允许您:</p><ul class=""><li id="a5fd" class="lr ls hi jv b jw ko ka kp jg lt jk lu jo lv kn lw lx ly lz bi translated">初始化 Terraform 并下载所有远程依赖项</li><li id="cba5" class="lr ls hi jv b jw ma ka mb jg mc jk md jo me kn lw lx ly lz bi translated">使用所有必需的 AWS 资源(IAM 角色、ASG、S3 存储桶等)创建一个干净的 EKS 集群。)</li><li id="b118" class="lr ls hi jv b jw ma ka mb jg mc jk md jo me kn lw lx ly lz bi translated">更新您的本地<code class="du mj mk ml mm b">kubeconfig</code>文件，以便在已配置的上下文中访问您新创建的 EKS 集群</li></ul><p id="64e8" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">这些 Terraform 命令将在存储库的默认<code class="du mj mk ml mm b">apps</code>文件夹中生成一些文件。在开始将服务部署到您的 EKS Kubernetes 集群之前，您需要在 Git 中提交它们，并将它们推送到您的 Github 存储库:</p><p id="a884" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">请注意，Argo CD 是预先配置的，用于跟踪当前存储库的变化。当对其<code class="du mj mk ml mm b">apps</code>文件夹进行新的更改时，它们会触发同步过程，并且放置在该文件夹中的所有对象都会被创建。</p><p id="4e70" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">之后，您可以使用 Argo CD CLI/UI 或<code class="du mj mk ml mm b">kubectl</code>来管理您的 Kubernetes 集群。要开始使用<code class="du mj mk ml mm b">kubectl</code>(用于集群管理的 Kubernetes CLI)，请按照本官方指南进行安装和配置:</p><ul class=""><li id="b17b" class="lr ls hi jv b jw ko ka kp jg lt jk lu jo lv kn lw lx ly lz bi translated"><a class="ae kt" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank">安装并设置 kubectl </a></li></ul><h2 id="25ea" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">3.访问和管理您的亚马逊 EKS Kubeflow 集群</h2><p id="a807" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">现在，您已经部署了集群并准备好工作。在部署过程中，根据您在<code class="du mj mk ml mm b">main.tf</code>文件中的<code class="du mj mk ml mm b">domains</code>变量设置创建了两个服务访问端点:</p><ul class=""><li id="2253" class="lr ls hi jv b jw ko ka kp jg lt jk lu jo lv kn lw lx ly lz bi translated">阿尔戈 CD <code class="du mj mk ml mm b"><a class="ae kt" href="https://argocd.some.domain.local" rel="noopener ugc nofollow" target="_blank">https://argocd.some.domain.local</a></code></li><li id="4d3a" class="lr ls hi jv b jw ma ka mb jg mc jk md jo me kn lw lx ly lz bi translated">库伯流<code class="du mj mk ml mm b"><a class="ae kt" href="https://kubeflow.some.domain.local" rel="noopener ugc nofollow" target="_blank">https://kubeflow.some.domain.local</a></code></li></ul><p id="97a8" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">检查您在<code class="du mj mk ml mm b">domains</code>变量中提供的电子邮件以获取访问凭证，并使用它们登录。</p><p id="f249" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">要了解 Kubeflow 和 Argo CD 的更多信息，您可以查看它们各自的官方文档:</p><ul class=""><li id="6102" class="lr ls hi jv b jw ko ka kp jg lt jk lu jo lv kn lw lx ly lz bi translated"><a class="ae kt" href="https://www.kubeflow.org/docs/pipelines/pipelines-quickstart/" rel="noopener ugc nofollow" target="_blank">库伯弗洛</a></li><li id="4775" class="lr ls hi jv b jw ma ka mb jg mc jk md jo me kn lw lx ly lz bi translated"><a class="ae kt" href="https://argoproj.github.io/argo-cd/" rel="noopener ugc nofollow" target="_blank">阿尔戈 CD </a></li></ul><h1 id="f9bc" class="kz iw hi bd ix la lb lc jb ld le lf jf lg lh li jj lj lk ll jn lm ln lo jr lp bi translated">开始使用 Kubeflow 管道</h1><p id="41a3" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">一旦您通过<code class="du mj mk ml mm b">kubectl</code>成功登录亚马逊 EKS 集群，访问 Kubeflow UI 并通过所有配置屏幕，您将看到 Kubeflow 仪表盘:</p><figure class="kv kw kx ky fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mw"><img src="../Images/957b32d09a3b7f5fc01e98847067ad7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B6r16joBxE4TU2Thi0i54Q.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片作者。</figcaption></figure><p id="3ed4" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">在管道部分，Kubeflow 提供了一些示例，让您快速尝试管道。要了解更多关于在 AWS 上使用 Kubeflow 的信息，请查看<a class="ae kt" href="https://www.kubeflow.org/docs/aws/" rel="noopener ugc nofollow" target="_blank">官方 Kubeflow 文档</a>。</p><figure class="kv kw kx ky fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/b3929c28aa64cddb88c25c211d73ff02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V49T1sjqNqsrx2jCWIx2jA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片作者。</figcaption></figure><p id="9b6c" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">或者，您可以使用 AWS SageMaker 和 Kubeflow 上传自己的管道。例如，让我们上传一个带有内置 AWS SageMaker 算法的演示模块。</p><ol class=""><li id="ccb7" class="lr ls hi jv b jw ko ka kp jg lt jk lu jo lv kn mi lx ly lz bi translated">创建一个文件夹，用于管理单独的 Terraform 状态(包含与管道执行相关的资源)，并添加一个<code class="du mj mk ml mm b">main.tf</code>文件，代码如下:</li></ol><pre class="kv kw kx ky fd mn mm mo mp aw mq bi"><span id="a7c9" class="iv iw hi mm b fi mr ms l mt mu">module kmeans_mnist {<br/>  source = "path/to/kmeans-mnist-pipeline/folder/at/root/of/the/project"</span><span id="9643" class="iv iw hi mm b fi mv ms l mt mu">  cluster_name = "&lt;your-cluster-name&gt;"<br/>  username     = "&lt;your-kubeflow-username&gt;"<br/>}</span></pre><p id="3613" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">2.运行 Terraform:</p><pre class="kv kw kx ky fd mn mm mo mp aw mq bi"><span id="d6d3" class="iv iw hi mm b fi mr ms l mt mu">terraform init<br/>terraform apply</span></pre><p id="5729" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">Terraform 将生成一个<code class="du mj mk ml mm b">training_pipeline.yaml</code>文件，并创建一个与您的 Kubeflow 用户名相匹配的 Kubernetes 服务帐户，该帐户拥有 AWS 运行管道所需的所有权限。</p><p id="acf8" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">3.通过 Kubeflow UI 的管道部分将培训管道上传到 Kubflow:</p><figure class="kv kw kx ky fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/c43b10fe9eace855be5209fe510db39b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v1wGDAPousjfyP9Bh4lMRg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片作者。</figcaption></figure><p id="b596" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">4.现在您已经有了第一个 pipeline 和一个准备好的 Kubernetes 服务帐户，请在表单中指定它们以开始运行:</p><figure class="kv kw kx ky fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mz"><img src="../Images/c60dc0b017604016d618d6a805564063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SfFneB8b215pOh8ILo63iA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片作者。</figcaption></figure><p id="2496" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">就是这样！现在，您有一个在 Kubeflow 中执行的管道。</p><h2 id="0661" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">按照路线图前进</h2><p id="ac45" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">SAKK 会按照<a class="ae kt" href="https://github.com/provectus/sak-kubeflow/projects/1" rel="noopener ugc nofollow" target="_blank">路线图</a>继续进化。即将推出的计划包括通过 Terraform(在<code class="du mj mk ml mm b"><a class="ae kt" href="https://github.com/provectus/sak-kubeflow/blob/init/main.tf" rel="noopener ugc nofollow" target="_blank">main.tf</a></code>中)配置更多资源:</p><ul class=""><li id="d81c" class="lr ls hi jv b jw ko ka kp jg lt jk lu jo lv kn lw lx ly lz bi translated"><strong class="jv hj">进一步整合 AWS。</strong>更多的 AWS 功能将可以通过 Terraform 配置:RDS (Postgres)、elastic cache(Redis)、S3 (Minio)等。将搬出 Kubernetes，由 AWS 管理。</li><li id="b626" class="lr ls hi jv b jw ma ka mb jg mc jk md jo me kn lw lx ly lz bi translated"><strong class="jv hj">升级产品版本。</strong>通过 Terraform 设置产品版本(Argo CD、Kubeflow、Kubeflow Pipelines)将成为可能。</li><li id="68cc" class="lr ls hi jv b jw ma ka mb jg mc jk md jo me kn lw lx ly lz bi translated"><strong class="jv hj">为 Kubeflow 设置 AWS IAM 角色。</strong>设置 Kubeflow 用户的角色和权限以使其能够使用 AWS 将转移到 Terraform。用户将能够生成 Kubeflow 配置文件和资源，它们将存储在 GitHub 存储库中，并作为 GitOps 流程的一部分使用。</li><li id="20e7" class="lr ls hi jv b jw ma ka mb jg mc jk md jo me kn lw lx ly lz bi translated"><strong class="jv hj"> Kubeflow 管道管理。</strong>可以存储库伯流管道的状态。用户将能够从外部使用现成的管道部署 Kubeflow:从 GitHub 存储库预加载它们，上传默认的 AWS 管道。</li><li id="070e" class="lr ls hi jv b jw ma ka mb jg mc jk md jo me kn lw lx ly lz bi translated"><strong class="jv hj">与其他云平台的集成。</strong>目前，SAKK 仅适用于<a class="ae kt" href="https://aws.amazon.com/eks/" rel="noopener ugc nofollow" target="_blank">亚马逊 EKS </a>(弹性 Kubernetes 服务)，但长期计划是扩展到其他云平台。</li></ul><h1 id="78be" class="kz iw hi bd ix la lb lc jb ld le lf jf lg lh li jj lj lk ll jn lm ln lo jr lp bi translated">结论</h1><p id="2b1b" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">在这篇文章中，我们分享了我们用来为 ML 团队建立有效工作流的内部工具 SAKK，并展示了如何在部署后开始使用 Kubeflow。该工具基于我们的 ML 和 DevOps 工程师多年来总结的最佳 MLOps 实践。我们希望该产品能像对我们一样对您的 ML 团队有所帮助，并为您节省服务和管理生产 ML 工作负载的时间和精力。</p><p id="ea42" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">我们相信，任何使用 ML 的组织或工程师都应该能够专注于他们的 ML 应用程序和管道，而不必过于担心基础设施的部署。</p></div></div>    
</body>
</html>