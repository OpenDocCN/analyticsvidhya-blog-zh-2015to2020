<html>
<head>
<title>Python Based PDF Generator Lambda Function with S3 Event Trigger</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Python的具有S3事件触发器的PDF生成器Lambda函数</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/python-based-pdf-generator-lambda-function-with-s3-event-trigger-52faea791c80?source=collection_archive---------2-----------------------#2020-04-09">https://medium.com/analytics-vidhya/python-based-pdf-generator-lambda-function-with-s3-event-trigger-52faea791c80?source=collection_archive---------2-----------------------#2020-04-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/886f2a3483accdef8e43b4416634f549.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BV5wfhmaipRn-dwCwF1Iww.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">示意图</figcaption></figure><h1 id="d5ba" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">介绍</h1><p id="8727" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">S3非常适合存放物品。任何类型的对象，如图像、文档和二进制文件都可以存储在S3上。S3提供无限的存储空间，并以非常低的成本提供极其耐用、高度可用和无限可扩展的数据存储基础设施，尽管每个对象不需要超过5TB。这里是<a class="ae kq" href="https://aws.amazon.com/s3/faqs/" rel="noopener ugc nofollow" target="_blank"> S3常见问题解答</a>。</p><p id="1a70" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">通常，企业可能希望生成PDF格式的文件，并将其保存在S3存储桶中。本文提供了使用Lambda函数设置和创建此类服务的分步指南，并附有用python编写的示例代码。</p><h2 id="2b6c" class="kw iv hi bd iw kx ky kz ja la lb lc je kd ld le ji kh lf lg jm kl lh li jq lj bi translated">建筑说明</h2><p id="9938" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">名为<strong class="ju hj"> kene-test </strong>的S3桶将有两个前缀(文件夹),分别是<strong class="ju hj"> incoming </strong>和<strong class="ju hj"> incoming_PDF。</strong>顾名思义，<strong class="ju hj"> incoming </strong>将是我们推送S3对象的文件夹，而<strong class="ju hj"> incoming_PDF </strong>将作为我们保存<strong class="ju hj"> incoming </strong>文件夹中生成的PDF格式文件的文件夹。</p><p id="e9a0" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">Lambda函数将由“<strong class="ju hj">所有对象创建事件</strong>”S3事件触发。将文件转换为PDF后，它保存在Lambda <strong class="ju hj"> /tmp </strong>文件夹中，然后被推送到<strong class="ju hj"> incoming_PDF </strong>文件夹中。需要注意的是<strong class="ju hj"> /tmp </strong>是一个<strong class="ju hj"> 512MB </strong>目录存储路径，也是Lambda函数中唯一可写的路径。</p></div><div class="ab cl lk ll gp lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hb hc hd he hf"><h2 id="8986" class="kw iv hi bd iw kx ky kz ja la lb lc je kd ld le ji kh lf lg jm kl lh li jq lj bi translated">S3水桶</h2><p id="1458" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">转到<a class="ae kq" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank"> AWS控制台</a>并创建一个S3桶(在本例中为<strong class="ju hj"> kene-test </strong>),带有两个文件夹，如下所示。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/c9fb93bf5bf2508255af2e3e5e04a6c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oabyxsrn3yBbLtvSFOWN4w.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">肯尼测试S3桶</figcaption></figure><h2 id="8f03" class="kw iv hi bd iw kx ky kz ja la lb lc je kd ld le ji kh lf lg jm kl lh li jq lj bi translated"><strong class="ak">λ函数</strong></h2><p id="6247" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">将以下策略添加到Lambda函数角色。这将使Lambda函数能够执行S3 Get和Put操作。</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="0af3" class="kw iv hi lx b fi mb mc l md me">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Effect": "Allow",<br/>            "Action": [<br/>                "s3:PutObject",<br/>                "s3:GetObject"<br/>            ],<br/>            "Resource": "arn:aws:s3:::*/*"<br/>        }<br/>    ]<br/>}</span></pre><p id="e352" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">点击Lambda函数界面上的<strong class="ju hj">添加触发器</strong>按钮，配置Lambda函数，当有物体被推入<strong class="ju hj"> kene-test </strong> S3桶的<strong class="ju hj"> incoming </strong>文件夹时，该函数被触发。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/6ec7771b4acdf00689838db4ae44e67d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e9OIHzH98E46N_CE9P1wUg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">添加触发器</figcaption></figure><p id="3675" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">在搜索栏中键入并选择S3。根据下图填写表格。完成后，单击保存。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/1265b2ebaaed6bb6e35c8b07a1a92e50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C09C-lYNDK8jJ4cHqmnCjQ.png"/></div></div></figure><p id="eb6a" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">现在你的Lambda函数被配置为每当在<strong class="ju hj"> kene-test </strong> S3桶的<strong class="ju hj"> incoming </strong>文件夹中创建一个对象时被触发。</p><h2 id="9647" class="kw iv hi bd iw kx ky kz ja la lb lc je kd ld le ji kh lf lg jm kl lh li jq lj bi translated">Lambda函数Python代码</h2><p id="3ca9" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">有三种方法可以将代码添加到Lambda函数中，它们是:</p><ol class=""><li id="0f38" class="mh mi hi ju b jv kr jz ks kd mj kh mk kl ml kp mm mn mo mp bi translated">内联编辑代码</li><li id="12d5" class="mh mi hi ju b jv mq jz mr kd ms kh mt kl mu kp mm mn mo mp bi translated">上传代码和代码依赖项的. zip文件</li><li id="4c14" class="mh mi hi ju b jv mq jz mr kd ms kh mt kl mu kp mm mn mo mp bi translated">从S3上传文件</li></ol><p id="524f" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">在这个简短的练习中，我们将把代码和代码包上传为一个. zip文件。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mv"><img src="../Images/be1c4af3d5b3778535ee4c441b2fa91e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qTwrFjZJm5xXXY-g3Xvslg.png"/></div></div></figure><p id="0e88" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">显示了示例代码。注意<strong class="ju hj"> boto3 </strong>和<strong class="ju hj"> fpdf </strong>需要包含在。zip文件，以防您想要创建。自己压缩文件。</p><figure class="ls lt lu lv fd ij"><div class="bz dy l di"><div class="mw mx l"/></div></figure><p id="62e3" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">你可以下载完整版。来自我的Github repo的zip。</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="583d" class="kw iv hi lx b fi mb mc l md me">git clone <a class="ae kq" href="https://github.com/Kenec/Lambda-PDF-Generator.git" rel="noopener ugc nofollow" target="_blank">https://github.com/Kenec/Lambda-PDF-Generator.git</a></span></pre><p id="ba28" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">下一步是编辑处理程序文本字段以指向我们自己的。如下图所示进行更改，以便Lambda可以执行代码。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/1a8fbb4412087e1ae6866865ed66c24d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8HDc524jVib-Z2nb_aEi3A.png"/></div></div></figure><h2 id="43a4" class="kw iv hi bd iw kx ky kz ja la lb lc je kd ld le ji kh lf lg jm kl lh li jq lj bi translated">测试</h2><p id="8930" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">为了测试设置，上传一个文件到S3的<strong class="ju hj">接收文件夹</strong>。这将调用该函数，生成您上传的PDF格式文件，并将其保存到<strong class="ju hj"> incoming_PDF </strong>文件夹中。</p></div><div class="ab cl lk ll gp lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hb hc hd he hf"><h2 id="d82f" class="kw iv hi bd iw kx ky kz ja la lb lc je kd ld le ji kh lf lg jm kl lh li jq lj bi translated">结论</h2><p id="51ce" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">这个简单的设置可以是另一个复杂架构的一部分。它可以被调整来执行其他任务，比如当这样的操作完成时在Slack信道上通知团队。</p><p id="4770" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>