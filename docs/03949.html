<html>
<head>
<title>Visualizing thousands of phrases with Scattertext, PyTextRank and Phrasemachine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Scattertext、PyTextRank和Phrasemachine可视化成千上万的短语</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/visualizing-phrase-prominence-and-category-association-with-scattertext-and-pytextrank-f7a5f036d4d2?source=collection_archive---------3-----------------------#2020-02-27">https://medium.com/analytics-vidhya/visualizing-phrase-prominence-and-category-association-with-scattertext-and-pytextrank-f7a5f036d4d2?source=collection_archive---------3-----------------------#2020-02-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b8cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">2021年3月7日:PyTextRank的v3与Scattertext≤0.1.1不兼容。我已经更新了Scattertext以确保与API的兼容性，以及Readme文件和这篇博文。至少在这里使用的约定数据集上，结果似乎更好。</strong></p><p id="d309" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://github.com/jasonkessler/scattertext" rel="noopener ugc nofollow" target="_blank"> Scattertext </a>是一个Python包，让你交互式地可视化两类文本如何彼此不同(Kessler 2017)。我在散点图上做的大部分工作都集中在如何可视化不同类别中不同频率的单个单词和(以及二元模型)的区别。</p><p id="6431" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇博文关注的是我们如何使用<a class="ae jd" href="https://github.com/DerwenAI/pytextrank" rel="noopener ugc nofollow" target="_blank"> PyTextRank </a>和<a class="ae jd" href="https://github.com/slanglab/phrasemachine" rel="noopener ugc nofollow" target="_blank"> Phrasemachine </a>将这些技术扩展到更长的短语。这篇文章的第一部分将概述散点图可视化是如何工作的，第二部分描述了如何将PyTextRank集成到散点图中以及集成其分数的两种不同方法，第三部分将讨论如何集成Phrasemachine。</p><h1 id="068e" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">散文本简介</h1><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es kc"><img src="../Images/d9171eb0cb585c92f06158a6510d4330.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sml0D7KzrVJavom2FB5d2w.png"/></div></div><figcaption class="ko kp et er es kq kr bd b be z dx translated"><strong class="bd jg">图一。</strong>一个散点图示例显示了民主党人和共和党人在2012年提名大会上的演讲中词频排名如何不同。越蓝的术语，民主党的关联分数越高。术语越红，共和党的关联分数越高。请看<a class="ae jd" href="http://jasonkessler.github.io/demo_dense_rank.html" rel="noopener ugc nofollow" target="_blank">http://jasonkessler.github.io/demo_dense_rank.html</a>的互动版剧情。</figcaption></figure><p id="ad6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在图1中，我们可以看到民主党人和共和党人(在2012年政治大会的发言人中)的用词情况。每个点对应一个词的用法，这个词在y轴上的位置越高，它被民主党人使用得越多，越靠右，它被共和党人使用得越多。频繁使用的术语，如连词、冠词和介词，出现在右上角，而不常用的术语，如“乐观主义”或“选票”出现在右下角。</p><p id="96fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所示的位置对应于特定类别中密集的频率等级。意味着在特定类别中第一个最常用的术语被标在第二个最常用的术语旁边，即使一个术语比它的邻居使用的次数多很多。这可以防止图中出现大的间隙，并使其整体可读性更好。</p><p id="dcec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，使用一种针对分散文本的独特算法来确定哪些点被标记，哪些点没有被标记。这种标注发生在客户端，如果用户将鼠标悬停在这些术语上，就可以交互式地看到哪些术语对应于哪些点。单击会显示文档片段，显示每个术语在上下文中的用法。</p><h1 id="50ac" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">使用PyTextRank</h1><p id="2009" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">由Paco Nathan创建的PyTextRank 是TextRank算法(Mihalcea和Tarau 2004)的修改版本的实现。它涉及图中心性算法来提取文档中最突出的短语的评分列表。这里，命名实体由spaCy识别。从spaCy版本2.2开始，这些来自于在notes 5 上<a class="ae jd" href="https://catalog.ldc.upenn.edu/LDC2013T19" rel="noopener ugc nofollow" target="_blank">训练的NER系统。</a></p><p id="d7db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用时，像平常一样构建一个语料库，但是要确保使用spaCy来解析每个文档，而不是使用内置的<code class="du kx ky kz la b">whitespace_nlp</code>类型的标记器。注意，不需要将PyTextRank添加到spaCy管道中，因为它将由<code class="du kx ky kz la b">PyTextRankPhrases</code>对象单独运行。</p><p id="2b50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用<code class="du kx ky kz la b">AssociationCompactor</code>将图表中显示的短语数量减少到2000个，保留与每个类别最相关的1000个短语。所生成的短语将被视为非文本特征，因为它们的文档分数将不对应于字数。减少生成的短语数量很重要，因为随着更多的短语被可视化，散射文本的渲染引擎会变慢。请注意，超过4000个短语的图加载起来会非常慢。</p><pre class="kd ke kf kg fd lb la lc ld aw le bi"><span id="ccd4" class="lf jf hi la b fi lg lh l li lj">import pytextrank, spacy<br/>import scattertext as st<br/>import numpy as np</span><span id="c0f9" class="lf jf hi la b fi lk lh l li lj">nlp = spacy.load('en')<br/>nlp.add_pipe("textrank", last=True)</span><span id="1568" class="lf jf hi la b fi lk lh l li lj">convention_df = st.SampleCorpora.ConventionData2012.get_data(<br/>).assign(<br/>    parse=lambda df: df.text.apply(nlp),<br/>    party=lambda df: df.party.apply(<br/>        {'democrat': 'Democratic', <br/>         'republican': 'Republican'}.get<br/>    )<br/>)</span><span id="afaf" class="lf jf hi la b fi lk lh l li lj">corpus = st.CorpusFromParsedDocuments(<br/>    convention_df,<br/>    category_col='party',<br/>    parsed_col='parse',<br/>    feats_from_spacy_doc=st.PyTextRankPhrases()<br/>).build(<br/>).compact(<br/>    st.AssociationCompactor(2000, use_non_text_features=True)<br/>)</span></pre><p id="e698" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，语料库中存在的术语是命名的实体，并且与频率计数相反，它们的得分是由TextRank算法分配给它们的特征中心性得分。运行<code class="du kx ky kz la b">corpus.get_metadata_freq_df('')</code>将为每个类别返回术语的TextRank得分总和。这些分数的密集等级将用于构建散点图。</p><pre class="kd ke kf kg fd lb la lc ld aw le bi"><span id="6585" class="lf jf hi la b fi lg lh l li lj">term_category_scores = corpus.get_metadata_freq_df('')<br/>print(term_category_scores.head(5))<br/>'''<br/>                               Democratic  Republican<br/>term<br/>new plants                       0.104446    0.000000<br/>jobs                             3.967825    2.860420<br/>construction workers             0.120949    0.000000<br/>more opportunity                 0.175094    0.147941<br/>more Americans                   0.177554    0.054976<br/>'''</span></pre><p id="d684" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们构建这个图之前，让我们添加一些辅助变量，因为总的TextRank分数不太容易解释，我们将在<code class="du kx ky kz la b">metadata_description</code>字段中显示每个分数在每个类别中的排名。这些将在点击一个术语后显示。</p><pre class="kd ke kf kg fd lb la lc ld aw le bi"><span id="45af" class="lf jf hi la b fi lg lh l li lj">term_ranks = np.argsort(<br/>    np.argsort(-term_category_scores, axis=0), <br/>axis=0) + 1</span><span id="1bc9" class="lf jf hi la b fi lk lh l li lj">metadata_descriptions = {<br/>    term: '&lt;br/&gt;' + '&lt;br/&gt;'.join(<br/>        '&lt;b&gt;%s&lt;/b&gt; TextRank score rank: %s/%s' % (<br/>            cat, <br/>            term_ranks.loc[term, cat], <br/>            corpus.get_num_metadata()<br/>        )<br/>        for cat in corpus.get_categories()<br/>    )<br/>    for term in corpus.get_metadata()<br/>}</span></pre><p id="d7ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以用几种方法来构建学期分数。一个是标准的密集等级差异，这是在这里的大多数两个类别对比情节中使用的分数，它将给我们最多的类别相关短语。另一个是使用最大类别特定得分，这将为我们提供每个类别中最突出的短语，而不管其他类别中的突出程度。我们将在本教程中采用这两种方法，让我们计算第二种分数，下面是类别特定的突出度。</p><pre class="kd ke kf kg fd lb la lc ld aw le bi"><span id="08f7" class="lf jf hi la b fi lg lh l li lj">category_specific_prominence = term_category_scores.apply(<br/>    lambda row: (row.Democratic <br/>                 if row.Democratic &gt; row.Republican <br/>                 else -row.Republican),<br/>    axis=1<br/>)</span></pre><p id="040f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们准备输出这个图表。注意，我们使用了一个<code class="du kx ky kz la b">dense_rank</code>转换，它将相同比例的短语放置在彼此之上。我们使用<code class="du kx ky kz la b">category_specific_prominence</code>作为分数，并将<code class="du kx ky kz la b">sort_by_dist</code>设置为<code class="du kx ky kz la b">False</code>，以确保显示在图表右侧的短语是根据分数而不是到左上角或右下角的距离来排序的。由于匹配短语被视为非文本特征，并且为了确保它们在被点击时是可搜索的，我们通过将<code class="du kx ky kz la b">topic_model_preview_size</code>设置为<code class="du kx ky kz la b">0</code>将它们编码为单短语主题模型。这表明主题模型列表不应该显示。最后，我们设置确保显示完整的文档。请注意，文档将按特定短语得分的顺序显示。</p><pre class="kd ke kf kg fd lb la lc ld aw le bi"><span id="da08" class="lf jf hi la b fi lg lh l li lj">html = st.produce_scattertext_explorer(<br/>    corpus,<br/>    category='Democratic',<br/>    minimum_term_frequency=0,<br/>    pmi_threshold_coefficient=0,<br/>    width_in_pixels=1000,<br/>    transform=st.dense_rank,<br/>    metadata=corpus.get_df()['speaker'],<br/>    scores=category_specific_prominence,<br/>    sort_by_dist=False,<br/>    use_non_text_features=True,<br/>    topic_model_term_lists={term: [term] for term in         <br/>                            corpus.get_metadata()},<br/>    topic_model_preview_size=0,<br/>    metadata_descriptions=metadata_descriptions,<br/>    use_full_doc=True<br/>)</span></pre><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es ll"><img src="../Images/784ddcd62d91c7f5f3c64a301ad679fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UH81yEcGBte3iE7Jo6_3SA.png"/></div></div><figcaption class="ko kp et er es kq kr bd b be z dx translated"><strong class="bd jg">图二。</strong>短语由PyTextRank提取。两个轴是由PyTextRank计算的短语中心性得分的密集等级。根据PyTextRank计算的特定于类别的特征向量中心性的总和对术语进行评分。类别关联简单地由哪个类别的平均分数最高来确定。互动版:<a class="ae jd" href="http://jasonkessler.github.io/demo_pytextrank_prominence.html" rel="noopener ugc nofollow" target="_blank">http://jasonkessler . github . io/demo _ pytextrank _ prominence . html</a></figcaption></figure><p id="82c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个类别中最相关的术语是有意义的，至少在事后分析中是如此。当提到(当时的)州长罗姆尼时，民主党人在最核心的地方提到他时使用了他的姓氏“罗姆尼”，而共和党人则使用更熟悉、更人性化的“米特”。至于奥巴马总统，短语“奥巴马”也没有出现在最热门的词汇中，但是名字“巴拉克”是民主党演讲中最核心的短语之一，与“米特”相似。与共和党人相比，民主党人更倾向于使用“奥巴马总统”这一正式称谓。</p><p id="64d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者，我们可以将分数中的等级差异浓缩到颜色短语点，并确定要显示在图表右侧的顶级短语。我们没有将<code class="du kx ky kz la b">scores</code>设置为特定类别的重要性分数，而是将<code class="du kx ky kz la b">term_scorer=RankDifference()</code>设置为在散点图创建过程中注入一种确定术语分数的方法。</p><pre class="kd ke kf kg fd lb la lc ld aw le bi"><span id="d9f0" class="lf jf hi la b fi lg lh l li lj">html = st.produce_scattertext_explorer(<br/>    corpus,<br/>    category='Democratic',<br/>    minimum_term_frequency=0,<br/>    pmi_threshold_coefficient=0,<br/>    width_in_pixels=1000,<br/>    transform=st.dense_rank,<br/>    use_non_text_features=True,<br/>    metadata=corpus.get_df()['speaker'],<br/>    term_scorer=st.RankDifference(),<br/>    sort_by_dist=False,<br/>    topic_model_term_lists={term: [term] for term in <br/>                            corpus.get_metadata()},<br/>    topic_model_preview_size=0, <br/>    metadata_descriptions=metadata_descriptions,<br/>    use_full_doc=True<br/>)</span></pre><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es lm"><img src="../Images/e11151f09985c2baaaeabf883c25f640.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WZguekjiucKV-rx04o089g.png"/></div></div><figcaption class="ko kp et er es kq kr bd b be z dx translated"><strong class="bd jg">图三。</strong>短语由PyTextRank提取。这里，根据术语密集等级的不同，术语的评分方式与图1相同。这突出了每个类别中更有特点和独特性的短语。例如，“罗恩·保罗”，一个来自得克萨斯州的自由主义代表和一个邪教人物，是共和党人中最有特色的。如图2所示，“巴拉克”是民主党人的特征，就像佩尔·格兰特和政治上备受指责的生殖保健提供者“计划生育”一样。互动版:<a class="ae jd" href="https://jasonkessler.github.io/demo_pytextrank_rankdiff.html" rel="noopener ugc nofollow" target="_blank">https://jasonkessler . github . io/demo _ pytextrank _ rank diff . html</a></figcaption></figure><h1 id="dd51" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">使用短语机器</h1><p id="5426" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">来自<a class="ae jd" href="https://github.com/AbeHandler" rel="noopener ugc nofollow" target="_blank">Abe Handler</a>(Handler et al . 2016)的Phrasemachine在词性标签序列上使用正则表达式来识别名词短语。这比使用spaCy的NP组块有优势，因为它倾向于分离有意义的、没有同位语的大名词短语。</p><p id="d711" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与PyTextRank相反，我们将只使用这些短语的计数，像对待任何其他术语一样对待它们。</p><p id="5f38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将从语料库中选择4000个与类别最相关的短语，并使用其密集排序的特定于类别的频率来绘制它们。我们将使用密集等级中的差异作为得分函数。</p><pre class="kd ke kf kg fd lb la lc ld aw le bi"><span id="1111" class="lf jf hi la b fi lg lh l li lj">import spacy<br/>from scattertext import SampleCorpora, PhraseMachinePhrases, dense_rank, RankDifference, AssociationCompactor, produce_scattertext_explorer<br/>from scattertext.CorpusFromPandas import CorpusFromPandas</span><span id="b6a4" class="lf jf hi la b fi lk lh l li lj">corpus = CorpusFromPandas(<br/>    SampleCorpora.ConventionData2012.get_data(),<br/>    category_col='party',<br/>    text_col='text',<br/>    feats_from_spacy_doc=PhraseMachinePhrases(),<br/>    nlp=spacy.load('en', parser=False)<br/>).build().compact(AssociationCompactor(4000))</span><span id="3c4b" class="lf jf hi la b fi lk lh l li lj">html = produce_scattertext_explorer(<br/>    corpus,<br/>    category='democrat',<br/>    category_name='Democratic',<br/>    not_category_name='Republican',<br/>    minimum_term_frequency=0, <br/>    pmi_threshold_coefficient=0,<br/>    transform=st.dense_rank,<br/>    metadata=corpus.get_df()['speaker'],<br/>    term_scorer=st.RankDifference(),<br/>    width_in_pixels=1000<br/>)</span></pre><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es ln"><img src="../Images/98451e1be6c9c22682adb905899c6c87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kbfrEegCjTHmBt9c"/></div></div><figcaption class="ko kp et er es kq kr bd b be z dx translated"><strong class="bd jg">图4。</strong>找到的短语来自Phrasemachine (Handler 2016)在这里。术语的位置是基于它们的频率的密集等级，和图1和图3一样，分数是术语密集等级的差异。</figcaption></figure><h1 id="60d7" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">参考</h1><ul class=""><li id="0c28" class="lo lp hi ih b ii ks im kt iq lq iu lr iy ls jc lt lu lv lw bi translated">亚伯兰·汉德勒，马特·丹尼，汉娜·沃勒克，和布伦丹·奥康纳。一袋什么？面向语料库分析的简单名词短语抽取。EMNLP 2016的NLP+CSS研讨会。</li><li id="83d5" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">杰森·s·凯斯勒。<a class="ae jd" href="https://arxiv.org/abs/1703.00565" rel="noopener ugc nofollow" target="_blank"> Scattertext:一个基于浏览器的工具，用于可视化语料库的差异</a>。ACL系统演示。2017.</li><li id="de8e" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">拉达·米哈尔恰，保罗·塔劳。TextRank:给文本带来秩序。EMNLP。2004.</li></ul></div></div>    
</body>
</html>