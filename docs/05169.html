<html>
<head>
<title>How I build a question answering model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何建立一个问答模型</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-i-build-a-question-answering-model-3548878d5db2?source=collection_archive---------8-----------------------#2020-04-13">https://medium.com/analytics-vidhya/how-i-build-a-question-answering-model-3548878d5db2?source=collection_archive---------8-----------------------#2020-04-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/5c5502349cbb1983e3e5cd48d109f21b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LzSaud2YGFyE8Ius.jpeg"/></div></div></figure><p id="fd51" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi jo translated"><span class="l jp jq jr bm js jt ju jv jw di"/>问题回答模型简单来说就是一个回答你所提问题的计算机程序。</p><p id="57e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了让程序能够做到这一点，我们需要用一系列问题和答案来训练机器学习算法。</p><p id="6180" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将在本文中看到如何做到这一点。</p><p id="e319" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用的数据集是<a class="ae jx" href="https://rajpurkar.github.io/SQuAD-explorer/" rel="noopener ugc nofollow" target="_blank">斯坦福问答</a>数据集，它引用了超过10万个与他们的问题相关的答案。<br/>在这个数据集中，我们还有其他在这个简单案例中不会用到的信息。</p><h1 id="a54e" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">准备数据</h1><h2 id="0de8" class="kw jz hi bd ka kx ky kz ke la lb lc ki jb ld le km jf lf lg kq jj lh li ku lj bi translated">检索数据帧中的数据</h2><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/4482d0f0b5dae5bf7ac8827f183e3854.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_dljVdkTBKZPfB3zSDSG6w.png"/></div></div></figure><p id="02a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是提供给我们的Json文件中的数据的样子。<br/>我们希望检索每个响应的<strong class="is hj"> response_text </strong>字段以及与之相关的信息。为此，我们可以如下进行:</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/b9c2e6f25547b8d6dd1e10869030fe02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EtOjFeiP6PM3AjHu_UGGdA.png"/></div></div></figure><p id="08a5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过应用该函数，我们将从Json转到一个数据帧，我们将能够使用该数据帧进行工作:</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/c43466cb97800e17d2900b1f0b61a1ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*McLtahbOZdIm-KVI6U0xTQ.png"/></div></div></figure><p id="64a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里每一行代表一个问题的答案。当我们要训练我们的机器学习模型时，这将有助于我们，因为我们要给它一个问题作为特征，一个答案作为标签。</p><h2 id="3d0f" class="kw jz hi bd ka kx ky kz ke la lb lc ki jb ld le km jf lf lg kq jj lh li ku lj bi translated">训练单词嵌入模型</h2><p id="052b" class="pw-post-body-paragraph iq ir hi is b it lq iv iw ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn hb bi translated">机器学习模型只能用数字来训练，所以我们必须按照这个图表向量化我们的问题和答案</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/d013e18ace275cbc54baa5899bd3365c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4iTU1PpirqEbV9vIte7SAw.png"/></div></div></figure><ol class=""><li id="a29f" class="lw lx hi is b it iu ix iy jb ly jf lz jj ma jn mb mc md me bi translated">我们根据上下文(与问题相关的文本)训练我们的单词嵌入模型。</li><li id="fe41" class="lw lx hi is b it mf ix mg jb mh jf mi jj mj jn mb mc md me bi translated">我们使用之前获得的模型对我们的问题和答案进行矢量化。</li><li id="f80a" class="lw lx hi is b it mf ix mg jb mh jf mi jj mj jn mb mc md me bi translated">我们用这些矢量化的问题和答案来训练我们的机器学习模型。</li></ol><p id="92b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，作为第一步，我们需要检索我们的上下文，对它进行预处理，并用它来训练我们的单词嵌入模型。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/aa0296b6a086d5ff48eaca623f6ed70d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d12g3yEUIGfecCHhRVU7Kw.png"/></div></div></figure><h2 id="05c6" class="kw jz hi bd ka kx ky kz ke la lb lc ki jb ld le km jf lf lg kq jj lh li ku lj bi translated">预处理特征和标签</h2><p id="c35c" class="pw-post-body-paragraph iq ir hi is b it lq iv iw ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn hb bi translated">对于答案，我们就取答案所在的句子。当我们给模型打分时，它会帮助我们。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/11e100486643d0a1c117b06b26950db9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E2HMdg1Q8_kiQXasoEPS5A.png"/></div></div></figure><p id="8dd8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个函数遍历上下文，找到答案所在的句子，然后简单地预处理这些句子，丢弃一些没有价值的答案。</p><p id="77d2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于更简单的问题，我们只使用简单的预处理gensim函数。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/d42822670e6eac7374c4039b88b7e5e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ejegDreHfaosmccupW15Cw.png"/></div></div></figure><h2 id="a86f" class="kw jz hi bd ka kx ky kz ke la lb lc ki jb ld le km jf lf lg kq jj lh li ku lj bi translated">嵌入问题和答案</h2><p id="5e78" class="pw-post-body-paragraph iq ir hi is b it lq iv iw ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn hb bi translated">我们将使用两种不同的方法来嵌入我们的问题和答案。然后我们将比较他们的表现。</p><p id="67e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用的第一种方法非常简单，我们将使用FastText来嵌入所有内容。FastText的优点是可以处理词汇表之外的单词，所以我们不会因为试图嵌入词汇表之外的单词而出现任何错误。</p><p id="3f17" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第二种方法稍微复杂一点，代码如下:</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/763961c005b8bdd4fc3d06fdae02af35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hDdRps3hkvk7GpK8tv6w4A.png"/></div></div></figure><p id="977e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">事实上，所有令人困惑的代码都可以用这个图表来总结</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es mn"><img src="../Images/58b60cfd14a60e5a0b0294f1b0eeab2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*lGqxChrZngNaa5OKA83Lqg.jpeg"/></div></figure><p id="7ce5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，我们可以将这些函数应用到我们的数据集，以嵌入问题和答案。</p><p id="f90c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们从混合嵌入开始:</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/3fcccd0085bb2f26b2d82c69dc2e3914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xHwMZiRwdxNjQX4iBzwXmA.png"/></div></div></figure><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/f2905780a1022645ef1174b8f587cd37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IQEwpVXUnevPaROqU9c7CQ.png"/></div></div></figure><p id="f46c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们对每个问题进行平均，以便每个句子而不是每个单词有一个向量。</p><p id="34f5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以为快速文本嵌入做同样的事情:</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/a3db7feefa6e5dea843172f606836e17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eY3MObFHwb2AakmRoNgzjg.png"/></div></div></figure><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/c3652d680a7904e1fec40367a2684cc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OWiCCeuudyM7FjGheJXWDw.png"/></div></div></figure><p id="d960" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在训练我们的机器学习模型之前，我们需要处理输入的形状。事实上，scikit learn机器学习模型采用2D数组作为输入，这与我们刚刚创建的熊猫系列不同。</p><p id="7303" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了解决这个问题，我们创建了一个函数，将熊猫系列转换为学习机模型可以使用的2D数组。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/f3fc45ef4e3b4bc639223ae8472c10a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9oAH4gDd8-JvyfEdpdE7vA.png"/></div></div></figure><ul class=""><li id="632c" class="lw lx hi is b it iu ix iy jb ly jf lz jj ma jn mq mc md me bi translated">question_np，answer_np : 2D数组，包含使用mix方法矢量化的问题和答案</li><li id="2452" class="lw lx hi is b it mf ix mg jb mh jf mi jj mj jn mq mc md me bi translated">question _ fastText _ np，answer_fastText_np : 2D数组，包含用唯一的fastText方法矢量化的问题和答案</li></ul><h1 id="455c" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">训练和评分模型</h1><h2 id="60eb" class="kw jz hi bd ka kx ky kz ke la lb lc ki jb ld le km jf lf lg kq jj lh li ku lj bi translated">训练我们的机器学习模型</h2><p id="ca4d" class="pw-post-body-paragraph iq ir hi is b it lq iv iw ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn hb bi translated">我们将使用scikit学习库中的两个不同的模型，支持向量回归机(SVR)和梯度推进回归机(GBR)。我们将使用多输出回归器，顾名思义，它允许我们获得一组输出值(这里是矢量化响应)。</p><p id="28b4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了测试我们的单词嵌入方法的有效性，我们将使用我们拥有的两组不同的问题和答案来训练模型。</p><p id="5909" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，我们将有4种不同的模型:</p><ul class=""><li id="194e" class="lw lx hi is b it iu ix iy jb ly jf lz jj ma jn mq mc md me bi translated">基于mix方法嵌入问答的支持向量回归模型</li><li id="400e" class="lw lx hi is b it mf ix mg jb mh jf mi jj mj jn mq mc md me bi translated">一个嵌入了问题和答案的SVR模型</li><li id="a451" class="lw lx hi is b it mf ix mg jb mh jf mi jj mj jn mq mc md me bi translated">问题和答案嵌入mix方法的GBR模型</li><li id="b9ce" class="lw lx hi is b it mf ix mg jb mh jf mi jj mj jn mq mc md me bi translated">一个GBR模型，问题和答案嵌入了唯一的快速文本方法</li></ul><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/49a11680e0b009b80e3051e20455c66d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aJn-tYBTgbx3G1UuiPpFAA.png"/></div></div></figure><h2 id="0411" class="kw jz hi bd ka kx ky kz ke la lb lc ki jb ld le km jf lf lg kq jj lh li ku lj bi translated">给我们的模型打分</h2><p id="8f1a" class="pw-post-body-paragraph iq ir hi is b it lq iv iw ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn hb bi translated">现在测试我们训练过的模型是很重要的。为此，我们将无法使用scikit learn基于我们的用例已经制作的功能。在本文中，我将向你展示如何实现这些功能，但我不会运行它们，因为它们需要几天时间来处理整个数据集。</p><p id="8ca5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以我们将使用两个主要函数:</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mr"><img src="../Images/4886fe92d5053b2f952b12bad8616de1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CbUL_QTf5Tda0xXRL7HPWQ.png"/></div></div></figure><ul class=""><li id="3e82" class="lw lx hi is b it iu ix iy jb ly jf lz jj ma jn mq mc md me bi translated">get_vectorized_context将一个上下文作为输入，并返回一个数组，该数组包含该上下文中与其矢量化相关联的每个句子。</li><li id="abb9" class="lw lx hi is b it mf ix mg jb mh jf mi jj mj jn mq mc md me bi translated">least_distance将向量x和向量y的数组作为输入，并通过应用欧几里得距离返回y到x的最近向量。</li></ul><p id="be6d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果在我们的上下文中，与我们预测的向量最接近的向量是真实答案，我们认为预测是好的。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ms"><img src="../Images/df248c5defba8996df424db227ca72b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8IXFVXZ6wZCZ6b_lDp5tAw.png"/></div></div></figure><p id="ce27" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我们已经看到了一个经典的NLP问题，这个问题允许我们试验预处理和分析文本数据所需的不同步骤。</p><p id="bad2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们也了解云处理的所有利益，其中一个模型需要20多分钟来训练，我们无法为它们尝试许多参数。<br/>如果功率更大，我们可以进行一些交叉验证或网格搜索来找到最佳参数。</p></div></div>    
</body>
</html>