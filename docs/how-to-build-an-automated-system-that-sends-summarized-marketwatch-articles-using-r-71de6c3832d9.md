# 如何使用 R 构建一个自动系统来发送汇总的“市场观察”文章

> 原文：<https://medium.com/analytics-vidhya/how-to-build-an-automated-system-that-sends-summarized-marketwatch-articles-using-r-71de6c3832d9?source=collection_archive---------19----------------------->

![](img/5993f6e7648d2cd3b3b818f6a7d3610f.png)

来源:市场观察

在这个信息时代，了解最新的相关新闻是一项艰巨的任务。从埃隆·马斯克的新创意到卡戴珊的新彩妆系列，任何普通人都难以吸收。但是过多的信息并不一定意味着我们应该完全放弃看新闻。相反，我们应该每天不断地从可靠的来源收集和理解我们认为对我们有价值的信息。这就是为什么脸书、Twitter、YouTube 和其他社交媒体巨头雇佣数据科学家来找出他们的用户更喜欢在他们的 feed 上看到什么，以增强他们的体验，而不是向他们提供基于普遍受欢迎程度的一切，这在用户保留方面非常无效。因此，每当你决定是否观看某个节目，甚至只是简单地点击一个帖子，你都在不知不觉地帮助他们更好地了解你(在一个不那么令人毛骨悚然的背景下，让他们的算法更准确)。此外，如果你目前有身份危机，我建议你去你的 YouTube 主页，让它告诉你你是什么样的人，你的兴趣是什么。不管你喜不喜欢，你可以非常肯定这并不是完全错误的。

在这篇文章中，我将分享一个技巧，使用 r 手动构建一个系统，向你自己/他人发送你感兴趣的主题的摘要文章。为此，我选择了“市场观察”网站，这是一个提供最新股票市场、金融和商业新闻的网站。在这样做的时候，我们将使用一个名为“rvest”的包，这是一个用来轻松地从 html 网页中抓取数据的包。

让我们开始吧。

作为我们旅程的第一步，我们必须访问我们计划从中收集数据的网站。我最近对理解冠状病毒对金融市场的影响产生了兴趣。因此，正如你在下面看到的，我选择了发表在“市场观察”上的包含冠状病毒信息的文章。

![](img/ce9ffd159e72f65f3451f8ece670c3eb.png)

在我们开始编码部分之前，最好先了解一下我们将要使用的包和类。因此，我对那些正在努力理解某个函数是什么或者它实际上做什么的人的建议是回到这一点，彻底阅读这个函数是关于什么的。

## **Rvest**

“xml2”和“httr”包的包装器，使 HTML 和 xml 易于下载和操作。

**Read_html** :简单读取 html 或 XML。
**html _ nodes**:使用 XPath 和 CSS 选择器从 HTML 文档中轻松提取片段
**HTML _ attr**:从 HTML 中提取属性。
**html _ text**:从 html 中提取文本。

## **润滑剂**

Lubridate 提供了一些工具，使得解析和操作日期变得更加容易。

**gsub** : gsub 分别执行第一个和所有匹配的替换。
**parse _ date _ time**:用户友好的日期时间解析函数。将输入向量解析为 POSIXct 日期时间对象。
**ymd _ HMS:**ymd _ HMS()系列函数可以识别所有非字母数字分隔符，并正确处理不同类型的日期时间表示。
**diff Time:**时间间隔创建、打印和一些运算。

## **托管架**

一组一致、简单且易于使用的包装器，围绕着奇妙的“stringi”包。

str_squish : str_squish()减少字符串中重复的空格。

## **LSA 的乐趣**

提供使用语义的向量空间模型的方法和功能，例如潜在语义分析。

**genericSummary** :从文本中选择最能描述其主题的句子
**粘贴**:转换为字符后链接矢量。
**追加**:用于矢量合并，也给矢量添加元素。

## **发送邮件**

r .使用 SMTP 向本地 SMTP 服务器提交邮件。

**sendmail** :发送邮件。

为了达到我们的最终目标，即建立一个自动发送包含冠状病毒相关文章摘要的电子邮件的系统，需要从每篇文章中找到五个有用的变量。网站的 URL，文章发表的日期和时间，文章发表的时间，文章的标题和文章的正文。选择五个变量中每一个的原因将会在后面提到。

获取第一个变量(URL)非常简单。

这里需要注意的一件重要事情是，一个人应该如何找到术语“div.searchresult a”和“href”。下面的图片将显示找到它们的具体步骤。

![](img/3cce204f0e1af996e840bd6c238de992.png)

第一步

![](img/f3c51689076de2fc680c8f0e9ae7bc84.png)

第二步

![](img/b77dcf015003f238b0d51e3018ff02d9.png)

第三步

查找文章上传的日期和时间的原因是为了找到第二个变量，它显示了文章上传的时间。为此，您必须将原始数据转换为标准时间，然后将标准时间转换为您的当地时间。对于这些特定的任务，我们引入了“lubridate”包。当数据以我们期望的必要形式出现后，找到时差就只是找到发布时间(本地)和您的系统时间之间的差异。

因为我们只对最新的文章感兴趣，所以为了被归类为“最新”的文章，设置一个时间限制会更合适。我决定限制为 15 小时。因此，15 小时前发表的任何文章的摘要版本都将包含在邮件中。

现在我们已经为 5 个变量中的 3 个获得了足够的数据来构建系统，我们剩下的是提取每篇文章的标题和正文。这项任务听起来并不容易，因为我们经常会遇到包含“\n”术语和单词间有长空格的段落和行，如下所示。

![](img/fcd66d1f22cd02db4f26de0ca4796bca.png)

因此，我们也有一些关于使用“stingr”包清理我们的文本的知识是很重要的，它可以消除文本输出中不必要的术语和空格。

既然我们已经整理好了文章的正文并准备好了，那么在发送电子邮件之前，我们剩下的最后一步就是总结所选文章的正文。对于这个任务，我们将使用名为“LSA 乐趣”的软件包。

在我们获得符合最新条件的文章的摘要版本后，我们可以使用“append”将标题和摘要正文组合起来，并构建一个包含两列的数据框。

在耦合了标题和摘要之后，我们可以简单地使用“sendmailR”包及其函数来发送电子邮件。

现在，您已经知道如何使用 R 构建一个自动系统来发送摘要文章，您可以使用它来获取您感兴趣的任何主题的最新信息。尽管这个系统离人工阅读文章然后总结的质量还差得很远，但它确实是一个很好的起点。因此，当谈到构建自动化系统时，我们都应该问自己的问题是“在我的生活中，我重复做的任何事情都可以被自动化系统取代吗？”从那里开始。