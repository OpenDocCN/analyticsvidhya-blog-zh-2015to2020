<html>
<head>
<title>How to Rate Limit Routes in Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何对烧瓶中的限制路线进行评级</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-rate-limit-routes-in-flask-61c6c791961b?source=collection_archive---------1-----------------------#2020-02-14">https://medium.com/analytics-vidhya/how-to-rate-limit-routes-in-flask-61c6c791961b?source=collection_archive---------1-----------------------#2020-02-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e36fa46980f96e498392f32715dfd26e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3_fi4K-dFOsH_S3K"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">马库斯·斯皮斯克在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="b78e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://pymbook.readthedocs.io/en/latest/flask.html" rel="noopener ugc nofollow" target="_blank"> Flask </a>是一个用python写的web框架。它为您提供了工具、库和技术，允许您构建web应用程序。这些web应用程序可以是一些网页、博客、wiki，或者大到基于web日历应用程序或商业网站。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="925f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">什么是限速？<br/> </strong>速率限制允许你控制在给定的时间段内某人访问你的API的频率。烧瓶中有一个名为<strong class="ix hj">烧瓶限制器的扩展。</strong>此扩展允许您限制特定路线上的请求数量。每个路线可以有不同的请求限制，也可以不设限制。它通过跟踪用户的IP地址来限制用户。</p><p id="bb0f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">你为什么要使用它？<br/> </strong>一个API端点不应该被无限制的访问。我们需要确保我们的应用程序路由尽可能高效地运行。关注应用程序的性能非常重要，因为我们不希望用户有不好的体验。它还有助于通过限制请求来降低成本，并提高我们抵御DoS攻击的安全性。</p><p id="84b8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">如何实施？</strong> <br/>我们正在使用<code class="du ka kb kc kd b">flask_limiter</code>库在我们的flask应用中提供速率限制特性。在完成文件后，你将需要一些进口货。确保您的环境已经安装了<code class="du ka kb kc kd b">flask</code>和<code class="du ka kb kc kd b">flask-limiter</code>。</p><pre class="ke kf kg kh fd ki kd kj kk aw kl bi"><span id="921e" class="km kn hi kd b fi ko kp l kq kr">from flask_limiter import Limiter<br/>from flask_limiter.util import get_remote_address</span></pre><p id="75e3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这些导入之后，您将需要添加一个默认限制器。使用下面的代码片段。</p><pre class="ke kf kg kh fd ki kd kj kk aw kl bi"><span id="b480" class="km kn hi kd b fi ko kp l kq kr">limiter = Limiter(<br/>    application,<br/>    key_func=get_remote_address,<br/>    default_limits=["200 per day", "50 per hour"]<br/>)</span></pre><p id="2b94" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于<code class="du ka kb kc kd b">Limiter</code>，第一个参数应该是主flask文件应用程序的名称。那么<code class="du ka kb kc kd b">key_func </code>应该等于<code class="du ka kb kc kd b">get_remote_address</code>。您可以将<code class="du ka kb kc kd b">default_limits</code>设置为您想要的任何值。</p><p id="1a7b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在每条路线下，您可以单独定制请求限制，它将绕过默认限制。</p><pre class="ke kf kg kh fd ki kd kj kk aw kl bi"><span id="ffa6" class="km kn hi kd b fi ko kp l kq kr"># example 5 per minute route <br/>@application.route("/slow")<br/>@limiter.limit("5 per minute")<br/>def slow():<br/>    return "5 per minute!"</span></pre><p id="adf8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们还可以将路由从默认限制中免除，用户将可以无限制地访问该路由。</p><pre class="ke kf kg kh fd ki kd kj kk aw kl bi"><span id="be68" class="km kn hi kd b fi ko kp l kq kr"># example no limit route<br/>@application.route("/exempt")<br/>@limiter.exempt<br/>def exempt():<br/>    return "No limits!"</span></pre><p id="8a5b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">示例烧瓶App: <br/> </strong> <em class="ks">将下面的代码块复制粘贴到</em><strong class="ix hj"><em class="ks">application . py</em></strong><em class="ks">文件中并运行</em></p><pre class="ke kf kg kh fd ki kd kj kk aw kl bi"><span id="3741" class="km kn hi kd b fi ko kp l kq kr">from flask import Flask<br/>from flask_limiter import Limiter<br/>from flask_limiter.util import get_remote_address</span><span id="4a7e" class="km kn hi kd b fi kt kp l kq kr">application = Flask(__name__)</span><span id="6d7d" class="km kn hi kd b fi kt kp l kq kr">limiter = Limiter(<br/>    application,<br/>    key_func=get_remote_address,<br/>    default_limits=["200 per day", "50 per hour"]<br/>)</span><span id="fdce" class="km kn hi kd b fi kt kp l kq kr">@application.route("/")<br/>def default():<br/>    return "default limit!"</span><span id="d55a" class="km kn hi kd b fi kt kp l kq kr">@application.route("/five")<br/>@limiter.limit("5 per minute")<br/>def five():<br/>    return "5 per minute!"<br/><br/>@application.route("/exempt")<br/>@limiter.exempt<br/>def exempt():<br/>    return "No limits!"<br/><br/><br/>if __name__ == "__main__":<br/>    application.run(port=5000, debug=True)</span></pre><p id="342e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">测试每条路线，并设置任何你想要的限制。一条路线也可能有多个限制。每当请求超过速率限制时，将不会调用该函数，而是会引发429 http错误。</p><p id="439d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">速率限制字符串符号</strong> <br/>举例:</p><ul class=""><li id="48c4" class="ku kv hi ix b iy iz jc jd jg kw jk kx jo ky js kz la lb lc bi translated">每分钟10次</li><li id="9a30" class="ku kv hi ix b iy ld jc le jg lf jk lg jo lh js kz la lb lc bi translated">每小时10英镑</li><li id="b703" class="ku kv hi ix b iy ld jc le jg lf jk lg jo lh js kz la lb lc bi translated">10/小时</li><li id="458a" class="ku kv hi ix b iy ld jc le jg lf jk lg jo lh js kz la lb lc bi translated">10/小时；100/天；每年2000英镑</li><li id="50da" class="ku kv hi ix b iy ld jc le jg lf jk lg jo lh js kz la lb lc bi translated">100/天，500/7天</li><li id="bdda" class="ku kv hi ix b iy ld jc le jg lf jk lg jo lh js kz la lb lc bi translated">100/天，500/7天</li></ul></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="af59" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">限制请求将由您将运行的应用程序决定。所以你会知道每条路线的最佳价格。:)</p><p id="c218" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这篇文章最终将成为我和我的团队在从事一个名为Cryptolytic的项目时所学到的经验的系列文章的一部分(文章将很快写出来并链接到这里)。这是我们在进行项目时希望拥有的指南。</p><p id="67eb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这篇文章最终将成为我和我的团队在从事一个名为Cryptolytic的项目时所学到的经验的系列文章的一部分(文章将很快写出来并链接到这里)。这是我们在进行项目时希望拥有的指南。</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/6213600eacd8f04bb18d2fba1e0e8599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*F7eHtQD968rPa4YB.png"/></div></div></figure><p id="e37a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">包含本文中使用的所有代码的笔记本可以在这里找到</strong><a class="ae iu" href="https://github.com/Cryptolytic-app/cryptolytic/tree/master/medium_articles" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj"/></a><strong class="ix hj"/>，这是我们的密码破解项目的repo内部——所以如果你很好奇，可以去看看！</p><p id="ce53" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在Twitter <a class="ae iu" href="https://twitter.com/malexmad" rel="noopener ugc nofollow" target="_blank"> @malexmad </a>，<a class="ae iu" href="https://github.com/malexmad" rel="noopener ugc nofollow" target="_blank"> Github </a>上找我，或者在<a class="ae iu" href="https://www.linkedin.com/in/marvin-davila/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系我！</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><div class="ke kf kg kh fd lj"><a href="https://flask-limiter.readthedocs.io/en/stable/" rel="noopener  ugc nofollow" target="_blank"><div class="lk ab dw"><div class="ll ab lm cl cj ln"><h2 class="bd hj fi z dy lo ea eb lp ed ef hh bi translated">烧瓶限制器-烧瓶限制器1.0.1+0.gb390e64 .脏文档</h2><div class="lq l"><h3 class="bd b fi z dy lo ea eb lp ed ef dx translated">上述Flask应用程序将具有以下速率限制特征:通过远程地址的速率限制…</h3></div><div class="lr l"><p class="bd b fp z dy lo ea eb lp ed ef dx translated">烧瓶限制器. readthedocs.io</p></div></div><div class="ls l"><div class="lt l lu lv lw ls lx io lj"/></div></div></a></div><div class="ly lz ez fb ma lj"><a href="http://flask.palletsprojects.com/en/1.1.x/quickstart/#" rel="noopener  ugc nofollow" target="_blank"><div class="lk ab dw"><div class="ll ab lm cl cj ln"><h2 class="bd hj fi z dy lo ea eb lp ed ef hh bi translated">快速启动烧瓶文档(1.1.x)</h2><div class="lq l"><h3 class="bd b fi z dy lo ea eb lp ed ef dx translated">一个最小的Flask应用程序看起来像这样:那么代码做了什么？首先，我们导入了这个类。安…</h3></div><div class="lr l"><p class="bd b fp z dy lo ea eb lp ed ef dx translated">flask.palletsprojects.com</p></div></div></div></a></div><div class="ly lz ez fb ma lj"><a href="https://github.com/Cryptolytic-app/cryptolytic" rel="noopener  ugc nofollow" target="_blank"><div class="lk ab dw"><div class="ll ab lm cl cj ln"><h2 class="bd hj fi z dy lo ea eb lp ed ef hh bi translated">密码破解-app/密码破解</h2><div class="lq l"><h3 class="bd b fi z dy lo ea eb lp ed ef dx translated">你可以在Cryptolytic找到这个项目。Trello板产品Canvas Cryptolytic是一个为初学者修修补补的平台…</h3></div><div class="lr l"><p class="bd b fp z dy lo ea eb lp ed ef dx translated">github.com</p></div></div><div class="ls l"><div class="mb l lu lv lw ls lx io lj"/></div></div></a></div></div></div>    
</body>
</html>