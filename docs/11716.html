<html>
<head>
<title>Optimal Transportation — 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">最佳运输— 1</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/optimal-transportation-1-61fe0dda03ba?source=collection_archive---------14-----------------------#2020-12-15">https://medium.com/analytics-vidhya/optimal-transportation-1-61fe0dda03ba?source=collection_archive---------14-----------------------#2020-12-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f79b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与深度学习的关系</p><h2 id="fa77" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">介绍</h2><p id="46ee" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">最近，我跟随石溪大学的 David Gu 教授做了一些计算几何方面的工作。基础数学对计算机科学和机器学习有如此深远的影响，这很有启发性。由于我的背景是代数几何/拓扑学，我发现这个领域很顺利，也很令人兴奋。我决定根据我所学到的写一系列的文章，并展示一些关于最佳运输的酷东西(第一)。</p><p id="bb67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我会尽量不要在第一个帖子里说得太专业，因为我不想把人们吓跑。我将简要地展示最优运输如何改进深度学习，特别是在 GAN 案例中。</p><h2 id="5265" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">深度学习和模型崩溃</h2><p id="937b" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">GAN 代表生成性对抗网络。网上有很多介绍甘模型的文章，我就不赘述了。简而言之，GAN 是由两个神经网络组成的生成模型，一个是鉴别器，另一个是生成器。鉴别器网络用于判断一幅图像是“假”还是“真”，通常是预先训练好的。生成器模型将从<em class="kd">潜在空间</em>获取输入点来生成图像，并输出图像。<em class="kd">潜在空间是向量空间，需要训练</em>。GAN 模型将发生器和鉴别器堆叠在一起，随机点流入发生器，然后流入鉴别器。来自生成器模型的输出被手动标记为“真实的”，然而，在开始时，鉴别器将认为它是“虚假的”,并且大的误差将迫使反向传播更新生成器权重以输出更好的图像。在这个过程中，潜在空间将被赋予意义，并最终代表输出分布。</p><p id="3fbc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们更广泛地了解深度学习。当我们训练一个 DL 模型时，例如 NLP 模型，我们经常使用嵌入。一个单词或一个物体被嵌入到一个高维矩阵或空间中，使得每个点都由某个空间中的高维向量来表示。然后训练该模型以赋予该空间一个意义，以便我们的训练样本数据将相应地分布在该空间中。现在，我们似乎可以回答这个问题:深度学习真正学到了什么？<em class="kd">它学习流形上的概率分布</em>。</p><p id="cf80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，潜在空间中潜在点的分布可能不是连续的。这可能会导致问题，例如，如果我们的输入点位于潜在空间的间隙区域呢？那么模型就无法判断它来自哪个分布，并且会产生非常差的结果。让我们用一个具体的例子来说明这个问题:MNIST 数字数据集。使用 GAN，我们可以从一个大潜在空间，比如说 100 维向量空间中产生数字图像。通过选择适当的学习率和历元数，鉴别器可以很好地分辨“真实”和“虚假”图像</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ke"><img src="../Images/07d81ecadad00b53f7be6cdd097bd070.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KjeLPZ5LJqru3OH3M3FuKA.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">鉴别器模型的准确性</figcaption></figure><p id="7e8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是 GAN 模型损失(二进制交叉熵)甚至在 100 个时期后仍保持在相当高的水平。这表明即使经过长时间的训练，发生器也不能欺骗鉴别器。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ku"><img src="../Images/0382cd6ed917e939b2eb906a9f3aba54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3H6rNIF4mKRBoYdRXLWCoQ.jpeg"/></div></div></figure><p id="bb49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们用 UMAP 把潜在空间投影到一个低维空间(2 维)后，画出这个潜在空间。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es kv"><img src="../Images/3b789163a6db9210aaf626998871d8c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TGl68XiVuK9tTl93iKHMEQ.jpeg"/></div></div></figure><p id="2b8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们立即看到，分布是高度不连续的，有很大的差距。如果我们仅仅使用这个二维空间作为潜在空间来生成数字图像会发生什么？</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es kw"><img src="../Images/c2f5d5e184ecec84f809ab10c9ce68e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0oaRSqrEOhAnsCIyw82NpQ.png"/></div></div></figure><p id="4ffd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">显然有许多模糊的输出，其中一些是不可识别的。难怪鉴别者不上当，轻易抓到“假”的。</p><h2 id="4547" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">最佳运输</h2><p id="e882" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">我们可以通过使用最佳运输来解决这个问题。最佳运输理论试图解决以下问题:我们有两个可测空间</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es kx"><img src="../Images/c29829a32def46b0f1df5e9a71036a58.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/1*N0-PSMKDvf9l4RSIQgJ5Vw.gif"/></div></figure><p id="7d9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">带有概率分布函数</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es ky"><img src="../Images/c8f2f378f1c802fe28d70dcef1a12fdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:530/1*Ph6I9VvvpORs7zFYlu5HJw.gif"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">概率分布函数</figcaption></figure><p id="49cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们说一个从<em class="kd"> X </em>到<em class="kd"> Y </em>的映射<em class="kd"> T </em>测度保持如果</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es kz"><img src="../Images/1ed104071d9cc183b33607426a920330.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/1*rsmaIjBUv9wjZRMJsLeXmQ.gif"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">测度保持映射</figcaption></figure><p id="ee07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后给定一个成本函数 c</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es la"><img src="../Images/8dacee7812a8f5739da70db444838c35.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/1*XrXljSOGUuXF9lBDK7EAgw.gif"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">价值函数</figcaption></figure><p id="2c56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们要计算使成本最小的保运输措施<em class="kd"> T </em>(称为最优运输)<em class="kd"> </em></p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es lb"><img src="../Images/706c64a2d0c97baef06a376f08bd1a43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/1*UE_LrI_AArKX7R0af0CebA.gif"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">蒙日问题</figcaption></figure><p id="0adc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们试图最小化的积分通常被称为<strong class="ih hj">瓦瑟斯坦距离</strong>，上面的表达式被称为<strong class="ih hj">蒙日问题</strong>。通过一些数学操作，我们可以将蒙日问题转化为白来尼问题(我希望在这个系列中给出更多的数学细节！):</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es lc"><img src="../Images/523cd055ffb9446a87e5d63480e6e0ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/1*DziTf_bUa4U0zU_Mxocy3w.gif"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">白来尼问题</figcaption></figure><p id="ab57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们取二次成本函数，可以证明白来尼问题是有解的</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es ld"><img src="../Images/0fd7c3db86e9b138b68745c255ab0e7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:288/1*Y5pL_Y7Y1QZHFmMvSl_zLw.gif"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">白来尼成本函数</figcaption></figure><p id="ef73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">白来尼问题中的函数<em class="kd"> u </em>被称为白来尼势(见下图)，其梯度给出了运输图<em class="kd"> T </em>。</p><p id="de0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将来自白来尼观点的最佳运输理论应用于上面给出的二维潜在空间。首先，我们赋予二维潜在空间一个均匀的分布，即每个点的权重相等，这就是我们的<em class="kd"> Y </em>空间。然后我们建立白来尼势如下:</p><ol class=""><li id="6315" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated">我们对<em class="kd"> Y </em>和相应的 Voronoi 图进行三角剖分(Delaunay ),并计算每个 Voronoi 单元的面积。</li><li id="a993" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">我们通过将 Voronoi 单元提升到三维空间作为超平面并计算它们的上包络来构建白来尼势。</li><li id="bbde" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">这个上包络的勒让德对偶到 2D 空间的投影给出了<em class="kd"> Y </em>空间的加权 Delaunay 三角剖分。</li><li id="94fe" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">迭代地调整提升和上包络的高度，使得其到 2D 空间的投影给出 Voronoi 分解，使得单元的面积等于给定的权重。这给了<em class="kd"> X </em>空间。</li></ol><p id="847e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以这种方式获得的白来尼势将是分段线性空间，并且投影将给出<em class="kd"> X </em>空间的 Voronoi 图，使得每个单元测量目标重量，即，在我们的情况下，均匀分布的空间。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ls"><img src="../Images/20268835477066bce66a8057010ab2b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R6n4sst1lZJ0BtwW7LT3QQ.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">白来尼势</figcaption></figure><p id="40f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们看到，这样得到的投影空间在分布之间没有间隙，奇点的测度为零。如果我们从这个空间而不是原始的 2 维潜在空间运行 GAN，那么模型崩溃问题将得到显著改善。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lt"><img src="../Images/012fea7e5bffb87191cdda2ef56235ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UwI86A5L9FjR6KUZNDRwpQ.jpeg"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">加班后的甘</figcaption></figure><p id="3772" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">值得注意的是，大部分生成的数字是清晰明确的，但仍有一些是模糊的，例如，底部第三行右侧。原因是 OT 潜在空间中的数据点位于两个分布的边缘，也称为奇点。虽然奇点有零测度(在我们的空间中是余维 1)，但可能会发生一些点位于这个零测度集中。但是，这已经是对原有潜伏空间的巨大提升了。</p></div></div>    
</body>
</html>