<html>
<head>
<title>Apache Airflow Chapter 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">阿帕奇气流第1章</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/apache-airflow-chapter1-2145900f6960?source=collection_archive---------13-----------------------#2019-12-17">https://medium.com/analytics-vidhya/apache-airflow-chapter1-2145900f6960?source=collection_archive---------13-----------------------#2019-12-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5072" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我刚刚开始了一个新项目，在那里我曾经为一个客户项目构建管道并完成Apache-airflow设置。所以我已经花了两个星期的时间阅读airflow官方文档，以全面了解自下而上。现在我打算为气流创建完整的章节。这里的第一章都是关于基本气流及其背后的历史。</p><h2 id="5cec" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">气流</h2><p id="846b" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">Airflow是一个基于python语言构建的开源工作流管理系统。它是由现任CEO &amp;和<strong class="ih hj"> <em class="kd"> Present创始人<strong class="ih hj"> Maxime Beauchemin </strong>在Airbnb创建的。</em>T15】</strong></p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es ke"><img src="../Images/b8a503aa6dd7ff7cdbc994beed70fa83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*sSRHHf73FUy6sjgIsQBmcQ.png"/></div><figcaption class="km kn et er es ko kp bd b be z dx translated">来源于谷歌图片</figcaption></figure><p id="9a16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在airflow之前，有很多数据工作流管理工具可用，但是由于python的发展和良好的社区支持，apache-airflow现在处于领先地位。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es kq"><img src="../Images/cbf97379e06a4efedcc5827f9943919c.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*noE7l9cNVnB1R1zYFxOfEw.png"/></div><figcaption class="km kn et er es ko kp bd b be z dx translated">数据工作流管理工具及其GitHub star列表</figcaption></figure><h2 id="11d9" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">阿帕奇-气流快速介绍</h2><p id="f588" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">让我们开始Apache-airflow的快速安装</p><pre class="kf kg kh ki fd kr ks kt ku aw kv bi"><span id="d229" class="jd je hi ks b fi kw kx l ky kz">1.To start airflow we have to define home directory (by default ~/airflow)</span><span id="b25d" class="jd je hi ks b fi la kx l ky kz">export AIRFLOW_HOME=~/airflow-playground</span><span id="5c1b" class="jd je hi ks b fi la kx l ky kz">2.Install Apache-airflow python package from pip</span><span id="337f" class="jd je hi ks b fi la kx l ky kz">pip install apache-airflow</span><span id="c32e" class="jd je hi ks b fi la kx l ky kz">3.Initialize the database(by default sqlite)</span><span id="5438" class="jd je hi ks b fi la kx l ky kz">airflow initdb</span><span id="14fe" class="jd je hi ks b fi la kx l ky kz">4.Run webserver and scheduler(run each command in different tabs)</span><span id="f86d" class="jd je hi ks b fi la kx l ky kz">airflow webserver -p 8000<br/>airflow scheduler</span></pre><p id="9412" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你按照上述步骤，气流将开始运行在您的本地浏览器的8000端口<a class="ae lb" href="http://localhost:8000/admin/" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/admin/</a>。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lc"><img src="../Images/a033bc205691ae3ef3fff5da9aa603c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tyUtUIz0ZTu7xP4OSLl6zA.png"/></div></div></figure><p id="5e73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，我们有几个示例任务来练习我们对气流任务和操作符的理解。只是为了让我们回填过去两天的数据</p><pre class="kf kg kh ki fd kr ks kt ku aw kv bi"><span id="097b" class="jd je hi ks b fi kw kx l ky kz"># start_date --&gt; -s and end_date --&gt; -e<br/>airflow backfill example_xcom -s 2019-12-12 -e 2010-12-13</span></pre></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><p id="9ffa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在进入深入的气流教程之前，让我们设置<code class="du lo lp lq ks b">virtualenv</code></p><h2 id="dbdb" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">Virtualenvwrapper</h2><p id="b05d" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">到目前为止，我们经历了一些低水平的阿帕奇气流。让我们潜入更深的地方。对于python相关的项目，建议在隔离的环境中处理不同的项目。一个好的选择是<code class="du lo lp lq ks b">VIRTUALENV</code>,尽管这是最好的选择，但每次激活环境时，都必须明确指定env文件夹。</p><pre class="kf kg kh ki fd kr ks kt ku aw kv bi"><span id="5480" class="jd je hi ks b fi kw kx l ky kz">virtualenv -p python3 .env<br/>source bin/activate</span></pre><p id="bbeb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了克服在一个目录中管理所有的<code class="du lo lp lq ks b">virtualenv</code>包文件夹并使生活更容易，我使用了<code class="du lo lp lq ks b">virtualenvwrapper</code>，它是<code class="du lo lp lq ks b">virtualenv</code>的一组扩展</p><p id="27a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">按照以下说明在本地系统上安装和配置<code class="du lo lp lq ks b">virtualenvwrapper</code>。</p><pre class="kf kg kh ki fd kr ks kt ku aw kv bi"><span id="20f0" class="jd je hi ks b fi kw kx l ky kz"># Changed to home directory<br/>cd</span><span id="26f2" class="jd je hi ks b fi la kx l ky kz"># Make directory to save all your virtualenvs<br/>mkdir .venvs</span><span id="b657" class="jd je hi ks b fi la kx l ky kz"># Install virtualenv package<br/>pip install virtualenv</span><span id="4a20" class="jd je hi ks b fi la kx l ky kz"># Install virtualenvwrapper package<br/>pip install virtualenvwrapper</span><span id="9113" class="jd je hi ks b fi la kx l ky kz"># Once virtualenvwrapper installed get source path in my case (/home/jagadish/.local/bin/virtualenvwrapper.sh) <br/>which virtualenvwrapper.sh</span><span id="1ecb" class="jd je hi ks b fi la kx l ky kz"># Just add virtualenvwrapper configuration inside of ~/.bashrc<br/>export WORKON_HOME=~/.venvs<br/>source /home/jagadish/.local/bin/virtualenvwrapper.sh</span></pre><p id="53d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦<code class="du lo lp lq ks b">virtualenvwrapper</code>在本地安装好，我们现在就准备继续前进。这里是<code class="du lo lp lq ks b">virtualenvwrapper</code>的备忘单，里面有基本的有用命令。</p><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="lr ls l"/></div><figcaption class="km kn et er es ko kp bd b be z dx translated">虚拟包装的备忘单</figcaption></figure><p id="4196" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在是时候开始设置<code class="du lo lp lq ks b">virtualenv</code>并为我们的项目安装所有相关的pip包。我保留我的环境名作为<code class="du lo lp lq ks b">playground,</code>你可以选择任何你喜欢的。</p><pre class="kf kg kh ki fd kr ks kt ku aw kv bi"><span id="b4ba" class="jd je hi ks b fi kw kx l ky kz"># To create env<br/>mkvirtualenv -p python playground</span><span id="5117" class="jd je hi ks b fi la kx l ky kz"># Activate virtualenv by <br/>workon playground</span><span id="d5ff" class="jd je hi ks b fi la kx l ky kz"># Install airflow and postgres packages<br/>pip install apache-airflow[postgres]</span></pre><p id="7b14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建一个目录，所有与项目相关的文件都应该放在这个目录下，并创建一个文件夹作为项目报告。</p><pre class="kf kg kh ki fd kr ks kt ku aw kv bi"><span id="49f6" class="jd je hi ks b fi kw kx l ky kz">mkdir playground</span><span id="a79c" class="jd je hi ks b fi la kx l ky kz">cd playground</span><span id="494f" class="jd je hi ks b fi la kx l ky kz">setvirtualenvproject</span></pre><p id="636a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过做<code class="du lo lp lq ks b">setvirtualenvproject</code>将使，而运行<code class="du lo lp lq ks b">workon</code>跳转目录以及激活环境。现在我们已经准备好完全运行我们的airflow，但是最佳实践是我们必须将我们的airflow主目录路径添加到<code class="du lo lp lq ks b">~/.bashrc</code>或<code class="du lo lp lq ks b">~/.zshrc</code>文件中(以sudo模式打开)。通过添加它将不会反映我们当前终端的变化，所以我们必须重新启动，只需关闭所有终端并从头开始或使用<code class="du lo lp lq ks b">source ~/.bashrc</code>或<code class="du lo lp lq ks b">source ~/.zshrc</code></p><pre class="kf kg kh ki fd kr ks kt ku aw kv bi"><span id="3373" class="jd je hi ks b fi kw kx l ky kz">export AIRFLOW_HOME=~/airflow-playground</span></pre><p id="1dbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在通过跑步启动气流</p><pre class="kf kg kh ki fd kr ks kt ku aw kv bi"><span id="534b" class="jd je hi ks b fi kw kx l ky kz">airflow webserver -p 8000</span><span id="592c" class="jd je hi ks b fi la kx l ky kz">airflow scheduler</span></pre><p id="3c36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，我们已经了解了airflow的基本工作流程以及项目环境设置。让我们在下一章更深入地了解气流的每个组成部分。</p><p id="7ccf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你遇到任何与气流有关的问题，请告诉我。谢了。</p></div></div>    
</body>
</html>