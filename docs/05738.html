<html>
<head>
<title>Invoke an Amazon SageMaker endpoint using AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Lambda调用Amazon SageMaker端点</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/invoke-an-amazon-sagemaker-endpoint-using-aws-lambda-83ff1a9f5443?source=collection_archive---------1-----------------------#2020-05-01">https://medium.com/analytics-vidhya/invoke-an-amazon-sagemaker-endpoint-using-aws-lambda-83ff1a9f5443?source=collection_archive---------1-----------------------#2020-05-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="919b" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">使用API Gateway和AWS Lambda调用Amazon SageMaker XGBoost回归模型端点的分步指南</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/9a1628f559d868c1cc4ed9d89e795c0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FWmfC7SvtZxsSNdF"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">照片由<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae jn" href="https://unsplash.com/@heyerlein?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> h heyerlein </a>拍摄</figcaption></figure><p id="8fbc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">假设您在这里是因为您已经部署了SageMaker ML模型端点，试图理解使用AWS Lambda函数托管它的过程。如果是，那我们开始吧..</p><p id="b080" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">注:</strong>如果没有，可以通过阅读我之前的博客<a class="ae jn" rel="noopener" href="/@sriramya.kannepalli/random-forest-and-xgboost-on-amazon-sagemaker-and-aws-lambda-29abd9467795"> Random Forest和亚马逊SageMaker </a>上的XGBoost来创建一个XGBoost SageMaker端点，实现这个jupyter笔记本。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="kk kl l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">Jupyter笔记本，用于将XGBoost部署为SageMaker端点</figcaption></figure><h1 id="bff6" class="km kn hi bd ko kp kq kr ks kt ku kv kw io kx ip ky ir kz is la iu lb iv lc ld bi translated">我的端点在哪里？</h1><p id="7de0" class="pw-post-body-paragraph jo jp hi jq b jr le ij jt ju lf im jw jx lg jz ka kb lh kd ke kf li kh ki kj hb bi translated">现在，在SageMaker中训练和部署模型之后，您可以从SageMaker控制台的SageMaker &gt;推断&gt;端点中复制您部署的端点的名称。在AWS Lambda函数中定义环境变量时，我们将使用端点名称。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lj"><img src="../Images/eb9eefd2e02c0b5f18bfd3a7cdf780e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uzM1orMdBymMqQoKFYYh0w.png"/></div></div></figure><h1 id="8ddc" class="km kn hi bd ko kp kq kr ks kt ku kv kw io kx ip ky ir kz is la iu lb iv lc ld bi translated"><strong class="ak">创建AWS Lambda函数</strong></h1><p id="7dc7" class="pw-post-body-paragraph jo jp hi jq b jr le ij jt ju lf im jw jx lg jz ka kb lh kd ke kf li kh ki kj hb bi translated">在AWS控制台中搜索“Lambda ”,然后单击“函数”下的“创建函数”。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lk"><img src="../Images/b4d906124ed9e70fcd216875bf0ecb27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*McEka_eHbLH-cQm92p0bzQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">屏幕截图—在AWS Lambda中创建新函数</figcaption></figure><p id="695d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">选择运行时Python 3.6，并在函数代码中添加以下示例代码:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="7000" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后点击“保存”。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ll"><img src="../Images/8d4019480ebdabb7980ffdf6df294eec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wAyNRhHbioZcPfrfWxRwgQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">python中的lambda_function代码示例</figcaption></figure><p id="aefd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">点击编辑环境变量&gt;添加环境变量并添加</p><p id="ae43" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">密钥:“端点名称”</p><p id="45d0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">值:'【T12'并点击'保存'。</p><p id="c978" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果您正在实现上述示例教程中使用的XGBoost模型端点，则您的值字符串可能采用以下格式:</p><p id="2e09" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">值:'<a class="ae jn" href="https://console.aws.amazon.com/sagemaker/home?region=us-east-1#/endpoints/xgboost-2020-04-30-22-01-11-369" rel="noopener ugc nofollow" target="_blank">xgboost-YEAR-MONTH-DATE-xx-xx-xx-</a>XXX '</p><h1 id="06cb" class="km kn hi bd ko kp kq kr ks kt ku kv kw io kx ip ky ir kz is la iu lb iv lc ld bi translated">定义IAM角色</h1><p id="cf17" class="pw-post-body-paragraph jo jp hi jq b jr le ij jt ju lf im jw jx lg jz ka kb lh kd ke kf li kh ki kj hb bi translated">然后向上滚动并点击“权限”选项卡。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lm"><img src="../Images/5b64f744f8399b2183155c8524f684b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LC0H7GgoH4vj2FqK69VVMw.png"/></div></div></figure><p id="bf89" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">点击执行角色&gt;角色名称</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ln"><img src="../Images/e45f19dcee82c5814b8b49b2dc121f0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d4pl_7TEIo6L6TvcadBGcg.png"/></div></div></figure><p id="2c94" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您将被重定向到IAM控制台。</p><ol class=""><li id="9f13" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj lt lu lv lw bi translated">在策略名称下单击您的策略。</li><li id="b391" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated">点击编辑策略&gt; JSON</li><li id="1328" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated">在现有JSON字符串的末尾添加逗号，并在末尾包含以下字符串。</li></ol><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="f33b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">4.不要忘记点击“审查政策”和“保存更改”。</p><p id="d17d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这将赋予Lambda函数调用SageMaker模型端点的权限。</p><h1 id="a26c" class="km kn hi bd ko kp kq kr ks kt ku kv kw io kx ip ky ir kz is la iu lb iv lc ld bi translated"><strong class="ak"> API网关</strong></h1><p id="9309" class="pw-post-body-paragraph jo jp hi jq b jr le ij jt ju lf im jw jx lg jz ka kb lh kd ke kf li kh ki kj hb bi translated">现在在AWS控制台中搜索API网关</p><ul class=""><li id="b8a9" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj mc lu lv lw bi translated">单击REST API部分下的“导入”。</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es md"><img src="../Images/2d896200ac5d92f8a3637addf83b078f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-b8t_ZuA_ZE2E9YjkrjdOw.png"/></div></div></figure><ul class=""><li id="e09f" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj mc lu lv lw bi translated">在“创建新API”下选择“新API”。</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lj"><img src="../Images/1a6d4e0ecacf4196bdc612ecfade5cb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hZDbAZjlTSqQVzb342LNow.png"/></div></div></figure><ul class=""><li id="ba49" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj mc lu lv lw bi translated">在设置中输入“API名称”，然后单击“创建API”。您将被重定向到以下屏幕——</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es md"><img src="../Images/18dc502fbd3a0eb2b24a84b1e9e58830.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lB10JhsY1sww_W43tdzM7A.png"/></div></div></figure><ul class=""><li id="7065" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj mc lu lv lw bi translated">单击“创建资源”。输入“资源名称”并单击“创建资源”。例如，我将我的资源命名为“住房预测”</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lj"><img src="../Images/1dfabe5e8c78133fe75c1efab94140ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lh-XfbFAu35N-EiX9YMvBA.png"/></div></div></figure><ul class=""><li id="b304" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj mc lu lv lw bi translated">单击“操作”和“创建方法”</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es md"><img src="../Images/01de1fe6d11beb9712bf1177f3348f61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HlmBQDzF3G6PJDonpBq3-g.png"/></div></div></figure><ul class=""><li id="eb7e" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj mc lu lv lw bi translated">选择“过帐”方法，然后单击“'✔️”。</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es md"><img src="../Images/403ba3c58e8ffc06fa50a030af668078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UGTjbuqMPu6br_dmD4k3gQ.png"/></div></div></figure><ul class=""><li id="0e4a" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj mc lu lv lw bi translated">输入Lambda函数名并点击“保存”。</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es md"><img src="../Images/85eed399aaf2f3f02f18c88a6e25e2fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YkpRBUyRitXoj99oKJ3DRA.png"/></div></div></figure><ul class=""><li id="b12f" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj mc lu lv lw bi translated">现在转到“操作”并点击“部署API”。</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es md"><img src="../Images/37afc75d711d4613fa659c3e5799a9cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*99sbhAmWQiIyNnXsqoCrHA.png"/></div></div></figure><ul class=""><li id="c4b0" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj mc lu lv lw bi translated">选择“新阶段”并输入阶段名称。例如，对于测试或生产，单击“部署”。</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es md"><img src="../Images/4455055876660ca04447899edd932b31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XihM_bbobZ0_P0h5htPbFA.png"/></div></div></figure><ul class=""><li id="59fe" class="lo lp hi jq b jr js ju jv jx lq kb lr kf ls kj mc lu lv lw bi translated">现在点击Stages &gt; test下的POST，复制以<your-function-name>结尾的调用URL</your-function-name></li></ul><p id="4b33" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">注意:您的URL应该以<your function-name="">结尾，而不是“test”。</your></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es md"><img src="../Images/f0e838a367ca8a1e51c42366703c1a41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3daoOTSh0I3IflDDQ-Koqg.png"/></div></div></figure><p id="e50d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在我们有了Lambda函数、API网关和测试数据(从测试数据中复制单个数据点)，让我们使用Postman测试它，它是一个用于测试web服务的HTTP客户端。你可以在这里下载最新版本的邮递员<a class="ae jn" href="https://www.getpostman.com/apps" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="7d2c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">将调用URL放入Postman，如下图所示，并选择POST as方法。在Body选项卡中，放置测试数据，如下图所示。选择Send按钮，对于XGBoost教程中显示的测试数据，您将看到返回的结果为“1005792.625”。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es md"><img src="../Images/30485fd1af8b8d3e10888a8cae5be26c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QM1M8u6N1j8qoaDn62V8KA.png"/></div></div></figure><p id="9aaf" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">万岁！！🎊🎉🎊您已经创建了一个由Amazon SageMaker部署和托管的模型端点。然后使用调用端点的无服务器架构(一个API网关和一个Lambda函数)调用端点。</p><p id="976a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在你知道如何使用AWS Lamda无服务器函数调用Amazon SageMaker托管的机器学习模型端点了..恭喜你！！！👏👏👏</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es me"><img src="../Images/26209d84bc8879c4c2f957f23bbae6c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hQtgBbFNsFPRHdi_"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">照片由<a class="ae jn" href="https://unsplash.com/@kirbyphotography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">苏珊·奎尔斯拍摄</a>在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure></div></div>    
</body>
</html>