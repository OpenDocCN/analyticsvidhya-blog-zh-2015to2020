<html>
<head>
<title>COVID-19 World Progression — Animated Data Visualization with Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">新冠肺炎世界进展—用Plotly实现动画数据可视化</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/covid-19-world-progression-animated-data-vizualization-with-plotly-1c5dd909822d?source=collection_archive---------9-----------------------#2020-03-23">https://medium.com/analytics-vidhya/covid-19-world-progression-animated-data-vizualization-with-plotly-1c5dd909822d?source=collection_archive---------9-----------------------#2020-03-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7566" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对我来说，隔离意味着学习新的东西，为了了解更多关于新冠肺炎疫情和数据科学的知识，我想调查数据并绘制一些图表。本文解释了所有的工作并展示了结果。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/e5287d1d33f38619cdc803917dcb4fb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ARV6A0QIWlcgLf2k.jpg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">资料来源:freeimages.com</figcaption></figure><h1 id="102c" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">获取数据</h1><p id="62f0" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">第一步是找到可用的数据。在做了一些研究后，我使用了来自约翰·霍普斯金大学的关于确诊病例、死亡和康复的数据。我还使用请求包来下载数据，这样我就可以很容易地更新数据。我还需要每个国家的3位字母代码，我在这里找到了<a class="ae kw" href="https://github.com/lukes/ISO-3166-Countries-with-Regional-Codes/blob/master/all/all.csv" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="dc12" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">预处理</h1><p id="28a0" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">然后，我需要准备数据，将所有数据集整合到一个表中，包含我需要的所有内容。首先，我必须按国家汇总数据，为此，名称需要相同。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="77d0" class="lc ju hi ky b fi ld le l lf lg">import pandas as pd<br/>import copy<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import plotly.express as px<br/><br/>conf = pd.read_csv('data/original/time_series_2019-ncov-Confirmed.csv')<br/>deaths = pd.read_csv('data/original/time_series_2019-ncov-Deaths.csv')<br/><br/>changes = [{'old': 'US', 'new': 'United States of America'},<br/>           {'old': 'Russia', 'new': 'Russian Federation'},<br/>           {'old': 'Venezuela', 'new': 'Venezuela (Bolivarian Republic of)'},<br/>           {'old': 'Bahamas, The', 'new': 'Bahamas'},<br/>           {'old': 'Bolívia', 'new': 'Bolívia (Plurinatioanl State of)'},<br/>           {'old': 'Brunei', 'new': 'Brunei Darussalam'},<br/>           {'old': 'Congo (Brazzaville)', 'new': 'Congo'},<br/>           {'old': 'Congo (Kinshasa)', 'new': 'Congo, Democratic Republic of the'},<br/>           {'old': "Cote d'Ivoire", 'new': "Côte d'Ivoire"},<br/>           {'old': "Gambia, The", 'new': 'Gambia'},<br/>           {'old': "Iran", 'new': 'Iran (Islamic Republic of)'},<br/>           {'old': 'Korea, South', 'new': 'Korea, Republic of'},<br/>           {'old': 'Moldova', 'new': 'Moldova, Republic of'},<br/>           {'old': 'Taiwan*', 'new': 'Taiwan, Province of China'},<br/>           {'old': 'Tanzania', 'new': 'Tanzania, United Republic of'},<br/>           {'old': 'United Kingdom', 'new': 'United Kingdom of Great Britain and Northern Ireland'},<br/>           {'old': 'Vietnam', 'new': 'Viet Nam'}]<br/><br/>for c in changes:<br/>    conf.loc[conf['Country/Region'] == c['old'], 'Country/Region'] = c['new']<br/>    deaths.loc[deaths['Country/Region'] == c['old'], 'Country/Region'] = c['new']<br/>    rec.loc[rec['Country/Region'] == c['old'], 'Country/Region'] = c['new']</span><span id="98cc" class="lc ju hi ky b fi lh le l lf lg">def calc(data):<br/>    data = data.drop(['Lat', 'Long', 'Province/State'], axis=1)<br/>    data = data.groupby('Country/Region')[list(data.columns[1:])].agg('sum')<br/>    return data</span><span id="6c3c" class="lc ju hi ky b fi lh le l lf lg">conf = calc(conf)<br/>deaths = calc(deaths)</span></pre><p id="87f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在死亡数据集中，一些国家的数字在一天中不断减少，因此最快的解决方案是将其值等于死亡发生前一天的值。冰岛的数据也需要修正。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="a339" class="lc ju hi ky b fi ld le l lf lg">def preprocess(data):<br/>    for c in range(1, len(data.columns)-1):<br/>        if (data.iloc[:, c] &lt; data.iloc[:, c-1]).sum() &gt; 0:<br/>            print(data.loc[(data.iloc[:, c] &lt; data.iloc[:, c-1]), :].iloc[:, c],<br/>                  data.loc[(data.iloc[:, c] &lt; data.iloc[:, c-1]), :].iloc[:, c-1])<br/>            data.loc[(data.iloc[:, c] &lt; data.iloc[:, c-1]), data.columns[c]] = data.loc[(data.iloc[:, c] &lt; data.iloc[:, c-1]), data.columns[c-1]]<br/>    return data<br/><br/>deaths = preprocess(deaths)</span><span id="99c3" class="lc ju hi ky b fi lh le l lf lg"># Correcting Iceland data<br/>deaths.loc['Iceland', deaths.loc['Iceland', :] == 5] = 1</span></pre><p id="7b2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，导入国家代码数据集并连接数据。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="299d" class="lc ju hi ky b fi ld le l lf lg">codes = pd.read_csv('data/original/all.csv').set_index('name')[['alpha-3']]</span><span id="810a" class="lc ju hi ky b fi lh le l lf lg">graphDF = codes.join(conf)</span></pre><h1 id="c8e3" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">绘制传播图</h1><p id="3791" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">我想知道的第一件事是新冠肺炎是如何传播到世界各地的，一个很好的图表来理解这一点，将是一个确诊病例和死亡的动画地图。Plotly是一个重要的工具。我使用Plotly内置的世界地图，并通过阿尔法-3代码来识别国家。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="1061" class="lc ju hi ky b fi ld le l lf lg">graphDF = graphDF.loc[graphDF.iloc[:, 1].dropna().index.values, :]<br/>graphDF['country'] = graphDF.index<br/><br/>graphDF = finalDF.melt(id_vars=['country', 'alpha-3'])<br/>graphDF.columns = ['country', 'alpha-3', 'Day', 'N']</span><span id="6d65" class="lc ju hi ky b fi lh le l lf lg"># Created hasCases discrete variable<br/>finalDF.loc[:, 'hasCases'] = ((finalDF.N &gt; 0) * 1).astype('str')</span><span id="f0ff" class="lc ju hi ky b fi lh le l lf lg"># Graph code<br/>fig = px.choropleth(finalDF, locations="alpha-3",<br/>                    color='hasCases', <br/>                    hover_name="Country", # Country to hover info<br/>                    color_discrete_sequence=['gainsboro', 'darkred'], # Chosing the colors of categories<br/>                    title="Countries with Confirmed Cases of COVID-19 arround the World", # Graph title<br/>                    animation_frame='Day',<br/>                    animation_group='Country',<br/>                    template='ggplot2')<br/><br/>fig.update_layout(transition = {'duration': 800})<br/><br/>fig.show()</span></pre><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="li lj l"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">资料来源:约翰·霍普斯金大学</figcaption></figure><p id="0532" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有可能看到亚洲、欧洲和北美是最先暴露于这种病毒的，它刚刚到达南美和非洲。实际上，在第33天之后，传播速度似乎加快了。事实上，在非洲和南美洲，在第一例确诊病例后，传播速度似乎加快了。</p><p id="311d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">绘制完图表后，我用Chart Studio API轻松地上传了它。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="498f" class="lc ju hi ky b fi ld le l lf lg">cs.tools.set_credentials_file(username='lucasgiutavares', api_key='your_api_key')<br/><br/>cs.tools.set_config_file(world_readable=True,<br/>                         sharing='public')<br/><br/>py.plot(fig, filename='COVID-19 Dissemination', auto_open=True)</span></pre><p id="bf02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，除此之外，这些国家是如何处理传播的呢？为了回答这个问题，我调查了死亡率(死亡/确诊病例)。</p><h1 id="aa23" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">绘制死亡率图表</h1><p id="4df8" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">从理论上讲，死亡率较高的国家在处理避免传播、诊断和治疗确诊病例方面可能会有更多的问题，一个动画散点图可以对此提供很好的见解。因此，我再次使用plotly，用令人惊讶的短代码来做这件事。</p><p id="74a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我需要合并确诊病例和死亡病例的数据集。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="fc48" class="lc ju hi ky b fi ld le l lf lg">conf.loc[:, 'Country'] = conf.index<br/>corrGraphData = codes.join(conf)<br/>corrGraphData = corrGraphData.loc[corrGraphData.iloc[:, 1].dropna().index, :]<br/>corrGraphData = corrGraphData.drop(['alpha-3'], axis=1).melt(id_vars=['Country'], var_name='Day', value_name='Cases')<br/>deaths.loc[:, 'Country'] = deaths.index<br/>corrGraphDeaths = codes.join(deaths)<br/>corrGraphDeaths = corrGraphDeaths.loc[corrGraphDeaths.iloc[:, 1].dropna().index, :]<br/>corrGraphDeaths = corrGraphDeaths.drop(['alpha-3'], axis=1).melt(id_vars=['Country'], var_name='Day', value_name='Deaths')<br/>corrGraphData = corrGraphData.join(corrGraphDeaths[['Deaths']])<br/>corrGraphData.loc[:, 'Death Rate'] = (corrGraphData.Deaths / corrGraphData.Cases).fillna(0)</span></pre><p id="e79e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，标绘的代码。大小和颜色代表国家的死亡率。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="0f20" class="lc ju hi ky b fi ld le l lf lg"># Scatter Death Rate Animated Graph<br/>figScatter = px.scatter(corrGraphData, x='Cases', y='Deaths', size='Death Rate', size_max=40,<br/>                        range_x=[10, 160000],<br/>                        range_y=[1, 4900],<br/>                        hover_name='Country',<br/>                        animation_frame='Day',<br/>                        color='Death Rate',<br/>                        title='COVID-19: Deaths by number of confirmed cases',<br/>                        color_continuous_scale=px.colors.sequential.Reds,<br/>                        range_color=[0, 0.05],<br/>                        log_x=True,<br/>                        log_y=True,<br/>                        trendline='lowess',<br/>                        template='plotly_dark')<br/>fig.update_layout(<br/>    xaxis_title="Confirmed Cases",<br/>    yaxis_title="COnfirmed Deaths",<br/>    )<br/><br/>figScatter.show()</span></pre><p id="f8dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上传:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="8b0f" class="lc ju hi ky b fi ld le l lf lg">cs.tools.set_credentials_file(username='lucasgiutavares', api_key='your_api_key')<br/><br/>cs.tools.set_config_file(world_readable=True,<br/>                         sharing='public')<br/><br/>py.plot(figScatter, filename='COVID-19 Deaths rate', auto_open=True)</span></pre><p id="36c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是结果:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="li lj l"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">资料来源:约翰·霍普斯金大学</figcaption></figure><p id="de10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">人们可能会注意到，当第一批病例发生时，许多国家的死亡率很高。在这一主题中，意大利、伊朗和西班牙的发病率有所下降，但仍有很高的发病率和许多病例。其他国家，如索马里、阿尔及利亚、圣马力诺和菲律宾，病例数量较少，但死亡率较高。另一方面，中国和美国的死亡率大幅下降。此外，一些国家，如俄罗斯、德国、冰岛、新加坡，病例数量不多，到目前为止能够保持较低的死亡率。</p><p id="4824" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个重要的限制是，随着患病人数的增加，进行了更多的检查，即使没有症状，因此，确诊的病例也更多。因此，很难想象在短期内国家的行动和死亡率下降之间有什么关系。</p><p id="c0e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请随意自己导航！</p><h1 id="53c4" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="fef3" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">通过一些数据分析，可能会注意到新冠肺炎已经蔓延，但有一些方法来遏制它，这主要取决于每个人，而不仅仅是政府的行动。一些国家比其他国家取得了最好的结果，但做好我们的本分才是最重要的。</p><p id="9275" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，重要的是要记住，我不是传染病科学专家，但我真的喜欢从数据中产生知识，所以如果你能通过提供一些见解或纠正来帮助它，请这样做！</p><p id="025c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，如果你喜欢这篇文章，请鼓掌，并随时提出批评和/或见解。呆在家里！</p></div></div>    
</body>
</html>