<html>
<head>
<title>Machine, Take My Hand: My very first poetry generator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">机器，抓住我的手:我的第一台诗歌生成器</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/machine-take-my-hand-5ab0aef44839?source=collection_archive---------25-----------------------#2020-05-04">https://medium.com/analytics-vidhya/machine-take-my-hand-5ab0aef44839?source=collection_archive---------25-----------------------#2020-05-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/af8c95ddc6f8e544d34c720639f2f405.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*wnNsXFTMIT76X-taX764VQ.png"/></div></figure><p id="a398" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">正如我在<a class="ae jk" rel="noopener" href="/python-in-plain-english/daunting-python-and-the-holy-poetry-generator-d9259913acb">上一篇文章</a>中所描述的，我已经开始着手创建一个诗歌生成器。我头脑中的终极目标是崇高的，令人印象深刻的，在一片浓雾中依然模糊不清。然而，我创造了<a class="ae jk" href="https://polar-earth-97611.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">一样东西</a>，在这篇文章中，我将描述我如何卷起袖子，弄脏我的手(我残疾的、腕骨有隧道的手)，并做出一些不完美的、相当简单的东西，朝着正确的方向迈出了一步。</p><h2 id="4bc2" class="jl jm hi bd jn jo jp jq jr js jt ju jv ix jw jx jy jb jz ka kb jf kc kd ke kf bi translated">收集一些文本！喜欢大量的文字</h2><p id="b38b" class="pw-post-body-paragraph im in hi io b ip kg ir is it kh iv iw ix ki iz ja jb kj jd je jf kk jh ji jj hb bi translated">我决定从零开始，尽可能从<a class="ae jk" href="https://github.com/thundercomb/poetrydb" rel="noopener ugc nofollow" target="_blank"> PoetryDB </a>获取一切，这是一个<a class="ae jk" href="https://www.gutenberg.org/" rel="noopener ugc nofollow" target="_blank">项目，类似古腾堡</a>的公共领域诗集，为“网络诗人”设计。它存在的原因是实际的:</p><blockquote class="kl km kn"><p id="7bbc" class="im in ko io b ip iq ir is it iu iv iw kp iy iz ja kq jc jd je kr jg jh ji jj hb bi translated">“互联网技术让文字变得无休止地被操纵，传统的诗人和作家正在被抛在后面。我想改变这种情况，让我们所有人都有一个更强大的未来。”</p></blockquote><p id="f8de" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是一个可以利用的好资源，也是一个完美的起点。站点<a class="ae jk" href="http://poetrydb.org/index.html" rel="noopener ugc nofollow" target="_blank">完全基于API调用；这里没有通航的道路，也没有UX可言。这是诗人和程序员的天堂。在弄清楚正确的URL语法之后，是时候创建一些函数并施展一些API魔法了。</a></p><p id="b15b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">以下是我的操作顺序:</p><ul class=""><li id="f448" class="ks kt hi io b ip iq it iu ix ku jb kv jf kw jj kx ky kz la bi translated">我收集了他们所有诗人的名单，</li><li id="831c" class="ks kt hi io b ip lb it lc ix ld jb le jf lf jj kx ky kz la bi translated">从中我收集了每位诗人的诗的标题列表，</li><li id="1e06" class="ks kt hi io b ip lb it lc ix ld jb le jf lf jj kx ky kz la bi translated">我从中提取了每首诗的诗句。</li></ul><p id="ffc1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">把这些线连在一起，瞧！PoetryDB上的260万个单词。你问260万？？嗯，算是吧。</p><p id="64f4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">隐藏在这一切之中的是我不得不在这个过程中做出的一些关键决定，这些决定让260万这个数字显得有些不精确。请允许我列举一些原因。</p><p id="00e8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">当代化<br/> </strong>我们假设这是一个词。我对其他生成器的抱怨之一是对过去诗歌形式的模仿——即十四行诗和俳句。过去的事了，伙计！展望未来！</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lg"><img src="../Images/9788da00c63e5bf776a7ab79c52b141d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*57j4oejqEFGiF90nS9wK6Q.jpeg"/></div></div></figure><p id="3d2b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我的想法是:通过包含换行符(' \n ')和制表符(' \t ')，使我的生成器现代化。这比我想象的要复杂，因为Python将这些元素视为空白空间或其他东西。想象一下！啊，但是诗人看到了空虚中的实质。然而，如果你不小心，运行一个必要的功能将蒸发你所有的宝贵空间。</p><p id="ff27" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">稍后会有更多的介绍…现在，我只知道我用换行符将所有的诗连接在一起… <br/>然后所有的诗也用换行符连接在一起… <br/>并将两个连续空格的所有实例转换成一个制表符… <br/>给我留下一长串单词<em class="ko"> + </em>总共260万个空格。嗯…基本上。</p><p id="fbad" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">标点还是不标点？<br/> </strong>这就是问题。考虑到当代诗歌的现状，我认为让所有的内容都小写并去掉大部分标点符号是一个相当稳妥的选择，但是你真的想解散已经筋疲力尽的团队吗？还是把<em class="ko">neer</em>变成<em class="ko"> neer </em>？过去两周，我每天晚上都在问自己这些问题，你猜怎么着:我还是不知道。所以罗伯特·弗罗斯特该死！两条路我都走了。(而且最后肯定是两个不同的字数。)</p><p id="1cd7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">单词标记化vs分词<br/> </strong>这两个概念最终定义了我选择的每一条路径，也因此定义了我最终使用的两个版本的生成器，所以让我们来定义它们。</p><p id="c28f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="ko">单词标记化(即nltk . Word _ token ize(str))</em><br/>简单来说，这是取一个单词串，返回该串中每个单词的列表，每个单词一般用空格或标点符号隔开。它可以变得更复杂，但是因为我已经去掉了所有不包含在单词中的标点符号，这就是我需要的所有符号化。</p><p id="a88c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><a class="ae jk" href="https://www.nltk.org/" rel="noopener ugc nofollow" target="_blank"> NLTK </a>是金标准。我有一种感觉，在不久的将来，我会更深入地钻研文档。</p><p id="6935" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">令人惊讶的是，这可能是更复杂的术语，至少就代码如何工作而言。简单地说，这是将一串没有空格的单词分开的行为。这需要英语(或其他语言)的一些机器知识，然后使用它知道的单词的频率和它们出现的概率来将未分隔的文本分割成单词列表。</p><p id="7f06" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><a class="ae jk" href="https://github.com/keredson/wordninja" rel="noopener ugc nofollow" target="_blank">单词忍者</a>是我发现的最快和最直观的分词器，尽管还有其他的<a class="ae jk" href="https://towardsdatascience.com/fast-word-segmentation-for-noisy-text-2c2c41f9e8da" rel="noopener" target="_blank">选项</a>。</p><p id="0708" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">基本上:</p><pre class="lh li lj lk fd lp lq lr ls aw lt bi"><span id="a0b2" class="jl jm hi lq b fi lu lv l lw lx">wordninja.split('thequickbrownfox')</span></pre><p id="4114" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">变成了:</p><pre class="lh li lj lk fd lp lq lr ls aw lt bi"><span id="64cd" class="jl jm hi lq b fi lu lv l lw lx">['the', 'quick', 'brown', 'fox']</span></pre><p id="a748" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">标记化的问题是，它没有考虑可能被错误地挤在一起的单词，这在大型文本资源(如Project Gutenberg和PoetryDB)中是必然会发生的。当运行我的生成器的第一个测试时，这些偶然的连接很快就显示出来了，它返回了womp womps，如<em class="ko"> pluralsays </em>和okayyyys，如<em class="ko"> satanmeans </em>。或者还有<em class="ko">恶臭y-dight</em>……那到底是怎么进去的？</p><p id="fb95" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后是Word Ninja，它非常快速地完成一件非常复杂的事情(比我尝试过的所有其他分段器都快)，但仍然有过度分段单词的趋势。所以你最终可能会得到类似“con mig gs”的东西。不知何故“米格”和“gs”成了单词？</p><p id="6d18" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">保存你的空瓶子！尽管有所不同，这些方法有一个(个人而言)令人沮丧的相似之处:它们跳过空白，有效地删除它们。我所有的宝贝都不见了！令牌化的一个变通方法相当简单:您可以用类似于“x2”和“y2”的东西来替换这些术语，然后在以后恢复它们。</p><p id="0b6d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">但是对于单词忍者来说，‘x2’会变成‘x’和‘2’；似乎除了单词以外的任何东西都会被分割。尽管如此，你不能用任何旧词来替换它，因为它很有可能出现在文本中，所以你以后会过度还原它。幸运的是，考虑到源诗的年代久远，我可以用<strong class="io hj">‘飞机’</strong>和<strong class="io hj">‘汽车’</strong>来代替它们，这两个词没有出现在文本的任何地方，也没有被单词Ninja分割。万岁。</p><h2 id="a815" class="jl jm hi bd jn jo jp jq jr js jt ju jv ix jw jx jy jb jz ka kb jf kc kd ke kf bi translated"><strong class="ak">创建字典</strong></h2><p id="35c4" class="pw-post-body-paragraph im in hi io b ip kg ir is it kh iv iw ix ki iz ja jb kj jd je jf kk jh ji jj hb bi translated">所以我们得到了我们的单词，2641563个通过切分，2534938个通过标记化。但是十万字算什么…</p><p id="94ca" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">反正！从这个庞大的单词列表中，我们可以:</p><ul class=""><li id="fecc" class="ks kt hi io b ip iq it iu ix ku jb kv jf kw jj kx ky kz la bi translated">创建一个字典，其中每个唯一的单词都是一个键</li><li id="03fe" class="ks kt hi io b ip lb it lc ix ld jb le jf lf jj kx ky kz la bi translated">每个键的值是一个列表，其中包含原始文本中该键后面的每个单词</li></ul><p id="b446" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后是关键时刻，写一个函数把“飞机”和“汽车”还原到空白空间。</p><p id="383a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后砰！一个<a class="ae jk" href="https://files.cargocollective.com/c714448/poems_dictionary.json" rel="noopener ugc nofollow" target="_blank"> 21MB JSON文件</a>。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es ly"><img src="../Images/420f8419bb6b7e84b4413c494e68cc07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*l-uAuTp3tsbGNpyQirUEsA.jpeg"/></div></figure><p id="17ff" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在那里，您可以编写一个函数:</p><ul class=""><li id="264f" class="ks kt hi io b ip iq it iu ix ku jb kv jf kw jj kx ky kz la bi translated">从字典中选择一个随机键</li><li id="38e2" class="ks kt hi io b ip lb it lc ix ld jb le jf lf jj kx ky kz la bi translated">然后从下面的单词列表中随机选择一个单词</li><li id="0815" class="ks kt hi io b ip lb it lc ix ld jb le jf lf jj kx ky kz la bi translated">然后使用随机单词作为下一个密钥</li><li id="aedf" class="ks kt hi io b ip lb it lc ix ld jb le jf lf jj kx ky kz la bi translated">继续下去，直到你达到你选择的字数。</li></ul><h2 id="1208" class="jl jm hi bd jn jo jp jq jr js jt ju jv ix jw jx jy jb jz ka kb jf kc kd ke kf bi translated">当代诗歌押韵吗？</h2><p id="44f7" class="pw-post-body-paragraph im in hi io b ip kg ir is it kh iv iw ix ki iz ja jb kj jd je jf kk jh ji jj hb bi translated">只要有时间！我的另一个目标是尝试Allison Parrish的<a class="ae jk" href="https://github.com/aparrish/pronouncingpy" rel="noopener ugc nofollow" target="_blank">发音</a>，它有一个押韵功能，可以列出输入单词的所有押韵。我创建了不同程度押韵的新功能，从用所选单词的押韵替换每行的结尾，用押韵替换整首诗中随机出现的单词，以及用押韵替换每个单词(如果有的话)。</p><p id="eea3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">咻！非常有趣！如果你一路过关斩将(即使你没有成功)，试试这里:<a class="ae jk" href="https://polar-earth-97611.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> auto_pometizer </a>。点击此处查看该项目的<a class="ae jk" href="https://github.com/p-szymo/poetrydb_poem_generator" rel="noopener ugc nofollow" target="_blank">回购</a>。</p><p id="5522" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了方便起见，下面是每个函数的一些简短示例:</p><p id="391c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">segmented_auto_pometizer:</p><pre class="lh li lj lk fd lp lq lr ls aw lt bi"><span id="ec1a" class="jl jm hi lq b fi lu lv l lw lx"> encircle me <br/> then take ismail and me i guess 	 <br/> for fooling swearing play 	 such things that it hail <br/> with all things now feasts <br/> returned</span></pre><p id="8d56" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">tokenized_auto_pometizer:</p><pre class="lh li lj lk fd lp lq lr ls aw lt bi"><span id="e5cc" class="jl jm hi lq b fi lu lv l lw lx">weaves rainbows to his footstep <br/> love 's love is thy ruthless hand <br/> a pyramid <br/> whether through all besprent <br/> above thine immortal town to pine <br/> most</span></pre><p id="3291" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">endline_rhyme_auto_pometizer:</p><pre class="lh li lj lk fd lp lq lr ls aw lt bi"><span id="8e47" class="jl jm hi lq b fi lu lv l lw lx">ahem <br/> we boldly to sayn <br/> he leaped <br/> that old wounds of those who for very own <br/> or eternal mcbride <br/> our 	 be to get long</span></pre><p id="af3c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">random_rhyme_auto_pometizer:</p><pre class="lh li lj lk fd lp lq lr ls aw lt bi"><span id="a695" class="jl jm hi lq b fi lu lv l lw lx">asti ties of hours have brode <br/> putt biz my tenth another 	 	 	 	 <br/> both wings <br/> ang and fast towards our ingots bags <br/> but tears</span></pre><p id="2a42" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">full_rhyme_auto_pometizer:</p><pre class="lh li lj lk fd lp lq lr ls aw lt bi"><span id="e68f" class="jl jm hi lq b fi lu lv l lw lx">parched goard under-age nav moliere shove downbeat <br/> 	 fluoresce marquis leicht chiu beneficiary queue <br/> corbu convert sai truthful dansie and ras superpower nies <br/> trivette coo last</span></pre><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lz"><img src="../Images/055ca4917552d7ca282eefe8a058f9bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hYtbqPcQ_HC6vcs1lgGJBg.jpeg"/></div></div><figcaption class="ma mb et er es mc md bd b be z dx translated">(<a class="ae jk" href="https://www.reddit.com/r/OldSchoolCool/comments/amnz4v/this_kid_with_the_power_glove_1989/" rel="noopener ugc nofollow" target="_blank">来源</a>)</figcaption></figure></div></div>    
</body>
</html>