<html>
<head>
<title>Harry Potter’s Invisibility Cloak — Using OpenCV, Python — Computer Vision</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">哈利·波特的隐身衣——使用OpenCV、Python——计算机视觉</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/harry-potter-invisibility-cloak-using-opencv-python-4fa6796816f5?source=collection_archive---------14-----------------------#2020-04-25">https://medium.com/analytics-vidhya/harry-potter-invisibility-cloak-using-opencv-python-4fa6796816f5?source=collection_archive---------14-----------------------#2020-04-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="5cb4" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">学习和执行OpenCV、Python的一个很棒的项目</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ix"><img src="../Images/2b2f4db223f75b794ac454b27137736d.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/1*890yQXEd9YajkpkSa-tkDQ.gif"/></div><figcaption class="jf jg et er es jh ji bd b be z dx translated">哇哦。！</figcaption></figure><p id="baa6" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">哈利从他父亲那里得到了他的隐形衣，而我们可以用OpenCV创造我们自己的隐形衣，并检查它穿在我们身上的样子。<strong class="jl hj">是的！不需要去霍格沃茨，你需要的只是学习的兴趣和一台电脑。</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kf"><img src="../Images/92eae4e063a5dbc2316f6132feb53fa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I4G4iUcuBBbOHyHCpaQzow.jpeg"/></div></div><figcaption class="jf jg et er es jh ji bd b be z dx translated">算法！</figcaption></figure><h1 id="acf9" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">我们要怎么做？</h1><p id="f40b" class="pw-post-body-paragraph jj jk hi jl b jm lc ij jo jp ld im jr js le ju jv jw lf jy jz ka lg kc kd ke hb bi translated">我们都听说过<strong class="jl hj">绿屏</strong>，所有那些电影里的<strong class="jl hj"> VFX特效</strong>。这里我们做的与绿色筛选相反(去除背景)，<strong class="jl hj">是的，我们去除前景</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lh"><img src="../Images/f3fec5d4d2fc9623fe34385f79d18152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*TLqy4r12qzNDkAt7Au37nA.gif"/></div><figcaption class="jf jg et er es jh ji bd b be z dx translated">在行动！</figcaption></figure><p id="c7c2" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这里我用了蓝色的布。我能用别的颜色吗！是的，红色、绿色也可以</p><h2 id="18db" class="li kl hi bd km lj lk ll kq lm ln lo ku js lp lq kw jw lr ls ky ka lt lu la lv bi translated">让我们设置环境</h2><p id="cd64" class="pw-post-body-paragraph jj jk hi jl b jm lc ij jo jp ld im jr js le ju jv jw lf jy jz ka lg kc kd ke hb bi translated">我们需要安装OpenCV(开源计算机视觉)库，它可以帮助我们执行与计算机视觉相关的任务。<a class="ae lw" href="https://www.youtube.com/watch?v=d3AT9EGp4iw" rel="noopener ugc nofollow" target="_blank">我们需要对OpenCV库进行pip安装。</a></p><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="097b" class="li kl hi ly b fi mc md l me mf">pip install opencv-python</span></pre><h2 id="e3c5" class="li kl hi bd km lj lk ll kq lm ln lo ku js lp lq kw jw lr ls ky ka lt lu la lv bi translated">打开Spyder(安装-<a class="ae lw" href="https://www.youtube.com/watch?v=5mDYijMfSzs" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=5mDYijMfSzs</a></h2><h2 id="8210" class="li kl hi bd km lj lk ll kq lm ln lo ku js lp lq kw jw lr ls ky ka lt lu la lv bi translated">导入库</h2><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="7ae7" class="li kl hi ly b fi mc md l me mf">import cv2<br/>import numpy as np<br/>import time</span></pre><h2 id="8d79" class="li kl hi bd km lj lk ll kq lm ln lo ku js lp lq kw jw lr ls ky ka lt lu la lv bi translated">捕捉视频</h2><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="16df" class="li kl hi ly b fi mc md l me mf">Video_capture = cv2.VideoCapture(0)</span></pre><p id="94a7" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">读取视频文件的第一步是创建一个VideoCapture对象。它的参数可以是设备索引。<em class="mg"> (0-集成网络摄像头，1-外置网络摄像头等等..)</em></p><h2 id="bba2" class="li kl hi bd km lj lk ll kq lm ln lo ku js lp lq kw jw lr ls ky ka lt lu la lv bi translated">让系统摄像头预热！</h2><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="561b" class="li kl hi ly b fi mc md l me mf">time.sleep(3)<br/>background = 0</span></pre><p id="05fd" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">Python的时间睡眠功能是用来增加程序执行的延迟。当执行time.sleep(t)语句时，下一行代码将在t秒后执行。</p><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="5a01" class="li kl hi ly b fi mc md l me mf">for i in range(45):<br/>    ret, background = Video_capture.read()<br/>background = np.flip(background, axis=1)</span></pre><p id="7048" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这里我们捕捉45度范围内的背景，并翻转(字面上)背景</p><h1 id="03c9" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">颜色检测和分割</h1><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="06b7" class="li kl hi ly b fi mc md l me mf">while (Video_capture.isOpened()):<br/>    ret, frame = cap.read()<br/>    if not ret:<br/>        break<br/>    frame= np.flip(frame, axis=1)</span></pre><p id="039f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这里我们创建一个while循环来捕获帧并运行帧。<em class="mg"> capture.read() </em>返回一个布尔值(真/假)。如果读框正确，则为真。<em class="mg">“ret”</em>将从获取相机帧中获取返回值，真或假。<em class="mg">“帧”</em>将获取相机中的下一帧(通过“捕捉”)。</p><p id="a817" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><em class="mg">“若不ret: <br/>破”。如果帧没有被返回，这段代码就中断循环。</em></p><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="23ed" class="li kl hi ly b fi mc md l me mf">#Converting the color space from BGR to HSV<br/>   hsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)</span></pre><p id="6dda" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">BGR — HSV是OpenCV中可用的颜色空间转换方法之一。对于颜色转换，我们使用函数cv2.cvtColor(input_image，flag ),其中flag确定转换的类型。对于BGR -HSV，我们使用旗<em class="mg"> cv2。COLOR_BGR2HSV </em>。"<em class="mg"> Video_capture.read" </em>它以BGR(蓝-绿-红)颜色捕捉帧，而我们使用HSV格式进行遮罩。因此，我们翻转框架的颜色代码。</p><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="ae9e" class="li kl hi ly b fi mc md l me mf">#<em class="mg">Creating masks with ranges of blue color to detect</em><br/>  lower_blue = np.array([94, 80, 2])<br/>  upper_blue = np.array([126, 255, 255])<br/>  mask_all = cv2.inRange(hsv,lower_blue,upper_blue)</span></pre><p id="1544" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们正在为颜色(蓝色)创建一个范围，其中我们定义了蓝色最高部分的最低部分(HSV的最低和最高值)。"<em class="mg"> inRange" </em>函数返回一个二进制掩码，其中白色像素(255)表示落在上限和下限范围内的像素，而黑色像素(0)则不在此范围内。我们生成一个遮罩来确定帧中与检测到的蓝色相对应的区域</p><h2 id="ccc7" class="li kl hi bd km lj lk ll kq lm ln lo ku js lp lq kw jw lr ls ky ka lt lu la lv bi translated">选择你的颜色，创造隐形斗篷</h2><p id="ad5f" class="pw-post-body-paragraph jj jk hi jl b jm lc ij jo jp ld im jr js le ju jv jw lf jy jz ka lg kc kd ke hb bi translated">只需替换代码片段</p><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="9e50" class="li kl hi ly b fi mc md l me mf">#Range of different colors<strong class="ly hj"><br/>Red color</strong><br/>low_red = np.array([161, 155, 84]) high_red = np.array([179, 255, 255])<br/><strong class="ly hj">Blue color</strong><br/>low_blue = np.array([94, 80, 2]) high_blue = np.array([126, 255, 255])<br/><strong class="ly hj">Green color</strong><br/>low_green = np.array([25, 52, 72]) high_green = np.array([102, 255, 255])<br/><strong class="ly hj">Every color except white</strong><br/>low = np.array([0, 42, 0]) high = np.array([179, 255, 255])</span></pre><p id="bae6" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">现在，我们必须完善这个面具，然后用它来分割出框架的布。</p><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="31b1" class="li kl hi ly b fi mc md l me mf">#Doing morphological operations<br/>mask_all = cv2.morphologyEx(mask_all, cv2.MORPH_OPEN, np.ones((3,3),np.uint8))<br/>mask_all = cv2.morphologyEx(mask_all, cv2.MORPH_DILATE, np.ones((3,3),np.uint8))</span></pre><p id="b0f7" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这里我们使用cv2.morphologyEx执行一些<a class="ae lw" href="https://docs.opencv.org/trunk/d9/d61/tutorial_py_morphological_ops.html" rel="noopener ugc nofollow" target="_blank">形态变换</a>(基于图像形状的操作)。它需要三个输入，一个是我们的原始图像，操作符和<strong class="jl hj">内核</strong>大小。“np.ones((3，3)，np.uint8)”是内核，其中(3，3)是大小，<em class="mg">“NP . unit 8”</em>是数据类型。</p><p id="09f8" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们在这里使用的形态学算子是开和膨胀。膨胀增加了帧中的白色区域，或者前景对象的尺寸增加。打开只是腐蚀的另一个名字，然后是膨胀。它在消除噪音方面很有用。侵蚀(就像土壤侵蚀一样，侵蚀边界)消除了白噪声，但它也缩小了我们的对象。所以我们扩大它。既然噪音没了，他们就不会回来了，但是我们的对象面积增加了。它也有助于连接物体的断裂部分。</p><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="ed7e" class="li kl hi ly b fi mc md l me mf">#Create an inverted mask to segment out the blue from the #frame(hiding the blue part)<br/>mask1 = cv2.bitwise_not(mask_all)</span><span id="819c" class="li kl hi ly b fi mh md l me mf">## Segment the blue color part out of the frame using bitwise and #with the inverted mask<br/>streamA = cv2.bitwise_and(frame,frame,mask=mask1)</span><span id="067a" class="li kl hi ly b fi mh md l me mf"># Creating an image showing static background frame pixels only for #the masked region<br/>streamB = cv2.bitwise_and(background, background, mask = mask_all)</span></pre><p id="3477" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这里，我们用静态背景区域的相应像素值替换检测到的蓝色区域的像素值，这给了我们一个创建效果的增强输出，将我们的衣服转换成一件隐身衣。为此，我们使用<a class="ae lw" href="https://www.youtube.com/watch?v=mc846qb0ngk" rel="noopener ugc nofollow" target="_blank">位与、位非运算。</a></p><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="7ddd" class="li kl hi ly b fi mc md l me mf">#Generating the final output<br/>output = cv2.addWeighted(streamA,1,streamB,1,0)<br/>cv2.imshow("Thankyou_Dumbledore",output)<br/>if cv2.waitKey(1) == 27:<br/>     break</span></pre><p id="b5c0" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这里我们使用“<em class="mg">add weighted”</em>对象进行反锐化掩模。函数<strong class="jl hj"> cv2.imshow() </strong>用于在窗口中显示图像。第一个参数是窗口名，它是一个字符串。第二个论点是我们的形象。</p><p id="07df" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><em class="mg">"如果cv2 . wait key(25)= = 27:"</em>wait key函数显示指定毫秒的图像。否则，它不会显示图像。例如，waitKey(0)将无限显示窗口，直到任何按键。等待键(25)将显示一帧25毫秒，这里我们指定1毫秒后显示将自动关闭。因为我们把它放在一个循环中，所以它会逐帧显示视频</p><p id="6104" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">27是“Esc”的键码。按“Esc”停止播放视频。<strong class="jl hj"> break </strong>是<strong class="jl hj"> python </strong>中的一个关键字，用于将程序控制带出循环。</p><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="1d24" class="li kl hi ly b fi mc md l me mf">Video_capture.release()<br/>cv2.destroyAllWindows()</span></pre><p id="65d5" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这将释放网络摄像头，然后关闭所有imshow()窗口。</p><h1 id="6830" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">雅斯！！</h1><h2 id="9ff0" class="li kl hi bd km lj lk ll kq lm ln lo ku js lp lq kw jw lr ls ky ka lt lu la lv bi translated">最后，我们使用OpenCV库成功地用Python创建了我们自己的隐形斗篷代码。尝试使用我们在其他项目中使用的方法。</h2><blockquote class="mi"><p id="9a8d" class="mj mk hi bd ml mm mn mo mp mq mr ke dx translated">加油。！</p></blockquote><p id="bbf5" class="pw-post-body-paragraph jj jk hi jl b jm ms ij jo jp mt im jr js mu ju jv jw mv jy jz ka mw kc kd ke hb bi translated">全代码！</p><p id="c5a8" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">Github知识库链接—<a class="ae lw" href="https://github.com/Davinci-Decoder/ML-AI" rel="noopener ugc nofollow" target="_blank">https://github.com/Davinci-Decoder/ML-AI</a></p><p id="cdcf" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">参考资料:【https://www.learnopencv.com/】T2；【https://docs.opencv.org/2.4/index.html T4】</p></div></div>    
</body>
</html>