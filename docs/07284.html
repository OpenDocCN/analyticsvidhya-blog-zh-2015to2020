<html>
<head>
<title>Frequently Asked Questions(FAQ) in Building and Dockerizing Flask-MongoDB Web Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建和对接Flask-MongoDB Web应用程序的常见问题(FAQ)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/frequently-asked-questions-faq-in-building-and-dockerizing-flask-mongodb-web-application-2bcb92d1f133?source=collection_archive---------27-----------------------#2020-06-19">https://medium.com/analytics-vidhya/frequently-asked-questions-faq-in-building-and-dockerizing-flask-mongodb-web-application-2bcb92d1f133?source=collection_archive---------27-----------------------#2020-06-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es im"><img src="../Images/1375098580d743cd9855d565ef3bc6be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nr5PUavibPIx0i4c"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">Jules Bss 在<a class="ae jc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="5edd" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">有一个主题的常见问题总是很有帮助的。</p><p id="b4ab" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们的文章是一个简单的FAQ，包含了用flask和mongoDB构建和编写web应用程序时常见的令人困扰的错误(FDE)。</p><blockquote class="kb kc kd"><p id="c560" class="jd je ke jf b jg jh ji jj jk jl jm jn kf jp jq jr kg jt ju jv kh jx jy jz ka hb bi translated">开发者永远不会满足于单一的框架。他们正在寻求将多种技术融入他们的学习堆栈中。</p></blockquote><h1 id="5fb9" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">常见问题解答</h1><h2 id="5579" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">为什么是烧瓶？</h2><p id="1fba" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">Flask是一个构建web应用程序的简单web框架。</p><p id="dfa2" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Flask不像Django那样是全栈web框架。但是它是一个依靠第三方库来服务的微观框架。</p><p id="7626" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">有了flask，你将有很好的学习机会和对你的应用程序的控制，例如，构建功能的方式。</p><h2 id="9a9b" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">为什么是MongoDB？</h2><p id="d06b" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">我们日常生活中的数据没有很好的组织。所以我们的数据库必须准备好处理不同的数据类型。MongoDB是一个面向文档的数据库，为高效的数据处理提供了多种选择。</p><h2 id="fe9f" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">为什么要码头化？</h2><p id="4926" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">Docker容器维护运行应用程序的完整环境。</p><p id="2e78" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">有了docker，你可以用更少的资源运行任何版本的python和任何操作系统的组合。</p><h2 id="d71f" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">PyMongo vs MongoEngine</h2><p id="5788" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">PyMongo返回JSON格式的输出或字符串引用的字典。</p><p id="efab" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">MongoEngine允许您创建一个模式来更好地处理数据。这使得你的代码清晰。</p><p id="c127" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">所以比起pymongo我更喜欢MongoEngine。我将在文章的最后提供一个github链接，链接到用mongo engine开发的web应用程序。</p><h1 id="d3c3" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">场减速器(Field Decelerator)</h1><h2 id="367e" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">缩进误差</h2><p id="56af" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">尽管python中没有分号和大括号，但一个简单的空格在这里也能派上用场。</p><p id="bef8" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">使用一个好的IDE来避免这个错误。</p><h2 id="be80" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">无模函数</h2><p id="9afc" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">“pip安装<module>”是解决没有找到模块错误的终极答案。</module></p><h2 id="d8dd" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">找不到路线</h2><p id="82e4" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">在你的“routes.py”中完美提供路线。</p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="1d3b" class="lg kj hi ma b fi me mf l mg mh"><a class="ae jc" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route("/logout")<br/>def logout():<br/>    flash(f"{session.get('username')}, you are successfully logged   <br/>              out!", "success")</span><span id="6e1a" class="lg kj hi ma b fi mi mf l mg mh">    session.pop('username',None)<br/>    session.pop('role',None)<br/>    return redirect(url_for('login'))</span></pre><h2 id="1231" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">渲染模板错误</h2><p id="0ff8" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">渲染模板时最常见的错误是在render_template前缺少“return”。</p><p id="eab0" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">将所有必需的参数传递给模板。</p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="66de" class="lg kj hi ma b fi me mf l mg mh">return render_template("customer/delete_customer.html",form=form,title="Delete customer")</span></pre><h2 id="cccf" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">不起作用的URL</h2><p id="9ebd" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">使用url_for函数引用路由，而不是将url写入字符串。</p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="75b9" class="lg kj hi ma b fi me mf l mg mh">return redirect(url_for('index'))</span></pre><h2 id="3afc" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">重复的函数名</h2><p id="6b4e" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">每个回调函数都有一个唯一的函数名。</p><p id="e2dd" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">以下代码将引发错误</p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="e0fb" class="lg kj hi ma b fi me mf l mg mh">@app.route('/in')<br/>def fun():<br/>    ....</span><span id="2d49" class="lg kj hi ma b fi mi mf l mg mh">@app.route('/out')<br/>def fun():<br/>    ....</span></pre><h2 id="2ebb" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">无法连接到服务器</h2><p id="9f17" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">如果你在本地用数据库运行你的应用，那么确保在另一个终端运行“mongod”。</p><p id="84e0" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果是最新版本的Mac，你会得到一个简单的“mongod”错误。</p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="87c1" class="lg kj hi ma b fi me mf l mg mh">cd Documents(or any other preferred location)<br/>mkdir data<br/>cd data<br/>mkdir db<br/>cd ..<br/>cd..<br/>mongod --dbpath ~/documents/data/db</span></pre><h2 id="eb45" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">密钥丢失</h2><p id="74fa" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">请确保将您的密钥设置到您的flask应用程序，以便进行有效的会话管理。</p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="8fa8" class="lg kj hi ma b fi me mf l mg mh">#config.py<br/>class Config(object):<br/>    SECRET_KEY=os.environ.get("SECRET_KEY") or "secret_string"</span><span id="cf5f" class="lg kj hi ma b fi mi mf l mg mh">#app.py</span><span id="5d43" class="lg kj hi ma b fi mi mf l mg mh">app = Flask(__name__)<br/>app.config.from_object(Config)</span></pre><h2 id="2a85" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">使用中的端口</h2><p id="32bb" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">要检查正在运行的端口，请使用以下命令</p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="3705" class="lg kj hi ma b fi me mf l mg mh">sudo lsof -iTCP -sTCP:LISTEN -n -P</span></pre><p id="c34b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">使用“sudo kill <id>”终止id为的mongod进程。现在用“mongod”命令重新启动。</id></p><h2 id="198a" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">停靠后的意外行为</h2><p id="f1f7" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">别忘了链接docker-compose.yml里面的db。</p><p id="d3fa" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">另外，确保在docker-compose.yml的卷中指定正确的目录名。</p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="2773" class="lg kj hi ma b fi me mf l mg mh">#Dockerfile </span><span id="ca55" class="lg kj hi ma b fi mi mf l mg mh">FROM python:3.7<br/>ADD . /bank<br/>WORKDIR /bank<br/>RUN pip install -r requirements.txt</span><span id="41ec" class="lg kj hi ma b fi mi mf l mg mh">#docker-compose.yml</span><span id="f6a1" class="lg kj hi ma b fi mi mf l mg mh">web:<br/>  build: .<br/>  command: python -u main.py<br/>  ports:<br/>    - "5000:5000"<br/>  volumes:<br/>    - .:/bank<br/>  links:<br/>    - db<br/>db:<br/>  image: mongo:4.2.5</span></pre><h2 id="5605" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">对接时出现端口错误</h2><p id="4474" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">如果对接后端口有任何错误，用以下代码修改</p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="ebe8" class="lg kj hi ma b fi me mf l mg mh">if __name__ == "__main__":<br/>    app.run(host="0.0.0.0", debug=True)</span></pre><h2 id="c23a" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">停靠后数据库的连接问题</h2><p id="1589" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">确保config.py中有mongodb设置，如下所示</p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="58c1" class="lg kj hi ma b fi me mf l mg mh">#config.py</span><span id="a4eb" class="lg kj hi ma b fi mi mf l mg mh">class Config(object):<br/>    SECRET_KEY=os.environ.get("SECRET_KEY") or "secret_string"<br/>    MONGODB_SETTINGS = { 'db' : 'MY_BANK' ,'host' :   <br/>         os.environ["DB_PORT_27017_TCP_ADDR"] , 'port': 27017}</span><span id="9cf3" class="lg kj hi ma b fi mi mf l mg mh">#app.py</span><span id="b37c" class="lg kj hi ma b fi mi mf l mg mh">app = Flask(__name__)<br/>app.config.from_object(Config)</span><span id="7a96" class="lg kj hi ma b fi mi mf l mg mh">db = MongoEngine()<br/>db.init_app(app)</span></pre><h2 id="aa78" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">模板中缺少标记</h2><p id="f7a6" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">确保已经为模板中的条件语句和循环给出了结束标记。</p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="6da7" class="lg kj hi ma b fi me mf l mg mh">{{ if k }}<br/>....<br/>{{ endif }}</span></pre><h2 id="daff" class="lg kj hi bd kk lh li lj ko lk ll lm ks jo ln lo kw js lp lq la jw lr ls le lt bi translated">丢失的CSRF令牌</h2><p id="db19" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">CSRF令牌由服务器端应用程序生成，并发送给客户端，包含在请求中。</p><p id="3668" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">您将看不到应用程序的预期行为。要知道发生了这个错误，需要打印“form.errors”。</p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="11ff" class="lg kj hi ma b fi me mf l mg mh">#include following anywhere in your template</span><span id="c42c" class="lg kj hi ma b fi mi mf l mg mh">{{ form.hidden_tag() }}</span></pre><h1 id="991d" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">完整的Web应用程序</h1><p id="4d73" class="pw-post-body-paragraph jd je hi jf b jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka hb bi translated">这是一个用flask和mogodb制作的完整的dockerized bank web应用程序的链接。</p><div class="mj mk ez fb ml mm"><a href="https://github.com/maheshsai252/bank-flask" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab dw"><div class="mo ab mp cl cj mq"><h2 class="bd hj fi z dy mr ea eb ms ed ef hh bi translated">maheshsai252/bank-flask</h2><div class="mt l"><h3 class="bd b fi z dy mr ea eb ms ed ef dx translated">一个基本的flask web应用程序，可以执行所有的银行操作。</h3></div><div class="mu l"><p class="bd b fp z dy mr ea eb ms ed ef dx translated">github.com</p></div></div><div class="mv l"><div class="mw l mx my mz mv na iw mm"/></div></div></a></div><p id="9e23" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">感谢您的阅读:)</p></div></div>    
</body>
</html>