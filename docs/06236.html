<html>
<head>
<title>Dynamic Memory Allocation - malloc ()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">动态内存分配- malloc()</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/dynamic-memory-allocation-863d8e2e7e61?source=collection_archive---------19-----------------------#2020-05-15">https://medium.com/analytics-vidhya/dynamic-memory-allocation-863d8e2e7e61?source=collection_archive---------19-----------------------#2020-05-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3424aa875cb5a4a9fad6a56fa9b2170c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TyN7Kq1ZvO3Bvm4vbPLIeA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">C语言中的内存管理函数</figcaption></figure><p id="d955" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在上一篇文章中，我们简要讨论了什么是静态和动态内存分配？以及栈和堆的概念。如果你没有读过我以前的类似文章，那么我想请你先读一下那篇文章，这里的<a class="ae js" href="https://bit.ly/2X2xvoQ" rel="noopener ugc nofollow" target="_blank"><strong class="iw hj"/></a>是它的链接。</p><p id="aebd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">简而言之，我们现在知道动态内存分配是在运行时分配内存的过程，在<strong class="iw hj"> stdlib.h </strong>下有一些内存管理函数允许我们动态地分配和释放内存。因此，今天我们将详细讨论所有这些功能。</p><p id="3b8d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们从第一个函数malloc()开始。函数malloc()分配单个内存块。它保留一个指定大小的内存块，并返回一个类型为<strong class="iw hj"> void </strong>的指针。所以，我们可以把它赋给任何类型的指针。</p><p id="47e7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这个函数的声明是:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="ef03" class="kc kd hi jy b fi ke kf l kg kh">ptr = (cast-type *) malloc ( byte-size );</span></pre><p id="fe72" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">ptr是类型为cast-type的指针。malloc返回一个指向字节大小的内存区域的指针(类型转换)。</p><p id="fb46" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">示例:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="7d39" class="kc kd hi jy b fi ke kf l kg kh">ptr = (int * ) malloc (2 * sizeof(int));</span></pre><p id="3fee" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">成功执行该程序后，分配一个8字节大小的内存块。是因为<strong class="iw hj"> int </strong>的大小是4字节。所分配内存的第一个字节的地址被分配给指针<strong class="iw hj"> ptr </strong>。下图可以很好地说明这一点:</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ki"><img src="../Images/e1eb16681c3835f1ca58c975ec76a28a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BXiKR0PUwcX5MuvaCofDIg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">malloc()的内存分配</figcaption></figure><p id="1c30" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">到目前为止，我们已经知道了malloc()函数是如何工作的。现在让我们实现这个概念来解决一个问题:</p><p id="f5c4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">程序使用malloc()以相反的顺序排列输入的元素。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="8544" class="kc kd hi jy b fi ke kf l kg kh">ptr = (int *) malloc(size * sizeof(int));</span></pre><p id="c0fe" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里的<strong class="iw hj"> ptr </strong>是类型为<strong class="iw hj"> int </strong>的指针，<strong class="iw hj"> size </strong>是类型为<strong class="iw hj"> int、</strong>的变量，在这个语句执行之后<strong class="iw hj">size×4</strong>字节的内存被分配。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="b96e" class="kc kd hi jy b fi ke kf l kg kh">if (ptr == NULL) {<br/>    printf("Error! memory not available.");<br/>    exit(0);<br/>}</span></pre><p id="926d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果指针ptr指向NULL，该语句会显示一个错误，也就是说，如果内存中没有可供分配的空间，它只会显示一条错误消息。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="d50b" class="kc kd hi jy b fi ke kf l kg kh">for (i = 0; i &lt; size; i++) {<br/>    printf("Enter element %d: ", i + 1);<br/>    scanf("%d", ptr + i);<br/></span></pre><p id="a0f8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这个语句只是读取输入的元素。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="9eea" class="kc kd hi jy b fi ke kf l kg kh">for (i = size - 1; i &gt;= 0; i--) {<br/>    printf("%d ", *(ptr + i));<br/>}</span></pre><p id="6f37" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">执行此语句后，所有输入的元素将以相反的顺序排列。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="6de6" class="kc kd hi jy b fi ke kf l kg kh">free(ptr);</span></pre><p id="eb7d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在用malloc分配内存之后，并且您已经在您的程序中使用完它，必须使用函数<strong class="iw hj"> <em class="kj"> free() </em> </strong>将它返回给系统。</p><p id="dc23" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是整个程序的样子:</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kk"><img src="../Images/cafcdb83432e779168c9653de82bd1fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x7q9J8UHeGDQPCaNp_NDkQ.png"/></div></div></figure><p id="8ed2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">输出:</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/8e3a3540b5338b21a89a01ffdb1e9014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YwtA-jtvYP-NmfnEZq5kyg.png"/></div></div></figure><p id="69d2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这都是关于malloc的，在下一篇文章中我们将讨论calloc()。这里是calloc的<a class="ae js" rel="noopener" href="/@bindu.khadka.np/calloc-dynamic-memory-allocation-562ab4276367"> <strong class="iw hj">链接</strong> </a>。</p><p id="28c2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这里 观看我的同题视频<a class="ae js" href="https://www.youtube.com/watch?v=IxBjTl6ZNQg" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj">。</strong></a></p></div></div>    
</body>
</html>