<html>
<head>
<title>Build Custom Django Authentication with your own User Model from Scratch with Email Verification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过电子邮件验证，使用您自己的用户模型从头开始构建自定义Django身份验证</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/build-custom-django-authentication-with-your-own-user-model-from-scratch-with-email-verification-54a3dad2130d?source=collection_archive---------3-----------------------#2019-11-17">https://medium.com/analytics-vidhya/build-custom-django-authentication-with-your-own-user-model-from-scratch-with-email-verification-54a3dad2130d?source=collection_archive---------3-----------------------#2019-11-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/9ea13a7740a8707246a90a11d43b3dce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*Pb5-aqqojtcPqoeq6xKQ-g.jpeg"/></div></figure><p id="c39d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">希望你做得很好！在这里，我将向您介绍如何在django中为您自己创建的用户模型构建一个定制的身份验证系统。假设您试图构建一个应用程序，其中您想要摆脱django的内置用户模型。你如何认证你自己的用户？开始吧！</p><p id="a8f2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先创建一个项目。(这里我的项目名是customAuth)。</p><blockquote class="jk jl jm"><p id="167a" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">django-管理开始项目自定义授权</p></blockquote><p id="81f5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">进入<em class="jn"> customAuth </em>目录，创建一个应用<em class="jn"> authApp。</em></p><blockquote class="jk jl jm"><p id="ec77" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">CD custom auth<br/>python manage . py startapp authApp</p></blockquote><p id="d520" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在<em class="jn"> customAuth/settings.py </em>文件中注册您的应用程序</p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="906e" class="ka kb hi jw b fi kc kd l ke kf"># Application definition</span><span id="5fbf" class="ka kb hi jw b fi kg kd l ke kf">INSTALLED_APPS = [<br/>    'authApp',<br/>    ...<br/>]</span></pre><p id="79d5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在您的<em class="jn"> authApp </em>目录中，创建一个文件<em class="jn"> urls.py </em>来创建对应于该应用程序的URL，只在其中创建每个应用程序的URL总是一个好的做法。编辑您的<em class="jn"> authApp/urls.py </em>如下。</p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="f88f" class="ka kb hi jw b fi kc kd l ke kf">from django.urls import path</span><span id="852a" class="ka kb hi jw b fi kg kd l ke kf">app_name = 'authApp'</span><span id="5c1f" class="ka kb hi jw b fi kg kd l ke kf">urlpatterns = []</span></pre><p id="baf8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在将应用程序的url文件注册到项目的url中。打开<em class="jn"> customAuth/urls.py </em>并添加以下行。</p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="487c" class="ka kb hi jw b fi kc kd l ke kf">....<br/>from django.urls import path, include</span><span id="7ebc" class="ka kb hi jw b fi kg kd l ke kf">urlpatterns = [<br/>    ....<br/>    path('', include('authApp.urls')),<br/>]</span></pre><p id="d666" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们通过迁移来形成我们的数据库。运行命令。</p><blockquote class="jk jl jm"><p id="d2a0" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">python manage.py迁移</p></blockquote><p id="653e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们可以专注于我们的主要目标了。在<em class="jn"> authApp/models.py </em>中创建一个名为<em class="jn"> MyUser的用户模型。(我已经为每个用户保留了唯一的用户名和电子邮件)</em></p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="ecee" class="ka kb hi jw b fi kc kd l ke kf">class MyUser(models.Model):<br/> name = models.CharField(max_length=255)<br/> email = models.EmailField(max_length=500, unique=True)<br/> username = models.CharField(max_length=255, unique=True)<br/> password = models.CharField(max_length=255)</span><span id="eb6d" class="ka kb hi jw b fi kg kd l ke kf">def __str__(self):<br/>  return self.username</span></pre><p id="0e4f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">应用迁移。</p><blockquote class="jk jl jm"><p id="6960" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">python manage . py make migrations<br/>python manage . py迁移</p></blockquote><p id="c7fa" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们为这个用户创建一个简单的注册和登录门户。为我们的MyUser模型创建注册和登录两个表单。打开<em class="jn"> authApp/forms.py </em>(如果不存在，创建一个文件<em class="jn"> forms.py </em> ) <em class="jn"> </em>，编辑如下。</p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="4d1c" class="ka kb hi jw b fi kc kd l ke kf">from django import forms<br/>from .models import MyUser</span><span id="5499" class="ka kb hi jw b fi kg kd l ke kf">passwordInputWidget = {<br/> 'password': forms.PasswordInput(),<br/>}</span><span id="69d1" class="ka kb hi jw b fi kg kd l ke kf">class RegisterForm(forms.ModelForm):<br/> class Meta:<br/>  model = MyUser<br/>  fields = '__all__'<br/>  widgets = [passwordInputWidget]</span><span id="e9c4" class="ka kb hi jw b fi kg kd l ke kf">class LoginForm(forms.ModelForm):<br/> class Meta:<br/>  model = MyUser<br/>  fields = ['username', 'password']<br/>  widgets = [passwordInputWidget]</span></pre><p id="c309" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们为我们的网站创建一些视图。打开<em class="jn"> authApp/views.py </em>，编辑如下。然后创建对应于这些视图的URL。</p><blockquote class="jk jl jm"><p id="a4e5" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">authApp/views.py</p></blockquote><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="d551" class="ka kb hi jw b fi kc kd l ke kf">from django.shortcuts import render<br/>from .models import MyUser<br/>from .forms import RegisterForm, LoginForm</span><span id="2743" class="ka kb hi jw b fi kg kd l ke kf"># Create your views here.</span><span id="b3d2" class="ka kb hi jw b fi kg kd l ke kf">def register(request):<br/> form = RegisterForm()<br/> return render(request, 'authApp/register.html', {'form': form})</span><span id="ca73" class="ka kb hi jw b fi kg kd l ke kf">def login(request):<br/> form = LoginForm()<br/> return render(request, 'authApp/login.html', {'form': form})</span></pre><blockquote class="jk jl jm"><p id="832f" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">authApp/urls.py</p></blockquote><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="9b44" class="ka kb hi jw b fi kc kd l ke kf">...<br/>from . import views<br/>..</span><span id="097c" class="ka kb hi jw b fi kg kd l ke kf">urlpatterns = [<br/> path('register/', views.register, name='register'),<br/> path('login/', views.login, name='login'),<br/>]</span></pre><p id="c73d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在<em class="jn">authApp/templates/authApp</em>目录下创建两个模板，分别命名为<em class="jn">register.html和</em>，如下所示。</p><blockquote class="jk jl jm"><p id="2dc3" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">register.html</p></blockquote><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="6f0b" class="ka kb hi jw b fi kc kd l ke kf">&lt;form method="post"&gt;<br/> {% csrf_token %}<br/> {{ form.as_p }}<br/> &lt;button&gt;Register&lt;/button&gt;<br/> &lt;div&gt;Already have an account? &lt;a href="{% url 'authApp:login' %}"&gt;Sign in&lt;/a&gt;<br/>&lt;/form&gt;</span></pre><blockquote class="jk jl jm"><p id="2444" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">login.html</p></blockquote><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="84c6" class="ka kb hi jw b fi kc kd l ke kf">&lt;form method="post"&gt;<br/> {% csrf_token %}<br/> {{ form.as_p }}<br/> &lt;button&gt;Login&lt;/button&gt;<br/> &lt;div&gt;Don't have an account? &lt;a href="{% url 'authApp:register' %}"&gt;Sign up&lt;/a&gt;<br/>&lt;/form&gt;</span></pre><p id="7ba1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们已经为我们的网站创建了一个基本视图。打开您的终端/命令窗口，并在其中运行以下命令。</p><blockquote class="jk jl jm"><p id="f571" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">python manage.py runserver</p></blockquote><p id="28c8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">并在浏览器中打开localhost:8000/register。你拿到登记表了吗？此外，在单击登录链接时，您将被重定向到登录页面。基本观点做好了。现在我们只剩下认证部分了。当有人注册时，registerform被发布，它应该用发布的数据创建一个新的MyUser实例，如果用户名和电子邮件不是唯一的，那么我们将显示一个错误。所以让我们编辑<em class="jn"> views.py. </em></p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="5414" class="ka kb hi jw b fi kc kd l ke kf">def register(request):<br/> form = RegisterForm()<br/> success = None<br/> if request.method=='POST':<br/>  if MyUser.objects.filter(username=request.POST['username']).exists():<br/>   error = "This username is already taken"<br/>   return render(request, 'authApp/register.html', {'form': form, 'error': error})<br/>  if MyUser.objects.filter(email=request.POST['email']).exists():<br/>   error = "This email is already taken"<br/>   return render(request, 'authApp/register.html', {'form': form, 'error': error})<br/>  form = RegisterForm(request.POST)<br/>  new_user = form.save(commit=False)<br/>  new_user.save()<br/>  success = "New User Created Successfully !"<br/> return render(request, 'authApp/register.html', {'form': form, 'success': success})</span></pre><p id="7de3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">编辑register.html如下。</p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="3a32" class="ka kb hi jw b fi kc kd l ke kf">{% if success %}<br/>&lt;div&gt; {{ success }} &lt;/div&gt;<br/>{% endif %}</span><span id="e76a" class="ka kb hi jw b fi kg kd l ke kf">{% if error %}<br/>&lt;div&gt; {{ error }} &lt;/div&gt;<br/>{% endif %}</span><span id="cd89" class="ka kb hi jw b fi kg kd l ke kf">&lt;form method="post"&gt;<br/> ...<br/>&lt;/form&gt;</span></pre><p id="9284" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当您提交包含有效条目的注册表时，将会创建新用户。请随意注册一些用户，并尝试用相同的用户名和电子邮件创建帐户，并验证错误是否有效。现在，我们已经创建了用户注册系统，我们必须让用户登录到我们的系统。当用户使用正确的凭证提交登录表单时，找到用户对应的用户名并为该用户创建一个新会话。只要用户登录，会话就会为该用户运行。用户登录系统后，我们会将其重定向到一个欢迎页面(或<em class="jn">主页</em>页面),在这里我们会显示用户的信息。我们还将使主页仅在用户登录后才可见，也就是说，除非用户登录，否则无法进入主页。为此，我们必须创建自己的装饰函数，就像<em class="jn"> login_required一样。</em>首先创建一个文件<em class="jn">authApp/templates/authApp/home . html</em>，编辑如下文件。</p><blockquote class="jk jl jm"><p id="5055" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">authApp/views.py</p></blockquote><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="f3ab" class="ka kb hi jw b fi kc kd l ke kf">from django.shortcuts import render, redirect</span><span id="b145" class="ka kb hi jw b fi kg kd l ke kf">def login(request):<br/> form = LoginForm()<br/> if request.method=='POST':<br/>  username = request.POST['username']<br/>  password = request.POST['password']<br/>  if MyUser.objects.filter(username=username, password=password).exists():<br/>   user = MyUser.objects.get(username=username)<br/>   request.session['user_id'] = user.id # This is a session variable and will remain existing as long as you don't delete this manually or clear your browser cache<br/>   return redirect('authApp:home')<br/> return render(request, 'authApp/login.html', {'form': form})</span><span id="1aa7" class="ka kb hi jw b fi kg kd l ke kf">def get_user(request):<br/> return MyUser.objects.get(id=request.session['user_id'])</span><span id="ce56" class="ka kb hi jw b fi kg kd l ke kf">def home(request):<br/> if 'user_id' in request.session:<br/>  user = get_user(request)<br/>  return render(request, 'authApp/home.html', {'user': user})<br/> else:<br/>  return redirect('authApp:login')</span></pre><blockquote class="jk jl jm"><p id="fe4b" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">authApp/urls.py</p></blockquote><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="d5cd" class="ka kb hi jw b fi kc kd l ke kf">urlpatterns = [<br/> ....<br/> path('', views.home, name='home'),<br/>]</span></pre><blockquote class="jk jl jm"><p id="673c" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">auth app/templates/auth app/home . html</p></blockquote><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="7d2c" class="ka kb hi jw b fi kc kd l ke kf">&lt;div&gt;<br/> Welcome {{ user.username }}<br/> &lt;p&gt; Name : {{ user.name }} &lt;/p&gt;<br/> &lt;p&gt; Username : {{ user.username }} &lt;/p&gt;<br/> &lt;p&gt; Email : {{ user.email }} &lt;/p&gt;<br/>&lt;/div&gt;</span></pre><p id="867d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在转到localhost:8000，您应该会被自动重定向到登录页面。尝试使用有效凭据登录。希望你现在可以进入主页了。但是对于大型web应用程序，将会有许多用户只能在登录后才能访问的网页，所以不要设置会话密钥是否存在的条件，让我们构建自己的装饰器。创建一个文件<em class="jn"> authApp/decorators.py </em>并编辑以下文件。</p><blockquote class="jk jl jm"><p id="6c9d" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">decorators.py</p></blockquote><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="1009" class="ka kb hi jw b fi kc kd l ke kf">from .models import MyUser<br/>from django.shortcuts import redirect</span><span id="dc92" class="ka kb hi jw b fi kg kd l ke kf">def user_login_required(function):<br/> def wrapper(request, login_url='authApp:login', *args, **kwargs):<br/>  if not 'user_id' in request.session:<br/>   return redirect(login_url)<br/>  else:<br/>   return function(request, *args, **kwargs)<br/> return wrapper</span></pre><blockquote class="jk jl jm"><p id="a7ad" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">views.py</p></blockquote><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="8ffd" class="ka kb hi jw b fi kc kd l ke kf">from .decorators import user_login_required</span><span id="dfd8" class="ka kb hi jw b fi kg kd l ke kf"><a class="ae kh" href="http://twitter.com/user_login_required" rel="noopener ugc nofollow" target="_blank">@user_login_required</a><br/>def home(request):<br/> user = get_user(request)<br/> return render(request, 'authApp/home.html', {'user': user})</span></pre><p id="c313" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">添加<strong class="io hj">注销</strong>功能的时间到了。编辑<em class="jn"> views.py </em>和<em class="jn"> urls.py. </em></p><blockquote class="jk jl jm"><p id="369d" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">views.py</p></blockquote><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="8f86" class="ka kb hi jw b fi kc kd l ke kf">def logout(request):<br/> if 'user_id' in request.session:<br/>  del request.session['user_id'] # delete user session<br/> return redirect('authApp:login')</span></pre><blockquote class="jk jl jm"><p id="a55a" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">urls.py</p></blockquote><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="9429" class="ka kb hi jw b fi kc kd l ke kf">urlpatterns = [<br/> ...<br/> path('logout/', views.logout, name='logout'),<br/>]</span></pre><blockquote class="jk jl jm"><p id="43a7" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">auth app/templates/auth app/home . html</p></blockquote><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="35d8" class="ka kb hi jw b fi kc kd l ke kf">......<br/>&lt;div&gt;To logout, &lt;a href="{% url 'authApp:logout' %}"&gt;Click Here&lt;/a&gt;&lt;/div&gt;</span></pre><p id="a5eb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，当你进入主页后，尝试注销，你将被重定向到登录页面。请注意，在您注销后，除非您再次登录，否则无法访问主页。</p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="d1e0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="jn">邮件验证</em> </strong></p><p id="ff85" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们创建一些功能，使欺诈用户无法进入我们的系统。当用户注册时，我们会发送一些电子邮件验证码到他的邮箱。他只能用正确的验证码注册。我们将调用ajax来实时发送电子邮件，而无需刷新页面。在register.html导入jquery，用邮件数据回复<em class="jn"> views.py </em>，再次返回注册页面。您需要更改<em class="jn"> customAuth/settings.py </em>才能访问邮件服务。</p><blockquote class="jk jl jm"><p id="11a1" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">settings.py</p></blockquote><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="71b5" class="ka kb hi jw b fi kc kd l ke kf">...<br/><br/>EMAIL_HOST = 'smtp.gmail.com' ## Email you want to use<br/>EMAIL_PORT = 587 # For gmail, code is 587<br/>EMAIL_HOST_USER = "&lt;YOUR EMAIL ADDRESS&gt;"<br/>EMAIL_HOST_PASSWORD = "&lt;YOUR EMAIL PASSWORD&gt;"<br/>EMAIL_USE_TLS = True<br/>EMAIL_USE_SSL = False</span></pre><blockquote class="jk jl jm"><p id="b017" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">register.html</p></blockquote><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="ebf1" class="ka kb hi jw b fi kc kd l ke kf">&lt;script src="<a class="ae kh" href="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js" rel="noopener ugc nofollow" target="_blank">https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js</a>"&gt;&lt;/script&gt;</span><span id="acf1" class="ka kb hi jw b fi kg kd l ke kf">{% if success %}<br/>&lt;div&gt; {{ success }} &lt;/div&gt;<br/>{% endif %}</span><span id="23c5" class="ka kb hi jw b fi kg kd l ke kf">{% if error %}<br/>&lt;div&gt; {{ error }} &lt;/div&gt;<br/>{% endif %}</span><span id="71cf" class="ka kb hi jw b fi kg kd l ke kf">&lt;form method="post"&gt;<br/> {% csrf_token %}<br/> {{ form.as_p }}<br/> &lt;input type='number' name='code' id='id_code' placeholder="Enter Verification Code.." style="display: none;"&gt;<br/> &lt;button id='regBtn'&gt;Register&lt;/button&gt;<br/> &lt;div&gt;Already have an account? &lt;a href="{% url 'authApp:login' %}"&gt;Sign in&lt;/a&gt;<br/>&lt;/form&gt;</span><span id="b350" class="ka kb hi jw b fi kg kd l ke kf">&lt;script&gt;<br/> $('#regBtn').on('click', function(e){<br/>  if($("#id_code").css('display')=='none'){<br/>   e.preventDefault();<br/>   var dataToGo = $('#id_email').val();<br/>   console.log(dataToGo);<br/>   $.ajax({<br/>           url: "{% url 'authApp:ajax_generate_code' %}",<br/>           type: 'GET',<br/>           data: dataToGo,<br/>           success: function (data) {<br/>               $('#id_code').css('display', 'block');<br/>           },<br/>           cache: false,<br/>           contentType: false,<br/>           processData: false<br/>        });<br/>  }<br/> })<br/>&lt;/script&gt;</span></pre><blockquote class="jk jl jm"><p id="546b" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">views.py</p></blockquote><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="e960" class="ka kb hi jw b fi kc kd l ke kf">import random<br/>from django.core.mail import EmailMultiAlternatives<br/>from django.template.loader import render_to_string<br/>from customAuth.settings import EMAIL_HOST_USER<br/>from django.http import HttpResponse</span><span id="901b" class="ka kb hi jw b fi kg kd l ke kf">def ajax_generate_code(request):<br/> print(request.GET)<br/> for x in request.GET:<br/>  if x!='_':<br/>   email = x</span><span id="e6b8" class="ka kb hi jw b fi kg kd l ke kf">## Generate Code and save it in a session<br/>   request.session['code'] = random.randint(100000, 999999)</span><span id="2c50" class="ka kb hi jw b fi kg kd l ke kf">## Send email Functionality<br/>   text_content = "Your Email Verification Code is " + str(request.session['code'])<br/>   msg = EmailMultiAlternatives('Verify Email', text_content, EMAIL_HOST_USER, [email])<br/>   msg.send()</span><span id="397e" class="ka kb hi jw b fi kg kd l ke kf">return HttpResponse("success")</span><span id="0ab4" class="ka kb hi jw b fi kg kd l ke kf">def register(request):<br/> form = RegisterForm()<br/> success = None<br/> if request.method=='POST':<br/>  if MyUser.objects.filter(username=request.POST['username']).exists():<br/>   error = "This username is already taken"<br/>   return render(request, 'authApp/register.html', {'form': form, 'error': error})<br/>  if MyUser.objects.filter(email=request.POST['email']).exists():<br/>   error = "This email is already taken"<br/>   return render(request, 'authApp/register.html', {'form': form, 'error': error})</span><span id="afca" class="ka kb hi jw b fi kg kd l ke kf">## Check Verification Code<br/>  if (not 'code' in request.POST) or (not 'code' in request.session) or (not request.POST['code']==str(request.session['code'])):<br/>   error = "Invalid Verification Code"<br/>   return render(request, 'authApp/register.html', {'form': form, 'error': error})</span><span id="1dcf" class="ka kb hi jw b fi kg kd l ke kf">## Safe to go<br/>  form = RegisterForm(request.POST)<br/>  new_user = form.save(commit=False)<br/>  new_user.save()<br/>  success = "New User Created Successfully !"<br/> return render(request, 'authApp/register.html', {'form': form, 'success': success})</span></pre><blockquote class="jk jl jm"><p id="c13c" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">urls.py</p></blockquote><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="ac48" class="ka kb hi jw b fi kc kd l ke kf">...<br/>urlpatterns = [<br/> ...<br/> path('ajax_generate_code/', views.ajax_generate_code, name='ajax_generate_code'),<br/>]</span></pre><p id="ffb9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">转到localhost:8000/register/并尝试创建一个帐户，在那里输入您的电子邮件地址，当您第一次单击注册按钮时，它会显示另一个电子邮件验证码输入框。检查你的电子邮件，你应该得到一个验证码。把它放在那里，你就可以走了！</p><p id="39bc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">编码快乐！</p></div></div>    
</body>
</html>