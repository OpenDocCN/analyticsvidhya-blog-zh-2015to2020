<html>
<head>
<title>Django ORM internals- Environment setup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django ORM内部——环境设置</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/django-orm-internals-environment-setup-42cf66dff5b2?source=collection_archive---------20-----------------------#2020-12-14">https://medium.com/analytics-vidhya/django-orm-internals-environment-setup-42cf66dff5b2?source=collection_archive---------20-----------------------#2020-12-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="2ea1" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated"><strong class="ak">背景:</strong></h2></div><p id="7781" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我们将了解Django ORM是如何工作的。根据专家的说法，如果我们想学习一些新的东西，最好的方法是，阅读一些现有实现的代码库。<br/>如果你正在开发一些基于Python的ORM &amp;那么你就不会去研究Django代码，要么你错过了什么，要么你远远超出了像我这样的普通开发人员。<br/>我想在开始的时候澄清一下，这不是关于任何使用Django框架的web应用程序开发。我正在学习任何ORM是如何工作的&amp;阅读Django代码是最好的起点。这将是一系列的职位。如果我们正在寻找一个能够帮助使用Django唯一的ORM特性的指南，这可能会有所帮助。</p><h2 id="e6ca" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated"><strong class="ak">工具:</strong></h2><p id="14a2" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">因为目的是了解Django ORM的内部，所以第一步应该是从它的开发部门获得源代码。因为每个项目都有一个虚拟环境是一个很好的实践，所以我们将使用conda来管理我们的虚拟环境。为了使这篇文章更短，我们不再详细介绍conda的安装过程。由于虚拟环境帮助我们隔离python开发环境，docker可以以类似的方式帮助我们处理其他应用程序，因此对于数据库应用程序，我们将使用docker。同样，我们可以从互联网上的一些其他资源开始使用docker和docker composer。最后，关于IDE，我正在使用Pycharm社区版。</p><h2 id="1f0b" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">设置:</h2><p id="1912" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">那么，我们已经讨论了正在使用的工具，现在让我们按照步骤开始作为一个ORM开发者。</p><p id="c8ca" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">创建并激活虚拟环境</strong></p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="f638" class="jt ju hi ky b fi lc ld l le lf"><em class="lg">~$ conda create -n django-dev python=3.9<br/>~$ </em>conda activate django-dev</span></pre><p id="d9e6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">从Github克隆最新的Django源代码</strong></p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="da18" class="jt ju hi ky b fi lc ld l le lf">~$ git clone <a class="ae lh" href="https://github.com/django/django.git" rel="noopener ugc nofollow" target="_blank">https://github.com/django/django.git</a><br/>~$ cd django</span></pre><p id="e4f9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">从源代码安装Django</strong></p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="be04" class="jt ju hi ky b fi lc ld l le lf">~$ python -m pip install . # make sure you are inside the django dir</span></pre><p id="4fd5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">为ORM实验</strong>创建一个项目&amp; App</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="2dbf" class="jt ju hi ky b fi lc ld l le lf">~$ mkdir experiment &amp;&amp; cd experiment<br/>~$ django-admin startproject ormtest .<br/>~$ python manage.py startapp modeltest</span></pre><p id="2e6f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">修改设置文件以满足我们的要求</strong></p><p id="43c6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">默认情况下，django将创建一个web应用程序可以使用的设置文件。因为我们只需要数据库连接部分，所以我们将删除其他不相关的配置。最终的设置文件将如下图所示。这里我附上了docker-composer文件，以供参考。docker容器可以通过下面的命令启动。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="ce2b" class="jt ju hi ky b fi lc ld l le lf">~$ sudo docker-compose up # in the dir with compose.yml <br/></span></pre><figure class="kt ku kv kw fd li"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="7a9d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">最后一步</strong></p><p id="f26c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们几乎完成了设置。我们可以使用下面的示例运行一个基本的测试代码。在下面的示例中，假设我们在modeltest的模型文件中有一个模型“Device”。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="57f2" class="jt ju hi ky b fi lc ld l le lf">import os<br/>from django.core.wsgi import get_wsgi_application<br/><br/>os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'ormtest.settings')<br/><br/>application = get_wsgi_application()<br/><br/>from modeltest.models import Device<br/><br/>if __name__ == "__main__":<br/>    d1 = Device.objects.filter(device_id=1)<br/>    print(d1[0].name)</span></pre></div><div class="ab cl ll lm gp ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hb hc hd he hf"><p id="c4d6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将是一系列的职位。所以请继续关注，我们将了解ORM是如何工作的！</p></div></div>    
</body>
</html>