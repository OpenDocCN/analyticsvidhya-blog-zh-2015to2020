<html>
<head>
<title>Create a Face Mask Detector in 5 Lines of Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用5行代码创建一个面具检测器</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/create-a-face-mask-detector-in-5-lines-of-code-42e840424239?source=collection_archive---------19-----------------------#2020-05-24">https://medium.com/analytics-vidhya/create-a-face-mask-detector-in-5-lines-of-code-42e840424239?source=collection_archive---------19-----------------------#2020-05-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ecd3b75631335188e3632c408454e04f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H6taJFKsINNOl1R-3Boe9A.jpeg"/></div></div></figure><p id="0e29" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个疫情的时代，面具已经成为我们服饰中至关重要的一部分。戴口罩不仅是你照顾自己的一种姿态，也是为了社区。一些人使用外科口罩，一些人使用N95呼吸器。很少有人选择用布做的面具，有创意的人使用自制的花式面具。买不起口罩的人会用围巾包住脸，或者用t恤捂住嘴。无论如何，每个人都在尽力保护自己，防止病毒传播。在一些研究中，人们发现那些新冠肺炎病毒感染者曲线变平的国家非常重视口罩的使用。</p><p id="0dfc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将创建一个简单的面具检测器模型来检测一个人是否戴着面具。我们将使用<strong class="is hj"> Fast.ai </strong>库来构建模型。我们将使用Google Colab，这样我就可以使用他们的GPU。</p><h1 id="479c" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">收集数据</strong></h1><p id="147a" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">第一步是获取数据。因为我们正在制作面罩检测器，所以我们必须拍摄戴面罩和不戴面罩的人的脸部图像。我们将使用<strong class="is hj"> Fatkun批量下载</strong>从Google images中收集数据，然后我们将它存储在两个不同的文件夹中，分别命名为<strong class="is hj"> with_mask </strong>和<strong class="is hj"> without_mask </strong>。我们总共有1921张照片。我的数据集结构如下:</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es kr"><img src="../Images/60e443a5bc8f64a5d41fe9f6a8519fc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:444/format:webp/1*Jl4AD9DFDtydqINUlRq4DA.png"/></div></figure><h1 id="1c45" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">模型结构</h1><p id="3081" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">一旦我们的数据准备好了，现在我们可以开始构建我们的模型。</p><p id="14ea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将导入所有必要的库。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="0b50" class="lb jp hi kx b fi lc ld l le lf">from fastai import *                <strong class="kx hj"># line_1</strong><br/>from fastai.vision import *         <strong class="kx hj"># line_2</strong></span></pre><p id="2a94" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里我们不必分配类，因为ImageDataBunch将从文件夹名中获取类名。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="8df1" class="lb jp hi kx b fi lc ld l le lf">data =ImageDataBunch.from_folder(’dataset/’,train=".",valid_pct=0.2,<br/>                                 ds_tfms=get_transforms(), size=224,<br/>                                  num_workers=4)<br/>                                 .normalize(imagenet_stats)  <strong class="kx hj">#line_3</strong></span></pre><p id="2fb7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> ImageDataBunch </strong>安排所有的数据——一个训练集，一个带有图像和标签的验证集。它将从路径<code class="du lg lh li kx b"><strong class="is hj">'dataset/'</strong></code> <strong class="is hj"> </strong>获取图像。它将为训练集找到我们将使用<code class="du lg lh li kx b"><strong class="is hj">'.’</strong></code>指定的默认文件夹。由于我们没有单独的验证集，我们将创建自己的验证集，<code class="du lg lh li kx b"><strong class="is hj">valid_pct=0.2</strong></code>将自动随机分离20%的数据进行验证。因此，我们有1537幅图像用于训练，384幅图像用于验证。使用<code class="du lg lh li kx b"><strong class="is hj">get_transforms()</strong></code> <strong class="is hj"> </strong>我们可以扩充数据，但仅出于演示目的，我们将尽量保持模型简单。我们喂的是<code class="du lg lh li kx b"><strong class="is hj">size</strong></code> (224，224，3)的形象。<code class="du lg lh li kx b"><strong class="is hj">num_workers</strong></code>是要使用的CPU数量，我们使用4个。最后，我们将数据标准化。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="f873" class="lb jp hi kx b fi lc ld l le lf">learn = create_cnn(data, models.vgg16_bn, metrics=accuracy) <strong class="kx hj"># line_4</strong></span></pre><p id="83ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们正在创建CNN模型，在该模型中，我们将数据拟合到训练前的VGG16模型中。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="d5e6" class="lb jp hi kx b fi lc ld l le lf">learn.fit_one_cycle(3)   <strong class="kx hj"># line_5</strong></span></pre><p id="3299" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面的代码将为3个时期训练模型。仅用三个时期，我们就获得了大约98%准确度的相当好的结果。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es lj"><img src="../Images/1e8e5878d206d285e3ab9dcae046f07b.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*Dg7rg0-bPvhuKChlHCLqPw.png"/></div></figure><p id="a882" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们用5行代码构建了一个掩蔽检测CNN模型。</p><h1 id="2178" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">试验</h1><p id="418a" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">让我们看看我们的模型在验证数据集上的表现</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="bcda" class="lb jp hi kx b fi lc ld l le lf">interp = ClassificationInterpretation.from_learner(learn)<br/>interp.plot_confusion_matrix()</span></pre><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es lk"><img src="../Images/cb9707a07155c3e0e9aa7f04d5c324fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/format:webp/1*8ZRRSqU07GnGzj-Co6MHjQ.png"/></div></figure><p id="25da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这种情况下，我们的模型是好的，因为它降低了假阳性率，即当某人没有戴面具时，我们的模型预测戴面具的次数，因为我们不想错过没有戴面具的人。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/6410352f382338b6a8f5c6c1b4ff5827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rO9cbXYhsHs3CPU6D-JOJA.png"/></div></div></figure><p id="4acd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的模型在如此简单的代码中表现很好，如果我们稍微调整一下，我们可以使我们的模型更加准确，并应用于实时视频。</p></div></div>    
</body>
</html>