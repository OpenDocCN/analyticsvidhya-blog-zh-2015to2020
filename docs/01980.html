<html>
<head>
<title>SQL for Analysts: A challenge a day — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向分析师的SQL:每天的挑战—第1部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/sql-for-analysts-a-challenge-a-day-part-1-71ed725156e0?source=collection_archive---------23-----------------------#2019-11-24">https://medium.com/analytics-vidhya/sql-for-analysts-a-challenge-a-day-part-1-71ed725156e0?source=collection_archive---------23-----------------------#2019-11-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="f74f" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">嗨伙计们！欢迎来到面向分析师的“<em class="hi">SQL</em>”系列。本系列将通过真实的场景来练习分析师面临的常见挑战/问题。本系列将涵盖中级到高级的挑战，因此如果您不精通SQL的基础知识或语法，我建议您使用一些其他资源来逐步提高。我将使用MySQL来应对这些挑战，所以我建议您也使用MySQL。该系列没有任何特定的顺序，所以你可以从任何部分开始，并尝试解决挑战。</p><p id="d117" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">也就是说，让我们开始吧。快乐学习！</p></blockquote><h2 id="f700" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated"><strong class="ak">挑战:</strong></h2><p id="af81" class="pw-post-body-paragraph ii ij hi il b im kf io ip iq kg is it js kh iw ix jw ki ja jb ka kj je jf jg hb bi translated">每辆车每天的第一次和最后一次行程持续多长时间？</p><p id="5e19" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it js iv iw ix jw iz ja jb ka jd je jf jg hb bi translated">下面是我们正在处理的数据的快照:</p><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es kk"><img src="../Images/312c4ca74c1db1ff759824751ad37140.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/format:webp/1*yHw8GZNwhCnPfEEqL2v3mQ.png"/></div></figure><p id="80b7" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it js iv iw ix jw iz ja jb ka jd je jf jg hb bi translated">此外，下面是创建表并将上述数据添加到表中的代码:</p><pre class="kl km kn ko fd ks kt ku kv aw kw bi"><span id="3136" class="jh ji hi kt b fi kx ky l kz la">create table rental (<br/> rental_id int,<br/> veh_id int,<br/> rental_date date,<br/> rental_start_time time,<br/> rental_duration int);<br/> <br/> insert into rental <br/> values (1, 1, ‘2019–08–01’, ‘12:00:00’, 19),<br/> (2,2,’2019–08–01',’14:00:00',22),<br/> (3,1,’2019–08–01',’14:30:00',15),<br/> (4,3,’2019–08–02',’05:00:00',42),<br/> (5,3,’2019–08–02', ‘19:00:00’,57),<br/> (6,1,’2019–08–02', ‘20:30:00’,67),<br/> (7,1,’2019–08–01',’16:00:00', 12);</span></pre><h2 id="213f" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated"><strong class="ak">解决方案:</strong></h2><p id="07b0" class="pw-post-body-paragraph ii ij hi il b im kf io ip iq kg is it js kh iw ix jw ki ja jb ka kj je jf jg hb bi translated">下面的快照显示了解决方案需要的样子:</p><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es lb"><img src="../Images/89009a0b4868d73e19debd68a074e112.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/1*q1BkGmEOeKiJNpkZQLQ9ug.png"/></div></figure><p id="6aaa" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it js iv iw ix jw iz ja jb ka jd je jf jg hb bi translated">在这个场景中，我们想要找出第一次和最后一次乘坐的旅行持续时间。我们将使用以下概念:</p><ol class=""><li id="92b2" class="lc ld hi il b im in iq ir js le jw lf ka lg jg lh li lj lk bi translated">First_value和last_value窗口函数可用于确定数据子集的第一个和最后一个值。</li><li id="aead" class="lc ld hi il b im ll iq lm js ln jw lo ka lp jg lh li lj lk bi translated">在这种情况下，我们按照veh_id和租赁日期进行划分，因为我们需要找到每辆自行车和日期组合的第一个和最后一个</li><li id="fa5e" class="lc ld hi il b im ll iq lm js ln jw lo ka lp jg lh li lj lk bi translated">我们按租赁开始时间排序，以获得first_value和last_value函数的正确排序</li><li id="667d" class="lc ld hi il b im ll iq lm js ln jw lo ka lp jg lh li lj lk bi translated">一旦数据被排序和分区，我们将把rental_duration列传递给函数，以获得第一次和最后一次旅行的持续时间。</li><li id="9953" class="lc ld hi il b im ll iq lm js ln jw lo ka lp jg lh li lj lk bi translated">对于last_value，我们使用“无界在前和无界在后之间的范围”，因为我们想要整个分区子集的第一个和最后一个值。这给了我们以下片段:</li></ol><pre class="kl km kn ko fd ks kt ku kv aw kw bi"><span id="b72c" class="jh ji hi kt b fi kx ky l kz la">first_value(rental_duration) over (partition by veh_id, rental_date order by rental_start_time) as first_duration,</span><span id="dc09" class="jh ji hi kt b fi lq ky l kz la">last_value(rental_duration) over (partition by veh_id, rental_date order by rental_start_time range between unbounded preceding and unbounded following) as last_duration</span></pre><p id="2c51" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it js iv iw ix jw iz ja jb ka jd je jf jg hb bi translated">最后，我们对整个表进行分组，以删除重复的信息行。这给了我们最后一个问题:</p><pre class="kl km kn ko fd ks kt ku kv aw kw bi"><span id="2142" class="jh ji hi kt b fi kx ky l kz la">with cte as (<br/>select *,<br/>first_value(rental_duration) over (partition by veh_id, rental_date order by rental_start_time) as first_duration,<br/>last_value(rental_duration) over (partition by veh_id, rental_date order by rental_start_time range between unbounded preceding and unbounded following) last_duration<br/>from rental<br/>order by veh_id, rental_date, rental_start_time)<br/>select rental_date, veh_id, first_duration, last_duration from cte <br/>group by 1,2,3,4<br/>order by 1,2;</span></pre><p id="097b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it js iv iw ix jw iz ja jb ka jd je jf jg hb bi translated">就是这样！希望你能跟上！</p></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><p id="806a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it js iv iw ix jw iz ja jb ka jd je jf jg hb bi translated">如果您有兴趣解决更多问题，您可以在以下位置找到更多挑战:</p><p id="bb01" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it js iv iw ix jw iz ja jb ka jd je jf jg hb bi translated">下一个挑战—<a class="ae ly" rel="noopener" href="/analytics-vidhya/sql-for-analysts-a-challenge-a-day-part-2-fcc549f10cb9">https://medium . com/analytics-vid hya/SQL-for-analysts-a-challenge-a-day-part-2-FCC 549 f 10 CB 9</a></p></div></div>    
</body>
</html>