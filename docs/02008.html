<html>
<head>
<title>Performing Multivariate Mixed Modeling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">执行多元混合建模</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/performing-multivariate-mixed-modeling-7c925f015f39?source=collection_archive---------1-----------------------#2019-11-26">https://medium.com/analytics-vidhya/performing-multivariate-mixed-modeling-7c925f015f39?source=collection_archive---------1-----------------------#2019-11-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/de09faac7f795422aa74b216dd4f5aca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i59uYGF3eCB1-sdhUnQTMA.png"/></div></div></figure><p id="f093" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在继续之前，你应该有一个线性混合模型(LMM)的先验知识，你可以在我的<a class="ae jo" rel="noopener" href="/@vyawaharesushrut1/introduction-to-mixed-models-208f012aa865"> <em class="jp">以前的博客</em> </a>中找到。</p><p id="99f2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">无论如何，让我们快速介绍一下混合模型。线性混合效应模型在生物数据分析中越来越常见。它提供了一个灵活的方法来模拟广泛的数据类型，生态数据往往是复杂的，需要复杂的模型结构。它包括固定效应和随机效应的组合作为预测变量。</p><p id="a146" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些模型功能强大。软件的进步使得非专业人士也可以使用这些工具，并且变得相对简单，适合广泛使用的统计软件包，如r。</p><p id="a427" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要在R中执行多元LMMs，还没有任何特定的软件包。所以，我们来看看是怎么做的。我为这项研究创建了一个样本数据。</p><blockquote class="jq jr js"><p id="069d" class="iq ir jp is b it iu iv iw ix iy iz ja jt jc jd je ju jg jh ji jv jk jl jm jn hb bi translated"><strong class="is hj"> <em class="hi">注:- </em> </strong> <em class="hi">本博客的目的是展示如何使用各种数据分析命令。它并没有涵盖研究者应该做的研究过程的所有方面。特别是，它不包括数据清理和检查、假设验证、模型诊断和潜在的后续分析。</em></p></blockquote><p id="b01a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们加载数据，看看数据的概要和结构</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jw"><img src="../Images/6bab70eb9aa1c443b1ec25e98fbee7c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*giqvv1RxUbWvAJkycyGRJg.png"/></div></div><figcaption class="kb kc et er es kd ke bd b be z dx translated">数据汇总</figcaption></figure><p id="a182" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里我把<strong class="is hj">率</strong>作为我的因变量，其他变量都是独立的。我们将使用从<strong class="is hj">利率</strong>预测的变量<strong class="is hj"> ln和exp </strong>，它们都嵌套在<strong class="is hj"> id </strong>中。你可以看到我的数据是宽格式的。</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es kf"><img src="../Images/b513b333560d2c3aa8078a57740d2db8.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*Nw_7hXzZEenL7r9TNPhMxQ.png"/></div><figcaption class="kb kc et er es kd ke bd b be z dx translated">数据结构</figcaption></figure><p id="1552" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将使用<strong class="is hj"> reshape2 </strong>包以日志格式重塑我的数据。结果是一个新的数据集，称为<strong class="is hj">数据1 </strong>。</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es kg"><img src="../Images/f081a990af854ffa896f3fe5a6d8a0fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*_i88OwhEEl31YeXLTcVRVw.png"/></div><figcaption class="kb kc et er es kd ke bd b be z dx translated">我们已经融合了数据</figcaption></figure><p id="928c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，让我们看看我们的数据融化后是什么样子。</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es kh"><img src="../Images/62a8f042a52913f64c687caa59037e1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*VkG0sMslVahMMLRWi2eO7Q.png"/></div></figure><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es ki"><img src="../Images/8e36361a1b5d828bf06e24d72949ac84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*fGCR8h0lcrt3ZuOQR3cCIQ.png"/></div><figcaption class="kb kc et er es kd ke bd b be z dx translated">新数据的结构</figcaption></figure><p id="1e08" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们的下一步在执行多元分析中起着重要的作用。要执行多元LMM，我们需要为分类变量创建虚拟变量；那就是我们数据中的<strong class="is hj">变量</strong>。</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es kj"><img src="../Images/d6aabfaf6209c0a49fb2c1fc9e8080a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*dOCc0ZSeLeWaRipbqp6_jg.png"/></div><figcaption class="kb kc et er es kd ke bd b be z dx translated">为“ln”和“exp”创建虚拟变量</figcaption></figure><p id="c237" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在该代码中<strong class="is hj"> D1 </strong>和<strong class="is hj"> D2 </strong>是<strong class="is hj"> ln </strong>和<strong class="is hj"> exp的虚拟变量。</strong></p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es kk"><img src="../Images/1a8f5ad6f018ee40b87b81092eed5008.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*F4Z4uzy5BACS7e8XGFkpng.png"/></div><figcaption class="kb kc et er es kd ke bd b be z dx translated">虚拟变量</figcaption></figure><p id="b3ee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于，<strong class="is hj">ln</strong><strong class="is hj">D1</strong>的值为<strong class="is hj"> 1 </strong>否则<strong class="is hj"> 0 </strong>。类似地，对于<strong class="is hj">exp</strong>，D2的值为1，否则为0。<strong class="is hj"> D1 </strong>和<strong class="is hj"> D2 </strong>是0/1虚拟变量，编码结果是变量<strong class="is hj"> ln </strong>还是<strong class="is hj"> exp，</strong>id现在重复多次，<strong class="is hj">速率</strong>重复两次，每个结果变量一次。</p><p id="761a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了使模型符合我们的数据，我将使用<strong class="is hj"> nlme </strong>包来构建<strong class="is hj"> LMM </strong>。在我之前的博客中，我使用了<strong class="is hj"> lme4 </strong>包来构建<strong class="is hj"> LMM </strong>。有一个新的软件包适合于许多类型的随机系数模型，<strong class="is hj"> lme4 </strong>，但是它不处理特殊的残差协方差结构。</p><blockquote class="jq jr js"><p id="5c74" class="iq ir jp is b it iu iv iw ix iy iz ja jt jc jd je ju jg jh ji jv jk jl jm jn hb bi translated"><strong class="is hj">注意:- </strong>两个包在编写公式时的语法略有不同。</p></blockquote><p id="e023" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们使用<strong class="is hj"> nlme </strong>软件包来拟合模型。</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es kl"><img src="../Images/3c46353be0428a0a1dece01ef5a7f7a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*y8XIqDauuCMbKvF7EAehZg.png"/></div><figcaption class="kb kc et er es kd ke bd b be z dx translated">模型</figcaption></figure><blockquote class="jq jr js"><p id="dd86" class="iq ir jp is b it iu iv iw ix iy iz ja jt jc jd je ju jg jh ji jv jk jl jm jn hb bi translated">注意:-我们指定了特殊的控制参数，因为模型没有在默认的迭代次数中收敛，所以它们被增加了。</p></blockquote><p id="6dce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们来看一些诊断图。首先，我们将查看拟合值的残差。我们将整体观察它们，并使用<strong class="is hj">点阵</strong>包按结果变量进行分解。</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es km"><img src="../Images/644f4287590c61d02198f4cc929a69ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*s-6ZSR3muuJB9MObTEmIyQ.png"/></div></figure><figure class="jx jy jz ka fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/c33c3a5b04a65a880ae0a0c40a722db1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*bJDHgtZ-YoSAYbeRFt6ZwA.png"/></div></div><figcaption class="kb kc et er es kd ke bd b be z dx translated">残差与拟合值</figcaption></figure><p id="3e06" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了更好地理解，我们将绘制由变量分隔的QQ-plot。</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es ko"><img src="../Images/6333e40352b9aba784311de4680a612c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*A2LgeSlcuiBAkoOM89XAew.png"/></div></figure><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es kp"><img src="../Images/a2becd1725412a24b2bea030adfb05bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*qVj5UoNL0IB5R16Q0qNBWg.png"/></div><figcaption class="kb kc et er es kd ke bd b be z dx translated">由变量分隔的QQ图</figcaption></figure><p id="0927" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将在这个QQ图中添加简单的线条。</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es kq"><img src="../Images/011d3e9bae09b93974a36dad70bd1019.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*99rhrqcf2r-Y2BTb0Ashjw.png"/></div></figure><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es kp"><img src="../Images/2d7d7a3a7aa6c9aa0882278f00ff9e3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*hK4voI7cnsdGon7SrtC_Tg.png"/></div></figure><p id="e0a5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从残差的QQ图来看，很明显它们不是正态分布的，我们可能会担心这个假设。然而，为了演示起见，我们将继续。接下来，让我们看看残差对拟合值的作图，以检查诸如异方差之类的东西。</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es kr"><img src="../Images/84f88549f1281cc8d410febc22fb1686.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*u6wXSCW1CTTmLHSvETOq-Q.png"/></div><figcaption class="kb kc et er es kd ke bd b be z dx translated">整体情节</figcaption></figure><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es ks"><img src="../Images/d44a40850bc8b0edd445716491360c8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*0qaADO9q9nkdYtdebYA2RQ.png"/></div><figcaption class="kb kc et er es kd ke bd b be z dx translated">整体情节</figcaption></figure><p id="2802" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们看看这两个变量的分布。</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es kt"><img src="../Images/f2842e77386947e0dc3bda909ecb59cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*B2gJqN0DYZPgFY0qMDM6Aw.png"/></div><figcaption class="kb kc et er es kd ke bd b be z dx translated">对于这两个变量</figcaption></figure><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es ku"><img src="../Images/e0164b90c27a3d7af39b0cdd4a514862.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*0H1rwi-theB-Hx8yK_H6TQ.png"/></div></figure><p id="0ce8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过变量分离后，看起来好一点了，尽管离理想状态还很远。我们可以看到，这两个变量的预测值的分布非常不同。令人惊讶的是，它们不在同一尺度上。在这种规模下，很难看出<strong class="is hj"> ln </strong>的真实价差。我们可以只检查这个变量<strong class="is hj">在</strong>中的曲线。</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es kv"><img src="../Images/38627e7e67d6ad106361288d63e2e8b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*4N6gRkSUCS8v8361OncIcQ.png"/></div></figure><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/f6009ad417d39f71a1e8aba8d36517a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*ZN6SJDan6TnPssW30wsaPA.png"/></div></figure><p id="92b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它看起来扩散得不太严重。我们的地块看起来都很好，我们不需要做任何修改。让我们检查一下我们模型的概要。</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es kx"><img src="../Images/5cd25cf0c99b461d3f272e2934f149e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*rRTb9hRSmk2m6A4Ulotetg.png"/></div><figcaption class="kb kc et er es kd ke bd b be z dx translated">模型摘要</figcaption></figure><p id="75b1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它包含了大量的信息。如果我们看一下我们模型的总结，我们会发现它同时具有固定效应和随机效应。剩余标准差是剩余方差的平方根，用于变量<strong class="is hj"> ln </strong>。为了得到<strong class="is hj"> exp </strong>变量的值，用<strong class="is hj"> 6.74 </strong>乘以余数。</p><p id="abb3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些类型模型会变得复杂，有时会遇到收敛问题。很容易误用随机效应和协方差结构。</p><p id="fc01" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> nlme </strong>包有一个名为<strong class="is hj"> getVarCov() </strong>的函数，它给出一个方差协方差<strong class="is hj"> </strong>矩阵。方差协变看起来像这样:</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es ky"><img src="../Images/060d9f8c7f41d941062937e9258b5d99.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*PuQFtItyEqBw0Fcm8_X2cg.png"/></div><figcaption class="kb kc et er es kd ke bd b be z dx translated">方差协方差</figcaption></figure><p id="9d46" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一个<strong class="is hj">方差</strong> - <strong class="is hj">协方差矩阵</strong>是一个方阵<strong class="is hj">矩阵</strong>，它包含了与几个变量相关的<strong class="is hj">方差</strong>和<strong class="is hj">协方差</strong>。矩阵<strong class="is hj">的对角线元素</strong>包含变量的<strong class="is hj">方差</strong>，非对角线元素包含所有可能变量对之间的<strong class="is hj">协方差</strong>。方差测量数据相对于平均值的分散程度。</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es kz"><img src="../Images/f388fa8dd588ee4b2f93c811b8ae1827.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*4bilsynaAnFq6jkDO3lMWA.png"/></div><figcaption class="kb kc et er es kd ke bd b be z dx translated">方差协方差矩阵</figcaption></figure><p id="c22f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在线性混合效应模型中，我们可以得到随机效应项之间的估计方差、标准差和相关性。</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es la"><img src="../Images/6763c10c40352b1615a50c8e796e6ab3.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*tcUYjudAHc3ochUSwkF8bg.png"/></div></figure><p id="0a57" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这可能会遇到收敛问题，并且会变得很慢。这不是一个很常见的技术，所以你可能找不到很多文献。</p><p id="d4b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">结论:- </strong>这些模型相当复杂。它允许我们以一种总体的方式来看待变量之间的关系，并量化变量之间的关系。在这篇博客中，我已经建立了双变量混合模型，同样我们也可以建立多变量混合模型。现在我们能够使用多个变量来预测可能的结果。</p><blockquote class="jq jr js"><p id="2349" class="iq ir jp is b it iu iv iw ix iy iz ja jt jc jd je ju jg jh ji jv jk jl jm jn hb bi translated">在混合模式中，你有很多东西可以探索。要了解更多混合模型的神奇之处，请继续关注我的混合模型系列博客。</p></blockquote></div></div>    
</body>
</html>