<html>
<head>
<title>Time Series Analysis — A quick tour of fbProphet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列分析fbProphet快速浏览</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/time-series-analysis-a-quick-tour-of-fbprophet-cbbfbffdf9d8?source=collection_archive---------1-----------------------#2020-10-31">https://medium.com/analytics-vidhya/time-series-analysis-a-quick-tour-of-fbprophet-cbbfbffdf9d8?source=collection_archive---------1-----------------------#2020-10-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="75da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi jd translated">相对于时间绘制的一系列数据点被称为<em class="jm">时间序列。</em>这是一种用于市场评估和天气预报的事实分析技术。这是一个令人兴奋的研究主题，因为它在某种程度上倾向于预测未来，这是我们一直感兴趣的。</p><p id="8e7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有两种类型的机器学习(ML)模型用于时间序列分析:</p><ol class=""><li id="24ed" class="jn jo hi ih b ii ij im in iq jp iu jq iy jr jc js jt ju jv bi translated">时间依赖模型</li><li id="165f" class="jn jo hi ih b ii jw im jx iq jy iu jz iy ka jc js jt ju jv bi translated">一般可加模型</li></ol><h1 id="6207" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">时间依赖模型</h1><p id="2ea6" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">通过观察过去几天的天气，我们可以预测明天的天气。如果过去4-5天天气晴朗，那么明天天气晴朗的可能性很大。这是理解时间依赖模型的直观方式。过去值和现在值之间的相关性显示了时间依赖性。在这个模型中，我们给予最近的数据比旧的数据点更大的权重。这类模型的一些例子有ARIMA <em class="jm">(自回归综合移动平均)、S </em>、ARIMA <em class="jm">(季节性自回归综合移动平均)、</em>、LSTM <em class="jm">(长短期记忆)、</em>。</p><p id="e260" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ARIMA要求数据具有恒定的均值和方差，并且没有季节性。如果数据不满足上述条件，比方说，如果我们有一个有上升趋势的数据点，那么要使用ARIMA，我们首先需要对它进行变换，并使它保持平稳。另一方面，LSTM是一个强大的循环神经网络。LSTM的预测非常准确，但是由于神经网络缺乏可解释性，导致预测的网络成分仍然未知。</p><h1 id="a92d" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">一般可加模型</h1><p id="3890" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">我们可以根据总体趋势训练我们的模型，并添加一些季节效应，而不是使用来自相似时间戳的值之间的相关性。GAM背后的原理类似于<em class="jm">回归</em>模型。与使用单个预测因子来预测结果的回归不同，GAM使用平滑函数的和来预测结果。这里的平滑函数包括描述趋势分量、季节分量、假日分量等的函数。由于GAM由函数组成，我们可以分离出单个函数并评估其在预测中的作用，这使得GAM更具可解释性。GAM的一个例子就是fbProphet。</p><h2 id="3658" class="le kc hi bd kd lf lg lh kh li lj lk kl iq ll lm kp iu ln lo kt iy lp lq kx lr bi translated">FB先知</h2><p id="4cde" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">FbProphet是脸书核心数据科学团队发布的一个强大的时间序列分析包。这是一个简单易用的软件包，用于执行时间序列分析和<strong class="ih hj"> <em class="jm">规模预测</em> </strong>。</p><p id="971f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据官方<a class="ae ls" href="https://facebook.github.io/prophet/" rel="noopener ugc nofollow" target="_blank">先知网站</a>:</p><blockquote class="lt lu lv"><p id="247a" class="if ig jm ih b ii ij ik il im in io ip lw ir is it lx iv iw ix ly iz ja jb jc hb bi translated">Prophet是一种基于加法模型预测时间序列数据的过程，在该模型中，非线性趋势与每年、每周和每天的季节性以及假日影响相适应。它最适用于具有强烈季节效应的时间序列和几个季节的历史数据。Prophet对缺失数据和趋势变化非常稳健，通常能够很好地处理异常值。</p></blockquote><p id="ca4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个没有时间序列培训专业知识的分析师可以调整一些可解释的参数，并在Prophet中获得一个好的预测模型。</p><p id="08ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">脸书大学的数据科学团队发现，通过将自动预测与分析师在回路中对特殊情况的预测相结合，有可能涵盖各种各样的业务用例。下图说明了prophet中使用的预测流程:</p><figure class="ma mb mc md fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es lz"><img src="../Images/b1702d6a91615e5e642426dd339a2bfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NG9XQ0CCpd6cAUI3DoRG0g.png"/></div></div></figure><p id="6f2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Prophet使用一个可分解的时间序列模型，它有三个主要的模型组件:趋势、季节性和假日。它们在以下等式中合并:</p><p id="973a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> y(t) = g(t) + s(t) + h(t) + e(t) </strong></p><p id="9dad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，</p><ul class=""><li id="b8fa" class="jn jo hi ih b ii ij im in iq jp iu jq iy jr jc ml jt ju jv bi translated">g(t)是对非周期性变化建模的趋势函数。它可以是线性函数，也可以是逻辑函数。</li><li id="a324" class="jn jo hi ih b ii jw im jx iq jy iu jz iy ka jc ml jt ju jv bi translated">s(t)代表周期性变化，即每周、每月、每年。使用傅立叶级数模拟每年的季节性成分，使用虚拟变量模拟每周的季节性成分。</li><li id="53b0" class="jn jo hi ih b ii jw im jx iq jy iu jz iy ka jc ml jt ju jv bi translated">h(t)是一个函数，表示不规则时间表中出现的节假日的影响。(n≥1天)</li><li id="9ef3" class="jn jo hi ih b ii jw im jx iq jy iu jz iy ka jc ml jt ju jv bi translated">e(t)项表示模型不适应的误差变化。</li></ul><p id="f325" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">先知的研究论文可以在这里找到<a class="ae ls" href="https://peerj.com/preprints/3190.pdf#section.1" rel="noopener ugc nofollow" target="_blank"><em class="jm"/></a><em class="jm">。</em></p><h1 id="d0bd" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">装置</h1><p id="2bfc" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">Prophet有python和r两种版本。这个故事涵盖了Prophet的Python安装和实现。</p><p id="41ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以使用Python中的pip安装Prophet，如下所示。Prophet依赖于一个名为<code class="du mm mn mo mp b">pystan.</code>的Python模块，这个模块将在我们安装Prophet时自动安装。</p><pre class="ma mb mc md fd mq mp mr ms aw mt bi"><span id="6cc4" class="le kc hi mp b fi mu mv l mw mx">pip install fbprophet</span></pre><h1 id="dff0" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">例子</h1><p id="fdea" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">因为prophet最适合处理季节性数据，所以我在这里使用了简单的年度季节性数据。</p><p id="341c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们导入必要的库以及fb prophet并读取数据集。</p><figure class="ma mb mc md fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es my"><img src="../Images/965df33f9a9a7e321120592f288ebf9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TNXtPhdwtEOh0RFmoMfB7w.png"/></div></div></figure><p id="1c3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然prophet可以处理丢失的值，但是最好删除NaN值。数据集只有一个缺失值。删除缺少值的行，并将<em class="jm">月</em>列转换为日期时间类型。</p><figure class="ma mb mc md fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es mz"><img src="../Images/3b3d7eb50d487df475135abd4957ea38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XmTvCyKGG4iHf13BvEQrsA.png"/></div></div></figure><p id="be6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Prophet要求数据集的列有正确的命名约定。因此，根据prophet的要求，这些列被重命名为<em class="jm"> ds </em>和<em class="jm"> y </em>。现在，让我们可视化数据集。</p><figure class="ma mb mc md fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es na"><img src="../Images/9a31d2f1e0012dec7e282aa1ac3999aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VfSjeB56YFwn_csUqhk8vQ.png"/></div></div></figure><p id="416b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据集被分成训练集和测试集。prophet模型根据每年的季节性进行实例化，并适合训练数据集。</p><figure class="ma mb mc md fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es nb"><img src="../Images/14adb12d41d2d894740dc1e082386d0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ubsc5FkP23KoPuS6oPIkvg.png"/></div></div></figure><p id="c90e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，使用prophet的<em class="jm">make _ future _ data frame()</em>函数创建一个68个月(测试数据计数)的数据框架，模型在该数据框架中进行预测。</p><figure class="ma mb mc md fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es nc"><img src="../Images/d9bf491d6d72f479a09b0c37e9ebd26e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YNvfZ4ZBOviu5Hm4gM2u7Q.png"/></div></div></figure><p id="121e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们将上面的图表与实际数据进行比较，它们看起来非常相似。因此，该模型运行良好。</p><p id="9775" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Fbprophet提供了一个<em class="jm"> plot_component() </em>函数，可以用来可视化时间序列的整体趋势和分量。</p><figure class="ma mb mc md fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es nd"><img src="../Images/837be470fdcd34943ed36fae0e47ed0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LYHPiW3TOaHsMvnRumvPEw.png"/></div></div></figure><p id="a4bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我相信我能够用一个强大的prophet包的简短演示来很好地描述用于执行分析和预测的时间序列分析和ML模型。如果您希望了解如何使用prophet对非周期性数据进行时间序列分析，您可以通过下面的链接访问我的github repo。在那里，我也实现了ARIMA模型。</p><div class="ne nf ez fb ng nh"><a href="https://github.com/samiptimalsena/Time_Series_Analysis" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab dw"><div class="nj ab nk cl cj nl"><h2 class="bd hj fi z dy nm ea eb nn ed ef hh bi translated">samiptimalsena/时间序列分析</h2><div class="no l"><h3 class="bd b fi z dy nm ea eb nn ed ef dx translated">时间序列分析和预测。解散GitHub是超过5000万开发者的家园，他们一起工作来托管和…</h3></div><div class="np l"><p class="bd b fp z dy nm ea eb nn ed ef dx translated">github.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv mj nh"/></div></div></a></div></div></div>    
</body>
</html>