<html>
<head>
<title>How to create a python package and publish to PyPI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建 python 包并发布到 PyPI</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-create-a-python-package-and-publish-to-pypi-7e1b548add14?source=collection_archive---------7-----------------------#2020-10-08">https://medium.com/analytics-vidhya/how-to-create-a-python-package-and-publish-to-pypi-7e1b548add14?source=collection_archive---------7-----------------------#2020-10-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/f39b052f75279f0f8b16aaba309bd772.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*zrGrep-fmp8vOQT1EjbqOw.png"/></div></figure><p id="9bc6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">python 包索引(PyPI)是由开源 python 社区贡献的 Python 包的存储库，以帮助他人。创建包的目的是什么？没有它们，我们将不得不依赖于通过复制/粘贴来共享代码，这是没有效率的。一个包可以包含从 API 获取数据、对输入进行操作等代码。让我们看一个我创建的将文本转换成盲文的 python 包的例子，以及发布到 PyPI 的步骤。</p><h2 id="aae5" class="jk jl hi bd jm jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke bi translated"><strong class="ak">第一步:设置文件夹结构</strong></h2><p id="67ca" class="pw-post-body-paragraph im in hi io b ip kf ir is it kg iv iw ix kh iz ja jb ki jd je jf kj jh ji jj hb bi translated">按照下面所示的格式创建一个文件夹结构。主包文件夹名称应该与您的包名称相同。包含代码的文件夹可以命名为任何名称。在这里，我保留了与主包文件夹相同的名称。</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="2ca1" class="jk jl hi kp b fi kt ku l kv kw">.<br/>└── pybraille (main package folder)<br/>    └── pybraille (folder that contains your code)<br/>        └── your code here</span></pre><h2 id="71cc" class="jk jl hi bd jm jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke bi translated"><strong class="ak">第二步:添加你的代码</strong></h2><p id="52eb" class="pw-post-body-paragraph im in hi io b ip kf ir is it kg iv iw ix kh iz ja jb ki jd je jf kj jh ji jj hb bi translated">将所有类或脚本文件放在包含代码的文件夹中，并添加 __init__。py 文件。__init__。py 文件应该包含导入语句，以便只公开您希望用户访问的必需的类和函数。<code class="du kx ky kz kp b">from pybraille.main import convertText, convertFile</code></p><p id="a2ea" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">此外，您可以在 __init__ 中添加名为 __all__ 的列表。包含模块名称的 py 文件。这允许用户在遇到<code class="du kx ky kz kp b">from package import *</code>时导入 __all__ 变量中提到的所有模块名。<br/> <code class="du kx ky kz kp b">__all__ = [‘convertText’, ‘convertFile’]</code></p><h2 id="f97b" class="jk jl hi bd jm jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke bi translated"><strong class="ak">第三步:创建安装文件</strong></h2><p id="975a" class="pw-post-body-paragraph im in hi io b ip kf ir is it kg iv iw ix kh iz ja jb ki jd je jf kj jh ji jj hb bi translated">在主包文件夹中创建一个 setup.py 文件。这个安装文件包含告诉 pip 如何安装软件包的信息。</p><ul class=""><li id="492f" class="la lb hi io b ip iq it iu ix lc jb ld jf le jj lf lg lh li bi translated">find_packages()将自动查找主包文件夹中的所有包。</li><li id="afe5" class="la lb hi io b ip lj it lk ix ll jb lm jf ln jj lf lg lh li bi translated">关键字是用户搜索 python 包时应映射到包的字符串列表。</li><li id="1a6a" class="la lb hi io b ip lj it lk ix ll jb lm jf ln jj lf lg lh li bi translated">分类器帮助 PyPI 中的用户根据特定标准进行过滤。</li><li id="bd17" class="la lb hi io b ip lj it lk ix ll jb lm jf ln jj lf lg lh li bi translated">将版本号设置为低于 1.0.0，表示您的软件包不是稳定版本(如果适用)。</li></ul><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="1eb6" class="jk jl hi kp b fi kt ku l kv kw">from setuptools import setup, find_packages<br/>setup(<br/> name=’package name,<br/> version='package version',<br/> description='package description',<br/> url='Github Url', <br/> author='Your name',<br/> author_email='Your email',<br/> classifiers=[<br/>   'Development Status :: 5 - Production/Stable',<br/>   'Intended Audience :: Education',<br/>   'Operating System :: OS Independent',<br/>   'License :: OSI Approved :: MIT License',<br/>   'Programming Language :: Python :: 3',<br/>   'Programming Language :: Python :: 3.5',<br/>   'Programming Language :: Python :: 3.6',<br/>   'Programming Language :: Python :: 3.7',<br/>   'Programming Language :: Python :: 3.8',<br/> ],<br/> keywords=['python', 'braille', 'text to braille'],<br/> packages=find_packages()<br/>)</span></pre><h2 id="1fff" class="jk jl hi bd jm jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke bi translated">步骤 4:测试设置</h2><p id="f285" class="pw-post-body-paragraph im in hi io b ip kf ir is it kg iv iw ix kh iz ja jb ki jd je jf kj jh ji jj hb bi translated">运行这个命令:<code class="du kx ky kz kp b">python setup.py sdist<br/></code>这会在文件夹中创建一堆文件。主文件将是在“dist”文件夹中创建的 tar.gz 文件，最终发布到 PyPI。</p><p id="dd9d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在你可以在本地安装你的包，并使用命令<br/> <code class="du kx ky kz kp b">pip install -e ./</code>测试它</p><p id="6c62" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">安装完成后，您可以在主包文件夹中启动 python 终端，并测试您的包是否工作。</p><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lo"><img src="../Images/243e7c92a93e5c628e1f952ec82c9944.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QGRs0NH2ed8EAIoQFqLVXg.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">在本地测试您的包</figcaption></figure><h2 id="ebbc" class="jk jl hi bd jm jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke bi translated"><strong class="ak">第五步:添加所需文件</strong></h2><p id="335d" class="pw-post-body-paragraph im in hi io b ip kf ir is it kg iv iw ix kh iz ja jb ki jd je jf kj jh ji jj hb bi translated">要添加 gitignore 文件，我推荐使用这个网站:【https://www.toptal.com/developers/gitignore<a class="ae lx" href="https://www.toptal.com/developers/gitignore" rel="noopener ugc nofollow" target="_blank">。<br/>在搜索栏中输入“Python ”,它会显示文本，你可以将其复制到 gitignore 文件中。</a></p><p id="a0e7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">选择许可证可能会令人困惑。你可以看看这个网站<a class="ae lx" href="https://choosealicense.com/" rel="noopener ugc nofollow" target="_blank">https://choosealicense.com/</a>来帮你选择执照。将复制的文本粘贴到一个文件中，并将其命名为 LICENSE.txt。</p><p id="b9df" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">添加一个 README.md 文件来记录任何安装步骤以及如何使用库。要使这个自述文件成为 PyPI 下的正式文档，请将以下内容添加到 setup.py 文件中。</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="ae01" class="jk jl hi kp b fi kt ku l kv kw">with open("README.md", "r") as rd:<br/>  long_description = rd.read()</span><span id="e77f" class="jk jl hi kp b fi ly ku l kv kw">setup(<br/>...<br/>  long_description=long_description,<br/>  long_description_content_type="text/markdown",<br/>...  <br/>)</span></pre><p id="8cfb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果您有任何库依赖项，请将其添加到 setup.py 文件中</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="6ab9" class="jk jl hi kp b fi kt ku l kv kw">setup(<br/>...<br/>  install_requires=[<br/>    "any-library ~= 1.0"<br/>  ]<br/>...  <br/>)</span></pre><p id="7a18" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">通过运行以下命令，无论何时对 setup.py 文件进行更改，都可以在本地测试您的包:</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="d9cb" class="jk jl hi kp b fi kt ku l kv kw">python setup.py sdist<br/>pip install -e ./</span></pre><h2 id="551c" class="jk jl hi bd jm jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke bi translated"><strong class="ak">步骤 6:编写测试</strong></h2><p id="88cd" class="pw-post-body-paragraph im in hi io b ip kf ir is it kg iv iw ix kh iz ja jb ki jd je jf kj jh ji jj hb bi translated">在将代码投入生产之前测试它总是更好的。因此，在主包文件夹下创建一个“tests”文件夹，并在那里添加您的测试。我在开发中使用“pytest”进行测试。</p><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lz"><img src="../Images/25421b9f3a67051a82e8a460b1217b8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H9kh4mqc8UKF4y-Px8wpRg.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">运行您的测试</figcaption></figure><p id="f912" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您可以使用“tox”来针对多个 python 发行版测试您的代码。安装 tox 并在主包文件夹中创建一个 tox.ini 文件。</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="c972" class="jk jl hi kp b fi kt ku l kv kw">[tox]<br/>envlist = py36, py37<br/> <br/>[testenv]<br/>deps = pytest<br/>commands = pytest</span></pre><p id="b49e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">envlist 指定了测试代码的不同发行版。使用<code class="du kx ky kz kp b">tox</code>命令运行测试。</p><h2 id="8a32" class="jk jl hi bd jm jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke bi translated"><strong class="ak">第七步:发布</strong></h2><p id="6533" class="pw-post-body-paragraph im in hi io b ip kf ir is it kg iv iw ix kh iz ja jb ki jd je jf kj jh ji jj hb bi translated">最后，您的文件夹结构应该如下所示:</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="7f7c" class="jk jl hi kp b fi kt ku l kv kw">.<br/>└── pybraille<br/>    ├── build<br/>    ├── dist<br/>    │   └── pybraille-0.1.0.tar.gz<br/>    ├── pybraille<br/>    │   ├── main.py<br/>    │   └── __init__.py<br/>    ├── .gitignore<br/>    ├── LICENSE.txt<br/>    ├── README.md<br/>    ├── setup.py<br/>    └── tox.ini</span></pre><p id="edb3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当您准备好发布包时，运行<code class="du kx ky kz kp b">python setup.py sdist </code>命令在 dist 文件夹中创建一个 tar.gz 文件。确保它不会抛出任何错误。</p><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es ma"><img src="../Images/16b939da0ea2e5eec94e849cccbce5c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MbACwBMkr3XMuYt-Zb8PtQ.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">正在为您的包创建 dist</figcaption></figure><p id="9bac" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在 PyPI 网站(<a class="ae lx" href="https://pypi.org/" rel="noopener ugc nofollow" target="_blank">https://pypi.org/</a>)创建一个账户。</p><p id="5f7e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用 twine 将您的包上传到 PyPI。首先安装 twine 包，然后使用下面的命令发布包:</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="47f8" class="jk jl hi kp b fi kt ku l kv kw">twine upload dist/*</span></pre><p id="8d80" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">系统将提示您输入用户名和密码。如果上传成功，它会吐出你的包的网址。</p><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mb"><img src="../Images/9604ce829d0bff9a32ea7465f4fdf346.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sxjN7KcSsE5outqURjyP7w.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">正在将包上传到 PyPI</figcaption></figure><p id="6bfe" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您的包已上传到 PyPI。👏 🎉 🎉现在每个人都可以从 PyPI 安装你的包了。</p></div></div>    
</body>
</html>