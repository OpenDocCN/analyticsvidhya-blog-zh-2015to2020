# Python æ—¶é—´åºåˆ—é¢„æµ‹å…¥é—¨ğŸ‘

> åŸæ–‡ï¼š<https://medium.com/analytics-vidhya/get-started-with-time-series-forecasting-in-python-c8ca78ee84a5?source=collection_archive---------2----------------------->

![](img/8db77f11d252e8a2ee1a3a25f7374944.png)

**æ¦‚è¿°:**

*   ä»€ä¹ˆæ˜¯æ—¶é—´åºåˆ—ï¼Ÿ
*   æ—¶é—´åºåˆ—çš„ä¸åŒç»„æˆéƒ¨åˆ†ã€‚
*   ä¸åŒçš„æ—¶é—´åºåˆ—é¢„æµ‹æ¨¡å‹
*   Python ä¸­çš„è‹¹æœè‚¡ä»·é¢„æµ‹

**ä»€ä¹ˆæ˜¯æ—¶é—´åºåˆ—ï¼Ÿ**

æ—¶é—´åºåˆ—ä»…ä»…æ˜¯åœ¨è¿ç»­çš„æ—¶é—´ç‚¹å¯¹ä¸€ä¸ªæ•°é‡å˜é‡çš„æœ‰åºè§‚å¯Ÿã€‚æ—¶é—´å¯ä»¥æ˜¯å¹´ã€æœˆã€æ—¥ã€å°æ—¶ç­‰ã€‚è¿™å–å†³äºæ•°æ®æ”¶é›†è¿‡ç¨‹ã€‚æ—¶é—´åºåˆ—åœ¨è®¸å¤šä¸åŒé¢†åŸŸéƒ½æœ‰åº”ç”¨ï¼Œä¾‹å¦‚:

*   å›½æ°‘æ”¶å…¥å’Œå¤–æ±‡å‚¨å¤‡
*   è¡Œä¸šå†…çš„é”€å”®é¢å’Œåˆ©æ¶¦
*   è‚¡ç¥¨äº¤æ˜“å¸‚åœº
*   å¤©æ°”ç»Ÿè®¡åˆ†æ
*   å†œä¸šç”Ÿäº§
*   äººå£ç»Ÿè®¡å­¦ç­‰ã€‚

æ•°å­¦ä¸Šï¼Œæ—¶é—´åºåˆ—è¢«å®šä¹‰ä¸º

![](img/0882d26aa128e9f67aee45e83dc8eb65.png)

å…¶ä¸­`n`è¡¨ç¤ºè§‚å¯Ÿæ¬¡æ•°ã€‚ç”±äºå„ç§å› ç´ ï¼Œå€¼`Yt`éšæ—¶é—´`t`æ³¢åŠ¨ï¼Œå› æ­¤æ—¶é—´åºåˆ—ä¸æ˜¯æ—¶é—´çš„å¸¸æ•°å‡½æ•°ã€‚è®©æˆ‘ä»¬ç ”ç©¶ä¸€ä¸‹å¼•èµ·è¿™äº›æ³¢åŠ¨çš„ä¸€äº›å› ç´ ã€‚è¿™äº›ä¹Ÿè¢«ç§°ä¸ºæ—¶é—´åºåˆ—çš„ç»„æˆéƒ¨åˆ†ã€‚

1.  **è¶‹åŠ¿:**æ•°æ®åœ¨ä¸€æ®µè¾ƒé•¿çš„æ—¶é—´å†…ä¸€èˆ¬ä¼šæœ‰å¢åŠ æˆ–å‡å°‘çš„è¶‹åŠ¿ç§°ä¸ºå…·æœ‰æŸç§è¶‹åŠ¿ã€‚è¿™åœ¨ä¼ä¸šçš„ç»æµç»Ÿè®¡ä¸­æœ€ä¸ºå¸¸è§ã€‚åœ¨æ•´ä¸ªç»™å®šçš„æ—¶é—´æ®µå†…ï¼Œå¢åŠ æˆ–å‡å°‘çš„æ–¹å‘å¯èƒ½ä¸åŒã€‚åœ¨ä¸åŒçš„æ—¶é—´ä¼šæœ‰ä¸åŒçš„è¶‹åŠ¿ã€‚ç„¶è€Œï¼Œæ€»ä½“è¶‹åŠ¿å¯èƒ½æ˜¯å‘ä¸Šæˆ–å‘ä¸‹çš„ã€‚
2.  **å­£èŠ‚æ€§:**æ—¶é—´åºåˆ—ä¸­çš„å­£èŠ‚æ€§å˜åŒ–æ˜¯ç”±äºä¸€äº›å› ç´ åœ¨ä¸åˆ°ä¸€å¹´çš„æ—¶é—´å†…ä»¥è§„åˆ™å’Œå‘¨æœŸæ€§çš„æ–¹å¼å‘ç”Ÿä½œç”¨ï¼Œå¹¶ä¸”å¹´å¤ä¸€å¹´å…·æœ‰ç›¸åŒçš„æ¨¡å¼ã€‚è¿™äº›å› ç´ å¯èƒ½æ˜¯è‡ªç„¶å‘ç”Ÿçš„ï¼Œä¹Ÿå¯èƒ½æ˜¯äººä¸ºçš„å¹²é¢„ã€‚å­£èŠ‚æ€§ç ”ç©¶å¯¹äºä¼ä¸šåœ¨æŸä¸ªå­£èŠ‚æ—¶é—´çª—å†…åˆ›é€ æ›´å¤šæ”¶å…¥çš„å†³ç­–æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚
3.  **å‘¨æœŸå‹:**æ³¢åŠ¨å‘¨æœŸè¶…è¿‡ä¸€å¹´çš„æ—¶é—´åºåˆ—çš„æ³¢åŠ¨ç§°ä¸ºå‘¨æœŸå‹ã€‚ä¸€ä¸ªå®Œæ•´çš„å‘¨æœŸç§°ä¸ºâ€œå‘¨æœŸâ€ã€‚ä½ å¯èƒ½å¬è¯´è¿‡â€œå•†ä¸šå‘¨æœŸâ€ï¼Œåœ¨è¿™ç§å‘¨æœŸä¸­ï¼Œéœ€æ±‚å’Œä¾›ç»™ä¼šå—åˆ°ä¸€äº›ç»æµå› ç´ çš„å½±å“ã€‚ä¸å­£èŠ‚æ€§ä¸åŒï¼Œå¾ªç¯æ¨¡å¼ä¸æ˜¯å‘¨æœŸæ€§çš„ã€‚

**å¹³ç¨³æ€§**

ç›´è§‚ä¸Šï¼Œå¹³ç¨³æ€§æ„å‘³ç€æ—¶é—´åºåˆ—çš„ç»Ÿè®¡ç‰¹æ€§ä¸ä¼šéšæ—¶é—´è€Œæ”¹å˜ã€‚ä¾‹å¦‚ï¼Œå…·æœ‰ä¸Šè¿°æˆåˆ†çš„æ—¶é—´åºåˆ—è¶‹åŠ¿ã€å­£èŠ‚æ€§ç­‰ã€‚ä¸æ˜¯é™æ­¢çš„ã€‚å¹³ç¨³è¿‡ç¨‹å¾ˆå®¹æ˜“åˆ†æã€‚æ—¶é—´åºåˆ—çš„å¹³ç¨³æ€§ä¸»è¦æœ‰ä¸¤ç§ç±»å‹â€”â€”ä¸¥æ ¼å¹³ç¨³æ€§æˆ–å¼±å¹³ç¨³æ€§(åœ¨éšæœºè¿‡ç¨‹ç†è®ºä¸­ä¹Ÿç§°ä¸ºäºŒé˜¶å¹³ç¨³æ€§)ã€‚

*   **ä¸¥æ ¼å¹³ç¨³æ€§:**å¦‚æœ`Yt`çš„è¾¹é™…åˆ†å¸ƒåœ¨ä¸åŒçš„æ—¶é—´ç‚¹ t ç›¸åŒï¼Œå³

![](img/6528dd4cc446cbf37fd1541fb508e94f.png)

è¿™é‡Œï¼Œ`k`è¡¨ç¤ºæ»åã€‚

*   **å¼±å¹³ç¨³æ€§:**ä¸€ä¸ªåºåˆ—è¢«ç§°ä¸ºå¼±å¹³ç¨³çš„ï¼Œå¦‚æœ

![](img/2f1365cbfb604b859b5a4b31ff3269c9.png)

å› æ­¤ï¼Œåæ–¹å·®ä¸æ˜¯`t`çš„å‡½æ•°ã€‚ç°åœ¨ï¼Œé¦–å…ˆæƒ³åˆ°çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœçº§æ•°ä¸æ˜¯å¹³ç¨³çš„ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿç®€å•çš„ç­”æ¡ˆæ˜¯â€”â€”è®©å®ƒé™æ­¢ä¸åŠ¨ã€‚æˆ‘ä»¬æ€ä¹ˆåšå‘¢ï¼Ÿæœ‰ä¸åŒçš„æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½†è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•ä¸”æœ€å—æ¬¢è¿çš„æ–¹æ³•â€”â€”â€œå·®å¼‚â€ã€‚

**å·®å¼‚**

å·®åˆ†åŸºæœ¬ä¸Šæ˜¯ä»æ—¶é—´åºåˆ—çš„å½“å‰å€¼ä¸­å‡å»å…ˆå‰çš„å€¼ï¼Œå³

![](img/34b7e74907e8ec35ad4ba7d161e21c82.png)

ç„¶åä½¿ç”¨è¿™ä¸ªæ–°çš„å¹³ç¨³å·®åˆ†åºåˆ—ã€‚æœ‰æ—¶ä¸€é˜¶å·®åˆ†ä¸èƒ½ä½¿å®ƒç¨³å®šï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å»æ›´é«˜é˜¶ï¼Œåƒå·®åˆ†ä¸€é˜¶å·®åˆ†åºåˆ—ç­‰ç­‰ã€‚å·®å¼‚ç¨³å®šäº†åºåˆ—çš„å¹³å‡å€¼ï¼Œè¿™æœ‰åŠ©äºæ¶ˆé™¤è¶‹åŠ¿å’Œå­£èŠ‚æ€§ã€‚è¯¸å¦‚å¯¹æ•°å˜æ¢çš„å…¶ä»–æ–¹æ³•ç¨³å®šäº†æ–¹å·®ã€‚

**è‡ªç›¸å…³å‡½æ•°**

ä¸¤ä¸ªéšæœºå˜é‡çš„ç›¸å…³å‡½æ•°åº¦é‡ä¸¤ä¸ªå˜é‡çš„å…³è”ã€‚ç±»ä¼¼åœ°ï¼Œè‡ªç›¸å…³æµ‹é‡ç›¸åŒæ—¶é—´åºåˆ—çš„ä¸¤ä¸ªå€¼ä¹‹é—´çš„ç›¸å…³æ€§ã€‚è¿™äº›å€¼ç”±æ»å k åˆ†éš”ï¼Œæ»å k æ—¶çš„ ACF å¯ç”±ä¸‹å¼ç»™å‡º:

![](img/4c11c3c761ba6f327ecc74fe9ebc0ea1.png)

**åè‡ªç›¸å…³å‡½æ•°(PACF)**

éƒ¨åˆ†è‡ªç›¸å…³å‡½æ•°æ˜¯åœ¨å»é™¤å¯¹å…¶ä»–æ»åé¡¹çš„ä»»ä½•çº¿æ€§ä¾èµ–ä¹‹å`Yt`å’Œ`Y{t-k}`ä¹‹é—´çš„è‡ªç›¸å…³ï¼Œç”±ä¸‹å¼ç»™å‡º

![](img/ca8bd550da05425693e1f1fdfc8f7be0.png)

ä¸ºä»€ä¹ˆ ACF å’Œ PACF å¾ˆé‡è¦ï¼Ÿ

ä¸€æ—¦ä½ ä½¿æ—¶é—´åºåˆ—å¹³ç¨³ï¼Œæˆ‘ä»¬å¿…é¡»è®¡ç®— ACF å’Œ PACF ç›¸å…³å›¾ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ‰¾åˆ°é¢„æµ‹æ¨¡å‹æ‰€éœ€çš„å‚æ•°ã€‚è¿·èŒ«ï¼Ÿï¼Ÿï¼Ÿä¸è¦â€¦ç»§ç»­å†™è¿™ç¯‡æ–‡ç« ã€‚ä¸€æ—¦æˆ‘ä»¬çœ‹å®Œè¿™ä¸ªä¾‹å­ï¼Œä½ å°±ä¼šæ˜ç™½äº†ã€‚

**ç™½å™ªå£°**

ç™½å™ªå£°ä¸è¿‡æ˜¯ä¸€ä¸ªå‡å€¼ä¸ºé›¶ã€æ–¹å·®ä¸å˜ã€åæ–¹å·®ä¸ºé›¶çš„éšæœºåºåˆ—ã€‚

![](img/aed6feba6fda527059e32ebc8210b491.png)

å¦‚æœæ—¶é—´åºåˆ—æ˜¯ç™½å™ªå£°ï¼Œæˆ‘ä»¬å°±æ— æ³•é¢„æµ‹ã€‚å°±åœåœ¨é‚£é‡Œï¼

# **é¢„æµ‹æ¨¡å‹**

ç°åœ¨ï¼Œè®©æˆ‘ä»¬è®¨è®ºå››ä¸ªé‡è¦çš„é¢„æµ‹æ¨¡å‹ã€‚

1.  **è‡ªå›å½’æ¨¡å‹(AR(p))**

åœ¨ AR(p)æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å˜é‡è¿‡å»å€¼çš„çº¿æ€§ç»„åˆæ¥é¢„æµ‹æ„Ÿå…´è¶£çš„å˜é‡ã€‚æœ¯è¯­ A***utoregression***è¡¨ç¤ºå®ƒæ˜¯å˜é‡å¯¹è‡ªèº«çš„å›å½’ã€‚`p`è¡¨ç¤ºæ¨¡å‹ä¸­åŒ…å«çš„è¿‡å»å€¼çš„æ•°é‡ã€‚AR(p)æ¨¡å‹ç”±ä¸‹å¼ç»™å‡º

![](img/d3fc19a9293ac9115336254ac73ff2df.png)

2.**å‡çº¿æ¨¡å‹(MA(q))**

ç§»åŠ¨å¹³å‡æ¨¡å‹ä¸æ˜¯åœ¨å›å½’ä¸­ä½¿ç”¨é¢„æµ‹å˜é‡çš„è¿‡å»å€¼ï¼Œè€Œæ˜¯åœ¨å›å½’ä¸­ä½¿ç”¨è¿‡å»çš„é¢„æµ‹è¯¯å·®`e`ã€‚`q`è¡¨ç¤ºæ¨¡å‹ä¸­ä½¿ç”¨çš„è¿‡å»è¯¯å·®é¡¹çš„æ•°é‡ã€‚MA(q)æ¨¡å‹ç»™å‡ºä¸º

![](img/c63b643e298b7d7bbc9ca7b9c4502447.png)

3.**è‡ªå›å½’ç§»åŠ¨å¹³å‡æ¨¡å‹(ARMA(pï¼Œq))**

ç°åœ¨å¾ˆç›´è§‚çš„å°±èƒ½å¼„æ¸…æ¥šè¿™ä¸ªæ¨¡å‹æœ‰ä»€ä¹ˆã€‚ä½ æ˜¯å¯¹çš„ï¼å®ƒåŒ…å«ä¸¤é¡¹ï¼Œå³åºåˆ—çš„è¿‡å»å€¼å’Œè¯¯å·®é¡¹ã€‚`p`å’Œ`q`åˆ†åˆ«æ˜¯ AR å’Œ MA æ¨¡å‹çš„å‚æ•°ã€‚ARMA(pï¼Œq)æ¨¡å‹ç»™å‡ºå¦‚ä¸‹:

![](img/70c411706e31184fb724260afaa0bd1b.png)

4.**è‡ªå›å½’ç»¼åˆç§»åŠ¨å¹³å‡æ¨¡å‹(ARIMA(pï¼Œdï¼Œq))**

å½“æˆ‘ä»¬å°†å·®åˆ†ä¸è‡ªå›å½’ç§»åŠ¨å¹³å‡æ¨¡å‹(ARMA)ç›¸ç»“åˆæ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª ARIMA æ¨¡å‹ã€‚è¿™æœ‰ä¸‰ä¸ªå‚æ•°ã€‚`p`æ˜¯ AR æ¨¡å‹çš„é˜¶æ•°ï¼Œ`q`æ˜¯ MA æ¨¡å‹çš„é˜¶æ•°ï¼Œ`d`æ˜¯å·®åˆ†çš„é˜¶æ•°ã€‚ARIMA(pï¼Œdï¼Œq)æ¨¡å‹ç”±ä¸‹å¼ç»™å‡º

![](img/fb7b263454ac931a3574b8181d8d0065.png)

å…¶ä¸­è™šçº¿ Y é¡¹æ˜¯å·®åˆ†çº§æ•°é¡¹ã€‚

# åšå…‹æ–¯-è©¹é‡‘æ–¯æ³•(B-J æ³•)

Box-Jenkins æ–¹æ³•æ˜¯ç”± George Box å’Œ Gwilym Jenkins åœ¨ä»–ä»¬ 1970 å¹´çš„å¼€åˆ›æ€§æ•™ç§‘ä¹¦[æ—¶é—´åºåˆ—åˆ†æ:é¢„æµ‹å’Œæ§åˆ¶](https://amzn.to/31OLnFH)ä¸­æå‡ºçš„ã€‚

ä»–ä»¬åˆ¶å®šäº†ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤æ¥é¢„æµ‹å•å˜é‡æ—¶é—´åºåˆ—:

1.  **è¯†åˆ«:**åœ¨è¿™ä¸ªæ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æŸ¥çœ‹ ACF å’Œ PACF å›¾æˆ–è€…é€šè¿‡ä¸€äº›ç»Ÿè®¡æµ‹è¯•æ¥è¯†åˆ« ARIMA æ¨¡å‹`p`ã€`d`å’Œ`q`çš„å‚æ•°ã€‚é€šå¸¸ï¼Œæ ¹æ® ACF å’Œ PACF å›¾ä¸­çš„æ¨¡å¼é€‰æ‹©ä»¥ä¸‹æ¨¡å‹:

![](img/28ab397d0c044a47f3bb4ee08d9daf46.png)

**2ã€‚ä¼°è®¡:**åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨åƒæœ€å¤§ä¼¼ç„¶ä¼°è®¡(MLE) / Yule-Walker è¿‡ç¨‹/çŸ©æ–¹æ³•(MOM)è¿™æ ·çš„æ–¹æ³•æ¥ä¼°è®¡æ—¶é—´åºåˆ—å›å½’æ¨¡å‹ä¸­çš„ä»¥ä¸‹å‚æ•°ã€‚

![](img/fdebc12483e33aa42da1bc0b4659b9d7.png)

**3ã€‚è¯Šæ–­æ£€æŸ¥:**åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„æŒ‡æ ‡ï¼Œå¦‚ AICã€BICã€MAPE ç­‰ï¼Œæ¥æ£€æŸ¥æ¨¡å‹çš„é¢„æµ‹å‡†ç¡®æ€§ã€‚

> å—å¤Ÿäº†æ¦‚å¿µï¼è®©æˆ‘ä»¬æ¥çœ‹çœ‹ Python ä¸­çš„è‹¹æœè‚¡ä»·é¢„æµ‹ã€‚

é¦–å…ˆè®©æˆ‘ä»¬åŠ è½½æ‰€æœ‰éœ€è¦çš„åŒ…ã€‚

```
from pandas_datareader import data
from datetime import datetime
import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
from statsmodels.graphics.tsaplots import acf, plot_acf, plot_pacf
from statsmodels.tsa.stattools import adfuller
from pmdarima.arima.utils import ndiffs
from statsmodels.tsa.arima_model import ARIMA
import pmdarima as pm
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä»é›…è™ä¸‹è½½ 2019 å¹´ 1 æœˆ 1 æ—¥è‡³ 2020 å¹´ 1 æœˆ 1 æ—¥çš„è‹¹æœè‚¡ç¥¨æ•°æ®ï¼Œå¹¶ç»˜åˆ¶æˆªè‡³ç›®å‰çš„æ”¶ç›˜ä»·ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ”¶ç›˜ä»·ä½œä¸ºé¢„æµ‹çš„å•å˜é‡æ—¶é—´åºåˆ—ã€‚

```
aapl = data.DataReader('AAPL', 'yahoo', datetime(2019, 1, 1), datetime(2020, 1, 1))
series1 = aapl.Close.dropna() #original series
ax = plt.axes()
ax.set_facecolor('beige')
plt.plot(series1)
```

![](img/8db77f11d252e8a2ee1a3a25f7374944.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ° 2019 å¹´ 12 ä¸ªæœˆçš„å¢é•¿è¶‹åŠ¿ï¼Œè¿™å‘Šè¯‰æˆ‘ä»¬è‚¡ç¥¨è¡¨ç°å¾ˆå¥½ã€‚ğŸ‘

ç°åœ¨ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªè¶‹åŠ¿ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªå¹³ç¨³çš„åºåˆ—ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨è¿™ä¸ªåºåˆ—è¿›è¡Œé¢„æµ‹ï¼Œæˆ‘ä»¬éœ€è¦å·®åˆ†å®ƒï¼Œå¹¶æ‰¾åˆ°å·®åˆ†çš„é¡ºåºï¼Œä½¿å®ƒå¹³ç¨³ã€‚è®©æˆ‘ä»¬é¦–å…ˆè¿›è¡Œä¸€é˜¶å·®åˆ†ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦ä½¿åºåˆ—å¹³ç¨³ã€‚

```
ax = plt.axes()
series2 = aapl.Close.diff().dropna() #first order differenced series
ax.set_facecolor('silver')
plt.plot(series2)
```

![](img/316f030a84bef1f8dc540562d4894f9f.png)

å®ƒç¡®å®ä½¿å®ƒæˆä¸ºäº†ä¸€ä¸ªå›ºå®šç³»åˆ—ï¼ç°åœ¨ï¼Œå¦‚æœä½ ä»ç„¶ä¸ç›¸ä¿¡çœ‹åˆ°çš„å›¾ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ä¸€äº›ç»Ÿè®¡æµ‹è¯•ï¼Œç»™æˆ‘ä»¬æ‰€éœ€çš„å·®åˆ†é¡ºåºï¼Œä½¿ä¸€ç³»åˆ—å¹³ç¨³ã€‚

```
# Adf Test
ndiffs(series1, test='adf')  # output is 1# KPSS test
ndiffs(series1, test='kpss')  # output is 1# PP test:
ndiffs(series1, test='pp')  # output is 1
```

å› æ­¤ï¼Œåœ¨æ‰€æœ‰ä¸‰ä¸ªæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å¾—åˆ°çš„å·®å€¼é¡ºåºä¸º 1ã€‚

å¤ªå¥½äº†ï¼è®©æˆ‘ä»¬ä¹Ÿæ£€æŸ¥ä¸€ä¸‹ ACF å›¾åœ¨å·®åˆ†åæ˜¯å¦æ”¹å˜äº†ã€‚å¯ä»¥çœ‹åˆ°ï¼Œéå¹³ç¨³åºåˆ—çš„ ACF è¡°å‡ç¼“æ…¢ï¼Œè€Œå¹³ç¨³åºåˆ—çš„ ACF è¡°å‡å¾ˆå¿«ã€‚

```
plt.rcParams.update({'figure.figsize':(12,7), 'figure.dpi':120})
# Original Series
fig, axes = plt.subplots(2, 2)
axes[0, 0].plot(series1); 
axes[0, 0].set_title('Original Series')
plot_acf(series1, ax=axes[0, 1])# 1st Differencing
axes[1, 0].plot(series2); 
axes[1, 0].set_title('1st Order Differencing')
plot_acf(series2, ax=axes[1, 1])plt.show()
```

![](img/99e966b12779941f753588be2b436469.png)

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ç¡®å®šäº†å‚æ•°`d`çš„å€¼ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦ç¡®å®šåˆ†åˆ«æ˜¯ AR å’Œ MA æ¨¡å‹é˜¶æ•°çš„`p`å’Œ`q`çš„å€¼ã€‚

ä¸ºäº†ç¡®å®š`p`ï¼Œæˆ‘ä»¬éœ€è¦çœ‹çœ‹ PACF å›¾ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åœ¨ä¸‹é¢ç»˜åˆ¶å®ƒã€‚

```
fig, axes = plt.subplots(1, 2)
axes[0].plot(series2); 
axes[0].set_title('1st Differencing')
axes[1].set(ylim=(-1,1))
plot_pacf(series2, ax=axes[1])plt.show()
```

![](img/fddd565c23bbfc2d77fe3cb6df012b58.png)

ä½ å¯ä»¥çœ‹åˆ°å”¯ä¸€æœ‰æ„ä¹‰çš„æ»åæ˜¯ 0ã€‚äºæ˜¯ï¼Œæå®š`p=0`

ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡æŸ¥çœ‹ ACF å›¾æ¥æ‰¾åˆ° MA(q)æ¨¡å‹ä¸­çš„`q` é¡¹ã€‚

```
#Find q in MA(q)
plt.rcParams.update({'figure.figsize':(12,3), 'figure.dpi':120})
fig, axes = plt.subplots(1, 2)
axes[0].plot(series2); 
axes[0].set_title('1st Differencing')
axes[1].set(ylim=(-1,1))
plot_acf(series2, ax=axes[1])plt.show()
```

![](img/5864531e816b54013f27dad72a73ddf7.png)

ä½ å¯ä»¥çœ‹åˆ°å”¯ä¸€æœ‰æ„ä¹‰çš„æ»åæ˜¯ 0ã€‚å› æ­¤ï¼Œå›ºå®š q=0

ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰`p=0`ã€`d=1`å’Œ`q=0`ã€‚ä½ è¿˜åœ¨ç­‰ä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿ

è®©æˆ‘ä»¬æ¥æ‹Ÿåˆ ARIMA (0ï¼Œ1ï¼Œ0)æ¨¡å‹ã€‚

```
# 0,1,0 ARIMA Model
model = ARIMA(series1.dropna(), order=(0,1,0))
model_fit = model.fit(disp=0)
print(model_fit.summary())
```

![](img/d7ee7fe5ec585a97b9058f3f1b5b4ee2.png)

ä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç³»æ•°ä¸­ï¼Œæˆ‘ä»¬åªæœ‰å¸¸æ•°é¡¹ï¼Œæ²¡æœ‰å…¶ä»–ç³»æ•°ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æœ‰`p=0`å’Œ`q=0`ï¼Œè¿™æ„å‘³ç€æ¨¡å‹ä¸­ä¸åŒ…å«è¿‡å»çš„å€¼å’Œé”™è¯¯ã€‚æœ‰é“ç†å¯¹å—ï¼Ÿ

æ—¢ç„¶æˆ‘ä»¬å·²ç»æ‹Ÿåˆäº†æ¨¡å‹ï¼Œè®©æˆ‘ä»¬é€šè¿‡ç»˜åˆ¶æ®‹å·®å›¾æ¥æ£€æŸ¥å®ƒçš„å‡†ç¡®æ€§ã€‚ç°åœ¨ï¼Œè®°ä½æˆ‘ä»¬ä½¿ç”¨çš„æ—¶é—´åºåˆ—æ¨¡å‹åªä¸è¿‡æ˜¯å‚æ•°å›å½’æ¨¡å‹ã€‚å› æ­¤ï¼Œæ®‹å·®åº”è¯¥éµå¾ªå›å½’æ¨¡å‹çš„å‡è®¾ï¼Œæˆ–è€…ç®€å•åœ°è¯´ï¼Œå®ƒä»¬åº”è¯¥æ˜¯ç™½å™ªå£°ã€‚ç°åœ¨ä½ æ˜ç™½äº†â€”â€”ä»€ä¹ˆæ˜¯ç™½å™ªéŸ³ã€‚

```
# Plot residual errors
residuals = pd.DataFrame(model_fit.resid)
fig, ax = plt.subplots(1,2)
residuals.plot(title="Residuals", ax=ax[0])
residuals.plot(kind='kde', title='Density', ax=ax[1])
plt.show()
```

![](img/24904a77404b519a1c267cd9446170e1.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ®‹å·®æ˜¯éšæœºç™½å™ªå£°ï¼Œæ­£æ€åˆ†å¸ƒï¼å¤ªå¥½äº†ï¼Œæˆ‘ä»¬åˆšåˆšæ‰¾åˆ°äº†æœ€é€‚åˆæˆ‘ä»¬æ•°æ®çš„æ—¶é—´åºåˆ—æ¨¡å‹ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç»˜åˆ¶å®é™…çš„å’Œæ‹Ÿåˆçš„æ—¶é—´åºåˆ—ã€‚

```
# Actual vs Fitted
model_fit.plot_predict(dynamic=False)
plt.show()
```

![](img/e77ef6c20a70bc72e2ea277fc5f20cba.png)

éå¸¸é€‚åˆï¼ç°åœ¨æˆ‘ä»¬äº†è§£äº†ä»€ä¹ˆæ˜¯æ—¶é—´åºåˆ—å»ºæ¨¡ã€‚è®©æˆ‘ä»¬é¢„æµ‹ï¼Œè¿™æ˜¯æœ¬æ•™ç¨‹çš„ä¸»è¦ç›®æ ‡ã€‚é¦–å…ˆæ ¹æ®æˆ‘ä»¬çš„æ•°æ®åˆ›å»ºè®­ç»ƒå’Œæµ‹è¯•é›†ï¼Œæ„å»ºæ¨¡å‹ï¼Œç„¶åè¿›è¡Œé¢„æµ‹ã€‚ç®€å•ï¼

```
# Create Training and Test
train = series1.dropna()[:200] #first 200 rows in the training set
test = series1.dropna()[200:] #remaining rows in the test set#If it is not a time series, then this is not the ideal way for #train-test split. You may use scikit-learn library and use function #train_test_split() by providing the ratio. Since this is a time-#series data set, we cannot use future values to predict past #values.# Build Model
# model = ARIMA(train, order=(0,1,0))  
model = ARIMA(train, order=(0, 1, 0))  
fitted = model.fit(disp=-1)# Forecast
fc, se, conf = fitted.forecast(53, alpha=0.05)  # 95% conf# Make as pandas series
fc_series = pd.Series(fc, index=test.index)
lower_series = pd.Series(conf[:, 0], index=test.index)
upper_series = pd.Series(conf[:, 1], index=test.index)# Plot
plt.figure(figsize=(12,5), dpi=100)
plt.plot(train, label='training')
plt.plot(test, label='actual')
plt.plot(fc_series, label='forecast')
plt.fill_between(lower_series.index, lower_series, upper_series, 
                 color='k', alpha=.15)
plt.title('Forecast vs Actuals')
plt.legend(loc='upper left', fontsize=8)
plt.show()
```

![](img/b4d0ecae6ecf7477ff94f218db9ab689.png)

è¿™æ˜¯ä¸€ä¸ªä¸é”™çš„é¢„æµ‹ï¼Œå› ä¸ºå®é™…å€¼ä½äºç½®ä¿¡åŒºé—´å†…ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å‡ ä¸ªå‡†ç¡®æ€§æŒ‡æ ‡ï¼Œçœ‹çœ‹è¿™ä¸ªæ¨¡å‹æ˜¯å¦å¥½ã€‚

```
# Accuracy metrics
def forecast_accuracy(forecast, actual):
    mape = np.mean(np.abs(forecast - actual)/np.abs(actual))  # MAPE
    me = np.mean(forecast - actual)             # ME
    mae = np.mean(np.abs(forecast - actual))    # MAE
    mpe = np.mean((forecast - actual)/actual)   # MPE
    rmse = np.mean((forecast - actual)**2)**.5  # RMSE
    corr = np.corrcoef(forecast, actual)[0,1]   # corr
    mins = np.amin(np.hstack([forecast[:,None], 
                              actual[:,None]]), axis=1)
    maxs = np.amax(np.hstack([forecast[:,None], 
                              actual[:,None]]), axis=1)
    minmax = 1 - np.mean(mins/maxs)             # minmax
    acf1 = acf(fc-test)[1]                      # ACF1
    return({'mape':mape, 'me':me, 'mae': mae, 
            'mpe': mpe, 'rmse':rmse, 'acf1':acf1, 
            'corr':corr, 'minmax':minmax})forecast_accuracy(fc, test.values)
#MAPA is 0.065 which implies 93.5% accuracy in the prediction
```

![](img/2b6016aab581c16ebab284665cd7b63a.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒMAPE(å¹³å‡ç»å¯¹é¢„æµ‹è¯¯å·®)ä¸º 0.065ï¼Œè¿™æ„å‘³ç€é¢„æµ‹çš„å‡†ç¡®åº¦ä¸º 93.5%ã€‚è¿˜ä¸é”™ï¼

ç°åœ¨ï¼Œå¦‚æœä½ ä¸æƒ³åšè¿™ä¸ªå¯»æ‰¾`p`ã€`d`å’Œ`q`çš„å¤§ç¨‹åºï¼Œé‚£æˆ‘ä»¬å°±é•¿è¯çŸ­è¯´å§ã€‚åªéœ€ä½¿ç”¨ auto_arima()å‡½æ•°ï¼Œå®ƒä¼šä¸ºæ‚¨æä¾›æœ€ä½³çš„å‚æ•°å’Œæ¨¡å‹ã€‚

```
#Automate ARIMA modelmodel = pm.auto_arima(series1.dropna(), start_p=0, start_q=0,
                      test='adf',       # use adftest to find optimal 'd'
                      max_p=3, max_q=3, # maximum p and q
                      m=1,              # frequency of series
                      d=None,           # let model determine 'd'
                      seasonal=False,   # No Seasonality
                      start_P=0, 
                      D=0, 
                      trace=True,
                      error_action='ignore',  
                      suppress_warnings=True, 
                      stepwise=True)print(model.summary())
```

![](img/db7f809317f340e1badb3df5ccdd3d9b.png)![](img/e203f4ca65dbf78f9def7867e2116f4d.png)

å› æ­¤ï¼Œæˆ‘ä»¬çš„æ¨¡å‹ä¼°è®¡ç¡®å®æ˜¯æ­£ç¡®çš„ã€‚æˆ‘ä»¬æ•°æ®çš„æœ€ä½³æ¨¡å‹æ˜¯ ARIMA(0ï¼Œ1ï¼Œ0)ã€‚å¤ªå¥½äº†ï¼

ç°åœ¨ï¼Œåªéœ€æŸ¥çœ‹æœ€ä½³æ¨¡å‹çš„æ®‹å·®ç›´æ–¹å›¾å’Œ QQplotã€‚

```
model.plot_diagnostics(figsize=(7,5))
plt.show()
```

![](img/e43371e07b7ff0c3fba4051714810102.png)

QQplot ä¼¼ä¹éµå¾ªæ­£æ€åˆ†ä½æ•°ã€‚æ²¡æœ‰å¤§å°¾å·´ã€‚ç›´æ–¹å›¾å’Œå¯†åº¦çœ‹èµ·æ¥ä¹Ÿæ­£å¸¸ã€‚ç›¸å…³å›¾è¯´ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¹³ç¨³çš„æ—¶é—´åºåˆ—ã€‚å¤ªå¥½äº†ï¼ï¼ï¼ï¼ä¸€åˆ‡éƒ½å¥½ï¼ï¼ï¼è®©æˆ‘ä»¬æ‹æ‹èƒŒï¼Œæ˜¯æ—¶å€™åšäº›æ€»ç»“äº†ã€‚

## **ç»“å°¾å¤‡æ³¨:**

æˆ‘ä»¬åˆšåˆšç”¨å•å˜é‡æ—¶é—´åºåˆ—æ¢è®¨äº†æ—¶é—´åºåˆ—åˆ†æçš„åŸºæœ¬æ¡†æ¶ã€‚åƒ RNN è¿™æ ·çš„éå‚æ•°æ¨¡å‹å’Œæ·±åº¦å­¦ä¹ æ¨¡å‹ä¹Ÿç”¨äºé¢„æµ‹ã€‚å¤šå…ƒæ—¶é—´åºåˆ—å»ºæ¨¡ä¹Ÿåœ¨å®è·µä¸­ä½¿ç”¨ã€‚å‰é¢è¿˜æœ‰å¾ˆå¤šä¸œè¥¿è¦å­¦ã€‚æˆ‘å°†åœ¨æ¥ä¸‹æ¥çš„æ•…äº‹ä¸­è®¨è®ºæ›´å¤æ‚çš„æ¨¡å‹ã€‚æ•¬è¯·æœŸå¾…ï¼

å¦‚æœä½ è§‰å¾—è¿™ä¸ªåšå®¢æœ‰ç”¨ï¼Œè¯·ç‚¹èµã€è¯„è®ºå¹¶åˆ†äº«ã€‚æˆ‘å¾ˆä¹æ„åœ¨è¯„è®ºåŒºå›ç­”ä½ çš„é—®é¢˜ã€‚

# å›å¤´è§ï¼