<html>
<head>
<title>LUNG CANCER DIAGNOSIS: MAKING MACHINES THAT THINK LIKE HUMAN BEINGS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">肺癌诊断:制造像人类一样思考的机器</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/lung-cancer-diagnosis-making-machines-that-think-like-human-beings-6463ca8e33d7?source=collection_archive---------19-----------------------#2020-11-02">https://medium.com/analytics-vidhya/lung-cancer-diagnosis-making-machines-that-think-like-human-beings-6463ca8e33d7?source=collection_archive---------19-----------------------#2020-11-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class="if ig ez fb ih ii"><a href="https://github.com/TomiTsuma/Lung-Cancer-Diagnosis/blob/master/Core%26Outline%20Lung%20Cancer%20Diagnosis.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="ij ab dw"><div class="ik ab il cl cj im"><h2 class="bd hj fi z dy in ea eb io ed ef hh bi translated">富津马/肺癌-诊断</h2><div class="ip l"><h3 class="bd b fi z dy in ea eb io ed ef dx translated">permalink dissolve GitHub是超过5000万开发人员的家园，他们一起工作来托管和审查代码，管理…</h3></div><div class="iq l"><p class="bd b fp z dy in ea eb io ed ef dx translated">github.com</p></div></div><div class="ir l"><div class="is l it iu iv ir iw ix ii"/></div></div></a></div><p id="b6a6" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">肺癌是美国男性和女性的头号癌症杀手。它夺去的生命比乳腺癌、结肠癌和前列腺癌加起来还多。像所有其他类型的癌症一样，肺部的结节是癌症的征兆。</p><p id="64c3" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">医生通常使用肺部CT扫描来确定肺部是否存在结节。要注意的是，从单个患者中提取几个图像，从而可以形成肺部的3D图像。这些图像是矢状、冠状和轴向视图。因此，对于患者扫描的单个实例，我们甚至可以产生600个图像。医生的职责是识别这些图像中的结节。结节必须是可触及的。</p><blockquote class="jw jx jy"><p id="02c4" class="iy iz jz ja b jb jc jd je jf jg jh ji ka jk jl jm kb jo jp jq kc js jt ju jv hb bi translated">肿瘤可以根据大小分为“良性”或“恶性”。</p></blockquote><p id="7e18" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">良性肿瘤更容易治疗，但如果没有及早发现和治疗，也很容易发展成恶性肿瘤(在这种情况下，你被称为癌症)。</p><p id="b909" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">本文的重点是展示我如何设计一个神经网络，它可以用来将病人的CT扫描分类为有结节或无结节。</p><h2 id="701e" class="kd ke hi bd kf kg kh ki kj kk kl km kn jj ko kp kq jn kr ks kt jr ku kv kw kx bi translated">所需的模块</h2><p id="aea3" class="pw-post-body-paragraph iy iz hi ja b jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv hb bi translated">作为我的习惯，我确保在笔记本的第一个单元格中有我所有的重要陈述。</p><figure class="ld le lf lg fd lh"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="947c" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">从顶部开始:</p><ol class=""><li id="744a" class="lk ll hi ja b jb jc jf jg jj lm jn ln jr lo jv lp lq lr ls bi translated">numpy数组是keras分类器可接受的输入类型。</li><li id="674b" class="lk ll hi ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls bi translated">Pandas用于读取来自lidc-idri结核计数(2015年6月23日)的数据。xlsx 文件。</li><li id="d6a5" class="lk ll hi ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls bi translated">Matplotlib用于绘制相对于组件数量的累积解释方差图。</li><li id="c8db" class="lk ll hi ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls bi translated">Os用于访问windows的文件结构和读取文件。</li><li id="baa5" class="lk ll hi ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls bi translated">Shutil用于将文件复制并移动到适当的文件夹中进行分类。</li><li id="d16b" class="lk ll hi ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls bi translated">CV2用于从图像中读取像素数据和向图像中写入像素数据。</li><li id="e6f3" class="lk ll hi ja b jb lt jf lu jj lv jn lw jr lx jv lp lq lr ls bi translated">Pydicom用于从。dcm文件，尤其是像素数据。</li></ol><p id="e9c4" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">keras分类器的各层将在后面详述。</p><p id="5f70" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">8.Adam优化器将用于分类器。</p><p id="8233" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">9.后端将用于检查“channel_last”是否被添加到我们输入的输入形状中。</p><p id="63bf" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">10.ImageDataGenerator将用于增加图像，以匹配每个类别中的图像数量。</p><p id="ea0a" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">11.PCA用于仅确定有差异的列，以避免不必要的数据。</p><h2 id="9e12" class="kd ke hi bd kf kg kh ki kj kk kl km kn jj ko kp kq jn kr ks kt jr ku kv kw kx bi translated">探索性数据分析</h2><p id="4daa" class="pw-post-body-paragraph iy iz hi ja b jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv hb bi translated">我们必须首先执行一些EDA，以确保我们的数据是正确的，然后才能为我们的模型提取必要的数据。</p><figure class="ld le lf lg fd lh"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="6f6c" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">我们创建了一个数据帧，并将其命名为nodCount。然后，我试图消除所有具有空值的列和行。</p><p id="27ae" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">就EDA而言，还有很多事情要做，但我们现在不会详细讨论这些。</p><h2 id="7674" class="kd ke hi bd kf kg kh ki kj kk kl km kn jj ko kp kq jn kr ks kt jr ku kv kw kx bi translated">对病人档案进行分类</h2><figure class="ld le lf lg fd lh"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="03a4" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">以上是一个二元分类问题。因此，我们想创建两个文件夹，“零结节”和“潜在癌变”。这些将容纳。无结节记录患者和至少有一个结节记录患者的dcm文件。</p><h2 id="070e" class="kd ke hi bd kf kg kh ki kj kk kl km kn jj ko kp kq jn kr ks kt jr ku kv kw kx bi translated">为分类器创建图像</h2><figure class="ld le lf lg fd lh"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="9cb9" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">CT扫描通常保存为。dcm文件。这些通常包含所有患者数据，所有数据都方便地存储为单个文件。在这些里面。dcm文件是我们可以用来创建图像的像素数据。</p><p id="1910" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">由于文件已经被分成两个文件夹，我们需要编写两个函数。</p><blockquote class="jw jx jy"><p id="08c6" class="iy iz jz ja b jb jc jd je jf jg jh ji ka jk jl jm kb jo jp jq kc js jt ju jv hb bi translated">“需要”实际上并不准确，我只是选择以一种任意的方式做事。我们实际上可以只使用一个函数，它的参数是病人的文件夹位置。dcm文件和存储图像的位置。</p></blockquote><p id="7473" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">我使用了迭代循环，第一次循环对每个类别中病人的所有文件夹都这样做，第二次循环对所有。每个患者文件夹中的dcm文件。</p><p id="899d" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">我们读了。dcm文件使用:</p><p id="f90d" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated"><code class="du lz ma mb mc b">ds = dicom.dcmread((“patient id”),force = False)</code></p><p id="8173" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">“force”设置为false，以确保它只读取。dcm文件。</p><p id="13d3" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">使用以下方法访问像素数据:</p><pre class="ld le lf lg fd md mc me mf aw mg bi"><span id="b5ed" class="kd ke hi mc b fi mh mi l mj mk">pixel_array_numpy = ds.pixel_array</span></pre><p id="605c" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">然后，使用以下命令将其写入新创建的图像文件:</p><pre class="ld le lf lg fd md mc me mf aw mg bi"><span id="dadd" class="kd ke hi mc b fi mh mi l mj mk">cv2.imwrite(img,pixel_array_numpy)</span></pre><p id="93d1" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">我希望已经很明显了，这两个函数需要调用，否则就没用了。</p><h2 id="7d39" class="kd ke hi bd kf kg kh ki kj kk kl km kn jj ko kp kq jn kr ks kt jr ku kv kw kx bi translated">图像增强</h2><figure class="ld le lf lg fd lh"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="1190" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">与没有结节的患者相比，有结节记录的患者数量存在巨大的不平衡(顺便说一下，这是引起巨大恐慌的原因)。如果我们用这种不平衡来训练我们的模型，它最终每次都会预测“没有结节”。因此，解决方法是扩大较小的一个的图像，以便与数字匹配。增强包括缩放、旋转、翻转等。</p><h2 id="7ffb" class="kd ke hi bd kf kg kh ki kj kk kl km kn jj ko kp kq jn kr ks kt jr ku kv kw kx bi translated">准备培训数据</h2><figure class="ld le lf lg fd lh"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="f302" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">这里我们创建了两个数组。x将包含训练数据，而y将包含目标数据。我们将“潜在癌变”编码为0，将“零结节”编码为1。然后我们需要将X和Y都转换成numpy数组。</p><p id="9d05" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">下一步是规范化数据集。这意味着我们将X除以255，以减少X列的方差差异。这反过来又确保了没有一个列会因为较高的方差而对结果产生比另一个更大的影响。规范化本质上使所有数据更接近于零。这个术语叫做特征缩放。</p><p id="0a15" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">最后，我只打印了X的一个实例的形状，以便获得神经网络的输入形状。</p><h2 id="caf7" class="kd ke hi bd kf kg kh ki kj kk kl km kn jj ko kp kq jn kr ks kt jr ku kv kw kx bi translated">设计神经网络</h2><figure class="ld le lf lg fd lh"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="e75f" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">使用顺序的含义是，我们创建一个分层的神经网络，在每一层对数据进行不同的操作。</p><p id="baa2" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">第一层(卷积层)用于提取影像数据集的特征。这就是我们详述X[0]或(512，512，3)数据输入形状的地方。还值得注意的是，该形状添加了通道号，因此技术上输入为(512，512，3，1)。我们使用以下方法检查是否添加了频道:</p><pre class="ld le lf lg fd md mc me mf aw mg bi"><span id="f7c5" class="kd ke hi mc b fi mh mi l mj mk"><strong class="mc hj">from</strong> <strong class="mc hj">tensorflow.keras</strong> <strong class="mc hj">import</strong> backend <strong class="mc hj">as</strong> K<br/>print(K.image_data_format())</span><span id="c7ae" class="kd ke hi mc b fi ml mi l mj mk"><br/>This will output"channels_last"</span></pre><p id="0f35" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">接下来是添加模型的池层。在这种情况下，我们将使用MaxPooling，它接受宽度和高度设置中的像素值，然后获得最大值。使用平均池降低了4%的准确性。</p><p id="3b74" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">接下来是一个平面化层，它将我们的4d输入数组转换成2d数组。</p><p id="f890" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">最后，我们的输出层是一个密集层，这是一个完全连接的神经网络。</p><blockquote class="jw jx jy"><p id="03c7" class="iy iz jz ja b jb jc jd je jf jg jh ji ka jk jl jm kb jo jp jq kc js jt ju jv hb bi translated">对于完全连接的神经网络，一层的每个神经元必须连接到下一层的每个神经元。</p></blockquote><p id="d0fa" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">output_shape设置为1，因为这是一个二元分类问题。乙状结肠激活功能在这里也是必要的。使用整流线性单元不起作用。</p><p id="36cc" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">summary()函数输出正在使用的模型、图层以及每个图层的输入形状和每个图层的参数数量。</p><p id="588a" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">我们用X和y训练模型，并将verbose设置为1，以提供关于准确性和损失的额外细节。</p><h2 id="8302" class="kd ke hi bd kf kg kh ki kj kk kl km kn jj ko kp kq jn kr ks kt jr ku kv kw kx bi translated">寻求最优</h2><figure class="ld le lf lg fd lh"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="d1b9" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">从逻辑上讲，after completion是为手头的问题找到一个最优解。所以我所做的是从我们拥有的4d数据集的每个平面获取数据，并使用解释的累积方差相对于成分数量的图表，以便获得占方差一定百分比的成分。</p><blockquote class="jw jx jy"><p id="77ad" class="iy iz jz ja b jb jc jd je jf jg jh ji ka jk jl jm kb jo jp jq kc js jt ju jv hb bi translated">为了客观地思考这个问题，想象一下，如果我们要确定为什么有些女人化妆，而有些女人不化妆，而我们仅有的数据是她们都是女人。当确定数据的变化时，保持一元状态的数据是无益的。</p></blockquote><p id="45a4" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">我们可以看到，512个组件中约有50个组件解释了数据集中的任何差异。因此，我们使用主成分分析将X2和X3减少到50个成分。</p><p id="b478" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">然后，我们可以使用这些新数据重新训练模型。</p><h2 id="826b" class="kd ke hi bd kf kg kh ki kj kk kl km kn jj ko kp kq jn kr ks kt jr ku kv kw kx bi translated">做预测</h2><figure class="ld le lf lg fd lh er es paragraph-image"><div class="er es mm"><img src="../Images/d24139499f854faab2623c2cb4342d30.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/1*Ea5c8yxckQk45u6EKgFDPg.jpeg"/></div></figure><figure class="ld le lf lg fd lh"><div class="bz dy l di"><div class="li lj l"/></div></figure><figure class="ld le lf lg fd lh er es paragraph-image"><div class="er es mm"><img src="../Images/d24139499f854faab2623c2cb4342d30.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/1*Ea5c8yxckQk45u6EKgFDPg.jpeg"/></div></figure><p id="f7ca" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">为了进行预测，我们需要设置图像所在的目录，并创建一个新的数组，我们称之为Xpred。然后，我们将Xpred规范化，并使用predict()函数。</p><p id="fa96" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">Xpred的任何实例产生值1，这是潜在癌症的代码，意味着该人有91%的机会在他们的肺中具有癌症结节。</p></div></div>    
</body>
</html>