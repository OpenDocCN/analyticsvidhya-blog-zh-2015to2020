<html>
<head>
<title>Covid-19 Interactive Visualization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">新冠肺炎交互式可视化</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/covid-19-interactive-visualization-b46966b8b63b?source=collection_archive---------17-----------------------#2020-05-06">https://medium.com/analytics-vidhya/covid-19-interactive-visualization-b46966b8b63b?source=collection_archive---------17-----------------------#2020-05-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="3610" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">可视化<strong class="io hj">新冠肺炎</strong>数据，了解其对美国人口的影响。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jk"><img src="../Images/6ef97bacddc0f558d985550460ea549d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p9xz4rwqTWNTJq7MkN99_g.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">新型冠状病毒已导致全球20多万人死亡。</figcaption></figure><p id="fab5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这篇文章中，我将带你了解如何只使用python工具和api来构建你自己的交互式仪表盘，并将其发布到像<a class="ae ka" href="https://mybinder.org/" rel="noopener ugc nofollow" target="_blank"> binder </a>或<a class="ae ka" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> heroku </a>这样的提供商上。</p><p id="776c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，原始数据集是由约翰霍普金斯大学提供的，可以在他们的github页面上找到。这只是集中在美国的数据，但同样可以扩展到其他国家。</p><p id="2c0e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，请确保您已经安装了python，Jupyter notebook并准备就绪。我将只详细介绍执行的一些操作。你可以自己尝试一下:)或者在我的<a class="ae ka" href="https://github.com/abhim-12/Covid-19" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到整个项目。</p><p id="ac42" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您需要安装以下python文件来执行分析和可视化数据。</p><pre class="jl jm jn jo fd kb kc kd ke aw kf bi"><span id="da63" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">import</strong> <strong class="kc hj">pandas</strong> <strong class="kc hj">as</strong> <strong class="kc hj">pd</strong><br/><strong class="kc hj">import</strong> <strong class="kc hj">matplotlib.pyplot</strong> <strong class="kc hj">as</strong> <strong class="kc hj">plt</strong><br/><strong class="kc hj">from</strong> <strong class="kc hj">IPython.display</strong> <strong class="kc hj">import</strong> Markdown, display<br/><strong class="kc hj">from</strong> <strong class="kc hj">datetime</strong> <strong class="kc hj">import</strong> datetime <strong class="kc hj">as</strong> dt<br/><strong class="kc hj">from</strong> <strong class="kc hj">ipywidgets</strong> <strong class="kc hj">import</strong> interact<br/><strong class="kc hj">import</strong> <strong class="kc hj">chart_studio.plotly</strong> <strong class="kc hj">as</strong> <strong class="kc hj">py</strong><br/><strong class="kc hj">import</strong> <strong class="kc hj">plotly.graph_objs</strong> <strong class="kc hj">as</strong> <strong class="kc hj">go</strong><br/><strong class="kc hj">from</strong> <strong class="kc hj">plotly.offline</strong> <strong class="kc hj">import</strong> iplot, init_notebook_mode<br/><strong class="kc hj">import</strong> <strong class="kc hj">cufflinks</strong><br/><strong class="kc hj">from</strong> <strong class="kc hj">plotly.subplots</strong> <strong class="kc hj">import</strong> make_subplots<br/>cufflinks.go_offline(connected=<strong class="kc hj">True</strong>)<br/>init_notebook_mode(connected=<strong class="kc hj">True</strong>)<br/><strong class="kc hj">import</strong> <strong class="kc hj">dateutil<br/>import plotly.express as px</strong></span></pre><p id="9367" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">pandas —使用数据帧读取数据并创建数据子集。<br/>matplotlib——Python的go to可视化库。<br/> datetime —处理时间序列数据的直观库，适用于数据帧。<br/>ipywidgets——在Jupyter中创建小部件，使仪表板更具交互性。<br/>plot ly/袖扣——更好的交互式可视化效果。</p><p id="c685" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从git repo中提供的链接收集数据。</p><pre class="jl jm jn jo fd kb kc kd ke aw kf bi"><span id="9893" class="kg kh hi kc b fi ki kj l kk kl">x1 = 'https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv' <br/>x2 = 'https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv' <br/>x3 = 'https://raw.githubusercontent.com/abhim-12/Covid-19/master/population.csv' <br/>x4 = 'https://raw.githubusercontent.com/abhim-12/Covid-19/master/state-codes.csv'</span></pre><p id="2d54" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用pandas read.csv()函数将数据读入数据帧:</p><pre class="jl jm jn jo fd kb kc kd ke aw kf bi"><span id="3da3" class="kg kh hi kc b fi ki kj l kk kl">conf = pd.read_csv(x1) <br/>death = pd.read_csv(x2) <br/>pop = pd.read_csv(x3)      # US Population data<br/>codes = pd.read_csv(x4)    # US State Codes</span></pre><p id="788e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用head()函数了解数据包含的内容、列、数据类型等。</p><p id="ed07" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">执行一些数据清理(如重命名列、删除)以使其更加一致和可展示。还要删除任何不必要的列。</p><pre class="jl jm jn jo fd kb kc kd ke aw kf bi"><span id="1dca" class="kg kh hi kc b fi ki kj l kk kl">del death['Population']<br/>def filt(df):<br/>    df.drop(columns=['iso3','code3','Admin2','Country_Region'],axis=1,inplace=True)<br/>    df.rename(columns={'Province_State':'State'},inplace=True)<br/>    df=df.reset_index()<br/>    del df['index']</span></pre><p id="651e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们创建的第一个数据框架(<em class="km"> z2 </em>)合并了各州的确诊病例和死亡病例框架。接下来，我们创建几个列，根据数据推断每个州的情况的严重性。</p><pre class="jl jm jn jo fd kb kc kd ke aw kf bi"><span id="4077" class="kg kh hi kc b fi ki kj l kk kl">cols = conf.columns.to_list()[-1]<br/>ctemp = conf.groupby('State').sum()[conf.columns[-1]].sort_values(ascending=False).reset_index()<br/>dtemp = death.groupby('State').sum()[death.columns[-1]].sort_values(ascending=False).reset_index()<br/>ctemp = ctemp[['State',conf.columns[-1]]]<br/>dtemp = dtemp[['State',death.columns[-1]]]</span><span id="d201" class="kg kh hi kc b fi kn kj l kk kl"># State level aggregated data<br/>z2 = pd.merge(ctemp,dtemp,on=['State'],how='inner').merge(temp2,on='State',how='left')      <br/><br/>z2.rename(columns={deaths:'Deaths',confirm:'Cases'},inplace=True)</span><span id="0cdc" class="kg kh hi kc b fi kn kj l kk kl">z2['CMR'] = (z2['Deaths']/z2['Population'])*100000                          # Crude Mortality Rate per 100000<br/>z2['Infected %'] = (z2['Cases']/z2['Population'])*100                       # Percentage of population infected</span><span id="1797" class="kg kh hi kc b fi kn kj l kk kl">z2['Case Fatality Rate'] = (z2['Deaths']/z2['Cases'])*100                   # Case Fatality Rate - Ratio of Deaths out of those infected<br/>z2 = z2[['State','Cases','Deaths','Population','Infected %','CMR','Case Fatality Rate']]</span></pre><p id="ae54" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">计算粗死亡率、病死率和感染百分比，我选择突出CFR高于平均值的州。结果如下所示(<em class="km">点击</em> 了解更多关于数据帧样式的信息)。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es ko"><img src="../Images/c67bbde37f2e3571517e9a7a9e3b143b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ny9QfpOlWC0oIYGOGhWzkg.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">使用您喜欢的任何方法对数据进行样式化也有助于更好地传达信息。</figcaption></figure><p id="d172" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们的第一个可视化是病毒如何影响整个国家，所以我们做了两个可视化——1)影响的时间线和2)choropleth图</p><pre class="jl jm jn jo fd kb kc kd ke aw kf bi"><span id="0470" class="kg kh hi kc b fi ki kj l kk kl">def timeline(Condition):<br/>    tempd = cc.groupby('Date').sum().reset_index()<br/>    temph = tempd.loc[tempd['PerDay_Confirm']&gt;0].reset_index(drop=True)<br/>    if Condition=='Deaths':<br/>        title = 'Timeline of Deaths'<br/>        color='red'<br/>    if Condition=='Cases':<br/>        Condition='Confirm'<br/>        title = 'Timeline of Cases'<br/>        color='orange'<br/>    temph.iplot(x='Date',y=Condition,xTitle='Dates',yTitle='Count',title=title,mode='lines+markers',color=color)<br/>interact(timeline, Condition=['Deaths','Cases'])</span></pre><p id="64c8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，上面定义的函数生成了病毒影响的时间序列图。iplot 包允许结合jupyter小部件绘制交互式图形。函数<em class="km"> interact </em>以函数名为参数，变量<em class="km"> Condition </em>为包含“病例”和“死亡”的列表。该图生成一个下拉列表，用户可以在不同时间的病例和死亡之间切换。plotly软件包使我们的绘图具有交互性，向我们显示每个数据点的数字，无需任何额外的代码。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kp"><img src="../Images/ad73589dfde02ca137e81236ec3bf8d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DTsh5M1kMD2NBSRMkR5bEA.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">新冠肺炎影响的交互式时间序列图</figcaption></figure><p id="660b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你可以做的另一个有趣的可视化是<strong class="io hj">动画</strong>显示每天对每个状态的影响。</p><pre class="jl jm jn jo fd kb kc kd ke aw kf bi"><span id="69c0" class="kg kh hi kc b fi ki kj l kk kl">def timeline2(Condition):<br/>    fig = px.choropleth(tempz,<br/>                        locations='Code',<br/>                        color=Condition,<br/>                        hover_name='State',<br/>                        locationmode='USA-states',<br/>                        animation_frame='Date',<br/>                        scope='usa'<br/>    )<br/>    fig.update_layout(<br/>        title_text = 'Spread of Coronavirus',<br/>        title_x = 0.5,<br/>        geo=dict(<br/>            showframe = False,<br/>            showcoastlines = True<br/>        ))</span><span id="0105" class="kg kh hi kc b fi kn kj l kk kl">fig.show()<br/>interact(timeline2,Condition=['Confirm','Deaths'])</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kq"><img src="../Images/1290eb2f17cf77cd81c95044f624697b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8c4eDhy4AB7oFRylI4SPNQ.png"/></div></div></figure><p id="e978" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我创建的另一个中间数据框架包含每个州每天的死亡和确诊病例的合并版本<strong class="io hj">(州-天级别)</strong>。</p><pre class="jl jm jn jo fd kb kc kd ke aw kf bi"><span id="5267" class="kg kh hi kc b fi ki kj l kk kl">def transform(df,s):   #s is a String with 'Confirm' or 'Deaths'                    <br/># To dcast the data and get it at a state-date level <br/>    <br/>    temp = df.copy(deep=True)<br/>    temp.drop(columns=['UID','iso2','Lat','Long_','FIPS'],inplace=True)<br/>    temp = temp.melt(id_vars=['State','Combined_Key'],var_name='Date',value_name=s)</span><span id="231d" class="kg kh hi kc b fi kn kj l kk kl"> # Source data is cumulative, this gets the numbers per day<br/>    <br/>    temp2 = temp.groupby(['Combined_Key'])[s].diff().fillna(0).reset_index()<br/>    p = 'PerDay'+'_'+s<br/>    temp2.rename(columns={s:p},inplace=True) <br/>    temp2 = pd.concat([temp,temp2],axis=1)<br/>    del temp2['index']<br/>    temp2 = temp2.sort_values(['Combined_Key','Date',s,p]).reset_index(drop=True)<br/>    return temp2</span></pre><p id="758c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对每个单独的数据集(conf &amp; death)调用该函数，合并结果以创建如下输出:</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kr"><img src="../Images/aab9d6491e40fb1a36b5d85f951081d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eVjfnU92YLdzzZtUFmrM_Q.png"/></div></div></figure><p id="d318" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，您可以对上述数据框进行大量的可视化操作。我做的一个这样的可视化是显示一个州的一个省每天的病例或死亡人数。</p><pre class="jl jm jn jo fd kb kc kd ke aw kf bi"><span id="1545" class="kg kh hi kc b fi ki kj l kk kl">zz['Province'] = [s.split(',')[0] for s in  zz['Combined_Key']]<br/>province = zz['Province'].unique()<br/># Plots Cases/Deaths for a Province per Day <br/>def plots2(State,Province,Condition):                        <br/>    a = zz.loc[(zz['Province']==Province) &amp; (zz['State']==State) ]<br/>    if Condition.startswith('C'):<br/>        Condition = 'PerDay_Confirm'<br/>        color = 'orange'<br/>    if Condition.startswith('D'):<br/>        Condition = 'PerDay_Deaths'<br/>        color = 'red'<br/>    a = a[a[Condition].gt(0)]<br/>    a = a.sort_values('Date',ascending=True)<br/>    a.iplot(x='Date',y=Condition,kind='bar',xTitle='Dates',yTitle=Condition.split('_')[1],title=(Condition.split('_')[1] + " in " + Province + ", " + State),color=color)<br/>interact(plots2,State=z2['State'].sort_values(),Province = province,Condition=['Cases','Deaths'])</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kq"><img src="../Images/f79ce0703b7fd652fb4436f982761268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L7IrdGLMfkCmMdjtFpu2Dg.png"/></div></div></figure><p id="9ca6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您可以使用我展示的示例执行许多类似的绘图。继续学习如何在笔记本上创建仪表板。</p><p id="3a66" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">瞧吧</strong> —瞧吧，这是一个基于jupyter的python库，可以将你的笔记本变成仪表盘。安装和运行voila相当简单，github页面上提供了说明。</p><p id="905a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">从cmd运行voila</strong>:<em class="km">voila \ path \ to \ notebook \ notebook . ipynb—theme = dark</em></p><p id="30a5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您的交互现在看起来会像这样:</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es ks"><img src="../Images/105c30b76e45a579f536aa909a1be7c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YbnKIbp9m-xa0aE7OQEmzg.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">瞧仪表板</figcaption></figure><p id="a055" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在您的仪表板已经完成，是时候部署它了。如我之前所说，你可以使用heroku或binder。两者都要求你将数据推送到git(确保你已经安装了git)。</p><p id="8be8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Heroku 提供了一个cli来推动您的项目。你可以在这里找到更多细节<a class="ae ka" href="https://github.com/voila-dashboards/voila-heroku" rel="noopener ugc nofollow" target="_blank">。瞧，文档</a>提供了部署项目的清晰步骤。</p><p id="f799" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">和“瞧！”你完了。您已经完全用python创建了一个仪表板，不需要外部软件，并且可以与您的同事、同事或其他人共享。添加更多的组件使用模板为未来的项目，你认为合适的。</p></div></div>    
</body>
</html>