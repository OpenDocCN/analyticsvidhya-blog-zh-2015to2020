<html>
<head>
<title>Better Spark Logging and Monitoring with Spark Listener</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用火花监听器实现更好的火花记录和监控</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/better-spark-logging-and-monitoring-with-spark-listener-c2c5fe86547a?source=collection_archive---------3-----------------------#2020-07-25">https://medium.com/analytics-vidhya/better-spark-logging-and-monitoring-with-spark-listener-c2c5fe86547a?source=collection_archive---------3-----------------------#2020-07-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f2ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我在火花深潜系列中的一个故事。</p><div class="jd je ez fb jf jg"><a rel="noopener follow" target="_blank" href="/@somanathsankaran"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hj fi z dy jl ea eb jm ed ef hh bi translated">索玛纳特·桑卡兰培养基</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">阅读索马纳特·桑卡兰在媒介上的作品。对python和spark感兴趣的大数据开发者。每天，索马纳特…</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">medium.com</p></div></div><div class="jp l"><div class="jq l jr js jt jp ju jv jg"/></div></div></a></div><p id="aeae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大家好，一旦你熟悉了spark。运行spark应用程序面临的一个问题是调试它的故障。</p><p id="4a50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">监控spark作业最简单的方法是spark UI，但是Spark UI的问题是，在应用程序完成的情况下，很难理解失败的确切原因。</p><p id="4323" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我说我们可以定制spark应用程序，我们可以看到我们在spark代码中编写的每一行从应用程序到任务级别的spark元数据属性，这在调试应用程序时非常方便，只需在spark submit中添加一行即可</p><p id="cc7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> SparkListener接口:</strong></p><p id="c290" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它是spark提供的开发人员api接口之一，我们可以通过扩展该接口来利用它，以便更好地理解我们的应用程序。在这篇教程中，为了更好地记录日志，我使用了下面的方法，这样我就可以看到我用spark写的每一行都发生了什么</p><ol class=""><li id="316b" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated">onJobStart —作业开始时需要触发什么</li><li id="e751" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">onJobEnd-作业开始时需要触发什么</li><li id="5ea6" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">应用程序启动时需要触发什么</li><li id="18ce" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">应用程序结束时需要触发什么</li><li id="15e3" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">onStageSubmitted —提交需要在舞台上触发的内容</li><li id="ca07" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">舞台结束-舞台结束时需要触发什么</li></ol><p id="3ebb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">如何使用Spark监听器？</strong></p><p id="f0ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤1:我们可以通过扩展spark listener并覆盖默认实现来使用spark listener，如下所示</p><figure class="kk kl km kn fd ko"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="e77c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤2:当我们覆盖阶段完成时，我已经定义了一个自定义的阶段完成，它将打印阶段元数据的详细信息，这些信息可以用于更好的日志记录</p><figure class="kk kl km kn fd ko"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="f573" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的例子中，我只是打印了开始和完成后的阶段元数据</p><p id="8053" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在第2行使用case类来定义stg元数据</p><p id="9735" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在stg添加，我只是打印像阶段名称，开始时间，结束时间等stg信息</p><p id="c7b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">向Spark应用程序添加Spark监听器</strong></p><p id="773a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">spark LIstener的最大优点之一是这个类不需要任何代码更改，我们可以通过使用-conf spark . extra listeners = com . spark monitor . spark monitor来添加，如下所示</p><blockquote class="kr ks kt"><p id="7956" class="if ig ku ih b ii ij ik il im in io ip kv ir is it kw iv iw ix kx iz ja jb jc hb bi translated">home/somanath &gt; spark-shell—jars/home/somanath/. m2/repository/com/spark monitor/spark health monitor/1.0-SNAPSHOT/spark health monitor-1.0-SNAPSHOT . jar—conf spark . extra listeners = com . spark monitor . spark monitor</p></blockquote><p id="d00a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">可视化我们的监听器输出</strong></p><p id="7358" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">执行器数据- </strong>我们可以看到添加执行器时的主机和内核数量</p><figure class="kk kl km kn fd ko er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ky"><img src="../Images/cc6ad5c33198d305c4e3583c24ebedfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*afIhtYhcNtG8OgX1WFEiEA.png"/></div></div></figure><p id="4d67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">应用数据</strong>-应用开始时间应用名称、用户Id等</p><p id="0181" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">阶段和工作细节</strong></p><p id="8f89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用read csv触发了一个作业，您可以找到如下详细信息</p><p id="9988" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作业何时开始，作业的阶段是什么，作业何时结束，阶段何时结束，如下所示</p><figure class="kk kl km kn fd ko er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es le"><img src="../Images/8b5e5e2a3f76efe971c6126c41ee9695.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cX4nirbwO9ewSTrhNBscMg.png"/></div></div></figure><p id="bc02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">应用程序结束时间:</strong>我已经使用spark.stop结束了应用程序，我的本地应用程序运行了76秒</p><figure class="kk kl km kn fd ko er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lf"><img src="../Images/2d851a2da441f7041ed8c8e4d16a5c27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5jvAS2-mewoOd1mwmSIVDg.png"/></div></div></figure><p id="ab3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结论:</p><p id="42b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们有一个非常复杂的应用程序，Spark listener会非常方便，我们可以看到如下细节</p><ol class=""><li id="4788" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated">阶段和任务的开始和结束时间</li><li id="7579" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">调试失败的应用程序可能非常容易，因为我们也有失败的原因</li><li id="0c15" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">我们可以增强应用程序数据，并将其存储在一些数据库中，用于火花监测</li></ol><p id="8d62" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天就到这里吧！！:)</p><p id="3c40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">学习并让别人学习！！</strong></p></div></div>    
</body>
</html>