<html>
<head>
<title>Time series modeling for forecasting returns on investment funds</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测投资基金回报的时间序列模型</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/time-series-modeling-for-forecasting-returns-on-investments-funds-c4784a2eb115?source=collection_archive---------12-----------------------#2020-08-16">https://medium.com/analytics-vidhya/time-series-modeling-for-forecasting-returns-on-investments-funds-c4784a2eb115?source=collection_archive---------12-----------------------#2020-08-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="63ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">时间序列分析，讨论了ARIMA，自动ARIMA，自相关(ACF)，部分自相关(PACF)，平稳性和差分。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/2e410d4e5aefd024c30d9fc3ead9841c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WtJqTkFL0Fyzb2WSfmAATQ.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">来源:<a class="ae jt" href="https://cdn.pixabay.com/photo/2017/03/10/23/13/oracle-girl-2133976_1280.jpg" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></figcaption></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="7f75" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">数据在哪里？</h1><p id="cbc7" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">大多数金融时间序列示例使用内置数据集。有时这些数据并不符合您的需求，如果您不知道如何获得您需要的确切数据，您将面临一个障碍。</p><p id="347a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将演示如何直接从互联网上提取数据。有的包已经做了，但是如果需要另外的相关数据，就自己做了。我会告诉你如何从网站上直接提取资金信息。为了便于演示，我们选择了位于CVM(comisso de Valores mobiliáRios)网站上的巴西基金，该网站是监管巴西金融业的政府机构。</p><p id="a61a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大概每个国家都有一些类似的机构，存储金融数据，免费提供给公众使用，你可以针对他们。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="e3a5" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">从网站下载数据</h1><p id="2d93" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">要从网站下载数据，我们可以使用RCurlpackage中的getURL函数。只需在控制台中运行install.package("RCurl ")命令，就可以从CRAN下载该软件包。</p><p id="7749" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下载数据，网址【http://dados.cvm.gov.br/dados/FI/DOC/INF_DIARIO/DADOS/】<a class="ae jt" href="http://dados.cvm.gov.br/dados/FI/DOC/INF_DIARIO/DADOS/" rel="noopener ugc nofollow" target="_blank">T3T5】</a></p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="3391" class="lk kc hi lg b fi ll lm l ln lo">library(tidyverse) # a package to handling the messy data and organize it<br/>library(RCurl) # The package to download a spreadsheet from a website<br/>library(forecast) # This package performs time-series applications<br/>library(PerformanceAnalytics) # A package for analyze financial/ time-series data<br/>library(readr) # package for read_delim() function<br/> <br/>#creating an object with the spreadsheet url url &lt;- "http://dados.cvm.gov.br/dados/FI/DOC/INF_DIARIO/DADOS/inf_diario_fi_202006.csv"<br/> <br/>#downloading the data and storing it in an R object<br/> text_data &lt;- getURL(url, connecttimeout = 60)<br/> <br/>#creating a data frame with the downloaded file. I use read_delim function to fit the delim pattern of the file. Take a look at it!<br/>df &lt;- read_delim(text_data, delim = ";")<br/> <br/>#The first six lines of the data<br/>head(df)</span><span id="4652" class="lk kc hi lg b fi lp lm l ln lo">### A tibble: 6 x 8<br/>##   CNPJ_FUNDO DT_COMPTC  VL_TOTAL VL_QUOTA VL_PATRIM_LIQ CAPTC_DIA RESG_DIA<br/>##   &lt;chr&gt;      &lt;date&gt;        &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;<br/>## 1 00.017.02~ 2020-06-01 1123668.     27.5      1118314.         0        0<br/>## 2 00.017.02~ 2020-06-02 1123797.     27.5      1118380.         0        0<br/>## 3 00.017.02~ 2020-06-03 1123923.     27.5      1118445.         0        0<br/>## 4 00.017.02~ 2020-06-04 1124052.     27.5      1118508.         0        0<br/>## 5 00.017.02~ 2020-06-05 1123871.     27.5      1118574.         0        0<br/>## 6 00.017.02~ 2020-06-08 1123999.     27.5      1118639.         0        0<br/>## # ... with 1 more variable: NR_COTST &lt;dbl&gt;</span></pre><h1 id="7523" class="kb kc hi bd kd ke lq kg kh ki lr kk kl km ls ko kp kq lt ks kt ku lu kw kx ky bi translated">处理混乱</h1><p id="4e73" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">这个数据集包含了在CVM注册的所有基金的大量信息。首先，我们必须选择其中之一来应用我们的时间序列分析。</p><p id="41c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">巴西市场有很多资金。为了计算它的数量，我们必须运行下面的代码:</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="a305" class="lk kc hi lg b fi ll lm l ln lo">#get the unique identification code for each fund<br/> x &lt;- unique(df$CNPJ_FUNDO)<br/> <br/>length(x) # Number of funds registered in Brazil.</span><span id="5525" class="lk kc hi lg b fi lp lm l ln lo">##[1] 17897</span></pre><p id="e435" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我选择了识别代码(CNPJ)为12 . 987 . 743/0001–86的阿拉斯加黑色FICFI Em es-Bdr nível I进行分析。</p><p id="8368" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在开始之前，我们需要更多的观察来做好分析。为了扩大时间窗口，我们需要从CVM网站下载更多数据。可以通过向数据中添加其他月份来实现这一点。</p><p id="4edb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们必须采取一些措施:</p><p id="befb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们必须生成一系列循环和下载数据的路径。使用下面的命令，我们将获取2018年1月到2020年7月的数据。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="ebba" class="lk kc hi lg b fi ll lm l ln lo"># With this command we generate a list of urls for the years of 2020, 2019, and 2018 respectively.<br/> <br/> url20 &lt;- c(paste0("http://dados.cvm.gov.br/dados/FI/DOC/INF_DIARIO/DADOS/inf_diario_fi_", 202001:202007, ".csv"))<br/> url19 &lt;- c(paste0("http://dados.cvm.gov.br/dados/FI/DOC/INF_DIARIO/DADOS/inf_diario_fi_", 201901:201912, ".csv"))<br/> url18 &lt;- c(paste0("http://dados.cvm.gov.br/dados/FI/DOC/INF_DIARIO/DADOS/inf_diario_fi_", 201801:201812, ".csv"))</span></pre><p id="6808" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">获得路径后，我们必须循环遍历这个路径向量，并将数据存储到R环境中的一个对象中。请记住，在所有17897只基金中，我选择了其中的一只，阿拉斯加黑人投资基金</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="c64e" class="lk kc hi lg b fi ll lm l ln lo"># creating a data frame object to fill of funds information<br/> fundoscvm &lt;- data.frame()<br/> <br/> # Loop through the urls to download the data and select the chosen investment fund.<br/> # This loop could take some time, depending on your internet connection.<br/> for(i in c(url18,url19,url20)){<br/>   csv_data &lt;- getURL(i, connecttimeout = 60)<br/>   fundos &lt;- read_delim(csv_data, delim = ";")<br/>   <br/>   fundoscvm &lt;- rbind(fundoscvm, fundos)<br/>   rm(fundos)<br/> }</span></pre><p id="4f07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们可以看看名为fundoscvm的新数据框。这是一个巨大的数据集，有10056135行。</p><p id="f341" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们选择要预测的基金。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="2984" class="lk kc hi lg b fi ll lm l ln lo">alaska &lt;- fundoscvm%&gt;%<br/>     filter(CNPJ_FUNDO == "12.987.743/0001-86") # filtering for the `Alaska Black FICFI Em Ações - Bdr Nível I` investment fund.</span><span id="64b5" class="lk kc hi lg b fi lp lm l ln lo"># The first six observations of the time-series<br/> head(alaska)</span><span id="53d8" class="lk kc hi lg b fi lp lm l ln lo">## # A tibble: 6 x 8<br/> ##   CNPJ_FUNDO DT_COMPTC  VL_TOTAL VL_QUOTA VL_PATRIM_LIQ CAPTC_DIA RESG_DIA<br/> ##   &lt;chr&gt;      &lt;date&gt;        &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;<br/> ## 1 12.987.74~ 2018-01-02   6.61e8     2.78    630817312.  1757349. 1235409.<br/> ## 2 12.987.74~ 2018-01-03   6.35e8     2.78    634300534.  5176109. 1066853.<br/> ## 3 12.987.74~ 2018-01-04   6.50e8     2.82    646573910.  3195796.  594827.<br/> ## 4 12.987.74~ 2018-01-05   6.50e8     2.81    647153217.  2768709.  236955.<br/> ## 5 12.987.74~ 2018-01-08   6.51e8     2.81    649795025.  2939978.  342208.<br/> ## 6 12.987.74~ 2018-01-09   6.37e8     2.78    646449045.  4474763.   27368.<br/> ## # ... with 1 more variable: NR_COTST &lt;dbl&gt;</span><span id="60f4" class="lk kc hi lg b fi lp lm l ln lo"># The las six observations...<br/> tail(alaska)</span><span id="6f24" class="lk kc hi lg b fi lp lm l ln lo">## # A tibble: 6 x 8<br/> ##   CNPJ_FUNDO DT_COMPTC  VL_TOTAL VL_QUOTA VL_PATRIM_LIQ CAPTC_DIA RESG_DIA<br/> ##   &lt;chr&gt;      &lt;date&gt;        &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;<br/> ## 1 12.987.74~ 2020-07-24   1.89e9     2.46   1937895754.   969254.  786246.<br/> ## 2 12.987.74~ 2020-07-27   1.91e9     2.48   1902905141.  3124922. 2723497.<br/> ## 3 12.987.74~ 2020-07-28   1.94e9     2.53   1939132315.   458889.       0 <br/> ## 4 12.987.74~ 2020-07-29   1.98e9     2.57   1971329582.  1602226.  998794.<br/> ## 5 12.987.74~ 2020-07-30   2.02e9     2.62   2016044671.  2494009. 2134989.<br/> ## 6 12.987.74~ 2020-07-31   1.90e9     2.47   1899346032.   806694. 1200673.<br/> ## # ... with 1 more variable: NR_COTST &lt;dbl&gt;</span></pre><p id="2249" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">CVM网站提供了大量关于所选基金的信息。我们只对基金份额价值感兴趣。这一信息在VL_QUOTAvariable。有了股票价值，我们可以计算几个财务指标，并执行其预测。</p><p id="5f20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据维度是649，8。期间范围是:</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="e621" class="lk kc hi lg b fi ll lm l ln lo"># period range:<br/> range(alaska$DT_COMPTC)</span><span id="3222" class="lk kc hi lg b fi lp lm l ln lo">## [1] "2018-01-02" "2020-07-31"</span></pre><p id="5252" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看基金的股价。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="c674" class="lk kc hi lg b fi ll lm l ln lo">ggplot(alaska, aes( DT_COMPTC, VL_QUOTA))+ geom_line()+<br/>   scale_x_date(date_breaks = "3 month") +<br/>   theme(axis.text.x=element_text(angle=60, hjust=1))</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/0fa5e19cffc95213cc5d5b15a61c0b36.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*UAr-dgi6M6ceriJGuDej8Q.png"/></div></figure><p id="4476" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">新冠肺炎带来很多麻烦，不是吗？</p><p id="c7df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个金融原始序列可能包含一些问题，这些问题以模式的形式重复出现，或者根据经济周期出现。</p><p id="88ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于一周中的交易日，每日金融时间序列通常具有5个周期的季节性。有些人应该考虑到金融市场不运转的假日和其他日子。为了简化分析，我将省略这些情况。</p><p id="a544" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以在中观察到，该系列似乎在一段时间内上升，之后下降。这是在数据中观察到的趋势模式的一个很好的例子。</p><p id="5b7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有趣的是,<em class="le">分解</em>序列以查看序列的“内部”,并分离每个影响，以捕捉金融时间序列的确定性(趋势和季节性)和随机(剩余)部分。</p><h1 id="beae" class="kb kc hi bd kd ke lq kg kh ki lr kk kl km ls ko kp kq lt ks kt ku lu kw kx ky bi translated">分解系列</h1><p id="cbbd" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">时间序列可以分解为三个部分:趋势、季节和余数(随机)。</p><p id="0814" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有两种方法可以做到这一点:加法形式和乘法形式。</p><p id="5746" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设y_t是我们的时间序列，T_t代表趋势，S_t是季节分量，R_t是余数，或随机分量。<br/>在加法形式中，我们假设数据结构是其组成部分的总和:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lw"><img src="../Images/b64fc095796f8049907fe23b0ac8e1d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/1*-gTPIBMyUVdygJsbiIFTqA.png"/></div></figure><p id="ba49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj">乘法</strong>形式中，我们假设数据结构是其组件的乘积:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lx"><img src="../Images/91e88099b974c4d041a815187e557c24.png" data-original-src="https://miro.medium.com/v2/resize:fit:518/format:webp/1*K3ss1SodoSSKR2paIs3bZQ.png"/></div></figure><p id="3047" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些结构是相关的。乘法结构的对数是(对数)分量的加法结构:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/93431ae7c1212e262640a54689a91867.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dcFbT8p0EkZx5aNggiRljw.png"/></div></div></figure><p id="7482" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置<em class="le">频率5 </em>的季节性成分，我们可以考虑基金回报的周日效应。我们用5是因为没有周末的数据。你也应该考虑假期，但是因为它根据国家的分析而变化，我忽略了这个影响。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="9f7c" class="lk kc hi lg b fi ll lm l ln lo">library(stats) # a package to perform and manipulate time-series objects<br/> library(lubridate) # a package to work with date objects<br/> library(TSstudio) # A package to handle time-series data<br/> <br/> # getting the starting point of the time-series data<br/> start_date &lt;- min(alaska$DT_COMPTC)<br/> <br/> # The R program does not know that we are working on time-series. So we must tell the software that our data is a time-series. We do this using the ts() function<br/> <br/> ## In the ts() function we insert first the vector that has to be handle as a time-series. Second, we tell what is the starting point of the time series. Third, we have to set the frequency of the time-series. In our case, it is 5.<br/> share_value &lt;- ts(alaska$VL_QUOTA, start =start_date, frequency = 5)<br/> <br/> # the function decompose() performs the decomposition of the series. The default option is the additive form.<br/> dec_sv &lt;- decompose(share_value)<br/> <br/> # Take a look!<br/> plot(dec_sv)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/1c2a3e7770d2ba7d831c5da2dccd7346.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*nwk9tU--N_bMoWiW0X2lkA.png"/></div></figure><p id="1d21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可加时间序列的分解。</p><p id="c4dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上图显示了观察到的完整序列，以及其三个组成部分趋势，季节性趋势和随机趋势，以<strong class="ih hj">相加</strong>的形式分解。</p><p id="8999" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图显示了观察到的完整序列，以及其三个组成部分趋势、季节性趋势和随机趋势，以<strong class="ih hj">乘法</strong>形式分解。</p><p id="010d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这两种形式非常相关。季节性成分略有变化。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="5a54" class="lk kc hi lg b fi ll lm l ln lo">dec2_sv &lt;- decompose(share_value, type = "multiplicative")<br/> <br/> plot(dec2_sv)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/5f23191e01bf7f4a4a0f304f6c06fb12.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*JWJWOLS6yRDLRi-R5gPERA.png"/></div></figure><p id="74d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在时间序列应用程序中，我们对基金的回报感兴趣。相关数据集中的另一个信息对我们毫无用处。</p><p id="322a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基金的日收益率(R <em class="le"> t </em>)是从份额价值的(对数)第一个差值中得到的。在你的数据里，他的变量叫VL _配额。日志很重要，因为它为我们提供了每日回报的百分比。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lz"><img src="../Images/5b5c2522c72081c0929568ba4aeb497f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*owL6lob2FXLNMIu8ftwGMw.png"/></div></figure><p id="9c5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其算法是:</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="af4b" class="lk kc hi lg b fi ll lm l ln lo">R1 &lt;- log(alaska$VL_QUOTA)%&gt;% # generate the log of the series<br/>   diff() # take the first difference<br/> <br/> plot.ts(R1) # function to plot a time-series</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/4328344c7f70f04b28f892f82b077630.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*h72V0YI0UzWh6ojVxrfX3w.png"/></div></figure><p id="bbd6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">return(对数第一差)系列在之前的分解中扮演余数的角色。</p><p id="ca45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">分解数据的随机成分不受季节影响。我们可以手动计算5个周期的差值:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ma"><img src="../Images/3419ac87b1bfdc09b5d40a723c34908b.png" data-original-src="https://miro.medium.com/v2/resize:fit:408/format:webp/1*12knM82vmpe7qjSw9W9lKw.png"/></div></figure><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="c324" class="lk kc hi lg b fi ll lm l ln lo">R5 &lt;- R1 %&gt;% diff(lag = 5)<br/> plot.ts(R5)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/c0e698533d41d814fe6c5c4ce998683b.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*8uRO2Ww-SYdd-xbxa_vfUg.png"/></div></figure><p id="6cf7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这两幅图相似。但是第二种可能没有季节效应。</p><p id="14e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以使用forecast软件包的ggsubseriesplot函数绘制一个图表来直观地识别序列的季节性。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="0155" class="lk kc hi lg b fi ll lm l ln lo">ggsubseriesplot(share_value)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/5c9f562e5d142d9584bac96c89237339.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*2qhNziZaMaQQ9-joLUxOEw.png"/></div></figure><p id="a63b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">哦，看来我们对季节性数据的假设是错误的！在这个时间序列中没有明显的季节性模式。</p><h1 id="15f7" class="kb kc hi bd kd ke lq kg kh ki lr kk kl km ls ko kp kq lt ks kt ku lu kw kx ky bi translated">预测</h1><p id="d795" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">在预测之前，我们必须验证数据是随机的还是自相关的。为了验证数据的自相关性，我们可以首先使用自相关函数(ACF)和偏自相关函数(PACF)。</p><h1 id="d45d" class="kb kc hi bd kd ke lq kg kh ki lr kk kl km ls ko kp kq lt ks kt ku lu kw kx ky bi translated">自相关函数和偏自相关函数</h1><p id="e086" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">如果我们使用原始数据，自相关是明显的。蓝线表示滞后自相关的显著性极限。在下面的ACF图中，黑色垂直线超过水平蓝线意味着自相关在5%的置信水平下是显著的。向上的线序列表示测试系列的正自相关。</p><p id="f263" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了知道自相关的顺序，我们必须看一看偏自相关函数(PACF)。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="c80d" class="lk kc hi lg b fi ll lm l ln lo">library(TSstudio)<br/> <br/> R &lt;- alaska$VL_QUOTA #extract the fund share value from the data<br/> Racf &lt;- acf(R, lag.max = 12) # compute the ACF</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/f4b2a0d2d203fc1aea444b0132d6d2f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*qzTF0Ca5os_HGwX09-OxCQ.png"/></div></figure><p id="e8b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基金份额价值的自相关函数。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="6365" class="lk kc hi lg b fi ll lm l ln lo">Rpacf &lt;- pacf(R, lag.max = 12) # compute the PACF</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/2c8bdae6e8d23d013d018345268bbe11.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*Nbhs9j7DS60OMlMTGxT9Bg.png"/></div></figure><p id="cb16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">偏相关函数确认滞后1、6和8的数据中的自相关。</p><p id="8f17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大多数时候，在财务分析中，我们感兴趣的是基金份额的回报。要使用它，可以对回报进行预测分析，而不是使用基金股价。我给你补充一下，这个程序是处理基金份额价格非平稳性的好方法。</p><p id="9f90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们可以执行回报的(部分)自相关函数:</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="116f" class="lk kc hi lg b fi ll lm l ln lo">library(TSstudio)<br/> <br/> Racf &lt;- acf(R1, lag.max = 12) # compute the ACF</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/f6e19892dd37020939b400319897678d.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*09tnD9HJ1u0EAfEWs-2i-Q.png"/></div></figure><p id="89b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基金份额(日志)回报的ACF。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="1044" class="lk kc hi lg b fi ll lm l ln lo">Racf &lt;- acf(R5, lag.max = 12) # compute the ACF</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/7c9ef490c46f39192e171d089ac24320.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*JLE6FeNuYTIux-Kmn557_g.png"/></div></figure><p id="9292" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的ACF图显示了负自相关模式，但无法直观地确定确切的顺序，或者数据中是否存在额外的移动平均成分。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="5453" class="lk kc hi lg b fi ll lm l ln lo">Rpacf &lt;- pacf(R1, lag.max = 12) # compute the PACF</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/fd6957568e166ea63fbc9bf65621abd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*MjIRkNNSL4kq6ynEOHOchA.png"/></div></figure><p id="6518" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基金份额(对数)回报的PACF。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="524d" class="lk kc hi lg b fi ll lm l ln lo">Rpacf &lt;- pacf(R5, lag.max = 12) # compute the PACF</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/3613677dc110484cdc42a867b8167f1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*_1lIJkVk3_sPhz0Wd2G95A.png"/></div></figure><p id="83e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">收益率的自相关函数对我们没有太大的帮助。我们唯一能确定的是存在一种负的自相关模式。</p><p id="bd1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一种确定要使用的组件类型的方法是(自相关或移动平均)。我们可以执行各种型号规格，并选择具有更好的AIC或BIC标准的型号。</p><h1 id="ed84" class="kb kc hi bd kd ke lq kg kh ki lr kk kl km ls ko kp kq lt ks kt ku lu kw kx ky bi translated">用ARIMA模型预测</h1><p id="ba27" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">执行预测模型的一个好选择是使用ARIMA模型族。对于那些不熟悉ARIMA模型甚至自相关函数理论的人，我推荐Brooks的书《金融计量经济学导论》。</p><p id="d725" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了对ARIMA(p，d，q)规格建模，我们必须知道自相关分量的阶数(p)、积分的阶数(d)和移动平均过程的阶数(q)。</p><p id="f82f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好吧，但是，怎么做呢？</p><p id="415e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一种策略是查看自相关函数和偏自相关函数。因为我们不能只根据我们在图表中看到的来陈述一种模式，我们必须测试一些模型规格，并选择一个具有更好的AIC或BIC标准的模型。</p><p id="904a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经知道收益是平稳的，所以我们不需要验证平稳条件(如果你不相信我，你可以这么做:)。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="a6a6" class="lk kc hi lg b fi ll lm l ln lo"># The ARIMA regression<br/> arR &lt;- Arima(R5, order = c(1,0,1)) # the auto.arima() function automatically choose the optimal lags to AR and MA components and perform tests of stationarity and seasonality<br/> <br/> summary(arR) # now we can see the significant lags</span><span id="5c47" class="lk kc hi lg b fi lp lm l ln lo">## Series: R5 <br/> ## ARIMA(1,0,1) with non-zero mean <br/> ## <br/> ## Coefficients:<br/> ##           ar1     ma1    mean<br/> ##       -0.8039  0.6604  0.0000<br/> ## s.e.   0.0534  0.0636  0.0016<br/> ## <br/> ## sigma^2 estimated as 0.001971:  log likelihood=1091.75<br/> ## AIC=-2175.49   AICc=-2175.43   BIC=-2157.63<br/> ## <br/> ## Training set error measures:<br/> ##                        ME       RMSE        MAE      MPE     MAPE      MASE<br/> ## Training set 9.087081e-07 0.04429384 0.02592896 97.49316 192.4589 0.6722356<br/> ##                     ACF1<br/> ## Training set 0.005566003</span></pre><p id="06ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果希望进行快速分析，而不是执行多个模型并比较AIC标准，可以使用auto.arima()函数，该函数自动选择自相关、积分的顺序，并测试数据中的季节成分。</p><p id="b341" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我用它来知道ARIMA(1，0，1)最适合我的数据！！</p><p id="bdc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有趣的是检查残差以验证模型是否考虑了数据的所有非随机成分。我们可以用forecast软件包的checkresiduals函数来实现。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="01ca" class="lk kc hi lg b fi ll lm l ln lo">checkresiduals(arR)# checking the residuals</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/0b21d2be7eceeebfef2cdeb3e6432fe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*KOng1aD2D6d2VWm47G3hcQ.png"/></div></figure><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="68c5" class="lk kc hi lg b fi ll lm l ln lo"> ## <br/> ##  Ljung-Box test<br/> ## <br/> ## data:  Residuals from ARIMA(1,0,1) with non-zero mean<br/> ## Q* = 186.44, df = 7, p-value &lt; 2.2e-16<br/> ## <br/> ## Model df: 3.   Total lags used: 10</span></pre><p id="fd7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看看残差ACF。该模型似乎没有考虑所有非随机成分，可能是由于条件异方差。由于这不是本文的重点，你可以谷歌一下Arch-Garch家族模型</p><h1 id="d79c" class="kb kc hi bd kd ke lq kg kh ki lr kk kl km ls ko kp kq lt ks kt ku lu kw kx ky bi translated">现在，预测！</h1><p id="9ce8" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">预测可以很容易地用一个单一的功能预测。您应该只插入auto.arima()函数给定的模型对象和要预见的未来期间。</p><pre class="je jf jg jh fd lf lg lh li aw lj bi"><span id="83ab" class="lk kc hi lg b fi ll lm l ln lo">farR &lt;-forecast(arR, 15)<br/> <br/> ## Fancy way to see the forecasting plot<br/> <br/> plot_forecast(farR)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mb"><img src="../Images/e04a8a0b703e79d8f695a6a827e8895c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*OnZfYwg8oYkeK9VQUY3t_w.png"/></div></div></figure><p id="03bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">TSstudio包的函数plot_forecast是查看绘图预测的好方法。如果您将鼠标光标放在图上，您可以看到基金份额的笛卡尔坐标位置。</p><p id="6d1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你可以去预测你想要的一切。祝你好运！</p></div></div>    
</body>
</html>