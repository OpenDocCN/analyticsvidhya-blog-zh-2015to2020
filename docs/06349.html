<html>
<head>
<title>How to calculate Gower’s Distance using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Python计算高尔的距离</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/concept-of-gowers-distance-and-it-s-application-using-python-b08cf6139ac2?source=collection_archive---------2-----------------------#2020-05-19">https://medium.com/analytics-vidhya/concept-of-gowers-distance-and-it-s-application-using-python-b08cf6139ac2?source=collection_archive---------2-----------------------#2020-05-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8981e3074b7cca4322fe8fcfafe4d7fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KeD_FnY4UnHctrJ6"/></div></div></figure><p id="bc80" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通常在我们的分析中，我们倾向于将相似的对象组合在一起，然后对这些组应用不同的规则和验证，而不是分别处理每个单独的点。</p><p id="9f63" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在机器学习领域，这种活动被称为聚类。有许多算法用于聚类的K-Means，DBSCAN，层次聚类等。但是，如果数据集中既有数值数据又有分类数据，那么它们都不是有效的。高尔的措施旨在解决这个问题。</p><blockquote class="jo jp jq"><p id="ad1f" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated">你如何衡量相似性？</p></blockquote><p id="ae8f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你将如何区分银行存款余额为10000美元、平均信用卡消费为300美元/月、住在洛杉矶并且是餐馆老板的客户A<strong class="is hj">与另一位银行存款余额为11230美元、平均信用卡消费为1300美元/月、住在新泽西州并且受雇于一家私人公司担任商业分析师的<strong class="is hj">客户B </strong>？</strong></p><p id="71e8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">那么<strong class="is hj">的客户C </strong>呢？他也是一名商业分析师，没有信用卡，住在洛杉矶，银行账户中有50000美元。如果你比较居住地，C和A是相似的，但另一方面，如果你比较他们的职业，C显然更像b。</p><p id="e919" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">很明显，他们三个都是不同的，因为他们的三个属性都不相同。但真正的问题是我们如何定义不同？它们有多相似/不相似？如果我们需要配对一个而忽略一个，我们该如何决定？在分析中，我们应该量化一切。我们需要数字来支持我们的观察。仅根据数字特征对数据点进行分组很容易，K-Means为我们做到了这一点。对于分类数据也是如此，K-Mode可用于该目的。当我们既有数字特征又有分类特征时，聚类就不能很好地工作。</p><blockquote class="jo jp jq"><p id="1994" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated"><strong class="is hj"> 1。高尔的度量是什么</strong></p><p id="217f" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated"><strong class="is hj"> 2。数据准备</strong></p><p id="fa46" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated"><strong class="is hj"> 3。理解计算</strong></p><p id="2df5" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated"><strong class="is hj"> 4。解读</strong></p><p id="bfb2" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated"><strong class="is hj"> 5。单线实施</strong></p></blockquote><h2 id="8c20" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jb kg kh ki jf kj kk kl jj km kn ko kp bi translated">高尔测量</h2><p id="fd1e" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated"><em class="jr">高尔的距离/测度/系数/相似度是一种寻找由混合类型属性组成的数据集的两行之间的相似性的测度。它使用连续变量的曼哈顿距离和二进制变量之间的相似性度量骰子距离的概念。</em></p><p id="3bee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是计算高尔距离的数学公式:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/473020e49c124531da9ef50f67ac78ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CVB0w8GF_Vqq93qPheHd3A.png"/></div></div></figure><p id="bac6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">s’也可以说是我们有兴趣计算的相似度值。</p><h2 id="5b31" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jb kg kh ki jf kj kk kl jj km kn ko kp bi translated"><strong class="ak">数据准备</strong></h2><p id="4072" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">在这篇博客中，我将使用3个特征(2个数字和1个分类)来展示这个指标。我们将首先从导入必要的库开始。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="32ca" class="jv jw hi lb b fi lf lg l lh li">import pandas as pd<br/>import numpy as np<br/>from sklearn.neighbors import DistanceMetric</span></pre><p id="564b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">构建数据框架</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="5b7c" class="jv jw hi lb b fi lf lg l lh li">df = pd.DataFrame([[1,2.6,'A'],[12,5,'X'],[4,7,'A']])<br/>df.columns = ['Num_1','Num_2','Cat_1']</span></pre><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es lj"><img src="../Images/d67fd487f892c427287f9beb2c0fc1db.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*arz-5put1WaviKGhSl-WKg.png"/></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">数据</figcaption></figure><p id="2ad7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以我现在需要根据每个特征找出2个数据点之间的相似性。我将找出公式中给出的3个不同的值。</p><p id="0e63" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">理解计算</strong></p><p id="bd13" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我将这三个相似点称为s1、s2和s3。我会把所有的权重保持为1。</p><p id="d760" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">s1 =基于“Num_1”的相似性</p><p id="f8a2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是一个两步过程</p><ol class=""><li id="cc18" class="lo lp hi is b it iu ix iy jb lq jf lr jj ls jn lt lu lv lw bi translated">求每个点之间的曼哈顿距离</li><li id="0cb0" class="lo lp hi is b it lx ix ly jb lz jf ma jj mb jn lt lu lv lw bi translated">归一化矩阵</li></ol><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="78e1" class="jv jw hi lb b fi lf lg l lh li">s1 = DistanceMetric.get_metric('manhattan').pairwise(df[['Num_1']])<br/>s1</span></pre><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/251a3731f1fabc5f678911d316ff6d83.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*k4sNLwr6I6uyj9QsC2EJiQ.png"/></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">基于曼哈顿距离的差异</figcaption></figure><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="b2ed" class="jv jw hi lb b fi lf lg l lh li"># normalizing the matrix by dividing with the highest values<br/>s1 = s1/max(np.ptp(df['Num_1']),1)<br/>s1</span></pre><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es md"><img src="../Images/5b6516973b53d86e553323e935ea40a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*Kt0GvFNB4fXddAle_mlcYg.png"/></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">归一化后的相似矩阵</figcaption></figure><p id="0ac0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">同样，可以计算s2。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="03f1" class="jv jw hi lb b fi lf lg l lh li">#performing both the step at the same time<br/>s2 = DistanceMetric.get_metric('manhattan').pairwise(df[['Num_2']])/max(np.ptp(df['Num_2']),1)<br/>s2</span></pre><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es me"><img src="../Images/c2087b221878d8c775ae22bb876f0597.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*7Tr1oYjduTg5fPin1-y2zQ.png"/></div></figure><p id="8db8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在计算s3，不会和我们在s1和s2中处理数值一样。我们首先需要将分类值转换成虚拟变量，然后应用骰子距离。</p><p id="86d9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想知道什么是骰子系数，那么只需记住它也是一种计算类别之间相似性的方法。</p><p id="825e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了在值相等时缩短它，DiceDistance = 0</p><p id="e629" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当它们不相等时，这就是sklearn计算DiceDistance的方法。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/75525ab9c60a5d9638ef697e48f04b07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dGseoD_o25BrppXITlFXVg.png"/></div></div></figure><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="9e41" class="jv jw hi lb b fi lf lg l lh li">For our problem</span><span id="9f97" class="jv jw hi lb b fi mg lg l lh li">NTF : number of dims in which the first value is True, second is False = 2.</span><span id="9fed" class="jv jw hi lb b fi mg lg l lh li">NFT : number of dims in which the first value is False, second is True = 1.<br/>        <br/>NNEQ : number of non-equal dimensions, NNEQ = NTF + NFT = 3.<br/>        <br/>NTT : number of dims in which both values are True = 0.</span><span id="3de0" class="jv jw hi lb b fi mg lg l lh li">NNZ : number of nonzero dimensions, NNZ = NTF + NFT + NTT = 3.</span><span id="1839" class="jv jw hi lb b fi mg lg l lh li">DiceDistance = NNEQ / (NTT + NNZ) = 3/3 = 1</span></pre><p id="3d9f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们用python代码来支持我们上面的手动计算。s3值可以计算如下</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="fb9a" class="jv jw hi lb b fi lf lg l lh li">s3 = DistanceMetric.get_metric('dice').pairwise(dummy_df)<br/>s3</span></pre><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es mh"><img src="../Images/060578cddf9a1957749a23902194fc62.png" data-original-src="https://miro.medium.com/v2/resize:fit:518/format:webp/1*y4Sye93yJKpoytMGPLFNtg.png"/></div></figure><p id="1361" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如所料，只要找到不相等的值，矩阵就会返回值1。</p><p id="4eae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们拥有所有的价值观。计算出的s1、s2和s3，w1 = w2 = w3 = 1。</p><p id="72e2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们来计算高尔的度量。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="d058" class="jv jw hi lb b fi lf lg l lh li">Gowers_Distance = (s1*w1 + s2*w2 + s3*w3)/(w1 + w2 + w3) <br/>Gowers_Distance</span></pre><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es mi"><img src="../Images/48432cd6d595b4fa30f1a0d2f436b816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*CXpBt4UbQYz0y4HiW0ka1g.png"/></div></figure><p id="63c4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面的矩阵代表了任意两个数据点之间的相似性指数。</p><h2 id="966d" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jb kg kh ki jf kj kk kl jj km kn ko kp bi translated">解释</h2><p id="442f" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">没有对从中得出的数字的解释，任何计算/算法都是不完整的。</p><p id="e983" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">行1和行2之间的距离是0.84，行1和行3之间的距离是0.42。</p><p id="3af7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这意味着与行2相比，行1更类似于行3。直觉上，这就像我们看一下值一样有意义。这两行在分类列中具有相同的值，并且Num_1中的值也比第2行更接近。</p><p id="1429" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jr">好极了！！！如果我们已经走了这么远，那么你已经学得很好了。</em></p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/f4b6c369ee630887c3eed97b9b05e2ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zTr2FQEaBVXzV8rC"/></div></div></figure><p id="b233" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是等等。难道Python中没有任何包可以自动完成这项工作，而不是手动编写公式吗？</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/66414bfba6dd53608b6e2c02918786f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Yg-0w9BtZD7-MCa1"/></div></div></figure><h2 id="f461" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jb kg kh ki jf kj kk kl jj km kn ko kp bi translated">单线实施</h2><p id="282f" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">与R不同，直到2019年12月才有可用的包。这可能是我们很少有人谈论这个话题的原因。</p><p id="317d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意，该软件包没有预装Anaconda。在开始使用它之前，您必须安装它并重启您的内核。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="c670" class="jv jw hi lb b fi lf lg l lh li">pip install gower</span></pre><p id="e5f6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个包的奇妙之处在于，你甚至不用做把值转换成虚拟变量的脏活。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="59f9" class="jv jw hi lb b fi lf lg l lh li">import gower<br/>gower.gower_matrix(df)</span></pre><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/7aa3df22f3f902557fcfc27e2a41634e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q8jhqfFAUBZLkLPL_jwqjg.png"/></div></div></figure><p id="fa71" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，收到的输出与我们手动执行计算时的输出完全相同。</p><p id="a1b9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">结论</strong></p><p id="29ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">基于相似性对对象进行分组是业内谈论最多的用例之一。就个人而言，我在我的一个项目中应用了这种方法，该项目的任务是根据与财务活动相关的17个不同的KPI对类似的供应商进行分组。那是我第一次按照高尔的标准着陆。</p><p id="7b04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该分析可以扩展，其中输出矩阵可以被直接馈送到许多算法中，如用于维数约简、层次聚类等的t-sne算法。</p><p id="144b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">希望你看博客的时候过得愉快。如果你喜欢我的博客，请给我的这篇文章一些掌声以示支持。</p><p id="a1c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完整代码的链接可以在这里找到:<a class="ae mm" href="https://github.com/Sreemanto/Gower-s-Distance/blob/master/Gower's%20Measure.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> GitHub </strong> </a></p><p id="2ca9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我的领英简介:<a class="ae mm" href="https://www.linkedin.com/in/sreemanta/" rel="noopener ugc nofollow" target="_blank">T5】领英T7】</a></p><p id="e726" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">参考资料:</p><div class="mn mo ez fb mp mq"><a href="https://pypi.org/project/gower/" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab dw"><div class="ms ab mt cl cj mu"><h2 class="bd hj fi z dy mv ea eb mw ed ef hh bi translated">英国威尔士南部</h2><div class="mx l"><h3 class="bd b fi z dy mv ea eb mw ed ef dx translated">Python中高尔的距离计算。高尔距离是一种距离测量，可以用来计算距离…</h3></div><div class="my l"><p class="bd b fp z dy mv ea eb mw ed ef dx translated">pypi.org</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne io mq"/></div></div></a></div><div class="mn mo ez fb mp mq"><a href="http://www.apimirror.com/scikit_learn/modules/generated/sklearn.neighbors.distancemetric" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab dw"><div class="ms ab mt cl cj mu"><h2 class="bd hj fi z dy mv ea eb mw ed ef hh bi translated">scikit_learn</h2><div class="mx l"><h3 class="bd b fi z dy mv ea eb mw ed ef dx translated">基地。BaseEstimator基础。BaseEstimator基础。BaseEstimator.get_params() base。BaseEstimator.set_params()…</h3></div><div class="my l"><p class="bd b fp z dy mv ea eb mw ed ef dx translated">www.apimirror.com</p></div></div></div></a></div></div></div>    
</body>
</html>