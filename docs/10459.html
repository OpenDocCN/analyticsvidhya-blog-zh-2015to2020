<html>
<head>
<title>Customer Churn in the Telecom Sector</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">电信行业的客户流失</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/customer-churn-in-the-telecom-sector-34b6f04ed43e?source=collection_archive---------14-----------------------#2020-10-19">https://medium.com/analytics-vidhya/customer-churn-in-the-telecom-sector-34b6f04ed43e?source=collection_archive---------14-----------------------#2020-10-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/8c5db858e60947538fe0a1d376642505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*TD4F1QB8ERIE4O2Dc7IQjQ.png"/></div></figure><p id="3ff8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi jk translated">每个公司都想尽可能留住自己的客户。顾客是公司成功的象征，尤其是服务行业的公司。一个组织的研发部门和人力资源部采取了各种措施来减少客户的流失。阻止客户流失的关键步骤之一是分析历史数据。人力资源部门的重要任务之一是保存历史数据并保持更新。</p><p id="6998" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对客户信息系统数据的分析被称为客户流失。客户流失涉及的主要假设是，具有这些属性和服务的客户是否可能离开服务，以及他离开服务的可能性有多大。导致客户离开服务的因素有哪些？</p><p id="0e33" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个分析过程由组织中具有数据科学、数据分析、数据分析和机器学习等工作背景的人员来完成。因此，如果你的目标是像这样的工作简介，你一定会想通读这篇文章。因此，让我们动手做一些分析。我们将使用Python作为我们的语言来创造奇迹。</p><h1 id="3714" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">“问题定义”</h1><p id="20c9" class="pw-post-body-paragraph im in hi io b ip kr ir is it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj hb bi translated">在竞争激烈的服务行业，客户流失是一个值得关注的问题。另一方面，如果在早期阶段预测可能离开公司的客户，这将是一个潜在的巨大的额外收入来源。</p><p id="229b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们必须找到客户是否有可能停止电信服务。导致客户停止服务的原因是什么？创建一个机器学习模型来预测客户是否会离开。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kw"><img src="../Images/c76b10827395edfcd728e19a6cf76912.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TJvo-bk9MVKNDubo.png"/></div></div></figure><pre class="kx ky kz la fd lf lg lh li aw lj bi"><span id="06ec" class="lk ju hi lg b fi ll lm l ln lo"># importing project dependencies:<br/># compute dependency<br/>import numpy as np<br/># dataframe dependency<br/>import pandas as pd<br/># visualization dependencies<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>import plotly.express as px<br/># stats dependency<br/>from scipy import stats<br/># feature_engineering dependency<br/>import feature_engine<br/># from scraping some data<br/>import webbrowser<br/>import warnings<br/>warnings.filterwarnings('ignore')</span><span id="3342" class="lk ju hi lg b fi lp lm l ln lo"># importing the training dependencies<br/>from sklearn.linear_model import LogisticRegression<br/>from sklearn.svm import SVC<br/>from sklearn.neighbors import KNeighborsClassifier<br/>from sklearn.naive_bayes import GaussianNB<br/>from sklearn.tree import DecisionTreeClassifier<br/>from sklearn.ensemble import RandomForestClassifier<br/>from sklearn.ensemble import GradientBoostingClassifier<br/>from sklearn.ensemble import AdaBoostClassifier</span><span id="a616" class="lk ju hi lg b fi lp lm l ln lo"># importing the evalation metrics<br/>from sklearn.model_selection import cross_val_score,KFold<br/>from sklearn.metrics import f1_score,precision_score,recall_score<br/>from sklearn.metrics import plot_confusion_matrix,plot_roc_curve<br/>from sklearn.metrics import classification_report</span></pre><p id="127e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">导入我们将在此过程中使用的所需库。</p><pre class="kx ky kz la fd lf lg lh li aw lj bi"><span id="f796" class="lk ju hi lg b fi ll lm l ln lo"># importing in the dataset<br/>df = pd.read_csv(‘Customer_Churn.csv’)</span></pre><p id="06e8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用导入数据。csv文件"</p><pre class="kx ky kz la fd lf lg lh li aw lj bi"><span id="a837" class="lk ju hi lg b fi ll lm l ln lo">&lt;class 'pandas.core.frame.DataFrame'&gt;<br/>RangeIndex: 7043 entries, 0 to 7042<br/>Data columns (total 21 columns):</span><span id="7606" class="lk ju hi lg b fi lp lm l ln lo">#   Column            Non-Null Count  Dtype</span><span id="08db" class="lk ju hi lg b fi lp lm l ln lo">---  ------            --------------  -----</span><span id="2387" class="lk ju hi lg b fi lp lm l ln lo">0   customerID        7043 non-null   object</span><span id="6d74" class="lk ju hi lg b fi lp lm l ln lo">1   gender            7043 non-null   object</span><span id="d395" class="lk ju hi lg b fi lp lm l ln lo">2   SeniorCitizen     7043 non-null   int64</span><span id="2393" class="lk ju hi lg b fi lp lm l ln lo">3   Partner           7043 non-null   object</span><span id="5e73" class="lk ju hi lg b fi lp lm l ln lo">4   Dependents        7043 non-null   object</span><span id="8201" class="lk ju hi lg b fi lp lm l ln lo">5   tenure            7043 non-null   int64</span><span id="1b9d" class="lk ju hi lg b fi lp lm l ln lo">6   PhoneService      7043 non-null   object</span><span id="4b5f" class="lk ju hi lg b fi lp lm l ln lo">7   MultipleLines     7043 non-null   object</span><span id="fc1f" class="lk ju hi lg b fi lp lm l ln lo">8   InternetService   7043 non-null   object</span><span id="d71d" class="lk ju hi lg b fi lp lm l ln lo">9   OnlineSecurity    7043 non-null   object</span><span id="bc64" class="lk ju hi lg b fi lp lm l ln lo">10  OnlineBackup      7043 non-null   object</span><span id="a83a" class="lk ju hi lg b fi lp lm l ln lo">11  DeviceProtection  7043 non-null   object</span><span id="98bd" class="lk ju hi lg b fi lp lm l ln lo">12  TechSupport       7043 non-null   object</span><span id="cf21" class="lk ju hi lg b fi lp lm l ln lo">13  StreamingTV       7043 non-null   object</span><span id="56d0" class="lk ju hi lg b fi lp lm l ln lo">14  StreamingMovies   7043 non-null   object</span><span id="8c77" class="lk ju hi lg b fi lp lm l ln lo">15  Contract          7043 non-null   object</span><span id="8e3a" class="lk ju hi lg b fi lp lm l ln lo">16  PaperlessBilling  7043 non-null   object</span><span id="af82" class="lk ju hi lg b fi lp lm l ln lo">17  PaymentMethod     7043 non-null   object</span><span id="7766" class="lk ju hi lg b fi lp lm l ln lo">18  MonthlyCharges    7043 non-null   float64</span><span id="5044" class="lk ju hi lg b fi lp lm l ln lo">19  TotalCharges      7043 non-null   object</span><span id="a7df" class="lk ju hi lg b fi lp lm l ln lo">20  Churn             7043 non-null   object</span><span id="e70e" class="lk ju hi lg b fi lp lm l ln lo">dtypes: float64(1), int64(2), object(18)</span><span id="eb10" class="lk ju hi lg b fi lp lm l ln lo">memory usage: 1.1+ MB</span></pre><p id="ba58" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">数据集中总共有19个要素。这些特征中的一些给出了关于客户的个人信息，一些特征描述了可用的特征，其余的给出了使用相应服务的客户的账单细节。</p><p id="7315" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">客户流失变量给出了如果客户可能停止他的服务或继续他的服务，因此客户流失是这里的目标变量。目标变量的值必须是唯一的值“是”和“否”。因此，这个流失变量是一个二元目标。为了预测二元目标，我们使用分类方法。</p><p id="5773" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">大多数机器学习算法不能很好地处理缺失数据，因此我们需要始终在数据集中找到并解决缺失值。此外，我们没有在用于建模的数据中保留两个高度相关的特征。我们在ML建模期间做出的假设之一是，任何两个特征都是彼此独立的，如果相关性高，则意味着这些特征是相关的，这将增加模型的白泽。检查完这些条件后，我们得出一些推论:</p><h1 id="b26b" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">“探索性数据分析”</h1><p id="c026" class="pw-post-body-paragraph im in hi io b ip kr ir is it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj hb bi translated">EDA的一个重要方面是实现数据并在数据中找到意义。EDA通常可以分为两种类型:</p><p id="d27a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">单变量分析和多变量分析。</p><h2 id="dce7" class="lk ju hi bd jv lq lr ls jz lt lu lv kd ix lw lx kh jb ly lz kl jf ma mb kp mc bi translated">单变量分析</h2><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es md"><img src="../Images/95c394673dbdcd8ec3c007a8cc2719ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*pJlLH_LYfhkW3aREL2k6Yg.png"/></div></figure><p id="caa0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们看看客户利用服务的期限(以月为单位)。大多数客户选择按月或不到1年的租赁期。</p><p id="3508" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是一个连续变量。因此，我们将绘制密度分布图，以月为单位绘制任期图。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es me"><img src="../Images/6b3bebcc34187231fc7f884b11659c39.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*BDMq3uTIYQytqj8prl6wmg.png"/></div></figure><p id="8e0c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">客户是否使用电信提供的任何电话服务，如果使用，客户是否使用多条线路？</p><p id="7d43" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以绘制一个柱状图来获得这些信息。我们可以看到大多数客户使用电话服务。使用多线和单线的客户几乎相同(接近3000)。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mf"><img src="../Images/26dd57c3d9e4bdeafc07ee37c3a7c1ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*AYN3Z2vrtZdTMguDoyHZFQ.png"/></div></figure><p id="3d28" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从相邻的图中，我们可以看到，大多数客户采取逐月图。新客户或不信任服务的客户可能会选择按月服务。然而，采用两年计划的客户对电信公司提供的服务更满意。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mg"><img src="../Images/9cf14689320c6d12d443e0919f049e91.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*H96KfTrtdSsjxAXxv4GhtA.png"/></div></figure><p id="d2c1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这些是客户必须支付的服务月费。大多数顾客每月支付大约20美元。该特征在尾部的一端以高概率(大约20)遵循正态分布</p><h2 id="2c0d" class="lk ju hi bd jv lq lr ls jz lt lu lv kd ix lw lx kh jb ly lz kl jf ma mb kp mc bi translated">多变量分析</h2><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mh"><img src="../Images/cfc173651d2abd4ba3cf6a2838d4c7e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*MPohFAyBgTU6teCUnB8CDQ.png"/></div><figcaption class="mi mj et er es mk ml bd b be z dx translated">任期与流失</figcaption></figure><p id="ac3d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下图显示了两个KDE图，一个是客户离开服务(是)，另一个是客户没有离开/重新订购服务(否)。离开服务的客户任期较短，而没有离开/保留服务的客户更有可能采用更长的任期计划(超过60个月)。我们可以看到，拥有正流失值的客户的任期分布具有很高的偏斜度。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mm"><img src="../Images/369a4a47f5f9b5b08800e5dc0f9aa385.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*zHtR08ejP1RClJedACUBxQ.png"/></div><figcaption class="mi mj et er es mk ml bd b be z dx translated">付款方式与任期柱状图</figcaption></figure><ul class=""><li id="67ef" class="mn mo hi io b ip iq it iu ix mp jb mq jf mr jj ms mt mu mv bi translated">任期长的客户很可能更喜欢自动支付方式(银行转账和信用卡)。</li></ul><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es mw"><img src="../Images/bd2dae07dad1279fe2567e2a52aa330b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wLRlZuJk_vMjQzwXRPuM5Q.png"/></div></div><figcaption class="mi mj et er es mk ml bd b be z dx translated">线路与月费。</figcaption></figure><p id="647a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">上图是多条线路和客户每月支付费用之间的箱线图。我们根据客户获得的互联网服务，对多个Lineas功能的属性进行了划分。我们可以推断，选择光纤而不是传统DSL的客户必须支付更多的月费。</p><blockquote class="mx my mz"><p id="3c4c" class="im in na io b ip iq ir is it iu iv iw nb iy iz ja nc jc jd je nd jg jh ji jj hb bi translated">光纤很贵！</p></blockquote><h1 id="eef9" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">“数据预处理和管道”</h1><blockquote class="mx my mz"><p id="7c96" class="im in na io b ip iq ir is it iu iv iw nb iy iz ja nc jc jd je nd jg jh ji jj hb bi translated">垃圾进，垃圾出！</p></blockquote><p id="5fa7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果每次我把这个告诉别人，a都能得到5分钱，那我就可以在外星人上写这篇文章了。你的数据越好，你的预测就越准确，就这么简单。现在有了一套精确的规则来处理数据，但是在处理数据的过程中，有些事情你需要注意</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es ne"><img src="../Images/1c9e6f98fa7a7cb75620319acb0c4ee0.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*tSO5buUxWR1UYnDMXE3pog.png"/></div></figure><ul class=""><li id="dd7c" class="mn mo hi io b ip iq it iu ix mp jb mq jf mr jj ms mt mu mv bi translated">删除相关值大于0.95的要素。如果你有很多特性，你也可以把这个阈值降低到0.9。数据集中最好不要有高度相关的要素。为了检查python中的相关性，我们使用热图。</li></ul><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es nf"><img src="../Images/0f9d6d1ac53183bbaa2fef5c9e46cbd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:304/format:webp/1*D1rlDhF8wYzTfHMaOD2vaw.png"/></div></div><figcaption class="mi mj et er es mk ml bd b be z dx translated">要素中没有缺失值。</figcaption></figure><ul class=""><li id="7293" class="mn mo hi io b ip iq it iu ix mp jb mq jf mr jj ms mt mu mv bi translated">前面说了，找出脏数据。在每种情况下，数据可能丢失，也可能不丢失(np.nan格式)，特征中也可能有错误数据。人们可以很容易地发现大部分用户数据，因为要么该特性中的其余值没有相同的格式，要么丢失的值可能被替换为类似999、' missing '、'？', '-'.为了处理这类脏数据，我们把它们转换成Nan格式进行处理。然后，根据要求我们处理那些丢失的值。在我们的数据中，我们没有任何缺失值。这在现实世界中是非常罕见的情况，我们可能会认为自己很幸运！</li><li id="4d74" class="mn mo hi io b ip ng it nh ix ni jb nj jf nk jj ms mt mu mv bi translated"><strong class="io hj">从数据集中移除离群值</strong>。我们可以使用各种异常值去除技术来检测和处理数据集中的异常值。常见的做法是使用Z评分法和四分位间距法(IQR)来处理异常值。请注意，在使用Z得分和IQR算法之前移除所有NaN值非常重要。此外，必须仅对数值特征而非分类变量执行异常值移除。</li><li id="0f47" class="mn mo hi io b ip ng it nh ix ni jb nj jf nk jj ms mt mu mv bi translated">下一步将是解决数据的<strong class="io hj">偏斜</strong>。数据科学家对数据集中数字特征的偏斜度非常担心。有3种偏斜分布类型:正偏斜、负偏斜和正态偏斜。数据分析师非常喜欢正态分布。数据科学家们也在努力，所以每当我们的数据集中有一个数字特征，并且该特征是倾斜的，我们倾向于使用一些倾斜变换方法使该倾斜更加正常。偏斜变换的常见做法是使用对数变换、平方根变换和n次方变换(Box-Cox)。有效倾斜是指要素的倾斜值在-1到+1之间。倾斜大于绝对值1 (abs(1))的特征无效。</li></ul><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es nl"><img src="../Images/54419014c74a7a6879746ab96b5f88c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*X8bnr6HPBQX_bv1HG5Ztmg.png"/></div></figure><p id="23be" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">上图显示了倾斜变换前后的分布。我们的数据集中只有3个数字特征，其余的都是对象数据类型。我已经应用了平方根变换，因为它给了我们最好的偏斜。</p><ul class=""><li id="4ff0" class="mn mo hi io b ip iq it iu ix mp jb mq jf mr jj ms mt mu mv bi translated">同样，大多数传统的机器学习模型与字符串数据不兼容，即具有对象数据类型的特征。因此，我们需要将对象数据类型的特征转换成数字特征。这就是所谓的<strong class="io hj">分类编码。</strong>编码有两种类型。一个热编码和标签编码。标签编码是针对分类目标变量和序数类型特征编码完成的。然而，一个热编码被应用于具有标称特征类型的特征。</li></ul><p id="4291" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在我们的问题中，目标是二进制分类的，因此我们使用标签编码将其转换为数字。我们还有一些名义上的分类独立变量，因此我们将对它们应用一键编码。</p><p id="193b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">EDA后的结束语:</p><ul class=""><li id="18bc" class="mn mo hi io b ip iq it iu ix mp jb mq jf mr jj ms mt mu mv bi translated">目标变量具有不平衡的类。</li><li id="d4c5" class="mn mo hi io b ip ng it nh ix ni jb nj jf nk jj ms mt mu mv bi translated">该数据集中有7000多个样本。</li><li id="dc89" class="mn mo hi io b ip ng it nh ix ni jb nj jf nk jj ms mt mu mv bi translated">该数据集有20个要素。</li><li id="c842" class="mn mo hi io b ip ng it nh ix ni jb nj jf nk jj ms mt mu mv bi translated">在这20个特征中，3个是数字的，其余的是分类的</li><li id="f86f" class="mn mo hi io b ip ng it nh ix ni jb nj jf nk jj ms mt mu mv bi translated">这个数据集中没有丢失数据，尽管脏数据的可能性很高。</li><li id="6ae7" class="mn mo hi io b ip ng it nh ix ni jb nj jf nk jj ms mt mu mv bi translated">数据集中没有高度相关的要素。</li><li id="deff" class="mn mo hi io b ip ng it nh ix ni jb nj jf nk jj ms mt mu mv bi translated">尽管成本高，大多数顾客还是喜欢光纤。</li><li id="967f" class="mn mo hi io b ip ng it nh ix ni jb nj jf nk jj ms mt mu mv bi translated">大多数顾客喜欢月租。</li></ul><h1 id="2f67" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">“构建机器学习分类模型”</h1><p id="c66f" class="pw-post-body-paragraph im in hi io b ip kr ir is it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj hb bi translated">当你建立一个模型时，所有处理数据的艰苦工作将由你来做。</p><p id="a5bf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先我们需要<strong class="io hj">分离特征和目标</strong>。按照惯例，我们将对“X”和“y”变量中的特性进行评分。始终检查数组和数据帧的形状，这将使您的调试变得容易。</p><pre class="kx ky kz la fd lf lg lh li aw lj bi"><span id="469b" class="lk ju hi lg b fi ll lm l ln lo">X = df_cleaned.drop('Churn_No',1)<br/>y = df_cleaned['Churn_No']<br/>print(X.shape,y.shape)</span><span id="cd3a" class="lk ju hi lg b fi lp lm l ln lo">((7032, 30), (7032,))</span></pre><p id="5369" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们没有任何其他训练数据集，因此我们将随机选择一定比例的样本作为训练集，并在该数据上验证模型。sklearn库为我们提供了许多进行这种拆分的函数。我们将使用<strong class="io hj">训练_测试_分割</strong>功能。我们将按照70:30的列车测试比例分割数据。</p><pre class="kx ky kz la fd lf lg lh li aw lj bi"><span id="8a43" class="lk ju hi lg b fi ll lm l ln lo">from sklearn.model_selection import train_test_split<br/>X_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.3,random_state=42)</span><span id="c97b" class="lk ju hi lg b fi lp lm l ln lo">print(X_train.shape,y_train.shape,X_test.shape,y_test.shape)</span><span id="355b" class="lk ju hi lg b fi lp lm l ln lo">((4922, 30), (4922,), (2110, 30), (2110,))</span></pre><p id="5a1e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将运行多个模型，并找到给我们最好结果的模型。</p><pre class="kx ky kz la fd lf lg lh li aw lj bi"><span id="6f97" class="lk ju hi lg b fi ll lm l ln lo"># choosing the best model</span><span id="545d" class="lk ju hi lg b fi lp lm l ln lo">models = [LogisticRegression(),SVC(),KNeighborsClassifier(n_neighbors=5),DecisionTreeClassifier(),RandomForestClassifier(n_estimators=200),GradientBoostingClassifier(n_estimators=150),AdaBoostClassifier(RandomForestClassifier())]</span><span id="0a06" class="lk ju hi lg b fi lp lm l ln lo">model_names = 'Logistic_reg SVC KNN Random_forest Decision_Treee Gradient_boost Adaboost'.split()</span><span id="a122" class="lk ju hi lg b fi lp lm l ln lo">models_df = pd.DataFrame(columns=['Algo','Train_acc','Test_acc','Precision','Recall','F1_score','Avg_CV'])</span><span id="0bdd" class="lk ju hi lg b fi lp lm l ln lo">for (model,model_names) in zip(models,model_names):</span><span id="2774" class="lk ju hi lg b fi lp lm l ln lo">print(model_names)</span><span id="2050" class="lk ju hi lg b fi lp lm l ln lo">model.fit(X_train,y_train)</span><span id="f7f8" class="lk ju hi lg b fi lp lm l ln lo">y_preds = model.predict(X_test)</span><span id="ee8f" class="lk ju hi lg b fi lp lm l ln lo">train_acc = model.score(X_train,y_train)</span><span id="a824" class="lk ju hi lg b fi lp lm l ln lo">test_acc = model.score(X_test,y_test)</span><span id="d3c6" class="lk ju hi lg b fi lp lm l ln lo">prec = precision_score(y_test,y_preds,average='micro')rec = recall_score(y_test,y_preds,average='micro')f1 = f1_score(y_test,y_preds,average='micro')avg_cv = np.mean(cross_val_score(model,X_train,y_train))</span><span id="c886" class="lk ju hi lg b fi lp lm l ln lo">models_df = models_df.append({'Algo':model_names,'Train_acc':train_acc,'Test_acc':test_acc,'Precision':prec,'Recall':rec,'F1_score':f1,'Avg_CV':avg_cv},ignore_index=True)</span></pre><p id="251d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下表给出了各种ML算法的评估。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es nm"><img src="../Images/d398908e95b6252a6c84b5526efa26c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*2QhRsp5eCq5ZZusB_8GVZw.png"/></div><figcaption class="mi mj et er es mk ml bd b be z dx translated">模型评估</figcaption></figure><p id="0843" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里我们有<strong class="io hj">逻辑回归</strong>作为胜出者，以0.005%的幅度击败梯度提升。有时候，如果你得到相同的结果，保持事情简单会更好。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es nn"><img src="../Images/802090ac07115eff967f45205a3b1d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*-rGADvxHyku6PjpaDoN1Ag.png"/></div><figcaption class="mi mj et er es mk ml bd b be z dx translated">分类报告</figcaption></figure><p id="a3bf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">考虑到目标中的不平衡类，这些度量是非常好的。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es no"><img src="../Images/2142d5b138a7132f87f7ea8435cc99c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*vPwkYsn1a8sEf-all--aqw.png"/></div><figcaption class="mi mj et er es mk ml bd b be z dx translated">训练数据的ROC曲线</figcaption></figure><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es np"><img src="../Images/ae70a8522d3ca8481217fbafa2e81513.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*46oLEi301bMaXt5Jqi3F2w.png"/></div><figcaption class="mi mj et er es mk ml bd b be z dx translated">测试数据的ROC曲线</figcaption></figure><p id="9e84" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">接收机工作特性曲线</strong></p><p id="cb8d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> ROC曲线</strong>显示了每个可能临界值的临床敏感性和特异性之间的关系</p><p id="232d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是训练集上的ROC曲线。训练集上85%的分数对于这个数据集来说是非常好的。</p><p id="8bc7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下图给出了测试的ROC曲线。ROC评分是84 %,也很不错了！</p><h1 id="8332" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">“保存模型”</h1><p id="c48e" class="pw-post-body-paragraph im in hi io b ip kr ir is it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj hb bi translated">我们已经走了很长的路，是时候拯救你的模型了。我们评估了多种算法，并决定逻辑回归算法是最适合我们的问题。</p><p id="6d6d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将使用Joblib库保存模型</p><pre class="kx ky kz la fd lf lg lh li aw lj bi"><span id="7531" class="lk ju hi lg b fi ll lm l ln lo">import joblib<br/>joblib.dump(best_model,'customer_churn.pkl')</span><span id="4a4f" class="lk ju hi lg b fi lp lm l ln lo">['customer_churn.pkl']</span></pre><p id="a39b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">完整的项目可从以下网址获得</p><div class="nq nr ez fb ns nt"><a href="https://github.com/gitwit-mistry/datatrained-projects/blob/master/Eval_Project_Week3/Project-15_Customer%20Churn.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab dw"><div class="nv ab nw cl cj nx"><h2 class="bd hj fi z dy ny ea eb nz ed ef hh bi translated">git wit-Mistry/data trained-项目</h2><div class="oa l"><h3 class="bd b fi z dy ny ea eb nz ed ef dx translated">permalink dissolve GitHub是超过5000万开发人员的家园，他们一起工作来托管和审查代码，管理…</h3></div><div class="ob l"><p class="bd b fp z dy ny ea eb nz ed ef dx translated">github.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh ik nt"/></div></div></a></div></div></div>    
</body>
</html>