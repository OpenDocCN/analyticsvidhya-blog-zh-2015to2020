<html>
<head>
<title>Journey of Apache Kafka &amp; Zookeeper Administrator ( Part 6 )</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">é˜¿å¸•å¥‡å¡å¤«å¡ä¸åŠ¨ç‰©å›­ç®¡ç†å‘˜ä¹‹æ—…(å…­)</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/analytics-vidhya/journey-of-apache-kafka-zookeeper-administrator-part-6-2e0c0afd1ae2?source=collection_archive---------21-----------------------#2020-08-25">https://medium.com/analytics-vidhya/journey-of-apache-kafka-zookeeper-administrator-part-6-2e0c0afd1ae2?source=collection_archive---------21-----------------------#2020-08-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="24c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2019å¹´7æœˆ</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/4efd6a725ba7782caa406a91c10da884.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*vocQpMjZPDjNvjwlJQhsGw.jpeg"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">å®˜æ–¹å›¾ç‰‡æ¥è‡ªé˜¿å¸•å¥‡å¡å¤«å¡ç½‘ç«™</figcaption></figure><p id="d4eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è°ˆåˆ°äº†é›…è™å¡å¤«å¡ç»ç†åˆåCMAKã€‚</p><p id="0748" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è®©æˆ‘ä»¬è½¬åˆ°ä¸‹ä¸€ä¸ªæœ‰è¶£çš„è¯é¢˜ï¼Œé‚£å°±æ˜¯ä½¿ç”¨MM1 çš„<strong class="ih hj">é˜¿å¸•å¥‡å¡å¤«å¡çš„<strong class="ih hj">è·¨dcå¤åˆ¶</strong>ã€‚</strong></p><p id="21c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¯·é—®è‡ªå·±ä¸€ä¸ªé—®é¢˜ï¼Œä½ çœŸçš„éœ€è¦å®ƒå—ï¼Ÿå¦‚æœä¸æ˜¯ï¼Œé‚£å°±ä¸è¦åšã€‚</p><p id="350f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å½“æˆ‘å¼€å§‹è¿™ä¸ªé¡¹ç›®æ—¶ï¼Œæ—¶é—´é•œåƒåˆ¶ä½œäºº2(åˆåMM2)è¿˜æ²¡æœ‰æ­£å¼å‘å¸ƒï¼Œæ‰€ä»¥æˆ‘åªèƒ½ç”¨MM1è¿›è¡Œè®¾è®¡ï¼Œå¹¶è¯šå®åœ°è¯´â€œMM1é€‚åˆæˆ‘çš„ç”¨ä¾‹â€ï¼Œæˆ‘åªéœ€è¦ç¡®ä¿æ•°æ®è¢«å¿«é€Ÿå¯é åœ°å¤åˆ¶(ä¸æ˜¯100%)ã€‚</p><p id="83a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘å·²ç»åœ¨5æœˆå’Œ6æœˆå¯¹MM1åšäº†ç›¸å½“å¤šçš„ç ”ç©¶ï¼Œä½†æ²¡æœ‰å®ç°å®ƒã€‚è¿™åªæ˜¯åœ¨æˆ‘çš„è„‘æµ·ä¸­ï¼Œè¿™å°±æ˜¯æˆ‘éœ€è¦å¦‚ä½•å®ç°å®ƒã€‚</p><p id="afa4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">ä¸ºä»€ä¹ˆä¸ç”¨ä»»ä½•ç¬¬ä¸‰æ–¹å¤åˆ¶å™¨æ¯”å¦‚</strong><a class="ae jp" href="https://github.com/uber/uReplicator" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">uå¤åˆ¶å™¨</strong> </a> <strong class="ih hj">ï¼Ÿ</strong> <br/>å½“æˆ‘æ£€æŸ¥å®ƒçš„è®¾è®¡æ—¶ï¼Œå®ƒç›¸å½“å¤æ‚ï¼Œä¸éœ€è¦é‚£äº›åŠŸèƒ½ï¼Œå¦‚åç§»åŒæ­¥ã€é…ç½®åŒæ­¥&amp; 100%å¯é ã€‚å³ä½¿å®ƒä½¿ç”¨<strong class="ih hj"> RDBMS </strong>ä½œä¸ºæºï¼Œè¿™ä¹Ÿæ˜¯å¦ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘å¿…é¡»ä¸ºå®ƒç®¡ç†æ•°æ®åº“ï¼Œç„¶åå¯¹æˆ‘çš„ç”¨ä¾‹è¿›è¡Œç›‘æ§ï¼Œè¿™æ˜¯éå¸¸å¤æ‚ä¸”ä¸å®¹æ˜“çš„è§£å†³æ–¹æ¡ˆã€‚</p><p id="f4e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘åœ¨æˆ‘çš„è¿‡ç¨‹ä¸­åŠ å…¥äº†ä¸€ä¸ªéå¸¸é‡è¦çš„ä¸œè¥¿ï¼Œæ¥å®Œç¾çš„åˆ©ç”¨MM1ã€‚<strong class="ih hj">ç”±äºMM1æ˜¯å•å‘çš„ï¼Œ</strong> <strong class="ih hj">æˆ‘ä¸å¾—ä¸å¼•å…¥ä¸»é¢˜åç¼€</strong>ï¼Œè¿™æ ·MM1å°±å¯ä»¥åœ¨å¤åˆ¶è¿‡ç¨‹ä¸­ä½¿ç”¨å®ƒä»¬ã€‚ä¸»é¢˜åç¼€æä¾›äº†ä¸åŒdcç¯å¢ƒä¹‹é—´çš„åˆ†éš”ã€‚</p><p id="65be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> MM1æ¶æ„(è¿œç¨‹è¯»å–å’Œæœ¬åœ°å†™å…¥æ¨¡å¼)</strong></p><ul class=""><li id="46e3" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">å®‰è£…åœ¨DC 2ä¸­çš„MM1å°†ä»DC 1å¡å¤«å¡è·å–è¿œç¨‹æ•°æ®ï¼Œå¹¶åœ¨æœ¬åœ°å†™å…¥DC 2å¡å¤«å¡ã€‚</li><li id="34c3" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">å®‰è£…åœ¨DC 1ä¸­çš„MM1å°†ä»DC 2å¡å¤«å¡è·å–è¿œç¨‹æ•°æ®ï¼Œå¹¶åœ¨æœ¬åœ°å†™å…¥DC 1å¡å¤«å¡ã€‚</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ke"><img src="../Images/f0e495c997f968f7a0bf9b7a9008fcba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*eAkpi3Wgyex4BzuLvNGpzg.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">åŸºäºMM1çš„æ¶æ„ã€‚</figcaption></figure><p id="9072" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">ä¸Šè¿°æ¶æ„çš„ä¼˜åŠ¿</strong></p><ul class=""><li id="e7fe" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">æ¯ä¸ªDCçš„ä¸»é¢˜+æ•°æ®çš„åˆ†ç¦»ã€‚</li><li id="7c30" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">æ”¯æŒMM1ã€‚</li><li id="ca2e" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">ä¸»é¢˜ä¹‹é—´æ²¡æœ‰æ•°æ®çš„å¾ªç¯/æ— é™å¤åˆ¶ã€‚</li><li id="754b" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">å¾ˆå¥½ç†è§£ã€‚</li><li id="2b21" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">å¦‚æœéœ€è¦ï¼Œå¾ˆå®¹æ˜“æ‰©å±•/ç¼©å°MM1çš„å®¹é‡ã€‚</li></ul><p id="b8fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘çš„æ¶æ„å·²ç»å®Œæˆï¼Œæˆ‘å¿…é¡»åœ¨å®‰è£…è¿‡ç¨‹+æµ‹è¯•é˜¶æ®µå·¥ä½œã€‚</p><p id="41f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‰€æœ‰çš„ä¸œè¥¿éƒ½å·²ç»åœ¨Apache KafkaåŒ…ä¸­ï¼Œæˆ‘å¿…é¡»ä¸ºå®ƒç”Ÿæˆä¸¤ä¸ªé…ç½®ï¼Œæ¶ˆè´¹è€…å’Œç”Ÿäº§è€…é…ç½®ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥åœ¨æŸä¸ªåœ°æ–¹è¯»å–å’Œå†™å…¥ï¼Œä»¥æ¨¡æ‹Ÿè·¨DCå¤åˆ¶ã€‚</p><p id="9d78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/configure/templates/kafka-mirror-maker-consumer.properties" rel="noopener ugc nofollow" target="_blank">æ¶ˆè´¹è€…é…ç½®</a></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="29aa" class="kk kl hi kg b fi km kn l ko kp">bootstrap.servers={{ kafkaMirrorMakerSourceDcClusterAddressString }}</span><span id="108f" class="kk kl hi kg b fi kq kn l ko kp"># consumer group id<br/>group.id={{ kafkaMirrorMakerGroupId }}<br/>auto.offset.reset={{ kafkaMirrorMakerAutoOffsetReset }}<br/>partition.assignment.strategy={{ kafkaMirrorMakerPartitionAssignmentStrategy }}<br/>fetch.max.bytes={{ kafkaMirrorMakerFetchMaxBytes }}<br/>fetch.min.bytes={{ kafkaMirrorMakerFetchMinBytes }}<br/>fetch.max.wait.ms={{ kafkaMirrorMakerFetchMaxWaitMs }}<br/>exclude.internal.topics=true<br/>allow.auto.create.topics=false</span></pre><p id="15cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/configure/templates/kafka-mirror-maker-producer.properties" rel="noopener ugc nofollow" target="_blank">ç”Ÿäº§å•†é…ç½®</a></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="d24b" class="kk kl hi kg b fi km kn l ko kp">bootstrap.servers={{ kafkaMirrorMakerDestinationDcClusterAddress }}<br/>compression.type={{ kafkaMirrorMakerCompressionType }}<br/>partitioner.class={{ kafkaMirrorMakerPartitionerClass }}<br/>request.timeout.ms={{ kafkaMirrorMakerRequestTimeoutMs }}<br/>max.block.ms={{ kafkaMirrorMakerMaxBlockMs }}<br/>linger.ms={{ kafkaMirrorMakerLingerMs }}</span><span id="e76c" class="kk kl hi kg b fi kq kn l ko kp"># the maximum size of a request in bytes<br/>max.request.size={{ kafkaMirrorMakerMaxRequestSize }}<br/>batch.size={{ kafkaMirrorMakerBatchSize }}<br/>buffer.memory={{ kafkaMirrorMakerBufferMemory }}</span><span id="c975" class="kk kl hi kg b fi kq kn l ko kp">max.in.flight.requests.per.connection={{ MaxInFlightRequests }}</span><span id="0443" class="kk kl hi kg b fi kq kn l ko kp">client.id={{ kafkaMirrorMakerClientId }}</span><span id="9e15" class="kk kl hi kg b fi kq kn l ko kp">acks={{ kafkaMirrorMakerAcks }}</span></pre><p id="2ecb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ›´æ–°M <a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/configure/templates/kafka-mirror-maker.sh" rel="noopener ugc nofollow" target="_blank"> irror-Maker-Start.sh </a></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="f6ae" class="kk kl hi kg b fi km kn l ko kp">export JMX_PORT={{ kafkaMirrorMakerJmxInitialPort + item }}<br/>export KAFKA_HEAP_OPTS="-Xmx{{ MakerHeapSize }} -Xms{{ HeapSize }}"<br/>export KAFKA_LOG4J_OPTS="-Dlog4j.configuration=file:log4j.properties"</span><span id="1862" class="kk kl hi kg b fi kq kn l ko kp">exec $(dirname $0)/kafka-run-class.sh kafka.tools.MirrorMaker "$@"</span></pre><p id="3c1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">æ‰‹åŠ¨å¯åŠ¨å¡å¤«å¡MM 1 </strong></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="5107" class="kk kl hi kg b fi km kn l ko kp">bin/kafka-mirror-maker.sh --consumer.config kafka-mirror-maker-consumer.properties --producer.config kafka-mirror-maker-producer.properties --whitelist '.*dc1' --abort.on.send.failure false</span></pre><p id="52f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸€æ—¦å¼€å§‹æ­£å¸¸å·¥ä½œï¼Œæˆ‘å°±å¼€å§‹è€ƒè™‘å¦‚ä½•æ‰©å±•MM1ï¼Œè¿™æ˜¯MM1çœŸæ­£å‡ºè‰²çš„åœ°æ–¹ï¼Œæˆ‘å¿…é¡»æ·»åŠ æ›´å¤šå…·æœ‰ç›¸åŒæ¶ˆè´¹è€…å’Œç”Ÿäº§è€…é…ç½®çš„MM1å®ä¾‹ï¼Œå› ä¸ºMM1åŸºäºKafkaæ¶ˆè´¹è€…å’Œç”Ÿäº§è€…ï¼Œè€ŒKafkaæ¶ˆè´¹è€…è¢«è®¾è®¡ä¸ºåœ¨é›†ç¾¤æ¨¡å¼ä¸‹å·¥ä½œã€‚</p><p id="7a47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦‚ä½•è¿è¡ŒMM1çš„å¤šä¸ªå®ä¾‹ï¼Ÿç°åœ¨æ˜¯æ–½å±•é­”æ³•çš„æ—¶å€™äº†ã€‚æˆ‘åˆ›å»ºäº†é…ç½®æ¨¡æ¿ï¼ŒAnsibleå°†ä¸ºæˆ‘ç”Ÿæˆé…ç½®ã€‚</p><p id="a8f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘å–äº†ä¸€ä¸ªåˆå§‹å˜é‡ï¼Œè¡¨ç¤ºæ¯ä¸ªå®ä¾‹åº”è¯¥è¿è¡Œå¤šå°‘MM1ï¼Ÿæˆ‘å¯ä»¥ä¸ºæ¯ä¸ªå®ä¾‹ä½¿ç”¨1ä¸ªï¼Œä½†è¿™æ˜¯ä¸€ç§éå¸¸ä½æ•ˆçš„æ–¹å¼ï¼Œå› æ­¤æˆ‘å¿…é¡»åœ¨æ¯ä¸ªå®ä¾‹ä¸Šç§»åŠ¨åˆ°å¤šä¸ªMM1å®ä¾‹ï¼Œç°åœ¨æˆ‘å¯ä»¥æœ‰3ä¸ªè™šæ‹Ÿæœºï¼Œä½†æˆ‘å¯ä»¥è¿è¡Œ6/9/12ä¸ªMM1å®ä¾‹ï¼Œå¹¶å¹³å‡åˆ†å¸ƒåœ¨æ‰€æœ‰3ä¸ªè™šæ‹Ÿæœºä¸Šã€‚</p><p id="2c7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">kafkamirormakerprocesscountpernode:2</p><p id="9bf3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/configure/tasks/mirrorMaker.yml" rel="noopener ugc nofollow" target="_blank">å¯æ‰§è¡Œä»»åŠ¡ä»£ç </a> <br/>æ‰€æœ‰å˜é‡å–è‡ª:<a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/inventory/development/group_vars/kafka-mirror-maker.yml" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">group _ vars/Kafka-mirror-maker . yml</strong></a></p><p id="2228" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨ï¼Œå½“æˆ‘ç”Ÿæˆåƒconsumer/producerè¿™æ ·çš„é…ç½®æ—¶ï¼Œå› ä¸ºå®ƒä»¬å¯¹äºMM1çš„æ‰€æœ‰å®ä¾‹éƒ½åº”è¯¥æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘éœ€è¦ä¸ºæ¯ä¸ªæœåŠ¡å™¨ç”Ÿæˆä¸€æ¬¡å®ƒä»¬ï¼Œå¹¶ä¸”MM1çš„æ‰€æœ‰å®ä¾‹éƒ½å°†ä½¿ç”¨å®ƒä»¬ã€‚</p><p id="36c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç”±äºæ—¥å¿—å’Œå¯åŠ¨è„šæœ¬çš„åŸå› ï¼Œæˆ‘å¿…é¡»ä¸ºæ¯ä¸ªMM1å®ä¾‹ç”Ÿæˆä¸¤ä¸ªä»¥ä¸Šçš„æ–‡ä»¶ã€‚</p><ul class=""><li id="acd3" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/configure/templates/tools-log4j.properties" rel="noopener ugc nofollow" target="_blank"> log4j.properties </a></li><li id="ce75" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/configure/templates/kafka-mirror-maker.sh" rel="noopener ugc nofollow" target="_blank"> mirror-maker-start.sh </a></li></ul><p id="a385" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨Ansibleæ‹¿ç€ä¸Šé¢çš„æ¨¡æ¿ï¼ŒåŸºäºâ€œkafkamirormakerprocesscountpernodeâ€ä¸ºæˆ‘ç”Ÿæˆä¸åŒçš„æ—¥å¿—å’Œå¯åŠ¨è„šæœ¬ã€‚</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="d993" class="kk kl hi kg b fi km kn l ko kp">- name: Creating kafka Mirror Maker configurations | properties files<br/>  template:<br/>    src: "tools-log4j.properties"<br/>    dest: "{{ kafkaInstallDir }}/kafka_{{ kafkaScalaVersion }}-{{ kafkaVersion }}/config/kafka-mirror-log4j-{{ item }}.properties"<br/>    owner: "{{ kafkaUser }}"<br/>    group: "{{ kafkaGroup }}"<br/>    mode: 0775<br/>  loop: "{{ range(1, kafkaMirrorMakerProcessCountPerNode + 1, 1) | list }}"</span><span id="8b95" class="kk kl hi kg b fi kq kn l ko kp">- name: Creating kafka Mirror Maker configurations | kafka-mirror-maker.sh<br/>  template:<br/>    src: kafka-mirror-maker.sh<br/>    dest: "{{ kafkaInstallDir }}/kafka_{{ kafkaScalaVersion }}-{{ kafkaVersion }}/bin/kafka-mirror-maker-{{ item }}.sh"<br/>    owner: "{{ kafkaUser }}"<br/>    group: "{{ kafkaGroup }}"<br/>    mode: 0775<br/>  loop: "{{ range(1, kafkaMirrorMakerProcessCountPerNode + 1, 1) | list }}"</span></pre><p id="7501" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">éœ€è¦ç”Ÿæˆçš„æœ€åä¸€ä¸ªæ–‡ä»¶æ˜¯SystemDæ–‡ä»¶ï¼Œå› æ­¤è¯¥æµç¨‹å¯ä»¥ç”±SystemDå¯åŠ¨å’Œç®¡ç†ï¼Œè€Œä¸æ˜¯ç”±<strong class="ih hj"> Nohup </strong>æˆ–<strong class="ih hj"> PM2 </strong>æˆ–å…¶ä»–æµç¨‹ç®¡ç†ç³»ç»Ÿå¯åŠ¨å’Œç®¡ç†ã€‚</p><p id="7842" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/service/templates/kafka-mirror-maker-service.j2" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> MM2 SystemDæ¨¡æ¿</strong> </a></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="8fdc" class="kk kl hi kg b fi km kn l ko kp">[Unit]<br/>Description=Apache Kafka Mirror Maker Process {{ item }}<br/>After=syslog.target network.target</span><span id="e715" class="kk kl hi kg b fi kq kn l ko kp">[Service]<br/>Type=simple<br/>User={{ kafkaUser }}<br/>Group={{ kafkaGroup }}</span><span id="899a" class="kk kl hi kg b fi kq kn l ko kp">ExecStart={{ kafkaInstallDir }}/kafka/bin/kafka-mirror-maker-{{ item }}.sh \<br/>--consumer.config {{ kafkaInstallDir }}/kafka/config/kafka-mirror-maker-consumer.properties \<br/>--producer.config {{ kafkaInstallDir }}/kafka/config/kafka-mirror-maker-producer.properties \<br/>--whitelist '{{ kafkaMirrorMakerReplicateTopicWhiteListPattern }}'\<br/>--abort.on.send.failure false</span><span id="6e66" class="kk kl hi kg b fi kq kn l ko kp">TimeoutStopSec=180<br/>Restart=no</span><span id="501d" class="kk kl hi kg b fi kq kn l ko kp">[Install]<br/>WantedBy=multi-user.target</span></pre><p id="0f5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ¯ä¸ªConfiguration + SystemDè¿›ç¨‹éƒ½é™„åŠ äº†è¿›ç¨‹å·ï¼Œè¿™æ ·ä»¥åæˆ‘å°±å¯ä»¥åŒºåˆ†å®ƒä»¬äº†ã€‚</p><p id="f319" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">æˆ‘ç›¸ä¿¡ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ä½ è¿˜æ²¡æœ‰æƒ³è¿‡è¦ç›‘æµ‹&amp;è®°å½•MM1ã€‚</strong></p><p id="e013" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">æ—¥å¿—è®°å½•ä¹Ÿéå¸¸ç®€å•ï¼Œ</strong>æ—¥å¿—æ˜¯åŸºäºæ¯ä¸ªè¿›ç¨‹å·åœ¨Kafka Log Dirä¸‹ç”Ÿæˆçš„ï¼Œå› æ­¤ç›¸åŒçš„Splunké…ç½®ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œã€‚</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="50bc" class="kk kl hi kg b fi km kn l ko kp">{{ kafkaLogDir }}/kafka-mirror-maker-1.log<br/>{{ kafkaLogDir }}/kafka-mirror-maker-2.log</span></pre><p id="3ad3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">ç›‘æ§<br/> </strong>è¿™å°±åƒæ—¥å¿—è®°å½•ä¸€æ ·ç®€å•ï¼Œå› ä¸ºç°åœ¨æˆ‘éœ€è¦äº†è§£æˆ‘éœ€è¦ç›‘æ§å“ªäº›æŒ‡æ ‡ï¼Œä»¥åŠä»å“ªé‡Œè·å–è¿™äº›æŒ‡æ ‡ã€‚è€å®è¯´ï¼Œæˆ‘å·²ç»çŸ¥é“æˆ‘è¦æ€ä¹ˆåšï¼Œè¿™æ˜¯åŸºäºJMXï¼Œå› ä¸ºMM1å·²ç»åœ¨åšï¼Œæˆ‘åªéœ€è¦ä¸€ä¸ªåˆ®åˆ€å’Œæ—¶é—´åºåˆ—æ•°æ®åº“(åˆåæ–°é—è¿¹)ã€‚æˆ‘æœ‰æ–°é—è¿¹ä¸å¡å¤«å¡çš„é›†æˆï¼Œæˆ‘åªéœ€è¦ä¸ºMM1æ‰©å±•å®ƒã€‚</p><p id="4133" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦‚æœä½ ä»”ç»†æ£€æŸ¥è¿‡æˆ‘ä¹‹å‰çš„æ¨¡æ¿ï¼Œä½ ä¼šåœ¨<a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/configure/templates/kafka-mirror-maker.sh" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">Kafka-mirror-maker . sh</strong></a>ä¸­çœ‹åˆ°æˆ‘è¿˜æ·»åŠ äº†å¦ä¸€ä¸ªå°é­”æœ¯ï¼Œä¸ºæ¯ä¸ªMM1å®ä¾‹åŠ¨æ€ç”ŸæˆJMXç«¯å£ã€‚</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="aade" class="kk kl hi kg b fi km kn l ko kp"><strong class="kg hj">kafkaMirrorMakerJmxInitialPort</strong>: 9980</span></pre><p id="4e7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨ï¼Œæ¯å½“æˆ‘ç”Ÿæˆ<a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/configure/templates/kafka-mirror-maker.sh" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">Kafka-mirror-maker . sh</strong></a><strong class="ih hj">ï¼Œ</strong>æ—¶ï¼Œæˆ‘åœ¨æ¨¡æ¿ä¸­åšå¦‚ä¸‹æ“ä½œ</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="4ae8" class="kk kl hi kg b fi km kn l ko kp">export JMX_PORT={{ kafkaMirrorMakerJmxInitialPort + item }}</span></pre><p id="19f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸Šé¢çš„ä»£ç /æ¨¡æ¿å°†ä¸ºæ¯ä¸ªMM1å®ä¾‹ç”Ÿæˆstart.shï¼Œå¹¶ä¸”æ¯ä¸ªå®ä¾‹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„JMXç«¯å£ã€‚</p><p id="6a2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç”±äºæˆ‘ç†Ÿæ‚‰æ–°çš„é—è¿¹JMXé›†æˆï¼Œæˆ‘åªéœ€è¦ä¸ºå®ƒç”Ÿæˆé…ç½®ã€‚</p><p id="c0e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">é‡è¦æç¤º:</strong>Kafkaå’ŒMM1çš„ç›‘æ§ä¸èƒ½å®‰è£…åœ¨åŒä¸€å°è™šæ‹Ÿæœºä¸Šï¼Œè¿™æ„å‘³ç€æ‚¨ä¸åº”è¯¥åœ¨åŒä¸€å°æœºå™¨ä¸Šå®‰è£…Kafkaå’ŒMM1ã€‚</p><p id="433f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/nri-kafka/templates/kafka-mirror-maker-jmx-config.yml" rel="noopener ugc nofollow" target="_blank">æ–°é—è¿¹JMXé…ç½®æ¨¡æ¿</a></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="4aff" class="kk kl hi kg b fi km kn l ko kp">integration_name: com.newrelic.jmx</span><span id="4d49" class="kk kl hi kg b fi kq kn l ko kp">instances:<br/>{% for processCount in range(kafkaMirrorMakerProcessCountPerNode) %}</span><span id="9744" class="kk kl hi kg b fi kq kn l ko kp">- name: jmx<br/>    command: all_data<br/>    arguments:<br/>      jmx_host: {{ ansible_fqdn }}<br/>      jmx_port: {{ kafkaMirrorMakerJmxInitialPort + processCount + 1 }}<br/>      collection_files: "/etc/newrelic-infra/integrations.d/kafka-mirror-maker-jvm-metrics.yml,/etc/newrelic-infra/integrations.d/kafka-mirror-maker-metrics.yml"<br/>      metric_limit: 0<br/>    labels:<br/>      env: {{ kafkaClusterName }}<br/>      mirrorMakerProcessName: kafka-mirror-maker-{{ processCount + 1 }}<br/>{% endfor %}</span></pre><p id="7eba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/nri-kafka/templates/kafka-mirror-maker-jvm-metrics.yml" rel="noopener ugc nofollow" target="_blank"> JVMåº¦é‡æ¨¡æ¿</a></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="c2bd" class="kk kl hi kg b fi km kn l ko kp">collect:<br/># Standard JVM Metrics<br/>    - domain: java.lang<br/>      event_type: kafkaMirrorMakerMonitoring<br/>      beans:<br/>          - query: type=GarbageCollector,name=*<br/>            attributes:<br/>                - CollectionCount<br/>                - CollectionTime<br/>          - query: type=Memory<br/>            attributes:<br/>                - HeapMemoryUsage.Max<br/>                - HeapMemoryUsage.Used<br/>                - NonHeapMemoryUsage.Used<br/>          - query: type=Threading<br/>            attributes:<br/>                - ThreadCount<br/>                - PeakThreadCount<br/>          - query: type=ClassLoading<br/>            attributes:<br/>                - LoadedClassCount</span></pre><p id="bbd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/nri-kafka/templates/kafka-mirror-maker-metrics.yml" rel="noopener ugc nofollow" target="_blank"> MM1å…¬åˆ¶æ¨¡æ¿</a></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="70de" class="kk kl hi kg b fi km kn l ko kp">collect:</span><span id="dc04" class="kk kl hi kg b fi kq kn l ko kp">- domain: kafka.consumer<br/>      event_type: kafkaMirrorMakerMonitoring<br/>      beans:<br/>          - query: type=consumer-coordinator-metrics,client-id=*<br/>          - query: type=consumer-fetch-manager-metrics,client-id=*<br/>          - query: type=consumer-fetch-manager-metrics,client-id=*,topic=*,partition=*<br/>          - query: type=consumer-metrics,client-id=*</span><span id="a7ce" class="kk kl hi kg b fi kq kn l ko kp">- domain: kafka.producer<br/>      event_type: kafkaMirrorMakerMonitoring<br/>      beans:<br/>          - query: type=producer-metrics,client-id=*<br/>          - query: type=producer-node-metrics,client-id=*,node-id=*</span><span id="abf0" class="kk kl hi kg b fi kq kn l ko kp">- domain: kafka.tools<br/>      event_type: kafkaMirrorMakerMonitoring<br/>      beans:<br/>          - query: type=MirrorMaker,name=MirrorMaker-numDroppedMessages</span></pre><p id="1857" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">å…³äºæ–°é—è¿¹æ¨¡æ¿éœ€è¦çŸ¥é“çš„å‡ ä»¶äº‹</strong></p><ul class=""><li id="a04d" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">æˆ‘å°†æŒ‡æ ‡æ”¾å…¥æ–°çš„insightsæ•°æ®åº“â€œ<strong class="ih hj">kafkaMirrorMakerMonitoring</strong>â€ä¸­ï¼Œè€Œä¸æ˜¯â€œ<strong class="ih hj"> kafkaMonitoring </strong>â€ä¸­ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥åˆ†å¼€äº†ã€‚</li><li id="a6b1" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">å¦‚æœä½ è®°å¾—MM1æ˜¯åŸºäºKafkaæ¶ˆè´¹è€…å’Œç”Ÿäº§è€…çš„ï¼Œè¿™æ„å‘³ç€å®ƒå°†å¯¼å‡ºä»–ä»¬çš„æ‰€æœ‰æŒ‡æ ‡ï¼Œä½ å¯ä»¥åœ¨æ±‡åˆé¡µé¢ä¸Šæ‰¾åˆ°:ã€https://docs.confluent.io/current/kafka/monitoring.html<a class="ae jp" href="https://docs.confluent.io/current/kafka/monitoring.html" rel="noopener ugc nofollow" target="_blank"/></li><li id="457d" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">å¦‚æœæ‚¨æ‰¾ä¸åˆ°MM1æŒ‡æ ‡çš„æ–‡æ¡£ï¼Œé‚£ä¹ˆä½¿ç”¨<strong class="ih hj"> Jconsole </strong>è¿›è¡Œæ¢ç´¢ã€‚</li><li id="bee8" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">ä½¿ç”¨æ ‡ç­¾åŒºåˆ†<a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/nri-kafka/templates/kafka-mirror-maker-jmx-config.yml" rel="noopener ugc nofollow" target="_blank">æ–°é—è¿¹JMXé…ç½®æ¨¡æ¿</a>ä¸­çš„æµç¨‹ã€‚</li></ul><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="f339" class="kk kl hi kg b fi km kn l ko kp">labels:<br/>   env: {{ kafkaClusterName }}<br/>   mirrorMakerProcessName: kafka-mirror-maker-{{ processCount + 1 }}</span></pre><p id="a27b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/clusterNewRelicSetup.yml" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">clusternewrelicsetup . yml</strong></a><strong class="ih hj">:</strong>æ‰©å±•ç”¨äºMM1æ–°é—è¿¹è®¾ç½®ã€‚<br/>å¦‚æœä½ è¿˜è®°å¾—çš„è¯ï¼Œæˆ‘æåˆ°è¿‡New Relic Insightsè¢«å¼ƒç”¨ï¼Œæ‰€ä»¥å¼€å§‹åœ¨<strong class="ih hj"> New Relic One </strong>ä¸­åˆ›å»ºä¸€ä¸ªä»ªè¡¨æ¿ã€‚</p><p id="1600" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">æ‰‹åŠ¨æ­¥éª¤ğŸ˜ <br/> </strong>åˆ›é€ æ–°çš„é—è¿¹ä¸€ä»ªè¡¨æ¿ã€‚</p><p id="3d66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="kr">éœ€è¦è®°ä½çš„å‡ ä»¶äº‹æ˜¯ï¼ŒNew Relic Infra Agentå°†æŒ‡æ ‡å‘å¸ƒåˆ°New Relic Insightsä¸­çš„å¦ä¸€ä¸ªæ•°æ®åº“ã€‚</em> </strong> <br/> <strong class="ih hj">ç³»ç»Ÿç¤ºä¾‹:</strong>ç”¨äºå­˜å‚¨CPUæŒ‡æ ‡ã€‚<br/> <strong class="ih hj"> StorageSample: </strong>ç”¨äºå­˜å‚¨ç£ç›˜è§„æ ¼ã€‚<br/> <strong class="ih hj">ç½‘ç»œç¤ºä¾‹:</strong>ç”¨äºå­˜å‚¨ç½‘ç»œåº¦é‡ã€‚<br/><strong class="ih hj">kafkamirormakermonitoring:</strong>ç”¨äºå­˜å‚¨å®é™…çš„Kafka MM1æŒ‡æ ‡ã€‚</p><p id="568c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä½¿ç”¨<a class="ae jp" href="https://docs.newrelic.com/docs/apis/rest-api-v2/api-explorer-v2/use-api-explorer" rel="noopener ugc nofollow" target="_blank"> New Relic API Explorer </a>å¯¼å…¥ä¸‹é¢çš„dashboard JSONä»£ç ã€‚<br/> <strong class="ih hj">æ–°é—ç‰©ä»ªè¡¨ç›˜ä»£ç :</strong><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/files/newrelic-dashboards/kafka-mirror-maker-v1.json" rel="noopener ugc nofollow" target="_blank">Kafka-Mirror-maker-v1 . JSON</a><br/><strong class="ih hj">æ–°é—ç‰©ä»ªè¡¨ç›˜ç¤ºä¾‹:</strong> <a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/files/newrelic-dashboards/Apache%20Kafka%20Mirror%20Maker.pdf" rel="noopener ugc nofollow" target="_blank">é˜¿å¸•å¥‡å¡å¤«å¡é•œMaker.pdf</a></p></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><p id="6a81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ—…ç¨‹å°†åœ¨ä¸‹ä¸€ä¸ªè¯é¢˜ç»§ç»­ï¼</p></div></div>    
</body>
</html>