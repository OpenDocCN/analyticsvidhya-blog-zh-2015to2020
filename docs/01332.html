<html>
<head>
<title>Predicting annual US income using the “Adult-income” data set, and analyzing model interpretability using ELI5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用“成人收入”数据集预测美国年收入，并使用ELI5分析模型的可解释性</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/predicting-annual-us-income-using-the-adult-income-data-set-and-analyzing-model-e393cf7395a5?source=collection_archive---------9-----------------------#2019-10-15">https://medium.com/analytics-vidhya/predicting-annual-us-income-using-the-adult-income-data-set-and-analyzing-model-e393cf7395a5?source=collection_archive---------9-----------------------#2019-10-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/72026ce090cadcd2a144adaf7dda2968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9LdX9R6hT67KTmQ5"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae iu" href="https://unsplash.com/@neonbrand?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> NeONBRAND </a>拍摄的照片</figcaption></figure><p id="fa3c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一个人的年收入可能会受到各方面的影响，如年龄、教育程度、职业、每周工作时间、性别以及许多其他特征。“成人收入”数据集提供了一组包括这些特征的数据，并告诉我们这个人的年收入是大于5万美元(&gt; 5万美元)还是小于5万美元(≤5万美元)。</p><p id="9d07" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以在下面看到这个数据集的样子。然后给出数据集中出现的列的描述。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jt"><img src="../Images/67a1fbec4c0b830cb9e00806bf71067f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u7f3_movo-cB5j0Dl2WVJg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图一。“成人传入”数据集的前10行</figcaption></figure><ul class=""><li id="e463" class="jy jz hi ix b iy iz jc jd jg ka jk kb jo kc js kd ke kf kg bi translated"><strong class="ix hj">年龄</strong>:人的年龄。[连续]</li><li id="485b" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj">工作类别</strong>:工作类型。(联邦、州、私人……)[分类]</li><li id="df5f" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj"> fnlwgt: </strong> <em class="km">我没有找到任何关于这个的描述:(</em> <strong class="ix hj"> </strong>【绵】</li><li id="6eab" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj">教育:</strong>个人所获得的教育水平。(学士、12级、博士……)[分类]</li><li id="76db" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj"> education_num: </strong>教育程度的数值表示。[连续]</li><li id="2a60" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj">婚姻状况:</strong>玛丽塔格的状况。(已婚、离异、未婚……)[分类]</li><li id="4c19" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated">职业:这个人在工作中扮演的角色。(高级管理人员、销售人员、工艺维修人员……)[分类]</li><li id="95ad" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated">关系:人们在家庭关系中扮演的角色。(妻子、丈夫、自己的孩子……)[分类]</li><li id="5547" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj">人种:</strong>人的种族。(黑人、白人、亚洲人……)[分类]</li><li id="bd43" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj">性别:</strong>人的生物性别。[分类]</li><li id="1853" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj">资本_收益:</strong>个人的资本收益[连续]</li><li id="4243" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj">资本_损失:</strong>个人的资本损失[连续]</li><li id="6e74" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj">每周工作小时数:</strong>周末工作的总小时数。</li><li id="d990" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj"> native_country: </strong>人的出生国。[分类]</li><li id="587a" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj">高收入:</strong>&gt;【5万美元或≤5万美元【分类】</li></ul><p id="7d63" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="km">你可以在以下来源找到这个数据集:</em><a class="ae iu" href="http://www.cs.toronto.edu/~delve/data/adult/desc.html" rel="noopener ugc nofollow" target="_blank"><em class="km">http://www.cs.toronto.edu/~delve/data/adult/desc.html</em></a></p><p id="581f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这篇文章中，我们将使用决策树、随机森林和决策树模型的集合来预测这个人的收入是高于还是低于5万美元。我们将通过使用scikit-learn提供的管道模块以及RandomForestClassifier和DecisionTreeClassifier模块来实现这一点。为了进行决策树的集成，我们将使用sklearn提供的BaggingClassifer模块。我们将使用网格搜索来为我们的预测找到最佳设置，并比较在此模型调整的每个步骤中获得的结果。</p><p id="c292" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了进行我们的测试和评估，这个数据集的所有特征都被转换成数字特征。因此，以下所有结果都是用转换后的数据集获得的。</p><p id="5ac3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将从执行从分类到数字的特征转换的流水线开始，使用Select K best选择特征，以及使用模型决策树和随机森林的分类问题。</p><p id="3987" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用网格搜索cv，我们将把估计器定义为一个决策树、一个随机森林和一个BaggingClassifier来做一个决策树的集合。</p><p id="4bab" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个网格中使用的一组超参数可以在图3中看到</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kn"><img src="../Images/181c9eb7dc94be5fb51358bd60409c4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*cV48W9yMbSTH9VGyDgt8NQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">图2初始管道结构。</figcaption></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es ko"><img src="../Images/523e180e6d6e0edbbcd6e83d91b2c6fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*CqTgNfuU05SHp92T2jIuWA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">图三。定义的搜索空间</figcaption></figure><p id="554c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个例子中，我们还将改变BaggingClassifier模型的<strong class="ix hj"> <em class="km"> oob_score </em> </strong>和<strong class="ix hj"> <em class="km"> bootstrap </em> </strong>超参数。因此，我们也可以使用<strong class="ix hj"> <em class="km">开箱样品</em> </strong>来测试我们的模型，这些样品在我们的培训中没有使用过。</p><p id="155e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为此，我们必须将<strong class="ix hj"> <em class="km"> oob_score </em> </strong>和<strong class="ix hj"> <em class="km"> bootstrap </em> </strong>设置为True。为了探索更多的可能性，我们还将验证我们的模型是否在不使用<em class="km">开箱</em>样本的情况下表现更好，在这种情况下，我们必须将<strong class="ix hj"> <em class="km"> oob_score </em> </strong>和<strong class="ix hj"> <em class="km"> bootstrap </em> </strong>设置为False。</p><h2 id="16cf" class="kp kq hi bd kr ks kt ku kv kw kx ky kz jg la lb lc jk ld le lf jo lg lh li lj bi translated">找到最佳模型</h2><p id="a95f" class="pw-post-body-paragraph iv iw hi ix b iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo lo jq jr js hb bi translated">在运行网格搜索<em class="km">拟合方法后，</em>选择的最佳模型是随机森林。模型的超参数如下表所示。</p><p id="8df7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">估计器</strong>:随机森林分类器</p><ul class=""><li id="cc60" class="jy jz hi ix b iy iz jc jd jg ka jk kb jo kc js kd ke kf kg bi translated"><strong class="ix hj">判据</strong>:熵</li><li id="e34f" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj">n _ estimates</strong>:400</li><li id="8302" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj">最大_叶节点数</strong> : 16</li><li id="b997" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj">最大_深度</strong> : 16</li><li id="89c4" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj">敏样叶</strong> : 1</li><li id="353d" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj">最小样本分割</strong> : 2</li><li id="a6c5" class="jy jz hi ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated"><strong class="ix hj"> fs_k: 14 </strong></li></ul><p id="1530" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们的例子中，模型在测试数据集中的精确度大约是85.27%。分类报告如图4所示。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es lp"><img src="../Images/81469d61c449a1f338a1f5d7e822df39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*bW7r9bZGXZWLlU4a7hu7gA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">图4。模型预测的分类报告</figcaption></figure><p id="26b2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">模型解释</strong></p><p id="e567" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了进行模型解释，我们将使用ELI5。</p><blockquote class="lq lr ls"><p id="179f" class="iv iw km ix b iy iz ja jb jc jd je jf lt jh ji jj lu jl jm jn lv jp jq jr js hb bi translated">ELI5是一个python包，用于调试机器学习分类器和解释预测。</p></blockquote><p id="8b04" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将首先使用我们通过使用网格搜索实现的模型中的功能<strong class="ix hj"><em class="km">【show _ weights】</em></strong>。因此，我们可以看到随机森林模型的特征重要性的美化版本。</p><p id="3019" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后我们将使用我们的模型和eli5进行排列重要性，这样我们就可以看到每个特征在预测中的贡献。<strong class="ix hj"> <em class="km">排列重要性</em> </strong>方法一次打乱一个特征，然后拟合和预测模型以查看其准确性是否受到损害，它通过计算原始模型和特征被打乱的模型之间的准确性差异来计算该度量。</p><p id="748e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对所有特征重复该过程。预测准确度的差异越大，特征越重要。</p><p id="cab2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">图4和图5分别显示了模型的特征重要性和排列重要性。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es lw"><img src="../Images/3c0e4eaaf18ae626952a4f6db9586d20.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*ciIHGCNlSIHlgb4WXnw5oQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">图五。随机森林模型的特征重要性</figcaption></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es lx"><img src="../Images/8f3ea9989ce03a38ef8a3fca97129054.png" data-original-src="https://miro.medium.com/v2/resize:fit:562/format:webp/1*izBENy6441AdWrdESNSOmw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">图六。用排列重要性法确定特征的重要性</figcaption></figure><p id="c535" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> <em class="km"> ELI5的文档参考</em> </strong></p><p id="aebe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://eli5.readthedocs.io/en/latest/overview.html" rel="noopener ugc nofollow" target="_blank"><em class="km">https://eli5.readthedocs.io/en/latest/overview.html</em></a></p></div></div>    
</body>
</html>