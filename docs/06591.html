<html>
<head>
<title>Automate Seasonality Plots With Plotly and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Plotly和Python自动绘制季节性图</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/automate-seasonality-plots-with-plotly-and-python-23e7fef065a2?source=collection_archive---------6-----------------------#2020-05-27">https://medium.com/analytics-vidhya/automate-seasonality-plots-with-plotly-and-python-23e7fef065a2?source=collection_archive---------6-----------------------#2020-05-27</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><figure class="ew ey ih ii ij ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et ig"><img src="../Images/725e588529ef5beb79264a7c096acb53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mbZ4d3IzTmi46SzfihlJqw.jpeg"/></div></div><figcaption class="ir is eu es et it iu bd b be z dy translated">不溅</figcaption></figure><p id="eaf6" class="pw-post-body-paragraph iv iw hj ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hc bi translated">这是我上一篇文章的延续。在那篇文章中，我将向你展示如何从美国能源信息署(EIA)的API中提取能源数据。这篇文章将向你展示如何利用API来创建可以快速刷新的季节性图表。</p><p id="0b32" class="pw-post-body-paragraph iv iw hj ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hc bi translated">作为一名分析师，我花了太多时间重新制作图表，几乎没有时间做分析。通过用Python自动化我的所有图表，我在一天中创造了更多的时间来进行分析和需要更深入思考的项目。我希望这段代码能帮助你实现图表自动化，让你的一天变得自由。</p><h1 id="9667" class="ju jv hj bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">什么是季节性？</h1><p id="23ad" class="pw-post-body-paragraph iv iw hj ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hc bi translated">季节性是时间序列数据中出现的重复模式或变化。这些模式可以在任何时间间隔内出现—每小时、每天、每月、每年等等。例如，美国的汽油需求在夏季会上升，因为人们会在暑假自驾游。因此，能源公司知道，与其他季节相比，他们必须在夏季向美国供应更多的汽油。这些信息对于商业计划是必要的。天气是季节性的另一个典型例子——夏天较热，冬天较冷。飓风季节发生在每年的六月到十一月。</p></div><div class="ab cl kx ky gq kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="hc hd he hf hg"><h1 id="a3b4" class="ju jv hj bd jw jx le jz ka kb lf kd ke kf lg kh ki kj lh kl km kn li kp kq kr bi translated">什么是季节性图表？</h1><p id="21fd" class="pw-post-body-paragraph iv iw hj ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hc bi translated">季节性图表有助于阐明时间序列数据中的季节性模式。下图是季节性图表的一个例子。它显示了美国墨西哥湾沿岸的炼油厂原油需求(PADD 3)。横过x轴是月份。y轴显示原油需求，单位为千桶/天(kbd)。每条线代表不同的年份。黑色虚线是5年平均值(2015-2019年的平均数据)。灰色阴影区域是2015年至2019年的所有数据范围。我从平均值和范围中排除了2020年的数据，因为我想将2020年的数据与历史进行比较。</p><p id="0b5d" class="pw-post-body-paragraph iv iw hj ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hc bi translated"><em class="lj">参考消息——PADDs代表石油管理防御区，是50个州的地理集合。它们是在第二次世界大战中为定量供应汽油而创建的。</em></p><figure class="ll lm ln lo fe ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et lk"><img src="../Images/48ccc7842c4315ca48f8fe9ad90fb924.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H2ZatA0vj0UPgwTmWRfb7Q.jpeg"/></div></div><figcaption class="ir is eu es et it iu bd b be z dy translated">炼油商对PADD 3号(美国墨西哥湾沿岸)原油的需求</figcaption></figure></div><div class="ab cl kx ky gq kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="hc hd he hf hg"><h1 id="4a2c" class="ju jv hj bd jw jx le jz ka kb lf kd ke kf lg kh ki kj lh kl km kn li kp kq kr bi translated">分析季节性图表</h1><p id="e2f7" class="pw-post-body-paragraph iv iw hj ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hc bi translated">我们现在可以用这张季节性图表快速分析事物。2020年红线显示当年需求和2018年差不多。绿色和橙色的线看起来像异常值；我们应该多调查那几年。这个范围有助于我们理解墨西哥湾沿岸炼油系统的局限性；在任何一个月里，它的平均消耗量都不会超过940万桶。</p><ol class=""><li id="eb75" class="lp lq hj ix b iy iz jc jd jg lr jk ls jo lt js lu lv lw lx bi translated"><strong class="ix hk"> 5年平均</strong>——这表明美国原油需求在夏季平均上升，秋季开学时下降，年底时再次上升。2月和10月的两次下跌与炼油厂的常规维修时间相吻合。</li><li id="1f4d" class="lp lq hj ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated"><strong class="ix hk">范围</strong> —该范围告诉我们，在峰值时，美国墨西哥湾沿岸消耗约930万桶原油。最低时，墨西哥湾沿岸的炼油厂一个月消耗不到750万桶石油。</li><li id="936f" class="lp lq hj ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated"><strong class="ix hk">异常值</strong>——当我们看这个图表时，立刻有两条线突出出来——绿线和橙线。这些线条也恰好分别创造了区间的顶部和底部。是什么导致了2017年如此剧烈的下跌(橙线)？为什么2018年原油运行没有像往常一样在秋季下降？2017年，飓风哈维袭击了墨西哥湾沿岸，淹没了主要的炼油区——休斯顿、博蒙特/亚瑟港、科珀斯克里斯蒂，并进入路易斯安那州。随着该地区的恢复，许多炼油厂停止运营数周。2018年，墨西哥和中南美洲其他地区对清洁产品的需求很高。这有助于维持2018年整个冬季的高原油价格。</li><li id="1724" class="lp lq hj ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated"><strong class="ix hk">将2020年与其他年份进行比较— </strong>到目前为止，2020年的需求与2018年相似。然而，随着当前冠状病毒形势和油价在几周前跌至负值，我预计3月和4月数据中原油需求将下降。一旦数据公布，我将拭目以待！这个数据在每个月底出来，滞后两个月。5/29/20，将发布2020年3月的数据。</li></ol></div><div class="ab cl kx ky gq kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="hc hd he hf hg"><h1 id="9d01" class="ju jv hj bd jw jx le jz ka kb lf kd ke kf lg kh ki kj lh kl km kn li kp kq kr bi translated">用Plotly创建季节性图表</h1><p id="3300" class="pw-post-body-paragraph iv iw hj ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hc bi translated">为什么是Plotly？Plotly非常适合可视化，因为您可以与图形进行交互。下面的两个图表显示了不同的悬停能力。左图显示了一个简单的悬停功能——悬停在任何一个数据点上，它会立即显示月、年和原油需求。在右侧图表中，如果您将鼠标悬停在某个数据点上，该月的所有其他数据点也会弹出。现在，您可以立即看到2019年9月与5年平均值、最大值和最小值的对比。</p><div class="ll lm ln lo fe ab cb"><figure class="md ik me mf mg mh mi paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><img src="../Images/a97038992cceaa89289ea83c02d196c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*H2ZatA0vj0UPgwTmWRfb7Q.jpeg"/></div></figure><figure class="md ik mj mf mg mh mi paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><img src="../Images/a2e4e97d51386d1043cd30d90e4354b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*ZzJl4P7jnfd-7dZjl1F9sA.jpeg"/></div><figcaption class="ir is eu es et it iu bd b be z dy mk di ml mm translated">用Plotly创建的原油需求季节性图表</figcaption></figure></div><p id="dac2" class="pw-post-body-paragraph iv iw hj ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hc bi translated">好了，现在来看实际代码。你也可以<a class="ae jt" href="https://github.com/shuzlee/Crude_Seasonality/blob/master/EIA%20API%20Pull%20Plotly%20Seasonality.ipynb" rel="noopener ugc nofollow" target="_blank">在我的GitHub </a>获取代码。请参考<a class="ae jt" rel="noopener" href="/analytics-vidhya/use-python-to-pull-energy-data-from-the-us-department-of-energys-api-11d6f724927e">我以前的文章</a>中从EIA的API中提取数据的代码。</p><p id="1817" class="pw-post-body-paragraph iv iw hj ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hc bi translated">从API中提取数据后，按月份和年份透视数据。然后制作最大值、最小值和5年平均值列。这将返回如下表所示的数据框。从这里，你可以创建一个季节性图表。</p><figure class="ll lm ln lo fe ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et mn"><img src="../Images/79029eba1cc1318ba1a53c12e4fe8ee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h5UfuGcGUxPuA2JocwzA-Q.png"/></div></div><figcaption class="ir is eu es et it iu bd b be z dy translated">PADD 1原油需求数据透视表(kbd)</figcaption></figure><p id="f545" class="pw-post-body-paragraph iv iw hj ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hc bi translated">下面的代码创建了上面的表。在所有其他PADDs的代码中重复。每个PADD和总计都有不同的数据透视表。</p><figure class="ll lm ln lo fe ik"><div class="bz dz l di"><div class="mo mp l"/></div><figcaption class="ir is eu es et it iu bd b be z dy translated">数据透视表代码</figcaption></figure></div><div class="ab cl kx ky gq kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="hc hd he hf hg"><p id="e246" class="pw-post-body-paragraph iv iw hj ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hc bi translated">下面是在Plotly中创建图形的代码。此代码显示了绘制2015–2020年所有年份的方法。要查看仅显示2020年和2019年的代码，请查看我的GitHub上的完整代码。</p><figure class="ll lm ln lo fe ik"><div class="bz dz l di"><div class="mo mp l"/></div></figure><p id="bd04" class="pw-post-body-paragraph iv iw hj ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hc bi translated">任何时候新的数据出来，重新运行代码，你所有的图表都会更新！每月EIA数据在每个月底发布。</p><div class="ll lm ln lo fe ab cb"><figure class="md ik mq mf mg mh mi paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><img src="../Images/d20c40782d81dedc03ec0381080d75c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*9x4OTKtLMaUy8dlqP20CJQ.png"/></div></figure><figure class="md ik mq mf mg mh mi paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><img src="../Images/7f0fc659727a593d45b20c185c73c240.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*t7pTd7_Z3kw2ly9rJRZbbQ.png"/></div></figure></div><div class="ab cb"><figure class="md ik mq mf mg mh mi paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><img src="../Images/fc5e9ff8b510d7df21d5ef5ca781e16f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*WFsN-f-iL7kFc4WekQm7aA.png"/></div></figure><figure class="md ik mq mf mg mh mi paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><img src="../Images/b5376eccdfef435fd65d2a220848fcf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*efZauiaQgrcEz1W7LvZkRA.png"/></div></figure></div><div class="ab cb"><figure class="md ik mq mf mg mh mi paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><img src="../Images/da615bdff7cff6b1277455f883d21067.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*maanRB8ZhzmJNVZzG2UV-A.png"/></div></figure><figure class="md ik mq mf mg mh mi paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><img src="../Images/a67fff596f95dcec88149dc04040431a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*VMRl-W-mCr27-QxRSSc3_A.png"/></div></figure></div></div><div class="ab cl kx ky gq kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="hc hd he hf hg"><h1 id="ff3a" class="ju jv hj bd jw jx le jz ka kb lf kd ke kf lg kh ki kj lh kl km kn li kp kq kr bi translated">Github链接和参考</h1><p id="6cde" class="pw-post-body-paragraph iv iw hj ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hc bi translated">Github链接:<a class="ae jt" href="https://github.com/shuzlee/Crude_Seasonality/blob/master/EIA%20API%20Pull%20Plotly%20Seasonality.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/shuzlee/Crude _季节性/blob/master/EIA % 20 API % 20 pull % 20 plot ly % 20季节性. ipynb </a></p><p id="f7b0" class="pw-post-body-paragraph iv iw hj ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hc bi translated">参考资料:</p><pre class="ll lm ln lo fe mr ms mt mu aw mv bi"><span id="78be" class="mw jv hj ms b fj mx my l mz na"><em class="lj"># COLOR LIST: https://community.plotly.com/t/plotly-colours-list/11730/3</em><br/><em class="lj"># FILL IN AREA: https://plotly.com/python/filled-area-plots/</em><br/><em class="lj"># LINE CHARTS: https://plotly.com/python/line-charts/</em><br/><em class="lj"># PIVOT TABLES: https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.pivot_table.html</em></span></pre></div></div>    
</body>
</html>