<html>
<head>
<title>How to Build your First Real-Time Streaming(CDC) system(Setup-Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建您的第一个实时流(CDC)系统(设置-第2部分)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-build-your-first-real-time-streaming-cdc-system-setup-part-2-bac2c5397d5e?source=collection_archive---------5-----------------------#2020-03-11">https://medium.com/analytics-vidhya/how-to-build-your-first-real-time-streaming-cdc-system-setup-part-2-bac2c5397d5e?source=collection_archive---------5-----------------------#2020-03-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ee81b509edf96ec4f513ec242d54900f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pks0EWh77kC6y0_wmYR3Rg.jpeg"/></div></div></figure><p id="05dd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在此概念证明的第<a class="ae jo" rel="noopener" href="/@rohan.mudaliar/how-to-build-your-first-real-time-streaming-cdc-system-introduction-part-1-5d61b2d9d511">篇第1 </a>中，我们看了我们正在看的问题陈述、关键概念和我们用来解决问题的技术堆栈。让我们快速回顾一下。</p><p id="1a78" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注:</strong>如果您需要更好地了解整个问题，请阅读文章的第一部分，它包含了关于上述细节的详细信息。</p><h1 id="003e" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">问题陈述摘要</h1><p id="1b1e" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我们有一家电子商务公司，该公司的业务团队需要包含一些实时更新的报告来做出决策。我们的后端是用java构建的，它使用微服务。架构如下所示:</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/f5b28ece65d30961008ba13820e9d1fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dOIenWSvxFLCI-Iv0OoOGA.jpeg"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">系统图</figcaption></figure><p id="2c2e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">业务团队希望使用这些数据构建一个仪表板，并利用它做出一些营销决策。所有这些数据都存在于3个不同的数据库中，分别用于我们需要获取信息的3个不同的系统。我们决定采用以下技术:</p><h1 id="8ab5" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">技术堆栈:</h1><p id="89db" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我们决定将以下技术用于该项目:-</p><ul class=""><li id="7dea" class="lb lc hi is b it iu ix iy jb ld jf le jj lf jn lg lh li lj bi translated">Mysql 8.0.18</li><li id="7093" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">阿帕奇卡夫卡连接</li><li id="e78f" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">阿帕奇卡夫卡</li><li id="873a" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">阿帕奇卡夫卡溪流</li><li id="ea4d" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">弹性搜索。</li><li id="283c" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">码头工人</li><li id="bab0" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">Swagger UI</li><li id="25f3" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">邮递员</li></ul><h1 id="e572" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">总体技术任务:</h1><p id="b6c9" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">就总体技术任务而言，我们的任务如下</p><ol class=""><li id="01a9" class="lb lc hi is b it iu ix iy jb ld jf le jj lf jn lp lh li lj bi translated">使用docker设置本地基础设施。</li><li id="b3f9" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lp lh li lj bi translated">使用Kafka connect将数据从MySQL数据库摄取到Kafka。</li><li id="285b" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lp lh li lj bi translated">在Java后端使用Kafka流读取数据。</li><li id="a8b3" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lp lh li lj bi translated">为聚集视图创建弹性搜索索引。</li><li id="8847" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lp lh li lj bi translated">实时收听事件并更新事件。</li><li id="ae8f" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lp lh li lj bi translated">设置本地并运行java代码</li></ol><p id="5765" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注意:</strong>本文假设用户已经在他们的系统上安装了MySQL、docker和其他基本组件，并且只涵盖了这个项目的设置。需要注意的一点是，我使用的是mac系统，windows系统的设置可能略有不同。有关安装docker和MySQL的详细步骤，请参考以下链接:-</p><ul class=""><li id="ef3b" class="lb lc hi is b it iu ix iy jb ld jf le jj lf jn lg lh li lj bi translated"><a class="ae jo" href="https://www.toolsqa.com/sql/how-to-install-mysql-server/" rel="noopener ugc nofollow" target="_blank">安装MySql </a></li><li id="9cc8" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated"><a class="ae jo" href="https://docs.docker.com/install/" rel="noopener ugc nofollow" target="_blank">安装对接器</a></li></ul><h1 id="6691" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">1.使用docker设置本地基础设施。</h1><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/f41d03d5ba0b4c15f637317a86edcf04.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/1*ZPDP4ihFuVZNoTQkzwoUNw.png"/></div></figure><p id="1fc8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于不知道docker是什么的读者来说，“Docker是一个用于开发、发布和运行应用程序的开源平台。Docker使您能够将应用程序从基础架构中分离出来，以便快速交付软件。”如需更多信息，请查看</p><p id="43f5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，我使用docker在我的本地创建以下图像:-</p><ul class=""><li id="8de3" class="lb lc hi is b it iu ix iy jb ld jf le jj lf jn lg lh li lj bi translated">弹性搜索7.5.1</li><li id="19a1" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">基巴纳语:7.5.1</li><li id="6c84" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">动物园管理员:1.0</li><li id="3205" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">卡夫卡:1.0</li><li id="37d6" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">卡夫卡连接1.0</li></ul><p id="b446" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我附上以下参考文件:</p><pre class="kt ku kv kw fd lr ls lt lu aw lv bi"><span id="b47f" class="lw jq hi ls b fi lx ly l lz ma">version: "3.5"<br/>services:<br/>  # Install ElasticSearch<br/>  elasticsearch:<br/>    container_name: elasticsearch<br/>    image: docker.elastic.co/elasticsearch/elasticsearch:7.5.1<br/>    environment:<br/>      - discovery.type=single-node<br/>    ports:<br/>      - 9200:9200<br/>      - 9300:9300<br/>  kibana:<br/>    container_name: kibana<br/>    image: docker.elastic.co/kibana/kibana:7.5.1<br/>    environment:<br/>      - elasticsearch.url= <a class="ae jo" href="http://localhost:9200" rel="noopener ugc nofollow" target="_blank">http://localhost:9200</a><br/>    ports:<br/>      - 5601:5601<br/>​<br/>#debezium<br/>  zookeeper:<br/>      image: debezium/zookeeper:1.0<br/>      hostname: zookeeper<br/>      container_name: zookeeper<br/>      ports:<br/>        - 2181:2181<br/>        - 2888:2888<br/>      environment:<br/>        ZOOKEEPER_CLIENT_PORT: 2181<br/>        ZOOKEEPER_TICK_TIME: 2000<br/>  kafka:<br/>      image: debezium/kafka:1.0<br/>      ports:<br/>        - 9092:9092<br/>      links:<br/>        - zookeeper<br/>      environment:<br/>        - ZOOKEEPER_CONNECT=zookeeper:2181<br/>        - ADVERTISED_HOST_NAME=192.168.0.250<br/>        # If we wanted to connect to Kafka from outside of a Docker container, then we’d want Kafka to advertise its address via the Docker host,<br/>        # which we could do by adding -e ADVERTISED_HOST_NAME= followed by the IP address or resolvable hostname of the Docker host,<br/>        # which on Linux or Docker on Mac this is the IP address of the host computer (not localhost).<br/>​<br/>​<br/>  schema-registry:<br/>      image: confluentinc/cp-schema-registry<br/>      ports:<br/>        - 8181:8181<br/>        - 8081:8081<br/>      environment:<br/>        - SCHEMA_REGISTRY_KAFKASTORE_CONNECTION_URL=zookeeper:2181<br/>        - SCHEMA_REGISTRY_HOST_NAME=schema-registry<br/>        - SCHEMA_REGISTRY_LISTENERS=http://schema-registry:8081<br/>      links:<br/>        - zookeeper<br/>  connect:<br/>    image: debezium/connect:1.0<br/>    ports:<br/>      - 8083:8083<br/>    links:<br/>      - kafka<br/>      - schema-registry<br/>    environment:<br/>      - BOOTSTRAP_SERVERS=kafka:9092<br/>      - GROUP_ID=1<br/>      - CONFIG_STORAGE_TOPIC=my_connect_configs<br/>      - OFFSET_STORAGE_TOPIC=my_connect_offsets<br/>      - STATUS_STORAGE_TOPIC=my_connect_statuses<br/>      - INTERNAL_KEY_CONVERTER=org.apache.kafka.connect.json.JsonConverter<br/>      - INTERNAL_VALUE_CONVERTER=org.apache.kafka.connect.json.JsonConverter</span></pre><p id="7c05" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设您已经在本地安装了docker，您需要在终端中运行下面的命令。</p><pre class="kt ku kv kw fd lr ls lt lu aw lv bi"><span id="4fd2" class="lw jq hi ls b fi lx ly l lz ma">docker-compose up</span></pre><p id="9cf6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将创建图像并调出上述服务。为了验证这一点，我们可以手动检查服务是否启动:-</p><p id="71ec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">卡夫卡连接- <code class="du mb mc md ls b">curl -H "Accept:application/json" localhost:8083/</code></p><p id="60f7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">基巴纳应该可以通过下面的网址。</p><pre class="kt ku kv kw fd lr ls lt lu aw lv bi"><span id="f488" class="lw jq hi ls b fi lx ly l lz ma"><a class="ae jo" href="http://localhost:5601/app/kibana#/management/kibana/index_pattern" rel="noopener ugc nofollow" target="_blank">http://localhost:5601/app/kibana#/management/kibana/index_pattern</a></span></pre><p id="8b2b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以通过检查是否有活动的进程运行各个端口来手动检查其他服务(例如Kafka-9092、zookeeper-2181、elastic search-9200)</p><h1 id="e020" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">2.使用Kafka connect将数据从MySQL数据库摄取到Kafka。</h1><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es me"><img src="../Images/b918df59f244f2a288e6a5e1512aae18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*QNi3zJugiFn3Ja8oC78b1w.jpeg"/></div></figure><p id="5aa6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在第一步中，我们创建了所需的基础设施，并连接了Kafka。在此步骤中，我们需要执行以下子任务:-</p><ul class=""><li id="fa79" class="lb lc hi is b it iu ix iy jb ld jf le jj lf jn lg lh li lj bi translated"><strong class="is hj">准备Mysql进行实时更新，并给予用户访问数据库的适当权限</strong></li></ul><p id="b577" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，对于实时更新，如果我们只是从不同的数据库获得数据是不够的，我们还需要获得在不同系统上执行的不同更新、删除等的快照。</p><p id="694b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Mysql有一个叫Binlogs的东西可以帮助解决这个问题，MongoDb有一个叫oplog的东西。</p><pre class="kt ku kv kw fd lr ls lt lu aw lv bi"><span id="48b3" class="lw jq hi ls b fi lx ly l lz ma">(<a class="ae jo" href="https://docs.mongodb.com/manual/core/replica-set-oplog/" rel="noopener ugc nofollow" target="_blank">https://docs.mongodb.com/manual/core/replica-set-oplog/</a>).</span></pre><p id="2656" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">MySQL的设置是一个数据库任务，我附上一篇文章的参考，我发现这将有助于你:</p><pre class="kt ku kv kw fd lr ls lt lu aw lv bi"><span id="fbe4" class="lw jq hi ls b fi lx ly l lz ma"><a class="ae jo" href="https://www.anicehumble.com/2016/12/enabling-mysql-binary-logging-on-macos.html" rel="noopener ugc nofollow" target="_blank">https://www.anicehumble.com/2016/12/enabling-mysql-binary-logging-on-macos.html</a></span></pre><p id="8c74" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">必须定义一个MySQL用户，该用户对连接器将监视的所有数据库拥有以下所有权限:</p><ul class=""><li id="5b9b" class="lb lc hi is b it iu ix iy jb ld jf le jj lf jn lg lh li lj bi translated"><code class="du mb mc md ls b"><a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_select" rel="noopener ugc nofollow" target="_blank">SELECT</a></code> <a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_select" rel="noopener ugc nofollow" target="_blank"> -使连接器能够从数据库的表中选择行；仅在执行快照时使用</a></li><li id="c653" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated"><code class="du mb mc md ls b"><a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_reload" rel="noopener ugc nofollow" target="_blank">RELOAD</a></code><a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_reload" rel="noopener ugc nofollow" target="_blank">——使</a> <code class="du mb mc md ls b"><a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/flush.html" rel="noopener ugc nofollow" target="_blank">FLUSH</a></code> <a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/flush.html" rel="noopener ugc nofollow" target="_blank">语句的连接器清除或重新加载各种内部缓存，刷新表，或获取锁；仅在执行快照时使用</a></li><li id="458a" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated"><code class="du mb mc md ls b"><a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_show-databases" rel="noopener ugc nofollow" target="_blank">SHOW DATABASES</a></code> <a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_show-databases" rel="noopener ugc nofollow" target="_blank"> -通过发出</a> <code class="du mb mc md ls b"><a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_show-databases" rel="noopener ugc nofollow" target="_blank">SHOW DATABASE</a></code> <a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_show-databases" rel="noopener ugc nofollow" target="_blank">语句，使连接器能够查看数据库名称；仅在执行快照时使用</a></li><li id="1b23" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated"><code class="du mb mc md ls b"><a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_replication-slave" rel="noopener ugc nofollow" target="_blank">REPLICATION SLAVE</a></code><a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_replication-slave" rel="noopener ugc nofollow" target="_blank">——使连接器能够连接并读取其MySQL服务器的binlog连接器</a>始终需要</li><li id="0e48" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated"><code class="du mb mc md ls b"><a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_replication-client" rel="noopener ugc nofollow" target="_blank">REPLICATION CLIENT</a></code> <a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_replication-client" rel="noopener ugc nofollow" target="_blank"> -启用</a><code class="du mb mc md ls b"><a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_replication-client" rel="noopener ugc nofollow" target="_blank">SHOW MASTER STATUS</a></code><a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_replication-client" rel="noopener ugc nofollow" target="_blank"/><code class="du mb mc md ls b"><a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_replication-client" rel="noopener ugc nofollow" target="_blank">SHOW SLAVE STATUS</a></code><a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_replication-client" rel="noopener ugc nofollow" target="_blank"/><code class="du mb mc md ls b"><a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_replication-client" rel="noopener ugc nofollow" target="_blank">SHOW BINARY LOGS</a></code><a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_replication-client" rel="noopener ugc nofollow" target="_blank">；连接器</a>始终需要</li></ul><p id="6059" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_replication-client" rel="noopener ugc nofollow" target="_blank">在官方的debezium MySQL文档(</a>T2)上阅读更多关于MySQL的配置的信息</p><ul class=""><li id="4461" class="lb lc hi is b it iu ix iy jb ld jf le jj lf jn lg lh li lj bi translated"><strong class="is hj">使用Kafka Connect创建一个MySQL连接器。</strong></li></ul><p id="a07b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦在MySQL服务器上启用了Binlogs，下一步就是创建一个连接器。简单来说，connector从源系统创建一个连接，并将要读取的数据发送到Kafka sink，或者从Kafka源读取数据，并将其推送到接收系统。</p><p id="41fc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们使用Debezium连接器(<a class="ae jo" href="https://www.confluent.io/hub/debezium/debezium-connector-mysql" rel="noopener ugc nofollow" target="_blank">https://www . confluent . io/hub/Debezium/Debezium-connector-MySQL</a>)来实现我们的目的。这将从MySQL的binlogs中读取所有的DDL和DML，并推入Kafka，创建Kafka主题。</p><p id="14eb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最简单的方法是通过邮递员。使用下面的示例请求点击localhost:8083/connectors/</p><pre class="kt ku kv kw fd lr ls lt lu aw lv bi"><span id="b466" class="lw jq hi ls b fi lx ly l lz ma">{ <br/>"name":"test-order-connector",<br/>"config":{ <br/>"connector.class":"io.debezium.connector.mysql.MySqlConnector",<br/>"tasks.max":"1",<br/>"database.hostname":"localhost",<br/>"database.port":"3306",<br/>"database.user":"root",<br/>"database.password":"password",<br/>"database.server.id":"1",<br/>"database.server.name":"test",<br/>"database.whitelist":"wms",<br/>"database.history.kafka.bootstrap.servers":"kafka:9092",<br/>"database.history.kafka.topic":"test.wms"<br/>}<br/>}</span></pre><p id="b165" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的JSON中，大多数关键字都是不言自明的，需要注意的一点是，每次创建新的连接器主题时，您都需要更改database.server.id、database.server.name和name。</p><p id="f6a4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，在postman/curl上运行上面的JSON之后，运行下面的命令来列出您本地的Kafka主题</p><pre class="kt ku kv kw fd lr ls lt lu aw lv bi"><span id="8f53" class="lw jq hi ls b fi lx ly l lz ma">kafka-topics --zookeeper localhost:2181 --list</span></pre><p id="cdd1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">新创建的主题的类型是。</p><pre class="kt ku kv kw fd lr ls lt lu aw lv bi"><span id="b0e5" class="lw jq hi ls b fi lx ly l lz ma"><strong class="ls hj">&lt;database.server.name&gt;. &lt; databasename &gt;.&lt; tablename &gt;</strong></span></pre><p id="f889" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于我们的例子，我们的表名应该是这样的</p><pre class="kt ku kv kw fd lr ls lt lu aw lv bi"><span id="ee4e" class="lw jq hi ls b fi lx ly l lz ma"><strong class="ls hj">test.wms.order</strong></span></pre><p id="7317" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您运行上面的命令时，您应该会看到上面格式的表格。</p><h1 id="695c" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Kafka事件示例:</h1><p id="bfd3" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">如果设置完成，Kafka事件将采用下面的格式，检查Kafka事件中标签之前和之后的<strong class="is hj">。Before对于插入为null，对于更新为not null。</strong></p><pre class="kt ku kv kw fd lr ls lt lu aw lv bi"><span id="d02a" class="lw jq hi ls b fi lx ly l lz ma">“payload”: {<br/> “before”: null,<br/> “after”: {<br/> “id”: 2,<br/> “wmsrecord_id”: “1”,<br/> “item_type”: null,<br/> “shipment_cost”: “24.5”,<br/> “created_at”: 1580774645000000,<br/> “courier”: “FETCHR”,<br/> “order_id”: “1”<br/> },<br/> “source”: {<br/> “version”: “1.0.3.Final”,<br/> “connector”: “mysql”,<br/> “name”: “localtest15031242pm”,<br/> “ts_ms”: 0,<br/> “snapshot”: “last”,<br/> “db”: “wms”,<br/> “table”: “logistics_demo”,<br/> “server_id”: 0,<br/> “gtid”: null,<br/> “file”: “mysql-bin-changelog.248436”,<br/> “pos”: 511,<br/> “row”: 0,<br/> “thread”: null,<br/> “query”: null<br/> },<br/> “op”: “c”,<br/> “ts_ms”: 1584342852164<br/> }</span></pre><p id="a75f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">故障排除提示:</strong></p><p id="6f0e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有时候，主题不是以给定的格式创建的，这意味着数据没有从MySQL流向Kafka主题。因此，这可能有以下原因</p><ul class=""><li id="78ec" class="lb lc hi is b it iu ix iy jb ld jf le jj lf jn lg lh li lj bi translated">MySQL bin日志尚未正确配置。手动检查MySQL中的二进制日志，以验证是否写入了二进制日志。</li><li id="d419" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">数据库用户没有访问bin日志所需的权限。这是我遇到的另一个常见问题。查看Debezium文档(<a class="ae jo" href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html" rel="noopener ugc nofollow" target="_blank">https://Debezium . io/documentation/reference/1.0/connectors/MySQL . html</a>)了解所需的特定权限。</li><li id="eccf" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">Database.serverid每次都必须是唯一的。</li></ul><h1 id="0623" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">任务概述:</h1><p id="11b1" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">下面是我们在这篇文章中所做的总结</p><ul class=""><li id="53f5" class="lb lc hi is b it iu ix iy jb ld jf le jj lf jn lg lh li lj bi translated">为Binlog事件设置MySQL数据库。</li><li id="9fe3" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">使用Debezium Kafka Connect在本地Kafka中创建主题。</li></ul><p id="ae52" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步是读取事件，在弹性搜索上创建索引，并构建我们的实时系统。让我们看看如何在第3篇文章中做到这一点。</p><blockquote class="mf"><p id="00cf" class="mg mh hi bd mi mj mk ml mm mn mo jn dx translated">如果您确实喜欢这篇文章，请务必阅读后续文章并分享您的反馈。在LinkedIn上找到我，地址是<a class="ae jo" href="https://www.linkedin.com/in/rohanganesh0506/" rel="noopener ugc nofollow" target="_blank"> rohan_linkedIn </a>。</p></blockquote></div></div>    
</body>
</html>