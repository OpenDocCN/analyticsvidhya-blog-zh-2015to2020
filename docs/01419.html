<html>
<head>
<title>How I manage Python for every day usage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何管理Python的日常使用</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/my-python-development-and-daily-usage-setup-af8633ddef78?source=collection_archive---------7-----------------------#2019-10-21">https://medium.com/analytics-vidhya/my-python-development-and-daily-usage-setup-af8633ddef78?source=collection_archive---------7-----------------------#2019-10-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/0a07c5851a45c78b00ebafd9205b8aca.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/0*dihL0QWgTD5uvK_A.png"/></div></figure><p id="5d2c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">哦XKCD，永远是重点:)</p><p id="09a1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用Python做得越多，设置就越复杂。例如，您可能希望每个项目有一个virtualenv。对于某些项目，您可能希望有一个完整的沙盒，而对于其他项目，您可能希望能够使用系统范围的python环境。在其他项目中，您可能想要测试或使用多个Python版本。有些可能是Anaconda项目。您可能有自己的依赖于系统级软件包的脚本，但是您希望这些脚本可以从任何地方访问。您可能还希望在沙箱中安装各种基于python的工具。幸运的是，有一些很棒的工具可以帮助维护一个合理的配置来满足大多数需求！</p><p id="c2ce" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我将把这篇文章分成两篇:</p><ul class=""><li id="d6b5" class="jk jl hi io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated">全局python设置</li><li id="f126" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated"><a class="ae jy" rel="noopener" href="/@aiguofer/managing-a-python-development-environment-in-emacs-43897fd48c6a">基于Emacs的开发环境</a>。</li></ul><h1 id="ae71" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">全局配置</h1><h2 id="d9d8" class="kx ka hi bd kb ky kz la kf lb lc ld kj ix le lf kn jb lg lh kr jf li lj kv lk bi translated">配置基于Python的工具</h2><p id="2868" class="pw-post-body-paragraph im in hi io b ip ll ir is it lm iv iw ix ln iz ja jb lo jd je jf lp jh ji jj hb bi translated">首先，我使用了许多基于python的工具，用于各种目的。因为大多数这些通常在包管理器中不可用，所以最好pip安装这些。然而，由于可能存在复杂的依赖关系需求，我喜欢将它们分别安装在各自的沙箱中。为此，我使用了<a class="ae jy" href="https://github.com/pipxproject/pipx" rel="noopener ugc nofollow" target="_blank"> pipx </a>。我使用系统python 3进行设置，并将其安装到用户范围的python目录:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="ce37" class="kx ka hi lv b fi lz ma l mb mc">PYENV_VERSION=system pip3 install --user pipx</span></pre><p id="969f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，我从保存在我的dotfiles中的<code class="du md me mf lv b">requirements.txt</code>文件安装我的工具(如果感兴趣，这里有<a class="ae jy" href="https://github.com/aiguofer/dotfiles/blob/master/requirements_pipx.txt" rel="noopener ugc nofollow" target="_blank">链接</a>):</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="2076" class="kx ka hi lv b fi lz ma l mb mc">while read pkg; do    <br/>  $HOME/.local/bin/pipx install $pkg<br/>done &lt; requirements_pipx.txt</span></pre><p id="cb3a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">默认情况下，Pipx会将包安装到<code class="du md me mf lv b">~/.local/bin</code>，所以我确保这优先于我的pyenv安装(见下一节)。为此，只需确保您的<code class="du md me mf lv b">PATH</code>在您的init文件中设置正确。例如:</p><p id="b4ec" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><code class="du md me mf lv b">export PATH=~/.local/bin:~/.pyenv/shims:~/.pyenv/bin:$PATH</code></p><h2 id="3312" class="kx ka hi bd kb ky kz la kf lb lc ld kj ix le lf kn jb lg lh kr jf li lj kv lk bi translated">安装pyenv</h2><p id="ac7d" class="pw-post-body-paragraph im in hi io b ip ll ir is it lm iv iw ix ln iz ja jb lo jd je jf lp jh ji jj hb bi translated">为了安装和维护不同的Python版本/virtualenv组合，我使用了一个叫做<a class="ae jy" href="https://github.com/pyenv/pyenv" rel="noopener ugc nofollow" target="_blank"> pyenv </a>的神奇包。我安装了所有的默认插件:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="c72e" class="kx ka hi lv b fi lz ma l mb mc">git_installers=(<br/>    # other tools excluded for post...<br/>    pyenv/pyenv-installer/master/bin/pyenv-installer # pyenv<br/>)</span><span id="f073" class="kx ka hi lv b fi mg ma l mb mc">for installer in "${git_installers[@]}"; do<br/>    curl -sL <a class="ae jy" href="https://raw.githubusercontent.com/$installer" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/$installer</a> | bash<br/>done</span></pre><p id="9be4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">(我以类似的方式在git上安装了一些其他的东西，这就是为什么我使用了一个循环，不想为这篇文章修改代码)</p><h2 id="a286" class="kx ka hi bd kb ky kz la kf lb lc ld kj ix le lf kn jb lg lh kr jf li lj kv lk bi translated">确保每个版本中都安装了必要的软件包</h2><p id="f5a3" class="pw-post-body-paragraph im in hi io b ip ll ir is it lm iv iw ix ln iz ja jb lo jd je jf lp jh ji jj hb bi translated">我喜欢确保在我设置的每个版本和环境中都安装了各种各样的包。这些主要是与开发相关的，并且是使用Emacs作为我的IDE所必需的。</p><p id="747c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为此，我使用了<a class="ae jy" href="https://github.com/jawshooah/pyenv-default-packages" rel="noopener ugc nofollow" target="_blank"> pyenv-default-packages </a>插件(我将在另一节讨论其他插件):</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="82db" class="kx ka hi lv b fi lz ma l mb mc">pyenv_plugins=(<br/>    aiguofer/pyenv-version-alias<br/>    jawshooah/pyenv-default-packages<br/>    aiguofer/pyenv-jupyter-kernel<br/>)</span><span id="16e8" class="kx ka hi lv b fi mg ma l mb mc">for plugin in "${pyenv_plugins[@]}"; do<br/>    plugin_name=$(echo $plugin | cut -d '/' -f2)<br/>    git clone <a class="ae jy" href="https://github.com/$plugin" rel="noopener ugc nofollow" target="_blank">https://github.com/$plugin</a> $(pyenv root)/plugins/$plugin_name<br/>done</span></pre><p id="6fc2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后我创建一个文件<code class="du md me mf lv b">~/.pyenv/default-packages</code>,包含:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="5fe7" class="kx ka hi lv b fi lz ma l mb mc">ipdb<br/>elpy<br/>jedi<br/>epc<br/>importmagic<br/>flake8</span></pre><h2 id="cdd9" class="kx ka hi bd kb ky kz la kf lb lc ld kj ix le lf kn jb lg lh kr jf li lj kv lk bi translated">设置Jupyter内核</h2><p id="955b" class="pw-post-body-paragraph im in hi io b ip ll ir is it lm iv iw ix ln iz ja jb lo jd je jf lp jh ji jj hb bi translated">因为我通过<code class="du md me mf lv b">pipx</code>使用全局<code class="du md me mf lv b">jupyter-console</code>安装，并且每个项目都有自己的版本，所以我确保为每个版本安装了一个Jupyter内核。为此，我编写了<a class="ae jy" href="https://github.com/aiguofer/pyenv-jupyter-kernel" rel="noopener ugc nofollow" target="_blank"> pyenv-jupyter-kernel </a>插件。我在上面向你展示了我是如何安装它的。现在，每当安装新版本/virtualenv时，都会创建一个匹配的Jupyter内核。我在Emacs中利用这一点，无论我在做什么，总是使用相应的内核。</p><h2 id="55ed" class="kx ka hi bd kb ky kz la kf lb lc ld kj ix le lf kn jb lg lh kr jf li lj kv lk bi translated">设置默认python环境</h2><p id="0e71" class="pw-post-body-paragraph im in hi io b ip ll ir is it lm iv iw ix ln iz ja jb lo jd je jf lp jh ji jj hb bi translated">我喜欢有一个默认的virtualenv，它继承了系统包，我可以用它来做一般用途的Python事情，比如写我每天使用的脚本，旋转默认的REPL来尝试一些东西，等等。我喜欢使用virtualenv的原因是我不必担心使用<code class="du md me mf lv b">--user</code>标志，我继承系统包的原因是难以构建的包(比如QT和GTK)可以通过包管理器获得。我也喜欢在需要Python 2的时候为Python 2和Python 3各准备一个。我是这样设置的:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="27bc" class="kx ka hi lv b fi lz ma l mb mc">pyenv virtualenv --system-site-packages -p /usr/bin/python2 default2<br/>pyenv virtualenv --system-site-packages -p /usr/bin/python3 default3</span><span id="ffd9" class="kx ka hi lv b fi mg ma l mb mc">pyenv global default3 default2</span><span id="8097" class="kx ka hi lv b fi mg ma l mb mc">pip2 install -r requirements.txt # install required deps for scripts<br/>pip3 install -r requirements.txt</span></pre><h2 id="9269" class="kx ka hi bd kb ky kz la kf lb lc ld kj ix le lf kn jb lg lh kr jf li lj kv lk bi translated">设置项目版本</h2><p id="e415" class="pw-post-body-paragraph im in hi io b ip ll ir is it lm iv iw ix ln iz ja jb lo jd je jf lp jh ji jj hb bi translated">为不同的项目设置python环境时，会有各种各样的需求。例如，您可能需要一个特定的python版本。您可以使用pyenv安装特定版本，如下所示:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="4904" class="kx ka hi lv b fi lz ma l mb mc">pyenv install 3.5.7</span></pre><p id="59fd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">那么您可能希望使用该特定版本来设置virtualenv:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="ae8d" class="kx ka hi lv b fi lz ma l mb mc">pyenv virtualenv 3.5.7 my_project</span></pre><p id="0df2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，当您在项目目录中时，您可能想要自动使用该环境，所以您可以设置它:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="c8c0" class="kx ka hi lv b fi lz ma l mb mc">cd /path/to/my_project<br/>pyenv local my_project</span></pre><p id="8e29" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">但是，您可能还想为TOX设置多个python版本，因此您可以首先使用pyenv安装您想要测试的版本，然后像这样设置它:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="6370" class="kx ka hi lv b fi lz ma l mb mc">pyenv local my_project 3.7.1 3.6.3 3.5.7 2.7.10</span></pre><p id="7191" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这将使my_project成为安装包/etc的缺省值，但是每个版本的python可执行文件也可以用于tox。</p><p id="1330" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">或者您可能需要多个virtualenvs用于一个更大项目的不同组件，同时在同一个“项目”中拥有所有安装的可执行文件</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="1a39" class="kx ka hi lv b fi lz ma l mb mc">cd /path/to/my_project<br/># create a dir for each component and set up virtualenvs<br/>pyenv local component1 component2 component3...</span></pre><h2 id="963c" class="kx ka hi bd kb ky kz la kf lb lc ld kj ix le lf kn jb lg lh kr jf li lj kv lk bi translated">用终端提示符玩得很好</h2><p id="e13a" class="pw-post-body-paragraph im in hi io b ip ll ir is it lm iv iw ix ln iz ja jb lo jd je jf lp jh ji jj hb bi translated">我喜欢这种设置提供的灵活性，但是我不喜欢在使用多个版本时显示pyenv版本的工具的工作方式。例如，我的全球版本将显示为:<code class="du md me mf lv b">default3:default2</code>而其他一些项目甚至更糟。为了解决这个问题，我创建了<a class="ae jy" href="https://github.com/aiguofer/pyenv-version-alias" rel="noopener ugc nofollow" target="_blank"> pyenv-version-alias </a>插件，它允许我为不同的pyenv环境设置一个别名。比如全球版只是显示为<code class="du md me mf lv b">global</code>而不是。</p><p id="f7e8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">由于插件只是创建了一个命令<code class="du md me mf lv b">pyenv version-alias</code>，你需要设置其他工具来使用它。我使用Powerlevel10k作为我的提示符，因此我通过使用以下命令覆盖pyenv提示符来配置它:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="4762" class="kx ka hi lv b fi lz ma l mb mc"># override powerlevel10k<br/>prompt_pyenv() {<br/>    local v=$(pyenv version-alias)</span><span id="4144" class="kx ka hi lv b fi mg ma l mb mc"># only display pyenv if we're not using 'global'<br/>if [[ "${v}" != "global" || "${POWERLEVEL9K_PYENV_PROMPT_ALWAYS_SHOW}" == "true" ]]; then<br/>        _p9k_prompt_segment "$0" "blue" "$_p9k_color1" 'PYTHON_ICON' 0 '' "${v//\%/%%}"<br/>    fi<br/>}</span></pre><p id="df5c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是它最终的样子(这里展示了我最复杂的环境):</p><figure class="lq lr ls lt fd ij er es paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="er es mh"><img src="../Images/078b18d170e6ce1c258f49ea6581706e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yUDWelIrWj0H-ge3Shlyvg.png"/></div></div></figure></div></div>    
</body>
</html>