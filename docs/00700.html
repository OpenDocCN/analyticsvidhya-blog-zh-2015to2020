<html>
<head>
<title>Extract RSS News Feeds using Python and Google Cloud Services</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和Google云服务提取RSS新闻提要</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/web-scraping-news-data-rss-feeds-python-and-google-cloud-platform-7a0df2bafe44?source=collection_archive---------0-----------------------#2019-08-29">https://medium.com/analytics-vidhya/web-scraping-news-data-rss-feeds-python-and-google-cloud-platform-7a0df2bafe44?source=collection_archive---------0-----------------------#2019-08-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="5292" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">web抓取和无服务器云服务简介。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/b062d830fdd629f48e3b6e8f003fb3c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zZZ_M9TA_u8PRph0"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">由<a class="ae jn" href="https://unsplash.com/@romankraft?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">罗曼·卡夫</a>在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><blockquote class="jo jp jq"><p id="1e19" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">本文的目的是介绍一种系统化的方法来读取RSS新闻提要，并将其内容处理成web抓取的新闻文章。挑战在于能够提取在不同网站上发布的文本文章，而不需要对网页结构有任何强有力的前提。</p></blockquote><p id="760e" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">整体解决方案分三步描述:</p><ol class=""><li id="23f0" class="kr ks hi ju b jv jw jy jz ko kt kp ku kq kv kn kw kx ky kz bi translated">消息在云发布/订阅中发布，带有新闻RSS订阅源的URL，</li><li id="4718" class="kr ks hi ju b jv la jy lb ko lc kp ld kq le kn kw kx ky kz bi translated">第一个云功能由先前的消息触发。它提取RSS提要中的每篇文章，将其存储在云存储中，并在Cloud Pub/Sub中为每篇文章发布一条消息以供进一步使用，</li><li id="ef35" class="kr ks hi ju b jv la jy lb ko lc kp ld kq le kn kw kx ky kz bi translated">第二个云功能由之前的消息触发。它从网络上抓取文章页面，将结果文本存储在云存储中，并在云发布/订阅中发布消息以供进一步使用。</li></ol><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lf"><img src="../Images/3c45cfaff56a054523ec86f420231643.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZnOf5YEwOS17I-miSxljfA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">新闻RSS源网页抓取—解决方案图</figcaption></figure><h1 id="1666" class="lg lh hi bd li lj lk ll lm ln lo lp lq io lr ip ls ir lt is lu iu lv iv lw lx bi translated">RSS源数据处理</h1><blockquote class="jo jp jq"><p id="7fb6" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">假设我们想听一个RSS新闻提要，并在每个链接上循环提取网页文章。</p></blockquote><p id="1a9b" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">幸运的是，RSS提要是用XML编写的，必须符合<a class="ae jn" href="https://www.w3schools.com/xml/xml_rss.asp" rel="noopener ugc nofollow" target="_blank">规范</a>。所以处理一个或多个RSS提要应该是一样的。下面是我搜索“苹果”相关文章时的一个Google News RSS Feed的例子。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ly"><img src="../Images/1aa58cdc39ba797156e9fe73393ba564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aujpVoeGfFszhjGLSIm1AA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">RSS源示例— XML文件</figcaption></figure><p id="6518" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">正如我们所看到的，每个条目都是由标题、原始网页链接、出版日期和描述摘要描述的文章。让我们看看如何使用Python来运行搜索，以及如何遍历每个项目来收集文章链接。</p><p id="deef" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">首先我们需要安装<strong class="ju hj"> feedparser </strong>库来<strong class="ju hj">解析</strong> RSS提要xml文件:</p><p id="46b9" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated"><code class="du lz ma mb mc b">pip install feed parser</code></p><p id="b37d" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">我们还需要安装<strong class="ju hj"> pandas </strong>来使用<strong class="ju hj">pandas . io . json . Json _ normalize</strong>将Json数据展平到pandas数据表:<code class="du lz ma mb mc b">pip install pandas</code></p><p id="4a89" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">以下代码的输出是一组URL，将在下一节中使用它们通过web抓取库提取文章。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="md me l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">RSS提要数据解析器— Python代码</figcaption></figure></div><div class="ab cl mf mg gp mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hb hc hd he hf"><h1 id="e36e" class="lg lh hi bd li lj mm ll lm ln mn lp lq io mo ip ls ir mp is lu iu mq iv lw lx bi translated">网络抓取新闻文章</h1><blockquote class="jo jp jq"><p id="34ee" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">目标是从新闻网站中提取文章，而不强烈依赖于任何网页结构。</p></blockquote><p id="0341" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">如果我们观察新闻网站的页面结构，我们会注意到主文章被一些像图像、广告、链接等噪音所包围。在提取过程中我们应该忽略。</p><p id="ab63" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">以下是《卫报》网站上一篇文章的例子:</p><div class="mr ms ez fb mt mu"><a href="https://www.theguardian.com/technology/2019/aug/28/apple-ends-contracts-hundreds-workers-hired-to-listen-siri" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab dw"><div class="mw ab mx cl cj my"><h2 class="bd hj fi z dy mz ea eb na ed ef hh bi translated">苹果终止了数百名受雇听Siri的工人的合同</h2><div class="nb l"><h3 class="bd b fi z dy mz ea eb na ed ef dx translated">欧洲数百名受雇检查Siri录音错误的苹果员工已经失业…</h3></div><div class="nc l"><p class="bd b fp z dy mz ea eb na ed ef dx translated">www.theguardian.com</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni jh mu"/></div></div></a></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nj"><img src="../Images/c206a4af555ab6c19a36e2cc955499c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rgVmUzA6ED4CNwtmx9iMZA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">卫报示例—首页</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nk"><img src="../Images/13bf818cc5238a41c2394f256860b7c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z2V6W-YMltoFS2heozGmyQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">卫报示例—底部页面</figcaption></figure><p id="1303" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">如果我们查看下面的页面源代码，我们会注意到,<a class="ae jn" href="https://www.w3schools.com/tags/tag_article.asp" rel="noopener ugc nofollow" target="_blank"> &lt;文章&gt; </a> HTML元素用于自包含主要文本，该文本被分割在多个段落<a class="ae jn" href="https://www.w3schools.com/tags/tag_p.asp" rel="noopener ugc nofollow" target="_blank"> &lt; p &gt; </a>上。这种结构常见于新闻网站。然而，也有一些例外，所以我们不想对页面结构做出强有力的假设，以便能够解析任何新闻网页。</p><blockquote class="jo jp jq"><p id="b0eb" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">我们要做的唯一假设是，一篇文章是一个或多个段落块的连接，每个网页包含一篇我们想要提取的主要文章。</p></blockquote><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nl"><img src="../Images/163c8b2ea46a7ba100c643bd5cb8d62c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qy03K0BkIPNrVIsWTN3bpA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">卫报示例—源代码</figcaption></figure><p id="7380" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">这是路透社网站的另一个例子，其中的<article>元素不用于独立的文章，但之前的假设仍然成立:</article></p><blockquote class="jo jp jq"><p id="5b73" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">感兴趣的文章是段落块的连接，并且每个网页包含一篇主要文章。</p></blockquote><p id="8adc" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">我们从上一页源代码中注意到，元素<code class="du lz ma mb mc b">&lt;div class=”ArticlePage_container&gt;</code>用于对主要文章段落块进行分组，而不是使用&lt;<em class="jt">文章</em> &gt;元素。</p><div class="mr ms ez fb mt mu"><a href="https://www.reuters.com/article/us-globalfoundries-tsmc-lawsuit/globalfoundries-sues-tsmc-wants-u-s-import-ban-on-some-products-idUSKCN1VH0E9" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab dw"><div class="mw ab mx cl cj my"><h2 class="bd hj fi z dy mz ea eb na ed ef hh bi translated">GlobalFoundries起诉TSMC，希望美国禁止某些产品的进口</h2><div class="nb l"><h3 class="bd b fi z dy mz ea eb na ed ef dx translated">上海(路透社)-合同芯片制造商GlobalFoundries因专利问题起诉更大的竞争对手和苹果供应商TSMC</h3></div><div class="nc l"><p class="bd b fp z dy mz ea eb na ed ef dx translated">www.reuters.com</p></div></div></div></a></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nm"><img src="../Images/350aefaef0a332f62a780442ba0791fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*imDpnsBxbkEiEL0JVI8vcQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">路透社示例—源代码</figcaption></figure><p id="b62b" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">因此，我们可以考虑提取页面中的所有段落元素，并将它们连接成一篇文章。然而，并不是网页中的所有段落块都与主文章相关，所以我们应该找到一种方法，只连接感兴趣的段落。</p><p id="ee84" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">所提出的解决方案易于实施，并不完美，但在不同网站上测试时效果良好:</p><ol class=""><li id="3867" class="kr ks hi ju b jv jw jy jz ko kt kp ku kq kv kn kw kx ky kz bi translated">提取页面主体中的所有段落元素，</li><li id="bd5d" class="kr ks hi ju b jv la jy lb ko lc kp ld kq le kn kw kx ky kz bi translated">对于每个段落，构建其专利元素层次结构，</li><li id="2cd9" class="kr ks hi ju b jv la jy lb ko lc kp ld kq le kn kw kx ky kz bi translated">在同一父层次结构下连接段落，</li><li id="5ee8" class="kr ks hi ju b jv la jy lb ko lc kp ld kq le kn kw kx ky kz bi translated">选择最长的段落作为主要文章。</li></ol><blockquote class="jo jp jq"><p id="f017" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">假设主要文章应该代表最高的网页内容，而其他网页组件，如广告、图像、链接、推广文章摘要等。，应该是个别边缘的。</p></blockquote><p id="f23f" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">为了实现这个解决方案，让我们安装一些有用的库:</p><ul class=""><li id="99f1" class="kr ks hi ju b jv jw jy jz ko kt kp ku kq kv kn nn kx ky kz bi translated"><em class="jt">请求</em>库将用于请求http URL:<code class="du lz ma mb mc b">pip install requests</code></li><li id="2050" class="kr ks hi ju b jv la jy lb ko lc kp ld kq le kn nn kx ky kz bi translated"><em class="jt"> beautifulsoup4 </em>库将用于从html内容类型:<code class="du lz ma mb mc b">pip install beautifulsoup4</code>中提取数据</li><li id="ede8" class="kr ks hi ju b jv la jy lb ko lc kp ld kq le kn nn kx ky kz bi translated"><em class="jt">熊猫</em>图书馆将用于收集数据帧格式的文章:<code class="du lz ma mb mc b">pip install pandas</code></li></ul><p id="fcf4" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">下面是处理一篇文章的Python实现:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="md me l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">网络抓取— Python代码</figcaption></figure><p id="fc23" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">所以现在我们可以循环遍历RSS提要结果中的每一项来提取所有文章。</p></div><div class="ab cl mf mg gp mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hb hc hd he hf"><h1 id="be70" class="lg lh hi bd li lj mm ll lm ln mn lp lq io mo ip ls ir mp is lu iu mq iv lw lx bi translated">使用谷歌云平台实现自动化</h1><p id="1edc" class="pw-post-body-paragraph jr js hi ju b jv no ij jx jy np im ka ko nq kd ke kp nr kh ki kq ns kl km kn hb bi translated">在本节中，我们将使用谷歌云平台(GCP)来构建一个可扩展的解决方案，用于搜索与关键字相关的任何新闻，提取新闻文章并存储它们以供将来处理:</p><ol class=""><li id="f4c6" class="kr ks hi ju b jv jw jy jz ko kt kp ku kq kv kn kw kx ky kz bi translated"><a class="ae jn" href="https://cloud.google.com/pubsub/" rel="noopener ugc nofollow" target="_blank"> Cloud Pub/Sub </a>将用于构建一个事件驱动的解决方案来启动搜索和提取流程，</li><li id="a958" class="kr ks hi ju b jv la jy lb ko lc kp ld kq le kn kw kx ky kz bi translated"><a class="ae jn" href="https://cloud.google.com/functions/" rel="noopener ugc nofollow" target="_blank">云函数</a>将用于使我们的Python代码作为服务可用，</li><li id="d7fc" class="kr ks hi ju b jv la jy lb ko lc kp ld kq le kn kw kx ky kz bi translated"><a class="ae jn" href="https://cloud.google.com/storage/" rel="noopener ugc nofollow" target="_blank">云存储</a>将用于将结果文章持久化为<a class="ae jn" href="https://www.w3schools.com/js/js_json_intro.asp" rel="noopener ugc nofollow" target="_blank"> Json </a>文件。</li></ol><p id="b5dd" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated"><em class="jt">您可以使用Gmail帐户开始免费使用</em><a class="ae jn" href="https://cloud.google.com/free/" rel="noopener ugc nofollow" target="_blank"><em class="jt">GCP</em></a><em class="jt">。你可以获得300美元的免费信用，可以使用12个月。</em></p><h2 id="2d08" class="nt lh hi bd li nu nv nw lm nx ny nz lq ko oa ob ls kp oc od lu kq oe of lw og bi translated">云发布/订阅</h2><p id="0f25" class="pw-post-body-paragraph jr js hi ju b jv no ij jx jy np im ka ko nq kd ke kp nr kh ki kq ns kl km kn hb bi translated">要开始使用云发布/订阅，我们应该创建一个主题。主题是对发布者和订阅者之间交换的相关消息进行分组的资源。</p><p id="9439" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">就我们的情况来说，我们将发布三个主题的消息:</p><ol class=""><li id="f000" class="kr ks hi ju b jv jw jy jz ko kt kp ku kq kv kn kw kx ky kz bi translated"><em class="jt">news _ search _ to _ process:</em>本主题发布的消息会触发一个云函数来处理一个RSS提要，</li><li id="95a1" class="kr ks hi ju b jv la jy lb ko lc kp ld kq le kn kw kx ky kz bi translated"><em class="jt">news _ article _ to _ process:</em>本话题发布的消息会触发云功能对一个新闻网页进行web抓取，</li><li id="42c9" class="kr ks hi ju b jv la jy lb ko lc kp ld kq le kn kw kx ky kz bi translated"><em class="jt"> news_article_processed </em>:本主题发布的消息会通知订阅者进行进一步处理。</li></ol><p id="45d0" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">我们可以使用<a class="ae jn" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> Google Cloud console </a>来创建一个主题，或者我们可以使用命令行使用<a class="ae jn" href="https://cloud.google.com/sdk/" rel="noopener ugc nofollow" target="_blank"> Google Cloud SDK </a>在我们的本地环境中安装和配置:</p><pre class="iy iz ja jb fd oh mc oi oj aw ok bi"><span id="eccf" class="nt lh hi mc b fi ol om l on oo">gcloud pubsub topics create news_search_to_process<br/>gcloud pubsub topics create news_article_to_process<br/>gcloud pubsub topics create news_article_processed</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es op"><img src="../Images/ee2960f33b684554be7a8c9b7d9dfcc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NP8HLfM9aBp3iItpbLrWng.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">云发布/订阅—创建主题</figcaption></figure><p id="9f08" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">我们还需要定义一条消息，以便能够针对不同的RSS提要或不同的关键字运行新闻搜索。</p><p id="88cf" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">为了保持示例的简单性，让我们发布一个简单的URL <em class="jt"> </em>作为消息属性，云函数将使用它来启动流程:</p><p id="f531" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated"><code class="du lz ma mb mc b">url = '<a class="ae jn" href="https://news.google.com/rss/search?q=apple'" rel="noopener ugc nofollow" target="_blank">https://news.google.com/rss/search?q=apple</a>'</code></p><p id="4e7f" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">我们可以使用控制台手动将消息发布到某个主题:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oq"><img src="../Images/722d19cde3cb1bb4ef392a7f78310d4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RLJIhHBpMwsRyu-jadkngg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">云发布/订阅—主题详细信息</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es or"><img src="../Images/a7c036fcdace37e59188ff4f114efca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_CoNz9ZhaobcYHnDfif0mw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">云发布/订阅—将消息发布到主题</figcaption></figure><h2 id="ddb9" class="nt lh hi bd li nu nv nw lm nx ny nz lq ko oa ob ls kp oc od lu kq oe of lw og bi translated">云函数</h2><p id="3f43" class="pw-post-body-paragraph jr js hi ju b jv no ij jx jy np im ka ko nq kd ke kp nr kh ki kq ns kl km kn hb bi translated">为了为我们的解决方案部署云功能，我们需要创建这两个文件:</p><ol class=""><li id="22aa" class="kr ks hi ju b jv jw jy jz ko kt kp ku kq kv kn kw kx ky kz bi translated"><em class="jt"> main.py </em>文件包含我们的python函数，</li><li id="d42f" class="kr ks hi ju b jv la jy lb ko lc kp ld kq le kn kw kx ky kz bi translated"><em class="jt"> requirements.txt </em>文件列出了我们需要安装的python库。出于我们的目的，它将包含以下库:</li></ol><pre class="iy iz ja jb fd oh mc oi oj aw ok bi"><span id="ec1f" class="nt lh hi mc b fi ol om l on oo">google-cloud-storage<br/>google-cloud-pubsub<br/>pandas<br/>feedparser<br/>bs4</span></pre><p id="bd8e" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">main.py文件包含:</p><ol class=""><li id="31d0" class="kr ks hi ju b jv jw jy jz ko kt kp ku kq kv kn kw kx ky kz bi translated"><em class="jt">process _ RSS _ feed _ search()</em>:当我们发布消息到云发布/订阅主题<em class="jt"> news_search_to_process </em>时，这个云函数会被触发。</li><li id="e346" class="kr ks hi ju b jv la jy lb ko lc kp ld kq le kn kw kx ky kz bi translated"><em class="jt">process _ RSS _ feed _ article()</em>:当我们发布消息到云发布/订阅主题<em class="jt">news _ article _ to _ process</em>时，这个云函数会被触发。</li><li id="e6e3" class="kr ks hi ju b jv la jy lb ko lc kp ld kq le kn kw kx ky kz bi translated"><em class="jt"> news_feed_parser </em>:这个类用于解析RSS新闻源URL，并抓取新闻网页。</li><li id="6faa" class="kr ks hi ju b jv la jy lb ko lc kp ld kq le kn kw kx ky kz bi translated"><em class="jt"> gcp_cloud_util </em>:该类用于连接Google云平台，将gcp服务封装为云存储，本例中为云发布/订阅。</li></ol><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="47ae" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">现在我们需要部署两个云函数，由发布到云发布/订阅主题的消息触发。我们可以使用<a class="ae jn" href="https://cloud.google.com/sdk/" rel="noopener ugc nofollow" target="_blank"> Google Cloud SDK </a>执行命令行:</p><pre class="iy iz ja jb fd oh mc oi oj aw ok bi"><span id="b4ff" class="nt lh hi mc b fi ol om l on oo">gcloud functions deploy process_rss_feed_search --runtime python37 --trigger-topic news_search_to_process</span><span id="0c22" class="nt lh hi mc b fi os om l on oo">gcloud functions deploy process_rss_feed_article --runtime python37 --trigger-topic news_article_to_process</span></pre><p id="9205" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">我们现在准备通过发布消息到云发布/订阅主题<em class="jt">新闻_搜索_流程:</em>来测试我们的解决方案</p><ul class=""><li id="a990" class="kr ks hi ju b jv jw jy jz ko kt kp ku kq kv kn nn kx ky kz bi translated"><code class="du lz ma mb mc b">url = '<a class="ae jn" href="https://news.google.com/rss/search?q=apple" rel="noopener ugc nofollow" target="_blank">https://news.google.com/rss/search?q=apple</a>'</code></li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ot"><img src="../Images/d7b6ebf275b2189f4ce2ab28287c41aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*svJUT3dxuKdzCQle7fsHkA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">消息发布到主题:<em class="ou">新闻_搜索_流程</em></figcaption></figure><p id="f76d" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">云函数<em class="jt">process _ RSS _ Feed _ search()</em>运行成功，处理了从google News RSS Feed中提取的100篇文章:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ov"><img src="../Images/7a08c4d18235ea741d23d158b3586f69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ga8SeBFKB0Ykq6YUcoZcYA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">云函数process_rss_feed_search()日志</figcaption></figure><p id="edff" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">云函数<em class="jt">process _ RSS _ feed _ article()</em>成功运行100次，处理发布的文章:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ow"><img src="../Images/8561a2f955bc2a9ffd86f828d5b4dd55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S2YEw1KrybR-UaLbVmX5jg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">云函数process_rss_feed_article()日志</figcaption></figure><p id="8705" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">从网页中提取了100篇新闻文章，并在云存储中创建了Json文件:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ox"><img src="../Images/703784af9bcadfb081d5edab829416ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UTLgYFn0qO2FJiRyCQFZug.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">云存储—新闻文章Json文件</figcaption></figure><p id="e8ed" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">以下是生成的Json文件示例:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oy"><img src="../Images/1770200046f1f79368860d745d6a81fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cj5TM8rswpbCJn1Mzjc2gA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">新闻文章— Json文件示例</figcaption></figure><blockquote class="oz"><p id="9cb3" class="pa pb hi bd pc pd pe pf pg ph pi kn dx translated">我希望你喜欢这篇关于web抓取和无服务器云服务的介绍。在以后的文章中，我将介绍如何使用<a class="ae jn" href="https://spacy.io/" rel="noopener ugc nofollow" target="_blank"> Spacy python包</a>从新闻文章中提取实体的解决方案，以及如何使用<a class="ae jn" href="https://cloud.google.com/endpoints/" rel="noopener ugc nofollow" target="_blank">云端点</a>安全地公开Web服务。</p></blockquote></div></div>    
</body>
</html>