<html>
<head>
<title>Data Cleansing and Analysis: Reviewing SAT score correlations in New York public schools</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据清理和分析:回顾纽约公立学校SAT成绩的相关性</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/data-cleaning-and-dashboarding-reviewing-sat-score-correlations-in-new-york-public-schools-295174fd7247?source=collection_archive---------10-----------------------#2019-11-27">https://medium.com/analytics-vidhya/data-cleaning-and-dashboarding-reviewing-sat-score-correlations-in-new-york-public-schools-295174fd7247?source=collection_archive---------10-----------------------#2019-11-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/cd95a646f77f506f7d00c1b7db27f0a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MUu8e5CgK6f7Vo_MalN15w.jpeg"/></div></div></figure><p id="2880" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个项目的目的是从一个复杂的数据集中彻底清理和提供见解。为此，我们将导入并清理纽约市公立学校提供的各种数据源。</p><p id="8ab0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将探索相关性和可视化，看看数据中是否有任何值得注意的关系。</p><h1 id="4d04" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">调查结果摘要</h1><p id="9e47" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">似乎有几个因素与一所学校的平均SAT分数相关。特别是:</p><ul class=""><li id="4cb7" class="kr ks hi is b it iu ix iy jb kt jf ku jj kv jn kw kx ky kz bi translated">白人和亚裔学生比例较高的学校往往与较高的SAT分数相关，而黑人或西班牙裔学生比例较高的学校则与较低的SAT分数相关。</li><li id="72a9" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">当调查他们对学校安全、沟通、参与和学术期望的看法时，学生和教师的分数往往与sat平均分数一致。然而，父母的分数远不是可靠的指标。</li><li id="da9b" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">女生比例较高的学校往往在SAT平均分上得分较高。</li><li id="9dc2" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">学生参加更多AP考试的学校往往会有更高的SAT分数，但随着每个学生AP考试百分比的增长，这一趋势会趋于平稳。</li></ul><h1 id="70fc" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">数据清理</h1><p id="d047" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">这个项目的信息来自纽约市公立学校网站。</p><p id="f45c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将结合几个相关的数据集:</p><ul class=""><li id="5bd0" class="kr ks hi is b it iu ix iy jb kt jf ku jj kv jn kw kx ky kz bi translated">2012年学校SAT成绩—纽约市每所高中的平均SAT成绩</li><li id="b7fa" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">班级规模—每个学校的平均班级规模</li><li id="023c" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">AP考试成绩-每所高中的进阶先修(AP)考试成绩</li><li id="795a" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">毕业结果——毕业学生的百分比</li><li id="fb4a" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">人口统计-每个学校的人口统计信息</li><li id="a8b5" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">学校调查——对每个学校的家长、教师和学生的调查</li></ul><h1 id="063e" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">读入数据</h1><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="2e00" class="lp jp hi ll b fi lq lr l ls lt">import pandas as pd</span><span id="a2d1" class="lp jp hi ll b fi lu lr l ls lt"># Creating a dictionary of relevant dataframes<br/>data_files = [<br/> “ap_2010.csv”,<br/> “class_size.csv”,<br/> “demographics.csv”,<br/> “graduation.csv”,<br/> “hs_directory.csv”,<br/> “sat_results.csv”<br/>]<br/>data = {}<br/>for f in data_files:<br/> d = pd.read_csv(f)<br/> key_name = f.replace(“.csv”, “”)<br/> data[key_name] = d</span></pre><p id="b739" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">查看这些数据集后，似乎“DBN”是一个提供唯一学校标识符代码的公共字段。我们将使用这个代码作为我们学校的标识符，以一种有意义的方式合并这些数据集。</p><p id="0af1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">勘测数据包含在两个单独的“txt”文件中，需要使用适当的编码导入并合并成一个数据帧。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="8e12" class="lp jp hi ll b fi lq lr l ls lt">all_survey = pd.read_csv(‘survey_all.txt’, delimiter=”\t”, encoding=”windows-1252")</span><span id="ece1" class="lp jp hi ll b fi lu lr l ls lt">d75_survey = pd.read_csv(‘survey_d75.txt’, delimiter=”\t”, encoding=”windows-1252")</span><span id="6c81" class="lp jp hi ll b fi lu lr l ls lt">survey = pd.concat([all_survey, d75_survey], axis=0, sort=False)</span></pre><p id="12f4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">调查数据中有几列对于我们的分析是不必要的。使用<a class="ae lf" href="https://data.cityofnewyork.us/Education/NYC-School-Survey-2011/mnz3-dyi8" rel="noopener ugc nofollow" target="_blank">调查数据源网站</a>提供的数据字典，我们可以将数据集限制在相关列。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="2445" class="lp jp hi ll b fi lq lr l ls lt"># Creating a list of relevant columns and limiting the survey dataframe to selected columnss<br/>survey[‘DBN’] = survey[‘dbn’]<br/>cols_needed = [“DBN”, “rr_s”, “rr_t”, “rr_p”, “N_s”, “N_t”, “N_p”, “saf_p_11”, <br/> “com_p_11”, “eng_p_11”, “aca_p_11”, “saf_t_11”, “com_t_11”, “eng_t_11”, <br/> “aca_t_11”, “saf_s_11”, “com_s_11”, “eng_s_11”, “aca_s_11”, “saf_tot_11”, <br/> “com_tot_11”, “eng_tot_11”, “aca_tot_11”]<br/>survey = survey.loc[:,cols_needed]</span><span id="7531" class="lp jp hi ll b fi lu lr l ls lt"># Assigning this new dataset to the original data dictionary<br/>data[‘survey’] = survey</span></pre><p id="4f03" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">添加DBN栏目</strong></p><p id="072f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">测量数据没有与其他数据集类似的DBN值格式。但是，我们可以通过调整“CSD”字段的格式并将其添加到“学校代码”字段来创建此列。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="0610" class="lp jp hi ll b fi lq lr l ls lt"># Creating new column for adjusted DBN value<br/>data[‘hs_directory’][‘DBN’] = data[‘hs_directory’][‘dbn’]</span><span id="0cb3" class="lp jp hi ll b fi lu lr l ls lt"># Padding ‘CSD’ number with 2 spaces for formatting<br/>def pad_csd(num):<br/> return str(num).zfill(2)<br/>data[‘class_size’][‘padded_csd’] = data[‘class_size’][‘CSD’].apply(pad_csd)</span><span id="ee5f" class="lp jp hi ll b fi lu lr l ls lt"># Adding ‘CSD’ and ‘SCHOOL CODE’ to create new ‘DBN’ field<br/>data[‘class_size’][‘DBN’] = data[‘class_size’][‘padded_csd’] + data[‘class_size’][‘SCHOOL CODE’]</span><span id="8fa5" class="lp jp hi ll b fi lu lr l ls lt">print(data[‘class_size’].head())</span></pre><h1 id="c249" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">操纵数值</h1><p id="7dfb" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">在组合这些数据集之前，我们需要将几个字段转换成数值，而不是字符串。一旦完成，我们需要创建一个总的“sat_score ”,这是每个学校的数学、阅读和写作分数的总和。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="1f77" class="lp jp hi ll b fi lq lr l ls lt"># Converting SAT components to numeric values<br/>data[‘sat_results’][‘SAT Math Avg. Score’] = pd.to_numeric(data[‘sat_results’][‘SAT Math Avg. Score’], errors=’coerce’)<br/>data[‘sat_results’][‘SAT Critical Reading Avg. Score’] = pd.to_numeric(data[‘sat_results’][‘SAT Critical Reading Avg. Score’], errors=’coerce’)<br/>data[‘sat_results’][‘SAT Writing Avg. Score’] = pd.to_numeric(data[‘sat_results’][‘SAT Writing Avg. Score’], errors=’coerce’)</span><span id="62f6" class="lp jp hi ll b fi lu lr l ls lt"># Combining SAT components into final score<br/>data[‘sat_results’][‘sat_score’] = data[‘sat_results’][‘SAT Math Avg. Score’] + data[‘sat_results’][‘SAT Critical Reading Avg. Score’] + data[‘sat_results’][‘SAT Writing Avg. Score’]</span></pre><h1 id="a2ff" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">提取坐标</strong></h1><p id="4a89" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">为了在地图上绘制学校坐标，我们需要从单个字段中提取纬度和经度值，并将这些值分成两个字段。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="0977" class="lp jp hi ll b fi lq lr l ls lt">import re</span><span id="087f" class="lp jp hi ll b fi lu lr l ls lt"># creating a function with regex for finding latitude, splitting it from the longitude and returning the value<br/>def find_lat(loc):<br/> coords = re.findall(“\(.+\)”, loc)<br/> lat = coords[0].split(“,”)[0].replace(“(“,””)<br/> return lat</span><span id="93e8" class="lp jp hi ll b fi lu lr l ls lt"># storing this value in a new column<br/>data[‘hs_directory’][‘lat’] = data[‘hs_directory’][‘Location 1’].apply(find_lat)</span><span id="6646" class="lp jp hi ll b fi lu lr l ls lt"># creating a function with regex for finding longitude, splitting it from the latitude and returning the value<br/>def find_lon(loc):<br/> coords = re.findall(“\(.+\)”, loc)<br/> lat = coords[0].split(“,”)[1].replace(“)”,””)<br/> return lat</span><span id="5348" class="lp jp hi ll b fi lu lr l ls lt"># storing this value in a new column<br/>data[‘hs_directory’][‘lon’] = data[‘hs_directory’][‘Location 1’].apply(find_lon)</span><span id="2499" class="lp jp hi ll b fi lu lr l ls lt"># converting both to numeric<br/>data[‘hs_directory’][‘lat’] = pd.to_numeric(data[‘hs_directory’][‘lat’], errors=’coerce’)<br/>data[‘hs_directory’][‘lon’] = pd.to_numeric(data[‘hs_directory’][‘lon’], errors=’coerce’)</span></pre><h1 id="aa8c" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">压缩数据集</h1><p id="d916" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">现在，我们将为合并准备数据集，从“class_size”开始。为此，我们需要:</p><ul class=""><li id="715d" class="kr ks hi is b it iu ix iy jb kt jf ku jj kv jn kw kx ky kz bi translated">将数据集限制为仅包含高中信息(与SAT成绩相关)</li><li id="238c" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">将数据集限制为仅包含生成的类</li><li id="771b" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">将数据集限制为每个DBN/学校仅包含一个值</li><li id="9e72" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">删除DBN的所有重复条目，应用每个学校所有班级的平均规模。</li><li id="5173" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">按仅包含2012年的行进行筛选。</li><li id="b704" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">按“群组”为2006的行进行筛选</li><li id="a968" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">通过选择“人口统计”为“总群组”的行，仅保留汇总数据</li><li id="7302" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">将AP分数转换为数值</li></ul><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="eb69" class="lp jp hi ll b fi lq lr l ls lt">class_size = data[‘class_size’]<br/># limiting dataset to high school data<br/>class_size = class_size[class_size[‘GRADE ‘] == ‘09–12’]<br/># limiting type to ‘GEN Ed’<br/>class_size = class_size[class_size[‘PROGRAM TYPE’] == ‘GEN ED’]<br/>print(class_size.head())</span><span id="e70f" class="lp jp hi ll b fi lu lr l ls lt"># removing duplicates through aggregating by 'DBN'<br/># grouping by DBN and applying mean for all classes at a given school<br/>class_size = class_size.groupby('DBN').agg(numpy.mean)<br/># resetting index to retain DBN as column<br/>class_size.reset_index(inplace=True)<br/>data['class_size'] = class_size</span><span id="6a11" class="lp jp hi ll b fi lu lr l ls lt"># filtering for 2012 demographics<br/>data[“demographics”] = data[“demographics”][data[“demographics”][“schoolyear”] == 20112012]</span><span id="e48e" class="lp jp hi ll b fi lu lr l ls lt"># selecting most recent graduation data<br/>data['graduation'] = data['graduation'][data['graduation']['Cohort'] == '2006']<br/># selecting only 'Total Cohort' data<br/>data['graduation'] = data['graduation'][data['graduation']['Demographic'] == 'Total Cohort']</span><span id="2bd3" class="lp jp hi ll b fi lu lr l ls lt"># converting AP scores to numeric<br/>cols = ['AP Test Takers ', 'Total Exams Taken', 'Number of Exams with scores 3 4 or 5']</span><span id="5cf5" class="lp jp hi ll b fi lu lr l ls lt">for col in cols:<br/>    data['ap_2010'][col] = pd.to_numeric(data['ap_2010'][col], errors='coerce')<br/>print(data['ap_2010'].dtypes)</span></pre><p id="3507" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">合并数据集</strong></p><p id="d2a5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">清理之后，我们准备合并所有数据集。对于具有最相关信息的数据集，我们将使用左合并，以从‘sat _ results’数据集中维护尽可能多的信息。我们将使用DBN作为组合数据的唯一标识符。对于剩余的数据集，我们将利用“内部”连接，以确保在不添加无关行的情况下维护所有DBN值。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="4851" class="lp jp hi ll b fi lq lr l ls lt"># creating a new dataframe for compilation<br/>combined = data[“sat_results”]<br/>combined = combined.merge(data[‘ap_2010’], on=’DBN’, how=’left’)<br/>combined = combined.merge(data[‘graduation’], on=’DBN’, how=’left’)</span><span id="919b" class="lp jp hi ll b fi lu lr l ls lt"># inner merging other datasets<br/>combined = combined.merge(data['class_size'], how='inner', on='DBN')<br/>combined = combined.merge(data['demographics'], how='inner', on='DBN')<br/>combined = combined.merge(data['survey'], how='inner', on='DBN')<br/>combined = combined.merge(data['hs_directory'], how='inner', on='DBN')</span></pre><h1 id="d1e0" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">填充缺失数据</h1><p id="d8e2" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">最后，我们将使用每列的平均值填充缺失数据，并用0替换所有空值。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="f483" class="lp jp hi ll b fi lq lr l ls lt">means = combined.mean()<br/># filling in empty values with the mean of each column<br/>combined = combined.fillna(means)<br/># replacing nan values with 0<br/>combined = combined.fillna(0)<br/>print(combined.head())</span></pre><h1 id="c292" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">为映射添加学区列</h1><p id="1465" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">为了更好地帮助我们聚合和映射学校，我们可以创建一个“school_dist”列，其中包含每个学校所在地区的信息。学区被表示为“DBN”字段的前两个字符。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="5dc5" class="lp jp hi ll b fi lq lr l ls lt"># a function to extract the first two characters of a value<br/>def extstr(s):<br/> return s[0:2]<br/># applying this function to extract school district<br/>combined[‘school_dist’] = combined[‘DBN’].apply(extstr)<br/>print(combined[‘school_dist’].head())</span></pre><h1 id="29dc" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">探索性数据分析</h1><p id="f624" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">现在数据已经整理好了，我们将通过探索相关性和创建基本的可视化来初步了解这些数据。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="eff1" class="lp jp hi ll b fi lq lr l ls lt">correlations = combined.corr()<br/>correlations = correlations[‘sat_score’].sort_values()<br/>print(correlations)</span></pre><p id="7f76" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从这些原始数据来看，似乎有一些有趣的相关性值得探索。具体而言，种族和性别人口统计数据似乎与性别或种族正相关和负相关。此外，虽然“AP考生”字段正相关，但“ell_percent”字段负相关。</p><p id="9517" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了更深入地探索这些关系，我们将创建一些可视化效果。</p><h1 id="913f" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">绘制英语语言相关性</strong></h1><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="5370" class="lp jp hi ll b fi lq lr l ls lt">import matplotlib.pyplot as plt<br/>combined.plot.scatter(x=”ell_percent”, y=”sat_score”)<br/>plt.show()<br/>plt.savefig(‘eng_corr.png’, dpi=300, bbox_inches=’tight’)</span></pre><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/f8221ab6f590d35ca4384e7f7c6754c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eb2pG4dre-33PR1TqnwWew.png"/></div></div></figure><p id="7c97" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从这张散点图来看，非英语母语学生比例较高的学校在SAT考试中得分较低。</p><h1 id="b466" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">绘制调查相关性</h1><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="571f" class="lp jp hi ll b fi lq lr l ls lt">column_list = combined.loc[:,’saf_p_11':’aca_s_11']<br/>column_list[‘sat_score’] = combined[‘sat_score’]<br/>correlations = column_list.corr()<br/>correlations = correlations[‘sat_score’].sort_values()<br/>import matplotlib.pyplot as plt<br/>correlations.plot.bar()<br/>plt.savefig(‘surv_corr.png’, dpi=300, bbox_inches=’tight’)<br/>plt.show()</span></pre><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/85ce9f63683a71ed6027ea0be5d81427.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AHAokFz2IAS9h1nmy1uLZA.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">p' =家长，t =老师，s =学生</figcaption></figure><p id="cbc0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">根据这一数据，家长(p值变量)在以反映学校SAT分数的方式对学校安全、沟通、参与和学术期望进行排名时往往较差。一般来说，学生们倾向于根据预期的SAT分数对这些因素进行排序。</p><h1 id="7799" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">调查安全性分数</h1><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="0817" class="lp jp hi ll b fi lq lr l ls lt">import matplotlib.pyplot as plt<br/>combined.plot.scatter(x=”saf_s_11", y=”sat_score”)<br/>plt.savefig(‘safety_corr.png’, dpi=300, bbox_inches=’tight’)<br/>plt.show()</span></pre><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/88132e6c1b8140082ee9e1d680326100.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-tGUfkLT9SqTaHR03gaKXg.png"/></div></div></figure><p id="7fdc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">根据这个图，看起来好像学生的“安全和尊重”分数与学校的平均SAT分数正相关。这意味着，在学生感到安全和受尊重的学校，SAT分数往往更高，这是意料之中的。</p><h1 id="ee6d" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">按地区绘制安全分数</h1><p id="af62" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">另一种我们可以聚合数据的方式是按学区，这允许我们以有意义的方式按地理位置绘制数据。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="75b4" class="lp jp hi ll b fi lq lr l ls lt">import numpy</span><span id="5d45" class="lp jp hi ll b fi lu lr l ls lt">districts = combined.groupby(‘school_dist’).agg(numpy.mean)<br/>districts.reset_index(inplace=True)<br/>print(districts.head())</span><span id="e5ef" class="lp jp hi ll b fi lu lr l ls lt">from mpl_toolkits.basemap import Basemap<br/>plt.figure(figsize=(10, 10))<br/>m = Basemap(<br/>    projection='merc', <br/>    llcrnrlat=40.496044, <br/>    urcrnrlat=40.915256, <br/>    llcrnrlon=-74.255735, <br/>    urcrnrlon=-73.700272,<br/>    resolution='i'<br/>)</span><span id="d457" class="lp jp hi ll b fi lu lr l ls lt">m.drawmapboundary(fill_color='#ffffff')<br/>m.drawcoastlines(color='#6D5F47', linewidth=.4)<br/>m.drawrivers(color='#6D5F47', linewidth=.4)<br/>longitudes = districts['lon'].tolist()<br/>latitudes = districts['lat'].tolist()<br/>m.scatter(longitudes, latitudes, s=300, zorder=2, latlon=True, c=districts['saf_s_11'], cmap='summer')<br/>plt.savefig('district_safety_map.png', dpi=300, bbox_inches='tight')<br/>plt.show()</span></pre><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/b7710ed415b362dfad1a8f21093ea19a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-cOHqaKX2PcojiRPfsfQTg.png"/></div></div></figure><p id="f556" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在该图中，较暗的颜色代表较低的分数。因此，最高分似乎在布朗克斯南部、曼哈顿、布鲁克林西南部和皇后区北部。得分较低的似乎是布鲁克林中部、上布朗克斯区、皇后区东部和斯塔滕岛。</p><p id="f2bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">绘制种族关联图</strong></p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="24a0" class="lp jp hi ll b fi lq lr l ls lt">column_list_race = correlations[[‘white_per’, ‘asian_per’, ‘black_per’, ‘hispanic_per’]]</span><span id="00a7" class="lp jp hi ll b fi lu lr l ls lt">import matplotlib.pyplot as plt<br/>column_list_race.plot.bar()<br/>plt.savefig(‘racial_corr.png’, dpi=300, bbox_inches=’tight’)<br/>plt.show()</span></pre><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/926d86a58af10d926e7df7779e6097d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iPAazJ6BO-lOU7AQx1eNCw.png"/></div></div></figure><p id="985a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">根据这幅图，白人或亚裔学生比例较高的学校往往SAT平均分较高。黑人或西班牙裔学生比例较高的学校，SAT平均分往往较低。</p><h1 id="274d" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">探索西班牙裔种族的相关性</h1><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="c586" class="lp jp hi ll b fi lq lr l ls lt">import matplotlib.pyplot as plt<br/>combined.plot.scatter(x=”hispanic_per”, y=”sat_score”)<br/>plt.savefig(‘hispanic_scatter.png’, dpi=300, bbox_inches=’tight’)<br/>plt.show()</span></pre><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/7334a91ec5c7b0dd52d30924b116c046.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MTZlVAkr3Xqy3tTz-5QdeA.png"/></div></div></figure><p id="4d48" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个散点图告诉我们，大多数学校倾向于围绕SAT平均分数聚集，而不管西班牙裔学生的百分比。然而，那些西班牙裔学生比例很高的学校往往在SAT考试中得分很低，而那些西班牙裔学生比例很低的学校则有更多的机会获得更高的平均分。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="5d55" class="lp jp hi ll b fi lq lr l ls lt"># selecting schools with a hispanic population greater than 95%<br/>high_hispanic_pop = combined[combined[‘hispanic_per’] &gt; 95]<br/>print(high_hispanic_pop[“School Name”])<br/>44             MANHATTAN BRIDGES HIGH SCHOOL<br/>82                                         0<br/>89     GREGORIO LUPERON HIGH SCHOOL FOR SCIE<br/>125                                        0<br/>141    INTERNATIONAL SCHOOL FOR LIBERAL ARTS<br/>176                                        0<br/>253                MULTICULTURAL HIGH SCHOOL<br/>286    PAN AMERICAN INTERNATIONAL HIGH SCHOO<br/>Name: School Name, dtype: object</span></pre><ul class=""><li id="31cf" class="kr ks hi is b it iu ix iy jb kt jf ku jj kv jn kw kx ky kz bi translated"><a class="ae lf" href="https://www.usnews.com/education/best-high-schools/new-york/districts/new-york-city-public-schools/manhattan-bridges-high-school-13105" rel="noopener ugc nofollow" target="_blank">曼哈顿桥高中</a>似乎是一所100%的少数族裔学校，高度重视AP考试和标准化分数。</li><li id="ebf4" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">SCIE的<a class="ae lf" href="https://insideschools.org/school/06M552" rel="noopener ugc nofollow" target="_blank">格雷戈里奥·鲁佩隆高中</a>是一所为讲西班牙语的学生开设的以科学为主题的学校。</li><li id="9fcb" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">国际文理学院是一所面向双语学生的学校，非常注重人文教育。</li><li id="bf26" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">多元文化高中专注于帮助新移民的学生学习英语。</li><li id="ef98" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">泛美国际高中同样关注说西班牙语的学生。</li></ul><p id="0d14" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些学校往往在SAT考试中表现不佳，但主要集中于非英语国家的学生。因此，他们在英语标准化考试中的成绩是意料之中的。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="8c0b" class="lp jp hi ll b fi lq lr l ls lt"># selecting schools with a hispanic population less than 10% and SAT score over 1800<br/>low_hispanic_pop = combined[combined[‘hispanic_per’] &lt; 10]<br/>low_hispanic_pop = combined[combined[‘sat_score’] &gt; 1800]<br/>print(low_hispanic_pop[“School Name”])<br/>5             BARD HIGH SCHOOL EARLY COLLEGE<br/>37                    STUYVESANT HIGH SCHOOL<br/>79      HIGH SCHOOL FOR MATHEMATICS  SCIENCE<br/>151             BRONX HIGH SCHOOL OF SCIENCE<br/>155    HIGH SCHOOL OF AMERICAN STUDIES AT LE<br/>187           BROOKLYN TECHNICAL HIGH SCHOOL<br/>302              TOWNSEND HARRIS HIGH SCHOOL<br/>327    QUEENS HIGH SCHOOL FOR THE SCIENCES A<br/>356      STATEN ISLAND TECHNICAL HIGH SCHOOL<br/>Name: School Name, dtype: object</span></pre><ul class=""><li id="920a" class="kr ks hi is b it iu ix iy jb kt jf ku jj kv jn kw kx ky kz bi translated"><a class="ae lf" href="https://bhsec.bard.edu/manhattan/" rel="noopener ugc nofollow" target="_blank">巴德高中</a>是一所与巴德学院有关联的大学预科学校。</li><li id="82b9" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><a class="ae lf" href="https://stuy.enschool.org/" rel="noopener ugc nofollow" target="_blank">施托伊弗桑特高中</a>是另一所以学术为重点的学校，亚裔学生比例很高。</li><li id="e879" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><a class="ae lf" href="https://hsmse.org/" rel="noopener ugc nofollow" target="_blank">数学和科学高中</a>是另一所与纽约城市学院相关的预备学校。</li><li id="992d" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">布朗克斯科学高中是一所专门致力于科学学习的学校。</li><li id="85f7" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">LE的美国研究高中(High School of American Studies)专注于美国历史，隶属于雷曼学院(Lehman College)。</li></ul><p id="0c54" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个子集高度集中在学术上，有几所学校与当地的学院和大学合作。虽然他们看起来文化多元，但他们的西班牙裔学生明显比该地区的其他学校少得多。</p><h1 id="b915" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">调查性别差异</h1><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="e50a" class="lp jp hi ll b fi lq lr l ls lt">column_list_gender = correlations[[‘male_per’, ‘female_per’]]<br/>column_list_gender.plot.bar()<br/>plt.savefig(‘gender_corr.png’, dpi=300, bbox_inches=’tight’)<br/>plt.show()</span></pre><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/5cc7a0737813347bbe54627d4c7cc747.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*__PcCvow_c7XgvDWUi20Lw.png"/></div></div></figure><p id="ffe7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">虽然这些类别中的相关百分比很小(小于0 . 15)，但似乎女生百分比较高的学校往往在SAT考试中得分较高，而男生百分比较高的学校往往在SAT考试中得分较低。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="04ad" class="lp jp hi ll b fi lq lr l ls lt">import matplotlib.pyplot as plt<br/>combined.plot.scatter(x=”female_per”, y=”sat_score”)<br/>plt.savefig(‘female_scatter.png’, dpi=300, bbox_inches=’tight’)<br/>plt.show()</span></pre><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/2a50b870abac7d4dafbd932391fd9f50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r-i1JZFarAmSy8Pi7OxbXg.png"/></div></div></figure><p id="3e83" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该散点图显示，一所学校的平均SAT分数往往随着女生比例的增加而增加。然而，完全由女性组成的学校不一定在SAT考试中得分最高。这使得人们相信这种相关性可能是由其他因素造成的。例如，总体而言，女生比例较高的学校可能更注重学术。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="aadb" class="lp jp hi ll b fi lq lr l ls lt"># selecting schools with a female population greater than 60% and SAT score greater than 1700<br/>hi_female_pop = combined[combined[‘female_per’] &gt; 60]<br/>hi_female_pop = combined[combined[‘sat_score’] &gt; 1700]<br/>print(hi_female_pop[“School Name”])<br/>5             BARD HIGH SCHOOL EARLY COLLEGE<br/>26             ELEANOR ROOSEVELT HIGH SCHOOL<br/>37                    STUYVESANT HIGH SCHOOL<br/>60                        BEACON HIGH SCHOOL<br/>61      FIORELLO H. LAGUARDIA HIGH SCHOOL OF<br/>79      HIGH SCHOOL FOR MATHEMATICS  SCIENCE<br/>151             BRONX HIGH SCHOOL OF SCIENCE<br/>155    HIGH SCHOOL OF AMERICAN STUDIES AT LE<br/>187           BROOKLYN TECHNICAL HIGH SCHOOL<br/>198               BROOKLYN LATIN SCHOOL  THE<br/>302              TOWNSEND HARRIS HIGH SCHOOL<br/>327    QUEENS HIGH SCHOOL FOR THE SCIENCES A<br/>356      STATEN ISLAND TECHNICAL HIGH SCHOOL<br/>Name: School Name, dtype: object</span></pre><ul class=""><li id="0fdd" class="kr ks hi is b it iu ix iy jb kt jf ku jj kv jn kw kx ky kz bi translated"><a class="ae lf" href="https://bhsec.bard.edu/manhattan/" rel="noopener ugc nofollow" target="_blank">巴德高中</a>是一所与巴德学院有关联的大学预科学校。</li><li id="4522" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">Stuyvesant高中是另一所重视学术的学校，亚裔学生比例很高。</li><li id="8250" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">埃莉诺·罗斯福高中是一所注重学术的筛选学校。</li><li id="ffcd" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated">灯塔高中专注于技术和艺术。</li><li id="bd19" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><a class="ae lf" href="https://www.laguardiahs.org/" rel="noopener ugc nofollow" target="_blank"> Fiorello H. Laguardia高中</a>是一所以表演艺术为重点的学校，入学是通过试听过程筛选的。</li></ul><p id="2729" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">同样，这些学校往往是预备学校，或者那些侧重于科学和艺术的学校。</p><h1 id="f3cc" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">调查AP测试相关性</h1><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="3a42" class="lp jp hi ll b fi lq lr l ls lt"># Creating an ap_per value, the average number of tests taken per student<br/>combined[‘ap_per’] = (combined[‘AP Test Takers ‘] / combined[‘total_enrollment’])<br/>import matplotlib.pyplot as plt<br/>combined.plot.scatter(x="ap_per", y="sat_score")<br/>plt.savefig('ap_scatter.png', dpi=300, bbox_inches='tight')<br/>plt.show()</span></pre><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/d7736e5fed890d2d738636ef0550d976.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TbctfkaP0hP0pspZHx0BYg.png"/></div></div></figure><p id="cc90" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这幅图中，似乎每所高中参加AP考试的学生比例与SAT平均分有着有趣的关联。在0%和0.6%之间，相关性似乎是正的。然而，参加AP考试的学生比例超过0.6%的学校往往根本不会提高SAT的平均成绩。相反，它徘徊在1200点上方。</p><h1 id="0f14" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">GitHub / Jupyter笔记本</h1><p id="a1a5" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">关于这个项目代码的完整Jupyter笔记本，请访问我的<a class="ae lf" href="https://github.com/e-kirkland/datascience/tree/master/NYC%20Schools" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>。</p></div></div>    
</body>
</html>