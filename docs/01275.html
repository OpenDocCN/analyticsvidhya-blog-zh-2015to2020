<html>
<head>
<title>How to save and load your Scikit-learn models in a minute</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在一分钟内保存和加载您的Scikit-learn模型</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/save-and-load-your-scikit-learn-models-in-a-minute-21c91a961e9b?source=collection_archive---------2-----------------------#2019-10-12">https://medium.com/analytics-vidhya/save-and-load-your-scikit-learn-models-in-a-minute-21c91a961e9b?source=collection_archive---------2-----------------------#2019-10-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="9d48" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">权威指南</h2><div class=""/><figure class="ev ex ip iq ir is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es io"><img src="../Images/9fe59a5c65f74337e6c4f59041e0fa7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Aai22yayTbCSkWnMvO9OtA.jpeg"/></div></div><figcaption class="iz ja et er es jb jc bd b be z dx translated">保存泡菜</figcaption></figure><p id="a07b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">你有没有建立过机器学习模型，想知道如何拯救它们？接下来，我将向您展示如何将Scikit学习模型保存为一个文件。</p><p id="1860" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">数据的保存被称为<strong class="jf hs"> <em class="kb">序列化，</em> </strong>我们将一个对象存储为字节流保存在磁盘上。加载或恢复模型被称为<strong class="jf hs"> <em class="kb">反序列化，</em> </strong>其中我们将字节流从磁盘恢复回Python对象。</p><p id="b585" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hs"> <em class="kb">你应该保存你的模型的理由？</em>T11】</strong></p><ol class=""><li id="557f" class="kc kd hi jf b jg jh jk jl jo ke js kf jw kg ka kh ki kj kk bi translated">以防你需要重建训练好的模型。</li><li id="4d0a" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">与他人分享模型。我们可以将模型保存到一个文件中，并与其他人共享该文件，可以加载该文件来进行预测。</li><li id="0120" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">当您需要将模型用于生产目的时。为了避免长时间的训练，我们在一个巨大的数据集上训练了该模型，并拥有一个性能良好的预测模型。</li></ol><p id="d701" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hs"><em class="kb">sci kit中保存和恢复模型的工具-学习</em> </strong></p><p id="a3bf" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们描述的第一个工具是<a class="ae kq" href="https://docs.python.org/3/library/pickle.html" rel="noopener ugc nofollow" target="_blank"> Pickle </a>，这是用于对象序列化和反序列化的标准Python工具。然后，我们看一下<a class="ae kq" href="https://pythonhosted.org/joblib/" rel="noopener ugc nofollow" target="_blank"> Joblib </a>库，它提供了包含大型数据数组的对象的简单序列化(反序列化),最后，我们展示了一种手动方法，用于将对象保存到<a class="ae kq" href="https://en.wikipedia.org/wiki/JSON" rel="noopener ugc nofollow" target="_blank"> JSON </a> (JavaScript对象符号)和从JSON【】恢复对象。这些方法都不是最佳解决方案，但是应该根据项目的需要选择合适的方法。</p><p id="8855" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hs"> <em class="kb">模型初始化</em> </strong></p><p id="52f4" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">首先，让我们创建一个scikit-learn模型。在我们的例子中，我们将使用一个<a class="ae kq" href="https://en.wikipedia.org/wiki/Logistic_regression" rel="noopener ugc nofollow" target="_blank">逻辑回归</a>模型和<a class="ae kq" href="https://en.wikipedia.org/wiki/Iris_flower_data_set" rel="noopener ugc nofollow" target="_blank">虹膜数据集</a>。让我们导入所需的库，加载数据，并将其分成训练集和测试集。</p><figure class="ks kt ku kv fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es kr"><img src="../Images/79484fc1de6979f31ff2d4f2b4d78ca0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q-aPNqAh7mx0TO1G2-M4VA.png"/></div></div></figure><p id="a2e5" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在，让我们使用一些非默认参数创建模型，并使其符合训练数据。我们假设您之前已经找到了模型的最佳参数，即产生最高估计精度的参数。</p><figure class="ks kt ku kv fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es kw"><img src="../Images/4f2e10f4d6a486d52da66b8db469bc4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z9cAPuFV5uYZOUWIUmnLoA.png"/></div></div></figure><p id="e15f" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">使用<code class="du kx ky kz la b">fit</code>方法，模型已经学习了存储在<code class="du kx ky kz la b">model.coef_</code>中的系数。目标是将模型的参数和系数保存到文件中，这样就不需要对新数据重复模型训练和参数优化步骤。</p><figure class="ks kt ku kv fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es lb"><img src="../Images/66ac92ad9bdf5560f114b0ea4810a74b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0jYJ1YPbyJ84aqGgytnUuA.png"/></div></div></figure><p id="dde7" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们的模型现在已经训练好了。我们可以保存该模型，并在以后加载该模型，以便对看不见的数据进行预测。</p><p id="b196" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hs"> <em class="kb">用泡菜拯救你的模特</em> </strong></p><p id="cdd6" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Pickle用于序列化和反序列化Python对象结构，也称为编组或展平。序列化是指将内存中的对象转换为可以存储在磁盘上或通过网络发送的字节流的过程。稍后，可以检索这个字符流，并将其反序列化回Python对象。当您使用机器学习算法时，Pickle非常有用，您需要保存它们以便能够在以后生成预测，而不必重写所有内容。</p><figure class="ks kt ku kv fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es lc"><img src="../Images/1c64a910ecea20e6c499c18a72f48301.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LTuep_8wr2z0Q-OmFL6jVQ.png"/></div></div></figure><p id="f579" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hs"> <em class="kb">用Joblib </em> </strong>保存你的模型</p><p id="cb35" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><a class="ae kq" href="https://pypi.python.org/pypi/joblib" rel="noopener ugc nofollow" target="_blank"> Joblib </a>是SciPy生态系统的一部分，为管道化Python作业提供了实用程序。它提供了<a class="ae kq" href="https://pythonhosted.org/joblib/generated/joblib.dump.html" rel="noopener ugc nofollow" target="_blank">实用程序，用于有效地保存和加载利用NumPy数据结构的Python对象</a>。这对于一些需要大量参数或存储整个数据集(如K-最近邻)的机器学习算法非常有用。尽管Pickle要求将文件对象作为参数传递，但Joblib既可以处理文件对象，也可以处理字符串文件名。如果您的模型包含大型数据数组，每个数组将存储在一个单独的文件中，但保存和恢复过程将保持不变。</p><figure class="ks kt ku kv fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es ld"><img src="../Images/bac0227d3cba00e0e1c7d0d2cec197bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*62D7RR1UFz7UtURuv-JLdA.png"/></div></div></figure><p id="a248" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hs"> <em class="kb">使用JSON格式保存你的模型</em> </strong></p><p id="7cd4" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">根据您的项目，很多时候您会发现Pickle和Joblib是不合适的解决方案。其中一些原因将在后面的考虑因素一节中讨论。我们将首先导入JSON库，创建一个包含系数和截距的字典。系数和截距是一个数组对象。我们不能将数组转储为JSON字符串，所以我们将数组转换为一个列表，并将其存储在字典中</p><figure class="ks kt ku kv fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es le"><img src="../Images/b72b4b35ef9662947552f77d4c5809ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LK-WL4ZObUbeJD8tTon3rA.png"/></div></div></figure><p id="4bf2" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们使用JSON转储将Python字典转换成JSON字符串。我们需要缩进输出，所以我们提供缩进参数，并将其设置为4。将JSON字符串保存到文件中。</p><figure class="ks kt ku kv fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es lf"><img src="../Images/b493a0f0c272252a631965fe0bd55077.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WtFuDZSsXNpov0SydTXUhg.png"/></div></div></figure><p id="7b87" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们将文件内容加载到一个JSON字符串中。以“读取”模式打开文件，然后将JSON数据加载到python对象中，在我们的例子中，python对象是一个字典</p><figure class="ks kt ku kv fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es lg"><img src="../Images/7931fdcff3eecc5254b21ec70280bc7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OThvikiDmnvwmcMKOj6sJA.png"/></div></div></figure><p id="43b4" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">因为使用JSON的数据序列化实际上将对象保存为字符串格式，而不是字节流，所以可以用文本编辑器打开和修改“regressor_param.txt”文件。虽然这种方法对开发人员来说很方便，但是它不太安全，因为入侵者可以查看和修改JSON文件的内容。</p><p id="3837" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hs"> <em class="kb">考虑章节</em> </strong></p><ol class=""><li id="e7e2" class="kc kd hi jf b jg jh jk jl jo ke js kf jw kg ka kh ki kj kk bi translated">Pickle和Joblib工具的最大缺点是它们对不同模型和Python版本的兼容性。</li><li id="3e7a" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">在保存和恢复模型之间，模型的内部结构应该保持不变</li><li id="094e" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">从已知来源接收时恢复模型，以避免任何恶意代码。Pickle和Joblib都可能包含恶意代码，因此不建议从不受信任或未经验证的来源恢复数据。</li></ol><p id="841a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hs"> <em class="kb">结论</em> </strong></p><p id="71b1" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">恭喜你！现在，您已经准备好使用Python对文件进行酸洗和反酸洗了。您将能够保存您的机器学习模型，并在以后继续使用它们。Pickle和Joblib库使用起来既快速又简单，但是在不同的Python版本和学习模型的变化之间存在兼容性问题。</p><p id="88c1" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">数据科学新手？需要指导吗？</p><p id="f6ae" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">你可以从这里伸出手</p><ul class=""><li id="5f71" class="kc kd hi jf b jg jh jk jl jo ke js kf jw kg ka lh ki kj kk bi translated">推特:@ akinwhande</li><li id="ca82" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka lh ki kj kk bi translated">Linkedin: <a class="ae kq" href="https://www.linkedin.com/in/akinwande-komolafe-49166b147/" rel="noopener ugc nofollow" target="_blank">阿金万德</a></li></ul><p id="2831" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">喜欢这篇文章吗？然后在medium上关注我，获取更多有见地的文章。</p><p id="f8ef" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我参与了一个开源项目，帮助数据科学家解决基本数据争论和预处理步骤的问题。Slik背后的想法是启动监督学习项目。文档链接可在<a class="ae kq" href="https://sensei-akin.github.io/slik_python_package/html/index.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p></div></div>    
</body>
</html>