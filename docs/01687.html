<html>
<head>
<title>Macro Programming in OpenOffice/LibreOffice with using Python[EN]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python在OpenOffice/LibreOffice中进行宏编程[EN]</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/macro-programming-in-openoffice-libreoffice-with-using-python-en-a37465e9bfa5?source=collection_archive---------0-----------------------#2019-11-09">https://medium.com/analytics-vidhya/macro-programming-in-openoffice-libreoffice-with-using-python-en-a37465e9bfa5?source=collection_archive---------0-----------------------#2019-11-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1cd62c91a6c7845c776de52f098f65d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tkKcycpPe-j8x0nWwbGK4w.png"/></div></div></figure><p id="d143" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">开源世界正在飞速发展。为此，我已经开始学习LibreOffice中的宏编程。在我将要写的关于宏编程的前两三个故事中，我将主要使用这个<a class="ae jo" href="http://christopher5106.github.io/office/2015/12/06/openoffice-libreoffice-automate-your-office-tasks-with-python-macros.html" rel="noopener ugc nofollow" target="_blank">教程</a>。但它有一些缺失的部分，从零开始有点复杂。所以如果你有任何我没有提到的问题，你可以看看这个。</p><h1 id="7221" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">什么是图书馆办公室？</strong></h1><p id="c649" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">LibreOffice相当于开源软件界的微软Office。还有一种类似LibreOffice的办公方式叫做OpenOffice。OpenOffice与LibreOffice几乎相同，我在OpenOffice中对LibreOffice所做的工作也是如此。如果你愿意，你可以从<a class="ae jo" href="https://www.howtogeek.com/187663/openoffice-vs.-libreoffice-whats-the-difference-and-which-should-you-use/" rel="noopener ugc nofollow" target="_blank">这里</a>看到它们之间的区别。</p><h1 id="408a" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">图书馆的组成</strong></h1><p id="507f" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">图书馆办公室有四个主要部分。Writer是文字处理器，Calc是电子表格程序，Impress是演示程序，Draw是类似微软的Visio的程序。</p><h1 id="2661" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">开始使用宏</h1><p id="1bdd" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">要开始在LibreOffice中使用宏，我们需要先进行设置。让我们现在做这些。</p><p id="bede" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们应该去<strong class="is hj">图书馆&gt;工具&gt;选项&gt;图书馆&gt;安全</strong></p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/93becc76d04582e8fe8cff3a681e8e3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T1ecCnvKObxZ_JEMYuWh9Q.png"/></div></div></figure><p id="2084" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并更改<strong class="is hj">宏安全&gt;介质</strong></p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kx"><img src="../Images/81a0d490b4b2bfc57e2c786de2048107.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a5-HeQI5Q_dvzjDPlSC-hQ.png"/></div></div></figure><p id="49f7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这样，LibreOffice将允许我们使用我们的宏，但也将保护我们免受我们不知道来源的宏的影响。</p><h1 id="ad82" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">为什么是Python？</h1><p id="75fb" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">宏是在office套件中运行的程序代码片段，有助于自动化日常任务。具体来说，在LibreOffice API中，多亏了通用网络对象(UNO ),这些代码可以用如此多的编程语言编写。其中有:Open/LibreOffice Basic(感谢<a class="ae jo" rel="noopener" href="/@f.s.farimani?source=responses-----a37465e9bfa5----1----------------------------"> Foad S Farimani </a>的更正:)、Java、C/C++、Javascript、Python。</p><p id="92e9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">那么我们应该使用哪种语言呢？由于LibreOffice是多平台的，我们可以在不同的平台上使用我们的文档，如Mac、Windows和Linux。所以我们需要一种跨平台的语言来在不同的平台上运行我们的宏。因此，我们可以取消Visual Basic。</p><p id="45ea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Java和C/C++需要编译，更加复杂和冗长。所以我们也可以排除这些。</p><p id="1b34" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们选择JavaScript，我们在处理数字时可能会遇到一些问题。例如，它有舍入误差(Javascript中的<code class="du ky kz la lb b">0.1 + 0.2</code>不等于<code class="du ky kz la lb b">0.3</code>)。所以我们也可以排除这个。但是Python在数值计算方面非常强大，这要归功于它的库。库likeNumpy和Numexpr非常适合这项工作。所以宏编程应该选择Python 3。</p><h1 id="9192" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">从命令行连接到LibreOffice</h1><p id="d76d" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">在我们创建自己的宏之前，让我们看看如何通过从命令行连接到LibreOffice来使用Python操作LibreOffice。</p><p id="b5a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，用一个打开的套接字启动LibreOffice Calc，以便从shell进行通信。</p><p id="8ff2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于Linux:</p><pre class="kt ku kv kw fd lc lb ld le aw lf bi"><span id="b7d4" class="lg jq hi lb b fi lh li l lj lk">soffice --calc --accept="socket,host=localhost,port=2002;urp;StarOffice.ServiceManager"</span></pre><p id="766d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">更新</strong>:我更新了我的Libreoffice之后，office command就不再工作了。要联系office，您可以这样写:</p><pre class="kt ku kv kw fd lc lb ld le aw lf bi"><span id="e774" class="lg jq hi lb b fi lh li l lj lk">/opt/libreoffice$VERSION/program/soffice --calc --</span></pre><p id="9e5f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">$VERSION是您的libreoffice版本。</p><p id="04ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于Mac OS:</p><pre class="kt ku kv kw fd lc lb ld le aw lf bi"><span id="23c7" class="lg jq hi lb b fi lh li l lj lk">/Applications/LibreOffice.app/Contents/MacOS/soffice --calc \<br/>--accept<strong class="lb hj">=</strong>"socket,host=localhost,port=2002;urp;StarOffice.ServiceManager"</span></pre><p id="5df2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于Windows:</p><pre class="kt ku kv kw fd lc lb ld le aw lf bi"><span id="718f" class="lg jq hi lb b fi lh li l lj lk">"C:\\Program Files (x86)\LibreOffice 5\program\soffice.exe" --calc --accept="socket,host=localhost,port=2002;urp;"</span></pre><p id="50a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将这些命令写入注释行，这将打开Calc。</p><p id="18cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">(如果您有任何问题，请看一下<a class="ae jo" href="http://www.openoffice.org/udk/python/python-bridge.html" rel="noopener ugc nofollow" target="_blank">提出的解决方法</a>。)</p><p id="f76e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们必须打开Python Shell。</p><p id="2dd8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于Linux:</p><p id="d286" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们需要开放另一个终端，因为这个终端正忙于开放图书馆。在新的终端中写下这个。</p><pre class="kt ku kv kw fd lc lb ld le aw lf bi"><span id="bac1" class="lg jq hi lb b fi lh li l lj lk">python3</span></pre><p id="c359" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="ll">更新:</em> </strong> <em class="ll">这可能会在您尝试下一个命令时给出此错误:</em></p><pre class="kt ku kv kw fd lc lb ld le aw lf bi"><span id="1e10" class="lg jq hi lb b fi lh li l lj lk">ModuleNotFoundError: No module named ‘uno</span></pre><p id="7852" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果发生这种情况，你应该使用LibreOffice附带的Python解释器。您可以在:找到它</p><pre class="kt ku kv kw fd lc lb ld le aw lf bi"><span id="c9a1" class="lg jq hi lb b fi lh li l lj lk">/opt/libreoffice$VERSION/program/python</span></pre><p id="082d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于Mac OS:</p><pre class="kt ku kv kw fd lc lb ld le aw lf bi"><span id="13e6" class="lg jq hi lb b fi lh li l lj lk">/Applications/LibreOffice.app/Contents/MacOS/python</span></pre><p id="1a0c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ll">(更新)Mac OS的正确路径(感谢</em> <a class="ae jo" rel="noopener" href="/@f.s.farimani?source=post_page-----f6b6eb540c07--------------------------------"> Foad S Farimani </a>):</p><pre class="kt ku kv kw fd lc lb ld le aw lf bi"><span id="abe9" class="lg jq hi lb b fi lh li l lj lk"><em class="ll">/Applications/LibreOffice.app/Contents/Resources/python</em></span></pre><p id="7ebb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于Windows:</p><pre class="kt ku kv kw fd lc lb ld le aw lf bi"><span id="a4e2" class="lg jq hi lb b fi lh li l lj lk">"C:\\Program Files (x86)\LibreOffice 5\program\python.exe"</span></pre><p id="66d7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们在打开的Python Shell上写这些代码。</p><pre class="kt ku kv kw fd lc lb ld le aw lf bi"><span id="e50b" class="lg jq hi lb b fi lh li l lj lk">import socket  <em class="ll"># only needed on win32-OOo3.0.0</em><br/>import uno</span><span id="1653" class="lg jq hi lb b fi lm li l lj lk"><em class="ll"># get the uno component context from the PyUNO runtime</em><br/>localContext <strong class="lb hj">=</strong> uno<strong class="lb hj">.</strong>getComponentContext()</span><span id="e04f" class="lg jq hi lb b fi lm li l lj lk"><em class="ll"># create the UnoUrlResolver</em><br/>resolver <strong class="lb hj">=</strong> localContext<strong class="lb hj">.</strong>ServiceManager<strong class="lb hj">.</strong>createInstanceWithContext(<br/>				"com.sun.star.bridge.UnoUrlResolver", localContext )</span><span id="2058" class="lg jq hi lb b fi lm li l lj lk"><em class="ll"># connect to the running office</em><br/>ctx <strong class="lb hj">=</strong> resolver<strong class="lb hj">.</strong>resolve( "uno:socket,host=localhost,port=2002;urp;StarOffice.ComponentContext" )<br/>smgr <strong class="lb hj">=</strong> ctx<strong class="lb hj">.</strong>ServiceManager</span><span id="d92c" class="lg jq hi lb b fi lm li l lj lk"><em class="ll"># get the central desktop object</em><br/>desktop <strong class="lb hj">=</strong> smgr<strong class="lb hj">.</strong>createInstanceWithContext( "com.sun.star.frame.Desktop",ctx)</span><span id="6d4f" class="lg jq hi lb b fi lm li l lj lk"><em class="ll"># access the current writer document</em><br/>model <strong class="lb hj">=</strong> desktop<strong class="lb hj">.</strong>getCurrentComponent()</span></pre><p id="5b85" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些行对于每个文档(文本、电子表格、演示文稿、绘图)都是常见的。</p><p id="8dda" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们与文档进行交互。</p><p id="ae86" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为我们用参数<code class="du ky kz la lb b">--calc</code>打开LibreOffice，所以让我们试试电子表格命令。</p><pre class="kt ku kv kw fd lc lb ld le aw lf bi"><span id="3568" class="lg jq hi lb b fi lh li l lj lk"><em class="ll"># access the active sheet</em><br/>active_sheet <strong class="lb hj">=</strong> model<strong class="lb hj">.</strong>CurrentController<strong class="lb hj">.</strong>ActiveSheet<br/><br/><em class="ll"># access cell C4</em><br/>cell1 <strong class="lb hj">=</strong> active_sheet<strong class="lb hj">.</strong>getCellRangeByName("C4")<br/><br/><em class="ll"># set text inside</em><br/>cell1<strong class="lb hj">.</strong>String <strong class="lb hj">=</strong> "Hello world"<br/><br/><em class="ll"># other example with a value</em><br/>cell2 <strong class="lb hj">=</strong> active_sheet<strong class="lb hj">.</strong>getCellRangeByName("E6")<br/>cell2<strong class="lb hj">.</strong>Value <strong class="lb hj">=</strong> cell2<strong class="lb hj">.</strong>Value <strong class="lb hj">+</strong> 1</span></pre><p id="1dce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们用<code class="du ky kz la lb b">--writer </code>参数打开LibreOffice，我们还可以做以下操作。</p><pre class="kt ku kv kw fd lc lb ld le aw lf bi"><span id="a3f8" class="lg jq hi lb b fi lh li l lj lk"><em class="ll"># access the document's text property</em><br/>text <strong class="lb hj">=</strong> model<strong class="lb hj">.</strong>Text<br/><br/><em class="ll"># create a cursor</em><br/>cursor <strong class="lb hj">=</strong> text<strong class="lb hj">.</strong>createTextCursor()<br/><br/><em class="ll"># insert the text into the document</em><br/>text<strong class="lb hj">.</strong>insertString( cursor, "Hello World", 0 )</span></pre><p id="47c8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">恭喜你！现在你可以用Python从外部控制LibreOffice。我在这里完成这个。在我的下一篇文章中，我将讨论嵌入式宏。再见:)</p><p id="6555" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要查看更高级的例子，您可以查看我为这个博客系列创建的知识库。</p><div class="ln lo ez fb lp lq"><a href="https://github.com/rebahozkoc/libreofficepythonmacros" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hj fi z dy lv ea eb lw ed ef hh bi translated">GitHub-rebahozkoc/libre office Python macros:libre office Python宏示例</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">LibreOffice Python Macros是一个处理LibreOffice文档的项目。项目是用Python写的。它有…</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">github.com</p></div></div><div class="lz l"><div class="ma l mb mc md lz me io lq"/></div></div></a></div><p id="c4fa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建本系列文章时，我会参考以下重要资源:</p><div class="ln lo ez fb lp lq"><a href="https://muhammetkara.com/" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hj fi z dy lv ea eb lw ed ef hh bi translated">穆罕默德·卡拉</h2><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">muhammetkara.com</p></div></div><div class="lz l"><div class="mf l mb mc md lz me io lq"/></div></div></a></div><div class="ln lo ez fb lp lq"><a href="http://christopher5106.github.io/office/2015/12/06/openoffice-libreoffice-automate-your-office-tasks-with-python-macros.html" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hj fi z dy lv ea eb lw ed ef hh bi translated">OpenOffice / LibreOffice中面向接口的编程:用Python自动化您的办公任务…</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">OpenOffice和LibreOffice是主要的开源办公套件，开源相当于微软的Office，以…</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">christopher5106.github.io</p></div></div><div class="lz l"><div class="mg l mb mc md lz me io lq"/></div></div></a></div><div class="ln lo ez fb lp lq"><a href="http://www.pitonyak.org/oo.php" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hj fi z dy lv ea eb lw ed ef hh bi translated">www.pitonyak.org/oo.php</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">Andrew Pitonyak我的OpenOffice.org宏文档(更新于美国东部时间2015年6月12日11:19:53 PM)包含许多示例。这个…</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">www.pitonyak.org</p></div></div></div></a></div></div></div>    
</body>
</html>