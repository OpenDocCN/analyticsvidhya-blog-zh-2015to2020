<html>
<head>
<title>Inference Tensorflow2 model in C++</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">C++中推理 Tensorflow2 模型</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/inference-tensorflow2-model-in-c-aa73a6af41cf?source=collection_archive---------4-----------------------#2020-08-17">https://medium.com/analytics-vidhya/inference-tensorflow2-model-in-c-aa73a6af41cf?source=collection_archive---------4-----------------------#2020-08-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4129" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章是关于 Tensorflow2 模型的 C++推理。注意，这是关于<strong class="ih hj"> Tensorflow Lite </strong>的<strong class="ih hj">而不是</strong>(你可以在官方页面找到一个不错的指南:【https://www.tensorflow.org/lite/guide】)。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="5aee" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">快速启动</h1><ol class=""><li id="2749" class="kj kk hi ih b ii kl im km iq kn iu ko iy kp jc kq kr ks kt bi translated">以 SavedModel 格式(<a class="ae jd" href="https://www.tensorflow.org/guide/saved_model" rel="noopener ugc nofollow" target="_blank">https://www.tensorflow.org/guide/saved_model</a>)导出训练好的模型</li><li id="baac" class="kj kk hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated">使用 SavedModel CLI 查找输入和输出张量名称(<a class="ae jd" href="https://www.tensorflow.org/guide/saved_model#details_of_the_savedmodel_command_line_interface" rel="noopener ugc nofollow" target="_blank">https://www . tensor flow . org/guide/saved _ model # details _ of _ the _ saved model _ command _ line _ interface</a>)</li><li id="6892" class="kj kk hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated">使用 Tensorflow C++ API 的设置环境(<a class="ae jd" href="https://github.com/FloopCZ/tensorflow_cc" rel="noopener ugc nofollow" target="_blank">https://github.com/FloopCZ/tensorflow_cc</a>)</li><li id="a18c" class="kj kk hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated">负载和推理模型</li></ol><figure class="kz la lb lc fd ld"><div class="bz dy l di"><div class="le lf l"/></div></figure></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="646a" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">以 SavedModel 格式导出训练模型</h1><p id="9dd6" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">对于 C++推理，您应该做的第一件事是导出模型。Tensorflow 提供了一个名为<strong class="ih hj"> SavedModel </strong>的格式，包含了运行模型的所有需求。以<strong class="ih hj"> SavedModel </strong>格式<strong class="ih hj"> </strong>导出模型的 python 代码如下。(更多详情:<a class="ae jd" href="https://www.tensorflow.org/guide/saved_model" rel="noopener ugc nofollow" target="_blank">https://www.tensorflow.org/guide/saved_model</a>)</p><figure class="kz la lb lc fd ld"><div class="bz dy l di"><div class="le lf l"/></div></figure><h1 id="7595" class="jl jm hi bd jn jo lj jq jr js lk ju jv jw ll jy jz ka lm kc kd ke ln kg kh ki bi translated">使用 SavedModel CLI 查找输入和输出张量名称</h1><p id="3ace" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">对于 C++推理，我们需要输入和输出张量的准确名称。我们可以使用 Tensorflow 的 SavedModel CLI 从导出的模型中解析这些信息。该命令如下所示:</p><figure class="kz la lb lc fd ld"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="ea60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这会打印出张量名称，如下所示:</p><figure class="kz la lb lc fd ld"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="1295" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上面的结果，我可以找到输入和输出张量的名称。</p><blockquote class="lo lp lq"><p id="293b" class="if ig lr ih b ii ij ik il im in io ip ls ir is it lt iv iw ix lu iz ja jb jc hb bi translated">输入:服务 _ 默认 _ 输入 _ 张量:0</p><p id="2553" class="if ig lr ih b ii ij ik il im in io ip ls ir is it lt iv iw ix lu iz ja jb jc hb bi translated">输出:stateflupartitionedcall:0，stateflupartitionedcall:1，stateflupartitionedcall:2，stateflupartitionedcall:3，stateflupartitionedcall:4，stateflupartitionedcall:5</p></blockquote><h1 id="6c83" class="jl jm hi bd jn jo lj jq jr js lk ju jv jw ll jy jz ka lm kc kd ke ln kg kh ki bi translated">使用 Tensorflow C++ API 的设置环境</h1><p id="33f8" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">Tensorflow C++ API 需要 Tensorflow 源代码文件夹和 Bazel 构建系统。然而，FloopCZ 共享了一个很好的存储库，使得 Tensorflow C++ API 没有这些需求成为可能。请跟随这里的向导:<a class="ae jd" href="https://github.com/FloopCZ/tensorflow_cc" rel="noopener ugc nofollow" target="_blank">https://github.com/FloopCZ/tensorflow_cc</a></p><p id="d4c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用 docker 容器进行快速设置(<a class="ae jd" href="https://hub.docker.com/r/floopcz/tensorflow_cc/" rel="noopener ugc nofollow" target="_blank">https://hub.docker.com/r/floopcz/tensorflow_cc/</a>)。</p><h1 id="3370" class="jl jm hi bd jn jo lj jq jr js lk ju jv jw ll jy jz ka lm kc kd ke ln kg kh ki bi translated">负载和推理模型</h1><p id="d61b" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">Tensorflow C++ API 为<strong class="ih hj">saved model:</strong><a class="ae jd" href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/cc/saved_model/loader.h" rel="noopener ugc nofollow" target="_blank">https://github . com/tensor flow/tensor flow/blob/master/tensor flow/cc/saved _ model/loader . h</a></p><p id="e816" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">函数<strong class="ih hj"> LoadSavedModel </strong>返回<strong class="ih hj"> SavedModelBundleLite </strong>类的一个实例，其中包含用于运行模型的<strong class="ih hj">会话</strong>。在官方<a class="ae jd" href="https://www.tensorflow.org/guide/saved_model#load_a_savedmodel_in_c" rel="noopener ugc nofollow" target="_blank">页面</a>中，示例代码使用<strong class="ih hj"> SavedModelBundle </strong>，但更倾向于使用<strong class="ih hj"> SavedModelBundleLite </strong>(请阅读 loader.h 中<strong class="ih hj"> SavedModelBundleLite </strong>类的注释)。</p><p id="ecb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要运行模型，首先调用<strong class="ih hj">SavedModelBundleLite::GetSession()</strong>来获取会话实例。然后，像往常一样，推理模型通过调用<strong class="ih hj"> Session::Run() </strong>。这里我们提供了从<strong class="ih hj"> SavedModel CLI </strong>获得的输入和输出张量的名称。</p><figure class="kz la lb lc fd ld"><div class="bz dy l di"><div class="le lf l"/></div></figure></div></div>    
</body>
</html>