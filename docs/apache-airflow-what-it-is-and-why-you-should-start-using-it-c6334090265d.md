# é˜¿å¸•å¥‡æ°”æµç®€ä»‹

> åŸæ–‡ï¼š<https://medium.com/analytics-vidhya/apache-airflow-what-it-is-and-why-you-should-start-using-it-c6334090265d?source=collection_archive---------14----------------------->

![](img/f875642335d35fe5ecd87fb39ea336da.png)

## ä»‹ç»

ä»€ä¹ˆæ˜¯é˜¿å¸•å¥‡æ°”æµï¼Ÿ

> Apache Airflow æ˜¯ä¸€ä¸ªå¼€æºå¹³å°ï¼Œç”¨äºåˆ›ä½œã€è°ƒåº¦å’Œç›‘æ§**å·¥ä½œæµ**ã€‚å®ƒæ˜¯ 2015 å¹´åœ¨ Airbnb åˆ›å»ºçš„(ä½œä¸ºå¿«é€Ÿåˆ›ä½œã€è¿­ä»£å’Œç›‘æ§æ‰¹å¤„ç†æ•°æ®ç®¡é“çš„æ›´å¥½æ–¹å¼ï¼Œå¤„ç† Airbnb æ­£åœ¨å¤„ç†çš„å¤§é‡æ•°æ®)ã€‚
> 
> ç›®å‰ï¼ŒApache Airflow æ˜¯ Apache è½¯ä»¶åŸºé‡‘ä¼šçš„ä¸€éƒ¨åˆ†ã€‚ç”±äºä½¿ç”¨ Python å¸¦æ¥çš„å¥å£®æ€§å’Œçµæ´»æ€§ï¼ŒAirflow è·å¾—äº†å¹¿æ³›çš„æ¬¢è¿

æ­£å¦‚ J [AREK POTIUK](https://www.linkedin.com/in/jarekpotiuk) æ‰€æŒ‡å‡ºçš„ï¼Œæ°”æµæ˜¯ä¸€ä¸ªæŒ‡æŒ¥è€…(å®ƒå¯ä»¥è¢«æ¯”ä½œç®¡å¼¦ä¹é˜Ÿä¸­çš„æŒ‡æŒ¥ï¼Œå®ƒä¸åšå¤ªå¤šï¼Œä½†æ§åˆ¶ç€ä¸€åˆ‡çš„æµåŠ¨ï¼Œä»–åœ¨é‚£é‡Œæ§åˆ¶å’ŒåŒæ­¥åšè¿™é¡¹å·¥ä½œçš„æ‰€æœ‰å…¶ä»–äºº)

**å¥½å§ï¼Œé…·ï¼Œæ—¢ç„¶ apache airflow ç®¡ç†å·¥ä½œæµï¼Œé‚£ä¹ˆå·¥ä½œæµåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ**

> ç®€å•æ¥è¯´ï¼Œå·¥ä½œæµæ˜¯æŒ‰è®¡åˆ’å¼€å§‹æˆ–ç”±äº‹ä»¶è§¦å‘çš„ä¸€ç³»åˆ—ä»»åŠ¡

![](img/276d3f6eeb8f565e72150d33619d6418.png)

æ°”æµå·¥ä½œæµç¨‹è¢«è®¾è®¡æˆä¸€ä¸ª[æœ‰å‘æ— ç¯å›¾(DAG)ã€‚](https://en.wikipedia.org/wiki/Directed_acyclic_graph)åˆ›ä½œå·¥ä½œæµæ—¶ï¼Œå®ƒè¢«åˆ’åˆ†ä¸ºå¯ç‹¬ç«‹æ‰§è¡Œçš„ä»»åŠ¡ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥é€šè¿‡å°†è¿™äº›ä»»åŠ¡ç»„åˆæˆä¸€ä¸ªå›¾å½¢ï¼Œå°†å®ƒä»¬åˆå¹¶æˆä¸€ä¸ªé€»è¾‘æ•´ä½“ã€‚å·¥ä½œæµä¸­çš„æ¯ä¸ªä»»åŠ¡éƒ½æ˜¯[ç­‰å¹‚](https://en.wikipedia.org/wiki/Idempotence)

> åœ¨ä½ å¾˜å¾Šçš„æ€ç»ªä¸­ï¼Œä½ å¯èƒ½ä¼šæƒ³ä½¿ç”¨æ°”æµæœ‰ä»€ä¹ˆå¥½å¤„

## æ°”æµçš„å¥½å¤„

1.  å®ƒå¯ä»¥ä¼˜é›…åœ°å¤„ç†ä¸Šæ¸¸/ä¸‹æ¸¸æ•°æ®
2.  è½»æ¾è®¿é—®å†å²æ•°æ®(å›å¡«å’Œé‡æ–°è¿è¡Œå†å²æ•°æ®)
3.  ç®€å•çš„é”™è¯¯å¤„ç†(å¤±è´¥æ—¶é‡è¯•)
4.  å®ƒæœ‰ä¸€ä¸ªå¾ˆæ£’çš„ç¤¾åŒº([ä½ å¯ä»¥åœ¨ slack](https://apache-airflow-slack.herokuapp.com/) åŠ å…¥æ°”æµç¤¾åŒº)
5.  å¯æ‰©å±•æ€æƒ³ä½¿ç”¨[è¿ç®—ç¬¦](https://github.com/apache/airflow/tree/master/airflow/contrib/operators)
6.  å®ƒæ‹¥æœ‰å‡ºè‰²çš„æ—¥å¿—è®°å½•èƒ½åŠ›
7.  å¯ä¼¸ç¼©æ€§å’Œä¾èµ–æ€§ç®¡ç†
8.  å¼ºå¤§çš„ç›‘æ§åŠŸèƒ½æ‚¨å¯ä»¥å®æ—¶è¿è¡Œå’ŒæŸ¥çœ‹å·¥ä½œæµæ‰§è¡Œæƒ…å†µ
9.  ä»¥ç¼–ç¨‹æ–¹å¼åˆ›ä½œã€å®‰æ’å’Œç›‘æ§å·¥ä½œæµæˆ–æ•°æ®ç®¡é“
10.  ä¼Ÿå¤§çš„è­¦æŠ¥ç³»ç»Ÿ
11.  é€šè¿‡ REST API è®¿é—®
12.  å®ƒå¯ä»¥åœ¨æœ¬åœ°ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨äº‘ä¸­ä½¿ç”¨(äº‘æ˜¯å…¶ä»–äººçš„è®¡ç®—æœºğŸ˜† ğŸ˜œ)

airflow çš„ä¸»è¦äº‘æœåŠ¡æä¾›å•†æ˜¯[å¤©æ–‡å­¦å®¶ã€‚IO](https://www.astronomer.io/) å’Œ [google cloud composer](https://cloud.google.com/composer/docs/concepts/overview)

## æ°”æµçš„ä½¿ç”¨æ¡ˆä¾‹

é˜¿å¸•å¥‡æ°”æµå¯ä»¥ç”¨äºå„ç§ç›®çš„

1.  ETL(æå–ã€è½¬æ¢ã€åŠ è½½)ä½œä¸š
2.  ä»å¤šä¸ªæ¥æºæå–æ•°æ®
3.  æœºå™¨å­¦ä¹ ç®¡é“
4.  æ•°æ®åº“
5.  ç¼–æ’è‡ªåŠ¨åŒ–æµ‹è¯•

[è¿™é‡Œæœ‰ä¸€äº›å€¼å¾—æ³¨æ„çš„æåŠ](https://airflow.apache.org/use-cases/)

## æ°”æµä¸­çš„æ¦‚å¿µ

1.  ç»è¥è€…
2.  åå…‹
3.  ä»»åŠ¡
4.  è¿æ¥å™¨
5.  é’©ä½
6.  å˜é‡
7.  XCOM
8.  å®æ–½è€…

# 1)è¿è¥å•†

> æ“ä½œå‘˜æè¿°å·¥ä½œæµä¸­çš„å•ä¸ªä»»åŠ¡ã€‚æ“ä½œå‘˜é€šå¸¸(ä½†ä¸æ€»æ˜¯)æ˜¯åŸå­çš„ï¼Œè¿™æ„å‘³ç€ä»–ä»¬å¯ä»¥ç‹¬ç«‹å·¥ä½œï¼Œä¸éœ€è¦ä¸ä»»ä½•å…¶ä»–æ“ä½œå‘˜å…±äº«èµ„æºã€‚
> 
> æ“ä½œç¬¦åªæ˜¯ä¸€ä¸ªå¸¦æœ‰â€œexecute()â€æ–¹æ³•çš„ Python ç±»ï¼Œå½“å®ƒè¿è¡Œæ—¶å°±ä¼šè¢«è°ƒç”¨ã€‚

## æ°”æµä¸­æ“ä½œè€…çš„ç±»å‹

> ä¸€.è¡ŒåŠ¨
> äºŒã€‚è½¬ç§»
> ä¸‰ã€‚ä¼ æ„Ÿå™¨

# 2.åå…‹

> Dag æè¿°*å¦‚ä½•*è¿è¡Œå·¥ä½œæµã€‚
> 
> DAG åªæ˜¯ä¸€ä¸ªåŒ…å«ä¸€ç»„ä»»åŠ¡åŠå…¶ä¾èµ–å…³ç³»çš„ Python è„šæœ¬ã€‚æ¯ä¸ªä»»åŠ¡åšä»€ä¹ˆç”±ä»»åŠ¡çš„æ“ä½œå‘˜å†³å®š
> 
> ç®€è€Œè¨€ä¹‹ï¼ŒDAG æ˜¯å…·æœ‰å®šä¹‰çš„ä¾èµ–æ€§å’Œå…³ç³»çš„ä»»åŠ¡çš„é›†åˆ

ä¸€ä¸ª *DagRun* æ˜¯ä¸€ä¸ª DAG çš„å®ä¾‹ï¼Œå®ƒç”±è°ƒåº¦ç¨‹åºåˆ›å»ºï¼Œæˆ–è€…å¯ä»¥æ‰‹åŠ¨è§¦å‘ ut

# 3.ä»»åŠ¡

> ä»»åŠ¡æ˜¯åœ¨ Dag ä¸­å®šä¹‰çš„ï¼Œä¸¤è€…éƒ½æ˜¯ç”¨ Python ä»£ç ç¼–å†™çš„ï¼Œç”¨æ¥å®šä¹‰ä½ æƒ³åšä»€ä¹ˆã€‚
> 
> æ¯ä¸ªä»»åŠ¡åšä»€ä¹ˆç”±ä»»åŠ¡çš„[æ“ä½œç¬¦](https://airflow.apache.org/docs/stable/_api/airflow/operators/index.html)å†³å®š

# 4.è¿æ¥å™¨

> è¿æ¥å¤–éƒ¨ç³»ç»Ÿæ‰€éœ€çš„ä¿¡æ¯å­˜å‚¨åœ¨å…¶ metastore æ•°æ®åº“ä¸­çš„ Airflow stores æ‰€æœ‰è¿æ¥å™¨ä¸­ï¼Œ
> 
> â­ï¸å˜é‡éƒ¨åˆ†ä¹Ÿå¯ä»¥ä¿å­˜è¿™äº›â€œæ‰€è°“çš„è¿æ¥æ•°æ®å’Œå‚æ•°â€,ä½†æ˜¯æ ¹æ®æœ€ä½³å®è·µï¼Œå®ƒä»¬åº”è¯¥ä½œä¸ºè¿æ¥å™¨å­˜å‚¨ã€‚ä½†æ˜¯ä½ çŒœæ€ä¹ˆç€ï¼Ÿå¦‚æœä½ æ˜¯é‚£äº›ä¸å–œæ¬¢é˜…è¯»æ–‡æ¡£çš„å¼€å‘äººå‘˜ä¹‹ä¸€ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬å­˜å‚¨åœ¨ä½ å–œæ¬¢çš„ä»»ä½•åœ°æ–¹

# 5.é’©ä½

> é’©å­ç”¨äºä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’ï¼Œå¦‚ S3ã€HIVEã€SFTPã€æ•°æ®åº“ç­‰ã€‚
> 
> æ‰€æœ‰ä¸å¤–éƒ¨æœåŠ¡çš„é€šä¿¡éƒ½æ˜¯ä½¿ç”¨é’©å­å®Œæˆçš„

```
operator <->hooks <-> externalAPI
```

# 6.å˜é‡

> å˜é‡æ˜¯ä»¥ç®€å•çš„é”®å€¼å¯¹å½¢å¼å­˜å‚¨å’Œæ£€ç´¢ä»»æ„å†…å®¹æˆ–è®¾ç½®çš„é€šç”¨æ–¹å¼
> 
> è¿™å¯ä»¥æ¯”ä½œ ***ç¯å¢ƒå˜é‡***

# 7.XCOM

> å³ä½¿æ“ä½œå‘˜æ˜¯ç­‰å¹‚çš„ï¼Œä»–ä»¬ä»ç„¶éœ€è¦å…±äº«ä¿¡æ¯æˆ–å°‘é‡æ•°æ®(**æ“ä½œå‘˜äº¤å‰é€šä¿¡**)ï¼Œè¿™å°±æ˜¯ XCOM çš„ç”¨æ­¦ä¹‹åœ°
> 
> XComs è®©ä»»åŠ¡äº¤æ¢æ¶ˆæ¯ï¼Œåå­—æ˜¯â€œcross-communicationâ€çš„ç¼©å†™ã€‚

# 8.å®æ–½è€…

> **æ‰§è¡Œå™¨**æ˜¯ä»»åŠ¡å®ä¾‹å¼€å§‹è¿è¡Œçš„æœºåˆ¶ã€‚**æ°”æµ**æ”¯æŒå„ç§**æ‰§è¡Œè€…**ã€‚
> 
> **é—å˜±æ‰§è¡Œäººçš„ç§ç±»**
> 1 .DebugExecutors(åœ¨å•ä¸ªè¿›ç¨‹ä¸­è¿è¡Œä»»åŠ¡ï¼Œç®€å•ä½†ä¸åˆ©äºç”Ÿäº§)
> 2ã€‚LocalExecutors(åœ¨å•ç‹¬çš„è¿›ç¨‹ä¸­è¿è¡Œä»»åŠ¡)
> 3ã€‚CeleryExecutor(å‘èŠ¹èœå·¥äººå‘é€ä»»åŠ¡ï¼Œå¾ˆéš¾è®¾ç½®ï¼Œä½†æœ€é€‚åˆç”Ÿäº§)
> 4ã€‚KubernetesExecutor(äº§ç”Ÿå¸¦æœ‰æ°”æµçš„æ–°åŠèˆ±ï¼Œè¿è¡Œæœ€é€‚åˆç¹é‡ä»»åŠ¡çš„ä»»åŠ¡)
> 
> æ‰§è¡Œè€…éå¸¸é‡è¦ï¼Œèµ·åˆï¼Œè¿™ä¸ªæ¦‚å¿µå¯èƒ½çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†æ˜¯å¤©æ–‡å­¦å®¶æä¾›äº†ä¸€ä¸ªå…¨é¢çš„è§£é‡Š

# ç»“è®º

airflow çš„æœ€å¤§å¥½å¤„ä¹‹ä¸€æ˜¯å®ƒå…è®¸æ‚¨ä»¥ç¼–ç¨‹æ–¹å¼å®šä¹‰å·¥ä½œæµã€‚å®ƒè®©ç”¨æˆ·å¯ä»¥è‡ªç”±åœ°ç¼–å†™åœ¨ç®¡é“çš„æ¯ä¸€æ­¥è¦æ‰§è¡Œçš„ä»£ç ã€‚

Airflow ä¹Ÿæœ‰ä¸€ä¸ªéå¸¸å¼ºå¤§ä¸”é…ç½®è‰¯å¥½çš„ UIã€‚è¿™ä½¿å¾—è·Ÿè¸ªä½œä¸šã€å›å¡«ä½œä¸šå’Œé…ç½®å¹³å°å˜å¾—éå¸¸ç®€å•

![](img/19186de29937f3494909f50c3a2c1d1b.png)

[Alexander Redl](https://unsplash.com/@alexanderredl?utm_source=medium&utm_medium=referral) åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„çš„ç…§ç‰‡

## å‡†å¤‡å¥½å¼€å§‹ä½¿ç”¨ APACHE AIRFLOW äº†å—ï¼Ÿ

è¿™é‡Œæœ‰ä¸€ä¸ªå…³äºå¦‚ä½•åœ¨æœ¬åœ°æœºå™¨ä¸ŠåŠ é€Ÿ apache æ°”æµçš„å¿«é€Ÿçº²è¦

ğŸ’¡æ°”æµæ˜¯åŸºäº Python çš„ã€‚å®‰è£…å®ƒçš„æœ€ä½³æ–¹å¼æ˜¯é€šè¿‡å·¥å…·ã€‚

```
# airflow needs a home, ~/airflow is the default,
# but you can lay foundation somewhere else if you prefer
# (optional)
export AIRFLOW_HOME=~/airflow
```

ä½¿ç”¨ pip ä» PyPI å®‰è£…

```
pip install apache-airflow
```

#å¯åŠ¨ web æœåŠ¡å™¨ï¼Œé»˜è®¤ç«¯å£æ˜¯ 8080

```
airflow webserver -p 8080
```

![](img/3002af2a8f2157b95dd49526f069fa7f.png)

Apache Airflow æœåŠ¡å™¨æ—¥å¿—

ç°åœ¨å½“ä½ è®¿é—®`0.0.0.0:8080`ğŸš€

![](img/640abf6d5faf07131f69c0f36210b020.png)

Apache æ°”æµç”¨æˆ·ç•Œé¢

å¤©æ–‡å­¦å®¶ CLI ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å·¥å…·(å®é™…ä¸Šæ˜¯è¿è¡Œé˜¿å¸•å¥‡æ°”æµæœ€ç®€å•çš„æ–¹æ³•)

è¯·å…³æ³¨æ›´å¤šæ•™ç¨‹ï¼Œåœ¨é‚£é‡Œæˆ‘å°†ä½¿ç”¨å¤©æ–‡å­¦å®¶ CLI æ¥åˆ›é€ é­”æ³•

**ä¿é‡ï¼Œä¿æŒå®‰å…¨ğŸŒŠæ„¿å¿ƒæµä¸ä½ åŒåœ¨**

âœŒï¸ âœŒï¸ ğŸš€ ğŸš€ âœŒï¸ âœŒï¸

**å»¶ä¼¸é˜…è¯»**

ä¸€è‚¡[å¸•åˆ‡æ°”æµ](https://github.com/apache/airflow)

A [stronomer.io æ°”æµä»‹ç»/](https://www.astronomer.io/guides/intro-to-airflow/)