<html>
<head>
<title>Deployment of Webapp over AWS-EKS cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在AWS-EKS集群上部署Webapp</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deployment-of-webapp-over-aws-eks-cluster-e2fc4d3f65aa?source=collection_archive---------20-----------------------#2020-07-11">https://medium.com/analytics-vidhya/deployment-of-webapp-over-aws-eks-cluster-e2fc4d3f65aa?source=collection_archive---------20-----------------------#2020-07-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/1460231538bd1925822bb8d8084d5137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z1PrcMNe3PQse4ASctnfRA.jpeg"/></div></div></figure><div class=""/><blockquote class="iq ir is"><p id="e884" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">AWS-EKS</p></blockquote><p id="f218" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi jv translated"><span class="l jw jx jy bm jz ka kb kc kd di">一个</span><strong class="iw hu">mazon EKS(Kubernetes的弹性容器服务)——</strong>允许您在AWS 上使用<strong class="iw hu"> Kubernetes，而无需安装和管理您自己的Kubernetes控制平面。</strong></p><p id="2294" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">EKS本身在自己的基础设施内私下管理主节点。只有我们需要担心我们的从属环境(比如实例类型)。</p><p id="c941" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">在这里，我们可以启动从属环境的各种实例类型，也称为节点组，在这个节点组中，我们可以启动尽可能多的各种实例类型的节点。</p></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h2 id="2cb2" class="kl km ht bd kn ko kp kq kr ks kt ku kv js kw kx ky jt kz la lb ju lc ld le lf bi translated">使用EKS自动气象站的好处</h2><ul class=""><li id="f570" class="lg lh ht iw b ix li jb lj js lk jt ll ju lm jr ln lo lp lq bi translated">好用。</li><li id="a0b4" class="lg lh ht iw b ix lr jb ls js lt jt lu ju lv jr ln lo lp lq bi translated">灵活。</li><li id="7ee7" class="lg lh ht iw b ix lr jb ls js lt jt lu ju lv jr ln lo lp lq bi translated">性价比高。</li><li id="84a2" class="lg lh ht iw b ix lr jb ls js lt jt lu ju lv jr ln lo lp lq bi translated">可靠。</li><li id="bf86" class="lg lh ht iw b ix lr jb ls js lt jt lu ju lv jr ln lo lp lq bi translated">可扩展和高性能。</li><li id="413a" class="lg lh ht iw b ix lr jb ls js lt jt lu ju lv jr ln lo lp lq bi translated">安全。</li></ul></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h2 id="3029" class="kl km ht bd kn ko kp kq kr ks kt ku kv js kw kx ky jt kz la lb ju lc ld le lf bi translated">目标:-</h2><p id="04c9" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je js lw jh ji jt lx jl jm ju ly jp jq jr hb bi translated">创建一个EKS集群，在该集群中启动三个不同的实例类型节点，然后在该节点中启动两个pod，一个是Mysql数据库，另一个是Joomla(web应用程序)。为了平衡我们的应用程序，我们将把这个应用程序单元与AWS的ELB服务提供的负载平衡器连接起来，对于两个单元的存储，我们将使用AWS的EFS存储。</p><p id="60c1" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">所以，让我们开始创造我们的整个环境…</p></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h2 id="d5f1" class="kl km ht bd kn ko kp kq kr ks kt ku kv js kw kx ky jt kz la lb ju lc ld le lf bi translated">在AWS中创建IAM角色。</h2><p id="40d7" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je js lw jh ji jt lx jl jm ju ly jp jq jr hb bi translated">1.打开<em class="iv"> IAM控制台</em>。</p><p id="781f" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">2.选择<strong class="iw hu">角色&gt;创建角色。</strong></p><p id="76c0" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">3.从服务列表中选择EKS &gt;在EKS下选择使用案例，因为<strong class="iw hu">允许EKS代表您管理集群。</strong></p><p id="7113" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">4.然后给出一些标签并复习。</p></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h2 id="0c2f" class="kl km ht bd kn ko kp kq kr ks kt ku kv js kw kx ky jt kz la lb ju lc ld le lf bi translated">创建亚马逊EKS集群</h2><p id="8b9c" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je js lw jh ji jt lx jl jm ju ly jp jq jr hb bi translated">我们可以通过两种方式在AWS中创建EKS</p><ol class=""><li id="e62e" class="lg lh ht iw b ix iy jb jc js lz jt ma ju mb jr mc lo lp lq bi translated">使用aws eks create-cluster命令:该命令没有为创建具有不同实例类型的集群(从属)提供更多定制。</li><li id="b3c8" class="lg lh ht iw b ix lr jb ls js lt jt lu ju lv jr mc lo lp lq bi translated">使用eksctl命令:我们将使用这个命令来创建我们的集群，因为它在创建从属环境时提供了更多的定制。</li></ol><p id="e445" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">其次，我们将需要一个软件，将联系主(Kubernetes集群)。</p><p id="da65" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">因此，下载eksctl和kubectl软件，很容易通过google获得，保存在一个文件夹中，并向您的环境变量提供该文件夹的位置。</p><div class="md me mf mg fd ab cb"><figure class="mh hk mi mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/ffac19bae7e3dde6d26c6fbc6b702506.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*OP_NduN_MSDYynd79aT_mQ.png"/></div></figure><figure class="mh hk mi mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/3303f5ecf0aebb07c49a783f34cdfb99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*XTI3JSjqD_-Df7WLkQglhA.png"/></div><figcaption class="mn mo et er es mp mq bd b be z dx mr di ms mt translated">eksctl和kubectl文件</figcaption></figure></div></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><p id="60b2" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">为了创建集群，我们必须用yml代码创建一个文件，给出集群名称、区域(我们启动集群的位置)，为节点组提供不同的实例类型和容量，并且在每个节点组中提供一个aws-key，以便进一步登录。</p><pre class="md me mf mg fd mu mv mw mx aw my bi"><span id="c4b4" class="kl km ht mv b fi mz na l nb nc">apiVersion: eksctl.io/v1alpha5<br/>kind: ClusterConfig</span><span id="bda7" class="kl km ht mv b fi nd na l nb nc">metadata: <br/> name: ak-cluster<br/> region: ap-south-1</span><span id="190f" class="kl km ht mv b fi nd na l nb nc">nodeGroups:<br/> — name: ng1<br/> desiredCapacity: 2<br/> instanceType: t2.micro<br/> ssh: <br/> publicKeyName: key1<br/> — name: ng2<br/> desiredCapacity: 1<br/> instanceType: t2.small<br/> ssh:<br/> publicKeyName: key1</span></pre><p id="91c1" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">创建集群的命令→</p><p id="77e3" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated"><code class="du ne nf ng mv b">eksctl create cluster -f cluster.yml</code></p><p id="0023" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">这里，cluster.yml是我上面创建的代码的文件名。</p><figure class="md me mf mg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nh"><img src="../Images/2f2fa335fe350e86a81953bdd80231dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yu8Ym7Ffk0siw8uyCAH7eA.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">cluster.yml</figcaption></figure><p id="cffe" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">我们还可以检查通过以下命令创建的集群和节点组:-</p><p id="89aa" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated"><code class="du ne nf ng mv b">eksctl get cluster</code></p><p id="416a" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated"><code class="du ne nf ng mv b">eksctl get nodegroup --cluster ak-cluster</code></p><p id="b202" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated"><strong class="iw hu"> <em class="iv"> ak-cluster </em> </strong>是您在代码中提到的集群名称。</p><figure class="md me mf mg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nh"><img src="../Images/d02bf9ea3d019891abb3dee9fb42d2f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z4bgHZv0hDUooQPgrZugPA.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">集群和节点组</figcaption></figure><p id="b636" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">创建集群和节点组的WEBUI视图。</p><div class="md me mf mg fd ab cb"><figure class="mh hk mi mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/65e814936635f0ea603cbfc0e45fb369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*yidf0AxHTzL04tqWwk2nlg.png"/></div></figure><figure class="mh hk mi mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/ec9ef516763eaa32afbb867f2e75aa08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*pKNEHO-rh3PjfYk3ERc6YQ.png"/></div></figure></div><p id="ab8f" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">现在，将这个集群连接到kubectl，为此我们必须更新我们的kubeconfig文件→</p><p id="1ab7" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated"><code class="du ne nf ng mv b">aws eks update-kubeconfig --name ak-cluster</code></p></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h2 id="92e1" class="kl km ht bd kn ko kp kq kr ks kt ku kv js kw kx ky jt kz la lb ju lc ld le lf bi translated">创建用于存储数据的EFS</h2><div class="md me mf mg fd ab cb"><figure class="mh hk mi mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/b0242f4fdb4b86ad5bca708f66eaf0f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*T08nwTada05-jTSlD1JHNA.png"/></div></figure><figure class="mh hk mi mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/5847371fbd90db355500a92d8b1f5d13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*0VyaNdtziAeZuL1QGY9PPA.png"/></div></figure></div><p id="fb89" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">创建群集后，将自动为该群集创建VPC，并使用该群集创建我们的EFS。</p><p id="5992" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">此外，要使用由集群创建的同一个安全组。</p></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><blockquote class="iq ir is"><p id="cfbf" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了将我们的EFS存储连接到我们的pods，我们必须在所有的从节点上手动安装amazon-efs-utils。</p></blockquote><p id="5140" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated"><code class="du ne nf ng mv b">yum install amazon-efs-utils -y</code></p><figure class="md me mf mg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nh"><img src="../Images/7f3aed3cc312f86202c43ed17ad88411.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sBYgIw2Oihu6yUDDK50I5A.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx">:</figcaption></figure></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><blockquote class="iq ir is"><p id="c3db" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">注意:-</p><p id="fc5b" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">建议使用单独的名称空间来启动我们的不同项目，或者在默认名称空间中运行。</p><p id="a5c3" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ne nf ng mv b">kubectl create namespace ak-eks</code></p><p id="4ae2" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">将其更新为默认值。</p><p id="9886" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ne nf ng mv b">kubectl config set-context --current --namespace=ak-eks</code></p></blockquote><figure class="md me mf mg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nh"><img src="../Images/6a41adc61974b2fb4b5d2d88e49ed430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PJtX3S1ssKaIGkv-pUDPmQ.png"/></div></div></figure></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h2 id="e72a" class="kl km ht bd kn ko kp kq kr ks kt ku kv js kw kx ky jt kz la lb ju lc ld le lf bi translated">创建EFS置备程序</h2><pre class="md me mf mg fd mu mv mw mx aw my bi"><span id="5bc5" class="kl km ht mv b fi mz na l nb nc">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/> name: efs-provisioner<br/>spec:<br/> selector:<br/> matchLabels:<br/> app: efs-provisioner<br/> replicas: 1<br/> strategy:<br/> type: Recreate<br/> template:<br/> metadata:<br/> labels:<br/> app: efs-provisioner<br/> spec:<br/> containers:<br/> — name: efs-provisioner<br/> image: quay.io/external_storage/efs-provisioner:v0.1.0<br/> env:<br/> — name: FILE_SYSTEM_ID<br/> value: fs-3f55dfee<br/> — name: AWS_REGION<br/> value: ap-south-1<br/> — name: PROVISIONER_NAME<br/> value: ak/aws-efs<br/> volumeMounts:<br/> — name: pv-volume<br/> mountPath: /persistentvolumes<br/> volumes:<br/> — name: pv-volume<br/> nfs:<br/> server: fs-3f55dfee.efs.ap-south-1.amazonaws.com<br/> path: /</span></pre><p id="70cd" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">用创建的efs和服务器的id替换文件系统ID。该置备程序将帮助我们的kubectl连接到EFS以进行存储。</p></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h2 id="6e2b" class="kl km ht bd kn ko kp kq kr ks kt ku kv js kw kx ky jt kz la lb ju lc ld le lf bi translated">修改RBAC</h2><p id="0878" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je js lw jh ji jt lx jl jm ju ly jp jq jr hb bi translated">使用基于角色的访问控制修改某些权限(RBAC)。</p><pre class="md me mf mg fd mu mv mw mx aw my bi"><span id="80fb" class="kl km ht mv b fi mz na l nb nc">apiVersion: rbac.authorization.k8s.io/v1beta1<br/>kind: ClusterRoleBinding<br/>metadata:<br/> name: nfs-provisioner-role-binding<br/>subjects:<br/> — kind: ServiceAccount<br/> name: default<br/> namespace: ak-eks<br/>roleRef:<br/> kind: ClusterRole<br/> name: cluster-admin<br/> apiGroup: rbac.authorization.k8s.io</span></pre></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h2 id="7526" class="kl km ht bd kn ko kp kq kr ks kt ku kv js kw kx ky jt kz la lb ju lc ld le lf bi translated">创建存储类和PVC</h2><p id="680b" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je js lw jh ji jt lx jl jm ju ly jp jq jr hb bi translated">我们将创建一个存储类，它将创建我们的pod存储数据所需的PVC。将创建一个动态PV，它将联系所需存储的存储类。</p><pre class="md me mf mg fd mu mv mw mx aw my bi"><span id="b81a" class="kl km ht mv b fi mz na l nb nc">apiVersion: storage.k8s.io/v1<br/>kind: StorageClass<br/>metadata:<br/> name: aws-efs<br/>provisioner: ak/aws-efs<br/> — -<br/>kind: PersistentVolumeClaim<br/>apiVersion: v1<br/>metadata:<br/> name: wordpress-efs<br/> annotations:<br/> volume.beta.kubernetes.io/storage-class: “aws-efs”<br/>spec:<br/> accessModes:<br/> — ReadWriteMany<br/> resources:<br/> requests:<br/> storage: 10Gi<br/> — -<br/>kind: PersistentVolumeClaim<br/>apiVersion: v1<br/>metadata:<br/> name: mysql-efs<br/> annotations:<br/> volume.beta.kubernetes.io/storage-class: “aws-efs”<br/>spec:<br/> accessModes:<br/> — ReadWriteMany<br/> resources:<br/> requests:<br/> storage: 10Gi</span></pre></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h2 id="911f" class="kl km ht bd kn ko kp kq kr ks kt ku kv js kw kx ky jt kz la lb ju lc ld le lf bi translated">创建秘密盒子</h2><p id="d7a2" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je js lw jh ji jt lx jl jm ju ly jp jq jr hb bi translated">我已经创建了一个存储我们的数据库根密码的秘密盒子，我不会透露，但我会告诉如何创建存储您的密码和其他重要凭证的秘密盒子。</p><pre class="md me mf mg fd mu mv mw mx aw my bi"><span id="7d57" class="kl km ht mv b fi mz na l nb nc">apiVersion: v1<br/>kind: Secret<br/>metadata:<br/> name: mysecure<br/>data:<br/> password: xxyyzz</span></pre></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h2 id="b261" class="kl km ht bd kn ko kp kq kr ks kt ku kv js kw kx ky jt kz la lb ju lc ld le lf bi translated">Mysql(数据库pod)的部署</h2><pre class="md me mf mg fd mu mv mw mx aw my bi"><span id="e6a7" class="kl km ht mv b fi mz na l nb nc">apiVersion: v1<br/>kind: Service<br/>metadata:<br/> name: wordpress-mysql<br/> labels:<br/> app: wordpress<br/>spec:<br/> ports:<br/> — port: 3306<br/> selector:<br/> app: wordpress<br/> tier: mysql<br/> clusterIP: None<br/> — -<br/>apiVersion: apps/v1 # for versions before 1.9.0 use apps/v1beta2<br/>kind: Deployment<br/>metadata:<br/> name: wordpress-mysql<br/> labels:<br/> app: wordpress<br/>spec:<br/> selector:<br/> matchLabels:<br/> app: wordpress<br/> tier: mysql<br/> strategy:<br/> type: Recreate<br/> template:<br/> metadata:<br/> labels:<br/> app: wordpress<br/> tier: mysql<br/> spec:<br/> containers:<br/> — image: mysql:5.6<br/> name: mysql<br/> env:<br/> — name: MYSQL_ROOT_PASSWORD<br/> valueFrom:<br/> secretKeyRef:<br/> name: mysecret<br/> key: password<br/> ports:<br/> — containerPort: 3306<br/> name: mysql<br/> volumeMounts:<br/> — name: mysql-persistent-storage<br/> mountPath: /var/lib/mysql<br/> volumes:<br/> — name: mysql-persistent-storage<br/> persistentVolumeClaim:<br/> claimName: mysql-efs</span></pre></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h2 id="4478" class="kl km ht bd kn ko kp kq kr ks kt ku kv js kw kx ky jt kz la lb ju lc ld le lf bi translated">WordPress(Webapp)的部署</h2><pre class="md me mf mg fd mu mv mw mx aw my bi"><span id="8ba1" class="kl km ht mv b fi mz na l nb nc">apiVersion: v1<br/>kind: Service<br/>metadata:<br/> name: wordpress<br/> labels:<br/> app: wordpress<br/>spec:<br/> ports:<br/> — port: 80<br/> selector:<br/> app: wordpress<br/> tier: frontend<br/> type: LoadBalancer<br/> — -<br/>apiVersion: apps/v1 # for versions before 1.9.0 use apps/v1beta2<br/>kind: Deployment<br/>metadata:<br/> name: wordpress<br/> labels:<br/> app: wordpress<br/>spec:<br/> selector:<br/> matchLabels:<br/> app: wordpress<br/> tier: frontend<br/> strategy:<br/> type: Recreate<br/> template:<br/> metadata:<br/> labels:<br/> app: wordpress<br/> tier: frontend<br/> spec:<br/> containers:<br/> — image: wordpress:4.8-apache<br/> name: joomla<br/> env:<br/> — name: WORDPRESS_DB_HOST<br/> value: wordpress-mysql<br/> — name: WORDPRESS_DB_PASSWORD<br/> valueFrom:<br/> secretKeyRef:<br/> name: mysecret<br/> key: password<br/> ports:<br/> — containerPort: 80<br/> name: wordpress<br/> volumeMounts:<br/> — name: wordpress-persistent-storage<br/> mountPath: /var/www/html<br/> volumes:<br/> — name: wordpress-persistent-storage<br/> persistentVolumeClaim:<br/> claimName: wordpress-efs</span></pre><ul class=""><li id="7eb9" class="lg lh ht iw b ix iy jb jc js lz jt ma ju mb jr ln lo lp lq bi translated">使用负载平衡器的AWS ELB服务作为我们的web应用程序连接到外部世界的服务类型。</li></ul></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><blockquote class="iq ir is"><p id="d9de" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要运行上述所有代码，您可以使用:-</p><p id="b903" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ne nf ng mv b">kubectl create -f 'file_name'</code></p><p id="8406" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，使用以下命令检查所有文件是否已成功创建:-</p><p id="488a" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ne nf ng mv b">kubectl get all</code></p></blockquote><figure class="md me mf mg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nh"><img src="../Images/898b49ac21ad01f954611d8deeae476d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xSnhmVy0yJEKah3lJOyfCg.png"/></div></div></figure><ul class=""><li id="6af0" class="lg lh ht iw b ix iy jb jc js lz jt ma ju mb jr ln lo lp lq bi translated">使用AWS负载平衡器DNS主机名，我们可以看到我们部署的webapp(WordPress)。</li></ul><figure class="md me mf mg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nh"><img src="../Images/e4c111f33080e91ba65d27d0a49ff270.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-gTI01SgoY7GofdfmSRVOA.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">AWS ELB</figcaption></figure><ul class=""><li id="bf67" class="lg lh ht iw b ix iy jb jc js lz jt ma ju mb jr ln lo lp lq bi translated">最后，我们的已经在aws_eks集群中部署…</li></ul><div class="md me mf mg fd ab cb"><figure class="mh hk mi mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/6b73876cb4e731ec462bcc5cfcfa0a8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*4w8zAYi4Uw48X9zy_yk7hw.png"/></div></figure><figure class="mh hk mi mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/1976f7a4492b0e74eee87f5b31cc8914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*cCRp6JVTISHnBgJGzx3RPA.png"/></div><figcaption class="mn mo et er es mp mq bd b be z dx mr di ms mt translated">AWS上的WORDPRESS _ EKS</figcaption></figure></div><h2 id="daef" class="kl km ht bd kn ko kp kq kr ks kt ku kv js kw kx ky jt kz la lb ju lc ld le lf bi translated">感谢阅读！！！</h2><p id="378f" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je js lw jh ji jt lx jl jm ju ly jp jq jr hb bi translated">热烈欢迎所有的建议和掌声。</p><blockquote class="iq ir is"><p id="37f5" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Github知识库，以获得代码中的更多帮助:-</p></blockquote><div class="hh hi ez fb hj ni"><a href="https://github.com/Akashdeep-47/AWS_EKS.git" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab dw"><div class="nk ab nl cl cj nm"><h2 class="bd hu fi z dy nn ea eb no ed ef hs bi translated">阿卡什迪普-47/EKS自动气象站</h2><div class="np l"><h3 class="bd b fi z dy nn ea eb no ed ef dx translated">在AWS EKS亚马逊EKS(Kubernetes的弹性容器服务)部署web app(WordPress)-允许您使用…</h3></div><div class="nq l"><p class="bd b fp z dy nn ea eb no ed ef dx translated">github.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw hp ni"/></div></div></a></div></div></div>    
</body>
</html>