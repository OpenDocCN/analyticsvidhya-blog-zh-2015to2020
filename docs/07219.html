<html>
<head>
<title>tf-explain working with tensorboard</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TF-解释如何使用tensorboard</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/tf-explain-working-283a311f1276?source=collection_archive---------13-----------------------#2020-06-17">https://medium.com/analytics-vidhya/tf-explain-working-283a311f1276?source=collection_archive---------13-----------------------#2020-06-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7403bafeb48fe3e2c07c93ad2254e494.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rdD0n5yUrAF4_BrHVg6eqw.png"/></div></div></figure><p id="a5fc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">tf-explain是一个完全基于tensorflow 2.0构建的pip可安装库，与tf.keras一起使用。它有助于更好地理解我们当前正在训练的模型。在tf.keras中，我们在训练时提供给模型的回调中使用它的所有API。</p><p id="4876" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">毫无疑问，tf-explain不是tensorflow的官方产品，但它完全是基于tensorflow 2.0构建的。它的一个主要优势是使用tensorboard，它以更好的视图和清晰的图形为我们提供与图像相关的信息。</p><p id="a674" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完整代码在<a class="ae jo" href="https://github.com/AshishGusain17/Grad-CAM-implementation/blob/master/tf_explain_methods.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/ashishgusain 17/Grad-CAM-implementation/blob/master/TF _ explain _ methods . ipynb</a>中。各种方法在图像上的实现可以在下面的图形中看到。</p><h1 id="e073" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">安装:</strong></h1><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="69de" class="kw jq hi ks b fi kx ky l kz la">pip install tf-explain<br/>pip install tensorflow==2.1.0</span></pre><h1 id="b471" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">使用他们的API:</strong></h1><p id="33d7" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">1.)构建一个tf.keras模型</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="4d41" class="kw jq hi ks b fi kx ky l kz la">img_input = tf.keras.Input((28,28,1))<br/>x = tf.keras.layers.Conv2D(filters=32, kernel_size=(3, 3), activation=”relu” , name=”layer1")(img_input)<br/>x = tf.keras.layers.Conv2D(filters=64, kernel_size=(3, 3), activation=”relu”, name=”layer2")(x)</span><span id="4b44" class="kw jq hi ks b fi lg ky l kz la">x = tf.keras.layers.MaxPool2D(pool_size=(2, 2))(x)<br/>x = tf.keras.layers.Dropout(0.25)(x)<br/>x = tf.keras.layers.Flatten()(x)<br/>x = tf.keras.layers.Dense(128, activation=”relu”)(x)<br/>x = tf.keras.layers.Dropout(0.5)(x)<br/>x = tf.keras.layers.Dense(10, activation=”softmax”)(x)</span><span id="ab73" class="kw jq hi ks b fi lg ky l kz la">model = tf.keras.Model(img_input, x)<br/>model.summary()</span></pre><p id="4c87" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.)为任何特定的标签创建验证数据集，该标签将作为API的输入给出。我们使用了包含60，000幅训练图像和10，000幅测试图像的mnist数据集。它有10类图像，数字范围从0到9。让我们将标签0和4的元组创建为validation_class_zero和validation_class_four，如下所示。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="5a71" class="kw jq hi ks b fi kx ky l kz la"># Here, we choose 5 elements with one hot encoded label “0” == [1, 0, 0, 0, 0, 0, 0, 0, 0, 0]</span><span id="6328" class="kw jq hi ks b fi lg ky l kz la">validation_class_zero = (<br/>    np.array(<br/>       [<br/>           el<br/>           for el, label in zip(test_images, test_labels) <br/>           if np.all(np.argmax(label) == 0)<br/>       ][0:5]<br/>    ),None)<br/></span><span id="cd6d" class="kw jq hi ks b fi lg ky l kz la"># Here, we choose 5 elements with one hot encoded label “4” == [0, 0, 0, 0, 1, 0, 0, 0, 0, 0]</span><span id="dc1b" class="kw jq hi ks b fi lg ky l kz la">validation_class_four = (<br/>    np.array(<br/>       [<br/>           el<br/>           for el, label in zip(test_images, test_labels)<br/>           if np.all(np.argmax(label) == 4)<br/>       ][0:5]<br/>    ),None)</span></pre><p id="82c6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.)实例化回调:</p><p id="0ac7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，让我们实例化将提供给模型的各种回调。这些回调将针对数字0和4。在其中的一些，你可以看到所提供的层的名称，在上面的模型中可以看作是一个卷积层。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="5146" class="kw jq hi ks b fi kx ky l kz la">callbacks = [</span><span id="025c" class="kw jq hi ks b fi lg ky l kz la">tf_explain.callbacks.GradCAMCallback(validation_class_zero, class_index=0, layer_name=”layer2"),<br/>tf_explain.callbacks.GradCAMCallback(validation_class_four, class_index=4, layer_name=”layer2"),</span><span id="5c01" class="kw jq hi ks b fi lg ky l kz la">tf_explain.callbacks.ActivationsVisualizationCallback(validation_class_zero, layers_name=[“layer2”]),<br/>tf_explain.callbacks.ActivationsVisualizationCallback(validation_class_four, layers_name=[“layer2”]),</span><span id="2266" class="kw jq hi ks b fi lg ky l kz la">tf_explain.callbacks.SmoothGradCallback(validation_class_zero, class_index=0, num_samples=15, noise=1.0),<br/>tf_explain.callbacks.SmoothGradCallback(validation_class_four, class_index=4, num_samples=15, noise=1.0),</span><span id="5e80" class="kw jq hi ks b fi lg ky l kz la">tf_explain.callbacks.IntegratedGradientsCallback(validation_class_zero, class_index=0, n_steps=10),<br/>tf_explain.callbacks.IntegratedGradientsCallback(validation_class_four, class_index=4, n_steps=10),</span><span id="95ca" class="kw jq hi ks b fi lg ky l kz la">tf_explain.callbacks.VanillaGradientsCallback(validation_class_zero, class_index=0),<br/>tf_explain.callbacks.VanillaGradientsCallback(validation_class_four, class_index=4),</span><span id="4036" class="kw jq hi ks b fi lg ky l kz la">tf_explain.callbacks.GradientsInputsCallback(validation_class_zero, class_index=0),<br/>tf_explain.callbacks.GradientsInputsCallback(validation_class_four, class_index=4)<br/>]</span></pre><p id="f368" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.)加载张量板:</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="405a" class="kw jq hi ks b fi kx ky l kz la">%reload_ext tensorboard<br/>%tensorboard — logdir logs</span></pre><p id="93f2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.)模型的训练:</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="8852" class="kw jq hi ks b fi kx ky l kz la">opt1 = tf.keras.optimizers.Adam(learning_rate=0.001)</span><span id="6c16" class="kw jq hi ks b fi lg ky l kz la">model.compile(optimizer=opt1, loss=”categorical_crossentropy”, metrics=[“accuracy”])<br/>model.fit(train_images, train_labels, epochs=20, batch_size=32, callbacks=callbacks)</span></pre><p id="b37c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">6.)结果:</p><p id="ea10" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我得到的结果是损失:0.4919 —准确度:0.8458。这些是在仅仅4-5个时期后获得的。我尝试了各种优化器，SGD和AdaGrad花费了大约15个时期的最大时间。</p><p id="c70b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">7.)Tensorboard结果:</p><p id="c076" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">编号为0和4的图像的激活可视化:</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/034c91e4223210f1f7d52980642b517f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KvyycYlp97hh-eCIo4-koA.jpeg"/></div></div></figure><p id="9bf3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">编号为0和4的图像的GradCAM实现:</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/2c715d42c15c3132fc4c7a3321fea9a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L_oEF7_E0Pjj1yyzmUhU8A.jpeg"/></div></div></figure><p id="03bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">编号为0和4的图像的梯度输入:</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/82efd17c36d32e8f1aac0e7b0f2ca6b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1cj8K4V6VAmSHtK4dr_CLw.jpeg"/></div></div></figure><p id="e94a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">编号为0和4的图像的普通渐变:</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/3a2f377933b9187cc84adaa6141fe1e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kf-aEYSgZxlqjdi5GVU0Xg.jpeg"/></div></div></figure><p id="f939" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">整合编号为0和4的图像的梯度:</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/a3334f45155740a39af4ef1c73d81175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6WoWxmLfZZNsNtBEFBCQkg.jpeg"/></div></div></figure><p id="a47d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">编号为0和4的图像的平滑渐变:</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/d4c910d44d7def63a95511b6865fea61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lsSO7iDQ6H-i8kBhiG0-CQ.jpeg"/></div></div></figure><p id="aa89" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这都是我这边的。您可以通过以下方式联系我:</p><p id="cf93" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">电子邮件:ashishgusain12345@gmail.com</p><p id="2c4d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">github:<a class="ae jo" href="https://github.com/AshishGusain17" rel="noopener ugc nofollow" target="_blank">https://github.com/AshishGusain17</a></p><p id="e7cf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">领英:<a class="ae jo" href="https://www.linkedin.com/in/ashish-gusain-257b841a2/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/ashish-gusain-257b841a2/</a></p><p id="8969" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">演职员表:<a class="ae jo" href="https://tf-explain.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">https://tf-explain.readthedocs.io/en/latest/</a></p></div></div>    
</body>
</html>