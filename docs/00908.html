<html>
<head>
<title>Rendering a Google Map in a JavaScript Front-End</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在JavaScript前端呈现谷歌地图</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/rendering-a-google-map-in-a-javascript-front-end-part-i-a076420a9ee9?source=collection_archive---------1-----------------------#2019-09-18">https://medium.com/analytics-vidhya/rendering-a-google-map-in-a-javascript-front-end-part-i-a076420a9ee9?source=collection_archive---------1-----------------------#2019-09-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="4dda" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">第一部分:Google Maps项目和Maps API的安装和设置</h2></div><p id="ae2b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我是一名新的程序员，目前是熨斗学校的学生，具有土地保护和空间建模的背景。学习软件开发的一个主要动机是希望培养我的能力，去创造新的、有用的工具，来帮助自然资源管理者和自然资源保护者的关键性工作。</p><p id="3701" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由于我过去的大部分工作都是基于地图的，我知道我希望我作为一名程序员的第一个项目是将交互式网络地图与实际应用结合起来。当面临用JavaScript前端创建Rails应用程序的挑战时，我决定使用Google Maps JavaScript API来构建一个工具，以帮助消防员和林务员跟踪野火并计划规定的燃烧。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/ea490a51031a82f694d010ab2b4decf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9bGLbGTHPHG1LP6G_fkn_Q.png"/></div></div></figure></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="6ed0" class="km kn hi bd ko kp kq kr ks kt ku kv kw io kx ip ky ir kz is la iu lb iv lc ld bi translated">谷歌云平台上的项目设置</h1><p id="026f" class="pw-post-body-paragraph ix iy hi iz b ja le ij jc jd lf im jf jg lg ji jj jk lh jm jn jo li jq jr js hb bi translated">在开始使用Google Maps API进行任何开发之前，我首先需要完成一些关键任务:</p><ol class=""><li id="f92c" class="lj lk hi iz b ja jb jd je jg ll jk lm jo ln js lo lp lq lr bi translated">在<a class="ae ls" href="https://cloud.google.com/console/google/maps-apis/overview" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>上创建一个谷歌地图项目</li><li id="b0e6" class="lj lk hi iz b ja lt jd lu jg lv jk lw jo lx js lo lp lq lr bi translated">选择一套谷歌地图产品应用到项目中</li><li id="fb54" class="lj lk hi iz b ja lt jd lu jg lv jk lw jo lx js lo lp lq lr bi translated">获取API密钥</li><li id="9751" class="lj lk hi iz b ja lt jd lu jg lv jk lw jo lx js lo lp lq lr bi translated">启用项目计费</li></ol><p id="4a5c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> <em class="ly">创建谷歌云项目</em> </strong></p><p id="cc35" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我首先在谷歌云平台上创建了一个账户。为了向我的帐户添加一个新项目，我导航到主页上的项目下拉菜单，</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lz"><img src="../Images/e77c91a348309b77f65a854a2b48f36b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4I_ydVOXPI3fPI4Zvanivg.png"/></div></div></figure><p id="f818" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">点击随后屏幕上的“新建项目”按钮，</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ma"><img src="../Images/dea98f05d7c86f174f346dfd890ea826.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dP3aW1VT-d-B6Tye3bRzww.png"/></div></div></figure><p id="f868" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">并为新项目命名(可以选择将其分配到一个组织文件夹中)。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mb"><img src="../Images/fc6d35088f91bcc1626e368fac542fd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7kc9c3vQLvMTSO6qhPdWcw.png"/></div></div></figure><p id="f725" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> <em class="ly">选择谷歌地图产品套件</em> </strong></p><p id="964e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">随着一个新项目的创建，我需要仔细考虑，具体来说，我希望这个项目完成什么。我描绘了一个清晰的用户场景—我想用实时wildfire点数据填充地图，并让最终用户能够在地图上导航并与该数据交互。此外，我希望目标终端用户(例如，野火战斗人员和护林员)能够围绕每个野火点绘制持久的可编辑多边形，以在空间上表示火灾的当前范围。最后，我希望地图在渲染时自动地理参考用户的位置，以使绘制精确的多边形更简单。</p><p id="0319" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Google Maps JavaScript API提供了三组不同的产品和工具，开发者可以将它们应用到云平台的项目中:</p><ol class=""><li id="9fa3" class="lj lk hi iz b ja jb jd je jg ll jk lm jo ln js lo lp lq lr bi translated"><a class="ae ls" href="https://cloud.google.com/maps-platform/maps/" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj">地图</strong> </a> <strong class="iz hj"> : </strong>使开发人员能够向应用程序添加交互式地图，包括街景图像和360度全景图。</li><li id="fd25" class="lj lk hi iz b ja lt jd lu jg lv jk lw jo lx js lo lp lq lr bi translated"><a class="ae ls" href="https://cloud.google.com/maps-platform/routes/" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj">路线</strong> </a> <strong class="iz hj"> : </strong>让您的用户确定从一点到另一点的最有效路径。路线包还提供导航和实时交通更新。</li><li id="422f" class="lj lk hi iz b ja lt jd lu jg lv jk lw jo lx js lo lp lq lr bi translated"><a class="ae ls" href="https://cloud.google.com/maps-platform/places/" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj">地点</strong> </a> <strong class="iz hj"> : </strong>允许用户使用电话号码和地址查找特定地点。Places包包括额外的API，这些API提供将地址地理编码到特定坐标的能力，并使用手机信号塔和WiFi节点数据返回设备的位置。</li></ol><p id="86aa" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建新项目时，系统会提示我选择希望项目访问的工具集。基于我设定的用户故事和目标，我认为地图和地点包都是必要的。</p><p id="1583" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> <em class="ly">获取API密钥</em> </strong></p><p id="28a6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了在应用程序中渲染地图，我首先需要生成一个特定于我的Google Cloud帐户和项目的API密钥。为了创建一个新的API密钥，我导航回到了<a class="ae ls" href="https://cloud.google.com/console/google/maps-apis/overview" rel="noopener ugc nofollow" target="_blank"> Google云平台</a>。在汉堡包菜单中，我选择了“API&amp;服务”菜单中的“凭证”选项。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mc"><img src="../Images/64f10f33133c6b3e93f5d8c68f300f6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C4qU-thLyu5Z1NB_5ulURQ.png"/></div></div></figure><p id="31ec" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在随后的页面上选择“Create credentials”下拉菜单并选择“API key”生成了一个惟一的键，我保存了这个键以供参考，并在为我的应用程序构建HTML时使用。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es md"><img src="../Images/7e18115bff1e8d704ae890c355e59465.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9so37bo6TrOy2Xwlm6vNUw.png"/></div></div></figure><p id="a597" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> <em class="ly">启用项目计费</em> </strong></p><p id="499e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Google Maps JavaScript API要求您输入信用卡信息并确认账单政策，然后才能在应用程序中使用产品。一个项目的每月总费用由所使用的谷歌地图产品和应用程序的使用情况决定。从<a class="ae ls" href="https://developers.google.com/maps/billing/gmp-billing" rel="noopener ugc nofollow" target="_blank">谷歌地图平台计费页面</a>:</p><blockquote class="me mf mg"><p id="db2a" class="ix iy ly iz b ja jb ij jc jd je im jf mh jh ji jj mi jl jm jn mj jp jq jr js hb bi translated">跟踪每个产品SKU的使用情况。</p><p id="947d" class="ix iy ly iz b ja jb ij jc jd je im jf mh jh ji jj mi jl jm jn mj jp jq jr js hb bi translated">SKU是产品API +被调用的服务或功能的组合(例如，位置API-位置细节)。</p><p id="8ba2" class="ix iy ly iz b ja jb ij jc jd je im jf mh jh ji jj mi jl jm jn mj jp jq jr js hb bi translated">一个产品可能有多个按不同费率计费的SKU(例如，Places API—Place Details；Places API —自动完成—按请求)。</p><p id="d162" class="ix iy ly iz b ja jb ij jc jd je im jf mh jh ji jj mi jl jm jn mj jp jq jr js hb bi translated">SKU定价根据使用量分为三个等级:0-100，000英镑；100,001–500,000;500,001+.</p><p id="04dc" class="ix iy ly iz b ja jb ij jc jd je im jf mh jh ji jj mi jl jm jn mj jp jq jr js hb bi translated">成本的计算方法是SKU使用率x每次使用的价格。</p></blockquote></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="4f4b" class="km kn hi bd ko kp kq kr ks kt ku kv kw io kx ip ky ir kz is la iu lb iv lc ld bi translated">渲染地图</h1><p id="d5bf" class="pw-post-body-paragraph ix iy hi iz b ja le ij jc jd lf im jf jg lg ji jj jk lh jm jn jo li jq jr js hb bi translated"><strong class="iz hj"> <em class="ly">创建文件结构</em> </strong></p><p id="de49" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在浏览器中渲染地图需要两个关键文件:</p><ol class=""><li id="ad30" class="lj lk hi iz b ja jb jd je jg ll jk lm jo ln js lo lp lq lr bi translated"><strong class="iz hj">index.html</strong>:规定网页的基本结构和流程，通过容纳API键作为到谷歌地图API的链接，并通过回调函数初始化地图渲染。</li><li id="3a7d" class="lj lk hi iz b ja lt jd lu jg lv jk lw jo lx js lo lp lq lr bi translated"><strong class="iz hj"> index.js </strong>:存放地图初始化函数和渲染时要执行的任何操作。</li></ol><p id="27e4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> <em class="ly">构建HTML </em> </strong></p><p id="a497" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我在HTML文件中包含了以下组件:</p><ol class=""><li id="0bb7" class="lj lk hi iz b ja jb jd je jg ll jk lm jo ln js lo lp lq lr bi translated">在文件的顶部，我将文档的内容声明为HTML5:</li></ol><pre class="ju jv jw jx fd mk ml mm mn aw mo bi"><span id="0be6" class="mp kn hi ml b fi mq mr l ms mt">&lt;!DOCTYPE html&gt;</span></pre><p id="701a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.在文件的开头，我描述了文档的元数据，并给应用程序起了一个标题，如下所示:</p><pre class="ju jv jw jx fd mk ml mm mn aw mo bi"><span id="95d5" class="mp kn hi ml b fi mq mr l ms mt">&lt;html lang="en" dir="ltr"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta<br/>       charset="utf-8"<br/>       name="viewport"<br/>       content="width=device-width,<br/>       initial-scale=1,<br/>       shrink-to-fit=no"&gt;<br/>    &lt;title&gt;Wildfire Tracker&lt;/title&gt;<br/>  &lt;/head&gt;</span></pre><p id="19e6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.我还创建了一个相关的CSS样式表，并使用bootstrap(一个开源的样式工具包)来增强我的应用程序的外观。我在head标记中包含了样式表和Boostrap CDN的链接。</p><p id="56cb" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">4.地图本身保存在HTML文件的body标签中。在使用bootstrap在页面顶部创建了h1和一个简单的导航栏之后，我为地图本身创建了一个占位符div。</p><pre class="ju jv jw jx fd mk ml mm mn aw mo bi"><span id="78da" class="mp kn hi ml b fi mq mr l ms mt">&lt;div class="map-container"&gt;<br/>   &lt;div class = "map" id="map"&gt;&lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="3479" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">5.在主体的底部，我链接到了相关的JavaScript文件index.js。</p><pre class="ju jv jw jx fd mk ml mm mn aw mo bi"><span id="7e87" class="mp kn hi ml b fi mq mr l ms mt">&lt;script src="src/index.js" type="text/javascript"&gt;&lt;/script&gt;</span></pre><p id="12bd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">6.最后，我包含了对一个Google文件的调用，该文件保存了Google Maps JavaScript API中包含的所有符号和定义。这个脚本标记还传递我生成的个性化API键，如上所述，以访问相关数据。此外，“callback”关键字引用了我的JavaScript文件中的一个函数，该函数设置要呈现的地图的属性。“Async defer”指定当页面的其余部分完成解析时，应执行脚本标记的内容。一旦API准备好了，它就调用回调参数中指定的函数(这里是initMap)</p><pre class="ju jv jw jx fd mk ml mm mn aw mo bi"><span id="2a25" class="mp kn hi ml b fi mq mr l ms mt">&lt;script<br/>   async defer src="<a class="ae ls" href="https://maps.googleapis.com/maps/api/js?key={YOUR" rel="noopener ugc nofollow" target="_blank">https://maps.googleapis.com/maps/api/js?key={YOUR</a> API KEY}<br/>   callback=initMap&amp;libraries=drawing"<br/>   type="text/javascript"&gt;<br/>&lt;/script&gt;</span></pre><p id="bb26" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> <em class="ly">用JavaScript渲染地图</em> </strong></p><p id="5a16" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">地图的核心功能和样式保存在一个初始化函数中，该函数在HTML文件呈现时执行。首先，调用一个函数并创建一个新的Google Maps元素，如下所示:</p><pre class="ju jv jw jx fd mk ml mm mn aw mo bi"><span id="4848" class="mp kn hi ml b fi mq mr l ms mt">function initMap() {<br/>    let map = new google.maps.Map(<br/>      document.getElementById('map'){</span></pre><p id="30dd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该功能还保存地图上包含的每个元素的所需样式，如项目设置时在谷歌云平台中选择的谷歌地图产品所指示的。因为我希望明亮的wildfire点数据与底图形成良好的对比，所以我选择了我建立的暗模式样式，如下所示:</p><pre class="ju jv jw jx fd mk ml mm mn aw mo bi"><span id="5c62" class="mp kn hi ml b fi mq mr l ms mt">styles: [<br/> {elementType: 'geometry', stylers: [{color: '#242f3e'}]},<br/> {elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]},<br/> {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},<br/> {<br/>    featureType: 'administrative.locality',<br/>    elementType: 'labels.text.fill',<br/>    stylers: [{color: '#d59563'}]<br/>  },<br/>  {<br/>    featureType: 'poi',<br/>    elementType: 'labels.text.fill',<br/>    stylers: [{color: '#d59563'}]<br/>   },<br/>   {<br/>    featureType: 'poi.park',<br/>    elementType: 'geometry',<br/>    stylers: [{color: '#263c3f'}]<br/>   },<br/>   {<br/>    featureType: 'poi.park',<br/>    elementType: 'labels.text.fill',<br/>    stylers: [{color: '#6b9a76'}]<br/>   },<br/>   {<br/>    featureType: 'road',<br/>    elementType: 'geometry',<br/>    stylers: [{color: '#38414e'}]<br/>   },<br/>   {<br/>    featureType: 'road',<br/>    elementType: 'geometry.stroke',<br/>    stylers: [{color: '#212a37'}]<br/>   },<br/>   {<br/>    featureType: 'road',<br/>    elementType: 'labels.text.fill',<br/>    stylers: [{color: '#9ca5b3'}]<br/>   },<br/>   {<br/>    featureType: 'road.highway',<br/>    elementType: 'geometry',<br/>    stylers: [{color: '#746855'}]<br/>   },<br/>   {<br/>    featureType: 'road.highway',<br/>    elementType: 'geometry.stroke',<br/>    stylers: [{color: '#1f2835'}]<br/>   },<br/>   {<br/>    featureType: 'road.highway',<br/>    elementType: 'labels.text.fill',<br/>    stylers: [{color: '#f3d19c'}]<br/>   },<br/>   {<br/>    featureType: 'transit',<br/>    elementType: 'geometry',<br/>    stylers: [{color: '#2f3948'}]<br/>   },<br/>   {<br/>    featureType: 'transit.station',<br/>    elementType: 'labels.text.fill',<br/>    stylers: [{color: '#d59563'}]<br/>   },<br/>   {<br/>    featureType: 'water',<br/>    elementType: 'geometry',<br/>    stylers: [{color: '#17263c'}]<br/>   },<br/>   {<br/>    featureType: 'water',<br/>    elementType: 'labels.text.fill',<br/>    stylers: [{color: '#515c6d'}]<br/>   },<br/>   {<br/>    featureType: 'water',<br/>    elementType: 'labels.text.stroke',<br/>    stylers: [{color: '#17263c'}]<br/>   }<br/>  ]<br/>})</span></pre><p id="5cca" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在同一个初始化函数中，我还让我的最终用户能够访问Google Maps <a class="ae ls" href="https://developers.google.com/maps/documentation/javascript/examples/drawing-tools" rel="noopener ugc nofollow" target="_blank">绘图管理器</a>，并引入了地理定位，使用用户的位置作为地图中心来呈现界面。</p></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><p id="f570" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我的下一篇文章中，我将讨论使用Google Maps JavaScript API和Ruby on Rails后端对各种类型的数据进行渲染、持久化和执行完整的CRUD操作。</p></div></div>    
</body>
</html>