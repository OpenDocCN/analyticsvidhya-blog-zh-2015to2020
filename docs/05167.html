<html>
<head>
<title>Use Python To Pull Energy Data From The Department of Energy’s EIA API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python从能源部的EIA API中提取能源数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/use-python-to-pull-energy-data-from-the-us-department-of-energys-api-11d6f724927e?source=collection_archive---------6-----------------------#2020-04-13">https://medium.com/analytics-vidhya/use-python-to-pull-energy-data-from-the-us-department-of-energys-api-11d6f724927e?source=collection_archive---------6-----------------------#2020-04-13</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><figure class="ew ey ih ii ij ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et ig"><img src="../Images/798a9091dae167def6597c012e6f957c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aflYJinxluCz3q14vttBnw.jpeg"/></div></div><figcaption class="ir is eu es et it iu bd b be z dy translated">照片由<a class="ae iv" href="https://unsplash.com/@appolinary_kalashnikova?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">在<a class="ae iv" href="https://unsplash.com/s/photos/energy?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的卡拉什尼科夫</a>拍摄</figcaption></figure><p id="18be" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated"><a class="ae iv" href="http://www.eia.gov" rel="noopener ugc nofollow" target="_blank">能源信息署</a>负责美国能源部的统计和数据。美国有大量与能源相关的数据和信息，包括可再生能源、核能、原油、汽油、喷气燃料、柴油、电力和天然气。</p><p id="5bb3" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">然而，在EIA的网站上导航和查找数据可能会很棘手。为了帮助解决这个问题，EIA创建了一个易于访问的API。你可以在<a class="ae iv" href="http://www.eia.com/opendata." rel="noopener ugc nofollow" target="_blank">www.eia.com/opendata.</a>找到API。根据不同类型的数据，EIA每周、每月或每年发布新数据。该API对于在每周和每月数据发布时刷新它们非常有用。</p><p id="3cea" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">例如，我使用从EIA的API中提取的数据创建了下图。每次月度数据发布，我都可以重新运行代码，图形会自动更新。为了可视化，我从<a class="ae iv" href="https://towardsdatascience.com/visualizing-covid-19-data-beautifully-in-python-in-5-minutes-or-less-affc361b2c6a" rel="noopener" target="_blank">这篇文章</a>中得到代码。</p><figure class="jv jw jx jy fe ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et ju"><img src="../Images/c742ee5c227a83f9bf8a56423e415234.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YhaXtU7ZSM5qv6kQrmjxIQ.jpeg"/></div></div></figure></div><div class="ab cl jz ka gq kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hc hd he hf hg"><h1 id="0f7b" class="kg kh hj bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">API访问— API密钥</h1><p id="5ab3" class="pw-post-body-paragraph iw ix hj iy b iz le jb jc jd lf jf jg jh lg jj jk jl lh jn jo jp li jr js jt hc bi translated">首先，您需要从EIA获得一个API密钥。转到<a class="ae iv" href="http://www.eia.com/opendata" rel="noopener ugc nofollow" target="_blank">www.eia.com/opendata</a>并点击“立即注册”按钮。</p><figure class="jv jw jx jy fe ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et lj"><img src="../Images/12823d17f607050b4adb663e072c10e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tx1cznpVTYy3M_3LYmmRIg.png"/></div></div></figure><p id="76dd" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">这将带你到一个注册表格，看起来像这样。输入您的信息，然后单击“注册”。您将收到一封包含新API密钥的电子邮件。它可能会被发送到您的垃圾文件夹，所以如果您在几分钟内没有收到API密钥，请务必检查那里。</p><figure class="jv jw jx jy fe ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et lk"><img src="../Images/0bda54abcfd6469f2021eac74cfae280.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ods5o380yP8ENRsR5TSqTw.png"/></div></div></figure></div><div class="ab cl jz ka gq kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hc hd he hf hg"><h1 id="10e2" class="kg kh hj bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">查找数据集</h1><p id="5f0b" class="pw-post-body-paragraph iw ix hj iy b iz le jb jc jd lf jf jg jh lg jj jk jl lh jn jo jp li jr js jt hc bi translated">现在，您可以通过API搜索想要获取的数据集。您可以通过点击<a class="ae iv" href="https://www.eia.gov/opendata/" rel="noopener ugc nofollow" target="_blank"> API主页上的“API查询浏览”来浏览数据集。</a></p><figure class="jv jw jx jy fe ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et ll"><img src="../Images/7d4378ac97f936c6e7ff1b77f2c62ab9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VJ2H-mGODI3NReLjBfORpQ.png"/></div></div></figure><p id="8d80" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">在下一页，您可以点击“儿童类别”下的链接来搜索您需要的数据。</p><figure class="jv jw jx jy fe ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et lm"><img src="../Images/98770e4170435946cc98849e4d22ea0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vSrihrpsg9tDJNhIUS1ouw.png"/></div></div></figure><p id="1763" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">另一种搜索数据的方法是点击页面顶部的“来源和用途”并浏览网站。当您遇到想要的数据集时，EIA通常会在API中发布一个指向该数据集的链接。</p></div><div class="ab cl jz ka gq kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hc hd he hf hg"><h1 id="18e1" class="kg kh hj bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">获取系列ID</h1><p id="4261" class="pw-post-body-paragraph iw ix hj iy b iz le jb jc jd lf jf jg jh lg jj jk jl lh jn jo jp li jr js jt hc bi translated">每个数据系列都有一个特定的系列ID。您将使用这个系列ID和API键从数据库中提取数据集。例如，下图显示了PADD 3(美国墨西哥湾沿岸)原油消费数据的系列ID。该代码允许您一次获取多个系列。跟踪所有您想要使用的系列id。</p><figure class="jv jw jx jy fe ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et ln"><img src="../Images/4b8cdb741a55268f7acd4c306ccd7f59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G2pnLtxCHo38oCtsaTgV3g.png"/></div></div></figure></div><div class="ab cl jz ka gq kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hc hd he hf hg"><p id="660e" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated"><strong class="iy hk">趣闻:</strong> PADD代表<a class="ae iv" href="https://en.wikipedia.org/wiki/Petroleum_Administration_for_Defense_Districts" rel="noopener ugc nofollow" target="_blank">石油管理局防区</a>。这些区域是在1942年第二次世界大战期间建立的，用来组织汽油和柴油等燃料的分配。今天，PADDs仍然用于按地区组织数据。</p><figure class="jv jw jx jy fe ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et lo"><img src="../Images/a6a0eab5c0e7784f4ba9439ff6a3e961.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/0*yVTtskAAvSkjJ56S.png"/></div></div><figcaption class="ir is eu es et it iu bd b be z dy translated">资料来源:环境影响评估</figcaption></figure></div><div class="ab cl jz ka gq kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hc hd he hf hg"><h1 id="f3c2" class="kg kh hj bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">使用Python拉入数据</h1><p id="20ad" class="pw-post-body-paragraph iw ix hj iy b iz le jb jc jd lf jf jg jh lg jj jk jl lh jn jo jp li jr js jt hc bi translated">现在我们有了API键和系列id，我们可以编写Python代码来访问数据。首先，导入必要的库。我们将使用pandas、numpy、requests、matplotlib和datetime。数据是json格式的，所以我们需要请求库来正确读取数据。</p><pre class="jv jw jx jy fe lp lq lr ls aw lt bi"><span id="af99" class="lu kh hj lq b fj lv lw l lx ly">#Import libraries<br/>import pandas as pd<br/>import requests<br/>import matplotlib.pyplot as plt<br/>import numpy as np<br/>from datetime import date<br/>import matplotlib.ticker as ticker</span></pre><p id="9741" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">现在，将您的API密钥粘贴到代码中。然后粘贴您想要提取的系列id。用逗号分隔您的系列id。在下面的代码中,“PADD名称”变量充当您希望在最终数据帧中使用的列名。您还可以使用“startDate”和“endDate”变量选择想要提取的日期范围。</p><pre class="jv jw jx jy fe lp lq lr ls aw lt bi"><span id="957f" class="lu kh hj lq b fj lv lw l lx ly"># API Key from EIA<br/>api_key = 'PASTE YOUR API KEY HERE'</span><span id="a97a" class="lu kh hj lq b fj lz lw l lx ly"># PADD Names to Label Columns<br/># Change to whatever column labels you want to use.</span><span id="c53f" class="lu kh hj lq b fj lz lw l lx ly">PADD_NAMES = ['PADD 1','PADD 2','PADD 3','PADD 4','PADD 5']</span><span id="b9cf" class="lu kh hj lq b fj lz lw l lx ly"># Enter all your Series IDs here separated by commas<br/>PADD_KEY = ['PET.MCRRIP12.M',<br/>'PET.MCRRIP22.M',<br/>'PET.MCRRIP32.M',<br/>'PET.MCRRIP42.M',<br/>'PET.MCRRIP52.M']</span><span id="918c" class="lu kh hj lq b fj lz lw l lx ly"># Initialize list - this is the final list that you will store all the data from the json pull. Then you will use this list to concat into a pandas dataframe. </span><span id="690a" class="lu kh hj lq b fj lz lw l lx ly">final_data = []</span><span id="9dc3" class="lu kh hj lq b fj lz lw l lx ly"># Choose start and end dates<br/>startDate = '2009-01-01'<br/>endDate = '2021-01-01'</span></pre><p id="02d7" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">最后，调用API以json格式提取数据。您的url链接可能会根据您正在获取的数据集而变化。要检查所需的确切url，请查看API查询浏览器中的“要使用的API调用”链接。</p><figure class="jv jw jx jy fe ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et ma"><img src="../Images/93b45702bc7a0e6971a329ab1c84a066.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xk0HSC-EJxIL8tOOyFvX_A.png"/></div></div><figcaption class="ir is eu es et it iu bd b be z dy translated">API调用使用链接是您需要用来拉入API的链接。可能与下面提供的代码不同。</figcaption></figure><pre class="jv jw jx jy fe lp lq lr ls aw lt bi"><span id="ca3f" class="lu kh hj lq b fj lv lw l lx ly"># Pull in data via EIA API</span><span id="9d18" class="lu kh hj lq b fj lz lw l lx ly">for i in range(len(PADD_KEY)):</span><span id="aabc" class="lu kh hj lq b fj lz lw l lx ly">    url = '<a class="ae iv" href="http://api.eia.gov/series/?api_key='" rel="noopener ugc nofollow" target="_blank">http://api.eia.gov/series/?api_key='</a> + api_key +<br/>          '&amp;series_id=' + PADD_KEY[i]</span><span id="7d1d" class="lu kh hj lq b fj lz lw l lx ly">    r = requests.get(url)<br/>    json_data = r.json()<br/>    <br/>    if r.status_code == 200:<br/>        print('Success!')<br/>    else:<br/>        print('Error')<br/>    <br/>    df = pd.DataFrame(json_data.get('series')[0].get('data'),<br/>                      columns = ['Date', PADD_NAMES[i]])</span><span id="0f6d" class="lu kh hj lq b fj lz lw l lx ly">    df.set_index('Date', drop=True, inplace=True)<br/>    final_data.append(df)</span></pre></div><div class="ab cl jz ka gq kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hc hd he hf hg"><h1 id="4b13" class="kg kh hj bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">创建熊猫数据框架</h1><p id="0de1" class="pw-post-body-paragraph iw ix hj iy b iz le jb jc jd lf jf jg jh lg jj jk jl lh jn jo jp li jr js jt hc bi translated">现在把你所有的数据合并到一个熊猫数据框中，编辑日期，创建一个时间序列。</p><pre class="jv jw jx jy fe lp lq lr ls aw lt bi"><span id="a78c" class="lu kh hj lq b fj lv lw l lx ly"># Combine all the data into one dataframe<br/>crude = pd.concat(final_data, axis=1)</span><span id="3436" class="lu kh hj lq b fj lz lw l lx ly"># Create date as datetype datatype<br/>crude['Year'] = crude.index.astype(str).str[:4]<br/>crude['Month'] = crude.index.astype(str).str[4:]<br/>crude['Day'] = 1<br/>crude['Date'] = pd.to_datetime(crude[['Year','Month','Day']])<br/>crude.set_index('Date',drop=True,inplace=True)<br/>crude.sort_index(inplace=True)<br/>crude = crude[startDate:endDate]<br/>crude = crude.iloc[:,:5]</span></pre><p id="380b" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">现在你有了一个熊猫数据框架，它很容易操作、分析和可视化。</p><figure class="jv jw jx jy fe ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et mb"><img src="../Images/28efe60176d63618b96d00301311312c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XC7l2IhG1k6p6YGnkVOKRA.png"/></div></div></figure><p id="dd06" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">下面是上面的数据框架图。同样，可视化的代码来自<a class="ae iv" href="https://towardsdatascience.com/visualizing-covid-19-data-beautifully-in-python-in-5-minutes-or-less-affc361b2c6a" rel="noopener" target="_blank">这篇文章</a>，但是我在下面复制了我的确切代码。</p><figure class="jv jw jx jy fe ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et ju"><img src="../Images/c742ee5c227a83f9bf8a56423e415234.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YhaXtU7ZSM5qv6kQrmjxIQ.jpeg"/></div></div></figure><pre class="jv jw jx jy fe lp lq lr ls aw lt bi"><span id="55a0" class="lu kh hj lq b fj lv lw l lx ly"># Generating Colours and Style<br/>colors = {'PADD 1':'#045275', <br/>          'PADD 2':'#089099', <br/>          'PADD 3':'#7CCBA2', <br/>          'PADD 4':'#7C1D6F', <br/>          'PADD 5':'#DC3977'}</span><span id="1a52" class="lu kh hj lq b fj lz lw l lx ly">plt.style.use('fivethirtyeight')</span><span id="6aa7" class="lu kh hj lq b fj lz lw l lx ly"># Creating the Visualization<br/>plot = crude.plot(figsize=(12,8), <br/>                  color=list(colors.values()), <br/>                  linewidth=5, <br/>                  legend=False)</span><span id="1b34" class="lu kh hj lq b fj lz lw l lx ly">plot.yaxis.set_major_formatter(ticker.StrMethodFormatter('{x:,.0f}'))<br/>plot.grid(color='#d4d4d4')<br/>plot.set_xlabel('Date')<br/>plot.set_ylabel('Crude Inventory Levels (KBD)')</span><span id="845b" class="lu kh hj lq b fj lz lw l lx ly"># Assigning Colour<br/>for padd in list(colors.keys()):<br/>    plot.text(x = crude.index[-1], y = crude[padd].max(), color = <br/>    colors[padd], s = padd, weight = 'bold')</span><span id="f694" class="lu kh hj lq b fj lz lw l lx ly"># Adding Labels<br/>plot.text(x = crude.index[1], <br/>          y = int(crude.max().max())+1300, <br/>          s = "Crude Consumption by PADD (thousand barrels per<br/>               day)", <br/>          fontsize = 23, <br/>          weight = 'bold', <br/>          alpha = .75)</span><span id="8b52" class="lu kh hj lq b fj lz lw l lx ly">plot.text(x = crude.index[1], <br/>          y = int(crude.max().max())+900, <br/>          s = "Crude consumption by refineries and blenders is a  <br/>          proxy for crude demand in each region", <br/>          fontsize = 16, <br/>          alpha = .75)</span><span id="425d" class="lu kh hj lq b fj lz lw l lx ly">plot.text(x = crude.index[1], <br/>          y = -1000,<br/>          s = 'Source: Energy Information Administration<br/>          <a class="ae iv" href="http://www.eia.gov'" rel="noopener ugc nofollow" target="_blank">www.eia.gov'</a>, <br/>          fontsize = 10)</span></pre></div></div>    
</body>
</html>