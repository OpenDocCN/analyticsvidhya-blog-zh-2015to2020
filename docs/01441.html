<html>
<head>
<title>Inserting Pandas DataFrames Into Database using INSERT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用INSERT将Pandas数据帧插入数据库</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/inserting-pandas-dataframes-into-database-using-insert-815f0e4e6361?source=collection_archive---------0-----------------------#2019-10-23">https://medium.com/analytics-vidhya/inserting-pandas-dataframes-into-database-using-insert-815f0e4e6361?source=collection_archive---------0-----------------------#2019-10-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1ce5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当在Python中处理数据时，我们使用pandas，并且我们经常将数据存储为pandas数据帧。令人欣慰的是，如果我们想对数据帧使用SQL，我们不需要做任何转换；我们可以使用insert将熊猫数据帧直接插入MySQL数据库。</p><p id="5562" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是相同的步骤:</p><p id="6b66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤1:我们可以在这里使用字典创建我们自己的数据框架。我们还可以从CSV文件中导入数据，或者以任何其他方式创建数据帧，但是出于本例的目的，我们将只导入电影数据，如下所示:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="b3d9" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj">import pandas as pd <br/>movies = pd.read_csv(‘http://bit.ly/imdbratings')<br/>movies.head()</strong></span></pre><figure class="jd je jf jg fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es js"><img src="../Images/2f6dbf7ad5c67120004ec0ec3192fa24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_XS0SSJ7Hveeeew6deQnvg.png"/></div></div></figure><p id="ab17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤2:在我们的MySQL数据库中创建一个表。</p><p id="4c06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在将数据插入MySQL之前，我们将在MySQL中创建一个movies表来保存我们的数据。如果这样的表已经存在，我们可以跳过这一步。</p><p id="559f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ka">注意</em>:使用CREATE TABLE语句创建一个表，后跟表名，然后列出每一列及其数据类型。例如。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="cdbc" class="jm jn hi ji b fi jo jp l jq jr">                  <strong class="ji hj">CREATE TABLE movies_details(<br/>                               star_rating float(2,1),<br/>                               title varchar2(100),<br/>                               content_rating varchar2(10),<br/>                               ……);</strong></span></pre><p id="5db6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第4步:接下来，我们将创建一个列列表，通过遍历每一行并使用INSERT INTO将该行的值插入到数据库中，将我们的dataframe行逐个插入到数据库中。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="327a" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj"># creating column list for insertion <br/>cols = “`,`”.join([str(i) for i in data.columns.tolist()])<br/># Insert DataFrame records one by one. <br/>for i,row in data.iterrows():<br/>    sql = “INSERT INTO `movies_details` (`” +cols + “`) VALUES (“ + “%s,”*(len(row)-1) + “%s)” <br/>    cursor.execute(sql, tuple(row)) <br/># the connection is not autocommitted by default, so we must commit to save our # changes <br/>    connection.commit()</strong></span></pre><p id="d175" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第5步:同样，让我们查询数据库，以确保我们插入的数据已被正确保存。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="08b8" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj"># Execute query <br/>sql = “SELECT * FROM `movies_details`” <br/>cursor.execute(sql) </strong></span><span id="727d" class="jm jn hi ji b fi kb jp l jq jr"><strong class="ji hj"># Fetch all the records <br/>result = cursor.fetchall() <br/>for i in result: <br/>    print(i)</strong></span></pre><p id="7445" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="16a4" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj">(9.3, ‘The Shawshank Redemption’,’R’, ‘Crime’, 142, ‘[u’Tim Robbins’, u’Morgan Freeman’, u’Bob Gunt…’) </strong></span><span id="ee79" class="jm jn hi ji b fi kb jp l jq jr"><strong class="ji hj">(9.2,’The Godfather’, ‘R’,’Crime’,175, ‘[u’Marlon Brando’, u’Al Pacino’, u’James Caan’]’ </strong></span><span id="2d0b" class="jm jn hi ji b fi kb jp l jq jr"><strong class="ji hj">(9.1,’The Godfather: Part II’ , ‘R’, ‘Crime’,200, ‘[u’Al Pacino’, u’Robert De Niro’, u’Robert Duv…’) <br/>……</strong></span><span id="cbd5" class="jm jn hi ji b fi kb jp l jq jr">.......</span></pre><p id="fa72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们确信一切正常，我们就可以关闭连接。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="1d30" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj">connection.close()</strong></span></pre><p id="22bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下一篇文章中，我们将学习to_sql()方法，将熊猫数据帧插入MySQL数据库。</p></div></div>    
</body>
</html>