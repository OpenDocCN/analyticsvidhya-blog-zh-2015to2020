<html>
<head>
<title>Big Data in Google Cloud — Cost Monitoring</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云中的大数据——成本监控</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/big-data-in-google-cloud-cost-monitoring-da22282f6744?source=collection_archive---------19-----------------------#2020-07-31">https://medium.com/analytics-vidhya/big-data-in-google-cloud-cost-monitoring-da22282f6744?source=collection_archive---------19-----------------------#2020-07-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b386" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是三部曲中的第一部。</p><p id="6d93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大约在2019年初，当我们将大数据解决方案迁移到谷歌云平台(GCP)时，我们不知何故地担心<strong class="ih hj">的成本会如何根据<strong class="ih hj">如何组织</strong>而变化</strong>，以及<strong class="ih hj">我们的内部用户将如何利用提供的数据</strong>，主要是在BigQuery (BQ)中。此外，我们不希望我们的内部用户在使用数据时担心成本，但同时，我们也不希望愚蠢的错误给我们带来不必要的成本，因为我们选择了按需成本模型。</p><p id="9d98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以这篇文章是关于我们如何解决成本问题的故事。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/b971bc9171fce05955f855a010634301.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TJfnHGK1UfkhVlYsjNGrbw.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><a class="ae jt" href="https://pixabay.com/photos/savings-budget-investment-money-2789137/" rel="noopener ugc nofollow" target="_blank">https://pix abay . com/photos/savings-budget-investment-money-2789137/</a></figcaption></figure><p id="f2c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我想先告诉你我们做了什么，按什么顺序，为什么。此外，如果我们犯了任何错误，那么我将分享我对这些错误的想法，并谈谈我们当时的想法和我们现在认为需要改进的地方。</p><p id="4f7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">重要的是，尽管当时团队中没有人有使用GCP的经验，即使在使用了一年多之后，我确信我们还有很多要学习的。</p><h1 id="abf0" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">培训内部用户</h1><p id="61a1" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">大部分成本来源将由团队直接管理，除了可能成为我们成本的一大块，也就是BigQuery。我们有产品分析师、数据科学家、业务分析师和许多其他人，他们利用我们的流程生成的数据。在迁移的时候，他们都习惯于配置单元，并且使用我们当时的配置，他们所做的任何事情都不会产生额外的成本。现在，任务是让他们轻松过渡到BQ，并指导他们如何意识到成本。</p><h2 id="9ae6" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">BigQuery降低成本的一般准则</h2><p id="828a" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">鉴于BigQuery是按使用的数据量收费的，我们向内部用户提供以下通用指南:</p><ul class=""><li id="d594" class="ll lm hi ih b ii ij im in iq ln iu lo iy lp jc lq lr ls lt bi translated"><strong class="ih hj">优先考虑手头的任务</strong>，而不是成本；</li><li id="c0eb" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><strong class="ih hj">如果您需要的只是对数据有所了解，请使用预览</strong>；<br/>不收费。</li><li id="9a74" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><strong class="ih hj">利用为本地表提供的消耗预测</strong>；</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lz"><img src="../Images/f252d0c754eff4f8ba794229c2c7b83b.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/1*aj63gT_EyMLiof84CxUBdQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">消费预测的一个例子</figcaption></figure><ul class=""><li id="7f4d" class="ll lm hi ih b ii ij im in iq ln iu lo iy lp jc lq lr ls lt bi translated">完成目标所需的数据越少越好。</li></ul><p id="2f32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是一些减少查询使用的数据量的方法:</p><ul class=""><li id="6789" class="ll lm hi ih b ii ij im in iq ln iu lo iy lp jc lq lr ls lt bi translated"><strong class="ih hj">按分区过滤表；</strong> <br/>可以根据需要配置一个表。<br/>对于外部表格，也可以通过特殊字段<em class="ma">_文件名</em>进行过滤，只加载匹配的文件，降低成本。<br/> ⚠️关于外部表，它会扫描所有需要的文件来满足您的查询(并为此向您收费)，<strong class="ih hj">所以不要被显示以下内容的消费预测</strong>所迷惑:</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mb"><img src="../Images/32954d49794b60e03d9be90f1deb94c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*tRkxMwreWjm-sAtEAmqODw.png"/></div></figure><ul class=""><li id="2972" class="ll lm hi ih b ii ij im in iq ln iu lo iy lp jc lq lr ls lt bi translated"><strong class="ih hj">只选择必要的列；</strong> <br/>这就是为什么视图有时不太理想，因为它们将对所有列收费，而不管最终查询使用了多少列。</li><li id="2ffa" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><strong class="ih hj">用_TABLE_SUFFIX伪列</strong>过滤通配符表；</li><li id="f279" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><strong class="ih hj">重用缓存的查询；</strong> <br/>使用缓存中数据的查询不收费。<br/>虽然有很多限制(<a class="ae jt" href="https://cloud.google.com/bigquery/docs/cached-results" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/bigquery/docs/cached-results</a>)，但总的原则是<strong class="ih hj">查询和数据必须保持不变</strong>,<strong class="ih hj">查询不能使用非确定性函数</strong>，比如CURRENT_DATE()。<br/> ⚠️通配符表没有被缓存。</li><li id="45ac" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">使用<strong class="ih hj">限制</strong>不影响成本。</li></ul><h1 id="f23f" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">预算</h1><p id="ae04" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">很明显，仅仅培训我们的用户是不够的，我们要担心的不仅仅是BigQuery。因此，从一开始，我们就希望有一些关于成本的警报系统。我们发现实现这一目标的最简单方法是设定预算。<br/>(参见<a class="ae jt" href="https://cloud.google.com/billing/docs/how-to/budgets" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/billing/docs/how-to/budgets</a>)</p><blockquote class="mc"><p id="7af9" class="md me hi bd mf mg mh mi mj mk ml jc dx translated"><em class="mm">预算使您能够对照计划支出跟踪实际的谷歌云支出</em></p></blockquote><p id="8768" class="pw-post-body-paragraph if ig hi ih b ii mn ik il im mo io ip iq mp is it iu mq iw ix iy mr ja jb jc hb bi translated">这真的很简单，可能足以满足您的需求。这个想法只是为了建立你预计到每个月底要花多少钱(或者以上个月为基础)，并设定一些门槛规则。当成本达到这些阈值或百分比时，将会发送一封电子邮件。</p><p id="00ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设定预算的步骤(如果你有权限的话):</p><p id="0c8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1转到计费<br/> 2。预算&amp;警报<br/> 3。点击“创建预算”</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ms"><img src="../Images/733f71c32098b4861dc8ab58bdaf5725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/0*a7PPI5QSOBQ9e9W_"/></div></figure><p id="abac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.填写表格</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mt"><img src="../Images/6f9e1d68603b9d5f2ce8d8f2be66e33d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/0*CN8mDczVlNQvCv-x"/></div></figure><p id="c976" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.设置金额</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mu"><img src="../Images/62d19ad9e82094cfd3b6bcd09e26514c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/0*sK2-o_AINJQrw7he"/></div></figure><p id="eb95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.设置阈值规则</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mv"><img src="../Images/6510056392488befc8bb058af33f85da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/0*hwBqOLYK6z6KzG_a"/></div></figure><p id="b2ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每当您的当前费用达到您配置的阈值时，您都会收到一封如下所示的电子邮件:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mw"><img src="../Images/1d4324b4331be81c13219223ece7a454.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/0*ZyeHSb70GiwKydpv"/></div></figure><p id="d98e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是第一部分。<br/>在我们接下来的两篇文章中，我们将看到:<br/> - <a class="ae jt" rel="noopener" href="/@leonardoaugusto.campos/big-data-in-google-cloud-cost-monitoring-part-ii-a78615627af9">谷歌云中的大数据-成本监控(第二部分)<br/>导出日志数据和计费数据；</a> <br/> - <a class="ae jt" rel="noopener" href="/@leonardoaugusto.campos/big-data-in-google-cloud-cost-monitoring-part-iii-13dd5e9f36ac">谷歌云中的大数据——成本监控(第三部分)将数据点发送到云监控并创建警报</a>。</p><p id="888b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您有任何问题、意见或建设性的反馈，请在评论中留下。</p></div></div>    
</body>
</html>