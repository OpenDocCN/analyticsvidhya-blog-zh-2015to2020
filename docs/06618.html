<html>
<head>
<title>COVID-19 — Web Scrape, Analyze and send custom emails</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">新冠肺炎—网页抓取、分析和发送定制电子邮件</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/covid-19-web-scrape-analyze-and-send-custom-emails-d9dfbff05d90?source=collection_archive---------33-----------------------#2020-05-27">https://medium.com/analytics-vidhya/covid-19-web-scrape-analyze-and-send-custom-emails-d9dfbff05d90?source=collection_archive---------33-----------------------#2020-05-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a877532cd9d1d14ccaeb036a2808bd3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MCnT9-m-y10Qy88icV-lgw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">来源:starschema.com</figcaption></figure><p id="2534" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">自新冠肺炎疫情病毒爆发以来，人们依靠多个网站来获取该病毒在不同国家或地区的影响信息。在本文中，我们将探索从网站获取数据(网络抓取)并对其进行分析的过程，以创建可视化的图表来展示新冠肺炎当前的状况。稍后，我们将了解如何将这些图作为电子邮件附件发送，以及如何通过电子邮件自动发送定期更新。整个工作流程是用python编程语言编写的。</p><h2 id="7ebc" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">网站(全球资讯网的主机站)</h2><p id="d3d1" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">我们将用来获取数据的网站是worldometer。该网站提供新冠肺炎病例、康复、死亡等数字的频繁更新。在每个国家。</p><div class="kt ku ez fb kv kw"><a href="https://www.worldometers.info/coronavirus/" rel="noopener  ugc nofollow" target="_blank"><div class="kx ab dw"><div class="ky ab kz cl cj la"><h2 class="bd hj fi z dy lb ea eb lc ed ef hh bi translated">冠状病毒病例:</h2><div class="ld l"><h3 class="bd b fi z dy lb ea eb lc ed ef dx translated">追踪确诊病例、康复患者、检测和死亡人数的实时统计数据和冠状病毒新闻…</h3></div><div class="le l"><p class="bd b fp z dy lb ea eb lc ed ef dx translated">www.worldometers.info</p></div></div><div class="lf l"><div class="lg l lh li lj lf lk io kw"/></div></div></a></div><h2 id="39a7" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">网页抓取</h2><p id="fae6" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">在我们开始写代码之前，我们需要确定我们应该瞄准的网站部分。为此，我们应该打开web浏览器并导航到上面提到的网页。您将能够看到一个包含国家名称和病例数信息的表格。我们可以将该表设置为执行web抓取的目标。</p><p id="996d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">按键盘上的F12，浏览器上弹出的新窗口就是网页的HTML代码。您可以通过使用Google chrome浏览器上的Ctrl + Shift + C键并使用鼠标悬停在网页上来检查网页元素。我们的目标是识别表格的HTML代码。</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/91a1c7672d33d5e28cc698971359c994.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*koL37lJDIXr8jeLjP3WTPg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">识别要执行网页抓取的表格</figcaption></figure><p id="5b36" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如上图所示，我们可以识别代表表格的HTML代码和元素。我们将在python代码中使用这些信息从网站获取数据。如果你有困难或者需要更多关于检查网页元素的信息，请点击这个链接(<a class="ae iu" href="https://www.youtube.com/watch?v=Bg9r_yLk7VY" rel="noopener ugc nofollow" target="_blank">网页抓取视频</a>)观看一个有趣的网页抓取教程。</p><h1 id="a4b1" class="lq ju hi bd jv lr ls lt jz lu lv lw kd lx ly lz kg ma mb mc kj md me mf km mg bi translated">编写代码</h1><p id="55f5" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">我们将使用python对整个工作流程进行编程。我们应该导入网络抓取、分析和发送电子邮件所需的所有必要的包。</p><figure class="lm ln lo lp fd ij"><div class="bz dy l di"><div class="mh mi l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">导入库</figcaption></figure><h2 id="f1a5" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">用于网页抓取的Python代码</h2><p id="523d" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">下面的代码将从网页的表格中提取所有数据，并将数据排列到一个python列表中。</p><figure class="lm ln lo lp fd ij"><div class="bz dy l di"><div class="mh mi l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">Web抓取并将数据放入列表中</figcaption></figure><h2 id="6f02" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">数据争论</h2><p id="4cec" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">在我们开始分析和绘图之前，需要对数据进行充分的准备和整理。我们将排列成列表的数据转换成pandas数据框。观察数据时，我们可能会注意到有些单元格没有数据或有空白。它们大多表示没有新病例或活跃病例。但是，我们需要将它们更改为一个数学值来执行操作。我们丢弃冗余数据，并用0替换一些数据，如空格或“Nan”值。由于我们在此分析中仅关注国家，因此我们删除了与大洲相关的数据。我们还观察到不同列中的数字的数据类型不是整数或浮点数。为了执行数学计算和绘图，我们将它们转换成浮点数据类型。由于数据框架包含200多个国家，我们将其缩减到报告病例数最多的前9个国家，以及一个名为“其他”的新类别，其中包含来自所有其他国家的信息。我们将使用这些数据进行分析并生成图表。</p><figure class="lm ln lo lp fd ij"><div class="bz dy l di"><div class="mh mi l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">数据争论</figcaption></figure><h2 id="ec47" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">生成图</h2><p id="cd78" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">在数据争论过程结束时准备的数据帧用于生成绘图。下面列出了生成一些图的代码。</p><figure class="lm ln lo lp fd ij"><div class="bz dy l di"><div class="mh mi l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">生成条形图和圆环图的Python代码</figcaption></figure><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/cf41cb8222c4a666037e22931e9daa46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*so1WPGd5SJL8Baoozq_F6Q.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">分析网络搜集的数据后生成的图</figcaption></figure><figure class="lm ln lo lp fd ij"><div class="bz dy l di"><div class="mh mi l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">生成饼图的Python代码</figcaption></figure><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/edd70c9617c26b7b696ef21f57d83820.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*joCx-Ci32ugWSQt-kEB-2w.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">使用数据生成的饼图</figcaption></figure><h2 id="ff5c" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">通过电子邮件发送绘图</h2><p id="570f" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">通过在“email.txt”文件中提及所有收件人的电子邮件地址，可以将保存的绘图作为附件通过电子邮件发送给多人。“email.txt”文件应该存储在python脚本的同一个文件夹中，除非您在代码中提到了确切的路径。“email.txt”文件的内容如下。</p><pre class="lm ln lo lp fd ml mm mn mo aw mp bi"><span id="0d0f" class="jt ju hi mm b fi mq mr l ms mt">user.email@gmail.com<br/>Userp@ssw0rd<br/>receiver1@yahoo.com, receiver2@aol.com</span></pre><p id="930b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于gmail用户来说，如果使用“yagmail”软件包，通过电子邮件发送文件的过程可以简化。你可以在下面的链接中找到更多信息。<br/><a class="ae iu" href="https://blog.mailtrap.io/yagmail-tutorial/" rel="noopener ugc nofollow" target="_blank">YAG mail-教程</a></p><figure class="lm ln lo lp fd ij"><div class="bz dy l di"><div class="mh mi l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">将图作为电子邮件附件发送的代码</figcaption></figure><figure class="lm ln lo lp fd ij er es paragraph-image"><div class="er es mu"><img src="../Images/6780b5180530d421e9a91acdaa1514ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*sGtHLGML3WvShvAWs2nS_w.jpeg"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">收件箱中电子邮件的预览</figcaption></figure><h2 id="fffb" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">整个过程的自动化</h2><p id="5f40" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">现在我们已经看到了整个工作流程，下面是一些关于我们如何自动化整个过程的提示。<br/> 1。编写一个批处理进程，每隔“x”小时执行一次python代码。这里的缺点是，你将不得不保持你的电脑运行。<br/> 2。我们可以将完整的python脚本嵌入到一个带有休眠计时器的循环中。这里，我们也有保持PC运行的缺点。<br/> 3。在Google Colab或其他类似平台中运行代码。像Google Colab这样的大多数平台只支持12小时内代码的免费不间断执行。<br/> 4。您可以在云中设置一个虚拟机，它基于计时器执行python脚本。请记住，虚拟机可能会产生成本。<br/> 5。最好的选择是将python脚本放在开发板中，比如BeagleBone或Raspberry Pi。我们可以将代码嵌入一个带有睡眠定时器的循环中，让它运行。如果电源和互联网连接没有中断，代码将顺利执行。</p><p id="2b55" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在web抓取过程之后，可以对生成的数据帧进行更多的分析。我想邀请你进行这些分析。在下面的链接中，你可以找到我用来编写网页抓取、分析和发送电子邮件的整个工作流程的jupyter笔记本。</p><div class="kt ku ez fb kv kw"><a href="https://github.com/aj7amigo/COVID-19/blob/master/python_scripts/COVID19_data_analyzer.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="kx ab dw"><div class="ky ab kz cl cj la"><h2 class="bd hj fi z dy lb ea eb lc ed ef hh bi translated">aj7 amigo/新冠肺炎</h2><div class="ld l"><h3 class="bd b fi z dy lb ea eb lc ed ef dx translated">permalink dissolve GitHub是超过5000万开发人员的家园，他们一起工作来托管和审查代码，管理…</h3></div><div class="le l"><p class="bd b fp z dy lb ea eb lc ed ef dx translated">github.com</p></div></div><div class="lf l"><div class="mv l lh li lj lf lk io kw"/></div></div></a></div><div class="kt ku ez fb kv kw"><a href="https://www.kaggle.com/aj7amigo/covid-19-web-scrape-analyze-send-custom-email" rel="noopener  ugc nofollow" target="_blank"><div class="kx ab dw"><div class="ky ab kz cl cj la"><h2 class="bd hj fi z dy lb ea eb lc ed ef hh bi translated">新冠肺炎-网页抓取，分析和发送自定义电子邮件</h2><div class="ld l"><h3 class="bd b fi z dy lb ea eb lc ed ef dx translated">使用Kaggle笔记本探索和运行机器学习代码|使用来自非数据源的数据</h3></div><div class="le l"><p class="bd b fp z dy lb ea eb lc ed ef dx translated">www.kaggle.com</p></div></div><div class="lf l"><div class="mw l lh li lj lf lk io kw"/></div></div></a></div><p id="eabf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">非常欢迎你的改进建议。</p><p id="9ad1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢您抽出时间阅读这篇文章。非常欢迎您的反馈。</p><p id="0014" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">谢谢</strong></p></div></div>    
</body>
</html>