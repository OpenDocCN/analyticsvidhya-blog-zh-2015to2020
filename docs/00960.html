<html>
<head>
<title>Sparkify: Predicting Churn With Spark for a Music Streaming Company</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Sparkify:用Spark为一家音乐流媒体公司预测用户流失</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/sparkify-predicting-churn-with-spark-for-a-music-streaming-company-f3fe90df608d?source=collection_archive---------12-----------------------#2019-09-21">https://medium.com/analytics-vidhya/sparkify-predicting-churn-with-spark-for-a-music-streaming-company-f3fe90df608d?source=collection_archive---------12-----------------------#2019-09-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/29f5fa6128761306de0d01b8417ef9ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fwtoVVh0ATQ0VCDINlnj2w.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">(<a class="ae iu" href="https://www.evergent.com/tag/churn/" rel="noopener ugc nofollow" target="_blank">来源</a>)</figcaption></figure></div><div class="ab cl iv iw gp ix" role="separator"><span class="iy bw bk iz ja jb"/><span class="iy bw bk iz ja jb"/><span class="iy bw bk iz ja"/></div><div class="hb hc hd he hf"><blockquote class="jc jd je"><p id="3065" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><strong class="ji hj">客户</strong> C <strong class="ji hj"> hurn </strong>是指现有客户、用户、玩家、订户或任何类型的回头客停止业务或终止与某公司的关系。</p><p id="f2ef" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">例如，这可能意味着取消订阅、终止会员资格、关闭某种账户、不续签服务协议或合同，甚至顾客决定在另一家商店购买他或她的食品杂货[1]。</p></blockquote><p id="76b7" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">正如你所想象的，这个项目是关于客户流失的。而且也全是关于数据科学，机器学习，大数据！具体来说，在这个项目中，我们将共同构建一个针对大数据问题的端到端数据科学项目:预测客户流失。</p><p id="1e55" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">我们将使用<strong class="ji hj"> IBM Watson Studio </strong>，它为我们提供了一个<strong class="ji hj"> Lite free </strong>帐户，允许我们使用Spark进行分布式计算。然而，请记住，这个免费帐户提供的计算能力是有限的，因此，我们不能使用太大的数据集，也不能应用太复杂的算法。</p></div><div class="ab cl iv iw gp ix" role="separator"><span class="iy bw bk iz ja jb"/><span class="iy bw bk iz ja jb"/><span class="iy bw bk iz ja"/></div><div class="hb hc hd he hf"><h2 id="ebc3" class="kh ki hi bd kj kk kl km kn ko kp kq kr ke ks kt ku kf kv kw kx kg ky kz la lb bi translated"><strong class="ak">稍微介绍一下Apache Spark </strong></h2><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/3658889bc1651633f4484555f5d93605.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*Z0vPsbA5VTVxulyR0OOTAg.png"/></div></div></figure><p id="0e2d" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">Apache Spark是一个开源集群计算框架，也是目前最流行的大数据分析工具之一。从理论上讲，Spark对于我们的计算机内存无法容纳的大数据是有用的。然而，考虑到IBM Watson免费提供的计算能力，我们将使用一个250MB的数据集，这并不算大。</p><h2 id="7fcc" class="kh ki hi bd kj kk kl km kn ko kp kq kr ke ks kt ku kf kv kw kx kg ky kz la lb bi translated">IBM Watson工作室</h2><p id="7237" class="pw-post-body-paragraph jf jg hi ji b jj lh jl jm jn li jp jq ke lj jt ju kf lk jx jy kg ll kb kc kd hb bi translated">在这个项目中，我将使用IBM提供的免费Lite帐户，它允许我们使用一个Jupyter笔记本，该笔记本使用<strong class="ji hj">一个带有1个vCPU和4 GB RAM的驱动程序，以及2个各带有1个vCPU和4 GB RAM的执行器。</strong>因此，我将使用安装了Python 3.6和<strong class="ji hj"> PySpark </strong>的笔记本。</p><h2 id="e5a8" class="kh ki hi bd kj kk kl km kn ko kp kq kr ke ks kt ku kf kv kw kx kg ky kz la lb bi translated">项目概述</h2><p id="0ef8" class="pw-post-body-paragraph jf jg hi ji b jj lh jl jm jn li jp jq ke lj jt ju kf lk jx jy kg ll kb kc kd hb bi translated">该项目将分为以下几个主要主题:</p><ul class=""><li id="30af" class="lm ln hi ji b jj jk jn jo ke lo kf lp kg lq kd lr ls lt lu bi translated"><strong class="ji hj"> ETL +解释性数据分析</strong></li><li id="332a" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated"><strong class="ji hj">机器学习</strong></li></ul><p id="19e4" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated"><strong class="ji hj">提取负荷变换和解释性数据分析</strong></p><p id="40db" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">这个项目中使用的数据由一个虚构的音乐流媒体公司Sparkify的用户日志文件组成。数据由<strong class="ji hj"> Udacity </strong>提供，作为<strong class="ji hj">数据科学家纳米学位项目的一部分。</strong></p><p id="9fc6" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">数据集的主要结构如下图所示。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/a30f588e5206046311e6d824d7f9e6ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*BQz5fzMKomHQsAgxI-8hOw.jpeg"/></div></figure><p id="ef62" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">正如我们所看到的，我们有关于每个用户交互的大量信息，以及相应的时间戳，这为我们创建预测客户流失的功能提供了强大的数据！</p><p id="cf18" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">让我们试着从这个数据集中获得一些见解！</p><p id="9231" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">探索这些数据，我最终发现了一些有趣的信息:</p><ul class=""><li id="33df" class="lm ln hi ji b jj jk jn jo ke lo kf lp kg lq kd lr ls lt lu bi translated">在数据集中，我们有大约499351个独特的时间戳(用户交互)，平均而言，每个用户有大约1140次交互。</li><li id="4b01" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated"><strong class="ji hj">从这个数据中，我们有4470个独特的会话。</strong></li><li id="82c8" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated"><strong class="ji hj">平均来说，用户在进入主页之前会听大约24首音乐。</strong></li></ul><figure class="ld le lf lg fd ij er es paragraph-image"><div class="er es mb"><img src="../Images/b084b7db7e9e3f0ecee5b01feb712981.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*e-QkzpXx3q0fQPV-JZTneA.png"/></div></figure><p id="70a9" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">由于我们使用的是精简的数据集，可以注意到我们总共有448个用户，按性别和级别(免费或付费)分布，如左图所示。</p><p id="a298" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">此外，Sparkify还提供以下页面:</p><ul class=""><li id="7acc" class="lm ln hi ji b jj jk jn jo ke lo kf lp kg lq kd lr ls lt lu bi translated">取消，提交降级，拇指向下，主页</li><li id="e737" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated">降级、滚动广告、注销、保存设置</li><li id="a2b3" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated">保存设置</li><li id="9ed0" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated"><strong class="ji hj">取消确认</strong></li><li id="9cf8" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated">关于，设置，添加到播放列表，添加朋友，下一首歌曲</li><li id="3446" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated">竖起大拇指，帮助，升级，错误，提交升级</li></ul><p id="8114" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">为了这个项目，<strong class="ji hj">我将把客户流失定义为取消确认的行为。</strong>因此，取消Sparkify服务的用户将被标记为1，Sparkify的当前用户将被标记为0。</p><p id="931f" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">考虑到客户流失的定义，按性别和级别划分的用户分布可以重新计算如下。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/3d6751b3d89fb3678b412fc330b59542.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*fTdqg-FWjRcqkSq-R0d4Qg.png"/></div></figure><p id="ecec" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">人们也可能对哪些艺术家用户最喜欢听感兴趣。下图显示了收听率最高的10位艺术家。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/ff2070d68aecc67309141d27751fd200.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DQBH_VzOTTXhqk16g4Ec9g.png"/></div></div></figure><h2 id="e8d6" class="kh ki hi bd kj kk kl km kn ko kp kq kr ke ks kt ku kf kv kw kx kg ky kz la lb bi translated">特征工程</h2><p id="bc6a" class="pw-post-body-paragraph jf jg hi ji b jj lh jl jm jn li jp jq ke lj jt ju kf lk jx jy kg ll kb kc kd hb bi translated">作为ETL过程的一部分，我使用上面描述的数据集来创建我发现对预测客户流失有用的特性。工程特性列表如下所述:</p><ul class=""><li id="9fe2" class="lm ln hi ji b jj jk jn jo ke lo kf lp kg lq kd lr ls lt lu bi translated"><strong class="ji hj">用户在访问主页期间平均收听的歌曲数量</strong></li><li id="13fd" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated"><strong class="ji hj">每个用户收听的不同艺术家的数量</strong></li><li id="e646" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated"><strong class="ji hj">每个用户收听的歌曲数量</strong></li><li id="600d" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated"><strong class="ji hj">根据最大观察时间戳，用户多久前注册</strong></li><li id="d3c3" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated"><strong class="ji hj">如果用户在历史中曾经是付费级别用户</strong></li><li id="750a" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated"><strong class="ji hj">用户性别</strong></li><li id="4ac9" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated"><strong class="ji hj">用户听一首歌的总时间</strong></li><li id="3e09" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated"><strong class="ji hj">每个用户每次收听的平均歌曲数量</strong></li></ul><p id="f78f" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">要查看关于这些特性的更多细节以及它们是如何被每个用户分发的，请查看我的<a class="ae iu" href="https://github.com/GiulioCMSanto/sparkify_predicting_churn_with_spark" rel="noopener ugc nofollow" target="_blank"> <strong class="ji hj"> GitHub </strong> </a> <strong class="ji hj">上的项目。</strong></p><h2 id="f18d" class="kh ki hi bd kj kk kl km kn ko kp kq kr ke ks kt ku kf kv kw kx kg ky kz la lb bi translated">机器学习</h2><p id="cc69" class="pw-post-body-paragraph jf jg hi ji b jj lh jl jm jn li jp jq ke lj jt ju kf lk jx jy kg ll kb kc kd hb bi translated">上述特征然后被用于预测流失。数据清理和特性工程过程在ETL管道中进行了转换，以使该过程更加容易。</p><p id="acab" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">在这个项目中使用了两条不同的机器学习流水线:一条包含一个<strong class="ji hj">逻辑回归器</strong> <strong class="ji hj">分类器</strong>，另一条包含一个<strong class="ji hj">随机森林分类器</strong>。两个管道都使用标准的缩放器来缩放创建的特征以及PySpark运行模型所需的汇编器和索引器。</p><p id="a811" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">两种模型的结果如下所示:</p><p id="4ce8" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated"><strong class="ji hj">逻辑回归</strong></p><figure class="ld le lf lg fd ij er es paragraph-image"><div class="er es me"><img src="../Images/10f0d8cba03916338dde026182bbd86a.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*LXuGNE9w5g-vVeff3-da8g.png"/></div></figure><ul class=""><li id="7838" class="lm ln hi ji b jj jk jn jo ke lo kf lp kg lq kd lr ls lt lu bi translated"><strong class="ji hj">精度:0.8 </strong></li><li id="afdb" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated"><strong class="ji hj"> F1得分:0.7 </strong></li><li id="0937" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated"><strong class="ji hj">ROC下面积:0.61 </strong></li></ul><p id="a658" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">在包含90%数据的训练集上，使用三重交叉验证来训练管道。10%验证数据用于计算这些指标。考虑到机器的限制，在交叉验证中尝试了不同的参数组合。</p><p id="ff5b" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated"><strong class="ji hj">随机森林分类器</strong></p><p id="76d2" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">随机森林分类器也使用三重交叉验证来训练。在这种情况下,“基尼”杂质用于测量信息增益，并在网格搜索中尝试不同的深度。</p><ul class=""><li id="4d36" class="lm ln hi ji b jj jk jn jo ke lo kf lp kg lq kd lr ls lt lu bi translated"><strong class="ji hj">精度:0.75 </strong></li><li id="799f" class="lm ln hi ji b jj lv jn lw ke lx kf ly kg lz kd lr ls lt lu bi translated"><strong class="ji hj"> F1得分:0.74 </strong></li></ul><h1 id="8402" class="mf ki hi bd kj mg mh mi kn mj mk ml kr mm mn mo ku mp mq mr kx ms mt mu la mv bi translated">结论</h1><p id="fe79" class="pw-post-body-paragraph jf jg hi ji b jj lh jl jm jn li jp jq ke lj jt ju kf lk jx jy kg ll kb kc kd hb bi translated">一个完整的数据科学项目成功建立，以预测流失。清除数据中的空值和重复值，并进行解释性数据分析。然后创建了一些功能，以允许人们执行能够预测用户是否会流失的机器学习算法。</p><p id="09c6" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">考虑到可用的计算能力，由此产生的交叉验证指标是令人满意的。如果您愿意获得更好的结果，您可以升级您的IBM Watson机器，或者使用来自Amazon AWS的EMR来对所用模型中的参数以及更多的功能进行更深入的搜索。使用本项目中描述的机器，每个模型需要大约25分钟来训练，并搜索一些参数。</p><h2 id="d2b9" class="kh ki hi bd kj kk kl km kn ko kp kq kr ke ks kt ku kf kv kw kx kg ky kz la lb bi translated">参考</h2><p id="5229" class="pw-post-body-paragraph jf jg hi ji b jj lh jl jm jn li jp jq ke lj jt ju kf lk jx jy kg ll kb kc kd hb bi translated">[1]<a class="ae iu" href="https://www.netigate.net/articles/customer-satisfaction/customer-churn-meaning/" rel="noopener ugc nofollow" target="_blank">https://www . netigate . net/articles/customer-satisfaction/customer-churn-meaning/</a></p></div></div>    
</body>
</html>