<html>
<head>
<title>Writing multiple CSV Files to SQL Databases using SQLAlchemy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SQLAlchemy将多个CSV文件写入SQL数据库</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/writing-multiple-csv-files-to-sql-databases-using-sqlalchemy-1f3b85af56d6?source=collection_archive---------4-----------------------#2019-12-05">https://medium.com/analytics-vidhya/writing-multiple-csv-files-to-sql-databases-using-sqlalchemy-1f3b85af56d6?source=collection_archive---------4-----------------------#2019-12-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5024" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据库在数据科学中扮演着非常重要的角色，每个程序员，无论是数据科学家还是数据分析师，都需要能够有效地使用这些数据库并灵活处理。处理CSV文件也是数据科学家的日常工作。为了查询数据并得出可用于业务的有意义的见解，能够读取它们或将它们写入SQL Server等数据库是绝对必要的。这项工作的自动化将为您节省大量时间和精力。</p><p id="53f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了有效地完成这项工作，python非常方便，它是开源的，内置了几个强大的包和库。一个这样的库是<strong class="ih hj"> <em class="jd"> SQLAlchemy </em> </strong>，它方便了<strong class="ih hj"> <em class="jd"> Python </em> </strong>程序和<strong class="ih hj"> <em class="jd"> SQL数据库</em> </strong>之间的通信。</p><p id="0666" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设您已经熟悉了基本的python技能，让我们从代码开始，在这里您将看到如何将保存在本地机器上的一个文件夹中的多个CSV文件写入您的<strong class="ih hj"><em class="jd">Microsoft SQL Server</em></strong>数据库中的一个SQL表(SQLAlchemy可用于写入许多其他数据库，如MySQL、Oracle、PostgreSQL、SQLite等。仅举几个例子)。</p><p id="c669" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，第一步是通过在本地机器终端上运行来安装如下重要的库，如果它们还没有安装在python工具包中的话。Pyodbc是一个连接器，用于连接python和SQL Server数据库。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/bf0f88614f81cb3e289d097f0bb04133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MKPosDpogaeRPfqydifsKA.png"/></div></figure><p id="b46b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们将从python代码开始。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jm"><img src="../Images/115164b53bfd8ed4c6615ec3c0dedf77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fk6rFp_-Ic7VIUuQ52e_Fg.png"/></div></div></figure><p id="31c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们将使用pyodbc连接器在python和MS SQL Server之间建立连接。在下面的代码中定义您的服务器名称、数据库名称、用户和服务器登录密码。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jr"><img src="../Images/295accd0b40d83343d793c16450ebc1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aF-E758SnaFSetaWy4uY2Q.png"/></div></div></figure><p id="b9b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">建立连接后，您可以定义保存所有CSV文件的文件夹，所有文件名都可以存储在一个列表变量中。只要确保这些文件具有相同的列数和列名，以便它们可以作为单个表写入SQL数据库。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es js"><img src="../Images/5a9912f314252cc638fa3dc42705b0fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lZy4DpnjlrmM-ltaBPkOlg.png"/></div></div></figure><p id="e8bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在是时候使用SQLAlchemy的强大功能将这些文件写到一个表中了。您可以首先在SQL数据库中创建一个表(使用SQL query，确保它具有与CSV文件相同的列数和列名，并且您可以添加一个<strong class="ih hj"> <em class="jd"> DataSource </em> </strong>列来写入文件名，以便在查询数据时知道DataSource文件)，使用python代码与它建立连接。这将通过对象关系映射器(ORM)工具来完成，该工具将Python类转换为关系数据库上的表，并自动将函数调用转换为SQL语句。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jt"><img src="../Images/25a68c8032ac2c27a4ce4c4de8750b19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yCJ4mhH858m-vDgRJxroAg.png"/></div></div></figure><p id="f9e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的代码解释了python如何首先读取每个CSV文件。如果您的文件包含一些非英语数据，那么它需要在代码中定义一些编码，以便python能够读取该文件。你可以用下面这段代码完成所有这些，然后最终将所有文件写入表中，并更新数据源列。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es ju"><img src="../Images/aa8e964b44ef570ebb3d032f000206c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_6posp2HolUT42G0wN7arw.png"/></div></div></figure><p id="4a7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行整个代码，享受自动化。</p></div></div>    
</body>
</html>