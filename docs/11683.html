<html>
<head>
<title>Multivariate Forecasting for the Volatility of the Stock Data using Deep Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于深度学习的股票数据波动性多元预测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/multivariate-forecasting-for-the-volatility-of-the-stock-data-using-deep-learning-cd560ca63178?source=collection_archive---------8-----------------------#2020-12-14">https://medium.com/analytics-vidhya/multivariate-forecasting-for-the-volatility-of-the-stock-data-using-deep-learning-cd560ca63178?source=collection_archive---------8-----------------------#2020-12-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3ded" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果有人问及某家公司的增长情况，你能不考虑国家GDP、电晕、飓风等外部因素就回答吗？,?。那么我们如何能够通过观察以前的数据来预测股票价格的波动性呢？这是我们昨天<a class="ae jd" rel="noopener" href="/analytics-vidhya/univariate-forecasting-for-the-volatility-of-the-stock-data-using-deep-learning-6c8a4df7edf9">开发的</a>模型的多元附加概念。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/438f27fa14cbce1e0daa994ed6c573c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gshYr_0572l7CCSBnfmpqw.jpeg"/></div></div></figure><p id="086f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们开始一个简单的实际理解，为什么我们需要去多元。假设你在机场开了一家书店，在奥运期间你需要购买几本杂志，你会选择买什么类型的杂志？。你会买80%和美食有关，只有20%和运动有关的杂志吗？没有权利…！！！在你的脑海中，你会有一个假设，即大多数人将会为奥运会而旅行，所以我需要在体育杂志上投入更多。所以，在这里，你看着外部因素，如世界各地正在发生的事情，以决定你的购买模式。同样，购买模式会受到许多其他因素的影响，这就是所谓的多元因素。利用多重特征预测未来。</p></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><h1 id="269b" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">数据准备</strong></h1><p id="e0a4" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">我们将使用特斯拉公司股票预测的相同数据，并以这样的方式准备数据，即过去n天的多个特征用于预测波动性。</p><pre class="jf jg jh ji fd la lb lc ld aw le bi"><span id="5885" class="lf jy hi lb b fi lg lh l li lj">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>from sklearn.preprocessing import Normalizer</span><span id="325d" class="lf jy hi lb b fi lk lh l li lj">window_size=20<br/>#first download data from yahoo<br/>import yfinance as yf<br/>from yahoofinancials import YahooFinancials<br/>df = yf.download(‘TSLA’, start=’2000–01–01', end=’2019–12–31', progress=False)<br/>#compute daily returns and 20 day moving historical volatility<br/>df[‘returns’]=df[‘Close’].pct_change()<br/>df[‘volatility’]=df[‘returns’].rolling(window_size).std()*(252**0.5)<br/>df =df.dropna()<br/>print(df.shape)<br/>df.head()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ll"><img src="../Images/e5d3ccda9edf64596d1c5caf2b24f2db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*Et8IVO1b044g1nHVp6n5Bw.png"/></div></div></figure><pre class="jf jg jh ji fd la lb lc ld aw le bi"><span id="b682" class="lf jy hi lb b fi lg lh l li lj">def convert2matrix(X_arr,Y_arr, look_back):<br/> X, Y =[], []<br/> #iterating thorough the data with window as look back<br/> for i in range(len(X_arr)-look_back):<br/>  d=i+look_back <br/>  # extracting the X as features and target of n days and Y as   target at (n+1)th day<br/>  X.append(np.hstack((X_arr[i:d],Y_arr[i:d])))<br/>  Y.append(Y_arr[d])<br/> return np.array(X), np.array(Y)</span><span id="7e5b" class="lf jy hi lb b fi lk lh l li lj">X = df.drop(['volatility'],axis=1).values<br/>transformer = Normalizer().fit(X)<br/>X = transformer.transform(X)<br/>y=np.expand_dims(df['volatility'].values,1)<br/>X.shape,y.shape</span></pre><blockquote class="lm ln lo"><p id="90af" class="if ig lp ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated">X和y的形状:(2373，7)，(2373，1)</p></blockquote><pre class="jf jg jh ji fd la lb lc ld aw le bi"><span id="e582" class="lf jy hi lb b fi lg lh l li lj">x,y = convert2matrix(X,y,10)<br/>print(x.shape,y.shape)</span></pre><blockquote class="lm ln lo"><p id="c0d8" class="if ig lp ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated">X和y的形状:(2363，10，8)，(2363，1)</p></blockquote><h1 id="ba49" class="jx jy hi bd jz ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku bi translated"><strong class="ak">模型建筑</strong></h1><pre class="jf jg jh ji fd la lb lc ld aw le bi"><span id="e83d" class="lf jy hi lb b fi lg lh l li lj">from sklearn.model_selection import train_test_split<br/>X,x_valid,y,y_valid = train_test_split(x,y,test_size=0.1,shuffle=False)<br/>print(X.shape,y.shape,x_valid.shape,y_valid.shape)</span><span id="1233" class="lf jy hi lb b fi lk lh l li lj">from keras.models import Sequential<br/>from keras.layers import Dense, LSTM<br/>from keras.optimizers import Adam<br/>model = Sequential()<br/>model.add(LSTM(10, input_shape=(X.shape[1], X.shape[2])))<br/>model.add(Dense(1))<br/>model.compile(loss='mae', optimizer=Adam(0.001))<br/>model.fit(X, y, epochs=10, batch_size=32, validation_data=(x_valid, y_valid), verbose=1, shuffle=False)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ly"><img src="../Images/3315edeffaa5a78b6be5c9d7a3b3aee3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*64_C7Kjw1z1y6xq8aTeW-g.png"/></div></div></figure><pre class="jf jg jh ji fd la lb lc ld aw le bi"><span id="bc2e" class="lf jy hi lb b fi lg lh l li lj">from sklearn.metrics import mean_absolute_error<br/>pred = model.predict(x_valid)<br/>plt.figure(figsize=(20,5),dpi=300)<br/>plt.plot(y_valid,label='True Value')<br/>plt.plot(pred,linestyle='--', label = 'Predicted')<br/>plt.legend()<br/>plt.title('Mean Suqared Error: '+str(mean_absolute_error(pred,y_valid))[:6],fontsize=20)<br/>plt.show()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lz"><img src="../Images/5e164c33d2013aa930a633114c4faa63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Ib1fM0LtyK1KAa36bxOrQ.png"/></div></div></figure><p id="618e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了比较结果，我使用了相同的单变量和多变量模型和测试数据。如你所见，误差从0.06降至0.04。这给出了一个清晰的想法，即多元数据对于这个雅虎财务数据工作得很好。</p><p id="4683" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章将提供一个关于如何准备多元数据和使用LSTM预测波动性的良好实践经验。坚持练习和阅读。</p><p id="f7ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">喜欢这篇文章别忘了鼓掌。！！！</p></div></div>    
</body>
</html>