<html>
<head>
<title>Automation with Selenium and Web Scraping in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中Selenium和Web抓取的自动化</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/automation-with-selenium-and-web-scraping-in-python-c53f0c0602d6?source=collection_archive---------10-----------------------#2019-11-03">https://medium.com/analytics-vidhya/automation-with-selenium-and-web-scraping-in-python-c53f0c0602d6?source=collection_archive---------10-----------------------#2019-11-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/52ef88d87793dabb1ca409a8777a8fb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TlCoojCAPy98fzCI"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">哈尔·盖特伍德在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="997a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Selenium是最流行的自动化库之一。您可以使用它来自动化广泛的web应用程序。最受欢迎的应用是测试web应用程序。但是硒的应用不仅仅局限于测试。Selenium允许您打开自己选择的浏览器，并像正常人一样执行任务，例如:</p><p id="5677" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">点击按钮</p><p id="2153" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">填写表格</p><p id="f529" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在网页上搜索信息。</p><p id="cda4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">与selenium一起使用的流行语言是Java和Python，但是在自动化方面，Python比Java有很多优势。同样在数据科学中，数据收集是最重要的步骤之一。很多时候，我们需要从不同的网站收集数据。有时，这可能会成为一项非常麻烦的任务。在这种情况下，Selenium和web scraping就派上了用场，这样我们就可以自动完成日常任务。</p><p id="ee35" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我们将提取特定农产品的价格(例如马铃薯)的数据，这些数据来自一个农业网站agmarknet.gov.in。该网站要求我们填写一份表格，并提交它来检索数据。我们的任务是检索给定年份范围内所有州的马铃薯价格。因此，我们将编写一个脚本，自动为我们收集数据。收集的数据将下载到CSV文件中。</p><p id="d37e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">加载所需模块</strong></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jt"><img src="../Images/d662544b56e410c3577e73b758ae1555.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*FYFOawYnt0PZ6m_-qOGB_Q.png"/></div></figure><p id="c402" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jy"> webdriver </em> —允许您启动浏览器</p><p id="1d60" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jy">选择</em> —允许您选择网页上的元素，以便您可以对它们执行操作。</p><p id="b4db" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jy"> bs4 </em> —我们使用这个模块进行网页抓取</p><p id="f1b8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jy">熊猫</em> —用于处理表格格式的数据</p><p id="9b36" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jy"> pdb </em> —用于调试目的</p><p id="01f0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">打开网络浏览器</strong></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jz"><img src="../Images/6d273c5596b2a61cb0352b9aa72d80c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*AiiNmcFN5uDJwJILGOtFHA.png"/></div></figure><p id="bf9a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以使用webdriver启动您选择的浏览器。在这种情况下，我们推出了chrome浏览器。</p><p id="656b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">调用函数</strong></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es ka"><img src="../Images/4ccd55baf267bf36558e6ed9d163c808.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*58p7VrfApAsUvOI8SvQv3w.png"/></div></figure><p id="dfee" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这段代码片段是我们调用所有函数的起点，这些函数将执行自动化任务，并抓取所有需要的网页</p><p id="1939" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">信息。当你浏览文档时，你会找到这些函数的定义。</p><p id="0a99" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">选择值 () —执行填写表单的任务</p><p id="67dd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jy"> scrapeTable </em> () —用于提交表单后获取所需数据。</p><p id="3ac3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以通过月份列表中的任意多个月份。现在，为了简单起见，我们将使用2个月。对于年的范围，使用变量start_year和end_year。</p><p id="8034" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">在硒的帮助下填表</strong></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kb"><img src="../Images/c64c58c873afcd1d616ab3dfb38368ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*gEi3gYeSLvEWBTZmh3PmgQ.png"/></div></figure><p id="88e1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是需要填写和提交的表格。在selenium的帮助下，我们将填充这些下拉列表中的值。代码如下。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kc"><img src="../Images/ec25eabe6226bbb4e7df2d3b9f7d359a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*3dwChWB1Biu87e8594_1Aw.png"/></div></figure><p id="1448" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您需要创建选择类的实例。创建select类的实例后，可以对该实例执行Select方法，从下拉列表中选择选项。您需要找到想要选择的元素的“id ”,并将其传递给<em class="jy">选择</em>()函数。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/f1c5ba8fd9149d76bd61d36e2f253ed5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5GAGg7Ra-_dk-PQG1KQcaQ.png"/></div></div></figure><p id="60ae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们使用<em class="jy"> checkOptions </em>()来检查下拉列表是否已经加载了值。下面是代码片段</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es ke"><img src="../Images/608d3fc38a76a325768fe1fece000ff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*vmLOp2QBa4RdsRvqrw1X_g.png"/></div></figure><p id="b6b6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jy"> submit.click </em>()在提交按钮上执行点击动作。结果是我们得到如下页面</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kf"><img src="../Images/dab41d3888e01f1ebf417521d084703a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VVQlS2V5qYwXr_RjyCuxqw.png"/></div></div></figure><p id="2774" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们感兴趣的是只提取已经在表单中填充了值的列。在这种情况下，“2018年1月价格”。</p><p id="81af" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为此，我们需要在<em class="jy"> BeautifulSoup </em>的帮助下进行网络抓取。下面是代码片段。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kg"><img src="../Images/15b2f5e9860295d79251918690981443.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WWVlelLDNUazz7w18t0YtQ.png"/></div></div></figure><p id="edd6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">BeautifulSoup是一个Python库，用于从HTML和XML文件中提取数据。它与您喜欢的解析器一起工作，提供导航、搜索和修改解析树的惯用方式。它通常为程序员节省数小时或数天的工作。</p><p id="0c51" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我们将页面源转换成一个BeautifulSoup对象。它有助于轻松导航该结构。下面是刮桌子的步骤。</p><ul class=""><li id="2e69" class="kh ki hi ix b iy iz jc jd jg kj jk kk jo kl js km kn ko kp bi translated">我们首先读取给定网页的源代码，并使用“BeautifulSoup”函数创建一个BeautifulSoup (soup)对象。</li><li id="de2b" class="kh ki hi ix b iy kq jc kr jg ks jk kt jo ku js km kn ko kp bi translated">然后，我们检查所有表格的HTML脚本</li><li id="e3fc" class="kh ki hi ix b iy kq jc kr jg ks jk kt jo ku js km kn ko kp bi translated">然后，我们在表的所有行上迭代一个循环，去掉html标记的元素，并将其转换为表中所有行的列表。</li><li id="ff13" class="kh ki hi ix b iy kq jc kr jg ks jk kt jo ku js km kn ko kp bi translated">然后，我们使用pandas库将这个列表转换成数据帧。</li><li id="39a7" class="kh ki hi ix b iy kq jc kr jg ks jk kt jo ku js km kn ko kp bi translated">然后我们调用一个<em class="jy"> concatDataFrame </em>()函数来连接所有月份的列。</li><li id="425d" class="kh ki hi ix b iy kq jc kr jg ks jk kt jo ku js km kn ko kp bi translated">最后，我们将这个数据帧输出到一个CSV文件中。下面是连接数据帧的代码片段</li></ul><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kv"><img src="../Images/a910837eb8ec071e3efe59ac5e5f434a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*7sZX8texH_IMmUJhFZZmbg.png"/></div></figure><p id="9ef7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，我们将在一个循环中执行此任务，这要求我们返回到我们填写表单的同一页面。我们可以用下面的代码在浏览器上执行反压。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/ea30d61c9127dada32573f223fbbf9c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*07NFvO4SS8jLBwjK-sXqlA.png"/></div></figure><p id="ccb9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个过程将继续循环工作，直到我们根据提供的输入提取数据。最终结果将是一个CSV文件，如下所示。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kx"><img src="../Images/f7d95486e145dbfad32e3335a95af697.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q40uSyl2rWlPJlGvm-Miow.png"/></div></div></figure><p id="8aa4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">结论</strong></p><p id="d965" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Selenium有助于将原本可能需要几个小时才能完成的任务自动化。</p><p id="6c88" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过对该代码进行微小的修改，您可以提取任意年份范围内的任意商品的数据。</p><ul class=""><li id="6b85" class="kh ki hi ix b iy iz jc jd jg kj jk kk jo kl js km kn ko kp bi translated">提取的数据如果收集了较长的时间周期，则对于执行时间序列分析是空闲的。</li></ul><p id="a60d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">参考文献</strong></p><div class="ky kz ez fb la lb"><a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab dw"><div class="ld ab le cl cj lf"><h2 class="bd hj fi z dy lg ea eb lh ed ef hh bi translated">美丽的汤文档-美丽的汤4.4.0文档</h2><div class="li l"><h3 class="bd b fi z dy lg ea eb lh ed ef dx translated">Beautiful Soup是一个Python库，用于从HTML和XML文件中提取数据。它与您最喜欢的解析器一起工作…</h3></div><div class="lj l"><p class="bd b fp z dy lg ea eb lh ed ef dx translated">www.crummy.com</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp io lb"/></div></div></a></div><div class="ky kz ez fb la lb"><a href="https://selenium-python.readthedocs.io/" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab dw"><div class="ld ab le cl cj lf"><h2 class="bd hj fi z dy lg ea eb lh ed ef hh bi translated">Selenium与Python - Selenium Python绑定2文档</h2><div class="li l"><h3 class="bd b fi z dy lg ea eb lh ed ef dx translated">请注意，这不是正式文档。如果你想对这个文档有所贡献，你可以叉这个…</h3></div><div class="lj l"><p class="bd b fp z dy lg ea eb lh ed ef dx translated">selenium-python.readthedocs.io</p></div></div></div></a></div></div></div>    
</body>
</html>