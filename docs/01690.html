<html>
<head>
<title>Tidying data using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python整理数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/tidying-data-in-python-78e48eb0bdfd?source=collection_archive---------3-----------------------#2019-11-09">https://medium.com/analytics-vidhya/tidying-data-in-python-78e48eb0bdfd?source=collection_archive---------3-----------------------#2019-11-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/18b59649f98639310b72647a7ca72066.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*veexsBGpgxNrc7V5"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">米卡·鲍梅斯特在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="9f09" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这篇文章是我之前写的<a class="ae iu" rel="noopener" href="/@kimrodrikwa/untidy-data-a90b6e3ebe4c">凌乱数据博客</a>的延续。要了解什么是不整洁的数据，请看看帖子。概括地说，如果数据具有以下属性，则称其为整洁的:</p><ol class=""><li id="781b" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">每个变量形成一列。</li><li id="0305" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated"><em class="kc">每个观察值形成一行。</em></li><li id="cda1" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated"><em class="kc">每种类型的观测单元形成一张表。</em></li></ol><p id="069f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里我要整理一下我在那篇帖子里介绍的一个杂乱无章的数据。我将使用Python来做这件事，更具体地说是<a class="ae iu" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">熊猫库</a>。然后，我将评估最终的“整洁数据”，以检查它是否符合这些要求。</p><p id="d985" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">原始凌乱数据</strong></p><figure class="ki kj kk kl fd ij"><div class="bz dy l di"><div class="km kn l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">杂乱的数据。例如，its既有学生观察单元，也有表现观察单元</figcaption></figure><p id="8a79" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">关于完整的解决方案，请看这个<a class="ae iu" href="https://github.com/Kimmirikwa/tidy-data" rel="noopener ugc nofollow" target="_blank"> github库</a>。</p><p id="58c6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我首先打算进口熊猫</p><figure class="ki kj kk kl fd ij"><div class="bz dy l di"><div class="km kn l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">导入python作为其通用别名</figcaption></figure><p id="cc98" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将数据读入<a class="ae iu" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html" rel="noopener ugc nofollow" target="_blank"> pandas dataframe </a>并获取数据的列。下面的代码实现了这一点。</p><figure class="ki kj kk kl fd ij"><div class="bz dy l di"><div class="km kn l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">将csv文件读入数据帧并检查列</figcaption></figure><p id="1242" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们有了数据框架，我们可以使用强大的pandas技术来整理数据。如前所述，该数据存在不整洁的数据问题。我现在将讨论这些问题，并讨论它们的修复方法。以下是前一篇文章中解释的数据问题:</p><ol class=""><li id="01ce" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated"><em class="kc">有些列标题是值，而不是变量名</em></li><li id="bccd" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated"><em class="kc">多个变量存储在一列</em></li><li id="87c2" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated"><em class="kc">变量存储在行和列中</em></li><li id="a060" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated"><em class="kc">多种类型的观测单位存储在同一个表中</em></li></ol><p id="c2ba" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了讨论修复，我不会按照上述问题的顺序。我将解决所有这些问题，首先将数据分成不同的表(针对学生和成绩)并整理每个数据集。</p></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><ul class=""><li id="f8fb" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js kv jz ka kb bi translated"><em class="kc">多种类型的观测单位存储在同一个表中</em></li></ul><p id="d78f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该数据包含了<strong class="ix hj">学生</strong>和<strong class="ix hj">表现</strong>的数据。我要做的第一件事是把这些不同的观察单位分开，让每个单位都有自己的表格。列<em class="kc"> id </em>、<em class="kc">姓名</em>、<em class="kc">电话</em>和<em class="kc">性别和年龄</em>将出现在<strong class="ix hj">学生</strong>表中。<em class="kc">测试号</em>、<em class="kc">第一项</em>、<em class="kc">第二项</em>和<em class="kc">第三项</em>将出现在性能表中。<em class="kc"> id </em>列也将被添加到性能表中，以标识性能的学生。</p><p id="87fa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们初始化两个数据帧<em class="kc"> student_df </em>和<em class="kc"> performance_df </em>，它们具有来自原始数据帧的相关列。</p><figure class="ki kj kk kl fd ij"><div class="bz dy l di"><div class="km kn l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">将原始数据集拆分为学生数据集和成绩数据集。这解决了上面的问题4。</figcaption></figure><p id="9f93" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">学生df现在看起来如下所示</p><figure class="ki kj kk kl fd ij"><div class="bz dy l di"><div class="km kn l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">学生表中的数据可能是在收集学生的详细信息时记录的</figcaption></figure><p id="ef1e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="kc"> performance_df </em>如下图</p><figure class="ki kj kk kl fd ij"><div class="bz dy l di"><div class="km kn l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">成绩表有可能在考试后记录的数据</figcaption></figure><p id="7b7e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">可以清楚地看到，数据帧现在包含不同的观察单位。几乎可以肯定，学生表中的数据是在注册学生时记录的。对于性能表，很明显，这些数据是在检查后记录的，尽管分散在一段时间内。这并不意味着不可能收集例如学生的性别和分数作为一个观察。例如，在进入一所学校之前做一次考试之后，这是可能的。然而，对于一个学生来说，在三个学期的多次考试中出现这种情况的几率非常低。</p></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><ul class=""><li id="6d95" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js kv jz ka kb bi translated"><em class="kc">多个变量存储在一列</em></li></ul><p id="1142" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="kc"> student_df </em>中的<strong class="ix hj">性别和年龄</strong>列包含性别和年龄数据。提取每个学生的<strong class="ix hj">性别</strong>和<strong class="ix hj">年龄</strong>并添加到相关列。原来的<strong class="ix hj">性别和年龄</strong>列是从数据帧中删除的。这是通过使用数据框的<a class="ae iu" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html" rel="noopener ugc nofollow" target="_blank">应用</a>和<a class="ae iu" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.drop.html" rel="noopener ugc nofollow" target="_blank">下降</a>功能实现的。</p><figure class="ki kj kk kl fd ij"><div class="bz dy l di"><div class="km kn l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">提取性别和年龄，然后将它们放在不同的列中。然后删除原始的组合列。</figcaption></figure><p id="1ad2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">学生表现在看起来如下所示。</p><figure class="ki kj kk kl fd ij"><div class="bz dy l di"><div class="km kn l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">整洁的学生桌子</figcaption></figure><p id="87ab" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从上表中可以看出，</p><ol class=""><li id="ec7d" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">id、姓名、电话、性别和年龄都是构成表格列的变量。</li><li id="f509" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated"><em class="kc">每个学生数据都是一个观察值，形成一行。</em></li><li id="aae1" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated"><em class="kc">该表只有一种观察单位，即针对学生的观察单位</em></li></ol></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><p id="3fed" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们有了一个整洁的学生数据，注意力将转移到成绩数据上。</p><ul class=""><li id="5b02" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js kv jz ka kb bi translated"><em class="kc">有些列标题是值，不是变量名</em></li></ul><p id="988e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第1项</strong>、<strong class="ix hj">第2项</strong>和<strong class="ix hj">第3项</strong>是数值，但用作列标题。这是通过使用熊猫<a class="ae iu" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.melt.html" rel="noopener ugc nofollow" target="_blank">融化</a>修复的。</p><figure class="ki kj kk kl fd ij"><div class="bz dy l di"><div class="km kn l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">熔化性能数据框架</figcaption></figure><p id="4ba9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在melted dataset<strong class="ix hj">term 1</strong>、<strong class="ix hj"> term 2 </strong>和<strong class="ix hj"> term 3 </strong>列现在在<strong class="ix hj"> term </strong>列中，它们以前的值在<strong class="ix hj">标记</strong>列中。</p><figure class="ki kj kk kl fd ij"><div class="bz dy l di"><div class="km kn l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">熔融性能数据</figcaption></figure><p id="8912" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">术语编号是从术语值中提取的。</p><figure class="ki kj kk kl fd ij"><div class="bz dy l di"><div class="km kn l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">提取术语编号</figcaption></figure></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><ul class=""><li id="e306" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js kv jz ka kb bi translated"><em class="kc">多个变量存储在一列</em></li></ul><p id="ca7f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">测试1 </strong>和<strong class="ix hj">测试2 </strong>是不同的变量，但存储在<strong class="ix hj">测试号</strong>栏中。<strong class="ix hj">测试1 </strong>和<strong class="ix hj">测试2 </strong>列添加了各自的标记作为数值。</p><figure class="ki kj kk kl fd ij"><div class="bz dy l di"><div class="km kn l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">添加测试1分数和测试2分数</figcaption></figure><p id="de7f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们快到了！我们现在删除<strong class="ix hj">标记</strong>和<strong class="ix hj">测试编号</strong>列，因为它们的数据在测试标记列中。然后，我们将重复的成绩条目放入表中，并按学生id对数据进行排序。</p><figure class="ki kj kk kl fd ij"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="e52f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最终的性能数据如下所示。</p><figure class="ki kj kk kl fd ij"><div class="bz dy l di"><div class="km kn l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">整洁的性能数据</figcaption></figure><p id="5ecc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从上表中可以看出，</p><ol class=""><li id="7060" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated"><em class="kc"> id、term、test 1标记和test 2标记都是构成表格列的变量。</em></li><li id="7ab3" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated"><em class="kc">每个学生在测试中的表现数据是一个观察值，形成一行。</em></li><li id="8fc2" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated"><em class="kc">该表只有一种观察单位，即学生在考试中的表现。</em></li></ol></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><p id="25be" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">结论</strong></p><p id="9e9a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们现在已经将学生和成绩的数据分别放在不同的表中。对于学生数据集，最初保存<strong class="ix hj">性别</strong>和<strong class="ix hj">年龄</strong>数据的<strong class="ix hj">性别和年龄</strong>列被拆分为单独的列。对于性能数据集，我们最初用作列标题的<strong class="ix hj">术语1 </strong>、<strong class="ix hj">术语2 </strong>和<strong class="ix hj">术语3 </strong>值被更改为<strong class="ix hj">术语</strong>列的值。最后<strong class="ix hj">测试1 </strong>和<strong class="ix hj">测试2 </strong>变量从数值变为列标题。</p><p id="76e9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这标志着第二部分数据整洁博客的结束。</p><p id="d7cf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">参考文献</strong></p><ol class=""><li id="55a5" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated"><a class="ae iu" rel="noopener" href="/@kimrodrikwa/untidy-data-a90b6e3ebe4c">我的第一篇关于凌乱数据的帖子</a>。</li><li id="2125" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated"><a class="ae iu" href="https://vita.had.co.nz/papers/tidy-data.pdf" rel="noopener ugc nofollow" target="_blank">整理资料论文</a>由哈德利·韦翰撰写</li><li id="cc70" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated"><a class="ae iu" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">熊猫图书馆</a></li><li id="2776" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated"><a class="ae iu" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html" rel="noopener ugc nofollow" target="_blank">熊猫数据帧</a></li><li id="f483" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated">熊猫数据框<a class="ae iu" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html" rel="noopener ugc nofollow" target="_blank">应用</a></li><li id="adda" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated">熊猫数据帧<a class="ae iu" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.drop.html" rel="noopener ugc nofollow" target="_blank">下降</a></li><li id="0158" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated">熊猫<a class="ae iu" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.melt.html" rel="noopener ugc nofollow" target="_blank">融化</a>。</li></ol></div></div>    
</body>
</html>