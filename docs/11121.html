<html>
<head>
<title>How to build a Bitcoin Sentiment Analysis using Python and Twitter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python和Twitter构建比特币情绪分析</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-build-a-bitcoin-sentiment-analysis-using-python-and-twitter-beb89e6ce0c8?source=collection_archive---------3-----------------------#2020-11-19">https://medium.com/analytics-vidhya/how-to-build-a-bitcoin-sentiment-analysis-using-python-and-twitter-beb89e6ce0c8?source=collection_archive---------3-----------------------#2020-11-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4b46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">情绪分析现在是一种趋势，事实上，已经有几个产品在分析一个或多个社交媒体，以获得对某项金融资产的情绪。这些模型有些是有效的，有些则不那么有效。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/404a31acbd9d97104ae7d43155e154bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZSNUPq249HNtp2YeCGBRWQ.png"/></div></div></figure><h2 id="f305" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">为什么要创建自己的情感分析？</h2><p id="ce81" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">关键是，在其他人制作的通用模型中，我们通常找不到我们需要的细节，而且它们也没有足够的可塑性来满足我们的需求。</p><p id="8a66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于创建一个情绪分析所需的资源是完全免费的，所以我想到了创建一个简短的DIY指南，让每个人都可以选择如何实现自己的分析，并从中汲取灵感。</p><h2 id="ad0e" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">先决条件</h2><p id="b9d8" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">为了让Python脚本正确运行，您需要订阅一些资源并安装一些库。此外，我下面要列出的资源已经安装在装有Python 3.9的mac上，所以如果您使用不同的机器或环境，结果可能需要稍加调整。在任何情况下，对于任何障碍，总有“神圣之水”来帮助我们。</p><ul class=""><li id="d7ad" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">Python 3安装了以下库:</li><li id="710a" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">Tweepy ( <code class="du ld le lf lg b">pip install tweepy</code></li><li id="6aad" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">谷歌Clound语言(<code class="du ld le lf lg b">pip install — upgrade google-cloud-language</code>)</li><li id="4b28" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">熊猫(<code class="du ld le lf lg b">pip install pandas openpyxl</code>)</li><li id="7bfd" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">Twitter开发订阅和相关Oauth凭证</li><li id="3693" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">NLP库的Google Cloud订阅和相关Oauth凭据</li></ul><p id="42b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦安装了这些库，您就可以在代码的第一部分导入它们:</p><pre class="je jf jg jh fd lh lg li lj aw lk bi"><span id="b43e" class="jp jq hi lg b fi ll lm l ln lo">import tweepy<br/>import os<br/>from google.cloud import language_v1<br/>import pandas as pd</span></pre><h2 id="2ce4" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">从Twitter抓取</h2><p id="17e3" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">Twitter有一个公共API，可以基于JSON格式的搜索返回tweets。我们感兴趣的是关于比特币的信息，所以我们将按照下面的代码对<strong class="ih hj">#比特币</strong>进行搜索。在任何情况下，简单地通过添加另一枚硬币或其他相关标签(例如<strong class="ih hj"> #BTC </strong>)来修改这个脚本将允许您扩展或改进搜索。</p><p id="28c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更改访问令牌后(<code class="du ld le lf lg b">insert-your-twitter-access-token-here</code></p><p id="f94c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以修改搜索参数，以确定每次搜索检索多少条推文以及最大推文数量(分别为<code class="du ld le lf lg b">tweetsPerQry</code>和<code class="du ld le lf lg b">maxTweets</code>)。我强烈建议做一些测试查询来检查结果，看看推文是否相关。</p><p id="8613" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以对代码进行的其他更改旨在优化推文，例如通过消除转发。看看Tweepy API，了解可用的选项。</p><p id="3d23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从这里，我只提取推文的文本，并把它们放在一个列表中(<code class="du ld le lf lg b">listposts</code>)，然后由Google NLP进行实际分析。</p><pre class="je jf jg jh fd lh lg li lj aw lk bi"><span id="76f3" class="jp jq hi lg b fi ll lm l ln lo">consumer_key = 'insert-your-twitter-access-token-here'<br/>consumer_secret = 'insert-your-twitter-access-token-here'<br/>access_token = 'insert-your-twitter-access-token-here'<br/>access_token_secret = 'insert-your-twitter-access-token-here'<br/><br/>tweetsPerQry = 100<br/>maxTweets = 100<br/>hashtag = "#Bitcoin"<br/><br/>authentication = tweepy.OAuthHandler(consumer_key, consumer_secret)<br/>authentication.set_access_token(access_token, access_token_secret)<br/>api = tweepy.API(authentication, wait_on_rate_limit=True, wait_on_rate_limit_notify=True)<br/>maxId = -1<br/>tweetCount = 0<br/>listposts = []<br/>while tweetCount &lt; maxTweets:<br/>	if(maxId &lt;= 0):<br/>		newTweets = api.search(q=hashtag, count=tweetsPerQry, result_type="recent", tweet_mode="extended")<br/>	else:<br/>		newTweets = api.search(q=hashtag, count=tweetsPerQry, max_id=str(maxId - 1), result_type="recent", tweet_mode="extended")<br/><br/>if not newTweets:<br/>		print("Tweet Habis")<br/>		break<br/>	<br/>	for tweet in newTweets:<br/>		d={}<br/>		d["text"] = tweet.full_text.encode('utf-8')<br/>		print (d["text"])<br/>		listposts.append(d)<br/>		<br/>	tweetCount += len(newTweets)	<br/>	maxId = newTweets[-1].id<br/>print (listposts)</span></pre><p id="d782" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里可以找到我用的Twitter抓取脚本:<a class="ae lp" href="https://gist.github.com/DeaVenditama/40ed30cb4bc793ab1764fc3105258d8a" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">https://gist . github . com/DeaVenditama/40 ed 30 CB 4 BC 793 ab 1764 fc 3105258 D8 a</strong></a></p><h2 id="771c" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">把推文交给谷歌自然语言处理</h2><p id="7520" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">Google NLP是我们将用来对从Twitter中提取的文本进行自然语言处理的库。我选择尝试这一个，因为我在过去已经尝试过其他的不太能说服我。鉴于很难用几句话来理解情绪，我发现这个谷歌图书馆非常详细，因为它提供了两个衡量标准:<strong class="ih hj">得分</strong>和<strong class="ih hj">量级</strong>。</p><p id="3423" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">特别地，<strong class="ih hj">分数</strong>对应于文本的总体情感倾向，其可以是积极的、消极的或中性的，并且具有可以从-1到1变化的值(-1表示消极，0表示中性，1表示积极)。<br/>的<strong class="ih hj">量级</strong>反而表示得分的强弱。换句话说，情绪的强度。趋向于0的值表示低强度，而趋向于2的值表示高情感强度。</p><p id="fa00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在启动脚本之前，您需要有一个Google Cloud帐户，并按照这个URL(<a class="ae lp" href="https://cloud.google.com/natural-language/docs/reference/libraries#cloud-console" rel="noopener ugc nofollow" target="_blank">https://Cloud . Google . com/natural-language/docs/reference/libraries # Cloud-console</a>)上的步骤安装必要的库，并下载包含身份验证凭据的JSON文件。一旦你把文件下载到你的机器上，你必须输入文件的完整路径来代替(<code class="du ld le lf lg b">insert-the-path-to-your-json-key-here</code>)</p><p id="69db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这部分代码中，我们什么也不做，只是滚动之前获得的tweet列表，并调用分析情绪的Google NLP函数，为每个tweet返回一对值(<strong class="ih hj"> score </strong>，<strong class="ih hj"> magnitude </strong>)。</p><pre class="je jf jg jh fd lh lg li lj aw lk bi"><span id="cd97" class="jp jq hi lg b fi ll lm l ln lo">os.environ['GOOGLE_APPLICATION_CREDENTIALS'] = "insert-the-path-to-your-json-key-here"<br/>client = language_v1.LanguageServiceClient()<br/><br/>for x in range (len(listposts)):<br/>     <br/>    try:<br/> <br/>        document = language_v1.Document(content=listposts[x]["text"], type_=language_v1.Document.Type.PLAIN_TEXT)<br/>        sentiment = client.analyze_sentiment(document=document).document_sentiment<br/>        sscore = round(sentiment.score,4)<br/>        smag = round(sentiment.magnitude,4)<br/> <br/>        listposts[x]["score"] = sscore<br/>        listposts[x]["magnitude"] = smag<br/>         <br/>    except Exception as e:<br/>        print(e)<br/>        listposts[x]["score"] = 0<br/>        listposts[x]["magnitude"] = 0</span></pre><p id="f5ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谷歌NLP脚本是丹尼尔·赫里迪亚提供给我的。在这个页面上，你还可以找到一个从脸书帖子开始的一般分析例子。</p><div class="lq lr ez fb ls lt"><a href="https://www.danielherediamejias.com/facebook-scraping-and-sentiment-analysis-with-python/" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab dw"><div class="lv ab lw cl cj lx"><h2 class="bd hj fi z dy ly ea eb lz ed ef hh bi translated">用Python - Daniel Heredia实现脸书抓取和情感分析</h2><div class="ma l"><h3 class="bd b fi z dy ly ea eb lz ed ef dx translated">在今天的帖子中，我将向你展示如何非常容易地删除发表在公共网站上的帖子…</h3></div><div class="mb l"><p class="bd b fp z dy ly ea eb lz ed ef dx translated">www.danielherediamejias.com</p></div></div><div class="mc l"><div class="md l me mf mg mc mh jn lt"/></div></div></a></div><h2 id="ee24" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">Excel文件的结果分析</h2><p id="c5fa" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">在最后两行中，tweets列表及其分数和大小通过Pandas库进行处理，并写入您选择的excel文件(<code class="du ld le lf lg b">insert-you-file-excel-path-here</code>)</p><pre class="je jf jg jh fd lh lg li lj aw lk bi"><span id="dfd2" class="jp jq hi lg b fi ll lm l ln lo">df = pd.DataFrame(listposts)</span><span id="5e5b" class="jp jq hi lg b fi mi lm l ln lo">df.to_excel('insert-you-file-excel-path-here', header=True, index=False)</span></pre><p id="325c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">脚本运行完毕后，您将得到一个类似于下图的excel文件:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mj"><img src="../Images/e49a913af2797015aca9e704214697a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*0h2N0oBzBrvSZKUErjNhhQ.png"/></div></figure><p id="c9cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果表明，对提取的推文进行后续提炼是必要的，因为很容易遇到不太相关的推文，甚至更糟糕的是，促销推文。我相信这种分析的最终价值与预先完成的细化工作一样准确。</p><p id="3169" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的情况下，100条推文中的平均分数是-0.025，震级为0.0517。</p><h2 id="0fe1" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">接下来的发展</h2><p id="1f1c" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">除了推文细化之外，还有许多措施可以增加这种分析的价值，例如:</p><ul class=""><li id="e161" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">提取比特币的价值(大多数交易所都有免费的API)，并将其与分数相关联。</li><li id="e760" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">通过尝试不同的标签来使用不同的搜索</li><li id="0762" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">使用较小的加密货币，Twitter上的标签较少，以了解结果是否更准确，因为它的垃圾邮件较少</li><li id="387a" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">了解哪些时间框架是正确的。在我们的例子中，我们采用了最近的推文。但从理论上讲，情绪在短期内相关性很强，而在长期内相关性较弱，或者相反。</li><li id="a92e" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">从推文中添加不同的指标:转发次数、点赞等，这些都有助于推文的加权或过滤。</li></ul></div></div>    
</body>
</html>