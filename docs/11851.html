<html>
<head>
<title>SQL queries I wish I’d known when I started in data. Part 1: the event funnel.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL 查询我希望我从数据开始时就知道。第 1 部分:事件漏斗。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/sql-queries-i-wish-id-known-when-i-started-in-data-part-1-the-event-funnel-3bd1de6a92ef?source=collection_archive---------6-----------------------#2020-12-21">https://medium.com/analytics-vidhya/sql-queries-i-wish-id-known-when-i-started-in-data-part-1-the-event-funnel-3bd1de6a92ef?source=collection_archive---------6-----------------------#2020-12-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="677b" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">值得记忆的 SQL。</h1><p id="999b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">自从不到两个月前加入哈勃以来，我注意到我脑子里有多少 SQL 语句。这些是我发现自己在工作的每个地方反复使用的查询，一旦我使用了一次，我就不会忘记它们。</p><p id="323d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">所以，我想也许值得分享这些问题，以防对其他人有用🤗这正是我在这一系列博客文章中要做的。</p><p id="31f6" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">我将介绍一些最常见的 SQL 查询，这些查询是我在研究产品性能时突然想到的。我还将谈一谈如何利用这些数据来帮助你做出更好的产品决策。</p><p id="4d02" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">因此，希望能对建筑有所了解:</p><p id="d679" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">-事件漏斗<br/> -无缝日期网格<br/> -让您对用户进行时间序列分析的表格</p><p id="039e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">一旦您构建了这些公共查询，您就可以使用 Beacon 来保存它们，这样您的所有团队成员都可以访问它们，而无需编写 SQL。您还可以使用 Beacon 来分享您在 Slack 中的新查询结果！<a class="ae kg" href="https://www.gethubble.io/beacon" rel="noopener ugc nofollow" target="_blank">你可以在这里查看灯塔</a>。</p><p id="625b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">成为一个“数据驱动”的公司有时会感觉像一个白日梦，但希望这些博客帖子可以帮助你的团队将它变成现实💪。</p><h1 id="339e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">使用事件漏斗跟踪用户可以参加的一系列事件，并改善旅程！</h1><p id="ea03" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我在首次发布产品时挖掘的最有用的数据之一是<strong class="jf hj">事件漏斗</strong>。</p><p id="ce9b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">事件漏斗是一种工具，可让您测量一系列步骤(事件)的完成率。例如，您可以创建一个创建帐户所需步骤的漏斗，然后跟踪每个步骤的完成率。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/bd3d6b93efc87f86156f082f35479e39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*80ZfjGCJ2tW1lbW9zfQ68A.png"/></div></div></figure><p id="633e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">通过这些漏斗，你可以看到哪些步骤是用户旅程中最大的落点。这些信息非常有用，因为:</p><p id="18b9" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">1.你可以根据数据做出<strong class="jf hj">决定</strong>你需要改变产品的哪些部分来提高行动的完成度(而不是仅仅依靠你的直觉)。<br/> 2。您可以<strong class="jf hj">估计您的变更对完成率的影响</strong>，因为您可以比较变更前后的漏斗。</p><h1 id="4a6d" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">我们如何利用事件漏斗提高与 Beacon 的互动。</h1><p id="a7cb" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们开发了一个产品，<a class="ae kg" href="https://www.gethubble.io/beacon" rel="noopener ugc nofollow" target="_blank"> Beacon </a>，它可以让你在 Slack 中编写、运行和共享你的 SQL(你可以<a class="ae kg" href="https://slack.com/oauth/v2/authorize?client_id=1207722259383.1462138656839&amp;scope=commands,im:history,im:read,im:write,team:read,users:read,users:read.email,workflow.steps:execute,chat:write&amp;user_scope=&amp;state=medium.event_funnel" rel="noopener ugc nofollow" target="_blank">在这里把它添加到你的工作区</a>！)</p><p id="b07a" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">一旦我们发布了它，我们想了解用户是如何参与到产品中的。具体来说，我们想弄清楚<strong class="jf hj">为什么人们在安装 Beacon 后不使用它运行查询。</strong></p><p id="71aa" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">因此，我们有一个操作(“执行查询”)，我们试图优化完成率，我们知道导致该操作的步骤。进入… <em class="kt">事件漏斗</em>。</p><p id="4c06" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">我为用户建立了一个事件漏斗，从“我安装了应用程序”到“我执行了一个查询”。我使用我们令人敬畏的工具<a class="ae kg" href="https://slack.com/oauth/v2/authorize?client_id=1207722259383.1462138656839&amp;scope=commands,im:history,im:read,im:write,team:read,users:read,users:read.email,workflow.steps:execute,chat:write&amp;user_scope=&amp;state=medium.event_funnel" rel="noopener ugc nofollow" target="_blank"> Beacon </a>来运行查询，并直接与 Slack 中的团队分享结果:</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es ku"><img src="../Images/40f2fd40426fb53656f5a74e773db76e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zNhOCpUKU5MQLmpJxOzA3Q.png"/></div></div></figure><p id="2a2b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi">…</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kv"><img src="../Images/138bd5d94955796374fe5fd509f76cf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KYmUhxjG_Y87yqOtwSk6CQ.png"/></div></div></figure><p id="5486" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这个事件漏斗非常清楚地表明，最大的落点在第 3 步和第 4 步之间:看到<code class="du kw kx ky kz b">connect modal</code>(即给出如何连接到数据库的指令的屏幕)并成功获得<code class="du kw kx ky kz b">database connected</code>。</p><p id="235e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">因此，我们联系了一些在这一步陷入困境的用户，集思广益，想出了一些我们可以做出的改进，以帮助减少连接数据库时的摩擦。基本上，<strong class="jf hj">事件漏斗向我们展示了如果我们想要推动用户参与度的最高增长，我们应该寻求改变产品的哪一部分。</strong></p><h1 id="dca1" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">事件漏斗是我记忆中的 SQL 查询之一。</h1><p id="2009" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">为了能够构建一个漏斗，您需要生成一个表格，在您的漏斗中每一步都有一行，然后统计完成该步骤的用户数量。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es la"><img src="../Images/8165a693dc68b7280ab640150d7ded7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H_sUlacsGSJ1O6ECAsSmIw.png"/></div></div></figure><p id="1afa" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这些<code class="du kw kx ky kz b">step_name</code>值是我们在应用程序中跟踪的分析事件(如果您还没有设置事件跟踪，您可以使用类似<a class="ae kg" href="https://segment.com/docs/protocols/tracking-plan/best-practices/" rel="noopener ugc nofollow" target="_blank"> Segment </a>或<a class="ae kg" href="https://docs.rudderstack.com/rudderstack-sdk-integration-guides" rel="noopener ugc nofollow" target="_blank"> Rudderstack </a>的工具来设置事件跟踪！)</p><p id="5ffb" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">一旦你想好了你的漏斗中需要的步骤以及它们的顺序，你就可以使用下面的 SQL 模板来构建你的事件漏斗。我们的团队现在喜欢看到这些漏斗，它推动了我们的许多工作。我们使用<a class="ae kg" href="https://www.gethubble.io/beacon" rel="noopener ugc nofollow" target="_blank"> Beacon </a>在我们的团队 Slack 中分享最新的事件漏斗数据。</p><p id="e088" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">我挖掘了 3 个事件，但是您可以遵循此模板中的模式，添加更多事件作为附加子查询(这些实际上称为“<a class="ae kg" href="https://www.essentialsql.com/introduction-common-table-expressions-ctes/" rel="noopener ugc nofollow" target="_blank"> CTEs </a>”)，以满足您的漏斗需求！</p><h1 id="9508" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">这就是它的辉煌之处:事件漏斗。</h1><p id="af6b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">要使用这个事件漏斗运行查询，您需要确保您已经整理了一些东西:</p><h2 id="b9df" class="lb ig hi bd ih lc ld le il lf lg lh ip jo li lj it js lk ll ix jw lm ln jb lo bi translated">步骤 1:在下面的查询中插入正确的变量。</h2><p id="799a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">1.<code class="du kw kx ky kz b">user_id</code>字段需要是你的用户的标识符(或者是你在漏斗中计算的单位——例如<code class="du kw kx ky kz b">team_id</code>如果你想知道团队做某事的转化率)<br/> 2。<code class="du kw kx ky kz b">event</code>字段应该是您在每个子查询(CTE)中引用的步骤的<strong class="jf hj">名称。<br/> 3。<code class="du kw kx ky kz b">timestamp</code>字段应表示事件发生的时间。<br/> 4。您需要更改<code class="du kw kx ky kz b">FROM project_name.dataset_name.event_name_1 </code>来引用为每个给定步骤存储事件数据的表。<br/> 5。我在底部注释掉了一些代码，让你为漏斗指定一个日期范围(见:<code class="du kw kx ky kz b">IF YOU WANT TO SPECIFY A RANGE OF DATES, YOU CAN DO THAT HERE</code>)。如果需要，您可以添加它，但是它不是查询工作所必需的！🙂</strong></p><pre class="ki kj kk kl fd lp kz lq lr aw ls bi"><span id="f912" class="lb ig hi kz b fi lt lu l lv lw">WITH event_1 AS (<br/> SELECT<br/> user_id, — identifier of the thing you’re counting in your funnel<br/> ‘get_in_rocket’ AS event, — name of the step in your funnel<br/> MIN(timestamp) AS timestamp_first — timestamp of when the event occurred<br/> <br/> FROM `project_name.dataset_name.event_name_1` — table where your event data is stored for step 1<br/> <br/> GROUP BY 1, 2<br/> ),</span><span id="ca40" class="lb ig hi kz b fi lx lu l lv lw">event_2 AS (<br/> SELECT<br/> s2.user_id,<br/> ‘push_button’ AS event,<br/> MIN(timestamp) AS timestamp_first<br/> <br/> FROM `project_name.dataset_name.event_name_2` AS s2<br/> <br/> INNER JOIN event_1 s1 ON s1.user_id = s2.user_id<br/> <br/> WHERE s2.timestamp &gt;= s1.timestamp_first<br/> <br/> GROUP BY 1,2<br/> ),</span><span id="986c" class="lb ig hi kz b fi lx lu l lv lw">event_3 AS (<br/> SELECT<br/> s3.user_id,<br/> ‘blastoff’ AS event,<br/> MIN(timestamp) AS timestamp_first<br/> <br/> FROM `project_name.dataset_name.event_name_3` AS s3<br/> <br/> INNER JOIN event_2 s2 ON s2.user_id = s3.user_id<br/> <br/> WHERE s3.timestamp &gt;= s2.timestamp_first<br/> <br/> GROUP BY 1,2<br/> ),</span><span id="6527" class="lb ig hi kz b fi lx lu l lv lw">all_events AS (<br/> SELECT CONCAT(’01: “‘, event, ‘“‘) as step_name, user_id, timestamp_first FROM event_1<br/> UNION ALL<br/> SELECT CONCAT(’02: “‘, event, ‘“‘) as step_name, user_id, timestamp_first FROM event_2<br/> UNION ALL<br/> SELECT CONCAT(’03: “‘, event, ‘“‘) as step_name, user_id, timestamp_first FROM event_3<br/> )</span><span id="bc12" class="lb ig hi kz b fi lx lu l lv lw">SELECT<br/> step_name,<br/> COUNT(user_id) AS num_users_making_it_to_step,<br/> ROUND(COUNT(user_id) * 100 / (MAX(COUNT(user_id)) OVER(PARTITION BY NULL)), 2) AS percent_of_users_making_it_to_step</span><span id="1194" class="lb ig hi kz b fi lx lu l lv lw">FROM all_events<br/> LEFT JOIN event_1 USING(user_id)</span><span id="7299" class="lb ig hi kz b fi lx lu l lv lw">— IF YOU WANT TO SPECIFY A RANGE OF DATES, YOU CAN DO THAT HERE<br/> — This is the “From” date:<br/> — WHERE event_1.timestamp_first &gt;= ‘2020–12–01’</span><span id="8fb2" class="lb ig hi kz b fi lx lu l lv lw">— This is the “To” date:<br/> — AND event_1.timestamp_first &lt;= ‘2020–12–03’</span><span id="e00f" class="lb ig hi kz b fi lx lu l lv lw">GROUP BY 1<br/>ORDER BY 1 ASC</span></pre><h2 id="a609" class="lb ig hi bd ih lc ld le il lf lg lh ip jo li lj it js lk ll ix jw lm ln jb lo bi translated">第二步:使用 Beacon 分享你最喜欢的 Slack 频道的漏斗图！</h2><p id="151a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">一旦<a class="ae kg" href="https://slack.com/oauth/v2/authorize?client_id=1207722259383.1462138656839&amp;scope=commands,im:history,im:read,im:write,team:read,users:read,users:read.email,workflow.steps:execute,chat:write&amp;user_scope=&amp;state=medium.event_funnel" rel="noopener ugc nofollow" target="_blank">将 Beacon </a>安装到您的 Slack 工作空间中，并连接到您的数据库，只需键入<code class="du kw kx ky kz b">/run-query</code>，然后输入您的 SQL 查询并点击 enter。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es ly"><img src="../Images/ee0c244e04ab975c7f1953e51c9ecb83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WFEDEdw0EwLhR4z5zRMR4w.png"/></div></div></figure><h2 id="9772" class="lb ig hi bd ih lc ld le il lf lg lh ip jo li lj it js lk ll ix jw lm ln jb lo bi translated">步骤 3:保存您的查询，以便您团队的其他成员可以使用它！</h2><p id="70d4" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">一旦您的查询在 Slack 中发布，您就可以点击<code class="du kw kx ky kz b">Save Query</code>让您团队中的其他人都可以使用您的事件漏斗的 SQL 查询！</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es lz"><img src="../Images/31b949feaa1bf6160975c81e1439eb3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eJRSc71cHtNv1vrsRvkYjg.png"/></div></div></figure><p id="07d5" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">就是这样！</p><p id="a0c9" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">如果你有任何问题或反馈，请随时给我发消息，地址是<a class="ae kg" href="mailto:katie@gethubble.io" rel="noopener ugc nofollow" target="_blank"> katie@gethubble.io </a>，还有<a class="ae kg" href="https://slack.com/oauth/v2/authorize?client_id=1207722259383.1462138656839&amp;scope=commands,im:history,im:read,im:write,team:read,users:read,users:read.email,workflow.steps:execute,chat:write&amp;user_scope=&amp;state=medium.event_funnel" rel="noopener ugc nofollow" target="_blank">去看看 Beacon </a>，这样你就可以直接在 Slack 上与你的团队分享你的新活动漏斗😊</p></div></div>    
</body>
</html>