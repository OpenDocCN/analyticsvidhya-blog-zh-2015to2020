<html>
<head>
<title>Gentle Introduction to AutoML from H2O.ai</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">来自H2O.ai的AutoML温柔介绍</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/gentle-introduction-to-automl-from-h2o-ai-a42b393b4ba2?source=collection_archive---------0-----------------------#2018-09-13">https://medium.com/analytics-vidhya/gentle-introduction-to-automl-from-h2o-ai-a42b393b4ba2?source=collection_archive---------0-----------------------#2018-09-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d9166856b831565f4eacb08593732f1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vE0y7B8fr-kG2vU2abzEVw.png"/></div></div></figure><p id="064f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">近年来，数据科学技能及其需求的趋势超过了技能供应。随着人工智能渗透到行业的每个角落，很难将数据科学家放在每个可能的用例中。</p><p id="b11d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了弥合这一差距，公司已经开始构建自动处理数据集和构建基线模型的框架。我们看到许多这样的实现都是开源的。据行业领军人物之一，<a class="jo jp ge" href="https://medium.com/u/9aea625dfc27?source=post_page-----a42b393b4ba2--------------------------------" rel="noopener" target="_blank"> H2O.ai </a>，</p><blockquote class="jq jr js"><p id="ad80" class="iq ir jt is b it iu iv iw ix iy iz ja ju jc jd je jv jg jh ji jw jk jl jm jn hb bi translated">AutoML接口被设计为具有尽可能少的参数，使得用户所需要做的就是指向他们的数据集，识别响应列，并且可选地指定时间约束或对训练的总模型数量的限制。</p></blockquote><p id="3cb6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">根据Google Trends，Auto ML的兴起始于Q2 2017:</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jx"><img src="../Images/17fda639c98d2bbdb59ef33b00e854db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7OAhyTCOZ-NO69A49XYy8A.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">AutoML谷歌趋势</figcaption></figure><p id="9315" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">AutoML是H2O的一个功能，它可以自动构建大量模型，目标是在没有任何先验知识的情况下找到“最佳”模型。在本文中，我们将从H2O.ai中了解AutoML。</p><p id="9b12" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该实现在R和Python API中都可用，当前版本的AutoML(在H2O 3.20中)执行:</p><ol class=""><li id="5000" class="kg kh hi is b it iu ix iy jb ki jf kj jj kk jn kl km kn ko bi translated">训练并交叉验证默认随机森林(DRF)、极度随机森林(XRT)、梯度推进机器(GBM)的随机网格、深度神经网络的随机网格、glm的固定网格。</li><li id="16bb" class="kg kh hi is b it kp ix kq jb kr jf ks jj kt jn kl km kn ko bi translated">AutoML然后训练两个堆叠集成模型。</li><li id="c5fa" class="kg kh hi is b it kp ix kq jb kr jf ks jj kt jn kl km kn ko bi translated">第一个集成包含所有模型，第二个集成仅包含每个算法类中性能最好的模型。</li></ol><h1 id="5cd7" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">安装H2O.ai</h1><p id="edc0" class="pw-post-body-paragraph iq ir hi is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">安装程序非常简单。你所需要做的就是安装以下依赖项，然后<code class="du lx ly lz ma b">pip</code>安装；</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="b8dc" class="mf kv hi ma b fi mg mh l mi mj">pip install requests<br/>pip install tabulate<br/>pip install "colorama&gt;=0.3.8"<br/>pip install future</span><span id="2c3e" class="mf kv hi ma b fi mk mh l mi mj">pip install <strong class="ma hj">-</strong>f <a class="ae ml" href="http://h2o-release.s3.amazonaws.com/h2o/latest_stable_Py.html" rel="noopener ugc nofollow" target="_blank">http:<strong class="ma hj">//</strong>h2o<strong class="ma hj">-</strong>release<strong class="ma hj">.</strong>s3<strong class="ma hj">.</strong>amazonaws<strong class="ma hj">.</strong>com<strong class="ma hj">/</strong>h2o<strong class="ma hj">/</strong>latest_stable_Py<strong class="ma hj">.</strong>html</a> h2o</span></pre><p id="dd7b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您已经安装了anaconda，您可以直接使用<code class="du lx ly lz ma b">conda</code>命令；</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="7c27" class="mf kv hi ma b fi mg mh l mi mj">conda install -c h2oai h2o=3.20.0.1</span></pre><p id="0d73" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注意</strong>:在OS X El Capitan中从<code class="du lx ly lz ma b">pip</code>安装H2O时，用户必须包含<code class="du lx ly lz ma b">--user</code>标志。比如说-</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="6f5b" class="mf kv hi ma b fi mg mh l mi mj">pip install -f <a class="ae ml" href="http://h2o-release.s3.amazonaws.com/h2o/latest_stable_Py.html" rel="noopener ugc nofollow" target="_blank">http://h2o-release.s3.amazonaws.com/h2o/latest_stable_Py.html</a> h2o --user</span></pre><p id="8102" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">关于R和Hadoop的安装，请参考官方文档<a class="ae ml" href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/downloading.html#install-in-r" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><h1 id="af01" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">入门指南</h1><p id="cabc" class="pw-post-body-paragraph iq ir hi is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">通过导入H2O.ai和H2OAutoML实例来启动h2o.ai实例。</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="cfe2" class="mf kv hi ma b fi mg mh l mi mj">import h2o<br/>from h2o.automl import H2OAutoML<br/>h2o.init()</span></pre><p id="af2d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果设置成功，将会看到以下集群信息。</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/591fd55e2091fa29edc39b028a221fcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xJ5oqOaopSls1LH4yE0a3Q.png"/></div></div></figure><p id="94da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本例中，我们将使用DataHack练习题<a class="ae ml" href="https://datahack.analyticsvidhya.com/contest/practice-problem-loan-prediction-iii/" rel="noopener ugc nofollow" target="_blank">贷款预测III </a>中的数据集</p><p id="11dc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里的目标是预测客户是否会支付贷款，其中我们提供了详细信息，如性别、婚姻状况、教育程度等。</p><p id="0f5a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，让我们导入训练集并检查<code class="du lx ly lz ma b">.head()</code>和数据帧的数据类型。</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="38a1" class="mf kv hi ma b fi mg mh l mi mj">df = h2o.import_file('train_u6lujuX_CVtuZ9i.csv')<br/>df.head()</span></pre><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/3114b29e20dd94222004da9700d67e74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*42bOrFaVclU9_UM-jSzyLg.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">。head()方法框架</figcaption></figure><p id="b2f9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们用<code class="du lx ly lz ma b">.describe()</code>方法检查数据类型。</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/b1a70abba1a9a042bd6cfa2298f8bbdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ia6WDE4Yd2xMAs7NMZM9aQ.png"/></div></div></figure><p id="42f5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如您在这个例子中看到的，我们的目标变量— <code class="du lx ly lz ma b">Loan_Status</code>的数据类型是enum类型。如果它被称为int类型，那么您必须使用以下命令将数据类型更改为enum:</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="1ce5" class="mf kv hi ma b fi mg mh l mi mj">df[target] = df[target].asfactor()</span></pre><p id="41d8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注意:如果不这样做，AutoML会认为这是一个回归问题，如果你运行模型超过10个小时，代价会很大。</strong></p><p id="84f6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以，一定要小心。我想知道如果目标<code class="du lx ly lz ma b">y</code>有<code class="du lx ly lz ma b">nunique==2</code>，H2O.ai开发者是否可以在后端自动转换这个。</p><p id="4976" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们必须分离特征和目标变量。AutoML函数采用<code class="du lx ly lz ma b">x</code>和<code class="du lx ly lz ma b">y</code>变量中的特征和目标。</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="f08f" class="mf kv hi ma b fi mg mh l mi mj">y = "Loan_Status"<br/>x = ['Gender','Married','Education','ApplicantIncome',<br/>    'LoanAmount','CoapplicantIncome','Loan_Amount_Term',<br/>    'Credit_History','Property_Area']</span></pre><p id="6677" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">太好了！现在我们准备启动汽车</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="d6ef" class="mf kv hi ma b fi mg mh l mi mj">aml = H2OAutoML(max_models = 30, max_runtime_secs=300, seed = 1)<br/>aml.train(x = x, y = y, training_frame = df)</span></pre><p id="8c1c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，您可以配置<code class="du lx ly lz ma b">max_runtime_secs</code>和/或<code class="du lx ly lz ma b">max_models</code>的值，为您的跑步设置明确的时间或型号数量限制。该模型将根据所提供的参数进行训练。在本教程中，我们用大约2分钟的时间来训练没有多少功能的模型。</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/4331f0e108b1c79c39be9d4e652a0e3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jcAwmhZTh76XhxNvLq7LHw.png"/></div></div></figure><p id="c9d2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦模型完成训练，您就可以访问<strong class="is hj">排行榜</strong>。领先者模型存储在<code class="du lx ly lz ma b">aml.leader</code>处，排行榜存储在<code class="du lx ly lz ma b">aml.leaderboard</code>处。排行榜存储顶级模型的快照。顶级模型通常是堆叠的集合，因为它们可以轻松胜过单个训练模型。要查看整个排行榜，请将<code class="du lx ly lz ma b">head()</code>方法的<code class="du lx ly lz ma b">rows</code>参数指定为总行数:</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="b665" class="mf kv hi ma b fi mg mh l mi mj">lb = aml.leaderboard<br/>lb.head()<br/>lb.head(rows=lb.nrows) # Entire leaderboard</span></pre><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/be27d3fedd30297146e758c497e5434c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g9h2SfHY2Aw2QP8wrboykQ.png"/></div></div></figure><p id="08a0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最佳模型得分<em class="jt"> 0.77431 AUC。鉴于我们没有进行任何种类的预处理或模型调优，这是一个很好的成绩！</em></p><h2 id="ef22" class="mf kv hi bd kw mr ms mt la mu mv mw le jb mx my li jf mz na lm jj nb nc lq nd bi translated">预测和保存模型</h2><p id="00c0" class="pw-post-body-paragraph iq ir hi is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">你可以用最佳领导者模型来做预测。这可以通过使用以下命令来完成:</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="ccb8" class="mf kv hi ma b fi mg mh l mi mj">preds = aml.predict(test)</span></pre><p id="a4f4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步是保存训练好的模型。有两种方法保存领导者模型——二进制格式和MOJO格式。如果您要将leader模型投入生产，那么建议使用MOJO格式，因为它是为生产使用而优化的。</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="0a3b" class="mf kv hi ma b fi mg mh l mi mj">h2o.save_model(aml.leader, path = "./Loan_Pred_Model_III_shaz13")</span></pre><h1 id="220e" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">我们对汽车的看法</h1><p id="df80" class="pw-post-body-paragraph iq ir hi is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">AutoML会留在这里。我渴望看到数据科学进一步发展的方向。就特征工程而言，单个自动混音器肯定无法胜过人类的创造性思维，但以我的经验来看，AutoML值得探索。</p><p id="2209" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">虽然AutoML本身不会让你在机器学习竞赛中获得冠军，但它绝对值得考虑作为混合和堆叠模型的补充。在最近的比赛中，AutoML模型大大提高了我的分数，这使我开始探索并专注于混合部分。我强烈推荐看看<a class="jo jp ge" href="https://medium.com/u/9aea625dfc27?source=post_page-----a42b393b4ba2--------------------------------" rel="noopener" target="_blank"> H2O.ai </a>的AutoML。并且，一定要让我知道你对它的看法，以及你对其他自动建模功能的体验。</p></div></div>    
</body>
</html>