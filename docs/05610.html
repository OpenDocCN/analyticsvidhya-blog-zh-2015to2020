<html>
<head>
<title>Use Functions for Analytics workflows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将函数用于分析工作流</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/use-functions-for-analytics-workflows-16c9629ffbca?source=collection_archive---------38-----------------------#2020-04-26">https://medium.com/analytics-vidhya/use-functions-for-analytics-workflows-16c9629ffbca?source=collection_archive---------38-----------------------#2020-04-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="bf5e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="a80c" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这个故事基于一个客户使用案例——如何将<strong class="jf hj">无服务器</strong>与<strong class="jf hj">托管服务</strong>结合起来构建分析工作流。我们将看到这样一个需求的必要性，以及实现它的步骤。</p><p id="424c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">有服务为什么还要无服务器？<a class="ae kg" href="https://read.acloud.guru/@ben11kehoe?source=post_page-----717ef2088b42----------------------" rel="noopener ugc nofollow" target="_blank">本凯霍</a>的优秀文章<a class="ae kg" href="https://read.acloud.guru/serverless-is-a-state-of-mind-717ef2088b42" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj">无服务器是一种心态</strong> </a> <strong class="jf hj"> </strong>谈如何…</p><blockquote class="kh ki kj"><p id="dbe1" class="jd je kk jf b jg kb ji jj jk kc jm jn kl kd jq jr km ke ju jv kn kf jy jz ka hb bi translated">“您应该在托管服务之间使用函数作为粘合剂，包含您的业务逻辑，这些托管服务提供了构成您的应用程序的大部分的重要内容。<em class="hi"/></p></blockquote><h1 id="ed04" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">概观</h1><figure class="kp kq kr ks fd kt er es paragraph-image"><div class="er es ko"><img src="../Images/ec503bbb2f0d438a865faf188ea79b7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*u-0526K2EQDkVqWNLs8h8w.png"/></div></figure><ol class=""><li id="772b" class="kw kx hi jf b jg kb jk kc jo ky js kz jw la ka lb lc ld le bi translated">数据成批出现，并存储在<a class="ae kg" href="https://cloud.ibm.com/catalog/services/cloud-object-storage" rel="noopener ugc nofollow" target="_blank">云对象存储器</a>中。数据丢弃的频率是每天一次，根据负载、来自某个上游系统的事务数量等，数据丢弃可以在任何时间发生。</li><li id="72e0" class="kw kx hi jf b jg lf jk lg jo lh js li jw lj ka lb lc ld le bi translated">每当有数据丢失时，使用<a class="ae kg" href="https://cloud.ibm.com/functions" rel="noopener ugc nofollow" target="_blank"> IBM云函数</a>触发<em class="kk">动作</em></li><li id="da44" class="kw kx hi jf b jg lf jk lg jo lh js li jw lj ka lb lc ld le bi translated">动作的实际<em class="kk">执行是调用计算引擎上的作业，在本例中是<a class="ae kg" href="https://cloud.ibm.com/catalog/services/analytics-engine" rel="noopener ugc nofollow" target="_blank"> IBM分析引擎</a>。这里我们使用Livy接口调用一个spark应用程序</em></li><li id="1038" class="kw kx hi jf b jg lf jk lg jo lh js li jw lj ka lb lc ld le bi translated">最后，spark应用程序的执行是针对刚刚丢弃的数据完成的。</li></ol><h1 id="5c13" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">IBM云功能</h1><p id="3e07" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">IBM Cloud Functions基于Apache OpenWhisk，是一个多语言功能即服务(FaaS)编程平台，用于开发可按需扩展执行的轻量级代码。这种事件驱动计算平台，也称为无服务器计算，或功能即服务(FaaS)，运行代码以响应事件或直接调用。</p><ul class=""><li id="969b" class="kw kx hi jf b jg kb jk kc jo ky js kz jw la ka lk lc ld le bi translated">动作:动作是一段执行特定任务的代码。一个动作可以用你选择的语言编写，比如嵌入在Docker容器中的JavaScript或Swift代码或自定义二进制代码的小片段。您可以将您的操作作为源代码或Docker映像提供给云函数。</li><li id="a84e" class="kw kx hi jf b jg lf jk lg jo lh js li jw lj ka lk lc ld le bi translated"><strong class="jf hj">序列:</strong>一组动作可以链接成一个序列，无需编写任何代码。序列是按顺序调用的动作链，其中一个动作的输出作为输入传递给下一个动作。</li><li id="5803" class="kw kx hi jf b jg lf jk lg jo lh js li jw lj ka lk lc ld le bi translated"><strong class="jf hj">事件:</strong>事件的例子包括数据库记录的改变、超过特定温度的物联网传感器读数、GitHub存储库的新代码提交，或者来自web或移动应用的简单HTTP请求。</li><li id="4ae0" class="kw kx hi jf b jg lf jk lg jo lh js li jw lj ka lk lc ld le bi translated"><strong class="jf hj">触发器:</strong>触发器是一类事件的命名通道。触发器是一个声明，您希望对来自用户或事件源的某种类型的事件做出反应。</li><li id="39ec" class="kw kx hi jf b jg lf jk lg jo lh js li jw lj ka lk lc ld le bi translated"><strong class="jf hj">规则:</strong>规则将一个触发器与一个动作相关联。每次触发器触发时，规则使用触发器事件作为输入，并调用关联的操作</li></ul><p id="69b1" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">点击阅读更多概念和术语<a class="ae kg" href="https://cloud.ibm.com/docs/openwhisk?topic=cloud-functions-use_cases" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="16a8" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">步骤1:创建触发器</h1><p id="62c2" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在不涉及太多细节的情况下，这一步是在一个名为<strong class="jf hj"> pmobucket </strong>的特定桶上创建一个触发器，当带有名称前缀<strong class="jf hj"> dailyreport* </strong>的对象被写入桶时，该触发器被激活。</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es ll"><img src="../Images/07286544afd144b73de7a06090c1cc56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X-iiNk0s_nrW1-igV_YqPw.png"/></div></div></figure><p id="252b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">它出现在我的触发器列表中，因此:</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lq"><img src="../Images/f323a923f980cad122b7eb170d0f5a6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P8c_OIthpPy9c0s99AC04A.png"/></div></div></figure><h1 id="9f24" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">步骤2:创建行动</h1><p id="1ca7" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在这一步中，我们创建一个与上一步中创建的触发器相关联的操作。您可以选择任何运行时，比如Node.js，随您选择——在本例中，我选择了Python3。</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lr"><img src="../Images/c373f5d6127dfae720b7514353f94daf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-OpsT9P5x85_xZ_PzHa-PA.png"/></div></div></figure><p id="1daf" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">为了演示起见——我使用了一个使用python请求库的简单Livy调用——来调用一个名为<strong class="jf hj"> dailyreportanalysis.py </strong>的预定义应用程序</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es ls"><img src="../Images/9ba89b78c8515f277a2b63a2d4b6de98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e9shnNCd_WTzK0u7Br4gqw.png"/></div></div></figure><pre class="kp kq kr ks fd lt lu lv lw aw lx bi"><span id="551a" class="ly ig hi lu b fi lz ma l mb mc">import sys<br/>import requests<br/>def main(dict):<br/>    url = '<a class="ae kg" href="https://chs-eps-549-mn001.us-south.ae.appdomain.cloud:8443/gateway/default/livy/v1/batches'" rel="noopener ugc nofollow" target="_blank">https://chs-mmm-007-mn001.us-south.ae.appdomain.cloud:8443/gateway/default/livy/v1/batches'</a><br/>    data = '{ "file":"/user/clsadmin/dailyreportanalysis.py"}'<br/>    resp = requests.post(url, data, auth=('clsadmin','password'),headers={"Content-Type": "application/json","X-Requested-By": "livy"})<br/>    print(resp)<br/>    return { 'message': resp.status_code }</span></pre><p id="03c8" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">我创建的操作如下所示。</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es md"><img src="../Images/07450dd3e5b7bf85a4020b1f652ae544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VmKZ0GjVhqo28gp5YeAmNg.png"/></div></div></figure><h1 id="6e8a" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">步骤3:上传数据以触发操作</h1><p id="31e8" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">再次出于演示的目的，我使用云对象存储的控制台界面来上传需要分析的数据</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es me"><img src="../Images/790e397d364b830d6445dac2edfe1815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hklqk1njFrBt1OpYV-cH9Q.png"/></div></div></figure><p id="955a" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这导致应用程序被自动调用，您可以从分析引擎集群的Ambari UI中看到这一点。</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mf"><img src="../Images/4cd4d6efb10439f5b381fafedac9929a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hXJQiJ3dprFNnNLOUK7u4A.png"/></div></div></figure><h1 id="8828" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">结论</h1><p id="98ab" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">IBM Cloud functions是一个强大的工具，可用于将跨多个服务的处理流程缝合在一起。在这里，为了演示的目的，我们只触及了表面。</p><p id="c3d0" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">如果不是为了函数？同样的事情也可以通过外部和内部的工作流工具来实现(比如Oozie)。然而，这需要更多的设置、代码和配置。我花了不到一个小时的时间为这个特别的演示创建步骤。</p><p id="7980" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">围绕<a class="ae kg" href="https://cloud.ibm.com/" rel="noopener ugc nofollow" target="_blank"> IBM Cloud </a>快乐探索！</p><p id="26cd" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这篇文章是与IBM云和认知软件服务顾问<a class="ae kg" href="https://www.linkedin.com/in/daniel-lopez-sainz-6114998/" rel="noopener ugc nofollow" target="_blank">丹尼尔·洛佩斯·赛恩斯</a>合著的。</p></div></div>    
</body>
</html>