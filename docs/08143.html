<html>
<head>
<title>Deploying Yolo on Tensorflow Serving: Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Tensorflow服务器上部署Yolo:第1部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploying-yolo-on-tensorflow-serving-part-1-4586f97f0dd9?source=collection_archive---------11-----------------------#2020-07-19">https://medium.com/analytics-vidhya/deploying-yolo-on-tensorflow-serving-part-1-4586f97f0dd9?source=collection_archive---------11-----------------------#2020-07-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/37b02794d2a2d7276cf5527ed85ba761.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*q2SZIL06g5ydAGUG1iHSzA.png"/></div></div></figure><p id="b9ed" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">我是如何开始Tensorflow服务的。</strong></p><p id="5745" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我是一名<a class="ae jo" href="https://www.linkedin.com/in/gaurav-gola96/" rel="noopener ugc nofollow" target="_blank">机器学习工程师</a>，我一直在开发一系列机器学习产品，如<a class="ae jo" href="https://play.google.com/store/apps/details?id=com.fynd.ficto&amp;hl=en" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">Android</strong></a><strong class="is hj">和web上的<a class="ae jo" href="http://glamar.io" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">虚拟化妆</strong> </a> <strong class="is hj">，</strong> <a class="ae jo" href="http://witi.fynd.com" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">图像属性分类</strong> </a> <strong class="is hj">，机器翻译，移动设备的实时DL模型优化，以及与Kubernetes的部署管道设置等</strong>。创建这些模型只是我的问题的一部分，我的下一个挑战是在生产中服务这些模型。模型服务系统应该能够承受大流量。</strong></p><p id="6773" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">任何系统的关键要求:</p><ul class=""><li id="fd1c" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">水平可扩展性</li><li id="852c" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">与TensorFlow新版本兼容</li><li id="c2b1" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">预测时的低延迟</li></ul><p id="c727" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">小概述:Tensorflow发球</strong></p><p id="d023" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Tensorflow Serving是用C++写的，支持机器学习模型的服务。现成的Tensorflow服务安装支持:</p><ul class=""><li id="8fea" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">张量流模型的服务</li><li id="c56d" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">从本地文件系统扫描和加载张量流模型</li></ul><p id="93a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">TensorFlow服务将每个模型视为可服务的对象。它定期扫描本地文件系统，根据文件系统的状态和模型版本化策略加载和卸载模型。这允许在Tensorflow服务继续运行的同时，通过将导出的模型复制到指定的文件路径来轻松热部署已训练的模型。</p><p id="97b2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">为什么YOLOv2 </strong></p><p id="05d9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一个显而易见的原因是我一直在研究它😅。对于Yolov2，也没有适当的教程介绍如何导出TF服务的模型以及TF服务输出结果的后处理，如果你不熟悉yolov2算法，这有一点小技巧。我在一年前的<a class="ae jo" href="https://github.com/thtrieu/darkflow/issues/824" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">部署了这个模型</strong>，</a>部署包括导出模型用于TF服务，并写下<strong class="is hj">后处理脚本</strong>，这是更棘手的部分。</p><p id="638f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">本地机器设置</strong></p><p id="590d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在研究机器学习的许多用例时，我遇到了一个问题，我必须训练一个<a class="ae jo" href="https://github.com/thtrieu/darkflow" rel="noopener ugc nofollow" target="_blank"><strong class="is hj"/><strong class="is hj">yolov 2</strong></a>并将其部署到TensorFlow服务上。在这篇博客中，我将讲述如何在Tensorflow服务器上部署Yolov2。</p><p id="5ebe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要在本地机器上设置TensorFlow服务，只需按照TensorFlow <a class="ae jo" href="https://www.tensorflow.org/tfx/serving/setup" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">安装</strong> </a>设置即可，非常简单。为了训练你自己的yolov2，你可以跟随<a class="ae jo" href="https://github.com/thtrieu/darkflow/blob/master/README.md" rel="noopener ugc nofollow" target="_blank"> Github repo </a>。</p><p id="ac40" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">保存您的模型</strong></p><p id="8fd2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要将我们训练的模型加载到TensorFlow服务中，我们首先需要将其保存为<a class="ae jo" href="https://www.tensorflow.org/versions/r1.15/api_docs/python/tf/saved_model" rel="noopener ugc nofollow" target="_blank"> SavedModel </a>格式。这将在一个定义明确的目录层次结构中创建一个protobuf文件，并将包含一个版本号。<a class="ae jo" href="https://www.tensorflow.org/tfx/guide/serving" rel="noopener ugc nofollow" target="_blank"> TensorFlow Serving </a>允许我们选择模型的哪个版本，或者当我们做出推理请求时我们想要使用的“可服务的”。每个版本将被导出到给定路径下的不同子目录中。</p><p id="840f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是将yolov2模型导出为TF服务格式的脚本</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="87de" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">检查您保存的模型</strong></p><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es kj"><img src="../Images/c0ceb08209ddbcec6a95d2bd6f7fe15e.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*aye3kV-v0uBDpwCC3ilITg.png"/></div><figcaption class="kk kl et er es km kn bd b be z dx translated">导出的模型目录结构</figcaption></figure><p id="37cc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">命令行实用程序<code class="du ko kp kq kr b">saved_model_cli</code>查看我们的SavedModel中的<a class="ae jo" href="https://www.tensorflow.org/versions/r1.15/api_docs/python/tf/MetaGraphDef" rel="noopener ugc nofollow" target="_blank">元图定义</a>(模型)和<a class="ae jo" href="https://www.tensorflow.org/tfx/tutorials/signature_defs" rel="noopener ugc nofollow" target="_blank">签名定义</a>(可以调用的方法)。</p><pre class="kd ke kf kg fd ks kr kt ku aw kv bi"><span id="b402" class="kw kx hi kr b fi ky kz l la lb">export export_path=./export/1<br/>saved_model_cli show --dir $export_path --all</span></pre><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/0e3e65828102f9b79701c45680f03390.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*5c36GHDfahiRkT5v-KuFyw.png"/></div><figcaption class="kk kl et er es km kn bd b be z dx translated">保存的模型输入/输出形状</figcaption></figure><p id="d10c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">启动本地服务器:</strong></p><p id="4eb3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建TensorFlow服务配置，您可以在其中添加模型及其各自基础的列表。</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="0d41" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用以下命令在特定端口上启动您的服务器</p><pre class="kd ke kf kg fd ks kr kt ku aw kv bi"><span id="43aa" class="kw kx hi kr b fi ky kz l la lb">tensorflow_model_server --model_config_file=/home/gaurav/tensorflow_serving_model_config_file --port=9000</span></pre><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ld"><img src="../Images/513796156e7a4b9c93ec19ca921b742d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_zSKZ7HH97EP5Rr-ZaSYkg.png"/></div></div><figcaption class="kk kl et er es km kn bd b be z dx translated">9000端口上版本1的服务模型</figcaption></figure><p id="5804" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">结论</strong></p><p id="eeb3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这一部分中，我们介绍了如何将保存的微型yolov2模型导出为Tensorflow服务格式，检查您的模型，并在本地启动服务器。<strong class="is hj">如果你分析<em class="le">检查你保存的模型</em>部分，你会发现输出是张量的一种形式，尽管你需要一个类名称，就像我们在分类模型中得到的一样</strong>。这将在后处理你的输出张量post TF服务的下一部分中涉及，并在本博客的<a class="ae jo" rel="noopener" href="/@gauravgola/deploying-yolo-on-tensorflow-serving-part-2-4ecd5edbe776"> <strong class="is hj">第二部分</strong> </a>中围绕服务的模型创建一个小API。</p><blockquote class="lf lg lh"><p id="84b2" class="iq ir le is b it iu iv iw ix iy iz ja li jc jd je lj jg jh ji lk jk jl jm jn hb bi translated">在<a class="ae jo" href="https://www.linkedin.com/in/gaurav-gola96/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> Linkedin </strong> </a> <strong class="is hj">和</strong><a class="ae jo" href="https://www.youtube.com/channel/UC3zK1Iuw2Rufxu8TKeyj4GQ" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">Youtube</strong></a><strong class="is hj">上和我连线。</strong></p><p id="0993" class="iq ir le is b it iu iv iw ix iy iz ja li jc jd je lj jg jh ji lk jk jl jm jn hb bi translated">本项目github:<a class="ae jo" href="https://github.com/gauravgola96/Yolo_deployment" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">链接</strong> </a></p></blockquote></div></div>    
</body>
</html>