<html>
<head>
<title>Calculator chatbot using Django and Dialogflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Django和Dialogflow的计算器聊天机器人</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/calculator-chatbot-dialo-e9f8e08d07af?source=collection_archive---------3-----------------------#2020-06-27">https://medium.com/analytics-vidhya/calculator-chatbot-dialo-e9f8e08d07af?source=collection_archive---------3-----------------------#2020-06-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6391a3c69231ef03e06c0181e486cf0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aabQlCgcrkwwQRyKg0tHaA.jpeg"/></div></div></figure><p id="6a2d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">希望你们都已经使用谷歌对话流聊天机器人只是为了在前端互动。但在这里，我想解释一下如何使用webhook概念创建一个交互式聊天机器人。Webhooks是当有事情发生时，应用程序自动发送的消息。在这里，我创建了一个简单的计算器聊天机器人，它识别用户想要执行的算术运算，并产生相同的结果。</p><p id="1cdf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们继续下一步之前，你需要准备好以下东西:</p><ul class=""><li id="6876" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">计算机编程语言</li><li id="23e0" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">Django框架——处理webhook的Python web框架</li><li id="983a" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated"><a class="ae kc" href="https://ngrok.com/" rel="noopener ugc nofollow" target="_blank"> Ngrok </a> —全球访问您的本地主机</li><li id="0f59" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">谷歌<a class="ae kc" href="https://cloud.google.com/dialogflow/docs/" rel="noopener ugc nofollow" target="_blank">对话流</a></li></ul><p id="2fb7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">在对话流中创建设置:</strong></p><ul class=""><li id="4470" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">在Google dialogflow中创建名为<strong class="is hj"> operations </strong>的实体</li><li id="4678" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">参考下面我为运营实体创建的截图，</li></ul><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/76979b6804d7c7b57a1c4de1849aad6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U1IhKyzRQucS2j-cI5wLVg.png"/></div></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">下面是参考文献及其相应同义词的列表</figcaption></figure><p id="8538" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们创建聊天机器人的意图。因为我要做4种算术运算，所以我创建了4种不同的意图。</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es km"><img src="../Images/2723325ec1b85bec49b670619b1263d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3RnHfi8MyGAy14Yixl6PWg.png"/></div></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">意向列表</figcaption></figure><p id="02fa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">培训意图:</p><p id="9d65" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在是时候给我们已经创造的意图提供训练短语了。下面我已经给出了我已经给出的训练短语的例子。以类似的方式给出所有其他意图的训练短语。确保给出尽可能多的训练短语，因为这将有助于对话流轻松了解用户的意图。添加训练短语后，务必保存它。</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div class="er es kn"><img src="../Images/3639aaa8a749afd23a72abfeef8a60a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*TH4G9stDdxn-Kl-YH7RhEQ.png"/></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">训练短语</figcaption></figure><p id="908f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请确保将培训短语与实体操作和编号对应起来，如下所示。</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div class="er es ko"><img src="../Images/b801a780a7330a7e6426c3391871bb08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*UNAgmiQkMXyv5hB-8-rVgQ.png"/></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">Add是我们定义的操作实体，numbers是内置实体。</figcaption></figure><p id="ff66" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">动作和参数:</strong></p><p id="5a92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了获得用户正在寻找的操作，我们需要定义动作。此外，为了获得我们需要执行的数字和操作，我们需要通过选择required复选框来强制执行数字和操作。选择提示，并添加您想问用户的问题，以防未提供所需的详细信息。</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kp"><img src="../Images/287975330f4cf75a92a75fcfd42cc6ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*vWmzJZDp-OqabMJVssh-Og.png"/></div></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">动作需要定义为加法</figcaption></figure><p id="3b0e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面的屏幕截图定义了如果用户错过了一个数字，机器人将询问的提示:</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kq"><img src="../Images/dd47ce7650b20c56ad8057df46f460f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EXnMrfXBSDxFuZGr7CBWjw.png"/></div></div></figure><p id="e9ee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在启用位于意图末尾的webhook按钮，</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/85508dde6e1824ccda9b2cd9b239d80d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*Pq8XvgvWNDgU4Rw0L77wUg.png"/></div></div></figure><p id="96ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以同样的方式对我们已经定义的其他三个意图(减法、乘法和除法)做同样的事情。</p><p id="2756" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">制作Django框架设置:</p><p id="50bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在Django框架中创建项目，并创建一个名为算术的应用程序。</p><pre class="ke kf kg kh fd ks kt ku kv aw kw bi"><span id="5bcd" class="kx ky hi kt b fi kz la l lb lc">django-admin startproject calculator_chatbot<br/>python manage.py startapp arithmetic</span></pre><p id="a15f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建应用程序后，请确保将其添加到settings.py的已安装应用程序中</p><pre class="ke kf kg kh fd ks kt ku kv aw kw bi"><span id="8448" class="kx ky hi kt b fi kz la l lb lc">INSTALLED_APPS = [<br/>    'django.contrib.admin',<br/>    'django.contrib.auth',<br/>    'django.contrib.contenttypes',<br/>    'django.contrib.sessions',<br/>    'django.contrib.messages',<br/>    'django.contrib.staticfiles',<br/>    '<strong class="kt hj">arithmetic</strong>',<br/>]</span></pre><p id="153c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要运行服务器，请使用下面的命令，</p><pre class="ke kf kg kh fd ks kt ku kv aw kw bi"><span id="d0a8" class="kx ky hi kt b fi kz la l lb lc">python manage.py runserver</span></pre><p id="886b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，让我们通过在calculator_chatbot文件夹的urls.py中添加以下代码来为我们新创建的应用程序创建url，如下所示:</p><pre class="ke kf kg kh fd ks kt ku kv aw kw bi"><span id="c998" class="kx ky hi kt b fi kz la l lb lc">from django.contrib import admin<br/>from django.urls import path, include<br/>from arithmetic import views</span><span id="5b56" class="kx ky hi kt b fi ld la l lb lc">urlpatterns = [<br/>    path('admin/', admin.site.urls),<br/>    path('arithmetic/', include('arithmetic.urls')),<br/>]</span></pre><p id="3876" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了访问算术应用程序中的网页，在算术应用程序文件夹中创建一个urls.py文件，并在其中添加以下代码。</p><figure class="ke kf kg kh fd ij"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="c704" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们在views.py中创建它们相应的视图，</p><figure class="ke kf kg kh fd ij"><div class="bz dy l di"><div class="le lf l"/></div></figure><figure class="ke kf kg kh fd ij er es paragraph-image"><div class="er es lg"><img src="../Images/baec86729763d662c8eb1f9ae80284d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:370/format:webp/1*7a26yk5mu89eGGKys7EmOA.png"/></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">文件夹将如上所示可见</figcaption></figure><blockquote class="lh li lj"><p id="39dd" class="iq ir lk is b it iu iv iw ix iy iz ja ll jc jd je lm jg jh ji ln jk jl jm jn hb bi translated">在app文件夹(算术)中创建一个名为templates的文件夹，在其中创建另一个名为算术的子文件夹，并在其中创建home.html来检查Django框架。<strong class="is hj">注意:这只是为了测试框架url是否工作正常。</strong></p></blockquote><p id="fbe2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">让本地主机在全球可用:</strong></p><p id="2775" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在确保运行Django服务器，并从互联网上下载ngrok。安装ngrok后，使用命令提示符进入文件夹，并键入以下命令来运行应用程序。</p><pre class="ke kf kg kh fd ks kt ku kv aw kw bi"><span id="de32" class="kx ky hi kt b fi kz la l lb lc">ngrok http 8000</span></pre><figure class="ke kf kg kh fd ij er es paragraph-image"><div class="er es lo"><img src="../Images/6eaa6aed0272d3e322244f63c385967b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*CndlfRXF6vnjDQZw_FsC8w.png"/></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">运行该命令后，它将看起来像在图像中</figcaption></figure><p id="4aad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在复制转发url和本地主机url，粘贴到settings.py的Allowed_host中如下，</p><pre class="ke kf kg kh fd ks kt ku kv aw kw bi"><span id="1bda" class="kx ky hi kt b fi kz la l lb lc">ALLOWED_HOSTS = ['127.0.0.1',<br/>'78173a906130.ngrok.io'<br/>]</span></pre><p id="179d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">同样的方法在启用后将url粘贴到dialogflow fulfillment窗口的webhook中，并且不要忘记保存它，</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/cbfcd20adc336da393b8c963f8ed7214.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Arwp6iw3IsLgAkatC2Hdw.png"/></div></div></figure><p id="2f44" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">确保在url的末尾添加/算术/webhook。也能实现所有的意图。</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/e7f18f76088d1f9ef41b48f32e305c43.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*c9zPwsQlTPnWnkyyRrsMQw.png"/></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">最终聊天机器人</figcaption></figure><p id="746f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在是使用聊天机器人的时候了。当你给出训练短语时，聊天机器人会识别你的意图并得到号码。然后，它将通过webhook将其传递给本地主机，并获得实现响应。</p><p id="77d2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">是啊！我们做到了。如果您仍然面临任何问题，请从git资源库— <a class="ae kc" href="https://github.com/Siddhu2/calculator-chatbot" rel="noopener ugc nofollow" target="_blank"> GIT </a>下载我的代码。快乐编码:-)</p></div></div>    
</body>
</html>