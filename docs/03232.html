<html>
<head>
<title>Face Recognition and Micro Expressions with OpenCV and AWS Rekognition</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于OpenCV和AWS的人脸识别和微表情识别</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/face-recognition-and-microespressions-with-opencv-and-aws-rekognition-2ea2bc83f7da?source=collection_archive---------14-----------------------#2020-01-21">https://medium.com/analytics-vidhya/face-recognition-and-microespressions-with-opencv-and-aws-rekognition-2ea2bc83f7da?source=collection_archive---------14-----------------------#2020-01-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="22ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在一辆公交车上，因为一场车祸，有很多交通堵塞，所以我在这里编码的东西。编码什么？我在练习一些机器学习，我想记下我正在做的事情，这是第一个演示，你肯定可以在网上找到，但我的更酷:-P</p><p id="322d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，让我们用OpenCV做一些Python，看看如何进行。为了理解人脸识别是如何工作的，了解一些关于Haar Cascade的知识可能会很方便。从小波到级联，整个哈尔理论非常有趣。顺便说一句，谁对Haar Cascade感兴趣<a class="ae jd" href="http://www.willberger.org/cascade-haar-explained/" rel="noopener ugc nofollow" target="_blank">这里有一篇有趣的文章</a>。</p><p id="c261" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们现在按一些键盘按钮。</p><p id="d7d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先确保你已经安装了<em class="je"> python3 </em>确保你已经安装了<em class="je"> opencv-python </em> libs和…到目前为止一切顺利。</p><p id="b7eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好吧，试试这段代码</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="51bd" class="jo jp hi jk b fi jq jr l js jt"><strong class="jk hj">import</strong> cv2</span><span id="ae40" class="jo jp hi jk b fi ju jr l js jt">cap = cv2.VideoCapture(0)<br/>face_cascade = cv2.CascadeClassifier('haar/haarcascade_frontalface_default.xml')</span><span id="b672" class="jo jp hi jk b fi ju jr l js jt"><strong class="jk hj">while</strong>(True):</span><span id="2d77" class="jo jp hi jk b fi ju jr l js jt">   ret, frame = cap.read()<br/>   gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)<br/>   faces = face_cascade.detectMultiScale(gray, 1.3, 5)<br/>   <strong class="jk hj">for</strong> (x,y,w,h) <strong class="jk hj">in</strong> faces:<br/>      cv2.rectangle(frame,(x,y),(x+w,y+h),(255,0,0),2)</span><span id="9230" class="jo jp hi jk b fi ju jr l js jt">   cv2.imshow('B&amp;W',gray)<br/>   cv2.imshow('Color',frame)</span><span id="1ffd" class="jo jp hi jk b fi ju jr l js jt">   <strong class="jk hj">if</strong> cv2.waitKey(1) &amp; 0xFF == ord('q'):<br/>      <strong class="jk hj">break</strong></span></pre><p id="af40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这应该足以让你的脸被认出来，你可以在这里找到哈尔瀑布<a class="ae jd" href="https://raw.githubusercontent.com/opencv/opencv/master/data/haarcascades/haarcascade_frontalface_default.xml" rel="noopener ugc nofollow" target="_blank"/>。魔法是由函数<em class="je"> detectMultiScale </em>完成的，如果你想了解更多，请参考<a class="ae jd" href="https://docs.opencv.org/2.4/modules/objdetect/doc/cascade_classification.html#cascadeclassifier-detectmultiscale" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="2791" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太棒了，不是吗？好了，现在安装一些其他的包……事实上我想你只需要另外一个包，这就是<em class="je"> boto3。</em>还有boto3是什么？嗯…</p><blockquote class="jv jw jx"><p id="9c03" class="if ig je ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated">Boto是Python的Amazon Web Services (AWS) SDK。它使Python开发人员能够创建、配置和管理AWS服务，如EC2和S3。Boto提供了一个易于使用的、面向对象的API，以及对AWS服务的底层访问。</p></blockquote><p id="c50f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那就装吧！</p><p id="bc25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗯，也许你知道，你应该有一个AWS帐户，通过使用高亚马逊巫术执行其他类型的魔法。如果你想创造它，看看条件就知道了，因为每样东西都有价格。</p><p id="83b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我想用AWS巫术分析面部微表情，我推荐使用<a class="ae jd" href="https://aws.amazon.com/rekognition/" rel="noopener ugc nofollow" target="_blank"> <em class="je">识别</em> </a>服务:</p><blockquote class="jv jw jx"><p id="e1e8" class="if ig je ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated">Amazon Rekognition使用成熟的、高度可扩展的深度学习技术，无需使用机器学习专业知识，就可以轻松地将图像和视频分析添加到您的应用程序中。</p></blockquote><p id="710f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们介绍这个函数和连接到AWS的客户机:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="f9cd" class="jo jp hi jk b fi jq jr l js jt">rekog = boto3.client('rekognition',<br/>                        region_name='eu-central-1',<br/>                        aws_access_key_id='BlaBla',<br/>                        aws_secret_access_key='BlaBlaXYZ'<br/>                    )</span><span id="3329" class="jo jp hi jk b fi ju jr l js jt"><strong class="jk hj">def</strong> send_to_rekognition(img, boto_client):<br/>    cv2.imwrite('/tmp/face_recog.jpg', img)<br/>    <strong class="jk hj">with</strong> open("/tmp/face_recog.jpg", "rb") as imageFile:<br/>        f = imageFile.read()<br/>        buf = bytearray(f)</span><span id="3ef7" class="jo jp hi jk b fi ju jr l js jt">    response = boto_client.detect_faces(<br/>        Image={<br/>            'Bytes': buf<br/>        },<br/>        Attributes=['ALL']<br/>    )<br/>    data = response["FaceDetails"]<br/>    <strong class="jk hj">for</strong> d <strong class="jk hj">in</strong> data:<br/>        <strong class="jk hj">print</strong>(d['Gender'])<br/>        <strong class="jk hj">for</strong> e <strong class="jk hj">in</strong> d['Emotions']:<br/>            <strong class="jk hj">print</strong>(e)</span></pre><p id="c8c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好吧，好吧，我知道这不是一个超级代码，但只是让你知道它是如何工作的。现在好些了吗？</p><p id="b90f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后主要部分会变成这样:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="089a" class="jo jp hi jk b fi jq jr l js jt">cap = cv2.VideoCapture(0)<br/>face_cascade = cv2.CascadeClassifier('haar/haarcascade_frontalface_default.xml')<br/><strong class="jk hj">while</strong>(<strong class="jk hj">True</strong>):<br/>    # Capture frame-by-frame<br/>    ret, frame = cap.read()</span><span id="099c" class="jo jp hi jk b fi ju jr l js jt"># Our operations on the frame come here</span><span id="186f" class="jo jp hi jk b fi ju jr l js jt">    gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)<br/>    faces = face_cascade.detectMultiScale(gray, 1.3, 5)<br/>    <strong class="jk hj">for</strong> (x,y,w,h) <strong class="jk hj">in</strong> faces:<br/>        cv2.rectangle(frame,(x,y),(x+w,y+h),(255,0,0),2)<br/>        roi_gray = gray[y:y+h, x:x+w]<br/>        roi_color = frame[y:y+h, x:x+w]<br/>        <strong class="jk hj">if</strong> cv2.waitKey(1) &amp; 0xFF == ord('a'):<br/>            send_to_rekognition(frame,rekog)<br/>    # Display the resulting frame<br/>    cv2.imshow('B&amp;W',gray)<br/>    cv2.imshow('Color',frame)<br/>    <strong class="jk hj">if</strong> cv2.waitKey(1) &amp; 0xFF == ord('q'):<br/>        <strong class="jk hj">break</strong></span><span id="c5be" class="jo jp hi jk b fi ju jr l js jt"># When everything done, release the capture<br/>cap.release()<br/>cv2.destroyAllWindows()</span></pre><p id="8452" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当这段代码运行时</p><figure class="jf jg jh ji fd kc er es paragraph-image"><div class="er es kb"><img src="../Images/484adf7a3cb3e761664d4a4a3de49358.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*gRvyjWnLysWjFC9GHSBQpw.jpeg"/></div></figure><p id="e885" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你的脸被认出来了只要按“a”，</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="85e4" class="jo jp hi jk b fi jq jr l js jt">{'Value': 'Male', 'Confidence': 99.81909942626953}<br/>{'Type': 'SURPRISED', 'Confidence': 0.0363442562520504}<br/>{'Type': 'CALM', 'Confidence': 86.3555679321289}<br/>{'Type': 'DISGUSTED', 'Confidence': 0.03421016037464142}<br/>{'Type': 'FEAR', 'Confidence': 0.020691828802227974}<br/>{'Type': 'ANGRY', 'Confidence': 1.0062201023101807}<br/>{'Type': 'SAD', 'Confidence': 10.729506492614746}<br/>{'Type': 'HAPPY', 'Confidence': 0.04961089417338371}<br/>{'Type': 'CONFUSED', 'Confidence': 1.7678450345993042}</span></pre><p id="c02d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以上是你将得到的！那么你能用这些数据做什么呢？事实上，这些数据是关于对微表情的研究。</p><blockquote class="jv jw jx"><p id="a598" class="if ig je ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated">微表情是瞬间发生的面部表情。这种不自觉的情绪泄露暴露了一个人的真实情绪。</p></blockquote><p id="9aba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们想象一下，你正处于这样一种情况，对感情的理解对决定是否雇佣某人做一份理想的工作、在一份亿万富翁的合同上签字、批准一笔豪华地产的贷款、理解一些谎言是否明显等等都是至关重要的</p><p id="9d57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对微表情的研究可以决定是做一笔好交易还是有一个关键的欺骗，它可以帮助了解谁信任谁，了解微表情有助于我们识别欺骗和了解一个人的真实心理状态。用人眼识别微表情是一项极其困难的任务，但通过机器学习，这可以实时完成，延迟可以忽略不计，结果非常可信。</p></div></div>    
</body>
</html>