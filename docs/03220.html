<html>
<head>
<title>Deploying a Shiny Flexdashboard with Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Docker部署闪亮的Flexdashboard</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploying-a-shiny-flexdashboard-with-docker-cca338a10d12?source=collection_archive---------2-----------------------#2020-01-21">https://medium.com/analytics-vidhya/deploying-a-shiny-flexdashboard-with-docker-cca338a10d12?source=collection_archive---------2-----------------------#2020-01-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="3b79" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">漂亮仪表板的稳健部署。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/240d822f0e6b283e9b40a31389bffdb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DtD0j_tL_QwNpmCtZ3Rs0g.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">Flexdashboard示例。从<a class="ae jn" href="https://walkerke.shinyapps.io/neighborhood_diversity/" rel="noopener ugc nofollow" target="_blank"> shinyapps.io </a></figcaption></figure><p id="dba2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="kk">这是关于微服务数据报告的系列文章的第二部分。要构建这个仪表盘，请参见第一部分，</em> <a class="ae jn" rel="noopener" href="/analytics-vidhya/shiny-dashboards-with-flexdashboard-e66aaafac1f2"> <strong class="jq hj"> <em class="kk">闪亮仪表盘与Flexdashboard </em> </strong> </a> <em class="kk">。关于使用闪亮的代理服务器在生产中大规模部署仪表板，请参见第三部分。</em></p><p id="8959" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="kk">这篇文章也发表在</em><a class="ae jn" href="https://www.r-bloggers.com/" rel="noopener ugc nofollow" target="_blank"><em class="kk">https://www.r-bloggers.com/</em></a><em class="kk">上。</em></p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><p id="7b3b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi ks translated"><span class="l kt ku kv bm kw kx ky kz la di">D</span>ashboard是一种快速、清晰、一致地提供数据洞察的绝佳方式。除了设计美观和有用的仪表板，一个主要的挑战是部署。在大多数业务中，除了数据分析师和各种技术之外，还有几个人参与其中。这导致了缓慢的部署过程和耗时的依赖性管理。在本文中，我们将学习如何使用Docker将以前的<a class="ae jn" rel="noopener" href="/analytics-vidhya/shiny-dashboards-with-flexdashboard-e66aaafac1f2">build</a><a class="ae jn" href="https://timosch.shinyapps.io/dashboard_example/" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj">R flex dashboard</strong></a><strong class="jq hj">封装成一个更易于复制、部署、扩展和管理的web应用程序。</strong></p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h1 id="f55e" class="lb lc hi bd ld le lf lg lh li lj lk ll io lm ip ln ir lo is lp iu lq iv lr ls bi translated">为什么是Docker？</h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lt"><img src="../Images/188e98775bc1a45257bce8698c2dc43a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*VIfwIv89V0zesAgLvT6ExQ.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><a class="ae jn" href="https://ertan-toker.de/docker-container-mongodb/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="9d4b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><a class="ae jn" href="https://www.docker.com/why-docker" rel="noopener ugc nofollow" target="_blank"> Docker </a>是目前发展最快的开源技术之一。Docker容器是运行应用程序的沙箱环境。不是模拟整个机器，而是只模拟一个Linux OS plus库。这种容器比虚拟机更轻量级，运行容器化的应用程序有很多优点。只使用分配给容器的资源，应用程序的环境总是相同的，不管它部署在哪个主机上。这使得Docker成为许多公司部署可复制的安全应用程序的首选工具。如果一个应用程序在一个容器中独立运行，并定义了与其他容器和主机的连接，那么它的管理和调试效率会更高。此外，由于减少了依赖性问题，软件安装速度更快，并且易于扩展。此外，标准化的构建、测试和部署环境支持软件开发的快速和健壮的CI/CD周期。各种服务和应用可以通过容器编排工具进行管理和负载平衡，例如<a class="ae jn" href="https://docs.docker.com/engine/swarm/key-concepts/" rel="noopener ugc nofollow" target="_blank"> Docker Swarm </a>或<a class="ae jn" href="https://kubernetes.io/de/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>。</p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h1 id="2895" class="lb lc hi bd ld le lf lg lh li lj lk ll io lm ip ln ir lo is lp iu lq iv lr ls bi translated">构建Docker容器</h1><h2 id="34f9" class="lu lc hi bd ld lv lw lx lh ly lz ma ll jx mb mc ln kb md me lp kf mf mg lr mh bi translated">开始</h2><p id="73a9" class="pw-post-body-paragraph jo jp hi jq b jr mi ij jt ju mj im jw jx mk jz ka kb ml kd ke kf mm kh ki kj hb bi translated">容器是由Dockerfile文件中的指令定义的映像构建的。对于每条指令，构建一个中间映像，并将其用作基础映像。在<a class="ae jn" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"> Dockerhub </a>上已经有很多现成的图片可供下载。你也可以用这些图片作为你自己图片的基础。在<a class="ae jn" href="https://docs.docker.com/install/" rel="noopener ugc nofollow" target="_blank">为您的主机系统安装Docker </a>后，您可以通过终端中的<code class="du mn mo mp mq b">docker pull</code>下载公共图像。我们将在Open Analytics<a class="ae jn" href="https://hub.docker.com/r/openanalytics/r-shiny" rel="noopener ugc nofollow" target="_blank">R Shiny image</a>的基础上构建Shiny Flexdashboard的容器。这个映像包含基本的R、必要的linux库以及Shiny和Rmarkdown R包。你可以在GitHub 上看到他们<a class="ae jn" href="https://github.com/openanalytics/r-shiny/blob/master/Dockerfile" rel="noopener ugc nofollow" target="_blank">对应的Dockerfile。您可以通过<code class="du mn mo mp mq b">docker pull openanalytics/r-shiny</code>下载图像。</a></p><h2 id="32be" class="lu lc hi bd ld lv lw lx lh ly lz ma ll jx mb mc ln kb md me lp kf mf mg lr mh bi translated">文档文件</h2><p id="69cb" class="pw-post-body-paragraph jo jp hi jq b jr mi ij jt ju mj im jw jx mk jz ka kb ml kd ke kf mm kh ki kj hb bi translated">你可以在我的<a class="ae jn" href="https://github.com/timosch29/Dockerized-Shiny-Proxy-Server/tree/master/example_dashboard" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj"> GitHub repo </strong> </a>中查看这个docker文件和闪亮Flexdashboard的文件。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="0ecd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Dockerfile文件指定了映像是如何构建的以及以什么顺序构建的。<code class="du mn mo mp mq b">FROM openanalytics/r-shiny</code>指定基本容器图像，后面的说明用注释解释。您可以在<a class="ae jn" href="https://docs.docker.com/engine/reference/builder/" rel="noopener ugc nofollow" target="_blank"> Docker文档</a>或本<a class="ae jn" href="https://kapeli.com/cheat_sheets/Dockerfile.docset/Contents/Resources/Documents/index" rel="noopener ugc nofollow" target="_blank">备忘单</a>上获得Docker文件说明的概述。如果您没有Flexdashboard Rmd文件，并且想要部署一个闪亮的应用程序，那么您必须在最后修改<code class="du mn mo mp mq b">CMD</code>指令，就像<a class="ae jn" href="https://github.com/TelethonKids/deploy_shiny_app/blob/master/webapp/Dockerfile" rel="noopener ugc nofollow" target="_blank">这个</a>或者在这篇<a class="ae jn" rel="noopener" href="/@suomynonascitylana/getting-started-with-docker-to-do-data-science-and-deploy-a-shiny-app-46803f8a0a69">中型文章</a>中描述的那样。</p><h2 id="9484" class="lu lc hi bd ld lv lw lx lh ly lz ma ll jx mb mc ln kb md me lp kf mf mg lr mh bi translated">建立形象</h2><p id="59bb" class="pw-post-body-paragraph jo jp hi jq b jr mi ij jt ju mj im jw jx mk jz ka kb ml kd ke kf mm kh ki kj hb bi translated">使用命令<code class="du mn mo mp mq b">docker build</code>从Dockerfile文件构建一个映像。如果你已经克隆了我的GitHub repo，在Dockerfile <code class="du mn mo mp mq b"><strong class="jq hj">docker build -t example_dashboard .</strong></code>的目录下运行下面的命令，这将从Dockerfile构建镜像并将其命名为<em class="kk"> example_dashboard </em>。第一次下载和安装依赖项时，构建过程将运行几分钟。好的一面是，一旦您完成了一个步骤，它就会被缓存，当您更改Docker文件中的其他步骤时，您不必完全运行它，或者您甚至可以对另一个Docker映像使用相同的缓存步骤。您可以使用<code class="du mn mo mp mq b">docker image ls</code>查看主机上所有可用的图像。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mt"><img src="../Images/96476a5e851a08ce00c96efbaebbe91b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ULW0lVbjph6SMEwwMpUwIg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">码头形象建筑的终端输出</figcaption></figure><h2 id="4d78" class="lu lc hi bd ld lv lw lx lh ly lz ma ll jx mb mc ln kb md me lp kf mf mg lr mh bi translated">运行容器</h2><p id="370f" class="pw-post-body-paragraph jo jp hi jq b jr mi ij jt ju mj im jw jx mk jz ka kb ml kd ke kf mm kh ki kj hb bi translated">使用命令<code class="du mn mo mp mq b">docker create</code>从图像制作容器，并使用带有图像名称的命令<code class="du mn mo mp mq b">docker start</code>启动容器。方便的是，有一个命令将两者结合成一个，我们将在这里使用，<code class="du mn mo mp mq b">docker run</code>。如果在您的主机上找不到图像名称，该命令甚至会尝试从<a class="ae jn" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker Hub </a>中提取图像。</p><p id="9bed" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们用<code class="du mn mo mp mq b"><strong class="jq hj">docker run --name=example_dashboard_container --rm -p 3838:3838 example_dashboard</strong></code>旋转容器。这将来自Docker容器的(先前展示的)端口3838映射到主机的相同端口3838。参数<code class="du mn mo mp mq b">--rm</code>表示如果容器被停止，我们希望它被移除，我们用<code class="du mn mo mp mq b">--name=</code>指定容器名称(这不是必需的)。如果您希望能够进一步使用您的终端，请设置参数<code class="du mn mo mp mq b">-d</code>以在分离模式下运行。您仍然可以通过<code class="du mn mo mp mq b">docker logs example_dashboard_container</code>查看容器输出。</p><p id="88dd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后，您可以通过导航到<a class="ae jn" href="http://localhost:3838" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj">http://localhost:3838</strong></a>来访问浏览器呈现的Docker容器中闪亮的Flexdashboard。瞧，您会看到本地部署的Flexdashboard具有闪亮的元素，无论它部署在哪台计算机上，都将始终给出相同的结果，并且无需管理依赖项和版本。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/1c0d4aa325e268b6917c6edb57a9ccf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*OGwJfmSoLNE-C92l5QPTBw.gif"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">已部署的示例仪表板。在<a class="ae jn" href="https://timosch.shinyapps.io/dashboard_example/" rel="noopener ugc nofollow" target="_blank"> Shinyapps.io </a>上试用一下</figcaption></figure><h2 id="3f9c" class="lu lc hi bd ld lv lw lx lh ly lz ma ll jx mb mc ln kb md me lp kf mf mg lr mh bi translated">部署容器</h2><p id="797c" class="pw-post-body-paragraph jo jp hi jq b jr mi ij jt ju mj im jw jx mk jz ka kb ml kd ke kf mm kh ki kj hb bi translated">为了使用Flexdashboard部署容器，您可以在安装了Docker的服务器上从Docker文件中再次构建映像。更方便的方法是通过<code class="du mn mo mp mq b">docker save -o ~/example_dashboard.tar example_dashboard</code>保存图像并将文件复制到服务器。然后通过<code class="du mn mo mp mq b">docker load -i example_dashboard.tar</code>加载图像并从中运行容器。您可以使用服务器的IP地址而不是浏览器中的本地主机来访问仪表板。如果您有域，也可以添加它，以便可以通过它访问您的仪表板。</p><p id="bda7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你可以设置一个类似<strong class="jq hj"> nginx </strong>的反向代理，根据子域将流量路由到不同的容器。是的，也有一个码头工人的形象。</p><p id="0cd6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如何将Docker容器部署到云提供商是有据可查的，你可以在网上找到说明和社区示例，例如针对<a class="ae jn" href="https://www.ybrikman.com/writing/2015/11/11/running-docker-aws-ground-up/" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj"/></a><a class="ae jn" href="https://blog.machinebox.io/deploy-docker-containers-in-google-cloud-platform-4b921c77476b" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj">谷歌云</strong> </a>和<a class="ae jn" href="https://blog.machinebox.io/deploy-machine-box-in-digital-ocean-385265fbeafd" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">数字海洋</strong> </a>。要在Heroku free tier上部署您的闪亮应用，请参见本文:<a class="ae jn" rel="noopener" href="/analytics-vidhya/deploying-an-r-shiny-app-on-heroku-free-tier-b31003858b68">https://medium . com/analytics-vid hya/deploying-an-r-Shiny-app-on-Heroku-free-tier-b 31003858 b 68</a>。如果你想在专业环境中部署一个闪亮的应用/Flexdashboard，一个有价值的开源工具是OpenAnalytics的<a class="ae jn" href="https://www.shinyproxy.io/" rel="noopener ugc nofollow" target="_blank"> Shinyproxy </a>服务器。关于使用Shinyproxy部署应用程序，请参阅本系列的第三部分。</p></div></div>    
</body>
</html>