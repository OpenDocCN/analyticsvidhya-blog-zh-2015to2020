<html>
<head>
<title>Data Visualizations for Zip Codes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">邮政编码的数据可视化</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/data-visualizations-for-zip-codes-2bbf1e16cab0?source=collection_archive---------6-----------------------#2020-05-10">https://medium.com/analytics-vidhya/data-visualizations-for-zip-codes-2bbf1e16cab0?source=collection_archive---------6-----------------------#2020-05-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d063" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如何对涉及位置或邮政编码的要素进行可视化？如果你想显示不同社区的平均房价，会发生什么？在本教程中，我将向您展示如何收集必要的工具，并生成下面的数据可视化。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/b2b628b95884b7cca10c5103e7dc1f69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R23-tTIHG_ts9wbDun_Nhw.png"/></div></div></figure><p id="ce7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了开发上面的数据可视化，我们将在Python中使用Folium。在本教程中，我们将使用King County地区销售价格的数据集。我们将用于编码目的的数据集可以在这个<a class="ae jp" href="https://github.com/andypeng93/Flatiron-Housing-Price-Project" rel="noopener ugc nofollow" target="_blank">链接</a>中找到。这个数据集用于我们在熨斗学校数据科学训练营的房价项目。对于这个项目，我们必须创建一个模型来预测房价。然而，如果你想摆弄原始数据集，你可以通过<a class="ae jp" href="https://www.kaggle.com/harlfoxem/housesalesprediction" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>找到它。</p><h1 id="4483" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">入门</strong></h1><p id="ac66" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">首先，我们需要导入我们的数据集kc_house_data.csv。假设我们的数据已经被清理，这就是数据应该的样子。</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="3f8d" class="ky jr hi ku b fi kz la l lb lc">import pandas as pd<br/>df = pd.read_csv('kc_house_data.csv')<br/>dfmap = df[['price', 'zipcode']]<br/>dfmap.head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ld"><img src="../Images/94d7d89b1fb0c36b1205e00b67ea4a15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zb-o-Y9TZSU4YTGzvZes6w.png"/></div></div></figure><p id="e2e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述数据框包含每个唯一邮政编码的多种房价。因此，我们需要创建一个包含我们想要的信息的合适的数据框架。在这个新的数据框中，我们总共需要四列。这四列是平均价格、邮政编码、经度和纬度。</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="fa6e" class="ky jr hi ku b fi kz la l lb lc">#Create the dataframe containing the data we want.<br/>dfmap.zipcode = dfmap.zipcode.astype(int)<br/>zipcode_means = []<br/>for i in dfmap.zipcode.unique().tolist():<br/>    val = dfmap[dfmap['zipcode'] == i]['price'].mean()<br/>    lat = dfmap[dfmap['zipcode'] == i]['lat'].mean()<br/>    long = dfmap[dfmap['zipcode'] == i]['long'].mean()<br/>    zipcode_means.append([str(i), val, lat, long])<br/>xall = []<br/>yall = []<br/>latall = []<br/>longall = []<br/>for val in zipcode_means:<br/>    xall.append(val[0])<br/>    yall.append(val[1])<br/>    latall.append(val[2])<br/>    longall.append(val[3])<br/>tdf = pd.DataFrame(list(zip(xall, yall, latall, longall)), columns = ['Zipcode', 'Price', 'Latitude', 'Longitude'])</span></pre><p id="89af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的代码首先遍历dfmap数据框，计算每个唯一邮政编码的平均房价、纬度和经度。</p><h1 id="19df" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">映射</strong></h1><p id="2244" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">现在我们有了数据框，我们可以开始开发地图的基础。为了构建地图的基础，我们将运行下面的代码。</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="ce8d" class="ky jr hi ku b fi kz la l lb lc">import folium<br/>map = folium.Map(location=[47.5112, -122.257], default_zoom_start=15)<br/>map</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es le"><img src="../Images/b612981ac026ff8629f69cf8dd90e252.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_0MwKTJbLnV_riZ81En4dA.png"/></div></div></figure><p id="94b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在有了从纬度47.5112和经度-122.257的位置开始的地图基础。根据您希望地图从哪里开始，您可以更改位置坐标。请注意，上图中没有代表每个邮政编码的边框。</p><p id="2ab1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要创建边界，我们需要为King County区域找到相应的geoJSON文件。幸运的是，我能够找到一个包含邮政编码、形状长度和面积的<a class="ae jp" href="https://gis-kingcounty.opendata.arcgis.com/datasets/e6c555c6ae7542b2bdec92485892b6e6_113/data" rel="noopener ugc nofollow" target="_blank"> KML文件</a>。然而，由于我下载的文件是KML文件，我不得不使用一个在线的<a class="ae jp" href="https://mygeodata.cloud/converter/kml-to-geojson" rel="noopener ugc nofollow" target="_blank">转换器</a>将KML转换成geoJSON。在开始编码之前，我们需要进入geoJSON文件，找出geoJSON文件中邮政编码的位置。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lf"><img src="../Images/c4cf0c1cb8b9186950cd9b8cb772a550.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vk31Dm6EAqwMu2u2iTjK6A.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lg"><img src="../Images/350d961ca19265f725812b414e5a5d35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vx9MMqx7WFHAbXAUXLbpug.png"/></div></div></figure><p id="59d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">geoJSON文件中邮政编码的位置是“feature.properties.ZIPCODE”。现在是时候将我们收集的信息输入到函数choropleth的参数中了。</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="b3ac" class="ky jr hi ku b fi kz la l lb lc">map.choropleth(geo_data="zip_codes.geojson",<br/>               data=tdf, <br/>               columns=['Zipcode', 'Price'], <br/>               key_on='feature.properties.ZIPCODE', <br/>               fill_color='BuPu',fill_opacity=0.7,line_opacity=0.2,<br/>               legend_name='SALE PRICE')</span></pre><ul class=""><li id="7c96" class="lh li hi ih b ii ij im in iq lj iu lk iy ll jc lm ln lo lp bi translated">geo_data是geoJSON文件的路径，该文件包含邮政编码区域的坐标。在这种情况下，它将是我们之前获得的geoJSON文件。</li><li id="1f9c" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">数据是我们在上面清理过的数据集。</li><li id="bf8d" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">columns表示我们要绘制的数据集的列。注意Zipcode列是数字格式还是字符串格式是很重要的。根据geo_data中的邮政编码是数字格式还是字符串格式，数据中的邮政编码列需要与之匹配。</li><li id="986c" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">key_on是包含geoJSON文件中邮政编码值的路径，我们在上面提到了“feature.properties.ZIPCODE”。</li><li id="b9df" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">fill_color是显示区域的颜色模式。</li><li id="88cd" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">fill_opacity是填充颜色时边界区域的透明度级别。</li><li id="bc4c" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">line_opacity是边界线的透明度级别。</li><li id="9464" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">图例名称是数据图例的标题。</li></ul><p id="6204" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行上面的代码会得到如下所示的地图。我们可以看到图例显示在右上角，标题为销售价格。我们选择的颜色“BuPu”给了我们地图上的蓝紫色。地图的黑色部分代表geoJSON文件中的邮政编码，但不在tdf数据集中。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lv"><img src="../Images/2bfbde6b89805eab8555425bdaba9698.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7rgLycaZPmLTEilK4c9qjw.png"/></div></div></figure><p id="d7ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将在地图上显示标记</p><ol class=""><li id="e32e" class="lh li hi ih b ii ij im in iq lj iu lk iy ll jc lw ln lo lp bi translated">邮政区码</li><li id="c56d" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lw ln lo lp bi translated">平均房价</li></ol><p id="3b45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们需要地图上的坐标来显示标记。如果您没有它的坐标，您可以使用这个<a class="ae jp" href="https://public.opendatasoft.com/explore/dataset/us-zip-code-latitude-and-longitude/export/?q=wa" rel="noopener ugc nofollow" target="_blank">链接</a>来获取相应邮政编码的坐标。但是，为了便于使用，我们已经准备好了要使用的数据帧。为了在地图上显示标记，我们将使用标记功能。</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="4f0e" class="ky jr hi ku b fi kz la l lb lc">from folium.plugins import MarkerCluster<br/>marker_cluster = MarkerCluster().add_to(map) # create marker clusters</span><span id="611b" class="ky jr hi ku b fi lx la l lb lc">for i in range((tdf.shape[0])):<br/>    location = [tdf['Latitude'][i], tdf['Longitude'][i]]<br/>    tooltip = "Zipcode: {}".format(tdf["Zipcode"][i])<br/>    folium.Marker(location, <br/>                  popup="""<br/>                  &lt;i&gt;Mean sales price: &lt;/i&gt; &lt;br&gt; &lt;b&gt;${}&lt;/b&gt; <br/>                  """.format(round(tdf['Price'][i],2)),<br/>                  tooltip=tooltip).add_to(marker_cluster)<br/>map</span></pre><ul class=""><li id="564d" class="lh li hi ih b ii ij im in iq lj iu lk iy ll jc lm ln lo lp bi translated">位置是标记的纬度和经度坐标。</li><li id="aa22" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">弹出窗口是当您单击标记时显示的文本。</li><li id="ee54" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">工具提示是将鼠标悬停在标记上时显示的文本。</li></ul><p id="96ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行下面的代码后，我们可以看到，当我们将鼠标悬停在标记上时，会显示邮政编码。通过点击标记，将显示文本平均销售价格和计算的平均价格。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/b2b628b95884b7cca10c5103e7dc1f69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R23-tTIHG_ts9wbDun_Nhw.png"/></div></div></figure><p id="b7f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们刚刚学习了如何用邮政编码数据制作交互式数据可视化。leav中有很多特性我们还没有探索，以后可以探索。有关leav文档，请参考此<a class="ae jp" href="https://python-visualization.github.io/folium/modules.html" rel="noopener ugc nofollow" target="_blank">链接</a>。我希望本教程能够帮助您在未来的数据分析中使用与邮政编码、纬度和经度相关的数据。</p></div></div>    
</body>
</html>