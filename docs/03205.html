<html>
<head>
<title>Case: Scraping Data using Selenium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">案例:使用Selenium收集数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/case-scraping-data-using-selenium-b0432a4bff95?source=collection_archive---------10-----------------------#2020-01-20">https://medium.com/analytics-vidhya/case-scraping-data-using-selenium-b0432a4bff95?source=collection_archive---------10-----------------------#2020-01-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="54f9" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">我的一个python游乐场，瞧，成功了</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ix"><img src="../Images/fef76fee6cf18281975974ce64b0164b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/0*LzYc3MukC6Mhbk2l"/></div></figure><p id="91c0" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我每天都在处理脏数据，来源可能是网站中的任何地方，也可能是线下的任何来源。获得这些数据后，您只剩下两个选项:</p><ol class=""><li id="e9bd" class="kb kc hi jh b ji jj jl jm jo kd js ke jw kf ka kg kh ki kj bi translated">安心于<strong class="jh hj">手动工作</strong>，这是<strong class="jh hj">少思考</strong>多努力的工作。</li><li id="7bc0" class="kb kc hi jh b ji kk jl kl jo km js kn jw ko ka kg kh ki kj bi translated">试着抓住如何让<strong class="jh hj">自动化</strong>这些东西的想法，这真的很痛苦，但你可以<strong class="jh hj">之后聪明地</strong>工作。</li></ol><p id="72e4" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我相信我们肯定都选择了第二种选择。</p></div><div class="ab cl kp kq gp kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="hb hc hd he hf"><p id="2e62" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我承认Python正在改变我的整个工作生活。我几个月前才彻底学会，并把它应用到工作生活中。我是那种非常热衷于学习的人，实际上，我无法想象如果没有python，我的生活会是什么样子。就像甘地说的:</p><blockquote class="kw kx ky"><p id="183f" class="jf jg kz jh b ji jj ij jk jl jm im jn la jp jq jr lb jt ju jv lc jx jy jz ka hb bi translated">活着，就像你明天就会死去一样。学习吧，就像你会永远活着一样。</p></blockquote><p id="e388" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj"> Python </strong>是如此<strong class="jh hj">便捷</strong>的编程语言，与其他语言相比相当<strong class="jh hj">易学</strong>和<strong class="jh hj">易懂</strong>。如果你是编码新手，我建议你先学习Python，理解其中的概念。</p><h1 id="d8fd" class="ld le hi bd lf lg lh li lj lk ll lm ln io lo ip lp ir lq is lr iu ls iv lt lu bi translated">什么是数据抓取？</h1><p id="516c" class="pw-post-body-paragraph jf jg hi jh b ji lv ij jk jl lw im jn jo lx jq jr js ly ju jv jw lz jy jz ka hb bi translated">抓取网页以获取有价值的数据或信息的行为。当你处理公共数据集时，这通常是需要的，因为它在<a class="ae ma" href="http://www.kaggle.com" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>等中还不可用，然后你需要从网站上获取数据。</p><p id="87d4" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">为了节省时间和精力，您应该通过运行python脚本来废弃该网站。在本例中，脚本使用的是Selenium框架。</p><h1 id="2d1a" class="ld le hi bd lf lg lh li lj lk ll lm ln io lo ip lp ir lq is lr iu ls iv lt lu bi translated">为什么是硒？</h1><p id="3507" class="pw-post-body-paragraph jf jg hi jh b ji lv ij jk jl lw im jn jo lx jq jr js ly ju jv jw lz jy jz ka hb bi translated">对于抓取网站，我们可以使用几个比较知名的框架，比如<a class="ae ma" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener ugc nofollow" target="_blank"> BeautifulSoup </a>、<a class="ae ma" href="https://lxml.de/" rel="noopener ugc nofollow" target="_blank"> lxml </a>等。事实上，<a class="ae ma" href="https://selenium.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="jh hj"> Selenium </strong> </a>并不是主要为抓取网站而构建的，它是自动化网络浏览器的测试目的框架。但就我个人而言，我更喜欢Selenium，因为我们只需几行代码就可以与网站进行更多的交互(登录、点击等),而且内置功能更简单。</p><h1 id="0fd7" class="ld le hi bd lf lg lh li lj lk ll lm ln io lo ip lp ir lq is lr iu ls iv lt lu bi translated">要做的步骤</h1><ol class=""><li id="4e5c" class="kb kc hi jh b ji lv jl lw jo mb js mc jw md ka kg kh ki kj bi translated">将Chromedriver包安装到jupyter领域(我用chrome作为我的浏览器)</li></ol><pre class="iy iz ja jb fd me mf mg mh aw mi bi"><span id="80aa" class="mj le hi mf b fi mk ml l mm mn">pip install chromedriver_binary</span></pre><p id="b1d2" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">2.将必要的包导入到脚本中</p><pre class="iy iz ja jb fd me mf mg mh aw mi bi"><span id="bda8" class="mj le hi mf b fi mk ml l mm mn">from selenium import webdriver<br/>import chromedriver_binary<br/>import pandas as pd<br/>import datetime<br/>import numpy as np</span></pre><p id="b8ac" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">3.设置你想去的网址</p><pre class="iy iz ja jb fd me mf mg mh aw mi bi"><span id="60e0" class="mj le hi mf b fi mk ml l mm mn">url = "<a class="ae ma" href="https://www.bps.go.id/dynamictable/2015/03/10/812/jumlah-penumpang-yang-berangkat-pada-penerbangan-domestik-di-bandara-utama-indonesia-2006-2019-orang-.html" rel="noopener ugc nofollow" target="_blank">https://www.bps.go.id/dynamictable/2015/03/10/812/jumlah-penumpang-yang-berangkat-pada-penerbangan-domestik-di-bandara-utama-indonesia-2006-2019-orang-.html</a>"</span></pre><p id="965b" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">4.创建一个web驱动程序开始抓取</p><pre class="iy iz ja jb fd me mf mg mh aw mi bi"><span id="b867" class="mj le hi mf b fi mk ml l mm mn">driver = webdriver.Chrome()<br/>driver.get(url)</span></pre><p id="66f1" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">5.单击想要捕获的数据，运行inspect element，并复制XPATH</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es mo"><img src="../Images/8f603de1f1c95f079424f728178723c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z6x03SGeQJXYOYrb_63FKw.png"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">网站和检查元素</figcaption></figure><p id="48d4" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">6.创建函数也从其他行获取数据，只需更改值</p><pre class="iy iz ja jb fd me mf mg mh aw mi bi"><span id="8bbf" class="mj le hi mf b fi mk ml l mm mn">def parse_table(val):<br/>    value = driver.find_elements_by_xpath('//*[<a class="ae ma" href="http://twitter.com/id" rel="noopener ugc nofollow" target="_blank">@id</a>="tableRightBottom"]/tbody/tr[{}]/td'.format(str(val)))</span><span id="8e82" class="mj le hi mf b fi mx ml l mm mn">added_value = []</span><span id="0897" class="mj le hi mf b fi mx ml l mm mn">for item in value:<br/>        member = item.text<br/>        member = "".join(member.split())<br/>        added_value.append(member)<br/>        <br/>    return added_value</span><span id="d2c3" class="mj le hi mf b fi mx ml l mm mn">polonia = parse_table(1)<br/>soeta = parse_table(2)<br/>juanda = parse_table(3)<br/>ngurah_rai = parse_table(4)<br/>hasanudin = parse_table(5)</span></pre><p id="7f26" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">7.创建从2006年到2019年的每月周期</p><pre class="iy iz ja jb fd me mf mg mh aw mi bi"><span id="03d1" class="mj le hi mf b fi mk ml l mm mn">start_year = 2006<br/>end_year = 2020</span><span id="5ee9" class="mj le hi mf b fi mx ml l mm mn">month_key = pd.DataFrame({"month": pd.period_range(start_year, freq='M', periods=(end_year-start_year)*12)<br/>                         })</span></pre><p id="6ba4" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">8.最后，通过连接所有机场，以一个数据框架的形式准备数据，并对其进行清理，然后创建总价值，即每月5个现有机场的总和</p><pre class="iy iz ja jb fd me mf mg mh aw mi bi"><span id="f6af" class="mj le hi mf b fi mk ml l mm mn">complete_data = pd.concat([month_key, <br/>           pd.DataFrame({"polonia": polonia,<br/>                         "soeta": soeta,<br/>                         "juanda": juanda,<br/>                         "ngurah_rai": ngurah_rai,<br/>                         "hasanudin": hasanudin<br/>                        })<br/>                        ], axis=1)</span><span id="2f58" class="mj le hi mf b fi mx ml l mm mn">complete_data = complete_data.dropna()</span><span id="b642" class="mj le hi mf b fi mx ml l mm mn">def cast_as_numeric(df, col):<br/>    df[col] = pd.to_numeric(df[col])<br/>    return print("cast as numeric done")</span><span id="f1c7" class="mj le hi mf b fi mx ml l mm mn">cast_as_numeric(complete_data, "polonia")<br/>cast_as_numeric(complete_data, "soeta")<br/>cast_as_numeric(complete_data, "juanda")<br/>cast_as_numeric(complete_data, "ngurah_rai")<br/>cast_as_numeric(complete_data, "hasanudin")</span><span id="ccef" class="mj le hi mf b fi mx ml l mm mn">complete_data["total"] = complete_data.iloc[:,1:].sum(axis=1)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es my"><img src="../Images/d04315b66f83bfaa20a989765fd5e2c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1XCy540CxlnuwBad2vRotA.png"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">输出数据</figcaption></figure><p id="9ec6" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">下一次，如果你想运行额外的月份，你只需在你的jupyter中运行所有，脚本将自动从网站上获取数据。</p></div><div class="ab cl kp kq gp kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="hb hc hd he hf"><p id="9918" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">谢谢你为这篇文章鼓掌，我只想分享我到目前为止为聪明地工作所做的努力。我的座右铭是做任何需要做的事情，不做那些没有效率的事情。</p><p id="976f" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我还有其他文章，也许你会感兴趣。</p><ul class=""><li id="0cfb" class="kb kc hi jh b ji jj jl jm jo kd js ke jw kf ka mz kh ki kj bi translated"><a class="ae ma" rel="noopener" href="/dataseries/how-to-schedule-query-using-airflow-and-google-bigquery-6d6936e868a8">如何使用Airflow和Google BigQuery安排查询</a></li><li id="5cb7" class="kb kc hi jh b ji kk jl kl jo km js kn jw ko ka mz kh ki kj bi translated"><a class="ae ma" rel="noopener" href="/dataseries/creating-time-comparison-trend-using-tableau-51e41d151d2f">使用Tableau创建时间对比趋势</a></li></ul><p id="7a30" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我将不断学习更多的知识，以不断完善我的知识，并在我目前所学的工具上进行合作，我的下一个议程可能是使用气流自动化数据采集。敬请期待！！</p></div></div>    
</body>
</html>