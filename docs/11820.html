<html>
<head>
<title>Data Visualization: Deploying an Interactive Map as a Web App with Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据可视化:使用 Heroku 将交互式地图部署为 Web 应用程序</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/data-visualization-deploying-an-interactive-map-as-a-web-app-with-heroku-51a323029e4?source=collection_archive---------4-----------------------#2020-12-20">https://medium.com/analytics-vidhya/data-visualization-deploying-an-interactive-map-as-a-web-app-with-heroku-51a323029e4?source=collection_archive---------4-----------------------#2020-12-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="0f73" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">本文将尝试分享如何使用 follow、Flask 和 Heroku 部署交互式地图可视化的见解。这是我上一篇关于叶子的文章的后续。</p><p id="cb60" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这篇文章的代码托管在 GitHub <a class="ae jk" href="https://github.com/JUGG097/Folium-Choropleth-Map-Heroku" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="da51" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我将更多地关注 Flask 的使用和 Heroku 的地图部署，要了解更多关于使用 leav 进行交互式地图生成的信息，请查看这篇<a class="ae jk" href="https://dev.to/jugg097/data-visualization-choropleth-interactive-map-with-python-using-folium-3684" rel="noopener ugc nofollow" target="_blank">文章</a>。</p><p id="d57f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我将把这个过程分为 3 个主要步骤。</p><h1 id="a66d" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">第 1 步-基于 API 的交互式地图，带叶子</h1><p id="c3b6" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">我将把从 API 获得的数据与包含尼日利亚地理坐标的 GeoJson 文件集成在一起，这个 GeoJson 文件是 follow 创建尼日利亚地理地图所需要的。使用的 API 的链接可以在<a class="ae jk" href="https://ng-covid-19-api.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">这里</a>找到，它包含了尼日利亚每个州的新冠肺炎案例分布。</p><p id="fb8b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我已经得到了尼日利亚的 GeoJson 文件，请参考这篇<a class="ae jk" href="https://dev.to/jugg097/data-visualization-choropleth-interactive-map-with-python-using-folium-3684" rel="noopener ugc nofollow" target="_blank">文章</a>以了解如何在您选择的任何地理位置进行这项工作。</p><p id="050f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，我使用<strong class="io hj"> <em class="ko">请求</em> </strong> python 模块用其<strong class="io hj"> <em class="ko">提取 API 数据。get()" </em> </strong>方法，用其<strong class="io hj"> <em class="ko">"将返回的数据解析为 JSON 格式。</em></strong>【JSON()】法。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="82b5" class="ky jm hi ku b fi kz la l lb lc"># Accessing API data using the python "requests" module</span><span id="ef7c" class="ky jm hi ku b fi ld la l lb lc">response = requests.get("https://ng-covid-19-api.herokuapp.com/")</span><span id="0d6f" class="ky jm hi ku b fi ld la l lb lc">data_json = response.json()</span></pre><p id="a745" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">此外，我使用<strong class="io hj"><em class="ko">geo pandas</em></strong>python 包及其<strong class="io hj"> <em class="ko">”将上述 GeoJson 文件作为 pandas DataFrame 读取。</em></strong>read _ file()"方法。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="3cca" class="ky jm hi ku b fi kz la l lb lc">df = gpd.read_file("Nigeria_Geometry.geojson")<br/>print(df)</span></pre><p id="c540" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">API 数据和 Geojson 文件是不同的文件格式(J <em class="ko"> SON vs DataFrame </em>)，我编写了一个自定义函数来帮助将它们集成到一个 DataFrame 对象中。使用“.apply()"方法我实现了这个函数，创建了新的列；<strong class="io hj"> <em class="ko">确诊病例，出院和死亡。</em> </strong></p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="a7dc" class="ky jm hi ku b fi kz la l lb lc"># Helper function implementation</span><span id="db59" class="ky jm hi ku b fi ld la l lb lc">df["Confirmed Cases"] = df["Name"].apply(get_stats, data = "confirmed")</span><span id="a909" class="ky jm hi ku b fi ld la l lb lc">df["Discharged"] = df["Name"].apply(get_stats, data = "discharged")</span><span id="3c54" class="ky jm hi ku b fi ld la l lb lc">df["Death"] = df["Name"].apply(get_stats, data = "death")</span><span id="aeac" class="ky jm hi ku b fi ld la l lb lc">print(df)</span></pre><p id="e36b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，我使用了<strong class="io hj"><em class="ko">【df】</em></strong>data frame 对象来创建使用 leav 的交互式地图可视化。</p><p id="385e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">有关使用 leave 进行地图可视化的更多详细说明，请参考此<a class="ae jk" href="https://dev.to/jugg097/data-visualization-choropleth-interactive-map-with-python-using-folium-3684" rel="noopener ugc nofollow" target="_blank">文章</a>。</p><figure class="kp kq kr ks fd lf er es paragraph-image"><div class="er es le"><img src="../Images/38a0c369176917fe5ee596edf6368cd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*nw2_ogw0DbfSA0HMSHcqFA.png"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">生成的地图</figcaption></figure><h1 id="5605" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">步骤 2-创建烧瓶应用程序</h1><p id="f7da" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">Flask 是一个 python web 开发框架；其功能类似于 Django。</p><blockquote class="lm ln lo"><p id="d5c8" class="im in ko io b ip iq ir is it iu iv iw lp iy iz ja lq jc jd je lr jg jh ji jj hb bi translated">它被称为“微框架”,因为它的目标是保持核心简单但可扩展</p></blockquote><p id="93cb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Flask 通常用于将一个叶子地图转换成一个 Web 应用程序，并且很容易设置。</p><p id="17b0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">上面生成的叶子地图将会变成 Flask app，可以按照叶子文档<a class="ae jk" href="https://python-visualization.github.io/folium/flask.html" rel="noopener ugc nofollow" target="_blank">这里</a>给出的例子进行部署。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="9b2c" class="ky jm hi ku b fi kz la l lb lc">from flask import Flask<br/>import folium<br/>import pandas as pd<br/>import geopandas as gpd<br/>import requests</span><span id="5b6f" class="ky jm hi ku b fi ld la l lb lc">app = Flask(__name__)</span><span id="db7d" class="ky jm hi ku b fi ld la l lb lc">@app.route("/")<br/>def index():<br/>    response = requests.get("https://ng-covid-19-   api.herokuapp.com/")data_json = response.json()</span><span id="b1cc" class="ky jm hi ku b fi ld la l lb lc">...(truncated code snippet)</span><span id="c837" class="ky jm hi ku b fi ld la l lb lc">    return folium_map._repr_html_()</span><span id="18b1" class="ky jm hi ku b fi ld la l lb lc">if __name__ == "__main__":<br/>    app.run()</span></pre><p id="8377" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我运行了 Flask 应用程序来测试我们的 follow map 是否正常工作，使用了:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="cb4c" class="ky jm hi ku b fi kz la l lb lc">python -m flask run<br/>## Run at the terminal</span></pre><figure class="kp kq kr ks fd lf er es paragraph-image"><div class="er es ls"><img src="../Images/11df012d56c14e56861b3b77b8141823.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*lJ4L1NUDsdrZ0tQIHoPyhg.png"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">Flask 应用程序运行时的输出…</figcaption></figure><h1 id="0d16" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">步骤 3 —使用 Heroku 进行部署</h1><blockquote class="lm ln lo"><p id="d2d6" class="im in ko io b ip iq ir is it iu iv iw lp iy iz ja lq jc jd je lr jg jh ji jj hb bi translated">H <!-- --> eroku 是一个基于托管容器系统的平台即服务，具有集成的数据服务和强大的生态系统，用于部署和运行现代应用</p></blockquote><p id="c640" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">上面创建的 Flask 应用程序将使用 Heroku 作为云主机进行部署。为此，我执行了以下操作:</p><p id="00c9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，我将所需的 Heroku 配置文件添加到 Flask app 文件夹中，这些配置文件是<strong class="io hj"> <em class="ko"> Procfile </em> </strong>和<strong class="io hj"><em class="ko">requirements . txt .</em></strong></p><p id="67fb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="ko"> Procfile </em> </strong>帮助在单行上声明流程类型，格式为“<strong class="io hj"> <em class="ko"> &lt;流程类型&gt; : &lt;命令&gt; </em> </strong>”。对于我们的 Flask 应用程序，我们添加了进程类型“web”来帮助启动 web 服务器，并且“app: app”指定了模块和应用程序名称。在我们的应用程序中，我们有 app 模块，我们的 flask 应用程序也称为 app。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="697c" class="ky jm hi ku b fi kz la l lb lc">web: gunicorn app:app</span></pre><p id="3237" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"><em class="ko">requirements . txt</em></strong>文件包含了我们的应用程序所依赖的所有 python 模块和包及其相应的版本，以支持可复制的代码。文件中的格式是这个"<strong class="io hj"> <em class="ko"> &lt;包/模块名&gt; == &lt;包/模块版本&gt; " </em> </strong>。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="5e58" class="ky jm hi ku b fi kz la l lb lc">folium==0.10.1</span><span id="4251" class="ky jm hi ku b fi ld la l lb lc">geopandas==0.7.0</span><span id="6df1" class="ky jm hi ku b fi ld la l lb lc">Flask==1.1.2</span><span id="4cc1" class="ky jm hi ku b fi ld la l lb lc">gunicorn==19.5.0</span></pre><p id="1029" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在添加了必要的 Heroku 配置文件后，我将项目文件夹推送到<a class="ae jk" href="https://github.com/JUGG097/Folium-Choropleth-Map-Heroku" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中，从那里我可以轻松地部署到 Heroku。另一种部署到 Heroku 的方法是通过 Heroku CLI(命令行界面)，我不会在本文中讨论。</p><figure class="kp kq kr ks fd lf er es paragraph-image"><div class="er es lt"><img src="../Images/ea1ba373e1689df85f4d2b980468a2e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*y83ZYOL__xi6fwYk4rBobQ.png"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">GitHub 存储库设置</figcaption></figure><p id="24d3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后我进入<a class="ae jk" href="https://www.heroku.com/platform" rel="noopener ugc nofollow" target="_blank"> Heroku 网页</a> ( <em class="ko">注册/登录</em>)，从我的仪表板页面我点击“<strong class="io hj"> <em class="ko">新建</em> </strong>”按钮，选择“<strong class="io hj"> <em class="ko">新建 app </em> </strong>”，添加 app 名称，点击“<strong class="io hj"> <em class="ko">创建 app </em> </strong>”。创建 app 后，我被要求选择一种部署方法，因为我已经将代码推送到 GitHub repo，我选择了“<strong class="io hj"> <em class="ko">连接到 GitHub </em> </strong>”，我被要求将我的 GitHub 帐户连接到 Heroku。</p><figure class="kp kq kr ks fd lf er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es lu"><img src="../Images/ebe85f657c101383a04eeefc005d2909.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VTzprXb_Sa4ZtB-xCGPZLQ.png"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx translated">Heroku 部署方法</figcaption></figure><p id="868a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，在将我的 GitHub 帐户连接到 Heroku 后，我只需指定包含要部署的代码的存储库并连接它。如果出现错误，我们可以在 Heroku 网页上查看构建日志。</p><figure class="kp kq kr ks fd lf er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es lz"><img src="../Images/5c9cab53c54c7f26670165dcac98bd1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6SnxUnAoZZbmoosv5HUnKw.png"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx translated">Heroku 连接到 GitHub…选择要部署的存储库</figcaption></figure><figure class="kp kq kr ks fd lf er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es ma"><img src="../Images/a05f0c8bbcd2143ce7403dafad863ec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lMTn7asdZhDiu65HWk2pnQ.png"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx translated"><a class="ae jk" href="https://folium-choropleth-map.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">部署互动地图</a></figcaption></figure><p id="86ba" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这将是所有关于与 Heroku 部署一个交互式地图，希望这篇文章是一个很大的帮助，如果所以请留下一两个掌声，也<strong class="io hj"> <em class="ko">星</em> </strong>或<strong class="io hj"> <em class="ko">叉</em></strong>GitHub 库<a class="ae jk" href="https://github.com/JUGG097/Folium-Choropleth-Map-Heroku" rel="noopener ugc nofollow" target="_blank">这里</a>和链接到部署的地图可以在<a class="ae jk" href="https://folium-choropleth-map.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="0241" class="ky jm hi bd jn mb mc md jr me mf mg jv ix mh mi jz jb mj mk kd jf ml mm kh mn bi translated"><strong class="ak">参考资料/其他资源</strong></h2><p id="9a44" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated"><strong class="io hj"><em class="ko"/></strong><a class="ae jk" href="https://devcenter.heroku.com/" rel="noopener ugc nofollow" target="_blank"><strong class="io hj">【https://devcenter.heroku.com/】</strong></a></p><p id="8065" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"><em class="ko"/></strong><a class="ae jk" rel="noopener" href="/the-andela-way/deploying-a-python-flask-app-to-heroku-41250bda27d0"><strong class="io hj"><em class="ko">https://medium . com/the-andela-way/deploying-a-python-flask-app-to-heroku-41250 BDA 27d 0</em></strong></a></p><p id="edfc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"><em class="ko"/></strong><a class="ae jk" href="https://flask.palletsprojects.com/en/1.1.x/quickstart/#a-minimal-application" rel="noopener ugc nofollow" target="_blank"><strong class="io hj"><em class="ko">https://flask . pallets projects . com/en/1.1 . x/quick start/# a-minimal-application</em></strong></a></p><p id="1759" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"><em class="ko"/></strong><a class="ae jk" href="https://python-visualization.github.io/folium/flask.html" rel="noopener ugc nofollow" target="_blank"><strong class="io hj"><em class="ko">https://python-visualization.github.io/folium/flask.html</em></strong></a></p><p id="fc16" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"><em class="ko"/></strong><a class="ae jk" href="https://dev.to/jugg097/data-visualization-choropleth-interactive-map-with-python-using-folium-3684" rel="noopener ugc nofollow" target="_blank"><strong class="io hj"><em class="ko">https://dev . to/jugg 097/data-visualization-choropleth-interactive-map-with-python-using-foyl-3684</em></strong></a></p><p id="4eb2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"><em class="ko"/></strong><a class="ae jk" href="https://code.visualstudio.com/docs/python/tutorial-flask" rel="noopener ugc nofollow" target="_blank"><strong class="io hj"><em class="ko">https://code.visualstudio.com/docs/python/tutorial-flask</em></strong></a></p></div></div>    
</body>
</html>