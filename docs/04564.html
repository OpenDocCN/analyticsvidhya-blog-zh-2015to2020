<html>
<head>
<title>Blend all Coronavirus Data into a Pandas Dataframe using OpenBlender</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用OpenBlender将所有冠状病毒数据混合到一个熊猫数据帧中</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/blend-all-coronavirus-data-into-a-pandas-dataframe-using-openblender-5a3af46a55b1?source=collection_archive---------17-----------------------#2020-03-24">https://medium.com/analytics-vidhya/blend-all-coronavirus-data-into-a-pandas-dataframe-using-openblender-5a3af46a55b1?source=collection_archive---------17-----------------------#2020-03-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="838e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简单是关键。</p><h1 id="770d" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">步伐</h1><ul class=""><li id="c72c" class="kb kc hi ih b ii kd im ke iq kf iu kg iy kh jc ki kj kk kl bi translated">第一步:设置技术先决条件</li><li id="3dbd" class="kb kc hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">第二步:聚集<strong class="ih hj">新冠肺炎</strong>确诊病例</li><li id="eec3" class="kb kc hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">第三步:收集COVID的<strong class="ih hj">新闻</strong></li><li id="8a3f" class="kb kc hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">第四步:收集<strong class="ih hj">财务</strong>和其他<strong class="ih hj">指标</strong></li><li id="5ff7" class="kb kc hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">步骤5: <strong class="ih hj">将所有的</strong>数据混合在一起</li></ul><h1 id="b5ed" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">第一步。先决条件</h1><ul class=""><li id="bc39" class="kb kc hi ih b ii kd im ke iq kf iu kg iy kh jc ki kj kk kl bi translated">安装Python 2.6+或3.1+版本</li><li id="86a8" class="kb kc hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">安装pandas，matplotlib，openblender和wordcloud(带pip)</li></ul><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="b451" class="la je hi kw b fi lb lc l ld le">$ pip install pandas OpenBlender matplotlib wordcloud</span></pre><h1 id="7435" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">第二步。收集新冠肺炎确诊病例</h1><p id="fb5d" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">CSSE正在做惊人的工作<strong class="ih hj">上传每日数据</strong> <a class="ae li" href="https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_daily_reports" rel="noopener ugc nofollow" target="_blank">这里</a>。然而，它非常凌乱，而且在许多不同的数据集上，所以我把它分类，并上传为一个单独的数据集:</p><figure class="kr ks kt ku fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lj"><img src="../Images/c7a918df3f1be7d423f8ae71b520371f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hqwQwrk_6i2cShKQLQdn8Q.png"/></div></div></figure><p id="9e8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们通过运行以下脚本将数据<strong class="ih hj">拉入熊猫数据帧</strong>:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="f9e3" class="la je hi kw b fi lb lc l ld le">from matplotlib import pyplot as plt<br/>import OpenBlender<br/>import pandas as pd<br/>import json<br/>%matplotlib inline</span><span id="3e19" class="la je hi kw b fi lr lc l ld le">action = 'API_getObservationsFromDataset'</span><span id="dcf5" class="la je hi kw b fi lr lc l ld le">parameters = { <br/> 'token':'<strong class="kw hj">YOUR_TOKEN_HERE</strong>',<br/> 'id_dataset':'5e6ac97595162921fda18076',<br/> 'date_filter':{<br/>               "start_date":"2020-01-01T06:00:00.000Z",<br/>               "end_date":"2020-03-11T06:00:00.000Z"},<br/> 'consumption_confirmation':'on' <br/>}</span><span id="ed7f" class="la je hi kw b fi lr lc l ld le">df_confirmed = pd.read_json(json.dumps(OpenBlender.call(action, parameters)['sample']), convert_dates=False, convert_axes=False).sort_values('timestamp', ascending=False)<br/>df_confirmed.reset_index(drop=True, inplace=True)<br/>df_confirmed.head(10)</span></pre><figure class="kr ks kt ku fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es ls"><img src="../Images/fe5dc178f94d37f244f1347945b579fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3R9GdV6NI3FGMZ9Zh_MFXA.png"/></div></div></figure><ul class=""><li id="e547" class="kb kc hi ih b ii ij im in iq lt iu lu iy lv jc ki kj kk kl bi translated"><strong class="ih hj">注意</strong>:要获得令牌，你<em class="lw">需要</em>在<a class="ae li" href="https://www.openblender.io/#/welcome/or/37" rel="noopener ugc nofollow" target="_blank"> openblender.io </a>(免费)上创建一个帐户，你可以在你的个人资料图标的“帐户”标签中找到它。</li></ul><p id="bce4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，现在我们有了按日和按地点汇总的确诊病例数、死亡人数和康复人数。</p><figure class="kr ks kt ku fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lx"><img src="../Images/f6bbbb6a9c7795afbbc6504c5e4996b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pdbwvPfsv6qeLiG_.png"/></div></div></figure><p id="af4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们可以看到伊朗、意大利和韩国确诊病例的爆发。我们还可以看到西班牙、法国和德国开始崛起。</p><h1 id="37be" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">第三步。收集新冠肺炎的消息</h1><p id="1223" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">我们将从这些来源收集<strong class="ih hj"> COVID新闻</strong>和文本:<a class="ae li" href="http://5d8848e59516294231c59581/" rel="noopener ugc nofollow" target="_blank"> ABC新闻</a>，<a class="ae li" href="https://www.openblender.io/#/dataset/explore/5e2ef74e9516294390e810a9" rel="noopener ugc nofollow" target="_blank">华尔街日报</a>，<a class="ae li" href="https://www.openblender.io/#/dataset/explore/5d571b9e9516293a12ad4f5c" rel="noopener ugc nofollow" target="_blank"> CNN新闻</a>和<a class="ae li" href="https://www.openblender.io/#/dataset/explore/5e32fd289516291e346c1726" rel="noopener ugc nofollow" target="_blank">今日美国推特</a>(你可以寻找其他来源)</p><figure class="kr ks kt ku fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es ly"><img src="../Images/563a8f785870e4c53fb6d2aa54cf1aa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zYZo9zT0N0VtI8S0.png"/></div></div></figure><p id="fe0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以让我们获取数据。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="2883" class="la je hi kw b fi lb lc l ld le">action = 'API_getOpenTextData'</span><span id="0e91" class="la je hi kw b fi lr lc l ld le">parameters = {<br/>    'token':'<strong class="kw hj">YOUR_TOKEN_HERE</strong>',<br/>    'consumption_confirmation':'on',<br/>    'date_filter':{"start_date":"2020-01-01T06:00:00.000Z", <br/>                   "end_date":"2020-03-10T06:00:00.000Z"},<br/>    'sources':[<br/>                # Wall Street Journal<br/>               {'id_dataset' : '5e2ef74e9516294390e810a9', <br/>                 'features' : ['text']},<br/>                # ABC News Headlines<br/>               {'id_dataset':"5d8848e59516294231c59581", <br/>                'features' : ["headline", "title"]},<br/>                # USA Today Twitter<br/>               {'id_dataset' : "5e32fd289516291e346c1726", <br/>                'features' : ["text"]},<br/>                # CNN News<br/>               {'id_dataset' : "5d571b9e9516293a12ad4f5c", <br/>                'features' : ["headline", "title"]}<br/>    ],<br/>    'aggregate_in_time_interval' : {<br/>              'time_interval_size' : 60 * 60 * 24<br/>    },<br/>    'text_filter_search':['covid', 'coronavirus', 'ncov']<br/>    <br/>}<br/>df_news = pd.read_json(json.dumps(OpenBlender.call(action, parameters)['sample']), convert_dates=False, convert_axes=False).sort_values('timestamp', ascending=False)</span><span id="3a4c" class="la je hi kw b fi lr lc l ld le">df_news.reset_index(drop=True, inplace=True)</span></pre><p id="be5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以上，<strong class="ih hj">我们指定了以下</strong>:</p><ul class=""><li id="3a9c" class="kb kc hi ih b ii ij im in iq lt iu lu iy lv jc ki kj kk kl bi translated">我们选择了4个<strong class="ih hj">来源来收集数据</strong>。具体来说，带有文本的功能列</li><li id="ff86" class="kb kc hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">我们指定要从1月1日到今天(3月10日)的数据</li><li id="e1e8" class="kb kc hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">我们要求将新闻汇总成<strong class="ih hj"> 24小时组</strong>或观察</li><li id="abda" class="kb kc hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">我们<strong class="ih hj">过滤了提到“冠状病毒”、“冠状病毒”或“ncov”的新闻</strong></li></ul><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="e042" class="la je hi kw b fi lb lc l ld le"># Let's take a look<br/>df_news.head(20)</span></pre><figure class="kr ks kt ku fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lz"><img src="../Images/b906fca82cb43ad6a6cf0366d5459c40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*r6ClacVLOG28Dz8N.png"/></div></div></figure><p id="27ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个观察都是按天的<strong class="ih hj">新闻聚合，我们有<strong class="ih hj">源</strong>和<strong class="ih hj">源</strong>源</strong>源，前者是所有新闻串联成一个字符串，后者是该时段的新闻列表。</p><p id="8ebf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">时间戳</strong>(返回为<a class="ae li" href="https://www.epochconverter.com/" rel="noopener ugc nofollow" target="_blank"> unix时间戳</a>)是指从前一个时间戳到当前时间戳(严格来说是之前)的间隔内发生的新闻<strong class="ih hj">:</strong></p><figure class="kr ks kt ku fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es ma"><img src="../Images/ef98a48f3a3a0918407df31e2fab4b25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*98xbzdshiNlsnjtB.png"/></div></div></figure><p id="8aab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们来看看一些感兴趣的<em class="lw">国家</em>的<strong class="ih hj">提及次数</strong>。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="6b41" class="la je hi kw b fi lb lc l ld le">interest_countries = ['China', 'Iran', 'Korea', 'Italy', 'France', 'Germany', 'Spain']</span><span id="1357" class="la je hi kw b fi lr lc l ld le">for country in interest_countries:<br/>    df_news['count_news_' + country] = [len([text for text in daily_lst if country.lower() in text]) for daily_lst in df_news['source_lst']]</span><span id="282e" class="la je hi kw b fi lr lc l ld le">df_news.reindex(index=df_news.index[::-1]).plot(x = 'timestamp', y = [col for col in df_news.columns if 'count' in col], figsize=(17,7), kind='area')</span></pre><figure class="kr ks kt ku fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es mb"><img src="../Images/f9994b4aed7fa68848887f4a848421af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RHagVzkChsA6ekHn.png"/></div></div></figure><figure class="kr ks kt ku fd lk er es paragraph-image"><div class="er es mc"><img src="../Images/699cb77546831e20139b3fe3fa8f9e26.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/0*3J-jyEGSbM49Lrwb"/></div></figure><p id="1213" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来看一段来自<strong class="ih hj">最近20天</strong>的新闻云。* <em class="lw">可选步骤(如果要安装wordcloud </em>):</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="7c2e" class="la je hi kw b fi lb lc l ld le">from os import path<br/>from PIL import Image<br/>from wordcloud import WordCloud, STOPWORDS, ImageColorGenerator</span><span id="81dd" class="la je hi kw b fi lr lc l ld le">plt.figure()<br/>plt.imshow(WordCloud(max_font_size=50, max_words=80, background_color="white").generate(' '.join([val for val in df['source'][0: 20]])), interpolation="bilinear")<br/>plt.axis("off")<br/>plt.show()</span><span id="6383" class="la je hi kw b fi lr lc l ld le">plt.figure()<br/>plt.imshow(WordCloud(max_font_size=50, max_words=80, background_color="white").generate(' '.join([val for val in df['source'][0: 20]])), interpolation="bilinear")<br/>plt.axis("off")<br/>plt.show()</span></pre><figure class="kr ks kt ku fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es md"><img src="../Images/1600378263b31e204740a20f44cf5c33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5YMPESvAE6rHtf8g.png"/></div></div><figcaption class="me mf et er es mg mh bd b be z dx translated">*上面的代码生成了图像的最后一个wordcloud。</figcaption></figure><p id="623c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">早期新闻中的关键词如“神秘”、“正在调查”、“几十个”<strong class="ih hj">与后期关键词</strong>如“中国”、“冠状病毒”、“全球”形成对比。以及<strong class="ih hj">更有</strong>最近的:“新型冠状病毒”、“冠状病毒流行”、“爆发”、“巡航”、“新型冠状病毒”等..</p><h1 id="edc2" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">第四步。收集财务和其他指标</h1><p id="6a95" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">为此，我们可以从道琼斯数据集中分离出来，混合其他几个数据，如<strong class="ih hj">汇率</strong>(日元、欧元、英镑)<strong class="ih hj">材料价格</strong>(原油、玉米、铂、锡)，或<strong class="ih hj">股票</strong>(可口可乐、道琼斯)。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="2f88" class="la je hi kw b fi lb lc l ld le">action = 'API_getObservationsFromDataset'<br/>        <br/>parameters = {<br/> 'token':'<strong class="kw hj">YOUR_TOKEN_HERE</strong>',<br/> 'id_dataset':'5d4c14cd9516290b01c7d673',</span><span id="b337" class="la je hi kw b fi lr lc l ld le">'aggregate_in_time_interval':{"output":"avg","empty_intervals":"impute","time_interval_size":86400},</span><span id="6158" class="la je hi kw b fi lr lc l ld le">'blends':[<br/>        #Yen vs USD              <br/>{"id_blend":"5d2495169516290b5fd2cee3","restriction":"None","blend_type":"ts","drop_features":[]},</span><span id="3766" class="la je hi kw b fi lr lc l ld le"># Euro Vs USD<br/>{"id_blend":"5d4b3af1951629707cc1116b","restriction":"None","blend_type":"ts","drop_features":[]},</span><span id="1dfb" class="la je hi kw b fi lr lc l ld le"># Pound Vs USD              <br/>{"id_blend":"5d4b3be1951629707cc11341","restriction":"None","blend_type":"ts","drop_features":[]},</span><span id="9e88" class="la je hi kw b fi lr lc l ld le"># Corn Price    <br/>{"id_blend":"5d4c23b39516290b01c7feea","restriction":"None","blend_type":"ts","drop_features":[]},</span><span id="8de9" class="la je hi kw b fi lr lc l ld le"># CocaCola Price     <br/>{"id_blend":"5d4c72399516290b02fe7359","restriction":"None","blend_type":"ts","drop_features":[]},</span><span id="e0e5" class="la je hi kw b fi lr lc l ld le"># Platinum price             <br/>{"id_blend":"5d4ca1049516290b02fee837","restriction":"None","blend_type":"ts","drop_features":[]},</span><span id="da9d" class="la je hi kw b fi lr lc l ld le"># Tin Price<br/>{"id_blend":"5d4caa429516290b01c9dff0","restriction":"None","blend_type":"ts","drop_features":[]},</span><span id="7b25" class="la je hi kw b fi lr lc l ld le"># Crude Oil Price<br/>{"id_blend":"5d4c80bf9516290b01c8f6f9","restriction":"None","blend_type":"ts","drop_features":[]}],</span><span id="0d06" class="la je hi kw b fi lr lc l ld le">'date_filter':{"start_date":"2020-01-01T06:00:00.000Z","end_date":"2020-03-10T06:00:00.000Z"},<br/>'consumption_confirmation':'on' <br/>}</span><span id="cca8" class="la je hi kw b fi lr lc l ld le">df = pd.read_json(json.dumps(OpenBlender.call(action, parameters)['sample']), convert_dates=False, convert_axes=False).sort_values('timestamp', ascending=False)<br/>df.reset_index(drop=True, inplace=True)</span><span id="a5b3" class="la je hi kw b fi lr lc l ld le">print(df.shape)<br/>df.head()</span></pre><figure class="kr ks kt ku fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es mi"><img src="../Images/ea2a31936d6f32ddbd4961657a68c63a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cDLr6DCpBWovjMR-UaNBGA.png"/></div></div></figure><p id="f581" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以现在我们有了一个单独的数据集，它包含了每天观察到的价格。如果我们想要比较它们，我们最好将它们归一化到0到1之间，这样我们就可以更好地欣赏这些模式:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="3d49" class="la je hi kw b fi lb lc l ld le"># Lets compress all into the (0, 1) domain<br/>df_compress = df.dropna(0).select_dtypes(include=['int16', 'int32', 'int64', 'float16', 'float32', 'float64']).apply(lambda x: (x - x.min()) / (x.max() - x.min()))<br/>df_compress['timestamp'] = df['timestamp']</span><span id="5903" class="la je hi kw b fi lr lc l ld le"># Now we select the columns that interest us<br/>cols_of_interest = ['timestamp', 'PLATINUM_PRICE_price', 'CRUDE_OIL_PRICE_price', 'COCACOLA_PRICE_price', 'open', 'CORN_PRICE_price', 'TIN_PRICE_price', 'PLATINUM_PRICE_price']<br/>df_compress = df_compress[cols_of_interest]<br/>df_compress.rename(columns={'open':'DOW_JONES_price'}, inplace=True)</span><span id="7fe4" class="la je hi kw b fi lr lc l ld le"># An now let's plot them<br/>from matplotlib import pyplot as plt<br/>fig, ax = plt.subplots(figsize=(17,7))<br/>plt = df_compress.plot(x='timestamp', y =['PLATINUM_PRICE_price', 'CRUDE_OIL_PRICE_price', 'COCACOLA_PRICE_price', 'DOW_JONES_price', 'CORN_PRICE_price', 'TIN_PRICE_price', 'PLATINUM_PRICE_price'], ax=ax)</span></pre><figure class="kr ks kt ku fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es mj"><img src="../Images/18baac948fd59a51b8a5b73f06a2caac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oTzJVZt4m-i1I5mvo3IaAw.png"/></div></div></figure><p id="6923" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有趣的是<strong class="ih hj">几乎所有的</strong>(除了锡价)都遵循<strong class="ih hj">相似的模式</strong>。</p><h1 id="7119" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">第五步。将所有数据混合在一起</h1><p id="8e10" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">现在，我们将把<strong class="ih hj">新冠肺炎确诊病例</strong>、<strong class="ih hj">冠状病毒新闻</strong>和<strong class="ih hj">经济指标</strong>数据排列成按照时间混合的<strong class="ih hj">单一数据集</strong>。</p><p id="4198" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了混合数据，让我们将创建的数据集上传到OpenBlender:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="5fcb" class="la je hi kw b fi lb lc l ld le"># First the News Dataset</span><span id="0a52" class="la je hi kw b fi lr lc l ld le">action = 'API_createDataset'</span><span id="a5a1" class="la je hi kw b fi lr lc l ld le">parameters = { <br/> 'token':'<strong class="kw hj">YOUR_TOKEN_HERE</strong>',<br/> 'name':'Coronavirus News',<br/> 'description':'YOUR_DATASET_DESCRIPTION',<br/> 'visibility':'private',<br/> 'tags':[],<br/> 'insert_observations':'on',<br/>    'select_as_timestamp' : 'timestamp',<br/> 'dataframe':df_news.to_json() <br/>}<br/>        <br/>OpenBlender.call(action, parameters)</span></pre><figure class="kr ks kt ku fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es mk"><img src="../Images/0b781b003fa62050db5d9d45d0206199.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SG88vgqmc-J6-t3K4QnTnQ.png"/></div></div></figure><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="1015" class="la je hi kw b fi lb lc l ld le"># And now the Financial Indicators</span><span id="6883" class="la je hi kw b fi lr lc l ld le">action = 'API_createDataset'</span><span id="604f" class="la je hi kw b fi lr lc l ld le">parameters = { <br/> 'token':'<strong class="kw hj">YOUR_TOKEN_HERE</strong>',<br/> 'name':'Financial Indicators for COVID',<br/> 'description':'YOUR_DATASET_DESCRIPTION',<br/> 'visibility':'private',<br/> 'tags':[],<br/> 'insert_observations':'on',<br/> 'select_as_timestamp' : 'timestamp',<br/> 'dataframe':df_compress.to_json() <br/>}<br/>        <br/>OpenBlender.call(action, parameters)</span></pre><figure class="kr ks kt ku fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es ml"><img src="../Images/136ad745105ed318927abd07f9731b3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZVXoQxZ_dNkbfTepkhrqcQ.png"/></div></div></figure><p id="8a98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lw">*注意:您可能希望在下面使用每个数据集的“id_dataset”。</em></p><p id="1612" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们只需提取初始新冠肺炎数据集，并通过替换“id_dataset”来混合我们创建的新数据集。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="a47c" class="la je hi kw b fi lb lc l ld le">action = 'API_getObservationsFromDataset'</span><span id="524e" class="la je hi kw b fi lr lc l ld le"># ANCHOR: 'COVID19 Confirmed Cases'<br/># BLENDS: 'Coronavirus News', 'Financial Indicators for COVID'<br/>        <br/>parameters = { <br/> 'token':'<strong class="kw hj">YOUR_TOKEN_HERE</strong>',<br/> 'id_dataset':'5e6ac97595162921fda18076',<br/> 'date_filter':{<br/>               "start_date":"2020-01-01T06:00:00.000Z",<br/>               "end_date":"2020-03-11T06:00:00.000Z"} ,<br/> <br/> },</span><span id="1310" class="la je hi kw b fi lr lc l ld le">'filter_select' : {'feature' : 'countryregion', 'categories' : ['Italy']},</span><span id="090c" class="la je hi kw b fi lr lc l ld le">'aggregate_in_time_interval':{"output":"avg","empty_intervals":"impute","time_interval_size":86400},</span><span id="2e84" class="la je hi kw b fi lr lc l ld le">'blends':[{"id_blend":"<strong class="kw hj">YOUR_CORONA_NEWS_ID</strong>","restriction":"None","blend_type":"ts","drop_features":[]},<br/>            {"id_blend":"<strong class="kw hj">YOUR_FINANCIAL_INDICATORS_ID</strong>","restriction":"None","blend_type":"ts","drop_features":[]}] <br/>}</span><span id="ba2a" class="la je hi kw b fi lr lc l ld le">df = pd.read_json(json.dumps(OpenBlender.call(action, parameters)['sample']), convert_dates=False, convert_axes=False).sort_values('timestamp', ascending=False)<br/>df.reset_index(drop=True, inplace=True)</span></pre><p id="01eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面我们<strong class="ih hj">选择了“意大利”</strong>、<strong class="ih hj">的观测值，按天</strong>以秒为单位(8640)进行聚合，<strong class="ih hj">混合了新的数据</strong>。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="01ab" class="la je hi kw b fi lb lc l ld le">df.head()</span></pre><figure class="kr ks kt ku fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es mm"><img src="../Images/33ed94d09564bc7a8bf74b59cd26f7e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cOHStEBs8c7I8pS6H1GB-A.png"/></div></div></figure><p id="3883" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们有了一个数据集，其中包含了按时间混合的所有数据的<strong class="ih hj">日常信息！</strong></p><p id="7cf7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这有很大的发展空间。</p></div></div>    
</body>
</html>