<html>
<head>
<title>Configure Amazon EC2 to Run PostgreSQL, Anaconda and Jupyter Notebook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">配置 Amazon EC2 运行 PostgreSQL、Anaconda 和 Jupyter Notebook</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/configure-amazon-ec2-to-run-postgresql-anaconda-and-jupyter-notebook-eefc0785a71f?source=collection_archive---------15-----------------------#2020-08-08">https://medium.com/analytics-vidhya/configure-amazon-ec2-to-run-postgresql-anaconda-and-jupyter-notebook-eefc0785a71f?source=collection_archive---------15-----------------------#2020-08-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/19463e1f6e8404242f61b81ca155a65f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J3sbGqqkNkbgM_x6r7Zdhg.jpeg"/></div></div></figure><p id="89c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本教程中，我们将创建一个新的<strong class="is hj"> <em class="jo"> Amazon EC2 </em> </strong>实例，并安装<strong class="is hj"> <em class="jo"> Anaconda </em> </strong>，<strong class="is hj"> <em class="jo"> Python </em> </strong>，<strong class="is hj"> <em class="jo"> PostgreSQL </em> </strong>，以及<strong class="is hj"><em class="jo">Jupyter notebook</em></strong>，以便在<strong class="is hj"> <em class="jo"> EC2 </em> </strong>实例 throw 上从本地机器(windows 10)运行我们的 Python 脚本</p><h2 id="a884" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">1-午餐 EC2 实例:</h2><ul class=""><li id="3691" class="kk kl hi is b it km ix kn jb ko jf kp jj kq jn kr ks kt ku bi translated">从 AWS 管理控制台中，我们选择了 EC2 服务，然后我们开始用一个<strong class="is hj"> <em class="jo"> Ubuntu 服务器 AMI 启动我们的新<strong class="is hj"> EC2 </strong>实例。</em> </strong></li><li id="41fd" class="kk kl hi is b it kv ix kw jb kx jf ky jj kz jn kr ks kt ku bi translated">出于本教程的考虑，我们将通过选择符合自由层条件的实例类型<strong class="is hj"> <em class="jo"> t2.micro </em> </strong>来停留在<strong class="is hj"> <em class="jo"> AWS </em> </strong>的自由层。</li><li id="a9a7" class="kk kl hi is b it kv ix kw jb kx jf ky jj kz jn kr ks kt ku bi translated">我们将保持配置细节不变，增加卷大小(可选步骤 max 30GiB)，我们将继续不添加标签，最后，我们将在<strong class="is hj"> <em class="jo">端口 22 上打开我们的实例到<strong class="is hj"> <em class="jo"> SSH </em> </strong>，在<strong class="is hj"> <em class="jo">端口 5432 上打开 PostgreSQL </em> </strong>，在<strong class="is hj"> <em class="jo">端口 8888 上打开 Jupiter 笔记本</em> </strong>，在<strong class="is hj">上打开 HTTP </strong></em> </strong></li></ul><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es la"><img src="../Images/a693aa6dba20c2d55849fb5d48ce8a81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C8JQLuEFwTNLdDqx8J3Etw.png"/></div></div></figure><ul class=""><li id="3ac3" class="kk kl hi is b it iu ix iy jb lf jf lg jj lh jn kr ks kt ku bi translated">在验证了我们的配置之后，我们将一个新的密钥对附加到实例，或者选择一个现有的密钥对。</li></ul><h2 id="35fa" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">2-在本地机器上配置 SSH:</h2><ul class=""><li id="bb14" class="kk kl hi is b it km ix kn jb ko jf kp jj kq jn kr ks kt ku bi translated">因为我们本地机器的操作系统可能是 windows 10🙏<strong class="is hj"> <em class="jo"> SSH </em> </strong>默认提供了<strong class="is hj"> <em class="jo"> CMD </em> </strong>，否则我们将需要使用<strong class="is hj"> <em class="jo"> puTTY </em> </strong>来连接到使用 throw <strong class="is hj"> <em class="jo"> SSH 的实例。</em>T85】</strong></li><li id="7e84" class="kk kl hi is b it kv ix kw jb kx jf ky jj kz jn kr ks kt ku bi translated">在我们的本地机器上，我们导航到<strong class="is hj"><em class="jo">C:\ Users \ our-local-user</em></strong>。\ssh 我们添加一个名为<strong class="is hj"><em class="jo">‘config’</em></strong>的新文本文件，然后填充它，如下图<strong class="is hj"> <em class="jo"> </em> </strong>所示。</li></ul><blockquote class="li lj lk"><p id="3e2c" class="iq ir jo is b it iu iv iw ix iy iz ja ll jc jd je lm jg jh ji ln jk jl jm jn hb bi translated">(注意:要保存不带扩展名的文件，我们将文件→另存为→将文件名写在双引号内，# sympol 后面的所有内容仅用于演示)</p></blockquote><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/f6be9b1e0cced215246a3cfaf339ea68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*daGZGrT381ZYMIoLYugHbw.png"/></div></div></figure><h2 id="52b8" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">3-将 Throw SSH 连接到 EC2 实例:</h2><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/68089fc3ef9bffc507bf8e2db8e5a356.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JP3LQv24U7fr7k7uzQgHdA.png"/></div></div></figure><p id="2648" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">打开本地机器上的<strong class="is hj"> <em class="jo"> CMD </em> </strong>或者使用(Windows 终端)，然后键入'<strong class="is hj"> <em class="jo"> ssh myaws' </em> </strong>(我们在<strong class="is hj"> <em class="jo"> config </em> </strong>文件中指定的名称)，系统会询问您是否确定要连接到实例类型<strong class="is hj"> <em class="jo"> 'yes' </em> </strong>。<br/> <strong class="is hj"> <em class="jo">瞧，</em> </strong>现在你已经连接到实例了👌。</p><h2 id="cd8e" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">4-在 EC2 实例上安装 Anaconda:</h2><ul class=""><li id="905d" class="kk kl hi is b it km ix kn jb ko jf kp jj kq jn kr ks kt ku bi translated">转到<a class="ae lq" href="https://www.anaconda.com/download/#linux" rel="noopener ugc nofollow" target="_blank"><strong class="is hj"><em class="jo">Anaconda</em></strong></a>→页面底部的<strong class="is hj"> <em class="jo"> Linux </em> </strong>部分右键单击<a class="ae lq" href="https://repo.anaconda.com/archive/Anaconda3-2020.07-Linux-x86_64.sh" rel="noopener ugc nofollow" target="_blank"> 64 位(x86)安装程序(550 MB) </a> →选择复制链接地址，然后在您连接到实例的 CMD 中写入(或者使用与本文不兼容的链接，但在您阅读本文时可能已经引入了新版本):</li></ul><pre class="lb lc ld le fd lr ls lt lu aw lv bi"><span id="772d" class="jp jq hi ls b fi lw lx l ly lz">wget <a class="ae lq" href="https://repo.anaconda.com/archive/Anaconda3-2020.07-Linux-x86_64.sh" rel="noopener ugc nofollow" target="_blank">https://repo.anaconda.com/archive/Anaconda3-5.3.0-Linux-x86_64.sh</a></span></pre><ul class=""><li id="6f0d" class="kk kl hi is b it iu ix iy jb lf jf lg jj lh jn kr ks kt ku bi translated">用<strong class="is hj"><em class="jo">‘ls’</em></strong>命令找出你安装了哪个文件，然后用<strong class="is hj"><em class="jo">‘sh’</em></strong>命令运行它，对我来说是这样的:</li></ul><pre class="lb lc ld le fd lr ls lt lu aw lv bi"><span id="46d2" class="jp jq hi ls b fi lw lx l ly lz">sh Anaconda3–2020.07-Linux-x86_64.sh</span></pre><ul class=""><li id="33aa" class="kk kl hi is b it iu ix iy jb lf jf lg jj lh jn kr ks kt ku bi translated">接受许可协议，接受默认安装位置，并在询问您是否要运行<code class="du ma mb mc ls b">conda init.</code>时回答“是”</li><li id="6b25" class="kk kl hi is b it kv ix kw jb kx jf ky jj kz jn kr ks kt ku bi translated">运行<strong class="is hj"> <em class="jo">源。bashrc' </em> </strong> <em class="jo"> </em>为了保证 python 的路径被配置好，现在你处于<em class="jo"/><strong class="is hj"><em class="jo">base</em></strong>Anaconda 环境<em class="jo">。</em></li><li id="82a5" class="kk kl hi is b it kv ix kw jb kx jf ky jj kz jn kr ks kt ku bi translated">运行<strong class="is hj"><em class="jo">‘康达停用’</em></strong>退出。</li></ul><h2 id="dae1" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">5-在 EC2 实例上安装和配置 PostgreSQL:</h2><ul class=""><li id="eac7" class="kk kl hi is b it km ix kn jb ko jf kp jj kq jn kr ks kt ku bi translated">要在实例上安装 PostgreSQL，请运行:</li></ul><pre class="lb lc ld le fd lr ls lt lu aw lv bi"><span id="771d" class="jp jq hi ls b fi lw lx l ly lz">sudo apt-get install postgresql postgresql-contrib</span></pre><ul class=""><li id="aaca" class="kk kl hi is b it iu ix iy jb lf jf lg jj lh jn kr ks kt ku bi translated">使用以下命令在 AWS 上的 PostgreSQL 上设置您的用户<code class="du ma mb mc ls b">ubuntu</code>:</li></ul><pre class="lb lc ld le fd lr ls lt lu aw lv bi"><span id="812d" class="jp jq hi ls b fi lw lx l ly lz">sudo -u postgres createuser --superuser ubuntu<br/>createdb</span></pre><ul class=""><li id="02a7" class="kk kl hi is b it iu ix iy jb lf jf lg jj lh jn kr ks kt ku bi translated">运行“psql”命令检查安装，然后运行“\q”退出。</li><li id="1613" class="kk kl hi is b it kv ix kw jb kx jf ky jj kz jn kr ks kt ku bi translated">要配置 PostgreSQL，运行以下命令，搜索<strong class="is hj"><em class="jo"># listen _ addresses = ' localhost '</em></strong>，将其更改为<strong class="is hj"><em class="jo">listen _ addresses = ' * '</em></strong>，然后保存并退出:</li></ul><blockquote class="li lj lk"><p id="085b" class="iq ir jo is b it iu iv iw ix iy iz ja ll jc jd je lm jg jh ji ln jk jl jm jn hb bi translated">sudo su-postgres<br/>nano/etc/PostgreSQL/10/main/PostgreSQL . conf</p></blockquote><ul class=""><li id="a0c5" class="kk kl hi is b it iu ix iy jb lf jf lg jj lh jn kr ks kt ku bi translated">我们将编辑另一个配置文件。在您的终端中运行以下命令</li></ul><pre class="lb lc ld le fd lr ls lt lu aw lv bi"><span id="9d63" class="jp jq hi ls b fi lw lx l ly lz">nano /etc/postgresql/10/main/pg_hba.conf</span></pre><p id="af84" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并搜索“IPv4 本地连接”。你应该有一条允许<code class="du ma mb mc ls b">127.0.0.1/32</code>连接的线路。在这一行下面，添加以下内容:</p><pre class="lb lc ld le fd lr ls lt lu aw lv bi"><span id="d8e0" class="jp jq hi ls b fi lw lx l ly lz">host    all             all             65.209.60.146/0         trust</span></pre><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/cba496212bd6778576880acbf6e34b43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sKsmdKufTFTCdgebbrTAUg.png"/></div></div></figure><ul class=""><li id="58f4" class="kk kl hi is b it iu ix iy jb lf jf lg jj lh jn kr ks kt ku bi translated">最后，我们使用<strong class="is hj"><em class="jo">【exit】</em></strong>命令退出 Postgres 用户，并使用以下命令重启 Postgres 服务器:</li></ul><pre class="lb lc ld le fd lr ls lt lu aw lv bi"><span id="1dba" class="jp jq hi ls b fi lw lx l ly lz">sudo service postgresql restart</span></pre><h2 id="e3bc" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">6-在 EC2 实例上创建一个新的 Anaconda 环境:</h2><ul class=""><li id="be6b" class="kk kl hi is b it km ix kn jb ko jf kp jj kq jn kr ks kt ku bi translated">我们用 Psycopg2、<strong class="is hj"><em class="jo">Python</em></strong>version<strong class="is hj"><em class="jo">3 . 7 . 7</em></strong>和<strong class="is hj"> <em class="jo"> Anaconda </em> </strong>包创建一个新的<strong class="is hj"> <em class="jo"> Anaconda </em> </strong>环境(顺序很重要)，然后我们用以下命令激活它:</li></ul><pre class="lb lc ld le fd lr ls lt lu aw lv bi"><span id="5380" class="jp jq hi ls b fi lw lx l ly lz">conda create --name newenv Psycopg2 python=3.7.7 anaconda<br/>conda activate newenv</span></pre><h2 id="49a6" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">7-在 AWS EC2 上配置 Jupyter:</h2><ul class=""><li id="500b" class="kk kl hi is b it km ix kn jb ko jf kp jj kq jn kr ks kt ku bi translated">第一次设置机器时，我们需要配置 Jupyter 以允许远程连接，并为 Jupiter 配置一个密码。在我们的实例中，我们运行:</li></ul><pre class="lb lc ld le fd lr ls lt lu aw lv bi"><span id="59bf" class="jp jq hi ls b fi lw lx l ly lz">jupyter notebook --generate-config<br/>jupyter notebook password</span></pre><h2 id="0492" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">8-在 EC2 上运行 Jupyter，并从您的本地机器创建隧道:</h2><ul class=""><li id="d29c" class="kk kl hi is b it km ix kn jb ko jf kp jj kq jn kr ks kt ku bi translated">我们使用以下命令在我们的实例上运行 Jupyter 笔记本，并且我们指定在我们的实例上没有带有<strong class="is hj"> <em class="jo"> no-browser </em> </strong>标志的浏览器:</li></ul><pre class="lb lc ld le fd lr ls lt lu aw lv bi"><span id="07e2" class="jp jq hi ls b fi lw lx l ly lz">jupyter notebook --no-browser</span></pre><ul class=""><li id="4cfb" class="kk kl hi is b it iu ix iy jb lf jf lg jj lh jn kr ks kt ku bi translated">我们打开另一个<strong class="is hj"><em class="jo">CMD</em></strong>or(Windows 终端)并使用以下命令在我们的本地机器和<strong class="is hj"> <em class="jo"> EC2 </em> </strong>实例之间创建一个隧道:</li></ul><pre class="lb lc ld le fd lr ls lt lu aw lv bi"><span id="cbba" class="jp jq hi ls b fi lw lx l ly lz">ssh myaws -L 8212:localhost:8888</span></pre><p id="cd45" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">其中<strong class="is hj"> <em class="jo"> 8121 </em> </strong>是我们要在本地机器上打开 Jupyter 笔记本的端口号，而<strong class="is hj"><em class="jo">localhost:8888</em></strong>是我们实例上的 out Jupyter 笔记本地址。</p><h2 id="0866" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated"><strong class="ak"> <em class="me"> 9-使用本地机器浏览器打开 Jupyter 笔记本:</em> </strong></h2><ul class=""><li id="a06a" class="kk kl hi is b it km ix kn jb ko jf kp jj kq jn kr ks kt ku bi translated">使用您选择的网络浏览器导航到<strong class="is hj"><em class="jo">localhost:8212</em></strong>地址，您应该看到 Jupyter 要求您输入密码，输入密码并开始编码😎。</li></ul></div><div class="ab cl mf mg gp mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hb hc hd he hf"><h1 id="af60" class="mm jq hi bd jr mn mo mp jv mq mr ms jz mt mu mv kc mw mx my kf mz na nb ki nc bi translated">在以下位置找到我:</h1><p id="172e" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb nd jd je jf ne jh ji jj nf jl jm jn hb bi translated"><strong class="is hj">LinkedIn:</strong><a class="ae lq" href="https://www.linkedin.com/in/yamenshaban/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/yamenshaban/</a><br/><strong class="is hj">GitHub:</strong><a class="ae lq" href="https://github.com/yamenkaba" rel="noopener ugc nofollow" target="_blank">https://github.com/yamenkaba</a></p></div></div>    
</body>
</html>