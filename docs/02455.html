<html>
<head>
<title>How fastai makes deep learning easy: classifying cancer cells using CNN</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">fastai如何让深度学习变得简单:使用CNN对癌细胞进行分类</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-fastai-makes-deep-learning-easy-classifying-cancer-cells-using-cnn-115520457733?source=collection_archive---------12-----------------------#2019-12-17">https://medium.com/analytics-vidhya/how-fastai-makes-deep-learning-easy-classifying-cancer-cells-using-cnn-115520457733?source=collection_archive---------12-----------------------#2019-12-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4feb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章是为刚接触深度学习并正在寻找快速建立神经网络模型的人准备的。他们可能不一定来自数学或计算机科学背景，但有python经验，并对在自己的领域使用深度学习感兴趣。要知道在现实生活中，没有免费的饼干，深度学习也不例外，这一点很重要。是的，它如何工作的基础非常简单，但要真正理解深度学习，人们必须更深入地挖掘并超越基础。这可能很容易学，但是很难掌握。底线是，即使大多数在线课程或博客(包括这篇)可能会给你留下深度学习非常有趣和简单的印象，它只是为了激发兴趣，但人们应该永远记住，深度学习的核心是一件事，数学。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/7939b6d5f3e35b0901bf82821ab7aae4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*ecTZgpaeCMYSa_FN7TKNbQ.png"/></div></figure><p id="ea4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尽管如此，我们都需要从某个地方开始，所以我们不妨从利用像<strong class="ih hj"> fastai </strong>这样的框架开始，来帮助我们快速实现神经网络，这样我们就可以可视化正在发生的事情，并直观地了解深度学习如何在我们自己的领域中帮助我们。</p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><p id="7fab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">定义正在解决的问题:</strong></p><p id="cdb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于我来自生物医学背景，我显然对理解深度学习如何影响医学研究和治疗的未来更感兴趣。当大多数人想到医学技术的未来时，他们会想象机器人进行手术或治疗方案的突破，但实际上最需要的是诊断领域的创新，特别是病理学领域的创新。即使在今天，大多数病理学家仍然在各个实验室之间运行带有组织或液体样本的载玻片进行咨询，并且严重依赖于通过光学显微镜进行人工载玻片观察。这样确实效率不高，容易出错。因此，自动细胞分类是一项重要而又具有挑战性的计算机视觉任务，对生物医学具有重大意义。</p><p id="4882" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇博客中，我们将尝试使用<a class="ae js" href="https://github.com/fastai/fastai" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> fastai </strong> </a>库(感谢杰瑞米·霍华德和他在<a class="ae js" href="https://www.usfca.edu/data-institute" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">【USF】</strong></a>的团队)来构建一个图像分类器，它在分类任务中工作得非常好。我们将尝试复制杨玉久等人的工作。艾尔。在那里，他们提出了一种基于卷积神经网络(CNN)的方法，根据肌动蛋白丝组织对人类乳腺来源的细胞系进行分类。他们想要分类的细胞如下:</p><ol class=""><li id="e691" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">正常乳腺上皮细胞系，MCF-10A(非侵袭性)</li><li id="c3e6" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">乳腺癌细胞系，MCF-7(攻击性较低)</li><li id="01f1" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">MDA-MB-231(更具攻击性)</li></ol><p id="2d0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">他们收集了总共552幅图像，其中每幅图像包含至少三个单独的细胞，从而产生了超过1500幅单独的细胞图像(每种类型的细胞大约有500-600幅单独的细胞图像)。具体来说，MCF-10A、MCF-7和MDA-MB-231类分别包含182、186和184幅图像。这项工作的目标是在他们的数据集上训练一个卷积神经网络，并达到接近或接近最先进的结果。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es kh"><img src="../Images/c4cca78497766ac81ca8c3ff0106e5c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ye2eBqycLgv5wI0ijMthw.png"/></div></div><figcaption class="km kn et er es ko kp bd b be z dx translated"><strong class="bd kq">显示了由人类专家</strong>执行的细胞分类任务的混淆矩阵</figcaption></figure><p id="8118" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇博客文章展示了使用Fastai + Pytorch对他们的数据集进行的研究和分析，并作为参考、教程和开源资源提供给其他人参考。它并不打算成为严肃的临床应用的生产就绪资源。我们在这里使用的是原始高分辨率图像的低分辨率版本，用于教育和研究。这被证明是原型化和测试各种深度学习算法的有效性的有用基础。</p><p id="be1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇博文中，我们将分三步解决这个问题:</p><ol class=""><li id="2ebf" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">将数据加载到正确的格式</li><li id="7af5" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">创建我们的神经网络模型的实例并对我们的数据进行训练</li><li id="84b3" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">学习如何创建最终调整和调整以使模型更好</li></ol><p id="0198" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">加载我们的数据:</strong></p><p id="222f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们开始构建模型之前，重要的是我们要探索、准备和加载数据集，使之成为一种可以学习模型的格式。Fastai附带了一个惊人的<strong class="ih hj"> <em class="kr"> data_block api </em> </strong>，它允许我们从不同的来源加载数据。在这篇文章中，我将使用下载并保存在不同文件夹中的图片。文件夹的名称作为我们图像的标签值，我们在一个名为<strong class="ih hj"> classes </strong>的变量中指定。下面的代码显示了我们如何将图像加载到一种适合CNN模型的格式中。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es ks"><img src="../Images/2edf2e77b0ca87db537d415183138c0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6GkJW9ZePclf1BBwEi0QYQ.png"/></div></div></figure><p id="dd89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们可以检查我们的图像看起来如何</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es kt"><img src="../Images/bd26a37ed72b4d50d356ce7819bdc0a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PKPtBvVZLcyVF-OnpDiU9w.png"/></div></div></figure><p id="f58f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">创建我们的模型</strong></p><p id="7908" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们正确地设置了ImageDataBunch对象，我们现在就可以将它和预先训练的ImageNet模型一起传递给cnn_learner。下面一行实例化了我们将用来执行分类的模型。我们使用的Resnet模型将是imagenet数据库上的预训练模型。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es ku"><img src="../Images/6d58353d21f21ce6a6a91aacbb52ed78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v4zBcOd-WUlzyHuBZGNh-A.png"/></div></div></figure><p id="2eeb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在接下来的一行中，我们实际上继续前进并拟合模型。fastai库的组织方式我们通常只需要在3件事情中做出决定来构建最简单的模型。</p><ol class=""><li id="72fc" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">模型架构(在我们的例子中，我们使用<strong class="ih hj"> <em class="kr"> resnet34 </em> </strong>)</li><li id="da75" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">epoch(我们希望通过网络传递数据集的次数)</li><li id="aa29" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">学习率(决定步长的调整参数)</li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es kv"><img src="../Images/e8e398733f3200434523b7d1c703b4be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2IcNl_qcyZhlWdIozPO7bA.png"/></div></div></figure><p id="583c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以从3个纪元周期开始，看看我们的模型表现如何，我们得到以下输出</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/95e66b0a7be1767d53553816aac0bb8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*FKEksBtPvxMn01TUmZSfhg.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kx"><img src="../Images/4732fd34e5ac67146f9c1d88b936cd31.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*Ajyb6_IoJ9AmSbmxCCUSlQ.png"/></div></figure><p id="6f3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仅用3个周期，我们就设法得到小于7%的误差，这已经比人类专家的表现更好了。我们可以查看混淆矩阵以了解更多信息。我们的模型在识别正常细胞系方面是好的，但是在分类MCF-7和MDA-MD-231方面仍然不好。</p><p id="a9d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">微调我们的参数:</strong></p><p id="8b1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尽管我们有一个很好的模型，但我们可以做得更好。通常对于没有计算机科学背景的人来说，这往往是我们通过使用我们的领域专业知识而真正发光的部分。我们要做的第一件事是获得被错误预测的数据图像，并查看与每个图像相关的概率值。通过查看图像，我们可以尝试并了解哪里出了问题，然后尝试一些纠正方法。请查看fastai文档以了解更多信息。使用fastai库，我们只用一行代码就可以得到这些错误分类的图像。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es ky"><img src="../Images/a362e7ca7436293896473662db5cbc41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NRSwP3Rhq8EYigV5fFGg4g.png"/></div></div></figure><p id="0006" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们查看错误分类细胞的图像时，我们没有看到任何明显的模式。当细胞聚集在一起时，它们可能会导致我们的模型对它们进行错误分类，但至少在我们的情况下不是这样，因为我没有看到任何明显的模式。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es kz"><img src="../Images/3f985c5fb8292c74d715269dcaa49f0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-B5h4aRRzjgNO6nC738BvQ.png"/></div></div></figure><p id="617b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以尝试旋转我们的图像或进行一些图像增强或数据增强方法，但这似乎没有必要。我们可以试着把我们的错误率和学习率对应起来。对于神经网络来说，学习率基本上是网络抛弃旧信念以接受新信念的速度。</p><p id="c607" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果一个孩子看到10只猫，它们都有橙色的皮毛，她会认为猫有橙色的皮毛，并在试图识别一只猫时寻找橙色的皮毛。现在她看到一只黑猫，她的父母告诉她这是一只猫(监督学习)。有了较大的“学习率”，孩子会很快意识到“橙色皮毛”并不是猫最重要的特征。学习率小，她会认为这只黑猫是离群的，猫还是橙色的。</p><p id="97c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，简而言之，选择正确的学习率可以帮助训练我们的模型来发现异常值。我们可以使用fastai库只用几行代码就可以做到这一点，并获得学习率。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es la"><img src="../Images/fb54d8d098fe9163c2e0320d9e762c5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SACTEoi5g3QZzNmlglKXjg.png"/></div></div></figure><p id="cc3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们只在1个周期内训练我们的模型，因此我们可以看到错误率在一个周期内是如何变化的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lb"><img src="../Images/395673c764a6b478cb1d3e9654f2892b.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*4_bAmwT2EsjmJJ50o7xXiQ.png"/></div></figure><p id="2098" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到，我们的损失函数显示学习率在1e-5到1e-3之间急剧下降。这意味着，如果我们训练我们的模型，保持学习率在这些学习率之间，它可能会提高其性能。</p><p id="7569" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们再次拟合模型，但这一次为学习率设置了新的参数。我们的做法如下</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es lc"><img src="../Images/31c0752e3a607c2183898d40f53089da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q9DrZNxkkPOmfKBuLQbHtw.png"/></div></div></figure><p id="20b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们只需要在我们的函数中指定另一个名为max_lr的参数，并将学习率的值放在我们注意到最急剧衰减的地方。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ld"><img src="../Images/bdf4020e8f49a7c99a85eef2bbeeb1ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*fOwCcW3tT0RA7N86ExuODQ.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kx"><img src="../Images/63a845d3a43bf8e99764b29ff594916b.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*1-VtrpLPb1WFSQ1h-CufVw.png"/></div></figure><p id="23f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以这一次，仅仅用了两个周期，我们就成功地获得了大约98.2%的准确率。我们的模型可以有效地捕捉差异。唯一的不同是，这一次它设法错过了一个侵略性的细胞图像，并将其归类为正常的MCF-10A。所以还是有提升的空间。</p><h1 id="ba2d" class="le lf hi bd kq lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">参考资料:</h1><p id="b9a5" class="pw-post-body-paragraph if ig hi ih b ii mb ik il im mc io ip iq md is it iu me iw ix iy mf ja jb jc hb bi translated">Oei RW，Hou G，Liu F，Zhong J，Zhang J，An Z，等(2019)利用细胞内肌动蛋白网络的显微镜图像进行细胞分类的卷积神经网络。PLoS ONE 14(3): e0213626。https://doi.org/10.1371/journal.电话:0213626</p><p id="ce9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae js" href="https://www.fast.ai/" rel="noopener ugc nofollow" target="_blank"> fast.ai </a> —程序员实用深度学习在线课程</p></div></div>    
</body>
</html>