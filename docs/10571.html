<html>
<head>
<title>Django with PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django与PostgreSQL</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/django-with-postgresql-34092de124ab?source=collection_archive---------15-----------------------#2020-10-24">https://medium.com/analytics-vidhya/django-with-postgresql-34092de124ab?source=collection_archive---------15-----------------------#2020-10-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/c29f992c9f7cf7ddcb1be998d0c88103.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vEjyYEM2ycO_xpurqqbHig.png"/></div></div></figure><div class=""/><p id="57a7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是利用PostgreSQL作为数据库解决方案安装Django的实用指南。</p><p id="97b6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">关于Django安装步骤的详细指南，你也可以在Django网站上阅读官方文档:<a class="ae jo" href="https://docs.djangoproject.com/en/3.1/intro/install/" rel="noopener ugc nofollow" target="_blank">https://docs.djangoproject.com/en/3.1/intro/install/</a></p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="7532" class="jw jx ht bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">安装PostgreSQL</h1><p id="313e" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hb bi translated">首先，让我们用常用的快捷键CTRL+ALT+T打开一个新的终端会话。</p><p id="e704" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后只需粘贴以下代码:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="8327" class="li jx ht le b fi lj lk l ll lm"># Create the file repository configuration:<br/><strong class="le hu">sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" &gt; /etc/apt/sources.list.d/pgdg.list'</strong></span><span id="64c8" class="li jx ht le b fi ln lk l ll lm"># Import the repository signing key:<br/><strong class="le hu">wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -</strong></span><span id="9efa" class="li jx ht le b fi ln lk l ll lm"># Update the package lists:<br/><strong class="le hu">sudo apt-get update</strong></span><span id="a32f" class="li jx ht le b fi ln lk l ll lm">#Install the latest version of PostgreSQL.<br/># If you want a specific version, use 'postgresql-12' or similar instead of 'postgresql':<br/><strong class="le hu">sudo apt-get -y install postgresql</strong></span></pre><p id="045f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装后，使用以下命令登录数据库:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="2d9b" class="li jx ht le b fi lj lk l ll lm"><strong class="le hu">sudo -u postgres psql</strong></span></pre><p id="aacb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好的，没错！现在您已经登录，只需:</p><ul class=""><li id="e446" class="lo lp ht is b it iu ix iy jb lq jf lr jj ls jn lt lu lv lw bi translated">创建数据库；</li><li id="46d9" class="lo lp ht is b it lx ix ly jb lz jf ma jj mb jn lt lu lv lw bi translated">创建一个用户帐户，让它成为“Django友好的”；</li><li id="dcf4" class="lo lp ht is b it lx ix ly jb lz jf ma jj mb jn lt lu lv lw bi translated">授予用户访问数据库的特权。</li></ul><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="c420" class="li jx ht le b fi lj lk l ll lm"># create database<br/><strong class="le hu">CREATE DATABASE your-project-name;</strong></span><span id="0b90" class="li jx ht le b fi ln lk l ll lm"># create user<br/><strong class="le hu">CREATE USER your-username WITH PASSWORD 'your-password';</strong></span><span id="bf32" class="li jx ht le b fi ln lk l ll lm"># change user settings to be more "Django-friendly"<br/><strong class="le hu">ALTER ROLE your-username SET client_encoding TO 'utf8';</strong><strong class="le hu"><br/></strong><strong class="le hu">ALTER ROLE your-username SET default_transaction_isolation TO 'read committed';</strong><strong class="le hu"><br/></strong><strong class="le hu">ALTER ROLE your-username SET timezone TO 'UTC';</strong></span><span id="be4c" class="li jx ht le b fi ln lk l ll lm"># grant the user all the privileges on database<br/><strong class="le hu">GRANT ALL PRIVILEGES ON DATABASE your-project-name TO your-username;</strong></span></pre><p id="fbea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">设置PostgreSQL数据库的工作已经完成。退出即可:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="9cf5" class="li jx ht le b fi lj lk l ll lm"><strong class="le hu">\q</strong></span></pre><p id="9e1d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后使用以下命令关闭终端会话:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="900c" class="li jx ht le b fi lj lk l ll lm"><strong class="le hu">EXIT</strong></span></pre><h1 id="d371" class="jw jx ht bd jy jz mc kb kc kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt bi translated">安装虚拟环境</h1><p id="b5b8" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hb bi translated">总是建议在虚拟环境中安装Django。我强烈建议你去做。顺便说一下，最后这是你的项目，所以… <strong class="is hu"> <em class="mh">如果你想改变你的全球环境，你可以跳到本教程的下一步。</em>T5】</strong></p><p id="afac" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以这里的第一步是安装python3 venv包(假设你已经安装了python3)</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="1991" class="li jx ht le b fi lj lk l ll lm"># Install virtualenv<strong class="le hu"><br/>sudo apt-get install python3-venv</strong></span></pre><p id="606a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装完成后，只需为您的项目创建一个新环境</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="a3ed" class="li jx ht le b fi lj lk l ll lm"># create your virtual environment<strong class="le hu"><br/>python3 -m venv your-project-name_env</strong></span></pre><p id="25aa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您想利用所有已安装的软件包，请记住总是稍后启动您的虚拟环境。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="d6f3" class="li jx ht le b fi lj lk l ll lm"># activate your virtual environment<strong class="le hu"><br/>source /home/your-username/your-project-name_env/bin/activate</strong></span></pre><p id="0b66" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，您应该在用户名前的括号中看到(您的项目名称环境)。大概是这样的:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="195f" class="li jx ht le b fi lj lk l ll lm">(your-project_env) your-username@your-machine:~$</span></pre><h1 id="5eb6" class="jw jx ht bd jy jz mc kb kc kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt bi translated">安装Django</h1><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="c9eb" class="li jx ht le b fi lj lk l ll lm"># install Django<strong class="le hu"><br/>sudo apt install python3-django</strong></span></pre><p id="e782" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Django项目的默认数据库是SQLite，这对于测试来说很好，但对于生产模式来说不是最佳选择。</p><p id="6867" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了让PostgreSQL与Django配合使用，您需要安装<strong class="is hu"> pyscopg2 </strong>包(参见Django文档以获取更多信息:<a class="ae jo" href="https://docs.djangoproject.com/en/3.1/topics/install/#database-installation" rel="noopener ugc nofollow" target="_blank">https://docs . Django project . com/en/3.1/topics/install/# database-installation</a>)</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="051c" class="li jx ht le b fi lj lk l ll lm"># install pyscopg2 package</span><span id="87c7" class="li jx ht le b fi ln lk l ll lm"><strong class="le hu">sudo apt install python3-dev libpq-dev<br/>pip install psycopg2</strong></span></pre><p id="2ad8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用以下命令检查安装:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="091d" class="li jx ht le b fi lj lk l ll lm"># check Django version<strong class="le hu"><br/>python3 -m django –version</strong></span></pre><p id="e258" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在Django已经安装好了，是时候创建自己的全新Django项目了:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="486c" class="li jx ht le b fi lj lk l ll lm"># create Django project<strong class="le hu"><br/>django-admin startproject your-project-name</strong></span></pre><p id="6626" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在移动到项目文件夹(如果你想知道所有文件的意思，去Django文档:<a class="ae jo" href="https://docs.djangoproject.com/en/3.1/intro/tutorial01/" rel="noopener ugc nofollow" target="_blank">https://docs.djangoproject.com/en/3.1/intro/tutorial01/</a>)。</p><p id="f412" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并使用以下命令运行Django服务器:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="5931" class="li jx ht le b fi lj lk l ll lm"># run django server<strong class="le hu"><br/>python3 manage.py runserver</strong></span></pre><p id="0092" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您点击终端中的链接或复制并粘贴<a class="ae jo" href="http://127.0.0.1:8000/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:8000/ </a>您应该会看到以下内容:</p><figure class="kz la lb lc fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mi"><img src="../Images/c7648f902cf38905b95ce19a95e6139e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j3rpY41XjiKPqH4m7z3zRQ.png"/></div></div></figure><h1 id="d3bd" class="jw jx ht bd jy jz mc kb kc kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt bi translated">将Django连接到PostgreSQL</h1><p id="43f7" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hb bi translated">我们已经接近本教程的结尾了！前方最后一步！</p><p id="1475" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">转到您之前创建的Django项目文件夹:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="2b0c" class="li jx ht le b fi lj lk l ll lm"># open django project folder<strong class="le hu">:<br/>cd path/to/your-django-project</strong></span><span id="5b1b" class="li jx ht le b fi ln lk l ll lm"># browse the files (you should find something like this):<br/><strong class="le hu">db.sqlite3  your-project-name  manage.py</strong></span><span id="ae90" class="li jx ht le b fi ln lk l ll lm"># go to the sub-folder your-project-name:<br/><strong class="le hu">asgi.py  __init__.py  __pycache__  settings.py  urls.py  wsgi.py</strong></span></pre><p id="168f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">打开名为<strong class="is hu"> settings.py </strong>的文件:</p><p id="79fa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">滚动到数据库部分(你也可以用CRTL+F找到它),用你的数据库信息修改它:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="1e80" class="li jx ht le b fi lj lk l ll lm">DATABASES = {<br/>    'default': {<br/>        'ENGINE': 'django.db.backends.postgresql_psycopg2',<br/>        'NAME': 'your-project-name',<br/>        'USER': 'your-postgresql-username',<br/>        'PASSWORD': 'your-postgresql-password',<br/>        'HOST': 'localhost',<br/>        'PORT': '',<br/>    }<br/>}<br/></span></pre></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="7b8d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将数据库更改迁移到PostgreSQL并运行Django服务器，一切都将正常工作！</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="f1f2" class="li jx ht le b fi lj lk l ll lm"># apply database changes<strong class="le hu"><br/>python3 manage.py migrate</strong></span><span id="7236" class="li jx ht le b fi ln lk l ll lm"># start server<strong class="le hu"><br/>python3 manage.py runserver</strong></span></pre><p id="5a83" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">给你！！！恭喜你。</p></div></div>    
</body>
</html>