<html>
<head>
<title>Diabetes 130 US hospitals for years 1999–2008.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">1999年至2008年美国130家医院的糖尿病。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/diabetes-130-us-hospitals-for-years-1999-2008-e18d69beea4d?source=collection_archive---------1-----------------------#2020-12-29">https://medium.com/analytics-vidhya/diabetes-130-us-hospitals-for-years-1999-2008-e18d69beea4d?source=collection_archive---------1-----------------------#2020-12-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="cd19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">我们能预测患者是否会再次入院吗？？</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/182975ee720615cbce51b7facca479dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4cmF9SaCjxtpWRshsrQqFw.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">糖尿病</figcaption></figure><p id="66eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇博客中，我将解释我如何创建机器学习模型，该模型可以使用130家美国医院的糖尿病数据集预测患者在30天内是否会再次入院。</p><h1 id="0d85" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">目录:</h1><ul class=""><li id="b16d" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated">引言。</li><li id="18bc" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">业务问题和限制。</li><li id="9d87" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">数据概述和ML公式。</li><li id="5b22" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">绩效指标。</li><li id="af29" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">数据预处理。</li><li id="c99c" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">特征工程和使用领域知识。</li><li id="d65d" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">探索性数据分析。</li><li id="752e" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">EDE与特征工程概述。</li><li id="721e" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">训练不同的模型。</li><li id="ece9" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">车型对比。</li><li id="0c57" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">模型部署</li><li id="a24b" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">结论。</li><li id="36a4" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">未来的工作。</li><li id="8cf7" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">未来连接的配置文件。</li><li id="dda8" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">参考文献。</li></ul><h1 id="d0a3" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">1.介绍</h1><p id="904d" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">糖尿病是一种慢性疾病，患者体内的血糖水平持续升高。糖尿病受身高、种族、性别、年龄的影响，但一个主要原因被认为是糖浓度。目前对一个大型临床数据库的分析是为了检查美国医院收治的糖尿病患者的糖尿病治疗的历史模式，并为可能改善患者安全性的未来方向提供信息。减少早期再住院是旨在提高医疗质量的政策重点。在这个案例研究中，我们将看到机器学习如何帮助我们解决因重新入院而导致的问题。</p><h1 id="76e1" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">2.业务问题和限制</h1><p id="63ed" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">据估计，美国9.3%的人口患有糖尿病，其中28%未确诊。糖尿病患者30天再入院率为14.4 ~ 22.7%。出院后超过30天的再入院率估计甚至更高，超过26 %的糖尿病患者在3个月内再入院，30 %在1年内再入院。在美国，与糖尿病患者住院治疗相关的费用为1240亿美元，其中估计250亿美元可归因于30天的再入院，假设再入院率为20 %。因此，减少糖尿病患者30天的再入院有可能大大降低医疗成本，同时改善护理。</p><h1 id="fe26" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">约束条件:</h1><ul class=""><li id="315e" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated">在医疗保健领域，可解释性一直很重要。如果模型预测到一些患者会再次入院，但无法解释为什么会得出这一结论，医生将对此类决定一无所知，而且医生也无法告诉患者他为什么需要再次入院。实际上，这将给医生和患者带来诸多不便。</li><li id="5011" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><code class="du ll lm ln lo b">Latency is not strictly important</code>大多数医疗保健相关应用都不依赖于延迟。</li><li id="6f27" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">如果不需要再次入院的患者同意再次入院，这将给患者带来经济负担。如果患者需要再次入院，但模型说“不允许再次入院”，那么这将导致医院的再次入院成本，因此，误诊率应尽可能低。</li></ul><h1 id="4e53" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">3.数据概述和ML公式</h1><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lp"><img src="../Images/6a003357bc651bb6a5ac7eb0b259950e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6cesLV-Ka-pWwZtpNx_j-g.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">Dibetis Kaggle数据集</figcaption></figure><p id="842b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">健康事实数据库(Cerner Corporation，Kansas City，MO)，一个全国性的数据仓库，收集美国各医院的综合临床记录。实际的数据库包含所有患者的数据，但特别是我想处理与糖尿病相关的数据，所以我使用了使用下面提到的五个标准过滤的数据，这些数据可在UCI机器学习资源库链接中获得:<a class="ae lq" href="https://archive.ics.uci.edu/ml/datasets/diabetes+130-us+hospitals+for+years+1999-2008" rel="noopener ugc nofollow" target="_blank">数据链接</a></p><ul class=""><li id="68b6" class="ks kt hi ih b ii ij im in iq lr iu ls iy lt jc kz la lb lc bi translated">这是住院病人的遭遇(住院)</li><li id="a4cc" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">这是一次“糖尿病”遭遇，也就是说，在此期间，任何类型的糖尿病都被输入系统作为诊断。</li><li id="fb5d" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">停留时间最少为1天，最多为14天。</li><li id="4fef" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">遭遇期间进行了实验室测试。</li><li id="f655" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">在遭遇期间进行了药物治疗。发现近10万条记录满足上述五个标准，数据集有55个特征，如性别、体重、遭遇id、再次入院。数据集可用于分类和聚类任务。我将用它来预测患者是否会在30天内再次入院。这是一项分类任务。</li></ul><p id="bbec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们提供了每个特性的简短描述。</p><ul class=""><li id="e61e" class="ks kt hi ih b ii ij im in iq lr iu ls iy lt jc kz la lb lc bi translated"><strong class="ih hj">遭遇ID </strong>遭遇的唯一标识符</li><li id="8794" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">患者编号</strong>患者的唯一标识符</li><li id="5db7" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">种族</strong>价值观:高加索人、亚洲人、非裔美国人、西班牙人和其他人</li><li id="e37c" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">性别</strong>值:男性、女性、未知/无效</li><li id="df6a" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">年龄</strong>以10年为间隔分组:0，10)，10，20)，…，90，100)</li><li id="ea23" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">重量</strong>重量单位为磅</li><li id="6319" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">入院类型</strong>对应9个不同值的整数标识符，例如，急诊、紧急、择期、新生儿和不可用</li><li id="67f5" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">出院处置</strong>对应29个不同值的整数标识符，例如，出院回家、过期、不可用</li><li id="0f88" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">入院来源</strong>对应于21个不同值的整数标识符，例如，医生转诊、急诊室和转院</li><li id="0c27" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">住院时间</strong>入院和出院之间的整数天</li><li id="d754" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">付款人代码</strong>对应23个不同值的整数标识符，例如，蓝十字/蓝盾、医疗保险和自费医疗保险</li><li id="79d9" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">医疗专业</strong>入院医生专业的整数标识符，对应84个不同的值，例如，心脏病学、内科、家庭/全科和外科医生</li><li id="cab6" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">实验室程序数量</strong>遭遇战期间进行的实验室测试数量</li><li id="b775" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">程序数量</strong>在遭遇中执行的程序的数字数量(除了实验室测试)</li><li id="e488" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">药物数量</strong>遭遇期间使用的不同通用名的数量</li><li id="2a10" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">门诊人次</strong>患者在就诊前一年的门诊人次</li><li id="f737" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">急诊次数</strong>患者在就诊前一年的急诊次数</li><li id="a0c7" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">住院人次</strong>患者在就诊前一年的住院人次</li><li id="84cd" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">诊断1 </strong>主要诊断(编码为ICD9的前三位)；848个不同的值</li><li id="92c8" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">诊断2 </strong>二级诊断(编码为ICD9的前三位)；923个不同的值</li><li id="e692" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">诊断3 </strong>附加二级诊断(编码为ICD9的前三位)；954个不同的值</li><li id="ef79" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">诊断数量</strong>输入系统的诊断数量为0%</li><li id="a640" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">葡萄糖血清测试结果</strong>表示结果的范围或是否未进行测试。值:"&gt; 200 "，" T39】 300 "，"正常"，如果没有测量则为"无"</li><li id="a7b8" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj"> A1c测试结果</strong>表示结果的范围或是否未进行测试。值:如果结果大于8%，则为“&gt;8”；如果结果大于7%但小于8%，则为“&gt;7”；如果结果小于7%，则为“正常”；如果未测量，则为“无”。</li><li id="6be2" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">药物变更</strong>表示糖尿病药物(剂量或通用名)是否有变更。价值观:“改变”和“不改变”</li><li id="781e" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">糖尿病药物</strong>显示是否开有任何糖尿病药物。值:“是”和“否”</li><li id="05dc" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">24种不同的药物。</li><li id="4490" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">再入院</strong>天为住院患者再入院。值:如果患者在30天内再次入院，则为“❤0”；如果患者在30天以上再次入院，则为“30”；如果没有再次入院记录，则为“否”</li></ul><h1 id="af63" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">4.性能指标</h1><p id="8375" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我们的任务是一个分类问题，因此我们可以使用性能指标，如<em class="jd">精确度、召回率、准确度</em>和<em class="jd"> F1得分。</em></p><h2 id="bacd" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">1)精度:</h2><p id="75a3" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">精度为(TP/TP+FP)其中TP为真阳性，FP为假阳性，我们可以将精度视为模型预测为阳性的所有点中有多少点确实是阳性点。当误报成本很高时，精确度是一个很好的衡量标准，在我们的案例研究中就是这种情况。对于不需要再次入院的患者，如果我们的模型预测患者需要再次入院，这是假阳性的，那么医院将让该患者留在医院，这增加了住院成本。</p><h2 id="8e63" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">2)回忆:</h2><p id="1ba4" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">召回率为(TP/TP + FN)其中TP为真阳性，FN为假阴性，我们可以将召回率视为实际为阳性的所有点中有多少点被模型预测为阳性。当假阴性成本很高时使用召回，这里的情况就是如此。对于需要再次入院的患者，如果模型预测不需要，那么医院会让他出院，但患者最终会再次入院，这增加了成本。</p><h2 id="7e78" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">3)谐波_ F1 _分数:</h2><p id="eceb" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">如上所述，我们知道假阴性成本和假阳性成本对我们来说都很重要，因此如果我们有一个将两者结合起来的衡量标准，那将是一件好事。F1-score对我们来说也是如此；它将查全率和查准率结合成一个等式。</p><blockquote class="mi mj mk"><p id="a909" class="if ig jd ih b ii ij ik il im in io ip ml ir is it mm iv iw ix mn iz ja jb jc hb bi translated">F1_score = (2 *精度*召回)/(精度+召回)</p></blockquote><p id="2b04" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的案例中存在不平衡数据的问题。经过仔细分析，我们发现微观的、宏观的F1分数对于处理不平衡的数据是没有用的。精度和召回率调和平均被用来处理精度和召回率之间的折衷。这里，我们处于相同的情况，我们希望对应于多数类的F1_score不应该支配我们的性能度量，因此我们可以考虑取各个类的F1 _ score的调和平均值。</p><blockquote class="mi mj mk"><p id="3793" class="if ig jd ih b ii ij ik il im in io ip ml ir is it mm iv iw ix mn iz ja jb jc hb bi translated">harmonic _ F1 _ score =(2 * F1 _ class 0 * F1 _ class 1)/(F1 _ class 0+F1 _ class 1)</p></blockquote><h2 id="af1f" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">4)AUC:</h2><p id="47bb" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">使用单个阈值来计算正常精度和召回率。这个单一的阈值可能不能正确地对所有的点进行分类。AUC只不过是ROC曲线下的面积，ROC曲线是通过计算FPR和TPR并将它们分别放在x和y轴上而绘制的。因此，AUC在计算FPR和TPR列表时采用了所有可能的阈值，从而向我们揭示了该模型的真正威力。</p><h1 id="c411" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">5.数据预处理</h1><p id="7375" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">首先让我们导入所有必需的库，</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="085c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据存储在驱动器中的“糖尿病数据. csv”文件中，让我们使用pandas.read_csv方法读取它。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mq"><img src="../Images/d150a757e735eb6786942769568cb3d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3K_PyT13BH6obKTSUAFbow.png"/></div></div></figure><h2 id="9b76" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">1.年龄特征:</h2><p id="a53a" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">年龄的值给定为[0–10]，[10–20]，[20–30]年龄特征不是分类的，而是顺序的，因此我们应该将其转换为数字，并将其视为数字特征。我们正在将年龄特征转换为数字特征，如下所示:</p><p id="2f4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">[0–10) → 5, [10–20) → 15, [20–30) — -&gt; 25</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><h2 id="c20a" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">2.处理重复记录:</h2><p id="ba33" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我们发现，对于某些患者，数据集中有许多条目，这些重复条目对解决任务没有帮助，因此我们删除了这些条目。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><h2 id="b4e6" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">3.转换和合并成更少的类别:</h2><p id="a15d" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我们执行了一些转换，如UP → 10，Down → -10。同样，我们还将类似的类别合并为单个类别，如入院来源id [2，3] → 1，[5，6，10，22，25] → 4。这些转换和合并过程是不言自明的，您可以通过下面的代码片段来理解转换和合并过程。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><h2 id="0ea9" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">4.处理缺失值:</h2><p id="6b72" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">此数据集中缺少的值用“？”表示。只有极少数列有缺失值。这些是，</p><blockquote class="mi mj mk"><p id="182a" class="if ig jd ih b ii ij ik il im in io ip ml ir is it mm iv iw ix mn iz ja jb jc hb bi translated">种族'，'体重'，'付款人_代码'，'医疗_专业'，'诊断_1 '，'诊断_2 '，'诊断_3 '</p></blockquote><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mr"><img src="../Images/fc8019a65b1085a7988fc993e39834bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*mm_sPWMo2sWnRz6k6DG6eQ.png"/></div></figure><p id="a3b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到权重特征有许多缺失值，所以我们选择删除它，对于diag_1、diag_2、diag_3，我们使用最常见的值来填充缺失值。</p><pre class="jf jg jh ji fd ms lo mt mu aw mv bi"><span id="c49b" class="lu jv hi lo b fi mw mx l my mz">diag_1 = Counter(list(data[‘diag_1’])).most_common(1)[0][0]<br/>diag_2 = Counter(list(data[‘diag_2’])).most_common(1)[0][0]<br/>diag_3 = Counter(list(data[‘diag_3’])).most_common(1)[0][0]</span><span id="2612" class="lu jv hi lo b fi na mx l my mz">data[‘diag_1’] = data[‘diag_1’].apply(lambda x : diag_1 if x == ‘?’ else x)<br/>data[‘diag_2’] = data[‘diag_1’].apply(lambda x : diag_2 if x == ‘?’ else x)<br/>data[‘diag_3’] = data[‘diag_3’].apply(lambda x : diag_3 if x == ‘?’ else x)</span></pre><p id="bf95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了填充medical_specialty的缺失值，我们创建了新的类别“缺失”和“种族”特征的缺失值通过使用模型插补来填充。我们用五个类训练了一个随机森林模型，</p><blockquote class="mi mj mk"><p id="a6e6" class="if ig jd ih b ii ij ik il im in io ip ml ir is it mm iv iw ix mn iz ja jb jc hb bi translated">西班牙裔'，'亚裔'，'高加索人'，'其他'，'非裔美国人'</p></blockquote><p id="698d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们保留了对应于种族值= '？'的行作为测试集，在训练RF模型时，还保留了“重新接纳”类别标签作为特征之一。训练之后，我们将测试数据输入到模型中，并得到了比赛标签。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><h1 id="6d7d" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">6.特征工程和使用领域知识。</h1><h2 id="2850" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">6.1)利用医学专业领域知识:</h2><p id="9095" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">经过研究，我们发现医疗专业是一个重要的功能，但是它有太多不同的值，所以当我们应用一个热编码时，它会不必要地创建许多功能。为了将他们分成更小数量的类别，我们使用了基于频率的方法和领域知识，像所有类型的外科医生都应该放在“外科医生”类别下。我们未能对以下医疗专业进行分组，因此我们将它们归入“未分组”类别。</p><ul class=""><li id="17c3" class="ks kt hi ih b ii ij im in iq lr iu ls iy lt jc kz la lb lc bi translated">内分泌学→腺体、胃肠病学→胃、妇科→女性生殖系统、血液学→血液</li><li id="8a04" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">血液学/肿瘤学→血液，住院医师→照顾入院患者的人，肿瘤学→癌症，眼科→眼，耳鼻喉科→耳，鼻，喉</li><li id="bcc4" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">肺科→呼吸科、放射科——使用医学成像(放射学)程序(检查/测试)如x光来诊断和治疗损伤和疾病</li></ul><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><h2 id="5fed" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">6.2)使用关于诊断1、诊断2和诊断3的领域知识:</h2><p id="565d" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">diag_1、diag_2、diag_3是分类特征，但是这些特征具有许多唯一的值。如果我们直接应用一个热编码，它将产生许多特征，最终将引发“维数灾难”问题。我们将使用描述文件中提供的领域知识来创建更少的类别。</p><p id="971d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.循环系统→390–459，785 →循环系统疾病<br/> 2。呼吸→460–519，786 →呼吸系统疾病<br/> 3。消化→520–579，787 →消化系统疾病<br/> 4。糖尿病→ 250.xx →糖尿病<br/> 5。伤害→800–999→伤害和中毒<br/> 6。肌肉骨骼→710–739→肌肉骨骼系统和结缔组织疾病<br/> 7。泌尿生殖系统→580–629，788 →泌尿生殖系统疾病<br/> 8。肿瘤→140–239→肿瘤<br/> 9。怀孕→630–679→妊娠、分娩和产褥期并发症<br/> 10。其他的</p><p id="f005" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将怀孕作为一个类别添加到原始描述文件中，并将其保存在“其他”类别中，但从研究中我们发现，怀孕会产生独特类型的糖尿病，因此将其作为单独的类别是有意义的。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><h2 id="292a" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">6.3)创建新特征:</h2><p id="7bfa" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我们删除了一些特征，如“遭遇id”、“患者编号”、“付款人代码”和“体重”，它们在我们的分析中并不重要。</p><h2 id="625e" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">3.1)健康指数:</h2><p id="7b18" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">如果一个人去医院的频率很高，那么我们可以认为这个人不太健康，不太健康的病人往往会很快再次入院。让我们创建健康指数变量。健康指数越高，患者再次入院的机会越小(间接比例)</p><blockquote class="mi mj mk"><p id="b4b4" class="if ig jd ih b ii ij ik il im in io ip ml ir is it mm iv iw ix mn iz ja jb jc hb bi translated">健康指数= ( 1 /(急诊人数+住院人数+门诊人数) )</p></blockquote><h2 id="f95f" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">3.2)疾病的严重程度</h2><p id="bd6f" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">如果患者在医院呆了很长时间，并经历了许多复杂的测试，那么疾病的严重程度就很高，因此，让我们创建疾病的严重程度作为特征之一。为了得到概率解释，让它除以总值。</p><blockquote class="mi mj mk"><p id="cd60" class="if ig jd ih b ii ij ik il im in io ip ml ir is it mm iv iw ix mn iz ja jb jc hb bi translated">疾病严重程度=(住院时间+手术次数+药物治疗次数+实验室手术次数+诊断次数)</p></blockquote><h2 id="1ed6" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">3.3)变更次数</h2><p id="b197" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">研究发现，不断经历药物比例变化(上升/下降)的患者往往会再次入院，因此我们设计了一个名为“变化次数”的新变量。这反映了比例发生变化的药物的数量。我们对每个病人都进行了计算。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><h2 id="9a77" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">6.4)使用卡方检验去除最不重要的分类特征:</h2><ul class=""><li id="5d6a" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated">卡方检验用于检验两个分类特征是否有某种关系。在这里，我们希望特征与类标签有一些关系，如果一些特征与类标签没有关系，那么移除它们是有意义的。卡方在内部执行假设检验，并给出p值，使用该p值，我们可以删除一些不重要的特征。我们将显著性水平/alpha保持为0.4，也就是说，如果有超过60%的可能性该特征是重要的，那么只有我们将该特征保留在我们的最终特征集中。</li></ul><pre class="jf jg jh ji fd ms lo mt mu aw mv bi"><span id="81eb" class="lu jv hi lo b fi mw mx l my mz">categorical_features = [‘gender’, ‘admission_type_id’, ‘discharge_disposition_id’, ‘admission_source_id’, ‘medical_specialty’, ‘diag_1’, ‘diag_2’, ‘diag_3’, ‘readmitted’]</span></pre><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><h2 id="d076" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">6.5)使用Spearman相关系数移除最不重要的数字特征</h2><ul class=""><li id="573b" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated">让我们使用Spearman相关系数来检查数字特征和重新接纳列是相关的还是独立的。如果发现一些特征与重新接纳无关，我们将简单地删除它们。</li><li id="2c05" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">我们发现相关性总是接近于零，但是，Spearman没有捕捉到非线性关系，因此，我们将使用p值而不是相关系数来获得“拒绝的特征列表”,这里假设检验是在假设变量独立时进行的。让我们将显著性水平/alpha设置为0.4。现在，我们可以通过声明p值&gt; alpha的要素在统计上独立于类别标签“重新允许”来移除它们。</li></ul><pre class="jf jg jh ji fd ms lo mt mu aw mv bi"><span id="01fb" class="lu jv hi lo b fi mw mx l my mz">numeric_features = [‘age’,’time_in_hospital’, ‘num_lab_procedures’, ‘num_procedures’, ‘num_medications’, ‘number_outpatient’, ‘number_emergency’, ‘number_inpatient’, ‘number_diagnoses’, ‘health_index’, ‘severity_of_disease’, ‘number_of_changes’, ‘A1Cresult’,‘max_glu_serum’,‘metformin’,’repaglinide’,’nateglinide’,’chlorpropamide’,’glimepiride’,’acetohexamide’,‘glipizide’,’glyburide’,’tolbutamide’,’pioglitazone’,’rosiglitazone’,’acarbose’,’miglitol’,‘troglitazone’,’tolazamide’,’examide’,’citoglipton’,’insulin’,’glyburide-metformin’,’glipizide-metformin’,‘glimepiride-pioglitazone’,’metformin-rosiglitazone’,’metformin-pioglitazone’, ‘change’, ‘diabetesMed’]</span></pre><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="b0b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们将保留以构建模型的最终功能列表:</p><pre class="jf jg jh ji fd ms lo mt mu aw mv bi"><span id="5b76" class="lu jv hi lo b fi mw mx l my mz">[‘gender’, ‘age’, ‘admission_type_id’, ‘discharge_disposition_id’, ‘admission_source_id’, ‘time_in_hospital’, ‘medical_specialty’, ‘num_lab_procedures’, ‘num_procedures’, ‘num_medications’, ‘number_outpatient’, ‘number_emergency’, ‘number_inpatient’, ‘diag_1’, ‘diag_2’, ‘diag_3’, ‘number_diagnoses’, ‘max_glu_serum’, ‘A1Cresult’, ‘metformin’, ‘repaglinide’, ‘nateglinide’, ‘chlorpropamide’, ‘glipizide’, ‘glyburide’, ‘tolazamide’, ‘insulin’, ‘change’, ‘diabetesMed’, ‘race’, ‘health_index’, ‘severity_of_disease’, ‘number_of_changes’]</span></pre><h1 id="71d1" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">7.探索性数据分析</h1><h2 id="a592" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">1.不平衡的数据:</h2><p id="a096" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">从图中我们可以清楚地看到，我们有91.2%的数据点属于0类，其余属于1类。我们有数据不平衡的问题。</p><div class="jf jg jh ji fd ab cb"><figure class="nb jj nc nd ne nf ng paragraph-image"><img src="../Images/e320250c5a0109906b4d12fb0248fba5.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*ADy4U1tG1rsORs-THcGt7Q.png"/></figure><figure class="nb jj nh nd ne nf ng paragraph-image"><img src="../Images/184331bece7ab0c34307c016c797b2ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:496/format:webp/1*mpP6ZVo7hyxwQY_teyLOdw.png"/></figure></div><h2 id="4394" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">2.出院处置ID:</h2><p id="ec45" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">从图表中可以清楚地看出，如果出院处置id为18，患者将不会再次入院。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ni"><img src="../Images/c7385d159279075643e11375ccea0100.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*-gS9saeBAHCQw3u4AoHeCQ.png"/></div></figure><h2 id="0af0" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">3.录取来源ID:</h2><p id="06a2" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">大多数再次入院的患者的入院来源为1，因此如果某个患者的来源id为1，他更有可能再次入院。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ni"><img src="../Images/9389e356af2d2250511d93e453942819.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*Eo2WjQwlOCdlNLiLv1CZhg.png"/></div></figure><h2 id="3eb7" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">4.糖尿病药物:</h2><p id="f4fc" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">该特征告知患者是否服用了糖尿病药物。在我们的数据集中，服用糖尿病药物并“再次入院”的患者数量几乎与服用糖尿病药物并“未再次入院”的患者数量相同。但是，通过与其他功能交互，糖尿病医学可能会揭示许多对给定任务有用的信息。</p><div class="jf jg jh ji fd ab cb"><figure class="nb jj nj nd ne nf ng paragraph-image"><img src="../Images/a5616bd608a018a9e69e655218e5634b.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*Qiz3MbSPX9QYssiWR_uswA.png"/></figure><figure class="nb jj nj nd ne nf ng paragraph-image"><img src="../Images/02441aba0811c5f944d22b18ec75b6d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*iGUVItUtfJs1_8gDQFGSMA.png"/></figure></div><h2 id="0b84" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">5.实验室程序的数量:</h2><p id="55a1" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">再次入院和未再次入院患者的实验室程序分配号完全相同。但是它有很高的方差。高方差特征被认为是信息丰富的特征。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es nk"><img src="../Images/62764b917a7d831dba2507895aa0a963.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*_rmalF0UXMuNogpr0wrQig.png"/></div></figure><h2 id="c7d6" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">6.在变化和糖尿病之间:</h2><p id="4871" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">从饼状图可以清楚地看出，如果患者的药物治疗没有变化，并且没有服用任何糖尿病药物，那么他比服用了糖尿病药物但药物治疗没有变化的患者有更多的机会再次入院。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><div class="jf jg jh ji fd ab cb"><figure class="nb jj nj nd ne nf ng paragraph-image"><img src="../Images/5a387fe46a6288ca3d77200771f7fb7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/format:webp/1*RQiCqijy3aseSL8ltHK5Nw.png"/></figure><figure class="nb jj nj nd ne nf ng paragraph-image"><img src="../Images/8c0ad2becdb4b55a2222622021a21eab.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/format:webp/1*QFOTlOyQ4BqX3b0tP_PDDw.png"/></figure></div><h2 id="65d9" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">7.在住院时间和年龄之间:</h2><p id="3a14" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">大多数病人年龄较大。再次入院的患者年龄较大，住院时间较长。未再次入院的患者住院时间减少。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es nl"><img src="../Images/5c2c08cc42df6e7e54d769579c87bf98.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*RAgu3pNiAni1M7FXefEpMw.png"/></div></figure><h2 id="e0fe" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">8.年龄和人数之间_住院患者:</h2><p id="8d61" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">越年轻的人越倾向于住院。对于[20-30]年龄组，再次入院的患者具有较高的住院特征值</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es nl"><img src="../Images/90982f3357bcb4b5a3f8cef3992dac81.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*N2CHfV3X5fCb5SKPu_VfrQ.png"/></div></figure><h2 id="dbeb" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">9.在入院来源标识和变更之间:</h2><p id="ffe9" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">从饼图中我们可以推断，如果有源id = 4患者，且变化特征的值为“否”，那么该患者比入院id为[1，9]的患者有更少的再次入院的机会，并且没有变化。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><div class="jf jg jh ji fd ab cb"><figure class="nb jj nm nd ne nf ng paragraph-image"><img src="../Images/bfad090d1237bc4cee53c116c5d40017.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/format:webp/1*dq5Nxf082IBe7Kaow3StIw.png"/></figure><figure class="nb jj nm nd ne nf ng paragraph-image"><img src="../Images/3c0737a0e7574a6c5c0ecb035c701ac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/format:webp/1*OZiJbXbPqY-qdVD0Ni6YGg.png"/></figure><figure class="nb jj nm nd ne nf ng paragraph-image"><img src="../Images/de1f69f5758832ec469d66ce379666d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/format:webp/1*boiiWHoxZaUtceWypi2axA.png"/></figure></div><h2 id="623c" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">10.特征子集之间的配对图:</h2><p id="6c31" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">从图中我们可以清楚地看到，这个问题是严格非线性的，因为+ve和-ve数据点像疯了一样混杂在一起。只有复杂的非线性函数才能解决仅考虑两个特征时的问题。如果我们希望它使用两个特征来解决它，我们必须进行数学变换，希望它可以将决策边界从复杂的非线性函数转换为线性函数。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es nn"><img src="../Images/052f18a74bda2b90563e0d581fa46c7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yN9wF4d6HkvdFYlH4aPxzQ.png"/></div></div></figure><h1 id="7a57" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">8.EDA与特征工程综述</h1><ul class=""><li id="8b14" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated">从EDA中我们了解到，实验室程序的数量、糖尿病药物治疗、入院等功能在我们的任务中非常重要。像“变化+糖尿病”、“年龄+住院时间”、“年龄+不耐烦次数”和“变化+入院来源id”这样的特征组合可以给我们提供许多在给定任务中有帮助的信息。</li><li id="dfb2" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">我们尝试了基于模型的插补来填充缺失值，但发现应使用基于模型的方法来插补具有非常少的不同值的特征，因此我们使用基于模型的插补来仅填充种族特征的缺失值。</li><li id="db5f" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">在change、insulin等列的特征工程中，我们没有稳定的值，但是经过实验，我们发现将它们转换成数字是个好主意。</li><li id="2182" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">首先，我们保持分类值不变，但使用这种方法，我们得到了非常低的AUC，因此，我们使用领域知识来减少分类特征的不同类别，这实际上提高了准确性。</li><li id="97f8" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">开始时，我们包含了所有的特性，而大多数特性对于给定的任务并不重要。因此，我们使用皮尔逊相关系数和卡方检验来消除不必要的特征，这提高了我们的模型的准确性。</li></ul><h1 id="07ec" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">9.培训不同的模型:</h1><p id="41b2" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">为了处理不平衡的数据，我们尝试了不同的技术，如欠采样，过采样，SMOTE。我们还尝试结合SMOTE和过采样。我们观察到“过采样技术”与其他技术相比表现良好。我们培训了大约8到10个不同的模型，这里我们将只展示表现良好的前4个模型。对于所有模型，我们保持训练数据大小= 0.8，有效数据大小= 0.1，测试数据大小= 0.1，除了完全遵循不同方法的定制集合模型。我不会解释“模型的工作”和“每个超参数的含义”，你可以在模型的官方文档中读到它们。</p><h2 id="8da5" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">9.1)逻辑回归:</h2><ul class=""><li id="59ea" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated">调整线性回归模型</li></ul><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><ul class=""><li id="a891" class="ks kt hi ih b ii ij im in iq lr iu ls iy lt jc kz la lb lc bi translated">设置最佳超参数:</li></ul><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><ul class=""><li id="fac0" class="ks kt hi ih b ii ij im in iq lr iu ls iy lt jc kz la lb lc bi translated">结果:</li></ul><pre class="jf jg jh ji fd ms lo mt mu aw mv bi"><span id="95b7" class="lu jv hi lo b fi mw mx l my mz">AUC_LR = 0.6534044933934898 <br/>F1_POS = 0.22583926754832148 F1_NEG = 0.7950444384594667 HARMONIC_F1_LR = 0.3517584864826567</span></pre><h2 id="0f50" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">9.2)定制Ensembler型号:</h2><ul class=""><li id="23b4" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated">将整个数据集分为训练和测试(80–20)</li><li id="a4bf" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">80%的火车集合，我们把它分成D1和D2。(50–50).现在，在d1，通过替换取样，我们创建了D1、d2、d3…dk(k个样本)。然后，我们创建了“k”个模型，并对每个模型进行了训练，如模型1将在d1样本上进行训练，模型2将在d2样本上进行训练，等等。</li><li id="2ac0" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">在将D2集传递给这k个模型中的每一个之后，我们将从这k个模型中的每一个中获得对D2的k个预测。</li><li id="0b3f" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">使用这k个预测，我们创建了一个新的数据集(转换的D2)，对于D2，我们已经知道它的相应目标值，所以我们用这k个预测训练了一个元模型。</li><li id="4ea2" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">现在，对于模型评估，我们使用了我们保留的20%的数据作为测试集。</li><li id="ec92" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">我们针对基础模型的数量和每个子数据集中的样本数量(d1，d2，..) .调整后，我们得到n = 95，样本数= 5000为最佳值</li><li id="8d87" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">设置最佳超参数:</li></ul><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><ul class=""><li id="c216" class="ks kt hi ih b ii ij im in iq lr iu ls iy lt jc kz la lb lc bi translated">结果</li></ul><pre class="jf jg jh ji fd ms lo mt mu aw mv bi"><span id="ea61" class="lu jv hi lo b fi mw mx l my mz">AUC_CE = 0.6401524560504123 <br/>F1_POS = 0.23093156466686765 F1_NEG = 0.8567899848425309 HARMONIC_F1_CE = 0.3638060712869564</span></pre><h2 id="4310" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">9.3)催化增强:</h2><ul class=""><li id="b327" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated">调整CatBoost模型</li></ul><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><ul class=""><li id="68e5" class="ks kt hi ih b ii ij im in iq lr iu ls iy lt jc kz la lb lc bi translated">设置最佳超参数</li></ul><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><ul class=""><li id="2361" class="ks kt hi ih b ii ij im in iq lr iu ls iy lt jc kz la lb lc bi translated">结果</li></ul><pre class="jf jg jh ji fd ms lo mt mu aw mv bi"><span id="fab6" class="lu jv hi lo b fi mw mx l my mz">AUC_CAT = 0.650942309050603 <br/>F1_POS = 0.22088068181818182 F1_NEG = 0.8053584102200142 HARMONIC_F1_CAT = 0.3466796697524027</span></pre><ul class=""><li id="ef7a" class="ks kt hi ih b ii ij im in iq lr iu ls iy lt jc kz la lb lc bi translated">特性重要性:这里我们只显示了对CatBoost模型非常重要的前10个特性。</li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es no"><img src="../Images/a0f6fcbdc9f287257072cd0eb507a2c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*m118OFUER-yBU6tgBMCbHg.png"/></div></figure><h2 id="9cfd" class="lu jv hi bd jw lv lw lx ka ly lz ma ke iq mb mc ki iu md me km iy mf mg kq mh bi translated">9.4)随机森林:</h2><ul class=""><li id="ad66" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated">调谐RF模型</li></ul><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><ul class=""><li id="ed22" class="ks kt hi ih b ii ij im in iq lr iu ls iy lt jc kz la lb lc bi translated">设置最佳超参数</li></ul><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mo mp l"/></div></figure><ul class=""><li id="af48" class="ks kt hi ih b ii ij im in iq lr iu ls iy lt jc kz la lb lc bi translated">结果</li></ul><pre class="jf jg jh ji fd ms lo mt mu aw mv bi"><span id="35b0" class="lu jv hi lo b fi mw mx l my mz">AUC_RF = 0.6633526103243218 <br/>F1_POS = 0.23723723723723722 F1_NEG = 0.8221288515406163 Harmonic_F1_RF = 0.36821940867963326</span></pre><h1 id="728e" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">10.模型比较</h1><p id="d97d" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">从图中我们可以清楚地看到，随机森林和自定义系综都给出了非常好的调和F1分数。我们可以看到决策树的表现比所有其他模型都差。Logistic回归、AdaBoost、CatBoost的表现非常相似。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es np"><img src="../Images/b3afb51b370a20106e67c385227d7721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CoK8pBHnMXtwiOCyixhYcQ.png"/></div></div></figure><h1 id="1dfe" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">11.模型部署</h1><p id="72ad" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">人们经常忽略这一步，但它是数据科学生命周期中的重要一步。我将使用Flask和AWS EC2实例部署模型。</p><p id="9791" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">先决条件:</p><ul class=""><li id="974e" class="ks kt hi ih b ii ij im in iq lr iu ls iy lt jc kz la lb lc bi translated">关于AWS EC2实例的知识</li><li id="afb5" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">蟒蛇皮烧瓶</li><li id="bdaf" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">HTML，CSS，JavaScript</li><li id="763e" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">Linux命令，如ssh、scp</li></ul><p id="235a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">文件的结构</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es nq"><img src="../Images/467b171cbd9e6ed02f1ee2b7666dc530.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*UX-1jtowc_3mmUq7Froz_A.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">文件结构</figcaption></figure><p id="6734" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">scalers文件夹、original_column.pkl、rf_model.joblib、train_columns.txt和cat_model.joblib是保存的不同模型的参数，需要这些参数来缩放特征和预测最终结果。</p><p id="25a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">需要将所有html相关文件保存在模板文件夹中。index.html文件将提供包含年龄、胰岛素、医学专业、性别等字段表单。填写信息后，用户可以点击“提交预测”按钮查看预测。如果跳过一些值，它将采用默认值。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es nr"><img src="../Images/33a663c1df9996b04fb28cb0a1f2728f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TuYq5E5dtDjmqYb4hD8Qkw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">重新入院表格</figcaption></figure><p id="c7ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">表单中提供的值将被发送到调用“def final_prediction”函数的flask api的“/predict”路径。此函数使用request.form.get('age ')方法收集数据并创建dataframe。一旦数据以“数据帧”的形式可用，final_prediction将使用已保存的参数(在cat_model.joblib等文件中)来预测结果，并将类别标签发送到“show_result.html”文件。</p><p id="2afe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">show_result.html文件根据类别标签打印“患者将不会再次入院！！!"或“提醒患者将再次入院！！！!"</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ns"><img src="../Images/ba5caf2240e59b4abd3c4a834b4d3119.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fkiCcsHU4i9HOizSuaQNeg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">预言；预测；预告</figcaption></figure><p id="a1d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在AWS端，首先需要创建“ubuntu server”的免费ec2实例并启动它。确保您在安全组中将入站规则设置为“所有流量”、“所有端口”。你的应用需要低延迟。避免在“final_prediction”函数中重新加载已保存的权重。读取函数外的所有文件，否则会导致不良行为。</p><p id="342a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">成功创建EC2实例并与实例连接后，使用以下命令。</p><pre class="jf jg jh ji fd ms lo mt mu aw mv bi"><span id="be77" class="lu jv hi lo b fi mw mx l my mz">ssh -i "deployment.pem" ubuntu@ec2-3-21-156-107.us-east-2.compute.amazonaws.com</span></pre><p id="4ab3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用以下命令复制实例上的deployment_new文件夹:</p><pre class="jf jg jh ji fd ms lo mt mu aw mv bi"><span id="e1a3" class="lu jv hi lo b fi mw mx l my mz">scp -i "deployment.pem" -r deployment_new <a class="ae lq" href="mailto:ubuntu@ec2-3-21-156-107.us-east-2.compute.amazonaws.com" rel="noopener ugc nofollow" target="_blank">ubuntu@ec2-3-21-156-107.us-east-2.compute.amazonaws.com</a>:~/deployment_new</span></pre><p id="bdc4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个EC2实例可能没有运行app.py文件所需的所有库。使用pip3 install <library name="">命令安装所有所需的库。最后要运行app use below命令，</library></p><pre class="jf jg jh ji fd ms lo mt mu aw mv bi"><span id="c334" class="lu jv hi lo b fi mw mx l my mz">nohup python3 app.py &amp;</span></pre><p id="3263" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是我的app的链接你可以试试用:<a class="ae lq" href="http://ubuntu@ec2-3-21-156-107.us-east-2.compute.amazonaws.com:8080/index" rel="noopener ugc nofollow" target="_blank">http://Ubuntu @ ec2-3-21-156-107 . us-east-2 . compute . Amazon AWS . com:8080/index</a></p><h1 id="58c7" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">12.结论</h1><p id="a8b5" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">在调整大量模型后，我们能够实现0.368的最高谐波F1分数和0.66的最高AUC。我们个人发现SMOTE在处理职业不平衡问题上表现不佳，因此我们避免使用它。我希望这个案例研究能够帮助您更好地理解医疗保健领域的数据，以及如何在类别不平衡问题普遍存在的医疗保健领域使用机器学习。</p><h1 id="0eb4" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">13.未来的工作</h1><p id="67fd" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">正如我已经说过的，可解释性非常重要，你可以尝试ELI5，SHAP (Shapely Additive解释)，LIME(Local interpretable Model Agnostic解释)来获得可解释性。在这篇博客中，我更关注经典的机器学习算法，像RNN，CNN，MLP这样的深度学习算法也可以实现。在特征工程中，我已经实现了基本的技术，但还有很大的空间去冒险使用高级技术，如多项式核、RBF核、特征的数学变换。</p><h1 id="191d" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">14.未来连接的配置文件</h1><p id="cf15" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated"><em class="jd"> GitHub链接:- </em></p><div class="nt nu ez fb nv nw"><a href="https://github.com/ranveerkln/Diabetic/blob/main/dibetis_23_12.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab dw"><div class="ny ab nz cl cj oa"><h2 class="bd hj fi z dy ob ea eb oc ed ef hh bi translated">ranveerkln/糖尿病</h2><div class="od l"><h3 class="bd b fi z dy ob ea eb oc ed ef dx translated">通过在GitHub上创建一个帐户，为ranveerkln/糖尿病的发展做出贡献。</h3></div><div class="oe l"><p class="bd b fp z dy ob ea eb oc ed ef dx translated">github.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok jo nw"/></div></div></a></div><p id="cf30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd"> LinkedIn链接:- </em></p><div class="nt nu ez fb nv nw"><a href="https://www.linkedin.com/in/sachin-ranveer-b37360166/" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab dw"><div class="ny ab nz cl cj oa"><h2 class="bd hj fi z dy ob ea eb oc ed ef hh bi translated">Sachin Ranveer -数据工程师-Nykaa.com | LinkedIn</h2><div class="od l"><h3 class="bd b fi z dy ob ea eb oc ed ef dx translated">经验丰富的数据工程师，有在互联网行业工作的经历。熟练掌握亚马逊红移…</h3></div><div class="oe l"><p class="bd b fp z dy ob ea eb oc ed ef dx translated">www.linkedin.com</p></div></div><div class="of l"><div class="ol l oh oi oj of ok jo nw"/></div></div></a></div><h1 id="c660" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">15.参考</h1><p id="2657" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated"><a class="ae lq" href="https://towardsdatascience.com/predicting-hospital-readmission-for-patients-with-diabetes-using-scikit-learn-a2e359b15f0" rel="noopener" target="_blank">使用机器学习来预测患有Scikit的糖尿病患者的再次入院——Learn |作者Andrew Long |迈向数据科学</a></p><p id="a22c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lq" href="https://www.appliedaicourse.com/" rel="noopener ugc nofollow" target="_blank">https://www.appliedaicourse.com/</a></p><p id="2273" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lq" href="https://www.researchgate.net/publication/333015077_Feature_Engineering_FE_Tools_and_Techniques_for_Better_Classification_Performance" rel="noopener ugc nofollow" target="_blank">https://www . research gate . net/publication/333015077 _ Feature _ Engineering _ FE _ Tools _ and _ Techniques _ for _ Better _ class ification _ Performance</a></p><p id="5683" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lq" href="https://www.ijedr.org/papers/IJEDR1802080.pdf" rel="noopener ugc nofollow" target="_blank"> link_to_pdf </a></p><p id="7be8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lq" href="https://www.kaggle.com/aldrinl/interpretable-ml-for-diabetes-patient-readmissionhttps://www.analyticsvidhya.com/blog/2019/11/shapley-value-machine-learning-interpretability-game-theory/" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/aldrinl/interpretable-ml-for-diabetes-patient-readmissionhttps://www . analyticsvidhya . com/blog/2019/11/Shapley-value-machine-learning-interprebility-game-theory/</a></p></div></div>    
</body>
</html>