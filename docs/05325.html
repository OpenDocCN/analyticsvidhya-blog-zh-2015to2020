<html>
<head>
<title>Happy cities have more Starbucks: or do they? — Regression Analysis with R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快乐城市有更多的星巴克:或者他们有吗？—带R的回归分析</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/happiness-has-something-to-do-with-starbucks-by-regression-in-r-6e7ea08d01c3?source=collection_archive---------20-----------------------#2020-04-17">https://medium.com/analytics-vidhya/happiness-has-something-to-do-with-starbucks-by-regression-in-r-6e7ea08d01c3?source=collection_archive---------20-----------------------#2020-04-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7464" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有一次，我接触到一个朋友评判的目光，因为我知道这个城市所有的星巴克店。我远不是星巴克的粉丝，我有充分的理由去了解包括星巴克在内的许多咖啡店——比如在家工作时效率极低。当然，这些不足以说服我的欧洲朋友和他对大公司的厌恶。</p><p id="9fa2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除此之外，我记得曾经有一段时间，星巴克是一种显示地位的方式——至少在我的家乡是这样。人们试图通过<em class="jd">拿着星巴克杯子</em>或者<em class="jd">批评拿着星巴克杯子的人</em>来展示他们有多酷。我不知道新的星巴克是什么，但这不是这里的主题。</p><p id="a2ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我摆弄了一些看起来如此不相关的数据集，以至于说服我以某种方式将它们结合起来。我综合了那些数据，画了一些花哨的图表和令人信服的回归线，最后欣赏了<strong class="ih hj">最常见的统计错误之一。</strong>一步一步来。</p><ol class=""><li id="8a2f" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">数据集来自Kaggle:</li></ol><ul class=""><li id="6708" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jn jk jl jm bi translated"><a class="ae jo" href="https://www.kaggle.com/starbucks/store-locations" rel="noopener ugc nofollow" target="_blank">星巴克门店位置</a>:全球星巴克门店</li><li id="4113" class="je jf hi ih b ii jp im jq iq jr iu js iy jt jc jn jk jl jm bi translated"><a class="ae jo" href="https://www.kaggle.com/unsdsn/world-happiness" rel="noopener ugc nofollow" target="_blank">世界幸福报告— 2019 </a>:根据公共政策、腐败等多个因素计算出的每个国家的幸福排名和得分。</li></ul><p id="908a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.库和导入数据</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="fbc5" class="kd ke hi jz b fi kf kg l kh ki">library(ggthemes)<br/>library(countrycode)<br/>library(readr)<br/>library(ggplot2)<br/>library(dplyr)<br/>library(tidyverse)</span><span id="c1dc" class="kd ke hi jz b fi kj kg l kh ki">#Importing the data<br/>starbucks &lt;- read_csv("Medium/starbucks_locations.csv")<br/>happiness &lt;- read_csv("Medium/happiness_2019.csv")</span></pre><p id="af79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.预处理</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="6fdc" class="kd ke hi jz b fi kf kg l kh ki">#Transforming country names to country codes and creating a continent column. <br/>happiness&lt;-happiness %&gt;%<br/>  mutate(Country=countrycode(happiness$`Country or region`,origin="country.name", destination="iso2c" )) %&gt;%<br/>  mutate(Continent=countrycode(happiness$`Country or region`, origin="country.name", destination="continent"))</span><span id="5b4b" class="kd ke hi jz b fi kj kg l kh ki">#Aggregating the starbucks stores and summarizing each country by the number of starbucks stores<br/>starbucks_total&lt;-starbucks %&gt;%<br/>  group_by(Country) %&gt;%<br/>  summarize(Number_of_store=n())</span><span id="b944" class="kd ke hi jz b fi kj kg l kh ki">#Normalization function for happiness score<br/>normalize &lt;- function(x) {<br/>return ((x - min(x)) / (max(x) - min(x)))<br/>}</span><span id="828a" class="kd ke hi jz b fi kj kg l kh ki">#Combining starbucks and happiness dataset, <br/>df&lt;-happiness %&gt;% <br/>  left_join(starbucks_total, by=c("Country"), suffix=c("_happiness","_data")) %&gt;%<br/>  mutate(Number_of_store=replace_na(Number_of_store,0)) %&gt;%<br/>  mutate(Normalized_score=normalize(Score))</span><span id="6c9a" class="kd ke hi jz b fi kj kg l kh ki">#Selecting the relevant columns: Country, Country code, Continent, Number of store, Normalized score<br/>starbucks_vs_happiness&lt;-df[,c(2,10,11,12,13)]<br/>starbucks_vs_happiness</span></pre><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kk"><img src="../Images/f4749fb4e8c150f3abd5dd4c8c237d3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KOWEBkHLCtPocH5mw5ocvw.png"/></div></div></figure><p id="772d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.星巴克门店数量与幸福指数</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="c1b3" class="kd ke hi jz b fi kf kg l kh ki">ggplot(starbucks_vs_happiness, aes(x=Normalized_score, y=log(Number_of_store), label=Country)) +<br/>      geom_point() +<br/>      geom_text(size=2,nudge_x=-0.03,nudge_y = 0.07) +<br/>      theme_economist() +<br/>      xlab("Happiness Score") +<br/>      ylab("Number of Starbucks Stores") + <br/>      ggtitle("Happiness and Starbucks Stores")</span></pre><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ks"><img src="../Images/99eaf05d5159b4afa23119348f9b45d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9WnOOkldMUOtPKk9BvJOnQ.png"/></div></div></figure><p id="d316" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看看我是如何使用一个奇特的主题——经济学家主题——来看起来更有说服力…</p><p id="e6dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.星巴克和快乐大陆</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="2153" class="kd ke hi jz b fi kf kg l kh ki">#Including only Americas, Asia and Europe since there were too few observations in other continents<br/>svh_modified&lt;-starbucks_vs_happiness %&gt;%<br/>  filter(Continent %in% c("Americas","Asia","Europe"))</span><span id="eb15" class="kd ke hi jz b fi kj kg l kh ki">#Happiness and Starbucks Stores by Continent<br/>ggplot(svh_modified, aes(x=Normalized_score, y=log(Number_of_store),  label=Country)) + <br/>      geom_point() + <br/>      facet_wrap(~Continent) +  <br/>      geom_text(size=2,nudge_x=-0.06,nudge_y = 0.07) + <br/>      geom_smooth(method="lm", se=FALSE) + <br/>      theme_economist() +<br/>      xlab("Happiness Score") +<br/>      ylab("Number of Starbucks Stores") + <br/>      ggtitle("Happiness and Starbucks Stores", subtitle="Americas, Asia and Europe")</span></pre><figure class="ju jv jw jx fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kt"><img src="../Images/0ca99c0264aad70100d74a394726f438.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X_wRs2YkmX7ZmWw5ZDj3_g.png"/></div></div></figure><p id="ea88" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.结论</p><p id="06d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗯，嗯…我喜欢这些曲线的陡峭程度，即使是在欧洲。星巴克店的数量似乎与国家的幸福程度有关。我们可能倾向于这么说……但是让我们不要急于分享一个著名陷阱的喜悦:<a class="ae jo" href="https://en.wikipedia.org/wiki/Confounding" rel="noopener ugc nofollow" target="_blank">混淆</a>。</p><p id="d844" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">阻止我们得出关联结论的是另一个变量<strong class="ih hj"/><strong class="ih hj">，它既影响依赖型幸福分数，也影响独立型星巴克变量的数量。对于这样一个变量，我的第一个天真的建议是国家的财富。富裕国家可能会更幸福，可能会有更多的星巴克。下一步应该是进一步分析回归结果。</strong></p><p id="58e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在此之前，享受黑咖啡是这一分析的主要结果——无论你来自一个快乐的地方。干杯！</p></div></div>    
</body>
</html>