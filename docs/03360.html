<html>
<head>
<title>Satellite Imagery Timelapses</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">卫星图像时间流逝</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/satellite-imagery-timelapses-4e9f5ec412b7?source=collection_archive---------19-----------------------#2020-01-27">https://medium.com/analytics-vidhya/satellite-imagery-timelapses-4e9f5ec412b7?source=collection_archive---------19-----------------------#2020-01-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="162f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和..熊猫！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/9d994454694114df9b4a8d6f4eb4d431.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/1*wOnvmPg39BNVXQqihdE-8Q.gif"/></div></figure><p id="94ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">新的一年已经开始，我们都已经在做事的热潮。所以我想这个周末我会有一个有趣的帖子！</p><p id="48ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，这将是关于熊猫、太阳能农场和时间流逝！</p><p id="f964" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我是如何做到这一点的，只是通过关注可再生能源领域发生的事情，我引用<a class="ae jl" href="https://www.businessinsider.com/china-panda-shaped-solar-energy-farms-project-2018-6" rel="noopener ugc nofollow" target="_blank">文章</a>中的话:</p><blockquote class="jm jn jo"><p id="f169" class="if ig jp ih b ii ij ik il im in io ip jq ir is it jr iv iw ix js iz ja jb jc hb bi translated"><em class="hi">2017年，这两个团体在中国的Daton建造了一座248英亩的太阳能发电厂，从上面看，它像两只微笑的熊猫。现在，联合国、熊猫绿色能源和中国政府正在中国各地建造99个类似的太阳能农场。</em></p></blockquote><p id="923d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">期待未来的太阳能农场，同时，让我们开始乐趣:</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="32ea" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">设置</h1><ul class=""><li id="e852" class="ky kz hi ih b ii la im lb iq lc iu ld iy le jc lf lg lh li bi translated">安装哨兵枢纽</li><li id="478a" class="ky kz hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">安装eo学习</li></ul><p id="8eae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(请在下面的参考资料中找到上述内容的链接)</p><h2 id="8203" class="lo kb hi bd kc lp lq lr kg ls lt lu kk iq lv lw ko iu lx ly ks iy lz ma kw mb bi translated">数据析取</h2><p id="6cef" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq mc is it iu md iw ix iy me ja jb jc hb bi translated">在我之前的:<a class="ae jl" href="https://danielmoraite.github.io/docs/satellite1.html" rel="noopener ugc nofollow" target="_blank">用Python I </a>进行卫星影像分析的文章中，你可以找到如何获取感兴趣区域<code class="du mf mg mh mi b">AOI</code>坐标的详细信息。请确保您从菜单中分别选择了<code class="du mf mg mh mi b">meta</code>、<code class="du mf mg mh mi b">add bboxes</code>。</p><p id="d78d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">定义ROI BBOX和时间间隔向eopatch请求不同类型的层和数据源</p><pre class="je jf jg jh fd mj mi mk ml aw mm bi"><span id="54a0" class="lo kb hi mi b fi mn mo l mp mq">roi_bbox = BBox(bbox=[113.4705, 39.9697, 113.4951, 39.9871], crs=CRS.WGS84)<br/> time_interval = ('2017-02-01', '2017-08-01')</span></pre><p id="9b5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">工作流程的任务:—下载S2图像(所有13个波段)—过滤掉云覆盖率大于给定阈值(例如0.8，0.05)的图像</p><pre class="je jf jg jh fd mj mi mk ml aw mm bi"><span id="35a4" class="lo kb hi mi b fi mn mo l mp mq">layer='BANDS-S2-L1C'<br/>  ​<br/>wcs_task = S2L1CWCSInput(layer=layer, <br/>                           resx='5m',<br/>                           resy='5m',<br/>                           maxcc=.05, time_difference=datetime.timedelta(hours=1))<br/>  ​<br/>save = SaveToDisk('timelapse_example', overwrite_permission=2, compress_level=1)</span></pre><p id="c7b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">构建和执行延时作为一个变换链</p><p id="2d0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您选择的区域和时间范围没有足够的0.8 cc，请随意将最大云覆盖率设置为0.8到0.05。否则，它将看起来像下面这样(有点神游):</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mr"><img src="../Images/ba7eaeff9484b7b8bb8f6acd7d62ed10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/0*PPAspaG5BGMaX8wx.gif"/></div></figure><pre class="je jf jg jh fd mj mi mk ml aw mm bi"><span id="1fad" class="lo kb hi mi b fi mn mo l mp mq">timelapse =LinearWorkflow(wcs_task, save)<br/>  ​<br/>result = timelapse.execute({<br/>   wcs_task: {'bbox': roi_bbox, 'time_interval': time_interval},<br/>                          save: {'eopatch_folder': 'eopatch'}})</span></pre><p id="9d90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将结果作为eopatch获取</p><pre class="je jf jg jh fd mj mi mk ml aw mm bi"><span id="97c2" class="lo kb hi mi b fi mn mo l mp mq">eopatch = result[save]<br/>eopatch</span></pre></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><pre class="mj mi mk ml aw mm bi"><span id="90b7" class="lo kb hi mi b fi ms mt mu mv mw mo l mp mq">EOPatch(<br/>    data: {<br/>      BANDS-S2-L1C: numpy.ndarray(shape=(4, 387, 419, 13), dtype=float32)<br/>    }<br/>    mask: {<br/>      IS_DATA: numpy.ndarray(shape=(4, 387, 419, 1), dtype=bool)<br/>    }<br/>    scalar: {}<br/>    label: {}<br/>    vector: {}<br/>    data_timeless: {}<br/>    mask_timeless: {}<br/>    scalar_timeless: {}<br/>    label_timeless: {}<br/>    vector_timeless: {}<br/>    meta_info: {<br/>      maxcc: 0.05<br/>      service_type: 'wcs'<br/>      size_x: '5m'<br/>      size_y: '5m'<br/>      time_difference: datetime.timedelta(0, 3600)<br/>      time_interval: ('2017-02-01', '2017-08-01')<br/>    }<br/>    bbox: BBox(((113.4705, 39.9697), (113.4951, 39.9871)), crs=EPSG:4326)<br/>    timestamp: [datetime.datetime(2017, 4, 1, 3, 18, 46), ..., datetime.datetime(2017, 7, 30, 3, 21, 38)], length=4<br/>  )</span></pre><p id="3e90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建gif的函数</p><pre class="je jf jg jh fd mj mi mk ml aw mm bi"><span id="b08b" class="lo kb hi mi b fi mn mo l mp mq">import imageio, os<br/>  ​<br/>def make_gif(eopatch, project_dir, filename, fps):<br/>"""<br/>Generates a GIF animation from an EOPatch.<br/>"""<br/>with imageio.get_writer(os.path.join(project_dir, filename), mode='I', fps=fps) as writer:<br/>           for image in eopatch:<br/>               writer.append_data(np.array(image[..., [3, 2, 1]], dtype=np.uint8))</span></pre><p id="5017" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将EOPatch写入GIF</p><pre class="je jf jg jh fd mj mi mk ml aw mm bi"><span id="716e" class="lo kb hi mi b fi mn mo l mp mq">make_gif(eopatch=eopatch.data['BANDS-S2-L1C']*2.5*255, project_dir='.', filename='eopatch_timelapse1.gif', fps=1)</span><span id="6fad" class="lo kb hi mi b fi mx mo l mp mq">from IPython.display import Image<br/>​<br/>Image(filename="eopatch_timelapse.gif")</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es my"><img src="../Images/0c4091cfb68e06cbcf800a76f4abad7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/0*wPTjndkZ7ktFUoUJ.gif"/></div></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="1184" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如上图gif所示，春天的伦敦。</p><p id="b189" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请在此找到完整的代码<a class="ae jl" href="https://github.com/DanielMoraite/DanielMoraite.github.io/blob/master/assets/panda.ipynb" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="08e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请随意选择您自己的坐标。你可能也想玩玩时间框架。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="ba5f" class="lo kb hi bd kc lp lq lr kg ls lt lu kk iq lv lw ko iu lx ly ks iy lz ma kw mb bi translated">资源:</h2><ul class=""><li id="5e71" class="ky kz hi ih b ii la im lb iq lc iu ld iy le jc lf lg lh li bi translated"><a class="ae jl" href="https://eo-learn.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">EO-learn的文档</a></li><li id="a065" class="ky kz hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated"><a class="ae jl" href="https://github.com/sentinel-hub/eo-learn" rel="noopener ugc nofollow" target="_blank"> eo-learn github </a></li><li id="2ef6" class="ky kz hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">我建议将eo-learn github存储库复制到您的驱动器上</li><li id="e017" class="ky kz hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated"><a class="ae jl" href="https://services.sentinel-hub.com/oauth/subscription?param_redirect_uri=https://apps.sentinel-hub.com/dashboard/oauthCallback.html&amp;param_state=%2Fconfigurations&amp;param_scope=SH&amp;param_client_id=30cf1d69-af7e-4f3a-997d-0643d660a478&amp;origin=" rel="noopener ugc nofollow" target="_blank"> sentinelhub创建账户</a></li><li id="87e7" class="ky kz hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated"><a class="ae jl" href="https://www.sentinel-hub.com/faq/where-get-instance-id" rel="noopener ugc nofollow" target="_blank"> sentinelhub实例ID </a></li><li id="09b8" class="ky kz hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated"><a class="ae jl" href="https://pypi.org/project/sentinelhub/" rel="noopener ugc nofollow" target="_blank"> sentinelhub安装</a></li></ul></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="c5f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意事项:</p><pre class="je jf jg jh fd mj mi mk ml aw mm bi"><span id="afb5" class="lo kb hi mi b fi mn mo l mp mq"># SentinelHub API Key (instance id) stored as an env variable(if you want to call it from your notebook):        <br/>    import os<br/>    os.environ['INSTANCE_ID']='your instance ID'<br/>    INSTANCE_ID = os.environ.get('INSTANCE_ID')</span></pre><p id="83f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随意去PAAAANDAAAS！</p></div></div>    
</body>
</html>