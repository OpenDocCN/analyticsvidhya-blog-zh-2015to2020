<html>
<head>
<title>5 Steps : To get an understanding on Correlation, Auto-Correlation and Partial Auto-Correlation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">5个步骤:了解相关、自相关和部分自相关</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/5-steps-to-get-an-understanding-on-correlation-auto-correlation-and-partial-auto-correlation-e71f6b4bba81?source=collection_archive---------3-----------------------#2020-01-03">https://medium.com/analytics-vidhya/5-steps-to-get-an-understanding-on-correlation-auto-correlation-and-partial-auto-correlation-e71f6b4bba81?source=collection_archive---------3-----------------------#2020-01-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/fffac9552c293fc8bf14913dac56126d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A1s6ezdTJFLBKRRrSh8jJw.jpeg"/></div></div></figure><p id="2ce2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我的上一个<a class="ae jo" rel="noopener" href="/analytics-vidhya/5-steps-to-get-an-understanding-on-co-variance-and-correlation-60c94f19a556">故事</a>中，我试图解释协方差和相关性的概念。在这个故事中，让我们理解自相关和偏相关的概念。</p><p id="84ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将相关性定义为确定两个变量之间关系方向的标准版本的协方差。<strong class="is hj">到目前为止，相关性在双变量分析中增加了一个分析值，那么当我们有单变量数据时呢？</strong></p><h1 id="589e" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">1.单变量描述统计</h1><p id="9022" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">描述性统计提供了样本中数据的汇总视图或描述。在单变量描述性统计中，我们对数据集中单个变量的描述性统计更感兴趣。描述性统计使用集中趋势度量和分散度量来提供数据集的描述。</p><p id="c5a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们考虑一个样本温度数据集，每个数据样本以规则的时间间隔收集。这种数据集是单变量时间序列数据。以下屏幕截图显示了eviews软件工具中导入的数据集及其描述性统计数据。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es ks"><img src="../Images/252ec0bfe208b88efa10dca45b063c28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*bzFDQVpU6WwkqLWEcDRePA.jpeg"/></div></figure><p id="06d2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在图中，您可以观察到，一个变量有10个观察值，它提供了集中趋势统计的度量，如平均值、中值、最大值、最小值等。它还提供了离差的标准，偏差，偏度和峰度的措施。偏度和峰度是解释数据分布的重要描述性统计量。偏度衡量分布的“侧面性”或对称性，峰度衡量分布的“尾部性”。</p><p id="8ce9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kx">当我们有上述单变量时间序列数据时，描述性统计不会给出我们在时间t观察到的值如何依赖于过去观察到的或没有观察到的数据的想法。所以我们需要一些更特殊的统计数据来理解现在和过去的观察值之间的依赖关系。</em></p><h1 id="9936" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">2.ACF —自相关函数</h1><p id="56ba" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">自相关也被称为序列相关。这种类型的相关性用于理解时间序列观测值如何依赖于先前时间的相同序列的值。序列中过去的观测值称为滞后。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es ky"><img src="../Images/693aac31cbf53e25718588de38a9b6e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*8EZSvPHyenzqsUoVvYzXbw.jpeg"/></div></figure><p id="9eef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上述数据集中，第一列是原始数据时间序列，第二列是一个一步移位的原始数据时间序列，称为原始数据的滞后1时间序列数据。这个Lag-1序列的长度将比原始时间序列少1。</p><p id="8040" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们看看计算ACF的数学公式。首先计算X和Y时间序列之间的相关系数，然后将其扩展到计算同一时间序列之间的相关性。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kz"><img src="../Images/9aae96f23a2f1458b78a31813d868e46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SAZ1roM4MINk0R30Itn9kg.jpeg"/></div></div></figure><p id="2089" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们计算滞后1的ACF，我们可以同样扩展相同的公式来推广滞后项。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es la"><img src="../Images/bb7806afbbb4427fd9684ca7adca1e1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/format:webp/1*kA8NicgzbdNEZMIUL-Yzcw.jpeg"/></div></figure><p id="f664" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ACF(Lk)的值称为滞后k时的自相关系数。样本自相关ACF(Lk)与k(时滞)的关系图称为相关图或自相关图。</p><p id="5bf7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">相关图是检查数据集中随机性的常用工具。这种随机性是通过计算不同时间滞后的数据值的自相关来确定的。如果是随机的，这种自相关对于任何和所有的时滞分离应该接近于零。如果是非随机的，那么一个或多个自相关将明显非零。</p><h1 id="43ca" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">3.计算ACF</h1><p id="3cae" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">让我们为上述温度数据集计算滞后1的ACF。我用下面的步骤来计算ACF。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/811b901a94cf81f00fcb0e5c9bb1eaa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gO3wZIOfRAmE-OXmQ3XyQA.jpeg"/></div></div></figure><p id="7cbf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> ACF(滞后K = 1) </strong> <br/> 1。计算原始数据时间序列的平均值<br/> 2。计算所有观察值的原始数据和平均值之间的差异<br/> 3。平方(2)步骤<br/> 4的输出。计算所有观察值的原始数据和平均值之间的平方差总和<br/> 5。计算滞后1系列和(n-k)个观察值的平均值之间的差异<br/> 6。计算(2)和(5)的输出之间的乘积<br/> 7。计算步骤(6) <br/> 8的输出总和。滞后1的ACF =输出(6) /输出(4)</p><p id="faef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们比较一下用Eviews软件对滞后1的输出的ACF计算。下面的屏幕截图显示了上述时间序列数据的相关图。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/0bb7971deafcfbae12c451ebc01c29fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*WsYuCrgF8P_wkIRVMikFtw.jpeg"/></div></figure><p id="ab78" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们计算的滞后1的ACF值为0.4099，Eviews输出为0.410。</p><h1 id="6f09" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">4.ACVF —自协方差函数</h1><p id="649e" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">对于给定的随机过程，自协方差是一个函数，它给出了该过程在成对时间点上与其自身的协方差。设Y为数据序列，每隔一定时间收集一次观察值。Y的期望值为μ=E[Y]。从Y的每个观测值中减去μ，得到z。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es ld"><img src="../Images/2d7eac1743c55a2c8e22ec5155b83d67.png" data-original-src="https://miro.medium.com/v2/resize:fit:610/format:webp/1*wLTHq2lcMR7Ax3RTjyqNaA.jpeg"/></div></figure><p id="c86e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将向量Z乘以Z转置，得到如下的(N×N)矩阵。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es le"><img src="../Images/6a8c2e70b54f5ffc81b43386decb45a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FB-QjosHjY9b3KTWbdahKA.jpeg"/></div></div></figure><p id="c92d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以上面矩阵的期望给出了协方差矩阵。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es lf"><img src="../Images/c5c53899e11abfba5ecad04a0a97f3ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*MAHdCeJLZRf3-zh55z70qQ.jpeg"/></div></figure><p id="b7ae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">E[Z Tran(Z)]矩阵是一个方差-协方差矩阵，它是一个包含与几个变量相关的方差和协方差的方阵。矩阵的对角线元素包含变量的方差，非对角线元素包含所有可能的变量对之间的协方差。</p><p id="234a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">时间序列在滞后k处的自协方差函数(ACVF)定义如下</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es lg"><img src="../Images/d2dd508c467d18d1bf8a284536406d16.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*I7gpqe_wpuE4WpStpkpxHg.jpeg"/></div></figure><p id="49df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">很容易从方差-协方差矩阵中计算出各种滞后的ACVF。在矩阵中，主对角线上的值是<em class="kx"> s </em> 0，主对角线上下对角线上的值是<em class="kx"> s </em> 1。两个单位之外的对角线上的值是<em class="kx"> s </em> 2等等。</p><p id="a72d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们计算温度数据集的自协方差函数(ACVF)。这里我写了一个简单的python代码来计算方差-协方差矩阵。</p><pre class="kt ku kv kw fd lh li lj lk aw ll bi"><span id="e1dc" class="lm jq hi li b fi ln lo l lp lq">data = [23.2,23.6,25.3,25.2,25.1,25.6,24.6,24.6,23.9,24.1]<br/># Create a Matrix Z for the data set<br/>Z = np.array(data)</span><span id="6d4a" class="lm jq hi li b fi lr lo l lp lq"># Compute the Mean and substract it from the data<br/>mean = Z.mean()<br/>Z = Z - mean</span><span id="1a3a" class="lm jq hi li b fi lr lo l lp lq"># Transpose the Z matrix and perform the mat multiplication Z and Z_Dash<br/>Z_Dash = np.transpose(Z)</span><span id="d645" class="lm jq hi li b fi lr lo l lp lq">R = np.dot(Z[:,None],Z_Dash[None,:])</span></pre><p id="ab10" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输出如下所示:</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/7060bdcad182a933747c736c0552c557.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xh4ybppFxDIoKebVourPrQ.jpeg"/></div></div></figure><p id="a97d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从上面的8×8矩阵，让我们计算自动协方差函数(ACVF)值。以下简单的python代码生成了这些值。</p><pre class="kt ku kv kw fd lh li lj lk aw ll bi"><span id="2220" class="lm jq hi li b fi ln lo l lp lq">l = len(data)<br/>slist = []<br/>for i in range(0,l) :<br/>    s = 0<br/>    for j in range(0,l-i) :<br/>        s = s + R[j+i][j]<br/>    slist.append(s)</span></pre><p id="c4e6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">生成的ACVF值存储在<code class="du lt lu lv li b">slist</code>列表中。这里是<code class="du lt lu lv li b">slist</code>的输出。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es lw"><img src="../Images/935aa8dec8d8878793b55a6b0b5d97f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*tLC8Ag3t91rI8uC5B48RdQ.jpeg"/></div></figure><h1 id="a597" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">5.PACF —偏自相关函数</h1><p id="9191" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我们将自相关函数理解为“当前时间的观测值与之前时间的观测值之间的相关性”。假设我们认为当前时间的观测值和先前时间的观测值都与其他时间的观测值相关，则偏自相关函数PACF也是这两个观测值之间的相关。<br/>例如，今天12月31日的股价可以与29日的股价相关，昨天12月30日的股价也可以与29日的股价相关，那么昨天12月30日股价的PACF就是剔除29日股价的影响后，今天12月31日与12月30日的真实相关性。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es lx"><img src="../Images/2e9679e6cc55d18a42ee0fac560f2160.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*NY1e0u9oX8yhHSmAicTBKg.jpeg"/></div></figure><p id="1cb3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">再考虑一个例子。假设输入变量为x1、x2和x3，输出变量为y。y和x3之间的偏自相关函数PACF是变量y和x3之间的相关性，其确定考虑了y和x3与x1和x2的关系。</p><p id="e63e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了理解y和x3如何与x1和x2相关，执行如下两个回归— <br/> 1。回归-根据x1和x2预测y。<br/> 2。回归-根据x1和x2预测x3</p><p id="8fad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每次回归都有一个残差被遗漏。输入变量x1和x2不能解释残差。取这两个残差之间的相关将给出y和x3变量之间的部分相关。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es ly"><img src="../Images/f30c932c1cfc035f52b2eac38c5328f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*e0S3Hj2iuujmHYBkec4-8g.jpeg"/></div></figure><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/3deded684b9eb15ddc4242aaec1b405d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JwkDAI3sn00DteaC3A6cdg.jpeg"/></div></div></figure><h1 id="df24" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">6.计算PACF</h1><p id="1665" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">对于上面的温度数据集，让我们计算滞后2的PACF。现在我们必须解决下面的方程。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/802184a126856241fc5778fe53c3cb5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*XHI6tOn0TMSNBBckmLiSYQ.jpeg"/></div></figure><p id="d62b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，我按照尤尔-沃克方程的方法来计算PACF值。在高层次上，该方法如下所示。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es mb"><img src="../Images/55c7f519848bc8c29f0afbd3fac74813.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*hvah2kTL32jRxImoO92BEA.jpeg"/></div></figure><p id="3974" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我写了一个简单的python代码来计算各种滞后的PACF。让我们计算Lag2的PACF，并与eviews的输出进行比较。</p><pre class="kt ku kv kw fd lh li lj lk aw ll bi"><span id="e7ed" class="lm jq hi li b fi ln lo l lp lq">lag = 2<br/>acvf_lags = slist[1:lag+1]<br/>mat = np.zeros((lag, lag))</span><span id="6148" class="lm jq hi li b fi lr lo l lp lq">for i in range(0,lag) :<br/>    for j in range(0,lag-i) :<br/>        mat[j+i][j] = slist[i]<br/>        mat[j][j+i] = slist[i]<br/>    <br/>ainv = np.linalg.inv(mat)</span><span id="97ad" class="lm jq hi li b fi lr lo l lp lq">result = np.matmul(ainv,acvf_lags)</span></pre><p id="2b9a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的代码中，我正在计算自协方差矩阵的逆矩阵和acvf值之间的矩阵乘法。矩阵乘法的输出如下。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/32dfe5add50b7aa0ae37e2cb484d6fb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:248/format:webp/1*K7dXvqgCpAqsPERC4a_7Ww.jpeg"/></div></figure><p id="54be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最低值-0.289是PACF(2)。eviews的输出也是一样的-0.290。类似地，可以计算各种滞后的PACF。</p><h1 id="4572" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="56b5" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">协方差、相关性、自协方差、自相关和偏相关是数据分析中的重要主题，需要很好地理解。它们在时间序列分析中也起着关键作用。</p></div></div>    
</body>
</html>