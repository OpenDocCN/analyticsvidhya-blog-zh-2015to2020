<html>
<head>
<title>How to dockerize your django application with mysql, redis and memcached?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 mysql，redis，memcached 将你的 django 应用 dockerize？</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-dockerize-your-django-application-with-mysql-redis-and-memcached-ff622b924d7b?source=collection_archive---------7-----------------------#2020-08-04">https://medium.com/analytics-vidhya/how-to-dockerize-your-django-application-with-mysql-redis-and-memcached-ff622b924d7b?source=collection_archive---------7-----------------------#2020-08-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7a42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个故事中，我将尝试解释如何对一个 enter django 应用程序进行 dockerize。首先，安装 docker 和 docker compose。</p><p id="149f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们将为应用程序维护一个 docker 文件，为控制 docker 实例(mysql、redis、memcached)维护另一个 docker-compose.yml 文件。我们的目录结构将是:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="e8c8" class="jm jn hi ji b fi jo jp l jq jr">base_directory<br/> - Dockerfile<br/> - docker-compose.yml<br/> - app<br/> - requirements.txt</span></pre><p id="698c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Dockerfile: </strong></p><p id="d628" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个文件将用于安装 django 应用程序的不同依赖项，将本地应用程序目录复制到 docker 实例。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="7666" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj">FROM</strong> python:3.5<br/><strong class="ji hj">ENV</strong> PYTHONUNBUFFERED 1<br/><strong class="ji hj">RUN</strong> mkdir /base_directory<br/><strong class="ji hj">WORKDIR</strong> /base_directory<br/><strong class="ji hj">ADD</strong> . /base_directory/<br/><strong class="ji hj">RUN</strong> apt-get update<br/><strong class="ji hj">RUN</strong> apt-get install -y git<br/><strong class="ji hj">RUN</strong> git init<br/><strong class="ji hj">RUN</strong> apt-get install -y gcc python3-dev<br/><strong class="ji hj">RUN</strong> apt-get install -y libxml2-dev libxslt1-dev build-essential python3-lxml zlib1g-dev<br/><strong class="ji hj">RUN</strong> apt-get install -y default-mysql-client default-libmysqlclient-dev<br/><strong class="ji hj">RUN</strong> wget https://bootstrap.pypa.io/get-pip.py<br/><strong class="ji hj">RUN</strong>  python3 get-pip.py<br/><strong class="ji hj">RUN</strong> rm get-pip.py<br/><strong class="ji hj">RUN</strong> pip install -r requirements.txt</span></pre><p id="94fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> docker-compose.yml: </strong></p><p id="38ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该文件将用于下载图像，下载后将创建一些容器并运行这些容器。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="ec1b" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj">version</strong>: <strong class="ji hj">'2'<br/><br/>services</strong>:<br/>  <strong class="ji hj">db</strong>:<br/>    <strong class="ji hj">container_name</strong>: <strong class="ji hj">'db'<br/>    image</strong>: mysql:5.7<br/>    <strong class="ji hj">ports</strong>:<br/>      - <strong class="ji hj">'3307:3306'<br/>    environment</strong>:<br/>       <strong class="ji hj">MYSQL_DATABASE</strong>: <strong class="ji hj">'appdb'<br/>       MYSQL_PASSWORD</strong>: <strong class="ji hj">'root'<br/>       MYSQL_ROOT_PASSWORD</strong>: <strong class="ji hj">'root'<br/>    volumes</strong>:<br/>      - <strong class="ji hj">'db:/var/lib/mysql'<br/>    command</strong>: [<strong class="ji hj">'mysqld'</strong>, <strong class="ji hj">'--character-set-server=utf8mb4'</strong>, <strong class="ji hj">'--collation-server=utf8mb4_unicode_ci'</strong>]</span><span id="ad27" class="jm jn hi ji b fi js jp l jq jr">  <strong class="ji hj">redis</strong>:<br/>    <strong class="ji hj">container_name</strong>: <strong class="ji hj">'redis'<br/>    image</strong>: <strong class="ji hj">'redis:3.2.0'<br/>    ports</strong>:<br/>      - <strong class="ji hj">'6378:6379'<br/>    volumes</strong>:<br/>      - <strong class="ji hj">'redisdata:/data'</strong></span><span id="d3a1" class="jm jn hi ji b fi js jp l jq jr"><strong class="ji hj">  memcached</strong>:<br/>    <strong class="ji hj">container_name</strong>: <strong class="ji hj">'memcached'<br/>    image</strong>: <strong class="ji hj">'memcached:latest'<br/>    ports</strong>:<br/>      - <strong class="ji hj">"11212:11211"</strong></span><span id="e681" class="jm jn hi ji b fi js jp l jq jr"><strong class="ji hj">  web</strong>:<br/>    <strong class="ji hj">build</strong>: .<br/>    <strong class="ji hj">command</strong>: python3 app/manage.py runserver 0.0.0.0:8001 <br/>    <strong class="ji hj">volumes</strong>:<br/>      - <strong class="ji hj">'.:/base_directory'<br/>    ports</strong>:<br/>      - <strong class="ji hj">"8001:8001"<br/>    depends_on</strong>:<br/>      - db<br/>      - redis<br/>      - memcached<br/><br/><strong class="ji hj">volumes</strong>:<br/>  <strong class="ji hj">redisdata</strong>:<br/>  <strong class="ji hj">db</strong>:<br/>  <strong class="ji hj">.</strong>:</span></pre><p id="d9f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Dockerfile 正在通过 web 容器下的 build 命令从此 docker-compose 运行。在我们的设置文件中，我们的数据库设置部分将是:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="e044" class="jm jn hi ji b fi jo jp l jq jr">DATABASES = {<br/>    <strong class="ji hj">'default'</strong>: {<br/>        <strong class="ji hj">'ENGINE'</strong>: <strong class="ji hj">'django.db.backends.mysql'</strong>,<br/>        <strong class="ji hj">'NAME'</strong>: <strong class="ji hj">'appdb'</strong>,<br/>        <strong class="ji hj">'HOST'</strong>: <strong class="ji hj">'db'</strong>,<br/>        <strong class="ji hj">'PORT'</strong>: 3306,<br/>        <strong class="ji hj">'USER'</strong>: <strong class="ji hj">'root'</strong>,<br/>        <strong class="ji hj">'PASSWORD'</strong>: <strong class="ji hj">'pass'</strong>,<br/>        <strong class="ji hj">'OPTIONS'</strong>: {<strong class="ji hj">'sql_mode'</strong>: <strong class="ji hj">'STRICT_ALL_TABLES'</strong>, <strong class="ji hj">'charset'</strong>: <strong class="ji hj">'utf8mb4'</strong>,},<br/>    }<br/>}</span></pre><p id="4579" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用以下方法来包装容器:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="8477" class="jm jn hi ji b fi jo jp l jq jr">docker-compose up</span></pre><p id="ae80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以在后台运行它们:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="7862" class="jm jn hi ji b fi jo jp l jq jr">docker-compose up -d </span></pre><p id="3e0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以通过以下方式制作集装箱:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="c1e8" class="jm jn hi ji b fi jo jp l jq jr">docker-compose down</span></pre><p id="87e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以从 docker 卷中删除所有内容:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="7bf0" class="jm jn hi ji b fi jo jp l jq jr">docker-compose down -v</span></pre><p id="28c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以通过以下方式进入任何集装箱的码头:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="d807" class="jm jn hi ji b fi jo jp l jq jr">docker exec -it container_name/id /bin/bash</span></pre><p id="58ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以通过以下方式导入 mysql 数据库:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="7f2e" class="jm jn hi ji b fi jo jp l jq jr">docker exec -i container mysql -uuser -ppass db &lt;db.sql</span></pre><p id="23e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们想先运行数据库，然后等待它完全准备好，在这种情况下，将首先运行数据库:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="41df" class="jm jn hi ji b fi jo jp l jq jr">docker-compose up db</span></pre><p id="f140" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后其他人也上来了:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="af51" class="jm jn hi ji b fi jo jp l jq jr">docker-compose up</span></pre><p id="54a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们的应用程序将在 8001 端口上启动:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="642f" class="jm jn hi ji b fi jo jp l jq jr"><a class="ae jt" href="http://localhost:8001/" rel="noopener ugc nofollow" target="_blank">http://localhost:8001/</a></span></pre></div></div>    
</body>
</html>