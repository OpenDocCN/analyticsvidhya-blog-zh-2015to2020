<html>
<head>
<title>Multithreading/Parallel Jobs in AWS Glue</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS Glue中的多线程/并行作业</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/multithreading-parallel-job-in-aws-glue-a291219123fb?source=collection_archive---------2-----------------------#2020-09-21">https://medium.com/analytics-vidhya/multithreading-parallel-job-in-aws-glue-a291219123fb?source=collection_archive---------2-----------------------#2020-09-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="205f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在基于AWS的数据湖中，AWS Glue和EMR是广泛用于ETL处理的服务。AWS Glue是一个专门针对ETL的服务。它有各种组件来帮助我们构建一个健壮的ETL系统。</p><blockquote class="jk jl jm"><p id="2bc4" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">在本文中，我将解释AWS Glue Job中的多线程方法，以便更快地处理数据。</p></blockquote><p id="f779" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">本文假设您了解以下技术的基础知识:</p><p id="1274" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">1 — AWG胶水</p><p id="9a13" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">2 —火花</p><p id="25e5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">3 — Python</p><p id="b885" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">ETL处理总是会有数据争论作业，这些作业将读取暂存的数据、执行验证、查找并将其写入目标。</p><p id="2310" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">有时，作业会读取stage，执行一些数据浓缩，进行验证，然后将这些半生不熟的数据用于两个不同的目标处理。如下图所示:</p><figure class="js jt ju jv fd jw er es paragraph-image"><div class="er es jr"><img src="../Images/2dfcbcdb2c80501ea503ba30fc6ba25c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*sH9QfSMZMMfk5HlKXjenaA.png"/></div></figure><p id="843a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这往往会变成一个性能瓶颈。这可以通过以下方法之一来处理:</p><p id="1e51" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">1-创建两个作业-每个目标一个，并在两个作业中执行部分重复性任务。这可以并行运行，但是这可能是低效的。</p><p id="5708" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">2 —将作业拆分为3，首先将执行所有常见任务并转移数据。然后，其他两个作业将执行目标特定的任务。这将增加I/O，并在一定程度上将我们带入MR时代。</p><p id="214a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">3 —使用多线程向Spark并行提交两个作业。</p><p id="0342" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这篇文章将讨论我用过的第三种方法，它非常有效。</p><blockquote class="jk jl jm"><p id="543d" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">Spark上下文是线程安全的，setLocalProperty可用于设置线程本地配置。</p></blockquote><p id="fe39" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">出于演示目的，我将使用以下舞台和昏暗的桌子:</p><figure class="js jt ju jv fd jw er es paragraph-image"><div class="er es jz"><img src="../Images/1b602bcad5e26e04cb97110a26442064.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*OtaMVdeGlGuZOqiZII3YMg.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">阶段和模糊样本数据</figcaption></figure><figure class="js jt ju jv fd jw er es paragraph-image"><div class="er es ke"><img src="../Images/fe7d9ec358649ef38fedf345064502a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*1l-gkViUHoWr7Asc08KccA.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">目标表</figcaption></figure><p id="eb91" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要在公平模式下配置Spark，我们需要将spark.scheduler.mode更新到FIFO，并在<strong class="io hj">引用的文件路径</strong>中为池的配置文件位置提供fairscheduler.xml。</p><blockquote class="jk jl jm"><p id="99d3" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">fairscheduler.xml是必须的，否则Glue container将跳过调度器设置</p></blockquote><p id="c2ab" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我试过没有它，并得到以下登录工作。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kf"><img src="../Images/abf5945da700168aa1fdd6d0f5bd1e76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*be__OD6_dG6TMKmCgChFSA.png"/></div></div></figure><p id="feb9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下面是配置的示例代码:</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="3253" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我使用了下面的fairscheduler.xml，它创建了两个不同权重的池(队列)。</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="3729" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Glue将创建3个池，2个配置池和1个默认池。这可以在下面的日志中看到。它会将这两个作业分配到不同的池中，从而能够并行处理这两个作业。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es km"><img src="../Images/1a510c17b6bb8c26fa76e1b2ba2f5d99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T6mFA5qDAVfkg-KU7me2ng.png"/></div></div></figure><blockquote class="jk jl jm"><p id="4653" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">“做学生很容易。学习需要实际工作。”<br/> —威廉·克劳福德</p></blockquote><p id="0cdf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请分享你对此的想法，快乐学习。</p></div></div>    
</body>
</html>