<html>
<head>
<title>Saving output of object recognition in macOS — OpenCV Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在macOS中保存对象识别的输出— OpenCV Python</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/saving-output-of-object-recognition-in-macos-opencv-python-5914bb5d9ca8?source=collection_archive---------18-----------------------#2020-01-02">https://medium.com/analytics-vidhya/saving-output-of-object-recognition-in-macos-opencv-python-5914bb5d9ca8?source=collection_archive---------18-----------------------#2020-01-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/4ffd99fa0298d8f009c7d1159a76a2ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v4BDPOmFbQgvNOORT0nu8g.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片来源— <a class="ae iu" href="https://www.pexels.com/photo/50mm-camera-lens-canon-laptop-693866/" rel="noopener ugc nofollow" target="_blank">链接</a></figcaption></figure><p id="7359" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这篇文章对那些已经成功完成物体探测任务的人来说很重要。</p><p id="fe82" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我对在Python中以视频格式在硬盘上保存OpenCV上的对象检测输出的过程做了一些研究。我意识到很少有文章解释如何做到这一点的确切方法。在本文中，我们将学习如何在macOS系统中保存输出视频。</p><p id="3eba" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> <em class="jt">提示:在windows系统中保存视频是一件痛苦的事情。这个问题与输出编解码器有关，CV社区经常讨论这个问题。</em> </strong></p><p id="5377" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们以行人检测代码作为参考。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="ca7a" class="kd ke hi jz b fi kf kg l kh ki">import cv2</span><span id="0b31" class="kd ke hi jz b fi kj kg l kh ki">cap = cv2.VideoCapture(<strong class="jz hj">&lt;enter file path.mp4&gt;</strong>)</span><span id="73cb" class="kd ke hi jz b fi kj kg l kh ki">pedestrian_cascade = cv2.CascadeClassifier(cv2.VideoCapture(<strong class="jz hj">&lt;enter file path.xml&gt;</strong>))</span><span id="6c40" class="kd ke hi jz b fi kj kg l kh ki">while True:<br/>    ret, frames = cap.read()<br/>    pedestrians = pedestrian_cascade.detectMultiScale( frames, 1.1, <br/>    1)</span><span id="86d3" class="kd ke hi jz b fi kj kg l kh ki">for (x,y,w,h) in pedestrians:<br/>        cv2.rectangle(frames,(x,y),(x+w,y+h),(0,255,0),2)<br/>        font = cv2.FONT_HERSHEY_DUPLEX<br/>        cv2.putText(frames, 'Person', (x + 6, y - 6), font, 0.5, (0, <br/>        255, 0), 1)<br/>        cv2.imshow('Pedestrian detection', frames)<br/>    if cv2.waitKey(33) == 13:<br/>        break</span><span id="a9e1" class="kd ke hi jz b fi kj kg l kh ki">cap.release()<br/>cv2.destroyAllWindows()</span></pre><p id="0a69" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了记录通过<em class="jt"> imshow </em>命令以单个帧显示给用户的内容，我们需要定义输出，其中<em class="jt">循环中的每一帧都覆盖了输出。</em></p><h1 id="baf7" class="kk ke hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">将视频写入硬盘的代码— macOS</h1><p id="962c" class="pw-post-body-paragraph iv iw hi ix b iy lh ja jb jc li je jf jg lj ji jj jk lk jm jn jo ll jq jr js hb bi translated">将输出视频保存在指定路径中的代码如下，粗体部分参照上面显示的代码进行了更改，代码后面有解释</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="4029" class="kd ke hi jz b fi kf kg l kh ki">import cv2</span><span id="5a01" class="kd ke hi jz b fi kj kg l kh ki">cap = cv2.VideoCapture( <strong class="jz hj">&lt;enter file path.mp4&gt;</strong>)</span><span id="a47c" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj">fourcc = cv2.VideoWriter_fourcc('m','p','4','v')# note the lower case</strong></span><span id="8690" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj">frame_width = int(cap.get(3))<br/>frame_height = int(cap.get(4))</strong></span><span id="4fd0" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj">out = cv2.VideoWriter(&lt;enter file path.mp4&gt;,fourcc , 10, (frame_width,frame_height), True)</strong></span><span id="1bd4" class="kd ke hi jz b fi kj kg l kh ki">pd_cascade = cv2.CascadeClassifier(<strong class="jz hj">&lt;enter file path.xml&gt;</strong>)</span><span id="7c88" class="kd ke hi jz b fi kj kg l kh ki">while True:<br/>    ret, frames = cap.read()</span><span id="c6a6" class="kd ke hi jz b fi kj kg l kh ki">pedestrians = pd_cascade.detectMultiScale( frames, 1.1, 1)</span><span id="6d3f" class="kd ke hi jz b fi kj kg l kh ki">for (x,y,w,h) in pedestrians:<br/>        cv2.rectangle(frames,(x,y),(x+w,y+h),(0,255,0),2)<br/>        font = cv2.FONT_HERSHEY_DUPLEX<br/>        cv2.putText(frames, 'Person', (x + 6, y - 6), font, 0.5, (0, 255, 0), 1)</span><span id="f673" class="kd ke hi jz b fi kj kg l kh ki">cv2.imshow('Pedestrian detection', frames)<br/>    <strong class="jz hj">out.write(frames)</strong><br/>    <br/>    if cv2.waitKey(33) == 13:<br/>        break</span><span id="7d6f" class="kd ke hi jz b fi kj kg l kh ki">cap.release()<br/><strong class="jz hj">out.release()</strong><br/>cv2.destroyAllWindows()</span></pre><h1 id="adc0" class="kk ke hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">代码的解释</h1><p id="9eea" class="pw-post-body-paragraph iv iw hi ix b iy lh ja jb jc li je jf jg lj ji jj jk lk jm jn jo ll jq jr js hb bi translated">在开始按帧读取视频之前，我们将输出定义如下:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="7b8f" class="kd ke hi jz b fi kf kg l kh ki"><strong class="jz hj">fourcc = cv2.VideoWriter_fourcc('m','p','4','v')# note the lower case</strong></span><span id="8ce9" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj">frame_width = int(cap.get(3))<br/>frame_height = int(cap.get(4))</strong></span><span id="8b8d" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj">out = cv2.VideoWriter(&lt;enter file path.mp4&gt;,fourcc , 10, (frame_width,frame_height), True)</strong></span></pre><p id="d1a3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">书面视频的输出需要规范，如文件名、编解码器、每秒帧数(fps)、帧高和帧宽。</p><p id="a444" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">参数说明:</strong></p><p id="47ad" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> fourcc: </strong>需要声明的编解码器。我们可以这样定义它:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="9873" class="kd ke hi jz b fi kf kg l kh ki"><strong class="jz hj">fourcc = cv2.VideoWriter_fourcc('m','p','4','v')# note the lower case</strong></span></pre><p id="675a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">请注意，你需要用小写字母写编解码器</strong></p><p id="d79f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">另外，<strong class="ix hj">帧宽和帧高</strong>可以参考输入视频/网络摄像头或用户提供。我在代码里用过FPS 10。但是，您可以使用以下方法获得输入视频的帧尺寸:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="3892" class="kd ke hi jz b fi kf kg l kh ki"><strong class="jz hj">frame_width = int(cap.get(3))<br/>frame_height = int(cap.get(4))</strong></span></pre><p id="4eb3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">每秒帧数</strong>可以映射到输入视频的FPS值，使用:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="bdc8" class="kd ke hi jz b fi kf kg l kh ki"><strong class="jz hj">get(CAP_PROP_FPS) or get(CV_CAP_PROP_FPS)</strong></span></pre><p id="8aaf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了生成彩色视频作为输出，我们使用了<em class="jt"> isColor </em>参数。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="0de2" class="kd ke hi jz b fi kf kg l kh ki"><strong class="jz hj">isColor= True</strong></span></pre><h1 id="bacd" class="kk ke hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">记住</h1><p id="1acf" class="pw-post-body-paragraph iv iw hi ix b iy lh ja jb jc li je jf jg lj ji jj jk lk jm jn jo ll jq jr js hb bi translated">一旦您通过Anaconda提示符运行代码，您将看到一个弹出视频，它以帧的形式显示输出。视频以您观看视频的速度在后台写入。</p><p id="9efe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">退出输出视频时，视频会保存在指定的路径中，直到输出被流化。</p><p id="eaba" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">那都是乡亲们！如果你有任何问题，请在评论区告诉我。</p><h1 id="a986" class="kk ke hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">编码</h1><div class="lm ln ez fb lo lp"><a href="https://github.com/chandravenky/Computer-Vision---Object-Detection-in-Python/tree/master/macOS%20recording%20codes" rel="noopener  ugc nofollow" target="_blank"><div class="lq ab dw"><div class="lr ab ls cl cj lt"><h2 class="bd hj fi z dy lu ea eb lv ed ef hh bi translated">chandravenky/计算机视觉——Python中的对象检测</h2><div class="lw l"><h3 class="bd b fi z dy lu ea eb lv ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="lx l"><p class="bd b fp z dy lu ea eb lv ed ef dx translated">github.com</p></div></div><div class="ly l"><div class="lz l ma mb mc ly md io lp"/></div></div></a></div><h1 id="320c" class="kk ke hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">相关链接</h1><p id="5e44" class="pw-post-body-paragraph iv iw hi ix b iy lh ja jb jc li je jf jg lj ji jj jk lk jm jn jo ll jq jr js hb bi translated"><a class="ae iu" rel="noopener" href="/@venkatesh.chandra_75550/person-pedestrian-detection-in-real-time-and-recorded-videos-in-python-windows-and-macos-4c81142f5f59"> <strong class="ix hj">使用OpenCV的Python中的行人检测— Windows和macOS </strong> </a></p><p id="f3b3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" rel="noopener" href="/@venkatesh.chandra_75550/vehicle-car-detection-in-real-time-and-recorded-videos-in-python-windows-and-macos-c5548b243b18"> <strong class="ix hj">使用OpenCV的Python中的车辆检测— Windows和macOS </strong> </a></p><p id="c596" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" rel="noopener" href="/@venkatesh.chandra_75550/real-time-webcam-face-detection-system-using-opencv-in-python-windows-and-macos-86c31fddd2bc"><strong class="ix hj">Python中的实时人脸检测系统— Windows和macOS </strong> </a></p><p id="31b9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" rel="noopener" href="/@venkatesh.chandra_75550/face-detection-on-recorded-videos-using-opencv-in-python-windows-and-macos-407635c699"><strong class="ix hj">Python中录制视频的人脸检测— Windows和macOS </strong> </a></p><h1 id="da4c" class="kk ke hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">去哪里找我🤓</h1><ol class=""><li id="e833" class="me mf hi ix b iy lh jc li jg mg jk mh jo mi js mj mk ml mm bi translated">在<a class="ae iu" href="https://www.linkedin.com/in/venkateshchandra/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>/<a class="ae iu" href="https://github.com/chandravenky" rel="noopener ugc nofollow" target="_blank">GitHub</a>/<a class="ae iu" href="http://chatraja.com/" rel="noopener ugc nofollow" target="_blank">我的网站</a>上与我联系</li><li id="b89e" class="me mf hi ix b iy mn jc mo jg mp jk mq jo mr js mj mk ml mm bi translated">感觉大方？给我买一杯☕️咖啡</li></ol></div></div>    
</body>
</html>