<html>
<head>
<title>Kafka — All you want to know</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">卡夫卡——你想知道的一切</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/kafka-all-you-want-to-know-b9624e496006?source=collection_archive---------16-----------------------#2020-07-02">https://medium.com/analytics-vidhya/kafka-all-you-want-to-know-b9624e496006?source=collection_archive---------16-----------------------#2020-07-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/5c26d735fc07156a184ff8c4f7509eee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*svsP-KFUSLKbMz0jcgnMEg.jpeg"/></div></figure><blockquote class="im in io"><p id="5baf" class="ip iq ir is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">历史</strong></p></blockquote><p id="23dc" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jo jc jd je jp jg jh ji jq jk jl jm jn hb bi translated">Apache Kafka最初由LinkedIn开发，随后于2011年初开源。2014年11月，几名在LinkedIn从事Kafka工作的工程师创建了一家名为Confluent的新公司，专注于Kafka。杰伊·克雷普斯似乎以作家弗朗茨·卡夫卡的名字给它命名，因为它是“一个为写作而优化的系统”，而且他喜欢卡夫卡的作品。</p><h1 id="2dfd" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated"><strong class="ak">什么和为什么</strong></h1><p id="c7ab" class="pw-post-body-paragraph ip iq hi is b it kp iv iw ix kq iz ja jo kr jd je jp ks jh ji jq kt jl jm jn hb bi translated">在当今世界，社交媒体、在线购物或任何其他类型的各种应用程序导致数据呈指数级增长。大多数时候，产生信息的应用程序和使用信息的应用程序相距甚远，彼此无法访问。我们需要一种无缝的机制，能够可靠而快速地将这些信息传递给多个接收者。</p><p id="4f70" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jo jc jd je jp jg jh ji jq jk jl jm jn hb bi translated">Kafka是一种解决方案，它在生产者和消费者的信息之间提供无缝集成，而不会阻止信息的生产者，也不会让生产者知道谁是最终消费者。</p><figure class="kv kw kx ky fd ij er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ku"><img src="../Images/4a47a6cc9fc3e82f50a7597b3480e390.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Yhi6LDBRrNjbE_ESPVfoA.png"/></div></div></figure></div><div class="ab cl ld le gp lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hb hc hd he hf"><h2 id="cd02" class="lk js hi bd jt ll lm ln jx lo lp lq kb jo lr ls kf jp lt lu kj jq lv lw kn lx bi translated"><strong class="ak">术语:</strong></h2><p id="0384" class="pw-post-body-paragraph ip iq hi is b it kp iv iw ix kq iz ja jo kr jd je jp ks jh ji jq kt jl jm jn hb bi translated">在讨论卡夫卡时，我们会用到各种各样的术语。它们是:</p><ul class=""><li id="e4d1" class="ly lz hi is b it iu ix iy jo ma jp mb jq mc jn md me mf mg bi translated">消息:它就像我们关系数据库中的一条记录。甚至认为它是一个字符串</li><li id="4539" class="ly lz hi is b it mh ix mi jo mj jp mk jq ml jn md me mf mg bi translated"><strong class="is hj">主题:</strong>属于特定类别的消息流称为主题。数据存储在主题中。</li><li id="da66" class="ly lz hi is b it mh ix mi jo mj jp mk jq ml jn md me mf mg bi translated"><strong class="is hj">代理:</strong>集群中的每个服务器都被视为一个代理。这是我们储存数据的地方。</li><li id="28f2" class="ly lz hi is b it mh ix mi jo mj jp mk jq ml jn md me mf mg bi translated"><strong class="is hj">生产者:</strong>产生消息的人。</li><li id="7af0" class="ly lz hi is b it mh ix mi jo mj jp mk jq ml jn md me mf mg bi translated"><strong class="is hj">消费者:</strong>消费来自代理的批量消息的人。</li><li id="83fc" class="ly lz hi is b it mh ix mi jo mj jp mk jq ml jn md me mf mg bi translated"><strong class="is hj">分区:</strong>主题分分区。分区允许跨多个代理拆分数据。它允许多个消费者并行阅读一个主题。</li><li id="358e" class="ly lz hi is b it mh ix mi jo mj jp mk jq ml jn md me mf mg bi translated"><strong class="is hj">复制:</strong>跨代理拥有同一个分区的多个副本以实现数据高可用性的过程。</li><li id="13d8" class="ly lz hi is b it mh ix mi jo mj jp mk jq ml jn md me mf mg bi translated"><strong class="is hj">领导者:</strong>即使我们有多个副本，一个分区也只有一个领导者。他负责发送和接收该分区的数据。</li><li id="d349" class="ly lz hi is b it mh ix mi jo mj jp mk jq ml jn md me mf mg bi translated"><strong class="is hj">跟随者:</strong>除了首领以外的所有其他复制品。他们将与领导者保持同步。</li><li id="8084" class="ly lz hi is b it mh ix mi jo mj jp mk jq ml jn md me mf mg bi translated"><strong class="is hj"> Offset: </strong>分区中每个消息的唯一ID，类似于数组索引。</li><li id="c688" class="ly lz hi is b it mh ix mi jo mj jp mk jq ml jn md me mf mg bi translated"><strong class="is hj">消费者群体:</strong>一群消费者平行阅读一个卡夫卡主题，以提高消费速度。</li></ul></div><div class="ab cl ld le gp lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hb hc hd he hf"><h2 id="4b90" class="lk js hi bd jt ll lm ln jx lo lp lq kb jo lr ls kf jp lt lu kj jq lv lw kn lx bi translated">保留:</h2><p id="52f0" class="pw-post-body-paragraph ip iq hi is b it kp iv iw ix kq iz ja jo kr jd je jp ks jh ji jq kt jl jm jn hb bi translated">Retention是一种配置，它告诉kafka它可以将特定的消息保留多长时间。卡夫卡抛弃基于时间或大小的旧信息。</p><blockquote class="im in io"><p id="6c15" class="ip iq ir is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">时间</strong></p></blockquote><p id="b3b2" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jo jc jd je jp jg jh ji jq jk jl jm jn hb bi translated">默认值为168小时(7天)。有多种配置可用于以毫秒、小时或分钟为单位更改该值。它们是:</p><pre class="kv kw kx ky fd mm mn mo mp aw mq bi"><span id="e060" class="lk js hi mn b fi mr ms l mt mu"><em class="ir">log.retention.ms  <br/>log.retention.hours<br/>log.retention.minutes</em></span></pre><p id="8746" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jo jc jd je jp jg jh ji jq jk jl jm jn hb bi translated"><em class="ir">如果指定了多个，较小的单元尺寸优先</em></p><blockquote class="im in io"><p id="5353" class="ip iq ir is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">大小</strong></p></blockquote><p id="82d4" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jo jc jd je jp jg jh ji jq jk jl jm jn hb bi translated">另一种使消息过期的方法是基于保留的消息的总字节数。默认值为1 GB</p><pre class="kv kw kx ky fd mm mn mo mp aw mq bi"><span id="f012" class="lk js hi mn b fi mr ms l mt mu">log.retention.bytes</span></pre></div><div class="ab cl ld le gp lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hb hc hd he hf"><p id="1cba" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jo jc jd je jp jg jh ji jq jk jl jm jn hb bi translated">我们在卡夫卡中经常使用的基本命令是:</p><h2 id="cba7" class="lk js hi bd jt ll lm ln jx lo lp lq kb jo lr ls kf jp lt lu kj jq lv lw kn lx bi translated"><strong class="ak"> 1。启动Kafka服务器</strong></h2><pre class="kv kw kx ky fd mm mn mo mp aw mq bi"><span id="170e" class="lk js hi mn b fi mr ms l mt mu">kafka/bin/kafka-server-start.sh kafka/config/server.properties &amp;</span></pre><h2 id="8e3c" class="lk js hi bd jt ll lm ln jx lo lp lq kb jo lr ls kf jp lt lu kj jq lv lw kn lx bi translated"><strong class="ak"> 2。创建主题</strong></h2><p id="1802" class="pw-post-body-paragraph ip iq hi is b it kp iv iw ix kq iz ja jo kr jd je jp ks jh ji jq kt jl jm jn hb bi translated">卡夫卡创造的主题是:</p><pre class="kv kw kx ky fd mm mn mo mp aw mq bi"><span id="4614" class="lk js hi mn b fi mr ms l mt mu">kafka/bin/kafka-topics.sh \<br/><strong class="mn hj">--create</strong> \<br/><strong class="mn hj">--zookeeper</strong> localhost:2181 \<br/><strong class="mn hj">--replication-factor</strong> 1 \<br/><strong class="mn hj">--partitions</strong> 1 \<br/><strong class="mn hj">--topic </strong>test-topic</span></pre><p id="307d" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jo jc jd je jp jg jh ji jq jk jl jm jn hb bi translated"><em class="ir">这里test-topic是题目名称。</em></p><h2 id="a46c" class="lk js hi bd jt ll lm ln jx lo lp lq kb jo lr ls kf jp lt lu kj jq lv lw kn lx bi translated">3.列出主题:</h2><p id="d5cf" class="pw-post-body-paragraph ip iq hi is b it kp iv iw ix kq iz ja jo kr jd je jp ks jh ji jq kt jl jm jn hb bi translated">要列出kafka区域中所有可用的主题:</p><pre class="kv kw kx ky fd mm mn mo mp aw mq bi"><span id="3f67" class="lk js hi mn b fi mr ms l mt mu">kafka/bin/kafka-topics.sh \<br/><strong class="mn hj">--list</strong> \<br/><strong class="mn hj">--zookeeper</strong> localhost:2181</span></pre><h2 id="5c95" class="lk js hi bd jt ll lm ln jx lo lp lq kb jo lr ls kf jp lt lu kj jq lv lw kn lx bi translated">4.生成消息:</h2><p id="1471" class="pw-post-body-paragraph ip iq hi is b it kp iv iw ix kq iz ja jo kr jd je jp ks jh ji jq kt jl jm jn hb bi translated">如果您想为一个主题生成几条消息，命令是:</p><pre class="kv kw kx ky fd mm mn mo mp aw mq bi"><span id="306b" class="lk js hi mn b fi mr ms l mt mu">kafka/bin/kafka-console-producer.sh \<br/><strong class="mn hj">-broker-list</strong> localhost:9092 \<br/><strong class="mn hj">-topic</strong> test-topic</span></pre><p id="7318" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jo jc jd je jp jg jh ji jq jk jl jm jn hb bi translated"><em class="ir"> broker-list是可用的kafka经纪人列表。如果我们有多个代理，您可以像这样指定CSV:localhost:9092，localhost:9093 </em></p><h2 id="88d8" class="lk js hi bd jt ll lm ln jx lo lp lq kb jo lr ls kf jp lt lu kj jq lv lw kn lx bi translated">5.消费邮件:</h2><p id="b811" class="pw-post-body-paragraph ip iq hi is b it kp iv iw ix kq iz ja jo kr jd je jp ks jh ji jq kt jl jm jn hb bi translated">消费卡夫卡主题中的信息是:</p><pre class="kv kw kx ky fd mm mn mo mp aw mq bi"><span id="074c" class="lk js hi mn b fi mr ms l mt mu">kafka/bin/kafka-console-consumer.sh \<br/><strong class="mn hj">--bootstrap-server</strong> localhost:9092 \<br/><strong class="mn hj">--topic</strong> test-topic \<br/><strong class="mn hj">--from-beginning</strong></span></pre><h2 id="ba00" class="lk js hi bd jt ll lm ln jx lo lp lq kb jo lr ls kf jp lt lu kj jq lv lw kn lx bi translated">6.邮件计数:</h2><p id="04de" class="pw-post-body-paragraph ip iq hi is b it kp iv iw ix kq iz ja jo kr jd je jp ks jh ji jq kt jl jm jn hb bi translated">要计算kafka主题中的消息数:</p><pre class="kv kw kx ky fd mm mn mo mp aw mq bi"><span id="0e31" class="lk js hi mn b fi mr ms l mt mu">kafka/bin/kafka-run-class.sh \<br/>kafka.tools.GetOffsetShell \<br/><strong class="mn hj">--broker-list</strong> localhost:9092 \<br/><strong class="mn hj">--topic</strong> test-topic \<br/><strong class="mn hj">--time</strong> -1</span></pre><p id="3126" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jo jc jd je jp jg jh ji jq jk jl jm jn hb bi translated"><em class="ir">然而，通过使用上述命令，结果将是主题的最后偏移值。如果有任何邮件由于保留期结束而被删除，我们将不会得到准确的计数。</em></p><h2 id="544e" class="lk js hi bd jt ll lm ln jx lo lp lq kb jo lr ls kf jp lt lu kj jq lv lw kn lx bi translated">7.描述主题:</h2><p id="cb01" class="pw-post-body-paragraph ip iq hi is b it kp iv iw ix kq iz ja jo kr jd je jp ks jh ji jq kt jl jm jn hb bi translated">描述一个主题:</p><pre class="kv kw kx ky fd mm mn mo mp aw mq bi"><span id="e779" class="lk js hi mn b fi mr ms l mt mu">kafka/bin/kafka-topics.sh \<br/><strong class="mn hj">--describe</strong> \<br/><strong class="mn hj">--zookeeper</strong> localhost:2181 \<br/><strong class="mn hj">--topic</strong> test-topic</span></pre><h2 id="d52a" class="lk js hi bd jt ll lm ln jx lo lp lq kb jo lr ls kf jp lt lu kj jq lv lw kn lx bi translated">8.改变主题</h2><pre class="kv kw kx ky fd mm mn mo mp aw mq bi"><span id="c222" class="lk js hi mn b fi mr ms l mt mu">kafka/bin/kafka-configs.sh \<br/><strong class="mn hj">–zookeeper</strong> localhost:2181 \<br/><strong class="mn hj">–alter</strong> \<br/>-<strong class="mn hj">-entity-type</strong> topics \<br/><strong class="mn hj">--entity-name</strong> test-topic \<br/><strong class="mn hj">–partitions</strong> 40</span></pre><h2 id="ad89" class="lk js hi bd jt ll lm ln jx lo lp lq kb jo lr ls kf jp lt lu kj jq lv lw kn lx bi translated">9.删除主题中的所有邮件:</h2><p id="808d" class="pw-post-body-paragraph ip iq hi is b it kp iv iw ix kq iz ja jo kr jd je jp ks jh ji jq kt jl jm jn hb bi translated">要删除一个主题中的所有消息，有两种方法:</p><ul class=""><li id="ba61" class="ly lz hi is b it iu ix iy jo ma jp mb jq mc jn md me mf mg bi translated"><strong class="is hj">删除主题并重新创建:</strong></li></ul><pre class="kv kw kx ky fd mm mn mo mp aw mq bi"><span id="0043" class="lk js hi mn b fi mr ms l mt mu">kafka/bin/kafka-topics.sh \<br/><strong class="mn hj">--zookeeper</strong> localhost:2181 \<br/><strong class="mn hj">--delete</strong> \<br/><strong class="mn hj">--topic</strong> test-topic</span></pre><ul class=""><li id="ab1c" class="ly lz hi is b it iu ix iy jo ma jp mb jq mc jn md me mf mg bi translated"><strong class="is hj">通过更改保留:</strong></li></ul><p id="e871" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jo jc jd je jp jg jh ji jq jk jl jm jn hb bi translated">如果我们像这样将保留期更改为一秒钟，我们可以在一秒钟内删除所有邮件:</p><pre class="kv kw kx ky fd mm mn mo mp aw mq bi"><span id="a55f" class="lk js hi mn b fi mr ms l mt mu">kafka/bin/kafka-configs.sh --zookeeper localhost:2181 --alter --entity-type topics --entity-name test-topic --add-config retention.ms=1000</span></pre><p id="ed53" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jo jc jd je jp jg jh ji jq jk jl jm jn hb bi translated">我们可以使用以下方法将保留时间恢复为默认值:</p><pre class="kv kw kx ky fd mm mn mo mp aw mq bi"><span id="5640" class="lk js hi mn b fi mr ms l mt mu">kafka/bin/kafka-configs.sh  --zookeeper localhost:2181 --alter --entity-type topics --entity-name test-topic --delete-config retention.ms</span></pre><h2 id="bc62" class="lk js hi bd jt ll lm ln jx lo lp lq kb jo lr ls kf jp lt lu kj jq lv lw kn lx bi translated">10.要停止Kafka服务器:</h2><pre class="kv kw kx ky fd mm mn mo mp aw mq bi"><span id="6f70" class="lk js hi mn b fi mr ms l mt mu">kafka/bin/kafka-server-stop.sh kafka/config/server.properties</span></pre></div><div class="ab cl ld le gp lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hb hc hd he hf"><p id="22c4" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jo jc jd je jp jg jh ji jq jk jl jm jn hb bi translated">以上是对卡夫卡及其基本命令的介绍。希望有用。我将很快在卡夫卡中发表另一篇具有一些高级特征的文章。</p><p id="391f" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jo jc jd je jp jg jh ji jq jk jl jm jn hb bi translated">谢谢你…..</p></div></div>    
</body>
</html>