<html>
<head>
<title>Time Series Forecasting with DeepAR</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用DeepAR进行时间序列预测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/time-series-forecasting-with-deepar-cbdae8abab8a?source=collection_archive---------3-----------------------#2020-11-20">https://medium.com/analytics-vidhya/time-series-forecasting-with-deepar-cbdae8abab8a?source=collection_archive---------3-----------------------#2020-11-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1e55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随着时间序列数据的巨大来源和数量，检测数据中的及时模式正在成为许多业务中分析和决策的关键部分。预先了解未来有助于决策者根据客户获得巨大优势的意图来规划他们的战略。</p><p id="effa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预测模型的改进增加了复杂性，以及捕捉以前未被注意到的相关性的能力。在这篇博客中，我们将讨论深度自回归模型(DeepAR)，这是亚马逊Sagemaker的内置算法之一。</p><p id="e1a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">亚马逊SageMaker </strong></p><p id="13a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，让我们在进入DeepAR之前先了解一些关于Amazon SageMaker的信息。每个开发人员和数据科学家都花费数小时来安装特定项目所需的框架和库，但最终还是与安装经理发生了争执。为了消除ML开发步骤中的这些障碍，Amazon Sagemaker已经出现了。Amazon SageMaker是一个完全托管的服务，提供快速构建、训练和部署模型的能力。它是一个基于web的可视化界面，以较低的成本使ML开发步骤更容易、更快。Amazon SageMaker笔记本是EC2实例中的Jupyter笔记本，专用于运行您的环境，以及构建模型的功能工程代码。笔记本实例自动配置AWS配置，以便从笔记本实例访问其他AWS服务。</p><p id="ab99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">EC2实例可以根据特征工程和培训工作需求进行选择和调整大小。AWS控制台记录所有训练作业，我们可以看到它在哪里，模型在哪里，以及使用的数据集。SageMaker创建RESTful API，无论模型在哪里训练，预训练的模型都可以使用Docker容器托管在SageMaker上。Amazon已经提供了Amazon SageMaker Studio，它提供了实验管理，可以轻松地查看和跟踪项目的进展。</p><p id="8ec4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> DeepAR </strong></p><p id="c0a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇博文中，我们将借助DeepAR算法，基于多个因素的过去趋势来预测时间序列。AWS的DeepAR算法是一种使用递归神经网络(RNN)的时间序列预测，具有生成点和概率预测的能力。</p><p id="bc23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用的数据集是尼泊尔2016年消耗的电力负荷概况，以一小时为间隔记录。这是来自尼泊尔电力局的真实数据集，这里的负荷以兆瓦为单位。由于我们的数据集只有一个时间序列，所以我们不会处理“规模”问题，但是DeepAR也能够在一个模型中处理多个时间序列，从而创建一个全局模型。它甚至有可能解决一个冷启动问题，即生成新的时间序列的预测，这些时间序列没有历史时间序列，但与它所训练的时间序列相似。</p><p id="4ba3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们开始吧，</p><p id="fe64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">加载数据集</strong></p><p id="da36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据尼泊尔日历，发现的电力数据集每月以. csv格式存储。在清理数据并将粒度调整为每小时后，预处理后的数据以pickle格式存储。让我们快速浏览一下我们的数据集。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/ff8ee260776984fa19fc5b2d77cdd243.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/0*jaTsZW7OMzcUMnqD"/></div></figure><p id="d5c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">分割数据集</strong></p><p id="6e0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">处理时间序列时，拆分数据集是不同的。与其他数据集不同的是，我们不会像以前那样进行80-20分割。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jl"><img src="../Images/c049ef2c9985ff05d2b7403d43b92cfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/0*fBV6BTWwcDRX8Qby"/></div></figure><p id="3729" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过从每个样本中移除某些数据点来准备训练数据集。而对于测试集，可以使用完整的数据集。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jm"><img src="../Images/2c84be9641159560a06bdbf69c2ecfff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rJKdI5XvrC_SQcZc"/></div></div></figure><p id="1995" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">用JSON格式写作</strong></p><p id="34ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">DeepAR接受JSON行形式的输入:每行一个样本，比如</p><p id="4c66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[{ ' start ':' 2016–04–13 01:00:00 '，' target': [682.14，717.49，707.64，706.44，737.34，1520.08，1568.08，…]}]</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jr"><img src="../Images/ad5a73ca8b74a6993e8f58215097ef3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/0*qLZBTbuNJBZRegpf"/></div></figure><p id="d141" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">JSON格式然后被上传到s3 bucket。</p><p id="2d83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">培训工作配置</strong></p><p id="d77f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于内置算法，我们需要选择容器作为我们运行的相同区域，然后创建一个估计器。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es js"><img src="../Images/499b77bbf9952a6112543a6c2c8ea084.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rsfIA4NkfGsF1VV1"/></div></div></figure><p id="7131" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">训练模型</strong></p><p id="3932" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只需将输入数据放入我们最近配置的估计器中。</p><p id="1f79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在训练完成后，为训练模型提供不同的度量，如RMSE、平均绝对分位数损失、不同分位数的损失等。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jt"><img src="../Images/3af93bfb4cae1292e535576aec725c64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/0*vMuURud4hdnAXY2e"/></div></figure><p id="0e58" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">部署模型</strong></p><p id="2449" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们需要创建一个端点来托管我们的模型，并创建一个预测器来发送请求。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ju"><img src="../Images/ba90c8df121d8090c1f5abcf6c732e12.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/0*OmDS-1VmgsP7I3Pp"/></div></figure><p id="1457" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">获取预测</strong></p><p id="cade" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了获得预测，我们发送JSON格式的样本和一个分位数列表作为可选配置。DeepAR的推理格式可以在这里找到<a class="ae jv" href="https://docs.aws.amazon.com/sagemaker/latest/dg/deepar-in-formats.html" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jw"><img src="../Images/0d6db90ee110dce1f404648ed324102d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lkGPS_kJgd7OlJBL"/></div></div></figure><p id="b0c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">绘制预测结果</strong></p><p id="7168" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">策划是每个人都喜欢和理解正在发生的事情的一种方式。让我们将我们的预测与地面真实值一起绘制出来，看看训练好的模型预测得有多好。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jx"><img src="../Images/8beabc72fcf12e11c16297d85be7ce6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3tSqCPJNo-ZrOvuj"/></div></div></figure><p id="f741" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">结论</strong></p><p id="c4ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用deepAR，我们可以专注于实验我们的时间序列，以获得最好的结果，而不用担心内部基础设施。我们可以很快完成这项工作，因为没有必要写任何培训代码。我们所需要做的就是准备数据，如果需要的话，做必要的调整来改进模型。</p><p id="957d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们有数百个相关的时间序列时，结果会更好，而且我们还会对所有的时间序列使用单一的模型(虽然这里不是这样，但在真实世界的数据中就是这样)。</p><p id="fd0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">没有 <a class="jz ka ge" href="https://medium.com/u/7897ec9b8fe1?source=post_page-----cbdae8abab8a--------------------------------" rel="noopener" target="_blank"> <em class="jy">阿尤什·巴特拉伊</em> </a> <em class="jy">的支持，我是写不出这篇文章的。谢谢！</em></p><p id="69b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jy">原帖</em><a class="ae jv" href="https://www.gritfeat.com/time-series-forecasting-with-deepar/" rel="noopener ugc nofollow" target="_blank"><em class="jy">https://www . gritfeat . com/time-series-forecasting-with-deepar/</em></a></p></div></div>    
</body>
</html>