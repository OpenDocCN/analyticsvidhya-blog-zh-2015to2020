<html>
<head>
<title>Using Python and Selenium to Scrape Infinite Scroll Web Pages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和Selenium抓取无限滚动网页</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/using-python-and-selenium-to-scrape-infinite-scroll-web-pages-825d12c24ec7?source=collection_archive---------1-----------------------#2020-06-26">https://medium.com/analytics-vidhya/using-python-and-selenium-to-scrape-infinite-scroll-web-pages-825d12c24ec7?source=collection_archive---------1-----------------------#2020-06-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b44604766c814439d744d0b1b608d3c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lHZUBEJz9PcgdGGc"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://www.thehindu.com/sci-tech/technology/internet/how-the-infinite-scroll-creates-major-disruption-in-social-routines-and-mental-health/article30666353.ece" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="4e30" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">网络抓取是一种重要的数据收集工具。虽然Twitter和Reddit等大型社交媒体支持使用现有python包快速提取数据的API，但有时您可能会遇到使用API难以解决的任务。例如，Reddit API允许您从subreddit(Reddit中的在线社区)中提取帖子和评论，但很难通过关键字搜索获得帖子和评论(在下一节中，您会更清楚地看到我的意思)。此外，并不是每个网页都有用于网络抓取的API。在这些情况下，手动抓取网页成为最佳选择。然而，现在许多网页都采用了一种网页设计技术:无限滚动。当用户向下滚动到页面底部时，无限滚动网页自动扩展内容，以取代传统的分页。虽然它对用户来说非常方便，但它增加了web报废的难度。在这个故事中，我将展示我开发的用于自动滚动网页的python代码，并作为示例演示如何使用它来抓取Reddit中的URL。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="110f" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">Selenium for infinite scroll web页面:问题是什么？</h1><p id="0ff7" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">假设我想提取Reddit上关于新冠肺炎的帖子和评论进行情感分析。然后我去Reddit.com搜索“新冠肺炎”，结果页面如下:</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ld"><img src="../Images/c415bd61d34e569e25c544fcf4aa7912.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vgaNqxOpVHDvjv4Tl7tmrw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Reddit.com新冠肺炎的搜索结果(滚动前)</figcaption></figure><p id="8fa7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">蓝色框中突出显示的文本是子编辑。注意，它们都是不同的。因此，如果我想通过Reddit API获取所有这些帖子，我必须首先从每个subreddit获取帖子，并编写额外的代码来过滤与新冠肺炎相关的帖子。这是一个非常复杂的过程，因此在这种情况下，手动刮擦是有利的。</p><p id="c985" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">红色框中突出显示的图标和数字是滚动条和<a class="ae iu" href="https://javascript.info/size-and-scroll" rel="noopener ugc nofollow" target="_blank">屏幕高度和滚动高度</a>。屏幕高度代表屏幕的整个高度，滚动高度代表网页的整个高度。滚动条显示我的当前屏幕相对于整个网页的位置，滚动条的长度显示屏幕高度相对于滚动高度的大小。在这种情况下，屏幕高度是864，滚动高度是3615。所以，滚动条比较长。</p><p id="f7ac" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是，当我向下滚动到网页的最底部时，滚动条会缩小，因为屏幕高度没有变化，但是滚动高度现在变成了27452:</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/23e1e7fe35c07394355ce131b41491ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UjY6dkhPKN7d5QjyW4A7zA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Reddit.com新冠肺炎的搜索结果(滚动后)</figcaption></figure><p id="87c9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是无限滚动:在初始阶段，页面上只有少量的帖子，我向下滚动后会有新的帖子出现。不幸的是，Selenium总是以初始形式打开网页。因此，我们从这个网页中提取的HTML是不完整的，我们无法获得向下滚动后显示的帖子。</p><h1 id="e706" class="ka kb hi bd kc kd lj kf kg kh lk kj kk kl ll kn ko kp lm kr ks kt ln kv kw kx bi translated">解决方案？模拟滚动！</h1><p id="2b7f" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">那么，我们如何提取完整的HTML并从这个Reddit网页中获取所有帖子呢？好吧，我们要求硒滚动它！以下代码展示了如何在Selenium中实现自动滚动功能:</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="a396" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Selenium可以在网页的控制台中执行Javascript。因此，我首先获得屏幕高度(我的屏幕的总高度，小于滚动高度)。然后，我让Selenium一次滚动一个屏幕高度。运行几次循环后，Selenium将滚动到一个足够低的位置，触发页面的扩展，新的帖子将开始加载。通常，网页需要一些时间来更新新的滚动高度和加载新的内容，所以我添加了一个暂停时间，让网页有足够的时间来完成更新。<strong class="ix hj">如果暂停时间太短，新的滚动高度将不会更新，循环将很快中断。</strong>然后记录更新后的滚动高度，当我们要求Selenium滚动到大于滚动高度的位置时(这意味着我们到达了末尾)，循环将会中断。</p><h1 id="6576" class="ka kb hi bd kc kd lj kf kg kh lk kj kk kl ll kn ko kp lm kr ks kt ln kv kw kx bi translated">现在，我们来演示一下！</h1><p id="cc15" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">首先，我们需要检查页面并检查在哪里可以找到URL:</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/c1e38a48ae131e359ce3b0958eed79b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QTpm8zMHPV4zboL06sTaQw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">检查页面以查找URL</figcaption></figure><p id="7e35" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们想要的URL就在一个div下的第一个a标签里，类为“y 8 hyj-y _ ltuhkqic 1 mdcq _ 2 inhsnb 8 V5 ea WP 4 p 0 ry _ mE”。看起来很简单！让我们尝试抓取没有自动滚动代码的URL:</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="f0c2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">产生的URL数是22。</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/cefe6176bf4334c15de63d77873d7af4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PJB0pTkp-4gBvj32izFiuA.png"/></div></div></figure><p id="5e00" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，让我们实现自动滚动代码，看看我们可以获得多少个URL:</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="ab53" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">结果URL的数量增加到246个！</p><figure class="le lf lg lh fd ij er es paragraph-image"><div class="er es ls"><img src="../Images/fdf4f0e1f2be189f0cefd0fe430e2125.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*DNFzD1lWMtptwX2qnj6taQ.png"/></div></figure><h1 id="4d9d" class="ka kb hi bd kc kd lj kf kg kh lk kj kk kl ll kn ko kp lm kr ks kt ln kv kw kx bi translated">就是这样！</h1><p id="1387" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">我在许多不同的网站上测试过我的自动滚动代码，包括Linkedin.com、Sephora.com(虽然不是为我自己)等等。它表现得相当好，除非我选择的暂停时间太小(正如我上面提到的)。如果你有兴趣看看我在Sephora.com上用我的代码做什么，就在这里:</p><p id="9ff1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">https://github.com/KuanWeiBeCool<a class="ae iu" href="https://github.com/KuanWeiBeCool" rel="noopener ugc nofollow" target="_blank"/></p><p id="73ee" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">如果你觉得这个故事有用，请为它鼓掌！这对我帮助很大！</strong></p></div></div>    
</body>
</html>