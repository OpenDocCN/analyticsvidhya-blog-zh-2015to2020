<html>
<head>
<title>Exporting a Data Frame to custom formatted Excel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将数据框导出到自定义格式的Excel</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/exporting-a-data-frame-to-custom-formatted-excel-a82a35116e92?source=collection_archive---------3-----------------------#2020-04-11">https://medium.com/analytics-vidhya/exporting-a-data-frame-to-custom-formatted-excel-a82a35116e92?source=collection_archive---------3-----------------------#2020-04-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="0d3e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">介绍</h1><p id="d2a3" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">你可能已经熟悉了熊猫。使用Pandas，将数据框导出到excel文件非常容易。然而，这个导出的文件在外观上非常简单。</p><p id="6f01" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">在这篇文章中，我们将尝试在格式上做一些改变，并尝试使它在视觉上更有趣。</p><p id="34bd" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">对于这项工作，我们将主要使用熊猫。我要用的数据集是一些随机的信用卡数据。你可以在这里找到同样的<a class="ae kb" href="http://eforexcel.com/wp/downloads-17-sample-csv-files-data-sets-for-testing-credit-card/" rel="noopener ugc nofollow" target="_blank"/>。为了更好地理解，我将在下面的数据集中添加一些新列。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/e7acfed64a6d390fca2152534ca15f97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8AFlmlkFzEcF4oQf1yEf4A.png"/></div></div></figure><p id="1762" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">先从进口熊猫和numpy开始吧。</p><pre class="ki kj kk kl fd kt ku kv kw aw kx bi"><span id="add5" class="ky ig hi ku b fi kz la l lb lc">import pandas as pd<br/>import numpy as np</span></pre><p id="6b19" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">读取文件:</p><p id="e909" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">“loc”变量包含数据集文件所在文件夹的名称。您可以直接将数据集文件名和位置放在一个变量中。我个人喜欢串联。正如您在下面看到的，目前该文件有100行和11列</p><pre class="ki kj kk kl fd kt ku kv kw aw kx bi"><span id="83db" class="ky ig hi ku b fi kz la l lb lc">loc = “Y:\\test\\”</span><span id="c734" class="ky ig hi ku b fi ld la l lb lc">df = pd.read_excel(loc+”test_records.xlsx”)<br/>df.shape<br/><em class="le">#(100, 11)</em></span></pre><p id="d161" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">让我们再增加三栏——“余额”、“已用信贷”和“已用信贷率”。为了生成平衡，我们将使用numpy的<em class="le"> random.randint </em>。对于其余的两个专栏，我们可以使用简单的数学公式。</p><pre class="ki kj kk kl fd kt ku kv kw aw kx bi"><span id="f549" class="ky ig hi ku b fi kz la l lb lc">df["Balance"]= np.random.randint(500,15000,df.shape[0])<br/>df["Credit Used"]= df["Credit Limit"] - df["Balance"]<br/>df["Credit Used Rate"] = (df["Credit Used"]/ df["Credit Limit"])<br/>df.head()</span></pre><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es lf"><img src="../Images/10da90d031e5ad3e6657723b2aa2bdd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jy7kv7GLuUZSxRRUQKzhQw.png"/></div></div></figure><p id="3238" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">如果你注意到，信贷使用率是数字，但它应该是百分比格式。事后我们会改的。现在让我们将上面的数据框保存到一个excel文件中，而不改变任何格式。ExcelWriter 是一个将数据框写入excel表格的类。你可以在这里找到更多关于它的信息。</p><pre class="ki kj kk kl fd kt ku kv kw aw kx bi"><span id="e0dd" class="ky ig hi ku b fi kz la l lb lc">writer_1 = pd.ExcelWriter(loc+”test_Records_modified.xlsx”,engine = ‘xlsxwriter’)<br/>df.to_excel(writer_1 , index=False, sheet_name= “Report”)<br/>writer_1.save()</span></pre><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/2e404db297740c8c7aacb596566e70b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*moMk1qPrHxQv357ii5hvBg.png"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">test_Records_modified.xlsx</figcaption></figure></div><div class="ab cl lk ll gp lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hb hc hd he hf"><p id="b8ed" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">让我们创建另一个writer来保存格式化的输出文件。这里我们使用<em class="le"> to_excel </em>函数来创建工作簿</p><pre class="ki kj kk kl fd kt ku kv kw aw kx bi"><span id="e1ba" class="ky ig hi ku b fi kz la l lb lc">writer_2= pd.ExcelWriter(loc+”test_Records_modified_2.xlsx”, engine= “xlsxwriter”)<br/>df.to_excel(writer_2, index=False, sheet_name= “Report”)</span><span id="b79a" class="ky ig hi ku b fi ld la l lb lc">workbook_2 = writer_2.book<br/>worksheet_2 = writer_2.sheets[“Report”]</span></pre><p id="6f3c" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">现在，让我们开始格式化。我们将对上面创建的工作表进行所有更改。</p><p id="07bf" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">首先，我们将定义格式变量，这样我们就可以在代码中需要的地方使用它们。对于这个任务，我们将使用<em class="le"> add_format。</em></p><pre class="ki kj kk kl fd kt ku kv kw aw kx bi"><span id="a90c" class="ky ig hi ku b fi kz la l lb lc"><em class="le"># Adding simple number format. <br/></em>fmt_number = workbook_2.add_format({<br/> “num_format” : “0”<br/>})</span><span id="adf6" class="ky ig hi ku b fi ld la l lb lc"><em class="le"># Adding currency format<br/></em>fmt_currency = workbook_2.add_format({<br/> “num_format” : “$#,##0.00” ,”bold” :False<br/> })</span><span id="93bd" class="ky ig hi ku b fi ld la l lb lc"><em class="le"># Adding percentage format.<br/></em>fmt_rate = workbook_2.add_format({<br/> “num_format” : “%0.0” , “bold” : False<br/>})</span><span id="f4bc" class="ky ig hi ku b fi ld la l lb lc"><em class="le"># Adding formats for header row.<br/></em>fmt_header = workbook_2.add_format({<br/> ‘bold’: True,<br/> ‘text_wrap’: True,<br/> ‘valign’: ‘top’,<br/> ‘fg_color’: ‘#5DADE2’,<br/> ‘font_color’: ‘#FFFFFF’,<br/> ‘border’: 1})</span><span id="23c4" class="ky ig hi ku b fi ld la l lb lc">#Setting the zoom<br/>worksheet_2.set_zoom(80)</span></pre><p id="6072" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">现在，我们将使用<em class="le"> set_column在工作表中使用上面定义的格式变量。</em></p><pre class="ki kj kk kl fd kt ku kv kw aw kx bi"><span id="247a" class="ky ig hi ku b fi kz la l lb lc">worksheet_2.set_column("A:N", 20)<br/>worksheet_2.set_column("K:M", 10, fmt_currency)<br/>worksheet_2.set_column("D:D",20,fmt_number)<br/>worksheet_2.set_column("N:N",10,fmt_rate)</span></pre><p id="9192" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">是时候改变标题格式了。下面代码中的零表示第0行，这基本上是最上面的一行(标题行)。</p><pre class="ki kj kk kl fd kt ku kv kw aw kx bi"><span id="f8a4" class="ky ig hi ku b fi kz la l lb lc">for col , value in enumerate(df.columns.values):<br/> worksheet_2.write(0, col, value, fmt_header)</span></pre><p id="ca09" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">让我们显示某些数字列的总和，如“Balance”。</p><pre class="ki kj kk kl fd kt ku kv kw aw kx bi"><span id="fe8e" class="ky ig hi ku b fi kz la l lb lc">for col in (“Balance”, “Credit Limit”, “Credit Used”):<br/> position_tot = pd.Index(list(df)).get_loc(col)<br/> worksheet_2.write(df.shape[0]+1,position_tot,df[col].sum(axis=0))</span></pre><p id="7fa3" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">拯救作家</p><pre class="ki kj kk kl fd kt ku kv kw aw kx bi"><span id="7f00" class="ky ig hi ku b fi kz la l lb lc">writer_2.save()</span></pre><p id="4e75" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">最终的输出文件如下所示。您可以看到一些列的格式发生了变化。标题格式也不同，看起来也不一样</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/ac2b48af0649c7de4db26d4503ba5aba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GnRP4lTdftmFDF8NZhTFFQ.png"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">格式化</figcaption></figure><p id="e9ff" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">现在，您可以自己更改格式。</p></div></div>    
</body>
</html>