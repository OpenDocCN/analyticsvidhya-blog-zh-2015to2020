<html>
<head>
<title>Factory Pattern &amp; Abstraction in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的工厂模式和抽象</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/factory-pattern-abstraction-in-python-fd42474faa87?source=collection_archive---------15-----------------------#2020-03-20">https://medium.com/analytics-vidhya/factory-pattern-abstraction-in-python-fd42474faa87?source=collection_archive---------15-----------------------#2020-03-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a272" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Python似乎是一种非常有趣的语言，一切尽在掌握。你可以写一些有用的代码，或者用流行的、受人喜爱的概念，比如可靠的、干净的代码和设计模式，写一些漂亮的代码。我不会把这篇文章写得太长，从现在开始，我会试着写一些关于Python的简单概念。在这篇文章中，我将谈论<a class="ae jd" href="https://en.wikipedia.org/wiki/Factory_method_pattern" rel="noopener ugc nofollow" target="_blank">工厂模式</a>，我们如何在Python中实现它，以及如何创建<a class="ae jd" href="https://en.wikipedia.org/wiki/Abstraction_(computer_science)" rel="noopener ugc nofollow" target="_blank">抽象</a>来使事情变得更简单。</p><p id="54e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设我们有一个音频播放器，我们可以播放wav和mp3格式。因此，基于参数<code class="du je jf jg jh b">wav</code>或<code class="du je jf jg jh b">mp3</code>，我们加载文件并播放它们。先做个界面吧。</p><pre class="ji jj jk jl fd jm jh jn jo aw jp bi"><span id="f416" class="jq jr hi jh b fi js jt l ju jv">from abc import ABC, abstractmethod</span><span id="c6b0" class="jq jr hi jh b fi jw jt l ju jv">class AudioPlayer(ABC):</span><span id="e1e3" class="jq jr hi jh b fi jw jt l ju jv">    @abstractmethod<br/>    def load(self, file: str) -&gt; (str):<br/>        pass</span><span id="c439" class="jq jr hi jh b fi jw jt l ju jv">    @abstractmethod<br/>    def play(self) -&gt; (str):<br/>        pass</span></pre><p id="74ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经使用了<code class="du je jf jg jh b">abc</code>包来实现正式接口的概念。<code class="du je jf jg jh b">@abstractmethod</code> decorator暗示这些方法应该被具体的类覆盖。所以现在让我们来制造玩家。</p><pre class="ji jj jk jl fd jm jh jn jo aw jp bi"><span id="e15d" class="jq jr hi jh b fi js jt l ju jv">class Mp3Player(AudioPlayer):</span><span id="0473" class="jq jr hi jh b fi jw jt l ju jv">    def __init__(self):<br/>        self.format = "mp3"<br/>        self.file = None</span><span id="575e" class="jq jr hi jh b fi jw jt l ju jv">    def load(self, file: str) -&gt; (str):<br/>        self.file = file<br/>        return f"Loading {self.format} file named {file}"</span><span id="cfe5" class="jq jr hi jh b fi jw jt l ju jv">    def play(self) -&gt; (str):<br/>        return f"playing {self.file}"</span><span id="42de" class="jq jr hi jh b fi jw jt l ju jv">class WavPlayer(AudioPlayer):</span><span id="c09d" class="jq jr hi jh b fi jw jt l ju jv">    def __init__(self):<br/>        self.format = "wav"<br/>        self.file = None</span><span id="cf8a" class="jq jr hi jh b fi jw jt l ju jv">    def load(self, file: str) -&gt; (str):<br/>        self.file = file<br/>        return f"Loading {self.format} file named {file}"</span><span id="8716" class="jq jr hi jh b fi jw jt l ju jv">    def play(self) -&gt; (str):<br/>        return f"playing {self.file}"</span></pre><p id="3352" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以我们有了<code class="du je jf jg jh b">Mp3Player</code>和<code class="du je jf jg jh b">Wavplayer</code>。他们实现了方法<code class="du je jf jg jh b">load</code>和<code class="du je jf jg jh b">play</code>。这两个类在这里是相同的，但是在实际的实现中，负载应该是不同的，可能游戏也是如此。现在是创建工厂的时候了。下面是Python的神奇之处！</p><pre class="ji jj jk jl fd jm jh jn jo aw jp bi"><span id="e63a" class="jq jr hi jh b fi js jt l ju jv">player_factory = {<br/>    'mp3': Mp3Player,<br/>    'wav': WavPlayer<br/>}</span></pre><p id="f8a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这太神奇了！你可以在字典中映射类，如此简单！在其他语言中，您可能必须编写几个switch cases或if-else。现在可以直接用这个工厂调用我们的load来玩了。这在Python中被称为调度器。</p><pre class="ji jj jk jl fd jm jh jn jo aw jp bi"><span id="3569" class="jq jr hi jh b fi js jt l ju jv">mp3_player = player_factory['mp3']()<br/>print(mp3_player.load("creep.mp3"))<br/>print(mp3_player.play())</span><span id="1bd7" class="jq jr hi jh b fi jw jt l ju jv">wav_player = player_factory['wav']()<br/>print(wav_player.load("that's_life.wav"))<br/>print(wav_player.play())</span></pre><p id="2d8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看看我们如何基于参数初始化一个类！<code class="du je jf jg jh b">mp3_player = player_factory[‘mp3’]()</code> —这真的很酷。所以整个代码看起来像这样—</p><pre class="ji jj jk jl fd jm jh jn jo aw jp bi"><span id="1e4c" class="jq jr hi jh b fi js jt l ju jv">from abc import ABC, abstractmethod</span><span id="427f" class="jq jr hi jh b fi jw jt l ju jv">class AudioPlayer(ABC):</span><span id="0332" class="jq jr hi jh b fi jw jt l ju jv">    @abstractmethod<br/>    def load(self, file: str) -&gt; (str):<br/>        raise NotImplementedError</span><span id="82e3" class="jq jr hi jh b fi jw jt l ju jv">    @abstractmethod<br/>    def play(self) -&gt; (str):<br/>        raise NotImplementedError</span><span id="063e" class="jq jr hi jh b fi jw jt l ju jv">class Mp3Player(AudioPlayer):</span><span id="07d5" class="jq jr hi jh b fi jw jt l ju jv">    def __init__(self):<br/>        self.format = "mp3"<br/>        self.file = None</span><span id="8d81" class="jq jr hi jh b fi jw jt l ju jv">    def load(self, file: str) -&gt; (str):<br/>        self.file = file<br/>        return f"Loading {self.format} file named {file}"</span><span id="62f9" class="jq jr hi jh b fi jw jt l ju jv">    def play(self) -&gt; (str):<br/>        return f"playing {self.file}"</span><span id="933f" class="jq jr hi jh b fi jw jt l ju jv">class WavPlayer(AudioPlayer):</span><span id="21b8" class="jq jr hi jh b fi jw jt l ju jv">    def __init__(self):<br/>        self.format = "wav"<br/>        self.file = None</span><span id="ff7b" class="jq jr hi jh b fi jw jt l ju jv">    def load(self, file: str) -&gt; (str):<br/>        self.file = file<br/>        return f"Loading {self.format} file named {file}"</span><span id="fe68" class="jq jr hi jh b fi jw jt l ju jv">    def play(self) -&gt; (str):<br/>        return f"playing {self.file}"</span><span id="35e7" class="jq jr hi jh b fi jw jt l ju jv">player_factory = {<br/>    'mp3': Mp3Player,<br/>    'wav': WavPlayer<br/>}</span><span id="7780" class="jq jr hi jh b fi jw jt l ju jv">mp3_player = player_factory['mp3']()<br/>print(mp3_player.load("creep.mp3"))<br/>print(mp3_player.play())</span><span id="37a7" class="jq jr hi jh b fi jw jt l ju jv">wav_player = player_factory['wav']()<br/>print(wav_player.load("that's_life.wav"))<br/>print(wav_player.play())</span></pre><p id="a838" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你可以问如果用户在<code class="du je jf jg jh b">player_factory</code>初始化中给<code class="du je jf jg jh b">mp4</code>，会发生什么。好的，代码会崩溃。在这里，我们可以做一个抽象，隐藏所有创建类和验证参数的复杂性。</p><pre class="ji jj jk jl fd jm jh jn jo aw jp bi"><span id="b81f" class="jq jr hi jh b fi js jt l ju jv">class AudioPlayerFactory:</span><span id="0d58" class="jq jr hi jh b fi jw jt l ju jv">    player_factory = {<br/>        'mp3': Mp3Player,<br/>        'wav': WavPlayer<br/>    }</span><span id="257f" class="jq jr hi jh b fi jw jt l ju jv">    @staticmethod<br/>    def make_player(format: str):<br/>        if format not in AudioPlayerFactory.player_factory:<br/>            raise Exception(f"{format} is not supported")<br/>        return AudioPlayerFactory.player_factory[format]()</span></pre><p id="d6a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们可以使用<code class="du je jf jg jh b">AudioPlayerFactory</code>来加载和播放。</p><pre class="ji jj jk jl fd jm jh jn jo aw jp bi"><span id="69a8" class="jq jr hi jh b fi js jt l ju jv">mp3_player = AudioPlayerFactory.make_player('mp3')<br/>print(mp3_player.load("creep.mp3"))<br/>print(mp3_player.play())</span><span id="29f7" class="jq jr hi jh b fi jw jt l ju jv">wav_player = AudioPlayerFactory.make_player('wav')<br/>print(wav_player.load("that's_life.wav"))<br/>print(wav_player.play())</span><span id="940e" class="jq jr hi jh b fi jw jt l ju jv">mp4_player = AudioPlayerFactory.make_player('mp4')<br/>print(mp4_player.load("what_a_wonderful_life.mp4"))<br/>print(mp4_player.play())</span></pre><p id="99e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将看到mp4文件的异常。你可以用自己的方式处理。所以新的代码是—</p><pre class="ji jj jk jl fd jm jh jn jo aw jp bi"><span id="b392" class="jq jr hi jh b fi js jt l ju jv">from abc import ABC, abstractmethod<br/></span><span id="66f9" class="jq jr hi jh b fi jw jt l ju jv">class AudioPlayer(ABC):</span><span id="b693" class="jq jr hi jh b fi jw jt l ju jv">    @abstractmethod<br/>    def load(self, file: str) -&gt; (str):<br/>        raise NotImplementedError</span><span id="a060" class="jq jr hi jh b fi jw jt l ju jv">    @abstractmethod<br/>    def play(self) -&gt; (str):<br/>        raise NotImplementedError<br/></span><span id="cea2" class="jq jr hi jh b fi jw jt l ju jv">class Mp3Player(AudioPlayer):</span><span id="c818" class="jq jr hi jh b fi jw jt l ju jv">    def __init__(self):<br/>        self.format = "mp3"<br/>        self.file = None</span><span id="1f61" class="jq jr hi jh b fi jw jt l ju jv">    def load(self, file: str) -&gt; (str):<br/>        self.file = file<br/>        return f"Loading {self.format} file named {file}"</span><span id="60f6" class="jq jr hi jh b fi jw jt l ju jv">    def play(self) -&gt; (str):<br/>        return f"playing {self.file}"<br/></span><span id="20ae" class="jq jr hi jh b fi jw jt l ju jv">class WavPlayer(AudioPlayer):</span><span id="dd8b" class="jq jr hi jh b fi jw jt l ju jv">    def __init__(self):<br/>        self.format = "wav"<br/>        self.file = None</span><span id="ccb5" class="jq jr hi jh b fi jw jt l ju jv">    def load(self, file: str) -&gt; (str):<br/>        self.file = file<br/>        return f"Loading {self.format} file named {file}"</span><span id="f8d2" class="jq jr hi jh b fi jw jt l ju jv">    def play(self) -&gt; (str):<br/>        return f"playing {self.file}"</span><span id="7329" class="jq jr hi jh b fi jw jt l ju jv">class AudioPlayerFactory:</span><span id="60f4" class="jq jr hi jh b fi jw jt l ju jv">    player_factory = {<br/>        'mp3': Mp3Player,<br/>        'wav': WavPlayer<br/>    }</span><span id="fbcb" class="jq jr hi jh b fi jw jt l ju jv">    @staticmethod<br/>    def make_player(format: str):<br/>        if format not in AudioPlayerFactory.player_factory:<br/>            raise Exception(f"{format} is not supported")<br/>        return AudioPlayerFactory.player_factory[format]()</span><span id="4cb3" class="jq jr hi jh b fi jw jt l ju jv">mp3_player = AudioPlayerFactory.make_player('mp3')<br/>print(mp3_player.load("creep.mp3"))<br/>print(mp3_player.play())</span><span id="8f90" class="jq jr hi jh b fi jw jt l ju jv">wav_player = AudioPlayerFactory.make_player('wav')<br/>print(wav_player.load("that's_life.wav"))<br/>print(wav_player.play())</span><span id="961b" class="jq jr hi jh b fi jw jt l ju jv">mp4_player = AudioPlayerFactory.make_player('mp4')<br/>print(mp4_player.load("what_a_wonderful_life.mp4"))<br/>print(mp4_player.play())</span></pre><p id="74a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这对你设计工厂有所帮助。还有另一种方法来隐藏工厂包的复杂性。我将很快讨论这个问题。掌声将不胜感激。</p></div></div>    
</body>
</html>