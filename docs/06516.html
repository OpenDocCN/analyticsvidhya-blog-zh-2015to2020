<html>
<head>
<title>Forecasting Apple Stock Prices Using LSTM’s and Tensorflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用LSTM和张量流预测苹果股票价格</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/forecasting-apple-stock-prices-using-lstms-and-tensorflow-e070f8c80723?source=collection_archive---------1-----------------------#2020-05-25">https://medium.com/analytics-vidhya/forecasting-apple-stock-prices-using-lstms-and-tensorflow-e070f8c80723?source=collection_archive---------1-----------------------#2020-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="78cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为奖励，变得富有！开个玩笑，兄弟。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/a66c215e27a85c19c1b98eff9c5e877b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*by0YNr16fnggIHXj.gif"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">来源<a class="ae jt" href="https://www.google.com/url?sa=i&amp;url=https%3A%2F%2Fgiphy.com%2Fgifs%2Fwatch-most-important-FAxPrWrvKDPji&amp;psig=AOvVaw0XQ9PkZscxhGNuqT42-u7I&amp;ust=1590435657749000&amp;source=images&amp;cd=vfe&amp;ved=0CAIQjRxqFwoTCJjyitagzekCFQAAAAAdAAAAABAD" rel="noopener ugc nofollow" target="_blank">此处</a></figcaption></figure><p id="ddfd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本帖中，我们将使用Tensorflow建立一个<em class="ju"> LSTM模型来预测苹果股票价格</em>！</p><p id="efb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ju">股票价格预测</em> </strong>是机器学习中一个非常有趣的领域。我个人一直对这个领域的应用很感兴趣。</p><p id="d437" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">机器学习</strong>在过去几年里对<strong class="ih hj"> <em class="ju">股市预测</em> </strong>变得非常有用，如今，许多投资公司都在使用机器学习在<strong class="ih hj">股市</strong>中做决策。</p><p id="0e72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">而且不像很多人认为的那样，我们不需要有一个惊人的<strong class="ih hj">机器学习模型</strong>才能真正赚钱。</p><blockquote class="jv jw jx"><p id="f66f" class="if ig ju ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated"><strong class="ih hj">警告:</strong>这篇文章的目的只是调查和展示机器学习模型如何在股票市场中工作，这不是一个投资建议！股市变化快，不推荐给没有经验的新手！</p></blockquote><p id="40bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们可以继续了！</p><h1 id="e7fa" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">LSTM的作品如何？</strong></h1><p id="c87a" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">基本上，<strong class="ih hj"> <em class="ju"> LSTM型号的</em> </strong>可以随时间存储信息。当我们想要处理时间序列或顺序数据时，这非常有用。</p><p id="1d59" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> LSTM模型</strong>与人类大脑非常相似。当有人对你说:</p><blockquote class="jv jw jx"><p id="9e16" class="if ig ju ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated"><strong class="ih hj">“马克和简正在街上踢足球”</strong></p></blockquote><p id="89a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你已经知道什么是足球，谁是马克和简，什么是街道，所以你可以更容易地处理和理解这些信息。</p><p id="2d75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设你什么都不知道，那将会非常复杂，而且很可能你不会在第一时间理解这些信息。</p><p id="e8b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">LSTM的作品是这样的，在储存信息后，他们可以解决更复杂的问题，而先前的信息是重要的。</p><p id="6026" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章的问题中，当我们想预测价格时，我们需要以前的信息。这就是为什么LSTM的非常有用！</p><p id="ef7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">LSTM的另一个重要特征是，我们可以决定哪些信息将被存储，哪些信息将被丢弃。我们使用门来做到这一点，这有助于我们避免像<a class="ae jt" href="https://www.superdatascience.com/blogs/recurrent-neural-networks-rnn-the-vanishing-gradient-problem/" rel="noopener ugc nofollow" target="_blank">消失梯度问题</a>这样的问题。</p><p id="6479" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下图中，我们有一个LSTM细胞结构和她的功能:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es le"><img src="../Images/e41989980a7619d0a207b3b617efc0ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QMyjxThHXBrB4BZj.jpg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">来源<a class="ae jt" href="https://www.google.com/url?sa=i&amp;url=https%3A%2F%2Fwww.researchgate.net%2Ffigure%2FStructure-of-the-LSTM-cell-and-equations-that-describe-the-gates-of-an-LSTM-cell_fig5_329362532&amp;psig=AOvVaw0Do5ORi7-ZJs1WJw1YyWZG&amp;ust=1590437056825000&amp;source=images&amp;cd=vfe&amp;ved=0CAIQjRxqFwoTCLjC0PClzekCFQAAAAAdAAAAABAI" rel="noopener ugc nofollow" target="_blank">此处</a></figcaption></figure><p id="827f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基本上，在这个功能中出现了遗忘、更新和存储信息的魔力。</p><p id="efd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想更多地了解LSTM，我推荐<a class="ae jt" href="https://machinelearningmastery.com/gentle-introduction-long-short-term-memory-networks-experts/" rel="noopener ugc nofollow" target="_blank">这篇文章</a>。</p><p id="548d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们来解决我们的问题吧！</p><h1 id="9f82" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">理解问题</h1><p id="5946" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">正如你之前看到的，预测股票价格是关于使用序列数据，过去的数据对我们的预测有直接影响。</p><p id="c97a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个股票价格序列数据的例子:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lf"><img src="../Images/22f14db0bf3c2b17061d4155d6230db8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IXXgq39ILKBX8Pvx.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">来源<a class="ae jt" href="https://www.google.com/url?sa=i&amp;url=https%3A%2F%2Ftowardsdatascience.com%2Fpredicting-fang-stock-prices-ecac4ddd27c1&amp;psig=AOvVaw15J6cxN184rRMay4sF5GLm&amp;ust=1590440932417000&amp;source=images&amp;cd=vfe&amp;ved=0CAIQjRxqFwoTCNCm-6m0zekCFQAAAAAdAAAAABAD" rel="noopener ugc nofollow" target="_blank">此处</a></figcaption></figure><p id="9467" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们想做的是:给我们的模型一个苹果的股票价格历史，他将在这些数据中识别模式，并进行大量的计算，然后，给我们预测！</p><p id="9969" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ju">还有我为什么选择苹果股票？</em>T9】</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lg"><img src="../Images/7117f68fe0aa8add1fd771845fa02877.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/0*NGVn16FCf7XboHHb.gif"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">事实上，我就是喜欢苹果！GIF <a class="ae jt" href="https://www.google.com/url?sa=i&amp;url=https%3A%2F%2Fgiphy.com%2Fexplore%2Fstock-market&amp;psig=AOvVaw1IKov4A4KXCiwQ9L026hJc&amp;ust=1590435580504000&amp;source=images&amp;cd=vfe&amp;ved=0CAIQjRxqFwoTCLDRn7agzekCFQAAAAAdAAAAABAD" rel="noopener ugc nofollow" target="_blank">此处</a></figcaption></figure><p id="319c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以首先，我们需要下载我们的数据。对于这个项目，我使用了一个直接从纳斯达克导出的数据集，你可以在这里下载这个数据<a class="ae jt" href="https://www.nasdaq.com/market-activity/stocks/aapl/historical" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="2250" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们正在使用神经网络，所以数据越多越好，我使用了过去5年的价格，这对我们来说很好。</p><p id="577c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下载完数据后，我们要做任何数据科学家或机器学习工程师最糟糕的部分，适应！</p><blockquote class="jv jw jx"><p id="9c2d" class="if ig ju ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated">已经格式化的数据在这篇文章的资源库中，在这篇文章的末尾。</p></blockquote><p id="6c46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是首先调整我们的数据，我们需要看看我们将调整和格式化什么。如果我们看一下数据，看起来是这样的:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lh"><img src="../Images/d28d4a8cd8457ffccedfa5dece9ac527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VInT5LmEUH-A_lp67xb0wg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">我们数据集的头</figcaption></figure><p id="99cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们想知道我们的数据集是否有空值，一个好的方法是使用Seaborn的<strong class="ih hj"> <em class="ju"> heatmap() </em> </strong>来可视化它。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es li"><img src="../Images/a6111a0d7bffa1e289c6b278fec46f42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e6hHv8aFmdgc2iVsBHboww.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">感谢上帝，我们没有空数据！</figcaption></figure><p id="803a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是正如你之前看到的，我们的“日期”栏使用了“/”，这会干扰我们的工作，所以我们需要格式化它！</p><blockquote class="jv jw jx"><p id="49c3" class="if ig ju ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated">实际上，对于我们的模型，我们只想使用开放列，但是这个“日期”列的格式很好，我们可以在以后的其他项目中使用相同的数据。</p></blockquote><p id="e478" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要格式化我们的“日期”列，我们可以使用来自熊猫的<strong class="ih hj"> <em class="ju">到_datetime() </em> </strong>:</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="fc0b" class="lo kc hi lk b fi lp lq l lr ls">data[‘Date’] = pd.to_datetime(data.Date)</span></pre><p id="5163" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们的日期列是日期时间格式！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lt"><img src="../Images/c7682ecc83ebeea7620c489462e27aea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Leo3jNziLJ25gxlnEEhZw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">更好，对吗？</figcaption></figure><p id="ba01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们需要格式化我们的价格，它们是字符串格式。这很容易做到，我们可以用<strong class="ih hj"> <em class="ju">替换掉String类中的()</em> </strong>。</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="e6c0" class="lo kc hi lk b fi lp lq l lr ls">data[‘Open’] = data[‘Open’].replace({‘\$’:’’}, regex=True).astype(float)<br/>data[‘High’] = data[‘High’].replace({‘\$’: ‘’}, regex=True).astype(float)<br/>data[‘Close/Last’] = data[‘Close/Last’].replace({‘\$’: ‘’}, regex=True).astype(float)<br/>data[‘Low’] = data[‘Low’].replace({‘\$’: ‘’}, regex=True).astype(float)</span></pre><p id="b258" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据中最后一个要改变的是删除列名中的空格，我们可以使用Pandas中的<strong class="ih hj"><em class="ju">【rename()</em></strong>来完成。</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="0acf" class="lo kc hi lk b fi lp lq l lr ls">data.rename(columns={‘ Close/Last’: ‘Close/Last’, ‘ Volume’: ‘Volume’,<br/> ‘ Open’: ‘Open’, ‘ High’: ‘High’, ‘ Low’: ‘Low’},<br/> inplace=True)</span></pre><p id="b041" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们的数据集已经格式化，可以进行分割了。</p><p id="304b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的数据集有1258行，我们希望将1000行用于训练，258行用于测试:</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="68fc" class="lo kc hi lk b fi lp lq l lr ls"># Split into train and test:</span><span id="740c" class="lo kc hi lk b fi lu lq l lr ls">data_to_train = data[:1000]<br/>data_to_test = data[1000:]</span></pre><p id="e9c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们可以保存2个csv文件，进行训练和测试。</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="6c33" class="lo kc hi lk b fi lp lq l lr ls">data_to_train.to_csv(‘train_data.csv’)<br/>data_to_test.to_csv(‘test_data.csv’)</span></pre><p id="5f1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ju">该做机器学习了，宝贝！</em>T15】</strong></p><h1 id="2fa4" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">构建我们的模型</h1><p id="a0c8" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">这个架构是基于<a class="ae jt" href="https://github.com/mwitiderrick/stockprice/blob/master/TATA%20.ipynb" rel="noopener ugc nofollow" target="_blank"> Derrick Mwiti模型</a>的，我测试过，结果太好了！</p><p id="5f79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们想在我们的模型中使用“开放”列，所以我们可以使用<strong class="ih hj"> <em class="ju"> iloc </em> </strong>来获取他的值。</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="e78a" class="lo kc hi lk b fi lp lq l lr ls">training_set = train_data.iloc[: , 3:4].values</span></pre><p id="bd00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们想定义一个变量real_stock_price来存储我们的真实数据，以便稍后与我们的模型预测进行比较！</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="5257" class="lo kc hi lk b fi lp lq l lr ls">real_stock_price = test_data.iloc[: , 3:4].values</span></pre><p id="ff1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从“Open”列中取出值后，我们需要对它们进行缩放。这使得我们的模型表现更好！</p><p id="72b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要缩放数值，我们可以用<strong class="ih hj"> <em class="ju"> sklearn </em> </strong>！</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="f63d" class="lo kc hi lk b fi lp lq l lr ls"># Normalizing data, scale between 0 and 1:</span><span id="f4b6" class="lo kc hi lk b fi lu lq l lr ls">from sklearn.preprocessing import MinMaxScaler</span><span id="13b9" class="lo kc hi lk b fi lu lq l lr ls">sc = MinMaxScaler(feature_range=(0, 1))</span><span id="8aa9" class="lo kc hi lk b fi lu lq l lr ls">training_data_scaled = sc.fit_transform(training_set)</span></pre><p id="87e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">缩放训练数据后，我们需要将其格式化为3D数组，以输入到我们的LSTM模型中。我们通过创建60个时间戳来做到这一点。</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="4676" class="lo kc hi lk b fi lp lq l lr ls">X_train = []</span><span id="e2af" class="lo kc hi lk b fi lu lq l lr ls">y_train = []</span><span id="953b" class="lo kc hi lk b fi lu lq l lr ls">for i in range(60, 1000):</span><span id="4e06" class="lo kc hi lk b fi lu lq l lr ls">  X_train.append(training_data_scaled[i-60:i, 0])</span><span id="20ab" class="lo kc hi lk b fi lu lq l lr ls">  y_train.append(training_data_scaled[i, 0])</span><span id="dafe" class="lo kc hi lk b fi lu lq l lr ls">X_train, y_train = np.array(X_train), np.array(y_train)</span></pre><p id="2c96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这样做之后，我们的数据就可以输入到我们的模型中了！</p><p id="f054" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的模型将使用以下架构:</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="6322" class="lo kc hi lk b fi lp lq l lr ls"># Building Model:</span><span id="7c88" class="lo kc hi lk b fi lu lq l lr ls">model = tf.keras.models.Sequential()</span><span id="ef13" class="lo kc hi lk b fi lu lq l lr ls">model.add(tf.keras.layers.LSTM(units=50, return_sequences=True,</span><span id="64dd" class="lo kc hi lk b fi lu lq l lr ls">input_shape=(X_train.shape[1], 1)))</span><span id="4659" class="lo kc hi lk b fi lu lq l lr ls">model.add(tf.keras.layers.Dropout(0.2))</span><span id="a4c2" class="lo kc hi lk b fi lu lq l lr ls">model.add(tf.keras.layers.LSTM(units=50, return_sequences=True))</span><span id="d74c" class="lo kc hi lk b fi lu lq l lr ls">model.add(tf.keras.layers.Dropout(0.2))</span><span id="e6f5" class="lo kc hi lk b fi lu lq l lr ls">model.add(tf.keras.layers.LSTM(units=50, return_sequences=True))</span><span id="1e6c" class="lo kc hi lk b fi lu lq l lr ls">model.add(tf.keras.layers.Dropout(0.2))</span><span id="eb62" class="lo kc hi lk b fi lu lq l lr ls">model.add(tf.keras.layers.LSTM(units=50))</span><span id="a62f" class="lo kc hi lk b fi lu lq l lr ls">model.add(tf.keras.layers.Dropout(0.2))</span><span id="b18e" class="lo kc hi lk b fi lu lq l lr ls">model.add(tf.keras.layers.Dense(units=1))</span><span id="0782" class="lo kc hi lk b fi lu lq l lr ls">model.summary()</span></pre><p id="79a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用丢弃层来避免过拟合问题，此外，我们使用参数<strong class="ih hj"><em class="ju">【return _ sequences】</em></strong>来确定该层是否将返回与LSTM兼容的序列。我们用<strong class="ih hj"><em class="ju">【return _ sequences = True】</em></strong>当我们有了LSTM层之后！</p><p id="82aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在构建我们的模型之后，我们希望用以下代码来编译它:</p><ul class=""><li id="a6fa" class="lv lw hi ih b ii ij im in iq lx iu ly iy lz jc ma mb mc md bi translated"><a class="ae jt" href="https://machinelearningmastery.com/adam-optimization-algorithm-for-deep-learning/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="ju">亚当优化器</em> </strong> </a></li><li id="d880" class="lv lw hi ih b ii me im mf iq mg iu mh iy mi jc ma mb mc md bi translated"><a class="ae jt" href="https://www.statisticshowto.com/mean-squared-error/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="ju">均方误差损失函数</em> </strong> </a></li></ul><p id="d988" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，是时候适合我们的模型了！</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="3041" class="lo kc hi lk b fi lp lq l lr ls">modelo = model.fit(X_train, y_train, epochs=100, batch_size=32)</span></pre><p id="d356" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在训练我们的模型之后，我们可以绘制损失图来可视化它有多好:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mj"><img src="../Images/ee75a092795c5b600b20c53f9661327e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sZevMgkhhou7d2k5o5NY4w.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">惊人的损失S2</figcaption></figure><h1 id="ab51" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">做出预测</strong></h1><p id="21e3" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">为了进行预测，我们需要使用我们的测试数据集，并像我们之前在训练数据集中所做的那样格式化他。</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="0846" class="lo kc hi lk b fi lp lq l lr ls">dataset_total = pd.concat([train_data[‘Open’], test_data[‘Open’]], axis=0)</span><span id="35aa" class="lo kc hi lk b fi lu lq l lr ls">inputs = dataset_total[len(dataset_total) — len(test_data) — 60:].values</span><span id="3bdd" class="lo kc hi lk b fi lu lq l lr ls">inputs = inputs.reshape(-1,1)</span><span id="a8f4" class="lo kc hi lk b fi lu lq l lr ls">inputs = sc.transform(inputs)</span><span id="732e" class="lo kc hi lk b fi lu lq l lr ls">X_test = []</span><span id="dd30" class="lo kc hi lk b fi lu lq l lr ls">for i in range(60, 259):</span><span id="df09" class="lo kc hi lk b fi lu lq l lr ls">   X_test.append(inputs[i-60:i, 0])</span><span id="a9bf" class="lo kc hi lk b fi lu lq l lr ls">X_test = np.array(X_test)</span><span id="b098" class="lo kc hi lk b fi lu lq l lr ls">X_test = np.reshape(X_test, (X_test.shape[0], X_test.shape[1], 1))</span></pre><p id="c2a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">格式化测试数据后，我们可以在X_test中进行预测。</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="d442" class="lo kc hi lk b fi lp lq l lr ls">predicted_stock_price = model.predict(X_test)</span></pre><p id="8345" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是在绘制我们的预测之前，我们需要在预测数组中做一个<strong class="ih hj"><em class="ju">【inverse _ transform()</em></strong>，因为我们使用标度做预测，所以我们的预测在0和1之间。</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="91f1" class="lo kc hi lk b fi lp lq l lr ls">predicted_stock_price = model.predict(X_test)</span></pre><p id="b0a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，是时候绘制预测图了，看看我们的模型与真实股票价格相比表现如何。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mk"><img src="../Images/ea77f29893beabf1b6df96c229685591.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*RPMJsa39A8Nt6I1p9pTQ2w.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">不错吧？</figcaption></figure><p id="0a7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如你所见，我们的模型表现得太好了！</p><p id="a383" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在任何价格预测中使用本文的相同方法，让我们赚钱吧宝贝！</p><p id="980e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在<a class="ae jt" href="https://github.com/gabrielmayers/apple_stocks_forecasting" rel="noopener ugc nofollow" target="_blank">这里</a>访问这个帖子的资源库。</p><p id="7a81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">目前，这就是全部！</p><p id="fcdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下次见！</p><p id="6d99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ju">我的社交媒体:</em> </strong></p><p id="41a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ju">领英:</em></strong><em class="ju"/><a class="ae jt" href="https://www.linkedin.com/in/gabriel-mayer-779b5a162/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/gabriel-mayer-779b5a162/</a></p><p id="b511" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"><em class="ju">GitHub:</em>【https://github.com/gabrielmayers】<a class="ae jt" href="https://github.com/gabrielmayers" rel="noopener ugc nofollow" target="_blank"/></strong></p><p id="9c55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"><em class="ju">Instagram:</em></strong><a class="ae jt" href="https://www.instagram.com/gabrielmayerl/" rel="noopener ugc nofollow" target="_blank">https://www.instagram.com/gabrielmayerl/</a></p><h1 id="651a" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">参考</h1><p id="0dab" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">[1] Derrick Mwiti，<a class="ae jt" href="https://github.com/mwitiderrick/stockprice" rel="noopener ugc nofollow" target="_blank">股价预测教程</a>的数据和笔记本(2018)，Github</p></div></div>    
</body>
</html>