<html>
<head>
<title>How to face a majority class greater than a minority class in a classification predictive modeling: from Caret to H2O</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在分类预测模型中如何面对大于少数类的多数类:从卡雷到H2O</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-face-a-majority-class-greater-than-a-minority-class-in-a-classification-predictive-modeling-2537c38d4afe?source=collection_archive---------7-----------------------#2020-01-29">https://medium.com/analytics-vidhya/how-to-face-a-majority-class-greater-than-a-minority-class-in-a-classification-predictive-modeling-2537c38d4afe?source=collection_archive---------7-----------------------#2020-01-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/cb513ccb8dc11e30c2294c0e84feb54b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SgoUnCuFIyyScSbdVgi--A.png"/></div></div></figure><p id="4a8f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">什么是分类预测建模</em> </strong></p><p id="1162" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在一个数据集中，有数量变量，它表现为数字值，如一个人的年龄或收入，还有质量变量，它表现为几个类别中的一个值，如一个人的性别或所购汽车的品牌。</p><p id="80c6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通常我们指的是因变量为数量变量时的回归任务和有分类响应时的分类任务。分类预测建模的目标是建立映射函数C(X ),该函数将特征空间X作为输入，并预测其离散输出Y的值，该函数估计给定观察的类别。分类任务评估给定观察值属于每个输出类的概率也很常见。</p><p id="7789" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">典型问题与分类任务</em> </strong></p><p id="bbaa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">属于每个类别的示例的数量可以称为类别分布。在分类问题中，每个类的数据集的观测值数量可能不均衡，因此类的分布是不相等的，并且是偏斜的。</p><p id="b677" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我将使用具有相同含义的不平衡分类任务/不平衡分类任务的术语，即在提到二元分类时，多数类大于少数类，其中多数类有许多实例，而少数类缺少观测值。</p><p id="0f27" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这项任务的典型例子有:流失预测、欺诈检测、异常检测、垃圾邮件检测等。但是，不平衡数据集的原因是什么？原因可以分为数据采样和领域属性。</p><p id="50e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数据收集过程中的错误可能会导致类间观察值分布不均，从而引入偏差和误差，否则在一个类中生成观察值的过程在时间、成本和计算方面可能会比另一个类更昂贵，因此很难从域中收集更多样本来改善类分布。</p><p id="f9bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">典型地，在分类任务中使用的大多数机器学习模型是在假设每一类的样本数量相等的情况下工作的，并且结果将是差的预测性能，尤其是对于典型地最有趣和最重要的预测的少数类。</p><p id="112d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">面对不平衡数据集有哪些策略？</em>T11】</strong></p><p id="ae9b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先对<strong class="is hj"> <em class="jo">进行正确的性能度量</em> </strong> <em class="jo">。</em>代表正确预测数除以预测总数的准确性对于不平衡数据集来说并不是正确的选择，因为仅能够预测多数类的简单模型可达到高水平的准确性。</p><p id="7d8b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用混淆矩阵是一个很好的实践，混淆矩阵是将预测分解成一个表格，显示正确的预测(在对角线上)和错误预测的类型。目标是最大化精度(分类器准确性的度量)和召回(分类器完整性的度量)的性能。对于非平衡数据集，更适合使用结合了精度和召回率的F1得分度量，它是两者之间的调和平均值，它表示分类器的精度(精度)和鲁棒性(召回率)。它还使用了ROC曲线，这是假阳性率与真阳性率的关系图，而不是ROC曲线下的面积(AUC ),它是ROC曲线的积分，它提供了比较分类器的得分。</p><p id="b87e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">尝试<strong class="is hj"> <em class="jo">采样</em> </strong> <strong class="is hj"> <em class="jo">方法</em> </strong>对数据集进行采样。为此，有两种主要方法。</p><p id="94c9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">-过抽样:随机抽样(替换)少数群体，以达到与多数群体相同的规模</p><p id="8ad6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">-下采样:随机划分多数类的子集，以达到与少数类相同的规模。</p><p id="85ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">还有生成合成样品的混合方法。最流行的是SMOTE(合成少数过采样技术)，这是一种从少数类创建合成样本而不是从其创建副本的过采样方法。</p><p id="6e05" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">尝试使用<strong class="is hj"> <em class="jo">分层k重交叉验证</em> </strong>作为模型评估。在k折叠交叉验证程序中，训练数据集被共享到<em class="jo"> k </em>折叠中。前<em class="jo"> k-1 </em>褶皱用于训练模型，第<em class="jo"> k </em>褶皱用作测试集。总共有<em class="jo"> k </em>个模型通过这些运行的平均值进行拟合和评估。</p><p id="6edb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不幸的是，k倍交叉验证不适用于评估不平衡的分类器，因为数据集被分成具有均匀概率分布的<em class="jo"> k倍。</em></p><p id="31d2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">解决方案是随机分割数据集，在每个子集中保持相同的类别分布，并使用目标变量来控制采样过程。</p><p id="0f62" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">尝试<strong class="is hj"> <em class="jo">代价敏感算法</em> </strong>。您可以使用相同的算法，但是更新为对成本敏感，对一个类的误分类错误的惩罚比另一个类多。惩罚分类引入了在训练过程中在少数类上犯分类错误的模型的额外成本。这些惩罚会使模型偏向于更多地关注少数群体。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es jp"><img src="../Images/9400f6905d912e352c7bea89a755bb48.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*5xHJ1yUubkfvTsgDukJ-bQ.png"/></div></figure><p id="13dd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">一个实际应用:一个贷款预测模型</em> </strong></p><p id="bf4c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为此，我使用了Kaggle的一个数据集:房屋净值数据集(HMEQ)T9。跟随带有<a class="ae ju" href="https://github.com/claudio1975/Medium-blog/tree/master/How%20to%20face%20a%20majority%20class%20greater%20than%20a%20minority%20class%20in%20a%20classification%20task/R%20approach" rel="noopener ugc nofollow" target="_blank">代码</a>的项目。</p><p id="4772" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它包含5.960最近房屋净值贷款的贷款性能信息。目标变量(BAD)是一个二元变量，表示申请人最终是否违约，并为每个申请人报告12个输入变量。任务是预测拖欠贷款的客户。</p><p id="0f91" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在变量描述的下面</p><p id="b316" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">-坏:1 =客户拖欠贷款0 =贷款已偿还</p><p id="f428" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">-贷款:贷款请求的金额</p><p id="44e8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">-MORTDUE:现有抵押贷款的到期金额</p><p id="8b22" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">-VALUE:当前属性的值</p><p id="6394" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">-原因:DebtCon =债务合并；家庭装修</p><p id="4775" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">工作:六个职业类别</p><p id="854f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">——YOJ:目前工作多年</p><p id="e99e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">DEROG:重大贬损报告的数量</p><p id="6b6f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">-deliq:拖欠信用额度的数量</p><p id="f62f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">-CLAGE:最早交易行的月龄</p><p id="98b8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">-NINQ:最近的信贷额度数量</p><p id="6db1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">-CLNO:信用额度数量</p><p id="f0bf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">-债务与收入的比率</p><p id="c77f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在应用机器学习模型之前，我已经用可视化和统计分析进行了探索性的数据分析。</p><p id="58c4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我可以立即看到目标变量上不平衡的类。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jv"><img src="../Images/e6997f7819dc0324b05e6b43ce86383d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*equtm5VsnADxYK8kegTAJA.jpeg"/></div></div></figure><p id="2f53" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">经过一些活动，如特征选择、对分类特征的特征工程和对数值特征的异常值封顶，在<a class="ae ju" href="https://rpubs.com/claudio75/570633" rel="noopener ugc nofollow" target="_blank">第一步</a>中，我已经用Caret应用了四个基线模型。以逻辑回归作为分类任务的基准，一个神经网络和两个集成模型:随机森林和梯度推进机。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jv"><img src="../Images/16ad3b6a2e944a6a6f3caf2314f83507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QfT6lN6w65Yk_ewP1dulvQ.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">使用Caret对训练集—基线模型进行评估</figcaption></figure><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jv"><img src="../Images/2abbaec535f1144f7ba330ee0243b5d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Worr6sYNaWzvgrOjfu6QCw.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">测试集上的混淆矩阵—带有插入符号的基线模型</figcaption></figure><p id="3904" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<a class="ae ju" href="https://rpubs.com/claudio75/570653" rel="noopener ugc nofollow" target="_blank">第二步</a>中，我在所有模型中应用了Caret:使用分层k倍交叉验证的过采样、下采样和SMOTE方法。</p><p id="1a70" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从应用的三种方法来看，过采样方法在测试集的混淆矩阵上表现出最佳性能。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jv"><img src="../Images/8a92111668b463032489da92be3ed2a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eldXEmu2fEWyyD3l4cWlig.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">对训练集的评估——用Caret进行过采样</figcaption></figure><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jv"><img src="../Images/e9c30a68bbfc09254657839a322614a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rIJyrS7oiN8Kb_K4c47L2g.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">测试集上的混淆矩阵—使用插入符号进行过采样</figcaption></figure><p id="325a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在第三步中，我尝试了一些成本敏感的学习算法，如Glmnet、成本敏感的C5.0、正则化随机森林和惩罚多项式回归，但只有最后两种适合。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jv"><img src="../Images/fbfdfd1589c2f705cbb1005534415db4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y3HRryJus-ptjt7OI1ukOg.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">用Caret评估列车组—成本敏感模型</figcaption></figure><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ka"><img src="../Images/746eed326a034dc5ddea736950eba5b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8-jdRAs-d8vDR7_3WJlVjA.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">测试集上的混淆矩阵—带有插入符号的成本敏感模型</figcaption></figure><p id="d311" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<a class="ae ju" href="https://rpubs.com/claudio75/570664" rel="noopener ugc nofollow" target="_blank">的最后一步</a>中，我已经将H2O开源框架应用到了前面的四个模型中。</p><p id="fc8f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">H2O显示了出色的结果，也很容易在基线格式中使用，它足以启用平衡类选项的平等类分布。还有其他参数可以用来调优，但是我没有用过。最后，值得一提的是，H2O也比Caret更适合使用大数据。看看<a class="ae ju" href="https://github.com/claudio1975/Medium-blog/tree/master/How%20to%20face%20a%20majority%20class%20greater%20than%20a%20minority%20class%20in%20a%20classification%20task/R%20approach" rel="noopener ugc nofollow" target="_blank">的Github库</a>。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jv"><img src="../Images/54e14df941aa1d1f6825b71eb31aceec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nl4l8c4z2746gvOHWW-tFQ.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">测试集上的混淆矩阵——H2O抽样</figcaption></figure></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><p id="1764" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">参考文献:</em> </strong></p><p id="98b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae ju" href="https://github.com/claudio1975/Medium-blog/tree/master/How%20to%20face%20a%20majority%20class%20greater%20than%20a%20minority%20class%20in%20a%20classification%20task/R%20approach" rel="noopener ugc nofollow" target="_blank"> Github库</a></p><p id="d7fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Robert Tibshirani，Trevor Hastie，Daniela Witten，Gareth James，“统计学习导论:R中的应用”，2013年</p><p id="8e2c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Max Kuhn，Kjell Johnson，“应用预测建模”，2013年</p><p id="96c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae ju" href="https://www.analyticsvidhya.com/blog/2016/03/practical-guide-deal-imbalanced-classification-problems/" rel="noopener ugc nofollow" target="_blank">https://www . analyticsvidhya . com/blog/2016/03/practical-guide-deal-unbalanced-class ification-problems/</a></p><p id="6490" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae ju" href="https://machinelearningmastery.com/what-is-imbalanced-classification/" rel="noopener ugc nofollow" target="_blank">https://machine learning mastery . com/what-is-unbalanced-class ification/</a></p><p id="a5d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae ju" href="https://machinelearningmastery.com/tactics-to-combat-imbalanced-classes-in-your-machine-learning-dataset/" rel="noopener ugc nofollow" target="_blank">https://machine learning mastery . com/tactics-to-combat-unbalanced-classes-in-your-machine-learning-dataset/</a></p></div></div>    
</body>
</html>