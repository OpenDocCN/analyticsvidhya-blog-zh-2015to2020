<html>
<head>
<title>Finding (real) peaks in your signal with SciPy and some common-sense tips</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用SciPy和一些常识提示找到信号中的(真实)峰值</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/finding-real-peaks-in-your-signal-with-scipy-and-some-common-sense-tips-a62c55cd387d?source=collection_archive---------6-----------------------#2020-11-09">https://medium.com/analytics-vidhya/finding-real-peaks-in-your-signal-with-scipy-and-some-common-sense-tips-a62c55cd387d?source=collection_archive---------6-----------------------#2020-11-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/73252f5fef665eb779924edf07a3078f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*js_xREe53dhfbs91sux7OQ.jpeg"/></div></div></figure><p id="1426" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你是一名数据科学家，你的典型任务之一就是分析某个信号并找到它的峰值。这可能是你的目标，原因有很多，但更大的原因是峰值以某种方式倾向于显示信号的某种属性。毫不奇怪，Python中已经有一个帮助您找到峰值的库，它就是<a class="ae jo" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.find_peaks.html" rel="noopener ugc nofollow" target="_blank"> SciPy(带有find_peaks函数</a>)。尽管如此，明智地使用这个强大的库来获得我们想要的东西是很重要的<strong class="is hj">我们需要让我们对“峰值”的定义更加明确</strong>。</p><h2 id="d2ec" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">您在找什么？</h2><p id="bcb4" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">在这个例子中，我将展示一个峰值是一颗星:)</p><p id="5417" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在天体物理学领域，<a class="ae jo" href="https://archive.stsci.edu/prepds/deep47tuc/" rel="noopener ugc nofollow" target="_blank">哈勃望远镜提供了Tucanae星</a>的图像文件数据。看起来是这样的:</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es kp"><img src="../Images/b9a549c4afa4d9b9d4a709c87ac205c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/format:webp/1*16j3SZICawEXJgwDo1i7Qg.png"/></div></figure><p id="3d9d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从数学上讲，它只是一个N行M列的矩阵。矩阵的每个数字代表像素的强度。因为我们希望星形尽可能靠近像素，所以我们希望:</p><p id="5104" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> A)如果两个峰值过于接近，我们可能希望将它们视为一个单独的峰值</strong></p><p id="ce88" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> B)不要让更高的强度值过于接近我们正在考虑的峰值(即，如果我们的峰值接近1000，我们不想让2000峰值接近这个峰值)</strong></p><p id="2ee3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> C)我们可能希望峰值衰减到我们正在研究的范围两端的某个值(本例中为0)</strong></p><p id="7153" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如有可能看到的那样，在这些条件下没有天体物理学，因为它们是关于什么是真正的“高峰”的常识性考虑。它们可能听起来微不足道，但是在我们的代码中考虑它们是很重要的。说到这里，我们先从Python说起！</p><h2 id="2611" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">导入你的巫师，给你的精灵命名。</h2><p id="1a63" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">在此特定示例中，您可以使用此设置:</p><pre class="kq kr ks kt fd ku kv kw kx aw ky bi"><span id="be16" class="jp jq hi kv b fi kz la l lb lc">import astropy<br/>from astropy.io import fits<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import matplotlib.pyplot as plt<br/>import matplotlib.colors as mcolors <br/>from matplotlib import cm<br/>import numpy as np<br/>import math <br/>import seaborn as sns<br/>from scipy.misc import electrocardiogram<br/>from scipy.signal import find_peaks<br/>hdu_list= fits.open('imagefilepath')<br/>img_data=hdu_list[0].data</span></pre><h2 id="df1a" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">使用查找峰值</h2><p id="3ce7" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">假设我们对检测1000高度峰值感兴趣。寻找峰值是一个强大的工具来做到这一点，但它确实包括A，B和C邪恶的峰值。不管怎样，这是一个好的开始。在你的图像上固定某个Y，用find_peaks找到你的峰值。一般来说，您可能希望对所有Y-es都这样做。</p><pre class="kq kr ks kt fd ku kv kw kx aw ky bi"><span id="aff5" class="jp jq hi kv b fi kz la l lb lc">HEIGHTS_fixed_y=[]<br/>X_HEIGHTS=[]<br/>Y=[]<br/>for y in range(len(img_data)):<br/>    x = img_data[y]<br/>    peaks, _= find_peaks(x,height=(950, 1050))<br/>    if len(peaks)!=0:<br/>        for i in range(len(peaks)):<br/>            HEIGHTS_fixed_y.append(x[peaks].tolist()[i])<br/>            X_HEIGHTS.append(peaks.tolist()[i])<br/>            Y.append(y)<br/>#X_HEIGHTS save all the x coordinates of the peaks<br/>#HEIGHTS_FIXED_y save all the heights of the peaks (they will be between 950 and 1050)<br/>#Y save all the y coordinates of the peaks</span><span id="c061" class="jp jq hi kv b fi ld la l lb lc">thousand=pd.DataFrame()<br/>thousand['Heights']=HEIGHTS_fixed_y<br/>thousand['$X_{heights}$']=X_HEIGHTS<br/>thousand['Y']=Y</span></pre><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es le"><img src="../Images/2cea4f30d1ae595a5f7b6af3a712bf4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:472/format:webp/1*DvJ1ALCMPMlnCC_gubnLJA.png"/></div></figure><h2 id="1117" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">a)删除彼此过于接近的峰值</h2><p id="4502" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">假设Y=400。在这个坐标上，X=20是一个峰值，X=9800也是一个峰值，这没问题。但是如果X=20是一个峰值，X=24也是一个峰值，那么我们就没有做对事情！假设固定Y的x必须被至少10个像素分隔开，如果不是这样，就删除它们。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lf"><img src="../Images/2ad78d2139dfc3aa08d438d987ffe9d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gGF8cUP8rAuvi-KUjBn_Mg.png"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">A级不可乘高峰)</figcaption></figure><pre class="kq kr ks kt fd ku kv kw kx aw ky bi"><span id="1e0e" class="jp jq hi kv b fi kz la l lb lc">y_unique_values=list(set(thousand.Y.tolist()))<br/>wrong_y=[]<br/>for y in y_unique_values:<br/>    wrong_x=thousand[thousand['Y']==y]['$X_{heights}$'].tolist()<br/>    differences=[]<br/>    if len(wrong_x)!=1:<br/>        <br/>        for x in range(len(wrong_x)-1):<br/>            first_value=wrong_x[x]<br/>            for j in range(x+1,len(wrong_x)):<br/>                difference=abs(first_value-wrong_x[j])<br/>                differences.append(difference)<br/>    for d in differences:<br/>        if d&lt;=10:<br/>            wrong_y.append(y)<br/>for y in wrong_y:<br/>    thousand=thousand[thousand.Y!=y]<br/>thousand=thousand.reset_index().drop(columns=['index'])</span></pre><h2 id="6671" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">b)如果有更高的值，它就不是峰值</h2><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lf"><img src="../Images/0025cfff593d2b8096678834a4915646.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JPXYdk97B_CZXWuZfD5iog.png"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">B级不可乘高峰)</figcaption></figure><p id="db68" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你希望峰值高度接近1000，你不能接受高度接近2000的峰值太接近你的峰值的x。用下面的代码摆脱它们:</p><pre class="kq kr ks kt fd ku kv kw kx aw ky bi"><span id="9e1d" class="jp jq hi kv b fi kz la l lb lc">not_peak_index=[]<br/>for i in range(len(thousand)):<br/>    y_values=img_data[thousand.Y.tolist()[i]].tolist()<br/>    x_min,x_max=thousand['$X_{heights}$'].tolist()[i]-10,thousand['$X_{heights}$'].tolist()[i]+10<br/>    range_values=y_values[x_min:x_max]<br/>    binary=0<br/>    for value in range_values:<br/>        if value &gt; thousand['Heights'].tolist()[i]:<br/>            binary=binary+1<br/>    if binary!=0:<br/>        not_peak_index.append(i)</span></pre><h2 id="1e50" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">c)好了，匹克，你已经说完了，现在回去睡觉吧。</h2><p id="6e5b" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">您可能希望您的峰值在范围的两端衰减到0(即，像下面这样的情况是不可接受的)</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/0ed5c8286f10f8838a5dc972ff7d28c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*udU-wTjDLvRQM0HWpLPmmA.png"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">C类，不得服用</figcaption></figure><p id="592e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用以下代码检测实际达到0的峰值:</p><pre class="kq kr ks kt fd ku kv kw kx aw ky bi"><span id="b567" class="jp jq hi kv b fi kz la l lb lc">not_zeros_index=[]<br/>for i in range(len(thousand)):<br/>    y_values=img_data[thousand.Y.tolist()[i]].tolist()<br/>    x_min,x_max=thousand['$X_{heights}$'].tolist()[i]-10,thousand['$X_{heights}$'].tolist()[i]+10<br/>    if abs(y_values[x_min])&gt;10 and abs(y_values[x_max]&gt;10):<br/>        not_zeros_index.append(i)</span></pre><p id="7618" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们设置10是因为不删除更大的一组点是一个可以接受的妥协，但当然你是老板！</p><h2 id="545d" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated"><strong class="ak">结论:</strong></h2><p id="ea1b" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated"><strong class="is hj"> SciPy(以及一般的Python库)是一个非常强大的库，但是它需要被明智地使用，因为如果我们不指定它，它就不知道我们想要什么</strong>。在这篇文章中，给出了3个技巧来清除find_peaks产生的数据帧中不需要的峰，当然，您可能希望对紧急情况开发更多的条件:)</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es ll"><img src="../Images/7b1333efeb14d744a6591114feb551ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*EQK1r1yRimh-h1IX6aEbHg.jpeg"/></div></figure><p id="fa2b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你喜欢这篇文章，你想知道更多关于机器学习的知识，或者你只是想问我一些你可以问的问题:</p><p id="ce33" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">A.在<a class="ae jo" href="https://www.linkedin.com/in/pieropaialunga/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> Linkedin </strong> </a>上关注我，在那里我发布我所有的故事<br/> B .订阅我的<a class="ae jo" href="https://piero-paialunga.medium.com/subscribe" rel="noopener"> <strong class="is hj">简讯</strong> </a>。这会让你了解新的故事，并给你机会发短信给我，让我收到你所有的更正或疑问。<br/> C .成为<a class="ae jo" href="https://piero-paialunga.medium.com/membership" rel="noopener"> <strong class="is hj">推荐会员</strong> </a>，这样你就不会有任何“本月最大数量的故事”，你可以阅读我(以及成千上万其他机器学习和数据科学顶级作家)写的任何关于最新可用技术的文章。</p><p id="8eec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">再见:)</p></div></div>    
</body>
</html>