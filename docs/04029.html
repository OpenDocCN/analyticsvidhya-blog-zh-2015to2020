<html>
<head>
<title>Unpivot data with delimiters in Power Query</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在超级查询中使用分隔符取消数据透视</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/unpivot-data-with-delimeters-in-power-query-57f57a3ddb4f?source=collection_archive---------11-----------------------#2020-03-02">https://medium.com/analytics-vidhya/unpivot-data-with-delimeters-in-power-query-57f57a3ddb4f?source=collection_archive---------11-----------------------#2020-03-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f73b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有时，我们会收到这样的数据集，其中一个数据值/单元格包含由分隔符(如逗号或分号)分隔的多个单独的值。例如，谷歌表单中下载的答案会出现这种情况。当回答者回答多项选择题时，所有勾选的选项都保存在同一单元格中，用分号分隔。</p><p id="ec43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，如果您想对这些问题的单个选项进行一些分析，该怎么办呢？每个选项被选择了多少次？如果你的数据看起来像这样</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/d03c78a2ecd177a06225c970e5ec4acd.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*QQ2q9iEMKwwREnls9aSFYg.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">带分隔符的数据示例</figcaption></figure><p id="c7d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那你怎么能提取任何关于个人社交网络的知识呢？这可以通过从每个回复中提取个人社交网络并将其保存在自己的行中来实现，也称为unpivoting。</p><p id="dd8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">换句话说，以第一个回答者的回答为例，他们的回答会在末尾占据四行，像这样。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jp"><img src="../Images/9e42fd93dad8a186e2dcd543ca3f417c.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*BRoo-pCcSjO0vvw9HhsdxA.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">非透视数据的示例</figcaption></figure><p id="99ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这样，第一个回答者使用的每个社交网络都可以清楚地识别，即使他们被放在自己的行中，我们仍然知道他们属于谁，因为ID是同样重复的。然而，作为副作用，剩余的列也被重复(在本例中是“性别”列)。</p><h1 id="4b0d" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">输入电源查询</h1><p id="25a1" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">从文章的标题可以看出，这种取消投票是在Power Query中实现的，这本身意味着该解决方案可以在Microsoft Excel和Microsoft Power BI中工作。过程基本相同，但是每个软件的不同之处将在整个解释中注明。</p><p id="a635" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本次演示中，我们将使用开头所示的小型数据集，包括六名受访者的社交网络和性别:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/d03c78a2ecd177a06225c970e5ec4acd.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*QQ2q9iEMKwwREnls9aSFYg.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">演示数据集</figcaption></figure><h1 id="d84e" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">将数据加载到超级查询中</h1><p id="86d6" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">在Excel中，我们需要做的第一件事是将数据范围转换成适当的表格。这很容易通过两个键盘快捷键来完成。选择范围内的任意单元格，然后按<code class="du kt ku kv kw b">Ctrl</code>和<code class="du kt ku kv kw b">A</code>选择整个范围。然后按下<code class="du kt ku kv kw b">Ctrl</code>和<code class="du kt ku kv kw b">T</code>将量程变成表格。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kx"><img src="../Images/bcabdba6b2a824331dd0d5664fb4cb3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*bvaLGta9qI28XwB_OnuT3Q.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">为数据集创建一个表</figcaption></figure><p id="0206" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为列在范围的第一行已经有了标题，所以在创建表格时要确保勾选了“我的表格有标题”选项。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ky"><img src="../Images/419dc57615f2920cfd8079b0380475ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*DNQfOUt61DZjzh38a341MQ.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">数据集表</figcaption></figure><p id="d06b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">既然数据存储在一个表中，我们可以将它装载到Power Query中。选中表格中的任何单元格后，导航到功能区菜单中的数据窗格，然后选择从表格/范围选项。这将把表加载到超级查询中。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kz"><img src="../Images/9e2adb049aeceebde33e6bded4daaa88.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*JXlsnLaXO5A89dp4vJZVxQ.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">从表格/范围选项位置</figcaption></figure><p id="8320" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Power BI中，假设我们在加载数据集后尝试进行这些转换，在Power Query中打开数据集唯一需要做的事情就是在字段窗格中右键单击数据集后选择编辑查询选项。Power BI和Excel的唯一区别是在这个过程的最后一步。电力查询中的以下操作在两个软件中完全相同。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es la"><img src="../Images/064d8c72fb12b98e77740c02da7a6f10.png" data-original-src="https://miro.medium.com/v2/resize:fit:370/format:webp/1*1mRWSiNTFKzS69QU81lCvQ.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">将数据集加载到超级查询中</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es lb"><img src="../Images/7d5bcc2978e49bd2164c50694d806767.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0qs5Chl2mwxGpXv_tGb3Zw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">电源查询中加载的表(Excel/Power BI)</figcaption></figure><h1 id="0917" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">取消数据透视</h1><p id="fc5c" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">既然数据已经加载到Power Query中，那么取消投票就非常容易执行了。选择目标列(“已用社交网络”)，并在功能区菜单的主页窗格下的拆分列选项中选择按分隔符。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es lg"><img src="../Images/18801b4fb98c60ab1bdc463da94e4404.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OqAmcN3cjRGXb0e0hCaD9w.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">按分隔符选项位置拆分列</figcaption></figure><p id="a173" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">顾名思义，这将按照指定的delimeter拆分“已用社交网络”中的数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es lh"><img src="../Images/627101d9a33a275a5e6bc7516442daa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oH6lyLrmsGyJEpukhBLPLQ.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">“按分隔符拆分列”对话框</figcaption></figure><p id="3a29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们正在寻找的分隔符是分号，我们希望Power Query拆分它的所有出现。但是在单击OK之前，高级选项中有我们执行反透视所需的最后一样东西:将拆分的数据存储在行中。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es li"><img src="../Images/130d7dfd3223bbea1ae71352568f1b54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dWp3vlLFQifm7R6rRlti6A.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">按分隔符拆分列并拆分成行</figcaption></figure><p id="9f5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，Power Query会将拆分的数据存储到列中，我们需要指定要创建多少列。在这种情况下，很容易看出，对“使用过的社交网络”问题的回答最多包括四个选项，但当数据集有数百或数千行时呢？</p><p id="7262" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过将数据分成行，这将在自己的行上存储每个单独的社交网络，重复各自的“回答者ID”和“性别”。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lj"><img src="../Images/61e812201a1d1aa3b59bcdf6787819f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*5qh3RVdb_lYmmJjdQJOjaQ.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">超级查询中的取消透视数据</figcaption></figure><h1 id="cba8" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">应用/保存转换</h1><p id="d566" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">我们唯一缺少的是保存结果查询/数据集。</p><p id="a0ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Excel中，我建议选择关闭并加载到…以便您可以选择保存结果的位置和方式。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lk"><img src="../Images/b9d55e43fa3f0173c96af0ec2195ef0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*X3PmRnJUh1T9YjojqGuKdA.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">关闭并加载结果查询</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ll"><img src="../Images/94beb9e958d13ce653313d975be44409.png" data-original-src="https://miro.medium.com/v2/resize:fit:636/format:webp/1*e9O1BRmrk5xLFP3eL08eZg.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">选择将结果查询导入到的位置</figcaption></figure><p id="a24d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了简单起见，我们可以将它作为一个表格加载到一个新的工作表中。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lm"><img src="../Images/56382dd8f87b40bad45629f5221c9969.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*WjczEQKD7z9KEUXLJuNoFg.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">非透视数据集</figcaption></figure><p id="178b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Power BI的情况下，我们应用更改(Close &amp; Apply关闭Power查询并立即应用转换)，而不是Close &amp; Load To…。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ln"><img src="../Images/eec8e245d18fcd990ff72b626e02fd5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:304/format:webp/1*T2Y8imfJvJVMZvmb599ixw.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">关闭并应用Power BI中的转换</figcaption></figure><h1 id="4e4c" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">结束语</h1><p id="96f7" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">至此，我们已经到了文章的结尾。既然我们可以访问每个受访者使用的个人社交网络，我们可以将它们用作过滤器，创建可视化等等。</p><p id="254c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我们所看到的，除了将数据加载到Power Query和应用/保存转换的不同选项之外，在Excel和Power BI中，通过Power Query使用delimeters取消数据透视的过程本质上是相同的。</p><p id="0cce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，如果你想下载这个演示的样本文件，我在GitHub 上有Excel和Power BI各一个<a class="ae lo" href="https://github.com/Ze1598/medium-articles/tree/master/Unpivot%20data%20with%20delimeters%20in%20Power%C2%A0Query" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>