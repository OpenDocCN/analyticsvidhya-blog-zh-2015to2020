<html>
<head>
<title>Saving and Loading Your Model to Resume Training in PyTorch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">保存并加载您的模型，以便在PyTorch中继续培训</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/saving-and-loading-your-model-to-resume-training-in-pytorch-cb687352fa61?source=collection_archive---------0-----------------------#2019-10-01">https://medium.com/analytics-vidhya/saving-and-loading-your-model-to-resume-training-in-pytorch-cb687352fa61?source=collection_archive---------0-----------------------#2019-10-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9dcbff051b3a9c00143748880b543d18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cWekwv06y-c1tA5A"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">由<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae iu" href="https://unsplash.com/@emilep?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">émile Perron</a>拍摄的照片</figcaption></figure><p id="0200" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我刚刚完成了对深度学习模型的训练，以创建歌词的嵌入，并在尝试从特定状态恢复训练我的模型时遇到了多个问题。因此，我决定写一篇博客，与社区分享我的心得。<br/>所以在这篇文章中，我们将讨论如何以检查点的形式保存你的模型，以及如何加载它们来恢复训练你的模型。</p><h1 id="dd17" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">为什么呢？</h1><p id="4812" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">那么，你可能会问的第一个问题是，为什么你甚至需要恢复训练模型？！模型不是应该只有在我们完成训练后才被保存吗？？！<br/>想象一下这样一种情况，你已经训练了你的模型几个小时，突然机器崩溃了，或者你失去了与你训练模型的远程GPU的连接。灾难对吗？考虑另一种情况，您为某些时期训练了您的模型，这已经花费了相当多的时间，但是您对性能不满意，并且您希望为更多时期训练它。</p><blockquote class="kw"><p id="dfc9" class="kx ky hi bd kz la lb lc ld le lf js dx translated">进入检查点和恢复训练！</p></blockquote><p id="407c" class="pw-post-body-paragraph iv iw hi ix b iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated">很明显，需要保存中间模型状态，并有一个恢复训练的机制。我们将这些中间模型状态称为检查点(您可能已经猜到了)。在进入如何保存它们的细节之前，让我们先看看它们是由什么组成的！</p><h1 id="b9e0" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">检查点的内容是什么？</h1><p id="8d47" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">作为一个中间模型状态，我们需要从这里恢复训练，我们需要确保我们保存了模型在训练过程中使用的所有信息。</p><ol class=""><li id="d216" class="ll lm hi ix b iy iz jc jd jg ln jk lo jo lp js lq lr ls lt bi translated"><strong class="ix hj">模型参数</strong></li><li id="4add" class="ll lm hi ix b iy lu jc lv jg lw jk lx jo ly js lq lr ls lt bi translated"><strong class="ix hj">历元数</strong> <br/>保存历元数是一个很好的方法，这样可以记录并跟踪我们总共运行了多少个历元。</li><li id="b353" class="ll lm hi ix b iy lu jc lv jg lw jk lx jo ly js lq lr ls lt bi translated"><strong class="ix hj">优化器参数</strong> <br/>是。你没看错。您需要保存优化器参数，尤其是当您使用Adam作为优化器时。Adam是一种自适应学习率方法，也就是说，它可以计算不同参数的个人学习率，如果你想从你离开的地方继续训练，你就需要这些参数！</li></ol><h1 id="04a4" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">保存检查点</h1><p id="13aa" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">现在我们知道了内容，让我们保存检查点。Pytorch使得保存检查点变得非常容易。</p><figure class="lz ma mb mc fd ij"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="ff3d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意<em class="mf">。pt </em>或<em class="mf">。pth </em>是使用PyTorch保存文件的常用和推荐的文件扩展名。</p><p id="9f22" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们看一下上面的代码块。它将状态保存到指定的检查点目录。除此之外，如果该模型是迄今为止最好的模型，则同样的检查点也被复制到另一个目录中以跟踪该最佳模型。</p><p id="9629" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要使用上述函数，请在训练循环中添加以下代码行</p><figure class="lz ma mb mc fd ij"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="7733" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将模型保存在所需的位置，以后可以使用下一节中的函数读取该位置。</p><h1 id="c049" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">加载检查点</h1><p id="9702" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">与保存检查点非常相似，PyTorch中的函数帮助加载检查点。</p><figure class="lz ma mb mc fd ij"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="3c3a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上述函数读取检查点文件，并将先前保存的模型状态和优化器状态加载到模型和优化器的实例中。加载状态本质上意味着它将模型/优化器参数设置为保存的检查点中存在的值。</p><p id="f7d9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在开始训练循环之前，您可以通过添加以下代码行来加载模型以恢复训练。</p><figure class="lz ma mb mc fd ij"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="a6c7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">基本上，首先初始化您的模型和优化器，然后使用load checkpoint函数更新状态字典。</p><p id="317a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您可以简单地将这个模型和优化器传递到您的训练循环中，您会注意到模型从它停止的地方恢复训练。您可以通过查看每个时期之后的损失值来确认这一点，这是之前观察到的时期(训练停止之前)的延续。</p></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><p id="8928" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">大概就是这样。<br/>感谢阅读。我希望这有所帮助。请不要犹豫，在评论区纠正任何错误。我真的很想学习和提高。</p></div></div>    
</body>
</html>