<html>
<head>
<title>Python Logging: Colorize Your Arguments!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python日志记录:为您的参数着色！</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/python-logging-colorize-your-arguments-41567a754ac?source=collection_archive---------4-----------------------#2020-05-24">https://medium.com/analytics-vidhya/python-logging-colorize-your-arguments-41567a754ac?source=collection_archive---------4-----------------------#2020-05-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a5b1381917dbf07c412365201e3775db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZaOru_rZsnfNCQaPJ5D60g.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">为消息参数记录交替的颜色</figcaption></figure><p id="2108" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">本文的最新完整代码和示例可以在我的<a class="ae js" href="https://github.com/davidohana/colargulog" rel="noopener ugc nofollow" target="_blank"> GitHub Repo </a>获得Apache-2.0许可。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="3273" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">是的，我们喜欢用颜色记录。<br/>是的，有许多Python库和示例代码向您展示了如何根据日志级别来给stdout日志消息着色。</p><p id="fe61" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">但是我将向您展示一些更好的东西——除了通过日志级别进行<strong class="iw hj">着色之外，对于格式字符串中的每个参数，日志消息还具有<strong class="iw hj">交替颜色</strong>。还有一个好处——参数格式是使用Python 3.2中引入的新的“<strong class="iw hj">大括号样式</strong>”格式制作的，例如:</strong></p><figure class="ka kb kc kd fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="2dc3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">实施非常简单，并且没有引入第三方依赖性。要应用颜色，您需要做的就是将StreamHandler的格式化程序设置为<strong class="iw hj"> ColorizedArgsFormatter: </strong>的实例</p><figure class="ka kb kc kd fd ij"><div class="bz dy l di"><div class="ke kf l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">拔靴带</figcaption></figure><h2 id="6957" class="kg kh hi bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">它是如何工作的？</h2><ul class=""><li id="b8e0" class="lb lc hi iw b ix ld jb le jf lf jj lg jn lh jr li lj lk ll bi translated">检查每个日志记录以确定是否使用了大括号样式的格式。我决定使用大括号样式的格式，因为这样更容易识别格式参数的开始和结束:{param}</li><li id="1dcd" class="lb lc hi iw b ix lm jb ln jf lo jj lp jn lq jr li lj lk ll bi translated">当前交替颜色的ANSI转义码添加在每个格式化参数之前，重置颜色转义码添加在它之后</li><li id="51fa" class="lb lc hi iw b ix lm jb ln jf lo jj lp jn lq jr li lj lk ll bi translated">更新日志记录，以便使用str.format()格式化<strong class="iw hj">消息</strong>字段，并将<strong class="iw hj">参数</strong>字段设置为空。</li><li id="2582" class="lb lc hi iw b ix lm jb ln jf lo jj lp jn lq jr li lj lk ll bi translated">特定级别的ANSI转义码添加在<strong class="iw hj"> levelname </strong>和<strong class="iw hj"> levelno </strong>格式占位符之前，重置颜色转义码添加在占位符之后。</li></ul><h2 id="28a2" class="kg kh hi bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">兼容性挑战</h2><ul class=""><li id="4ff3" class="lb lc hi iw b ix ld jb le jf lf jj lg jn lh jr li lj lk ll bi translated"><strong class="iw hj">我们仍然需要支持传统风格的字符串格式</strong>，例如:<br/> <em class="lr"> logger.info("我的名字是%s，我的年龄是%d "，"戴夫"，12) <br/> </em>因为我们代码的许多第三方依赖项可能会以旧格式登录。我的解决方案是使用一些简单的试探法来确定是否应该使用大括号格式:字符串中没有“%”字符+花括号对的数量与日志记录参数的数量相匹配。否则，我们会退回到传统格式，但是没有参数着色可用。</li><li id="8e1d" class="lb lc hi iw b ix lm jb ln jf lo jj lp jn lq jr li lj lk ll bi translated">当记录到其他媒介时，我们必须支持括号格式，比如文件。否则，记录器将无法理解格式字符串，并显示“TypeError:并非所有参数都在字符串格式化期间被转换”。解决方案是使用另一个简单的格式化程序，名为<strong class="iw hj">BraceFormatStyleFormatter</strong>，用于文件记录处理程序和其他不支持颜色的介质。这个格式化程序与<strong class="iw hj">的ColorizedArgsFormatter </strong>非常相似，但是它只使用格式化后的消息重写日志记录，而不添加ANSI颜色转义码。</li></ul><h2 id="2ef0" class="kg kh hi bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">其他提示</h2><ul class=""><li id="2d02" class="lb lc hi iw b ix ld jb le jf lf jj lg jn lh jr li lj lk ll bi translated">默认情况下，有两种交替的颜色。您可以通过更改<em class="lr"> arg_colors </em>列表来更改颜色或添加更多可选颜色。</li><li id="e088" class="lb lc hi iw b ix lm jb ln jf lo jj lp jn lq jr li lj lk ll bi translated">通过改变<em class="lr"> level_to_color </em>字典，可以改变日志级别到颜色的映射。</li><li id="26b7" class="lb lc hi iw b ix lm jb ln jf lo jj lp jn lq jr li lj lk ll bi translated">目前，日志记录中不支持带有kwargs映射的花括号消息格式，例如:<em class="lr">我的名字是{name}”。格式(name="David") </em></li></ul><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/eaa238749a6791264389ed177f196c04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bWzogOG0_V597SKjFnAF7A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">定制—更多交替颜色和不同颜色或调试信息</figcaption></figure><h2 id="f481" class="kg kh hi bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">完整代码</h2><figure class="ka kb kc kd fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><h2 id="efd6" class="kg kh hi bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">引导和日志记录—完整示例应用程序:</h2><figure class="ka kb kc kd fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="7af0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">最新的完整代码和示例可以在我的<a class="ae js" href="https://github.com/davidohana/colargulog" rel="noopener ugc nofollow" target="_blank"> GitHub Repo </a>获得Apache-2.0许可。</p><p id="232c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">度过多彩的一天，<br/>大卫</p></div></div>    
</body>
</html>