# Python Walrus 运算符简介

> 原文：<https://medium.com/analytics-vidhya/intro-to-the-python-walrus-operator-18097716a0b8?source=collection_archive---------10----------------------->

![](img/261d5e748fc47c20362ae5961001f05b.png)

## 介绍

2018 年 2 月 28 日在 [PEP 572](https://www.python.org/dev/peps/pep-0572/) 中首次提出，并由 [Emily Morehouse](https://twitter.com/emilyemorehouse) 实现，即将发布的 Python 3.8 带来了一个新的语言功能，赋值表达式。这个新特性公开了在 Python 表达式中为变量赋值、计算结果，然后在变量的作用域内重用变量的功能。用于定义赋值表达式的`:=`操作符通俗地称为 Walrus 操作符。

> 在讨论该 PEP 时，该运营商被非正式地称为“海象运营商”。该结构的正式名称是“赋值表达式”(按照 PEP 的标题)，但是它们也可以被称为“命名表达式”(例如，CPython 参考实现在内部使用该名称)。

赋值表达式提供的主要好处是代码更简洁，减少了在求值前将表达式的结果赋给变量时对额外代码行的需求。

在较高的层次上，赋值表达式的工作方式是计算`:=` (walrus)操作符右边的表达式，并将其赋给操作符左边的变量。这提供了在一个简单的表达式中评估表达式的布尔结果并从中赋值以便重用的能力。

例如，在下面的例子中，`my_dict.get("name")`检查`my_dict`是否存在关键字为`name`的值。字典中没有该键的值，所以使用 walrus 操作符返回`None`并将其分配给`val`。在条件语句的上下文中，`val`随后被评估并相应地执行，并且可能在其范围内被重用。

这是一个非常简单的例子，用来说明赋值表达式背后的基本原理。

## 争论

正如许多人可能已经意识到的那样，提出这种新语言特性的 PEP 572 在 Python 核心开发者和整个社区中引起了很大的争议。

这最终导致了 Python 的创造者[吉多·范·罗苏姆](https://en.wikipedia.org/wiki/Guido_van_Rossum)和长期以来的 BDFL *(“仁慈的终身独裁者”)*离开 BDFL 的角色，正如他在 2018 年 7 月 12 日的 Python 邮件列表中标题为[权力转移](https://www.mail-archive.com/python-committers@python.org/msg05628.html)的消息所概述的那样。

## 语法和有效用法

如人教版 572 所述…

> 在大多数可以使用任意 Python 表达式的上下文中，可能会出现一个名为表达式的**。它的形式是 NAME := expr，其中 expr 是除未区分元组之外的任何有效的 Python 表达式，NAME 是一个标识符。**

本质上，这意味着在实现赋值表达式之前，可以在合法 Python 表达式可以使用的任何地方使用赋值表达式(*几乎是*),只有少数例外。

赋值表达式合法的情况只是为了避免 Python 中赋值的两种不同语法之间的歧义。这里的目的是不要混淆给定场景的正确语法。

不允许使用下面的赋值表达式(有充分的理由)。

*   在表达式语句的顶层。
*   位于表达式语句右侧的顶层。
*   作为函数调用中关键字参数的值。
*   作为函数定义中的顶级默认值。
*   作为函数参数、返回值或变量赋值的注释。
*   lambda 函数中的非参数化表达式。

不过，通过将赋值表达式放在括号中(通常不允许使用),可以解决这些限制。然而，这可能是个坏主意。Python 核心开发团队出于良好的理由设置了这些限制，以避免模糊和复杂的代码。从下面的例子中可以看出，这些不允许的使用并没有增加可读性，而且在很多情况下使代码很难理解。

> *注:这些例子是从 PEP572* 的 [*异常情况*](https://www.python.org/dev/peps/pep-0572/#exceptional-cases) *部分复制的*

另一个值得注意的规则是，f 字符串上下文中的赋值表达式需要用括号括起来。

`f"Hello, {(name := get_name())}!. Hello, again {name}!"`

## 表达式目标的范围

在 Python 中添加赋值表达式并没有增加任何关于赋值表达式目标变量范围的新行为。

这是有益的，使赋值表达式容易掌握，即使对于新开发人员也是如此，因为它符合 Python 的现有行为。

## 性能考虑因素

在很大程度上，当使用赋值表达式时，性能没有差别。通过移除值的重复计算，使用赋值表达式可以提高性能。

一个例子是当计算值以在列表理解中执行过滤时。

例如，计算一系列数字的 2 的幂，然后在结果值列表中只过滤整数。通过使用列表理解中的赋值表达式来存储`pow(x, 2)`的计算值。在下面的例子中，运行时间提高了近 20%(206 毫秒)。

## 结论

赋值表达式和 walrus 操作符是 Python 的一个有价值的、令人耳目一新的补充。

Python 核心开发团队在提供一个简单易学的特性方面给予的关注。提供一个简单易用的带有少量新语法的操作符是非常好的。如果赋值表达式以实用的方式使用，它们将提高代码的可读性和简洁性。在某些情况下，通过减少重新计算值的需要，也可以提高性能。唯一需要注意的是，作为一个新的语言特性，许多开发者可能会对它的语法和行为感到陌生。在这种情况下，对于这些用户来说，代码的可读性可能会降低。