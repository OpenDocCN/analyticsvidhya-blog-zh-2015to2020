<html>
<head>
<title>D3js Basic to Mastery Part 2 Mastery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">D3js 基础到精通第 2 部分精通</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/d3js-basic-to-mastery-part-2-mastery-680db40f2ec5?source=collection_archive---------13-----------------------#2020-09-07">https://medium.com/analytics-vidhya/d3js-basic-to-mastery-part-2-mastery-680db40f2ec5?source=collection_archive---------13-----------------------#2020-09-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f120ee9a3ee89597747ff49fa39480e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0uZns4fCxsIeoCBRCryjIA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">世界各地新冠肺炎活跃的案例，泡沫比较<a class="ae iu" href="https://covidwithd3js.kiran.dev/worldbubble/" rel="noopener ugc nofollow" target="_blank">https://covidwithd3js.kiran.dev/worldbubble/</a></figcaption></figure><p id="450b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<a class="ae iu" rel="noopener" href="/@krngd2/d3js-basic-to-mastery-bf5459836970"> <strong class="ix hj"> <em class="jt">上一篇文章</em> </strong> </a>中，我们学习了 D3js 的基础知识，比如选择、DOM 操作、SVG、缩放和数据绑定。如果你正在开始使用 D3js，我强烈推荐你先阅读<a class="ae iu" rel="noopener" href="/@krngd2/d3js-basic-to-mastery-bf5459836970">的那篇文章</a>，然后再回到这里。</p><div class="ju jv ez fb jw jx"><a rel="noopener follow" target="_blank" href="/@krngd2/d3js-basic-to-mastery-bf5459836970"><div class="jy ab dw"><div class="jz ab ka cl cj kb"><h2 class="bd hj fi z dy kc ea eb kd ed ef hh bi translated">D3js 基础到精通第 1 部分基础</h2><div class="ke l"><h3 class="bd b fi z dy kc ea eb kd ed ef dx translated">如果你点击了这篇文章，我想你已经知道 d3js 是什么了，你可以在…</h3></div><div class="kf l"><p class="bd b fp z dy kc ea eb kd ed ef dx translated">medium.com</p></div></div><div class="kg l"><div class="kh l ki kj kk kg kl io jx"/></div></div></a></div><p id="a977" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们深入了解本文中的<strong class="ix hj">和</strong>、<strong class="ix hj">数据操作</strong>和<strong class="ix hj">布局</strong>的世界。</p><h1 id="b3ce" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">事件处理</h1><p id="f978" class="pw-post-body-paragraph iv iw hi ix b iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo lo jq jr js hb bi translated">可以通过在选择元素上调用<code class="du lp lq lr ls b">.on(event, function)</code>并传递侦听器的类型来附加事件。</p><p id="441c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们从最基本的交互功能开始。</p><figure class="lt lu lv lw fd ij"><div class="bz dy l di"><div class="lx ly l"/></div></figure><p id="eb51" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在上面的例子中，点击 js 标签。看看附在圆圈上的所有事件处理程序是什么。按 F12 重新加载页面并打开控制台，然后单击“运行笔”。这个控制台记录所有传递给回调函数的参数。<br/> <code class="du lp lq lr ls b">circles.on(‘mouseover’, (event, data)=&gt; {})</code>第一事件详细信息，第二债券数据。这个<code class="du lp lq lr ls b">event</code>用于获取当前事件的详细信息，这些信息可用于各种操作，如拖放和缩放。或者，你可以像这样直接访问 js 中的<code class="du lp lq lr ls b">event</code><code class="du lp lq lr ls b">circles.on(‘click’, () =&gt; console.log(“Event”, event))</code><br/><code class="du lp lq lr ls b">circles.on(‘dblclick’, ondblClick)</code>:在双击事件时，在这个例子中我们传递了一个函数，将元素“变红”。<br/> <code class="du lp lq lr ls b">circles.on(‘wheel’, (d, i, n) =&gt; console.log(“weeeee”, i))</code>:关于滚动事件，这对于用户友好的缩放事件和最后一个例子<code class="du lp lq lr ls b">ondrag</code>事件非常方便，这两个事件有点不同，我们必须在元素上调用<code class="du lp lq lr ls b">d3.drag()</code>函数。其中有类似<code class="du lp lq lr ls b">start</code>、<code class="du lp lq lr ls b">drag</code>、<code class="du lp lq lr ls b">end</code>的 on 事件。</p><pre class="lt lu lv lw fd lz ls ma mb aw mc bi"><span id="9fef" class="md kn hi ls b fi me mf l mg mh">circles.call(d3.drag()<br/>.on(“start”, console.log) <br/>.on(“drag”, onDrag) <br/>.on(“end”, console.log))</span></pre><p id="d489" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<code class="du lp lq lr ls b">onDrag</code>函数中，我们选择元素，并用其<code class="du lp lq lr ls b">event</code>的<code class="du lp lq lr ls b">x </code>属性更改其<code class="du lp lq lr ls b">cx</code>属性。</p><pre class="lt lu lv lw fd lz ls ma mb aw mc bi"><span id="3bb2" class="md kn hi ls b fi me mf l mg mh">function onDrag(d,i,n) {<br/> d3.select(this).attr(“cx”, event.x) <br/>}</span></pre><p id="c027" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">记住只有传统的<code class="du lp lq lr ls b">function</code>在<code class="du lp lq lr ls b">this</code>中传递上下文，而箭头函数引用它的相对父上下文。如果它是一个箭头函数，它应该是这样的。</p><pre class="lt lu lv lw fd lz ls ma mb aw mc bi"><span id="da93" class="md kn hi ls b fi me mf l mg mh">const onDrag = (d,i,n) =&gt; {<br/> d3.select(n[i]).attr(“cx”, event.x) <br/>}</span></pre><p id="3d92" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是最常用的鼠标事件列表。</p><ul class=""><li id="3bb9" class="mi mj hi ix b iy iz jc jd jg mk jk ml jo mm js mn mo mp mq bi translated"><code class="du lp lq lr ls b">click</code>:鼠标点击元素。</li><li id="dd5a" class="mi mj hi ix b iy mr jc ms jg mt jk mu jo mv js mn mo mp mq bi translated"><code class="du lp lq lr ls b">dblclick</code>:鼠标双击元素。</li><li id="f1d1" class="mi mj hi ix b iy mr jc ms jg mt jk mu jo mv js mn mo mp mq bi translated"><code class="du lp lq lr ls b">contextmenu</code>:鼠标右键点击元素。</li><li id="8c47" class="mi mj hi ix b iy mr jc ms jg mt jk mu jo mv js mn mo mp mq bi translated"><code class="du lp lq lr ls b">mouseenter</code>:鼠标进入元素。</li><li id="e19d" class="mi mj hi ix b iy mr jc ms jg mt jk mu jo mv js mn mo mp mq bi translated"><code class="du lp lq lr ls b">mouseleave</code>:鼠标离开元素。</li><li id="39e3" class="mi mj hi ix b iy mr jc ms jg mt jk mu jo mv js mn mo mp mq bi translated"><code class="du lp lq lr ls b">mousemove</code>:鼠标在元素上移动。</li><li id="076f" class="mi mj hi ix b iy mr jc ms jg mt jk mu jo mv js mn mo mp mq bi translated"><code class="du lp lq lr ls b">mouseout</code>:鼠标离开元素或它的任何子元素。</li><li id="77e5" class="mi mj hi ix b iy mr jc ms jg mt jk mu jo mv js mn mo mp mq bi translated"><code class="du lp lq lr ls b">mouseover</code>:鼠标进入该元素或其任何子元素。</li></ul><p id="f4da" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于<a class="ae iu" href="https://developer.mozilla.org/en-US/docs/Web/Events#Touch_events" rel="noopener ugc nofollow" target="_blank">触摸界面，阅读此处</a></p><p id="debb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">点击查看更多信息。</p><p id="31bc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">还有更多 D3js 提供的互动功能</p><ul class=""><li id="e6d4" class="mi mj hi ix b iy iz jc jd jg mk jk ml jo mm js mn mo mp mq bi translated"><code class="du lp lq lr ls b"><a class="ae iu" href="https://github.com/d3/d3/blob/master/API.md#dragging-d3-drag" rel="noopener ugc nofollow" target="_blank">d3.drag</a></code>:用鼠标拖动事件。</li><li id="37ef" class="mi mj hi ix b iy mr jc ms jg mt jk mu jo mv js mn mo mp mq bi translated"><code class="du lp lq lr ls b"><a class="ae iu" href="https://github.com/d3/d3/blob/master/API.md#zooming-d3-zoom" rel="noopener ugc nofollow" target="_blank">d3.zoom</a></code>:鼠标滚轮缩放事件。</li><li id="155c" class="mi mj hi ix b iy mr jc ms jg mt jk mu jo mv js mn mo mp mq bi translated"><code class="du lp lq lr ls b"><a class="ae iu" href="https://github.com/d3/d3/blob/master/API.md#brushes-d3-brush" rel="noopener ugc nofollow" target="_blank">d3.brush</a></code>:可用于选择区域或缩放。</li><li id="79d8" class="mi mj hi ix b iy mr jc ms jg mt jk mu jo mv js mn mo mp mq bi translated"><code class="du lp lq lr ls b"><a class="ae iu" href="https://github.com/d3/d3/blob/master/API.md#forces-d3-force" rel="noopener ugc nofollow" target="_blank">d3.force</a></code>:模拟重力动画</li></ul><p id="2d01" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">跟随我了解这些交互式可视化的发展。</p><h2 id="034a" class="md kn hi bd ko my mz na ks nb nc nd kw jg ne nf la jk ng nh le jo ni nj li nk bi translated">工具提示示例:</h2><p id="513e" class="pw-post-body-paragraph iv iw hi ix b iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo lo jq jr js hb bi translated"><a class="ae iu" href="https://codepen.io/krngd2/pen/YzqYNRe" rel="noopener ugc nofollow" target="_blank">https://codepen.io/krngd2/pen/YzqYNRe</a></p><h1 id="cf0f" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">数据操作</h1><p id="3337" class="pw-post-body-paragraph iv iw hi ix b iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo lo jq jr js hb bi translated">D3js 带有各种数据操作函数，在处理任何类型的数据时都非常方便。</p><p id="2399" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以印度新冠肺炎案例的数据为例。</p><pre class="lt lu lv lw fd lz ls ma mb aw mc bi"><span id="df33" class="md kn hi ls b fi me mf l mg mh"><strong class="ls hj">[{<br/></strong>“dailyconfirmed”: “78168”,<br/>”dailydeceased”: “892”,<br/>”dailyrecovered”: “62145”,<br/>”date”: “01 September “,<br/>”totalconfirmed”: “3766121”,<br/>”totaldeceased”: “66337”,<br/>”totalrecovered”: “2899515”<br/><strong class="ls hj">},<br/>.......<br/>......<br/>.....<br/>{<br/></strong>“dailyconfirmed”: “90600”,<br/>”dailydeceased”: “916”,<br/>”dailyrecovered”: “73161”,<br/>”date”: “05 September “,<br/>”totalconfirmed”: “4110852”,<br/>”totaldeceased”: “70095”,<br/>”totalrecovered”: “3177666”<br/><strong class="ls hj">}]</strong></span></pre><p id="4881" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是一个对象数组，如果我们想得到最大的<code class="du lp lq lr ls b">dailyconfirmed</code>例，你有<code class="du lp lq lr ls b">d3.max(data, accessor)</code>例</p><pre class="lt lu lv lw fd lz ls ma mb aw mc bi"><span id="fad9" class="md kn hi ls b fi me mf l mg mh">d3.max(data,(p)=&gt; p["dailyconfirmed"] ) // returns "90600"</span></pre><p id="1309" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">同样，我们也有</p><h2 id="441b" class="md kn hi bd ko my mz na ks nb nc nd kw jg ne nf la jk ng nh le jo ni nj li nk bi translated">最大</h2><p id="109a" class="pw-post-body-paragraph iv iw hi ix b iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo lo jq jr js hb bi translated"><code class="du lp lq lr ls b">d3.max(<em class="jt">iterable</em>[, <em class="jt">accessor</em>])</code>:返回最大值<br/> <code class="du lp lq lr ls b">d3.maxIndex(<em class="jt">iterable</em>[, <em class="jt">accessor</em>])</code>:返回最大值指标<br/> <code class="du lp lq lr ls b">d3.greatest(<em class="jt">iterable</em>[, <em class="jt">comparator</em>])</code>:返回最大指标对象</p><h2 id="7b94" class="md kn hi bd ko my mz na ks nb nc nd kw jg ne nf la jk ng nh le jo ni nj li nk bi translated">福建话</h2><p id="58c6" class="pw-post-body-paragraph iv iw hi ix b iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo lo jq jr js hb bi translated"><code class="du lp lq lr ls b">d3.min(<em class="jt">iterable</em>[, <em class="jt">accessor</em>])</code>:返回最小值<br/> <code class="du lp lq lr ls b">d3.minIndex(<em class="jt">iterable</em>[, <em class="jt">accessor</em>])</code>:返回最小值的索引<br/> <code class="du lp lq lr ls b">d3.least(<em class="jt">iterable</em>[, <em class="jt">comparator</em>])</code>:返回最小索引的对象</p><h2 id="bd00" class="md kn hi bd ko my mz na ks nb nc nd kw jg ne nf la jk ng nh le jo ni nj li nk bi translated">其他人</h2><p id="16c8" class="pw-post-body-paragraph iv iw hi ix b iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo lo jq jr js hb bi translated"><code class="du lp lq lr ls b">d3.sum(<em class="jt">iterable</em>[, <em class="jt">accessor</em>])</code>:返回 Sum <br/> <code class="du lp lq lr ls b">d3.extent(<em class="jt">iterable)</em></code> <em class="jt">:返回[min，max]组合成一个数组<br/> </em> <code class="du lp lq lr ls b">d3.mean(<em class="jt">iterable</em>[, <em class="jt">accessor</em>])</code> : <em class="jt">返回平均值</em> <br/> <code class="du lp lq lr ls b">d3.median(<em class="jt">iterable</em>[, <em class="jt">accessor</em>])</code> : <em class="jt">返回中间值</em></p><h2 id="9ad6" class="md kn hi bd ko my mz na ks nb nc nd kw jg ne nf la jk ng nh le jo ni nj li nk bi translated">转换</h2><p id="6645" class="pw-post-body-paragraph iv iw hi ix b iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo lo jq jr js hb bi translated">有趣的部分开始了。当您想要将数据修改为所需的格式时，转换方法非常方便。让我们了解一下最常用的转换方法。以上述数据为例。</p><pre class="lt lu lv lw fd lz ls ma mb aw mc bi"><span id="6763" class="md kn hi ls b fi me mf l mg mh">d3.group(data, d =&gt; d["date"]) </span></pre><p id="e32d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">输出</p><figure class="lt lu lv lw fd ij er es paragraph-image"><div class="er es nl"><img src="../Images/c8e5a6880c5a3b1920d85de2fce3272c.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*4QRbFCovk3fOVQioWh8BEw.png"/></div></figure><p id="97c0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将返回一个<a class="ae iu" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map" rel="noopener ugc nofollow" target="_blank"> <em class="jt">映射</em> </a> <em class="jt"> </em>带有日期和值的键的其余值。当您希望通过传递日期来访问值时，这很方便，并且对这种数据使用 Map instead Object 也可以提高性能。可以传递更多的回调函数来获取更多的嵌套数据。使用<em class="jt"> </em> <code class="du lp lq lr ls b"><em class="jt">Array.from(mapData)</em></code> <em class="jt">转换为数组。</em></p><p id="b96d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意键应该是唯一的，否则它们会被覆盖。如果您希望抛出错误，请使用功能类似的<em class="jt"> </em> <code class="du lp lq lr ls b"><em class="jt">d3.index(iterable, keyAccessory)</em></code> <em class="jt"> </em>。如果你想自定义输出值数组使用<code class="du lp lq lr ls b">d3.rollup(<em class="jt">iterable</em>, <em class="jt">reduce</em>, <em class="jt">…keys</em>) // Learn about <a class="ae iu" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" rel="noopener ugc nofollow" target="_blank">.reduce() here</a></code>你可以在这里查看更多关于<a class="ae iu" href="https://observablehq.com/@d3/d3-group#:~:text=rollup%20can%20be%20used%20to,according%20to%20the%20reduced%20value.&amp;text=You%20can%20similarly%20get%20the,group%20together%20with%20d3." rel="noopener ugc nofollow" target="_blank"><strong class="ix hj"><em class="jt"/></strong></a><strong class="ix hj"><em class="jt">。</em> </strong></p><p id="72af" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lp lq lr ls b">d3.range([<em class="jt">start</em>, ]<em class="jt">stop</em>[, <em class="jt">step</em>]) // generates array of values<br/>d3.merge([[1], [2, 3]]) //returns [1, 2, 3]<br/>d3.pairs([1, 2, 3, 4]); // returns [[1, 2], [2, 3], [3, 4]]<br/>d3.shuffle(<em class="jt">array</em>[, <em class="jt">start</em>[, <em class="jt">stop</em>]]) // shuffles the array</code></p><pre class="lt lu lv lw fd lz ls ma mb aw mc bi"><span id="30ea" class="md kn hi ls b fi me mf l mg mh">d3.ticks(<em class="jt">start</em>, <em class="jt">stop</em>, <em class="jt">count</em>)<br/>// returns array of equal interval rounded values<br/>// example<br/>d3.ticks(1, 10, 5)<br/>// returns <!-- -->[2, 4, 6, 8, 10]</span></pre><p id="91e5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里我只列出了根据我的经验最常用的方法。你可以在这里阅读所有这些<a class="ae iu" href="https://github.com/d3/d3-array/blob/master/README.md#statistics" rel="noopener ugc nofollow" target="_blank">统计</a>、<a class="ae iu" href="https://github.com/d3/d3-array/blob/master/README.md#search" rel="noopener ugc nofollow" target="_blank">搜索</a>、<a class="ae iu" href="https://github.com/d3/d3-array/blob/master/README.md#transformations" rel="noopener ugc nofollow" target="_blank">转换</a></p><h1 id="37a8" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">布局</h1><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nm"><img src="../Images/4498e8884b4cee94a46ba81bc2941b77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_nukhc_KOaIRYVZnm1Y9BQ.jpeg"/></div></div></figure><p id="8924" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">视觉化有很多种类型。D3 为我们提供了一些便利的内置可视化工具，如包装圆圈、树形图、网络图等。</p><p id="b762" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了开发它们，你需要理解一个重要的数据操作方法来产生层次数据。</p><p id="4c0f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">分层数据</strong></p><p id="5b8c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就像 Scales 获取数据并输出位置点一样，Hierarchical functions 获取分层数据并添加位置 x、y 和其他点，从而产生一定的布局。我们需要先准备一些层次数据。为此我们有<code class="du lp lq lr ls b">d3.stratify()</code>。假设我们有这样的数据</p><pre class="lt lu lv lw fd lz ls ma mb aw mc bi"><span id="6d6c" class="md kn hi ls b fi me mf l mg mh">const data = [<br/>  {"name": "Eve",   "parent": ""},<br/>  {"name": "Cain",  "parent": "Eve"},<br/>  {"name": "Seth",  "parent": "Eve"},<br/>  {"name": "Enos",  "parent": "Seth"},<br/>  {"name": "Noam",  "parent": "Seth"},<br/>  {"name": "Abel",  "parent": "Eve"},<br/>  {"name": "Awan",  "parent": "Eve"},<br/>  {"name": "Enoch", "parent": "Awan"},<br/>  {"name": "Azura", "parent": "Eve"}<br/>]</span></pre><p id="65ef" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了转换成分层数据，我们需要将这些数据传递给<code class="du lp lq lr ls b">d3.stratify()</code></p><pre class="lt lu lv lw fd lz ls ma mb aw mc bi"><span id="aac2" class="md kn hi ls b fi me mf l mg mh">const hierarchicalDataGenrator = d3.stratify()<br/>                                   .id(d =&gt; d.name)<br/>                                   .parentId(d =&gt; d.parent)<br/>hierarchicalDataGenrator(data)</span></pre><figure class="lt lu lv lw fd ij er es paragraph-image"><div class="er es nn"><img src="../Images/13bccd4c316cb813cdeef45d73764f77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*i32iE7p5_CfdDc9MO0hkEw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd ko">输出</strong></figcaption></figure><p id="c4d1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面是输出，我们得到分层的数据对象，我们可以得到<code class="du lp lq lr ls b">hierarchicalDataGenrator.ancestors()</code>、<code class="du lp lq lr ls b">hierarchicalDataGenrator.descendants()</code>、<code class="du lp lq lr ls b">hierarchicalDataGenrator.leaves()</code>。通常你不需要直接使用它们。让我们现在建立一些可视化。</p><h2 id="1158" class="md kn hi bd ko my mz na ks nb nc nd kw jg ne nf la jk ng nh le jo ni nj li nk bi translated">包装的圆圈</h2><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f120ee9a3ee89597747ff49fa39480e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0uZns4fCxsIeoCBRCryjIA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">世界各地新冠肺炎活跃的案例，泡沫比较<a class="ae iu" href="https://covidwithd3js.kiran.dev/worldbubble/" rel="noopener ugc nofollow" target="_blank">https://covidwithd3js.kiran.dev/worldbubble/</a></figcaption></figure><p id="e7e5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们取一个简单的和上面一样的数据，但是增加一个额外的点值。值是其父项下圆的百分比。让我们保留一切。像这样的<code class="du lp lq lr ls b">{“name”: “Eve”, “parent”: “”, value: 1}</code>。</p><ol class=""><li id="858f" class="mi mj hi ix b iy iz jc jd jg mk jk ml jo mm js no mo mp mq bi translated"><strong class="ix hj">使数据分层</strong></li></ol><pre class="lt lu lv lw fd lz ls ma mb aw mc bi"><span id="5bda" class="md kn hi ls b fi me mf l mg mh">const hDataGenerator = d3.stratify()<br/>                          .id(d=&gt;d.name)<br/>                          .parentId(d =&gt; d.parent)<br/>const hData = hDataGenerator(data)</span></pre><p id="28ec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> 2。对数值求和</strong></p><pre class="lt lu lv lw fd lz ls ma mb aw mc bi"><span id="0b29" class="md kn hi ls b fi me mf l mg mh">hData.sum(d =&gt; d.value)<br/>console.log(<!-- -->hData)</span></pre><figure class="lt lu lv lw fd ij er es paragraph-image"><div class="er es np"><img src="../Images/5e2a18de942bb5491ba37e48927e1734.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*lLu8OFYnEUrCTYoHTNP82Q.png"/></div></figure><p id="2e56" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以看到额外的<code class="du lp lq lr ls b">value</code>键。这是它的所有子值的总和。</p><p id="97f0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> 3。准备包装布局</strong></p><pre class="lt lu lv lw fd lz ls ma mb aw mc bi"><span id="db88" class="md kn hi ls b fi me mf l mg mh">const packLayout = d3.pack()<br/>                     .size([400, 400]);<br/>packLayout(hData)</span></pre><p id="d6d2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> 4。用它来创建布局</strong></p><pre class="lt lu lv lw fd lz ls ma mb aw mc bi"><span id="1959" class="md kn hi ls b fi me mf l mg mh">const nodes = d3.select('svg')<br/>                .append('g')<br/>                .selectAll('circle')<br/>                .data(hData.descendants())<br/>                .enter()<br/>                .append("g")</span><span id="5794" class="md kn hi ls b fi nq mf l mg mh">nodes.append('circle')<br/>      .attr('cx', (d) =&gt; d.x)<br/>      .attr('cy', (d) =&gt; d.y)<br/>      .attr('r', (d) =&gt; d.r)<br/>      .style("stroke", "black")<br/>      .style("fill", "none")</span><span id="0cae" class="md kn hi ls b fi nq mf l mg mh">nodes.append('text')<br/>     .attr('y', (d) =&gt; d.y - d.r + 16)<br/>     .attr('x', (d) =&gt; d.x)<br/>     .text(d =&gt; d.data.name)</span></pre><p id="f1b4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">输出</strong></p><figure class="lt lu lv lw fd ij er es paragraph-image"><div class="er es nr"><img src="../Images/f6f2b1c69ca57ab461bc986efc5e8803.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*2oJJUasRcyqREWIxGHXbsA.png"/></div></figure><h2 id="7963" class="md kn hi bd ko my mz na ks nb nc nd kw jg ne nf la jk ng nh le jo ni nj li nk bi translated">树形图</h2><p id="c4c7" class="pw-post-body-paragraph iv iw hi ix b iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo lo jq jr js hb bi translated">几乎所有东西都和上面一样，但是我们用<code class="du lp lq lr ls b">d3.tree()</code>代替<code class="du lp lq lr ls b">d3.pack()</code></p><p id="cc55" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">准备布局</strong></p><pre class="lt lu lv lw fd lz ls ma mb aw mc bi"><span id="373a" class="md kn hi ls b fi me mf l mg mh">const treeLayout = d3.tree().size([400, 400]);<br/>treeLayout(hData)</span></pre><p id="e5c7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">创造</strong></p><pre class="lt lu lv lw fd lz ls ma mb aw mc bi"><span id="750e" class="md kn hi ls b fi me mf l mg mh">const svg =  d3.select('svg')</span><span id="288e" class="md kn hi ls b fi nq mf l mg mh">//circles<br/>svg.append('g')<br/>    .selectAll('circle.node')<br/>    .data(hData.descendants())<br/>    .enter()<br/>    .append('circle')<br/>    .classed('node', true)<br/>    .attr('cx', (d) =&gt; d.x)<br/>    .attr('cy', (d) =&gt; d.y)<br/>    .attr('r', 4);</span><span id="f141" class="md kn hi ls b fi nq mf l mg mh">// Links<br/>svg.append("g")<br/>   .selectAll('line.link')<br/>   .data(hData.links())<br/>   .enter()<br/>   .append('line')<br/>   .attr('x1', (d) =&gt; d.source.x)<br/>   .attr('y1', (d) =&gt; d.source.y)<br/>   .attr('x2', (d) =&gt; d.target.x)<br/>   .attr('y2', (d) =&gt; d.target.y)<br/>   .style('stroke', 'black')</span></pre><p id="099e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">输出</strong></p><figure class="lt lu lv lw fd ij er es paragraph-image"><div class="er es ns"><img src="../Images/830ef8b816ab5044fa8e8cbba351274b.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*92rnxZP8Q-IZA0d10qNzIQ.png"/></div></figure><p id="00a7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">点击了解更多关于层级<a class="ae iu" href="https://github.com/d3/d3-hierarchy/tree/v2.0.0" rel="noopener ugc nofollow" target="_blank">的信息</a></p><p id="d2e8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我希望到现在为止你已经对如何玩 D3js 有了很好的了解。我知道我们在这些系列中没有建立任何令人兴奋的图表。在我的下一篇文章中，我们将建立赛车条形图。所以跟着我看更多令人兴奋的东西。</p></div></div>    
</body>
</html>