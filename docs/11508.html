<html>
<head>
<title>How create Image Recomendation system</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建形象推荐系统</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-create-image-recomendation-system-3dcc5edf1597?source=collection_archive---------17-----------------------#2020-12-06">https://medium.com/analytics-vidhya/how-create-image-recomendation-system-3dcc5edf1597?source=collection_archive---------17-----------------------#2020-12-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/cdc3748b69beb49affe4fb5248df14f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dCEBhlDpuHkwEErkprmG_g.jpeg"/></div></div></figure><p id="6986" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一个<strong class="is hj">推荐系统</strong>，或一个<strong class="is hj">推荐系统</strong>(有时用一个同义词如平台或引擎代替‘系统’)，是<a class="ae jo" href="https://en.wikipedia.org/wiki/Information_filtering_system" rel="noopener ugc nofollow" target="_blank">信息过滤系统</a>的一个子类，它试图预测用户对一个项目的“评分”或“偏好”。<a class="ae jo" href="https://en.wikipedia.org/wiki/Recommender_system#cite_note-handbook-1" rel="noopener ugc nofollow" target="_blank">【1】</a><a class="ae jo" href="https://en.wikipedia.org/wiki/Recommender_system#cite_note-2" rel="noopener ugc nofollow" target="_blank">【2】</a>它们主要用于商业应用。</p><p id="08ee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">推荐系统被用于各种领域，并且最普遍地被认为是用于视频和音乐服务的播放列表生成器、用于在线商店的产品推荐器、或者用于社交媒体平台的内容推荐器和开放网络内容推荐器。<a class="ae jo" href="https://en.wikipedia.org/wiki/Recommender_system#cite_note-twitterwtf2-3" rel="noopener ugc nofollow" target="_blank">【3】</a><a class="ae jo" href="https://en.wikipedia.org/wiki/Recommender_system#cite_note-4" rel="noopener ugc nofollow" target="_blank">【4】</a>这些系统可以使用单一输入(如音乐)或跨平台的多重输入(如新闻、书籍和搜索查询)来运行。也有针对特定主题的流行推荐系统，如餐馆和网上约会。推荐系统也被开发来探索研究文章和专家、<a class="ae jo" href="https://en.wikipedia.org/wiki/Recommender_system#cite_note-expertseer-5" rel="noopener ugc nofollow" target="_blank">【5】</a>合作者、<a class="ae jo" href="https://en.wikipedia.org/wiki/Recommender_system#cite_note-collabseer-6" rel="noopener ugc nofollow" target="_blank">【6】</a>和金融服务。</p><p id="4259" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">(<a class="ae jo" href="https://en.wikipedia.org/wiki/Recommender_system" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Recommender_system</a>)</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es jp"><img src="../Images/52ef503ec718dbfc431cd4447795a941.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*E8c4PEwsogQQWJPErGda2A.gif"/></div></figure><h1 id="da8d" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">协同过滤</h1><p id="ab9d" class="pw-post-body-paragraph iq ir hi is b it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj kw jl jm jn hb bi translated">协同过滤方法的一个关键优点是它不依赖于机器可分析的内容，因此它能够准确地推荐诸如电影之类的复杂项目，而不需要“理解”项目本身。在推荐系统中，许多算法已经被用于测量用户相似性或项目相似性。例如，艾伦首先实现的<a class="ae jo" href="https://en.wikipedia.org/wiki/K-nearest_neighbors_algorithm" rel="noopener ugc nofollow" target="_blank">k-最近邻</a> (k-NN)方法<a class="ae jo" href="https://en.wikipedia.org/wiki/Recommender_system#cite_note-38" rel="noopener ugc nofollow" target="_blank">【38】</a>和<a class="ae jo" href="https://en.wikipedia.org/wiki/Pearson_correlation" rel="noopener ugc nofollow" target="_blank">皮尔逊相关</a>。<a class="ae jo" href="https://en.wikipedia.org/wiki/Recommender_system#cite_note-39" rel="noopener ugc nofollow" target="_blank">【39】</a></p><p id="d2ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当根据用户行为建立模型时，通常会区分<a class="ae jo" href="https://en.wikipedia.org/wiki/Data_collection" rel="noopener ugc nofollow" target="_blank">数据收集</a>的显性和<a class="ae jo" href="https://en.wikipedia.org/wiki/Implicit_data_collection" rel="noopener ugc nofollow" target="_blank">隐性</a>形式。</p><p id="39cd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">显式数据收集的示例包括:</p><ul class=""><li id="0b02" class="kx ky hi is b it iu ix iy jb kz jf la jj lb jn lc ld le lf bi translated">要求用户对一个项目进行分级。</li><li id="0348" class="kx ky hi is b it lg ix lh jb li jf lj jj lk jn lc ld le lf bi translated">要求用户搜索。</li><li id="aaf4" class="kx ky hi is b it lg ix lh jb li jf lj jj lk jn lc ld le lf bi translated">要求用户从最喜欢到最不喜欢排列项目集合。</li><li id="89fb" class="kx ky hi is b it lg ix lh jb li jf lj jj lk jn lc ld le lf bi translated">向用户呈现两个项目，并要求他/她选择其中较好的一个。</li><li id="e566" class="kx ky hi is b it lg ix lh jb li jf lj jj lk jn lc ld le lf bi translated">要求用户创建他/她喜欢的项目列表(参见<a class="ae jo" href="https://en.wikipedia.org/wiki/Rocchio_algorithm" rel="noopener ugc nofollow" target="_blank"> <em class="ll">罗基奥分类</em> </a>或其他类似技术)。</li></ul><h1 id="1d73" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">余弦相似性</h1><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es lm"><img src="../Images/05d9a48813b9b1072015c35e13d94424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*_Bf9goaALQrS_0XkBozEiQ.png"/></div></figure><p id="5837" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用 Keras 和 CNN vgg16，我们将开发一个推荐类似产品的算法；</p><pre class="jq jr js jt fd ln lo lp lq aw lr bi"><span id="6dd9" class="ls jv hi lo b fi lt lu l lv lw"><em class="ll"># imports</em><br/><br/>from keras.applications import vgg16<br/>from keras.preprocessing.image import load_img,img_to_array<br/>from keras.models import Model<br/>from keras.applications.imagenet_utils import preprocess_input<br/><br/>from PIL import Image<br/>import os<br/>import matplotlib.pyplot as plt<br/>import numpy as np<br/>from sklearn.metrics.pairwise import cosine_similarity<br/>import pandas as pd</span><span id="e796" class="ls jv hi lo b fi lx lu l lv lw"><em class="ll"># parameters setup</em><br/><br/>imgs_path = "../input/style/"<br/>imgs_model_width, imgs_model_height = 224, 224<br/><br/>nb_closest_images = 5 <em class="ll"># number of most similar images to retrieve</em></span></pre><h1 id="e9c6" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">1.从 Keras 加载 VGG 预训练模型</h1><p id="389c" class="pw-post-body-paragraph iq ir hi is b it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj kw jl jm jn hb bi translated">Keras 模块包含几个预训练的模型，可以很容易地加载。</p><p id="2b8d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于我们基于视觉相似性的推荐系统，我们需要加载一个卷积神经网络(CNN)来解释图像内容。</p><p id="20e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个例子中，我们将加载在 imagenet 上训练的 VGG16 模型，imagenet 是一个大的带标签的图像数据库。</p><p id="ccc9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们采用整个模型，我们将得到一个包含属于某些类的概率的输出，但这不是我们想要的。</p><p id="52ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们希望检索模型能够从图像中获得的所有信息。</p><p id="5908" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了做到这一点，我们必须删除 CNN 的最后几层，它们只用于类别预测。</p><pre class="jq jr js jt fd ln lo lp lq aw lr bi"><span id="98c3" class="ls jv hi lo b fi lt lu l lv lw">files = [imgs_path + x for x in os.listdir(imgs_path) if “jpg” in x]</span><span id="9bf6" class="ls jv hi lo b fi lx lu l lv lw">print(“number of images:”,len(files))</span></pre><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es ly"><img src="../Images/16926112e84226f2839a0527a4dd0835.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*53q-U_dhMZwNoj5CP0VsTA.png"/></div><figcaption class="lz ma et er es mb mc bd b be z dx translated">项目中使用的路径文件示例</figcaption></figure><pre class="jq jr js jt fd ln lo lp lq aw lr bi"><span id="e015" class="ls jv hi lo b fi lt lu l lv lw"><em class="ll"># load the model</em><br/>vgg_model = vgg16.VGG16(weights='imagenet')<br/><br/><em class="ll"># remove the last layers in order to get features instead of predictions</em><br/>feat_extractor = Model(inputs=vgg_model.input, outputs=vgg_model.get_layer("fc2").output)<br/><br/><em class="ll"># print the layers of the CNN</em><br/>feat_extractor.summary()</span><span id="a305" class="ls jv hi lo b fi lx lu l lv lw"># compute cosine similarities between images</span><span id="7791" class="ls jv hi lo b fi lx lu l lv lw">cosSimilarities = cosine_similarity(imgs_features)</span><span id="d641" class="ls jv hi lo b fi lx lu l lv lw"># store the results into a pandas dataframe</span><span id="d621" class="ls jv hi lo b fi lx lu l lv lw">cos_similarities_df = pd.DataFrame(cosSimilarities, columns=files, index=files)<br/>cos_similarities_df.head()</span><span id="53a3" class="ls jv hi lo b fi lx lu l lv lw">def retrieve_most_similar_products(given_img):</span><span id="c02d" class="ls jv hi lo b fi lx lu l lv lw">print("--------------------------------------------------------")<br/>    print("original product:")</span><span id="1b08" class="ls jv hi lo b fi lx lu l lv lw">original = load_img(given_img, target_size=(imgs_model_width, imgs_model_height))<br/>    plt.imshow(original)<br/>    plt.show()</span><span id="37c5" class="ls jv hi lo b fi lx lu l lv lw">print("-------------------------------------------------------")<br/>    print("most similar products:")</span><span id="e536" class="ls jv hi lo b fi lx lu l lv lw">closest_imgs = cos_similarities_df[given_img].sort_values(ascending=False)[1:nb_closest_images+1].index<br/>    closest_imgs_scores = cos_similarities_df[given_img].sort_values(ascending=False)[1:nb_closest_images+1]</span><span id="5415" class="ls jv hi lo b fi lx lu l lv lw">for i in range(0,len(closest_imgs)):<br/>        original = load_img(closest_imgs[i], target_size=(imgs_model_width, imgs_model_height))<br/>        plt.imshow(original)<br/>        plt.show()<br/>        print("similarity score : ",closest_imgs_scores[i])</span></pre><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/44089849c564a9e9292c9e7b6d10506c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q962VmSpuXz5MIFAOsIDQQ.png"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx translated">结果</figcaption></figure><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/68e1e75e320cfc9dccc9ef9469b08756.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gKtG65yu8kRmP6PXfgKT7g.png"/></div></div></figure><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="mf mg l"/></div></figure></div></div>    
</body>
</html>