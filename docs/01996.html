<html>
<head>
<title>Geographic Imaging Systems (GIS) for Python — A Brief Introduction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向Python的地理成像系统(GIS)——简介</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/geographic-imaging-systems-gis-for-python-a-brief-introduction-f10b6f8fccee?source=collection_archive---------14-----------------------#2019-11-25">https://medium.com/analytics-vidhya/geographic-imaging-systems-gis-for-python-a-brief-introduction-f10b6f8fccee?source=collection_archive---------14-----------------------#2019-11-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="a895" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">可视化纽约市的医院设施分布</h2></div></div><div class="ab cl ix iy gp iz" role="separator"><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc"/></div><div class="hb hc hd he hf"><p id="e06a" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated"><strong class="jg hj">地图投影/坐标参考系统:</strong> <br/>地图投影是一种在二维表面上显示三维数据的方式——最常用于在计算机屏幕或纸上显示地图数据，而不是投影到地球仪上。地球表面位置的纬度和经度必须转换成平面上的位置。这不可避免地会带来一定程度的扭曲。就我们的目的而言，地图投影和坐标参考系统(crs)本质上是一回事。</p><p id="79cd" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">如果想要正确地绘制数据，投影的选择可能很重要，因为数据的显示方式会改变对数据的理解方式。在全局数据的情况下，<a class="ae ka" href="https://imgs.xkcd.com/comics/map_projections.png" rel="noopener ugc nofollow" target="_blank">这张XKCD漫画</a>展示了根据您选择的投影，您的结果可能看起来<strong class="jg hj">完全</strong>不同的方式。</p><p id="ea27" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">本教程更加本地化，将集中在纽约市，我们实际上有一个坐标系的选择。这里，我们将使用WGS 84/EPSG: 4326地图，表示WGS 84参考椭球面上的纬度和经度坐标。参考椭球是一个数学定义的表面，它近似于地球的真实形状(或多或少是一个扁平的球体)。全球定位系统(GPS)和OpenStreetMap也使用WGS 84参考椭球。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kb"><img src="../Images/9c29e802667a0d44bfc7ef8bd50cf3cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4Zq6Q1Sc8AMy4c34.jpg"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated"><a class="ae ka" href="https://nycitymap.wordpress.com/2016/09/" rel="noopener ugc nofollow" target="_blank"> NYCityMap &amp;超越</a></figcaption></figure><h2 id="f5cc" class="kr ks hi bd kt ku kv kw kx ky kz la lb jn lc ld le jr lf lg lh jv li lj lk ll bi translated">GIS数据类型</h2><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es lm"><img src="../Images/357044253a1fe8cf6a024f2f3ef614de.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*QrB_jE81Mh9IrtzjfB5FYA.png"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated"><a class="ae ka" href="https://gisgeography.com/spatial-data-types-vector-raster/" rel="noopener ugc nofollow" target="_blank">矢量数据示例</a></figcaption></figure><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es ln"><img src="../Images/2c98a8c8f948429ff88d437066f55f2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*rxyQS7Z-Aa1Em-sW.png"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated"><a class="ae ka" href="https://gisgeography.com/spatial-data-types-vector-raster/" rel="noopener ugc nofollow" target="_blank">栅格数据示例</a></figcaption></figure><p id="b324" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated"><strong class="jg hj">矢量:</strong>由顶点和路径组成<br/> *点:x，y坐标(想想GPS坐标)<br/> *线:点之间的线(道路、河流、管道)<br/> *多边形:用于显示与区域的边界/单元(邮政编码、市议会区)</p><p id="5bf7" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated"><strong class="jg hj">栅格:</strong>由像素/网格单元构成<br/> *离散:分类数据(陆地与海洋、城市与农村)<br/> *连续:连续数据(海拔、温度、溢油周围的石油浓度)</p><p id="ae26" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">有关GIS数据类型之间差异的更多信息，请参见<a class="ae ka" href="https://gisgeography.com/spatial-data-types-vector-raster/" rel="noopener ugc nofollow" target="_blank">此链接</a>。</p></div><div class="ab cl ix iy gp iz" role="separator"><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc"/></div><div class="hb hc hd he hf"><h2 id="ddca" class="kr ks hi bd kt ku kv kw kx ky kz la lb jn lc ld le jr lf lg lh jv li lj lk ll bi translated">使用GeoPandas:</h2><p id="abb1" class="pw-post-body-paragraph je jf hi jg b jh lo ij jj jk lp im jm jn lq jp jq jr lr jt ju jv ls jx jy jz hb bi translated">本教程将重点介绍矢量数据类型，特别是多边形和点。</p><pre class="kc kd ke kf fd lt lu lv lw aw lx bi"><span id="3357" class="kr ks hi lu b fi ly lz l ma mb"># Import necessary libraries<br/>import numpy as np<br/>import pandas as pd<br/>import geopandas as gpd<br/>import scipy<br/>import shapely<br/>import matplotlib.pyplot as plt</span></pre><p id="3808" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">对于GeoPandas中的GIS绘图，我们的数据必须有一个“geometry”列，其中包含所讨论的GIS数据类型的值-点、线、面等等。为了展示这个例子，我们使用纽约市邮政编码，这是纽约市开放数据公司提供的。</p></div><div class="ab cl ix iy gp iz" role="separator"><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc"/></div><div class="hb hc hd he hf"><p id="cd35" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated"><strong class="jg hj">盲目地使用你的形状文件:</strong></p><pre class="kc kd ke kf fd lt lu lv lw aw lx bi"><span id="aff9" class="kr ks hi lu b fi ly lz l ma mb"># Read in shapefile of NYC zipcodes<br/>gdf = gpd.read_file('./zipcodes/ZIP_CODE_040114.shp')</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mc"><img src="../Images/484ba894a50e48fadd497ac903a88af3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5nofWtTxXlfOJlc5o-2-eA.png"/></div></div></figure><p id="fd14" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">注意:要做到这一点，所有其他相关文件(如下所示)必须与。shp文件-</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es md"><img src="../Images/c2ca69cc85e83cd890c19169083c1682.png" data-original-src="https://miro.medium.com/v2/resize:fit:482/format:webp/1*rqhHcfq_0dx7NdXQjQMkaQ.png"/></div></figure><p id="32b9" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">看看第一个邮政编码多边形:</p><pre class="kc kd ke kf fd lt lu lv lw aw lx bi"><span id="7bfe" class="kr ks hi lu b fi ly lz l ma mb">gdf['geometry'][0]</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es me"><img src="../Images/da0ad12984d223334d27bc8a349cfd07.png" data-original-src="https://miro.medium.com/v2/resize:fit:564/format:webp/1*DFfSHw4OqkN_gSlclh630w.png"/></div></figure><p id="256f" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">还要注意几何列中为此多边形的边界给出的值:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es mf"><img src="../Images/0baeb43cd68a585899bce864b0eaae9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*WejL40q3GMRHW8lxDSqrkw.png"/></div></figure><p id="12a5" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">这些值不像纬度和经度那样是容易理解的地理坐标参考。相反，它们是上面提到的参考椭球上的坐标——对于我们的目的来说，它们完全没有意义，因为我们没有它们的上下文。看看用这些坐标生成的地图:</p><pre class="kc kd ke kf fd lt lu lv lw aw lx bi"><span id="78e4" class="kr ks hi lu b fi ly lz l ma mb">fig, ax = plt.subplots(figsize = (6, 6))<br/>gdf.plot(ax = ax);<br/>ax.set_title('NYC Zipcodes', fontsize = 20);</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es mg"><img src="../Images/eedbe88b9cb6d5308d89f807c358b49f.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*QGXe326DuTEp-2dltaz4zQ.png"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">参考椭球面上的纽约市邮政编码</figcaption></figure><p id="2b07" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">地理形状是可以辨认的，但是坐标是天书。我们如何解决这个问题？一种方法可能是将这个邮政编码数据集与一个仍然使用邮政编码的数据集配对，但也包含纬度和经度坐标以供参考。在这种情况下，我们将使用<a class="ae ka" href="https://data.cityofnewyork.us/Health/NYC-Health-Hospitals-patient-care-locations-2011/f7b6-v6v3" rel="noopener ugc nofollow" target="_blank">医院设施数据集</a>，同样来自纽约市开放数据。</p><pre class="kc kd ke kf fd lt lu lv lw aw lx bi"><span id="1d4f" class="kr ks hi lu b fi ly lz l ma mb">hospdf = pd.read_csv('./NYC_Health___Hospitals_Facilities_-_2011.csv')<br/>hospdf.head()</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mh"><img src="../Images/ad5fa435097bb5e38009dab1e62a1d2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ggJQVw1Xt9tCW8MjcdZ4JA.png"/></div></div></figure><p id="da86" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">下一步是将此Pandas数据框架转换为GeoPandas数据框架，它实际上是一个带有几何列的Pandas数据框架，但具有对某些GIS功能的额外访问权限:</p><pre class="kc kd ke kf fd lt lu lv lw aw lx bi"><span id="f531" class="kr ks hi lu b fi ly lz l ma mb">hosp_gdf = gpd.GeoDataFrame(hospdf, geometry=gpd.points_from_xy(hospdf.Longitude, hospdf.Latitude))</span></pre><p id="23b6" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">现在，看看当我们绘制网格医院位置时会发生什么:</p><pre class="kc kd ke kf fd lt lu lv lw aw lx bi"><span id="3b24" class="kr ks hi lu b fi ly lz l ma mb">hosp_gdf.plot(figsize = (9,9));<br/>plt.title('Hospital Facilities in NYC', fontsize = 20);<br/>plt.xlabel('Longitude', fontsize = 16);<br/>plt.ylabel('Latitude', fontsize = 16);</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es mi"><img src="../Images/d2b831f1b72fc8c24c8869a3ee7b4f63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*KW_dG222QLB5ucOJ35Ie_g.png"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">纽约市医院位置</figcaption></figure><p id="7c65" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">我们有医院的位置，但没有地理参考！！接下来，我们尝试在同一块土地上绘制我们的邮政编码和医院。那应该是有帮助的，对吗？</p><pre class="kc kd ke kf fd lt lu lv lw aw lx bi"><span id="a8d4" class="kr ks hi lu b fi ly lz l ma mb">fig, ax = plt.subplots(figsize = (9,9))<br/>gdf.plot(ax = ax);<br/>hosp_gdf.plot(ax = ax, color = 'r');<br/>ax.set_title('Hospital Facilities in NYC', fontsize = 20);</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es mj"><img src="../Images/483e04901699afd727c2ee21c529b5d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*A8nMwcIcoTc1BUR3RxeUqQ.png"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">纽约市邮政编码和医院(无益)</figcaption></figure><p id="a855" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">事实证明，没有那么多。多边形边界需要位于正确的参考系中-仅有适当的网格化点是不够的。</p></div><div class="ab cl ix iy gp iz" role="separator"><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc"/></div><div class="hb hc hd he hf"><h2 id="832b" class="kr ks hi bd kt ku kv kw kx ky kz la lb jn lc ld le jr lf lg lh jv li lj lk ll bi translated"><strong class="ak">现在我们已经学得更好了:</strong></h2><p id="559c" class="pw-post-body-paragraph je jf hi jg b jh lo ij jj jk lp im jm jn lq jp jq jr lr jt ju jv ls jx jy jz hb bi translated">让我们再试一次——这一次，通过读取转换到本文开头提到的EPSG 4326坐标参考系统的纽约市邮政编码数据。</p><pre class="kc kd ke kf fd lt lu lv lw aw lx bi"><span id="f2f0" class="kr ks hi lu b fi ly lz l ma mb">gdf = gpd.read_file('./zipcodes/ZIP_CODE_040114.shp').to_crs(epsg=4326)</span></pre><p id="f9e9" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">这个数据帧看起来像什么？</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mk"><img src="../Images/1ba9ce3b94960f5c92c761d522ecc993.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PY5LQ0zg4LfVoufEE7SDPQ.png"/></div></div></figure><p id="372e" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">注意，这里的多边形边界值是更容易识别的经纬度坐标。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es ml"><img src="../Images/30f4ae904bdbf2a57c4ec647b810a07d.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*y8h80wo78IJ4yUFzbYODTw.png"/></div></figure><p id="7017" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">当我们现在绘制这些数据时会发生什么？</p><pre class="kc kd ke kf fd lt lu lv lw aw lx bi"><span id="7d00" class="kr ks hi lu b fi ly lz l ma mb">fig, ax = plt.subplots(figsize = (9, 9))<br/>gdf.plot(ax = ax);<br/>ax.set_title('NYC Zipcodes', fontsize = 20);</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es mm"><img src="../Images/728122acfb41c8fa3d341a8ee888cc8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*HVvmU11eZjatWcmuA5Tabw.png"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">EPSG 4326坐标系中的纽约市邮政编码</figcaption></figure><p id="86df" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">接下来，让我们再次尝试将邮政编码和医院放在一起:</p><pre class="kc kd ke kf fd lt lu lv lw aw lx bi"><span id="7af2" class="kr ks hi lu b fi ly lz l ma mb">fig, ax = plt.subplots(figsize = (9,9))<br/>gdf.plot(ax = ax);<br/>hosp_gdf.plot(ax = ax, color = 'r');<br/>ax.set_title('Hospital Facilities in NYC', fontsize = 20)<br/>ax.set_xlabel('Longitude', fontsize = 16);<br/>ax.set_ylabel('Latitude', fontsize = 16);</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es mn"><img src="../Images/3926cff4bce3718956800685c95b8d23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*Fco8G0CWjfCFdOcaWdJL0w.png"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">纽约医院和邮政编码(好多了！)</figcaption></figure></div><div class="ab cl ix iy gp iz" role="separator"><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc"/></div><div class="hb hc hd he hf"><p id="2979" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated"><strong class="jg hj">下一步:</strong> <br/> 1。清理两个数据帧(去掉nan，将zipcodes转换成<code class="du mo mp mq lu b">int</code>数据类型，等等)<br/> 2。在医院数据框上按邮政编码分组，以获得每个邮政编码的医院数量<br/> 3。将其与共享邮政编码/邮政编码列<br/> 4上的邮政编码数据帧合并。将其转换为GeoPandas数据帧</p><pre class="kc kd ke kf fd lt lu lv lw aw lx bi"><span id="f9ca" class="kr ks hi lu b fi ly lz l ma mb"># Merge hospital data with zipcode polygons for easy plotting<br/>gdf_merge = hosp_agg.merge(gdf, left_on = 'Postcode', right_on = 'ZIPCODE')</span><span id="5af6" class="kr ks hi lu b fi mr lz l ma mb"># Create Gepandas DataFrame from merged data<br/>gdf_geo = gpd.GeoDataFrame(gdf_merge, geometry = gdf_merge.geometry, crs = {'init':'epsg:4326', no_defs':True})</span></pre><p id="633d" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">绘制时这个看起来像什么？</p><pre class="kc kd ke kf fd lt lu lv lw aw lx bi"><span id="ede0" class="kr ks hi lu b fi ly lz l ma mb"># Plot # of hospitals per zip<br/>fig, ax = plt.subplots(figsize = (13, 13))<br/>gdf.plot(ax=ax, color='white', edgecolor='black')<br/>gdf_geo.plot('Facility Type', legend=True, ax=ax,  # All df columns are identical<br/>            cmap='viridis_r', legend_kwds={'fraction':.035}, # Scale legend height to plot<br/>             vmin = 0)<br/>ax.set_title('Hospitals per Zipcode', fontsize = 20)<br/>ax.set_xlabel('Longitude', fontsize = 16)<br/>ax.set_ylabel('Latitude', fontsize = 16)<br/>plt.show()</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ms"><img src="../Images/4812277200e65a490818eedc57294996.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sp3eE26cliPklpF3R43d6A.png"/></div></div></figure><p id="8a13" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">我们可以绘制不同邮政编码的医院分布图，而不是绘制单独的数据点。</p><p id="87a6" class="pw-post-body-paragraph je jf hi jg b jh ji ij jj jk jl im jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated"><strong class="jg hj">TL；<br/>博士:</strong> 1。确保多边形数据参考了可用的坐标系。<br/> 2。参见第1点。<br/> 3。你确定你已经完成了#1吗？如果是，继续#4。<br/> 4。与您希望映射的数据合并。<br/> 5。制作有助于讲述故事的功能地图。</p></div></div>    
</body>
</html>