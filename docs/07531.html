<html>
<head>
<title>Crop Image with Croppie</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有作物的作物图像</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/crop-image-with-croppie-26146a4b933?source=collection_archive---------1-----------------------#2020-06-29">https://medium.com/analytics-vidhya/crop-image-with-croppie-26146a4b933?source=collection_archive---------1-----------------------#2020-06-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2f75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我一直在为一个必须使用图像裁剪器的项目构建一个功能。要求就像，用户必须上传一个固定的纵横比(对我来说是600 * 170)的图像。于是，我在谷歌和youtube上搜索，找出教程。但是我发现的还不够有说服力。我选择使用JQuery Croppie来满足需求，但是文档不够好，无法正确理解。我不得不挣扎一下。但对你来说是个好消息，你不用像我一样挣扎。因为我要写一个描述性的教程，这样你就可以在任何地方方便地使用图像裁剪功能。那么，让我们开始吧。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="c0d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将使用django作为后端，但你可以使用任何框架来处理后端，因为我将主要关注如何将该功能集成到前端，并将其传递给后端。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="f301" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">设置HTML </strong></p><p id="df44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">。注意:我用的是bootstrap 4，Jquery CDN，Croppie CDN。</p><ol class=""><li id="f513" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc jp jq jr js bi translated"><strong class="ih hj">设定头像:</strong></li></ol><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="ca6b" class="kc kd hi jy b fi ke kf l kg kh">&lt;head&gt;<br/>    &lt;title&gt;Image Cropper&lt;/title&gt;<br/>    &lt;link <em class="ki">rel</em>="stylesheet" <em class="ki">href</em>="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" <em class="ki">integrity</em>="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" <em class="ki">crossorigin</em>="anonymous"&gt;<br/>    &lt;link <em class="ki">rel</em>="stylesheet" <em class="ki">href</em>="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.css" /&gt;<br/>&lt;/head&gt;</span></pre><p id="c57b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.<strong class="ih hj">设置主体:</strong></p><ul class=""><li id="32f6" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc kj jq jr js bi translated">有两个部分。第一部分是建立一个输入字段，从用户输入。</li><li id="14eb" class="jk jl hi ih b ii kk im kl iq km iu kn iy ko jc kj jq jr js bi translated">当用户选择图像时将打开的模式。</li></ul><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="850d" class="kc kd hi jy b fi ke kf l kg kh">&lt;!--This is for taking picture input form user --&gt;<br/>&lt;div <em class="ki">class</em>="row"&gt;<br/>    &lt;div <em class="ki">class</em>="col-lg-12 col-md-12 text-center"&gt;<br/>        &lt;h3&gt;Image Cropper&lt;/h3&gt;<br/>    &lt;/div&gt;<br/>    &lt;div <em class="ki">class</em>="col-lg-12"&gt;<br/>        &lt;div <em class="ki">class</em>="jumbotron text-center"&gt;<br/>            &lt;div <em class="ki">class</em>="row"&gt;<br/>                &lt;div <em class="ki">class</em>="col-lg-12"&gt;<br/>                    &lt;img <em class="ki">id</em>="uploaded-image" <em class="ki">src</em>="https://flexgroup.nz/wp-content/uploads/2018/05/dummy-image.jpg" <em class="ki">height</em>="300px" <em class="ki">width</em>="600px"&gt;<br/>                &lt;/div&gt;<br/>                &lt;div <em class="ki">class</em>="input-group mt-3"&gt;<br/>                    &lt;div <em class="ki">class</em>="custom-file"&gt;<br/>                        &lt;input <em class="ki">type</em>="file" <em class="ki">accept</em>="image/*" <em class="ki">id</em>="cover_image"&gt;<br/>                    &lt;/div&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="dfbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出如下所示。</p><figure class="jt ju jv jw fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kp"><img src="../Images/a5ed31816023d421fb2ca6150fc0ad9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rt3RLbHptZxleirrUdP9yg.png"/></div></div></figure><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="9d2f" class="kc kd hi jy b fi ke kf l kg kh">&lt;!-- This is the modal --&gt;<br/>&lt;div <em class="ki">class</em>="modal" <em class="ki">tabindex</em>="-1" <em class="ki">role</em>="dialog" <em class="ki">id</em>="uploadimageModal"&gt;<br/>    &lt;div <em class="ki">class</em>="modal-dialog" <em class="ki">role</em>="document" <em class="ki">style</em>="min-width: 700px"&gt;<br/>        &lt;div <em class="ki">class</em>="modal-content"&gt;<br/>            &lt;div <em class="ki">class</em>="modal-header"&gt;<br/>                &lt;h5 <em class="ki">class</em>="modal-title"&gt;Modal title&lt;/h5&gt;<br/>                &lt;button <em class="ki">type</em>="button" <em class="ki">class</em>="close" <em class="ki">data-dismiss</em>="modal" <em class="ki">aria-label</em>="Close"&gt;<br/>                    &lt;span <em class="ki">aria-hidden</em>="true"&gt;&amp;times;&lt;/span&gt;<br/>                &lt;/button&gt;<br/>            &lt;/div&gt;<br/>            &lt;div <em class="ki">class</em>="modal-body"&gt;<br/>                &lt;div <em class="ki">class</em>="row"&gt;<br/>                    &lt;div <em class="ki">class</em>="col-md-12 text-center"&gt;<br/>                        &lt;div <em class="ki">id</em>="image_demo"&gt;&lt;/div&gt;<br/>                    &lt;/div&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>            &lt;div <em class="ki">class</em>="modal-footer"&gt;<br/>                &lt;button <em class="ki">type</em>="button" <em class="ki">class</em>="btn btn-primary crop_image"&gt;Crop and Save&lt;/button&gt;<br/>                &lt;button <em class="ki">type</em>="button" <em class="ki">class</em>="btn btn-secondary" <em class="ki">data-dismiss</em>="modal"&gt;Close&lt;/button&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="0f62" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.<strong class="ih hj">设置脚本文件。</strong></p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="92fd" class="kc kd hi jy b fi ke kf l kg kh">&lt;!-- All Sctipt File --&gt;</span><span id="bac8" class="kc kd hi jy b fi kx kf l kg kh">&lt;script <em class="ki">src</em>="https://code.jquery.com/jquery-3.5.1.js" <em class="ki">integrity</em>="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" <em class="ki">crossorigin</em>="anonymous"&gt;&lt;/script&gt;<br/>&lt;script <em class="ki">src</em>="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" <em class="ki">integrity</em>="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" <em class="ki">crossorigin</em>="anonymous"&gt;&lt;/script&gt;<br/>&lt;script <em class="ki">src</em>="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" <em class="ki">integrity</em>="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" <em class="ki">crossorigin</em>="anonymous"&gt;&lt;/script&gt;<br/>&lt;script <em class="ki">src</em>="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.js"&gt;&lt;/script&gt;<br/>&lt;script <em class="ki">src</em>="https://unpkg.com/sweetalert/dist/sweetalert.min.js"&gt;&lt;/script&gt;</span><span id="e772" class="kc kd hi jy b fi kx kf l kg kh">&lt;!-- This one is custom js file --&gt;<br/>&lt;script <em class="ki">src</em>="{% static 'ImageCropper/image-cropper.js' %}"&gt;&lt;/script&gt;</span></pre><p id="27ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.<strong class="ih hj">设置JavaScript文件(趣味部分)</strong></p><ul class=""><li id="df43" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc kj jq jr js bi translated">首先，让我们看一下场景。用户将点击“选择图像”，并从他的机器选择一个图像。所以，现在我想要的是当“选择图像”将被按下，我将打开我的模态与croppie初始化在我的“图像_演示”div模态。(不要忘记将所有内容都放在$(document)中)。准备好)</li></ul><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="61e2" class="kc kd hi jy b fi ke kf l kg kh"><em class="ki">/// Initializing croppie in my image_demo div</em></span><span id="2d12" class="kc kd hi jy b fi kx kf l kg kh"><em class="ki">var </em>image_crop = $('#image_demo').croppie({<br/>    viewport: {<br/>        width: 600,<br/>        height: 300,<br/>        type:'square'<em class="ki"><br/>    </em>},<br/>    boundary:{<br/>        width: 650,<br/>        height: 350<br/>    }<br/>});</span><span id="6adb" class="kc kd hi jy b fi kx kf l kg kh">/// catching up the cover_image change event and binding the image into my croppie. Then show the modal.</span><span id="1302" class="kc kd hi jy b fi kx kf l kg kh">$('#cover_image').on('change', <em class="ki">function</em>(){<br/>    <em class="ki">var </em>reader = <em class="ki">new </em>FileReader();<br/>    reader.onload = <em class="ki">function </em>(event) {<br/>        image_crop.croppie('bind', {<br/>            url: event.target.result,<br/>        });<br/>    }<br/>    reader.readAsDataURL(<em class="ki">this</em>.files[0]);<br/>    $('#uploadimageModal').modal('show');<br/>});</span></pre><ul class=""><li id="ac8d" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc kj jq jr js bi translated">此时的输出将如下图所示。</li></ul><figure class="jt ju jv jw fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es ky"><img src="../Images/176a78a57b47cecca485ffe101ade9ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*auWlh86G7iz7mFJ25y1TGQ.png"/></div></div></figure><ul class=""><li id="75f1" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc kj jq jr js bi translated">现在怎么办？(请击鼓……)现在，当用户单击“裁剪并保存”按钮时，我将捕获当前裁剪的图像，并通过ajax post请求将其发送到我的后端服务器。我更喜欢blob，但也有一些其他的方法可以遵循。</li></ul><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="fa66" class="kc kd hi jy b fi ke kf l kg kh">/// Get button click event and get the current crop image<br/>$('.<em class="ki">crop_image</em>').click(<em class="ki">function</em>(event){<br/>    <em class="ki">var </em>formData = <em class="ki">new </em>FormData();<br/>    image_crop.croppie('result', {type: 'blob', format: 'png'}).then(<em class="ki">function</em>(blob) {<br/>        formData.append('cropped_image', blob);<br/>        ajaxFormPost(formData, '/upload-image/'); /// Calling my ajax function with my blob data passed to it<br/>    });<br/>    $('#uploadimageModal').modal('hide');<br/>});</span><span id="5867" class="kc kd hi jy b fi kx kf l kg kh">/// Ajax Function<br/><em class="ki">function ajaxFormPost</em>(formData, actionURL){<br/>    $.ajax({<br/>        url: actionURL,<br/>        type: 'POST',<br/>        data: formData,<br/>        cache: <em class="ki">false</em>,<br/>        async: <em class="ki">true</em>,<br/>        processData: <em class="ki">false</em>,<br/>        contentType: <em class="ki">false</em>,<br/>        timeout: 5000,<br/>        beforeSend: <em class="ki">function</em>(){<br/>        },<br/>        success: <em class="ki">function</em>(response) {<br/>            <em class="ki">if </em>(response['status'] === 'success') {<br/>///Some Fancy UI, that you won't probably need</span><span id="bcd7" class="kc kd hi jy b fi kx kf l kg kh">                swal({<br/>                    title:'Success!',<br/>                    text: response['message'],<br/>                    type:'success',<br/>                    timer:2000<br/>                }).then(<em class="ki">function</em>() {<br/>/// But this part you may need, reset the input value and put the cropped image inside my image attribute.</span><span id="3966" class="kc kd hi jy b fi kx kf l kg kh">                    $('#cover_image').val("");<br/>                    $('#uploaded-image').attr('src', response['url']);<br/>                },<em class="ki">function</em>(){<br/>                });<br/>            } <em class="ki">else </em>{<br/>                swal({<br/>                    title:'Failed!',<br/>                    text: response['message'],<br/>                    type:'error'<br/>                });<br/>            }<br/>        },<br/>        complete: <em class="ki">function</em>(){<br/>        }<br/>    });<br/>}</span></pre><p id="c79b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.<strong class="ih hj">后端代码:</strong></p><ul class=""><li id="efc3" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc kj jq jr js bi translated">这部分可能会因你而异，我用的是django-framework(因为我擅长用它)</li><li id="5a2a" class="jk jl hi ih b ii kk im kl iq km iu kn iy ko jc kj jq jr js bi translated">不打算解释太多，但主要的概念是，我将通过ajax向我的url端点发送一个请求(“对我来说，它就像是<a class="ae kz" href="http://localhost:8000/" rel="noopener ugc nofollow" target="_blank">localhost:8000/</a>upload-image/”)，然后通过request.FILES获取我从前端发送的blob文件，并将其存储到media文件夹中，并发送一个成功的JsonResponse以及上传的图像url。如果保存失败，我将发送另一个带有“失败”状态的JsonResponse。</li></ul><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="028e" class="kc kd hi jy b fi ke kf l kg kh"><em class="ki">from </em>django.core.files.storage <em class="ki">import </em>FileSystemStorage<br/><em class="ki">from </em>django.http <em class="ki">import </em>JsonResponse<br/><em class="ki">from </em>django.views <em class="ki">import </em>View<br/><em class="ki">from </em>django.views.decorators.csrf <em class="ki">import </em>csrf_exempt<br/></span><span id="1c7d" class="kc kd hi jy b fi kx kf l kg kh">@csrf_exempt<br/><em class="ki">def </em>upload_image(request):<br/>    fs = FileSystemStorage()<br/>    <em class="ki">try</em>:<br/>        <em class="ki">if </em>request.FILES.get('cropped_image'):<br/>            file_obj = request.FILES['cropped_image']<br/>            file_name = 'email_cover_image.png'<br/>            filename = fs.save(file_name, file_obj)<br/>            file_path = fs.url(filename)<br/>            <em class="ki">return </em>JsonResponse({<br/>                'status': 'success',<br/>                'message': 'Image Uploaded Successfully',<br/>                'url': file_path<br/>            })<br/>    <em class="ki">except Exception as </em>E:<br/>        <em class="ki">print</em>(E)<br/>    <em class="ki">return </em>JsonResponse({<br/>        'status': 'failed',<br/>        'message': 'failed_to_upload_image'<br/>    })</span></pre><p id="4a0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.<strong class="ih hj">最终输出:</strong></p><ul class=""><li id="27bf" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc kj jq jr js bi translated">所以，我们的任务终于完成了。输出是。</li></ul><figure class="jt ju jv jw fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es la"><img src="../Images/a6dd6535a33bec947fda5d1f505d330b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TT75vqWyDP4qK-M9GSWotw.png"/></div></div></figure><p id="b06a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.<strong class="ih hj">结论:</strong></p><ul class=""><li id="6132" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc kj jq jr js bi translated">很难用文字来解释一切。</li><li id="f8c6" class="jk jl hi ih b ii kk im kl iq km iu kn iy ko jc kj jq jr js bi translated">但是我试着一步一步地解释，这样你就不会像我一样卡住，并得到一个教程参考。</li><li id="0207" class="jk jl hi ih b ii kk im kl iq km iu kn iy ko jc kj jq jr js bi translated">阅读Croppie的文档以获得更多示例。<a class="ae kz" href="https://foliotek.github.io/Croppie/" rel="noopener ugc nofollow" target="_blank">https://foliotek.github.io/Croppie/</a></li><li id="fa39" class="jk jl hi ih b ii kk im kl iq km iu kn iy ko jc kj jq jr js bi translated">完整代码:【https://github.com/hassanmdsifat/ImageCropper T2】</li></ul></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="8791" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢你，祝你愉快！！！！</p></div></div>    
</body>
</html>