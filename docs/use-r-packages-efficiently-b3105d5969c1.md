# 有效地使用 R 包

> 原文：<https://medium.com/analytics-vidhya/use-r-packages-efficiently-b3105d5969c1?source=collection_archive---------23----------------------->

我想利用这个机会写一些有用的模式来组织你的 R 代码。这些可能是高级 R 用户所熟知的，但在大多数教程中却被忽略了。所以，坐好，放松，享受一些有用的简单的休息技巧吧！

# 1.正在加载 R 包

在 R 中加载包最著名的方式是通过`library()`命令。这个选项的一个缺点是，如果在 R 环境中找不到这个包，就会抛出一个错误。另一个函数是`require()`,如果找不到包，它就抛出一条警告消息并返回`FALSE`,如果找到了，它就加载包并返回`TRUE`。

如果您想查看系统中的所有包，您可以使用`installed.packages()`，或者类似于`"testthat" %in% installed.packages()`的命令来检查特定的包(在本例中为`testthat`)。

# 2.基本文件夹结构

R 包的内容通常包含在一个结构化的文件夹中，该文件夹包含 R 文件以及文档和其他二进制文件。一个工作的 R 包的最简单的结构应该如下所示。

```
├── DESCRIPTION
├── NAMESPACE
└── R
    ├── file1.R
    └── file2.R
```

`DESCRIPTION`是包含包的元数据的文件。它至少需要两个字段:包的名称和版本。`NAMESPACE`是由`roxygen2`自动生成的文件，不能手工编辑。也就是说，下面的 mock 应该可以与任何包一起导出 R 文件夹中定义的所有函数。

```
# Generated by roxygen2: fake comment so roxygen2 overwrites silently.
exportPattern("^[^\\.]")
```

最后，`R`是包含所有 R 定义和变量的文件的文件夹。

# 3.访问命名空间中导出的变量

加载整个包可能需要一段时间，更不用说它可能会覆盖内存中与包中定义的一些对象同名的变量。所以，如果想在一个包中只使用一个函数，可以使用双冒号操作符，`::`。例如，为了使用包`testthat`中的函数`test_file()`，可以简单地输入`testthat::test_file()`。

# 4.访问命名空间中的内部变量

三重冒号操作符`:::`，简单来说就是`::`在类固醇上！该操作符允许您使用包中定义的变量，这些变量不导出到用户环境中。

作为一个例子，运行命令`testthat:::praise()`你会发现一个惊喜！

# 5.devtools 就在那里！用它！

在您的 R 环境中安装`devtools`包通常并不简单，因为它有许多依赖项和 C 二进制文件，但是它会使开发 R 包变得容易得多。因此，请耐心完成额外的调试工作——这在将来会有回报的！

开发 R 包的一些最有用的函数有:`document()`、`install()`、`load_all()`和`test()`。

*   `document()`:使用以`#'`开头的注释和`NAMESPACE`文件生成所有文档，包括手册页。当`NAMESPACE`被重写时，每次加载包时，只有标有`@export`的定义被导出。
*   `install()`:在本地 R 环境下，安装工作目录或提供的路径对应的 R 包。
*   `load_all()`:加载工作目录或提供的路径对应的 R 包中定义的所有函数和变量，不需要安装。这在与 RStudio 结合使用时特别有用，可以创建断点并检查所编写函数的行为。
*   `test()`:自动运行 R 包中位于`tests`的所有单元测试。

# 参考

所有这些想法都是在探索一些 R 包的帮助页面或源代码时收集的。以下几页对我特别有帮助。

*   [R 包](https://r-pkgs.org/)
*   [R 文档](https://www.rdocumentation.org/)
*   [测试存储库](https://github.com/r-lib/testthat)

# 结论

我希望这篇文章对你有用，也不要忘记分享你最喜欢的 R 技巧！