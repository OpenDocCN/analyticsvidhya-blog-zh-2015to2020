<html>
<head>
<title>Running a Jupyter Notebook in an Astronomer Airflow Local Development in 6 easy steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用6个简单的步骤在天文学家气流局部发展中运行Jupyter笔记本</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/running-a-jupyter-notebook-in-an-astronomer-airflow-local-development-in-6-easy-steps-5f134da392a0?source=collection_archive---------17-----------------------#2020-07-21">https://medium.com/analytics-vidhya/running-a-jupyter-notebook-in-an-astronomer-airflow-local-development-in-6-easy-steps-5f134da392a0?source=collection_archive---------17-----------------------#2020-07-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="ea77" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated"><strong class="il hj">注意</strong> : <em class="hi">这篇文章是专门写给使用天文学家版本的Airflow的读者的，但是它可以通过Docker适应任何Airflow实例设置。</em></p></blockquote><p id="1f70" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">我们的DAG的复杂性在过去的一年中增加了，我发现在一个DAG中以简单和可重复的方式交互地迭代和调试代码变得更加困难。所以我做了一些研究，整理了一些步骤，可以帮助人们运行Jupyter笔记本，它可以继承Airflow实例的所有本机挂钩、连接和变量。</p><p id="b249" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">有了这个交互式笔记本，您可以在最类似于DAG的最终形式的状态下更轻松地开发想法并共享它们，而无需DAG触发即可进行探索。</p><p id="9700" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">下面是在您自己的本地环境中进行设置的步骤:</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h1 id="91b7" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">步骤1(仅适用于阿尔卑斯山图像)</h1><p id="a322" class="pw-post-body-paragraph ii ij hi il b im kp io ip iq kq is it jh kr iw ix ji ks ja jb jj kt je jf jg hb bi translated"><strong class="il hj"> <em class="ik">注意:</em> </strong> <em class="ik">除非您docker文件中的天文学家图像包含阿尔卑斯山</em>，否则不再需要此步骤</p><p id="0dab" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">将以下内容添加到Airflow项目根目录中的<code class="du ku kv kw kx b">packages.txt</code>。这些包支持Jupyter在你的docker镜像中运行。</p><pre class="ky kz la lb fd lc kx ld le aw lf bi"><span id="6058" class="lg js hi kx b fi lh li l lj lk">build-base<br/>python3-dev<br/>zeromq-dev</span></pre><h1 id="ec69" class="jr js hi bd jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko bi translated">第二步</h1><p id="c637" class="pw-post-body-paragraph ii ij hi il b im kp io ip iq kq is it jh kr iw ix ji ks ja jb jj kt je jf jg hb bi translated">将jupyter包添加到您的<code class="du ku kv kw kx b">requirements.txt</code>中，它也位于airflow项目根目录中</p><pre class="ky kz la lb fd lc kx ld le aw lf bi"><span id="30e1" class="lg js hi kx b fi lh li l lj lk">jupyter</span></pre><h1 id="c04f" class="jr js hi bd jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko bi translated">第三步</h1><p id="4416" class="pw-post-body-paragraph ii ij hi il b im kp io ip iq kq is it jh kr iw ix ji ks ja jb jj kt je jf jg hb bi translated">现在我们需要在Airflow项目根目录下创建或添加一个名为<code class="du ku kv kw kx b">docker-compose.override.yml</code>的文件。此文件允许您附加/修改天文学家气流图像的默认docker-compose文件。我们将在webserver docker容器上为我们的Jupyter笔记本打开默认端口8888。</p><pre class="ky kz la lb fd lc kx ld le aw lf bi"><span id="a56e" class="lg js hi kx b fi lh li l lj lk">version '2'<br/>services:<br/>  webserver:<br/>    ports:<br/>      - 0.0.0.0:8888:8888</span></pre><h1 id="4624" class="jr js hi bd jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko bi translated">第四步</h1><p id="58c5" class="pw-post-body-paragraph ii ij hi il b im kp io ip iq kq is it jh kr iw ix ji ks ja jb jj kt je jf jg hb bi translated">用<code class="du ku kv kw kx b">astro dev start</code>启动您的本地实例如果当前正在运行，首先运行<code class="du ku kv kw kx b">astro dev stop</code></p><h1 id="ae87" class="jr js hi bd jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko bi translated">第五步</h1><p id="a455" class="pw-post-body-paragraph ii ij hi il b im kp io ip iq kq is it jh kr iw ix ji ks ja jb jj kt je jf jg hb bi translated">通过运行<code class="du ku kv kw kx b">docker ps</code>找到Airflow服务器的docker容器id</p><p id="376f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">输出将显示3个运行的映像，一个用于web服务器，一个用于调度程序，另一个用于postgres。在这种情况下，我们需要web服务器的容器id。它应该是大约10个字符的小写字母和数字的组合，如下图所示。</p><figure class="ky kz la lb fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es lq"><img src="../Images/e894697f078a15b966ce54621e258a30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ibc6wtF6i6uKj1XZYViVg.png"/></div></div></figure><h1 id="98d3" class="jr js hi bd jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko bi translated">第六步(最后！)</h1><p id="8c1a" class="pw-post-body-paragraph ii ij hi il b im kp io ip iq kq is it jh kr iw ix ji ks ja jb jj kt je jf jg hb bi translated">现在我们想通过运行以下命令从webserver容器中执行jupyter notebook</p><pre class="ky kz la lb fd lc kx ld le aw lf bi"><span id="7929" class="lg js hi kx b fi lh li l lj lk">docker exec -it xxxxxxxxxxxxx jupyter notebook --ip 0.0.0.0 --port 8888 --no-browser</span></pre><h2 id="1100" class="lg js hi bd jt ly lz ma jx mb mc md kb jh me mf kf ji mg mh kj jj mi mj kn mk bi translated">让我们进一步分析一下上面的陈述:</h2><p id="c45d" class="pw-post-body-paragraph ii ij hi il b im kp io ip iq kq is it jh kr iw ix ji ks ja jb jj kt je jf jg hb bi translated"><code class="du ku kv kw kx b">docker exec -it</code> —执行命令<code class="du ku kv kw kx b">-it</code>交互式文本终端</p><p id="412d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><code class="du ku kv kw kx b">xxxxxxxxxxxxx</code>是在步骤5中找到的容器的id</p><p id="a404" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><code class="du ku kv kw kx b">jupyter notebook</code>是运行jupyter笔记本的命令，这一行后的一切都是运行选项</p><p id="7fd4" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">因为我们在docker映像中，所以我们需要将ip running定义为0.0.0.0，以便转发到您的本地机器</p><p id="0cb6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><code class="du ku kv kw kx b">--port 8888</code>是我们在前面步骤中定义的运行端口。如果您选择在不同的端口上运行，您可以在此处输入该号码</p><p id="bb18" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><code class="du ku kv kw kx b">--no-browser</code>因为这是在docker container airflow web服务器中运行，我们不需要web浏览器来自动启动，因为我们会自己处理。</p><p id="48e1" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">假设这些都正确运行，您应该会看到类似如下的输出:</p><figure class="ky kz la lb fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ml"><img src="../Images/46ab734483e621238fdfbd3c74a878d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*S7QlaybTcW2nFaIL.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx translated">运行步骤6的控制台输出</figcaption></figure><h1 id="f4c6" class="jr js hi bd jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko bi translated">在你最喜欢的浏览器中加载Jupyter笔记本</h1><p id="6503" class="pw-post-body-paragraph ii ij hi il b im kp io ip iq kq is it jh kr iw ix ji ks ja jb jj kt je jf jg hb bi translated">现在，您可以像使用任何其他笔记本一样使用这个有记录的笔记本。</p><p id="2ebc" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">通过访问<a class="ae mq" href="http://127.0.0.1:8888/?token=" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:8888/？我们现在在我们的Airflow web服务器上运行一个Jupyter笔记本。</a></p><p id="5606" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">注意:</strong> <em class="ik">如果提示您输入令牌，您将需要利用输出中显示的令牌，在上面的示例中是</em> <code class="du ku kv kw kx b"><em class="ik">aa4234d685bf1f43799fd55e49cc86fb2b9feb9da445bd73</em></code></p><p id="5b88" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">这个令牌在jupyter笔记本的每一次启动时都会有所不同</p><figure class="ky kz la lb fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mr"><img src="../Images/3ec93634eb0081e05cf2693e011f032f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8b8u7uirP4brmFlbzuD1kg.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx translated">运行在气流项目根目录下的Jupyter笔记本</figcaption></figure><p id="1ce3" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">在这个笔记本中，您现在可以像编写DAG代码一样编写代码，从而能够交互地利用连接、变量和本机挂钩</p><figure class="ky kz la lb fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ms"><img src="../Images/e68c3d13892ccbef9ff9dcf6a9cbb45e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DFRUHakAGzZrnFaphNgkmA.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx translated">打印POC的气流项目变量的上下文</figcaption></figure></div></div>    
</body>
</html>