# StreamSets Transformer å¯æ‰©å±•æ€§:Spark å’Œæœºå™¨å­¦ä¹ 

> åŸæ–‡ï¼š<https://medium.com/analytics-vidhya/streamsets-transformer-extensibility-spark-and-machine-learning-e8ddcd7b7a9d?source=collection_archive---------12----------------------->

Apache Spark åœ¨è¿‡å»å‡ å¹´ä¸­ä¸€ç›´å¤„äºä¸Šå‡è¶‹åŠ¿ï¼Œåœ¨å†…å­˜å’Œåˆ†å¸ƒå¼è®¡ç®—ã€å®æ—¶åˆ†æå’Œæœºå™¨å­¦ä¹ ç”¨ä¾‹æ–¹é¢ï¼Œå®ƒç»§ç»­å æ®ä¸»å¯¼åœ°ä½ã€‚éšç€æœ€è¿‘å‘å¸ƒçš„ [StreamSets Transformer](https://streamsets.com/products/transformer/) ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸ºç°ä»£ ETL åˆ›å»ºé«˜åº¦æ’è£…çš„ Apache Spark åº”ç”¨ç¨‹åºçš„å¼ºå¤§å·¥å…·ï¼Œæ‚¨å¯ä»¥ä»¥æœ€å°çš„æ“ä½œå’Œé…ç½®å¼€é”€å¿«é€Ÿåˆ©ç”¨ Apache Spark çš„æ‰€æœ‰ä¼˜åŠ¿å’ŒåŠŸèƒ½ã€‚

åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œä½ å°†å­¦ä¹ å¦‚ä½•æ‰©å±• StreamSets Transformer æ¥è®­ç»ƒ[Spark ML RandomForestRegressor](https://spark.apache.org/docs/latest/ml-classification-regression.html#random-forest-regression)æ¨¡å‹ã€‚

# StreamSets è½¬æ¢å™¨å¯æ‰©å±•æ€§

è™½ç„¶ StreamSets DataOps å¹³å°ä½œä¸ºä¸€ä¸ªæ•´ä½“ä½¿æ‚¨èƒ½å¤Ÿå¤„ç†æ‰€æœ‰æ•°æ®æ“ä½œï¼Œä½† StreamSets Transformer åˆ™æ›´è¿›ä¸€æ­¥ï¼Œè¿˜ä½¿æ‚¨èƒ½å¤Ÿåˆå¹¶å’Œè‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ ä¸­æ¶‰åŠçš„ä¸€äº›æ›´å¸¸è§çš„ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ç»„åˆã€è¿æ¥å’Œä¸°å¯Œæ¥è‡ªå¤šä¸ªæ¥æºçš„è®­ç»ƒæ•°æ®é›†æ¥è¿›è¡Œæ•°æ®å‡†å¤‡ï¼Œé‡å‘½åç‰¹å¾ï¼Œå°†ç‰¹å¾çš„æ•°æ®ç±»å‹è½¬æ¢æˆæœºå™¨å­¦ä¹ ç®—æ³•æ‰€æœŸæœ›çš„æ•°æ®ç±»å‹ï¼Œç­‰ç­‰ã€‚

æ­¤å¤–ï¼ŒStreamSets Transformer è¿˜ä¸ºæ‚¨æä¾›äº†ä¸€ç§æ‰©å±•å…¶åŠŸèƒ½çš„æ–¹å¼ï¼Œå³ç¼–å†™å®šåˆ¶çš„ **Scala** å’Œ **PySpark** ä»£ç ä½œä¸ºæ‚¨æ•°æ®ç®¡é“çš„ä¸€éƒ¨åˆ†ã€‚è¯¥å¹³å°çš„è¿™äº›æ–°åŠŸèƒ½å’Œå¯æ‰©å±•æ€§ä¸ºè‡ªåŠ¨åŒ– ML ä»»åŠ¡æ‰“å¼€äº†å¤§é—¨ï¼Œä¾‹å¦‚è®­ç»ƒæœºå™¨å­¦ä¹ æ¨¡å‹ã€‚

StreamSets è½¬æ¢å™¨ç®¡é“æ¦‚è¿°

åœ¨æˆ‘ä»¬æ·±å…¥ç ”ç©¶ä»£ç ä¹‹å‰ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªé«˜å±‚æ¬¡çš„ç®¡é“æ¦‚è¿°ã€‚

![](img/ba66a7a8c4b481a6283498c59bda4906.png)

æŠ•å…¥

ä¸€ä¸ª[åˆ†éš”çš„(ã€‚csv)æ–‡ä»¶](https://github.com/iamontheinet/StreamSets/blob/master/Misc/Advertising_training.csv)ï¼ŒåŒ…å«åª’ä½“æ¸ é“(ç”µè§†ã€å¹¿æ’­å’ŒæŠ¥çº¸)çš„å†å²å¹¿å‘Šé¢„ç®—(ä»¥åƒç¾å…ƒä¸ºå•ä½)åŠå…¶é”€å”®é¢(ä»¥åƒç¾å…ƒä¸ºå•ä½)ã€‚

![](img/9395ae6b9495e1ee0459014208a83346.png)

å­—æ®µé‡å‘½åå™¨

è¯¥å¤„ç†å™¨å°†åˆ—(ä¹Ÿç§°ä¸ºç”¨äºæ¨¡å‹è®­ç»ƒçš„ç‰¹å¾)é‡å‘½åä¸ºæ›´æ˜“äºäººç±»é˜…è¯»çš„å½¢å¼â€”â€œ_ C1â€â†’â€œç”µè§†â€ï¼Œâ€œ_ C2â€â†’â€œå¹¿æ’­â€ï¼Œä»¥åŠâ€œ_ C3â€â†’â€œæŠ¥çº¸â€ã€‚

æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒè¿˜å°†è¡¨ç¤ºâ€œé”€å”®é¢â€(==å”®å‡ºçš„å•ä½æ•°)çš„åˆ—â€œ_c4â€é‡å‘½åä¸ºâ€œæ ‡ç­¾â€ï¼Œè¿™æ˜¯ Spark ML å¿…é¡»/å¿…éœ€çš„ä¸œè¥¿ã€‚

![](img/a45f300f1ca04728b5b51ae378543aca.png)

Scala å¤„ç†å™¨

ç®¡é“åŠ è½½å¦‚ä¸Šæ‰€è¿°çš„è®­ç»ƒæ•°æ®é›†ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ Scala å¤„ç†å™¨ï¼Œè¯¥å¤„ç†å™¨å°è£…å®šåˆ¶ä»£ç ä»¥è®­ç»ƒ Spark ML RandomForestRegressor æ¨¡å‹ã€‚è¯¥æ¨¡å‹è¢«è®­ç»ƒä¸ºæ ¹æ®åˆ†é…ç»™ç”µè§†ã€å¹¿æ’­å’ŒæŠ¥çº¸åª’ä½“æ¸ é“çš„å¹¿å‘Šé¢„ç®—æ¥é¢„æµ‹é”€å”®é¢(==å”®å‡ºçš„å•ä½æ•°)ã€‚

å…ˆå†³æ¡ä»¶:ä¸ºäº†è®©ç®¡é“è¿è¡Œæˆ‘ä»¬çš„å®šåˆ¶ Scala ä»£ç ï¼Œå¿…é¡»é€šè¿‡**åŸºæœ¬é˜¶æ®µåº“**ä¸‹çš„**åŒ…ç®¡ç†å™¨**ä» UI å®‰è£…ä»¥ä¸‹å¤–éƒ¨åº“ã€‚(æ³¨æ„ï¼Œè¿™å°†éœ€è¦å˜å‹å™¨é‡å¯ã€‚)

**ç®¡é“ä¹‹è‚‰ï¼**

![](img/6edb9b8384fb335044daabe53d168e29.png)

ä¸‹é¢æ˜¯æ’å…¥åˆ° **Scala å¤„ç†å™¨> > Scala > > Scala ä»£ç **æ®µçš„ Scala ä»£ç ã€‚å®ƒåŸºæœ¬ä¸Šæ¥å—è¾“å…¥æ•°æ®å¹¶è®­ç»ƒ Spark ML RandomForestRegressor æ¨¡å‹â€”â€”åŒæ—¶ç»“åˆè®­ç»ƒæµ‹è¯•åˆ†å‰²ã€è¶…å‚æ•°è°ƒæ•´å’Œäº¤å‰éªŒè¯ã€‚(è¯·å‚é˜…è¡Œå†…æ³¨é‡Šè¿›è¡Œæ¼”ç»ƒã€‚)

*æ³¨æ„:åœ¨åå°ï¼Œè¿™ä¸ªå®šåˆ¶ä»£ç è¢«ç¼–è¯‘åˆ°ä¸€ä¸ª jar ä¸­ï¼Œå¹¶äº¤ç»™åº•å±‚çš„æ‰§è¡Œå¼•æ“â€”â€”åœ¨æœ¬ä¾‹ä¸­æ˜¯ Sparkã€‚*è¾“å‡º

å‡è®¾ä¸€åˆ‡é¡ºåˆ©,â€œè¾“å‡ºâ€æ•°æ®å¸§å°†åŒ…å«â€œR2â€å’Œâ€œRMSE â€,å®ƒä»¬å°†è¢«å†™åˆ°ä¸Šè¿°ç®¡é“ä¸­æ ‡è®°ä¸ºâ€œæ•è· R2 å’Œ RMSEâ€çš„æ–‡ä»¶ç›®æ ‡ä½ç½®ä¸­é…ç½®çš„æ–‡ä»¶ä¸­ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ–‡ä»¶ç›®æ ‡çš„æ•°æ®æ ¼å¼è®¾ç½®ä¸º JSONï¼ŒJSON æ–‡ä»¶çš„å†…å®¹å¯èƒ½ç±»ä¼¼äº:

> { " RMSE ":2.133713963903168 ," R2 ": 0.1337263466

ä¸è¨€è€Œå–»ï¼Œæ¨¡å‹ç²¾åº¦å°†å–å†³äºè®­ç»ƒæ•°æ®é›†çš„å¤§å°å’Œè´¨é‡ï¼Œä»¥åŠè°ƒæ•´å“ªäº›è¶…å‚æ•°ã€‚ğŸ™‚

# æ‘˜è¦

åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæ‚¨äº†è§£äº†å¦‚ä½•è½»æ¾åœ°æ‰©å±• StreamSets Transformer çš„åŠŸèƒ½ã€‚ç‰¹åˆ«æ˜¯ï¼Œæ‚¨å­¦ä¹ äº†å¦‚ä½•åˆå¹¶è‡ªå®šä¹‰ Scala ä»£ç æ¥è®­ç»ƒ Spark ML æœºå™¨å­¦ä¹ æ¨¡å‹ã€‚ä»¥ç±»ä¼¼çš„æ–¹å¼ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ Python API for Spark æˆ– PySpark ç¼–å†™å®šåˆ¶ä»£ç ï¼Œå¹¶ä½¿ç”¨å†…ç½®çš„ [PySpark](https://streamsets.com/documentation/transformer/latest/help//transformer/Processors/PySpark.html#concept_gqm_4hn_ygb) å¤„ç†å™¨ã€‚

å°½ç®¡è¯¥å¹³å°æ˜“äºæ‰©å±•ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®šåˆ¶ä»£ç ä»ç„¶åˆ©ç”¨ StreamSets Transformer çš„åº•å±‚å†…ç½®åŠŸèƒ½å’Œå¼ºå¤§åŠŸèƒ½ã€‚ä»…ä¸¾å‡ ä¸ªä¾‹å­:

*   åœ¨ä»»ä½• Spark é›†ç¾¤ã€æœ¬åœ° Hadoop æˆ–äº‘æ‰˜ç®¡ Spark æœåŠ¡(ä¾‹å¦‚ Databricks)ä¸Šæ‰§è¡Œã€‚
*   æ¸è¿›å¼é”™è¯¯å¤„ç†å¯ä»¥å‡†ç¡®åœ°äº†è§£é”™è¯¯å‘ç”Ÿçš„ä½ç½®å’ŒåŸå› ï¼Œè€Œæ— éœ€è§£å¯†å¤æ‚çš„æ—¥å¿—æ–‡ä»¶ã€‚
*   é«˜åº¦ä»ªè¡¨åŒ–çš„ç®¡é“æ­ç¤ºäº†æ¯ä¸ªæ“ä½œä»¥åŠåº”ç”¨ç¨‹åºä½œä¸ºä¸€ä¸ªæ•´ä½“æ˜¯å¦‚ä½•æ‰§è¡Œçš„ã€‚

è¦äº†è§£æ›´å¤šå…³äº StreamSets Transformer çš„ä¿¡æ¯ï¼Œè¯·è®¿é—®æˆ‘ä»¬çš„[ç½‘ç«™](https://streamsets.com/products/transformer/)ï¼Œå‚è€ƒ[æ–‡æ¡£](https://streamsets.com/documentation/transformer/latest/help//transformer/GettingStarted/GettingStarted-Title.html#concept_a1b_zf4_pgb)ï¼Œå‚åŠ [ç½‘ç»œç ”è®¨ä¼š](https://go.streamsets.com/webinar-intro-to-data-transformer.html)ï¼Œä»¥åŠ[ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶](https://streamsets.com/download/)ã€‚

## æ›´æ–°

[åœ¨ç¬¬ 2 éƒ¨åˆ†](https://streamsets.com/blog/streamsets-transformer-extensibility-part-2-spark-mleap-bundles-to-s3/)ä¸­ï¼Œæˆ‘å·²ç»è¯´æ˜äº†å¦‚ä½•åˆ›å»º Spark MLeap æ†ç»‘åŒ…æ¥åºåˆ—åŒ–è®­ç»ƒå¥½çš„æ¨¡å‹å¹¶å°†æ†ç»‘åŒ…ä¿å­˜åˆ°äºšé©¬é€Š S3ã€‚

*åŸè½½äº 2019 å¹´ 9 æœˆ 12 æ—¥*[*https://streamsets.com*](https://streamsets.com/blog/streamsets-transformer-extensibility-spark-and-machine-learning/)*ã€‚*