<html>
<head>
<title>Building an Enterprise Data Lake On Cloud — Security</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建基于云安全的企业数据湖</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/building-an-enterprise-data-lake-on-cloud-security-9817e526bfd0?source=collection_archive---------26-----------------------#2020-07-06">https://medium.com/analytics-vidhya/building-an-enterprise-data-lake-on-cloud-security-9817e526bfd0?source=collection_archive---------26-----------------------#2020-07-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="93a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设计数据湖时的云安全。</p><p id="d548" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我之前的<a class="ae jd" rel="noopener" href="/@sarathsasi87/build-an-enterprise-data-lake-on-cloud-introduction-d906eb429cc">博客</a>中，我提到了您在开始云之旅之前需要测试的基础。如前所述，本节涵盖了企业数据湖的安全性部分，本博客是增量式的，因此在后续博客中您可以看到对本博客的引用，随着我们的进展，我们将在安全性(IAM)中添加更多内容。</p><p id="607f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在设计数据湖时，安全性是必须遵守的一个不容置疑的要求。当我们开始保护您的数据湖时，在云上需要考虑多个安全层。</p><ol class=""><li id="b04a" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">外围安全(网络级)</li><li id="8398" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">IAM(身份和访问管理)用于控制平面，RBAC(基于角色的访问控制)用于数据平面</li></ol><p id="5e5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">外围安全可以通过一个中央团队集中管理。该团队可以定义网络拓扑并实施规则和路由，从而为团队提供安全网，同时不会被限制使用服务。这些规则可以使用<a class="ae jd" href="https://docs.microsoft.com/en-us/azure/governance/policy/overview" rel="noopener ugc nofollow" target="_blank">策略</a>来执行。</p><p id="b601" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇博客中，我们关注数据湖网络的整体网络拓扑结构安全，请参考<a class="ae jd" href="https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/" rel="noopener ugc nofollow" target="_blank">这篇</a>。它提供了各种场景供您选择，以决定您希望如何设计从内部到azure的最小延迟连接。</p><p id="50bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一件事是设计外围安全，这将定义允许各部门在哪些虚拟网络上部署，以及它们如何被中央团队的安全网覆盖。下面是一个例子:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es js"><img src="../Images/a9f97aaf4aea9ad0d7b777ba46f1a43b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mtj72pTTXaSk0FcT5ZSRIw.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">我们的数据湖的基本网络设置</figcaption></figure><p id="146a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的想法是采用推荐的中心辐射式网络模型，其中您有一个中心，即塔/主团队，该团队监控并为团队/部门提供保护，以继续在其环境中进行积极的开发。</p><p id="d8f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于此设置，我们还为每个部门分配了一个资源组。这里有多种最佳实践，通常建议采用民主订阅模式，这意味着每个部门都有自己的订阅。由于在我的当前帐户上创建多个订阅的一些限制，我们将使用资源组作为边界。</p><p id="2b79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要设置它，你需要一个IDE，或者你也可以使用azure门户。在本教程中，我们将使用IAC(基础设施即代码)原则。</p><p id="5a54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来配置您的VNet范围，确保它们不重叠。想法是隔离每个部门，并使用<a class="ae jd" href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-peering-overview" rel="noopener ugc nofollow" target="_blank"> VNet对等</a>将其连接到中央管理团队，该团队拥有集中的监控和警报工具。有一个了望塔的方法总是好的，以确保事情得到集中监控。</p><p id="a6e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设一个公司有4个部门和1个中心团队。通常对于企业来说，您需要更多的IP，但是对于演示设置，我们假设使用此设置。</p><p id="7602" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要设置虚拟网络的IP范围:</p><ol class=""><li id="b675" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">对于中央集线器:10.1.0.0/24 (256个IP)</li><li id="3afc" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">对于部门1: 10.2.0.0/24 ( 256个IP)</li><li id="610a" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">对于部门2 : 10.3.0.0/24(256个IP)</li><li id="dfd4" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">对于部门3: 10.4.0.0/24 (256个IP)</li><li id="65ba" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">对于部门4: 10.5.0.0/24(256个IP)</li></ol><p id="9787" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以使用powershell，azure cli，或者调用REST APIs，并使用选择的语言，对于这个博客，它的<a class="ae jd" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest" rel="noopener ugc nofollow" target="_blank"> azure cli </a>。</p><p id="7f85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个项目下，参考infra/create_infra.sh，随着时间的推移，这个脚本将被完善，所以使用它作为开始。</p><div class="ki kj ez fb kk kl"><a href="https://github.com/sarathsasidharan/edl-blueprint" rel="noopener  ugc nofollow" target="_blank"><div class="km ab dw"><div class="kn ab ko cl cj kp"><h2 class="bd hj fi z dy kq ea eb kr ed ef hh bi translated">sarathsasidharan/EDL-蓝图</h2><div class="ks l"><h3 class="bd b fi z dy kq ea eb kr ed ef dx translated">企业数据湖模板。通过在…上创建帐户，为sarathsasidharan/edl-blueprint开发做出贡献</h3></div><div class="kt l"><p class="bd b fp z dy kq ea eb kr ed ef dx translated">github.com</p></div></div><div class="ku l"><div class="kv l kw kx ky ku kz kc kl"/></div></div></a></div><pre class="jt ju jv jw fd la lb lc ld aw le bi"><span id="9d2b" class="lf lg hi lb b fi lh li l lj lk"># This creates a new resource group <br/>create_resource_group $RG_NAME $RG_LOCATION</span><span id="9def" class="lf lg hi lb b fi ll li l lj lk"># This part creates all VNETs for each department<br/>create_virtual_network $RG_NAME $DEPARTMENT_0 $VNET_DEP0</span><span id="8602" class="lf lg hi lb b fi ll li l lj lk"># Set up VNet Peering<br/>create_virtual_network_peering $RG_NAME_DEP0 $RG_NAME_DEP1 $DEPARTMENT_0 $DEPARTMENT_1</span></pre><p id="f0bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该脚本执行以下内容:</p><ol class=""><li id="3dd8" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">创建一个<a class="ae jd" href="https://github.com/sarathsasidharan/edl-blueprint/blob/master/infra/resource-group/create_rg.sh" rel="noopener ugc nofollow" target="_blank">资源组</a>，需要在其中部署资源</li><li id="1333" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">在之前创建的资源组中创建一个<a class="ae jd" href="https://github.com/sarathsasidharan/edl-blueprint/blob/master/infra/network/create_network.sh" rel="noopener ugc nofollow" target="_blank"> VNET </a>，并分配IP范围</li><li id="011a" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated"><a class="ae jd" href="https://github.com/sarathsasidharan/edl-blueprint/blob/master/infra/network/create-peering.sh" rel="noopener ugc nofollow" target="_blank"> VNET </a>从各部门到中央枢纽的对等关系。</li></ol><p id="8cc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参考<a class="ae jd" href="https://github.com/sarathsasidharan/edl-blueprint/blob/master/infra/config/azure.config" rel="noopener ugc nofollow" target="_blank">配置</a>文件，查找每个虚拟网络使用的部门名称和IP范围。</p><p id="1ec1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在脚本的这一部分运行之后，您可以参考门户来检查资源组是否已配置，VNet是否已配置，以及VNet对等是否已从hub应用到部门。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lm"><img src="../Images/ba99898dcef1857edf80d3fb6392fa5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_XJEpAc9ZHuUTajxqwskJg.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">每个部门创建的资源组</figcaption></figure><p id="ccd9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">单击这些资源组链接以检查其中的资源，应创建一个虚拟网络，单击此虚拟网络资源链接，如果您从左侧刀片选择对等，对等信息也应可见。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es ln"><img src="../Images/f3a8f819bd612ab44acc71e8ecfe96d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Od2bgidlohXH6Hw1U-Mutw.png"/></div></div></figure><p id="d684" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是检查我们希望团队遵守的某些防护栏/规则。这是使用<a class="ae jd" href="https://docs.microsoft.com/en-us/azure/governance/policy/overview" rel="noopener ugc nofollow" target="_blank"> azure策略完成的。</a></p><p id="dff5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，让我们考虑以下护栏:</p><ol class=""><li id="721a" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">团队需要部署的任何虚拟机都应该连接到为该团队分配的虚拟网络。</li><li id="5d72" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">仅在西欧/北欧部署资源的地点。</li></ol><p id="bd08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以设置多种规则，但是让我们从这些规则开始，随着时间的推移，我们将丰富这些策略。</p><p id="7a9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我们特意选择了两种类型的策略，一种是azure自带的内置策略，您只需将其分配给作用域实体(管理组/订阅/资源组/资源),第二种是创建新的自定义策略定义，然后分配给作用域。</p><p id="91aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一点上，第1点是自定义策略，第2点是内置策略。</p><p id="2ec9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在文件infra/create_infra.sh中。让我们看一下自定义策略的创建。该策略限制在分配给团队的虚拟网络之外部署任何虚拟机。该方法创建一个策略，接受策略名称、显示名称和描述作为参数来创建新的策略定义。</p><pre class="jt ju jv jw fd la lb lc ld aw le bi"><span id="f501" class="lf lg hi lb b fi lh li l lj lk"># This is to create a new policy definition<br/>create_policy $POLICY_VNET $POLICY_VNET_DISPLAY_NAME $POLICY_VNET_DESC</span></pre><p id="449f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以通过在“搜索”选项卡中搜索“策略”来检查此策略是否已应用，在此选项卡下，选择“定义”以检查定义的策略是否已列出。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lo"><img src="../Images/c3f57a1578b56ce3944721de528c515a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mLSL3Q7y0In5UZRUmUhmSQ.png"/></div></div></figure><p id="ad8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了定义策略，你需要提供两个文件，一个参数文件和策略定义，点击<a class="ae jd" href="https://github.com/sarathsasidharan/edl-blueprint/tree/master/infra/policy/audit-vm-deployment-data-lake/definition" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="dc40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在参数文件中，我们提供将要使用的参数，在这种情况下，范围是我们将vnet作为参数传递到的资源组，这将确保例如:在资源组rg-hub-dev中，虚拟机只能部署到hub-vnet中，而不能部署到任何其他vnet中。</p><p id="f08d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了测试这一点，首先是限制在西欧和北欧之外创建的任何资源组中创建任何资源的策略。</p><p id="f39e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尝试在西欧地区的任何资源组中创建新的存储帐户。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lp"><img src="../Images/66f43273d98cd252b2dfe5e59f119233.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WpEO7a8rcE0sOtd4U0xiUQ.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">区域政策在起作用</figcaption></figure><p id="ae14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于我们为资源组分配的策略，此部署被阻止部署。</p><p id="6898" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于第二个测试，尝试在hr的资源组rg-hr-dev中创建一个虚拟机，并尝试将其部署到销售的VNet中。这个应该是屏蔽的。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lq"><img src="../Images/66c030ddd7709d504debeb88822ffb55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eq67XkUW2LdIrYyYiAnwAw.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">人力资源部门的虚拟机试图部署到销售虚拟网络中</figcaption></figure><p id="e20f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该策略禁止在销售虚拟网络上部署虚拟机。这样，我们就有了基本的网络不可协商的要求。下一篇博客将关注数据湖中第三个不可协商的需求监控和审计设置。对于IAM级别的控件，我们将在以后的博客中讨论。</p><p id="7960" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个zure蓝图是我的建议，使用公司特定的防护栏来实现azure环境的可扩展部署，我们将在后面详细介绍。这是大规模部署企业平台(IAM/RBAC、企业就绪资源和公司政策)的首选方式。我们还将在以后的博客中介绍如何使用<a class="ae jd" href="https://azure.microsoft.com/en-us/services/devops/" rel="noopener ugc nofollow" target="_blank"> Azure Devops </a>来实现这些自动化。</p></div></div>    
</body>
</html>