<html>
<head>
<title>STP/HSS traffic pattern with ARIMA and FB Prophet models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">采用ARIMA和FB Prophet模型的STP/HSS流量模式</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/stp-hss-traffic-pattern-with-arima-and-fb-prophet-models-3ec43820c6a3?source=collection_archive---------25-----------------------#2020-01-19">https://medium.com/analytics-vidhya/stp-hss-traffic-pattern-with-arima-and-fb-prophet-models-3ec43820c6a3?source=collection_archive---------25-----------------------#2020-01-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8de3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与示例KPI数据的简单比较</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/32060968c67b04a71d5da76b3123a6dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5UqjroR4H0ObMFuQG_5JZQ.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图片由https://pix abay . com/photos/call-sim-card-cell-cell-71168/</figcaption></figure><p id="5277" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">蜂窝电信网络，从大的方面来说，可以分为终端、传输和控制。当我们与他人(语音或数据)交流时，蜂窝等终端使我们能够移动。当我们从一个地方移动到另一个地方时，传输是允许连续连接介质，例如移动电话编码/解码的空中电波、电信塔上的天线、连接到数据中心控制设备的光纤和电缆，用于处理语音和数据服务。</p><p id="77bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通常，移动网络具有一组用于识别它们用户的控制单元，称为归属位置寄存器(<strong class="ih hj">HLR</strong>)/归属用户服务器(<strong class="ih hj"> HSS </strong>)，除此之外，它们还允许通过询问和计算先前记录在SIM卡上存储的向量来自用户的认证和授权。</p><p id="64f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">HLR/HSS是通过诸如<a class="ae jt" href="https://en.wikipedia.org/wiki/SIGTRAN" rel="noopener ugc nofollow" target="_blank"> SIGTRAN </a>或<a class="ae jt" href="https://en.wikipedia.org/wiki/Diameter_(protocol)" rel="noopener ugc nofollow" target="_blank"> Diameter </a>之类的信令协议进行通信的主动元件。不管使用的协议和请求或应答的消息类型(认证、授权、定位或取消更新、提供用户位置、路由信息、插入用户数据等)，信令链路都必须被监控，它可以识别服务上的问题并测量性能或扩展容量。</p><p id="1229" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这第一篇文章中，我使用了一个关键性能指标(<strong class="ih hj"> KPI </strong>)的微妙变化的时间序列数据，这些数据来自核心网络单元接收和发送的消息，用于比较ARIMA模型和FB Prophet的结果。</p><p id="f4f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据开始于2019–11–09 00:00:00，结束于2019–12–08 23:55:00，每个样本5分钟，共8640行，数据集可在<a class="ae jt" href="https://github.com/dhernandezgt/ARIMA-FB_Prophet" rel="noopener ugc nofollow" target="_blank"> github </a>上查看</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ju"><img src="../Images/1b930d8b0622805922f0350e122a2812.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6YOvXuCCzxIxka140l1i3A.png"/></div></div></figure><p id="8b2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图部署了来自网络元素的传入和传出流量，无需深入细节，我们可以看到，在观察期间，流量是不平衡的，到期末几乎达到相同的值。该分析将平均每小时对数据进行重新采样，以比较模型</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jv"><img src="../Images/d030b0957075de9885d81dc01e21b837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w6z2Qm5NUzBKDqXV_Y-GXQ.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jw"><img src="../Images/cd45ccd78088b924e6e269c893dc5d9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pcVr_b4qpH_uOyeT29tUeQ.png"/></div></div></figure><p id="0e51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据将分为训练(80% — 2019.11.09至2019.12.02)和测试(20% — 2019.12.03至2019.12.08)样本。每个模型将返回一个预测，该预测将通过均方误差(MSE)相互比较</p><h1 id="4406" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">ARIMA分析</h1><p id="5fed" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">用于预测的第一个模型是<a class="ae jt" href="https://en.wikipedia.org/wiki/Autoregressive_integrated_moving_average" rel="noopener ugc nofollow" target="_blank"> ARIMA </a>，它代表<strong class="ih hj">自回归综合移动平均</strong>。它的特点是</p><ol class=""><li id="764b" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lf lg lh li bi translated">将当前值与先前值(AR)相关联，</li><li id="228f" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">非平稳(一)；和</li><li id="a3ab" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">移动平均的回归误差(MA)。</li></ol><p id="973d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jt" href="https://en.wikipedia.org/wiki/Autoregressive_integrated_moving_average" rel="noopener ugc nofollow" target="_blank"> ARIMA </a>模型需要三个参数(p，d，q)来分别评价上述三个特征。对于“<em class="lo"> p </em>”、对于“<em class="lo">d”</em>的增强Dickey-Fuller检验以及对于“<em class="lo">q”</em>的PACF图(部分自相关)，可以图形化地获得参数值。然而，很难用图形来识别校正值。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/adef6c6cbaf0d881a04c3a714db950e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tNG6ZxxGa8Nqkkjbot6PcA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">ACF(自相关)和PACF(部分自相关)</figcaption></figure><p id="aa06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据集的第一步是以Nicholas Jhana在<a class="ae jt" href="https://www.kaggle.com/nicholasjhana/univariate-time-series-forecasting-with-keras#Transform-Data:-Hour-by-Hour" rel="noopener ugc nofollow" target="_blank"> Kaggle比赛</a>中的方式每小时进行转换，以便将ARIMA模型应用于每小时的训练样本，新数据框架的一部分可以在这里看到</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lq"><img src="../Images/10aa4029d08fe2be36e98d28eea6dc2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WlayBidd4eeiHm9saOhDmg.png"/></div></div></figure><p id="63eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了应用ARIMA模型，必须确定<em class="lo"> (p，d，q) </em>参数，我依赖了<a class="ae jt" href="http://Can We Predict the Day Ahead Electricity Market?" rel="noopener ugc nofollow" target="_blank"> Hamza Hamud </a>的伟大预测帖子，我遵循了上面解释的最小化AIC ( <em class="lo"> Akaike信息标准</em>)值，这些值在改变<em class="lo"> p，d和q </em>参数时比较预测模型，而不是使用ACF/PACF和通过使用以下函数的增强Dickey-Fuller检验。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lr"><img src="../Images/37d523565a51ffb7cc5d21143fda6180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H7dV73qQBK6txAtA2jWhtQ.png"/></div></div></figure><p id="7ef4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">AIC迭代函数在传递逐小时序列和返回顺序(p，d，q)以及结果表中的AIC时计算AIC。</p><p id="6c85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">itertools的“方法”产品在每个<em class="lo"> (p，d，q) </em>参数中提供了从0到6的迭代，但是函数在评估“<em class="lo">模型= ARIMA(history，order = param)”</em>指令时返回错误，原因是最小AIC值返回NaN的“d”参数。</p><p id="9729" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“d”参数发现大于0与AIC最小化逐小时表明数据集不是固定的。“d”参数每小时有不同的顺序(d=1、2等)。应该通过应用微分或自然对数将数据集转换成平稳。在它之后d = 0；p和q参数，每一个都从0到6迭代。</p><p id="eadc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我选择使用数据集中的自然对数进行转换，这样AIC迭代函数返回具有(p，0，q)参数的表，从每个小时我们取前五个AIC最小值用于重新评估<em class="lo">模型= ARIMA(历史，顺序=参数)</em>并逐小时循环</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/d858e6b8afc310230d9a86532bccb26f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_MxjVeJ_fNL93gIvaNDeZQ.png"/></div></div></figure><p id="45cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前5个AIC最小值用于重新评估预测2函数中的ARIMA。当模型拟合时，一阶组合找到了几个小时序列的最小AIC返回误差，然后我使用第二个，如果它返回误差，那么第三个。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lt"><img src="../Images/e8ec5f91eb2bbb71792c83418301b8e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FVp8CyQkZ_K46uc-JjhP9A.png"/></div></div></figure><p id="c232" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用predic2函数获得dataframe预测后，默认情况下，其列包括95%的预测和置信区间。因为ARIMA模型中的预测是用自然对数获得的，所以我们通过对预测数据集应用指数来将其转换回原始值，以便进一步分析。</p><p id="ffc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图以黑点显示收到的消息的预测结果和测试数据集的预测，紫色区域为置信区间。均方差(MSE)是62167953964</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jw"><img src="../Images/c113e27a6807672ea068f3a3d4424d4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m4o34v9YpyBrj6akbg9DqQ.png"/></div></div></figure><h1 id="0be8" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">FB先知分析</h1><p id="3478" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated"><a class="ae jt" href="https://facebook.github.io/prophet/" rel="noopener ugc nofollow" target="_blank"> FB Prophet </a>分析简单明了，数据转换更少。它可用于预测遵循<em class="lo"> sklearn </em>模型时间序列中的未来值。它评估季节性，并可以定制假日以改进分析。它需要两列:</p><ol class=""><li id="44da" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lf lg lh li bi translated">熊猫格式的“ds”表示日期，YYYY-MM-DD表示时间戳</li><li id="1657" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">“y”数值，它是用于预测的序列。</li></ol><p id="52ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的数据集的情况下，可以在5分钟内直接引入原始数据，可以按小时获得预测，但是为了继续分析，数据集按小时重新采样。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lu"><img src="../Images/a47c4a9c8743e9a2572abdc60c2b6175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*61iNehI8dEh-rNK5FtncQA.png"/></div></div></figure><p id="bc83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它可以使用<em class="lo"> Prophet() </em>实例化模型，并在默认情况下以80%的置信区间拟合数据集后立即进行，但是继续使用参数<em class="lo"> interval_width </em>将比较置信区间设置为95%。在<em class="lo"> make_future_dataframe </em>方法的帮助下，创建未来时段的数据框，以适应小时时段的预测。用<em class="lo">预测</em>方法计算预测并固定在未来数据帧中。</p><p id="b1eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预测结果数据集从原始数据加上预测开始。为了更好地展示，它提出了预测尾部转置。“yhat”是预测值，“yhat_lower”和“yhat_upper”是95%的置信区间。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lv"><img src="../Images/2b33d28b988d4ec01f60a82c35f344c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_V8Yj4TEhskOF5YTEPFSDg.png"/></div></div></figure><p id="a5ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">FB Prophet还包括绘制原始数据和结果的方法。黑点是原始数据，蓝线是预测，浅蓝色是置信区间。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/c193b94da20df1941887275e13e4c8ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7eQOWCd8nn-BFCILofyi0A.png"/></div></div></figure><p id="60ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">分析周期为原始数据集的20%的测试样本(2019.12.03至2019.12.08)。我们可以看到，预测拟合得更好，且许多观测值在置信区间内，这降低了均方误差(MSE)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lx"><img src="../Images/f8be26ac2a7fd12a648665a8c774e236.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nCP7UC3ie8zr3JFCG0D7SA.png"/></div></div></figure><p id="4e0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了公平比较这两种方法，FB Prophet将通过自然对数转换数据集进行拟合，并通过指数对数将预测结果返回到原始规模。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/d2df2578c7600426227ea5dfdfab6038.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2gQSmBXddXOU6Wm7tm2SlQ.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lz"><img src="../Images/ab09e7489fede2eef4bdee8d4f3404d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WLAEW6nl6c75NCe9UwDOWg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ma"><img src="../Images/05555c51c8011772eb42515c9a92e3af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ri_K07b4XFEoZs9ptTvEOA.png"/></div></div></figure><p id="c0c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下图中可以观察到分析周期，我们可以看到黑点比最小化MSE的预测蓝线更近。除了FB Prophet之外，它还可以进一步优化，如<a class="ae jt" href="https://github.com/vavlopes" rel="noopener ugc nofollow" target="_blank"> Vinicius Lopes </a>在github.com举行的<a class="ae jt" href="https://github.com/facebook/prophet/issues/549" rel="noopener ugc nofollow" target="_blank"> FB Prophet第549期上所述，通过随机化超参数，如growth、changepoint_prior_scale、changepoint_range、seasonality _ prior _ scale和holidays_prior_scale，这是另一篇文章的主题</a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ma"><img src="../Images/6f39f45da938b34e848dee18fafadb58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gpjnv-kEMpH9DarmDlFQyw.png"/></div></div></figure><p id="0c29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">原始数据的均方误差(MSE)结果为285087967，自然对数MSE为219517629。</p><p id="1493" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一些最后的想法:</p><ol class=""><li id="872a" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lf lg lh li bi translated">FB Prophet使用通过自然对数转换的数据集为这一小部分数据样本获得了最佳结果。</li><li id="4c69" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">FB Prophet与ARIMA或任何基于它的时间序列模型相比，是一个简单的应用模型。</li><li id="5316" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">FB Prophet可以优化并包含为改进预测而定制的假日日期，这是ARIMA模型所不具备的。</li></ol></div></div>    
</body>
</html>