<html>
<head>
<title>Journey of Apache Kafka &amp; Zookeeper Administrator ( Part 12 )</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">阿帕奇·卡夫卡与动物园管理员之旅(12)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/journey-of-apache-kafka-zookeeper-administrator-part-12-45233a46b83a?source=collection_archive---------20-----------------------#2020-09-04">https://medium.com/analytics-vidhya/journey-of-apache-kafka-zookeeper-administrator-part-12-45233a46b83a?source=collection_archive---------20-----------------------#2020-09-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="67f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2020 年 6 月(Oracle 云上的 Terraform Magic)</p><p id="b898" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我在上一篇关于 AWS 上的 Terraform 的文章中解释的那样。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/016c7b72aea127926b002db2f833babc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ovujWeR1HM2pHSTAWFIdg.png"/></div></div></figure><p id="be38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi jq translated"><span class="l jr js jt bm ju jv jw jx jy di"> T </span>今天，我将使用 Terraform 解释 Oracle 云设置。<br/>这将是非常类似的 AWS 设置只是名称术语的变化夫妇。</p><p id="b168" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">测试代码:</strong><a class="ae jd" href="https://github.com/116davinder/kafka-cluster-ansible/tree/master/terraform/oci" rel="noopener ugc nofollow" target="_blank">116 dav inder/Kafka-cluster-ansi ble/terraform/OCI</a></p><p id="4694" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Terraform </strong>需要很多东西才能开始 aka <a class="ae jd" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/terraform/oci/var.tf" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> var.tf </strong> </a></p><ul class=""><li id="8f53" class="jz ka hi ih b ii ij im in iq kb iu kc iy kd jc ke kf kg kh bi translated"><strong class="ih hj">根租户 ID</strong>:ocid 1 . tenancy . xxxxxxxxxxxxxxxxxxxxxxx zwtxryat 3 zbha</li><li id="23dd" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc ke kf kg kh bi translated"><strong class="ih hj">用户 ID:</strong>ocid 1 . User . xxxxxxxxxxxxxxxxxxxxxxxxxxxx XV 5 shh ccn 7 uglfoxpsa</li><li id="5b28" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc ke kf kg kh bi translated"><strong class="ih hj">隔离舱 ID:</strong>ocid 1 . Compartment . xxxxxxxxxxxxxxxxxxx NW 3 yxaackla</li><li id="5800" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc ke kf kg kh bi translated"><strong class="ih hj">用户 ID 指纹:</strong>F7:16:FD:xxxxxxxxxxxxxxxxxxxxxxxxxxx:ab:D4:ee:9a</li><li id="5db1" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc ke kf kg kh bi translated"><strong class="ih hj">用户私有 PEM 文件:</strong>/home/davenderpal/。oci/oci_api_key.pem</li><li id="aa4e" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc ke kf kg kh bi translated"><strong class="ih hj">用户地区:</strong>欧盟-法兰克福-1</li><li id="c760" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc ke kf kg kh bi translated"><strong class="ih hj">甲骨文 Linux ID *:</strong>ocid 1 . image . oc1 . eu-Frankfurt-1 . xxxxmmawia 2 womz 5 q</li><li id="f5e7" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc ke kf kg kh bi translated"><strong class="ih hj">虚拟云网络 ID</strong>:ocid 1 . vcn . oc1 . eu-Frankfurt-1 . xxxxxx75 cua</li><li id="9e69" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc ke kf kg kh bi translated"><strong class="ih hj">子网 ID *</strong>:ocid 1 . Subnet . oc1 . eu-Frankfurt-1 . xxxxxxxxxxxxapzt 3 vzuc 2 q</li><li id="8db1" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc ke kf kg kh bi translated"><strong class="ih hj">实例 ID: </strong>虚拟机。标准 2.2</li><li id="79e7" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc ke kf kg kh bi translated"><strong class="ih hj">AZ ID *:</strong>ExfZ:EU-法兰克福 1-AD-1</li><li id="1bc7" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc ke kf kg kh bi translated"><strong class="ih hj">安全列表 ID *:</strong>ocid 1 . Security List . oc1 . eu-Frankfurt-1 . xxxxxxxx 33 giwiva</li><li id="2622" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc ke kf kg kh bi translated"><strong class="ih hj"> SSH 公钥:</strong>SSH-RSA xxxxxxxxxxxxxxxxxxxxx RSA-Key 2047 @ da vinder _ Pal</li></ul><p id="e2c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注*: <br/> </strong> 1。<strong class="ih hj"> </strong>星号(*)变量可以自动化但我没来得及这么做。<br/> 2。当前设置与 HA 不兼容，因为使用了单个 AZ。<br/> 3。我已经为每个变量添加了关于如何/从哪里在 Oracle Cloud 中收集它们的描述，因此请仔细阅读<a class="ae jd" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/terraform/oci/var.tf" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">var . TF</strong></a><strong class="ih hj"/>位。</p><blockquote class="kn"><p id="28f0" class="ko kp hi bd kq kr ks kt ku kv kw jc dx translated">开始行动吧！</p></blockquote><p id="89a1" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">我们需要<strong class="ih hj"> EBS </strong>又名<strong class="ih hj">块存储</strong>在<strong class="ih hj"> Oracle Cloud </strong>中。</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="35b1" class="lh li hi ld b fi lj lk l ll lm">resource "oci_core_volume" "kafka-volume" {<br/>    count = var.kafka_instance_count<br/>    availability_domain = var.instance_availability_domain<br/>    compartment_id = var.compartment_ocid<br/>    display_name = "kafka-volume-${count.index + 1}"<br/>    size_in_gbs = var.kafka_block_volume_size_gb<br/>}</span></pre><p id="eedb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要创建实例。</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="574d" class="lh li hi ld b fi lj lk l ll lm">resource "oci_core_instance" "kafka" {<br/>    count = var.kafka_instance_count<br/>    availability_domain = var.instance_availability_domain<br/>    compartment_id = var.compartment_ocid<br/>    shape = var.instance_shape</span><span id="c48a" class="lh li hi ld b fi ln lk l ll lm">agent_config {<br/>        is_monitoring_disabled = false<br/>    }<br/>    create_vnic_details {<br/>        subnet_id = var.subnet_ocid<br/>        assign_public_ip = var.use_public_ip<br/>    }<br/>    metadata = {<br/>        ssh_authorized_keys = var.ssh_public_key<br/>    }<br/>    display_name = "kafka-${count.index + 1}"<br/>    source_details {<br/>        source_id = var.instance_image_ocid<br/>        source_type = "image"<br/>    }<br/>    preserve_boot_volume = false<br/>}</span></pre><p id="da9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们需要将块存储与实例关联起来。(使用<strong class="ih hj"> iSCSI </strong></p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="527d" class="lh li hi ld b fi lj lk l ll lm">resource "oci_core_volume_attachment" "kafka_volume_attachment" {<br/>    count = var.kafka_instance_count<br/>    attachment_type = "iscsi"<br/>    instance_id = element(oci_core_instance.kafka.*.id, count.index)<br/>    volume_id = element(oci_core_volume.kafka-volume.*.id, count.index)</span><span id="ba34" class="lh li hi ld b fi ln lk l ll lm">display_name = "kafka-volume-attachment-${count.index + 1}"<br/>    is_pv_encryption_in_transit_enabled = false<br/>    is_read_only = false<br/>    use_chap = false<br/>}</span></pre><p id="2816" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">最后，如何从 Linux 连接到卷？</strong></p><p id="f1c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">附加卷后，您可以配置 iSCSI 连接。使用<code class="du lo lp lq ld b">iscsiadm</code>命令行工具连接到卷。控制台提供了配置、验证和登录所需的命令，因此您可以轻松地将它们复制并粘贴到实例会话窗口中。配置连接后，您可以在实例上挂载卷，并像使用物理硬盘驱动器一样使用它。</p><p id="145b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">若要连接到您的宗卷:</p><ol class=""><li id="1a43" class="jz ka hi ih b ii ij im in iq kb iu kc iy kd jc lr kf kg kh bi translated">按照<a class="ae jd" href="https://docs.cloud.oracle.com/en-us/iaas/Content/GSG/Tasks/testingconnection.htm#Connecting_to_Your_Instance" rel="noopener ugc nofollow" target="_blank">连接到您的实例</a>中所述，登录到您的实例。</li><li id="23f0" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc lr kf kg kh bi translated">打开导航菜单。在<strong class="ih hj">核心基础设施</strong>下，转到<strong class="ih hj">计算</strong>并点击<strong class="ih hj">实例</strong>。</li><li id="7de1" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc lr kf kg kh bi translated">单击实例名称以查看其详细信息。</li><li id="5318" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc lr kf kg kh bi translated">在<strong class="ih hj">资源</strong>部分，点击<strong class="ih hj">附加块卷</strong>。</li><li id="a892" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc lr kf kg kh bi translated">点击你刚刚连接的卷旁边的操作图标(三个点),然后点击<strong class="ih hj"> iSCSI 命令和信息</strong>。</li><li id="73a3" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc lr kf kg kh bi translated">显示<strong class="ih hj"> iSCSI 命令和信息</strong>对话框。请注意，该对话框显示了有关您的宗卷的特定标识信息(如 IP 地址和端口)以及您需要使用的 iSCSI 命令。这些命令已经准备好使用，并且每个命令中已经包含了适当的信息。</li><li id="901c" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc lr kf kg kh bi translated"><strong class="ih hj">附加命令</strong>配置 iSCSI 连接并登录到 iSCSI。将<strong class="ih hj">附加命令</strong>列表中的每个命令复制并粘贴到实例会话窗口中。</li><li id="8b46" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc lr kf kg kh bi translated">请确保分别粘贴和运行每个命令。有三个附加命令。每个命令都以<code class="du lo lp lq ld b">sudo iscsiadm</code>开头。</li><li id="e74a" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc lr kf kg kh bi translated">输入登录 iSCSI 的最后一个命令后，您就可以格式化(如果需要)和挂载卷了。要获取实例上可装载的 iSCSI 设备的列表，请运行以下命令:</li></ol><ul class=""><li id="0aba" class="jz ka hi ih b ii ij im in iq kb iu kc iy kd jc ke kf kg kh bi translated"><code class="du lo lp lq ld b">sudo fdisk -l</code></li></ul><p id="df57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您的磁盘连接成功，您将在返回的列表中看到它，如下所示:</p><ul class=""><li id="0b03" class="jz ka hi ih b ii ij im in iq kb iu kc iy kd jc ke kf kg kh bi translated"><code class="du lo lp lq ld b">Disk /dev/sdb: 50.0 GB, 50010783744 bytes, 97677312 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 4096 bytes / 1048576 bytes</code></li></ul><p id="eb99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请使用以下链接获取最新信息。</p><p id="25c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://docs.cloud.oracle.com/en-us/iaas/Content/GSG/Tasks/addingstorage.htm" rel="noopener ugc nofollow" target="_blank">https://docs.cloud.oracle.com/en-us/Tasks/addingstorage.htm</a></p><p id="127b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong> Terraform 需要相当长的时间，因为 Oracle 云的性能不可预测，有时需要 5-6 分钟，有时需要 10-15 分钟。</p></div><div class="ab cl ls lt gp lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hb hc hd he hf"><p id="3a09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，Ansible 可以用于 Kafka 软件的实际设置。你可以重温我以前的文章。</p></div><div class="ab cl ls lt gp lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hb hc hd he hf"><p id="40d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个旅程将在下一篇文章中继续(Kafka 2.6.0 和 Java 11 的变化)</p></div></div>    
</body>
</html>