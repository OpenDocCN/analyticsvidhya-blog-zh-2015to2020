<html>
<head>
<title>An Introduction to Hadoop in EMR AWS.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">EMR AWS 中的 Hadoop 介绍。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/an-introduction-to-hadoop-in-emr-aws-701c7b3c6b34?source=collection_archive---------0-----------------------#2020-08-01">https://medium.com/analytics-vidhya/an-introduction-to-hadoop-in-emr-aws-701c7b3c6b34?source=collection_archive---------0-----------------------#2020-08-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a765" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大数据是机器学习不可或缺的一部分，在这里，我们将使用 EMR 处理存储在 S3 的<em class="jd">房地美月度贷款</em>数据集。Hive 用于处理数据，并将处理后的数据存储在 S3 中，用于进一步的机器学习过程。样本数据集有近 10 亿条记录。下面是要执行的活动的图示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/5762ab25ea2e35a7960a924db02a1c07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bX4MnMUchRSwMOQeXoEVRg.jpeg"/></div></div></figure><h1 id="f747" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">内容:</strong></h1><ol class=""><li id="2d3e" class="ko kp hi ih b ii kq im kr iq ks iu kt iy ku jc kv kw kx ky bi translated">启动 EMR 集群并了解文件系统。</li><li id="fba1" class="ko kp hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">在 PC、S3、EMR 本地和 hdfs 之间传输数据。</li><li id="9323" class="ko kp hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">在 hive 中创建表，预处理并将数据加载到 Hive 表中。</li><li id="902c" class="ko kp hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">数据分析和优化。</li><li id="40b0" class="ko kp hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">克隆现有的表。</li><li id="c7ae" class="ko kp hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">复杂和字符串数据类型。</li><li id="5d3b" class="ko kp hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">使用视图。</li><li id="021d" class="ko kp hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">EMR 集群启动期间的引导。</li><li id="9ec1" class="ko kp hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">HDFS 与关系数据库之间的数据传输。</li></ol><h1 id="97fb" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">使用的工具/软件:</h1><ol class=""><li id="9e77" class="ko kp hi ih b ii kq im kr iq ks iu kt iy ku jc kv kw kx ky bi translated">存储— AWS S3。</li><li id="96b9" class="ko kp hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">处理— AWS EMR。</li><li id="cbb3" class="ko kp hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">语言— FS Shell 和 HQL。</li></ol><h2 id="d041" class="le jr hi bd js lf lg lh jw li lj lk ka iq ll lm ke iu ln lo ki iy lp lq km lr bi translated"><strong class="ak"> <em class="ls"> 1。启动 EMR 集群，了解文件系统:</em> </strong></h2><p id="4325" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">请按照<a class="ae lw" href="https://youtu.be/6gMaphVxzsU" rel="noopener ugc nofollow" target="_blank">链接</a>启动一个 EMR 集群，并使用 Git Bash(之前安装在本地 PC 上)和。pem 文件(在用户创建期间从 AWS 下载)。请启用 EMR 的端口 22 进行访问。</p><p id="266a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦 EMR 启动并连接，下面是进一步玩 EMR 的屏幕。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lx"><img src="../Images/a867b8eecf632b3e43e8caaf6cb0009b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LBv0HMaRh_cRn1W_ETI3ZQ.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">EMR CLI</figcaption></figure><p id="c77b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在 EMR 中，我们有本地和 Hadoop 文件系统。下图显示了本地和 HDFS 文件夹中的默认文件夹和新建文件夹。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mc"><img src="../Images/2408ebe278313fc81f9cf6e28b3986b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OVywNnJ7eJhS7BsgOjuSUw.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">EMR 本地</figcaption></figure><p id="bf23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上面的屏幕截图来看，EMR 本地文件夹是/home/hadoop/。我们可以看到，测试文件夹 freddie-local 是在默认文件夹/home/hadoop/中创建的。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es md"><img src="../Images/2de9ae19f5f6641afc4e062e59176a7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jR68cLcFoApI5KCeuDqWug.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">EMR HDFS</figcaption></figure><p id="572a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上面可以看出，EMR 默认的 HDFS 文件夹是/user/hadoop/，因为测试文件夹<em class="jd"> freddie-hdfs </em>是在/user/hadoop/位置创建的。默认配置单元文件夹是/user/hive/warehouse/。在 hive 中创建的所有表都将数据存储在默认文件夹/user/hive/warehouse/中，除非在表创建步骤中指定了不同的位置参数。要访问 EMR Local，请仅使用 linux cli 命令，而要访问 EMR HDFS，我们需要添加“hadoop fs”和“-”，如上所示。</p><p id="9a69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在 AWS 中，EMR 中使用“hive”命令来启动 Hive CLI，如下所示。我们也可以使用 Hue 来处理 Hive。请按照<a class="ae lw" href="https://youtu.be/-9P608eaAkA" rel="noopener ugc nofollow" target="_blank">链接</a>启动 Hue 并访问 Hive。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es me"><img src="../Images/ad0faaeb7aee82bf8045a82c84fbe8c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CXEcjjX9YuVD4_gbOzi4AA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">EMR 配置单元 CLI</figcaption></figure><p id="03be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在已经准备好使用 CLI 和 Hue 来玩 Hive 了。在这个故事中，我们将使用 Hive CLI 与 HDFS 进行交互。</p><h2 id="2f8d" class="le jr hi bd js lf lg lh jw li lj lk ka iq ll lm ke iu ln lo ki iy lp lq km lr bi translated">2.<strong class="ak"> <em class="ls">在 PC、S3、EMR 本地和 hdfs 之间传输数据:</em> </strong></h2><p id="cb9c" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">a.<em class="jd"> PC 到 EMR 本地</em> —可使用以下命令在 PC 和 EMR 本地之间传输数据。用于将本地 PC 连接到 EMR 集群。pem 文件是必需的，应在用户创建期间创建。这里我们将把一个测试文件 freddie-mac.txt 从桌面转移到 EMR 本地。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mf"><img src="../Images/195620d18ee9762197e72e5621db0ef9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tt9_tecsPdk6_Dy_sor6Cw.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">桌面到 EMR 本地</figcaption></figure><p id="2c28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b.<em class="jd"> S3 到 EMR 本地</em><strong class="ih hj"><em class="jd"/></strong>—<strong class="ih hj">“AWS S3 CP</strong>”和<strong class="ih hj">“curl”</strong>可用于在 S3 和 EMR 本地之间移动数据，如下所示。这里我们将把文件<em class="jd"> freddie-mac.txt </em>从 S3 桶<em class="jd"> freddie-mac-hgsh </em>转移到 EMR 本地文件夹<em class="jd">即/home/hadoop/。</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mg"><img src="../Images/2372a95a19726384a35aead65c395c75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*69E8ZgkS4ZdDm0wi8yvz5A.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">S3 到 EMR 本地— 1</figcaption></figure><p id="9129" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还可以使用“<strong class="ih hj"> hadoop fs -get </strong>”来拉取和“<strong class="ih hj"> hadoop fs -put </strong>”来推送<strong class="ih hj"> S3 和 EMR local </strong>之间的数据，如下所示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lx"><img src="../Images/ba4ec22337328621fcb3b4765dbd1af6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f00hR2YJ0NdLEUH6jfoVTA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">S3 到 EMR 本地— 2</figcaption></figure><p id="3b2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd"> Curl </em>也可用于从 S3 下载数据到 EMR 本地，如下所示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/c6cfb0657cc942fae6487f939b5118f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kuX8Jg9WOiKLdjcH2wSNLA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">S3 到 EMR 本地— 3</figcaption></figure><p id="7138" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">c.<em class="jd">EMR Local to HDFS—</em><strong class="ih hj"/><strong class="ih hj">Hadoop fs-put</strong>和<strong class="ih hj"> hadoop fs -get </strong>可用于在 EMR Local 和 hdfs <strong class="ih hj"> </strong>之间移动数据，如下图所示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mc"><img src="../Images/cef82934fbba0b24c64aef2bdf508bea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uaI_cMq8dkeRQ4TfPaaNSQ.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">hdfs 本地的 EMR。</figcaption></figure><p id="8ce2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">d.<em class="jd"> S3 到 EMR Hdfs—</em>“<strong class="ih hj">Hadoop fs-CP</strong>”可用于在 S3 和 EMR Hdfs 之间移动数据，如下所示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/e9ded7b1cef604cc201d8ec6ed14b1a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ua2NXx8j2siS8t1YRdoAqw.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">EMR hdfs 到 S3。</figcaption></figure><p id="7ce0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">e.<em class="jd">浏览 S3 和 Hdfs 中的文件—</em><strong class="ih hj">【Hadoop fs-cat】</strong>可用于浏览 S3 和 EMR Hdfs 中的数据，如下。这里<em class="jd">头</em>连同<em class="jd"> "|" </em>字符用来限制行数。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/0cbd3cc64f5cf1df06e693de7d5897e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*37nT2xMpowGa4Et58aCKuA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">浏览 S3 数据。</figcaption></figure><p id="2164" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据从 EMR 本地复制到 hdfs 并浏览，如下所示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/a13a0a239a23802c2b17afb9a218940b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a15ItZXVCRguriArfr8I2A.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">浏览 Hdfs 数据。</figcaption></figure><h2 id="017a" class="le jr hi bd js lf lg lh jw li lj lk ka iq ll lm ke iu ln lo ki iy lp lq km lr bi translated">3.<strong class="ak"> <em class="ls">在 hive 中创建表格，预处理并加载数据到 Hive 表格:</em> </strong></h2><p id="141f" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">在 hive 中，我们可以创建外部和内部表。对于外部表，删除表时不会删除数据。它唯一被删除的模式。对于内部表，删除表时，数据和模式都会被删除。</p><p id="3e56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在配置单元中创建表时，/user/hive/warehouse/是存储表数据的默认位置。但是在创建表时，我们也可以为存储或引用的表数据指定不同的位置。数据位置可以是 EMR HDFS/用户/*或 S3 中的任何文件夹。</p><p id="3b41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在目前的项目中，我们在 S3 存储了拼花地板格式的原始数据。我们需要在 S3 处理和存储最终数据，用于进一步的机器学习过程。因此，我们不需要将表数据存储到 hdfs 中，即使在我们终止 EMR 集群之后，我们的数据也应该保留。因此将创建一个外部表，并将位置用作 S3 存储桶。</p><p id="ae36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用房地美<a class="ae lw" href="http://www.freddiemac.com/fmac-resources/research/pdf/user_guide.pdf" rel="noopener ugc nofollow" target="_blank">参考文档</a>(月度性能数据文件)创建相应的模式。收集了原始数据文件并存储在 S3。最后三个字段<em class="jd">步骤修改标志</em>、<em class="jd">延期付款修改</em>和<em class="jd">估计贷款价值(ELTV) </em>从原始输入文件中排除。</p><p id="d5da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请参考以下使用存储在 S3 的原始数据创建外部表格的屏幕截图。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es md"><img src="../Images/10754b49d0b3e78c79eabd1a9b94083e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8C7Cw6duzdHv3TStAhIfZw.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">S3 实木复合地板文件的大小。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mc"><img src="../Images/4d3e7074a191d8329832841eb5c5c85b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nipm4mRE-h57sHewNOGjig.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">创建新数据库之前清空配置单元仓库文件夹。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mi"><img src="../Images/4758c15dd7aa5ae4269c92447c7d80b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tvhDsTWdy_xhaK-STkenqA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">创建数据库弗雷迪。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lx"><img src="../Images/e7a9168f7a6db8a031992513dc075a3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B2f1Az6-40aCdGZqvxJpZg.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">数据库创建后的配置单元仓库文件夹。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mj"><img src="../Images/21c04278f0797d2f400a991dea1ebcf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*32iC5or_c6jlyZYC8BJq0w.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">用原始数据创建表格。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lx"><img src="../Images/1107ee15c7f1f6e0bc9c7f760cd2d5be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wwnAOsMz4tuOHHd71yVW2g.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">原始文件记录计数。</figcaption></figure><p id="b569" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请参考以下创建外部表的屏幕截图，以在 S3 中存储已处理的数据并将数据加载到表中。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mi"><img src="../Images/65364c1ed499486bf35ad621c8dbd38d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*muEvn68Xf4jM2jF94b76hA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">创建已处理表以存储 S3 的已处理数据。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lx"><img src="../Images/647280ea15cddd34b75f1678620f5058.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AnX8NSQ7zCkeKQDFpsCBVA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">将数据加载到已处理的表中。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mk"><img src="../Images/8cb9c0670063f6c70f990f96cb7a0c71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZvZLC_ytVyztLwR2aDpkbQ.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">已处理的文件记录计数。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/d5f1718beeed3fa63f60ecc15cf290f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*025VIn-rfRnOAZhq4xNKgQ.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">原始和处理过的文件。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/56dee7f77c2e6fc9f8a11140f7ea972e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2RYedCRhQpaBKMm6ZaMtVg.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">启用标题并查看已处理的文件。</figcaption></figure><p id="807e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为表位置是作为 S3 存储桶之一提供的，所以 o/p 被写入 S3 存储桶，而不是默认位置/用户/配置单元/仓库/</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ml"><img src="../Images/1386d8b811e79764d69244a0da9e82cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*89c9OqT1ZkO7oKd0touJ0w.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">在 o/p S3 时段中创建的已处理数据。</figcaption></figure><p id="f95d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成上述处理后，将终止 EMR 集群，并在稍后启动新的集群进行进一步分析和处理。</p><h2 id="8712" class="le jr hi bd js lf lg lh jw li lj lk ka iq ll lm ke iu ln lo ki iy lp lq km lr bi translated">4.<strong class="ak"> <em class="ls">数据分析与优化:</em> </strong></h2><p id="0bcc" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">如前所述，启动了一个新的 EMR 集群。使用了两个独立的 GIT bash CLI，一个连接 hadoop，另一个连接 hive。一旦连接到 hive，将使用之前在 S3 创建的已处理数据创建一个新的数据库和一个表。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mm"><img src="../Images/4c6d9bc316ac3b87e60a7f9948b73730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GsU5xFiSk10AjEiizc4Eug.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">新集群启动。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mn"><img src="../Images/350d839719bb3ba82c4f718232dca917.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gj1nYP8PwhLfWxg4RoPiWw.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">使用已处理的 S3 数据创建新的数据库和表。</figcaption></figure><p id="112c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a.Data is 有 2000 年到 2017 年的记录，如下图。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/220d5ddab56bdc98367e2fc39cd703b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aQN_8x0IP-hYfBCwMVeMxg.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">我们数据中不同年份的数量。</figcaption></figure><p id="52f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b.选择 2007 年贷款 ID F107Q1287729 的所有月度绩效数据。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/74d85fd84400914d3a2670de58e8f32a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SN3tpJRxaVdj2TnsE05zlg.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">2007 年贷款 F107Q1287729 的月度执行数据。</figcaption></figure><p id="9107" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">c.对于上述所有查询，数据都是从 S3 获取的，因为指定的表数据位置是 S3 存储桶。除了使用 S3，我们还可以通过创建如下所示的另一个表来将数据移动到 hive 中，以便进一步处理。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/749a3bbf8f40cea6403ccb2144dca434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qz0Ss3Jqq5iCmKxwbeyNPg.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">使用默认位置在 hdfs 中创建新表。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/ea71c2a93cc7a1d34e54a3cbd478b43f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-OZX9o45C6jw3XmnngNZSA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">描述格式化— pg1</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/347af3cfe2c31ad78f311591732e7806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vUq_mvQvOH1kTjpkvJW28A.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">描述格式化— pg2</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mn"><img src="../Images/1935726d3cc8ffc2ea39f2bc68921164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S3uI40o74fkXkHsKTnDSvw.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">在默认配置单元数据位置创建了名为 loan_monthly 的新文件夹。</figcaption></figure><p id="a181" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">d.查找 2010 年 9 月<em class="jd">当前贷款拖欠状态= 0 </em>(拖欠少于 30 天)的贷款 id 计数。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mc"><img src="../Images/9828f08a62521df41e48c3e2c58f2cad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZqTY9KbHu05I-PLAq7xSzQ.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">在特定年份特定条件下计数不同。</figcaption></figure><p id="fa54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">e.优化配置单元查询的一种方法是创建分区表。表分区是根据对表执行的常见查询类型创建的。如果不小心做到这一点，代价可能会更大。这里我们假设我们的数据主要是基于日期或年份进行查询的。因此创建了一个用于优化的分区表。这是动态分区，因为分区是根据每行的特定数据字段创建的。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mo"><img src="../Images/3bf5ff43c42e62103df21eb985c6a8d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xj-ID8QVzJWZ0psxhFB6vg.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">创建分区表之前的默认配置单元仓库文件夹。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mo"><img src="../Images/8c98c08f85eee218eb8f87c31c2e3882.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aS_ihuH56y-lgc_GdrbECg.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">创建按年份分区的分区表。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mc"><img src="../Images/42120d82e01c6aa82bcc411d30804a19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x8d3il5ZuD2m5W3kYJ6DbQ.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">创建表后的配置单元仓库。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/8bc8f3f8fc3139d0a37f48dbce381ce4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bbguaq5epKEIk8i6dPk5QA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">当我们使用 describe 时，分区列 period_year 显示为一列。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mi"><img src="../Images/a350f15d0009dc81384c7fcc3dc7bd29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IjS_uqMS1BZahzyn8a4O4Q.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">加载查询停滞，主要是由于内存错误。</figcaption></figure><p id="93d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">访问 YARN 后，发现好像没有分配给作业的容器。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mp"><img src="../Images/c2b9f9425279033c00dedf90caba07b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jG1X3FMkbIF92Qby-5QZvQ.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">纱线应用错误。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mn"><img src="../Images/1322ad634379bdd7c69cc2d7fbc65ea5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IMKgiXcfW0pz5d38sQDcJA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">HDFS 记忆报告 pg-1</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/bc9fd98f07c5efea7cf1474fbd3ff203.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mddlt_GCyMi3HTUQpiQN-A.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">HDFS 记忆报告 pg-2</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mq"><img src="../Images/e8152a2a2abd5bf6226539811ecb2b31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*prEo1vYyRPb2TtPNB1hnaA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">S3 的实际文件大小与 HDFS 的文件大小</figcaption></figure><p id="6af4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于我的 EMR 集群内存有限，删除了表 loan_monthly 并创建了一个新的外部表 loan_monthly，数据位置为 S3 存储桶。使用外部表将数据加载到分区表 loan_by_yearly 中。与<a class="ae lw" href="https://youtu.be/Pe6T3uheXYA" rel="noopener ugc nofollow" target="_blank">链接</a>一起，下面是在加载数据时描绘纱线和集群节点的一些屏幕打印。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/27eed0e17affe29a66ac74dc5beba9c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SwkHhbdhUL9zwuUjRLw3dw.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">新创建的外部表 loan_monthly。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/e8bb5c02da7ab3511116449e41156559.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JVyedi-lYNtmsYXl8LX1Og.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">将数据加载到分区表中。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mr"><img src="../Images/ae790364170c000f20a77cc27fac68b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3fl1ofO3TImXeVH3ebgVJA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">总共分配了 8 个集装箱。7 个用于任务，1 个用于切换。</figcaption></figure><p id="99d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为我们在创建 EMR 集群时只分配了两个核心节点，所以在将数据加载到分区表时只使用了其中的两个。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ms"><img src="../Images/22b586c5f22ed3ed40babbfbe33b5961.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fVUXa9UKRdpOZSCC9nUmJQ.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">将数据加载到分区表期间的 EMR 集群节点矩阵。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mc"><img src="../Images/2b29d875f5e1d85409ca41f34f23c591.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UCCpKOqezJ2FIcZuLXWG7Q.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">数据已加载到分区表中。</figcaption></figure><p id="7b01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">子文件夹是基于<em class="jd"> period_year </em>的值创建的，分区是基于该值完成的。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/20bad78e37fbaaacfa1a965a2138de01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fp-HgNA_Iswn4ZjjUWD4wQ.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">根据年份在 hive 仓库中创建的文件夹。</figcaption></figure><p id="0da7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当查看或使用表时，用于对表进行分区的参数显示为一列，但实际上并没有添加到数据文件中。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/8f4a246c7663c705a8b3d9dcdaaae3ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FNb5__khbjc8w5kFH4sFww.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">分区表中的 10 行。</figcaption></figure><p id="9cb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在执行与之前相同的查询后，只花费了 52 秒，而不是 575 秒，在这种情况下，效率提高了近 10 倍。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/1a4a30b64689da5543d8d234ab1bf513.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ReoscTq3DV_ABGNVanN6UA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">在特定年份特定条件下计数不同。</figcaption></figure><p id="b663" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据直接从 EMR hdfs 复制到 S3，供下次启动 EMR 时使用。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/cedafa87dadd80ef14ea6303a6880dcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*llgzbIh8v1viV1i0km-dnQ.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">在 EMR hdfs 和 S3 之间移动文件。</figcaption></figure><p id="aff9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">稍后，当一个新的 EMR 集群启动时，使用 S3 位置的数据创建一个新的分区表，如下所示。这被称为静态分区。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mt"><img src="../Images/bff3fb21bbf9ef4f1c082d6f4d5fba5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YldxjVNu9lb6KOjxiwwghg.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">S3 的分区数据。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/ef3c671f11de96d96f2580f1f850412f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VJyP50rHMhhzGub6Lv34tw.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">创建分区表。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/31c7e216d1fcb7b31776b9e44c7d2ab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WX878tP0UBhh2SOFFGSIIA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">将分区数据添加到表 pg-1 中。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/3f207f156c0e272ce255cb57de9e9fb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Be6t24otpduJeBjSl06mLg.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">将分区数据添加到表 pg-2。</figcaption></figure><p id="55d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">恢复的分区表中的记录总数等于已处理的表中的记录数，即 1064685806，如第 3 节所示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/22231e49441b92883e76543d891c5df9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OIPOYnjP_Kxo4ViK1wi3Aw.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">已还原分区表的记录计数。</figcaption></figure><p id="d210" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同样，从上面可以看出，已分区表和未分区表中计数所用的总时间几乎相同，因为分区是基于年份进行的，而我们的计数查询不是特定于年份的。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/850888cc35ff5d5c9e2330a1d4a2b8ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RTTupwDLf7Hi2PKsoWub1A.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">还原的分区表中的记录很少。该表具有分区字段 period_year。</figcaption></figure><h2 id="b2fa" class="le jr hi bd js lf lg lh jw li lj lk ka iq ll lm ke iu ln lo ki iy lp lq km lr bi translated">5.<strong class="ak"> <em class="ls">克隆一个已有的表:</em> </strong></h2><p id="d0fc" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">像这样的<em class="jd">可以用来编目或克隆一个现有的表。这里只创建模式，没有数据传输。数据需要显式地装载到新克隆的表中。<em class="jd">如果不存在</em>用于避免在创建新的数据库或表格时出现错误，如果存在同名的旧数据库或表格。</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es md"><img src="../Images/5b0fa249dd6d497bc0e016dc0a1a5b04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yhCOQBIyInXOPbKckl3feA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">创建表之前的配置单元仓库。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/5afd956b1645d457348bba977b3ceb96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dbe9oRyr_cJqHJ6d067z-g.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">使用 LIKE 编目的表。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mc"><img src="../Images/87a28740d27b2a04aac4bdafd544ea62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*leCkHF09pclCLiq7XZaaWA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">在配置单元仓库中创建新的空文件夹。</figcaption></figure><h2 id="443b" class="le jr hi bd js lf lg lh jw li lj lk ka iq ll lm ke iu ln lo ki iy lp lq km lr bi translated">6.<strong class="ak"> <em class="ls">复杂和字符串数据类型:</em> </strong></h2><p id="aef2" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">Hive 支持复杂的数据类型，如数组、映射和结构。使用 Kinesis Firehose 收集的 Twitter 数据已经存储在 S3。这些数据用于演示创建表、加载和查询复杂数据。</p><p id="eb21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在 hive 中创建一个临时表来访问原始 twitter 数据。数据也可以从 S3 加载到 hive 表中，如下所示。使用<em class="jd">加载</em>命令，将数据从源位置移动(而不是复制)到目标位置。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/80a504c2a1b056304a51f328f1a826e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IR1QdgEQ7oTNRJV0H4ExMw.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">创建表并从 S3 加载数据。</figcaption></figure><p id="7f08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过处理字符串数据在临时表中创建复杂数据，如下所示。如果在同一个表中使用不同的复杂数据类型，所有这些类型都必须使用相同的终止符。这里“|”在数组、映射和结构中用作终止符。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/88c34c4fc91b80bb2a1321f2dcff9ab9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CjJ56uTyChS025Oj7TmKfw.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">将数据加载到临时表中以创建复杂数据。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/72ac67616d3873b875b3d0606c596af2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Xvv4ABj4l0YzrXlxOSDEA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">查看创建的复杂数据。</figcaption></figure><p id="745d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建具有复杂数据类型的表，并将处理后的数据复制到复杂表数据文件夹。<em class="jd">由“|”终止的集合项</em>用于表定义，因为数据是在上一步中相应创建的。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/e081329c56d734bbb2cb3546b3bf12fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YLAULlGmwGb21wYJRzaUYQ.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">创建具有复杂数据类型的表。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/8ce82c4b2e0680402c3d1787731e4d9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q7JEvTcTDsi7Ew2futgInQ.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">描述具有复杂数据类型的表。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/4b97ec4097dece71ed7e5a48e056e0b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HUh_Fz3EnL0MY4NdngLxrg.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">将创建的数据移动到复杂表数据文件夹。</figcaption></figure><p id="2491" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">复杂数据从配置单元表中访问，如下所示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/23fb62d54c0d8e11a9840c1c3f8b5282.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yJ0ofaQMI61fLcjk_9gzvA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">访问配置单元表中的复杂数据。</figcaption></figure><p id="d0c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Explode 函数也可用于仅访问数组和映射，如下所示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/96d1e859a1cccce1ee2d962cd3619ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y1G-uT6yeW6GaScnLtqBOQ.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">仅使用 explode 函数来扩展数组和映射。</figcaption></figure><p id="7eda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当与其他列一起使用分解功能时，侧视图需要如下使用。虽然<em class="jd"> la </em>和<em class="jd"> lm </em>这两个词没有在任何地方使用，但是需要用侧视来定义。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/1b52a32ccef74f688d8898a00b595ffe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z-HEVqOMxPF5VjMDT26Spw.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">仅对于阵列和映射，使用侧视图进行分解。</figcaption></figure><h2 id="e9cf" class="le jr hi bd js lf lg lh jw li lj lk ka iq ll lm ke iu ln lo ki iy lp lq km lr bi translated">7.<strong class="ak"> <em class="ls">用视图工作:</em> </strong></h2><p id="d43e" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">视图是保存的查询，可以像查询表一样进行查询。如果一个复杂的查询被反复使用，它可以被保存为一个视图以节省时间。视图在数据库中显示为表格。</p><p id="a504" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，非物化视图是在 hive 中创建的，它不保存底层查询数据。视图的操作与我们的外部查询中的操作合并到一个集合中，以便在执行之前由 hive 进行优化。但是在物化视图中，查询数据被保存到数据库中，使得查询速度更快。因此，随着底层数据的变化，非物化视图会自动更新，而物化视图需要重建。</p><p id="36e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd"> Order By </em>是一种开销很大的操作，不应在视图内部使用。如果需要，排序应该始终包含在对视图执行的操作中。</p><p id="383a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据 S3 的数据创建表<em class="jd"> dayofweek </em>。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/77a262da8eba1040c85308e8c61f2b15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kvhakDKQRbpHHtNUgtUR7g.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">为星期几创建表。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/85bfc1699e78595a52cfa1da0d323d06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fESuHnymzfZVbWwbyDIiRg.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">将数据从源加载到配置单元表中。这里 S3 被用作来源。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/4a1f71d3437c537ff00717c7a49648a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q-7iqTLBxwnK6Fd3vIiaCw.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">查看表 dayofweek 的数据。</figcaption></figure><p id="b679" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">非物化视图和物化视图是使用如下所示的已处理数据和星期数据创建的。非物化视图的视图创建时间很快，而物化视图的查询时间很快。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/04e0ca3e778c194fb0ccd7cc524de00e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m3o_RHFqzuUCaCn8XJ_xSg.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">创建和查询非物化视图。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/ca99d06a0a68b0b603e6a5dd82ddffa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mnlu_eFIlE7koD9mHgzazg.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">创建和查询物化视图。</figcaption></figure><p id="9ba0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这两个视图在数据库中都显示为表，但数据文件夹只为物化视图创建。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/c9825bc924e91e77eaa58966402ca0ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8YaCb8K-Omkhxy5_Xo-DuA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">视图在数据库中显示为表格。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/0895ecef1122166878eb8b3aa5ac53ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2HvRukk7kwqOThDH-ssOcg.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">仅为实体化视图创建数据。</figcaption></figure><p id="c21a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">视图也可以修改，如下表所示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/84c63a7576999a1531123b6cc0606710.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kFnzK3QY6kGEEJHpo_4QnQ.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">描述原始视图的格式。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/67f66409ae7049ea7e35aad80ffd1bc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_EO8KvnpHc9CoIRxTcFByA.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">更改基础视图查询。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/6a516bb1f93bee565a545dfce2be0913.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xJakcl8GRcD0s_kOsjBJ9g.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">描述已修改视图的格式。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/d46ed53c0d0d3bb03552b95f165f9580.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ATqsbs_BwbXNXggvIVArWQ.jpeg"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">删除视图。</figcaption></figure><h2 id="5cb0" class="le jr hi bd js lf lg lh jw li lj lk ka iq ll lm ke iu ln lo ki iy lp lq km lr bi translated">8.<strong class="ak"><em class="ls">EMR 集群启动时的引导:</em> </strong></h2><p id="cc1e" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">配置单元查询可以保存到 S3，并且在 EMR 集群启动期间，可以在引导操作中使用相同的脚本位置。这将执行所有相应的脚本，同时自动启动集群。</p><h2 id="5ce3" class="le jr hi bd js lf lg lh jw li lj lk ka iq ll lm ke iu ln lo ki iy lp lq km lr bi translated">9.<strong class="ak"><em class="ls">HDFS 与 RDBMS 之间的数据传输:</em> </strong></h2><p id="cc93" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">在 Linux 中执行的 sqoop 用于 HDFS 和 RDBMS 之间的数据传输，包括导入和导出。</p><p id="a042" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更多细节有待更新。你的想法会得到赞赏。</p><p id="3fc4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢你，艾比。</p></div></div>    
</body>
</html>