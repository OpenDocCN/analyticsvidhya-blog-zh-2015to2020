<html>
<head>
<title>Keras Tuner: Hyperparameter tuning made Easy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Keras调谐器:简化超参数调谐</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/keras-tuner-hyperparameter-tuning-made-easy-50cf050ac6e3?source=collection_archive---------11-----------------------#2019-12-24">https://medium.com/analytics-vidhya/keras-tuner-hyperparameter-tuning-made-easy-50cf050ac6e3?source=collection_archive---------11-----------------------#2019-12-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a673aa63c4a7b46f8681ecc37c81acfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lIQ4eazsXRybUNPC"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">由<a class="ae iu" href="https://unsplash.com/@julianhochgesang?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">朱利安·霍格桑</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="efed" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们的日常CNN和图像分类或检测任务中，为我们的网络选择正确的超参数和层成为一项繁琐的任务。为了获得更好的精度和性能，使用超参数对神经网络进行正确的优化涉及大量的手动实验和使用不同层数、不同参数等的训练。这真的很忙乱和费时。好吧，等等！有没有简单的方法？是的，Keras调谐器可以拯救你的一天。所以，不要浪费太多时间，让我们开始吧。</p><h1 id="9d71" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用Keras-Tuner</h1><p id="af10" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我们将对时尚MNIST数据集进行超参数调整。</p><p id="115d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">要求:</strong></p><ul class=""><li id="2cec" class="kw kx hi ix b iy iz jc jd jg ky jk kz jo la js lb lc ld le bi translated">Python 3.6</li><li id="8efd" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">张量流2.0</li></ul><p id="9015" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">安装:</strong></p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="58f1" class="lt ju hi lp b fi lu lv l lw lx">pip install -U keras-tuner</span></pre><p id="9147" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从源安装</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="820e" class="lt ju hi lp b fi lu lv l lw lx">git clone https://github.com/keras-team/keras-tuner.git <br/>cd keras-tuner <br/>pip install .</span></pre><p id="034f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于使用时尚MNIST数据的多类分类，我们必须加载训练和测试数据集。</p><p id="0b34" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">导入所有依赖项</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="777e" class="lt ju hi lp b fi lu lv l lw lx">from tensorflow import keras <br/>from tensorflow.keras.layers import Conv2D, MaxPooling2D, Dense, Flatten, Activation<br/>from kerastuner.tuners import RandomSearch</span></pre><p id="87e6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">装载时尚MNIST</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="a453" class="lt ju hi lp b fi lu lv l lw lx">fashion_mnist <strong class="lp hj">=</strong> keras<strong class="lp hj">.</strong>datasets<strong class="lp hj">.</strong>fashion_mnist<br/><br/>(train_images, train_labels), (test_images, test_labels) <strong class="lp hj">=</strong> fashion_mnist<strong class="lp hj">.</strong>load_data()</span></pre><p id="d793" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在0和1之间缩放图像。</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="4a2f" class="lt ju hi lp b fi lu lv l lw lx">train_images <strong class="lp hj">=</strong> train_images <strong class="lp hj">/</strong> 255.0<br/>test_images <strong class="lp hj">=</strong> test_images <strong class="lp hj">/</strong> 255.0</span></pre><p id="e31d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，重塑测试和训练数据以便更好地输入到模型中。</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="1aa6" class="lt ju hi lp b fi lu lv l lw lx">train_images <strong class="lp hj">=</strong> train_images<strong class="lp hj">.</strong>reshape(len(train_images), 28, 28, 1)<br/>test_images <strong class="lp hj">=</strong> test_images<strong class="lp hj">.</strong>reshape(len(test_images), 28, 28, 1)</span></pre><p id="ee76" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将使用随机搜索来执行超参数调整。让我们定义一个名为create_model的函数，它接受一个参数<strong class="ix hj"> hp。</strong></p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="8ccd" class="lt ju hi lp b fi lu lv l lw lx">def create_model(hp):<br/> model = keras.models.Sequential()</span><span id="daea" class="lt ju hi lp b fi ly lv l lw lx">   model.add(Conv2D(hp.int("input_units",min_value=32,max_value=256,step=32),(3,3) ,input_shape=train_images[1:]))<br/> model.add(Activation('relu'))<br/> model.add(MaxPooling2D(pool_size=(2, 2)))</span><span id="24d2" class="lt ju hi lp b fi ly lv l lw lx">for j in range(hp.Int("no_layers",1,4)):<br/>  model.add(Conv2D(32, (3, 3)))<br/>  model.add(Activation('relu'))</span><span id="abd6" class="lt ju hi lp b fi ly lv l lw lx">model.add(Flatten())</span><span id="263c" class="lt ju hi lp b fi ly lv l lw lx">model.add(Dense(10))<br/> model.add(Activation("softmax"))</span><span id="7e06" class="lt ju hi lp b fi ly lv l lw lx">model.compile(optimizer="adam",<br/>              loss="sparse_categorical_crossentropy",<br/>              metrics=["accuracy"])</span><span id="47e5" class="lt ju hi lp b fi ly lv l lw lx">return model</span></pre><p id="6627" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，我们将实例化一个调谐器。我们指定模型构建函数、要优化的目标的名称(对于内置的指标，是最小化还是最大化是自动推断的)、要测试的试验总数(<code class="du lz ma mb lp b">max_trials</code>)以及应该为每个试验构建和适合的模型数量(<code class="du lz ma mb lp b">executions_per_trial</code>)。</p><p id="ea70" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">定义一个测试目录来存储日志。</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="74ee" class="lt ju hi lp b fi lu lv l lw lx">log_dir = "logs"</span><span id="b65b" class="lt ju hi lp b fi ly lv l lw lx">tuner = RandomSearch( create_model, objective=’val_accuracy’, max_trials=5, executions_per_trial=3, directory=’log_dir’)</span></pre><p id="0599" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们开始最佳调整模型的超参数搜索。</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="ce84" class="lt ju hi lp b fi lu lv l lw lx">tuner.search(x=train_images, y=train_labels,epochs=5,batch_size=64,validation_data=(test_images, test_labels))</span></pre><p id="6292" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在运行模型，您将获得产生最佳精确度的参数。</p><p id="4817" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">希望你喜欢这本书！不断学习。</p></div></div>    
</body>
</html>