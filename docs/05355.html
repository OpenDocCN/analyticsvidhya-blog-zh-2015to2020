<html>
<head>
<title>Intermediate Docker: Storage and Volumes (1/2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">中级码头工人:存储和卷(1/2)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/intermediate-docker-storage-and-volumes-1-2-bb1d2f844054?source=collection_archive---------27-----------------------#2020-04-18">https://medium.com/analytics-vidhya/intermediate-docker-storage-and-volumes-1-2-bb1d2f844054?source=collection_archive---------27-----------------------#2020-04-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b6b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经知道，Docker运行应用程序，并使用基本的分层映像，这些映像抽象了某个系统的某些部分和其他相关的基本概念，如Docker容器、运行模式、标记和命名、端口转发等。</p><p id="0e4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们缺少一个非常重要的功能，即<strong class="ih hj">存储。</strong>我们如何管理数据来填充我们的容器？应用程序需要数据，对吗？所以，现在我要谈谈Docker存储和卷。</p><p id="ef75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们从码头仓库开始，好吗？</p><h1 id="9690" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">在Docker中存储数据</h1><p id="824f" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">假设您有一组正在运行的容器，比如一个三层应用程序、一个<strong class="ih hj">数据库</strong>、一个<strong class="ih hj">中间件</strong>和一个<strong class="ih hj">前端</strong>层，从逻辑上(也是最佳实践)所有这些都应该是独立的，因为所有应用程序都需要数据(实际上是生成或使用)。</p><p id="d9dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，你会考虑把它存放在什么地方最好？数据必须依赖容器内部还是与容器在一起？。</p><p id="c249" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">自然地，容器被设计成短暂的(一次性的)，所以，你启动它，它们做它们的工作，最后，你关闭容器。此时，所使用的数据是不可访问的，当容器关闭时，您将无法访问“会话”数据。你看到了“会话”的类比，对吗？</p><p id="4b42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了回答你的问题，Docker容器通常存储在每个主机上，它们也是隔离的，所以数据不能与其他容器共享。容器文件系统不是为高性能IO设计的。</p><p id="68ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在走向理想的解决方案之前(<strong class="ih hj"> Docker Volumes </strong>)。我将澄清事实，告诉您卷不是存储数据的唯一方式，但却是更有效的方式。</p><p id="61b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了Docker卷(将在后面解释)，我们还有两种存储非永久数据的技术。我们将<strong class="ih hj">绑定挂载</strong>到Docker容器。还有<code class="du kg kh ki kj b">tmpfs</code> <strong class="ih hj">坐骑。</strong></p><p id="9833" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据文件系统执行<strong class="ih hj">绑定挂载</strong>描述了挂载到<strong class="ih hj"> Docker卷</strong>目录的确切路径的过程，基本上，您必须匹配主机上的确切文件路径，这种替代选项在功能方面非常有限，根本不建议使用。</p><p id="0bb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，应该在命令中设置<code class="du kg kh ki kj b">type=bind</code>,而源文件不能是一个名字，应该是一个特定的文件路径或变量</p><p id="8462" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查此容器实例:</p><p id="983e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kg kh ki kj b">docker container run -d --mount type=bind,source=/app,target=/app nginx</code></p><p id="378c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一种方式是通过<code class="du kg kh ki kj b">tmpfs</code>，它将数据存储在运行容器的主机的内存空间中。基本上，在Linux主机中有大量的RAM内存用于存储数据，我需要告诉你这是错误的吗？。</p><p id="36af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从开发者的角度来看，知道什么是应用商店是一件事，而对码头工人T2来说毫无意义。<strong class="ih hj"> Docker </strong>提供了不同类型的对象存储解决方案，这可以看作是Docker一般是如何存储数据的？。</p><p id="25f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们有<strong class="ih hj">块存储</strong>，这种特殊类型用于存储永久应用程序数据，另一种是<strong class="ih hj">对象存储</strong>，它通常用于存储docker容器图像。</p><p id="fce7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">块存储</strong>用于IO密集型操作，由用户创建，基本上存储固定的数据块。<strong class="ih hj">对象存储</strong>数据与元数据和唯一标识符一起存储，没有一种有组织的方式来存储数据，可伸缩性是渐进的，可以通过HTTP API调用来访问。<a class="ae kk" href="https://rancher.com/block-object-file-storage-containers/" rel="noopener ugc nofollow" target="_blank">这个</a>讲座更好地解释了它。</p><p id="5680" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将讨论Docker层是如何存储的。</p><h1 id="5e87" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">存储的Docker层(图像透视)</h1><p id="e01b" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">我在与<strong class="ih hj">图像管理</strong>相关的其他帖子系列中解释了其中的一些概念，但是由于我们正在解释策略以及Docker通常是如何存储数据的，我认为以一种快速的方式来谈论它是很重要的。</p><p id="11bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你知道Docker镜像内部是如何工作的？你可以跳过这一节，如果没有，我简单提一下，毕竟你周围可以找到很多资料。</p><p id="30b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Docker容器使用分层存储文件系统。这是什么意思？嗯，在内部，<strong class="ih hj"> Docker Images </strong>由多个只读层组成，当图像被实例化到容器中时，顶部的可写层被创建用于用户交互，然后当它被删除时被移除。</p><p id="6d3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Docker使用<strong class="ih hj">存储驱动</strong>来管理图像层和可写容器层的内容。这个驱动程序处理实现的方式与其他驱动程序不同。</p><p id="99b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总结一下:只读文件只有在文件被修改的时候才会从较低的只读层带入可写层。</p><h2 id="8e89" class="kl je hi bd jf km kn ko jj kp kq kr jn iq ks kt jr iu ku kv jv iy kw kx jz ky bi translated">基础图像</h2><p id="b495" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">因此，当构建一个容器时，整个过程从一个<strong class="ih hj">清单文件</strong>开始，这是一个描述容器将由什么组成的文本文件，来自其他人的基础OS(层)将出现。在这个基础层之上，将会有配置和应用层，它们将组成整个功能。</p><p id="8f68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当这种混合层被实例化时，产生的层将作为一个整体放在我们面前。在此<strong class="ih hj">基础层</strong>的顶部，创建了一个可写层，提供一个临时FS来写入临时数据，因为配置更改稍后可能会变成只读文件，这些更改会被带到顶部可写层，并且可以被向下推回。</p><p id="8c73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这整个概念叫做<strong class="ih hj"> Docker Union文件系统。</strong></p><p id="30ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里有一个实用的解释:</p><p id="b837" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kg kh ki kj b">docker image ls</code>(这将列出已安装的图像)</p><p id="d3f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kg kh ki kj b">docker image inspect [image]</code>在底部，你会看到一个组成图像的图层列表。然后，该层列表可以在<code class="du kg kh ki kj b">docker history [tag]</code>命令的帮助下显示。</p><p id="156e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我现在就暂停这个。目前，我们涵盖了很多，并不太容易消化。在这个迷你系列的第二部分，我将最终谈论Docker卷、存储驱动程序如何工作以及什么是<strong class="ih hj"> Docker集群存储。</strong></p><p id="8313" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一集见。</p><p id="a15b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">快乐编码:)</p></div></div>    
</body>
</html>