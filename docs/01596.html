<html>
<head>
<title>PostgreSQL Integration with Jupyter Notebook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PostgreSQL与Jupyter笔记本的集成</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/postgresql-integration-with-jupyter-notebook-deb97579a38d?source=collection_archive---------0-----------------------#2019-11-03">https://medium.com/analytics-vidhya/postgresql-integration-with-jupyter-notebook-deb97579a38d?source=collection_archive---------0-----------------------#2019-11-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b805" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">获得更加无缝的数据提取体验。</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/c13aa872c2992d3497e4ddae5be32034.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_4ITA6ACGusmKEu7"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">由<a class="ae ju" href="https://unsplash.com/@pawel_czerwinski?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">paweczerwiński</a>在<a class="ae ju" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="bb47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Jupyter Notebook是一款很棒的软件，可以记录数据可视化和分析过程中采取的步骤。它支持Python代码、markdown、HTML，多亏了几个库，还有PostgreSQL！这允许您在笔记本中编写SQL代码并进行更改，或者从那里查询数据库。您还可以将任何查询转换成pandas数据框架，以便直接进行分析。它让我更喜欢使用SQL和Jupyter笔记本！</p><h2 id="43d2" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">先决条件:</h2><ul class=""><li id="fa0c" class="kq kr hi ih b ii ks im kt iq ku iu kv iy kw jc kx ky kz la bi translated">Jupyter笔记本</li><li id="18de" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated">PostgreSQL和一个数据库(<a class="ae ju" href="http://www.postgresqltutorial.com/postgresql-sample-database/" rel="noopener ugc nofollow" target="_blank">示例数据库&amp;如何加载</a>)</li></ul><h2 id="35fb" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">要安装的库:</h2><ul class=""><li id="6315" class="kq kr hi ih b ii ks im kt iq ku iu kv iy kw jc kx ky kz la bi translated"><a class="ae ju" href="https://github.com/catherinedevlin/ipython-sql" rel="noopener ugc nofollow" target="_blank"> ipython-sql </a></li><li id="b667" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated">sqlalchemy</li><li id="5f23" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated">python数据库API (DBAPI)库</li></ul><p id="e077" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前两个库可以使用pip install命令安装:</p><pre class="jf jg jh ji fd lg lh li lj aw lk bi"><span id="b0d2" class="jv jw hi lh b fi ll lm l ln lo">pip install ipython-sql<br/>pip install sqlalchemy</span></pre><p id="ae61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第三个库取决于您选择使用的SQL软件。对于PostgreSQL，您可以使用<a class="ae ju" href="https://pypi.org/project/psycopg2/" rel="noopener ugc nofollow" target="_blank"> psycopg2 </a>:</p><pre class="jf jg jh ji fd lg lh li lj aw lk bi"><span id="af98" class="jv jw hi lh b fi ll lm l ln lo">pip install psycopg2</span></pre><p id="342e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不同的DBAPIs都记录在sqlalchemy的网站上，比如MySQL、Oracle和SQLite(感谢Dave Campbell)。</p><h2 id="e788" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">ipython-sql</h2><p id="c70a" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">由Github 上的<a class="ae ju" href="https://github.com/catherinedevlin/ipython-sql" rel="noopener ugc nofollow" target="_blank"> catherinedevlin创建，它支持使用包含<code class="du ls lt lu lh b">%</code>和<code class="du ls lt lu lh b">%%</code>的SQL魔法函数，允许您在Jupyter Notebook中编写SQL风格的代码。</a></p><h2 id="fa9d" class="jv jw hi bd jx jy jz ka kb kc kd ke kf iq kg kh ki iu kj kk kl iy km kn ko kp bi translated">sqlalchemy</h2><p id="f1d4" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">sqlalchemy最初由Michael Bayer创作，被吹捧为Python的“SQL工具包和对象关系映射器”。出于本教程的目的，它将主要用于将SQL查询存储到pandas数据帧中。</p><p id="4f6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经安装了我们的库，让我们继续Jupyter笔记本！</p><h1 id="77d5" class="lv jw hi bd jx lw lx ly kb lz ma mb kf mc md me ki mf mg mh kl mi mj mk ko ml bi translated">入门指南</h1><p id="5229" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">要加载ipython-sql，请使用以下神奇的命令:</p><pre class="jf jg jh ji fd lg lh li lj aw lk bi"><span id="b248" class="jv jw hi lh b fi ll lm l ln lo">%load_ext sql</span></pre><p id="8108" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将只需要sqlalchemy中的<code class="du ls lt lu lh b">create_engine()</code>函数，所以让我们用下面一行来导入它:</p><pre class="jf jg jh ji fd lg lh li lj aw lk bi"><span id="0036" class="jv jw hi lh b fi ll lm l ln lo">from sqlalchemy import create_engine</span></pre><p id="17b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们奠定了基础，我们现在就可以连接到PostgreSQL数据库了！</p><h1 id="2b02" class="lv jw hi bd jx lw lx ly kb lz ma mb kf mc md me ki mf mg mh kl mi mj mk ko ml bi translated">连接到PostgreSQL数据库</h1><p id="a823" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">要将ipython-sql连接到您的数据库，请使用以下格式:</p><pre class="jf jg jh ji fd lg lh li lj aw lk bi"><span id="b3b2" class="jv jw hi lh b fi ll lm l ln lo"># Format<br/>%sql dialect+driver://username:password@host:port/database</span><span id="888d" class="jv jw hi lh b fi mm lm l ln lo"># Example format<br/>%sql postgresql://postgres:password123@localhost/dvdrental</span></pre><ul class=""><li id="d68e" class="kq kr hi ih b ii ij im in iq mn iu mo iy mp jc kx ky kz la bi translated">在这种情况下，<code class="du ls lt lu lh b">dialect+driver</code>就是<code class="du ls lt lu lh b">postgresql</code>，但是在这里可以随意使用不同的数据库软件。</li><li id="b282" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated"><code class="du ls lt lu lh b">username:password</code>是您替换用户名和密码的地方。</li><li id="3c17" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated"><code class="du ls lt lu lh b">host</code>通常只是localhost。</li><li id="2e8f" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated">在我的经验中，<code class="du ls lt lu lh b">port</code>不需要被指定。</li><li id="6995" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated"><code class="du ls lt lu lh b">database</code>是要连接的数据库的名称。</li></ul><p id="6c7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了查看它是否成功连接，Jupyter笔记本将打印以下内容:</p><pre class="jf jg jh ji fd lg lh li lj aw lk bi"><span id="e08b" class="jv jw hi lh b fi ll lm l ln lo">'Connected: username@database'</span></pre><p id="548c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了将sqlalchemy连接到数据库，格式基本相同，但是我们将使用<code class="du ls lt lu lh b">create_engine()</code>函数创建一个名为<code class="du ls lt lu lh b">engine</code>的新对象:</p><pre class="jf jg jh ji fd lg lh li lj aw lk bi"><span id="bf8b" class="jv jw hi lh b fi ll lm l ln lo"># Format<br/>engine = create_engine('dialect+driver://username:password@host:port/database')</span><span id="624d" class="jv jw hi lh b fi mm lm l ln lo"># Example format<br/>engine = create_engine('postgresql://postgres:password123@localhost/dvdrental')</span></pre><p id="a3b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在大多数情况下，当连接到ipython-sql时，您可以复制并粘贴您在<code class="du ls lt lu lh b">%sql</code> magic命令后编写的内容，并将其封装在引号中作为<code class="du ls lt lu lh b">create_engine()</code>函数中的参数。</p><p id="7aef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只要您在输出中看不到错误，您就应该连接到数据库了！</p><h1 id="2d21" class="lv jw hi bd jx lw lx ly kb lz ma mb kf mc md me ki mf mg mh kl mi mj mk ko ml bi translated">在Jupyter笔记本中编写SQL命令</h1><p id="b808" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">要启用数据库查询和其他命令，调用神奇的命令<code class="du ls lt lu lh b">%%sql</code>并在其后添加您的SQL代码。SQL代码应该在它自己的块中，与Python代码分开(感谢Daniel Upton指出这一点！).下面是查询inventory表中前三行和所有列的示例代码:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mq"><img src="../Images/d9322c41cd7fb7dd02de19623d30e7d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*zagb2CYiNRU8FRTuSOOvLw.png"/></div></figure><p id="8bb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想将查询存储在pandas数据框架中，这就是sqlalchemy的用武之地。使用命令<code class="du ls lt lu lh b">pd.read_sql()</code>创建一个dataframe对象。它需要两个参数:</p><ol class=""><li id="4b2d" class="kq kr hi ih b ii ij im in iq mn iu mo iy mp jc mr ky kz la bi translated">用引号括起来的SQL查询。</li><li id="842a" class="kq kr hi ih b ii lb im lc iq ld iu le iy lf jc mr ky kz la bi translated">您之前使用<code class="du ls lt lu lh b">create_engine()</code>函数创建的<code class="du ls lt lu lh b">engine</code>对象。</li></ol><p id="6ba6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是如何使用上图中的库存表查询SQL代码实现数据帧<code class="du ls lt lu lh b">inventory_dataframe</code>的示例。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ms"><img src="../Images/4af237bb2935ff097a43482b84aaeb4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*vOJMT-lNag8bHpYoMmLVCw.png"/></div></figure><p id="20dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦在数据框架中有了查询，就可以放心地继续进行数据分析了！</p></div></div>    
</body>
</html>