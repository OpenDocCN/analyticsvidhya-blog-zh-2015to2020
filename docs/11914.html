<html>
<head>
<title>RapidAPI: first steps with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RapidAPI:Python 的第一步</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/rapidapi-and-fastapi-d720789a5b7e?source=collection_archive---------8-----------------------#2020-12-23">https://medium.com/analytics-vidhya/rapidapi-and-fastapi-d720789a5b7e?source=collection_archive---------8-----------------------#2020-12-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/863e433b3e4d1eb1b10d419c15fc99f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C_I-XKkzSp2y6CNVyvXYhA.png"/></div></div></figure><h2 id="7d94" class="hr hs ht bd b fp hu hv hw hx hy hz dx ia translated" aria-label="kicker paragraph">技术指南</h2><div class=""/><div class=""><h2 id="de63" class="pw-subtitle-paragraph iz ic ht bd b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq dx translated">综合指南</h2></div><p id="2bbc" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">一位在银行工作的朋友曾经绝望地告诉我:“为什么我们要为 IBAN 解析器付出那么多？每月 300 欧元？我不能相信为什么这个这么贵”。我只能回答:“我能为 50 :D 做这件事”。他确认他会接受这笔交易，我开始研究。嗯，和你认识的商人打交道。</p><blockquote class="kn ko kp"><p id="3731" class="jr js kq jt b ju jv jd jw jx jy jg jz kr kb kc kd ks kf kg kh kt kj kk kl km hb bi translated">寻找一些 Python 或 JS 自由职业者，工资高达 50€/小时？请不要犹豫<a class="ae ku" href="https://twitter.com/SchifferThorin" rel="noopener ugc nofollow" target="_blank">在 Twitter </a>或<a class="ae ku" href="https://www.linkedin.com/in/thorin-schiffer/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>上联系我，告诉我你的简历、空闲时间和时薪。(CET +/- 3 小时)。</p></blockquote><figure class="kw kx ky kz fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kv"><img src="../Images/294e0cb95bd13801f80998697a6e24ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZtIQ21CCnZ4MKNWZ"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">我的狗喜欢休息 API 和臭狗对待。</figcaption></figure><p id="f020" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">在寻找 API 的特殊主机时，我偶然发现了 RapidAPI——来自加利福尼亚的 Andreesen 和 Horowitz 烘焙 API 市场公司。这就是我所期待的，也许这就是我整个职业生涯所期待的。</p><p id="91c2" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">作为后端工程师，你玩单机的机会更少:你设计不出好看的人人都想舔的 app 或者一个可用性突出的网站，其他不那么抽象的同事可以。除此之外，没有 Instagram 影响者或青少年需要面部识别 API。简而言之，我们的信条是 B2B 服务。</p><p id="ff8c" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">问题是，你通常不能这么容易地联系到决策者，而且很多样板文件摆在上面:账单、会计、安全等等。例如，所有这些都是通过应用程序开发人员的应用程序商店完成的。最后，我们到了，RapidAPI。</p><p id="0d98" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">一方面，RapidAPI 为 API 开发者提供了一个平台，使他们能够专注于业务的核心部分——复杂的问题和新的可插拔功能。该平台支持 REST，最近还支持 GraphQL APIs。另一方面，它允许公司配置一次访问，并通过一个网关用一个密钥向不同的 API 提供者请求服务。实际上，这是一个非常有趣的想法！</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div class="er es le"><img src="../Images/6481a717e4018aac45cf1e11683ce0ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/0*jmggkkSqHjex_vWo"/></div><figcaption class="la lb et er es lc ld bd b be z dx translated">第一个被认为有魅力的人。</figcaption></figure><p id="3c2c" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">在日常编程中，我们开发人员会问自己:我们应该自己写，还是应该使用库？如果这个库开发得很好，可以在多个版本中存活，那为什么不呢！RapidAPI 进一步发展了这一理念。它不是一个程序，而是为您提供一种服务，在这种服务中，平衡、SLA 和可用性不再是您的问题。嗯，至少不是全部。</p><p id="6db4" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">然而，美中不足的是:这个项目并不完美。许多 API 都有问题，平台本身显示出相当分裂的可用性概念。也许是因为我在欧洲，也许不是，但网络应用程序相当慢。有些元素有问题，而且没有很好的记录，但我确信这是由快速增长造成的。双关语？</p><h1 id="a1e3" class="lf lg ht bd lh li lj lk ll lm ln lo lp ji lq jj lr jl ls jm lt jo lu jp lv lw bi translated">FastAPI 和 RapidAPI</h1><p id="4589" class="pw-post-body-paragraph jr js ht jt b ju lx jd jw jx ly jg jz ka lz kc kd ke ma kg kh ki mb kk kl km hb bi translated">对于 API 来说，一个好的 python 迷你框架早就应该出现了。Django 的畸形、年龄和存在危机吓跑了新手和数据科学家。Flask 从来就不是为 API 框架而创建的，尽管它非常小巧和可插拔，但 Flask 和 Django 都不是为编程 API 而创建的。尽管 Django rest framework 是一款令人惊叹的软件，但它并不是您所需要的。</p><p id="cda7" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">Python <a class="ae ku" href="https://www.techrepublic.com/article/python-overtakes-java-to-become-the-second-most-popular-programming-language/" rel="noopener ugc nofollow" target="_blank">庆祝</a>第二(第三？)来了。随着所有令人惊叹的新技术的发布，python 成为了数据科学的通用语言。Asyncio 已经产生了一个全新的 web 框架分支，并吸引了社区更多的关注。</p><p id="af57" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">其中一个框架是<a class="ae ku" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank">FastAPI</a>——用于 asyncio、WebSockets 和 http/2 的 API 的 Flask。你想要的一切。有趣的事实:我最早是从我在 Cornelsen Verlag 遇到的一位数据科学家那里知道这件事的。它非常容易使用，所以即使不是分布式系统的专家也可以马上开始使用。</p><p id="291d" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">这个框架被很好地记录了下来。我需要的一切都可以立即找到。像许多其他 rest 框架一样，FastAPI 支持基于来自<a class="ae ku" href="https://pydantic-docs.helpmanual.io/" rel="noopener ugc nofollow" target="_blank"> pydantic </a>的模型的模式生成，这是一个基于新的 python 类型功能的棉花糖竞赛。</p><p id="672b" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">像这样:</p><pre class="kw kx ky kz fd mc md me mf aw mg bi"><span id="c1db" class="mh lg ht md b fi mi mj l mk ml">class ParsedIBAN(BaseModel):<br/>    iban: str<br/>    compact: str<br/>    country_code: str<br/>    bank_code: str<br/>    account_code: str<br/>    length: int<br/>    bic: BIC<br/><br/>    class Config:<br/>        alias_generator = to_camel</span></pre><p id="8d69" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">下面是典型端点的样子:</p><pre class="kw kx ky kz fd mc md me mf aw mg bi"><span id="a2dd" class="mh lg ht md b fi mi mj l mk ml">@app.post(<br/>    "/ibans/",<br/>    response_model=ParsedIBAN,<br/>    responses={400: {"model": Error}, 401: {"model": Error}, 422: {"model": Error}},<br/>)<br/>def parse_iban(iban_str: IBANString, current_user: str = Depends(get_current_user)):<br/>    <em class="kq">"""<br/>    Parse IBAN supplied in the post payload.<br/><br/>    ERRORS:...</em></span></pre><p id="82ad" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">相当直截了当和自我理解。</p><p id="fbe2" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">RapidAPI 需要开放 API 模式文件，以便可以使用 FastAPI 的内置功能创建该文件，如下所示:</p><pre class="kw kx ky kz fd mc md me mf aw mg bi"><span id="f6a4" class="mh lg ht md b fi mi mj l mk ml">def open_api():<br/>    api = get_openapi(<br/>        title="IBAN PARSER",<br/>        version=VERSION,<br/>        description="Parses IBANS",<br/>        routes=app.routes,<br/>    )<br/>    api["servers"] = [<br/>        {"url": "https://iban-parser.herokuapp.com", "description": "Production server"}<br/>    ]<br/>    ...<br/>    return api</span></pre><p id="d077" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">将结果转储到 YAML 文件中，如下所示:</p><pre class="kw kx ky kz fd mc md me mf aw mg bi"><span id="2d36" class="mh lg ht md b fi mi mj l mk ml">@invoke.task<br/>def generate_schema(context):<br/>    <em class="kq">"""<br/>    Generates open api schema yaml for the api<br/>    """<br/>    </em>from main import open_api<br/><br/>    with open("schema.yaml", "w") as yaml_s:<br/>        yaml.dump(open_api(), yaml_s)</span></pre><h1 id="496f" class="lf lg ht bd lh li lj lk ll lm ln lo lp ji lq jj lr jl ls jm lt jo lu jp lv lw bi translated">CI 上传模式和自动上传</h1><figure class="kw kx ky kz fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mm"><img src="../Images/70a1960e89a4c380751f4ce43e810b4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KscphgSGsFa0yo90k_xAGg.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">创建 React 应用程序示例…</figcaption></figure><p id="4bc4" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">为了提供 API，首先是端点，您可以通过 web 界面上传模式文件。这是一个非常简单的方法，但并不真正与现代 12 因素 API 的生命周期兼容。在应用程序的生命周期中，端点改变是很常见的事情，每次需要更新时都上传模式文件不是武士的方式。</p><p id="3de9" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">RapidAPI 提供了一种将这些更新集成到您的 ci 中的方法。有趣的是，通过他们自己的<a class="ae ku" href="https://rapidapi.com/rapidapi3-rapidapi-tools/api/openapi-provisioning" rel="noopener ugc nofollow" target="_blank"> API 提供元信息</a>。不幸的是，这个 API 漏洞百出，我花了一段时间才弄明白是什么东西。例如，当一切正常时，它返回“204 no content”而不是 200，当出现模糊的错误消息时，它返回 400。我已经在 API 页面的讨论中发布了使用模式 YAML 的工作 curl。这又是一次:</p><pre class="kw kx ky kz fd mc md me mf aw mg bi"><span id="777b" class="mh lg ht md b fi mi mj l mk ml">curl --request PUT --url https://openapi-provisioning.p.rapidapi.com/v1/apis/$RAPID_API_API_ID \<br/>--header 'x-rapidapi-host: openapi-provisioning.p.rapidapi.com' \<br/>--header "x-rapidapi-key: $RAPID_API_APP_KEY" \<br/>--header 'content-type: multipart/form-data' --form "file=@schema.yaml;type=application/yaml" -i</span></pre><p id="fba2" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">您可以在您的 marketplace 页面上找到 API id (RAPID_API_API_ID ),应用密钥应插入到配置 API 概述中。</p><p id="4cd0" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">除此之外，在尝试猜测字段的名称时，我发现 GraphQL 后端为前端请求相同的 API，因此您也可以从 overview 页面更新 API 的元数据，这不能从 schema 文件直接配置。</p><p id="d8eb" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">这是我想到的一个调用任务:</p><pre class="kw kx ky kz fd mc md me mf aw mg bi"><span id="9ce0" class="mh lg ht md b fi mi mj l mk ml">@invoke.task<br/>def update_api_data(context):<br/>    <em class="kq">"""<br/>    Updates rapid api data from the schema file<br/>    """<br/>    </em>import requests<br/>    from main import open_api<br/><br/>    url = f"https://openapi-provisioning.p.rapidapi.com/v1/apis/{env.str('RAPID_API_API_ID')}"<br/><br/>    api = open_api()<br/>    with open("RapidApiDescription.md", "r") as f:<br/>        long_description = f.read()<br/>    payload = {<br/>        "name": api["info"]["title"],<br/>        "description": api["info"]["description"],<br/>        "longDescription": long_description,<br/>        "websiteUrl": "http://iban-parser.herokuapp.com/docs",<br/>    }<br/>    headers = {<br/>        "x-rapidapi-key": env.str("RAPID_API_APP_KEY"),<br/>        "x-rapidapi-host": "openapi-provisioning.p.rapidapi.com",<br/>    }<br/><br/>    response = requests.request("PUT", url, data=payload, headers=headers)<br/>    if response.status_code == 204:  # somehow they think 204 is okay<br/>        print("Upload OK")<br/>    else:<br/>        raise Exit(f"Upload not OK: {response.status_code}: {response.text}", code=127)</span></pre><h1 id="135e" class="lf lg ht bd lh li lj lk ll lm ln lo lp ji lq jj lr jl ls jm lt jo lu jp lv lw bi translated">快速 API 测试</h1><p id="27a0" class="pw-post-body-paragraph jr js ht jt b ju lx jd jw jx ly jg jz ka lz kc kd ke ma kg kh ki mb kk kl km hb bi translated">该平台另一个有趣的部分是测试引擎。对于一个完美的 API，你可能会用单元测试来覆盖它。RapidAPI 允许您从外部监控 API，将集成测试和监控结合在一个工具中。</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mn"><img src="../Images/c5edcad60d626ec02d56389d6c8b1895.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q_cQthS7HKm6BaPZkqI5Dw.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">添加和配置测试及其计划间隔；通过电子邮件或短信获得通知。而且他们也很讨厌！免费的！</figcaption></figure><p id="3a2b" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">现在又多了一个 bug:时间表没有正常工作:它们不会立即开始，而是在一个随机的时间点开始。我希望看到这一点得到解决。</p><p id="a3a5" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">配置工具非常简单明了。一个非常好的特性是基于模式文件的端点描述来构建测试:参数和 URL 已经存在了！</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mo"><img src="../Images/cdc9ce2a715f8e5a1c982ebc7334923d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*cfsjx_BOhJ8H8iEKVJt1aQ.gif"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">使用我的狗可以使用的工具添加测试步骤(见上图)。这是非常整洁的。</figcaption></figure><figure class="kw kx ky kz fd hk er es paragraph-image"><div class="er es mp"><img src="../Images/a6572e147f8637d840591dd23080ac32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*zej9QXyORq3xdz7ZufPD7Q.png"/></div><figcaption class="la lb et er es lc ld bd b be z dx translated">这是一个简单测试的样子。这没有一行代码。</figcaption></figure><h1 id="b4b2" class="lf lg ht bd lh li lj lk ll lm ln lo lp ji lq jj lr jl ls jm lt jo lu jp lv lw bi translated">从 CI 触发测试</h1><p id="7991" class="pw-post-body-paragraph jr js ht jt b ju lx jd jw jx ly jg jz ka lz kc kd ke ma kg kh ki mb kk kl km hb bi translated">测试工具中的每个测试都可以自动触发。</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mq"><img src="../Images/86bc8ed3a05ab74a7726317f7629a39a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Js1GgD5wz5dkQ1FHpar7Ew.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">通过 REST 触发测试执行</figcaption></figure><p id="e37c" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">API 为您提供了关于测试状态的信息，因此您可以跟踪它，并在出现问题时使 ci 管道状态失败。下面是我为从 ci 中触发和轮询而编写的调用任务。</p><pre class="kw kx ky kz fd mc md me mf aw mg bi"><span id="3f52" class="mh lg ht md b fi mi mj l mk ml">@invoke.task(help={"wait": "How many seconds to poll the result of the test"})<br/>def trigger_rapid_api_test(context, wait=5):<br/>    <em class="kq">"""<br/>    Triggers rapid api test<br/>    """<br/>    </em>overall_success = True<br/>    failed_count = 0<br/><br/>    trigger_urls = env.str("RAPID_API_TESTS").split(" ")<br/>    for trigger_url in trigger_urls:<br/>        response = requests.get(trigger_url)<br/>        if response.status_code != 201:<br/>            print(<br/>                f"{trigger_url} response status not OK: {response.status_code} {response.text}"<br/>            )<br/>            continue<br/><br/>        data = response.json()<br/>        print(data["message"])<br/><br/>        status_url = data["statusUrl"]<br/>        for i in range(wait):<br/>            data = requests.get(status_url).json()<br/>            if data["status"] == "complete":<br/>                print(f"STATUS: {data['status']}")<br/>                test_success = bool(data["succesful"])<br/>                break<br/>            else:<br/>                print(f"STATUS: {data['status']}")<br/>            time.sleep(1)<br/>        else:<br/>            test_success = False<br/>            failed_count += 1<br/>        overall_success &amp;= test_success<br/><br/>    if overall_success:<br/>        print("OVERALL STATUS: OK, ALL TESTS PASSED")<br/>    else:<br/>        raise Exit(f"OVERALL STATUS: NOT OK, {failed_count} FAILED", code=127)</span></pre><p id="6285" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">RapidAPI 本身在 CI 示例中引用了 Github 操作。下面是 Gitlab 的上述任务的样子:</p><pre class="kw kx ky kz fd mc md me mf aw mg bi"><span id="5763" class="mh lg ht md b fi mi mj l mk ml">rapid_api:<br/>  stage: .post<br/>  image: python:3.8.6<br/>  script:<br/>  - pip install -r requirements.txt<br/>  - inv upload-schema<br/>  - inv update-api-data<br/>  - inv trigger-rapid-api-test<br/>  only:<br/>  - master</span></pre><h1 id="c478" class="lf lg ht bd lh li lj lk ll lm ln lo lp ji lq jj lr jl ls jm lt jo lu jp lv lw bi translated">使用 API</h1><p id="3a37" class="pw-post-body-paragraph jr js ht jt b ju lx jd jw jx ly jg jz ka lz kc kd ke ma kg kh ki mb kk kl km hb bi translated">好了，API 部署完毕，下一步是什么？您需要填写几个文本框，然后就可以通过 RapidAPI 客户端访问您的 API 了。您需要考虑的一件事是使用 RapidAPI 将传递的自定义 HTTP 头进行身份验证，以区分来自 RapidAPI 的调用和任何其他调用。只要凭证没有通过，您甚至希望阻止用户调用 API。</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mr"><img src="../Images/1d8efb49b7dba4df04a9990b41c3a929.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R02hm2Ia9R8l3Fqr5vPNTA.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">Rapid API 传递秘密，你检查有效性。</figcaption></figure><p id="1c82" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">下面是如何用 FastAPI 完成的(记住 current _ user:str = Depends(get _ current _ user)？):</p><pre class="kw kx ky kz fd mc md me mf aw mg bi"><span id="2f76" class="mh lg ht md b fi mi mj l mk ml">def get_current_user(<br/>    x_rapidapi_proxy_secret: Optional[str] = Header(None),<br/>    x_rapidapi_user: Optional[str] = Header(None),<br/>):<br/>    rapid_api_secret = env("RAPID_API_SECRET", None)<br/>    if not rapid_api_secret:<br/>        return None<br/><br/>    if rapid_api_secret == x_rapidapi_proxy_secret:<br/>        return x_rapidapi_user<br/><br/>    raise HTTPException(<br/>        status_code=status.HTTP_401_UNAUTHORIZED,<br/>        detail={"message": "No credentials provided", "code": "NotAuthorized"},<br/>    )</span></pre><p id="50db" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">在客户端，用法非常简单:</p><pre class="kw kx ky kz fd mc md me mf aw mg bi"><span id="2b11" class="mh lg ht md b fi mi mj l mk ml">import requests</span><span id="5b0b" class="mh lg ht md b fi ms mj l mk ml">url = "<a class="ae ku" href="https://iban-parser.p.rapidapi.com/ibans/" rel="noopener ugc nofollow" target="_blank">https://iban-parser.p.rapidapi.com/ibans/</a>"</span><span id="68e1" class="mh lg ht md b fi ms mj l mk ml">payload = """{<br/>    \"iban\": \"GB33BUKB20201555555555\"<br/>}"""<br/>headers = {<br/>    'content-type': "application/json",<br/>    'x-rapidapi-key': "XXX",<br/>    'x-rapidapi-host': "iban-parser.p.rapidapi.com"<br/>    }</span><span id="5c69" class="mh lg ht md b fi ms mj l mk ml">response = requests.request("POST", url, data=payload, headers=headers)</span><span id="f2b7" class="mh lg ht md b fi ms mj l mk ml">print(response.text)</span></pre><p id="366a" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">瞧啊。弗提格。搞定了。</p><p id="5842" class="pw-post-body-paragraph jr js ht jt b ju jv jd jw jx jy jg jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">然后，市场对剩下的部分进行汇总:记账、统计请求数等等。我真的很期待 RapidAPI 的发展，因为我不想做这些事情！</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div class="er es mt"><img src="../Images/7fac5fa6882bc14418294873f3252771.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*in7r_P3JvXsZjn5b.gif"/></div></figure></div></div>    
</body>
</html>