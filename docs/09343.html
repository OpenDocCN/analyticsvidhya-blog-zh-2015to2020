<html>
<head>
<title>What About a 6-Week Machine Learning Project? Beginners Friendly Cat vs Dog Classification Problem.(Week 6)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为期 6 周的机器学习项目怎么样？初学者友好的猫 vs 狗分类问题。(第六周)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/what-about-a-6-week-machine-learning-project-be0e7f205888?source=collection_archive---------12-----------------------#2020-09-02">https://medium.com/analytics-vidhya/what-about-a-6-week-machine-learning-project-be0e7f205888?source=collection_archive---------12-----------------------#2020-09-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6f2bf21c11bb60acea10fde8adb1ec15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-uCOwxBCZxyRRtt13mdj9w.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">预言；预测；预告</figcaption></figure><p id="3afd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">自从我开始做我的猫和狗的分类项目，已经有 6 个星期了。在这个项目完成的过程中，我能够学到很多新的东西。在不同的阶段，它让我多次浏览文档，问许多问题，寻找答案，甚至重新运行让我产生疑问的代码。</p><p id="76a9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这一切都是从寻找我从 Kaggle.com<a class="ae js" href="http://kaggle.com/" rel="noopener ugc nofollow" target="_blank">得到的数据集开始的。我的下一步是将它上传到 google drive，并在 google colab 上安装数据。所有这些都完成后，我就准备好编码和处理数据集了。</a></p><p id="0920" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">执行了所有给定的操作:</p><ol class=""><li id="5c52" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">查找图像标签。</li><li id="3d2b" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">验证集的创建。</li><li id="0e59" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">将数据批量化。</li><li id="b260" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">选择和建立模型。</li><li id="b661" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">创建回调。</li><li id="d573" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">根据数据子集训练我们的模型。</li><li id="aee6" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">预测和评估模型。</li><li id="c8fa" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">在完整数据集上训练模型。</li><li id="2ab4" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">保存和加载模型。(<a class="ae js" rel="noopener" href="/analytics-vidhya/what-about-a-6-week-machine-learning-project-fd947e46c4a2">链接到上一篇文章</a>)。</li></ol><p id="c0a7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">一旦满足了所有这些操作，剩下的任务就是对测试数据集进行预测，并进行自定义图像预测。</p><h1 id="81ff" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">测试数据预测</h1><p id="2261" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">在完整数据集上训练模型并加载保存的模型之后，我们就可以用测试数据测试模型了。</p><p id="6677" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了对测试数据集进行预测，我们需要一些东西:</p><ul class=""><li id="0a04" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr lk jz ka kb bi translated">获取测试图像文件名。</li><li id="0930" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lk jz ka kb bi translated">使用<code class="du ll lm ln lo b">create_data_batches()</code>将文件名转换成数据批次，并将参数设置为 true，因为我们使用的是测试数据集，不会有任何标签。</li><li id="5a92" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lk jz ka kb bi translated">通过将测试批次传递给我们模型上的<code class="du ll lm ln lo b">predict()</code>方法，创建一个预测数组。</li><li id="fd90" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lk jz ka kb bi translated"><strong class="iw hj">获取测试图像文件名</strong></li></ul><p id="f49f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们可以直接访问文件路径，只需复制文件的路径，然后将其添加到一个列表中。猫和狗都必须这样做..</p><p id="3c6f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">猫</strong></p><pre class="lp lq lr ls fd lt lo lu lv aw lw bi"><span id="c1ac" class="lx ki hi lo b fi ly lz l ma mb"><em class="mc"># Loading the test cat image filenames</em><br/>test_cat_path = 'drive/My Drive/CatVsDog/test_set/test_set/cats/'<br/>test_cat_filenames = [test_cat_path + fname <strong class="lo hj">for</strong> fname <strong class="lo hj">in</strong> os.listdir(test_cat_path)]<br/>test_cat_filenames[:5]</span><span id="a355" class="lx ki hi lo b fi md lz l ma mb">['drive/My Drive/CatVsDog/test_set/test_set/cats/cat.4585.jpg',<br/> 'drive/My Drive/CatVsDog/test_set/test_set/cats/cat.4592.jpg',<br/> 'drive/My Drive/CatVsDog/test_set/test_set/cats/cat.4632.jpg',<br/> 'drive/My Drive/CatVsDog/test_set/test_set/cats/cat.4580.jpg',<br/> 'drive/My Drive/CatVsDog/test_set/test_set/cats/cat.4575.jpg']</span></pre><p id="0878" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">狗</strong></p><pre class="lp lq lr ls fd lt lo lu lv aw lw bi"><span id="c317" class="lx ki hi lo b fi ly lz l ma mb"><em class="mc"># Loading the test dog image filenames</em><br/>test_dog_path = 'drive/My Drive/CatVsDog/test_set/test_set/dogs/'<br/>test_dog_filenames = [test_dog_path + fname <strong class="lo hj">for</strong> fname <strong class="lo hj">in</strong> os.listdir(test_dog_path)]<br/>test_dog_filenames[:5]</span><span id="88d8" class="lx ki hi lo b fi md lz l ma mb">['drive/My Drive/CatVsDog/test_set/test_set/dogs/dog.4651.jpg',<br/> 'drive/My Drive/CatVsDog/test_set/test_set/dogs/dog.4158.jpg',<br/> 'drive/My Drive/CatVsDog/test_set/test_set/dogs/dog.4426.jpg',<br/> 'drive/My Drive/CatVsDog/test_set/test_set/dogs/dog.4462.jpg',<br/> 'drive/My Drive/CatVsDog/test_set/test_set/dogs/dog.4434.jpg']</span></pre><ul class=""><li id="3673" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr lk jz ka kb bi translated"><strong class="iw hj">利用</strong>T2】</li></ul><p id="4c11" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里，我们将猫数据和狗数据都转换成数据批次，并设置参数<code class="du ll lm ln lo b">test_data = True</code>，因为我们实际上是在处理测试数据，并且没有与这些数据相关联的标签。</p><p id="b8c6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">猫</strong></p><pre class="lp lq lr ls fd lt lo lu lv aw lw bi"><span id="f214" class="lx ki hi lo b fi ly lz l ma mb"><em class="mc"># Create test cat data batches</em><br/>test_cat_data = create_data_batches(test_cat_filenames, test_data=<strong class="lo hj">True</strong>)</span><span id="0f59" class="lx ki hi lo b fi md lz l ma mb">creating test data batches.....</span></pre><p id="ee87" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">狗</strong></p><pre class="lp lq lr ls fd lt lo lu lv aw lw bi"><span id="55c4" class="lx ki hi lo b fi ly lz l ma mb"><em class="mc"># Create test dog data batches</em><br/>test_dog_data = create_data_batches(test_dog_filenames, test_data=<strong class="lo hj">True</strong>)</span><span id="c13d" class="lx ki hi lo b fi md lz l ma mb">creating test data batches.....</span></pre><ul class=""><li id="38e3" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr lk jz ka kb bi translated"><strong class="iw hj">对测试数据进行预测</strong></li></ul><p id="f51d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在我们都准备好利用<code class="du ll lm ln lo b">predict()</code>方法对猫和狗的测试数据进行预测。在进行预测之后，我们将所有的预测值保存在一个<code class="du ll lm ln lo b">.csv</code>文件中，供以后使用。</p><p id="58d7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">猫</strong></p><pre class="lp lq lr ls fd lt lo lu lv aw lw bi"><span id="f541" class="lx ki hi lo b fi ly lz l ma mb"><em class="mc"># Make predictions on test cat data batch using the loaded full model</em><br/>test_cat_predictions = loaded_full_cat_model.predict(test_cat_data, verbose=1)</span><span id="fcf9" class="lx ki hi lo b fi md lz l ma mb">32/32 [==============================] - 21s 671ms/step</span><span id="0244" class="lx ki hi lo b fi md lz l ma mb">np.savetxt("drive/My Drive/CatVsDog/pred_cat_array.csv", test_cat_predictions, delimiter=",")</span></pre><p id="c8d4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">狗</strong></p><pre class="lp lq lr ls fd lt lo lu lv aw lw bi"><span id="a102" class="lx ki hi lo b fi ly lz l ma mb"><em class="mc"># Make predictions on test dog data batch using the loaded full model</em><br/>test_dog_predictions = loaded_full_dog_model.predict(test_dog_data, verbose=1)</span><span id="9bf5" class="lx ki hi lo b fi md lz l ma mb">32/32 [==============================] - 909s 28s/step</span><span id="7966" class="lx ki hi lo b fi md lz l ma mb">np.savetxt("drive/My Drive/CatVsDog/pred_dog_array.csv", test_dog_predictions, delimiter=",")</span></pre><p id="5ca5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在我们有了包含所有预测值的猫和狗的预测数组。这个项目剩下的下一件事是在自定义图像上实际测试我们的模型，看看我们的模型有多好？</p><h1 id="18d2" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">自定义图像预测</h1><p id="18fc" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">为了对一些随机图像进行预测，我们可以从互联网上下载图像，或者只是单独给附近的狗或猫拍照，然后上传到 google drive。</p><p id="8dc4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">将图片上传到 google drive 后，我们需要做以下事情——正如我们之前对测试数据所做的那样:</p><ul class=""><li id="2811" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr lk jz ka kb bi translated"><strong class="iw hj">获取文件路径</strong></li></ul><p id="df36" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如前所述，只需复制图像的路径即可轻松获得。</p><pre class="lp lq lr ls fd lt lo lu lv aw lw bi"><span id="8acd" class="lx ki hi lo b fi ly lz l ma mb"><em class="mc"># Get the custom path</em><br/><strong class="lo hj">import</strong> <strong class="lo hj">os</strong><br/>custom_path = "drive/My Drive/CatVsDog/CustomCatAndDogImage/"<br/>custom_image_path = [custom_path + fname <strong class="lo hj">for</strong> fname <strong class="lo hj">in</strong> os.listdir(custom_path)]<br/>custom_image_path<br/>custom_image_path_length = len(custom_image_path)</span></pre><p id="6b49" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这里，我保存了列表的长度，因为稍后我们绘制带有预测概率和标签的自定义图像时会用到它。</p><ul class=""><li id="3b59" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr lk jz ka kb bi translated"><strong class="iw hj">创建数据批次</strong></li></ul><p id="2c56" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里使用了我们方便的函数<code class="du ll lm ln lo b">create_data_batch</code>，并将<code class="du ll lm ln lo b">test_data</code>参数设置为真。</p><pre class="lp lq lr ls fd lt lo lu lv aw lw bi"><span id="1ae9" class="lx ki hi lo b fi ly lz l ma mb"><em class="mc"># Turn the file paths into data batches.</em><br/>custom_data = create_data_batches(custom_image_path, test_data=<strong class="lo hj">True</strong>)<br/>custom_data</span><span id="628d" class="lx ki hi lo b fi md lz l ma mb">creating test data batches.....</span><span id="3d60" class="lx ki hi lo b fi md lz l ma mb">&lt;BatchDataset shapes: (None, 224, 224, 3), types: tf.float32&gt;</span></pre><ul class=""><li id="50fd" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr lk jz ka kb bi translated"><strong class="iw hj">对猫和狗模型进行预测</strong></li></ul><p id="b783" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这里，所有的自定义测试图像都是在猫和狗模型上预测的，因为我们的模型需要实际了解哪个是猫和狗，而不是实际上只将猫的图像输入到猫模型中，将狗的图像输入到狗模型中。所以所有的图像都是用这两种模型预测的。</p><pre class="lp lq lr ls fd lt lo lu lv aw lw bi"><span id="532f" class="lx ki hi lo b fi ly lz l ma mb">custom_prediction_1 = loaded_full_cat_model.predict(custom_data)<br/>custom_prediction_2 = loaded_full_dog_model.predict(custom_data)</span></pre><ul class=""><li id="7fcf" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr lk jz ka kb bi translated"><strong class="iw hj">绘制图像，标签，预测概率</strong></li></ul><p id="60f6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">第一次，当使用标签和概率绘制图像时，我被骗了，因为我只得到<strong class="iw hj">猫标签</strong>，即使对于一个狗图像，它将是一只猫的概率较小。所以我打印出了最大概率，并想出了如何正确显示图像。我刚刚使用了一个<code class="du ll lm ln lo b">if()</code>语句，如果一个图像在猫模型上有更高的预测概率，那么它将是<code class="du ll lm ln lo b">cat</code>，否则我们可以说它将是<code class="du ll lm ln lo b">dog</code>。</p><p id="45ab" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所以在运行这段代码时，我得到了正确的标签，每张图片的预测概率都超过了 90 %。</p><p id="f93b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后我试着在另一张有猫和狗的图片上做预测。基于我之前使用的比较，这次我只得到猫或狗中的一个。因此，我再次计算出图像显示的概率，并观察到两个模型预测图像的预测概率都大于 75%。</p><p id="ed47" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所以我再次使用了另一个<code class="du ll lm ln lo b">if()</code>语句，如果两个模型都以大于 75 %的概率预测图像，那么在那个特定的图像中将会有猫和狗，我们可以很容易地打印出标签<strong class="iw hj">猫和狗</strong>以及它们各自的预测概率。</p><pre class="lp lq lr ls fd lt lo lu lv aw lw bi"><span id="2949" class="lx ki hi lo b fi ly lz l ma mb">custom_images = []<br/><strong class="lo hj">for</strong> image <strong class="lo hj">in</strong> custom_data.unbatch().as_numpy_iterator():<br/>  custom_images.append(image)</span><span id="0c93" class="lx ki hi lo b fi md lz l ma mb"><strong class="lo hj">import</strong> <strong class="lo hj">matplotlib.pyplot</strong> <strong class="lo hj">as</strong> <strong class="lo hj">plt</strong><br/>plt.figure(figsize=(20, 20))<br/><strong class="lo hj">for</strong> i, image <strong class="lo hj">in</strong> enumerate(custom_images):<br/>  plt.subplot(1, custom_image_path_length, i+1)<br/>  plt.xticks([])<br/>  plt.yticks([])<br/>  <strong class="lo hj">if</strong> np.max(custom_prediction_1[i]) &gt; 0.75 <strong class="lo hj">and</strong> np.max(custom_prediction_2[i]) &gt; 0.75:<br/>    plt.title("<strong class="lo hj">{}</strong> <strong class="lo hj">{:2.0f}</strong>% <strong class="lo hj">{:2.0f}</strong>% <strong class="lo hj">{}</strong>".format("cat",<br/>                                      np.max(custom_prediction_1[i])*100,<br/>                                      np.max(custom_prediction_2[i])*100,<br/>                                      "dog"), color="green")</span><span id="325f" class="lx ki hi lo b fi md lz l ma mb">  <strong class="lo hj">elif</strong> np.max(custom_prediction_1[i]) &gt; np.max(custom_prediction_2[i]):<br/>    plt.title("<strong class="lo hj">{}</strong> <strong class="lo hj">{:2.0f}</strong>% <strong class="lo hj">{}</strong>".format("cat",<br/>                                      np.max(custom_prediction_1[i])*100,<br/>                                      "cat"), color="green")</span><span id="fe97" class="lx ki hi lo b fi md lz l ma mb">  <strong class="lo hj">else</strong>:<br/>    plt.title("<strong class="lo hj">{}</strong> <strong class="lo hj">{:2.0f}</strong>% <strong class="lo hj">{}</strong>".format("dog",<br/>                                      np.max(custom_prediction_2[i])*100,<br/>                                      "dog"), color="green")<br/>  plt.imshow(image)</span></pre><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/68f288f2c61181321ecd8872d590dd59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PJnll67D9oRHX3SDtNcTBw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">预测结果。</figcaption></figure><p id="0297" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我的 Github 回购:<a class="ae js" href="https://github.com/Rohithv07/6WeekPro/blob/master/Cat_Vs_Dog.ipynb" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><p id="e39a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这里，10 个图像中有 9 个被正确预测，只有一个出错，因为里面有猫和狗，猫在某种程度上被藏在狗的手里——所以它只预测了狗。所以这可以作为这个项目的后续行动，我们可以用更多这样的图像进一步训练模型。</p><p id="9b4a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，我已经完成了我计划要完成的所有工作，并且非常高兴我能够及时完成整个项目。我要感谢我的机器学习导师，来自 Udemy <strong class="iw hj">的 Daniel Bourke </strong>，他帮助我提出了这样一个想法，这不仅增加了我的知识，也给了我完成这项工作的信心。现在，我将寻找一些其他类型的项目来做，因为我同样可以从中学习新的东西，而且学习新东西没有暂停按钮！</p></div></div>    
</body>
</html>