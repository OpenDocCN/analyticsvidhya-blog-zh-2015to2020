<html>
<head>
<title>Car Price Prediction with Machine Learning Models (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用机器学习模型预测汽车价格(上)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/car-price-prediction-with-machine-learning-models-price-f40ea2203f15?source=collection_archive---------23-----------------------#2020-07-12">https://medium.com/analytics-vidhya/car-price-prediction-with-machine-learning-models-price-f40ea2203f15?source=collection_archive---------23-----------------------#2020-07-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a959" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在过去的几年里，机器学习的应用几乎渗透到了每一项技术创新中。从相当简单的将电子邮件分类为垃圾邮件或火腿到复杂的应用程序，如随机对象检测或自动驾驶汽车，这个领域正在以非常快的速度发展。随着海量数据和更快的计算机处理器的出现，可以肯定地说，我们还有很长的路要走。</p><p id="9b79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">机器学习的一个常见应用是基于一些给定的特征进行预测。该模型从一些标记的数据中学习，然后对新的看不见的数据进行预测。这种类型的学习被归类为监督学习。</p><p id="700e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">监督学习可以进一步分为两种:分类或回归。分类问题回答问题，会吗？而回归问题回答多少？</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/b3380a5320f44039b1b12351e8ed5173.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R9Ccrjs5urWBsDMq"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">玛丽莎·布尔·水中香在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="2982" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将与您分享一种逐步建立机器学习模型的方法，该模型可以根据汽车的里程数、使用年限、变速器类型、前车主数量和其他许多特征来预测汽车的价格。我评估了5 ML算法(线性回归器、Lasso、Ridge、决策树和随机森林回归器)对数据的性能。</p><p id="95a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章将分为两部分。这第一部分将涵盖数据清理和EDA，而在第二部分，我们将预处理数据和应用机器学习算法。在帖子结束时，你将理解几乎所有机器学习模型的框架，如果你是一个新手，也许能够建立你的模型。这是工作流程的样子。</p><ol class=""><li id="6500" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated">数据清理和管理</li><li id="fb48" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">探索性数据分析</li><li id="b51d" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">特征工程</li><li id="0eeb" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">模型评估</li><li id="da0f" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">超参数调谐</li><li id="c01c" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">型号选择</li><li id="8541" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">结论和对未来工作的设想</li></ol><p id="0f38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">事不宜迟，让我们开始吧。</p><h1 id="b2c1" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">数据清理和管理</h1><p id="d6e5" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">数据是从Kaggle获得的，可以在这里下载<a class="ae jt" href="https://github.com/dayvheed/Car-Prices-/blob/master/train-data.csv" rel="noopener ugc nofollow" target="_blank">。我将从导入必要的库开始。</a></p><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="9100" class="lq kj hi lm b fi lr ls l lt lu">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>import datetime as dt<br/>from sklearn.preprocessing import RobustScaler<br/>from sklearn.model_selection import KFold<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.model_selection import cross_val_score<br/>from sklearn.model_selection import GridSearchCV<br/>from sklearn.linear_model import LinearRegression<br/>from sklearn.tree import DecisionTreeRegressor<br/>from sklearn.linear_model import Lasso<br/>from sklearn.linear_model import Ridge<br/>from sklearn.ensemble import RandomForestRegressor<br/>from sklearn.metrics import r2_score<br/>from sklearn import metrics<br/>import pickle<br/>sns.set()</span></pre><p id="ba6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，我读取数据并打印前5个样本。在我们的分析中，列“未命名:0”是不必要的，因此它从数据帧中删除。简而言之，汽车的品牌是好的，而不是整个车型。因此，我将每个条目按空间分开，选择了第一个索引。</p><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="5c32" class="lq kj hi lm b fi lr ls l lt lu"># Read the data<br/>train = pd.read_csv(r"C:\Users\wale obembe\Downloads\Compressed\245550_518431_bundle_archive\train-data.csv")<br/># Print the first 5 rows of the dataframe<br/>print(train.head())</span><span id="10cd" class="lq kj hi lm b fi lv ls l lt lu"># Drop the 'Unnamed: 0' column <br/>data = train.drop('Unnamed: 0', axis=1)<br/># Select only the brand of the car and not the model<br/>data['Name'] = data['Name'].apply(lambda x: x.split(' ')[0].upper())<br/>data.head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/aeb511ff2639e9834cd7a051d54d6b02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tcMfT9d6LFFVHW_A7o_5CQ.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lx"><img src="../Images/a0ef047ba2c93f6883efc828ade399ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m-Cfkewla316k53yKO6WyA.png"/></div></div></figure><p id="57ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">年份一栏显示了汽车的购买年份。但是为了更容易理解，我从现在的年份中减去了年份，以表示汽车已经使用了多长时间。</p><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="ff0e" class="lq kj hi lm b fi lr ls l lt lu"># Change the Year column to the years of usage<br/>data['Year'] = dt.date.today().year - data['Year']</span></pre><p id="e82a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你会注意到一些列，比如“里程”和“功率”，在数字旁边有它们的单位。对于我们的分析，我们只需要数值。所以我再次按空格分割，选择第一个索引并转换成数值。</p><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="dd66" class="lq kj hi lm b fi lr ls l lt lu"># Select the first word of the Mileage column<br/>data['Mileage'] =data['Mileage'].apply(lambda x: str(x).split(' ')[0])<br/># Change 'nan' string to real missing values<br/>data['Mileage'] = [x if x != 'nan' else np.nan for x in data['Mileage']]<br/># Convert the datatype to floating numbers<br/>data['Mileage'] = pd.to_numeric(data['Mileage'])</span><span id="8f56" class="lq kj hi lm b fi lv ls l lt lu"># Select the first word of the Power column<br/>data['Power'] = data['Power'].apply(lambda x: str(x).split(' ')[0])<br/># Change 'null' string to real missing values<br/>data['Power'] = [np.nan if x=='null' else x for x in data['Power']]<br/>data['Power'] = [np.nan if x=='nan' else x for x in data['Power']]<br/># Convert the datatype to floating numbers<br/>data['Power'] = pd.to_numeric(data['Power'])</span><span id="1ec5" class="lq kj hi lm b fi lv ls l lt lu">print(data['Mileage'].dtype, data['Power'].dtype)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ly"><img src="../Images/9995b77583414aa02f249628c0bf7162.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*1KrDBf9Qzi6sC5ftryCbgg.png"/></div></figure><p id="46cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在它们是浮点数，我检查了丢失的值，它们是存在的。</p><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="5129" class="lq kj hi lm b fi lr ls l lt lu"># Check for null values<br/>data.isnull().sum()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lz"><img src="../Images/182d1471352726b56a04570935b40ae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*pCTED-fwuLHM7ZQgYBW6gQ.png"/></div></figure><p id="5de0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，我注意到一些条目是“nan”或“null”字符串，从技术上讲，这不是一个缺失值，尽管它们应该是。这些字符串被转换为丢失的值。接下来，用列的中值替换缺失值，并删除“引擎”列中的缺失值，因为它是一个分类特征。我用中位数而不是平均数来代替，因为我后来意识到这些数据有很多异常值。这里的平均值是一个很大的值。</p><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="a1c0" class="lq kj hi lm b fi lr ls l lt lu"># Replace missing values with median value of the column<br/>mileage_median = data['Mileage'].median()<br/>data['Mileage'] = data['Mileage'].fillna(mileage_median)</span><span id="7a3d" class="lq kj hi lm b fi lv ls l lt lu">power_median = data['Power'].median() <br/>data['Power'] = data['Power'].fillna(power_median)</span><span id="5a7f" class="lq kj hi lm b fi lv ls l lt lu">seat_median = data['Seats'].median()<br/>data['Seats'] = data['Seats'].fillna(seat_median)</span><span id="1d7e" class="lq kj hi lm b fi lv ls l lt lu"># Drop the remaining rows with missing value<br/>data.dropna(axis=0, inplace=True)<br/># Check for missing values<br/>data.isnull().sum().any()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ma"><img src="../Images/06a6c101a33ceae1bc6ad7631f79f2aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*TLIU6n3H9XxX1yOfYDY-jw.png"/></div></figure><h1 id="8990" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">探索性数据分析</h1><p id="1ce8" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">首先，我将每个特征分为类别特征、数值特征、连续特征或离散特征。</p><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="02b0" class="lq kj hi lm b fi lr ls l lt lu"># Classify the non-numerical features<br/>cat_features = [x for x in data.columns if data[x].dtype == 'O']</span><span id="4bd8" class="lq kj hi lm b fi lv ls l lt lu"># Classify the numerical features<br/>num_features = [x for x in data.columns if data[x].dtype != 'O']</span><span id="4ab2" class="lq kj hi lm b fi lv ls l lt lu"># Classify the discrete features<br/>discrete_features = [x for x in num_features<br/>                     if len(data[x].unique()) &lt; 25]</span><span id="0b90" class="lq kj hi lm b fi lv ls l lt lu"># Classify the continuous features<br/>continuous_features = [x for x in num_features<br/>                      if x not in discrete_features]<br/># Check them out<br/>print(f"Categorical features: {cat_features}\nNumerical features: {num_features}\<br/>\nDiscrete features: {discrete_features}\nContinuous features: {continuous_features}")</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mb"><img src="../Images/c6ba8b82ac188c89f80fb444e5f3f769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UmXRosrh0W-DZBa_Bbs7Bg.png"/></div></div></figure><p id="337c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我进行了一些数据可视化，以更好地理解数据。我在seaborn用计数图法检查了每个品牌被购买的次数。</p><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="0f7b" class="lq kj hi lm b fi lr ls l lt lu"># Create a figure<br/>plt.figure(figsize=(8, 8))<br/># Count the number of times a car was bought and plot the graph<br/>count = sns.countplot(cat_features[0], data=data, order=data.groupby('Name').mean()['Price'].index)<br/>count.set_xticklabels(count.get_xticklabels(), rotation='vertical')</span><span id="e144" class="lq kj hi lm b fi lv ls l lt lu"># Plot the mean price of each car<br/>price = sns.lineplot(data.groupby('Name').mean()['Price'].index, data.groupby('Name').mean()['Price'].values)<br/>;</span></pre><p id="76e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">马鲁蒂和现代的销量最大，而宾利、兰博基尼和其他一些品牌的买家数量最少。凭直觉，人们会怀疑豪华车会非常昂贵，这也是其销量相对较低的原因。为了证明这一说法，我绘制了一个显示每个品牌价格的线图。兰博基尼和宾利是最贵的两辆车。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mc"><img src="../Images/8cdf3570d52e4da64fcf78673ea2d10d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a2S0YsDzqmqzLthWJOw-GQ.png"/></div></div></figure><p id="d1a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，我检查了每个功能如何影响价格。条形图显示，使用1至4年的汽车、行驶里程少于33963公里的汽车、只有一位前车主的汽车比其他类别的汽车价格更高。此外，柴油和电动汽车比汽油驱动的汽车或其他燃料类型的汽车更贵。自动变速器的汽车比手动变速器的汽车价格高得多。</p><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="1cbe" class="lq kj hi lm b fi lr ls l lt lu"># Create a figure with 6 subplots<br/>fig, ax = plt.subplots(2,3, figsize=(15, 10))<br/>fig.subplots_adjust(hspace=0.5)</span><span id="a220" class="lq kj hi lm b fi lv ls l lt lu"># Graph each categorical feature wrt to thee Price<br/>a = sns.barplot(data.columns[1], 'Price', data=data, ax=ax[0][0])<br/>a.set_xticklabels(a.get_xticklabels(), rotation='vertical')</span><span id="7713" class="lq kj hi lm b fi lv ls l lt lu">b = sns.barplot(pd.qcut(data[data.columns[2]], 4), 'Price', data=data, ax=ax[0][1])<br/>b.set_xticklabels(['1 - 4', '4 - 6', '6 - 9', '9 - 22'], rotation='vertical')<br/>b.set_xlabel('Age of Car')</span><span id="0748" class="lq kj hi lm b fi lv ls l lt lu">c = sns.barplot(pd.qcut(data[data.columns[3]], 4), 'Price', data=data, ax=ax[0][2])<br/>c.set_xticklabels(['171 - 33965', '33966 - 53000', '53000 - 73000', '73000 - 6500000'], rotation='vertical')</span><span id="2d9a" class="lq kj hi lm b fi lv ls l lt lu">d = sns.barplot(data.columns[4], 'Price', data=data, ax=ax[1][0])<br/>d.set_xticklabels(d.get_xticklabels(), rotation='vertical')</span><span id="175a" class="lq kj hi lm b fi lv ls l lt lu">e = sns.barplot(data.columns[5], 'Price', data=data, ax=ax[1][1])<br/>e.set_xticklabels(e.get_xticklabels(), rotation='vertical')</span><span id="2f9b" class="lq kj hi lm b fi lv ls l lt lu">f = sns.barplot(data.columns[6], 'Price', data=data, ax=ax[1][2])<br/>f.set_xticklabels(f.get_xticklabels(), rotation='vertical')</span><span id="b1e9" class="lq kj hi lm b fi lv ls l lt lu">;</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es md"><img src="../Images/7c33d43060df9312416be8c8a5ad63c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GSQy_lVX2_FKlmEnD3K20g.png"/></div></div></figure><p id="1f3f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，检查数据中是否存在异常值非常重要。我用seaborn为数字特征绘制了一个箱线图。顶部和底部胡须后的圆点表示异常值的存在。异常值是数据分布中极高或极低的值，它们的存在会严重损害您的分析。数据中的异常值将被立即处理。</p><pre class="je jf jg jh fd ll lm ln lo aw lp bi"><span id="3835" class="lq kj hi lm b fi lr ls l lt lu">data1 = data.copy()</span><span id="8305" class="lq kj hi lm b fi lv ls l lt lu"># Create a figure with 4 subplots    <br/>fig, ax = plt.subplots(2,2, figsize=(16,8))</span><span id="8067" class="lq kj hi lm b fi lv ls l lt lu"># Create a boxplot for the continuous features<br/>box1 = sns.boxplot(y=np.log(data1[continuous_features[0]]), ax=ax[0][0])<br/>box2 = sns.boxplot(y=np.log(data1[continuous_features[1]]), ax=ax[0][1])<br/>box3 = sns.boxplot(y=np.log(data1[continuous_features[2]]), ax=ax[1][0])<br/>box4 = sns.boxplot(y=np.log(data1[continuous_features[3]]), ax=ax[1][1])<br/>;</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es me"><img src="../Images/7b840cbe989795fb8faf95cd49eaa454.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*crS0N1YtY_p9BT7ItOnSSw.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mf"><img src="../Images/38fca09b73c654a98e77035bfe6ff047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sxeWdYALeBvclNo2GxXNWQ.png"/></div></div></figure><p id="2845" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我会暂时停在这里。请注意第2部分，我将从一些特性工程开始，并结束这个项目。感谢阅读！</p></div></div>    
</body>
</html>