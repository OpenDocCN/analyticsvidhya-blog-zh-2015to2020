<html>
<head>
<title>Is it possible to predict the contract award amount using its description?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">是否可以使用其描述来预测合同授予金额？</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/contract-awards-data-analyze-770925a6a6b5?source=collection_archive---------28-----------------------#2019-11-26">https://medium.com/analytics-vidhya/contract-awards-data-analyze-770925a6a6b5?source=collection_archive---------28-----------------------#2019-11-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="3e81" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">让我们利用世界银行提供的金融数据来找出答案</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/8451f17fd8c23c13729e98604dd4dc52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Gcpkwk4VE892T5gE.jpg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">来源:<a class="ae jn" href="https://internationalfinance.com/world-bank-group-credit-reporting-europe-central-asia/" rel="noopener ugc nofollow" target="_blank">https://international finance . com/world-bank-group-credit-reporting-Europe-central-Asia/</a></figcaption></figure><h1 id="d3c7" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">1.商业理解</h1><p id="7935" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">世界银行集团的企业采购部门负责协调和监督全球150多个办事处的货物、服务、建筑和咨询服务的采购战略、选择和合同执行。在这个项目中，我们将关注世界银行集团公司采购部门提供的数据集。</p><p id="2b34" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">该项目的目标是分析数据集<a class="ae jn" href="https://finances.worldbank.org/Procurement/Corporate-Procurement-Contract-Awards/a3d9-f9xv" rel="noopener ugc nofollow" target="_blank">公司采购合同授予</a>。公司采购部门使用给定的数据集，同时确保采购合同符合采购政策和程序，因为业务部门负责业务需求、支出政策、要求规格和供应商选择。</p><blockquote class="lh li lj"><p id="de89" class="kg kh lk ki b kj lc ij kl km ld im ko ll le kr ks lm lf kv kw ln lg kz la lb hb bi translated">这组数据包括世界银行集团根据其机构采购政策和程序执行的大额合同授予清单。该清单包括估价超过250，000美元的固定价格不确定交付/不确定数量(IDIQ)合同。</p></blockquote><p id="9f8a" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">通过这篇文章，我们将试图找到这些问题的答案:</p><ul class=""><li id="712c" class="lo lp hi ki b kj lc km ld kp lq kt lr kx ls lb lt lu lv lw bi translated">Q1。供应商合同编号和决标金额之间是否有任何联系？</li><li id="b706" class="lo lp hi ki b kj lx km ly kp lz kt ma kx mb lb lt lu lv lw bi translated">Q2。描述合同最常用的词是什么？</li><li id="a0a2" class="lo lp hi ki b kj lx km ly kp lz kt ma kx mb lb lt lu lv lw bi translated">Q3。合同描述和奖励金额有关系吗？</li></ul><p id="649b" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">为了找到这些问题的答案，我们从导入所需的库开始。我使用<strong class="ki hj"> pyspark </strong>和库<strong class="ki hj"> ml </strong>、<strong class="ki hj"> sql </strong>和<strong class="ki hj"> matplotlib </strong>来探索给定的数据集。</p><h1 id="5a43" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">2.数据理解</h1><p id="8fe9" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在加载和数据清理之后，我们探索数据，以便找到问题的答案。数据头类似于:</p><pre class="iy iz ja jb fd mc md me mf aw mg bi"><span id="4503" class="mh jp hi md b fi mi mj l mk ml">Row(_c0='Award Date', _c1='Quarter and Fiscal Year', _c2='Commodity Category', _c3='Contract Description', _c4='WBG Organization', _c5='Selection Number', _c6='Supplier', _c7='Supplier Country', _c8='Supplier Country Code', _c9='Contract Award Amount', _c10='Fund Source', _c11='VPU description')</span></pre><p id="1204" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">数据集中出现最多的前10个县:</p><pre class="iy iz ja jb fd mc md me mf aw mg bi"><span id="31a1" class="mh jp hi md b fi mi mj l mk ml">+--------------+-----+<br/>|     Countries|count|<br/>+--------------+-----+<br/>|           USA|  464|<br/>|United Kingdom|  180|<br/>|        France|   82|<br/>|         India|   76|<br/>|   Netherlands|   71|<br/>|       Germany|   44|<br/>|         Spain|   36|<br/>|         Kenya|   35|<br/>|       Denmark|   28|<br/>|     Indonesia|   28|<br/>+--------------+-----+</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mm"><img src="../Images/c804e534fff811f9cd68123cb36c23e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Gdwlz7nj5acSw_fPOF8zg.png"/></div></div></figure><p id="199e" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">前10个合同和授予金额最大的国家</p><pre class="iy iz ja jb fd mc md me mf aw mg bi"><span id="9c42" class="mh jp hi md b fi mi mj l mk ml">+--------------------+---------+-----------+<br/>|                 _c3|      _c7|        _c9|<br/>+--------------------+---------+-----------+<br/>|Food &amp; Catering a...|      USA|     2.16E8|<br/>|Travel Management...|      USA|     5.27E7|<br/>|PHARMACY BENEFIT ...|      USA|      5.2E7|<br/>|    Global Custodian|      USA|2.1941912E7|<br/>|Somalia  Monitori...|      USA|1.2054287E7|<br/>|Ethiopia Technica...|      USA|     1.16E7|<br/>|Food &amp; Catering a...|      USA|    1.125E7|<br/>|Global Multiproto...|Mauritius|1.0871742E7|<br/>|     GLOBAL PAYMENTS|      USA|      1.0E7|<br/>|Global Multiproto...|      USA|  9544230.0|<br/>+--------------------+---------+-----------+</span></pre><p id="8132" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">每份合同中获得较大金额的类别</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mn"><img src="../Images/987f871b4f34a040fcc6ab89c17aa6a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B7i28i-sz0TxZ3KuxZcgaQ.png"/></div></div></figure><p id="5b48" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj"> Q1。供应商合同编号和决标金额之间是否有任何联系？</strong></p><pre class="iy iz ja jb fd mc md me mf aw mg bi"><span id="50d5" class="mh jp hi md b fi mi mj l mk ml">supplier_df_count = df.select(“_c6”).groupby(“_c6”).count()\<br/>.orderBy(desc(“count”))supplier_df = df.select(“_c6”,     “_c9”).groupby(“_c6”).sum(“_c9”).orderBy(desc(“sum(_c9)”))</span><span id="1cd6" class="mh jp hi md b fi mo mj l mk ml">new_supplier_df = supplier_df.alias(‘a’).\<br/>join(supplier_df_count.alias(‘b’),col(‘b._c6’) == col(‘a._c6’)).\<br/> select([col(‘a.’+xx) for xx in supplier_df.columns] +[col(‘b.count’)])</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mp"><img src="../Images/946e121fef1a507738c8888eea02eca0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FTTj3DoMhEBiGvA-E-53uA.png"/></div></div></figure><p id="c248" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">上图描述了这两个国家之间的关系。正如我们从图表中看到的，它们是不相关的。</p><h1 id="84ba" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">3.准备数据</h1><p id="c187" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">为了回答Q2的问题，我们必须使用文本处理工具做一些数据准备，比如RegexTokenizer、StopWordsRemover和CountVectorizer。</p><pre class="iy iz ja jb fd mc md me mf aw mg bi"><span id="bb5d" class="mh jp hi md b fi mi mj l mk ml">regexTokenizer = RegexTokenizer(inputCol=”_c3", outputCol=”wordList”)<br/>data_df = regexTokenizer.transform(df)</span><span id="24ec" class="mh jp hi md b fi mo mj l mk ml">stopWordsRemover = StopWordsRemover(inputCol=”wordList”, outputCol=”cleanWordList”)<br/>data_df = stopWordsRemover.transform(data_df)</span><span id="578d" class="mh jp hi md b fi mo mj l mk ml">cv = CountVectorizer(inputCol=”cleanWordList”, outputCol=”TF”, vocabSize=1000)<br/>cvmodel = cv.fit(data_df)</span></pre><p id="0040" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj"> Q2。描述合同最常用的词是:</strong></p><pre class="iy iz ja jb fd mc md me mf aw mg bi"><span id="170d" class="mh jp hi md b fi mi mj l mk ml">['services', 'development', 'support', 'program', 'project',<br/> 'management', 'technical', 'survey', 'consultant', 'public']</span></pre><p id="9154" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">我们继续进行数据准备，以便获得合同描述的TF-IDF向量(_c9)并保存在TFIDF列中。我们将使用这个新列来训练回归模型并预测奖励金额(_c9)。</p><h1 id="a890" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">4.数据建模</h1><p id="738e" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">我们将数据集分成两部分:用于训练和测试。对于预测，让我们使用<strong class="ki hj">线性回归</strong>和<strong class="ki hj">决策树回归器</strong>创建回归模型。我们将数据传递给模型来训练和预测结果。</p><ul class=""><li id="d938" class="lo lp hi ki b kj lc km ld kp lq kt lr kx ls lb lt lu lv lw bi translated"><strong class="ki hj">线性回归</strong></li></ul><pre class="iy iz ja jb fd mc md me mf aw mg bi"><span id="41b0" class="mh jp hi md b fi mi mj l mk ml">lr = LinearRegression(featuresCol =’Features’, labelCol = ‘_c9’, maxIter=5, regParam=0.0, fitIntercept=False, solver=”normal”)<br/>lrModel = lr.fit(rest)<br/>lrPredictions = lrModel.transform(validation)</span></pre><ul class=""><li id="5355" class="lo lp hi ki b kj lc km ld kp lq kt lr kx ls lb lt lu lv lw bi translated"><strong class="ki hj">决策树回归器</strong></li></ul><pre class="iy iz ja jb fd mc md me mf aw mg bi"><span id="888c" class="mh jp hi md b fi mi mj l mk ml">dt = DecisionTreeRegressor(featuresCol ='Features', labelCol = '_c9')<br/>dtModel = dt.fit(rest)<br/>dtPredictions = dtModel.transform(validation)</span></pre><h1 id="2bc0" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">5.评估结果</h1><p id="f0c3" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">我们使用回归评估器来评估模型lrModel和dtModel的预测结果。</p><p id="0ecd" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">线性回归结果</strong>:</p><p id="6208" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">lrModel.r2 = 0.65 %</p><pre class="iy iz ja jb fd mc md me mf aw mg bi"><span id="71fe" class="mh jp hi md b fi mi mj l mk ml">+--------------------+---------+--------------------+<br/>|          prediction|      _c9|            Features|<br/>+--------------------+---------+--------------------+<br/>| -290797.60198603506| 439921.0|(1000,[19,36,85],...|<br/>|   5140235.828518745| 999671.0|(1000,[5,7,35,77,...|<br/>| -1288037.6153147744|481963.34|(1000,[32,102,170...|<br/>|1.1439009726993315E7|531296.75|(1000,[11,17,28,3...|<br/>|   277338.5157081769| 393310.0|(1000,[14,21,41,1...|<br/>|   455824.6088107006|360903.72|(1000,[0,7,278,32...|<br/>|   440127.2384942813| 363411.0|(1000,[6,50,100],...|<br/>|    84638.6229614776| 493043.0|(1000,[126],[4.51...|<br/>|   584871.7840514984| 392120.0|(1000,[10,13,15,2...|<br/>|  -984782.8991670524|342760.06|(1000,[10,13,15,4...|<br/>|  202106.55295227905| 499920.0|(1000,[5,70,120,1...|<br/>|  1818003.3578549554| 500000.0|(1000,[1,28,86],[...|<br/>| -286324.74035095086| 270187.7|(1000,[22,30,65,8...|<br/>|   78965.34471193032| 429350.0|(1000,[247,348,42...|<br/>|   636847.2108542032| 651706.0|(1000,[5,9,26,155...|<br/>|  1616184.1969578827|354885.22|(1000,[25,40,73,8...|<br/>|  -167486.8741742194|275643.97|(1000,[8,46,352,5...|<br/>|   576264.5478086167|388824.47|(1000,[30,79,81,3...|<br/>|   2116516.356030904| 535365.0|(1000,[4,6,7,22,1...|<br/>|   902461.1673980198| 600000.0|(1000,[81,115,244...|<br/>+--------------------+---------+--------------------+<br/>only showing top 20 rows<br/><br/>Root Mean Squared Error (RMSE) on test data for linear regression = 9.8932e+06<br/>R2 on test data for linear regression = -0.00310965</span></pre><p id="ffa4" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">决策树回归器结果</strong>:</p><pre class="iy iz ja jb fd mc md me mf aw mg bi"><span id="30d0" class="mh jp hi md b fi mi mj l mk ml">+-----------------+---------+--------------------+<br/>|       prediction|      _c9|            Features|<br/>+-----------------+---------+--------------------+<br/>|572582.6692662078| 439921.0|(1000,[19,36,85],...|<br/>|572582.6692662078| 999671.0|(1000,[5,7,35,77,...|<br/>|572582.6692662078|481963.34|(1000,[32,102,170...|<br/>|           1.16E7|531296.75|(1000,[11,17,28,3...|<br/>|572582.6692662078| 393310.0|(1000,[14,21,41,1...|<br/>|572582.6692662078|360903.72|(1000,[0,7,278,32...|<br/>|572582.6692662078| 363411.0|(1000,[6,50,100],...|<br/>|572582.6692662078| 493043.0|(1000,[126],[4.51...|<br/>|572582.6692662078| 392120.0|(1000,[10,13,15,2...|<br/>|572582.6692662078|342760.06|(1000,[10,13,15,4...|<br/>|572582.6692662078| 499920.0|(1000,[5,70,120,1...|<br/>|572582.6692662078| 500000.0|(1000,[1,28,86],[...|<br/>|572582.6692662078| 270187.7|(1000,[22,30,65,8...|<br/>|572582.6692662078| 429350.0|(1000,[247,348,42...|<br/>|572582.6692662078| 651706.0|(1000,[5,9,26,155...|<br/>|572582.6692662078|354885.22|(1000,[25,40,73,8...|<br/>|572582.6692662078|275643.97|(1000,[8,46,352,5...|<br/>|572582.6692662078|388824.47|(1000,[30,79,81,3...|<br/>|572582.6692662078| 535365.0|(1000,[4,6,7,22,1...|<br/>|572582.6692662078| 600000.0|(1000,[81,115,244...|<br/>+-----------------+---------+--------------------+<br/>Root Mean Squared Error (RMSE) on test data for decision tree = 9.77069e+06<br/>R2 on test data for decision tree = 0.0215811</span></pre><p id="f877" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj"> Q3。合同描述与中标金额的关系</strong></p><p id="81e3" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">从我们的两个模型获得的非常低的精度结果，我们可以得出结论，根据其描述来预测合同授予金额不是一个非常好的主意。实际上这两个信息是不相关的。</p><h1 id="6eca" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">结论</h1><p id="112c" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在数据探索和模型训练之后，我们能够回答所提出的问题。合同编号和合同金额之间没有关联，合同授予金额和合同说明之间也没有关系。更多细节，请查看我的<a class="ae jn" href="https://github.com/sushseqi/data_analysis" rel="noopener ugc nofollow" target="_blank"> GitHub </a>仓库中的笔记本。</p><p id="658f" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">A bientô:)</p></div></div>    
</body>
</html>