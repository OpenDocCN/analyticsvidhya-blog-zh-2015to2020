<html>
<head>
<title>How to Build a Sinatra Web App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建Sinatra网络应用程序</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-build-a-sinatra-web-app-cb2e31e12cb?source=collection_archive---------18-----------------------#2019-12-03">https://medium.com/analytics-vidhya/how-to-build-a-sinatra-web-app-cb2e31e12cb?source=collection_archive---------18-----------------------#2019-12-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ba7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是对Sinatra和ActiveRecord的介绍，以及我用来创建具有模型、视图、控制器(MVC)结构和数据持久性的全栈应用程序的一些方法。我目前正在开发一个应用程序，允许用户使用安全密码注册，并创建、读取、更新和删除订单。我在肉类市场的全食超市工作，每年的这个时候都会有成百上千的顾客订单，仅仅用纸和笔很难记录下来。我正在开发这个应用程序，希望有一天我能在工作中使用它来跟踪这些订单。</p><h1 id="7b98" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">那么从哪里开始呢？</h1><p id="50d6" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">在开始之前，您不需要确切地知道所有的代码，但是最好知道您希望成品看起来是什么样的，您希望它如何表现，以及诸如“我将有多少个模型？”这样的问题的答案"我需要使用什么数据类型？"在你继续和开始之前，这应该是清楚的。我的文件结构如下所示:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="7db1" class="kp je hi kl b fi kq kr l ks kt">├── Gemfile<br/>    ├── Gemfile.lock<br/>    ├── README.md<br/>    ├── Rakefile<br/>    ├── app<br/>    │ ├── controllers<br/>    │ │ ├── application_controller.rb<br/>    │ │ ├── users_controller.rb<br/>    │ │ ├── orders_controller.rb<br/>    │ │<br/>    │ ├── models<br/>    │ │ ├── user.rb<br/>    │ │ ├── order.rb<br/>    │ │ <br/>    │ |── views<br/>    │ ├── user<br/>    │ │ ├── signup.erb<br/>    │ │ ├── login.erb<br/>    │ │ <br/>    │ ├── orders<br/>    │    ├── show.erb<br/>    │    ├── new.erb<br/>    │    |── edit.erb<br/>    │  <br/>    │ <br/>    ├── config<br/>    │ └── environment.rb<br/>    ├── config.ru<br/>    ├── db<br/>    ├── public</span></pre><p id="a221" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我建立了基本的结构，我喜欢提交并推到GitHub。您应该在实际编码时间的每7-10分钟提交一次描述性的提交消息。</p><h1 id="7138" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">添加您的宝石</h1><p id="40f5" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">你可以随时添加更多的宝石，但在开始时，你需要添加一切将用于启动你的应用程序。这是我项目的gem文件:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="89be" class="kp je hi kl b fi kq kr l ks kt">source "https://rubygems.org"</span><span id="3e38" class="kp je hi kl b fi ku kr l ks kt">gem 'sinatra'<br/>gem 'activerecord', :require =&gt; 'active_record'<br/>gem 'sinatra-activerecord', :require =&gt; 'sinatra/activerecord'<br/>gem 'rake'<br/>gem 'require_all'<br/>gem 'sqlite3'<br/>gem 'thin'<br/>gem 'shotgun'<br/>gem 'pry'<br/>gem 'bcrypt'<br/>gem "tux"</span><span id="ccec" class="kp je hi kl b fi ku kr l ks kt">group :test do<br/>  gem 'rspec'<br/>  gem 'capybara'<br/>  gem 'rack-test'<br/>  gem 'database_cleaner', git: 'https://github.com/bmabey/database_cleaner.git'<br/>end</span></pre><h1 id="8c41" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">哦，这么重要的耙子</h1><p id="f3b9" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">Rakefile将需要“sinatra/activerecord/rake”并加载您的环境。我在自己的任务中添加了一个任务，启动一个“窥探”控制台来测试我的代码:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="99be" class="kp je hi kl b fi kq kr l ks kt">require_relative './config/environment'<br/>require 'sinatra/activerecord/rake'</span><span id="6935" class="kp je hi kl b fi ku kr l ks kt">task :console do<br/>    Pry.start<br/>end</span></pre><h1 id="4328" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">配置文件夹和environment.rb</h1><p id="8527" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">这可以被视为项目中最重要的文件之一。它是您描述所有其他依赖项的地方，也将用于装载您的数据库适配器。数据库适配器是ActiveRecord知道在哪里存储数据的方式。我正在使用SQLite查询语言。这是典型的环境。rb:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="9752" class="kp je hi kl b fi kq kr l ks kt">require 'bundler'<br/>Bundler.require<br/>ActiveRecord::Base.establish_connection(<br/>  :adapter =&gt; 'sqlite3',<br/>  :database =&gt; 'db/development.sqlite'<br/>)<br/>require_all 'app'</span></pre><h1 id="914d" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">数据库和迁移</h1><p id="71c0" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">一旦你的适配器，rakefile和你所有的宝石设置好了；您可以开始设置迁移和数据表。ActiveRecord为您提供了作为版本控制的强大迁移工具。您可以使用命令<code class="du kv kw kx kl b">rake db:create_migration NAME="name of migration"</code>创建这些版本。这将在您的“db”目录中自动生成一个“migrate”文件夹，您可以在其中执行创建表等操作。下面是我用来创建用户表的迁移:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="4596" class="kp je hi kl b fi kq kr l ks kt">class CreateUsers &lt; ActiveRecord::Migration[6.0]<br/>  def change<br/>    create_table :users do |t|<br/>      t.string :username<br/>      t.string :password_digest<br/>    end<br/>  end<br/>end</span></pre><h1 id="31aa" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">配置. ru</h1><p id="d301" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">config.ru文件是另一个非常重要的文件。该文件将加载您的环境并运行您的控制器:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="1c8d" class="kp je hi kl b fi kq kr l ks kt">require './config/environment'</span><span id="b88c" class="kp je hi kl b fi ku kr l ks kt">use UserController<br/>use OrdersController<br/>use Rack::MethodOverride<br/>run ApplicationController</span></pre><h1 id="7d97" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">应用控制器</h1><p id="1077" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">应用程序控制器将继承Sinatra，这将为它提供定义您的路线所需的所有功能。所有其他控制器都将继承这个控制器。如果您想要启用会话，它应该是这样的:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="7163" class="kp je hi kl b fi kq kr l ks kt">class ApplicationController &lt; Sinatra::Base</span><span id="d5d3" class="kp je hi kl b fi ku kr l ks kt">  configure do<br/>    set :public_folder, 'public'<br/>    set :views, 'app/views'<br/>    enable :sessions<br/>    set :session_secret, "session_secret"<br/>  end<br/></span><span id="f8b1" class="kp je hi kl b fi ku kr l ks kt">  get '/' do <br/>    "Hello, World!"<br/>  end</span><span id="82a4" class="kp je hi kl b fi ku kr l ks kt"> end</span></pre><h1 id="97f0" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">模型</h1><p id="245d" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">模型是继承自ActiveRecord的ruby类，active record将为它们提供对应用程序非常重要的所有关联所需的功能。这些有价值且近乎神奇的关联是通过使用像<code class="du kv kw kx kl b">has_many</code>和<code class="du kv kw kx kl b">belongs_to</code>这样的抽象来实现的。这里的另一个重要成分是<code class="du kv kw kx kl b">has_secure_password</code>，它将通过“bcrypt”宝石给这个类一个安全的密码:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="3aed" class="kp je hi kl b fi kq kr l ks kt">class User &lt; ActiveRecord::Base</span><span id="4485" class="kp je hi kl b fi ku kr l ks kt">has_many :orders<br/>has_secure_password</span><span id="81c3" class="kp je hi kl b fi ku kr l ks kt">end</span><span id="b591" class="kp je hi kl b fi ku kr l ks kt">class Order &lt; ActiveRecord::Base</span><span id="9cd7" class="kp je hi kl b fi ku kr l ks kt">belongs_to :user</span><span id="20e5" class="kp je hi kl b fi ku kr l ks kt">end</span></pre><h1 id="33d7" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">控制器、路线和视图</h1><p id="35ef" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">这就是Sinatra应用程序的基本结构。此时，您已经准备好构建您需要的任何路线和视图。</p></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><p id="1df1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lf">原载于2019年12月3日https://jcguest.github.io。</em></p></div></div>    
</body>
</html>