<html>
<head>
<title>Flutter Phone Authentication With firebase using Provider Package.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用提供商包的firebase的Flutter电话认证。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/flutter-phone-authentication-with-firebase-using-provider-package-55ffbce7c361?source=collection_archive---------2-----------------------#2020-06-06">https://medium.com/analytics-vidhya/flutter-phone-authentication-with-firebase-using-provider-package-55ffbce7c361?source=collection_archive---------2-----------------------#2020-06-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="242e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你好，今天我将讨论使用firebase和提供商包进行电话认证。因为我发现很难与供应商沟通，所以我会用我理解的最简单的方式来解释，尽管我尝试了很多次。这篇文章将包含13个步骤，让你们明白。</p><p id="9178" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一步:</p><ul class=""><li id="2a78" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">将您的应用程序连接到firebase</li><li id="ca93" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">设置电话授权</li><li id="4b10" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">导入<strong class="ih hj"> firebase_auth </strong>插件</li><li id="8bc2" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">在你的应用中设置身份验证功能</li><li id="47f2" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">将你的颤振app迁移到<a class="ae jr" href="https://flutter.dev/docs/development/packages-and-plugins/androidx-compatibility" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Android X </strong> </a> <strong class="ih hj">。</strong></li></ul><p id="4d99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤2:在pubspec.yaml文件中导入提供者包，并运行flutter pub get来升级依赖项。</p><p id="da9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤3:在lib文件夹中创建一个provider目录，并创建一个名为auth_provider的文件。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div class="er es js"><img src="../Images/02677e0705919e89e2810523ce75d1f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*FSQyO-aqhJ_u3F_UbMVwCQ.png"/></div></figure><p id="13e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤4:导入foundation.dart类。</p><p id="a900" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤5:创建一个名为AuthProvider的类:</p><p id="4b42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">具有ChangeNotifier{}的类AuthProvider</p><ol class=""><li id="304a" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ka jj jk jl bi translated">ChangeNotifier: Change notifier在应用程序中发生变化时使用，应用程序的逻辑是在provider类中定义的，它会通知那些subscribe侦听器，是的，我有一个值需要更改。</li></ol><p id="6b20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤6:现在让我们先回到我们的provider类，然后我们将来到auth_screen的UI，在AuthProvider类中:</p><ol class=""><li id="cde7" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ka jj jk jl bi translated">首先导入firebaseAuth.dart即:<strong class="ih hj">导入' package:firebase _ auth/firebase _ auth . dart '</strong>；</li><li id="cf2f" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ka jj jk jl bi translated">现在在AuthProvider类内部创建一个FirebaseAuth实例:<strong class="ih hj">final _ firebase auth</strong>= firebase auth。<em class="kb">实例</em>；</li><li id="b900" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ka jj jk jl bi translated">创建一个字符串类型的验证id变量。</li><li id="6c68" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ka jj jk jl bi translated">现在为verifyPhoneNumber创建一个方法，该方法有参数国家代码和字符串类型的手机号码，返回类型为Future <void>并带有async关键字，因为我们不想在执行电话身份验证时停止其他任务，这就是为什么我们使用async关键字，所以完整的函数定义为:</void></li></ol><pre class="jt ju jv jw fd kc kd ke kf aw kg bi"><span id="ae79" class="kh ki hi kd b fi kj kk l kl km">Future&lt;<strong class="kd hj">void</strong>&gt; verifyPhone(String countryCode, String mobile) <strong class="kd hj">async </strong>{<br/>  <strong class="kd hj">var </strong>mobileToSend = mobile;<br/>  <strong class="kd hj">final </strong>PhoneCodeSent smsOTPSent = (String verId, [int forceCodeResend]) {<br/>    <strong class="kd hj">this</strong>.<strong class="kd hj">verificationId </strong>= verId;<br/>  };<br/>  <strong class="kd hj">try </strong>{<br/>    <strong class="kd hj">await _firebaseAuth</strong>.verifyPhoneNumber(<br/>        phoneNumber: mobileToSend,<br/>        codeAutoRetrievalTimeout: (String verId) {<br/>          <em class="kb">//Starts the phone number verification process for the given phone number.<br/>          //Either sends an SMS with a 6 digit code to the phone number specified, or sign's the user in and [verificationCompleted] is called.<br/>          </em><strong class="kd hj">this</strong>.<strong class="kd hj">verificationId </strong>= verId;<br/>        },<br/>        codeSent: smsOTPSent,<br/>        timeout: <strong class="kd hj">const </strong>Duration(<br/>          seconds: 120,<br/>        ),<br/>        verificationCompleted: (AuthCredential phoneAuthCredential) {<br/>          print(phoneAuthCredential);<br/>        },<br/>        verificationFailed: (AuthException exceptio) {<br/>          <strong class="kd hj">throw </strong>exceptio;<br/>        });<br/>  } <strong class="kd hj">catch </strong>(e) {<br/>    <strong class="kd hj">throw </strong>e;<br/>  }<br/>}</span></pre><p id="3a45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的方法中，我们使用firebase发送给用户电话号码的OTP来验证电话号码。</p><p id="a6d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤7:创建另一种方法来验证OTP代码:下面是定义的方法:</p><pre class="jt ju jv jw fd kc kd ke kf aw kg bi"><span id="a0d8" class="kh ki hi kd b fi kj kk l kl km">Future&lt;<strong class="kd hj">void</strong>&gt; verifyOTP(String otp) <strong class="kd hj">async </strong>{<br/>  <strong class="kd hj">try </strong>{<br/>    <strong class="kd hj">final </strong>AuthCredential credential = PhoneAuthProvider.<em class="kb">getCredential</em>(<br/>      verificationId: <strong class="kd hj">verificationId</strong>,<br/>      smsCode: otp,<br/>    );<br/>    <strong class="kd hj">final </strong>AuthResult user =<br/>        <strong class="kd hj">await _firebaseAuth</strong>.signInWithCredential(credential);<br/>    <strong class="kd hj">final </strong>FirebaseUser currentUser = <strong class="kd hj">await _firebaseAuth</strong>.currentUser();<br/>    print(user);<br/><br/>    <strong class="kd hj">if </strong>(currentUser.<strong class="kd hj">uid </strong>!= <strong class="kd hj">""</strong>) {<br/>      print(currentUser.<strong class="kd hj">uid</strong>);<br/>    }<br/>  } <strong class="kd hj">catch </strong>(e) {<br/>    <strong class="kd hj">throw </strong>e;<br/>  }<br/>}<br/><br/>showError(error) {<br/>  <strong class="kd hj">throw </strong>error.toString();<br/>}</span></pre><p id="9cb1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的方法中，我们用firebase提供的代码来验证用户输入的代码。</p><p id="2c2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第八步:在你的pubspec.yaml文件中添加country_code_picker。</p><p id="47b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤9:在main.dart文件中注册你的provider，就像我定义的那样，基本上你在你想使用provider的窗口部件/屏幕的父级上面注册provider。它必须是该小部件的父级。返回main.dart文件中的代码注册authprovider:</p><pre class="jt ju jv jw fd kc kd ke kf aw kg bi"><span id="5f2d" class="kh ki hi kd b fi kj kk l kl km"><strong class="kd hj">import 'package:country_code_picker/country_localizations.dart'</strong>;<br/><strong class="kd hj">import 'package:flutter/material.dart'</strong>;<br/><br/><strong class="kd hj">import 'package:phone_auth_provider/provider/auth_provider.dart'</strong>;<br/><strong class="kd hj">import 'package:phone_auth_provider/screens/auth_screen.dart'</strong>;<br/><strong class="kd hj">import 'package:phone_auth_provider/screens/home_screen.dart'</strong>;<br/><strong class="kd hj">import 'package:phone_auth_provider/screens/verify_screen.dart'</strong>;<br/><strong class="kd hj">import 'package:provider/provider.dart'</strong>;<br/><br/><strong class="kd hj">void </strong>main() {<br/>  runApp(MyApp());<br/>}<br/><br/><strong class="kd hj">class </strong>MyApp <strong class="kd hj">extends </strong>StatelessWidget {<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    <strong class="kd hj">return </strong>ChangeNotifierProvider.value(<br/>      value: AuthProvider(),<br/>      child: MaterialApp(<br/>        supportedLocales: [<br/>          Locale(<strong class="kd hj">'en'</strong>),<br/>          Locale(<strong class="kd hj">'it'</strong>),<br/>          Locale(<strong class="kd hj">'fr'</strong>),<br/>          Locale(<strong class="kd hj">'es'</strong>),<br/>        ],<br/>        localizationsDelegates: [<br/>          CountryLocalizations.<em class="kb">delegate</em>,<br/>        ],<br/>        title: <strong class="kd hj">'Flutter Demo'</strong>,<br/>        debugShowCheckedModeBanner: <strong class="kd hj">false</strong>,<br/>        theme: ThemeData(<br/>          fontFamily: <strong class="kd hj">'oswald'</strong>,<br/>          primaryColor: Colors.<em class="kb">black</em>,<br/>          canvasColor: Colors.<em class="kb">white</em>,<br/>          appBarTheme: AppBarTheme(<br/>              actionsIconTheme: IconThemeData(<br/>                color: Colors.<em class="kb">black</em>,<br/>              ),<br/>              iconTheme: IconThemeData(color: Colors.<em class="kb">black</em>)),<br/>          textTheme: TextTheme(<br/>            headline6: TextStyle(<br/>              color: Colors.<em class="kb">black</em>,<br/>              fontSize: 24,<br/>              fontWeight: FontWeight.<em class="kb">w600</em>,<br/>            ),<br/>          ),<br/>          visualDensity: VisualDensity.<em class="kb">adaptivePlatformDensity</em>,<br/>        ),<br/>        home: AuthScreen(),<br/>        routes: {<br/>          VerifyScreen.<em class="kb">routeArgs</em>: (ctx) =&gt; VerifyScreen(),<br/>          HomeScreen.<em class="kb">routeArgs</em>: (ctx) =&gt; HomeScreen(),<br/>        },<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="6d94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤10:在lib中创建一个小部件文件夹，创建一个文件名user_text_field，并将以下代码复制粘贴到user_text_field类中:</p><pre class="jt ju jv jw fd kc kd ke kf aw kg bi"><span id="f063" class="kh ki hi kd b fi kj kk l kl km"><strong class="kd hj">import 'package:flutter/material.dart'</strong>;</span><span id="bcdf" class="kh ki hi kd b fi kn kk l kl km"><strong class="kd hj">class </strong>UserTextField <strong class="kd hj">extends </strong>StatelessWidget {<br/>  <strong class="kd hj">final titleLabel</strong>;<br/>  <strong class="kd hj">final maxLength</strong>;<br/>  <strong class="kd hj">final icon</strong>;<br/>  <strong class="kd hj">final controller</strong>;<br/>  <strong class="kd hj">final inputType</strong>;<br/>  UserTextField({@required <strong class="kd hj">this</strong>.<strong class="kd hj">titleLabel</strong>,@required <strong class="kd hj">this</strong>.<strong class="kd hj">maxLength</strong>,@required <strong class="kd hj">this</strong>.<strong class="kd hj">icon</strong>,@required <strong class="kd hj">this</strong>.<strong class="kd hj">controller</strong>,@required <strong class="kd hj">this</strong>.<strong class="kd hj">inputType</strong>});<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    <strong class="kd hj">return </strong>Padding(<br/>      padding: <strong class="kd hj">const </strong>EdgeInsets.all(10.0),<br/>      child: TextField(<br/>        maxLength: <strong class="kd hj">maxLength</strong>,<br/>        controller: <strong class="kd hj">controller</strong>,<br/>        keyboardType: <strong class="kd hj">inputType</strong>,<br/>        decoration: InputDecoration(</span><span id="1116" class="kh ki hi kd b fi kn kk l kl km">          labelText: <strong class="kd hj">titleLabel</strong>,<br/>          suffixIcon: Icon(<strong class="kd hj">icon</strong>,color: Colors.<em class="kb">black</em>,),<br/>          border: OutlineInputBorder(<br/>            borderRadius: BorderRadius.circular(10),<br/>            borderSide: BorderSide(color: Colors.<em class="kb">black</em>),<br/>          ),<br/>        ),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="39c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤11:在widgets文件夹中创建另一个名为rounded_button的类，然后将以下代码复制粘贴到其中:</p><pre class="jt ju jv jw fd kc kd ke kf aw kg bi"><span id="2eac" class="kh ki hi kd b fi kj kk l kl km"><strong class="kd hj">import 'package:flutter/material.dart'</strong>;</span><span id="f6f4" class="kh ki hi kd b fi kn kk l kl km"><strong class="kd hj">class </strong>RoundedButton <strong class="kd hj">extends </strong>StatelessWidget {<br/> <strong class="kd hj">final title</strong>;<br/> <strong class="kd hj">final </strong>Function <strong class="kd hj">onpressed</strong>;</span><span id="084c" class="kh ki hi kd b fi kn kk l kl km"> RoundedButton({@required <strong class="kd hj">this</strong>.<strong class="kd hj">title</strong>,@required <strong class="kd hj">this</strong>.<strong class="kd hj">onpressed</strong>});<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    <strong class="kd hj">return </strong>Padding(<br/>      padding: EdgeInsets.all(10),<br/>      child: RaisedButton(<br/>        elevation: 3,<br/>        shape: RoundedRectangleBorder(<br/>          borderRadius: BorderRadius.circular(10),<br/>        ),<br/>        onPressed: <strong class="kd hj">onpressed</strong>,<br/>        child: Text(<br/>          <strong class="kd hj">title</strong>,<br/>          style: Theme.<em class="kb">of</em>(context).<strong class="kd hj">textTheme</strong>.<strong class="kd hj">headline6</strong>.copyWith(<br/>                color: Colors.<em class="kb">white</em>,<br/>            fontSize: 14<br/>              ),<br/>        ),<br/>        color: Theme.<em class="kb">of</em>(context).<strong class="kd hj">primaryColor</strong>,<br/>        splashColor: Colors.<em class="kb">green</em>,<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="a123" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤12:为PhoneAuthScreen创建一个UI，即在lib中创建一个文件夹，即screens，并在名为auth_screen的screens文件夹中创建一个类，然后复制粘贴以下代码:</p><pre class="jt ju jv jw fd kc kd ke kf aw kg bi"><span id="5fc5" class="kh ki hi kd b fi kj kk l kl km"><strong class="kd hj">import 'package:country_code_picker/country_code_picker.dart'</strong>;<br/><strong class="kd hj">import 'package:flutter/cupertino.dart'</strong>;<br/><strong class="kd hj">import 'package:flutter/material.dart'</strong>;<br/><strong class="kd hj">import 'package:flutter/services.dart'</strong>;<br/><strong class="kd hj">import 'package:flutter_uber_clone/screens/verify_screen.dart'</strong>;<br/><strong class="kd hj">import '../widgets/user_text_field.dart'</strong>;<br/><strong class="kd hj">import '../widgets/rounded_button.dart'</strong>;<br/><strong class="kd hj">import '../provider/auth_provider.dart'</strong>;<br/><strong class="kd hj">import 'package:provider/provider.dart'</strong>;<br/><br/><strong class="kd hj">class </strong>AuthScreen <strong class="kd hj">extends </strong>StatelessWidget {<br/>  <strong class="kd hj">final controller </strong>= TextEditingController();<br/><br/>  String <strong class="kd hj">selectedCountryCode </strong>= <strong class="kd hj">''</strong>;<br/><br/>  showSnackBar(msg, color, context) {<br/>    Scaffold.<em class="kb">of</em>(context).showSnackBar(<br/>      <strong class="kd hj">new </strong>SnackBar(<br/>        content: <strong class="kd hj">new </strong>Text(<br/>          msg,<br/>          style: TextStyle(<br/>            color: Colors.<em class="kb">white</em>,<br/>          ),<br/>        ),<br/>        duration: <strong class="kd hj">new </strong>Duration(seconds: 2),<br/>        behavior: SnackBarBehavior.<strong class="kd hj">floating</strong>,<br/>        elevation: 3.0,<br/>        backgroundColor: color,<br/>      ),<br/>    );<br/>  }<br/><br/>  <strong class="kd hj">void </strong>_showErrorDialog(BuildContext context, String message) {<br/>    showDialog(<br/>      context: context,<br/>      builder: (ctx) =&gt; AlertDialog(<br/>        title: Text(<strong class="kd hj">'Error Occured'</strong>),<br/>        content: Text(message),<br/>        actions: &lt;Widget&gt;[<br/>          FlatButton(<br/>            onPressed: () {<br/>              Navigator.<em class="kb">of</em>(ctx).pop();<br/>            },<br/>            child: Text(<strong class="kd hj">'OK!'</strong>),<br/>          )<br/>        ],<br/>      ),<br/>    );<br/>  }<br/><br/><br/>  verifyPhone(BuildContext context){<br/>    <strong class="kd hj">try </strong>{<br/>      Provider.<em class="kb">of</em>&lt;AuthProvider&gt;(context, listen: <strong class="kd hj">false</strong>)<br/>          .verifyPhone(<br/>          <strong class="kd hj">selectedCountryCode</strong>,<br/>          <strong class="kd hj">selectedCountryCode </strong>+<br/>              <strong class="kd hj">controller</strong>.<strong class="kd hj">text</strong>.toString())<br/>          .then((value) {<br/>        Navigator.<em class="kb">of</em>(context)<br/>            .pushNamed(VerifyScreen.<em class="kb">routeArgs</em>);<br/>      }).catchError((e) {<br/>        String errorMsg =<br/>            <strong class="kd hj">'Cant Authenticate you, Try Again Later'</strong>;<br/>        <strong class="kd hj">if </strong>(e.toString().contains(<br/>            <strong class="kd hj">'We have blocked all requests from this device due to unusual activity. Try again later.'</strong>)) {<br/>          errorMsg =<br/>          <strong class="kd hj">'Please wait as you have used limited number request'</strong>;<br/>        }<br/>        _showErrorDialog(context, errorMsg);<br/>      });<br/>    } <strong class="kd hj">catch </strong>(e) {<br/>      _showErrorDialog(context, e.toString());<br/>    }<br/>  }<br/><br/>  <strong class="kd hj">void </strong>_onCountryChange(CountryCode countryCode) {<br/>    <strong class="kd hj">selectedCountryCode </strong>= countryCode.toString();<br/>    print(<strong class="kd hj">"New Country selected: " </strong>+ countryCode.toString());<br/>  }<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    SystemChrome.<em class="kb">setSystemUIOverlayStyle</em>(<br/>        SystemUiOverlayStyle(statusBarColor: Colors.<em class="kb">transparent</em>));<br/>    <strong class="kd hj">return </strong>Scaffold(<br/>      backgroundColor: Colors.<em class="kb">white</em>,<br/>      body: SafeArea(<br/>        child: Center(<br/>          child: SingleChildScrollView(<br/>            child: Column(<br/>              mainAxisAlignment: MainAxisAlignment.<strong class="kd hj">center</strong>,<br/>              children: [<br/>                Align(<br/>                    alignment: Alignment.<em class="kb">centerLeft</em>,<br/>                    child: Padding(<br/>                      padding: <strong class="kd hj">const </strong>EdgeInsets.all(10.0),<br/>                      child: Text(<br/>                        <strong class="kd hj">'PickUp'</strong>,<br/>                        style: Theme.<em class="kb">of</em>(context).<strong class="kd hj">textTheme</strong>.<strong class="kd hj">headline6</strong>,<br/>                      ),<br/>                    )),<br/>                Align(<br/>                    alignment: Alignment.<em class="kb">center</em>,<br/>                    child: Padding(<br/>                      padding: <strong class="kd hj">const </strong>EdgeInsets.all(10.0),<br/>                      child: Text(<br/>                        <strong class="kd hj">'Please enter your number below'</strong>,<br/>                        style: Theme.<em class="kb">of</em>(context).<strong class="kd hj">textTheme</strong>.<strong class="kd hj">headline6</strong>,<br/>                      ),<br/>                    )),<br/>                CountryCodePicker(<br/>                  initialSelection: <strong class="kd hj">selectedCountryCode</strong>,<br/>                  onChanged: _onCountryChange,<br/>                  showCountryOnly: <strong class="kd hj">false</strong>,<br/>                  showOnlyCountryWhenClosed: <strong class="kd hj">false</strong>,<br/>                ),<br/>                UserTextField(<br/>                  titleLabel: <strong class="kd hj">'Enter your number'</strong>,<br/>                  maxLength: 10,<br/>                  icon: Icons.<em class="kb">smartphone</em>,<br/>                  controller: <strong class="kd hj">controller</strong>,<br/>                  inputType: TextInputType.<em class="kb">phone</em>,<br/>                ),<br/>                Align(<br/>                  alignment: Alignment.<em class="kb">centerRight</em>,<br/>                  child: RoundedButton(<br/>                    title: <strong class="kd hj">'Send OTP'</strong>,<br/>                    onpressed: () {<br/>                      verifyPhone(context);<br/>                    },<br/>                  ),<br/>                ),<br/>               <br/>              ],<br/>            ),<br/>          ),<br/>        ),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="0058" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，这也是上面定义的auth屏幕的主要部分，所以不要担心，我只是再次复制这个方法来让你们理解它。</p><pre class="jt ju jv jw fd kc kd ke kf aw kg bi"><span id="9e77" class="kh ki hi kd b fi kj kk l kl km">verifyPhone(BuildContext context){<br/>    <strong class="kd hj">try </strong>{<br/>      Provider.<em class="kb">of</em>&lt;AuthProvider&gt;(context, listen: <strong class="kd hj">false</strong>)<br/>          .verifyPhone(<br/>          <strong class="kd hj">selectedCountryCode</strong>,<br/>          <strong class="kd hj">selectedCountryCode </strong>+<br/>              <strong class="kd hj">controller</strong>.<strong class="kd hj">text</strong>.toString())<br/>          .then((value) {<br/>        Navigator.<em class="kb">of</em>(context)<br/>            .pushNamed(VerifyScreen.<em class="kb">routeArgs</em>);<br/>      }).catchError((e) {<br/>        String errorMsg =<br/>            <strong class="kd hj">'Cant Authenticate you, Try Again Later'</strong>;<br/>        <strong class="kd hj">if </strong>(e.toString().contains(<br/>            <strong class="kd hj">'We have blocked all requests from this device due to unusual activity. Try again later.'</strong>)) {<br/>          errorMsg =<br/>          <strong class="kd hj">'Please wait as you have used limited number request'</strong>;<br/>        }<br/>        _showErrorDialog(context, errorMsg);<br/>      });<br/>    } <strong class="kd hj">catch </strong>(e) {<br/>      _showErrorDialog(context, e.toString());<br/>    }<br/>  }</span></pre><p id="0bf1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的方法中，我们使用provider通过firebase验证电话号码，在构造函数中，我们通常传递小部件的上下文，但是当我们谈到listen: false时，就好像我们只希望数据在那个小部件中出现一次，我们不希望从这个提供程序连续获得数据，在我们希望数据出现在提供程序中一次而不订阅通知的情况下，我们将listen: false传递给构造函数的提供程序。Then()是在将来某个值返回后运行的方法，例如:当号码发送了otp后，我们想导航到另一个屏幕。</p><p id="223f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤13:现在在screens文件夹中创建另一个名为verify_screen的屏幕，并复制粘贴以下代码:</p><pre class="jt ju jv jw fd kc kd ke kf aw kg bi"><span id="5881" class="kh ki hi kd b fi kj kk l kl km"><strong class="kd hj">import 'package:flutter/material.dart'</strong>;<br/><strong class="kd hj">import 'package:flutter/services.dart'</strong>;<br/><strong class="kd hj">import 'package:phone_auth_provider/provider/auth_provider.dart'</strong>;<br/><strong class="kd hj">import 'package:phone_auth_provider/screens/home_screen.dart'</strong>;<br/><strong class="kd hj">import 'package:phone_auth_provider/widgets/rounded_button.dart'</strong>;<br/><strong class="kd hj">import 'package:phone_auth_provider/widgets/user_text_field.dart'</strong>;<br/><br/><strong class="kd hj">import 'package:provider/provider.dart'</strong>;<br/><br/><br/><strong class="kd hj">class </strong>VerifyScreen <strong class="kd hj">extends </strong>StatelessWidget {<br/>  <strong class="kd hj">static const </strong><em class="kb">routeArgs </em>= <strong class="kd hj">'/verify-screen'</strong>;<br/>  <strong class="kd hj">final controller </strong>= TextEditingController();<br/><br/>  showSnackBar(msg, color, context) {<br/>    Scaffold.<em class="kb">of</em>(context).showSnackBar(<br/>      <strong class="kd hj">new </strong>SnackBar(<br/>        content: <strong class="kd hj">new </strong>Text(<br/>          msg,<br/>          style: TextStyle(<br/>            color: Colors.<em class="kb">white</em>,<br/>          ),<br/>        ),<br/>        duration: <strong class="kd hj">new </strong>Duration(seconds: 2),<br/>        behavior: SnackBarBehavior.<strong class="kd hj">floating</strong>,<br/>        elevation: 3.0,<br/>        backgroundColor: color,<br/>      ),<br/>    );<br/>  }<br/><br/>  <strong class="kd hj">void </strong>_showErrorDialog(BuildContext context, String message) {<br/>    showDialog(<br/>      context: context,<br/>      builder: (ctx) =&gt; AlertDialog(<br/>        title: Text(<strong class="kd hj">'Error Occured'</strong>),<br/>        content: Text(message),<br/>        actions: &lt;Widget&gt;[<br/>          FlatButton(<br/>            onPressed: () {<br/>              Navigator.<em class="kb">of</em>(ctx).pop();<br/>            },<br/>            child: Text(<strong class="kd hj">'OK!'</strong>),<br/>          )<br/>        ],<br/>      ),<br/>    );<br/>  }<br/><br/>  verifyOTP(BuildContext context){<br/>    <strong class="kd hj">try </strong>{<br/>      Provider.<em class="kb">of</em>&lt;AuthProvider&gt;(context, listen: <strong class="kd hj">false</strong>)<br/>          .verifyOTP(<strong class="kd hj">controller</strong>.<strong class="kd hj">text</strong>.toString())<br/>          .then((_) {<br/>        Navigator.<em class="kb">of</em>(context)<br/>            .pushReplacementNamed(HomeScreen.<em class="kb">routeArgs</em>);<br/>      }).catchError((e) {<br/>        String errorMsg =<br/>            <strong class="kd hj">'Cant authentiate you Right now, Try again later!'</strong>;<br/>        <strong class="kd hj">if </strong>(e.toString().contains(<strong class="kd hj">"ERROR_SESSION_EXPIRED"</strong>)) {<br/>          errorMsg = <strong class="kd hj">"Session expired, please resend OTP!"</strong>;<br/>        } <strong class="kd hj">else if </strong>(e<br/>            .toString()<br/>            .contains(<strong class="kd hj">"ERROR_INVALID_VERIFICATION_CODE"</strong>)) {<br/>          errorMsg = <strong class="kd hj">"You have entered wrong OTP!"</strong>;<br/>        }<br/>        _showErrorDialog(context, errorMsg);<br/>      });<br/>    } <strong class="kd hj">catch </strong>(e) {<br/>      _showErrorDialog(context, e.toString());<br/>    }<br/>  }<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    SystemChrome.<em class="kb">setSystemUIOverlayStyle</em>(<br/>        SystemUiOverlayStyle(statusBarColor: Colors.<em class="kb">transparent</em>));<br/>    <strong class="kd hj">return </strong>Scaffold(<br/>      body: SafeArea(<br/>        child: Center(<br/>          child: SingleChildScrollView(<br/>            child: Column(<br/>              children: [<br/>                Align(<br/>                    alignment: Alignment.<em class="kb">centerLeft</em>,<br/>                    child: Padding(<br/>                      padding: <strong class="kd hj">const </strong>EdgeInsets.all(10.0),<br/>                      child: Text(<br/>                        <strong class="kd hj">'PickUp'</strong>,<br/>                        style: Theme.<em class="kb">of</em>(context).<strong class="kd hj">textTheme</strong>.<strong class="kd hj">headline6</strong>,<br/>                      ),<br/>                    )),<br/>                Align(<br/>                  alignment: Alignment.<em class="kb">center</em>,<br/>                  child: Padding(<br/>                    padding: <strong class="kd hj">const </strong>EdgeInsets.all(10.0),<br/>                    child: Text(<br/>                      <strong class="kd hj">'Please enter code sent to your number'</strong>,<br/>                      style: Theme.<em class="kb">of</em>(context).<strong class="kd hj">textTheme</strong>.<strong class="kd hj">headline6</strong>,<br/>                    ),<br/>                  ),<br/>                ),<br/>                UserTextField(<br/>                  titleLabel: <strong class="kd hj">'Enter 6 digit Code'</strong>,<br/>                  maxLength: 6,<br/>                  icon: Icons.<em class="kb">dialpad</em>,<br/>                  controller: <strong class="kd hj">controller</strong>,<br/>                  inputType: TextInputType.<em class="kb">phone</em>,<br/>                ),<br/>                Align(<br/>                  alignment: Alignment.<em class="kb">centerRight</em>,<br/>                  child: RoundedButton(<br/>                    title: <strong class="kd hj">'Verify Code'</strong>,<br/>                    onpressed: () {<br/>                     verifyOTP(context);<br/>                    },<br/>                  ),<br/>                ),<br/>               <br/>              ],<br/>            ),<br/>          ),<br/>        ),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="1e01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望你对提供商的一切都很清楚，因为我认为这是一个非常基本的逐步处理电话认证和提供商的方法。</p><p id="d0c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在运行你的应用程序，看看使用firebase的提供商和电话认证的魔力，也根据你的需要定制UI，因为我的目标是让你们了解它。</p><p id="9e1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您阅读这篇长文，但我希望您能清楚如何使用电话认证服务提供商。</p><p id="da84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Github Repo的代码在这里:</p><div class="ko kp ez fb kq kr"><a href="https://github.com/Mashood97/phone_auth_provider" rel="noopener  ugc nofollow" target="_blank"><div class="ks ab dw"><div class="kt ab ku cl cj kv"><h2 class="bd hj fi z dy kw ea eb kx ed ef hh bi translated">ma hood 97/phone _ auth _ provider</h2><div class="ky l"><h3 class="bd b fi z dy kw ea eb kx ed ef dx translated">一个新的颤振项目。这个项目是颤振应用的起点。一些帮助您入门的资源…</h3></div><div class="kz l"><p class="bd b fp z dy kw ea eb kx ed ef dx translated">github.com</p></div></div><div class="la l"><div class="lb l lc ld le la lf jy kr"/></div></div></a></div><p id="42b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你们喜欢这篇文章并想要更多的文章，不要忘记关注并留下一颗星。</p></div></div>    
</body>
</html>