<html>
<head>
<title>Web Scraping, Dealing with FTP Servers and other things — All in One</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">网页抓取，处理FTP服务器和其他事情——一切尽在其中</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/web-scraping-dealing-with-ftp-servers-and-other-things-all-in-one-a07b61421d14?source=collection_archive---------7-----------------------#2020-04-08">https://medium.com/analytics-vidhya/web-scraping-dealing-with-ftp-servers-and-other-things-all-in-one-a07b61421d14?source=collection_archive---------7-----------------------#2020-04-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/88112b700181f61f91953ea081c5f557.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*aAyj9YYZFf7-yDGVtWx6Ww.png"/></div></figure><h1 id="f313" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">介绍</h1><p id="8bce" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在这篇文章中，我将介绍用于网页抓取的Python代码，如何处理网页中的表格以及如何从FTP服务器下载文件。</p><p id="3ae1" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">网络抓取是一种从网站提取数据并以逻辑格式存储在本地文件或云中的技术。Web抓取的工作原理是遍历网站的HTML代码，并根据网站的各种标签从中提取数据。</p><p id="8799" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">我们将抓取德州铁路公司的网站,从那里的FTP服务器下载一些文件。这是一个相当复杂的网站，不同的数据集出现在多个表格中。每个表格有5列。我们对以下栏目感兴趣</p><ol class=""><li id="4467" class="ko kp hi jm b jn ki jr kj jv kq jz kr kd ks kh kt ku kv kw bi translated">数据集名称和描述—数据集的名称</li><li id="5679" class="ko kp hi jm b jn kx jr ky jv kz jz la kd lb kh kt ku kv kw bi translated">下载—链接到可以下载文件的FTP服务器</li><li id="34e6" class="ko kp hi jm b jn kx jr ky jv kz jz la kd lb kh kt ku kv kw bi translated">手动—下载列中文件的描述</li></ol><h1 id="e3c6" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">假设</h1><p id="9a24" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">文章假设——</p><ol class=""><li id="bc5c" class="ko kp hi jm b jn ki jr kj jv kq jz kr kd ks kh kt ku kv kw bi translated">你知道网页抓取的需求和使用案例——为什么需要等等。</li><li id="6aea" class="ko kp hi jm b jn kx jr ky jv kz jz la kd lb kh kt ku kv kw bi translated">您对HTML及其各种标签有基本的了解</li></ol><h1 id="fe08" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">步骤1 —检查网页</h1><p id="a545" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">web抓取的第一步<strong class="jm hj">是检查网页，找到标签，从那里提取数据。数据通常深埋在嵌套标签中。因此，我们检查网页，看看我们想要抓取的数据嵌套在哪个标签下。要知道标签，右击元素并从菜单中选择<em class="lc">检查元素(Q) </em>。</strong></p><figure class="le lf lg lh fd ij er es paragraph-image"><div class="er es ld"><img src="../Images/d8857fe2b5c09b057e49cc9565f93197.png" data-original-src="https://miro.medium.com/v2/resize:fit:284/format:webp/1*BBpk23itdqu6EHPPqNb5Bw.png"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">右键菜单</figcaption></figure><p id="31e5" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">在检查器框中，我们发现我们正在寻找的数据在带有<code class="du lm ln lo lp b">id = "production-data-table"</code>的表的主体<code class="du lm ln lo lp b">&lt;tbody&gt;</code>中。因此，要提取数据，首先我们必须定位表，然后定位它的body标签。</p><figure class="le lf lg lh fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/ba5434a5bd7a7f75542393a28930f036.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/1*0MeSbm1j94Mr3E8iokbinQ.png"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">检查员箱</figcaption></figure><h1 id="9372" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">第二步——获取网页</h1><p id="266e" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><strong class="jm hj">第二步</strong>是获取网页。Python中的<code class="du lm ln lo lp b">request</code>包用于获取URL的详细信息。</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="lr ls l"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">请求页面</figcaption></figure><h1 id="2e09" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">步骤3 —从网页中提取数据</h1><p id="1ec1" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">第三步是从我们在第一步中确定的相关部分中提取数据。</p><p id="0054" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">在内存中获得页面后，我们总是检查状态代码以确保页面下载成功(<code class="du lm ln lo lp b">page.status_code == 200</code>)。为了遍历网页，我们将使用<code class="du lm ln lo lp b">BeautifulSoup</code> Python包。soup对象使我们能够轻松地浏览网页的各种标签。</p><p id="5d50" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">从网站提取信息的这一步骤总是为手头的网站定制的，因为网页的结构、标签和id会因网站而异。所以下面的代码是为德州铁路公司网站定制的。</p><p id="60ae" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">正如在步骤1中已经发现的，我们要提取的数据在生产数据表中。这方面的代码如下。</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="lr ls l"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">从页面提取数据</figcaption></figure><p id="eeab" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">至此，我们已经将所有需要的数据提取到一个数据帧中。重命名列，以便于参考。</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="lr ls l"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">重命名列以便于处理</figcaption></figure><p id="ed13" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">数据帧如下所示</p><figure class="le lf lg lh fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/52ebceea2af1860f6f0a39d98cc94b0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*uc5V0rkdumXHsilMjePw7w.png"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">带有网页表格数据的数据框</figcaption></figure><h1 id="b393" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">步骤4 —清洁数据框</h1><p id="a62c" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">清理数据帧，轻松提取有意义的信息。创建了4个新列来存储url和格式。</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="lr ls l"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">清理数据帧以进行处理</figcaption></figure><p id="e4e8" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">更新后的数据帧如下所示</p><figure class="le lf lg lh fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/bd43722ad2dda8e6e85543de14858a8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*s_Krz12WbN2jRaAiQpfl8A.png"/></div></figure><p id="b51d" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated"><code class="du lm ln lo lp b">data_url</code>和<code class="du lm ln lo lp b">data_desc_url </code>列中的信息是重复的，意味着前3行的数据是相同的，即所有天然气分类帐分布和所有石油分类帐分布等的数据。是一样的。所有与天然气分类帐、石油分类帐等相关的数据。应该下载到不同的文件夹中。进一步清理数据帧以仅保留唯一的行。</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="lr ls l"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">在正则表达式处理后只保留唯一的行</figcaption></figure><p id="bf42" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">上面的代码导致</p><figure class="le lf lg lh fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/e868f7f38c1d5d241d145da8b43236a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*P58uJ4lNtNBEpW6BIIjNCQ.png"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">唯一数据</figcaption></figure><h1 id="2de3" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">步骤5-从FTP服务器提取文件列表</h1><p id="fad7" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">【ftp://ftpe.rrc.texas.gov/shgled T2】中的URL是保存所有文件的目录的链接。要提取文件列表，我们必须将FTP基本URL和文件夹名称分开。</p><h2 id="d116" class="lu in hi bd io lv lw lx is ly lz ma iw jv mb mc ja jz md me je kd mf mg ji mh bi translated">步骤5A —使用FTP基本URL和文件夹创建列</h2><p id="13e6" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">使用regex为FTP基本URL和文件夹名称创建新列</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="lr ls l"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">使用FTP基本URL和文件夹名称创建新列</figcaption></figure><figure class="le lf lg lh fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/75e676185cf8a6f82a20ccb6b3cf0a05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*I8f8tegSCkRKWzNZUu9DSQ.png"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">带有FTP基本URL和文件夹名称的数据帧</figcaption></figure><h2 id="9f01" class="lu in hi bd io lv lw lx is ly lz ma iw jv mb mc ja jz md me je kd mf mg ji mh bi translated">步骤5B —提取文件列表</h2><p id="5546" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">Python包<code class="du lm ln lo lp b">ftplib</code>用于从FTP服务器提取信息。首先，我们必须登录到FTP服务器，改变工作目录，然后提取文件列表。</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="lr ls l"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">提取文件列表</figcaption></figure><p id="fa4e" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">执行上述操作后的数据帧为</p><figure class="le lf lg lh fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/1865d4edd98425fb2145ce73c7fe6864.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*ayud9N9P6CxDu3_kgusnXQ.png"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">具有新列的数据帧，包含FTP服务器中的文件列表</figcaption></figure><h1 id="e7fd" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">步骤6-从FTP服务器下载文件</h1><p id="ae0a" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">首先基于<code class="du lm ln lo lp b">dataset_name</code>列创建文件夹。创建文件夹后，根据<code class="du lm ln lo lp b">file_url_list</code>栏中的文件列表下载文件。从FTP和HTTP服务器下载文件是不一样的。从FTP服务器下载文件的步骤是不同的。下载文件的代码如下</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="lr ls l"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">从FTP服务器下载文件</figcaption></figure><p id="f6f2" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">执行上述代码后，将创建新的文件夹和文件。</p><figure class="le lf lg lh fd ij er es paragraph-image"><div class="er es mi"><img src="../Images/aa50d1fa4ea6e6cd98aaf5c54ffd12cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:444/format:webp/1*V4IQwaqWHPr5z31kn4h1NQ.png"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">创建的文件夹</figcaption></figure><figure class="le lf lg lh fd ij er es paragraph-image"><div class="er es mj"><img src="../Images/e35619df1edbb8a0dd3f6bd1ea243f4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:530/format:webp/1*k-nAP7RPcsEDCxLkScB6WQ.png"/></div></figure><h1 id="f7aa" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">结论</h1><p id="c127" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在这篇文章中，我详细描述了抓取网页、从网页表格中读取数据以及从FTP服务器下载文件所需的步骤。</p></div></div>    
</body>
</html>