<html>
<head>
<title>From data preparation to parameter tuning using Tensorflow for training with RNNs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从数据准备到参数调整使用Tensorflow进行RNNs训练</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/from-data-preparation-to-parameter-tuning-using-tensorflow-for-training-with-rnns-24610783aeb1?source=collection_archive---------18-----------------------#2020-04-16">https://medium.com/analytics-vidhya/from-data-preparation-to-parameter-tuning-using-tensorflow-for-training-with-rnns-24610783aeb1?source=collection_archive---------18-----------------------#2020-04-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/9a98f8231b8c4e34ca30ea454e58063d.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*3JOPNppgE-jr18gt_o201A.jpeg"/></div><figcaption class="im in et er es io ip bd b be z dx translated">来源:https://www.liberaldictionary.com/forecast/</figcaption></figure><p id="b26c" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">这个笔记本让你自信的重点是使用Tensorflow进行数据准备和参数调优。</p><p id="af7a" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">当涉及时间序列数据时，递归神经网络是一种强有力的预测工具。当我开始第一次阅读它们时，我看到一篇博客文章说:“学习RNNs的最好方法是使用它们。”直接进入RNNs的数学方面可能是相当令人生畏的。虽然数学是必不可少的，但能够将RNNs与Tensorflow等工具结合使用确实会建立信心，我建议这样做。</p><p id="56a1" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">在本文中，我们将介绍:</p><ol class=""><li id="fb4b" class="jp jq hi it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx bi translated">数据生成</li><li id="46a7" class="jp jq hi it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx bi translated">使用Tensorflow进行数据准备</li><li id="7d20" class="jp jq hi it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx bi translated">模型训练和参数调整</li><li id="1f70" class="jp jq hi it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx bi translated">预言；预测；预告</li></ol><p id="5374" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">开始吧！<a class="ae iq" href="https://github.com/padmaja-kulkarni/MachineLearningMadeFun/blob/master/RNNTutorial/RNNTutorial.ipynb" rel="noopener ugc nofollow" target="_blank">完整的代码可以从这里访问。</a></p><ol class=""><li id="d53d" class="jp jq hi it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx bi translated"><strong class="it hj">数据生成</strong></li></ol><p id="f4fa" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">在生成数据集之前，让我们编写导入。</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="52be" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">在这篇文章中，我使用了我在下面的代码中创建的时间序列数据。这个数据是以90天为周期的季节性数据，我也添加了一些噪声。让我们分开训练和测试数据。</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es kj"><img src="../Images/1ae988fc672c1687ce3b1366c6bded96.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*wA2uZ2quQTvKgWocHS1XSw.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">时间序列数据</figcaption></figure><p id="bbd7" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj"> 2。数据准备</strong></p><p id="65f0" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">一旦我们有了数据，让我们从RNN开始准备。</p><p id="867a" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">RNN体系结构考虑了时态数据，并可以用它来预测未来值。我们这里有一个单变量时间序列，只有一个变量，值！有了这些数据，现在我们要创建一个时间序列数据，用过去的m个值来预测最近的未来值，即在m+1时间。这里，一个数据点是一系列(m×1)值。让我们用下面的代码来做这件事。对于这个例子，让我们使用30的窗口大小。我们将在这里学习如何使用Tensorflow的数据函数。但在此之前，以下要点必不可少。</p><ol class=""><li id="d9da" class="jp jq hi it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx bi translated">为了确保算法不会从数据排序中学习，请始终打乱数据。</li><li id="fa9f" class="jp jq hi it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx bi translated">尝试几个窗户尺寸，选择一个合适的。</li><li id="7e74" class="jp jq hi it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx bi translated">这里，我们知道数据的季节性是90天，这个窗口大小或任何比这个更大的窗口大小都可以。</li></ol><p id="a290" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">下面是使用Tensorflow将我们的数据转换成时间序列数据格式的代码。让我们先来看看TensorFlow的各种数据API是如何处理我们的数据的。</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kk"><img src="../Images/cbd4a74f6ff9dcc506b0146f571bb199.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9w35kqEiXgJkDI9ZmxZY8A.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">了解Tensorflow的数据API</figcaption></figure><p id="7fbc" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">注意，在函数timeSeriesDataset()中，我们给窗口大小加1。这是为了让额外的数据点以后用作未来的预测值，如下面几行代码所示。这里，我们将数据集分成几批。建议批量大小为2的倍数，因为考虑到您电脑的内存设计，这样可能会有更好的结果。我使用32，因为我们的数据集不是很大。</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="4929" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">现在，我们已经准备好了我们的训练数据集！</p><p id="29a4" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj"> 3。模型训练和参数调整</strong></p><p id="b41d" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">让我们训练一个基本的RNN模型。这里我们使用两层RNN，每层64个单位。请注意，数据集最后一层的大小与我们的输出变量大小相同，即1。在代码中，我调用了一个函数LearningRateScheduler，它根据纪元编号改变学习速率。</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="d428" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">让我们看看学习率与损失的关系图是什么样子，这样我们就可以选择最佳的学习率。</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es kj"><img src="../Images/bb92894616e60376d0cbb2b9f73ab6be.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*2Y-gggIr0x3nZhALhHLfcA.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">图形学习率与损失</figcaption></figure><p id="dae4" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">现在，选择图形看起来稳定的学习率值，我们再次训练模型。在这里，我选择3 X10–3。</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="0a75" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">让我们写一个代码，看看我们的损失是如何演变的！</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="5f6a" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我们可以绘制图表，看看在最佳学习率下，我们的损失是如何下降的。</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es kj"><img src="../Images/68a7bca4962ce12512935a36ccaa5f99.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*rP9LP4ej7T4-VuIUUgBOtg.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">我们模型训练的平均绝对误差</figcaption></figure><p id="544b" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj"> 4。预测</strong></p><p id="2a3c" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">使用测试系列来预测和测试模型。</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div><figcaption class="im in et er es io ip bd b be z dx translated">测试集上的平均绝对误差为:4.3656874</figcaption></figure><p id="47ef" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">恭喜你！您已经成功构建并评估了您的第一个RNN模型。</p><p id="8766" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">现在，你应该在一个真实的数据集上尝试一下，例如，<a class="ae iq" href="http://archive.ics.uci.edu/ml/datasets/Solar+Flare" rel="noopener ugc nofollow" target="_blank">太阳耀斑数据</a>，看看你能否使用我在本文中使用的类似模型进行预测。祝你好运！</p></div></div>    
</body>
</html>