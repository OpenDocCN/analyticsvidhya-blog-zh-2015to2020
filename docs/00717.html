<html>
<head>
<title>How to extract information from your excel sheet using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python从excel表格中提取信息</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-extract-information-from-your-excel-sheet-using-python-5f4f518aec49?source=collection_archive---------0-----------------------#2019-08-31">https://medium.com/analytics-vidhya/how-to-extract-information-from-your-excel-sheet-using-python-5f4f518aec49?source=collection_archive---------0-----------------------#2019-08-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f0c99555ff1881e93d838192ebd8c97e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zXZJcDBWsOLxMLKBRhedgA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片由来自<a class="ae iu" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1280558" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a>的<a class="ae iu" href="https://pixabay.com/users/freephotocc-2275370/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1280558" rel="noopener ugc nofollow" target="_blank">安德里安·瓦雷亚努</a>拍摄</figcaption></figure><p id="2ea0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">编程的一个迷人之处在于，只需几行代码，你就可以让你的计算机执行一项任务，而这项任务如果由你自己来做，就会变得很平凡、很烦人。这些平凡的任务之一是从一个大的excel表格中提取信息。Python编程语言非常健壮，它的一个亮点是帮助我们自动化繁琐和重复的Excel任务。</p><p id="1c83" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这篇博文中，我们将一步一步地从excel表格中提取一些有价值的信息。我们将使用的excel表包含一家超市一个月的所有水果销售额。每一行都包含顾客购买水果的单独记录。excel表中有三列。A列给出了购买水果的每磅成本，B列给出了售出的磅数，C列给出了购买的总成本。excel表有23758行和4列。你可以在这里下载excel表格<a class="ae iu" href="https://drive.google.com/open?id=1cyNI4BKBBQvcVVsQgiiQFoCKRm0zeqwX" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="f3ba" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的目标是找出并记录当月每种水果的总销量和总购买量。你可以想象必须通过23758行来提取每个水果的信息的沮丧，我们很幸运，因为Python可以帮助我们很快完成这项任务。下面的步骤将深入而实用地解释如何使用Python来完成这项任务。</p><p id="dc2b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们开始这项任务之前，我想假设您已经掌握了用Python编写代码的基本知识，并且您的计算机上已经安装了Python。</p><p id="24ae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">安装openpyxl模块<br/> 我们将使用的python模块是OpenPyXL模块。OpenPyXL模块是一个库，它允许您使用Python来读写excel文件或带有。xlsx/xlsm/xltx/xltm分机。如果您的IDE上没有安装它，您可以使用</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="f4a1" class="kc kd hi jy b fi ke kf l kg kh">pip install openpyxl</span></pre><p id="634b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要测试您是否成功安装了它，请使用</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="f687" class="kc kd hi jy b fi ke kf l kg kh">Import openpyxl</span></pre><p id="5117" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">到目前为止，没有返回任何错误。您已经安装了OpenPyXL模块，并准备好处理一些excel文档。</p><p id="30b7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">读入并使用OpenPyXL <br/> </strong>打开excel文档下一步是将Excel表读入我们的Python环境。确保您将使用的Excel在您当前的工作目录中(CWD)。您可以使用以下方式访问您的CWD:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="fa38" class="kc kd hi jy b fi ke kf l kg kh">import os <br/>os.getcwd()</span><span id="c764" class="kc kd hi jy b fi ki kf l kg kh">os.chdir() #this changes our CWD, if the excel sheet is not in CWD</span></pre><p id="094e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果excel表不在你的CWD里怎么办？您可以复制该文件并将其粘贴到您的CWD中，以便从那里访问它。一旦我们确定在CWD中有了Excel文档，我们现在就可以读入它了。<br/>在读取excel文档后，我们现在可以访问它以获得关于Excel表的各种信息。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="0546" class="kc kd hi jy b fi ke kf l kg kh">import pandas as pd <br/>file = ‘produceSales.xlsx’<br/>data = pd.ExcelFile(file)<br/>print(data.sheet_names) #this returns the all the sheets in the excel file<br/>[‘Sheet1’]</span></pre><p id="16b4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，我们将我们将要处理的工作表解析到一个数据框中，这将使我们能够知道我们的excel工作表是否被正确读入。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="b87a" class="kc kd hi jy b fi ke kf l kg kh">df = data.parse(‘Sheet1’)<br/>df.info</span><span id="bf28" class="kc kd hi jy b fi ki kf l kg kh">df.head(10)</span></pre><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es kj"><img src="../Images/b7faac636016119ed76bacde61f5dd83.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/0*TYZ7L4lArXqn-RiE"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">此图像显示了我们的工作表的前十行。</figcaption></figure><p id="4d11" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">读入电子表格数据<br/> </strong>下一步是从电子表格[Sheet1]读入数据。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="c5ac" class="kc kd hi jy b fi ke kf l kg kh">ps = openpyxl.load_workbook(‘produceSales.xlsx’)</span><span id="d7b9" class="kc kd hi jy b fi ki kf l kg kh">sheet = ps[‘Sheet1’]</span><span id="5503" class="kc kd hi jy b fi ki kf l kg kh">sheet.max_row <br/>#returns the total number of rows in the sheet<br/>23758</span></pre><p id="e90b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，我们使用For循环迭代工作表中的所有行。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="227b" class="kc kd hi jy b fi ke kf l kg kh">for row in range(2, sheet.max_row + 1):</span><span id="89b6" class="kc kd hi jy b fi ki kf l kg kh"># each row in the spreadsheet represents information for a particular purchase.</span><span id="8fe2" class="kc kd hi jy b fi ki kf l kg kh">produce = sheet[‘B’ + str(row)].value</span><span id="7543" class="kc kd hi jy b fi ki kf l kg kh">cost_per_pound = sheet[‘C’ + str(row)].value</span><span id="27d0" class="kc kd hi jy b fi ki kf l kg kh">pounds_sold = sheet[‘D’ + str(row)].value</span><span id="c416" class="kc kd hi jy b fi ki kf l kg kh">total_sales = sheet[‘E’ + str(row)].value</span><span id="9099" class="kc kd hi jy b fi ki kf l kg kh"># the first column is B followed by C and so on.</span><span id="1cd2" class="kc kd hi jy b fi ki kf l kg kh"># Each value in a cell is represented by a column letter and a row number. So #the first element in the sheet is B1, next column C1 and so on. This enables #to iterate over the entire cells.</span></pre><p id="2233" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建一个包含每种水果所有信息的空字典。然后，我们使用set.default()方法将第一组元素填充到字典中。set.default()第一个参数检查字典中是否存在该键，如果不存在，则用第二个参数替换它。这样，我们就可以开始用set.default函数的第二个参数填充我们的字典。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="87ee" class="kc kd hi jy b fi ke kf l kg kh">TotalInfo.setdefault(produce,{‘Total_cost_per_pound’: 0,<br/> ‘Total_pounds_sold’: 0, <br/> ‘Total_sales’: 0,<br/> ‘Total_Purchase_Instances’: 0})</span><span id="795b" class="kc kd hi jy b fi ki kf l kg kh"># so with this set default method, we have set all metrics we want to collect to zero. When we are iterating, we start from Zero and add new iterated to the dictionary. The key of the dictionary is the fruit which is mapped to their various metrics.</span></pre><p id="8f9f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，我们填充字典。对于在新行中看到的每个新产品，我们将在新行中增加其相应的值。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="6698" class="kc kd hi jy b fi ke kf l kg kh"># Each row represents a fruit, so increment by the new corresponding values. <br/> <br/> TotalInfo[produce][‘Total_cost_per_pound’] += float(cost_per_pound)</span><span id="7bea" class="kc kd hi jy b fi ki kf l kg kh">TotalInfo[produce][‘Total_pounds_sold’] += int(pounds_sold)<br/> <br/> TotalInfo[produce][‘Total_sales’] += int(total_sales)</span><span id="e3f1" class="kc kd hi jy b fi ki kf l kg kh"># Each row represents a fruit, so increment by one. <br/> <br/> TotalInfo[produce][‘Total_Purchase_Instances’] += 1</span></pre><p id="61b6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">运行该代码块后，我们将使用该月每种水果的所有不同指标填充TotalInfo字典。填充的字典如下所示:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="f471" class="kc kd hi jy b fi ke kf l kg kh">‘Apples’: {‘Total_Purchase_Instances’: 627,<br/> ‘Total_cost_per_pound’: 1178.7600000000068,<br/> ‘Total_pounds_sold’: 12119,<br/> ‘Total_sales’: 22999},</span></pre><p id="271b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">填充TotalInfo字典后，将结果写入文件<br/> </strong>。我们可以将这个填充的字典写入我们选择的任何文件，不管是. csv文件。txt，。我们将使用pprint.pformat模块漂亮地打印我们的字典的值，并且我们使用python的写模式将字典的值写到文件中。下面的代码片段给出了一个例子:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="aa55" class="kc kd hi jy b fi ke kf l kg kh">resultFile = open(‘Total_info.txt’, ‘w’)<br/>resultFile.write(pprint.pformat(TotalInfo))<br/>resultFile.close()<br/>print(‘Done.’)</span></pre><p id="4860" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Total_info.txt文件将在您的CWD中找到。<br/>您可以随时通过更改。txt扩展成你想要的任何文件格式。<br/>下面的代码片段显示了如何转换为. csv文件格式。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="408d" class="kc kd hi jy b fi ke kf l kg kh"> Open (‘Total_info.csv’, ‘w’)</span></pre><p id="ebe8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">结论<br/> </strong>在这篇博文中，我们展示了如何使用Python从excel表格中提取信息。知道如何从excel表格中获取信息总是一个受欢迎的补充，因为它为您节省了大量执行重复任务的时间。请随意修改文章中的代码以满足您的需要；你可以在这里访问包含这篇博文<a class="ae iu" href="http://github.com/Oluwabukunmige/Working-with-Excel-Sheets" rel="noopener ugc nofollow" target="_blank">中使用的端到端代码的笔记本。</a></p><p id="6eac" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">快乐的蟒蛇。</p></div></div>    
</body>
</html>