<html>
<head>
<title>Get started with Kaggle Competition: M5 Forecasting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kaggle竞赛入门:M5预测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/get-started-with-kaggle-competition-m5-forecasting-2aacd6822b36?source=collection_archive---------22-----------------------#2020-04-26">https://medium.com/analytics-vidhya/get-started-with-kaggle-competition-m5-forecasting-2aacd6822b36?source=collection_archive---------22-----------------------#2020-04-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d0df22fd4c054004bda07191d7f72f58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k2qs8Pw2cNvFddX6"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://unsplash.com/@alvaroserrano?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Á·阿尔瓦罗·塞拉诺</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h2 id="38a1" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">比赛描述:</h2><p id="2f88" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">在第五次迭代的竞赛中，您将使用全球收入最大的公司沃尔玛的分层销售数据来预测未来28天的日销售额。该数据涵盖了美国三个州<br/>(加利福尼亚州、得克萨斯州和威斯康星州)的商店，包括商品级别、部门、产品类别和商店详细信息。</p><p id="a41d" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">此外，它还有解释变量，如价格、促销、星期几和特殊事件。总之，这一强大的数据集可用于提高预测的准确性。</p><h2 id="03b7" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">数据:</h2><p id="34ae" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">我们已经提供了4个CSV文件</p><ol class=""><li id="d947" class="kt ku hi jv b jw ko ka kp jg kv jk kw jo kx kn ky kz la lb bi translated"><em class="lc">日历。csv: </em>包含关于产品销售日期的信息。</li><li id="997b" class="kt ku hi jv b jw ld ka le jg lf jk lg jo lh kn ky kz la lb bi translated"><em class="lc">sales _ train _ validation . CSV:</em>包含每个产品和商店的历史每日单位销售数据。</li><li id="f438" class="kt ku hi jv b jw ld ka le jg lf jk lg jo lh kn ky kz la lb bi translated"><em class="lc"> sell_prices.csv: </em>包含每个商店和日期销售的产品的价格信息。</li><li id="48d3" class="kt ku hi jv b jw ld ka le jg lf jk lg jo lh kn ky kz la lb bi translated"><em class="lc"> sample_submission.csv: </em>提交的正确格式。</li></ol><h2 id="1a0b" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">探索性数据分析:</h2><blockquote class="li lj lk"><p id="f40a" class="jt ju lc jv b jw ko jy jz ka kp kc kd ll kq kf kg lm kr ki kj ln ks kl km kn hb bi translated">在本文中，我们将只研究挑战<strong class="jv hj">的<strong class="jv hj"> EDA </strong>，而不是建模</strong>。</p></blockquote><p id="a385" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">读取数据</strong></p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="568c" class="iv iw hi lt b fi lx ly l lz ma">cal_data = pd.read_csv('calendar.csv')<br/>prices = pd.read_csv('sell_prices.csv')<br/>sales = pd.read_csv('sales_train_validation.csv')</span><span id="0107" class="iv iw hi lt b fi mb ly l lz ma">#Printing the shape<br/>print(cal_data.shape)<br/>print(prices.shape)<br/>print(sales.shape)</span></pre><p id="a3f7" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">日历数据有1969行14列，价格有68，41，121行4列，销售有30490行1919列。</p><blockquote class="mc"><p id="e84b" class="md me hi bd mf mg mh mi mj mk ml kn dx translated">开始销售数据的EDA</p></blockquote><p id="f93c" class="pw-post-body-paragraph jt ju hi jv b jw mm jy jz ka mn kc kd jg mo kf kg jk mp ki kj jo mq kl km kn hb bi translated"><strong class="jv hj">查看销售表的前五行</strong></p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mr"><img src="../Images/8e74d45c4c6210ead38fa6afde56b840.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mnFSblA99d5xn0TraS3kCQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">sales.head()</figcaption></figure><p id="beaf" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">销售数据中的每一个条目都对应于一个商店中每一种商品全天的销售量。<br/>例如:第一行对应于store_1中加利福尼亚州“爱好_1”部门的项目1。<br/>销售数据有1919列，其中6列是不同类型的id，其他1913列是从d_1到d_1913的天数。<br/>销售日期从2011年1月29日开始，到2016年4月24日结束。</p><p id="1156" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">寻找独特的商店、商品、部门和类别</strong></p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="bd46" class="iv iw hi lt b fi lx ly l lz ma">print('There are <strong class="lt hj">{0}</strong> items '.format(len(sales['item_id'].unique())))<br/>print('There are <strong class="lt hj">{0}</strong> depts'.format(len(sales['dept_id'].unique())))<br/>print('There are <strong class="lt hj">{0} </strong>categories'.format(len(sales['cat_id'].unique())))<br/>print('There are <strong class="lt hj">{0}</strong> stores'.format(len(sales['store_id'].unique())))<br/>print('There are <strong class="lt hj">{0}</strong> states'.format(len(sales['state_id'].unique())))</span></pre><p id="dc90" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">共有3049件商品，7个部门，3个类别，10个商店，横跨3个州。</p><p id="8daf" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">将天数转换为日期，以便更好地分析数据</strong></p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="692a" class="iv iw hi lt b fi lx ly l lz ma">date_list = [d.strftime('%Y-%m-<strong class="lt hj">%d</strong>') for d <strong class="lt hj">in</strong> pd.date_range(start = '2011-01-29', end = '2016-04-24')]</span><span id="5b2c" class="iv iw hi lt b fi mb ly l lz ma"><em class="lc">#Renaming days to dates</em><br/>sales_df.rename(columns=dict(zip(sales_df.columns[6:], date_list)),inplace=True)<br/>sales_df.head()</span></pre><p id="957f" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">根据不同的id汇总数据，以便更好地了解这些销售额的变化。</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="ba52" class="iv iw hi lt b fi lx ly l lz ma"><em class="lc">#Aggregating by mean the sales by department</em><br/>dept_mean = sales_df.groupby(['dept_id']).mean().T<br/>dept_mean.index = pd.to_datetime(dept_mean.index)</span><span id="2785" class="iv iw hi lt b fi mb ly l lz ma"><em class="lc">#Aggregating by mean the sales by categories</em><br/>cat_mean = sales_df.groupby(['cat_id']).mean().T<br/>cat_mean.index = pd.to_datetime(cat_mean.index)</span><span id="080a" class="iv iw hi lt b fi mb ly l lz ma"><em class="lc">#Aggregating by mean the sales by stores</em><br/>store_mean = sales_df.groupby(['store_id']).mean().T<br/>store_mean.index = pd.to_datetime(store_mean.index)</span><span id="e17c" class="iv iw hi lt b fi mb ly l lz ma"><em class="lc">#Aggregating by mean the sales by states</em><br/>state_mean = sales_df.groupby(['state_id']).mean().T<br/>state_mean.index = pd.to_datetime(state_mean.index)</span></pre><p id="4bdd" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">绘制数据</strong></p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="71ab" class="iv iw hi lt b fi lx ly l lz ma">'''The parameter 'm' is frequency (by month), this can be set by day, week or year and many more'''</span><span id="17d0" class="iv iw hi lt b fi mb ly l lz ma">create_plots(dept_mean,'m')<br/>create_plots(cat_mean,'m')<br/>create_plots(store_mean,'m')<br/>create_plots(state_mean,'m')</span></pre><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ms"><img src="../Images/ca00d9505254a21649b5a3cf368ab26a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wZCB4si1i8bmyC1xBmfTCw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">各部门月平均销售额</figcaption></figure><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/b4c5c099b30eb4e1e31451b2305d0cd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1AG_JaNGS0G8Ly_jCdLcTw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">每个商店的月平均销售额</figcaption></figure><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mu"><img src="../Images/d979731ff886e1da6e3708598ba77583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JkX8xlUsqi33VGrenPavcw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">每个类别的月平均销售额</figcaption></figure><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mv"><img src="../Images/22550662d15c46af02c48e81e0857126.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NOfFWQSFMl_UptwhazpCug.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">每个州的月平均销售额</figcaption></figure><p id="4156" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">调查结果</strong> : <br/> 1。在百货公司:FOODS_3卖得最高。<br/> 2。分类:食品销量最大。<br/> 3。在个体商店中:CA_3卖得最多。<br/> WI_2开始较低，但在2012年第一季度末水平突然上升。<br/>2013年初WI_3走下坡路。<br/>Ca2在2014年呈下降趋势，2015年呈上升趋势。<br/> 4。在州:CA卖的最多。</p><blockquote class="li lj lk"><p id="6904" class="jt ju lc jv b jw ko jy jz ka kp kc kd ll kq kf kg lm kr ki kj ln ks kl km kn hb bi translated">2012年的WI_2和2015年的CA_2出现了一个有趣的模式，让我们来看看这些</p></blockquote><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mw"><img src="../Images/4192c6f2162cf3656809a5a9ec45f002.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*udHqX-UQEjGVtCdM6WsX4A.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">2012年的WI_2</figcaption></figure><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/72633d159b3a2f741dd7b0dc53ef7d32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tsCzSwNSDtmkluachanbJA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">2015年二氧化碳</figcaption></figure><p id="23ec" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">我们可以看到，在这两种情况下，6月初的水平都有所上升，水平上升的部门也是相同的，即FOODS_3和FOODS_2。这可能是因为增加了新产品。</p><p id="5ee9" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">我们还可以绘制特定日期范围的数据</strong></p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/479f3c780da5f9ff9cbee6c91f440d4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hqXM7DCQdQm-Cd5RwbYyTA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">2012年3月至2014年3月按类别销售</figcaption></figure><p id="ccea" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">我们可以看到，就在1月前，<strong class="jv hj">销售额下降到零</strong>，<strong class="jv hj"> </strong>这是因为沃尔玛在圣诞节不营业。</p><blockquote class="mc"><p id="fa7f" class="md me hi bd mf mg mh mi mj mk ml kn dx translated">启动日历数据的EDA</p></blockquote><p id="52fa" class="pw-post-body-paragraph jt ju hi jv b jw mm jy jz ka mn kc kd jg mo kf kg jk mp ki kj jo mq kl km kn hb bi translated"><strong class="jv hj">查看日历的前五行</strong></p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mz"><img src="../Images/fb4b62da2c1e49e74cdea8d4dcb98df8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NE3tBl77HHsS3LlmNi0oBA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">cal_data.head()</figcaption></figure><p id="66d0" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">该数据包含有关每天活动的详细信息，还显示了哪一天允许抢购。在该数据中，SNAP在其中3个状态中遵循一定的模式。在CA中，前十天允许快照，TX遵循模式101–011，WI遵循模式011。</p><blockquote class="li lj lk"><p id="58c3" class="jt ju lc jv b jw ko jy jz ka kp kc kd ll kq kf kg lm kr ki kj ln ks kl km kn hb bi translated"><em class="hi">什么是SNAP: </em>美国联邦政府提供一项名为补充营养援助计划(SNAP)的营养援助福利。SNAP为低收入家庭和个人提供电子福利转移借记卡来购买食品。在许多州，货币福利在一个月的10天内发放给人们，在这10天中的每一天，1/10的人将从他们的卡上获得福利。</p></blockquote><p id="4de0" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">关于事件的调查结果</strong></p><p id="9305" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">事件通常具有空值，因为不是每天都有一个事件，查看数据我们知道，有162行event_name_1不为空，只有5行event_name_2不为空。<br/>总共有31个独特的事件，属于5个独特的类型，正如我们在162行之前看到的，给出的数据是5年的，所以这些事件每年都会发生</p><blockquote class="mc"><p id="a8ec" class="md me hi bd mf mg mh mi mj mk ml kn dx translated">开始价格数据的EDA</p></blockquote><p id="499a" class="pw-post-body-paragraph jt ju hi jv b jw mm jy jz ka mn kc kd jg mo kf kg jk mp ki kj jo mq kl km kn hb bi translated"><strong class="jv hj">查看前五行价格</strong></p><figure class="lo lp lq lr fd ij er es paragraph-image"><div class="er es na"><img src="../Images/5fc5f6560fa167925f986784d2bfdc31.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*V7brefQdX8UGKIBZCz67tQ.jpeg"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">prices.head()</figcaption></figure><p id="8ec6" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">该表为我们提供了特定一周内每个商店中每个商品的sell_price。</p><p id="a5fa" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">绘制直方图</strong></p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="cfd4" class="iv iw hi lt b fi lx ly l lz ma">prices['sell_price'].hist(bins=50)<br/>plt.xlim(0,25)</span></pre><figure class="lo lp lq lr fd ij er es paragraph-image"><div class="er es nb"><img src="../Images/7a5d8cbf9493270b1926e5ef87626700.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*-8kAdLxDhYJ4qvVPQzAolQ.jpeg"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">所有项目的价格范围</figcaption></figure><p id="7888" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">我们可以看到销售价格在0到25之间变化，有些商品超出了这个范围。价格最高的商品是<strong class="jv hj">家用_2_516 </strong>，售价为107.32英镑</p></div><div class="ab cl nc nd gp ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="hb hc hd he hf"><p id="cae5" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">EDA结束</p><h2 id="a919" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">后续步骤</h2><ol class=""><li id="d04b" class="kt ku hi jv b jw jx ka kb jg nj jk nk jo nl kn ky kz la lb bi translated">开始建模</li><li id="0b80" class="kt ku hi jv b jw ld ka le jg lf jk lg jo lh kn ky kz la lb bi translated">做更多的EDA来创造更多的功能</li></ol><h2 id="c559" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">链接</h2><p id="facf" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">比赛链接:<a class="ae iu" href="https://www.kaggle.com/c/m5-forecasting-accuracy" rel="noopener ugc nofollow" target="_blank"> M5预测准确率</a> <br/>内核链接:<a class="ae iu" href="https://www.kaggle.com/njain920/preliminary-eda" rel="noopener ugc nofollow" target="_blank">查看完整代码</a></p><h2 id="d79b" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">最终注释</h2><p id="2228" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">这是我第一次参加比赛，也是我第一次处理时间序列数据。<br/>我希望您能就时间序列和零售领域发表意见。<br/>谢谢！</p></div></div>    
</body>
</html>