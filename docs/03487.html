<html>
<head>
<title>Developing an Interactive Dashboard for Value Investment with Python, Dash and Pandas (Version 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python、Dash和Pandas开发价值投资的交互式仪表盘(第二版)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/developing-an-interactive-dashboard-for-value-investment-with-python-dash-and-pandas-version-2-2c2616542b5c?source=collection_archive---------3-----------------------#2020-02-04">https://medium.com/analytics-vidhya/developing-an-interactive-dashboard-for-value-investment-with-python-dash-and-pandas-version-2-2c2616542b5c?source=collection_archive---------3-----------------------#2020-02-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="b837" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi">利用Python, Dash和Pandas 建立互動式價值投資工具(第二版)</h1><p id="fab9" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这是该工具的旧版本。</p><p id="f5ee" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">请前往更新版本3:</strong><a class="ae kg" rel="noopener" href="/@lesterso1027/developing-an-interactive-dashboard-for-value-investment-with-python-dash-and-pandas-version-3-d39582a710d7"><strong class="jf hj">https://medium . com/@ Lester so 1027/developing-an-interactive-dashboard-for-value-investment-with-python-dash-and-pandas-version-3-d 39582 a 710d 7</strong></a></p><h2 id="7fde" class="kh ig hi bd ih ki kj kk il kl km kn ip jo ko kp it js kq kr ix jw ks kt jb ku bi translated"><strong class="ak"> 1。最终结果一瞥</strong></h2><p id="699e" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">1.1 GIF</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es kv"><img src="../Images/2e5c84062598194d91b362c51e856609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*XtaH8PJbXqn73CPd8pqlLA.gif"/></div><figcaption class="ld le et er es lf lg bd b be z dx translated">工具的图示</figcaption></figure><p id="c336" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">1.2链接</p><p id="a28d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">App链接:<a class="ae kg" href="https://stockdashboardlester.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://stockdashboardlester.herokuapp.com/</a></p><p id="b974" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">请允许仪表板使用一些时间来加载。我只在渲染上使用免费层服务，所以速度可能会受到限制。</p><p id="9d31" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">Github链接:<a class="ae kg" href="https://github.com/lester1027/ticker_dashboard" rel="noopener ugc nofollow" target="_blank">https://github.com/lester1027/ticker_dashboard</a></p><p id="2cad" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">1.3使用步骤</p><p id="0440" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">一、输入<a class="ae kg" href="https://stockdashboardlester.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://stockdashboardlester.herokuapp.com/</a>，输入账号为‘莱斯特’，密码为‘通配符’。</p><p id="2fab" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">二。在下拉列表中选择tickers(可以通过键入过滤结果)。</p><p id="872b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">三。选择日期范围并更新价格(这一步对于基本面分析是不必要的)。</p><p id="3085" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">四。输入百分比形式的安全裕度(用户可以保留默认值)。</p><p id="6492" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">动词 （verb的缩写）点击“获取数据”按钮。</p><p id="b795" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">不及物动词点击“计算内在价值”按钮，显示所选股票的财务数据和分析结果。“比较”一栏显示股票是高估还是低估。</p><p id="6b0f" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">七。如果财务数字显示为“9999999999”或“1e+10”，这意味着无法从数据源访问所需的数字，需要手动输入。“比较”列中的单元格将显示“错误”。</p><p id="b999" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">八。表格是完全可编辑的。如果出现如上所述的错误，或者用户希望对财务数字进行一些调整，则应编辑显示财务数字1至14的列。调整后，会自动重新计算内在价值。<strong class="jf hj">应仔细调整“3 _长期_增长率”列的值。</strong></p><p id="d9c1" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">九。如果在下拉列表中找不到要分析的股票，用户可以单击“添加空行”按钮，手动输入所有数字。</p><p id="eee2" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">1.4变更日志</p><p id="fa39" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">2020年5月24日</p><p id="187d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">更新了API的URL。</p><p id="4219" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">二。该表的显示得到了增强。</p><p id="07b4" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">2020年3月5日</p><p id="c194" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">I .在类Stock中添加一个URL构造私有方法。</p><p id="7553" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">二。为财务数据采集增加了错误处理。</p><p id="6835" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">三。增加一栏来说明股票是被低估了还是被高估了。</p><p id="5e27" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">四。该表格现在可编辑。</p><p id="8bb6" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">动词 （verb的缩写）整个工具部署在Heroku上。</p></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h2 id="be26" class="kh ig hi bd ih ki kj kk il kl km kn ip jo ko kp it js kq kr ix jw ks kt jb ku bi translated">2.动机</h2><p id="27fd" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在资本主义社会，没有额外收入的工资不能长期正常维持一个人的日常生活。完成大学学业后，对货币的需求会越来越大。为了有一个长期的被动收益，价值投资可以是一个不错的选择。基于基本面分析的股票价值投资忽略了股票价格的短期或中期波动。相反，它关注企业的基本方面，并提出一个核心问题:公司做得好吗？未来会做得好吗？要回答这个问题，通常需要从公司的资产负债表、现金流量表和损益表中收集大量的财务数据。他/她还必须进行一系列后续计算，以计算公司的内在价值。收集数据并逐一计算每个目标公司的内在价值可能非常耗时。所以这个小项目旨在让人们用便捷的方式做价值投资。</p></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h2 id="ee3f" class="kh ig hi bd ih ki kj kk il kl km kn ip jo ko kp it js kq kr ix jw ks kt jb ku bi translated">3.方法</h2><p id="b5b4" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">3.1.定义用于计算内在价值的函数</p><p id="2143" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">根据<a class="ae kg" href="https://www.investopedia.com/terms/d/dcf.asp" rel="noopener ugc nofollow" target="_blank">贴现现金流</a>方法定义函数。参数是下面介绍的财务数字，输出是每股的内在价值。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lo"><img src="../Images/92efb7bbab63cf0a81c32403d0f6c0b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mWHQ4Noafh_QIpcVjqyBdw.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">该仪表板中每股内在价值的计算</figcaption></figure><pre class="kw kx ky kz fd lt lu lv lw aw lx bi"><span id="4b0e" class="kh ig hi lu b fi ly lz l ma mb">def calculate_intrinsic_value(ttmFCF,sharesOutstanding,longTermGrowthRate,currentSharePrice,stockBeta,riskFreeRate,riskPremium,taxRate,longTermIntRate,marketCap,mvDebt,totalLiab,cce,gdpGrowthRate):</span><span id="aaea" class="kh ig hi lu b fi mc lz l ma mb"><em class="md">#a function for calculating the intrinsic value</em></span><span id="c454" class="kh ig hi lu b fi mc lz l ma mb"><em class="md">#this is used later for both after acquiring financial figures and</em></span><span id="0011" class="kh ig hi lu b fi mc lz l ma mb"><em class="md">#after changing values in the interactive table</em></span><span id="9e59" class="kh ig hi lu b fi mc lz l ma mb">r_e=riskFreeRate+stockBeta*riskPremium</span><span id="b8ee" class="kh ig hi lu b fi mc lz l ma mb">r_d=longTermIntRate*(1-taxRate)</span><span id="d50e" class="kh ig hi lu b fi mc lz l ma mb">wacc=(marketCap)/(marketCap+mvDebt)*r_e+(mvDebt)/(marketCap+mvDebt)*r_d</span><span id="a916" class="kh ig hi lu b fi mc lz l ma mb">projectedFCF=np.array([ttmFCF*(1+longTermGrowthRate)**n for n in range(11)])</span><span id="4511" class="kh ig hi lu b fi mc lz l ma mb">discountFact=np.array([1/(1+wacc)**n for n in range(11)])</span><span id="da62" class="kh ig hi lu b fi mc lz l ma mb">discountedFCF=projectedFCF[1:]*discountFact[1:]</span><span id="0515" class="kh ig hi lu b fi mc lz l ma mb">pvDiscountedFCF=discountedFCF.sum()</span><span id="8502" class="kh ig hi lu b fi mc lz l ma mb">perpetuityValue=(projectedFCF[-1]*(1+gdpGrowthRate))/(wacc-gdpGrowthRate)</span><span id="20f1" class="kh ig hi lu b fi mc lz l ma mb">terminalValue=perpetuityValue*discountFact[-1]</span><span id="a9a4" class="kh ig hi lu b fi mc lz l ma mb">intrinsicValuePerShare=(pvDiscountedFCF+terminalValue+cce-totalLiab)/sharesOutstanding</span><span id="8078" class="kh ig hi lu b fi mc lz l ma mb">return intrinsicValuePerShare</span></pre><p id="47e1" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">3.2.获取财务数据</p><p id="44ba" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">3.2.1.网络抓取与API</p><p id="d313" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">如上所述，基本面分析涉及到相当多的财务数据。获取实时或持续更新数据的最常见方法是网络抓取和API。前者通过分析html和json等格式的网站内容直接获取数据，而后者使用其他公司、权威机构或一些好心人提供的数据源。应该对网络抓取和API进行比较。</p><p id="740d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">网页抓取主要是免费的。对于想直接从网络上提取信息的人来说，这是相当有吸引力的。另一篇价值投资的中型文章用的就是这种方法(<a class="ae kg" href="https://towardsdatascience.com/value-investing-dashboard-with-python-beautiful-soup-and-dash-python-43002f6a97ca" rel="noopener" target="_blank">价值投资仪表盘配Python美汤和Dash Python </a>)。这篇文章启发了我，我找到了一本书<a class="ae kg" href="https://www.apress.com/gp/book/9781484239247" rel="noopener ugc nofollow" target="_blank">《用Python进行网站抓取:使用BeautifulSoup和Scrapy》，作者是加博·拉斯洛·哈伊巴</a>。在阅读了前三章并使用了里面的代码后，我承认对于像我这样想即时制作工具的人来说，学习曲线太陡了。此外，谷歌Chrome浏览器中的“检查元素”是一个典型的网络抓取技巧，并不总是能返回理想的结果。例如，<a class="ae kg" href="https://finance.yahoo.com/" rel="noopener ugc nofollow" target="_blank"> Yahoo Finance </a>没有用&lt; table &gt;标签包装数据，单元格中的数据没有唯一的id，这些都使得内容很难被抓取。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es me"><img src="../Images/4bac1460c942e12854d0856e2466b025.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xTwQpNNtzVOxDMtbKmxevA.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">雅虎财经没有使用通用的HTML <table>标签</table></figcaption></figure><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mf"><img src="../Images/5d92fbb1a2b4e8e2901b4f717f4215ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EU4j6VhVTuXcNMpPYGdL2w.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">维基百科使用普通的HTML <table>标签</table></figcaption></figure><p id="4747" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">使用网络抓取的另一个缺点是，这种方法容易受到网站结构变化的影响。如果有人试图用一次性的网络抓取方式下载数据集，这是可以的。然而，这不是长期使用的理想解决方案。</p><p id="43ec" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">API方法还有其他优点和缺点。使用它不需要任何麻烦的刮擦。你需要做的就是找到一个合适的API服务。然而，API可能不是免费的。许多API都在使用“免费增值”的定价方法。也就是说，低于特定请求次数的使用是免费的，而用户需要为超过该数量的任何请求付费。例如，在RapidAPI 中的Yahoo <a class="ae kg" href="https://rapidapi.com/apidojo/api/yahoo-finance1?endpoint=apiendpoint_2e0b16d4-a66b-469e-bc18-b60cec60661b" rel="noopener ugc nofollow" target="_blank"> Finance API有如下定价策略。用户每月可以免费申请500次，每月10美元可以申请10，000次。除了价格问题之外，API不能确保用户使用一致的数据格式。例如，在RapidAPI的雅虎财务API中，微软的季度资产负债表包含“无形资产”这一数字，而苹果的则没有。这可能会阻碍投资工具的自动化。</a></p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mg"><img src="../Images/fe5787b41a62dc8f0b20e94a05f4f57d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6EP_e5JdZbygCqqAM4GKYw.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">用无形资产</figcaption></figure><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mg"><img src="../Images/c455e1f9bbc15eaf34588a40ebfb35be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AaWcjRQzowr5YQH6bP9_Nw.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">没有无形资产</figcaption></figure><p id="8620" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">最初，我的想法是为全球股票市场创造一个工具。然而，我很快发现对于原型工具来说，这是一个过于雄心勃勃的目标。这是因为如果涉及全球市场，数据的不一致性可能会更严重。比如地质上离我住的地方更近的香港和上海市场，就没有发展完善的价格公道的价值投资API。美国至少有股票市场的埃德加数据。考虑到所有提到的标准，我决定使用<a class="ae kg" href="https://financialmodelingprep.com/developer/docs/" rel="noopener ugc nofollow" target="_blank">金融建模准备</a>服务来获取数据。这项服务是免费的，每个公司都有一致的数据格式。不幸的是，它只包括美国的股票。我想我现在只能这样了。</p><p id="a47f" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">并非所有的数据都可以从API中收集。我还需要从网站上搜集一些数据。比如，我从维基百科上得到了各国的<a class="ae kg" href="https://en.wikipedia.org/wiki/List_of_countries_by_real_GDP_growth_rate" rel="noopener ugc nofollow" target="_blank"> GDP增长率</a>。这很容易做到，因为我使用的网站只包含简单HTML &lt;表&gt;标签中的数据。</p><p id="bded" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">我使用的财务数字列表来自Udemy课程<a class="ae kg" href="https://www.udemy.com/course/value-investing-essential-guide-to-picking-stocks/" rel="noopener ugc nofollow" target="_blank">完整的价值投资课程(2020年更新)</a>。很好的介绍了价值投资。数字如下。</p><p id="3ee5" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">1.自由现金流</p><p id="3efd" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">2.已发行股票数量</p><p id="498d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">3.长期增长率</p><p id="a822" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">4.当前股价</p><p id="8978" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">5.股票贝塔</p><p id="723a" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">6.无风险利率</p><p id="76d8" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">7.市场风险溢价</p><p id="f316" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">8.营业税税率</p><p id="eb6a" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">9.估计利率</p><p id="4665" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">10.股权的市场价值</p><p id="9b54" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">11.债务的市值</p><p id="7abb" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">12.负债总额</p><p id="9822" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">13.现金和现金等价物</p><p id="a0e9" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">14.国内生产总值增长率</p><p id="74ce" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">首先，为所有公司股票定义一个“股票”类别。可以使用股票代号、价格趋势的期望开始日期、价格趋势的期望结束日期和分析的安全边际(稍后解释)将单个公司股票作为对象初始化。</p><pre class="kw kx ky kz fd lt lu lv lw aw lx bi"><span id="ff7a" class="kh ig hi lu b fi ly lz l ma mb">class Stock:</span><span id="cdfd" class="kh ig hi lu b fi mc lz l ma mb">def __init__(self,symbol,startDate,endDate,margin):</span><span id="8c8c" class="kh ig hi lu b fi mc lz l ma mb">self.symbol=symbol</span><span id="890b" class="kh ig hi lu b fi mc lz l ma mb">self.startDate=startDate</span><span id="dd41" class="kh ig hi lu b fi mc lz l ma mb">self.endDate=endDate</span><span id="6923" class="kh ig hi lu b fi mc lz l ma mb">self.safetyMargin=margin</span><span id="03ee" class="kh ig hi lu b fi mc lz l ma mb">self.debtPremium=1.3</span><span id="54ac" class="kh ig hi lu b fi mc lz l ma mb"><em class="md">#the number to indicate a financial figure that cannot be acquired successfully</em></span><span id="42ca" class="kh ig hi lu b fi mc lz l ma mb">self.epsilon=9999999999</span></pre><p id="e228" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">update_source()方法用于将指向对象本身的API链接或web抓取链接存储为数据。</p><pre class="kw kx ky kz fd lt lu lv lw aw lx bi"><span id="c0b2" class="kh ig hi lu b fi ly lz l ma mb">def update_source(self):</span><span id="6cf5" class="kh ig hi lu b fi mc lz l ma mb"><em class="md">#source of priceHistory</em></span><span id="3f35" class="kh ig hi lu b fi mc lz l ma mb">self.url_priceHistory =self._get_f_url('priceHistory',format=True)</span><span id="3622" class="kh ig hi lu b fi mc lz l ma mb"><em class="md">#source of figures 1</em></span><span id="19b1" class="kh ig hi lu b fi mc lz l ma mb">self.url_cashflowQuarter=self._get_f_url('cashflowQuarter',format=True)</span><span id="9888" class="kh ig hi lu b fi mc lz l ma mb">self.url_cashflow=self._get_f_url('cashflow',format=True)</span></pre><p id="4f26" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">update_price()方法用于从相应的链接中获取股票的历史价格，并将其存储为对象的数据。</p><pre class="kw kx ky kz fd lt lu lv lw aw lx bi"><span id="8721" class="kh ig hi lu b fi ly lz l ma mb">def update_price(self):</span><span id="5372" class="kh ig hi lu b fi mc lz l ma mb"><em class="md">#price history</em></span><span id="cad3" class="kh ig hi lu b fi mc lz l ma mb">self.response_priceHistory = requests.request("GET",self.url_priceHistory).json()['historical']</span><span id="3328" class="kh ig hi lu b fi mc lz l ma mb">self.priceHistory=pd.DataFrame(self.response_priceHistory)</span><span id="d133" class="kh ig hi lu b fi mc lz l ma mb">self.selectedPriceHistory=self.priceHistory[(self.priceHistory['date']&gt;self.startDate)&amp;(self.priceHistory['date']&lt;self.endDate)]</span></pre><p id="a5ad" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">update_data()方法用于从链接中获取所需的财务数字，计算所需的数字，并将它们全部存储为对象的数据。计算使用上文第3.1节中定义的函数。</p><pre class="kw kx ky kz fd lt lu lv lw aw lx bi"><span id="24a1" class="kh ig hi lu b fi ly lz l ma mb">def update_data(self):</span><span id="6ba1" class="kh ig hi lu b fi mc lz l ma mb"><em class="md">#Figure 2: Total number of shares outstanding</em></span><span id="9189" class="kh ig hi lu b fi mc lz l ma mb">try:</span><span id="b7b6" class="kh ig hi lu b fi mc lz l ma mb">self.sharesOutstanding=float(requests.request('GET',self.url_companyQuote).json()[0]['sharesOutstanding'])</span><span id="f642" class="kh ig hi lu b fi mc lz l ma mb">except:</span><span id="8c0f" class="kh ig hi lu b fi mc lz l ma mb">self.sharesOutstanding=self.epsilon</span></pre><p id="e09c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">3.3.列出股票代码和公司名称的字典</p><p id="240a" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这个工具涉及美国股票市场纳斯达克和纽约证券交易所。包含两个市场的股票代号和公司名称的pandas数据帧被组合在一起，形成一个列表供工具中的用户选择。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mh"><img src="../Images/cbfb893e4f475577a90d3685c7ab8ed6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Khnv6h7WxVMawg6DHUwNKQ.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">组合数据帧</figcaption></figure><p id="87eb" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">3.4.创建工具的布局</p><p id="aebb" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在参加了Udemy课程<a class="ae kg" href="https://www.udemy.com/course/interactive-python-dashboards-with-plotly-and-dash/" rel="noopener ugc nofollow" target="_blank">和Plotly以及Dash </a>的交互式Python仪表盘之后，我发现Dash适合我对用于基本面分析的交互式工具的需求。构建交互式表格需要一个名为“dashtable”的附加库。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mi"><img src="../Images/e07b15f913bfc5cb39cb3fee67443e1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FPxIiUmflNsrBnJGO3mOuA.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">仪表板布局</figcaption></figure><p id="d30c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在左上角，有仪表板的标题“股票报价机仪表板”。在标题下，有一个下拉组件供用户选择他们想要调查的股票。选择可以是多重的。此外，用户可以在下拉组件上键入内容，以搜索他们想要的公司符号和名称。该下拉组件中包含的选项由3.2节中提到的字典列表定义。所选股票符号用于价格趋势显示和下表中的基本面分析。在下拉组件的右侧，有一个日期范围选择器，供用户确定下面显示的价格的日期范围。旁边的“更新价格”按钮用于刷新下图。</p><p id="3095" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在价格趋势图中，股票收盘价以不同的颜色显示，图例显示在右侧。这个图表是交互式的。用户可以放大某个区域，改变坐标轴刻度，切换某些趋势的显示等。</p><p id="8802" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在图表下方，是仪表板工具的核心，即基本面分析部分。在进行分析之前，用户可以输入百分比形式的安全余量。该安全余量用于扣除计算出的具有一定百分比的股票内在价值，使得分析对于一些分析误差具有容限。安全余量旁边的“基本分析”按钮用于刷新下面的交互式表格，以显示重要的数字和分析结果。用户需要将“具有安全边际的每股内在价值”与“4”进行比较。“当前股价”。如果当前价格低于内在价值，且存在安全边际，则“低于”会显示在“比较”栏中，这意味着股票当前被低估，反之亦然。</p><p id="4a09" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">整个分析表是可编辑的。可以删除行和列。可以对列进行筛选或排序。用户可以更改从数据源获取的财务数字，并自行修改。要为手动数字输入添加一个完全空行，用户可以按表格下方的“添加空行”按钮。</p><p id="3738" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">3.5.创建回调函数</p><p id="9345" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在决定了仪表板的布局之后，必须定义回调函数来实现上述特性。这些功能是为仪表板设置的，以便对用户所做的更改做出反应。</p><p id="1feb" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">点击“更新价格”按钮可触发update_graph()函数。被触发后，它传递所选的股票符号、所选的开始和结束日期以及安全余量，以便为“股票”类创建新对象。然后调用get_source()和get_price()函数来获取价格趋势。返回的图形格式用于替换布局中的原始图形。</p><pre class="kw kx ky kz fd lt lu lv lw aw lx bi"><span id="e40c" class="kh ig hi lu b fi ly lz l ma mb"><em class="md">#callback functions</em></span><span id="500c" class="kh ig hi lu b fi mc lz l ma mb">@app.callback(</span><span id="eab5" class="kh ig hi lu b fi mc lz l ma mb">Output('my_graph', 'figure'),</span><span id="1dad" class="kh ig hi lu b fi mc lz l ma mb">[Input('price-button', 'n_clicks')],</span><span id="8a2f" class="kh ig hi lu b fi mc lz l ma mb">[State('my_ticker_symbol', 'value'),</span><span id="b756" class="kh ig hi lu b fi mc lz l ma mb">State('my_date_picker', 'start_date'),</span><span id="4e78" class="kh ig hi lu b fi mc lz l ma mb">State('my_date_picker', 'end_date'),</span><span id="47f2" class="kh ig hi lu b fi mc lz l ma mb">State('safety_margin','value')])</span><span id="b8f9" class="kh ig hi lu b fi mc lz l ma mb">def update_graph(n_clicks, stock_ticker, start_date, end_date, margin):</span><span id="b8a8" class="kh ig hi lu b fi mc lz l ma mb"><em class="md">#when the 'price-button' is clicked, display the close price data in the graph</em></span><span id="9e5e" class="kh ig hi lu b fi mc lz l ma mb">traces = []</span><span id="d95a" class="kh ig hi lu b fi mc lz l ma mb">for tic in stock_ticker:</span><span id="1ef1" class="kh ig hi lu b fi mc lz l ma mb">equity=Stock(tic,start_date[:10],end_date[:10],margin)</span><span id="2ef3" class="kh ig hi lu b fi mc lz l ma mb">equity.update_source()</span><span id="6340" class="kh ig hi lu b fi mc lz l ma mb">equity.update_price()</span><span id="9276" class="kh ig hi lu b fi mc lz l ma mb">traces.append({'x':equity.selectedPriceHistory['date'],'y': equity.selectedPriceHistory['close'], 'name':tic})</span><span id="b5ae" class="kh ig hi lu b fi mc lz l ma mb">fig = {</span><span id="6682" class="kh ig hi lu b fi mc lz l ma mb">'data': traces,</span><span id="8cd3" class="kh ig hi lu b fi mc lz l ma mb">'layout': {'title':', '.join(stock_ticker)+' Closing Prices'}</span><span id="568f" class="kh ig hi lu b fi mc lz l ma mb">}</span><span id="e145" class="kh ig hi lu b fi mc lz l ma mb">return fig</span></pre><p id="eb83" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">update_table()函数可以由三个变化触发。</p><p id="d95e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">一、点击“基本面分析”按钮。</p><p id="1795" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">二。更改表中的值</p><p id="42d0" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">三。单击“添加空行”按钮</p><p id="c795" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在被触发后，这个回调函数确定上面的哪个更改是最近完成的。</p><p id="7838" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">如果时间戳显示最后一次更改是点击“基本面分析”按钮，它将传递所选的股票符号、所选的开始和结束日期以及安全余量，以便为“股票”类创建新对象。然后调用update_source()和update_data()函数来获取财务数据并计算内在值。</p><p id="c6d3" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">如果最后更改的是表中的值，此函数将根据相同的管道重新计算固有值，并刷新结果。</p><p id="8ae3" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">如果最后一次更改是单击“添加空行”按钮，一个新的空行将被追加到表格中。该行也是可编辑的。</p><pre class="kw kx ky kz fd lt lu lv lw aw lx bi"><span id="b196" class="kh ig hi lu b fi ly lz l ma mb">@app.callback(</span><span id="f83f" class="kh ig hi lu b fi mc lz l ma mb">Output('table', 'data'),</span><span id="4d42" class="kh ig hi lu b fi mc lz l ma mb">[Input('analysis-button', 'n_clicks_timestamp'),</span><span id="11fb" class="kh ig hi lu b fi mc lz l ma mb">Input('table','data_timestamp'),</span><span id="3731" class="kh ig hi lu b fi mc lz l ma mb">Input('add-row-button','n_clicks_timestamp')],</span><span id="7eaf" class="kh ig hi lu b fi mc lz l ma mb">[State('my_ticker_symbol', 'value'),</span><span id="3154" class="kh ig hi lu b fi mc lz l ma mb">State('my_date_picker', 'start_date'),</span><span id="41e9" class="kh ig hi lu b fi mc lz l ma mb">State('my_date_picker', 'end_date'),</span><span id="df90" class="kh ig hi lu b fi mc lz l ma mb">State('safety_margin','value'),</span><span id="299f" class="kh ig hi lu b fi mc lz l ma mb">State('table','data')])</span><span id="ef51" class="kh ig hi lu b fi mc lz l ma mb">def update_table(analysis_timestamp, data_timestamp, add_row_timestamp, stock_ticker, start_date, end_date, margin ,rows):</span><span id="f4eb" class="kh ig hi lu b fi mc lz l ma mb">...</span></pre><h2 id="c53d" class="kh ig hi bd ih ki kj kk il kl km kn ip jo ko kp it js kq kr ix jw ks kt jb ku bi translated">4.结论</h2><p id="ed71" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这是我第一次尝试创建一个交互式仪表板并在线部署。我从中学到了很多。希望该工具对我自己有帮助，也可能对你们中的一些人有帮助。请随时给我留下任何意见。感谢您的阅读。</p></div></div>    
</body>
</html>