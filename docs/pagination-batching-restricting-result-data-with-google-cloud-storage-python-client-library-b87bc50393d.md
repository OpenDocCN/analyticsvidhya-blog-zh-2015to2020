# 使用 Google 云存储 python 客户端库对结果数据进行分页、批处理和限制

> 原文：<https://medium.com/analytics-vidhya/pagination-batching-restricting-result-data-with-google-cloud-storage-python-client-library-b87bc50393d?source=collection_archive---------8----------------------->

这篇文章展示了使用云存储 Python 客户端库时的一些最佳实践。具体来说，我将讨论如何发送批处理 API 请求、限制结果数据以及如何对结果进行分页。

# 定量

不要执行多种类似的 API 操作，只要适用，尝试批处理 API 调用，以减少您的客户端必须与云存储建立的 HTTP 连接的数量，从而减少操作开销并提高性能。

例如，如果您需要从 GCS 存储桶中删除大量文件，这就是您逐个删除它们的方法。下面的代码演示了如何使用**bucket . delete _ blob()**方法来删除 blob 列表，然后使用 **delete_blob()** 来删除每个单独的 blob。

更好的选择是进行一次批处理 API 调用来删除它们，尽管单个请求中 API 调用的最大数量被限制为 1000。下面的代码片段演示了批量删除操作，一次删除 1000 个对象，直到没有要删除的对象。

当测试删除 10，000 个对象时，顺序删除需要大约 3238 秒(大约 54 分钟)，而批量删除只需要 121 秒(大约 2 分钟)。

# 页码

使用*字段*参数中的**next page token***对结果进行分页。当您想要显示有限数量的结果，并且想要分割返回的数据并在多个页面中显示时，这很有用。*

# *部分响应*

*当您请求匹配前缀标准的 blob 列表时，默认情况下，服务器在处理请求后发送回 blob 的完整表示[。为了获得更好的性能，您可以要求服务器只发送您真正需要的字段，并得到一个*部分响应*。下面的代码使用*字段*参数只请求匹配对象的*名称*和*内容类型*。](https://cloud.google.com/storage/docs/json_api/v1/objects#resource-representations)*

# *补丁(部分更新)*

*修改资源时避免发送不必要的数据。要仅发送您正在更改的特定字段的更新数据，请使用 **PATCH** 方法。如果您想清除先前设置的数据，使用 **PUT** 。出于这个原因，使用补丁要安全得多。您只需为要更改的字段提供数据；您忽略的字段不会被清除。以下代码通过发送批处理补丁请求将*内容类型*元数据设置为 *image/png* 。*