<html>
<head>
<title>Rpy2 Made Easy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Rpy2变得简单</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/rpy2-made-easy-d67a9c8b84c8?source=collection_archive---------3-----------------------#2020-10-14">https://medium.com/analytics-vidhya/rpy2-made-easy-d67a9c8b84c8?source=collection_archive---------3-----------------------#2020-10-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="9d53" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">初学者使用Rpy2的综合指南</h2></div><blockquote class="ix iy iz"><p id="559e" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">两名数据科学家走进一家酒吧。他们都想使用Python中的R。瞧吧— <a class="ae jx" href="https://rpy2.github.io/doc/latest/html/index.html" rel="noopener ugc nofollow" target="_blank"> Rpy2 </a>。</p></blockquote><figure class="jz ka kb kc fd kd er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es jy"><img src="../Images/51fd2be0fdff103e9a72dcfd157b6208.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*unWORqfmDxHuxqw6qchcTg.jpeg"/></div></div></figure><p id="9456" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kk jl jm jn kl jp jq jr km jt ju jv jw hb bi translated">Rpy2(嵌入python中的R)使用起来相当吓人，这完全是因为它不像它的各个部分那样有血有肉。还因为单独使用R和python要容易得多，但是某些软件架构可能需要两者的结合。Python直观的数据结构、可视化库和优秀的IDE与R的可信包相结合，为数据科学家的开发提供了坚实的资源。</p><h1 id="d206" class="kn ko hi bd kp kq kr ks kt ku kv kw kx io ky ip kz ir la is lb iu lc iv ld le bi translated">如何设置</h1><ol class=""><li id="ea61" class="lf lg hi jd b je lh jh li kk lj kl lk km ll jw lm ln lo lp bi translated">如果你还没有的话，下载Python3+和R。</li><li id="9eb9" class="lf lg hi jd b je lq jh lr kk ls kl lt km lu jw lm ln lo lp bi translated">从<a class="ae jx" href="https://pypi.org/project/rpy2/" rel="noopener ugc nofollow" target="_blank">这里</a>安装Rpy2</li></ol><h1 id="9abb" class="kn ko hi bd kp kq kr ks kt ku kv kw kx io ky ip kz ir la is lb iu lc iv ld le bi translated">使用Python中的R包和函数</h1><p id="a187" class="pw-post-body-paragraph ja jb hi jd b je lh ij jg jh li im jj kk lv jm jn kl lw jq jr km lx ju jv jw hb bi translated">下面的例子展示了如何使用适当的包从python调用现有的R函数。将要进口的货物如下:</p><pre class="jz ka kb kc fd ly lz ma mb aw mc bi"><span id="acca" class="md ko hi lz b fi me mf l mg mh">#Import necessary packages<br/>import rpy2.robjects as robjects<br/>from rpy2.robjects.packages import importr<br/>from rpy2.robjects import pandas2ri<br/>#Must be activated<br/>pandas2ri.activate()</span></pre><p id="8f5d" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kk jl jm jn kl jp jq jr km jt ju jv jw hb bi translated">下面的代码片段展示了如何将R对象和包导入python。示例中使用了R中的时序对象和预测包。人们需要确保这些功能/包在R中独立工作。</p><pre class="jz ka kb kc fd ly lz ma mb aw mc bi"><span id="9a54" class="md ko hi lz b fi me mf l mg mh">time_series=robjects.r('ts')<br/>forecast_package=importr('forecast')</span></pre><p id="b647" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kk jl jm jn kl jp jq jr km jt ju jv jw hb bi translated">使用python中预测包中函数的时间:</p><pre class="jz ka kb kc fd ly lz ma mb aw mc bi"><span id="5fe6" class="md ko hi lz b fi me mf l mg mh">#converting the training data into an R time series object<br/>r_times_series_data=time_series(df["Actuals"].values,frequency=12)</span><span id="824f" class="md ko hi lz b fi mi mf l mg mh">#fit the Time series into a model<br/>#Using auto_arima<br/>fit_arima=forecast.auto_arima(r_times_series_data,seasonal=False)</span><span id="2fa1" class="md ko hi lz b fi mi mf l mg mh">#getting the forecast value<br/>forecasted_arima=forecast_package.forecast(fit_arima,h=10,level=(95.0))</span></pre><p id="9299" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kk jl jm jn kl jp jq jr km jt ju jv jw hb bi translated">变量“forecasted _ arima”是一个列表向量，一个R数据类型。用户可以打印列名来查找所需的列。以下几行可用于查找预测结果:</p><pre class="jz ka kb kc fd ly lz ma mb aw mc bi"><span id="9edb" class="md ko hi lz b fi me mf l mg mh">#The 3rd index has the forecast value for Arima.<br/>#NOTE: THE INDEX MAY NOT BE SAME FOR ALL MODELS<br/>arima_output=forecasted_arima[3]</span></pre><p id="550d" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kk jl jm jn kl jp jq jr km jt ju jv jw hb bi translated">或者，用户可以按如下方式使用列名来访问列:</p><pre class="jz ka kb kc fd ly lz ma mb aw mc bi"><span id="d7c8" class="md ko hi lz b fi me mf l mg mh">#Alternate way to find forecasted result<br/>arima_output=forecasted_arima<!-- -->.rx2("mean")</span></pre><h1 id="d313" class="kn ko hi bd kp kq kr ks kt ku kv kw kx io ky ip kz ir la is lb iu lc iv ld le bi translated">从Python调用现有的R函数</h1><p id="07dd" class="pw-post-body-paragraph ja jb hi jd b je lh ij jg jh li im jj kk lv jm jn kl lw jq jr km lx ju jv jw hb bi translated">假设有一个R代码，如下所示:</p><pre class="jz ka kb kc fd ly lz ma mb aw mc bi"><span id="b3d3" class="md ko hi lz b fi me mf l mg mh">#Saved in the file Forecast_r_function.r<br/>library(forecast)<br/>Forecast_r_function= function(actuals, freq){<br/>    y &lt;- ts(actuals,frequency = freq)<br/>    fit &lt;- auto.arima(y, seasonal=TRUE)<br/>    forecasted = forecast(fit, h=5)<br/>    return (forecasted)<br/>    }</span></pre><p id="e66a" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kk jl jm jn kl jp jq jr km jt ju jv jw hb bi translated">从python调用上述预测函数，需要进行以下导入:</p><pre class="jz ka kb kc fd ly lz ma mb aw mc bi"><span id="4a76" class="md ko hi lz b fi me mf l mg mh">#Import the <a class="ae jx" href="https://rpy2.github.io/doc/v3.0.x/html/robjects_rpackages.html#rpy2.robjects.packages.SignatureTranslatedAnonymousPackage" rel="noopener ugc nofollow" target="_blank">SignatureTranslatedAnonymousPackage</a> <br/>from rpy2.robjects.packages import STAP</span><span id="cd42" class="md ko hi lz b fi mi mf l mg mh">#Read the file with the R code snippetwith open('Forecast_r_function.r', 'r') as f:<br/>    string = f.read()</span><span id="50e5" class="md ko hi lz b fi mi mf l mg mh">#Parse using STAP<br/>forecast_func_in_python= STAP(string, "Forecast_r_function")</span></pre><p id="17f4" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kk jl jm jn kl jp jq jr km jt ju jv jw hb bi translated">上面的步骤使python中的R函数可用。可以通过以下方式访问它:</p><pre class="jz ka kb kc fd ly lz ma mb aw mc bi"><span id="c073" class="md ko hi lz b fi me mf l mg mh">#Calling R function<br/>forecasted_arima=forecast_func_in_python<!-- -->.<!-- -->Forecast_r_function<!-- -->(time_series, 10)<br/>#storing result<br/>arima_output=forecasted_arima<!-- -->.rx2("mean")</span></pre><h1 id="028b" class="kn ko hi bd kp kq kr ks kt ku kv kw kx io ky ip kz ir la is lb iu lc iv ld le bi translated">结论</h1><p id="b321" class="pw-post-body-paragraph ja jb hi jd b je lh ij jg jh li im jj kk lv jm jn kl lw jq jr km lx ju jv jw hb bi translated">在python框架中使用Rpy2还有许多其他方式，包括用python本身编写R代码的方式。然而，这些比这里阐述的更容易出错。</p><p id="2fbd" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kk jl jm jn kl jp jq jr km jt ju jv jw hb bi translated">数据科学家经常使用R和Python，如果使用得好的话，将一个嵌入另一个的接口确实非常强大。尽管它不是很受欢迎，但rpy2可以在设计和集成整体系统时为数据科学家和开发人员提供技术优势。</p></div><div class="ab cl mj mk gp ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="hb hc hd he hf"><p id="4b72" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kk jl jm jn kl jp jq jr km jt ju jv jw hb bi translated"><em class="jc">请通读rpy2文档</em> <a class="ae jx" href="https://rpy2.github.io/doc/v3.0.x/html/high-level.html" rel="noopener ugc nofollow" target="_blank"> <em class="jc">此处</em> </a> <em class="jc">。</em></p></div></div>    
</body>
</html>