<html>
<head>
<title>Looking for the Best Programming Language for Processing Excel Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">寻找处理Excel文件的最佳编程语言</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/looking-for-the-best-programming-language-for-processing-excel-files-3e83e73e93b5?source=collection_archive---------9-----------------------#2020-09-17">https://medium.com/analytics-vidhya/looking-for-the-best-programming-language-for-processing-excel-files-3e83e73e93b5?source=collection_archive---------9-----------------------#2020-09-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/5bfe243935404857a124872bc3216ae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*R-l_UsJwRXJIb9aVUdwj5A.png"/></div></figure><p id="856f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Excel文件常用于数据分析。有时需要一个程序来做分析。这要求编程语言能够方便地解析Excel文件。</p><p id="830e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">可以解析和处理Excel文件的编程语言:<br/> 1。通用的高级编程语言，比如Java<br/> 2。excel VBA；<br/> 3。Python<br/> 4。埃斯普罗克·SPL。</p><p id="b339" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在让我们看看这些语言是如何使用它们自己的方式来进行解析和处理的。在这里，我的重点是它们如何读入一个Excel文件作为结构化数据。仅简要说明如何根据具体要求进行后续处理、向数据库写入数据或数据操作。</p><h1 id="0118" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">一、高级语言(以Java为例)</h1><p id="264b" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">几乎所有的高级语言都可以读取Excel文件。重点是，如果没有第三方专业数据检索API，您需要编写自己的程序来根据目标Excel文件的结构读取数据。那需要大量的工作和努力。幸运的是，Java有Apache POI来读写Excel文件。API可以读取每个单元格的值和属性。现在让我们看看它是如何将Excel电子表格读入结构化数据的。</p><p id="9f10" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里有一个简单的Excel文件。第一行是列标题。所有其余的行都包含详细的数据行。该文件如下:</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div class="er es kn"><img src="../Images/a62542b74e6e509e4905dfa510b37b08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*cv5qfsU3SoWmHUPob0uRTg.png"/></div></figure><p id="5335" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要使用Java调用POI读取数据，我们有以下程序:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="042e" class="kx jl hi kt b fi ky kz l la lb">DataSet ds = null;   //A user-defined class that stores data read from the Excel file; <br/>HSSFWorkbook wb = new HSSFWorkbook( new FileInputStream( "simple.xls" ) );<br/>HSSFSheet sheet = wb.getSheetAt( 0 );  //Assume the to-be-read data is stored in the first sheet<br/>int rows = sheet.getLastRowNum();<br/>int cols = sheet.getRow(0).getLastCellNum();<br/>ds = new DataSet( rows, cols );<br/>for( int row = 0; row &lt;= rows; row++ ) {<br/>        HSSFRow r = sheet.getRow( row );<br/>        for( int col = 0; col &lt;= cols; col++ ) {<br/>        HSSFCell cell = r.getCell( col );<br/>        int type = cell.getCellType();<br/>        Object cellValue;   //Cell value object<br/>        switch( type ) {   //Switch cell value to corresponding Java object according to its type<br/>                case HSSFCell.CELL_TYPE_STRING:<br/>                        ......<br/>                case HSSFCell.CELL_TYPE_NUMERIC:<br/>                        ......<br/>                ......<br/>                // The cell value handling code is omitted<br/>        }<br/>        if( row == 0 ) ds.setColTitle( col, (String)cellValue );<br/>        else ds.setCellValue( row, col, cellValue );<br/>        //Set cell values of as column headers if they are in the 1st row, otherwise set them as a data set <br/>        }<br/>}</span></pre><p id="e93c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">该程序只能读入最简单格式的Excel文件。即使省略了单元格值处理部分，它也相当长。如果Excel文件具有复杂的格式，如合并单元格、复杂的多行表头、表尾、多行记录、交叉表等，将会更长、更复杂。</p><p id="ecd5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">即使有POI这样强大的开源包，用Java解析Excel文件仍然相当复杂。</p><p id="2904" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">此外，高级语言只提供低级功能，缺乏结构化数据计算的特殊功能，如数据集的过滤、排序、分组和聚合以及连接。程序员需要专门写他们的。因此，即使在读取和解析数据之后，仍有大量工作要做。</p><h1 id="2e55" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">二。超越VBA</h1><p id="cb65" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">VBA (Visual Basic for Applications)是一种基于Visual Basic的编程语言，可用于创建宏和扩展Windows Office应用程序，包括Word、Excel、Access等。它被嵌入到Excel中，以增加后者的灵活性和数据处理能力。它可以直接获取Excel单元格中的数据。自然的解析能力使它比Java这样的高级语言更方便。但是，它也缺乏结构化的计算功能。这意味着在检索数据后，您仍然需要为计算编写大量代码。</p><p id="bc29" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下面是进行分组和聚合的代码片段(在sheet1中分组列A和聚合列B):</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="2abf" class="kx jl hi kt b fi ky kz l la lb">Public Sub test()<br/>    Dim Arr<br/>    Dim MyRng As Range<br/>    Dim i As Long<br/>    Dim Dic As Object<br/>    Set MyRng = Range("A1").CurrentRegion<br/>    Set MyRng = MyRng.Offset(1).Resize(MyRng.Rows.Count - 1, 2)<br/>    Set Dic = CreateObject("Scripting.dictionary")<br/>    Arr = MyRng<br/>    For i = 1 To UBound(Arr)<br/>        If Not Dic.exists(Arr(i, 1)) Then<br/>            Dic.Add Arr(i, 1), Arr(i, 2)<br/>        Else<br/>            Dic.Item(Arr(i, 1)) = Dic.Item(Arr(i, 1)) + Arr(i, 2)<br/>        End If<br/>    Next i<br/>    Sheet2.Range("A1") = "subject"<br/>    Sheet2.Range("A2").Resize(Dic.Count) =   Application.WorksheetFunction.Transpose(Dic.keys)<br/>    Sheet2.Range("B1") = "subtotal"<br/>    Sheet2.Range("B2").Resize(Dic.Count) =   Application.WorksheetFunction.Transpose(Dic.items)<br/>    Set Dic = Nothing<br/>End Sub</span></pre><p id="8024" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">解析Excel文件不是我们的目标。它只是为后续的计算和操作服务。虽然VBA有解析Excel数据的内在能力，但不如处理它好。</p><h1 id="4724" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">三。计算机编程语言</h1><p id="ddbf" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">Python pandas提供了读取Excel文件的接口。我们可以用Python读取前面的简单格式Excel文件，代码如下:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="9a49" class="kx jl hi kt b fi ky kz l la lb">import pandas as pd</span><span id="2191" class="kx jl hi kt b fi lc kz l la lb">file = 'simple.xls'<br/>data = pd.read_excel(file,sheet_name='Sheet1',header=0)</span></pre><p id="7ad3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">将参数header设置为0 (header=0)意味着读取第一行作为列标题。“数据”是检索到的结构化数据集。</p><p id="839a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要读取具有复杂表格标题的Excel电子表格(如下所示):</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div class="er es ld"><img src="../Images/797639be22aa4c32df2989f529fdde4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*znaqZIAeTROPiUefBXzz0A.png"/></div></figure><p id="bbf3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Python程序如下:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="7633" class="kx jl hi kt b fi ky kz l la lb">import pandas as pd</span><span id="93b5" class="kx jl hi kt b fi lc kz l la lb">file = 'complex.xls'<br/>data = pd.read_excel(file,sheet_name='Sheet1',header=None,skiprows=[0,1,2,3])<br/>data.columns=['No', 'ItemCode', 'ItemName', 'Unit', 'Quantity', 'Price', 'Sum']</span></pre><p id="7b14" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">程序指定不读取表头，并从5个throw through参数开始跳过前4行(如果表尾存在，可以指定跳过表尾)。它在最后一行代码中为数据集“data”设置了别名。</p><p id="8252" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要读取交叉表(如下所示):</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div class="er es le"><img src="../Images/6809c3c9052da33056244e27be32bf7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*bYGXCXC-nfGJbKd4HhPpqg.png"/></div></figure><p id="a096" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您可以使用以下Python程序:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="6d99" class="kx jl hi kt b fi ky kz l la lb">import pandas as pd<br/>file = 'cross.xls'<br/>data = pd.read_excel(file,sheet_name='Sheet1',header=1)<br/>data = data.melt(id_vars=['Unnamed: 0'], <br/>        value_vars=['West', 'East','Center', 'North','South', 'Northwest','Southwest'],<br/>        var_name='Area',<br/>        value_name='Amount')<br/>data.rename(columns={'Unnamed: 0': 'Type'})</span></pre><p id="9897" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">检索到的数据如下:</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div class="er es lf"><img src="../Images/0534e22ee83d513d47581cb0d81f963a.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/format:webp/1*2CN9qPvVk0AdiV9wDkfpNA.png"/></div></figure><p id="fb1d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">用Python读取Excel文件比用Java简单。由于Pandas封装了结构化计算功能，Python对后续计算的支持比Java和VBA更强。这些使得Python可以很容易地处理小的Excel文件，这些文件可以全部加载到内存中。</p><p id="067f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Python的问题在于，它没有对无法一次性加载到内存中的大Excel文件的批处理方法。所以你必须为阅读和后续计算编写复杂的程序。阅读<a class="ae lg" href="http://c.raqsoft.com/article/1594003670080" rel="noopener ugc nofollow" target="_blank">Python如何处理大文件</a>了解更多。</p><h1 id="f552" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">四。埃斯普罗克SPL</h1><p id="73cd" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">作为专业的数据处理工具，esProc提供了多种读取Excel文件的方法。esProc所基于的脚本语言SPL封装了一个丰富的结构化计算函数库，该函数库可以出色地处理所有后续计算以及结果集的导出并将其写入数据库。</p><p id="d972" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">用于读取Excel数据的esProc程序非常简单。它只有一行代码:</p><p id="1577" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">1.读取简单格式的Excel文件</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="d070" class="kx jl hi kt b fi ky kz l la lb">=file(“simple.xls”).xlsimport@t()</span></pre><p id="3117" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">@t选项意味着将1行作为列标题读取</p><p id="a020" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">2.阅读带有复杂表格标题的Excel表格</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="02f6" class="kx jl hi kt b fi ky kz l la lb">=file(“complex.xls”).xlsimport(;1,5).rename(#1:No,#2:ItemCode,#3:ItemName,#4:Unit,#5:Quantity,#6:Price,#7:Sum)</span></pre><p id="0a24" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">参数1，5指定从5 throw开始读取sheet1(也可以指定结束行)；rename函数修改列名。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="9aa6" class="kx jl hi kt b fi ky kz l la lb">=file(“cross.xls”).xlsimport@t(;1,2).rename(#1:Type).pivot@r(Type;Area,Amount)</span></pre><p id="4e53" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">pivot函数按类型对记录进行分组，并执行转置。@r选项启用列到行的转置。换位后的新列名为“面积”和“金额”。</p><p id="d319" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">显然，在解析Excel文件时，esProc SPL生成的代码比Python pandas更简洁。实际上，SPL在处理后续计算方面更有竞争力。阅读<a class="ae lg" rel="noopener" href="/analytics-vidhya/looking-for-the-best-lightweight-data-analysis-script-tools-ccde17a63fc6">寻找最好的轻量级数据分析脚本工具</a>了解更多信息。</p><p id="018e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最重要的是，esProc SPL拥有光标机制，可以方便地处理大型Excel文件的读取和计算。这使得数据分析师能够使用类似于处理少量数据的语法，以直观、简单的方式处理相对大量的数据。以读取一个格式简单的大Excel文件为例，使用光标的程序如下:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="aaa8" class="kx jl hi kt b fi ky kz l la lb">=file(“big.xlsx”).xlsimport@tc()</span></pre><p id="9646" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">结论是:在Python pandas和esProc SPL中解析Excel文件都很简洁。两种语言都配备了丰富的结构化计算功能，可以很好地处理日常分析工作。</p></div></div>    
</body>
</html>