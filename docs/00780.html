<html>
<head>
<title>Designing Basic Network Scanner Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python设计基本网络扫描器</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/creating-own-network-scanner-using-python-f11a50a5ff77?source=collection_archive---------3-----------------------#2019-09-05">https://medium.com/analytics-vidhya/creating-own-network-scanner-using-python-f11a50a5ff77?source=collection_archive---------3-----------------------#2019-09-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/bc9b767991030346ff2174d7d0d7626b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UwaAIpO6UmRAY_ICQ9xikw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">马库斯·斯皮斯克在<a class="ae iu" href="https://unsplash.com/s/photos/network-scanner?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="bc2d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">信息收集是渗透测试或黑客攻击的关键之一。如果你没有足够的系统信息，你就无法控制或入侵系统。</p><p id="16b3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">假设您连接到一个网络，并且您的目标机器也连接到同一个网络。如何识别目标机器？为此，您需要知道目标机器的IP地址。因此，您需要发现该网络中的所有设备，收集它们的mac地址和IP地址是首要步骤。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jt"><img src="../Images/9da3258c2fcf0249ad2e0c0d8822c26c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o0Q5Qs4uLM8fFMC5H37p7A.png"/></div></div></figure><p id="4034" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以使用NMAP或网络发现；这些是发现设备的好方法。但是在这里，我们将给出一个基本步骤，让你使用python创建你的网络扫描器。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jy"><img src="../Images/9976a37e06dd2b580030f12a853782fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*Ow9ZDjFWnA66rmZ4tdiQbg.png"/></div></figure><p id="ea47" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的基本扫描仪将显示所有连接到网络的设备及其MAC地址和IP地址。您可以使用您的功能实现添加系统的操作系统版本和其他信息。</p><p id="462e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当我们学习新事物时，我们想知道它们的基础。我们将在下一节中介绍它们。我们想了解广播mac和ARP协议来设计这个网络扫描器。如果你知道这些事情，你可以去实现。</p><h2 id="5e4f" class="jz ka hi bd kb kc kd ke kf kg kh ki kj jg kk kl km jk kn ko kp jo kq kr ks kt bi translated">什么是广播Mac</h2><p id="d834" class="pw-post-body-paragraph iv iw hi ix b iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo ky jq jr js hb bi translated">BroadcastMac不是设备的Mac地址。这是一个虚拟地址。当需要将一些数据包发送到网络中的所有设备时，这些数据包应该发往广播IP地址。然后，路由器会自动将数据包发送到连接到同一网络的所有设备。广播的MAC地址是“ff:ff:ff:ff:ff:ff:ff”。</p><h2 id="6b5f" class="jz ka hi bd kb kc kd ke kf kg kh ki kj jg kk kl km jk kn ko kp jo kq kr ks kt bi translated">什么是ARP协议</h2><p id="bd73" class="pw-post-body-paragraph iv iw hi ix b iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo ky jq jr js hb bi translated">t用于发现与给定IP地址相关联的MAC地址。为了通过本地网络发送数据包，我们需要目的机器的MAC地址。当数据包在本地网络中传输时，它们的IP地址会从数据包中删除，而MAC地址则用于识别设备。在此阶段，我们将这些数据包命名为帧。ARP可以发现特定IP地址的MAC地址。</p><h2 id="314c" class="jz ka hi bd kb kc kd ke kf kg kh ki kj jg kk kl km jk kn ko kp jo kq kr ks kt bi translated">ARP是如何工作的？</h2><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kz"><img src="../Images/5196808e636d596dc33c43028525de72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DbXLu9jwTRK-qyYwrOayyA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Shutterstock.com(2019)。<em class="la">等长商人扩音器在集团股票矢量(免版税)前讲话699978403 </em>。【在线】可在:<a class="ae iu" href="https://www.shutterstock.com/image-vector/isometric-businessman-megaphone-speaking-before-group-699978403" rel="noopener ugc nofollow" target="_blank">https://www . shutterstock . com/image-vector/isometric-business-megahamper-speaking-before-group-699978403</a>【2019年9月4日访问】。</figcaption></figure><p id="0427" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当一台机器(192.168.1.4)想知道目标IP地址(192.168.1.3)的MAC地址时，它会发送ARP请求，以广播MAC，消息类似于“谁有这个IP地址”。例如，如果目标IP地址是192.168.1.3，则消息看起来像“谁拥有192.168.1.3”。</p><p id="01c9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">广播MAC会将此数据包发送到网络中的每台设备。因此最终网络中的所有设备都会收到这个数据包。</p><p id="c5e9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">IP地址不等于目标IP地址(192.168.1.3)的设备会丢弃数据包。目标IP地址机器只发送类似“我是这个IP地址，我的Mac地址是这个”的响应消息。例如，消息在发送方(192.168.1.4)看来像“我是192.168.1.3，我的MAC地址是00:0a:95:9d:68:16”。</p><p id="5cbb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，发送方将在ARP协议的帮助下获得目标机器的Mac地址。使用这种ARP协议，设备可以识别网络中的其它设备。</p><p id="fd5c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦设备获得特定设备的MAC地址，它会将该MAC地址和设备的IP地址以一种称为ARP缓存表的表格格式保存在本地。<strong class="ix hj"> </strong>当一台设备向另一台设备发送ARP响应时，收到响应的设备从不检查发送方设备的IP地址，并将其保存在发送方机器发送的带有IP地址的ARP缓存表中。我们可以利用这个陷阱做一些<strong class="ix hj"> <em class="lb">中间人攻击。这种</em> </strong>通常被称为ARP欺骗。我将在下一篇文章中介绍使用ARP欺骗的中间人攻击。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/82bcfbdf63274d213543d1d3f8fc0c7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*bs4fX8cdk_TsNvL0G96G7g.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">中间的人</figcaption></figure><p id="acab" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">到目前为止，一切顺利。现在我们对ARP协议和广播有了更好的理解。我们可以转到网络扫描器的实现。</p></div><div class="ab cl ld le gp lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hb hc hd he hf"><h2 id="8c3c" class="jz ka hi bd kb kc kd ke kf kg kh ki kj jg kk kl km jk kn ko kp jo kq kr ks kt bi translated">实现网络扫描仪</h2><p id="e9c8" class="pw-post-body-paragraph iv iw hi ix b iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo ky jq jr js hb bi translated">在我们的python脚本中，我们将按照这些步骤来设计我们的网络扫描器。</p><ul class=""><li id="2c73" class="lk ll hi ix b iy iz jc jd jg lm jk ln jo lo js lp lq lr ls bi translated">创建具有目标IP地址的arp请求包。</li><li id="abcd" class="lk ll hi ix b iy lt jc lu jg lv jk lw jo lx js lp lq lr ls bi translated">向广播发送数据包，并接收来自目标IP地址的响应。</li><li id="1b02" class="lk ll hi ix b iy lt jc lu jg lv jk lw jo lx js lp lq lr ls bi translated">解析响应以获取Mac</li><li id="6180" class="lk ll hi ix b iy lt jc lu jg lv jk lw jo lx js lp lq lr ls bi translated">打印结果</li></ul><h2 id="c258" class="jz ka hi bd kb kc kd ke kf kg kh ki kj jg kk kl km jk kn ko kp jo kq kr ks kt bi translated">创建ARP请求数据包</h2><p id="20e9" class="pw-post-body-paragraph iv iw hi ix b iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo ky jq jr js hb bi translated">可以使用python中的scapy ARP类创建ARP数据包。Scapy是python中网络工具的基本库。我们可以创建带有我们想要知道的目标IP地址的数据包。我们可以使用广播MAC将此数据包发送到网络中连接的所有设备。需要在以太网帧中嵌入ARP协议数据包，因为在局域网中，数据包是在以太网帧中发送的。为此，我们想创建一个以太网帧。在这个以太网帧中，我们可以给出目的地作为广播Mac地址。因此，我们将ARP请求数据包附加到以太网帧中，该帧是以广播Mac的目的地址创建的。</p><p id="9b84" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，现在我们已经创建了一个arp_request数据包和以太帧。我们希望将arp请求附加到ether_frame中。为此，我们想放一个“/”来实现这一点。/运算符已被用作两层之间的复合运算符。在我们的例子中，ARP数据包在网络层，以太网帧在数据链路层。在这里，我们有一个带有目标IP地址的arp_request数据包，它可以通过以太网帧从我们的设备发送到广播MAC。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><h2 id="e0f5" class="jz ka hi bd kb kc kd ke kf kg kh ki kj jg kk kl km jk kn ko kp jo kq kr ks kt bi translated">发送数据包和接收响应</h2><p id="b399" class="pw-post-body-paragraph iv iw hi ix b iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo ky jq jr js hb bi translated">作为第二步，我们必须发送ARP请求并接收相应的ARP响应。为此，我们可以使用scapy的srp函数。srp()函数用于发送数据包和接收应答。该函数返回几个数据包。它们被命名为“应答包”和“未应答包”。对我们来说，我们只需要答案包。我们将这些数据包存储在success_list变量中。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="e81d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是这个列表有更多的细节。我们只需要设备的MAC地址。所以，我们必须解析这个响应。</p><h2 id="4ef7" class="jz ka hi bd kb kc kd ke kf kg kh ki kj jg kk kl km jk kn ko kp jo kq kr ks kt bi translated">解析响应</h2><p id="329a" class="pw-post-body-paragraph iv iw hi ix b iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo ky jq jr js hb bi translated">为了解析响应，我们实现了小逻辑。success_list表示ARP响应成功。因此，我们希望从success_list中获取每个响应。成功响应的每个IP地址存储在psrc变量中，MAC地址存储在hwsrc变量中。我们初始化一个字典，将psrc和hwsrc值存储为键值对。然后我们可以用python的print方法把那些东西打印成表格格式。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="0533" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当我们有了目标IP地址/ IP范围，我们就可以得到他们的MAC地址。那么我们如何获得IP地址作为控制台参数呢？</p><h2 id="85c4" class="jz ka hi bd kb kc kd ke kf kg kh ki kj jg kk kl km jk kn ko kp jo kq kr ks kt bi translated">获取用户输入作为参数</h2><p id="6506" class="pw-post-body-paragraph iv iw hi ix b iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo ky jq jr js hb bi translated">我们希望使用python的optparse库来获取命令行中的用户输入。我们只需要用户想要扫描的目标IP地址/ IP范围。为此，我们可以定义一个选项“t”或“target”来获取输入并将其存储到目标变量中。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="ccb8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">之后，我们发送这个目标变量(目标IP地址)来创建数据包方法，并将这些数据包发送到广播。我们可以获得响应并解析它，然后在控制台中打印结果。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="eee8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我想你可以得到一个清晰的思路来设计一个简单的网络扫描仪。您可以通过添加目标计算机的操作系统版本来改进该扫描仪。在开发了这个网络扫描器之后，我们可以用ARP欺骗进行一些中间人攻击，这将是我的下一篇文章。</p><p id="1845" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以克隆这个GitHub <a class="ae iu" href="https://github.com/cvaram96/simple_network_scanner.git" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj"> <em class="lb">资源库</em> </strong> </a> <strong class="ix hj"> <em class="lb"> </em> </strong>来获得完整的代码。更多细节可以在知识库的<a class="ae iu" href="https://cvaram96.github.io/BNS-scanner/" rel="noopener ugc nofollow" target="_blank"> wiki页面</a>中找到。</p><p id="e98d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="lb">如果你喜欢这个，点击</em>👏<em class="lb">在下面，所以其他人会在媒体上看到这个。</em>你有什么建议吗？下面评论。</p></div></div>    
</body>
</html>