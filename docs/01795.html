<html>
<head>
<title>Data extraction from PDF documents using Apache Tika and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Apache Tika和Python从PDF文档中提取数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/data-extraction-from-pdf-documents-using-apache-tika-and-python-b56e4bc79245?source=collection_archive---------6-----------------------#2019-11-14">https://medium.com/analytics-vidhya/data-extraction-from-pdf-documents-using-apache-tika-and-python-b56e4bc79245?source=collection_archive---------6-----------------------#2019-11-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f0af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章给出了关于1的细节。如何使用Apache Tika和Python 2从PDF文档中提取额外的文本或元数据。安装tika服务器，并在系统重启或使用docker重启后自动重启Tika服务器</p><p id="0a19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">涉及的两个主要步骤是1 .在docker 2上安装docker并运行tika服务器。使用此服务器和python从pdf文档中提取数据</p><h1 id="3aeb" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated"><strong class="ak">安装Docker并运行Tika服务器</strong></h1><h2 id="db4e" class="kb je hi bd jf kc kd ke jj kf kg kh jn iq ki kj jr iu kk kl jv iy km kn jz ko bi translated"><strong class="ak"> <em class="kp">码头工人安装</em> </strong></h2><p id="c362" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">1.从https://docs.docker.com/docker-for-windows/install/<a class="ae kv" href="https://hub.docker.com/editions/community/docker-ce-desktop-windows" rel="noopener ugc nofollow" target="_blank">下载并安装docker</a></p><p id="8d3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.一旦安装了docker，您可以通过在命令提示符下键入“docker”来验证docker的安装，或者您也可以运行默认情况下已经存在的hello-world映像</p><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es kx"><img src="../Images/6f0fee4ba92ee66aecd7422a2a50dcaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*n3Fg0fF8a9pu2WhbnW6W_A.png"/></div></figure><h2 id="34ec" class="kb je hi bd jf kc kd ke jj kf kg kh jn iq ki kj jr iu kk kl jv iy km kn jz ko bi translated"><strong class="ak"> <em class="kp">在docker上运行Tika服务器</em> </strong></h2><ol class=""><li id="01ee" class="lf lg hi ih b ii kq im kr iq lh iu li iy lj jc lk ll lm ln bi translated">使用以下命令从docker hub中提取<strong class="ih hj">图像</strong></li></ol><pre class="ky kz la lb fd lo lp lq lr aw ls bi"><span id="c26a" class="kb je hi lp b fi lt lu l lv lw">docker pull logicalspark/docker-tikaserver</span></pre><p id="4a06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.在任何端口上运行下载的映像；这里我们运行的是默认端口号<strong class="ih hj"> 9998 </strong></p><pre class="ky kz la lb fd lo lp lq lr aw ls bi"><span id="729e" class="kb je hi lp b fi lt lu l lv lw">docker run -d -p 9998:9998 logicalspark/docker-tikaserver</span></pre><h2 id="496e" class="kb je hi bd jf kc kd ke jj kf kg kh jn iq ki kj jr iu kk kl jv iy km kn jz ko bi translated"><strong class="ak"> <em class="kp">验证Tika服务器安装</em> </strong></h2><p id="3043" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">在浏览器中输入tika URL(<a class="ae kv" href="http://localhost:9998/" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj"><em class="kw">http://localhost:9998/</em></strong></a>)。如果容器运行成功，您应该会看到下面的网页</p><figure class="ky kz la lb fd lc er es paragraph-image"><div class="ab fe cl lx"><img src="../Images/206ee840ad9eeef6d441db424eb33b0c.png" data-original-src="https://miro.medium.com/v2/format:webp/1*HPs19tYKc-O3xa1DB2ghLw.png"/></div></figure><h2 id="4ce7" class="kb je hi bd jf kc kd ke jj kf kg kh jn iq ki kj jr iu kk kl jv iy km kn jz ko bi translated">注意:</h2><p id="fbfd" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">您甚至可以从其他机器访问tika服务器。在这种情况下，用主机url替换localhost，并允许主机中的9998端口转发，以便其他服务器可以访问它。</p><p id="f128" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">既然我们已经看到了Tika服务器是如何安装的，现在让我们看看如何在相同的服务器上使用python处理文档</p><h1 id="dc5b" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">使用Python处理Tika服务器上的文档</h1><p id="6e3b" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated"><strong class="ih hj"> extract_text </strong>函数用于从pdf文档中提取额外的文本数据，其中文件路径是输入文件路径，Tika url是安装Tika服务器的服务器的url。</p><p id="807e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:async和aiohttp只是用来启用并行处理。如果您愿意，可以用请求来替换它</p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><pre class="ky kz la lb fd lo lp lq lr aw ls bi"><span id="de1b" class="kb je hi lp b fi lt lu l lv lw">async def extract_text(file_path, tika_url):<br/>    async with aiohttp.ClientSession() as session:<br/>        async with session.put(url=tika_url, data=open(file_path, 'rb')) as response:<br/>            text_data = dict()<br/>            file_name = str.split(file_path, '\\')[-1]<br/>            text_data['file_name'] = file_name<br/>            text_data['text'] = await response.text()<br/>            return text_data</span></pre><p id="97e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> extract_meta </strong>函数用于提取pdf文档的元数据，其中文件路径是输入文件路径，Tika url是安装Tika服务器的服务器的url</p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><pre class="ky kz la lb fd lo lp lq lr aw ls bi"><span id="d266" class="kb je hi lp b fi lt lu l lv lw">async def extract_meta(file_path, tika_url):<br/>    async with aiohttp.ClientSession() as session:<br/>        async with session.put(url=tika_url, data=open(file_path, 'rb'),headers={'Accept': 'application/json'}) as response:<br/>            file_name = str.split(file_path, '\\')[-1]<br/>            try:<br/>                data = await response.text()<br/>                if data:<br/>                    meta_data = json.loads(data)<br/>                    meta_data['file_name'] = file_name<br/>            except Exception as ex:<br/>                print("repsonse_failed")<br/>            return meta_data</span></pre><p id="9c90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">过程数据</strong>函数是根据给定输入调用各个数据提取函数的主函数</p><p id="7473" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输入参数详细信息如下</p><p id="ede1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kw">files _ list</em>eg:[r " C:\ Users \ document 1 . pdf "，r"C:\Users\document2.pdf"]，tika _ URL()；<em class="kw"> convert_mode </em>值可以是‘text’或‘meta’；<em class="kw"> tika_url值将是tika服务器()的URL；step_limit </em>默认为1。您可以将其更改为任何值。步长基本上指定了您希望一次运行多少个并行进程</p><pre class="ky kz la lb fd lo lp lq lr aw ls bi"><span id="b764" class="kb je hi lp b fi lt lu l lv lw">def process_data(files_list, tika_url, convert_mode,step_limit=1):</span><span id="4b05" class="kb je hi lp b fi mf lu l lv lw">    start_index = 0<br/>    end_index = 0<br/>    total_files = len(files_list)<br/>    upper_limit = total_files // step_limit<br/>    files_index = list(range(0, upper_limit * step_limit, step_limit)) + [total_files]<br/>    json_data = [None] * total_files<br/>    chunks = len(files_index)<br/>    timeout = 9 * step_limit<br/>    tika_functions = {'text': extract_text,'meta':extract_meta}</span><span id="626b" class="kb je hi lp b fi mf lu l lv lw">    for j in range(1, chunks):<br/>     curr_files_list = files_list[files_index[j - 1]:files_index[j]]<br/>     temp_list = [None] * len(curr_files_list)<br/>     for i, file in enumerate(curr_files_list):<br/>          temp_list[i] = tika_functions[convert_mode](file,tika_url)</span><span id="bee6" class="kb je hi lp b fi mf lu l lv lw">    loop = asyncio.get_event_loop()<br/>    processed, unprocessed = loop.run_until_complete(asyncio.wait([j    for j in temp_list],timeout=timeout))<br/>    end_index = end_index + len(processed)<br/>    json_data[start_index:end_index] = [f.result() for f in processed]<br/>    start_index = end_index<br/>    return json_data</span></pre><p id="dbf0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kw">最后，这里是使用上述函数</em>提取pdf文档列表的文本数据的示例代码片段</p><pre class="ky kz la lb fd lo lp lq lr aw ls bi"><span id="22d5" class="kb je hi lp b fi lt lu l lv lw">result=process_data([r”<em class="kw">C:\Users\document1.pdf”, r”C:\Users\document2.pdf</em>”],"<a class="ae kv" href="http://localhost:9998/tika" rel="noopener ugc nofollow" target="_blank">http://localhost:9998/tika</a>","text")</span></pre><p id="52e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">至此，我们知道了如何从pdf文档中提取数据</p><h1 id="1ab6" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated"><strong class="ak">附加</strong></h1><p id="46be" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">如果你想知道如何自动重启tika服务器的过程，</p><h2 id="0113" class="kb je hi bd jf kc kd ke jj kf kg kh jn iq ki kj jr iu kk kl jv iy km kn jz ko bi translated">在系统重启或重新启动后自动重启Tika服务器:</h2><p id="9fd5" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">涉及的两个主要步骤是:a)设置tika容器的重启策略，使其总是b)每次系统重启时触发docker运行</p><p id="3351" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a) <strong class="ih hj"> <em class="kw">设置tika的重启策略:</em> </strong></p><p id="af01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">= &gt;在docker上运行tika映像后，使用下面的命令将容器的重启策略设置为always。</p><pre class="ky kz la lb fd lo lp lq lr aw ls bi"><span id="f423" class="kb je hi lp b fi lt lu l lv lw">docker update --restart=always containerid</span></pre><p id="82e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">= &gt;可以通过运行docker container ls命令获得容器id</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es mg"><img src="../Images/7f46a2a85a56a51381ca39f7d73f4dee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_y-jYRNKXSxTVt9hYp3kIA.png"/></div></div></figure><p id="86f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b) <strong class="ih hj"> <em class="kw">每次系统重启或重启时重启docker:</em></strong></p><p id="9d71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在任务调度器中创建一个基本任务，并将docker.exe文件路径添加为程序路径，并将触发条件设置为“系统启动”。确保以最高权限运行任务，并设置您在task_settings图像中看到的设置</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es ml"><img src="../Images/0aa6c2f1ec57513af729220d37eb687c.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*al4UNlCf2y-Q8YgdQtvikA.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx translated">任务_创建</figcaption></figure><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es mq"><img src="../Images/2b61f0a3580345b28f10a30f2446bcfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*2ru_TI4UBHwIKQ3dL-v6RQ.png"/></div><figcaption class="mm mn et er es mo mp bd b be z dx translated">任务设置</figcaption></figure><h2 id="f279" class="kb je hi bd jf kc kd ke jj kf kg kh jn iq ki kj jr iu kk kl jv iy km kn jz ko bi translated">参考资料:</h2><p id="4964" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated"><a class="ae kv" href="https://github.com/LogicalSpark/docker-tikaserver" rel="noopener ugc nofollow" target="_blank">https://github.com/LogicalSpark/docker-tikaserver</a>，<a class="ae kv" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank">https://hub.docker.com/</a></p></div></div>    
</body>
</html>