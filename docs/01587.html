<html>
<head>
<title>Fastai — Image Regression — Age Prediction based on Image</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Fastai —图像回归—基于图像的年龄预测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/fastai-image-regression-age-prediction-based-on-image-68294d34f2ed?source=collection_archive---------1-----------------------#2019-11-02">https://medium.com/analytics-vidhya/fastai-image-regression-age-prediction-based-on-image-68294d34f2ed?source=collection_archive---------1-----------------------#2019-11-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/09453757f198fa84f02743f83863b6ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TWPQZ0C1OT8Oo-bY"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">斯科特·韦伯在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="7d41" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">介绍</h1><p id="5fc8" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">当涉及到图像分类任务时，卷积神经网络(CNN)是非常强大的神经网络架构。然而，很少有人知道它们同样能够执行图像回归任务。</p><p id="4ab1" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">图像分类和图像回归任务的基本区别在于，分类任务中的目标变量(我们试图预测的事物)不是连续的，而回归任务中的目标变量是连续的。例如，如果我们需要在不同的狗和猫品种之间进行分类，这将属于分类任务的范围。然而，如果我们需要根据房屋的图像来预测房价，这将是一项回归任务。</p><p id="9ead" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">我在人寿保险行业工作，目前全球该行业正在发生的一个重大变化是简化客户的入职流程。不同的公司都在努力使销售保险的过程更加简单、直观和便捷。在这个方向上，深度学习的技术对于解决这个问题非常有用。例如，如果深度学习模型可以预测一个人的年龄、性别、吸烟者身份和身体质量指数(对于给定的保险金额来说，这些是计算正确的保费金额或拒绝/推迟保险的几个最重要的因素)，保险公司可以为他们的客户简化保险销售流程，并可能增加销售额。</p><p id="5e45" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">我们知道基于人的图像的性别预测相对简单，这属于<strong class="jv hj">图像分类任务</strong>。</p><p id="c78e" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">如果你有兴趣，可以参考下面的完整工作内容:</p><div class="kw kx ez fb ky kz"><a href="https://www.kaggle.com/abhikjha/wiki-gender-prediction" rel="noopener  ugc nofollow" target="_blank"><div class="la ab dw"><div class="lb ab lc cl cj ld"><h2 class="bd hj fi z dy le ea eb lf ed ef hh bi translated">维基性别预测</h2><div class="lg l"><h3 class="bd b fi z dy le ea eb lf ed ef dx translated">下载数千个项目的开放数据集+在一个平台上共享项目。探索热门话题，如政府…</h3></div><div class="lh l"><p class="bd b fp z dy le ea eb lf ed ef dx translated">www.kaggle.com</p></div></div><div class="li l"><div class="lj l lk ll lm li ln io kz"/></div></div></a></div><p id="8f5c" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">另一方面，诸如基于图像预测人的年龄的图像回归任务是相对难以完成的任务。处理该任务的更简单的方法是通过在一个桶中对不同的年龄进行分组，即通过创建年龄带，使其成为一个分类任务。然而，就保险单销售而言，这并不能解决问题(通常死亡率或发病率因年龄和性别而有显著差异)。因此，我试图创建一个模型，试图预测这个人的确切年龄。</p><h1 id="f2a5" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">偏倚和数据选择问题</h1><p id="d277" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">处理图像尤其是人物图像的主要问题是，公共领域中可自由获得的大多数数据源都带有明显的种族偏见。Fastai的杰瑞米·霍华德在他关于深度学习课程的一次讲座中提到了这一点。这些公共领域中可用的图像是有偏见的，因为大多数捕获的图像都是白人，如果我们基于这些图像创建任何模型，那么它很可能不会在例如印度或亚洲血统的人的图像上做得很好。</p><p id="327a" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">为了在一定程度上解决这个问题，我仔细选择了三个数据来源(所有这些都可以在公共领域获得):</p><ol class=""><li id="303b" class="lo lp hi jv b jw kr ka ks ke lq ki lr km ls kq lt lu lv lw bi translated">IMDB-Wiki人脸数据集(<a class="ae iu" href="https://data.vision.ee.ethz.ch/cvl/rrothe/imdb-wiki/" rel="noopener ugc nofollow" target="_blank">https://data.vision.ee.ethz.ch/cvl/rrothe/imdb-wiki/</a>)</li><li id="0aec" class="lo lp hi jv b jw lx ka ly ke lz ki ma km mb kq lt lu lv lw bi translated">http://aicip.eecs.utk.edu/wiki/UTKFace UTK人脸数据集(<a class="ae iu" href="http://aicip.eecs.utk.edu/wiki/UTKFace" rel="noopener ugc nofollow" target="_blank"/>)</li><li id="76d4" class="lo lp hi jv b jw lx ka ly ke lz ki ma km mb kq lt lu lv lw bi translated">http://chalearnlap.cvc.uab.es/dataset/26/description/真实人脸数据集(<a class="ae iu" href="http://chalearnlap.cvc.uab.es/dataset/26/description/" rel="noopener ugc nofollow" target="_blank"/>)</li></ol><p id="acb0" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">这些数据集是使用不同的来源/图像创建的，涵盖0到100岁之间的所有年龄，如果我们将这些数据结合在一起，严重的种族偏见问题在某种程度上得到了消除。</p><h1 id="2b03" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">Fastai课程和图书馆</h1><p id="8133" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">在开始这篇文章的主要内容之前，我想说几句话，并对我最喜欢的老师杰瑞米·霍华德教授的非凡课程<em class="mc">“程序员实用深度学习(上、下)》</em>表示感谢。这是一门令人惊叹的课程，我学到了很多东西，非常感谢杰里米和雷切尔创建并支持这门课程。</p><blockquote class="md me mf"><p id="2316" class="jt ju mc jv b jw kr jy jz ka ks kc kd mg kt kg kh mh ku kk kl mi kv ko kp kq hb bi translated">除了课程之外，Fastai还有一个令人惊叹的蓬勃发展的学生、研究人员和从业者社区，他们随时准备帮助和支持同学和从业者。就在最近，我了解到我过去写了中型文章的两个深度学习项目被Fastai用户选为100个此类项目的一部分，成为巴西利亚大学深度学习课程的一部分。对于一个刚刚开始学习ML / DL基础知识的人来说，这是一个非常好的产品时刻。多酷啊！所有这一切之所以成为可能，是因为这门令人惊叹的课程、像杰瑞米·霍华德这样的优秀教师、Fastai用户的繁荣社区以及Pytorch的包装库。</p></blockquote><h1 id="f535" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">项目描述</h1><p id="ee2e" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">由于一些奇怪的原因，我为这个项目工作的Kaggle内核没有成功提交。所以，我把笔记本放到了我的GitHub上:</p><div class="kw kx ez fb ky kz"><a href="https://github.com/abhikjha/Image-Regression---Age-Prediction---Fastai" rel="noopener  ugc nofollow" target="_blank"><div class="la ab dw"><div class="lb ab lc cl cj ld"><h2 class="bd hj fi z dy le ea eb lf ed ef hh bi translated">abhikjha/图像回归年龄预测Fastai</h2><div class="lg l"><h3 class="bd b fi z dy le ea eb lf ed ef dx translated">在v2笔记本中，我已经尝试基于Fastai库创建了一个图像回归模型。很少有重要的…</h3></div><div class="lh l"><p class="bd b fp z dy le ea eb lf ed ef dx translated">github.com</p></div></div><div class="li l"><div class="mj l lk ll lm li ln io kz"/></div></div></a></div><p id="aaca" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">以下是应该强调的几个要点:</p><ol class=""><li id="5900" class="lo lp hi jv b jw kr ka ks ke lq ki lr km ls kq lt lu lv lw bi translated">使用Fastai v1模型，并选择CNN架构— ResNet34来运行该模型。我尝试使用更复杂的架构，如ResNet50，但发现验证错误更高。</li><li id="9eb9" class="lo lp hi jv b jw lx ka ly ke lz ki ma km mb kq lt lu lv lw bi translated">在这个工作笔记本中，我使用了图像大小调整技术，图像大小逐渐增加，这有助于获得更高的精度。这是一个很棒的技术，每次我们需要在CNN工作时都必须使用。</li><li id="8e71" class="lo lp hi jv b jw lx ka ly ke lz ki ma km mb kq lt lu lv lw bi translated">L1平滑损失(胡伯的损失)被用来比L1或L2损失表现更好。</li><li id="ae8d" class="lo lp hi jv b jw lx ka ly ke lz ki ma km mb kq lt lu lv lw bi translated">在项目期间，我使用Fastai的判别学习技术进行学习，其中我们可以将NN arch分成不同的部分，并为NN arch的不同部分分配不同的权重衰减值和学习速率。</li><li id="80e0" class="lo lp hi jv b jw lx ka ly ke lz ki ma km mb kq lt lu lv lw bi translated">最后，使用Fastai Pytorch Hooks和Spotify Annoy创建了一个图像相似性模型(在我看来，这不是很好。</li></ol><p id="5f17" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><strong class="jv hj">年龄模型一瞥:</strong></p><pre class="mk ml mm mn fd mo mp mq mr aw ms bi"><span id="3d67" class="mt iw hi mp b fi mu mv l mw mx"><strong class="mp hj">class</strong> <strong class="mp hj">AgeModel</strong>(nn.Module):<br/>   <strong class="mp hj">def</strong> __init__(self):<br/>        super().__init__()<br/>        layers = list(models.resnet34(pretrained=<strong class="mp hj">True</strong>).children())[:-2]<br/>        layers += [AdaptiveConcatPool2d(), Flatten()]<br/>        layers += [nn.BatchNorm1d(1024, eps=1e-05, momentum=0.1, affine=<strong class="mp hj">True</strong>, track_running_stats=<strong class="mp hj">True</strong>)]<br/>        layers += [nn.Dropout(p=0.50)]<br/>        layers += [nn.Linear(1024, 512, bias=<strong class="mp hj">True</strong>), nn.ReLU(inplace=<strong class="mp hj">True</strong>)]<br/>        layers += [nn.BatchNorm1d(512, eps=1e-05, momentum=0.1, affine=<strong class="mp hj">True</strong>, track_running_stats=<strong class="mp hj">True</strong>)]<br/>        layers += [nn.Dropout(p=0.50)]<br/>        layers += [nn.Linear(512, 16, bias=<strong class="mp hj">True</strong>), nn.ReLU(inplace=<strong class="mp hj">True</strong>)]<br/>        layers += [nn.Linear(16,1)]<br/>        self.agemodel = nn.Sequential(*layers)</span><span id="bba8" class="mt iw hi mp b fi my mv l mw mx">    <strong class="mp hj">def</strong> forward(self, x):<br/>        <strong class="mp hj">return</strong> self.agemodel(x).squeeze(-1)</span></pre><p id="5d6f" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">在这里，你可以看到在ResNet34的架构中，在去除了处理分类任务的层之后，我们添加了可以处理回归任务的部分。</p><p id="04b6" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><strong class="jv hj">损失函数一览:</strong></p><pre class="mk ml mm mn fd mo mp mq mr aw ms bi"><span id="64e5" class="mt iw hi mp b fi mu mv l mw mx"><strong class="mp hj">class</strong> <strong class="mp hj">L1LossFlat</strong>(nn.SmoothL1Loss):<br/>    <strong class="mp hj">def</strong> forward(self, input:Tensor, target:Tensor) -&gt; Rank0Tensor:<br/>        <strong class="mp hj">return</strong> super().forward(input.view(-1), target.view(-1))</span></pre><p id="05b8" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">使用比L1或L2损失表现更好的平滑L1损失。</p><p id="917d" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><strong class="jv hj">看一眼学习者:</strong></p><pre class="mk ml mm mn fd mo mp mq mr aw ms bi"><span id="b6ba" class="mt iw hi mp b fi mu mv l mw mx">learn = Learner(data_wiki_small, model, model_dir = "/temp/model/", opt_func=opt_func, bn_wd=<strong class="mp hj">False</strong>, metrics=root_mean_squared_error,<br/>               callback_fns=[ShowGraph]).mixup(stack_y=<strong class="mp hj">False</strong>, alpha=0.2)<br/><br/>learn.loss_func = L1LossFlat()</span></pre><p id="6673" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><strong class="jv hj">现在，我们将看到模型的几个预测:</strong></p><figure class="mk ml mm mn fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mz"><img src="../Images/654801c894e93584fe42c42048adb646.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zAisgjnDP9MDXnoEpIsqqQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">模型的预测</figcaption></figure><p id="2d2d" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">为了根据随机测试图像测试这个模型，我使用了印度总理莫迪在2015年拍摄的照片(当时他大约64岁)。让我们看看我们的进展如何:</p><figure class="mk ml mm mn fd ij er es paragraph-image"><div class="er es na"><img src="../Images/3fd5f2cf5e70e0794635ca8200bfb9ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*2IPvpFDztxK-SRkeni-z4g.jpeg"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">2015年，64岁的莫迪总理</figcaption></figure><p id="8052" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">让我们看看模型预测了什么:</p><figure class="mk ml mm mn fd ij er es paragraph-image"><div class="er es nb"><img src="../Images/e3eb3fc559be8e8bcd15d7a6192f9eea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1094/format:webp/1*wiirJVt2LkOIRbN_Uw1Ang.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">太好了！它预测莫迪的年龄约为63岁</figcaption></figure><h1 id="01b1" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">结论</h1><p id="c371" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">这是我参与的时间最长的项目之一，但我必须说我在这个过程中学到了很多。这些东西中很少是判别学习技术、通过重构来构建合适模型的方法、图像大小调整技术等。</p><p id="2daf" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">如果你想对我的工作，尤其是这篇文章发表评论，请在下面分享你的想法和建议。</p><figure class="mk ml mm mn fd ij er es paragraph-image"><div class="er es nc"><img src="../Images/c71df8d28b9aceb12cf035953f006fb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/1*A5t29FfkdPzNkqJvVWI5PQ.gif"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">如果你喜欢我的文章，请鼓掌！！</figcaption></figure></div></div>    
</body>
</html>