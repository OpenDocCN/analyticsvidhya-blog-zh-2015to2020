<html>
<head>
<title>Using Machine Learning to identify Accents in Spectrograms of Speech. Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用机器学习识别语音频谱图中的重音。第二部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/using-machine-learning-to-identify-accents-in-spectrograms-of-speech-part-2-cc0150b81b83?source=collection_archive---------16-----------------------#2020-07-03">https://medium.com/analytics-vidhya/using-machine-learning-to-identify-accents-in-spectrograms-of-speech-part-2-cc0150b81b83?source=collection_archive---------16-----------------------#2020-07-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/05e28e5ee295502667f112f8916d3d22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*CLExccZjbhK3WhuDB5xkrg.png"/></div></div></figure><div class=""/><p id="13c0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个ML模型的开发中，我们将使用一个基于微软Azure的非常强大的平台/工具，Azure机器学习服务。它是一个基于云的框架，用于设计、培训、部署和管理机器学习模型。它提供了一个工具包，您可以在其中管理和监督机器学习模型开发的所有步骤。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div class="er es jo"><img src="../Images/f275c8b817dfb83c012eca177309eec2.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*aCwI6divHTqugUTHXoooaQ.png"/></div></figure><blockquote class="jt ju jv"><p id="5690" class="iq ir jw is b it iu iv iw ix iy iz ja jx jc jd je jy jg jh ji jz jk jl jm jn hb bi translated">获得对用于机器学习模型训练和推理的<a class="ae ka" href="https://azure.microsoft.com/en-us/overview/ai-platform/dev-resources/" rel="noopener ugc nofollow" target="_blank">开源工具和框架</a>的内置支持。使用熟悉的框架，如PyTorch、TensorFlow和scikit-learn，或者开放的互操作ONNX格式。选择最符合您需求的开发工具，包括流行的ide、Jupyter笔记本和CLIs，或者Python和r等语言。使用ONNX运行时来优化和加速跨云和边缘设备的推理。</p></blockquote><p id="0c53" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们对微软提供的非常强大的Python非常感兴趣，数据科学家和人工智能开发人员通过<a class="ae ka" href="https://docs.microsoft.com/azure/machine-learning/service/overview-what-is-azure-ml" rel="noopener ugc nofollow" target="_blank"> Azure机器学习服务</a>构建并运行机器学习工作流。你可以在任何Python环境中与服务进行交互，包括Jupyter笔记本、<a class="ae ka" href="https://docs.microsoft.com/azure/machine-learning/service/how-to-vscode-tools" rel="noopener ugc nofollow" target="_blank"> Visual Studio Code </a>，或者你最喜欢的Python IDE。</p><p id="9db1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以使用我们最喜欢的IDE在本地编写代码，调用SDK API来管理(创建、修改或删除)过程中涉及的所有对象(工作区、实验、运行或培训)，而无需与Azure Portal进行手动交互。然后，在训练期间，我们可以在Azure Portal中可视化模型中定义的损失和指标，帮助我们在单个点或容器中监督和分组所有信息。</p><p id="b710" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是让我们向您展示如何去做，大部分代码都是从微软文档的教程中提取的，所以入门非常容易。</p><p id="48ae" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">代码可以在这个Github库中访问。</p><p id="a596" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，加载库或SDK</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kb"><img src="../Images/a14d1abdd8d4c6dabcb78b33b85e22bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xJu8dST_I6yIGguscR0fqw.png"/></div></div></figure><h2 id="729a" class="kc kd ht bd ke kf kg kh ki kj kk kl km jb kn ko kp jf kq kr ks jj kt ku kv kw bi translated">创建Azure机器学习工作区并进行实验</h2><p id="6a0a" class="pw-post-body-paragraph iq ir ht is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">然后，我们需要获得或创建一个机器学习工作区，它将是我们所有模型或训练的“容器”。因此，假设它对应于一个项目:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lc"><img src="../Images/3ab02c5dec2cde25ec26485233abbe61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tzpMaNB2E2fOtg-5iWikVA.png"/></div></div></figure><p id="ef75" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">变量<em class="jw"> subscription_id </em>、<em class="jw"> resource_group </em>和<em class="jw"> workspace_name </em>必须设置为我们的Azure配置或首选项。现在，ws是我们的主要对象，所有的操作都将在这里执行。</p><p id="7090" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步，创建一个实验。实验是一个容器，它将保存我们的训练、他们的度量、他们的输出……然后我们可以分析和比较我们在模型中不同架构或参数上的结果。这将是我们在训练和评估一个ml模型期间的日记。我们将创建一个文件夹来存放培训脚本。脚本运行将被记录在Azure的实验下。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ld"><img src="../Images/f4fb5a53157992f86b599736436c84c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*khA76JdpJJyMPZp12ZsVww.png"/></div></div></figure><h2 id="6d37" class="kc kd ht bd ke kf kg kh ki kj kk kl km jb kn ko kp jf kq kr ks jj kt ku kv kw bi translated">创建和定义计算资源</h2><p id="dbf4" class="pw-post-body-paragraph iq ir ht is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">然后，为了运行我们的实验，我们需要一些计算能力，也就是所谓的<em class="jw">计算资源。</em>在本节中，我们将获得用于训练模型的计算资源。我们将搜索现有的计算资源，如果它不存在，我们将创建它。我们可以使用预先创建的虚拟机，如Azure Data Science虚拟机，或者我们可以创建一个新的计算资源来指示类型和计算能力。我们不必担心停止或删除资源，它们会自动停止，我们只需为我们的消耗时间付费。</p><p id="7011" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果有必要，我们可以在一个虚拟机集群上执行我们的模型。要创建集群，您需要指定一个计算配置，该配置指定要使用的机器类型和可伸缩性行为。然后，为集群选择一个在工作空间中唯一的名称，该名称可用于以后对集群进行寻址。有许多类型的计算资源:“V2 DS12标准”，“V2 D4标准”，有一定数量的RAM和GPU或CPU等。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es le"><img src="../Images/449fc81673bf1ecea62ac273f5ad9801.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yZ01EJGNMYrPk1S4f5g5AQ.png"/></div></div></figure><h2 id="edc6" class="kc kd ht bd ke kf kg kh ki kj kk kl km jb kn ko kp jf kq kr ks jj kt ku kv kw bi translated">数据存储，数据存放在其中</h2><p id="dcdf" class="pw-post-body-paragraph iq ir ht is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">现在，我们需要存储我们的训练数据，供我们的实验使用。我们有不同的选择，我们可以将它本地存储在vm中或Azure中的共享数据存储中。输入数据策略取决于许多因素，我们不会在本文中讨论(更多信息？).</p><p id="0357" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数据存储是一个可以存储数据的地方，然后实验(其中的运行对象)可以通过将数据装载或复制到计算目标来访问数据。数据存储可以由Azure Blob存储或Azure文件共享提供支持(未来将支持ADLS)。对于简单的数据处理，如果数据不在Blob存储或文件共享中，每个工作区都提供一个可以使用的默认数据存储。我们将使用默认数据存储。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lf"><img src="../Images/c371026e62e1885370ba9d5ec9704a21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NrlccItzlUk8pLHmShGbaQ.png"/></div></div></figure><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lg"><img src="../Images/8ae5e385e0e0f25e2b472c926df62606.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UjWeukqlbcEkue1csZ0aBg.png"/></div></div></figure><p id="d10e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个阶段，一切准备就绪，可以开始我们的模型训练了。在此之前，我们需要设置一些参数，设置之前创建的计算资源，将所有要运行的代码或脚本复制到一个文件夹中。脚本文件夹应该包含azure作业训练模型所需的所有文件，包含要运行的代码的python文件将在estimator对象的参数中定义。这个。py文件将运行训练过程的所有步骤:读取数据、分割数据、创建模型、设置参数、编译和拟合模型以及评估损失和度量。此文件夹将被复制到将执行培训作业的计算资源中。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lh"><img src="../Images/3dea40ce267d525fcba0a1c2faee0dfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2TrHOjjzJ24Qw4U2V63-Nw.png"/></div></div></figure><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es li"><img src="../Images/e995224a63cc6bee7991374dda0f08c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7WB0wEV9i-VEjeRf2uO47Q.png"/></div></div></figure><h2 id="c992" class="kc kd ht bd ke kf kg kh ki kj kk kl km jb kn ko kp jf kq kr ks jj kt ku kv kw bi translated">创建张量流估计器</h2><p id="5981" class="pw-post-body-paragraph iq ir ht is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">接下来，我们构造一个azure ml . train . dnn . tensor flow estimator对象，使用计算目标，并将数据存储的挂载点作为参数传递给训练代码。TensorFlow估算器提供了一种在计算目标上启动TensorFlow训练作业的简单方法。它会自动提供一个安装了TensorFlow的docker映像。在本例中，我们添加了keras包(显然是针对Keras框架的),以及matplotlib包，用于绘制“损失与准确性”图表，并将其记录在运行历史中。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lj"><img src="../Images/218867e878a60ade4655f8e7b62ed4e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U414bUKw0e0S-3M6rMbxmA.png"/></div></div></figure><p id="9509" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我们可以将评估器提交给Azure ML实验来开始执行。现在，所有资源都将启动，因此第一次需要几分钟(5-10分钟)来开始培训。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lf"><img src="../Images/5137fcdfbd38c8f47cf66c7f2363958a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_u3WWDX1li5HK3Oka1PDTw.png"/></div></div></figure><p id="a144" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行执行时，将经历以下阶段:</p><p id="d5e3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jw">准备</em>:创建一个与TensorFlow estimator指定的Python环境相匹配的docker映像，并将它上传到工作区的Azure容器注册中心。对于每个Python环境，这一步只发生一次——容器将被缓存以供后续运行。创建和上传图像大约需要5分钟。在作业准备过程中，日志会流式传输到运行历史记录中，并且可以通过查看日志来监控映像创建的进度。</p><p id="e8d6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jw">扩展</em>:如果计算需要扩展(即计算集群需要比当前可用节点更多的节点来执行运行)，集群将尝试扩展以提供所需数量的可用节点。缩放通常需要大约5分钟。</p><p id="6e78" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jw">运行</em>:脚本文件夹中的所有脚本都被上传到计算目标，数据存储被挂载/复制，entry_script被执行。当作业运行时，stdout和。/logs文件夹传输到运行历史记录中，可以通过查看来监控运行进度。</p><p id="84eb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jw">后处理</em>:把。将运行的/outputs文件夹复制到运行历史记录中</p><p id="dd36" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有多种方法可以检查正在运行的作业的进度。我们可以使用Jupyter笔记本小部件:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lk"><img src="../Images/b1727fa3ab584ec31dd05ea4046da0f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rYYWJIuNYbEpFUUlsMpzAQ.png"/></div></div></figure><p id="c72f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在。py文件我们对模型的参数进行编码，拆分并准备数据数据，设计神经网络，执行训练并绘制度量标准。让我们谈谈与azure ML对象相关的部分。</p><p id="5460" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们需要设置一些参数，并使用python解析器对象解析和检索这些参数:</p><figure class="jp jq jr js fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="b3bf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，我们加载数据，将其分为训练集和评估集，创建一个Keras CNN，其中3个卷积层采用批处理标准化和RELU激活，2个密集层采用RELU激活。最后，我们包括一个具有softmax激活函数的密集层，其输出大小等于要预测的类的数量。我们应用一些数据扩充来防止过度拟合，拟合和评估模型。您可以在中观察并获得所有细节。py文件包含在文件夹<em class="jw">中的</em> <a class="ae ka" href="https://github.com/edumunozsala/spectrograms_speech_classification" rel="noopener ugc nofollow" target="_blank">中的<em class="jw">演讲_cnn资源库</em>中的</a>。</p><p id="8aea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是我们感兴趣的是在实验中记录我们的模型结果，所以我们可以稍后在Azure中分析它们。我们可以使用回调函数来做到这一点:</p><figure class="jp jq jr js fd hk"><div class="bz dy l di"><div class="ll lm l"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated"><a class="ae ka" href="https://gist.github.com/b20e847706cd13932d092f0cfbfe569f.git" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/b20e 847706 CD 13932d 092 f 0 cfbfe 569 f . git</a></figcaption></figure><p id="5715" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在每个时期结束时，存储所获得的损失和精度值，然后我们可以使用它们在训练和验证数据集的训练期间绘制损失函数和精度。这张图片可以保存到工作区的实验中，稍后我们可以在Azure中看到它。我们还可以在实验中将模型保存为json格式，这样我们就可以在想要重现结果或进行推断的任何时候加载它。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lr"><img src="../Images/d8d45e926331d3105fcd506456941d9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hrb4ypfoCLtY4HDmujq1-w.png"/></div></div></figure><p id="e647" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是全部，现在我们有一个训练好的模型和结果存储在我们的Azure帐户中，从我们的Azure ML工作区的实验中，我们可以观察结果、图表和输出模型。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ls"><img src="../Images/528cf8a777f92ba06b59fa8fb3a8c70f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eIJ4rrPOAgh0nOGUnwnZIw.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">训练过程中丧失功能和准确性</figcaption></figure><figure class="jp jq jr js fd hk er es paragraph-image"><div class="er es lt"><img src="../Images/6c3acfc3c3ba6e52f6b72b19e6c8ff12.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*DTCQBu2ThYwRnyKUUFoOJQ.png"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">模型h5和json文件，现在我们可以下载到任何我们想使用的地方</figcaption></figure><p id="2d70" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这只是一个关于如何在Azure机器学习服务中训练ML模型的简单例子，随着发布的许多新功能，它的发展非常流畅。</p><p id="d921" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae ka" href="https://github.com/edumunozsala/spectrograms_speech_classification" rel="noopener ugc nofollow" target="_blank"> Github库</a>。</p><div class="hh hi ez fb hj lu"><a href="https://docs.microsoft.com/es-es/python/api/overview/azure/ml/intro?view=azure-ml-py" rel="noopener  ugc nofollow" target="_blank"><div class="lv ab dw"><div class="lw ab lx cl cj ly"><h2 class="bd hu fi z dy lz ea eb ma ed ef hs bi translated">SDK de Azure机器学习para Python</h2><div class="mb l"><h3 class="bd b fi z dy lz ea eb ma ed ef dx translated">人工智能领域的数据科学和开发人员</h3></div><div class="mc l"><p class="bd b fp z dy lz ea eb ma ed ef dx translated">docs.microsoft.com</p></div></div><div class="md l"><div class="me l mf mg mh md mi hp lu"/></div></div></a></div></div></div>    
</body>
</html>