<html>
<head>
<title>Visualization of COVID-19 Total Tests Using Web-scraping and Plotly in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用Python中的网页抓取和Plotly实现新冠肺炎总测试的可视化</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/visualization-of-covid-19-total-tests-using-web-scraping-and-plotly-in-python-7ef9dda2ce37?source=collection_archive---------21-----------------------#2020-04-05">https://medium.com/analytics-vidhya/visualization-of-covid-19-total-tests-using-web-scraping-and-plotly-in-python-7ef9dda2ce37?source=collection_archive---------21-----------------------#2020-04-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="31f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">测试总数的端到端数据提取，并在可视化中使用提取的数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/ba6d5a78ef71806950f5640cab1abbdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dEMcSsP60A7Swr_c"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">达米安·扎莱斯基在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="26e8" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">新冠肺炎:冠状病毒病(新冠肺炎)是一种由新型病毒引起的传染病。</h1><p id="dfff" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">这种疾病导致呼吸道疾病(如流感)，症状包括咳嗽、发烧，在更严重的情况下，呼吸困难。你可以通过勤洗手、避免触摸脸、避免与身体不适的人近距离接触(1米或3英尺)来保护自己。</p><p id="ef5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">冠状病毒疾病主要通过与感染者咳嗽或打喷嚏时的接触传播。当一个人触摸带有病毒的表面或物体，然后触摸他们的眼睛、鼻子或嘴时，它也会传播。现在全世界都在和冠状病毒做斗争，所以我试着找出前25个国家的冠状病毒检测总数。</p><h1 id="a6d4" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">使用Web抓取的表格数据提取</h1><p id="b665" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">Web抓取是从网站中提取信息、表格数据的过程。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kx"><img src="../Images/415a6701a44a010515757ca6f2f5d172.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cKdG-XG-_QyORXYn"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">照片由<a class="ae jt" href="https://unsplash.com/@tongs?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Xtina Yu </a>在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="6211" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击<a class="ae jt" href="https://ourworldindata.org/coronavirus-testing-source-data" rel="noopener ugc nofollow" target="_blank">此处</a>获取验证网站数据。我们在这段代码中使用了这个链接。</p><p id="6c3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们从这里开始:</p><p id="4cd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我正在使用漂亮的汤库进行网页清理，可以使用<code class="du ky kz la lb b">pip</code>来安装。</p><pre class="je jf jg jh fd lc lb ld le aw lf bi"><span id="1bad" class="lg jv hi lb b fi lh li l lj lk">pip install BeautifulSoup4</span></pre><p id="1374" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们完成以上库的安装，我们就可以提取表格数据。</p><pre class="je jf jg jh fd lc lb ld le aw lf bi"><span id="6465" class="lg jv hi lb b fi lh li l lj lk">#Importing the module</span><span id="d233" class="lg jv hi lb b fi ll li l lj lk">import pandas as pd</span><span id="84c8" class="lg jv hi lb b fi ll li l lj lk">import numpy as np</span><span id="4669" class="lg jv hi lb b fi ll li l lj lk">import matplotlib.pyplot as plt</span><span id="75ca" class="lg jv hi lb b fi ll li l lj lk">import seaborn as sns</span><span id="d6a9" class="lg jv hi lb b fi ll li l lj lk">%matplotlib inline</span></pre><p id="b9d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">进口美丽的汤</p><pre class="je jf jg jh fd lc lb ld le aw lf bi"><span id="2387" class="lg jv hi lb b fi lh li l lj lk">from urllib.request import urlopen</span><span id="42ae" class="lg jv hi lb b fi ll li l lj lk">#The urllib.request module is used to open URLs</span><span id="aaef" class="lg jv hi lb b fi ll li l lj lk">from bs4 import BeautifulSoup</span></pre><p id="21a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们需要一个从中提取数据的URL。</p><pre class="je jf jg jh fd lc lb ld le aw lf bi"><span id="eb94" class="lg jv hi lb b fi lh li l lj lk">url ="<a class="ae jt" href="https://ourworldindata.org/coronavirus-testing-source-data" rel="noopener ugc nofollow" target="_blank">https://ourworldindata.org/coronavirus-testing-source-data</a>"<br/>html = urlopen(url)</span><span id="2937" class="lg jv hi lb b fi ll li l lj lk">soup = BeautifulSoup(html, 'lxml')<br/>type(soup)</span><span id="7ae6" class="lg jv hi lb b fi ll li l lj lk"># Get the title<br/>title = soup.title<br/>print(title)</span><span id="f204" class="lg jv hi lb b fi ll li l lj lk"># Print out the text<br/>text = soup.get_text()<br/>print(soup.text)</span><span id="2370" class="lg jv hi lb b fi ll li l lj lk">soup.find_all('a')</span><span id="6e6f" class="lg jv hi lb b fi ll li l lj lk">all_links = soup.find_all("a")<br/>for link in all_links:<br/>    print(link.get("href"))</span></pre><p id="286d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">健全性检查</p><pre class="je jf jg jh fd lc lb ld le aw lf bi"><span id="e51a" class="lg jv hi lb b fi lh li l lj lk"># Print the first 10 rows for sanity check<br/>rows = soup.find_all('tr')<br/>print(rows[:10])</span><span id="6eb4" class="lg jv hi lb b fi ll li l lj lk">for row in rows:<br/>    row_td = row.find_all('td')<br/>print(row_td)<br/>type(row_td)</span><span id="bbd7" class="lg jv hi lb b fi ll li l lj lk">str_cells = str(row_td)<br/>cleantext = BeautifulSoup(str_cells, "lxml").get_text()<br/>print(cleantext)</span></pre><p id="1410" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Python内置的“re”模块为<a class="ae jt" href="https://www.regular-expressions.info/tutorial.html" rel="noopener ugc nofollow" target="_blank">正则表达式</a>提供了出色的支持，具有现代而完整的正则表达式味道。正则表达式指定一组与之匹配的字符串；这个模块中的函数允许你检查一个特定的字符串是否匹配一个给定的正则表达式(或者一个给定的正则表达式是否匹配一个特定的字符串，这归结为同样的事情)。</p><pre class="je jf jg jh fd lc lb ld le aw lf bi"><span id="198b" class="lg jv hi lb b fi lh li l lj lk">import re<br/>list_rows = []<br/>for row in rows:<br/>    cells = row.find_all('td')<br/>    str_cells = str(cells)<br/>    clean = re.compile('&lt;.*?&gt;')<br/>    clean2 = (re.sub(clean, '',str_cells))<br/>    list_rows.append(clean2)<br/>print(clean2)<br/>type(clean2)</span></pre><p id="acd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">清理完数据后，我正在使用pandas库创建一个数据框。</p><pre class="je jf jg jh fd lc lb ld le aw lf bi"><span id="923a" class="lg jv hi lb b fi lh li l lj lk">df = pd.DataFrame(list_rows)<br/>df.head(10)</span><span id="82e0" class="lg jv hi lb b fi ll li l lj lk">df1 = df[0].str.split(',', expand=True)<br/>df1.head(10)<br/>df1.fillna(0)<br/>#df1.to_excel('data_check.xlsx')<br/>df1[0] = df1[0].str.strip('[')<br/>df1.head()</span><span id="f4d7" class="lg jv hi lb b fi ll li l lj lk">new_header = df1.iloc[0] #grab the first row for the header</span><span id="976a" class="lg jv hi lb b fi ll li l lj lk">df1 = df1[1:] #take the data less the header row<br/>df1.columns = new_header</span></pre><p id="0db8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行代码后查看数据:</p><pre class="je jf jg jh fd lc lb ld le aw lf bi"><span id="bb2a" class="lg jv hi lb b fi lh li l lj lk">df1.head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/045dd7ab0798b7a8d4137f788106da49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jag6Y7HmooKnAIKSyFECCg.png"/></div></div></figure><p id="9559" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">选择相关列:</p><pre class="je jf jg jh fd lc lb ld le aw lf bi"><span id="1afd" class="lg jv hi lb b fi lh li l lj lk">df2=df1[['Country or territory',' Total tests',' Date',' Source',' Source Date']]<br/>df2</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ln"><img src="../Images/db2fb6b2c42080f757d1a09b6f0cd0ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AKNYuzOfEkCdyQuKEdp2cg.png"/></div></div></figure><p id="72cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为国家缩写添加新的列名“代码”:</p><pre class="je jf jg jh fd lc lb ld le aw lf bi"><span id="690f" class="lg jv hi lb b fi lh li l lj lk">Code=['SVN','ISL','MLT','AUS','QAT','ROU','ARM','AUS','IRN','THA','IRL','ZAF','GBR','CAN','NLD','NZL','CAN','HKG','CAN','NOR','COL','CHE','AUS','USA','FRA']</span><span id="6712" class="lg jv hi lb b fi ll li l lj lk">df3['Code']=Code<br/>df3</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lo"><img src="../Images/3b4a03fb64c2c430603113b281ccb48d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hI-8RDZLlhOEinS63QQjNw.png"/></div></div></figure></div><div class="ab cl lp lq gp lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hb hc hd he hf"><h1 id="ef8d" class="ju jv hi bd jw jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr bi translated">创建国家地图(前25名)</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mb"><img src="../Images/4dd5713c6f19187e8f4046236d9fc1fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Fmg-D4dqWewHduid"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">德尔菲·德拉鲁阿在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><pre class="je jf jg jh fd lc lb ld le aw lf bi"><span id="c8ea" class="lg jv hi lb b fi lh li l lj lk">df = df3</span><span id="231a" class="lg jv hi lb b fi ll li l lj lk">fig = go.Figure(data=go.Choropleth(<br/>    locations = df['Code'],<br/>    z = df[' Total tests'],<br/>    text = df['Country or territory'],<br/>    colorscale = 'Reds',<br/>    autocolorscale=False,<br/>    reversescale=True,<br/>    marker_line_color='darkgray',<br/>    marker_line_width=0.5,<br/>    colorbar_tickprefix = '',<br/>    colorbar_title = 'Total Number of test of COV-19 ',<br/>))</span><span id="20d9" class="lg jv hi lb b fi ll li l lj lk">fig.update_layout(<br/>    title_text='Total Number of test of COV-19  ',<br/>    geo=dict(<br/>        showframe=False,<br/>        showcoastlines=False,<br/>        projection_type='equirectangular'<br/>    ),<br/>    annotations = [dict(<br/>        x=0.55,<br/>        y=0.1,<br/>        xref='paper',<br/>        yref='paper',<br/>        text='Source: &lt;a href="<a class="ae jt" href="https://www.cia.gov/library/publications/the-world-factbook/fields/2195.html" rel="noopener ugc nofollow" target="_blank">https://www.cia.gov/library/publications/the-world-factbook/fields/2195.html</a>"&gt;\<br/>            CIA World Factbook&lt;/a&gt;',<br/>        showarrow = False<br/>    )]<br/>)</span><span id="466b" class="lg jv hi lb b fi ll li l lj lk">fig.show()</span></pre><p id="6624" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最终输出:-</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mc"><img src="../Images/139d7d9e29452fbb7753e7d35d188404.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*9XJ7fwbyjuTKKhLLgsYr-A.png"/></div></figure><h1 id="24ac" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">结论</h1><p id="3ae1" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">我们能够进行端到端的分析，首先，我们从网站中提取表格，然后创建可视化。</p><p id="d8ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这篇文章能帮助你并节省大量的时间。</p><p id="a358" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">快乐编码。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es md"><img src="../Images/527b4b5ecd1d3d74ae5f0cb8de3ebcea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TR1xoWrasfxvVLvE"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">照片由<a class="ae jt" href="https://unsplash.com/@lephunghia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Nghia Le </a>在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure></div></div>    
</body>
</html>