<html>
<head>
<title>Preparing to Train a custom Darknet model on Windows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">准备在Windows上训练自定义暗网模型</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/preparing-to-train-a-custom-darknet-model-on-windows-dea2f33f8177?source=collection_archive---------8-----------------------#2019-12-10">https://medium.com/analytics-vidhya/preparing-to-train-a-custom-darknet-model-on-windows-dea2f33f8177?source=collection_archive---------8-----------------------#2019-12-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d165" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">继我之前的<a class="ae jd" rel="noopener" href="/analytics-vidhya/installing-darknet-on-windows-462d84840e5a">文章</a>之后，我将讨论如何开始准备一个定制数据集来训练Windows上的暗网模型。如果你还没有安装Darknet，我强烈建议你按照我上面的教程来做。假设您现在已经对Darknet有所了解，我将直接进入其中。</p><p id="966b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想简单地确认您的文件是否位于正确的文件夹中，那么我建议导航到下面的<strong class="ih hj">“文件路径指南”</strong>部分。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/08bb66a83fb0dca95078d1798fe28706.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*oSgUGEJxDmE33mOUP6IHWA.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">暗网的标志</figcaption></figure><h1 id="1de4" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">定制培训配置</h1><p id="bada" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">第一步是找到位于cfg文件夹中的<strong class="ih hj"> yolov3.cfg </strong>文件，并创建该文件的副本。将重复文件重命名为<strong class="ih hj"> yolo-obj.cfg </strong>。</p><p id="6338" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，打开yolo-obj.cfg文件进行编辑。按照此<a class="ae jd" href="https://github.com/AlexeyAB/darknet#how-to-train-to-detect-your-custom-objects" rel="noopener ugc nofollow" target="_blank">链接</a>所示的顺序对该文件进行必要的更改。</p><p id="10e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了澄清，不要更改文件中的所有过滤器。只改变标签<strong class="ih hj">卷积</strong>层中的滤波器。</p><p id="b5ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，对卷积层中的滤波器使用公式(class+5)* 3。</p><p id="1fc0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于下一步，导航到<strong class="ih hj"> build/darknet/x64/data </strong>文件夹，并复制一份<strong class="ih hj"> coco.data </strong>文件。另外，复制一份<strong class="ih hj"> coco.names </strong>文件。</p><p id="964d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将这些副本移动到主darknet目录下的data文件夹中，并分别重命名为<strong class="ih hj"> obj.data </strong>和<strong class="ih hj"> obj.names </strong>。在<strong class="ih hj"> obj.names </strong>中，简单地写下您将在模型中使用的类的名称。每个类名应该在单独的一行上。</p><p id="5ea8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，确保编辑obj.data文件，如下所示。</p><pre class="jf jg jh ji fd kt ku kv kw aw kx bi"><span id="5344" class="ky jr hi ku b fi kz la l lb lc">classes= *Set this number*<br/>train  = data/train.txt<br/>valid  = data/test.txt<br/>names = data/obj.names<br/>backup = backup/</span></pre><p id="9177" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在开始标记图像之前，您仍然需要下载预训练的权重进行训练。点击此<a class="ae jd" href="https://pjreddie.com/media/files/darknet53.conv.74" rel="noopener ugc nofollow" target="_blank">链接</a>以获得预训练的卷积权重，并将它们移动到主darknet目录。</p><p id="b305" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，您需要创建一个名为obj的文件夹，并将其放在data文件夹中。在这个obj文件夹中，您将放置所有图像及其注释文件。</p><h1 id="2950" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">为训练数据录制视频</h1><p id="66b6" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">如果你计划录制视频样本来生成训练模型的图像，我强烈推荐一个叫做<a class="ae jd" href="https://sourceforge.net/projects/autoscreen/" rel="noopener ugc nofollow" target="_blank">自动截屏</a>的工具。这个工具可以让你长时间的截图你的桌面/窗口。</p><p id="c4a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以我推荐的是录下你的视频，设置自动截屏工具每秒截图，启动截屏，播放视频，剩下的就让工具处理吧！视频完成后，一定要打开截图的文件夹，将它们移到安全的地方。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ld"><img src="../Images/b280eb46df147ce7e04e0c75cbcfb07d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6MnJMDDzyF_xHOvNb-JbUw.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">自动屏幕捕获窗口</figcaption></figure><h1 id="a9a5" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">用标签标记图像</h1><p id="68be" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">要执行对象检测，您的模型将学习在图像、视频或实时提要中“定位”对象。定位是围绕图像中检测到的对象绘制边界框的过程。为了让模型本地化对象，需要在训练数据中绘制边界框。</p><p id="6b8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有许多不同的方法可以做到这一点，但是我推荐的工具叫做<a class="ae jd" href="https://github.com/tzutalin/labelImg" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj"/></a><strong class="ih hj">。</strong>如果您目前使用的是Windows电脑，请点击此<a class="ae jd" href="https://github.com/tzutalin/labelImg#windows" rel="noopener ugc nofollow" target="_blank">链接</a>获取安装说明。</p><p id="b7d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装完成后，您将需要定义您的类，因为我们将使用注释来训练YOLO模型。</p><p id="e489" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您需要打开<strong class="ih hj">label img-master/data/predefined _ classes . txt</strong>文件，并将每个类名写在单独的一行上。</p><p id="df7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，打开Anaconda提示符或命令提示符，并导航到<strong class="ih hj"> labelImg-master文件夹</strong>。之后，您应该键入以下命令:</p><pre class="jf jg jh ji fd kt ku kv kw aw kx bi"><span id="b785" class="ky jr hi ku b fi kz la l lb lc">python labelImg.py [LOCATION OF YOUR TRAINING IMAGES]</span></pre><p id="e5d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，如果我的训练图像位于我的D:驱动器上名为Pictures的文件夹中，那么我的命令将如下所示:</p><pre class="jf jg jh ji fd kt ku kv kw aw kx bi"><span id="f294" class="ky jr hi ku b fi kz la l lb lc">python labelImg.py D:\Pictures</span></pre><p id="e264" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将打开如下所示的窗口，第一张图像位于文件夹中。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es li"><img src="../Images/f98e21006ff8042a3e1fc34c32b87939.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dh1coI3YPGf_hkQmzZcCzg.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">标签窗口</figcaption></figure><p id="2f11" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，注释类型为PascalVOC，如左侧菜单所示。要切换到YOLO，你只需点击PascalVOC。验证左侧菜单如下图所示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lj"><img src="../Images/0ebdf7eadf90669db8b9782e99708ec7.png" data-original-src="https://miro.medium.com/v2/resize:fit:296/format:webp/1*pov62PVIE4XSvIUA5tCNfA.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">YOLO注释</figcaption></figure><p id="2708" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，你只需点击位于上图所示YOLO按钮正下方的<strong class="ih hj">“Create \ nRectBox”</strong>按钮，在对象周围画一个边界框。一旦你完成了物体周围的边界框的绘制，程序会要求你给这个框指定一个类。您只需选择课程并点击<strong class="ih hj">“确定”</strong>。</p><p id="0839" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确保单击“保存”或按Ctrl + S保存边界框注释。我强烈建议使用与训练图像相同的名称保存注释文件。验证文件是否为txt格式，因为PascalVOC只以XML格式保存注释。</p><p id="ccf8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，您可以点击<strong class="ih hj">“下一张图像”</strong>按钮继续注释文件夹中的所有图像。<strong class="ih hj"> <em class="lk">提示:</em> </strong> <em class="lk">如果后续图片与前一张图片的类别类型相同，则在后续图片上使用CTRL + D。这将使用已经指定的类复制边界框。</em></p><h1 id="d0ba" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">最终确定步骤</h1><p id="9eb5" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">如果您已经创建了注释并将图像放在darknet-master/data/obj文件夹中，那么您就可以开始下一步了！如果没有，那么我强烈建议将这些文件复制到这个位置。</p><p id="d954" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">训练前的最后一步是提取所有图像文件名，并将它们添加到名为train.txt的文件中。该train.txt必须放在darknet-master的data文件夹中。</p><p id="d715" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了节省您完成这项繁琐工作的时间，我编写了一个python脚本，您可以使用。你所需要做的就是用darknet-master的位置设置<strong class="ih hj"> customPath </strong>变量。代码的要点可以在这里访问<a class="ae jd" href="https://gist.github.com/Vimal-Raghubir/2e59486fa951a8fe2bafa1b3e0f77008" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="c4e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你完成了上面的所有步骤，你就应该为训练做好准备了！</p><h1 id="1703" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">文件路径指南</h1><p id="dcd5" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">为了确认，请参见下面的文件路径指南:</p><pre class="jf jg jh ji fd kt ku kv kw aw kx bi"><span id="efbd" class="ky jr hi ku b fi kz la l lb lc">darknet-master/data/obj.data<br/>darknet-master/data/obj.names<br/>darknet-master/data/train.txt<br/>darknet-master/data/obj/          //All images + annotations in here<br/>darknet-master/cfg/yolo-obj.cfg<br/>darknet-master/darknet53.conv.74<br/>darknet-master/backup             //Make sure to create this folder</span></pre><h1 id="2f0b" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">结论</h1><p id="8dd3" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">你现在可以开始训练了！稍后我很可能会发表一篇关于如何训练暗网模型、调整它、提高地图分数等等的博文。目前，如果您有任何问题，请务必留下评论！发展愉快，我希望在我的下一篇博文中见到你！</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ll"><img src="../Images/0efe890def020a9e95e5d14292a041e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*YPZM1SR-gAyp8PPYAhqs1g.jpeg"/></div></figure></div></div>    
</body>
</html>