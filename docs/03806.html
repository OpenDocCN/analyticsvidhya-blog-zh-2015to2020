<html>
<head>
<title>Instance Segmentation using Mask R-CNN on a custom dataset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在定制数据集上使用掩模R-CNN的实例分割</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/instance-segmentation-using-mask-r-cnn-on-a-custom-dataset-78631845de2a?source=collection_archive---------0-----------------------#2020-02-20">https://medium.com/analytics-vidhya/instance-segmentation-using-mask-r-cnn-on-a-custom-dataset-78631845de2a?source=collection_archive---------0-----------------------#2020-02-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="93ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd">在本文中，我们将使用Mask R-CNN对自定义数据集进行实例分割。</em>T3】</strong></p><p id="97e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在进入实现的细节之前，<strong class="ih hj">分割到底是什么？细分的类型有哪些？</strong></p><p id="68de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这张图片很好地解释了不同的计算机视觉技术:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/cbcdcdae8a4d414e2349a41cec5b74cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*rFHoslLmk5rwddVFcdakgw.jpeg"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">来源:<a class="ae jq" href="https://engineering.matterport.com/splash-of-color-instance-segmentation-with-mask-r-cnn-and-tensorflow-7c761e238b46" rel="noopener ugc nofollow" target="_blank">https://engineering . matter port . com/splash-of-color-instance-segmentation-with mask-r-CNN-and-tensor flow-7c 761 e 238 b 46</a></figcaption></figure><ul class=""><li id="ddd0" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated"><strong class="ih hj">分类:</strong>简单告知图像中是否存在气球。</li><li id="096a" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><strong class="ih hj">对象检测:</strong>定位图像中的所有气球对象，并为每个对象生成边界框。</li><li id="25a0" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><strong class="ih hj">语义分割:</strong>用相同的颜色高亮显示所有的气球像素。</li><li id="2e3a" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><strong class="ih hj">实例分割:</strong>用不同的颜色突出显示气球的不同实例。</li></ul><p id="8ac9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，<strong class="ih hj">语义分割</strong>会将所有对象分类为单个实例。但是在<strong class="ih hj">实例分割</strong>中，同一类的不同对象被分配为不同的实例。</p><p id="cddf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们已经有了目标检测，为什么还需要分割？</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es et"><img src="../Images/c7967027f8bec2c57d62304a280e68ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-utT04no_pxSaxxNIT5eEQ.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">来源:<a class="ae jq" rel="noopener" href="/analytics-vidhya/image-classification-vs-object-detection-vs-image-segmentation-f36db85fe81">https://medium . com/analytics-vid hya/image-class ification-vs-object-detection-vs-image-segmentation-f 36 db 85 Fe 81</a></figcaption></figure><p id="3e60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对象检测创建对应于图像中每个类别的边界框。但是它没有给出关于物体形状的信息。我们只得到边界框坐标的集合。</p><p id="415d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图像分割为图像中的每个对象创建逐像素的遮罩。因此它让我们对图像中的物体有了更细致的了解。</p><p id="4219" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jq" href="https://engineering.matterport.com/splash-of-color-instance-segmentation-with-mask-r-cnn-and-tensorflow-7c761e238b46" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">这篇</strong> </a>文章很好地洞察了理论部分，解释了什么是Mask R-CNN，它的架构以及如何在自定义数据集上训练它，但我仍然发现实现实际代码有点困难，所以我写这篇文章时提供了详细的步骤和一些实际的代码片段。</p><p id="3187" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里有一个预训练模型<a class="ae jq" href="https://github.com/matterport/Mask_RCNN/releases" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj"/></a><strong class="ih hj"/>，它是使用Mask R-CNN在COCO数据集上训练的，但它只包含80个类，因此我们现在将看到如何使用迁移学习在自定义类上训练。</p><p id="d27c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将要训练的自定义对象是“瓶子”。<a class="ae jq" href="https://github.com/AISangam/Mask-RCNN-bottle-training/tree/master/dataset" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">这里的</strong> </a>是对同一数据集的链接。因此，让我们深入了解实现细节:</p><h1 id="5029" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">步骤1:准备数据集</h1><p id="e06a" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">我上面提到的数据集由100幅图像组成，其中76幅用于训练，其余用于验证。我使用工具<a class="ae jq" href="http://www.robots.ox.ac.uk/~vgg/software/via/" rel="noopener ugc nofollow" target="_blank"> VGG注释器</a>来标记图像。这是一个简单的工具，它标记所有的图像，并将其导出到一个单一的JSON文件。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lm"><img src="../Images/cb65deb1c41e93972b66bc8ca11a91d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*1nzjCtmG39leaw7FixQCbg.jpeg"/></div></figure><h1 id="1d07" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">步骤2:克隆存储库</h1><p id="f79a" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">使用下面的命令克隆存储库</p><pre class="jf jg jh ji fd ln lo lp lq aw lr bi"><span id="740d" class="ls kk hi lo b fi lt lu l lv lw"><em class="jd">git clone </em><a class="ae jq" href="https://github.com/matterport/Mask_RCNN.git" rel="noopener ugc nofollow" target="_blank">https://github.com/matterport/Mask_RCNN.git</a></span></pre><p id="e22f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这之后，我们需要安装Mask R-CNN所需的依赖项。</p><h1 id="6d5e" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">步骤3:安装依赖项</h1><p id="e0f6" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">该存储库包含一个名为requirements.txt的文件，该文件列出了所有依赖项，因此使用以下命令来安装所有依赖项:</p><pre class="jf jg jh ji fd ln lo lp lq aw lr bi"><span id="2563" class="ls kk hi lo b fi lt lu l lv lw">pip install -r requirements.txt</span></pre><h1 id="0145" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">步骤4:下载预先训练的重量(在COCO上训练)</h1><p id="6447" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">接下来，我们需要下载预先训练的重量。您可以使用<a class="ae jq" href="https://github.com/matterport/Mask_RCNN/releases" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">此链接</strong> </a>下载预先训练好的重量。这些权重是从在MS COCO数据集上训练的模型获得的。下载完权重后，将该文件粘贴到我们在步骤2中克隆的Mask_RCNN存储库的根文件夹中。</p><h1 id="60ef" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">步骤5:编辑自定义类的代码</h1><p id="4af6" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">在克隆的repo的samples目录中，创建一个您的类的新文件夹，在我的例子中，它是bottle。在此文件夹中，创建一个数据集文件夹，并将训练和验证图像粘贴到其中。此外，复制文件balloons.py并将其重命名为bottle.py，然后根据需要进行编辑。这是我的<strong class="ih hj">b</strong><a class="ae jq" href="https://github.com/shashankchandak/Instance-Segmentation-MaskRCNN/blob/master/samples/bottle/bottle.py" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">ottle . py</strong></a>文件的链接，现在让我们看看我们需要编辑什么。</p><ol class=""><li id="1101" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc lx jx jy jz bi translated"><strong class="ih hj">数据集类</strong></li></ol><p id="4551" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它包括3个需要改变的功能:</p><pre class="jf jg jh ji fd ln lo lp lq aw lr bi"><span id="ceb4" class="ls kk hi lo b fi lt lu l lv lw">def <strong class="lo hj">load_balloons</strong>(self, dataset_dir, subset):<br/>def <strong class="lo hj">load_mask</strong>(self, image_id):<br/>def <strong class="lo hj">image_reference</strong>(self, image_id):</span></pre><p id="9149" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在所有3个函数中用你的自定义类名(这里是瓶子)替换“气球”。</p><p id="5eae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.<strong class="ih hj">配置类</strong></p><pre class="jf jg jh ji fd ln lo lp lq aw lr bi"><span id="6da2" class="ls kk hi lo b fi lt lu l lv lw">class BottleConfig(Config):</span><span id="b006" class="ls kk hi lo b fi ly lu l lv lw">NAME = "bottle"</span><span id="ab13" class="ls kk hi lo b fi ly lu l lv lw"># Number of classes (including background)<br/>    NUM_CLASSES = 1 + 1  # Background + bottle</span><span id="e6a0" class="ls kk hi lo b fi ly lu l lv lw"># Number of training steps per epoch   <br/>    STEPS_PER_EPOCH = 100</span></pre><h1 id="113f" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">第六步:培训</h1><p id="c3c6" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">训练是一项计算繁重的任务，将需要一个GPU，如果你没有一个不要担心，我会告诉你如何使用谷歌colab的训练目的。从bottle目录中运行这个命令来开始训练</p><pre class="jf jg jh ji fd ln lo lp lq aw lr bi"><span id="6595" class="ls kk hi lo b fi lt lu l lv lw">python bottle.py train --dataset=/samples/bottle/dataset  <br/>--weights=coco</span></pre><p id="67fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于那些没有GPU的人，这里是我的<strong class="ih hj"> </strong> <a class="ae jq" href="https://colab.research.google.com/drive/1vpgz4SbR5NdIltyifEuVBAvfuLnVfc0B" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> colab笔记本的链接。</strong> </a></p><p id="f21b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些步骤如下</p><ol class=""><li id="01be" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc lx jx jy jz bi translated">将包含所有文件的整个目录结构上传到google drive。</li><li id="8699" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc lx jx jy jz bi translated">创建新的Colab笔记本。</li><li id="b1af" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc lx jx jy jz bi translated">代码参考我的<a class="ae jq" href="https://colab.research.google.com/drive/1vpgz4SbR5NdIltyifEuVBAvfuLnVfc0B" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> colab笔记本</strong> </a>开始训练。</li><li id="e777" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc lx jx jy jz bi translated">所有的模型都将被保存到你的google drive中的文件夹rootdir/logs/</li></ol><h1 id="8d17" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">步骤7:评估模型</h1><p id="7470" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">评估模型的代码可以在<a class="ae jq" href="https://github.com/shashankchandak/Instance-Segmentation-MaskRCNN/blob/master/samples/bottle/inspect_bottle_model.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">这里</strong> </a>找到。下面是输出的一个示例。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lz"><img src="../Images/9dd888e891c0d025f293a9f929b12cc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*MpMVbHshb3w7ueKw-qu-Dg.jpeg"/></div></figure><p id="cba7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">就是这样！我们已经成功地在一个定制的数据集上实现了实例分割。</em></p><p id="5a29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参考资料:</p><ol class=""><li id="7a89" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc lx jx jy jz bi translated"><a class="ae jq" href="https://engineering.matterport.com/splash-of-color-instance-segmentation-with-mask-r-cnn-and-tensorflow-7c761e238b46" rel="noopener ugc nofollow" target="_blank">https://engineering . matter port . com/splash-of-color-instance-segmentation-with-mask-r-CNN-and-tensor flow-7c 761 e 238 b 46</a></li><li id="4f11" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc lx jx jy jz bi translated"><a class="ae jq" href="https://www.analyticsvidhya.com/blog/2019/07/computer-vision-implementing-mask-r-cnn-image-segmentation/?utm_source=blog&amp;utm_medium=introduction-image-segmentation-techniques-python" rel="noopener ugc nofollow" target="_blank">https://www . analyticsvidhya . com/blog/2019/07/computer-vision-implementing-mask-r-CNN-image-segmentation/？UTM _ source = blog&amp;UTM _ medium =简介-图像-分割-技术-python </a></li><li id="b577" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc lx jx jy jz bi translated"><a class="ae jq" href="https://github.com/AISangam/Mask-RCNN-bottle-training" rel="noopener ugc nofollow" target="_blank">https://github.com/AISangam/Mask-RCNN-bottle-training</a></li></ol></div><div class="ab cl ma mb gp mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="hb hc hd he hf"><p id="af7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如有任何疑问，你可以打电话到chandak.shashank16@gmail.com找我</p><p id="2408" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以通过我的其他个人资料联系我:</p><p id="0836" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jq" href="https://www.linkedin.com/in/shashankchandak16" rel="noopener ugc nofollow" target="_blank">领英</a></p><p id="a2a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jq" href="https://github.com/shashankchandak" rel="noopener ugc nofollow" target="_blank"> Github </a></p><p id="959f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jq" href="https://twitter.com/chandakshashank" rel="noopener ugc nofollow" target="_blank">推特</a></p></div></div>    
</body>
</html>