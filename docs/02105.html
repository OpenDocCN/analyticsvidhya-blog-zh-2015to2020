<html>
<head>
<title>Kinesis(AWS) vs. PubSub (GCP) and how they stand near Kafka</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kinesis(AWS) vs. PubSub (GCP)以及他们如何站在卡夫卡旁边</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/kinesis-aws-vs-pubsub-gcp-and-how-they-stand-near-kafka-c55a309598?source=collection_archive---------1-----------------------#2019-12-01">https://medium.com/analytics-vidhya/kinesis-aws-vs-pubsub-gcp-and-how-they-stand-near-kafka-c55a309598?source=collection_archive---------1-----------------------#2019-12-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9ae6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在过去的一年里，我在这两个管理流上做了大量工作，让我们了解每一个，它的能力，概念和弱点，最后将两个云解决方案与Kafka进行比较。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/9caaaae096833fc378f894b2166838c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*IwDZ1L1Xqyf5n7kxf_vYqg.png"/></div></figure><h1 id="2de3" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">GCP公共订阅</h1><h2 id="ac31" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">这里的组件是谁？</h2><p id="b231" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">1.话题<br/> 2。订阅。</p><p id="f1f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据发布到主题，主题可以有多个订阅，每个订阅服务一个消费者。<br/>不用说，任何订阅都是相互独立的，它只是为任何消费者设置流状态。</p><h2 id="bce9" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">缩放:</h2><p id="315c" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">您不必担心缩放，PubSub“知道”根据发布消息的速率来调整自己。没有必要用碎片/隔板“弄脏你的手”，GCP正在为你安排。</p><h2 id="1ccd" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">监视</h2><p id="5566" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">您可以使用StackDriver度量来监视PubSub，您可以在主题级别或订阅级别进行监视。</p><p id="074f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这两个指标表明订阅有不能及时确认的消息。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lc"><img src="../Images/5209440bd7ab5ccb659f600fdcf3cb7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nWACNcyVcq-BRASiL80F9Q.png"/></div></div></figure><p id="844d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下面的指标中，您可以看到发布消息率与确认率，在这种情况下，它们是相同的，表明确认过程运行良好，没有瓶颈。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lh"><img src="../Images/ba19f4c1675e92f53959419d02eed7e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hMPAdPTLk1HHwqKeXkt1oA.png"/></div></div></figure><h2 id="5e72" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">数据顺序</h2><p id="da6d" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">尽力而为，使用系统提供的<code class="du li lj lk ll b">publishTime</code>属性按照消息发布的顺序传递消息。云发布/订阅不保证一次性或有序交付。</p><h2 id="e9d0" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">一次性保证</h2><p id="4cab" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">尽最大努力，PubSub不保证只交付一次。</p><h1 id="3d49" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">运动学:</h1><h2 id="a76c" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">这里的组件是谁？</h2><ol class=""><li id="77a8" class="lm ln hi ih b ii kx im ky iq lo iu lp iy lq jc lr ls lt lu bi translated">溪流</li><li id="f05e" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc lr ls lt lu bi translated">碎片</li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es ma"><img src="../Images/8829595097dfc76b5d7c2fcf2e1fe884.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*npuiYDvuDgtyFwQSQXrkaQ.png"/></div></div></figure><p id="12e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个流类似于PubSub中的" Topic ",一个记录流，一个必须配置分片号的流，这将定义它的容量:</p><blockquote class="mb mc md"><p id="d1b7" class="if ig me ih b ii ij ik il im in io ip mf ir is it mg iv iw ix mh iz ja jb jc hb bi translated">碎片是吞吐量的单位。每个碎片每秒接收1MB和1000条记录，每秒发出2MB。为了适应更高或更低的吞吐量，可以在创建Kinesis流之后修改碎片的数量。</p></blockquote><p id="c7f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你创建你的流时，你必须选择碎片的数量。非常重要的是要记住:你要按小时付费！如果你有几个小时，你预计你的流量增加，你需要设置碎片数为最高流量，即使你不需要它的其余时间…</p><p id="6965" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建流时，AWS会帮助您计算所需的分片数:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es mi"><img src="../Images/25ce8b38e7df63d475367c5438aef24a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qiQm8lQhdLPluSfWx9jyVg.png"/></div></div></figure><h2 id="3774" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">当我有尖峰时会发生什么？</h2><p id="dc58" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">然后你会得到:“<code class="du li lj lk ll b">Rate exceeded for shard shardId-000000000052 in stream [some stream name] under account…</code>”<br/>如果是临时的spike，这可能是有效的，因为生产者库(<a class="ae mj" href="https://docs.aws.amazon.com/streams/latest/dev/developing-producers-with-kpl.html" rel="noopener ugc nofollow" target="_blank"> KPL </a>)曾经再次重试，被spike的记录会在下一次重试时被摄取。<br/> AWS还建议实施背压机制，以避免这种峰值。</p><h2 id="3883" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">当我必须增加碎片数量时会发生什么？还是减少？</h2><p id="651f" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">您可以增加碎片的数量，只能是其当前大小的两倍，或者如果您想要更少，则可以将其减少，但只能是当前大小的一半，这种限制会导致您在多次迭代中执行此过渡。</p><p id="e901" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你改变了碎片的数量，Kinesis为你处理重新分片，零停机时间。</p><h2 id="2d2f" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">分区键:</h2><p id="7c3f" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">对于你发送到Kinesis的任何记录，你应该指定它的分区键，这个键用于在可用的分片上平衡记录的负载。<br/>我通常做<code class="du li lj lk ll b">UUID.<em class="me">randomUUID</em>().toString()</code>。</p><h2 id="7864" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">监控:</h2><p id="a0ed" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">你可以在CloudWatch中，在分片级别和流级别对其进行监控。也支持警报。</p><p id="51a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">而如果要由消费者来监控呢？这有点挑战性，你必须确保你的消费者将指标发送到CloudWatch，(并且你为每个API调用付费)。在这里阅读更多<a class="ae mj" href="https://docs.aws.amazon.com/streams/latest/dev/monitoring-with-kcl.html#kcl-metrics-per-app" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="ec3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您还需要监视“<code class="du li lj lk ll b">WriteProvisionedThroughputExceeded”</code>和“<code class="du li lj lk ll b">ReadProvisionedThroughputExceeded</code>”，它们向您显示了超过碎片限制的读/写情况。</p><p id="2251" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以在下面的指标中看到，有时<code class="du li lj lk ll b">WriteProvisionedThroughputExceeded,</code>这可能与传入数据的峰值相关。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es mk"><img src="../Images/d5db0b33f10cffa75253ac3740c61a54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PX0gfwHpMJYzjmYyaY-2ZA.png"/></div></div></figure><h2 id="d8d9" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">定量</h2><p id="7a6c" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">Kinesis支持记录的批处理，它有专门的API用于“腐败记录”，而不是“腐败记录”。</p><blockquote class="mb mc md"><p id="c9c9" class="if ig me ih b ii ij ik il im in io ip mf ir is it mg iv iw ix mh iz ja jb jc hb bi translated">每个腐败记录请求最多可以支持500条记录。请求中的每个记录最大可达1 MB，整个请求的最大限制为5 MB。</p></blockquote><p id="a1c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">需要记住的是，当在一个API调用中生成聚合记录时，您还需要在消费它时解聚合它们。点击阅读更多<a class="ae mj" href="https://docs.aws.amazon.com/streams/latest/dev/kinesis-kpl-consumer-deaggregation.html" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="6690" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">数据顺序</h2><p id="1ddf" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">可以在分片级别实现排序，因为生产者必须发送包括其分区键在内的任何记录来确定分片。此外，任何记录都有一个序列号。因此，当消费者读取数据时，它将通过分片并按顺序接收数据。</p><h2 id="8ad8" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">一次性保证</h2><p id="932f" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">一条记录可以多次交付给消费者，因此应用程序必须强制执行恰好一次语义。有关更多信息，请参见亚马逊Kinesis数据流文档中的<a class="ae mj" href="https://docs.aws.amazon.com/streams/latest/dev/kinesis-record-processor-duplicates.html" rel="noopener ugc nofollow" target="_blank">处理重复记录</a>。</p><h1 id="36e0" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">将云解决方案与Kafka(最流行的)进行比较:</h1><h2 id="96cb" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">缩放:</h2><p id="c21a" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">Kafka不支持自动缩放，当你需要向主题中发送更多数据时，你必须增加分区、代理、复制等等。</p><p id="0162" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，集群中有大量的维护工作和多个需要增强的相关组件。</p><p id="2808" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Kinesis/PubSub时不需要这些操作。即使说Kinesis不是自动放大/缩小的，它仍然比在卡夫卡中更容易做到。</p><h2 id="4c3b" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">订单:</h2><p id="148b" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">Kafka可以在分区级别支持有序消息，用户从分区中读取数据，因此它将得到有序的消息。</p><h2 id="e74a" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">供应商锁:</h2><p id="cf3e" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">选择Kafka时，您不会被云供应商锁定，并且您可以在不接触任何代码/基础架构的情况下更改云提供商。<br/>卡夫卡，因为越来越受欢迎，拥有强大的生态系统，无数的工具和第三方连接器/接收器/提供者，让你轻松与外部世界融合。</p><h2 id="5e36" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">托管服务:</h2><p id="54af" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">卡夫卡设计过像<a class="ae mj" href="https://www.confluent.io/confluent-cloud/?utm_medium=sem&amp;utm_source=google&amp;utm_campaign=ch.sem_br.nonbrand_tp.prs_tgt.kafka_mt.xct_rgn.emea_lng.eng_dv.all&amp;utm_term=kafka%20managed%20service&amp;creative=367725579988&amp;device=c&amp;placement=&amp;gclid=EAIaIQobChMI0oXR683q5QIVSbTtCh1FMwEGEAAYASAAEgIRsvD_BwE" rel="noopener ugc nofollow" target="_blank">汇合</a>、<a class="ae mj" href="https://aiven.io/kafka?utm_expid=.r7Ehyfv2TDiN_-_Ue3zzqQ.0&amp;utm_referrer=https%3A%2F%2Faiven.io%2F" rel="noopener ugc nofollow" target="_blank">艾文</a>等解决方案。<br/>他们可以在任何云上为你构建集群:Aws/GCP/Azure。<br/>这个值得一查，因为Kafka自有实力，托管服务解决了集群维护部分。现在，您可以受益于其他Kafka功能:Kafka流、消息持久性、事务、消息排序、仅一次保证…</p><h1 id="880c" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">SumUp:</h1><p id="1b1d" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated"><strong class="ih hj">发布订阅</strong>:</p><ul class=""><li id="1648" class="lm ln hi ih b ii ij im in iq ml iu mm iy mn jc mo ls lt lu bi translated"><strong class="ih hj">零运算</strong>，无需定义分区和分片。</li><li id="54a3" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc mo ls lt lu bi translated"><strong class="ih hj">缩放</strong>是内置的，不需要任何操作(至少检查一下你没有达到一些配额限制)。</li><li id="4baf" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc mo ls lt lu bi translated"><strong class="ih hj">只为使用付费</strong>。</li><li id="d395" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc mo ls lt lu bi translated"><strong class="ih hj">监控</strong>友好简单。</li><li id="67cd" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc mo ls lt lu bi translated"><strong class="ih hj">生产者代码</strong>是直截了当的，没有处理分区/分片错误/反压力。</li></ul><p id="9a8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">驱动力</strong></p><ul class=""><li id="f5ea" class="lm ln hi ih b ii ij im in iq ml iu mm iy mn jc mo ls lt lu bi translated"><strong class="ih hj">扩展</strong>也是受管理的，但是你必须知道你的预期用途，并相应地操作扩大/缩小，这不会自动发生。</li><li id="f8a2" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc mo ls lt lu bi translated">你需要为你打开的碎片付费，即使你并没有使用所有的碎片。</li><li id="15cd" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc mo ls lt lu bi translated">监控并不总是免费的，以防你不得不发送自定义指标(每个消费者)。</li><li id="8f1e" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc mo ls lt lu bi translated"><strong class="ih hj">生产者代码</strong>可能很复杂，建议使用KPL库，(仅限java)</li></ul><p id="16ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Kafka </strong>，一方面有强大的生态系统，丰富的功能，而且它在不断成长和完善，它是开源的，有一个很大的社区，你也不会被云厂商锁定。<br/>但另一方面，它带来了高昂的维护成本，更好的是，如果你可以购买托管的Kafka服务，并将维护/扩展委托给外部服务，专注于你的逻辑和业务，那么你就可以享受两个世界的好处。</p></div></div>    
</body>
</html>