<html>
<head>
<title>Detect Primary Google Search Language: A Simple Python Solution</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">检测主要的Google搜索语言:一个简单的Python解决方案</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/detect-primary-google-search-language-a-simple-python-solution-dc37de2c5eab?source=collection_archive---------18-----------------------#2020-07-27">https://medium.com/analytics-vidhya/detect-primary-google-search-language-a-simple-python-solution-dc37de2c5eab?source=collection_archive---------18-----------------------#2020-07-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="914b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个用Python写的简单函数，用来检测不同国家的人用什么语言谷歌</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/b2658c5e109666ba2064a1986d5245c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vE4ulA4b6sXY0Httda0_gw.png"/></div></div></figure><p id="bdc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将定义一个函数来找出不同国家的Google搜索中主要使用的语言。该函数的结果可用于了解人们在互联网上的行为或增加谷歌趋势分析的相关性。</p><p id="97d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总体而言，该功能使用谷歌趋势中的<a class="ae jp" href="https://trends.google.com/trends/yis/2019/US/" rel="noopener ugc nofollow" target="_blank">热门关键词，确定关键词是否为<em class="jq">实体名称</em>，检测关键词的语言，并识别热门关键词中最常用的语言。为此，我使用了几个不同的Python包:</a></p><ul class=""><li id="bb9e" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated"><a class="ae jp" href="https://pypi.org/project/pytrends/" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">【py trends】</strong></a>:加载某个国家特定年份的谷歌搜索排名</li><li id="6a3c" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><a class="ae jp" href="https://py-googletrans.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> googletrans </strong> </a>:检测那些搜索的语言</li><li id="18bb" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><a class="ae jp" href="https://spacy.io/usage/linguistic-features" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">空间</strong> </a>:用于名称实体识别</li></ul><p id="0104" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有这些软件包都可以通过pip安装。</p><h2 id="6b2a" class="kf kg hi bd kh ki kj kk kl km kn ko kp iq kq kr ks iu kt ku kv iy kw kx ky kz bi translated">1.导入所有需要的包</h2><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="c137" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于包导入的几点注意事项:</p><ul class=""><li id="6cba" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated"><strong class="ih hj"> pytrends </strong>:在TrendReq()中，<em class="jq"> hl </em>只是表头语言，不会影响pytrends函数的结果；<em class="jq"> tz = 0 </em>表示时区为UTC<em class="jq">重试次数</em>表示尝试运行的次数；<em class="jq">补偿因子</em>是从urllib3继承的参数。为了谨慎地避免Google强加的任何速率限制，这里我将<em class="jq"> backoff_factor </em>设置为5，稍后在任何涉及pytrends的循环中，我将设置睡眠时间:<em class="jq"> time.sleep(6) </em></li></ul><blockquote class="lc ld le"><p id="611e" class="if ig jq ih b ii ij ik il im in io ip lf ir is it lg iv iw ix lh iz ja jb jc hb bi translated">第二次尝试后在两次尝试之间应用的补偿因子(大多数错误会通过第二次尝试立即解决，不会有延迟)。urllib3将休眠:</p><p id="fb6c" class="if ig jq ih b ii ij ik il im in io ip lf ir is it lg iv iw ix lh iz ja jb jc hb bi translated">{退避因子} *(2 * *({总重试次数} — 1))</p><p id="a5cb" class="if ig jq ih b ii ij ik il im in io ip lf ir is it lg iv iw ix lh iz ja jb jc hb bi translated">秒。如果退避因子是0.1，那么<code class="du li lj lk ll b"><strong class="ih hj"><em class="hi">sleep()</em></strong></code>将在重试之间休眠[0.0s，0.2s，0.4s，…]</p></blockquote><ul class=""><li id="1232" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">在这次实践中，这个包对我来说足够好了。可以查看Google的<a class="ae jp" href="https://cloud.google.com/translate/docs" rel="noopener ugc nofollow" target="_blank">官方翻译API </a>找一个稳定的API选项。</li><li id="9248" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><strong class="ih hj"> SpaCy: </strong>加载en_core_web_sm的脚本专门用于Jupyter笔记本，如果使用其他ide，请使用SpaCy官方文档指示的语法:<em class="jq">NLP = SpaCy . load(" en _ core _ web _ sm ")</em></li></ul><h2 id="dc77" class="kf kg hi bd kh ki kj kk kl km kn ko kp iq kq kr ks iu kt ku kv iy kw kx ky kz bi translated">2.定义函数</h2><p id="933d" class="pw-post-body-paragraph if ig hi ih b ii lm ik il im ln io ip iq lo is it iu lp iw ix iy lq ja jb jc hb bi translated">下面是我的函数的流程:</p><ul class=""><li id="9376" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">使用<em class="jq"> pytrends.top_charts()，</em>加载去年某个国家的热门谷歌搜索查询，返回一个熊猫数据帧。</li><li id="537b" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">使用googletrans获取这些搜索的检测语言。</li><li id="db45" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">在搜索查询中标出实体名称。</li><li id="b6c4" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">排除英文实体名称的搜索，假设在Google上搜索的选项是英文或其他语言。</li></ul><p id="2922" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该函数将<a class="ae jp" href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2" rel="noopener ugc nofollow" target="_blank"> country_code </a>作为唯一的输入，返回一个元组，其中第一项是该国家的主要Google搜索<a class="ae jp" href="https://en.wikipedia.org/wiki/ISO_639-1" rel="noopener ugc nofollow" target="_blank">语言代码</a>，第二项是一个pandas数据帧，包括热门搜索及其实体名称标签以及它们检测到的语言。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="2fcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是法国的函数结果示例</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lr"><img src="../Images/8e54af7adbd46a786ebcbc98f24c55d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mw0EI-Bo4V-zEqQCr8sKFw.png"/></div></div></figure><h2 id="6cd8" class="kf kg hi bd kh ki kj kk kl km kn ko kp iq kq kr ks iu kt ku kv iy kw kx ky kz bi translated">3.测试不同国家的功能</h2><p id="0c5f" class="pw-post-body-paragraph if ig hi ih b ii lm ik il im ln io ip iq lo is it iu lp iw ix iy lq ja jb jc hb bi translated">该函数的执行带来了两个问题:</p><ul class=""><li id="81cc" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">如何找到对应于国家名称的国家代码并传递给输入</li><li id="dfd8" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">如何知道语言代码输出的语言名称</li></ul><p id="0d53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用Python解决有几个选项，一个是<a class="ae jp" href="https://pypi.org/project/pycountry/" rel="noopener ugc nofollow" target="_blank">py country</a>；但是，目前pycountry不支持国家名称和语言之间的映射。在这种情况下，我使用了一个免费的REST API<a class="ae jp" href="https://restcountries.eu/" rel="noopener ugc nofollow" target="_blank">https://restcountries.eu/</a>，该API提供了关于一个国家的信息，如本国名称、全名、国家代码、货币、语言、首都、地区等。</p><p id="8553" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">按全名搜索时，API的结果如下所示。请注意，对于一些国家，如美国或英国，您必须使用他们的官方名称进行搜索。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/7869f72208328018471e65002c7d49c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3F4_PhrtyyMlyT1GCs6FWw.png"/></div></div></figure><p id="8eb7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将这14个国家作为我的谷歌趋势分析系列的目标:</p><p id="ea7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">['美国'，'加拿大'，'英国'，'法国'，'德国'，'意大利'，'澳大利亚'，'印度'，'菲律宾'，'新加坡'，'泰国'，'印度尼西亚'，'马来西亚'，'越南']</p><p id="d87f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">获取每个国家信息的脚本如下:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="3282" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我得到了这些国家的主要谷歌搜索语言如下。结果显示，我名单上的欧盟国家包括法国、德国、意大利主要使用他们的国家语言。在我选择的6个东南亚国家中，泰国、印度尼西亚和越南用当地语言搜索，而新加坡、菲律宾和马来西亚更喜欢英语。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lt"><img src="../Images/3bea0913e2341b2d47f84a3ce5ff0383.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QKtMqbKZ22drrCv7gqJweQ.png"/></div></div></figure><h2 id="2e89" class="kf kg hi bd kh ki kj kk kl km kn ko kp iq kq kr ks iu kt ku kv iy kw kx ky kz bi translated">4.我是如何想出这个函数的，我要用它做什么</h2><p id="5040" class="pw-post-body-paragraph if ig hi ih b ii lm ik il im ln io ip iq lo is it iu lp iw ix iy lq ja jb jc hb bi translated">作为一名Python新手和数据分析从业者，我想从事一些项目，在这些项目中，我可以练习我的Python技能，从周围的数据集中提取一些有趣的事实。对于我的第一个项目，以谷歌趋势为数据源，我计划处理来自不同国家的数据。</p><p id="7573" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我首先将英语作为所有国家的通用语言，但在一些国家，输入英语关键字并不能产生足够的数据输出。因此，我必须确定在每个国家我应该传递给谷歌趋势提取功能的语言。</p><p id="8353" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">函数背后的想法是基于这样的逻辑:我应该选择的语言应该是Google Trends top keywords中遇到的最常见的语言。</p><p id="3668" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该函数的第一个版本只是检测所有关键字的语言，而没有过滤掉<em class="jq">实体名称。</em>用法国测试时，因为top关键字包含几个英文实体名，所以函数返回英文作为主要语言。对结果感到困惑，我检查了法国的热门关键词，发现很多热门搜索都是人名、组织名、事件名等。因此，我意识到我需要从函数输入中排除实体名称，以获得更准确的结果。</p><p id="656c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在没有任何NLP经验的情况下，通过在谷歌搜索中键入一个简单的问题，比如“从文本中排除人名”,我开始了解SpaCy和嵌入式<em class="jq">命名实体识别</em>包。我从未听说过使用黑盒NLP包的想法，起初听起来让我害怕，但后来我意识到，在他人的工作基础上进行编程是一种常见的做法。</p><p id="4331" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，在熟悉了我在本文中提到的新包几天之后，我更有动力继续我的Python之旅。</p></div></div>    
</body>
</html>