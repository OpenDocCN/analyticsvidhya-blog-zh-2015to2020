<html>
<head>
<title>Part 1: Build your first Telegram bot with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第1部分:用Python构建您的第一个电报机器人</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/part-1-build-your-first-telegram-bot-with-python-eccefbdc48a9?source=collection_archive---------5-----------------------#2020-01-11">https://medium.com/analytics-vidhya/part-1-build-your-first-telegram-bot-with-python-eccefbdc48a9?source=collection_archive---------5-----------------------#2020-01-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="41fb" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">TL；DR，使用Python3和<a class="ae jh" href="https://github.com/eternnoir/pyTelegramBotAPI" rel="noopener ugc nofollow" target="_blank"> pyTelegramBotAPI </a>构建一个<a class="ae jh" href="https://telegram.org/" rel="noopener ugc nofollow" target="_blank">电报</a>机器人，获取并为用户提供随机<a class="ae jh" href="https://en.wikipedia.org/wiki/Main_Page" rel="noopener ugc nofollow" target="_blank">维基百科</a>文章。</p></blockquote><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es ji"><img src="../Images/b9372046416b319b78a16a7391ca2305.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FIv-V63TtCGxB--xibgUng.jpeg"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">使用Python的维基百科电报机器人</figcaption></figure><p id="8916" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">让我们构建一个电报机器人，它随机挑选并向用户发送维基百科文章的摘要，如果用户想要阅读整篇文章，机器人会发送文章的URL。</p><h2 id="30a2" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jy km kn ko jz kp kq kr ka ks kt ku kv bi translated">获取随机维基百科文章:</h2><p id="fd07" class="pw-post-body-paragraph ii ij hi il b im kw io ip iq kx is it jy ky iw ix jz kz ja jb ka la je jf jg hb bi translated">正如维基百科<a class="ae jh" href="https://en.wikipedia.org/wiki/Wikipedia:Random" rel="noopener ugc nofollow" target="_blank">项目页面</a>上提到的，网址<a class="ae jh" href="https://en.wikipedia.org/wiki/Special:Random" rel="noopener ugc nofollow" target="_blank"><em class="ik">https://en.wikipedia.org/wiki/Special:Random</em></a><em class="ik"/>会重定向到一篇随机文章。现在，要获得与文章相关的摘要和其他元数据，可以使用两种方法。</p><ul class=""><li id="38ee" class="lb lc hi il b im in iq ir jy ld jz le ka lf jg lg lh li lj bi translated"><strong class="il hj">使用<code class="du lk ll lm ln b">requests</code>和<code class="du lk ll lm ln b"><a class="ae jh" href="https://pypi.org/project/beautifulsoup4/" rel="noopener ugc nofollow" target="_blank">beautifulsoup4</a></code>库抓取</strong>维基百科页面。</li><li id="3309" class="lb lc hi il b im lo iq lp jy lq jz lr ka ls jg lg lh li lj bi translated">使用<strong class="il hj">维基媒体的REST API</strong>-【https://en.wikipedia.org/api/rest_v1 T21】/</li></ul><p id="97e8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">让我们通过<a class="ae jh" href="https://en.wikipedia.org/api/rest_v1/#/Page%20content" rel="noopener ugc nofollow" target="_blank">页面内容</a>端点使用Wikimedia的REST API，因为对于当前用例来说，它是一个更高效、更优雅的解决方案。</p><pre class="jj jk jl jm fd lt ln lu lv aw lw bi"><span id="c056" class="kb kc hi ln b fi lx ly l lz ma">pip3 install requests</span></pre><figure class="jj jk jl jm fd jn"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">从维基百科获取一篇随机文章的摘要</figcaption></figure><h2 id="bb20" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jy km kn ko jz kp kq kr ka ks kt ku kv bi translated">在Telegram中创建您的Bot帐户:</h2><p id="da26" class="pw-post-body-paragraph ii ij hi il b im kw io ip iq kx is it jy ky iw ix jz kz ja jb ka la je jf jg hb bi translated">第一步:每一个电报机器人背后，都有一个创造者“机器人父亲”。机器人爸爸是统治他们所有人的机器人。用它来创建新的机器人账户和管理你现有的机器人。</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es md"><img src="../Images/6344441c47f4d63350e5c89b43df997e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PiIwcnF7Ok0BIVPOSSMVsQ.jpeg"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">在电报中搜索“僵尸父亲”。</figcaption></figure><p id="9631" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">第二步:开始使用机器人父亲</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es me"><img src="../Images/3dc872203ead08190c01a54e547c6b9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oW7ELrprUhnrlAgnwyzL4w.jpeg"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">按“开始”</figcaption></figure><p id="8e45" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">第三步:使用<code class="du lk ll lm ln b">/newbot</code>命令创建一个新的机器人。</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es mf"><img src="../Images/7f36a5f892a06d2636397de06aaaafbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2mSyVyM6cvY7Y1Gn7k_9PQ.jpeg"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">按“/newbot”或键入并输入“/newbot”</figcaption></figure><p id="d903" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">步骤4:输入机器人的显示名称和用户名。</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es mg"><img src="../Images/5ce73f8cfe7cafd7ba9cd2d4c28d07d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XHzIEd_aryXN1QVzYBPeYg.jpeg"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">上面生成的访问令牌将用于在后面的步骤中访问bot</figcaption></figure><p id="3346" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">步骤5:还可以为机器人设置描述。</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es mh"><img src="../Images/1092cacc5588962c8049846c515fd956.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bvhoCy7ehkS4ZrnW0vkqJg.jpeg"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">用户将在与机器人的对话开始时看到描述</figcaption></figure><p id="aafb" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">有一个命令/功能列表，BotFather提供来创建和管理你所有的机器人，可以在<a class="ae jh" href="https://core.telegram.org/bots#6-botfather" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="5e3b" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jy km kn ko jz kp kq kr ka ks kt ku kv bi translated">使用Python构建您的机器人:</h2><p id="ca1e" class="pw-post-body-paragraph ii ij hi il b im kw io ip iq kx is it jy ky iw ix jz kz ja jb ka la je jf jg hb bi translated">我们将在python3中使用<a class="ae jh" href="https://github.com/eternnoir/pyTelegramBotAPI" rel="noopener ugc nofollow" target="_blank"> pyTelegramBotAPI </a>和请求包。</p><pre class="jj jk jl jm fd lt ln lu lv aw lw bi"><span id="a340" class="kb kc hi ln b fi lx ly l lz ma">pip3 install pyTelegramBotAPI requests</span></pre><p id="53b9" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">使用pyTelegramBotAPI包构建一个简单的echo bot如<a class="ae jh" href="https://github.com/eternnoir/pyTelegramBotAPI/blob/master/examples/echo_bot.py" rel="noopener ugc nofollow" target="_blank">示例</a> GitHub repo中给出的包，使用在创建bot的第4步中生成的API访问令牌。</p><figure class="jj jk jl jm fd jn"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">echo_bot.py</figcaption></figure><pre class="jj jk jl jm fd lt ln lu lv aw lw bi"><span id="0eff" class="kb kc hi ln b fi lx ly l lz ma">python3 echo_bot.py</span></pre><p id="7668" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">上面的bot使用长轮询方法来检查消息，并用相同的消息回复它收到的每条消息。</p><p id="1fbf" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">我们可以使用<a class="ae jh" href="https://github.com/eternnoir/pyTelegramBotAPI#reply-markup" rel="noopener ugc nofollow" target="_blank">回复标记</a>来获取用户输入，以决定用户是想进一步阅读文章还是跳过它。</p><pre class="jj jk jl jm fd lt ln lu lv aw lw bi"><span id="23fa" class="kb kc hi ln b fi lx ly l lz ma">from telebot import TeleBot, types</span><span id="2917" class="kb kc hi ln b fi mi ly l lz ma">bot = TeleBot("&lt;api_token&gt;")<br/>markup = types.ReplyKeyboardMarkup(one_time_keyboard=True,row_width=1)</span><span id="4acb" class="kb kc hi ln b fi mi ly l lz ma">markup.add("Read-Wiki", "Skip")<br/>msg_content="test message"<br/>bot.send_message(chat_id, msg_content, reply_markup=markup)</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es mj"><img src="../Images/9351b48d67683a63d48664181bc21804.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a2cybUjxeg68USzZSY48ng.jpeg"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">这是回复标记向用户显示的方式</figcaption></figure><p id="aef9" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">telegram bot的完整python3脚本在收到用户的<code class="du lk ll lm ln b">/random</code>命令时，获取并发送随机的维基百科文章摘要，并连同两个键盘按钮一起发送给用户，询问用户他/她是想阅读整篇文章还是跳过它，根据用户的回复，它发送维基百科URL或不回复任何内容。</p><figure class="jj jk jl jm fd jn"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">random_wiki_telegram_bot.py</figcaption></figure><pre class="jj jk jl jm fd lt ln lu lv aw lw bi"><span id="31b6" class="kb kc hi ln b fi lx ly l lz ma">python3 random_wiki_telegram_bot.py</span></pre><p id="9fbb" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">随机wiki-bot使用与echo bot示例相同的长轮询方法。上面创建的随机维基百科bot可以在这里访问<a class="ae jh" href="https://t.me/random_wiki_article_bot" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="c2f9" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">有趣的事情并没有到此结束，让我们看看如何使用WebSocket方法在Heroku上部署上面的bot，参见第2部分:在Heroku上部署Telegram bot。(正在建设中)</p><p id="fe3a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">您也可以通过添加更多的消息处理程序来处理我们的命令列表中没有的消息，或者向机器人添加更多的命令和功能来玩机器人。</p></div></div>    
</body>
</html>