<html>
<head>
<title>Spark your Analytics, with Apache Spark ğŸŒŸ</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å€ŸåŠ©Apache Sparkæ¿€å‘æ‚¨çš„åˆ†æèƒ½åŠ›ğŸŒŸ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/analytics-vidhya/spark-your-analytics-with-apache-spark-f4a47936b2f0?source=collection_archive---------8-----------------------#2019-10-06">https://medium.com/analytics-vidhya/spark-your-analytics-with-apache-spark-f4a47936b2f0?source=collection_archive---------8-----------------------#2019-10-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f1d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨æ·±å…¥åˆ°ä¸€ä¸ªç®€å•çš„ç”¨ä¾‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹Apache Sparkçš„å®šä¹‰ã€‚<br/> <strong class="ih hj"> Apache Spark: </strong> Sparkæ˜¯ä¸€ä¸ªå†…å­˜ä¼˜åŒ–çš„æ•°æ®å¤„ç†å¼•æ“ï¼Œå¯ä»¥å¯¹Hadoopæ•°æ®(åœ¨HDFS)æ‰§è¡Œæ“ä½œï¼Œæ€§èƒ½ä¼˜äºMapReduceã€‚</p><p id="ffcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™æ„å‘³ç€ï¼ŒApache Sparkæä¾›äº†ä»¥åˆ†å¸ƒå¼æ–¹å¼è¿è¡Œå•ä¸ªä½œä¸šçš„èƒ½åŠ›ï¼Œå…¶ä¸­ï¼ŒèŒƒå›´ä»ä¸¤ä¸ªèŠ‚ç‚¹åˆ°1000ä¸ªèŠ‚ç‚¹çš„èŠ‚ç‚¹ç¾¤é›†(ä¸ºç®€å•èµ·è§ï¼Œæ˜¯ä¸€ç»„è®¡ç®—æœº)è¢«ç»„è£…èµ·æ¥åœ¨å†…å­˜ä¸­æ‰§è¡Œä¸€é¡¹ä½œä¸šï¼Œå¹¶ä¸”å…·æœ‰è¶³å¤Ÿçš„å®¹é”™èƒ½åŠ›æ¥è·Ÿè¸ªä»»ä½•ä¸¢å¤±çš„èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶ä»»åŠ¡(èŒè´£)åˆ†é…ç»™ç¾¤é›†ä¸­ä»»ä½•å…¶ä»–å¯ç”¨çš„èŠ‚ç‚¹ï¼Œæœ€ç»ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½å‘é©±åŠ¨ç¨‹åºèŠ‚ç‚¹(é¢†å¯¼èŠ‚ç‚¹)æŠ¥å‘Šä½œä¸šçš„ç»“æœã€‚</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/c37dbd8685e99527ff8eb3817a1b2885.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jh1R3TIfvxDhXmKcwXK09Q.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">å›¾ç‰‡æ¥æº:<a class="ae jt" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank">https://unsplash.com</a></figcaption></figure><p id="769c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸€ä¸ªç®€å•çš„ç”¨ä¾‹æ˜¯å‡è®¾ç”¨æˆ·æƒ³è¦æ‰¾åˆ°ä»–çš„å•†åº—ä¸­é”€é‡æœ€å¤§çš„æ‚è´§é¡¹ç›®ï¼Œè¯¥å•†åº—åœ¨2010å¹´è‡³2011å¹´æœŸé—´æ‹¥æœ‰å¤§çº¦10ï¼Œ000åå®¢æˆ·ï¼Œç”¨æˆ·åªéœ€è¿è¡Œä¸€ä¸ªæä¾›è¯¥é¡¹ç›®çš„è¯¦ç»†ä¿¡æ¯çš„SQLæŸ¥è¯¢ã€‚<br/>ç°åœ¨ï¼ŒåŒä¸€ç”¨æˆ·å¸Œæœ›ç¡®å®š2000å¹´è‡³2019å¹´æœŸé—´æ¯ä½é¡¾å®¢è´­ä¹°æœ€å¤šçš„æ‚è´§ï¼Œå‡è®¾é”€å”®é¢å¾ˆé«˜ï¼Œå¹¶ä¸”åœ¨æŸä¸€å¤©è‡³å°‘æœ‰3000ç¬”é”€å”®é¢ã€‚è¿™ä¸ºæˆ‘ä»¬æä¾›äº†æ¯ä¸ªå®¢æˆ·çš„é”€å”®è®°å½•è®¡æ•°(2000â€“2019)æ€»è®¡_å¤©æ•°*æ€»è®¡_é”€å”®æ•°é‡= 9ã€***ã€***ã€***..æˆ–è€…å¯èƒ½æ›´å¤šã€‚åœ¨è¿™ä¸ªç”¨ä¾‹ä¸Šè¿è¡Œä¼ ç»Ÿçš„SQLæŸ¥è¯¢ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚<br/> Apache Sparkå¼€å§‹è¡ŒåŠ¨ï¼Œæ‹¯æ•‘æˆ‘ä»¬çš„åˆ›é€ åŠ›ã€‚</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="f2db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">ç¤ºä¾‹ç”¨ä¾‹:</strong> <br/>è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªç®€å•çš„CSV(é€—å·åˆ†éš”å€¼)æ–‡ä»¶ï¼Œå®ƒåŒ…å«4åˆ—ï¼Œå¤§çº¦æœ‰9997851æ¡è®°å½•ã€‚<br/> userIdï¼Œmovieï¼Œratingï¼Œtimestamp <br/> 18295ï¼Œ909090ï¼Œ2.5ï¼Œ1515203646000 <br/>åœ¨ä¸Šè¿°æ•°æ®çš„å¸®åŠ©ä¸‹ï¼Œå¯ä»¥å¯¼å‡ºnä¸ªåˆ—ï¼Œè¿™æœ‰åŠ©äºå¼€å‘è€…å’Œ/æˆ–æ•°æ®åˆ†æå¸ˆåŸºäºç”¨æˆ·è¡Œä¸ºåšå‡ºå»ºè®¾æ€§çš„å†³ç­–ã€‚<br/>å¯¹äºè¿™ä¸ªåœºæ™¯ï¼Œæˆ‘åœ¨è£…æœ‰<strong class="ih hj"> IntelliJ IDE </strong>å¹¶å®‰è£…äº†<strong class="ih hj">Sparkçš„æœ¬åœ°æœºå™¨(ç¬”è®°æœ¬ç”µè„‘)ä¸Šè¿è¡ŒSpark(æˆ‘å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­è®¨è®ºå¦‚ä½•è®¾ç½®IntelliJå’ŒSpark)</strong>ã€‚å¦‚æœæ‚¨æ„¿æ„çš„è¯ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ª100å€èŠ‚ç‚¹çš„é›†ç¾¤ä¸Šä½¿ç”¨spark session-cluster_levelè®¾ç½®è¿è¡Œã€‚</p><p id="ede2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">è®¡åˆ’å¯¹æ•°æ®æ‰§è¡Œä»»ä½•ç±»å‹çš„åˆ†ææ—¶è¦é—®çš„é—®é¢˜ï¼Ÿ<br/> -æ•°æ®è´¨é‡å¦‚ä½•ï¼Ÿ<br/> -æ•°æ®ä¸­æœ‰å¤šå°‘ç©ºå€¼æˆ–ç©ºå­—ç¬¦ä¸²ï¼Ÿ<br/> -è¿™äº›æ•°æ®æ˜¯å¦åŒ…å«è¶³å¤Ÿçš„ç”¨æˆ·æ ‡è¯†æˆ–äº§å“æ ‡è¯†ï¼Œä»¥ä¾¿åšå‡ºå†³ç­–ï¼Ÿ<br/> -æ˜¯å¦éœ€è¦æ ¼å¼æ ‡å‡†åŒ–ï¼Ÿæ¯”å¦‚æ—¥æœŸæ ¼å¼ã€User_idæ ¼å¼æˆ–æ›¿æ¢ç©ºå€¼ç­‰â€¦â€¦<br/>-æˆ‘å¯ä»¥åŸºäºä»»ä½•åˆ—å€¼(æ¯”å¦‚æ—¥æœŸ****-**-01ã€æ—¥æœŸ****-**-02)å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºä»¥æé«˜æ€§èƒ½å—ï¼Ÿ</strong></p><p id="a788" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨è¿™ä¸ªæ•…äº‹ä¸­ï¼Œè®©æˆ‘ä»¬åŸºäºå•ä¸ªUser_Idå¯¼å‡ºä¸‹é¢çš„åˆ—ã€‚</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="1abb" class="kg kh hi kc b fi ki kj l kk kl">user_id â€” The User ID.<br/>mov_watch_count â€” No. of Movies watched by that User. <br/>latest_movie_rated â€” The Movie_id which User recently rated.<br/>first_movie_rated â€” The Movie_id which User First rated.<br/>more_than_six_rtngs â€” Does the user rated more than 6 movies? Y/N<br/>less_than_two_rtngs â€” Does the user rated less than 2 movies? Y/N<br/>highest_rating â€” The Highest rating given by the User ever.<br/>lowest_rating â€” The Lowest rating given by the User ever.</span></pre><p id="d911" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è®©æˆ‘ä»¬å¿«é€Ÿæµè§ˆä¸€ä¸‹å¦‚ä½•å®ç°è¿™ä¸€ç‚¹çš„ä»£ç ç‰‡æ®µï¼Œä¸‹é¢å°†åŒ…å«é‡è¦çš„ã€‚</p><p id="045b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åˆ›å»ºä¸€ä¸ªsparkä¼šè¯ï¼Œå®ƒæ˜¯Sparkåº“ä¸–ç•Œçš„å…¥å£ã€‚</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="6401" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">//Create your sparkSession to Light it up.</strong><br/>val spark = SparkSession<br/>  .<em class="km">builder</em>()<br/>  .appName("userIdAndRatings")<br/>  .master("local[*]")<br/>  .config("spark.sql.warehouse.dir", "file:///C:/temp")<br/>  .getOrCreate()<br/><strong class="kc hj">//Read the CSV File(There are multiple ways to do this.)</strong><br/>val rawRecords = spark.read.format("csv")<br/>  .option("header", "true")<br/>  .option("delimiter", ",")<br/>  .option("inferSchema", "true")<br/>  .load("C:/sparktempfiles/training.csv")<br/>rawRecords.printSchema()<br/>rawRecords.createOrReplaceTempView("raw_records_view")<br/><strong class="kc hj">//Fix the Time Column from Epoch time to Human readable Date</strong><br/>val rawRecordsTimeFix =<br/>  """<br/>    |select userId, movieId, rating, date_format(from_unixtime(timestamp/1000), 'yyyy-MM-dd') as dateOfRating<br/>    |from raw_records_view<br/>  """.stripMargin</span></pre><p id="9378" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æƒ³å‡ºæœ€ç»ˆè¡¨æ ¼æˆ–æ•°æ®å¸§æˆ–CSVå¤´æ–‡ä»¶çš„å¸ƒå±€ã€‚</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="3389" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">//Create LayOut for your Output Table<br/></strong>val <em class="km">userRatingsLayout </em>= <em class="km">StructType</em>(<br/>  StructField("user_id", IntegerType, true) ::<br/>    StructField("mov_watch_count", IntegerType, true) ::<br/>    StructField("latest_movie_rated", IntegerType, true) ::<br/>    StructField("first_movie_rated", IntegerType, true) ::<br/>    StructField("more_than_six_rtngs", StringType, true) ::<br/>    StructField("less_than_two_rtngs", StringType, true) ::<br/>    StructField("highest_rating", DoubleType, true) ::<br/>    StructField("lowest_rating", DoubleType, true) ::<br/>    <em class="km">Nil</em>)</span></pre><p id="0220" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åˆ›å»ºä¸€ä¸ªåŸå§‹è®°å½•å¯¹è±¡ï¼Œç„¶åå¯¹user_idè¿›è¡Œåˆ†ç»„ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªåˆ—è¡¨ï¼Œä¸ºæ¯ä¸ªç”¨æˆ·æ´¾ç”Ÿæ–°åˆ—ã€‚</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="2f87" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">//Construct DataFrame which can shown on Console, can be saved as CSV file or as a Table.</strong><br/>val rawRecordsConstruct = spark.sql(rawRecordsTimeFix).map(RawRatings.<em class="km">parse</em>(_)).groupByKey(_.user_id).mapGroups {<br/>  case (user_id, ratings_iter) =&gt; {<br/>    val ratings_List = ratings_iter.toList<br/>val ratings_attr_vals = <em class="km">getRatingsAttributes</em>(ratings_List)</span><span id="8dfd" class="kg kh hi kc b fi kn kj l kk kl">    <em class="km">Row</em>(user_id, ratings_attr_vals.mov_watch_count, ratings_attr_vals.latest_movie_rated, ratings_attr_vals.first_movie_rated, ratings_attr_vals.more_than_six_rtngs, ratings_attr_vals.less_than_two_rtngs, ratings_attr_vals.highest_rating, ratings_attr_vals.lowest_rating)<br/>  }<br/>}(<em class="km">userRatingsColumnsEncoder</em>)</span></pre><p id="0d05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åˆ›å»ºä¸€ä¸ªä¸ºæˆ‘ä»¬çš„è¡¨å¸ƒå±€è®¡ç®—åˆ—å€¼çš„æ–¹æ³•ã€‚</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="7800" class="kg kh hi kc b fi ki kj l kk kl">def getRatingsAttributes(rawList: List[RawRecords]): ratingsRec = {<br/><strong class="kc hj">  //Create variables which has to be returned.</strong></span><span id="a3d9" class="kg kh hi kc b fi kn kj l kk kl">  var user_id = 999999<br/>  var mov_watch_count = 999999<br/>  var latest_movie_rated = 999999<br/>  var first_movie_rated = 999999<br/>  var more_than_six_rtngs = "NA"<br/>  var less_than_two_rtngs = "NA"<br/>  var highest_rating: Double = 999999.0<br/>  var lowest_rating: Double = 999999.0<br/></span><span id="56fd" class="kg kh hi kc b fi kn kj l kk kl">user_id = rawList.map(x =&gt; x.user_id).head.toInt<br/>  mov_watch_count = rawList.map(x =&gt; x.movie_id).size<br/>  latest_movie_rated = rawList.sortWith(_.date_of_rating &gt; _.date_of_rating).map(x =&gt; x.movie_id).head<br/>  first_movie_rated = rawList.sortWith(_.date_of_rating &lt; _.date_of_rating).map(x =&gt; x.movie_id).head<br/>  more_than_six_rtngs = if (rawList.map(x =&gt; x.rating).size &gt; 6) "Y" else "NA"<br/>  less_than_two_rtngs = if (rawList.map(x =&gt; x.rating).size &lt; 2) "Y" else "NA"<br/>  highest_rating = rawList.map(x =&gt; x.rating).sortWith(_ &gt; _).head<br/>  lowest_rating = rawList.map(x =&gt; x.rating).sortWith(_ &lt; _).head</span><span id="26ad" class="kg kh hi kc b fi kn kj l kk kl">  <em class="km">ratingsRec</em>(user_id, mov_watch_count, latest_movie_rated, first_movie_rated, more_than_six_rtngs, less_than_two_rtngs, highest_rating, lowest_rating)<br/>}</span><span id="357f" class="kg kh hi kc b fi kn kj l kk kl"><strong class="kc hj"><em class="km">//Show the Results on IntelliJ Run Window.<br/></em></strong><em class="km">println</em>("Showing the Results now")<br/>rawRecordsConstruct.show(false)</span></pre><p id="5408" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ˜¯æ—¶å€™ç‚¹å‡»IntelliJä¸Šç»¿è‰²æŒ‰é’®(æˆ–)è¿è¡Œç¨‹åºæ¥æŸ¥çœ‹è¾“å‡ºç»“æœäº†ã€‚Sparkå¼€å§‹å·¥ä½œï¼Œä¸åˆ°ä¸€åˆ†é’Ÿå°±è¿”å›ç»“æœã€‚</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="e594" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">æ³¨æ„</strong>:ä¸Šé¢çš„User_idå’Œmovie_idéƒ½æ˜¯é‡æ„çš„ã€‚</p><p id="8518" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¥½äº†ï¼Œä½ è®¤ä¸ºæˆ‘ä»¬è¿˜å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å“ªäº›åˆ—ï¼Œæ¯”å¦‚ç»™å®šç”¨æˆ·çš„<strong class="ih hj">ä¸€å¹´å†…æ²¡æœ‰ç”µå½±è¢«è§‚çœ‹ï¼Œä¸€ä¸ªæœˆå†…æ²¡æœ‰ç”µå½±è¢«è§‚çœ‹ï¼Œ</strong>ç­‰ç­‰..<br/>å¦‚æœæˆ‘ä»¬å¯ä»¥ç”¨<strong class="ih hj">â€˜movie_idâ€™s and Movie _ Nameâ€™</strong>åŠ å…¥Movie _ Idçš„backï¼Œå¹¶æ ¹æ®ç”¨æˆ·è¯„çº§æ‰¾åˆ°æœ€å—æ¬¢è¿çš„ç”µå½±æˆ–å‘ç”¨æˆ·æ¨èç”µå½±ï¼Œæˆ‘ä»¬å°†å¾ˆå¿«çœ‹åˆ°è¿™äº›ç»“æœã€‚</p><p id="87e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ¬¢è¿ä»»ä½•å»ºè®®ã€‚<br/>æ‰¾åˆ°æˆ‘çš„GitHubå­˜å‚¨åº“é¡µé¢ï¼Œå…¶ä¸­åŒ…å«äº†æœ¬æ–‡ä½¿ç”¨çš„å…¨éƒ¨ä»£ç :<a class="ae jt" href="https://github.com/pavanobj/spark_series" rel="noopener ugc nofollow" target="_blank">https://github.com/pavanobj/spark_series</a><br/>ç½‘ä¸Šæœ‰å¾ˆå¤šå…è´¹çš„æ•°æ®é›†ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡Œå„ç§åˆ†æã€‚</p><p id="f1b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ„Ÿè°¢æ‚¨èŠ±æ—¶é—´é˜…è¯»æœ¬æ–‡ï¼Œä¸‹æ¬¡å†è§ğŸ˜ƒ</p></div></div>    
</body>
</html>