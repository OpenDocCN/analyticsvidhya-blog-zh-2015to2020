<html>
<head>
<title>Implementing Kernel/Filter/Convolutional in you own</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在您自己的系统中实现内核/过滤器/卷积</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/implementing-kernel-filter-convolutional-in-your-own-a6146d87d791?source=collection_archive---------10-----------------------#2020-03-09">https://medium.com/analytics-vidhya/implementing-kernel-filter-convolutional-in-your-own-a6146d87d791?source=collection_archive---------10-----------------------#2020-03-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b56e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天我讨论如何在不使用预定义函数的情况下自己实现内核/过滤器。在进入主题之前，我先讨论一下卷积，以便更好地理解。</p><p id="a7f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在数学中，卷积是两个事物产生第三个事物的运算。简而言之，把两种东西混合在一起得到一种新的东西。例如，在牛奶中加入咖啡粉可以得到咖啡。这里有两样东西是牛奶和咖啡粉。第三件事是咖啡。</p><p id="355f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">来到我们的主题图像，这两件事是原始图像和过滤器。第三件事是修改图像。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/3b8fd333838446defb36b7d8b76a9414.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*co1XXuVjtf85c_n_Srf6uQ.png"/></div></figure><p id="3bea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的图片中，第一张图片是原始图像，第二张图片是过滤器，第三张图片是修改后的图像。作为人类，我们可以看到图像。但是计算机理解为一种价值。我只讨论灰度格式和RGB格式。灰度格式的范围是0–255。0表示全黑，255表示全白。中间值是黑色和白色的阴影。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jl"><img src="../Images/f349036a90caa78bfeabd1b5d890552b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*flbGhRhHsNYTfoz9WL7H6w.jpeg"/></div></div></figure><p id="5bec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上面的图片你可以直观的了解它是什么。如果计算机在那个像素上看到0值，它就在屏幕上呈现黑色。它为各个值呈现各个值。我们可以把整个世界缩小到这256个色度。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jq"><img src="../Images/ec383ad5549501daa32814e6129ae359.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/format:webp/1*urL9sxIuYO_6smnJcfXXsA.jpeg"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">灰度图像的例子</figcaption></figure><p id="8bd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到惊人的画面。但是如果我们放大观察每一个像素，就会有256种颜色中的一种</p><p id="88c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一个是rgb格式。它也与0–255的范围相同。但是三次，一次是红色通道，一次是蓝色通道，一次是绿色通道。所以通过使用这些组合，我们得到16777216种颜色</p><p id="8a12" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(0，0，0)-黑色</p><p id="aebd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">(0,0,1)</p><p id="785e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">…………</p><p id="3cee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(0，0，255)-蓝色</p><p id="3e01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(0，255，0)-绿色</p><p id="c8f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(255，0，0)-红色</p><p id="d2eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">…….</p><p id="7231" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">(255,255,254)</p><p id="462a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(255，255，255)-白色。</p><p id="1c9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">够了，我们进入主题。你知道什么是原始图像和修改后的图像。过滤器是我们在日常生活中使用的，如模糊，边缘检测，锐化等。现实生活中有很多过滤器。</p><p id="6de1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在opencv中，有许多预定义的函数来完成这种类型的操作。(例如:cv2.gaussianblur用于模糊)。但是我想知道内部发生的工作流程，并为此编写代码。让我们进入代码</p><p id="a929" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先导入所需的包。我只承诺不会对卷积运算使用预定义的运算。但是对于像图像打开，图像保存，转换数组到图像包的过程是必需的(如果你知道如何做，请分享)</p><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="6098" class="ka kb hi jw b fi kc kd l ke kf"><em class="kg">import cv2<br/>import numpy as np<br/>from PIL import Image</em></span></pre><p id="b016" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是加载图像。在以下代码中，0表示以灰度读取图像</p><blockquote class="kh ki kj"><p id="72ed" class="if ig kg ih b ii ij ik il im in io ip kk ir is it kl iv iw ix km iz ja jb jc hb bi translated"><code class="du kn ko kp jw b">img=cv2.imread(‘E:\sit.jpg’,0)</code></p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es kq"><img src="../Images/7c63b68b64377623aceaa9e4165b266e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pY-lm1HuGcwHZxbQ0BL0Og.jpeg"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">sit.jpg</figcaption></figure><p id="f92b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是图像。尺寸是1050*700。接下来我们来看看计算机是如何看待图像的</p><blockquote class="kh ki kj"><p id="6ede" class="if ig kg ih b ii ij ik il im in io ip kk ir is it kl iv iw ix km iz ja jb jc hb bi translated"><code class="du kn ko kp jw b">print(img)</code></p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kr"><img src="../Images/fc04891cf9104d86bee96364d6ea8a32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*WmYR-H4GFJnHiuqY-7OamA.png"/></div></figure><p id="35c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是图像在电脑上的样子。(也就是说，完整的图像没有作为值打印出来，所以它放在…)</p><p id="c799" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是初始化过滤器。过滤器只是一个值(矩阵)。在下图中，我选择了锐化矩阵作为例子。请访问下面的链接了解更多关于过滤器的信息</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ks"><img src="../Images/13b8bccc2c80a27be00a8c23839d3d5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UEFhqfl220lOiszd5LjRwg.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated"><strong class="bd kt">向维基百科致谢</strong></figcaption></figure><p id="2400" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ku" href="https://en.wikipedia.org/wiki/Kernel_(image_processing)" rel="noopener ugc nofollow" target="_blank">https://en . Wikipedia . org/wiki/Kernel _(图像处理)</a></p><blockquote class="kh ki kj"><p id="9c83" class="if ig kg ih b ii ij ik il im in io ip kk ir is it kl iv iw ix km iz ja jb jc hb bi translated"><code class="du kn ko kp jw b">x=np.array([[0,-1,0],[-1,5,-1],[0,-1,0]])</code></p></blockquote><p id="dedd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你明白为什么我把这个值？下一步是初始化所有变量。img.shape[0]表示图像的高度，img.shape[1]表示图像的宽度</p><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="2039" class="ka kb hi jw b fi kc kd l ke kf">y=img.shape[0]-2<br/>z=img.shape[1]-2</span><span id="81c4" class="ka kb hi jw b fi kv kd l ke kf">tempw=0<br/>temph=0</span><span id="ee7b" class="ka kb hi jw b fi kv kd l ke kf">h1=0<br/>w1=0<br/>go=0<br/>go1=0<br/>ko=0<br/>ko1=0<br/>sum=0</span><span id="c053" class="ka kb hi jw b fi kv kd l ke kf">b=input()</span><span id="b66b" class="ka kb hi jw b fi kv kd l ke kf">s=np.zeros((y,z))<br/>#s is an 2d array with z width &amp; y height with full of zero values.</span></pre><p id="83e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可能会想为什么我在两者上都加了-2。我解释这个。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es kw"><img src="../Images/1fb13b18b5b0a3d3358a7f66ccc72bd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zOX6RhFTkXy3mAvUHk6O4w.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es kw"><img src="../Images/3eab95fe157440b7f0b01845f27eec2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JxtM3bl9qEo4NJMWhqdIiA.png"/></div></div></figure><p id="a5a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以总共是宽度方向3和高度方向3。所以一共9个值。当我们执行5X5输入图像时，输出是3X3图像。如果我们执行7X7(输入)，那么5X5(输出)同样如此。</p><p id="88f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以你明白为什么我在宽度和高度上加-2值。输出图像的尺寸为(宽度-2)*(高度-2)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kx"><img src="../Images/71d8f3362e6d0b70ab1c02e9e2778180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*v4iaQTIXtN_6n_dBDP2HXQ.png"/></div></figure><p id="2e5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是卷积的代码。请省略注释行，因为它用于某些调试过程。它包含四个for循环</p><ol class=""><li id="b066" class="ky kz hi ih b ii ij im in iq la iu lb iy lc jc ld le lf lg bi translated">在图像的高度上跟踪</li><li id="2c31" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">在图像宽度上描摹</li><li id="14e6" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">在过滤器的高度上追踪</li><li id="95a9" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">在过滤器的宽度上追踪</li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lm"><img src="../Images/3430d8a4eccea8609b4638ffa3250863.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/1*6tXKORQ6ogCXMQj_0M4fGg.gif"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated"><strong class="bd kt">归功于TowardsDataScience </strong></figcaption></figure><p id="3098" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这正是逻辑正在做的事情。我为任何大小的输入图像实现这个。但是我用的是静态滤镜尺寸(3*3)。对于某些人来说，这些代码可能看起来很奇怪。对于这些，请记下来，并解决一些迭代，你可能会明白为什么我把这些值放在这一点上。因为我花10分钟写代码，20分钟做文书工作。我没有解释每一行并调试它，因为这很费时间。我再说一遍，当你在纸上解决它的时候，它是容易的。转换成数字数组后，我们要输出的是一个图像。为此</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ln"><img src="../Images/075093623fb9dad31eaeec4dd931e37d.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*MTYfnWNAn0aRzQlN1tO-Lw.png"/></div></figure><p id="9f40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么输出看起来像</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es lo"><img src="../Images/e081f0fd4810730465a675e1ecbd9200.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1cFuexak0Zc0Qrzs99tN_Q.jpeg"/></div></div></figure><p id="942e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是的，现在你可以自己应用过滤器了。现在我们的输出图像尺寸是(1048X698)。记住我们的输入大小(1050X700)。此图像需要33秒才能输出(效率不高)。感谢您阅读此给予回应，并询问任何有关代码或任何问题。</p><p id="38a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:请使用其他相同和不同大小的过滤器，并在这附近玩。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es kq"><img src="../Images/51cb977cb7a69503ee9d863f2bf22104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CwDfPnjtRJDwr1u55UTaag.jpeg"/></div></div></figure></div></div>    
</body>
</html>