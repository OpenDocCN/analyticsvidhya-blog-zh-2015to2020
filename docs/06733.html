<html>
<head>
<title>Image Data Labelling — large volume using Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">图像数据标记—使用机器学习的大量数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/image-data-labelling-large-volume-using-machine-learning-ae9146bb491d?source=collection_archive---------33-----------------------#2020-05-31">https://medium.com/analytics-vidhya/image-data-labelling-large-volume-using-machine-learning-ae9146bb491d?source=collection_archive---------33-----------------------#2020-05-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b3b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了使用自定义视觉或ML辅助数据标记来构建对象检测模型，我们需要调整较大图像的大小。下面是一个将图像大小调整到6MB的脚本。我的数据集从4MB到14MB不等。当我尝试ML辅助标记时，它通过检查内存出错。</p><p id="506f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图像大小调整甚至可以在本地计算机上完成，但这里的挑战是需要较长的时间，并消耗本地笔记本电脑或计算机的CPU。</p><p id="05a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了使解决方案不依赖于本地资源并根据需要增加规模，我选择在Azure machine learning services workspace中使用计算实例和笔记本运行这段代码。这种组合在云中为我提供了一个隔离的环境，图像可以存储在云中，也可以存储在blob存储中。这避免了网络延迟，并且所有的处理都在云中完成。现在，计算实例的大小取决于我们想要使用的数量，并且可以根据需要进行扩展。</p><p id="2c75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将文件移动到云blob存储可以通过任何数据移动工具来实现，如Azure data factory来移动数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/cd6fd23767003410594737ff2472585b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vCNEWHgC7JcEzYzG.jpg"/></div></div></figure><ul class=""><li id="6776" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">创建Blob存储帐户</li><li id="9644" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">创建一个容器</li><li id="b6ea" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">使用Azure数据工厂复制向导上传图片或我从另一个移动的图片</li><li id="d45e" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">创建Azure ML服务工作区</li><li id="093f" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">创建计算实例</li><li id="a891" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">创建新笔记本</li><li id="be08" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">选择Python版本3</li></ul><p id="ede8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，让我们为azure blob存储更新新的sdk</p><pre class="je jf jg jh fd kd ke kf kg aw kh bi"><span id="2d6e" class="ki kj hi ke b fi kk kl l km kn">pip install azure-storage-blob --upgrade</span></pre><p id="a426" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在进口必要的进口品</p><pre class="je jf jg jh fd kd ke kf kg aw kh bi"><span id="eab5" class="ki kj hi ke b fi kk kl l km kn">import os, uuid from azure.storage.blob <br/>import BlobServiceClient, BlobClient, ContainerClient</span></pre><p id="6bc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在连接并列出所有容器。替换您的存储帐户名称并键入连接字符串。</p><pre class="je jf jg jh fd kd ke kf kg aw kh bi"><span id="782e" class="ki kj hi ke b fi kk kl l km kn">import os, uuid from azure.storage.blob <br/>import BlobServiceClient, BlobClient, ContainerClient <br/>try: <br/>print("Azure Blob storage v12 - Python quickstart sample") <br/># Quick start code goes here AZURE_STORAGE_CONNECTION_STRING="DefaultEndpointsProtocol=https;AccountName=xxxx;AccountKey=xxxxxxxxxxxxxxxxxxxx;EndpointSuffix=core.windows.net" <br/># Create the BlobServiceClient object which will be used to create a container client <br/>blob_service_client = BlobServiceClient.from_connection_string(AZURE_STORAGE_CONNECTION_STRING) <br/># List containers <br/>print("\nListing containers...") <br/>containers_list = blob_service_client.list_containers() <br/>for c in containers_list: <br/>   print("\t" + c.name) <br/>except Exception as ex: <br/>   print('Exception:') print(ex)</span></pre><p id="0bb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你应该会看到一个文件列表</p><p id="b1f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">列出所有源图像文件，以确保blob中有图像</p><pre class="je jf jg jh fd kd ke kf kg aw kh bi"><span id="f0e9" class="ki kj hi ke b fi kk kl l km kn">print("\nListing blobs...") <br/># List the blobs in the container <br/>blob_list = blob_service_client.get_container_client("Containername").list_blobs() <br/>for blob in blob_list: <br/>   print("\t" + blob.name)</span></pre><p id="668a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导入图像操作以及源和目标容器设置，以调整到不同的图像大小，请更改变量newSize</p><pre class="je jf jg jh fd kd ke kf kg aw kh bi"><span id="3c52" class="ki kj hi ke b fi kk kl l km kn">from PIL import Image <br/>from pathlib import Path <br/>DEST_FILEIMG = "img1.jpg" <br/>RE_FILEIMG = "imgresize1.jpg" <br/>newSize = 6000000 <br/># bytes equal to 6MB <br/>filename = "image1.jpj" <br/>container_client = blob_service_client.get_container_client("sourcecontainer") container_client1 = blob_service_client.get_container_client("destinationcontainer")</span></pre><p id="acdd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是一次读取一个并调整其大小的代码</p><pre class="je jf jg jh fd kd ke kf kg aw kh bi"><span id="c449" class="ki kj hi ke b fi kk kl l km kn">blob_list = blob_service_client.get_container_client("excelon1").list_blobs() for blob in blob_list: <br/>    #print("\t" + blob.name) <br/>    if("jpg" in blob.name): <br/>        print("\t" + blob.name) <br/>        blob_client = container_client.get_blob_client(blob.name)<br/>        download_stream = blob_client.download_blob() <br/>        #print("File name" + blob.name + str(download_stream.readall()) + "\t") <br/>        with open(DEST_FILEIMG, "wb") as my_blob_img:  <br/>            my_blob_img.write(download_stream.readall()) <br/>        img = Image.open(DEST_FILEIMG) <br/>        width, height = img.size <br/>        fileSize = os.stat(DEST_FILEIMG).st_size <br/>        resizeFactor = 1 - (fileSize - newSize)/fileSize<br/>        #resizeFactor = 1 - (fileSize - newSize)/fileSize <br/>        if(fileSize &gt; newSize): <br/>           resizeFactor = 1 - (fileSize - newSize)/fileSize <br/>           if(resizeFactor &gt; 1): resizeFactor = 1 <br/>           newX = round(img.size[0] * resizeFactor) <br/>           newY = round(img.size[1] * resizeFactor) <br/>           img = img.resize((newX,newY), Image.ANTIALIAS) <br/>           img.save(RE_FILEIMG) <br/>        local_file_name = blob.name blob_client1 = blob_service_client.get_blob_client(container="destinatoncontainername", blob=local_file_name) <br/>        with open(RE_FILEIMG, "rb") as data:<br/>           blob_client1.upload_blob(data)</span></pre><p id="e494" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我保留了相同的名称，以便在需要时进行比较。另外，我一次只处理一个文件，这可能是将来的另一篇好文章。</p><p id="840a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里是数尺寸</p><pre class="je jf jg jh fd kd ke kf kg aw kh bi"><span id="0e15" class="ki kj hi ke b fi kk kl l km kn">print("\nListing blobs...") <br/>count = 0 <br/># List the blobs in the container <br/>blob_list = blob_service_client.get_container_client("destinationcontainername").list_blobs() <br/>for blob in blob_list: <br/>    #print("\t" + blob.name) <br/>    count += 1 </span><span id="0dc8" class="ki kj hi ke b fi ko kl l km kn">print("Total Files in container: " + str(count))</span></pre><p id="3258" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于我的上述运行，它花了大约30分钟来处理大约1000个不同大小的图像。</p><p id="05c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢</p></div><div class="ab cl kp kq gp kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="hb hc hd he hf"><p id="d427" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kw">最初发表于</em><a class="ae kx" href="https://github.com/balakreshnan/customvisionai2020/blob/master/ReSize/resizeimages.md" rel="noopener ugc nofollow" target="_blank"><em class="kw">【https://github.com】</em></a><em class="kw">。</em></p></div></div>    
</body>
</html>