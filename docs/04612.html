<html>
<head>
<title>Create custom clients in Locust.io to test database performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Locust.io中创建定制客户端来测试数据库性能</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/create-custom-clients-in-locust-io-to-test-database-performance-fd71235ece6e?source=collection_archive---------3-----------------------#2020-03-26">https://medium.com/analytics-vidhya/create-custom-clients-in-locust-io-to-test-database-performance-fd71235ece6e?source=collection_archive---------3-----------------------#2020-03-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/94da7a2c799f7bf475af413812d749d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vvpfcs0EdOzOYnN-s4Gpow.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Make Locust可以连接到MySQL和Presto，也可能连接到任何其他数据库..</figcaption></figure><p id="4715" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可能知道，Locust是以HTTP为主要目标构建的。因此，你将看到的所有教程和例子只告诉我们如何测试你的GET、PUT或POST端点。</p><p id="9b5c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然而，另一方面，如果你看看JMeter提供的各种选项，比如——能够通过其易于使用的JDBC客户端测试各种系统，如FTP、JMS、SMTP甚至数据库；你可能会很自然地觉得Locust有一些缺点。</p><p id="d20b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">但是，实际上，如果您需要扩展这个选项，并对任何基于请求/响应的系统(如数据库)进行负载测试，Locust开发人员已经保留了这个选项。蝗虫官网明确提到的一个特性是:</p><blockquote class="js jt ju"><p id="8920" class="iu iv jv iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hb bi translated"><strong class="iw hj"><em class="hi"/></strong><em class="hi">:</em></p><p id="0757" class="iu iv jv iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hb bi translated">蝗虫很小，非常容易被黑客攻击，我们打算保持这种状态。所有重要的事件I/O和协程都委托给gevent。替代测试工具的脆弱性是我们创建蝗虫的原因。</p></blockquote><p id="8233" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">还有一个<a class="ae jz" href="https://docs.locust.io/en/latest/testing-other-systems.html" rel="noopener ugc nofollow" target="_blank">示例</a>向您展示了如何创建一个定制的XML-RPC客户端，并使用它进行性能测试。</p><p id="f62d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，本文将向您介绍如何创建自定义客户端来测试MySQL或Presto数据库的性能。</p><h1 id="6d99" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">向TPC基准致敬</h1><p id="f28d" class="pw-post-body-paragraph iu iv hi iw b ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn lc jp jq jr hb bi translated">行业标准数据库性能基准测试使用<a class="ae jz" href="http://www.tpc.org/information/benchmarks.asp" rel="noopener ugc nofollow" target="_blank"> TPC </a>查询来完成这项工作。然而，<em class="jv">在您的项目</em>中可能有特定领域的用例或查询，您希望在某些预定义的负载下评估其性能。Locust或JMeter对于这样的场景来说非常方便，并且在某种程度上补充了TPC基准测试过程。</p></div><div class="ab cl ld le gp lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hb hc hd he hf"><p id="ce32" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">假设您已经在项目中安装了locust.io，让我们深入研究一个示例代码，展示如何编写一个定制客户端来测试MySQL查询性能。</p><h1 id="2664" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated"><strong class="ak">MySQL/蝗虫定制客户端</strong></h1><p id="d24b" class="pw-post-body-paragraph iu iv hi iw b ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn lc jp jq jr hb bi translated">我正在使用的软件包:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="6898" class="lt kb hi lp b fi lu lv l lw lx">...<br/>locustio==0.13.5<br/>PyMySQL==0.9.3<br/>SQLAlchemy==1.3.13<br/>...</span></pre><p id="c40e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，您首先要编写与数据库建立连接的方法，然后执行您想要的查询。接下来，创建一个客户端类，它将负责执行该方法并收集诸如通过/失败状态、运行时间等指标。客户端类需要在您的Locust类中初始化。<strong class="iw hj">参见下面的样本代码</strong>:</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="fb6e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要执行上面这段代码，用MySQL连接细节替换连接字符串的内容，并在第47行提供您想要的SQL查询。然后运行以下命令进行非web运行:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="8c77" class="lt kb hi lp b fi lu lv l lw lx">locust -f mysql_locust.py --no-web --clients=2 --hatch-rate=10 --run-time=1m</span></pre><blockquote class="js jt ju"><p id="f113" class="iu iv jv iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hb bi translated">这将使您的测试与2个并发用户一起运行1分钟。</p></blockquote><h1 id="7195" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">Presto/Locust自定义客户端</h1><p id="1878" class="pw-post-body-paragraph iu iv hi iw b ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn lc jp jq jr hb bi translated">Presto client的规则也是一样的，您可能知道，这是一个针对大数据的分布式SQL查询引擎。因此，测量和优化不同负载下的Presto查询对于贵组织大数据计划的成功至关重要。</p><p id="81fb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我正在使用的软件包:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="8c39" class="lt kb hi lp b fi lu lv l lw lx">...<br/>locustio==0.13.5<br/>PyHive==0.6.2<br/>...</span></pre><p id="9bd7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">示例工作代码如下:</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="499d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">无头运行它将是类似的:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="b2c7" class="lt kb hi lp b fi lu lv l lw lx">locust -f presto_locust.py --no-web --clients=2 --hatch-rate=10 --run-time=1m</span></pre></div><div class="ab cl ld le gp lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hb hc hd he hf"><p id="035d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可以随意添加更多的方法(每个方法包含不同的查询模式)并从<code class="du ma mb mc lp b">TaskSet</code>类执行它们。这些代码可以使用的一个增强功能是在运行时传递连接细节的方法。否则，在任何情况下，任何人都可以使用这些代码来测量他们的MySQL或Presto查询性能，并识别/优化执行缓慢的查询。</p></div></div>    
</body>
</html>