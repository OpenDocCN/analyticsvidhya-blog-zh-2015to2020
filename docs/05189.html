<html>
<head>
<title>Designing a contextual chatbot in Telegram with Python, Github &amp; Heroku — part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python、Github和Heroku在Telegram中设计上下文聊天机器人—第2部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/designing-a-contextual-chatbot-in-telegram-with-python-github-heroku-part-2-8e444c8a8386?source=collection_archive---------28-----------------------#2020-04-13">https://medium.com/analytics-vidhya/designing-a-contextual-chatbot-in-telegram-with-python-github-heroku-part-2-8e444c8a8386?source=collection_archive---------28-----------------------#2020-04-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8484" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<a class="ae jd" rel="noopener" href="/@sourav90.adhikari/designing-a-contextual-chatbot-in-telegram-with-python-github-heroku-part-1-39e24e7c7723">的最后一部分</a>，我们弄清楚了如何设置编码环境，并编写了实际运行机器人逻辑的Python脚本。在这一部分中，我们将在Heroku中创建一个新的应用程序，在Python脚本中设置一个webhook，并将本地git存储库推送到我们已经设置好的远程git。最后，我们将设置Heroku应用程序来直接访问Github存储库并部署应用程序。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/a2875a82593679b1a70fdff922381e92.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*ApUS9pOCktYiM4qnXGDLQg.jpeg"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">行动中的机器人</figcaption></figure></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><h1 id="27ff" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">在Heroku创建新应用程序</h1><p id="f154" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">Heroku是作为PaaS(平台即服务)运营的云应用平台。它使开发人员能够完全在云中构建、运行和操作应用程序。如果你没有一个免费的Heroku开发者帐号，你可以点击这个<a class="ae jd" href="https://signup.heroku.com/" rel="noopener ugc nofollow" target="_blank">链接</a>来创建一个。</p><p id="b3b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">登录您的Heroku帐户，您的应用仪表板将呈现在您面前。应用仪表板显示您的所有应用，并允许您管理它们。要创建新应用程序，请单击右上角的“新建”,并从下拉列表中选择“创建新应用程序”</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es la"><img src="../Images/cc9fed93264d3aa85d59ff31eeb6fed0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y0ThCD6-cMUA2R15XfqxfA.png"/></div></div></figure><p id="3606" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下一步中，输入应用程序的名称，然后单击“创建应用程序”</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es la"><img src="../Images/c9e6145166eb4bb493f7c7c990d131c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q9UoX8mbshQnPUbnR9oaJw.png"/></div></div></figure><p id="815a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">成功创建应用程序后，您将进入应用程序管理屏幕</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es la"><img src="../Images/ee1410213d706c6c06c844cfcfebde7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aWBl2_JAzKr8E3Ty-FOpWw.png"/></div></div></figure><p id="1d13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此页面允许您部署应用程序、查看日志等。在其他操作中。我们稍后将回到这一页。</p></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><h1 id="2c99" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">设置webhook </strong></h1><p id="d91d" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">webhook是一个HTTP push API，用于向其他应用程序实时传送数据。这是对典型HTTP推送API的改进，因为不需要频繁推送来模拟实时感觉。Telegram bot API提供了设置webhook的内置方法。</p><p id="c0e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要设置webhook，请打开编写bot逻辑的python脚本，并仅在main函数中添加以下代码。文件的其余部分保持原样。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lf lg l"/></div></figure><h2 id="09f3" class="lh jy hi bd jz li lj lk kd ll lm ln kh iq lo lp kl iu lq lr kp iy ls lt kt lu bi translated">解释附加的代码</h2><p id="c92b" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">第6行:将上一节中在Heroku中创建的应用程序的名称设置为APPNAME变量</p><p id="2c55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第27–30行:通过调用<code class="du lv lw lx ly b">updater.start_webhook()</code>方法启动一个webhook，并将参数设置为示例中所示的值</p><p id="6075" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第31行:通过调用<code class="du lv lw lx ly b">updater.set.Webhook()</code>方法设置webhook，并传递Heroku应用程序的URL，如示例所示</p><p id="fae3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第36行:注释掉<code class="du lv lw lx ly b">updater.start_polling()</code>方法。因为已经设置了webhook，所以不再需要这样做</p><p id="4f42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第39行:同样注释掉<code class="du lv lw lx ly b">updater.idle()</code>方法。</p></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><h1 id="e82c" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">将代码推送到Github存储库</h1><p id="f9b2" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">我们现在准备将我们的代码推送到Github repo。但是需要创建前三个附加文件</p><ul class=""><li id="2109" class="lz ma hi ih b ii ij im in iq mb iu mc iy md jc me mf mg mh bi translated">requirements.txt:这个文件列出了Heroku将在其环境中安装的所有python包。我们已经在一个虚拟环境中工作，要创建这个文件，只需从终端键入以下命令</li></ul><pre class="jf jg jh ji fd mi ly mj mk aw ml bi"><span id="ac89" class="lh jy hi ly b fi mm mn l mo mp">pip freeze &gt; requirements.txt</span></pre><ul class=""><li id="d27c" class="lz ma hi ih b ii ij im in iq mb iu mc iy md jc me mf mg mh bi translated">Procfile:所有Heroku应用程序都包含一个Procfile。Procfile指定了应用程序在启动时要执行的命令。它通常遵循以下格式:</li></ul><pre class="jf jg jh ji fd mi ly mj mk aw ml bi"><span id="911e" class="lh jy hi ly b fi mm mn l mo mp">&lt;process type&gt;: &lt;command&gt;</span></pre><p id="af0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过运行<code class="du lv lw lx ly b">touch Procfile</code>创建Procfile</p><p id="dcda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在您的编辑器中打开这个Procfile并添加<code class="du lv lw lx ly b">web: python telegram_bot.py</code></p><ul class=""><li id="4f50" class="lz ma hi ih b ii ij im in iq mb iu mc iy md jc me mf mg mh bi translated">。gitignore:这个文件维护了一个列表，列出了所有不需要推送到Github repo的文件。通常，这将包含所有本地环境文件。因为我们一直在使用一个名为venv的virtualenv，所以我们的文件应该会列出</li></ul><pre class="jf jg jh ji fd mi ly mj mk aw ml bi"><span id="b2ed" class="lh jy hi ly b fi mm mn l mo mp">venv/<br/>.venv<br/>venv.bak</span></pre><p id="c7be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦创建了这三个文件，从您的终端发出这些命令</p><pre class="jf jg jh ji fd mi ly mj mk aw ml bi"><span id="0678" class="lh jy hi ly b fi mm mn l mo mp">git add .<br/>git commit -m "first commit"<br/>git push -u origin master</span></pre><p id="23d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本地git repo中的所有文件现在都可以在远程Github存储库中获得。</p></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><h1 id="4d53" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">在Heroku上部署应用程序</h1><p id="d98c" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">现在回到你的Heroku应用程序页面。在“<strong class="ih hj">部署</strong>选项卡下，会列出三种部署方式。我们将选择<strong class="ih hj"> Github方法</strong>。</p><p id="5a7d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">授予Heroku访问您的Github个人资料的必要权限。一旦设置了授权，从搜索栏中搜索您的存储库的名称，然后单击“<strong class="ih hj">Connect</strong>”。</p><p id="13c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦存储库连接到Heroku应用程序，点击'<strong class="ih hj">手动部署</strong>'部分下的'<strong class="ih hj">部署分支</strong>，指向'<strong class="ih hj">主</strong>分支。该应用程序现在将建立自己，如果所有的步骤都是正确的，你的机器人将被托管。</p><p id="7f1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">请注意</strong>访问您的应用程序URL将返回一个“<strong class="ih hj"> 404:找不到页面</strong>”错误，但这没关系，因为脚本不一定返回任何内容。如果在启动应用程序时遇到问题，访问URL将显示错误消息。</p><p id="2fb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，这个教程到此为止。编码快乐！</p></div></div>    
</body>
</html>