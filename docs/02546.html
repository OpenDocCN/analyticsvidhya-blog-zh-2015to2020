<html>
<head>
<title>Malaria Bounding Boxes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">疟疾包围盒</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/malaria-bounding-boxes-41122bedf235?source=collection_archive---------9-----------------------#2019-12-22">https://medium.com/analytics-vidhya/malaria-bounding-boxes-41122bedf235?source=collection_archive---------9-----------------------#2019-12-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/9ccbb242407d52967950979bb3c966db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*dCSmV6M7WSN4d08TTe6UpA.png"/></div></figure><h1 id="e150" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">介绍</h1><p id="fe70" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi ki translated">alaria是一种由疟原虫寄生虫引起的疾病，它仍然是全球健康的主要威胁，每年影响2亿人并导致40万人死亡。</p><p id="7889" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated">对于疟疾和其他微生物感染，由训练有素的显微镜专家人工检查厚血涂片和薄血涂片仍然是寄生虫检测和阶段确定的金标准，因为其试剂和仪器成本低且灵活性高。尽管手动检测的处理量极低，并且容易受到人为偏差的影响，但由于明视野显微镜图像的变化范围很大，自动计数软件在很大程度上仍未得到使用。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/84121b6fa706f8943cbfc5891c4d3087.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*LQdDFT8pf2TCJN8yjSNH6g.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx translated">样本显微图像</figcaption></figure><p id="0bab" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated">为了克服这些问题，我建立了一个深度学习模型，将每个细胞分类为各自的感染或未感染细胞。</p><h1 id="efef" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">机器学习问题</h1><p id="1869" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">我们可以把这个问题当作一个<strong class="jm hj">物体检测问题，这里的</strong>物体是血细胞。该模型以原始图像为输入，通过在细胞周围绘制包围盒并注明细胞类型来给出输出。</p><p id="4da6" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated">输入:</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es lf"><img src="../Images/e205b5550ac46ebac8b74a5b96b6d3ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*VviUcIv6deQlU2ZBQoPmsg.png"/></div></figure><p id="53ea" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated">输出:</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es lg"><img src="../Images/2b7ea2cba54c71cbe909afa26d638e45.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*wrxXmo6R1Ujm3Nut7gCLuA.png"/></div></figure><h1 id="49c4" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">数据</h1><p id="26a2" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">我使用了来自Kaggle的<a class="ae lh" href="https://www.kaggle.com/kmader/malaria-bounding-boxes" rel="noopener ugc nofollow" target="_blank">疟疾包围盒</a>的数据，该数据由显微图像和注释(包围盒信息和图像中每个细胞的类别)组成。数据集由两类未感染细胞(红细胞和白细胞)和四类感染细胞(配子体、环、滋养体和裂殖体)组成。如果没有明确归类到某个细胞类别中，则将某些细胞标记为困难细胞。</p><p id="7879" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated">注释以JSON格式给出。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es li"><img src="../Images/764ca9c8e19520740fc72e8fa78f2363.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*jAzXKGt2uQn3IRfPRIplaw.png"/></div></figure><p id="f2aa" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated">我将80%的数据用于训练，20%的数据用于测试。</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="884e" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated">数据的一个主要问题是阶级不平衡。这里<strong class="jm hj">红细胞</strong>类支配着其他类</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es ll"><img src="../Images/04775c002e43c57557e5df2675e5f740.png" data-original-src="https://miro.medium.com/v2/resize:fit:462/format:webp/1*rQ06NNIxB6LLeK5gdNaGzQ.png"/></div></figure><p id="3765" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated">给定的JSON格式不适合模型准备，所以我制作了一个数据框，包括图像名称、边界框信息和类标签。我们在每个图像中有许多单元格，所以相同的图像名称将出现在更多的行中</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es lm"><img src="../Images/53398d75cf11f1a03bfb9c536fb4e2f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*PgX5rhpVLGLRzBneX4IFqQ.png"/></div></figure><h1 id="04bc" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">用更快的RCNN建模</h1><p id="76db" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">为了训练，我决定使用一种流行的物体检测算法的<strong class="jm hj">更快的R-CNN。</strong></p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es ln"><img src="../Images/3498dfc68d8d4ec42c5636329a61b2da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*9Gi8q9BPseHFZP2Iqsij0w.png"/></div></figure><p id="b852" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated">快速R-CNN由3个神经网络组成——特征网络、区域建议网络(RPN)和检测网络</p><h2 id="a8f4" class="lo in hi bd io lp lq lr is ls lt lu iw jv lv lw ja jz lx ly je kd lz ma ji mb bi translated">特征网络:</h2><p id="3219" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">特征网络通常是众所周知的预训练图像分类网络，例如VGG减去几个最后/顶层。该网络的功能是从图像中生成良好的特征。该网络的输出保持了原始图像的形状和结构(即，仍然是矩形，原始图像中的像素粗略地映射到相应的特征“像素”等)。)</p><h2 id="2dff" class="lo in hi bd io lp lq lr is ls lt lu iw jv lv lw ja jz lx ly je kd lz ma ji mb bi translated">区域提案网络(RPN):</h2><p id="b526" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">RPN通常是具有3个卷积层的简单网络。有一个共同的层，它分为两层，一层用于分类，另一层用于边界框回归。RPN的目的是生成许多被称为感兴趣区域(ROI)的边界框，这些边界框具有包含任何对象的高概率。该网络的输出是由两个对角的像素坐标标识的多个边界框，以及一个值(1、0或-1，分别指示对象是否在边界框中或者该框可以被忽略)。</p><h2 id="a3eb" class="lo in hi bd io lp lq lr is ls lt lu iw jv lv lw ja jz lx ly je kd lz ma ji mb bi translated">检测网络:</h2><p id="ae6f" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">检测网络(有时也称为RCNN网络)从特征网络和RPN获取输入，并生成最终的类和边界框。它通常由4个完全连接或致密的层组成。分类图层和边界框回归图层共享两个堆叠的公共图层。为了帮助它仅对边界框内部进行分类，将根据边界框裁剪要素。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/1eb92c7f4bf586454f3aecbc94623973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*9bBgccKZ-2MnqqpXqS8Uzg.png"/></div></figure><p id="9582" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated">由于我们的数据是高度不平衡的，我在整个数据集上训练更快的R-CNN后没有得到好的结果。无论细胞是什么，我们的模型预测它是红细胞，因为它在我们的数据集中占主导地位。为了克服这一点，我把这个问题分成两个阶段的分类问题。</p><h2 id="ef66" class="lo in hi bd io lp lq lr is ls lt lu iw jv lv lw ja jz lx ly je kd lz ma ji mb bi translated">一级分类:</h2><ul class=""><li id="65b1" class="md me hi jm b jn jo jr js jv mf jz mg kd mh kh mi mj mk ml bi translated">首先，我创建了只有两个标签的数据集，RBC和Other(除了RBC以外的所有类)</li><li id="5b2c" class="md me hi jm b jn mm jr mn jv mo jz mp kd mq kh mi mj mk ml bi translated">基于该数据训练了更快的R-CNN模型，该模型预测边界框和两个类别标签RBC和Other</li></ul><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mr"><img src="../Images/0547c4aeb6ad0900a29efab0cd4db958.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*zwmaaXIPVbsLUBmlZrDKSA.png"/></div></figure><h2 id="5b0c" class="lo in hi bd io lp lq lr is ls lt lu iw jv lv lw ja jz lx ly je kd lz ma ji mb bi translated">二级分类:</h2><ul class=""><li id="979b" class="md me hi jm b jn jo jr js jv mf jz mg kd mh kh mi mj mk ml bi translated">我已经用其他类(除了RBC)的地面真实边界框尺寸裁剪了图像。</li></ul><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lj lk l"/></div></figure><ul class=""><li id="208b" class="md me hi jm b jn kr jr ks jv ms jz mt kd mu kh mi mj mk ml bi translated">针对所有其他类，在此裁剪图像上训练密集网络模型。</li></ul><h2 id="6261" class="lo in hi bd io lp lq lr is ls lt lu iw jv lv lw ja jz lx ly je kd lz ma ji mb bi translated">测试</h2><ul class=""><li id="d9e1" class="md me hi jm b jn jo jr js jv mf jz mg kd mh kh mi mj mk ml bi translated">原始图像将被发送到第一级分类器。</li></ul><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mv"><img src="../Images/e2cd835e1f68fec0b4b17f1fa6e25fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*08Qb_-ziML7_VDfeYn9VwQ.png"/></div></figure><ul class=""><li id="bc43" class="md me hi jm b jn kr jr ks jv ms jz mt kd mu kh mi mj mk ml bi translated">它用边界框预测类RBC和其他。该结果(图像名称、边界框坐标和类别标签)将保存为CSV文件。</li></ul><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mw"><img src="../Images/f3a6844393551923547b187881e8ef4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*k3FPNqa1cCjmvTTVqzaH2A.png"/></div></figure><ul class=""><li id="0e63" class="md me hi jm b jn kr jr ks jv ms jz mt kd mu kh mi mj mk ml bi translated">在第二级中，再次获取原始图像并用预测的边界框尺寸裁剪其他类单元，最后馈送到模型2。模型2将预测单元的原始类别标签。</li></ul><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="er es mx"><img src="../Images/0f83605cf9db555020b2150c30108ef3.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*CF7OYFyB00B5MREoI382Sw.png"/></div></div></figure><h2 id="8723" class="lo in hi bd io lp lq lr is ls lt lu iw jv lv lw ja jz lx ly je kd lz ma ji mb bi translated">地面真实图像:</h2><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es nc"><img src="../Images/b8511a845b79362d0381fae4569e8a69.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*gMfKsZq6oEb5ZWruuL0RGg.png"/></div></figure><h2 id="c5ed" class="lo in hi bd io lp lq lr is ls lt lu iw jv lv lw ja jz lx ly je kd lz ma ji mb bi translated">结果</h2><p id="a16c" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">我使用地图作为模型的度量。关于地图的更多细节，请参考本文。</p><p id="231d" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated">这是测试数据的结果</p><p id="119e" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated">第一级分类器:在预测合适的包围盒以及分类红细胞和其他方面给出很好的结果</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es nd"><img src="../Images/5ee07544c58063a54fd3208859893a13.png" data-original-src="https://miro.medium.com/v2/resize:fit:346/format:webp/1*Z-Rp6JfFGbV-YlULZA5R8Q.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx translated">一级分类器后测试数据的结果</figcaption></figure><p id="f057" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated">最终分类器:对于少数类别，模型性能较低，因此，总体而言，我的MAP为0.78</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es ne"><img src="../Images/4e0eeba6ec0c18239464367e5d8969af.png" data-original-src="https://miro.medium.com/v2/resize:fit:448/format:webp/1*Xfy7Y1L_wlCDlIXI0kLzyQ.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx translated">最终分类器测试数据的结果</figcaption></figure><h1 id="9620" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">结论</h1><ul class=""><li id="54b0" class="md me hi jm b jn jo jr js jv mf jz mg kd mh kh mi mj mk ml bi translated">一级分类器在分类感染和未感染细胞方面做得不错，但在分类未感染细胞(红细胞和红细胞)方面做得不太好</li><li id="88ea" class="md me hi jm b jn mm jr mn jv mo jz mp kd mq kh mi mj mk ml bi translated">第二级分类器也工作良好，但由于内存问题，我拍摄的裁剪图像分辨率非常低。如果我们下定决心，我们还能得到更好的结果。</li><li id="0bdd" class="md me hi jm b jn mm jr mn jv mo jz mp kd mq kh mi mj mk ml bi translated">模型与“困难”类别有点混淆，因为实际上它不是一种感染的细胞类型，它只是因为我们不能将少数细胞分成6类中的任何一类而给出的。因此，我们的模型将预测正确的类而不是困难的类。</li></ul><h1 id="bb90" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">未来的工作</h1><ul class=""><li id="2c5e" class="md me hi jm b jn jo jr js jv mf jz mg kd mh kh mi mj mk ml bi translated">代替采用两个不同的分类器，我们可以通过创建次要类别的复制图像来平衡数据集，例如，我们可以使用GAN(生成对抗网络)作为数据增强技术。</li></ul><h1 id="0d9b" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">参考</h1><p id="8a8d" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><a class="ae lh" href="https://arxiv.org/pdf/1504.08083.pdf" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/pdf/1504.08083.pdf</a></p><p id="ce3d" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated">【https://arxiv.org/ftp/arxiv/papers/1804/1804.09548.pdf T2】号</p><p id="faaa" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated">【https://github.com/kbardool/keras-frcnn T4】</p><p id="da35" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated"><a class="ae lh" rel="noopener" href="/@whatdhack/a-deeper-look-at-how-faster-rcnn-works-84081284e1cd">https://medium . com/@ what dhack/a-deeper-look-how-faster-rcnn-works-84081284 E1 CD</a></p><p id="da30" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated">你可以在我的<a class="ae lh" href="https://github.com/sandeepburra/Malaria-Bounding-Boxes" rel="noopener ugc nofollow" target="_blank"> Github库</a>中找到完整的代码</p><p id="ec47" class="pw-post-body-paragraph jk jl hi jm b jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh hb bi translated">希望你喜欢这个博客，欢迎在下面的评论区分享你的想法，或者通过<a class="ae lh" href="https://www.linkedin.com/in/sandeep-burra-a7635aa0/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我</p></div></div>    
</body>
</html>