<html>
<head>
<title>Python-Data Projects — Data Analysis UI Reinforced by Ipywidgets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python数据项目Ipywidgets增强的数据分析UI</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/python-data-projects-data-analysis-ui-reinforced-by-ipywidgets-d680493464b8?source=collection_archive---------1-----------------------#2019-10-01">https://medium.com/analytics-vidhya/python-data-projects-data-analysis-ui-reinforced-by-ipywidgets-d680493464b8?source=collection_archive---------1-----------------------#2019-10-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9047" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Jupyter笔记本附带ipywidget插件，提供舒适的交互式用户体验。</p><p id="9de5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本帖中，我们将构建一个ipywidget框架，该框架:</p><ul class=""><li id="49d9" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><strong class="ih hj">检索</strong>源数据(CSV格式)并解析内容，</li><li id="2823" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><strong class="ih hj">补充</strong>统计和元信息，以及</li><li id="e194" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><strong class="ih hj">用普通matplotlib图绘制</strong>数据</li></ul><figure class="jr js jt ju fd jv"><div class="bz dy l di"><div class="jw jx l"/></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">预期的设计和实际功能</figcaption></figure></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><p id="5847" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">面对现实吧！任何处理CSV数据的人，尤其是在开发一个非常小的函数时，都必须接受这样一个事实:这是一个非常麻烦的过程，因为每个文件都有特殊的格式、定界、meta|top头、总计等。否则，函数的通用性就相当有限。因此，我们应该定义并坚持一种促进用户体验的方式，这种方式允许用户在选项中进行交互选择。</p><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es kj"><img src="../Images/0424ec9874d2b150e1f4c9cf16bc841c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*emd3iOLne4KYxcPxlDN6aQ.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">典型的场景流程</figcaption></figure><p id="ac39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从消化一般的ipywidget框架和小部件类型开始。</p><h1 id="beb5" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">Ipywidget布局结构和小部件类型</h1><p id="3a72" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">在开发ipywidget实现时，首先要做的是创建布局并将小部件分布到。下图总结了我们的目标。</p><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lt"><img src="../Images/698ba54322d1b4c4e73f449e3a31da9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fsaICO-MYUhLkHTGID_jAw.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">预期布局预览</figcaption></figure><p id="27e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是时候应用逆向工程技术并仔细检查它的组件了。</p><h2 id="09d1" class="lu kr hi bd ks lv lw lx kw ly lz ma la iq mb mc le iu md me li iy mf mg lm mh bi translated">标签结构</h2><p id="4ed6" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">在布局中，存在一个3- <em class="mi"> partite </em>选项卡结构，每个选项卡包含不同的子窗口小部件，这些子窗口小部件协作实现项目目标；<strong class="ih hj">检索</strong>、<strong class="ih hj">补充</strong>和<strong class="ih hj">剧情</strong>。</p><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="db15" class="lu kr hi mk b fi mo mp l mq mr">tab = widgets.Tab()</span><span id="6651" class="lu kr hi mk b fi ms mp l mq mr">children = [...]                            # to be introduced</span><span id="b147" class="lu kr hi mk b fi ms mp l mq mr">tab.children = children<br/>tab.set_title(0, "Upload")<br/>tab.set_title(1, "Describer")<br/>tab.set_title(2, "Plotter")</span></pre><p id="67df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mi"> children </em>属性加载包含索引和名称的选项卡列表。</p><h2 id="f6bb" class="lu kr hi bd ks lv lw lx kw ly lz ma la iq mb mc le iu md me li iy mf mg lm mh bi translated">折叠式小部件</h2><p id="22e5" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">在<em class="mi">上传</em>选项卡中，我们面对的是一个超级用户友好的折叠式小部件，尤其是在要遵循顺序流程的情况下。</p><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="d25b" class="lu kr hi mk b fi mo mp l mq mr">accordion = widgets.Accordion(children=[...])    # to be introduced<br/>accordion.set_title(0, 'File Selection')<br/>accordion.set_title(1, 'Delimiter')<br/>accordion.set_title(2, 'Skip Rows')</span></pre><p id="2c21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就像选项卡小部件一样，可以通过<em class="mi">子</em>属性和<em class="mi"> set_title() </em>方法引入层级系统。</p><h2 id="7144" class="lu kr hi bd ks lv lw lx kw ly lz ma la iq mb mc le iu md me li iy mf mg lm mh bi translated">按钮部件</h2><p id="61f5" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">按钮部件是触发元素，用户单击它来检索预期的操作。</p><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="246c" class="lu kr hi mk b fi mo mp l mq mr">button_preview = widgets.Button(<br/>    description='Preview',<br/>    disabled=False,<br/>    button_style='info',<br/>    tooltip='Click to Preview',<br/>    icon='search')</span><span id="97af" class="lu kr hi mk b fi ms mp l mq mr">def preview():<br/>    ...  # to be introduced</span><span id="e720" class="lu kr hi mk b fi ms mp l mq mr">def preview_clicked(b):<br/>    preview()button_preview.on_click(preview_clicked)</span></pre><p id="52f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于我们可以通过<em class="mi">描述</em>、<em class="mi">按钮样式</em>和<em class="mi">图标</em>属性来增强按钮的视觉效果，也可以通过<em class="mi"> on_click() </em>等方法来增强功能。现在，让我们将功能保存到下面的相关部分。</p><h2 id="35e3" class="lu kr hi bd ks lv lw lx kw ly lz ma la iq mb mc le iu md me li iy mf mg lm mh bi translated">输出部件</h2><p id="0399" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">命名应该是直截了当的，输出小部件动态呈现数据的快照。</p><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="2c94" class="lu kr hi mk b fi mo mp l mq mr">out = widgets.Output(layout={'border': '1px solid black'})</span><span id="23b8" class="lu kr hi mk b fi ms mp l mq mr">.<br/>.<br/>.</span><span id="fcae" class="lu kr hi mk b fi ms mp l mq mr">with out:<br/>        out.clear_output()<br/>        print('\n -----Now this is how your DF looks like:----- \n')<br/>        if df is not None:<br/>            print(df.head(10))<br/>        else:<br/>            print('Configuration is wrong/missing...')</span></pre><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es mt"><img src="../Images/345c5ba6f3060e216f5c3b80bd058671.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*11YI_fTmaavgHO-rUcMqZQ.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">输出小部件预览</figcaption></figure><h2 id="3e57" class="lu kr hi bd ks lv lw lx kw ly lz ma la iq mb mc le iu md me li iy mf mg lm mh bi translated">文件上传小部件</h2><p id="673c" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">同样，顾名思义，FileUpload小部件被激活以向系统提供原始数据。</p><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="6a08" class="lu kr hi mk b fi mo mp l mq mr">up = widgets.FileUpload(accept="", multiple=False)</span></pre><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es mu"><img src="../Images/4ee2ec9079ecbcc9d9f709a5c59035d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WbJq20cSdwmGRxnknyxv8w.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">文件上传小部件预览</figcaption></figure><h2 id="296a" class="lu kr hi bd ks lv lw lx kw ly lz ma la iq mb mc le iu md me li iy mf mg lm mh bi translated">单选按钮小部件</h2><p id="71d9" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">RadioButtons小部件用于在选项中进行单一选择。</p><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="245c" class="lu kr hi mk b fi mo mp l mq mr"># RadioButtons widget instantiation<br/>delim = widgets.RadioButtons(<br/>    options=[';', ',', ' '],<br/>    description='Separator: ',<br/>    disabled=False<br/>)</span></pre><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es mv"><img src="../Images/dc00eaddf19543ae04dc95a4850e4cad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GJmVuXlwHbPUUYDMi__eKQ.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">单选按钮和选择多个小部件预览</figcaption></figure><h2 id="98a2" class="lu kr hi bd ks lv lw lx kw ly lz ma la iq mb mc le iu md me li iy mf mg lm mh bi translated">选择多个小部件</h2><p id="dec5" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">SelectMultiple小部件允许在不同的选项中进行多重选择。</p><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="8d41" class="lu kr hi mk b fi mo mp l mq mr"># SelectMultiple widget instantiation<br/>eraser = widgets.SelectMultiple(<br/>    options=['tab','"'],<br/>    value=['tab'],<br/>    #rows=10,<br/>    description='Eraser: ',<br/>    disabled=False<br/>)</span></pre><h2 id="1973" class="lu kr hi bd ks lv lw lx kw ly lz ma la iq mb mc le iu md me li iy mf mg lm mh bi translated">IntSlider小工具</h2><p id="4847" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">IntSlider小部件提供了在滑动选择器上定义数值大小和预定义最小-最大频谱配置的可能性。</p><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="bc3b" class="lu kr hi mk b fi mo mp l mq mr"># IntSlider widget instantiation<br/>rows = widgets.IntSlider(<br/>    value=0,<br/>    step=1,<br/>    description='# of lines:',<br/>    disabled=False,<br/>    continuous_update=False,<br/>    orientation='horizontal',<br/>    readout=True,<br/>    readout_format='d'<br/>)</span></pre><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es mw"><img src="../Images/f4b12f967ec80b9f43a261c7428d45da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IMnBfV5ttHf4hTAd_X2bsA.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">IntSlider Widget预览</figcaption></figure><h2 id="f048" class="lu kr hi bd ks lv lw lx kw ly lz ma la iq mb mc le iu md me li iy mf mg lm mh bi translated">ToggleButtons构件</h2><p id="3432" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">ToggleButtons，由于两者；体现一个标准按钮的功能并允许在不同的选项中进行选择是强视觉类型。</p><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="7c37" class="lu kr hi mk b fi mo mp l mq mr"># ToggleButtons widget instantiation<br/>toggle = widgets.ToggleButtons(<br/>    options=['Preview', 'Info', 'Stats'],<br/>    description='Options',<br/>    disabled=False,<br/>    button_style='warning',<br/>    icons=['search', 'info', 'tachometer']<br/>)</span></pre><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es mx"><img src="../Images/1abf3d3ef918ed3502e45c549e9e05c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_or36elHBYNvNFDJ-XbHEw.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">ToggleButtons部件预览</figcaption></figure><h2 id="b407" class="lu kr hi bd ks lv lw lx kw ly lz ma la iq mb mc le iu md me li iy mf mg lm mh bi translated">下拉小工具</h2><p id="eb14" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">Dropdown widget是单一选择器的又一个例子。在典型的用法中，用户被要求选择一个由开发人员预先定义或动态更新的选项。</p><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="e1f9" class="lu kr hi mk b fi mo mp l mq mr"># Dropdown widget instantiation<br/>graph_type = widgets.Dropdown(<br/>    options=['Bar Chart', 'Line Chart'],<br/>    value='Bar Chart',<br/>    description='Chart Type:',<br/>    disabled=False,<br/>)</span></pre><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es my"><img src="../Images/2a2b4d40f2b127977267a442731ee97c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G5UlSSbldXHYONjCNFx50w.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">下拉菜单和颜色选择器小部件预览以及HBox/VBox的使用</figcaption></figure><h2 id="d9e4" class="lu kr hi bd ks lv lw lx kw ly lz ma la iq mb mc le iu md me li iy mf mg lm mh bi translated">颜色选择器小工具</h2><p id="62ee" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">ColorPicker小部件进入场景，一旦颜色相关的值尚未定义。通过在调色板上选择一种色调，或者通过在小部件中引入颜色名称，来定义颜色。</p><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="ffbb" class="lu kr hi mk b fi mo mp l mq mr"># ColorPicker widget instantiation<br/>color_picker = widgets.ColorPicker(<br/>    concise=False,<br/>    description='Color Picker: ',<br/>    value='lightblue',<br/>    disabled=False<br/>)</span></pre><h2 id="2258" class="lu kr hi bd ks lv lw lx kw ly lz ma la iq mb mc le iu md me li iy mf mg lm mh bi translated">HBox/VBox</h2><p id="22c5" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">HBox/VBox，尽管都被评价为小部件，但它们缺乏独立的视觉形式。另一方面，HBox/VBox用作容器，因此这些容器中的分组小部件将被定位，无论它们是横向(<strong class="ih hj"> H </strong>框)还是纵向(VBox)群集的<strong class="ih hj"> V </strong>。</p><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="9bf1" class="lu kr hi mk b fi mo mp l mq mr"># 4 horizontal layers (VBox) and 2 columnar structure (HBox)<br/>widgets.VBox([<br/>        widgets.HBox([graph_type, color_picker]),<br/>        widgets.HBox([x_axis, y_axis]), <br/>        button_plot,<br/>        out<br/>])</span></pre></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><p id="674d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在完成视觉架构的练习后，现在是赋予按钮功能的时候了。</p><h1 id="83dd" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">数据检索和解析</h1><p id="77ed" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">数据检索和内容解析过程中要遵循的步骤:</p><ul class=""><li id="6d87" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">访问用户通过FileUpload小部件(“up”对象)共享的CSV内容；</li><li id="c5f2" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">根据从用户引入的参数(“delim”、“eraser”和“rows”对象)清理数据，并将数据对象转换成pandas数据帧；和</li><li id="222c" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">赋予按钮“预览”功能，用户可以随时观察数据快照，并“上传”以将数据存储在系统中。</li></ul><h2 id="5b0a" class="lu kr hi bd ks lv lw lx kw ly lz ma la iq mb mc le iu md me li iy mf mg lm mh bi translated">通过文件上传小部件访问CSV的内容</h2><p id="9d14" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">一旦分析了通过FileUpload小部件获得的数据，很容易观察到原始数据存储在“content”字段下。</p><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="d583" class="lu kr hi mk b fi mo mp l mq mr">&gt;&gt;&gt; print(up)</span><span id="829b" class="lu kr hi mk b fi ms mp l mq mr">FileUpload(value={'oscar_male.csv': {'metadata': {'name': 'oscar_male.csv', 'type': 'text/csv', 'size': 4413, 'lastModified': 1555765537290}, 'content': b'"Index", "Year", "Age", "Name", "Movie"\n 1, 1928, 44, "Emil Jannings", "The Last Command, The Way of All Flesh"\n 2, 1929, 41, "Warner Baxter", "In Old Arizona"\n 3, 1930, 62, "George Arliss", "Disraeli"\n 4, 1931, 53, "Lionel Barrymore", "A Free Soul"\n 5, 1932, 47, "Wallace Beery", "The Champ"\n 6, 1933, 35, "Fredric March", "Dr. Jekyll and Mr. Hyde"\n 7, 1934, 34, "Charles Laughton", "The Private Life of Henry VIII"\n 8, 1935, 34, "Clark Gable", "It Happened One Night"\n 9, 1936,...)</span></pre><p id="4782" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">剩余部分提供了关于源文件的元信息，如文件类型等。</p><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="83fc" class="lu kr hi mk b fi mo mp l mq mr">def content_parser():<br/>    if up.value == {}:<br/>        with out:<br/>            print('No CSV loaded')    <br/>    else:<br/>        typ, content = "", ""<br/>        up_value = up.value<br/>        for i in up_value.keys():<br/>            typ = up_value[i]["metadata"]["type"]        if typ == "text/csv":<br/>            content = up_value[i]["content"]<br/>            content_str = str(content, 'utf-8')</span></pre><h2 id="e447" class="lu kr hi bd ks lv lw lx kw ly lz ma la iq mb mc le iu md me li iy mf mg lm mh bi translated">解析内容并将其传输到数据帧中</h2><p id="dc2a" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">本文开头提到的事实会重复出现，每个CSV的结构各不相同。默认情况下，选取的分隔符是“；”，然而实际上，“”将细胞彼此分开。输出小部件揭示了事实。</p><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es mz"><img src="../Images/864ae9f1f96c3ac4481dd9dea11fd866.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bTJmG2qV9Rf2qHk3H1qYZA.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">预览按钮上的数据快照以及分隔符和橡皮擦输入的选择</figcaption></figure><p id="130e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，Accordion小部件中的“分隔符”部分以及“橡皮擦”部分都必须重新调整。这样，就可以进行正确的解析。</p><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es na"><img src="../Images/3c1d04c82523524cdee52de070b4f104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GkAUN4CVOE4fRLmzKypL3Q.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">正确解析后输出小部件</figcaption></figure><p id="96b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用户引入的所有值都可以通过小部件的“值”属性捕获，并在函数中重用。</p><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="33d7" class="lu kr hi mk b fi mo mp l mq mr">def content_parser():<br/>    if up.value == {}:<br/>        with out:<br/>            print('No CSV loaded')    <br/>    else:<br/>        typ, content = "", ""<br/>        up_value = up.value<br/>        for i in up_value.keys():<br/>            typ = up_value[i]["metadata"]["type"]        </span><span id="f357" class="lu kr hi mk b fi ms mp l mq mr">        if typ == "text/csv":<br/>            content = up_value[i]["content"]<br/>            content_str = str(content, 'utf-8')<br/>    <br/>            if eraser.value != {}: <br/>                for val in eraser.value:<br/>                    if val == "tab":<br/>                        content_str = content_str.replace("\t","")<br/>                    else:<br/>                        content_str = content_str.replace(val,"")<br/>            if content_str != "":<br/>                str_io = StringIO(content_str) <br/>                return str_io</span><span id="62f6" class="lu kr hi mk b fi ms mp l mq mr">def df_converter():<br/>    content = content_parser()<br/>    if content is not None:<br/>        df = pd.read_csv(<br/>             content, <br/>             sep=delim.value, <br/>             index_col=False, <br/>             skiprows=rows.value)    <br/>        return df<br/>    else:<br/>        return None</span></pre><h2 id="a736" class="lu kr hi bd ks lv lw lx kw ly lz ma la iq mb mc le iu md me li iy mf mg lm mh bi translated">逐步流程监控和上传最终CSV</h2><p id="3848" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">由于“预览”按钮的功能，可以监控中间结果，并通过“上传”按钮，最终CSV可以上传到系统中。</p><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es nb"><img src="../Images/430e41f6cf49005f2cf292ee0218d9b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KbbqUqXxbuzKAgfOijhvOQ.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">流程中预览按钮的用法</figcaption></figure><p id="576c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“上传”和“预览”按钮的主要区别在于，在“上传”动作之后，“绘图仪”选项卡中的轴选项会根据加载的数据进行更新。正如我们在场景中所观察到的，在窗口小部件内部以及窗口小部件和用户之间有一个动态的通信。</p><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es nc"><img src="../Images/254641319c287143a6728975da89c3aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_PrXP4JkXH8d9MzsQd9-Og.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">加载CSV后动态更新下拉选项值</figcaption></figure><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="0d00" class="lu kr hi mk b fi mo mp l mq mr">def preview():<br/>    df = df_converter()<br/>    with out:<br/>        out.clear_output()<br/>        print('\n -----Now this is how your DF looks like:----- \n')<br/>        if df is not None:<br/>            print(df.head(10))<br/>        else:<br/>            print('Configuration is wrong/missing...')</span><span id="5e6d" class="lu kr hi mk b fi ms mp l mq mr">def upload():<br/>    df = df_converter()<br/>    with out:<br/>        out.clear_output()<br/>        print('\n -----Your uploaded DF looks like:----- \n')<br/>        if df is not None:<br/>            print(df)<br/>            x_axis.options = df.columns  # Dropdown Widget update<br/>            y_axis.options = df.columns  # Dropdown Widget update<br/>        else:<br/>            print('Configuration is wrong/missing...')</span><span id="2c0b" class="lu kr hi mk b fi ms mp l mq mr">def preview_clicked(b):<br/>    preview()</span><span id="3015" class="lu kr hi mk b fi ms mp l mq mr">def upload_clicked(b):<br/>    upload()</span><span id="e8ca" class="lu kr hi mk b fi ms mp l mq mr"><br/># Assigning functionality to buttons<br/>button_preview.on_click(preview_clicked)<br/>button_upload.on_click(upload_clicked)</span></pre><h1 id="046f" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">获取统计信息和元信息</h1><p id="4e3a" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">在本文的范围内，我们所讨论的“统计”和“元”信息仅限于基本的数据帧操作，如“head()”、“info()”和“describe()”以及它们在输出小部件上的外观。</p><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es nd"><img src="../Images/34de810293d381519ceee1ca2c18375f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1i2akiK43ktgN_vq8VkqrA.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">描述符选项卡预览</figcaption></figure><p id="74b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面列出了每个ToggleButton的替代选项。在ToggleButtons中，由于使用了“observe()”方法，我们可以检索并返回当前值，而不是像处理按钮那样使用“on_click()”方法。</p><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="2e1f" class="lu kr hi mk b fi mo mp l mq mr">def desc():<br/>    info_level = toggle.value<br/>    if info_level != {}:<br/>        df = df_converter()<br/>        with out:<br/>            out.clear_output()<br/>            print('\n ------Your {} looks like:------ \n'.format(<br/>                info_level))<br/>            if df is not None:<br/>                if info_level == 'Info  ':<br/>                    print(df.info(verbose=True))<br/>                elif info_level == 'Stats  ':<br/>                    print(df.describe())<br/>                elif info_level == 'Preview  ':<br/>                    print(df.head(5))<br/>                else:<br/>                print('Configuration is wrong/missing...')</span><span id="e9f4" class="lu kr hi mk b fi ms mp l mq mr">toggle.observe(desc_clicked, 'value')</span></pre><h1 id="2bba" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">数据可视化</h1><p id="3533" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">我们已经介绍了如何在上传原始文件时填充X和Y轴选项值。用户可以通过选择维度和度量来开始分析图表。除此之外，图形表示可以通过进一步的色彩和绘图风格得到加强。</p><p id="33e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了将重点放在ipywidget主题上，我用简单的线图和条形图来限制可视化选项。在下文中，“图表类型”下拉菜单可用于定义图表样式。</p><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ne"><img src="../Images/6793d872ad107c66c689056c8f0e7a67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0KZ9D-EJxvVeHDdNGtOKhA.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">条形图可视化预览</figcaption></figure><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es nf"><img src="../Images/0f6550eb2b9a039f4d1547725a36c24f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gUfmCelcq_byyHC-02tNsw.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">折线图可视化预览</figcaption></figure><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="e3d8" class="lu kr hi mk b fi mo mp l mq mr">def plot():<br/>    graph = graph_type.value<br/>    if graph != {}:<br/>        df = df_converter()<br/>        with out:<br/>            out.clear_output()<br/>            print('\n -----Your {} looks like:----- \n'.format(<br/>                graph))<br/>            if (df is not None):<br/>                df = df.head(5)<br/>                height = df[y_axis.value]<br/>                bars = df[x_axis.value]<br/>                y_pos = np.arange(len(height))<br/>                plt.figure(figsize=(10,4))<br/>                if graph == 'Bar Chart':<br/>                    plt.bar(<br/>                        y_pos, <br/>                        height, <br/>                        color=color_picker.value)<br/>                    plt.xticks(y_pos, bars)<br/>                elif graph == 'Line Chart':<br/>                    plt.plot(<br/>                        bars,<br/>                        height, <br/>                        color=color_picker.value,<br/>                        marker='o', <br/>                        linestyle='solid'<br/>                    )<br/>                    plt.xticks(bars)<br/>                plt.show()</span><span id="b20e" class="lu kr hi mk b fi ms mp l mq mr"><br/>def plotter_clicked(b):<br/>    plot()</span><span id="76b0" class="lu kr hi mk b fi ms mp l mq mr">button_plot.on_click(plotter_clicked)</span></pre></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><p id="8672" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过考虑各种使用选项，上面介绍的实现可以进行开发和改进。让这个框架适应特殊的CSV格式、利基分析用例以及华而不实的图表简直是小菜一碟。</p><p id="445f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">访问实施视频(仅提供土耳其语版本)👇</p><figure class="jr js jt ju fd jv"><div class="bz dy l di"><div class="ng jx l"/></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">实施视频(用土耳其语解释)</figcaption></figure><p id="a5d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要访问完整的Python代码👇</p><pre class="jr js jt ju fd mj mk ml mm aw mn bi"><span id="0a8a" class="lu kr hi mk b fi mo mp l mq mr">import pandas as pd<br/>import sys<br/>from io import StringIO<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>%matplotlib inline</span><span id="f70a" class="lu kr hi mk b fi ms mp l mq mr">tab = widgets.Tab()    <br/>out = widgets.Output(layout={'border': '1px solid black'})<br/>up = widgets.FileUpload(accept="", multiple=False)<br/>delim = widgets.RadioButtons(<br/>    options=[';', ',', ' '],<br/>    description='Separator: ',<br/>    disabled=False)</span><span id="4b56" class="lu kr hi mk b fi ms mp l mq mr">eraser = widgets.SelectMultiple(<br/>    options=['tab','"'],<br/>    value=['tab'],<br/>    #rows=10,<br/>    description='Eraser: ',<br/>    disabled=False)</span><span id="eb6a" class="lu kr hi mk b fi ms mp l mq mr">rows = widgets.IntSlider(<br/>    value=0,<br/>    step=1,<br/>    description='# of lines:',<br/>    disabled=False,<br/>    continuous_update=False,<br/>    orientation='horizontal',<br/>    readout=True,<br/>    readout_format='d')</span><span id="d442" class="lu kr hi mk b fi ms mp l mq mr">button_upload = widgets.Button(<br/>    description='Upload',<br/>    disabled=False,<br/>    button_style='warning',<br/>    tooltip='Click to Upload',<br/>    icon='check')</span><span id="d5f0" class="lu kr hi mk b fi ms mp l mq mr">button_preview = widgets.Button(<br/>    description='Preview',<br/>    disabled=False,<br/>    button_style='info',<br/>    tooltip='Click to Preview',<br/>    icon='search')</span><span id="73ad" class="lu kr hi mk b fi ms mp l mq mr">button_plot = widgets.Button(<br/>    description='Plot',<br/>    disabled=False,<br/>    button_style='danger',<br/>    tooltip='Click to Plot',<br/>    icon='pencil')</span><span id="3e94" class="lu kr hi mk b fi ms mp l mq mr">graph_type = widgets.Dropdown(<br/>    options=['Bar Chart', 'Line Chart'],<br/>    value='Bar Chart',<br/>    description='Chart Type:',<br/>    disabled=False)</span><span id="40d2" class="lu kr hi mk b fi ms mp l mq mr">x_axis = widgets.Dropdown(<br/>    options=[''],<br/>    value='',<br/>    description='X-Axis:',<br/>    disabled=False)</span><span id="fb8a" class="lu kr hi mk b fi ms mp l mq mr">y_axis = widgets.Dropdown(<br/>    options=[''],<br/>    value='',<br/>    description='Y-Axis:',<br/>    disabled=False)</span><span id="87c5" class="lu kr hi mk b fi ms mp l mq mr">color_picker = widgets.ColorPicker(<br/>    concise=False,<br/>    description='Color Picker: ',<br/>    value='lightblue',<br/>    disabled=False)</span><span id="64eb" class="lu kr hi mk b fi ms mp l mq mr">toggle = widgets.ToggleButtons(<br/>    options=['Preview  ', 'Info  ', 'Stats  '],<br/>    description='Options',<br/>    disabled=False,<br/>    button_style='warning',<br/>    icons=['search', 'info', 'tachometer'])</span><span id="e708" class="lu kr hi mk b fi ms mp l mq mr">accordion = widgets.Accordion(children=[<br/>    up, <br/>    widgets.VBox([delim, eraser]), <br/>    rows])<br/>accordion.set_title(0, 'File Selection')<br/>accordion.set_title(1, 'Delimiter')<br/>accordion.set_title(2, 'Skip Rows')<br/>accordion_box = widgets.VBox([<br/>    accordion, <br/>    widgets.HBox([button_preview, button_upload]),<br/>    out<br/>])</span><span id="274b" class="lu kr hi mk b fi ms mp l mq mr">children = [<br/>    accordion_box, <br/>    widgets.VBox([toggle, out]),<br/>    widgets.VBox([<br/>        widgets.HBox([graph_type, color_picker]),<br/>        widgets.HBox([x_axis, y_axis]), <br/>        button_plot,<br/>        out<br/>])]</span><span id="18e7" class="lu kr hi mk b fi ms mp l mq mr">tab.children = children<br/>tab.set_title(0, "Upload")<br/>tab.set_title(1, "Describer")<br/>tab.set_title(2, "Plotter")<br/>tab</span><span id="78b3" class="lu kr hi mk b fi ms mp l mq mr">def content_parser():<br/>    if up.value == {}:<br/>        with out:<br/>            print('No CSV loaded')    <br/>    else:<br/>        typ, content = "", ""<br/>        up_value = up.value<br/>        for i in up_value.keys():<br/>            typ = up_value[i]["metadata"]["type"]if typ == "text/csv":<br/>            content = up_value[i]["content"]<br/>            content_str = str(content, 'utf-8')<br/>    <br/>            if eraser.value != {}: <br/>                for val in eraser.value:<br/>                    if val == "tab":<br/>                        content_str = content_str.replace("\t","")<br/>                    else:<br/>                        content_str = content_str.replace(val,"")<br/>            if content_str != "":<br/>                str_io = StringIO(content_str) <br/>                return str_io</span><span id="77bf" class="lu kr hi mk b fi ms mp l mq mr">def df_converter():<br/>    content = content_parser()<br/>    if content is not None:<br/>        df = pd.read_csv(content, sep=delim.value, index_col=False, skiprows=rows.value)    <br/>        return df<br/>    else:<br/>        return None</span><span id="2b7b" class="lu kr hi mk b fi ms mp l mq mr">def preview():<br/>    df = df_converter()<br/>    with out:<br/>        out.clear_output()<br/>        print('\n -----Now this is how your DF looks like:----- \n')<br/>        if df is not None:<br/>            print(df.head(10))<br/>        else:<br/>            print('Configuration is wrong/missing...')</span><span id="a1ed" class="lu kr hi mk b fi ms mp l mq mr">def upload():<br/>    df = df_converter()<br/>    with out:<br/>        out.clear_output()<br/>        print('\n --------Your uploaded DF looks like:-------- \n')<br/>        if df is not None:<br/>            print(df)<br/>            x_axis.options = df.columns<br/>            y_axis.options = df.columns<br/>        else:<br/>            print('Configuration is wrong/missing...')</span><span id="b7d7" class="lu kr hi mk b fi ms mp l mq mr">def desc():<br/>    info_level = toggle.value<br/>    if info_level != {}:<br/>        df = df_converter()<br/>        with out:<br/>            out.clear_output()<br/>            print('\n ------Your {} looks like:------ \n'.format(<br/>                info_level))<br/>            if df is not None:<br/>                if info_level == 'Info  ':<br/>                    print(df.info(verbose=True))<br/>                elif info_level == 'Stats  ':<br/>                    print(df.describe())<br/>                elif info_level == 'Preview  ':<br/>                    print(df.head(5))<br/>                else:<br/>                    print('Configuration is wrong/missing...')<br/>    <br/>    <br/>def plot():<br/>    graph = graph_type.value<br/>    if graph != {}:<br/>        df = df_converter()<br/>        with out:<br/>            out.clear_output()<br/>            print('\n ------Your {} looks like:------ \n'.format(<br/>                graph))<br/>            if (df is not None):<br/>                df = df.head(5)<br/>                height = df[y_axis.value]<br/>                bars = df[x_axis.value]<br/>                y_pos = np.arange(len(height))<br/>                plt.figure(figsize=(10,4))<br/>                if graph == 'Bar Chart':<br/>                    plt.bar(<br/>                        y_pos, <br/>                        height, <br/>                        color=color_picker.value)<br/>                    plt.xticks(y_pos, bars)<br/>                elif graph == 'Line Chart':<br/>                    plt.plot(<br/>                        bars,<br/>                        height, <br/>                        color=color_picker.value,<br/>                        marker='o', <br/>                        linestyle='solid'<br/>                    )<br/>                    plt.xticks(bars)<br/>                plt.show()<br/>                <br/>def preview_clicked(b):<br/>    preview()</span><span id="88aa" class="lu kr hi mk b fi ms mp l mq mr">def upload_clicked(b):<br/>    upload()</span><span id="354c" class="lu kr hi mk b fi ms mp l mq mr">def desc_clicked(b):<br/>    desc()</span><span id="659a" class="lu kr hi mk b fi ms mp l mq mr">def plotter_clicked(b):<br/>    plot()<br/>    <br/>button_preview.on_click(preview_clicked)<br/>button_upload.on_click(upload_clicked)<br/>toggle.observe(desc_clicked, 'value')<br/>button_plot.on_click(plotter_clicked)</span></pre></div></div>    
</body>
</html>