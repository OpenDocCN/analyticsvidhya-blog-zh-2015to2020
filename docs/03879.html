<html>
<head>
<title>How to implement OTP based Authentication on Django-rest-framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Django-rest-framework上实现基于OTP的认证</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-implement-otp-based-authentication-on-django-rest-framework-185ae8032f07?source=collection_archive---------0-----------------------#2020-02-24">https://medium.com/analytics-vidhya/how-to-implement-otp-based-authentication-on-django-rest-framework-185ae8032f07?source=collection_archive---------0-----------------------#2020-02-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/714a038a20fb4230fb82710655b906e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sDHp0R3cYVgCNToYNE79Vg.jpeg"/></div></div></figure><p id="55fe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安全是计算机科学中永远不会消亡的领域之一。随着事情的发展，安全问题也日益增加。</p><p id="f9d6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，您可能会关心它，并且可能希望在您的项目中有某种安全认证。</p><p id="9302" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有不同种类的认证技术:</p><ol class=""><li id="f655" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated"><strong class="is hj">密码认证</strong></li><li id="db17" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated"><strong class="is hj">双因素认证(2FA) </strong></li><li id="6cb9" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated"><strong class="is hj">令牌认证</strong></li><li id="a65d" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated"><strong class="is hj">生物认证</strong></li></ol><p id="1935" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">等等。</p><blockquote class="kc kd ke"><p id="0bba" class="iq ir kf is b it iu iv iw ix iy iz ja kg jc jd je kh jg jh ji ki jk jl jm jn hb bi translated">参考:<a class="ae kj" href="https://www.solarwindsmsp.com/blog/network-authentication-methods" rel="noopener ugc nofollow" target="_blank">https://www . solarwindsmsp . com/blog/network-authentic ation-methods</a></p></blockquote><p id="1e24" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过OTP功能，我们可以在项目中实现<strong class="is hj"> 2FA </strong>。</p><h2 id="935f" class="kk kl hi bd km kn ko kp kq kr ks kt ku jb kv kw kx jf ky kz la jj lb lc ld le bi translated">那么我们为什么需要2FA呢？</h2><p id="ebf0" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">在密码认证中，我们需要密码来获得访问受限制内容的授权。因为这是一种直接的方式，如果黑客以任何方式通过登录进入服务器，那么你的数据可能会毫不费力地被窃取。为此，我们可以有一个中间步骤，当且仅当一次性密码正确时，我们才能验证用户。一次性密码可以通过任何方式发送，如电子邮件、手机等。</p><p id="1885" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们边做边学。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es lk"><img src="../Images/1d91f2e0f01c5a075133b1d803452086.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*fPjAjqwOlhY8XyCI2hYcjQ.png"/></div><figcaption class="lp lq et er es lr ls bd b be z dx translated">不，我会帮忙的</figcaption></figure><h1 id="685f" class="lt kl hi bd km lu lv lw kq lx ly lz ku ma mb mc kx md me mf la mg mh mi ld mj bi translated">OTP是如何工作的？</h1><p id="61a7" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">该流程图描述了该过程的流程。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es mk"><img src="../Images/f3694751e2e11af743753f97abe805ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:306/format:webp/1*SZDl-nh92H5zRYKaRphz9g.png"/></div><figcaption class="lp lq et er es lr ls bd b be z dx translated">流程图</figcaption></figure><ul class=""><li id="0682" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn ml ju jv jw bi translated">首先，客户通过提供的电话号码或电子邮件请求OTP代码。</li><li id="48d2" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn ml ju jv jw bi translated">则生成对该特定实例有效的密钥。</li><li id="2146" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn ml ju jv jw bi translated">OTP被创建并通过所提供的介质发送到客户端。</li><li id="789e" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn ml ju jv jw bi translated">用户在我们提供的门户上输入OTP代码。</li><li id="3b21" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn ml ju jv jw bi translated">之后，OTP由服务器验证。</li></ul></div><div class="ab cl mm mn gp mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="hb hc hd he hf"><h1 id="1376" class="lt kl hi bd km lu mt lw kq lx mu lz ku ma mv mc kx md mw mf la mg mx mi ld mj bi translated">在Django如何实现？</h1><p id="7e2a" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">我们可以使用名为<strong class="is hj"> PyOTP的python包/库通过OTP实现<strong class="is hj"> 2FA </strong>。</strong></p><p id="9f29" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> PyOTP </strong>提供了OTP创建和验证的所有功能。</p><p id="052d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Base64 </strong>将用于密钥生成。</p><p id="688a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在PyOTP中，我们必须定义用例的类型:</p><ol class=""><li id="e402" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">基于时间的OTP</li><li id="2ce2" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">基于计数器的OTP</li></ol><blockquote class="kc kd ke"><p id="e229" class="iq ir kf is b it iu iv iw ix iy iz ja kg jc jd je kh jg jh ji ki jk jl jm jn hb bi translated">参考:<a class="ae kj" href="https://pypi.org/project/pyotp/" rel="noopener ugc nofollow" target="_blank">https://pypi.org/project/pyotp/</a></p></blockquote><p id="f084" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这两种方法都不错，但是现在，我们将使用基于计数器的OTP。在基于计数器的OTP中，每个新的计数器编号都会生成一个新的6位数代码。</p><pre class="ll lm ln lo fd my mz na nb aw nc bi"><span id="713d" class="kk kl hi mz b fi nd ne l nf ng">hotp = pyotp.HOTP('base32secret3232')<br/>hotp.at(0) # =&gt; '260182'<br/>hotp.at(1) # =&gt; '055283'<br/>hotp.at(1401) # =&gt; '316439'</span></pre><blockquote class="kc kd ke"><p id="0ac1" class="iq ir kf is b it iu iv iw ix iy iz ja kg jc jd je kh jg jh ji ki jk jl jm jn hb bi translated"><strong class="is hj">整个项目参考</strong>:<a class="ae kj" href="https://github.com/Akash16s/OTP-in-django" rel="noopener ugc nofollow" target="_blank">https://github.com/Akash16s/OTP-in-django</a></p></blockquote><p id="2461" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以参考上面提供的GitHub repo的链接，因为在本教程中我不会教你Django rest框架。</p><blockquote class="kc kd ke"><p id="b152" class="iq ir kf is b it iu iv iw ix iy iz ja kg jc jd je kh jg jh ji ki jk jl jm jn hb bi translated">【https://www.youtube.com/watch?v=ejJ-2oz4AgI】几分钟学会Django-rest框架:<a class="ae kj" href="https://www.youtube.com/watch?v=ejJ-2oz4AgI" rel="noopener ugc nofollow" target="_blank">T5】</a></p></blockquote></div><div class="ab cl mm mn gp mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="hb hc hd he hf"><h2 id="3ece" class="kk kl hi bd km kn ko kp kq kr ks kt ku jb kv kw kx jf ky kz la jj lb lc ld le bi translated">文件结构</h2><pre class="ll lm ln lo fd my mz na nb aw nc bi"><span id="f3ae" class="kk kl hi mz b fi nd ne l nf ng">OTP<br/> ├── --init__.py<br/> ├── asgi.py<br/> ├── settings.py<br/> ├── urls.py<br/> └── wsgi.py<br/>verification<br/> ├── --init__.py<br/> ├── admin.py<br/> ├── apps.py<br/> ├── migrations<br/> ├── models.py<br/> ├── tests.py<br/> ├── urls.py<br/> └── views.py<br/>--manage.py</span></pre><p id="e220" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们从名为<strong class="is hj"> Verification的应用程序开始。</strong></p><h1 id="3175" class="lt kl hi bd km lu lv lw kq lx ly lz ku ma mb mc kx md me mf la mg mh mi ld mj bi translated">项目按以下方式配置。</h1><h2 id="a071" class="kk kl hi bd km kn ko kp kq kr ks kt ku jb kv kw kx jf ky kz la jj lb lc ld le bi translated">得到</h2><p id="7db2" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">这是将手机号码注册到数据库中并生成OTP。</p><p id="7b4d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du nh ni nj mz b">http://127.0.0.1:8000/verify/&lt;phone&gt;/</code></p><h2 id="0486" class="kk kl hi bd km kn ko kp kq kr ks kt ku jb kv kw kx jf ky kz la jj lb lc ld le bi translated">邮政</h2><p id="d5a5" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">这是使用OTP验证手机号码。</p><p id="ebc5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du nh ni nj mz b">http://127.0.0.1:8000/verify/&lt;phone&gt;/</code></p><h2 id="0442" class="kk kl hi bd km kn ko kp kq kr ks kt ku jb kv kw kx jf ky kz la jj lb lc ld le bi translated">JSON数据:</h2><pre class="ll lm ln lo fd my mz na nb aw nc bi"><span id="ed96" class="kk kl hi mz b fi nd ne l nf ng">{<br/>    "otp":040301<br/>}</span></pre><p id="f750" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们希望存储每次新注册的数据。所以我们的Django模型中有如下模型。</p><h2 id="82f4" class="kk kl hi bd km kn ko kp kq kr ks kt ku jb kv kw kx jf ky kz la jj lb lc ld le bi translated"><strong class="ak">型号:</strong></h2><pre class="ll lm ln lo fd my mz na nb aw nc bi"><span id="17b7" class="kk kl hi mz b fi nd ne l nf ng">class phoneModel(models.Model):<br/>    Mobile = models.IntegerField(blank=False)<br/>    isVerified = models.BooleanField(blank=False, default=False)<br/>    counter = models.IntegerField(default=0, blank=False)</span><span id="fab2" class="kk kl hi mz b fi nk ne l nf ng">def __str__(self):<br/>        return str(self.Mobile)</span></pre></div><div class="ab cl mm mn gp mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="hb hc hd he hf"><p id="8075" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在您已经准备好了服务器的框架，我们现在可以开始写下OTP的代码了。</p><p id="ffbe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在设计OTP功能时，我们必须确保上面提供的流程图应该满足。</p><h1 id="f118" class="lt kl hi bd km lu lv lw kq lx ly lz ku ma mb mc kx md me mf la mg mh mi ld mj bi translated">Get请求:</h1><p id="ec7c" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">我们不会深入到网络方面，我们只是将它用作与服务器通信的API。用户通过这个特定的GET请求来请求OTP。</p><p id="c899" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第一步:</strong>如果数据库中没有数据，则添加到数据库中，并为用户创建一个特定的模型对象。也更新计数器。</p><p id="cc1e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第二步:</strong>使用<strong class="is hj"> base64 </strong>库生成<strong class="is hj"> base32 </strong>的密钥。</p><p id="dfee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第三步:</strong>使用Key生成一个<strong class="is hj"> pyotp类的对象。</strong></p><p id="1e4e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤4: </strong>现在使用用户模型的<strong class="is hj">计数器</strong>和<strong class="is hj"> pyotp </strong>对象生成otp代码。</p><p id="0c54" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤5: </strong>使用邮件或消息服务将OTP代码发送给用户。</p><h1 id="c3b9" class="lt kl hi bd km lu lv lw kq lx ly lz ku ma mb mc kx md me mf la mg mh mi ld mj bi translated">帖子请求</h1><p id="da7b" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">我们不会深入到post request的网络方面，我们只是将它用作与服务器通信的API。用户尝试使用POST请求来验证OTP。</p><p id="dbad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤1: </strong>查找手机型号中存在电话号码。</p><p id="6e10" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第二步:</strong>使用<strong class="is hj"> base64 </strong>库生成<strong class="is hj"> base32 </strong>的密钥。</p><p id="d1c6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第三步:</strong>使用Key生成一个<strong class="is hj"> pyotp </strong>类的对象。</p><p id="9494" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第四步:</strong>现在使用用户发送的用户模型和OTP码的计数器，验证用户的真实性。</p><p id="5901" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第6步:</strong>现在发送用户授权令牌进行进一步授权。</p><h2 id="d22a" class="kk kl hi bd km kn ko kp kq kr ks kt ku jb kv kw kx jf ky kz la jj lb lc ld le bi translated">这是代码</h2><figure class="ll lm ln lo fd ij"><div class="bz dy l di"><div class="nl nm l"/></div></figure><p id="d1da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，您已经在Django-rest-framework项目中实现了OTP功能。</p><h1 id="8a0f" class="lt kl hi bd km lu lv lw kq lx ly lz ku ma mb mc kx md me mf la mg mh mi ld mj bi translated">恭喜你完成了代码。</h1><p id="3106" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">希望这个教程对你以后的项目有很大帮助。把这篇文章分享给你的同事和朋友。</p><p id="9c01" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">完整代码:</strong>【https://github.com/Akash16s/OTP-in-django】T2</p><h1 id="1931" class="lt kl hi bd km lu lv lw kq lx ly lz ku ma mb mc kx md me mf la mg mh mi ld mj bi translated">谢谢你陪我到最后。我目前正在开始写文章，所以，请在下面评论这篇文章，你的评论对我来说意义重大。</h1><p id="f38f" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">可以在<a class="ae kj" href="https://twitter.com/Akash16s" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">Twitter</strong></a><strong class="is hj"/><a class="ae kj" href="https://github.com/Akash16s?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">GitHub</strong></a><strong class="is hj"/><a class="ae kj" rel="noopener" href="/@akash16s?source=post_page---------------------------"><strong class="is hj">Medium</strong></a><strong class="is hj"/><a class="ae kj" href="https://www.linkedin.com/in/akash-srivastava-8b4527159/?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">LinkedIn</strong></a><strong class="is hj">上关注我。</strong></p><p id="e5bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">别忘了跟着<strong class="is hj"> </strong> <a class="ae kj" href="https://medium.com/camping-with-python?source=post_page---------------------------" rel="noopener"> <strong class="is hj">露营用python </strong> </a> <strong class="is hj">。</strong></p><p id="8ef5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你对本教程有任何疑问，或者有任何其他问题，或者你想提出一些建议，你可以在下面的<strong class="is hj">评论</strong>。</p><p id="5a74" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一篇文章很快就会出来，请继续练习。</p></div></div>    
</body>
</html>