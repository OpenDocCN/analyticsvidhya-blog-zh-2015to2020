<html>
<head>
<title>The Mechanics of Spam Email Detection Using Naive Bayes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用朴素贝叶斯的垃圾邮件检测机制</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/the-mechanics-of-spam-email-detection-using-naive-bayes-96c6b730d36e?source=collection_archive---------4-----------------------#2020-02-16">https://medium.com/analytics-vidhya/the-mechanics-of-spam-email-detection-using-naive-bayes-96c6b730d36e?source=collection_archive---------4-----------------------#2020-02-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c773b9efb6a68fd518060224d18d3b63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Yt-HeaSip7JJI9_w"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">由<a class="ae iu" href="https://unsplash.com/@yogasdesign?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Yogas设计</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="aec0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">垃圾邮件检测是自然语言处理中的一项常见任务，我们可以使用Python中的Scikit-learn轻松地建立模型并进行邮件过滤。但是，如果我们不使用Scikit-learn的魔力，垃圾邮件检测是如何工作的呢？让我们从头开始看看垃圾邮件检测是如何工作的。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jt"><img src="../Images/49c514de655d7e7ca545cde355f3311e.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*lxJ8T00lUeBh5YMGU6bAvA.png"/></div></figure><p id="5ecc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个例子是我从packtpub的免费机器学习书籍《Python机器学习示例》(作者Yuxi(Hayden) Liu)中找到的。我会尽可能简单地解释，因为我自己学习的时候觉得很难。</p><blockquote class="jy"><p id="c783" class="jz ka hi bd kb kc kd ke kf kg kh js dx translated">我们开始吧</p></blockquote><p id="34c9" class="pw-post-body-paragraph iv iw hi ix b iy ki ja jb jc kj je jf jg kk ji jj jk kl jm jn jo km jq jr js hb bi translated">给定如下四封电子邮件</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/4f975acc772cd3b80852629ec11004e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6atItKbW7unU7t2W_Rf82g.png"/></div></div></figure><p id="7824" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的任务是预测ID号为5的电子邮件的测试用例是否是垃圾邮件。</p><p id="9666" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我用我们的训练数据做一个单词包。什么是一袋单词？单词包的简单含义是描述单词在文档中出现的文本表示。</p><p id="fde9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是我们之前给出的电子邮件列表中的单词包</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/5bd3d271c5974368cdae6752dd793676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9LJxBD8Z2gHJ4jRINa4Lww.png"/></div></div></figure><p id="3c43" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们为电子邮件中出现的每一个单词加1，如果一个单词在电子邮件中没有出现，我们就加0。</p><p id="fe21" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从我们的单词包中，我们会得到训练数据中每个单词的概率。要获得一个单词的概率，我们可以通过将一个单词的总出现次数除以训练数据中所有单词的总出现次数来计算它。我们可以通过合计表中的<em class="kp">【total】</em>行(黄色行)来计算它，我们将得到13个单词的出现次数。</p><p id="41b8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">p(点击)= 3/13 = 0.231</p><p id="146a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">P(win) = 1/13 = 0.077</p><p id="77a6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">p(奖金)= 4/13 = 0.308</p><p id="0442" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">p(会议)= 2/13 = 0.154</p><p id="73da" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">p(设置)= 1/13 = 0.077</p><p id="6388" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">p(自由)= 2/13 = 0.154</p><p id="b123" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们将把我们的单词包分为垃圾单词包和非垃圾单词包</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kq"><img src="../Images/ae1c28f18f6190ca55f3cff2d6b2ccdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HMiyJfnlZ6pDRyt7ET5U0A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">罐头猪肉</figcaption></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/c5a77dd818e705ce520216e6ebdceb5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GzvnTZkZYL4JaJLyth5crw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">不是垃圾邮件</figcaption></figure><p id="7871" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以很容易地计算出每个单词出现在垃圾邮件和非垃圾邮件列表中的概率。</p><p id="7358" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">垃圾邮件类别中的总字数= 9</p><p id="6a20" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">非垃圾邮件(NS)类别中的总字数= 4</p><p id="c556" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们计算一个单词在垃圾邮件分类中的概率，我们会发现概率为零，这使得我们无法计算贝叶斯方程，因为乘法因子为零。为了消除零乘法因子，即看不见的项，我们将每个项频率设置为初始值1，因此</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/8900988684a16b948d5f85945076415b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SGsih1lQ6-G_XhcCO60crg.png"/></div></div></figure><p id="a441" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">其中6来自每个术语的一个额外计数(点击、赢取、奖励、会议、设置、免费)</p><p id="229a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以，我们可以计算出测试邮件是垃圾邮件的概率。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/95db279a152be6dfeb6f5ee6d12ca015.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_eJkPNVIlJikwmufGRukVQ.png"/></div></div></figure><p id="4ec4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">并且测试邮件不是垃圾邮件的概率</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/a4c5f9589f2a20baf1735b9c8ec1bfbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ap1dZuWI6T64wnwT1isb6Q.png"/></div></div></figure><p id="028e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">P(NS | free setup meeting free)&gt;P(S | free setup meeting free)</strong>这样我们就可以分类测试邮件是<strong class="ix hj">不是垃圾邮件。</strong>(在真实案例中并没有那么简单，但就目前而言，这已经足够了)</p></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><p id="9c02" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是Python 3语法，使用朴素贝叶斯从头开始进行简单的垃圾邮件检测。</p><p id="f4f9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，导入我们需要的库</p><pre class="ju jv jw jx fd lb lc ld le aw lf bi"><span id="bebd" class="lg lh hi lc b fi li lj l lk ll">import pandas as pd<br/>from collections import Counter</span></pre><p id="54f4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将电子邮件培训数据插入panda的数据框架。</p><pre class="ju jv jw jx fd lb lc ld le aw lf bi"><span id="00e8" class="lg lh hi lc b fi li lj l lk ll">data = {'email':  ['Click Win Prize', 'Click meeting setup meeting','Prize free prize','Click prize free'],<br/>        'is_spam': ['yes', 'no','yes','yes']<br/>        }<br/>data = pd.DataFrame(data)</span></pre><p id="c187" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">小写的电子邮件，在一个真实的情况下，我们可能需要词干和词汇化过程，但对于这个例子，我们不需要。</p><pre class="ju jv jw jx fd lb lc ld le aw lf bi"><span id="dda2" class="lg lh hi lc b fi li lj l lk ll">data["email"] = data["email"].apply(lambda str : str.lower())</span></pre><p id="3514" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的数据帧看起来会像这样</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es lm"><img src="../Images/af29346d517bd093f700403034f2c407.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*NlhestCtEv9IGFBA18SidQ.png"/></div></figure><p id="0bcf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">计算垃圾邮件和非垃圾邮件的概率</p><pre class="ju jv jw jx fd lb lc ld le aw lf bi"><span id="d6aa" class="lg lh hi lc b fi li lj l lk ll">sum_s = 0<br/>sum_ns = 0<br/>for i in data["is_spam"]:<br/>    if i == "yes":<br/>        sum_s += 1<br/>    else:<br/>        sum_ns += 1<br/>        <br/>prob_s = sum_s/len(data)<br/>prob_ns = sum_ns/len(data)</span></pre><p id="8a1d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">做一袋文字专栏</p><pre class="ju jv jw jx fd lb lc ld le aw lf bi"><span id="6434" class="lg lh hi lc b fi li lj l lk ll">data["bow"] = data["email"].str.split().apply(Counter)</span></pre><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es ln"><img src="../Images/08bd044cb4bf4071bd2a75a3d2c4976a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*lbQlWf1PpDkpDU7Nw_-YVA.png"/></div></figure><p id="5bfd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">计算某个单词在每个垃圾邮件和非垃圾邮件类别中的总出现次数</p><pre class="ju jv jw jx fd lb lc ld le aw lf bi"><span id="7a99" class="lg lh hi lc b fi li lj l lk ll">sum_bow_s = {}<br/>sum_bow_ns = {}</span><span id="3c75" class="lg lh hi lc b fi lo lj l lk ll">i=0<br/>for bow in data["bow"]:<br/>    for key in bow:<br/>        if data["is_spam"][i] == "yes":<br/>            if key in sum_bow_s:<br/>                sum_bow_s[key] += bow[key]<br/>            else:<br/>                sum_bow_s[key] = bow[key]<br/>        else:<br/>            if key in sum_bow_ns:<br/>                sum_bow_ns[key] +=bow[key]<br/>            else:<br/>                sum_bow_ns[key] = bow[key]<br/>    i += 1</span></pre><p id="d3b6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">计算垃圾邮件和非垃圾邮件类别中的单词/术语总数</p><pre class="ju jv jw jx fd lb lc ld le aw lf bi"><span id="ae2c" class="lg lh hi lc b fi li lj l lk ll">term_occurences_s = 0<br/>term_occurences_ns = 0<br/>for key in sum_bow_s:<br/>    term_occurences_s += sum_bow_s[key]<br/>for key in sum_bow_ns:    <br/>    term_occurences_ns += sum_bow_ns[key]</span></pre><p id="c607" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">计算训练数据中的唯一单词/术语</p><pre class="ju jv jw jx fd lb lc ld le aw lf bi"><span id="0728" class="lg lh hi lc b fi li lj l lk ll">temp = []<br/>unique_term = 0<br/>for bow in data["bow"]:<br/>    for key in bow:<br/>        if key not in temp:<br/>            unique_term += 1<br/>            temp.append(key)</span></pre><p id="0589" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">计算训练数据中每个单词的概率</p><pre class="ju jv jw jx fd lb lc ld le aw lf bi"><span id="9bea" class="lg lh hi lc b fi li lj l lk ll">sum_bow = {}<br/>term_occurences = 0<br/>for bow in data["bow"]:<br/>    for key in bow:<br/>        if key in sum_bow:<br/>            sum_bow[key] += bow[key]<br/>        else:<br/>            sum_bow[key] = bow[key]<br/>        term_occurences += bow[key]</span><span id="4325" class="lg lh hi lc b fi lo lj l lk ll">prob_bow = {}<br/>for key in sum_bow:<br/>    prob_bow[key] = sum_bow[key]/term_occurences</span></pre><p id="d21d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将训练数据中每个单词的概率存储在一个名为prob_bow的字典中</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es lp"><img src="../Images/f1361b47258a4186dab726d6634e7470.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*7Xxqn5QQQvJ6-C8RXT1Skg.png"/></div></figure><p id="31e8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，计算给定单词垃圾邮件或非垃圾邮件概率的语法</p><pre class="ju jv jw jx fd lb lc ld le aw lf bi"><span id="9f28" class="lg lh hi lc b fi li lj l lk ll">def split(words):<br/>    return words.split()</span><span id="a8b4" class="lg lh hi lc b fi lo lj l lk ll">def lower(words):<br/>    return words.lower()</span><span id="4874" class="lg lh hi lc b fi lo lj l lk ll">def probSpam(email):<br/>    email = split(lower(email))<br/>    likelihood = 1<br/>    evidence = 1<br/>    for term in email:<br/>        if term in sum_bow_s:<br/>            likelihood *= (sum_bow_s[term]+1)/(term_occurences_s+unique_term)<br/>        else:<br/>            likelihood *= 1/(term_occurences_s+unique_term)<br/>        evidence *= prob_bow[term]<br/>    likelihood_prior = likelihood*prob_s<br/>    posterior = likelihood_prior/evidence<br/>    return posterior</span><span id="c2a8" class="lg lh hi lc b fi lo lj l lk ll">def probNotSpam(email):<br/>    email = split(lower(email))<br/>    likelihood = 1<br/>    evidence = 1<br/>    for term in email:<br/>        if term in sum_bow_ns:<br/>            likelihood *= (sum_bow_ns[term]+1)/(term_occurences_ns+unique_term)<br/>        else:<br/>            likelihood *= 1/(term_occurences_ns+unique_term)<br/>        evidence *= prob_bow[term]<br/>    likelihood_prior = likelihood*prob_ns<br/>    posterior = likelihood_prior/evidence<br/>    return posterior<br/>    <br/>print(probSpam("Free setup meeting free"))<br/>print(probNotSpam("Free setup meeting free"))</span></pre><p id="d71d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们通过调用<strong class="ix hj"> probSpam </strong>函数计算给定单词垃圾的概率，通过调用<strong class="ix hj"> probNotSpam </strong>函数计算给定单词不是垃圾的概率。</p><p id="66eb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">结果是</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/3bccff10ae390711892309dd8eccc3c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:378/format:webp/1*kYbVX6wtRWIKmXFhzNXxVg.png"/></div></figure><p id="aa09" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">只是与我们的人工计数略有不同。</p><p id="e09a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以在这个GitLab链接上找到完整的代码</p><p id="1a29" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://gitlab.com/DeaVenditama/naivebayes" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/DeaVenditama/naivebayes</a>刮痕</p><p id="e4a3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本教程到此结束，请在下方留下您的反馈和建议！</p><p id="9289" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">谢谢你</p></div></div>    
</body>
</html>