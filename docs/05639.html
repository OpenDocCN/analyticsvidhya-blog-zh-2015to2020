<html>
<head>
<title>Predicting Rideshare fares using Machine Learning Algorithms</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用机器学习算法预测拼车费用</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/predicting-rideshare-fares-using-machine-learning-algorithms-ae9e8813a1d7?source=collection_archive---------25-----------------------#2020-04-27">https://medium.com/analytics-vidhya/predicting-rideshare-fares-using-machine-learning-algorithms-ae9e8813a1d7?source=collection_archive---------25-----------------------#2020-04-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2cca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用芝加哥的“交通网络提供商”数据和天气数据预测优步/Lyft/Via票价</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/deb65b33df5ca9667a372c51a82ca787.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1eKpyfs1kSeXlpRA.png"/></div></div></figure><p id="a2b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">芝加哥成为美国第一个发布优步、Lyft和Via等公司详细拼车数据的主要城市。该数据于2019年4月首次发布，涵盖了自2018年11月以来的旅行。涵盖出行、司机和车辆的数据集可以揭示乘客行为以及拼车公司的定价策略。</p><p id="662c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有几个关于乘客行为(<a class="ae jp" href="https://www.storybench.org/exploring-chicago-rideshare-data/" rel="noopener ugc nofollow" target="_blank"> Storybench-Chiago Rideshare数据</a>)以及定价(<a class="ae jp" href="https://www.reuters.com/article/us-uber-pricing-chicago/uber-drives-up-prices-for-shared-rides-chicago-data-reveals-idUSKBN1Y017V" rel="noopener ugc nofollow" target="_blank">路透社-优步司机涨价</a>)的故事。Storybench的研究发现，出行往往集中在清晨通勤时间和“夜生活”时间，路透社的研究发现，共享乘车价格的上涨主要影响芝加哥的低收入社区。在这些背景下，我试图建立机器学习模型来预测拼车票价。</p><h1 id="b822" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">行程数据</h1><p id="d9a1" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">行程数据包括每次行程的详细信息:开始时间、结束时间、持续时间、英里数、开始位置、结束位置等。更详细的数据描述以及数据来源可在此处找到:</p><div class="kt ku ez fb kv kw"><a href="https://data.cityofchicago.org/Transportation/Transportation-Network-Providers-Trips/m6dm-c72p" rel="noopener  ugc nofollow" target="_blank"><div class="kx ab dw"><div class="ky ab kz cl cj la"><h2 class="bd hj fi z dy lb ea eb lc ed ef hh bi translated">交通网络提供商— Trips |芝加哥市|数据门户</h2><div class="ld l"><h3 class="bd b fi z dy lb ea eb lc ed ef dx translated">编辑描述</h3></div><div class="le l"><p class="bd b fp z dy lb ea eb lc ed ef dx translated">data.cityofchicago.org</p></div></div><div class="lf l"><div class="lg l lh li lj lf lk jn kw"/></div></div></a></div><p id="486b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">芝加哥做的一些数据处理包括:在某些情况下人口普查区域被隐藏，时间被四舍五入到最接近的15分钟。车费四舍五入到最接近的2.50美元，小费四舍五入到最接近的1.00美元。建模数据是2019年12月拍摄的旅行，包含超过600万行。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ll"><img src="../Images/c22d1d520815e57366b00f2ae02102a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uuZI9lq3flWdDfY34nOUjQ.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/c1e1717e11528d1980766b363aa752ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Iog3B-sKslK1WmAQf1sI5Q.png"/></div></div></figure><h1 id="244a" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">气象资料</h1><p id="2e11" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">芝加哥2019年12月的天气数据，包括温度，降水，每小时能见度，每小时风向和每小时风速，都来自NOAA(国家环境信息中心)。为简单起见，所有芝加哥的数据都是从奥黑尔国际机场的一个站点收集的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ln"><img src="../Images/6f9543fc514320bd273f5be4f64a000f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ULjVWk6dif9X0VCnhMV7Lw.png"/></div></div></figure><h1 id="e0c6" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">数据争论</h1><p id="8bc5" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">由于天气数据间隔不规则，必须将数据重新采样为15分钟等间隔时间序列数据，以与行程数据相结合。下面是一个代码片段，它让数据等距分布。</p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="7b79" class="lt jr hi lp b fi lu lv l lw lx">#Resample Weather data to 15-min equally spaced data</span><span id="c05c" class="lt jr hi lp b fi ly lv l lw lx">weather['date'] = pd.to_datetime(weather['DATE'])<br/>weather =weather.set_index(pd.DatetimeIndex(weather['date']))<br/>weather =weather.resample('15min', loffset=pd.Timedelta('15min')).mean()</span></pre><p id="e343" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">填入缺失值后，天气数据如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lz"><img src="../Images/7152a9ac4d16d7b2c5789d372b8dde7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*ncWSrEkBRgmkgcEENCeRrg.png"/></div></figure><h1 id="a46a" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">特征</h1><p id="0f56" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">当乘客提出乘车请求时，他/她知道目的地，拼车公司用它来计算车费。此外，在提出请求时，天气状况是已知的，通常在开始旅行前10~15分钟。为了模拟已知条件，选择了以下特征-行程开始时间前15分钟的行程英里数和温度/降雨量/能见度/风速。我还包括了旅行的持续时间，这在提出请求时是一个未知的变量。然而，票价是预先确定的，不考虑旅行持续时间，因此包括该功能是为了测试预测能力。数字要素基于最小值-最大值进行了重新缩放，下面显示了要素的快照。建模数据被分成训练/测试(80/20)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ma"><img src="../Images/f04d0ab910e4fad67b3458140b37ab3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*bD2SffgQ6A4BuO-Wc3CovA.png"/></div></figure><h1 id="9178" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">模型</h1><p id="ab75" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">选择了三种流行的基于树的模型进行测试——随机森林、梯度增强和XG增强。下面提供了每个模型的简短描述及其设置的代码片段。</p><p id="66ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随机森林</p><p id="9651" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随机森林是决策树的集合。每个决策树都使用数据集的随机样本进行训练。然后，通过对树的预测进行平均，综合方法，对整个森林进行预测。</p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="e77d" class="lt jr hi lp b fi lu lv l lw lx">#Random Forest: initial set-up<br/>from sklearn.ensemble import RandomForestRegressor<br/>reg_rf= RandomForestRegressor(n_estimators=100,<br/>    random_state=1234,<br/>    max_depth=10,<br/>    min_samples_leaf=1,<br/>    verbose=2)</span></pre><p id="cb9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">梯度推进机器</p><p id="b12f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GBM是另一种基于决策树的集成方法。树被顺序地添加到模型中，并且每棵树都试图提高整体的性能。</p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="cd3c" class="lt jr hi lp b fi lu lv l lw lx">#GBM: initial set-up<br/>from sklearn.ensemble import GradientBoostingRegressor<br/>reg_gbm = GradientBoostingRegressor(<br/>                    random_state = 1234,<br/>                    verbose = 0,<br/>                    n_estimators = 100,<br/>                    learning_rate = 0.1,<br/>                    loss = 'ls',<br/>                    max_depth = 3)</span></pre><p id="e17c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">XGBoost</p><p id="eea4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">XGB是另一种基于决策树的集成方法，它使用梯度推进框架。XGBoost有大量的高级参数；因此，在使用XGB时，调整超参数以选择正确的配置非常重要。</p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="656c" class="lt jr hi lp b fi lu lv l lw lx">#xgb: initial set-up<br/>import xgboost as xgb<br/>reg_xgb = xgb.XGBRegressor(<br/>                    max_depth=3,<br/>                    learning_rate=0.2,<br/>                    gamma=0.0,<br/>                    min_child_weight=0.0,<br/>                    max_delta_step=0.0,<br/>                    subsample=1.0,<br/>                    colsample_bytree=1.0,<br/>                    colsample_bylevel=1.0,<br/>                    reg_alpha=0.0,<br/>                    reg_lambda=1.0,<br/>                    n_estimators=300,<br/>                    silent=0,<br/>                    nthread=4,<br/>                    scale_pos_weight=1.0,<br/>                    base_score=0.5,<br/>                    seed=1234,<br/>                    missing=None)</span></pre><h1 id="e53c" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">结果</h1><p id="52b9" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">所有这些基于树的模型都显示出高预测能力，从测试数据集获得的高于90%的R平方证明了这一点。毫不奇怪，最重要的变量是行程英里数，其次是行程秒数。从与天气相关的数据中找不到太多的意义。也许，这里使用的温度或降水数据没有经过转换，如降水量随时间的变化，导致这些特征的预测能力较低。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mb"><img src="../Images/8d7a681689b7d26b67fa07812e974435.png" data-original-src="https://miro.medium.com/v2/resize:fit:380/format:webp/1*sxrLh2Wcc84ardicQQK4bg.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mc"><img src="../Images/888cb001122336e2c56e58f8cb8450d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_gGLAisYIoL6dAt0qn9VLg.png"/></div></div></figure><p id="9ca5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当可视化来自随机森林模型的树时，可以看到行程英里是最重要的特征。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es md"><img src="../Images/e37ff34c9ae962d776e385db7d386918.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wMT-i2M4ZRr4M79PjIQZ0g.png"/></div></div></figure><h1 id="2920" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">结论</h1><p id="a35e" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">在这里，基于树的机器学习模型被尝试和比较，以查看它们对森林拼车费用的预测能力。虽然所有这些模型都显示了很高的预测能力，但通过转换与天气相关的变量和可能更精确的位置信息，可以获得进一步的改进。</p></div></div>    
</body>
</html>