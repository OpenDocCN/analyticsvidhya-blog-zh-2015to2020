<html>
<head>
<title>How to Make Mask Detection AI Using Python in 6 Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 6 个步骤用 Python 制作掩膜检测 AI</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-make-mask-detection-ai-using-python-in-6-steps-157696e84871?source=collection_archive---------5-----------------------#2020-12-09">https://medium.com/analytics-vidhya/how-to-make-mask-detection-ai-using-python-in-6-steps-157696e84871?source=collection_archive---------5-----------------------#2020-12-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="57ca" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">使用 keras 一步一步创建面具检测人工智能的综合指南</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/5b882649270a2c1c07cbad54db24f8b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NDBejxrWkdKC6QC8"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><a class="ae jn" href="https://unsplash.com/@lunarts?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">沃洛德梅尔·赫里先科</a>在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="35f0" class="jv jw hi bd jx jy jz ka kb kc kd ke kf io kg ip kh ir ki is kj iu kk iv kl km bi translated">抽象</h1><p id="52f8" class="pw-post-body-paragraph kn ko hi kp b kq kr ij ks kt ku im kv kw kx ky kz la lb lc ld le lf lg lh li hb bi translated">在这篇文章中，我想分享我制作面具检测应用程序的经验。我创建卷积神经网络使用 Keras，Python。这个项目的目的是对面部照片进行分类，这里我们将数据分为两类，这样我们就可以回答下面的问题。</p><blockquote class="lj"><p id="a040" class="lk ll hi bd lm ln lo lp lq lr ls li dx translated">那个人到底有没有戴面具？</p></blockquote><p id="8430" class="pw-post-body-paragraph kn ko hi kp b kq lt ij ks kt lu im kv kw lv ky kz la lw lc ld le lx lg lh li hb bi translated">我以前甚至没有想过这个想法，这个想法只是在我的脑海中闪过。我觉得这很酷，所以我很快就写完了。也许这就是爱因斯坦所说的证明。</p><blockquote class="lj"><p id="0f60" class="lk ll hi bd lm ln lo lp lq lr ls li dx translated">“想象力比知识更重要”</p></blockquote><figure class="lz ma mb mc md jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ly"><img src="../Images/0fd646c8b148f50c116b885c07c12d2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fXhKqfSJNpJykx05"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">照片由<a class="ae jn" href="https://unsplash.com/@moyse?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Taton moise</a>在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="5bb1" class="jv jw hi bd jx jy jz ka kb kc kd ke kf io kg ip kh ir ki is kj iu kk iv kl km bi translated">项目工作流程</h1><h2 id="c177" class="me jw hi bd jx mf mg mh kb mi mj mk kf kw ml mm kh la mn mo kj le mp mq kl mr bi translated"><strong class="ak">第一步:数据收集</strong></h2><p id="3cce" class="pw-post-body-paragraph kn ko hi kp b kq kr ij ks kt ku im kv kw kx ky kz la lb lc ld le lf lg lh li hb bi translated">你可以在 Kaggle 网站上轻松找到数据集。我在找理想的数据集(下载大小不要太大也不要太小)。我最终决定使用下面的数据集。</p><div class="ms mt ez fb mu mv"><a href="https://www.kaggle.com/omkargurav/face-mask-dataset" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab dw"><div class="mx ab my cl cj mz"><h2 class="bd hj fi z dy na ea eb nb ed ef hh bi translated">面罩检测数据集</h2><div class="nc l"><h3 class="bd b fi z dy na ea eb nb ed ef dx translated">面罩检测数据集 7553 幅图像</h3></div><div class="nd l"><p class="bd b fp z dy na ea eb nb ed ef dx translated">www.kaggle.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj jh mv"/></div></div></a></div><p id="b279" class="pw-post-body-paragraph kn ko hi kp b kq nk ij ks kt nl im kv kw nm ky kz la nn lc ld le no lg lh li hb bi translated">数据集大小为 160 MB，包含 7553 张具有 3 通道 jpg 扩展(RGB)的照片。该数据集由 3725 张带面具的人脸照片和 3828 张不同照片大小的不带面具的人脸照片组成。您可以搜索大型数据集，并使用迁移学习来建立更精确的模型。</p><h2 id="c96c" class="me jw hi bd jx mf mg mh kb mi mj mk kf kw ml mm kh la mn mo kj le mp mq kl mr bi translated">步骤 2:准备好环境</h2><p id="bea7" class="pw-post-body-paragraph kn ko hi kp b kq kr ij ks kt ku im kv kw kx ky kz la lb lc ld le lf lg lh li hb bi translated">首先，您需要下载数据集并提取 zip 文件。重构目录，使其看起来像这样。</p><pre class="iy iz ja jb fd np nq nr ns aw nt bi"><span id="5965" class="me jw hi nq b fi nu nv l nw nx">dataset<br/>    ├── train <br/>    │   ├── with_mask<br/>    │   └── without_mask<br/>    └── valid<br/>        ├── with_mask<br/>        └── without_mask</span></pre><p id="e532" class="pw-post-body-paragraph kn ko hi kp b kq nk ij ks kt nl im kv kw nm ky kz la nn lc ld le no lg lh li hb bi translated">接下来，我们需要导入所有需要的库。定义<code class="du ny nz oa nq b">loading_data()</code>函数来遍历目录，将目录中的所有文件放入 python 列表中。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ob oc l"/></div></figure><h2 id="70f1" class="me jw hi bd jx mf mg mh kb mi mj mk kf kw ml mm kh la mn mo kj le mp mq kl mr bi translated"><strong class="ak">第三步:数据预处理</strong></h2><p id="2632" class="pw-post-body-paragraph kn ko hi kp b kq kr ij ks kt ku im kv kw kx ky kz la lb lc ld le lf lg lh li hb bi translated">这里我不使用 Keras <code class="du ny nz oa nq b">flow_from_directory </code>加载数据集，而是使用 Tensorflow input output <code class="du ny nz oa nq b">tf.io.read_file(path) </code>，因为我想在训练模型之前创建一批数据，这样训练过程可以运行得更快。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ob oc l"/></div></figure><p id="663b" class="pw-post-body-paragraph kn ko hi kp b kq nk ij ks kt nl im kv kw nm ky kz la nn lc ld le no lg lh li hb bi translated">在预处理过程中，您可以使用图像增强技术来改变数据，以便通过翻转、旋转、裁剪、缩放和移动图像位置来提高模型性能并避免过度拟合。</p><h2 id="632e" class="me jw hi bd jx mf mg mh kb mi mj mk kf kw ml mm kh la mn mo kj le mp mq kl mr bi translated">步骤 4:构建神经网络</h2><p id="6677" class="pw-post-body-paragraph kn ko hi kp b kq kr ij ks kt ku im kv kw kx ky kz la lb lc ld le lf lg lh li hb bi translated">我用 Keras 创建了一个卷积神经网络(CNN)。这里，我使用 Softmax 激活的密集第 2 层单元作为输出节点，因为我想要 2 个阵列输出，以便更容易接收预测的信息。因为，我也试过用 1 个单位的致密层进行 Sigmoid 激活，结果并不显著。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ob oc l"/></div></figure><p id="f242" class="pw-post-body-paragraph kn ko hi kp b kq nk ij ks kt nl im kv kw nm ky kz la nn lc ld le no lg lh li hb bi translated">使用<code class="du ny nz oa nq b">model.summary()</code>函数获取模型摘要。</p><pre class="iy iz ja jb fd np nq nr ns aw nt bi"><span id="7a51" class="me jw hi nq b fi nu nv l nw nx">Model: "Mask Detector"<br/>_________________________________________________________________<br/>Layer (type)                 Output Shape              Param #   <br/>=================================================================<br/>conv2d_18 (Conv2D)           (None, 222, 222, 32)      896       <br/>_________________________________________________________________<br/>max_pooling2d_18 (MaxPooling (None, 111, 111, 32)      0         <br/>_________________________________________________________________<br/>conv2d_19 (Conv2D)           (None, 109, 109, 64)      18496     <br/>_________________________________________________________________<br/>max_pooling2d_19 (MaxPooling (None, 54, 54, 64)        0         <br/>_________________________________________________________________<br/>conv2d_20 (Conv2D)           (None, 52, 52, 128)       73856     <br/>_________________________________________________________________<br/>max_pooling2d_20 (MaxPooling (None, 26, 26, 128)       0         <br/>_________________________________________________________________<br/>flatten_6 (Flatten)          (None, 86528)             0         <br/>_________________________________________________________________<br/>dense_12 (Dense)             (None, 128)               11075712  <br/>_________________________________________________________________<br/>activation_6 (Activation)    (None, 128)               0         <br/>_________________________________________________________________<br/>dense_13 (Dense)             (None, 2)                 258       <br/>_________________________________________________________________<br/>activation_7 (Activation)    (None, 2)                 0         <br/>=================================================================<br/>Total params: 11,169,218<br/>Trainable params: 11,169,218<br/>Non-trainable params: 0</span></pre><h2 id="a716" class="me jw hi bd jx mf mg mh kb mi mj mk kf kw ml mm kh la mn mo kj le mp mq kl mr bi translated">第五步:培训模式</h2><p id="28d3" class="pw-post-body-paragraph kn ko hi kp b kq kr ij ks kt ku im kv kw kx ky kz la lb lc ld le lf lg lh li hb bi translated">训练过程仅运行 5 个时期。我还使用早期停止，这样如果模型在 3 个 epcohs 内没有改善，训练过程可以自动停止。这也用于避免过度拟合。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ob oc l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es od"><img src="../Images/509e307aacf5f2a43c6b95832aceeab8.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*_H6-us9kR_UrGjjCeki0gQ.jpeg"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">5 个时期的训练过程图</figcaption></figure><h2 id="36ce" class="me jw hi bd jx mf mg mh kb mi mj mk kf kw ml mm kh la mn mo kj le mp mq kl mr bi translated">第六步:演示</h2><p id="30f2" class="pw-post-body-paragraph kn ko hi kp b kq kr ij ks kt ku im kv kw kx ky kz la lb lc ld le lf lg lh li hb bi translated">我用 4 张模特从未见过的照片做了一个演示。这个结果让我很惊讶，因为这个模型可以用很大的概率值正确地预测一切。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ob oc l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es od"><img src="../Images/08db204cb76302e0e1d56ad37e31abaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*77yUBxHjk3bn9URBxvN-TA.jpeg"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">神经网络预测人们不戴口罩</figcaption></figure><p id="df37" class="pw-post-body-paragraph kn ko hi kp b kq nk ij ks kt nl im kv kw nm ky kz la nn lc ld le no lg lh li hb bi translated">我使用<code class="du ny nz oa nq b">model.save('output/face_mask_ai.h5')</code>将模型保存到 h5 文件中，然后使用 opencv 库创建了一个 python 脚本。之后我尝试用这个模型通过视频进行预测。我使用视频的唯一原因是，如果使用摄像头实时完成，我的计算机太弱了。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ob oc l"/></div></figure></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="554f" class="jv jw hi bd jx jy jz ka kb kc kd ke kf io kg ip kh ir ki is kj iu kk iv kl km bi translated">解决</h1><p id="b405" class="pw-post-body-paragraph kn ko hi kp b kq kr ij ks kt ku im kv kw kx ky kz la lb lc ld le lf lg lh li hb bi translated">您可以在部署过程中继续这个项目，并将其创建为一个 API，以便在其他项目中使用。对于一个令人满意的投资组合，也许您可以在移动设备上创建一个口罩相机应用程序来实时检测口罩佩戴情况。应用程序应该使用 API 在线运行，这样就不会消耗智能手机的资源。</p><p id="b2df" class="pw-post-body-paragraph kn ko hi kp b kq nk ij ks kt nl im kv kw nm ky kz la nn lc ld le no lg lh li hb bi translated">如果你想要这个项目的完整代码，你可以检查我的 Github 库【https://github.com/PhilipPurwoko/Face-Mask-Detection T2】</p><blockquote class="lj"><p id="b02b" class="lk ll hi bd lm ln lo lp lq lr ls li dx translated">享受学习！</p></blockquote></div></div>    
</body>
</html>