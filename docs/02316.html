<html>
<head>
<title>How to Import Weather Data into Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将天气数据导入Python</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-import-weather-data-into-python-scripts-7e9ff54f6aca?source=collection_archive---------1-----------------------#2019-12-11">https://medium.com/analytics-vidhya/how-to-import-weather-data-into-python-scripts-7e9ff54f6aca?source=collection_archive---------1-----------------------#2019-12-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/841cde185625745e9f122dee27f45c32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MRIs7yqXi0wYUQiTAfzFMg.png"/></div></div></figure><div class=""/><p id="d53f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我们将使用基于云的天气API将天气数据导入到一个<a class="ae jo" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a>应用程序中。这些技术可用于扩展许多需要包含天气预报数据或历史天气观测数据的Python脚本和应用程序。</p><h1 id="7c54" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">为什么包括天气数据？</h1><p id="e905" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">天气数据成为Python应用程序的一个重要特性的原因有很多。</p><p id="8d9b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们看到的天气预报数据最常见的应用之一是帮助规划事件或业务流程。例如，在零售业中，天气预报数据可用于计划受天气影响的产品的库存，如温暖或寒冷天气服装或在恶劣天气情况下与天气紧急情况相关的物品。</p><p id="6eae" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">保险公司将使用天气预报数据来为即将到来的天气事件制定计划。建筑公司可以通过了解天气预报来计划温度和天气关键活动，如混凝土浇筑。</p><p id="b674" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">历史天气观测数据有助于企业和个人了解过去特定日子里发生的事情。这可用于关联业务指标，以回答诸如“下雨会影响我的销售吗”之类的问题。用Python对天气数据进行统计分析是非常有价值的。</p><p id="3e60" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">历史天气摘要描述了一年中某个时间某个地点通常经历的总体天气状况。除了“正常”天气条件，这些总结也描述了极端天气。例如，您可以了解一月份某个特定地点的正常最高和最低温度。你也可以很容易地确定最高和最低温度。</p><h1 id="4d00" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">为什么要用Python？</h1><p id="d113" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">Python使得以编程方式使用天气数据变得很容易，因此您可以快速、重复、跨多个位置和时间段执行上述分析。</p><h1 id="4263" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">创建一个简单的python脚本来导入天气数据</h1><p id="bf6d" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">在Python中，从天气API导入数据非常简单。在这个例子中，我们将使用围绕他们的<a class="ae jo" href="https://www.visualcrossing.com/weather-data" rel="noopener ugc nofollow" target="_blank">天气数据</a>产品构建的<a class="ae jo" href="https://www.visualcrossing.com/weather-api" rel="noopener ugc nofollow" target="_blank">可视交叉天气API </a>。其他天气API已经存在，请选择最符合您需求的一个。</p><p id="6ae2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">第一步——为你选择的天气API注册一个账户</strong></p><p id="c557" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">大多数天气API都需要一个帐户。如果你跟随我们的样本，你可以在这里创建一个账户<a class="ae jo" href="https://www.visualcrossing.com/weather-api" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="97f7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">步骤2 —构建一个天气数据查询。</strong></p><p id="0357" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们使用的API使用restful APIs来返回逗号分隔值(CSV)或基于JSON的结构。为了简单起见，我们将使用CSV格式。CSV是一种非常简单的结构，使用逗号作为值分隔符来描述数据表。</p><p id="1807" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">API有许多针对不同天气类型的端点。</p><p id="ed52" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于天气预报，一个示例URL是:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="73fd" class="lb jq ht kx b fi lc ld l le lf"><a class="ae jo" href="http://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/weatherdata/" rel="noopener ugc nofollow" target="_blank">https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/weatherdata/</a>forecast?location=Herndon,VA&amp;aggregateHours=24&amp;unitGroup=us&amp;key=APIKEY</span></pre><p id="efee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于历史天气数据，简单的API结构是:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="fbd3" class="lb jq ht kx b fi lc ld l le lf"><a class="ae jo" href="https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/weatherdata/history?goal=history&amp;aggregateHours=24&amp;startDateTime=2019-12-04T00%3A00%3A00&amp;endDateTime=2019-12-11T00%3A00%3A00&amp;collectStationContributions=false&amp;maxStations=-1&amp;maxDistance=-1&amp;includeNormals=false&amp;shortColumnNames=false&amp;sendAsDatasource=false&amp;allowAsynch=false&amp;contentType=csv&amp;unitGroup=us&amp;key=X2KW264AEYIX7DF30FB18RTBL&amp;locations=Herndon%2CVA" rel="noopener ugc nofollow" target="_blank">https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/weatherdata/history?goal=history&amp;aggregateHours=24&amp;startDateTime=2019-12-04T00:00:00&amp;endDateTime=2019-12-11T00:00:00&amp;contentType=csv&amp;unitGroup=us&amp;locations=Herndon,VA</a>&amp;key=APIKEY</span></pre><p id="4b26" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这两个函数都返回CSV，我们可以在python脚本中直接导入和处理它。</p><p id="55e1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以将它们直接提交到浏览器窗口中来查看输出(记得用您自己的值替换‘API key’参数！)</p><p id="8b32" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">步骤3——编写一个python脚本</strong></p><p id="98a5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用几个库来帮助下载和处理Python中的天气数据</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="6acd" class="lb jq ht kx b fi lc ld l le lf">import csv //to process the CSV data<br/>import codecs //to download and decode the information<br/>import urllib.request //to request data from a URL<br/>import sys</span></pre><p id="e954" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">脚本的下一部分基于查询类型和位置请求构造天气API查询。天气API支持更多可以添加的参数，但我们会保持简单。</p><p id="c30c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先我们构造定义URL的根:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="f7b0" class="lb jq ht kx b fi lc ld l le lf">BaseURL = ‘http://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/weatherdata/'</span></pre><p id="182e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后我们添加公共参数，包括位置和API键。注意，我们使用Python脚本的输入参数来允许用户指定位置和键。这些值包含在sys.argv数组中。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="0067" class="lb jq ht kx b fi lc ld l le lf">DateParam = sys.argv[2].upper() </span><span id="4c65" class="lb jq ht kx b fi lg ld l le lf"># Set up the location parameter for our query<br/>QueryLocation = ‘&amp;location=’ + urllib.parse.quote(sys.argv[1]) </span><span id="4240" class="lb jq ht kx b fi lg ld l le lf"># Set up the key parameter for our query<br/>QueryKey = ‘&amp;key=’ + sys.argv[3]</span></pre><p id="9f40" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">查询的下一部分特定于类型—天气预报和历史天气数据。对于天气预报，我们只需要预报的时间段。aggregationHours=24相当于一天—我们可以通过将该值更改为1来检索每小时的预测。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="33a7" class="lb jq ht kx b fi lc ld l le lf"># Set up the specific parameters based on the type of queryif DateParam == ‘FORECAST’: <br/> print(‘ — Fetching forecast data’) <br/> QueryTypeParams = ‘forecast<br/>        &amp;aggregateHours=24&amp;unitGroup=us&amp;shortColumnNames=false’<br/>else: <br/> print(‘ — Fetching history for date: ‘, DateParam) </span><span id="a3d5" class="lb jq ht kx b fi lg ld l le lf"> # History requests require a date. We use the same date for start<br/>   and end since we only want to query a single date in this example<br/> QueryDate = ‘&amp;startDateTime=’ + DateParam +<br/>        ‘T00:00:00&amp;endDateTime=’  + sys.argv[2] + ‘T00:00:00’ </span><span id="80ac" class="lb jq ht kx b fi lg ld l le lf"> QueryTypeParams = ‘history<br/>        &amp;aggregateHours=24&amp;unitGroup=us&amp;dayStartTime=0:0:00<br/>        &amp;dayEndTime=0:0:00’ + QueryDate</span></pre><p id="e021" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们从所有部分构建完整的查询:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="246d" class="lb jq ht kx b fi lc ld l le lf"># Build the entire query<br/>URL = BaseURL + QueryTypeParams + QueryLocation + QueryKey</span></pre><p id="d7a0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在准备提交查询。这可以通过我们在开始时导入的三行库来实现:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="51a6" class="lb jq ht kx b fi lc ld l le lf"># Parse the results as CSV<br/>CSVBytes = urllib.request.urlopen(URL)<br/>CSVText = csv.reader(codecs.iterdecode(CSVBytes, ‘utf-8’))</span></pre><p id="a51c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这会请求数据，然后将结果解析为CSV。CSVText实例帮助我们轻松提取数据。</p><p id="254a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我们可以使用数据。在我们的简单示例中，我们将输出显示为一个简单的表输出:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="db7b" class="lb jq ht kx b fi lc ld l le lf">for Row in CSVText:<br/>  if RowIndex == 0:<br/>    FirstRow = Row<br/>  else:<br/>    print(‘Weather in ‘, Row[0], ‘ on ‘, Row[1])<br/>    ColIndex = 0<br/>    for Col in Row:<br/>      if ColIndex &gt;= 4:<br/>        print(‘ ‘, FirstRow[ColIndex], ‘ = ‘, Row[ColIndex])<br/>      ColIndex += 1<br/>    RowIndex += 1</span></pre><p id="8b35" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以在这里找到《T2》的完整代码。</p><h1 id="be9a" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">后续步骤</h1><p id="6cfc" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">上面的简单代码示例显示了从天气API中检索天气并将其集成到Python应用程序中是多么容易。从这一点来看，将天气预报集成到规划应用程序中或者使用历史数据进行统计分析是很简单的。</p><h2 id="0a3f" class="lb jq ht bd jr lh li lj jv lk ll lm jz jb ln lo kd jf lp lq kh jj lr ls kl lt bi translated">有问题吗？请在下面告诉我！</h2></div></div>    
</body>
</html>