<html>
<head>
<title>Using Convolutional Neural Networks in Tensorflow to Analyse Chest XRays</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Tensorflow中的卷积神经网络分析胸部x光片</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/using-convolutional-neural-networks-in-tensorflow-to-analyse-chest-xrays-635c59c0e567?source=collection_archive---------13-----------------------#2020-10-26">https://medium.com/analytics-vidhya/using-convolutional-neural-networks-in-tensorflow-to-analyse-chest-xrays-635c59c0e567?source=collection_archive---------13-----------------------#2020-10-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="985e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇短文中，我们将展示TensorFlow如何通过深度神经网络轻松地对图像数据进行分类。我们将使用Kaggle上提供的<a class="ae jd" href="https://www.kaggle.com/paultimothymooney/chest-xray-pneumonia" rel="noopener ugc nofollow" target="_blank">胸部x光</a>图像数据集展示该方法。因为这是一个基于图像的数据集，我们将利用<em class="je">卷积神经网络</em>，以及<em class="je">最大池</em>来获得我们的预测。</p><p id="ff35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这将作为一个指南，任何人都可以遵循，并尝试自己适应这个模型。内部模型层可以很容易地改变(添加或删除层，添加辍学，等等)。</p><h1 id="5470" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">胸部x光数据集:</h1><p id="2ef8" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">胸部x射线数据集由成千上万张拍摄的x射线图像组成。图像分为健康(正常)或不健康(肺炎)两类。数据集很大，包含。jpeg文件，因此它保存在zip文件中。我们使用<em class="je"> zipfile </em>包来解压缩数据，并创建各自的训练和验证目录。</p><h1 id="1be2" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">载入图像:</h1><p id="7034" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">下载完图像后，将工作目录设置为保存图像的位置。</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="kn ko l"/></div></figure><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es kp"><img src="../Images/b30f955e66ccd96c97e49099c2ff80a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/1*9ScV54DlO2xiNy56NrEKKw.png"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">图1:取自我的python代码的图像样本。此图像显示了16个图像的样本。第一个上半部分(8张图片)是健康的，第二个上半部分有肺炎。</figcaption></figure><p id="cf7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用常规卷积神经网络(CNN)来训练该模型，只有3个卷积和最大池，以及单个丢弃层。我们还为我们的内层使用了<a class="ae jd" href="https://en.wikipedia.org/wiki/Rectifier_(neural_networks)" rel="noopener ugc nofollow" target="_blank"> <em class="je"> relu </em> </a>激活函数。</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="kn ko l"/></div></figure><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kw"><img src="../Images/c5dff9ea04c0593918b40290f0d64f21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YlqLaq_7r6oOSZegcd3Eog.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">以灰度标绘的四个健康肺的样本。</figcaption></figure><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lb"><img src="../Images/c2e7a78902872afe01c7e09908671978.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4XhyJUywmKxu6YCCwscTIQ.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">图2:用灰度标绘的四个患病肺的样本。</figcaption></figure><h1 id="343a" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">定义我们的张量流模型:</h1><p id="b4e3" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">我们使用四个卷积层，每个卷积层后面都有一个最大池层。我们将每个卷积层中的滤波器数量增加一倍。我们在最终的relu激活后设置了一个0.3的丢弃层。这将增加验证的准确性(通过帮助防止过度拟合)。</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="kn ko l"/></div></figure><p id="bfcc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还可以查看我们模型的摘要:</p><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es lc"><img src="../Images/e16b383b49c5ba8375ed76e5b5a47348.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*I6VZNmWjEO_82_Lylg9oWQ.png"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">图3:我们的模型总结。我们有几个卷积层，最大池和一个下降层。</figcaption></figure><h1 id="ae63" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">图像增强:</h1><p id="7fb9" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">每个x射线图像大约是180像素乘180像素，因此我们的input_shape将被设置为(180，180，3)。3是三种颜色(RGB)的尺寸。我们将使用<em class="je"> ImageDataGenerator </em>来帮助创建额外的增强图像。我们将ImageDataGenerator的“填充模型”参数设置为“最近的”(以填充图像的任何缺失部分)。我们用255来缩放每个像素的亮度。</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="kn ko l"/></div></figure><h1 id="8d26" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">编译并拟合模型:</h1><p id="94d3" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">我们使用RMSprop优化器来执行梯度下降，学习率为0.0001，这确保我们采取小步骤。</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="kn ko l"/></div></figure><p id="b467" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在符合模型。我们指定25个历元，并让TensorFlow决定其他参数，如<em class="je">步数_每历元</em>和<em class="je">验证_步数</em>。</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="kn ko l"/></div></figure><h1 id="c4a2" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">可视化内层:</h1><p id="5cbd" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">TensorFlow的一大特点是我们可以轻松访问网络的内层。首先，让我们看看我们的模型拟合进行得如何。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es ld"><img src="../Images/4fd497cda3368a4279912cb1dcfce447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9bCYUI70a5EXGHX5p3sRig.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">图4:我们模型拟合的最后几个时期的总结。每个时期大约需要2.5分钟。</figcaption></figure><p id="a0fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个历元花费2.5分钟多一点，训练和验证的准确性都有所提高。我们的损失似乎趋于平稳，所以25个纪元可能足够了。</p><p id="a8c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还可以看到内层是什么样子的。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es le"><img src="../Images/a023ef4cd8109a0cf2e0b759ab45e98a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sOyzS-PS1ILYiaCYz9T5fw.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">图5:卷积层内部。这些层有助于提取图像的边缘和对比度。</figcaption></figure><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es le"><img src="../Images/7791be2557ad0d80966fa0217ae5d47a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TL4pYkEtChUUqByU7E4cFw.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">图6:最大池层内部。最大池平均化并简化了整个图像。这使得我们更容易识别尺寸减小的特征</figcaption></figure><h1 id="18a2" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">绘图精度和损失:</h1><p id="78d3" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">最后，我们可以检查每个历元的精度和损耗图。</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="kn ko l"/></div></figure><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es lf"><img src="../Images/2fbe8fcc314e33c1ba99f18922c2e87b.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*ZP-cpaQMOSOs6h3RVbY9eg.png"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">图7:我们的训练和验证准确性。两者都上升并稳定在90%左右</figcaption></figure><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es lg"><img src="../Images/e95849dadef058797d0e61c58cdf9cba.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*3Lyemf5Jz2c_AGVYhAnicA.png"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">图8:我们的培训和验证损失。</figcaption></figure><p id="a3e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样！我们已经训练了一个模型，该模型可以正确地对肺部状况进行分类，在测试集上的准确率超过90%，在训练集上的准确率超过94%。</p><h1 id="669b" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">总结:</h1><ul class=""><li id="2f76" class="lh li hi ih b ii kd im ke iq lj iu lk iy ll jc lm ln lo lp bi translated">在TensorFlow中使用CNN拟合一个简单的分类模型很简单。</li><li id="0539" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">ImageGenerator可以用来扩充图像，增加我们的训练集。</li><li id="9507" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">过度拟合可以通过增加压差来补救。</li></ul><p id="bd7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">感谢阅读！</strong></p><p id="fe5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">带有代码的Github:</p><p id="27b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://github.com/Robby955/ChestXray" rel="noopener ugc nofollow" target="_blank">https://github.com/Robby955/ChestXray</a></p></div></div>    
</body>
</html>