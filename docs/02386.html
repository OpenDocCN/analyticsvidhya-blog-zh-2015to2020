<html>
<head>
<title>FaceApi: Rest Api to detect face(s) in image using dlib, openCV &amp; Flask.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">FaceApi: Rest Api使用dlib、openCV和Flask来检测图像中的人脸。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/faceapi-rest-api-to-detect-face-s-in-image-using-dlib-openvc-flask-8a6cdfb0571f?source=collection_archive---------9-----------------------#2019-12-14">https://medium.com/analytics-vidhya/faceapi-rest-api-to-detect-face-s-in-image-using-dlib-openvc-flask-8a6cdfb0571f?source=collection_archive---------9-----------------------#2019-12-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/dd388bbae47cc01a76b3fd01a49be5bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*EId3AHcg-hfBHXUAwsAlvw.jpeg"/></div><figcaption class="im in et er es io ip bd b be z dx translated">[ <a class="ae iq" href="https://i0.wp.com/krazytech.com/wp-content/uploads/Face-detection-and-recognition-e1462652980288.jpg?w=600&amp;ssl=1" rel="noopener ugc nofollow" target="_blank">图像来源] </a></figcaption></figure><p id="838a" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">首先使用软件包管理器[ <a class="ae iq" href="https://pip.pypa.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> pip </a>安装基础软件包。</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="ba10" class="jy jz hi ju b fi ka kb l kc kd">pip install pipenv</span></pre><p id="2ecd" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">创建文件夹FaceApi</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="f028" class="jy jz hi ju b fi ka kb l kc kd">mkdir FaceApi &amp;&amp; cd FaceApi</span></pre><p id="03fc" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">使用pipenv创建虚拟环境</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="9d7d" class="jy jz hi ju b fi ka kb l kc kd">pipenv shell</span></pre><p id="f87d" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">使用pipenv安装所有软件包</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="7d0e" class="jy jz hi ju b fi ka kb l kc kd">pipenv install flask dlib numpy python-dotenv opencv-python</span></pre><p id="05f6" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">这将在虚拟环境中安装所有软件包。</p><p id="4fd3" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">如果你使用的是ubuntu，那么你需要先安装cmake。</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="a073" class="jy jz hi ju b fi ka kb l kc kd">sudo <strong class="ju hj">apt</strong>-<strong class="ju hj">get</strong> <strong class="ju hj">install cmake</strong></span></pre><p id="0a23" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">创建app.py文件，这是我们的应用程序的起点。</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="e26f" class="jy jz hi ju b fi ka kb l kc kd">touch app.py</span></pre><p id="58b8" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">创造。flaskenv文件并输入env变量</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="09b4" class="jy jz hi ju b fi ka kb l kc kd">touch .flaskenv<br/>FLASK_ENV=development<br/>FLASK_DEBUG=1</span></pre><p id="dbd7" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">创建一个文件夹face和2个文件app.py和exception.py，app.py包含主要逻辑。</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="4405" class="jy jz hi ju b fi ka kb l kc kd">mkdir face<br/>touch face/{app.py,exception.py}</span></pre></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><p id="98b2" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">检测图像中人脸的代码</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="kl km l"/></div><figcaption class="im in et er es io ip bd b be z dx translated">face/app.py</figcaption></figure><p id="6c8c" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我们已经使用dlib来检测图像中的人脸，并使用opencv在人脸上创建一个边界框。</p><p id="95db" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">detect()返回检测到的面数和base64字符串中的图像，作为api的json响应返回。</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="kl km l"/></div><figcaption class="im in et er es io ip bd b be z dx translated">face/exceptions.py</figcaption></figure><p id="cb9d" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">该类用于返回自定义异常消息。</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="kl km l"/></div><figcaption class="im in et er es io ip bd b be z dx translated">app.py</figcaption></figure><p id="eb01" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">这个文件是我们flask应用程序的入口点。</p><p id="2491" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我们接受base64字符串形式的图像，然后转换为numpy数组，再转换为rgb模式，因为dlib使用RGB模式的图像。</p><p id="341b" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">来自detect()的响应被转换成json，然后发送出去。</p></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h1 id="d5f8" class="kn jz hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">用postman测试api</h1><p id="d811" class="pw-post-body-paragraph ir is hi it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hb bi translated">激活虚拟环境并运行您的应用程序</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="bc12" class="jy jz hi ju b fi ka kb l kc kd">pipenv shell<br/>flask run<br/>(FaceAPI) sambhav@Sambhav-pc:~/Downloads/FaceApi$ flask run<br/> * Environment: development<br/> * Debug mode: on<br/> * Running on <a class="ae iq" href="http://127.0.0.1:5000/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:5000/</a> (Press CTRL+C to quit)<br/> * Restarting with stat<br/> * Debugger is active!<br/> * Debugger PIN: 626-933-224</span></pre><p id="4908" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">如果一切正常，那么从谷歌下载任何包含人物的图片。</p><p id="d3ab" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">使用将图像转换为base64字符串<a class="ae iq" href="https://codebeautify.org/image-to-base64-converter" rel="noopener ugc nofollow" target="_blank">:</a></p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lp"><img src="../Images/828caa67ac66d9f52557dbea8ed4ca1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8IndPTbpyOLIPb9n1GLB_w.png"/></div></div></figure><p id="67e9" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">复制base64字符串并打开postman。创建新请求。选择方法为Post，转到body并选择raw和JSON。</p><p id="f278" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">在正文中，按照以下格式输入json并点击请求</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="ff93" class="jy jz hi ju b fi ka kb l kc kd">{<br/>"image":"your base 64 string"<br/>}</span></pre><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lp"><img src="../Images/52213a9e62f53c0a3274f7b17433df06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HziCCYr1mesRAR7jrnPbiw.png"/></div></div></figure><p id="0054" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">api将返回一个json对象作为响应。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lp"><img src="../Images/bcff43dfa4206a6648748d9ea8702105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cmcg956lb80D9gL6h4M2fQ.png"/></div></div></figure><p id="d770" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">现在，复制base64字符串来测试它，并将它粘贴到这里<a class="ae iq" href="https://codebeautify.org/base64-to-image-converter" rel="noopener ugc nofollow" target="_blank">以将字符串转换为图像。</a></p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lp"><img src="../Images/7119d8e1d0c2e8a082da79298d06b94f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yF5oWCbj4_GkZuisJqexnA.png"/></div></div></figure></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h1 id="6d20" class="kn jz hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">结果</h1><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lu"><img src="../Images/142971d3b1589370054a03943d9c7372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BREu7dYCG1bWGOJI4nMmiA.png"/></div></div></figure><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es lv"><img src="../Images/ba3f745bcfbd59a8ac35ffe5ffcbfa8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*oEDpI44m9avXwoGtX0V_bQ.png"/></div></figure><p id="f7d9" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">你可以在<a class="ae iq" href="https://github.com/SambhavChoradia/FaceApi" rel="noopener ugc nofollow" target="_blank"> <em class="lw"> github </em> </a> <em class="lw">找到完整的代码。</em></p><p id="09f8" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">希望这对你有用。如果你在实现这个过程中有任何困难或者你需要任何帮助，请联系我。</p><p id="029a" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><em class="lw">邮箱:sambhavchoradia@gmail.com</em></p><p id="e0af" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><em class="lw">社交媒体:</em><a class="ae iq" href="https://www.linkedin.com/in/sambhav-choradia/" rel="noopener ugc nofollow" target="_blank"><em class="lw">LinkedIn</em></a></p><p id="2f69" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">快乐编码。</p><p id="beff" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj"> <em class="lw">参考文献:</em> </strong></p><div class="lx ly ez fb lz ma"><a href="https://programmer.group/opencv-python-cv2.imdecode-and-cv2.imencode-picture-decoding-and-coding.html" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab dw"><div class="mc ab md cl cj me"><h2 class="bd hj fi z dy mf ea eb mg ed ef hh bi translated">OpenCV-Python cv2.imdecode()和cv2.imencode()图片解码和编码</h2><div class="mh l"><h3 class="bd b fi z dy mf ea eb mg ed ef dx translated">cv2.imdecode()函数从指定的内存缓存中读取数据，并将数据转换(解码)为图像格式；这是…</h3></div><div class="mi l"><p class="bd b fp z dy mf ea eb mg ed ef dx translated">程序员小组</p></div></div><div class="mj l"><div class="mk l ml mm mn mj mo ik ma"/></div></div></a></div><div class="lx ly ez fb lz ma"><a href="https://www.base64decode.net/python-base64-b64decode" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab dw"><div class="mc ab md cl cj me"><h2 class="bd hj fi z dy mf ea eb mg ed ef hh bi translated">Python base64.b64decode()</h2><div class="mh l"><h3 class="bd b fi z dy mf ea eb mg ed ef dx translated">解码Base64编码的字符串base64.b64decode(s[，altchars]) s -是要解码的字符串。可选替代字符必须是…</h3></div><div class="mi l"><p class="bd b fp z dy mf ea eb mg ed ef dx translated">www.base64decode.net</p></div></div></div></a></div><div class="lx ly ez fb lz ma"><a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xxiii-application-programming-interfaces-apis" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab dw"><div class="mc ab md cl cj me"><h2 class="bd hj fi z dy mf ea eb mg ed ef hh bi translated">Flask大型教程第二十三部分:应用编程接口(API)</h2><div class="mh l"><h3 class="bd b fi z dy mf ea eb mg ed ef dx translated">这是Flask大型教程系列的第二十三部分，也是最后一部分，我将告诉你如何…</h3></div><div class="mi l"><p class="bd b fp z dy mf ea eb mg ed ef dx translated">blog.miguelgrinberg.com</p></div></div></div></a></div><p id="90bb" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><a class="ae iq" href="http://dlib.net/face_recognition.py.html" rel="noopener ugc nofollow" target="_blank">http://dlib.net/face_recognition.py.html</a></p></div></div>    
</body>
</html>