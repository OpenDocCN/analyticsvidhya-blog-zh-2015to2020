<html>
<head>
<title>Anomaly Detection using Angle-based techniques</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用基于角度的技术的异常检测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/anomaly-detection-using-angle-based-techniques-5d8db8500d14?source=collection_archive---------8-----------------------#2020-03-22">https://medium.com/analytics-vidhya/anomaly-detection-using-angle-based-techniques-5d8db8500d14?source=collection_archive---------8-----------------------#2020-03-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d2ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的异常检测系列中，我们将要讨论的另一种方法是基于角度的技术。</p><p id="bf5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基于角度的技术有助于多元数据的异常检测。让我们深入了解这项技术背后的直觉:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/96908c369fabe990a60dfb5764ef4c04.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*FaicATYtqJOa1wEIW9O-zw.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">橙色点代表正常点</figcaption></figure><p id="b8b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上图中，考虑一组数据点，其中橙色点代表一个正常点。对于法线点，当您选择不同的数据点时，它与任何其他两个数据点所成的角度会有很大的变化。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jp"><img src="../Images/9c70655428ee882315a8ea13379b977f.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*asMKuCOsSDmLA-D0WH0F5A.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">绿点代表异常点</figcaption></figure><p id="835b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在考虑另一种情况，其中绿点代表异常，在这种情况下，它与其他数据点形成的角度不会随着您选择不同的数据点而有太大变化。</p><p id="ee3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">核心思想是，与具有高方差的正常点相比，异常点具有低方差。</p><p id="a678" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将按照以下步骤实现上述算法:</p><ol class=""><li id="954f" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">对于每个数据点，确定它与所有其他数据点对所成的角度。</li><li id="7782" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">计算这个角度的方差。</li><li id="5782" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">方差低于预定阈值的点是异常点。</li></ol><p id="a359" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们深入到编码部分:</p><p id="2e3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:这里我们关注的是算法而不是数据，我们不会进行测试/训练分割。相反，我们将使用已知异常的模拟数据，并观察算法的执行情况。</p><p id="bc85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据:我们从创建数据开始，数据将是正常点和异常点的组合。每组点(正常和异常)都是从2D高斯分布中生成的，其中我们指定了每个维度的平均值以及协方差矩阵。我们选择正常数据是100个紧密聚集在一起的点，而异常数据是10个更远且分布更广的点。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es ke"><img src="../Images/43070e22538e3a759d92ee80df5d229f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0PlrY5NDp1vheHbODNYnPQ.png"/></div></div></figure><p id="6f22" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们绘制正常与异常的数据和颜色代码:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kj"><img src="../Images/f3082fcee53a6427506d71e5d920241f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2jnabEbx-bAzTQf4orsrzA.png"/></div></div></figure><p id="5143" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">算法:我们将实现一个真正的基于角度的算法。也就是说，我们计算数据中每组三个点的实际角度。</p><p id="6350" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将从构建基于角度的异常检测算法的两个关键函数开始。第一个函数<em class="kk"> angle </em>，计算三点之间的角度。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kl"><img src="../Images/b90d55aa4e1b6359d552a0bd4de9746e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kokoq_wpP3NPZvSuM-NBfg.png"/></div></div></figure><p id="b7ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第二个函数，<em class="kk"> eval_angle_point </em>，接受两个输入:一个点和数据(点的集合)。此函数返回输入点与输入数据中所有点对之间的角度列表。它使用<em class="kk">角度</em>的角度计算。</p><p id="ae52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过数据中所有点对的简单循环是不够的，因为我们必须确保这三个点没有重复地指向确定的角度。更具体地说，如果我们选择点A，然后考虑数据中的两点B(第二点)和C(第三点)，我们希望确保以下条件成立:</p><ol class=""><li id="ba12" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">B点不同于A点</li><li id="c5a3" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">C点不同于A点和B点</li><li id="56d5" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">我们不会计算同一个角度两次。也就是说，如果我们计算矢量AB和AC之间的角度(其中B是第二点，C是第三点)，我们不会用矢量AC和AB重复计算(其中C是第二点，B是第三点)</li></ol><p id="5c9e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kk"> eval_angle_point </em>中的<em class="kk"> if </em>语句确保三个条件成立。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es km"><img src="../Images/8bdad65092227d6fa4b6da23b19f15fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4U7zb6vvnu-qYZlrm0znLQ.png"/></div></div></figure><p id="19ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们使用<em class="kk"> eval_angle_point </em>，其中一个点来自正常数据，另一个点来自异常数据，来说明我们在上面做出的声明:异常点比正常点具有更低的角度方差。</p><p id="153c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随机选择一个正常点和一个异常点，并绘制数据中100对点的角度。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kn"><img src="../Images/08aac9a274f3b67aaa6418a5d7778925.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qA37RSUEcakIlpk03NSWxg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es ko"><img src="../Images/166cea9e0e01a1182e35aace56a56c1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*92vVO2niWwYOyLLTfEZkwA.png"/></div></div></figure><p id="d800" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这两点比较看起来很有希望，但没有统计学意义。</p><p id="4b8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们计算所有异常数据的角度方差。我们将用类型“0”标记异常，以便我们可以将它们与下面的正常数据(类型“1”)进行比较。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kp"><img src="../Images/91ad1ad4f1a1a03d8ea3a2cefc5c58d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E50P8SwJWEH-1a459tgg0w.png"/></div></div></figure><p id="d675" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看前十个条目。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kq"><img src="../Images/b8b5c156431554a1339e3b609771c2c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ab0rkCakqD-KuVZR9sJDMg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kr"><img src="../Images/68ddef85f945bb574a34a184047208b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gQjpo6K_y_6deRKsPEte1Q.png"/></div></div></figure><p id="41fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这有点令人不安。许多异常的角度方差相当高，甚至高于我们上面考虑的正常点的方差。为了完成我们的分析，我们还需要正态数据的方差，我们计算如下(将正态数据标记为类型“1”)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es ks"><img src="../Images/7c5d376568597ed0c12ab3b543369afd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZwNc2hjAYOoufgPna6aqZA.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kt"><img src="../Images/2a2dd71cb8dbdeccd96703557892529f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5oMuImboOFfjOWF1K1RpBA.png"/></div></div></figure><p id="0f78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们仔细观察，就会发现在计算正常数据和异常数据的角度变化所花费的时间之间存在显著的时间差。</p><p id="3884" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以问题来了，为什么*normal_data*的计算相对慢？</p><p id="c301" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">答案在于算法的复杂性，结果是O(N^3，其中n是点数。</p><p id="371c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">说明:要看到这一点，请思考一个角度是如何计算的。我们需要三分，而且应该都不一样。有N种方法选择第一点，N-1种方法选择第二点，N-2种方法选择第三点。交换第二个和第三个点给出相同的角度，所以总的复杂性是</p><p id="baa6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">N∗(N−1)∗(N−2)/2=O(N^3).</p><p id="5229" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，这里我们将算法分成两部分:<em class="kk"> eval_angle_point </em>计算给定点的所有角度[复杂度o(n^2]】,然后上面的最终循环(对于<em class="kk"> df_anomaly </em>和<em class="kk"> df_normal </em>)遍历所有点[复杂度O(N)]</p><p id="bf6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从异常数据的10个点到正常数据的100个点，运行时间增加了大约10 =1000倍，这导致了明显的速度减慢。基于角度的异常检测速度很慢。</p><p id="eb65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们将异常点和正常点的两个数据帧结合起来，并按照角度变化对它们进行升序排序。如果我们的异常检测算法是完美的，那么前十个条目应该都是异常(类型0)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es ku"><img src="../Images/786462920252371eb4deb3973f783c6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VD8fFUoylz1-KtPiksNN0Q.png"/></div></div></figure><p id="15fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">哎呀！我们只发现十个异常中的五个，方差最小的两个点属于正常数据。很明显我们的算法需要改进。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kv"><img src="../Images/4f4f48bb768d41b00da9e1ffa729a38e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oi_mqUe2iY2jybkT-X_66w.png"/></div></div></figure><p id="6cb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们之前用来计算角度的公式，我们发现原则上角度是一个很好的度量，但在实践中并不总是有效。</p><p id="f305" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，已经设计了其他类似角度的度量。例如:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/96991549eccaf6590a1048e169329621.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*xKTWE_vbUWUlbYDAM5al3g.png"/></div></figure><p id="b569" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然ψ通常被称为角度，但它不是真正的角度。分母中的平方幂在此度量中引入了距离依赖性。</p><p id="ca26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们更新公式，看看结果:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kx"><img src="../Images/bad3666b80347c9ce368341d6eb6f4f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Db04DcVYb-lVWDbuU1_SkA.png"/></div></div></figure><p id="c99c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码的其余部分保持不变。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es ky"><img src="../Images/918d3464bf651545d16809a0a50f7219.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UexE0SYCXTJtfe8QIfDgAA.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kz"><img src="../Images/57d6da362d42d9c6cd637946c67c80c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k2mkRNyzCeUihPni4kFPRg.png"/></div></div></figure><p id="cd31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我们在下面可以观察到的，法线和异常点的角度变化之间的差异更加明显。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es la"><img src="../Images/1d3939bf02f0512900fcb00950052bad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n-mRMW9eRW9MO-ZruKIOPQ.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es lb"><img src="../Images/d0b4181526089143fa079dafdb04beac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mAdkyuIJS0oHyrfsSHF5fw.png"/></div></div></figure><p id="c7b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我们在下面观察到的，异常点的角度方差比以前小了。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es lc"><img src="../Images/6f24c23a63562f49376dc03867291928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZA-arKtFdx2wQRre9scCnw.png"/></div></div></figure><p id="1acf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">类似地，计算法线点的角度方差。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es ld"><img src="../Images/eb0a579f1b327420f4bdd58d078e5f4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z3h9a2KLCEUAZEDlkKqK7A.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es le"><img src="../Images/873a4730544a06f9150ee07810496854.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RTMrjuJF5Uv5h9wUgx4OfQ.png"/></div></div></figure><p id="72d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，将异常点和正常点的两个数据帧组合起来，并按照角度方差以升序对它们进行排序。如果我们的异常检测算法是完美的，那么前十个条目应该都是异常(类型0)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es lf"><img src="../Images/ebf1c0db6e7ee26d88f53a4ec15c8835.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oe6ZuPZGhjkNNxyVsRbUUQ.png"/></div></div></figure><p id="1e41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">而且这次比以前好用多了。</p><p id="e6c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文中使用的代码可以在下面的github上找到:</p><div class="lg lh ez fb li lj"><a href="https://github.com/jainyk/Anomaly-detection/tree/master/Angle%20based%20techniques" rel="noopener  ugc nofollow" target="_blank"><div class="lk ab dw"><div class="ll ab lm cl cj ln"><h2 class="bd hj fi z dy lo ea eb lp ed ef hh bi translated">杰尼克/异常检测</h2><div class="lq l"><p class="bd b fp z dy lo ea eb lp ed ef dx translated">github.com</p></div></div><div class="lr l"><div class="ls l lt lu lv lr lw jj lj"/></div></div></a></div><p id="70fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如有任何疑问，请在下方留言。欢迎任何进一步的建议。</p></div></div>    
</body>
</html>