<html>
<head>
<title>Reducing Deep Learning Model Size Without Effecting It’s Original Performance and Accuracy With Tensorflow Model Optimization Toolkit On Real World Dataset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Tensorflow 模型优化工具包在真实数据集上减少深度学习模型的大小，而不影响其原始性能和准确性</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/reducing-deep-learning-model-size-without-effecting-its-original-performance-and-accuracy-with-a809b49cf519?source=collection_archive---------1-----------------------#2020-10-23">https://medium.com/analytics-vidhya/reducing-deep-learning-model-size-without-effecting-its-original-performance-and-accuracy-with-a809b49cf519?source=collection_archive---------1-----------------------#2020-10-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9bdf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你只需要知道如何训练可扩展和高效的深度学习模型</p><p id="52d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">目录:</p><p id="4c03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">㈠导言</p><p id="f630" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">㈡动机</p><p id="c9c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(iii)没有修剪的模型训练</p><p id="8525" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(四)修剪模型训练</p><p id="1880" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(v)两种模型尺寸的比较</p><p id="5227" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(六)两种模型性能的比较</p><p id="cb0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(七)两种模型精度的比较</p><p id="d637" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">㈧结论</p><p id="66c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">㈨参考资料</p><h2 id="fd08" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated"><strong class="ak">(一)简介:</strong></h2><p id="89e7" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">我们都知道，神经网络比经典的机器学习算法表现更好，因为权重在每个时期更新。但未知的事实是，当从神经网络中去除 90%的权重时，我们也可以匹配基线模型精度。</p><p id="b201" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大多数神经网络的权值本质上是稀疏的，稀疏权值不会影响模型的性能，所以我们可以在不影响性能的情况下去除它。</p><p id="7137" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从神经网络中去除稀疏权重的过程称为修剪。我使用 Tensorflow 模型优化工具包进行修剪。</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div class="er es kd"><img src="../Images/471c56aa4c0e48fc141ce014024fa98a.png" data-original-src="https://miro.medium.com/v2/resize:fit:594/format:webp/1*e7QlXonzxPjIeS5f1ZNISg.png"/></div><figcaption class="kl km et er es kn ko bd b be z dx translated">图片来源:【https://www.youtube.com/watch?v=KRlOEGtb3gk】T2&amp;t = 1233s</figcaption></figure><p id="9c3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">修剪的优势:</p><p id="8194" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">模型尺寸减小而不影响模型性能。</p><p id="19a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">准确性也类似于基线模型。</p><h2 id="b1d8" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated"><strong class="ak">(二)动机:</strong></h2><p id="83c6" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">最近，我开发了一个检测患病棉花植株或棉花叶片的 web 应用程序，在开发 web 应用程序后，我试图在 Heroku 平台上部署该 web 应用程序，但由于我的模型大小，我无法部署该模型。</p><p id="e546" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的型号是 562MB，但是 Heroku 平台只支持 500MB</p><p id="32a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我训练的. h5 文件大小为 61MB</p><p id="94ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后当时我不知道如何减少它，但昨天我得到了一个实习任务，其中模型修剪。</p><p id="a5b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在探索这个话题时，我在 youtube 上看到了一个视频，这是 tensorflow 团队关于模型优化工具包<a class="ae kp" href="https://www.youtube.com/watch?v=3JWRVx1OKQQ&amp;t=2143s" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=3JWRVx1OKQQ&amp;t = 2143s</a>的官方演示</p><p id="c812" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从那个视频中，我找到了问题的解决方案。</p><p id="1d28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">MobileNet:移除 75%的稀疏权重，然后我们还可以在 ImageNet 数据集上匹配基线模型精度</p><p id="ca72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ResNet50:移除 90%的稀疏权重，然后我们还可以在 ImageNet 数据集上匹配基线模型精度</p><p id="7b91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些信息激励我去解决我的问题</p><h2 id="3663" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">数据预处理:</h2><p id="4baa" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">这篇文章的主要目的是关于修剪，所以我不会深入研究数据预处理，如果你想要详细的解释，我已经发表了一篇文章，请关注这篇文章<a class="ae kp" rel="noopener" href="/analytics-vidhya/agriculture-project-from-scratch-to-deployment-using-deep-learning-architecture-fca767be094f">https://medium . com/analytics-vid hya/agriculture-project-from-scratch-to-deployment-using-deep-learning-architecture-FCA 767 be 094 f</a></p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kq"><img src="../Images/ee2c12432c4a32b30a4fcd93525ed51c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qdIJHTBJ89Z6Be6Brp9wIg.png"/></div></div></figure><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kq"><img src="../Images/3fd2eba4df153a00b62db633ab221c83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C3pvACEwgMpQb1nJRblnpw.png"/></div></div></figure><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kq"><img src="../Images/d0c65d13717abc92fb41c9b7dcf4961a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sOLuyAdras2x75DB5IKO0Q.png"/></div></div></figure><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kq"><img src="../Images/2b869653b5f00b12fe294934f834e03f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xcOrMvp3utk0Gcj0V16LmQ.png"/></div></div></figure><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kq"><img src="../Images/00bbfac8cb1d786f2fb34af174d2d438.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vsTSCx4NfOm0sSDj8L6q-w.png"/></div></div></figure><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kq"><img src="../Images/bd48707b751d070f3d12c6e29aa266a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HxQW3RutS6i56MGnhcvKhA.png"/></div></div></figure><h2 id="7844" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">(三)不修剪的模型训练:</h2><p id="4aa9" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">我的问题陈述是多类分类</p><p id="5f3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以对这些图像进行分类，我从头开始建立一个 CNN</p><p id="8e8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导入必要的模块</p><blockquote class="kv kw kx"><p id="4e8c" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">将张量流作为 tf 导入</p><p id="c839" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">从 tensorflow 导入 keras</p><p id="3897" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">从 tensorflow.keras.layers 导入输入，Lambda，密集，扁平 5</p><p id="deec" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">从 tensorflow.keras.models 导入模型</p><p id="038e" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">从 tensorflow.keras.models 导入序列</p><p id="e03e" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">将 numpy 作为 np 导入</p><p id="e06e" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">来自 tensorflow.keras .预处理导入图像</p><p id="ac1d" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">优化程序导入 Adam</p><p id="54cd" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">导入操作系统</p><p id="e8e7" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">导入临时文件</p><p id="e104" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">%load_ext 张量板</p><p id="449b" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">进口冲浪板</p></blockquote><p id="342f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">构建 CNN 模型</p><p id="7553" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4 Conv2D，4 MaxPooling2D，3 Dropout，3 Dense，1 Flatten 图层</p><p id="59f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Conv 2D 蛋鸡数量:32，64，128，256</p><p id="0494" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">内核大小=3x3</p><p id="a52b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">神经元密集层数:128，256</p><p id="5efb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出层最大神经元数量=4</p><p id="c37c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">激活功能:relu</p><blockquote class="kv kw kx"><p id="719c" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">CNN _ model = keras . models . sequential([</p><p id="ebac" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">keras.layers.Conv2D(filters=32，kernel_size=3，input_shape=[224，224，3])，</p><p id="a88a" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">keras . layers . maxpooling2d(pool _ size =(2，2))，</p><p id="b83e" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">keras.layers.Conv2D(filters=64，kernel_size=3)，</p><p id="d1f3" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">keras . layers . maxpooling2d(pool _ size =(2，2))，</p><p id="ecee" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">keras . layers . conv 2d(filters = 128，kernel_size=3)，</p><p id="6f01" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">keras . layers . maxpooling2d(pool _ size =(2，2))，</p><p id="a4dc" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">keras . layers . conv 2d(filters = 256，kernel_size=3)，</p><p id="2729" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">keras . layers . maxpooling2d(pool _ size =(2，2))，</p><p id="e9d9" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">辍学(0.5)，</p><p id="5e51" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">keras.layers.Flatten()，#神经网络构建</p><p id="351c" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">keras.layers.Dense(units=128，activation='relu ')，#输入层</p><p id="8e1e" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">辍学(0.1)，</p><p id="260f" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">keras.layers.Dense(单位=256，激活='relu ')，</p><p id="7276" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">辍学(0.25)，</p><p id="00d7" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">keras.layers.Dense(units=4，activation='softmax') #输出图层</p><p id="6fc8" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi">])</p></blockquote><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kq"><img src="../Images/02f1c8a425893b0e47dac253339e64a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VkxTEZ-9UzFmzTmA8AOFKg.png"/></div></div></figure><p id="8489" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">编译模型</p><blockquote class="kv kw kx"><p id="26ec" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">callbacks =[TF . keras . callbacks . tensor board(log _ dir = logdir，profile_batch=0)]</p><p id="4108" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">CNN _ model . compile(optimizer = Adam(lr = 0.0001)，loss = ' categorical _ crossentropy '，metrics=['accuracy'])</p></blockquote><p id="fff1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">拟合模型</p><p id="0325" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我只为 10 个时期训练模型，你可以为你想要的时期训练模型</p><blockquote class="kv kw kx"><p id="4044" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">history = CNN _ model . fit(train _ agumented _ set，epochs=10，verbose=1，validation _ data = val _ agumented _ set，callbacks =回调)</p></blockquote><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kq"><img src="../Images/365cff574b06e8f86c6dbc487d82d9dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uvKw0PPhVFqcCQ29ES9iEw.png"/></div></div></figure><h2 id="f6cb" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">(四)修剪模型训练:</h2><p id="eeae" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">修剪只不过是去除具有稀疏权重的神经元的连接</p><p id="a9f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在剪枝的帮助下，我们可以减少神经网络的权值，同时我们的模型大小也减少了</p><p id="6ee2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为规模更小，我们的模型响应时间也更短，通过修剪，我们间接地提高了我们的模型性能</p><p id="55cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了修剪神经网络，我使用 Tensorflow 模型优化工具包</p><p id="8391" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Tensoflow Toolkit 支持<a class="ae kp" href="https://www.tensorflow.org/model_optimization/guide/quantization/post_training" rel="noopener ugc nofollow" target="_blank">训练后量化</a>、<a class="ae kp" href="https://www.tensorflow.org/model_optimization/guide/quantization/training" rel="noopener ugc nofollow" target="_blank">量化感知训练</a>、<a class="ae kp" href="https://www.tensorflow.org/model_optimization/guide/pruning/index" rel="noopener ugc nofollow" target="_blank">剪枝</a>和<a class="ae kp" href="https://www.tensorflow.org/model_optimization/guide/clustering/index" rel="noopener ugc nofollow" target="_blank">聚类</a>。</p><p id="129e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于修剪，我使用 Tensorflow 模型优化 API 中的多项式函数</p><p id="67f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ref:<a class="ae kp" href="https://www.tensorflow.org/model_optimization/api_docs/python/tfmot/sparsity/keras/PolynomialDecay" rel="noopener ugc nofollow" target="_blank">https://www . tensor flow . org/model _ optimization/API _ docs/python/TF mot/sparsity/keras/polynomial decay</a></p><p id="b713" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">多项式函数包含参数</p><blockquote class="kv kw kx"><p id="ab5c" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><code class="du lc ld le lf b">initial_sparsity:</code>修剪开始时的稀疏度(%)。</p><p id="1c56" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><code class="du lc ld le lf b">final_sparsity</code>修剪结束时的稀疏度(%)。</p><p id="bb7b" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><code class="du lc ld le lf b">begin_step</code>开始修剪的步骤。</p><p id="8a73" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><code class="du lc ld le lf b">end_step</code>结束修剪的步骤。</p><p id="e7ca" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><code class="du lc ld le lf b">power</code>稀疏函数中使用的指数。</p><p id="56d8" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><code class="du lc ld le lf b">frequency</code>仅在每<code class="du lc ld le lf b">frequency</code>步应用修剪。</p></blockquote><p id="da1b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导入必要的模块</p><blockquote class="kv kw kx"><p id="71c9" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">从 tensor flow _ model _ optimization . sparsity 导入 keras 作为稀疏度</p><p id="02ad" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">将 numpy 作为 np 导入</p></blockquote><p id="1961" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我正在创建一个用于修剪参数的字典</p><blockquote class="kv kw kx"><p id="5069" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">pruning_params = {</p><p id="1098" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">' pruning_schedule ':稀疏性。多项式系数(initial_sparsity=0.85，</p><p id="650c" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">最终稀疏度=0.95，</p><p id="8081" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">begin_step=2000，</p><p id="0bbf" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">end_step=5000，频率=100)}</p></blockquote><p id="6a6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们以 85%的稀疏度(85%的权重为零)开始模型，以 95%的稀疏度结束。</p><p id="f581" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个<code class="du lc ld le lf b">PruningSchedule</code>对象，在整个训练过程中控制剪枝率。</p><p id="5ce4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我导入 keras 作为稀疏</p><p id="ced4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">sparsity . prune . low _ magnitude</strong>:具有修剪功能的扭曲层，它在训练期间使层的权重变得稀疏。例如，使用 85%的稀疏度将确保 85%的层权重为零。</p><p id="e1a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们知道了所有对修剪神经网络有用的参数</p><p id="efd5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用剪枝方法建立 CNN 模型</p><blockquote class="kv kw kx"><p id="4015" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">pruned _ model = keras . models . sequential([</p><p id="d29c" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">sparsity . prune _ low _ magnitude(keras . layers . conv 2d(filters = 32，kernel_size=3)，input_shape=[224，224，3]，**pruning_params)，</p><p id="212f" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">keras . layers . maxpooling2d(pool _ size =(2，2))，</p><p id="c41a" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">sparsity . prune _ low _ magnitude(keras . layers . conv 2d(filters = 64，kernel_size=3)，**pruning_params)，</p><p id="a784" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">keras . layers . maxpooling2d(pool _ size =(2，2))，</p><p id="a402" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">sparsity . prune _ low _ magnitude(keras . layers . conv 2d(filters = 128，kernel_size=3)，**pruning_params)，</p><p id="8b1e" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">keras . layers . maxpooling2d(pool _ size =(2，2))，</p><p id="85ed" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">sparsity . prune _ low _ magnitude(keras . layers . conv 2d(filters = 256，kernel_size=3)，**pruning_params)，</p><p id="5688" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">keras . layers . maxpooling2d(pool _ size =(2，2))，</p><p id="88d4" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">辍学(0.5)，</p><p id="0035" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">keras.layers.Flatten()，#神经网络建模</p><p id="685b" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">sparsity . prune _ low _ magnitude(keras . layers . dense(units = 128，activation='relu ')，**pruning_params)，#输入层</p><p id="a239" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">辍学(0.1)，</p><p id="86e9" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">sparsity . prune _ low _ magnitude(keras . layers . dense(units = 256，activation='relu ')，**pruning_params)，</p><p id="d75f" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">辍学(0.25)，</p><p id="a7ea" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">sparsity . prune _ low _ magnitude(keras . layers . dense(units = 4，activation='softmax ')，**pruning_params) #输出层</p><p id="e9f3" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi">])</p></blockquote><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kq"><img src="../Images/eee990f2290e95c5c8e4f7a03c29c9c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3BOUWGjlY-ZPZ5Dsp4ZBow.png"/></div></div></figure><p id="0cb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">编译模型</p><blockquote class="kv kw kx"><p id="78e9" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">pruned _ model . compile(optimizer = Adam(lr = 0.0001)，loss = ' categorical _ crossentropy '，metrics=['accuracy'])</p></blockquote><p id="668f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">拟合模型</p><blockquote class="kv kw kx"><p id="23b2" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">回调=[稀疏性。UpdatePruningStep()，稀疏性。pruning summaries(log _ dir = logdir，profile_batch=0)]</p><p id="e52d" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">history _ prun = pruned _ model . fit(train _ agumented _ set，epochs=10，verbose=1，</p><p id="c27d" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">validation _ data = val _ agumented _ set，callbacks=callbacks)</p></blockquote><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kq"><img src="../Images/9ff1dd944da1855ee35da2fe93e040eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YYezk2AWYdnKpXdcj4-kkg.png"/></div></div></figure><p id="1de7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> sparsity.strip_pruning : </strong>一旦模型被修剪到所需的稀疏度，该方法可用于恢复具有稀疏权重的原始模型。</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kq"><img src="../Images/55fc629a839bf0bfa692074e1f646331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V7afMbKriVRHdUX02cM7pg.png"/></div></div></figure><h2 id="d3de" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">(五)两种模型尺寸的比较:</h2><p id="e413" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">训练模型(无修剪)</p><p id="d89a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们得到了. h5 文件大小 61MB</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kq"><img src="../Images/84b0d54a130f39a17af912af5394f56a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XgkUfHiovOyKBv6k6KJyeg.png"/></div></div></figure><p id="c571" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">训练模型(带修剪)</p><p id="786f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们得到了大小为 20MB 的. h5 文件</p><p id="e381" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过修剪减少了 3 倍的文件大小</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kq"><img src="../Images/ba4a804617ae0f12b7b0816522169f1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-ugBwFyy6gyDznFL3SJKg.png"/></div></div></figure><h2 id="a2a1" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">(六)两种模型性能的比较:</h2><div class="ke kf kg kh fd ab cb"><figure class="lg ki lh li lj lk ll paragraph-image"><img src="../Images/8380ad2e4d6b22f6da4b076d24b55e98.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*fu_us6HOS4dr4I_RPK_pbg.png"/></figure><figure class="lg ki lh li lj lk ll paragraph-image"><img src="../Images/c3d63049f4c48cbaa1c4668481832580.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*ej1MGgsd3Mbp0Yj7_EfyuQ.png"/><figcaption class="kl km et er es kn ko bd b be z dx lm di ln lo translated">不修剪模型性能</figcaption></figure></div><div class="ab cb"><figure class="lg ki lh li lj lk ll paragraph-image"><img src="../Images/215088503e4dc2938f84369205c4db5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*42aYZkUzFPrgBEcr_eejaQ.png"/></figure><figure class="lg ki lh li lj lk ll paragraph-image"><img src="../Images/595497d76ad943baa57a8b4aa24b64f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*TD646chGfltsLESSB9yxAw.png"/><figcaption class="kl km et er es kn ko bd b be z dx lm di ln lo translated">使用修剪模型性能</figcaption></figure></div><p id="e219" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你比较这两个图，几乎两个模型表现相同的水平</p><h2 id="7163" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">(七)模型精度的比较:</h2><p id="9a31" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">训练模型(无修剪)</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es lp"><img src="../Images/b4f7e5f59f1e12ba7caa460095bd67a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Xdo7YRc1Aqtxc2OE3EF1Q.png"/></div></div></figure><p id="81fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">训练模型(带修剪)</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es lp"><img src="../Images/e284ceb3c74265db33db7c628bc190b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BLQZmZlG-N3DDgmsFbW5Tw.png"/></div></div></figure><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es lp"><img src="../Images/eecea86558ca2576267075712dd79805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4QZfKaHhLUxXrXBR0a7V2A.png"/></div></div></figure><p id="1849" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你观察上面的测试准确性</p><p id="9ca0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">修剪和不修剪之间的差异仅为 7%</p><p id="ed16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想要一个更小的模型，那么我们需要牺牲一些精确度</p><h2 id="1824" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">㈧结论:</h2><p id="781e" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">在剪枝的帮助下，我们的模型大小减少了 3 倍，性能也与原始模型相似，但精度损失了一些百分比。</p><p id="fdf5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们可以很容易地在 Heroku 平台上部署剪枝模型。由于修剪，模型尺寸减小，模型响应也减小</p><h2 id="1a67" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">㈨参考资料:</h2><div class="lq lr ez fb ls lt"><a href="https://www.tensorflow.org/model_optimization/api_docs/python/tfmot/sparsity/keras/PolynomialDecay" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab dw"><div class="lv ab lw cl cj lx"><h2 class="bd hj fi z dy ly ea eb lz ed ef hh bi translated">TF mot . sparsity . keras . polynomial decay |张量流模型优化</h2><div class="ma l"><h3 class="bd b fi z dy ly ea eb lz ed ef dx translated">用多项式函数修剪时间表。继承自:pruning schedule TF mot . sparsity . keras . polynomial decay(…</h3></div><div class="mb l"><p class="bd b fp z dy ly ea eb lz ed ef dx translated">www.tensorflow.org</p></div></div><div class="mc l"><div class="md l me mf mg mc mh kj lt"/></div></div></a></div><div class="lq lr ez fb ls lt"><a href="https://www.tensorflow.org/model_optimization/guide/pruning/pruning_with_keras" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab dw"><div class="lv ab lw cl cj lx"><h2 class="bd hj fi z dy ly ea eb lz ed ef hh bi translated">Keras 示例中的修剪|张量流模型优化</h2><div class="ma l"><h3 class="bd b fi z dy ly ea eb lz ed ef dx translated">欢迎使用基于幅度的权重修剪的端到端示例。了解什么是修剪以及…</h3></div><div class="mb l"><p class="bd b fp z dy ly ea eb lz ed ef dx translated">www.tensorflow.org</p></div></div><div class="mc l"><div class="mi l me mf mg mc mh kj lt"/></div></div></a></div><div class="lq lr ez fb ls lt"><a href="https://www.tensorflow.org/model_optimization/api_docs/python/tfmot/sparsity/keras/prune_low_magnitude" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab dw"><div class="lv ab lw cl cj lx"><h2 class="bd hj fi z dy ly ea eb lz ed ef hh bi translated">TF mot . sparsity . keras . prune _ low _ magnitude</h2><div class="ma l"><h3 class="bd b fi z dy ly ea eb lz ed ef dx translated">修改要在训练期间修剪的 tf.keras 层或模型。TF mot . sparsity . keras . prune _ low _ magnitude(to _ prune…</h3></div><div class="mb l"><p class="bd b fp z dy ly ea eb lz ed ef dx translated">www.tensorflow.org</p></div></div><div class="mc l"><div class="mj l me mf mg mc mh kj lt"/></div></div></a></div><div class="lq lr ez fb ls lt"><a href="https://www.tensorflow.org/model_optimization/api_docs/python/tfmot/sparsity/keras/strip_pruning" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab dw"><div class="lv ab lw cl cj lx"><h2 class="bd hj fi z dy ly ea eb lz ed ef hh bi translated">TF mot . sparsity . keras . strip _ pruning | tensor flow 模型优化</h2><div class="ma l"><h3 class="bd b fi z dy ly ea eb lz ed ef dx translated">从模型中去除包装。一旦一个模型被修剪成…</h3></div><div class="mb l"><p class="bd b fp z dy ly ea eb lz ed ef dx translated">www.tensorflow.org</p></div></div><div class="mc l"><div class="mk l me mf mg mc mh kj lt"/></div></div></a></div><figure class="ke kf kg kh fd ki"><div class="bz dy l di"><div class="ml mm l"/></div></figure><figure class="ke kf kg kh fd ki"><div class="bz dy l di"><div class="ml mm l"/></div></figure></div></div>    
</body>
</html>