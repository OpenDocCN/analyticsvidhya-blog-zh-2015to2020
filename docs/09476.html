<html>
<head>
<title>Azure data bricks node to node communication encryption</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure 数据砖节点到节点通信加密</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/azure-data-bricks-node-to-node-communication-encryption-ea0701e133ab?source=collection_archive---------19-----------------------#2020-09-07">https://medium.com/analytics-vidhya/azure-data-bricks-node-to-node-communication-encryption-ea0701e133ab?source=collection_archive---------19-----------------------#2020-09-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1288" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">文章讨论了如何通过加密来保护 spark 节点间的通信。许多公司都想保护 spark 及其处理过程。这可以通过 azure data bricks 引入的加密节点到节点通信的新特性来实现。以下是步骤。</p><ul class=""><li id="4698" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">为全局或集群范围初始化脚本创建一个初始化脚本</li><li id="c8d4" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">创建 azure 数据块集群。基本默认一个就够了。此群集仅用于创建初始化脚本。</li><li id="7be3" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">创建一个 scala 记事本，剪切并粘贴下面的代码</li></ul><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="baef" class="ka kb hi jw b fi kc kd l ke kf">dbutils.fs.put("/databricks/scripts/set-encryption.sh","""<br/>#!/bin/bash<br/>keystore_file="$DB_HOME/keys/jetty_ssl_driver_keystore.jks"<br/>keystore_password="gb1gQqZ9ZIHS"<br/><br/># Use the SHA256 of the JKS keystore file as a SASL authentication secret string<br/>sasl_secret=$(sha256sum $keystore_file | cut -d' ' -f1)<br/><br/>spark_defaults_conf="$DB_HOME/spark/conf/spark-defaults.conf"<br/>driver_conf="$DB_HOME/driver/conf/config.conf"<br/><br/>if [ ! -e $spark_defaults_conf ]; then<br/>touch $spark_defaults_conf<br/>fi<br/><br/>if [ ! -e $driver_conf ]; then<br/>touch $driver_conf<br/>fi<br/><br/># Authenticate<br/>echo "spark.authenticate true" &gt;&gt; $spark_defaults_conf<br/>echo "spark.authenticate.secret $sasl_secret" &gt;&gt; $spark_defaults_conf<br/><br/># Configure AES encryption<br/>echo "spark.network.crypto.enabled true" &gt;&gt; $spark_defaults_conf<br/>echo "spark.network.crypto.saslFallback false" &gt;&gt; $spark_defaults_conf<br/><br/># Configure SSL<br/>echo "spark.ssl.enabled true" &gt;&gt; $spark_defaults_conf<br/>echo "spark.ssl.keyPassword $keystore_password" &gt;&gt; $spark_defaults_conf<br/>echo "spark.ssl.keyStore $keystore_file" &gt;&gt; $spark_defaults_conf<br/>echo "spark.ssl.keyStorePassword $keystore_password" &gt;&gt; $spark_defaults_conf<br/>echo "spark.ssl.protocol TLSv1.2" &gt;&gt; $spark_defaults_conf<br/>echo "spark.ssl.standalone.enabled true" &gt;&gt; $spark_defaults_conf<br/>echo "spark.ssl.ui.enabled true" &gt;&gt; $spark_defaults_conf<br/><br/>head -n -1 ${DB_HOME}/driver/conf/spark-branch.conf &gt; $driver_conf<br/><br/>echo " // Authenticate"&gt;&gt; $driver_conf<br/><br/>echo " \"spark.authenticate\" = true" &gt;&gt; $driver_conf<br/>echo " \"spark.authenticate.secret\" = \"$sasl_secret\"" &gt;&gt; $driver_conf<br/><br/>echo " // Configure AES encryption"&gt;&gt; $driver_conf<br/>echo " \"spark.network.crypto.enabled\" = true" &gt;&gt; $driver_conf<br/>echo " \"spark.network.crypto.saslFallback\" = false" &gt;&gt; $driver_conf<br/><br/>echo " // Configure SSL"&gt;&gt; $driver_conf<br/><br/>echo " \"spark.ssl.enabled\" = true" &gt;&gt; $driver_conf<br/>echo " \"spark.ssl.keyPassword\" = \"$keystore_password\"" &gt;&gt; $driver_conf<br/>echo " \"spark.ssl.keyStore\" = \"$keystore_file\"" &gt;&gt; $driver_conf<br/>echo " \"spark.ssl.keyStorePassword\" = \"$keystore_password\"" &gt;&gt; $driver_conf<br/>echo " \"spark.ssl.protocol\" = \"TLSv1.2\"" &gt;&gt; $driver_conf<br/>echo " \"spark.ssl.standalone.enabled\" = true" &gt;&gt; $driver_conf<br/>echo " \"spark.ssl.ui.enabled\" = true" &gt;&gt; $driver_conf<br/>echo " }" &gt;&gt; $driver_conf<br/><br/>mv $driver_conf ${DB_HOME}/driver/conf/spark-branch.conf<br/><br/>""",true)</span></pre><ul class=""><li id="2236" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">上面的代码将创建一个名为<code class="du kg kh ki jw b">set-encryption.sh.</code>的文件</li><li id="c60b" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">shell 脚本基本上创建一个密钥，然后在每个节点上启用 AES 加密。创建 spark 集群时，脚本在所有节点上运行。</li><li id="8322" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">验证并确保我们已经创建了脚本文件</li></ul><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="e0c6" class="ka kb hi jw b fi kc kd l ke kf">display(dbutils.fs.ls("dbfs:/databricks/scripts/set-encryption.sh"))</span></pre><h1 id="addb" class="kj kb hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">创建新群集—对节点通信应用加密</h1><ul class=""><li id="3843" class="jd je hi ih b ii lg im lh iq li iu lj iy lk jc ji jj jk jl bi translated">创建一个全新的集群</li><li id="13b2" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">选择您自己的配置或保留默认值</li><li id="0ec5" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">在创建新集群之前，请转到高级部分</li><li id="30e1" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">选择初始化脚本部分</li><li id="0148" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">指定初始化脚本路径</li></ul><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="8b55" class="ka kb hi jw b fi kc kd l ke kf">dbfs:/databricks/scripts/set-encryption.sh</span></pre><ul class=""><li id="bc4c" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">现在启动集群</li><li id="c627" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">创建集群通常需要额外的几分钟时间。</li></ul><h1 id="f655" class="kj kb hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">测试集群</h1><ul class=""><li id="792d" class="jd je hi ih b ii lg im lh iq li iu lj iy lk jc ji jj jk jl bi translated">现在，让我们在集群运行后对其进行测试</li><li id="1df0" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">进入工作区，创建一个 scala 记事本</li><li id="256f" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">类型</li></ul><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="6ce7" class="ka kb hi jw b fi kc kd l ke kf">sc.version</span></pre><ul class=""><li id="eccd" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">让我们通过读取样本 json 文件来做一些数据帧测试</li></ul><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="051d" class="ka kb hi jw b fi kc kd l ke kf">val df = spark.read.json("/databricks-datasets/samples/people/people.json")<br/>display(df)</span></pre><ul class=""><li id="8fea" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">现在让我们做更多的数据帧读取</li></ul><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="fc5c" class="ka kb hi jw b fi kc kd l ke kf">val diamonds = spark.read.format("csv")<br/>  .option("header", "true")<br/>  .option("inferSchema", "true")<br/>  .load("/databricks-datasets/Rdatasets/data-001/csv/ggplot2/diamonds.csv")<br/>display(diamonds)</span></pre><ul class=""><li id="d8f8" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">如果你能看到细胞运行，那么我们都设置好了。我还没有做上述性能测试，但很快就会到来。</li><li id="9cca" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">还要记住，使用上面的方法会影响性能。请适当调整您的集群</li></ul><p id="5b91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢你。请让我们知道您的意见和想法。</p><p id="2226" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">原文:<a class="ae ll" href="https://github.com/balakreshnan/Accenture/blob/master/cap/databricksnodetonodeencryption.md" rel="noopener ugc nofollow" target="_blank">https://github . com/balakreshnan/Accenture/blob/master/cap/databricksnodetonode encryption . MD</a></p></div></div>    
</body>
</html>