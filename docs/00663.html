<html>
<head>
<title>Creating a Barcode Scanner using Android Studio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Android Studio创建条形码扫描仪</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/creating-a-barcode-scanner-using-android-studio-71cff11800a2?source=collection_archive---------1-----------------------#2019-08-24">https://medium.com/analytics-vidhya/creating-a-barcode-scanner-using-android-studio-71cff11800a2?source=collection_archive---------1-----------------------#2019-08-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="08c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Android Studio构建条形码扫描应用程序的分步指南。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="7a29" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">这篇文章是关于什么</h1><p id="2bdb" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">本文将指导您创建一个android应用程序，您可以使用移动相机扫描条形码并读取其中的数据。</p><h2 id="8ab3" class="kn jl hi bd jm ko kp kq jq kr ks kt ju iq ku kv jy iu kw kx kc iy ky kz kg la bi translated">先决条件</h2><ol class=""><li id="81a2" class="lb lc hi ih b ii ki im kj iq ld iu le iy lf jc lg lh li lj bi translated">安装了最新版本的Android Studio。(<a class="ae lk" href="https://developer.android.com/studio" rel="noopener ugc nofollow" target="_blank">从此处下载</a>)</li><li id="ff4d" class="lb lc hi ih b ii ll im lm iq ln iu lo iy lp jc lg lh li lj bi translated">测试应用程序的移动设备。(你可以使用内置的android模拟器，但在一些电脑上，它可能会导致一些问题。)</li><li id="43d1" class="lb lc hi ih b ii ll im lm iq ln iu lo iy lp jc lg lh li lj bi translated">java或任何面向对象编程语言的知识。</li></ol><h2 id="d990" class="kn jl hi bd jm ko kp kq jq kr ks kt ju iq ku kv jy iu kw kx kc iy ky kz kg la bi translated">让我们写一些代码</h2><ol class=""><li id="31b7" class="lb lc hi ih b ii ki im kj iq ld iu le iy lf jc lg lh li lj bi translated">在android studio中创建一个新的应用程序，并将其命名为条形码扫描仪。</li><li id="fd16" class="lb lc hi ih b ii ll im lm iq ln iu lo iy lp jc lg lh li lj bi translated">打开你的应用程序级Gradle文件，在那里添加下面的依赖项。</li></ol><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="527e" class="kn jl hi lv b fi lz ma l mb mc">implementation 'com.google.android.gms:play-services-vision:11.0.2'</span></pre><p id="2a44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.现在点击“立即同步”按钮，等待构建完成。构建完成后，打开您的清单文件并添加必要的权限。</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="1e6f" class="kn jl hi lv b fi lz ma l mb mc">&lt;uses-permission android:name="android.permission.CAMERA" /&gt;<br/>&lt;uses-permission android:name="android.permission.INTERNET" /&gt;</span></pre><p id="af48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，在清单文件中添加元数据字段，位于应用程序标记内，活动标记之上。</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="f09d" class="kn jl hi lv b fi lz ma l mb mc">&lt;meta-data<br/>    android:name="com.google.android.gms.vision.DEPENDENCIES"<br/>    android:value="barcode" /&gt;</span></pre><p id="ba9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我的清单文件的完整视图</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="e1e4" class="kn jl hi lv b fi lz ma l mb mc">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:tools="http://schemas.android.com/tools"<br/>    package="com.example.barcodescanner"&gt;<br/><br/>    &lt;uses-permission android:name="android.permission.CAMERA" /&gt;<br/>    &lt;uses-permission android:name="android.permission.INTERNET" /&gt;<br/><br/><br/>    &lt;uses-feature<br/>        android:name="android.hardware.camera"<br/>        android:required="true" /&gt;<br/><br/>    &lt;application<br/>        android:allowBackup="true"<br/>        android:icon="@mipmap/ic_launcher"<br/>        android:label="@string/app_name"<br/>        android:roundIcon="@mipmap/ic_launcher_round"<br/>        android:supportsRtl="true"<br/>        android:theme="@style/AppTheme"<br/>        tools:ignore="GoogleAppIndexingWarning"&gt;<br/><br/>        &lt;!--&lt;provider<br/>            &amp;lt;!&amp;ndash;android:name="androidx.core.content.FileProvider"<br/>            android:authorities="com.example.barcodescanner.fileprovider"<br/>            android:exported="false"<br/>            android:grantUriPermissions="true"&gt;&amp;ndash;&amp;gt;<br/><br/>        &lt;/provider&gt;--&gt;<br/>    &lt;meta-data<br/>        android:name="com.google.android.gms.vision.DEPENDENCIES"<br/>        android:value="barcode" /&gt;<br/><br/>        &lt;activity android:name=".MainActivity"&gt;<br/>            &lt;intent-filter&gt;<br/>                &lt;action android:name="android.intent.action.MAIN" /&gt;<br/><br/>                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;<br/>            &lt;/intent-filter&gt;<br/>        &lt;/activity&gt;<br/>    &lt;/application&gt;<br/><br/>&lt;/manifest&gt;</span></pre><p id="e76f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.现在，您已经设置了条形码扫描仪工作所需的所有依赖项和所有必要的权限。让我们为应用程序构建UI。</p><p id="a422" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.打开activity_main.xml文件，并在其中编写以下代码。</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="8c4d" class="kn jl hi lv b fi lz ma l mb mc">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    xmlns:tools="http://schemas.android.com/tools"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="match_parent"<br/>    tools:context=".MainActivity"&gt;<br/><br/>    &lt;SurfaceView<br/>        android:id="@+id/surface_view"<br/>        android:layout_width="match_parent"<br/>        android:layout_height="300dp"<br/>        app:layout_constraintTop_toTopOf="parent"<br/>        app:layout_constraintLeft_toLeftOf="parent"<br/>        app:layout_constraintRight_toRightOf="parent"<br/>        android:layout_marginTop="100dp"<br/>        /&gt;<br/><br/>    &lt;TextView<br/>        android:id="@+id/barcode_text"<br/>        android:layout_width="match_parent"<br/>        android:layout_height="50dp"<br/>        android:layout_marginLeft="30dp"<br/>        android:layout_marginRight="30dp"<br/>        app:layout_constraintTop_toBottomOf="@id/surface_view"<br/>        android:layout_marginTop="50dp"<br/>        android:text="Barcode Text"<br/>        android:textSize="25sp"<br/>        android:padding="5dp"/&gt;<br/><br/>&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span></pre><p id="7025" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你的视图应该看起来像这样</p><figure class="lq lr ls lt fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es md"><img src="../Images/d282c9fa40c22a5a9b31ab9f28b56580.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zAP3ktXFukyDnnPKRXF-Tg.jpeg"/></div></div></figure><p id="9e23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们有一个在android中称为sufaceview的东西和一个textview字段来显示条形码扫描的文本。</p><p id="bf40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SurfaceView:它提供了一个嵌入在视图层次结构中的专用绘图表面。</p><p id="4178" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您已经完成了条形码应用程序的UI代码，现在让我们编写java代码来创造奇迹。</p><p id="5d31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.打开MainActivity.java文件，你会看到下面的代码。</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="dc8e" class="kn jl hi lv b fi lz ma l mb mc">public class MainActivity extends AppCompatActivity {<br/>@Override<br/>protected void onCreate(Bundle savedInstanceState) {<br/>    super.onCreate(savedInstanceState);<br/>    setContentView(R.layout.<em class="ml">activity_main</em>);<br/>}</span></pre><p id="89be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们添加一些我们自己的代码</p><p id="fab9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.首先，我们需要绑定视图。</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="9117" class="kn jl hi lv b fi lz ma l mb mc">public class MainActivity extends AppCompatActivity {<br/><br/><br/>    private SurfaceView surfaceView;<br/>    private BarcodeDetector barcodeDetector;<br/>    private CameraSource cameraSource;<br/>    private static final int <em class="ml">REQUEST_CAMERA_PERMISSION </em>= 201;<br/>    //This class provides methods to play DTMF tones<br/>    private ToneGenerator toneGen1;<br/>    private TextView barcodeText;<br/>    private String barcodeData;<br/><br/><br/><br/>    @Override<br/>    protected void onCreate(Bundle savedInstanceState) {<br/>        super.onCreate(savedInstanceState);<br/>        setContentView(R.layout.<em class="ml">activity_main</em>);<br/>        toneGen1 = new ToneGenerator(AudioManager.<em class="ml">STREAM_MUSIC</em>,     100);<br/>        surfaceView = findViewById(R.id.<em class="ml">surface_view</em>);<br/>        barcodeText = findViewById(R.id.<em class="ml">barcode_text</em>);<br/>    }</span></pre><p id="1d64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8.现在我们将编写方法来扫描图像中的条形码。</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="e23d" class="kn jl hi lv b fi lz ma l mb mc">private void initialiseDetectorsAndSources() {<br/><br/>    //Toast.makeText(getApplicationContext(), "Barcode scanner started", Toast.LENGTH_SHORT).show();<br/><br/>    barcodeDetector = new BarcodeDetector.Builder(this)<br/>            .setBarcodeFormats(Barcode.<em class="ml">ALL_FORMATS</em>)<br/>            .build();<br/><br/>    cameraSource = new CameraSource.Builder(this, barcodeDetector)<br/>            .setRequestedPreviewSize(1920, 1080)<br/>            .setAutoFocusEnabled(true) //you should add this feature<br/>            .build();<br/><br/>    surfaceView.getHolder().addCallback(new SurfaceHolder.Callback() {<br/>        @Override<br/>        public void surfaceCreated(SurfaceHolder holder) {<br/>            try {<br/>                if (ActivityCompat.<em class="ml">checkSelfPermission</em>(MainActivity.this, Manifest.permission.<em class="ml">CAMERA</em>) == PackageManager.<em class="ml">PERMISSION_GRANTED</em>) {<br/>                    cameraSource.start(surfaceView.getHolder());<br/>                } else {<br/>                    ActivityCompat.<em class="ml">requestPermissions</em>(MainActivity.this, new<br/>                            String[]{Manifest.permission.<em class="ml">CAMERA</em>}, <em class="ml">REQUEST_CAMERA_PERMISSION</em>);<br/>                }<br/><br/>            } catch (IOException e) {<br/>                e.printStackTrace();<br/>            }<br/><br/><br/>        }<br/><br/>        @Override<br/>        public void surfaceChanged(SurfaceHolder holder, int format, int width, int height) {<br/>        }<br/><br/>        @Override<br/>        public void surfaceDestroyed(SurfaceHolder holder) {<br/>            cameraSource.stop();<br/>        }<br/>    });<br/><br/><br/>    barcodeDetector.setProcessor(new Detector.Processor&lt;Barcode&gt;() {<br/>        @Override<br/>        public void release() {<br/>            // Toast.makeText(getApplicationContext(), "To prevent memory leaks barcode scanner has been stopped", Toast.LENGTH_SHORT).show();<br/>        }<br/><br/>        @Override<br/>        public void receiveDetections(Detector.Detections&lt;Barcode&gt; detections) {<br/>            final SparseArray&lt;Barcode&gt; barcodes = detections.getDetectedItems();<br/>            if (barcodes.size() != 0) {<br/><br/><br/>                barcodeText.post(new Runnable() {<br/><br/>                    @Override<br/>                    public void run() {<br/><br/>                        if (barcodes.valueAt(0).email != null) {<br/>                            barcodeText.removeCallbacks(null);<br/>                            barcodeData = barcodes.valueAt(0).email.address;<br/>                            barcodeText.setText(barcodeData);<br/>                            toneGen1.startTone(ToneGenerator.<em class="ml">TONE_CDMA_PIP</em>, 150);<br/>                        } else {<br/><br/>                            barcodeData = barcodes.valueAt(0).displayValue;<br/>                            barcodeText.setText(barcodeData);<br/>                            toneGen1.startTone(ToneGenerator.<em class="ml">TONE_CDMA_PIP</em>, 150);<br/><br/>                        }<br/>                    }<br/>                });<br/><br/>            }<br/>        }<br/>    });<br/>}</span></pre><p id="149e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个方法将帮助我们在XML文件中创建的textview中扫描和显示文本。</p><p id="1444" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">9.完整的java代码将如下所示。</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="fbca" class="kn jl hi lv b fi lz ma l mb mc">package com.example.barcodescanner;<br/><br/>import androidx.appcompat.app.AppCompatActivity;<br/>import androidx.core.app.ActivityCompat;<br/><br/>import android.Manifest;<br/>import android.content.pm.PackageManager;<br/>import android.media.AudioManager;<br/>import android.media.ToneGenerator;<br/>import android.os.Bundle;<br/>import android.util.SparseArray;<br/>import android.view.SurfaceHolder;<br/>import android.view.SurfaceView;<br/>import android.widget.TextView;<br/><br/>import com.google.android.gms.vision.CameraSource;<br/>import com.google.android.gms.vision.Detector;<br/>import com.google.android.gms.vision.barcode.Barcode;<br/>import com.google.android.gms.vision.barcode.BarcodeDetector;<br/><br/>import java.io.IOException;<br/><br/>public class MainActivity extends AppCompatActivity {<br/><br/><br/>    private SurfaceView surfaceView;<br/>    private BarcodeDetector barcodeDetector;<br/>    private CameraSource cameraSource;<br/>    private static final int <em class="ml">REQUEST_CAMERA_PERMISSION </em>= 201;<br/>    private ToneGenerator toneGen1;<br/>    private TextView barcodeText;<br/>    private String barcodeData;<br/><br/><br/><br/>    @Override<br/>    protected void onCreate(Bundle savedInstanceState) {<br/>        super.onCreate(savedInstanceState);<br/>        setContentView(R.layout.<em class="ml">activity_main</em>);<br/>        toneGen1 = new ToneGenerator(AudioManager.<em class="ml">STREAM_MUSIC</em>, 100);<br/>        surfaceView = findViewById(R.id.<em class="ml">surface_view</em>);<br/>        barcodeText = findViewById(R.id.<em class="ml">barcode_text</em>);<br/>        initialiseDetectorsAndSources();<br/>    }<br/><br/>    private void initialiseDetectorsAndSources() {<br/><br/>        //Toast.makeText(getApplicationContext(), "Barcode scanner started", Toast.LENGTH_SHORT).show();<br/><br/>        barcodeDetector = new BarcodeDetector.Builder(this)<br/>                .setBarcodeFormats(Barcode.<em class="ml">ALL_FORMATS</em>)<br/>                .build();<br/><br/>        cameraSource = new CameraSource.Builder(this, barcodeDetector)<br/>                .setRequestedPreviewSize(1920, 1080)<br/>                .setAutoFocusEnabled(true) //you should add this feature<br/>                .build();<br/><br/>        surfaceView.getHolder().addCallback(new SurfaceHolder.Callback() {<br/>            @Override<br/>            public void surfaceCreated(SurfaceHolder holder) {<br/>                try {<br/>                    if (ActivityCompat.<em class="ml">checkSelfPermission</em>(MainActivity.this, Manifest.permission.<em class="ml">CAMERA</em>) == PackageManager.<em class="ml">PERMISSION_GRANTED</em>) {<br/>                        cameraSource.start(surfaceView.getHolder());<br/>                    } else {<br/>                        ActivityCompat.<em class="ml">requestPermissions</em>(MainActivity.this, new<br/>                                String[]{Manifest.permission.<em class="ml">CAMERA</em>}, <em class="ml">REQUEST_CAMERA_PERMISSION</em>);<br/>                    }<br/><br/>                } catch (IOException e) {<br/>                    e.printStackTrace();<br/>                }<br/><br/><br/>            }<br/><br/>            @Override<br/>            public void surfaceChanged(SurfaceHolder holder, int format, int width, int height) {<br/>            }<br/><br/>            @Override<br/>            public void surfaceDestroyed(SurfaceHolder holder) {<br/>                cameraSource.stop();<br/>            }<br/>        });<br/><br/><br/>        barcodeDetector.setProcessor(new Detector.Processor&lt;Barcode&gt;() {<br/>            @Override<br/>            public void release() {<br/>                // Toast.makeText(getApplicationContext(), "To prevent memory leaks barcode scanner has been stopped", Toast.LENGTH_SHORT).show();<br/>            }<br/><br/>            @Override<br/>            public void receiveDetections(Detector.Detections&lt;Barcode&gt; detections) {<br/>                final SparseArray&lt;Barcode&gt; barcodes = detections.getDetectedItems();<br/>                if (barcodes.size() != 0) {<br/><br/><br/>                    barcodeText.post(new Runnable() {<br/><br/>                        @Override<br/>                        public void run() {<br/><br/>                            if (barcodes.valueAt(0).email != null) {<br/>                                barcodeText.removeCallbacks(null);<br/>                                barcodeData = barcodes.valueAt(0).email.address;<br/>                                barcodeText.setText(barcodeData);<br/>                                toneGen1.startTone(ToneGenerator.<em class="ml">TONE_CDMA_PIP</em>, 150);<br/>                            } else {<br/><br/>                                barcodeData = barcodes.valueAt(0).displayValue;<br/>                                barcodeText.setText(barcodeData);<br/>                                toneGen1.startTone(ToneGenerator.<em class="ml">TONE_CDMA_PIP</em>, 150);<br/><br/>                            }<br/>                        }<br/>                    });<br/><br/>                }<br/>            }<br/>        });<br/>    }<br/><br/><br/>    @Override<br/>    protected void onPause() {<br/>        super.onPause();<br/>        getSupportActionBar().hide();<br/>        cameraSource.release();<br/>    }<br/><br/>    @Override<br/>    protected void onResume() {<br/>        super.onResume();<br/>        getSupportActionBar().hide();<br/>        initialiseDetectorsAndSources();<br/>    }<br/><br/>}</span></pre><p id="ac7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在尝试扫描这个条形码，您将在textview中看到条形码中嵌入的值。</p><figure class="lq lr ls lt fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es mm"><img src="../Images/b82fe88faf64fe9478068a3cf52e7b80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LJHoB-2ybBef3RV8LV3OcA.png"/></div></div></figure><p id="d0ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最终的屏幕应该是这样的。</p><figure class="lq lr ls lt fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es md"><img src="../Images/04841b73f779cd6d79b651c6a40640d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BokiEQk-z-4ho9crFIz-nQ.jpeg"/></div></div></figure><h1 id="90db" class="jk jl hi bd jm jn mn jp jq jr mo jt ju jv mp jx jy jz mq kb kc kd mr kf kg kh bi translated">谢谢你。</h1></div></div>    
</body>
</html>