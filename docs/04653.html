<html>
<head>
<title>Harry Potter cloak of invisibility with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">《哈利·波特》蟒蛇皮隐身衣</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/harry-potter-cloak-of-invisibility-with-python-9fdfa06b338?source=collection_archive---------15-----------------------#2020-03-27">https://medium.com/analytics-vidhya/harry-potter-cloak-of-invisibility-with-python-9fdfa06b338?source=collection_archive---------15-----------------------#2020-03-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="bd66" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">了解如何使用Python构建HP斗篷</h2></div><p id="0ecc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">隐身衣是一件神奇的神器，用来让穿戴者隐形。我敢肯定，你会看到或听说过哈利波特的斗篷，他穿的隐形。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es jt"><img src="../Images/48be842f81e4708ec9233a9767bc6725.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/1*N9PYeh-hpM77pJPuPVJYBA.gif"/></div></figure><p id="d1bc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">几天前，当我看到这张gif时，我非常兴奋地使用计算机视觉来构建类似的东西。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es kb"><img src="../Images/d8e2fea2f0e92e94329793cc9adfac69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*L5GPoPFtSWYbvjz8A0lrbw.gif"/></div></figure><p id="444c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是我用几行代码生成的结果</p><blockquote class="kc"><p id="f67c" class="kd ke hi bd kf kg kh ki kj kk kl js dx translated"><em class="km">兴奋到可以用Python制作自己的斗篷？开始吧！</em></p></blockquote><p id="5b8f" class="pw-post-body-paragraph ix iy hi iz b ja kn ij jc jd ko im jf jg kp ji jj jk kq jm jn jo kr jq jr js hb bi translated">我们将使用Python中的OpenCV库来实现这一点。</p><p id="a816" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">第一步:设置环境</strong></p><pre class="ju jv jw jx fd ks kt ku kv aw kw bi"><span id="124b" class="kx ky hi kt b fi kz la l lb lc">pip install opencv-python==4.1.2.30<br/>import cv2<br/>import numpy as np</span></pre><p id="61a6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">第二步:检查你将要使用的相机</strong></p><pre class="ju jv jw jx fd ks kt ku kv aw kw bi"><span id="71c9" class="kx ky hi kt b fi kz la l lb lc">capture = cv2.VideoCapture(0)<br/> <br/>while(True):<br/>    ret, frame = capture.read()<br/>    cv2.imshow('video', frame)<br/>    if cv2.waitKey(1) == 27:<br/>        break<br/> <br/>capture.release()<br/>cv2.destroyAllWindows()</span></pre><p id="e66a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里VideoCapture中的“0”表示使用笔记本电脑摄像头，等待键的<em class="ld"> 27 </em>表示按下“esc”停止视频，因为<em class="ld"> 27 </em>是“esc”键。</p><p id="db52" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">第三步:</strong> <strong class="iz hj">定义斗篷的颜色，并将其捕捉到帧中</strong></p><p id="e8f7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里我们将使用蓝色，并将使用颜色的HSV值，而不是RBG，因为HSV值对光照不太敏感。</p><p id="e1cb" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要找到定义颜色的HSV值，我们可以使用这个技巧:</p><pre class="ju jv jw jx fd ks kt ku kv aw kw bi"><span id="a560" class="kx ky hi kt b fi kz la l lb lc">blue = np.uint8([[[255,0,0 ]]])<br/>hsv_blue = cv2.cvtColor(blue,cv2.COLOR_BGR2HSV)<br/>print (hsv_blue)</span></pre><p id="3c5f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">输出:[[120 255 255]]</p><p id="86b0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们先用一张图片试试</p><pre class="ju jv jw jx fd ks kt ku kv aw kw bi"><span id="7ad2" class="kx ky hi kt b fi kz la l lb lc">img = cv2.imread('blue-1-mini.jpg')<br/>img2 = cv2.imread('iceland-mini.jpg')<br/>cv2.imshow('original',img)<br/>cv2.imshow('bg',img2)</span><span id="e7d7" class="kx ky hi kt b fi le la l lb lc">hsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)</span><span id="5d4f" class="kx ky hi kt b fi le la l lb lc"># define range of blue color in HSV<br/>lower_blue = np.array([110,50,50])<br/>upper_blue = np.array([130,255,255])</span><span id="0d24" class="kx ky hi kt b fi le la l lb lc"># Use the inrange function to get only blue colors<br/>mask1 = cv2.inRange(hsv, lower_blue, upper_blue)<br/>cv2.imshow('mask1',mask1)</span><span id="c438" class="kx ky hi kt b fi le la l lb lc">mask2 = cv2.bitwise_not(mask1)<br/>cv2.imshow('mask2',mask2</span></pre><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lf"><img src="../Images/e27953ce7b25de4db754af186c6496f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/1*N1wMpPZamzVlab853XsNVg.jpeg"/></div></figure><p id="c579" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如你所看到的，它完美地检测到了“原始”图像中的蓝色，并正确地屏蔽了它。</p><p id="e298" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">步骤4:将蓝色部分从帧中分割出来</strong></p><pre class="ju jv jw jx fd ks kt ku kv aw kw bi"><span id="00f4" class="kx ky hi kt b fi kz la l lb lc">## Segment the blue color part out of the frame using inverted mask<br/>res1 = cv2.bitwise_and(img,img, mask= mask2)<br/>cv2.imshow('result-mask2',res1)</span><span id="d04e" class="kx ky hi kt b fi le la l lb lc">#Create image showing static background image only for the masked region<br/>res2 = cv2.bitwise_and(img2, img2, mask = mask1)<br/>cv2.imshow('background capture',res2)</span></pre><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lg"><img src="../Images/8004c80100b7d1629c76f992854c520a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*MtLeSNL3mxch5KzTDbFL4Q.jpeg"/></div></figure><p id="03be" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">步骤5:将两个输出合并到一个帧中</strong></p><p id="ec4d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后一步是用先前保存的静态背景的像素值替换帧中检测到的蓝色区域的像素</p><pre class="ju jv jw jx fd ks kt ku kv aw kw bi"><span id="dac9" class="kx ky hi kt b fi kz la l lb lc">finalOutput = cv2.addWeighted(res1,1,res2,1,0)<br/>cv2.imshow('ouput ',finalOutput)</span></pre><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lh"><img src="../Images/f61f3a63f1c97c24ded21b057a5aea4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:518/format:webp/1*yGSIYkvR_OQU11zKXgKZ0A.png"/></div></figure><p id="83f9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们知道了在一幅图像中要采取什么步骤，我们可以对视频采取同样的步骤。</p></div><div class="ab cl li lj gp lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hb hc hd he hf"><p id="b26f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">看起来你很喜欢这篇文章！</p><ul class=""><li id="e21b" class="lp lq hi iz b ja jb jd je jg lr jk ls jo lt js lu lv lw lx bi translated">完整的代码，你可以在这里找到Jupyter笔记本<a class="ae ly" href="https://github.com/divensambhwani/HP-CLOAK/blob/master/HP%20CLOAK.ipynb" rel="noopener ugc nofollow" target="_blank">。</a></li></ul><p id="d5c8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">编码快乐！</p></div><div class="ab cl li lj gp lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hb hc hd he hf"><h2 id="23a0" class="kx ky hi bd lz ma mb mc md me mf mg mh jg mi mj mk jk ml mm mn jo mo mp mq mr bi translated">参考资料:</h2><p id="4a63" class="pw-post-body-paragraph ix iy hi iz b ja ms ij jc jd mt im jf jg mu ji jj jk mv jm jn jo mw jq jr js hb bi translated">[1]<a class="ae ly" href="https://docs.opencv.org/2.4/" rel="noopener ugc nofollow" target="_blank">https://docs.opencv.org/2.4/</a></p></div></div>    
</body>
</html>