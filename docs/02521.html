<html>
<head>
<title>A Guide To Build Your Own Custom Object Detector Using YoloV3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用YoloV3构建自定义对象检测器的指南</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/custom-object-detection-with-yolov3-8f72fe8ced79?source=collection_archive---------0-----------------------#2019-12-21">https://medium.com/analytics-vidhya/custom-object-detection-with-yolov3-8f72fe8ced79?source=collection_archive---------0-----------------------#2019-12-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/74e9c3528bbac6ded50f7dcee83a6483.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*onPymLIQSe60d1ln89w2gA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">目标探测</figcaption></figure><p id="a2cf" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在本文中，我将向您展示如何使用YoloV3创建您自己的自定义对象检测器。</p><p id="a6c7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我假设你已经知道深度学习计算机视觉的基本知识。</p><p id="e369" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我打算在我自己的GPU上训练我的模型。</p><p id="5bbb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">需要的步骤有:</strong></p><ol class=""><li id="8735" class="js jt hi iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">收集数据</li><li id="a5b8" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">转换为YoloV3格式</li><li id="e302" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">设置培训渠道</li><li id="20c7" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">培训模式</li><li id="3c70" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">导出权重文件。</li><li id="6afc" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">测试对象检测器</li></ol><h1 id="f698" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">1.收集数据</h1><p id="673a" class="pw-post-body-paragraph iu iv hi iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr hb bi translated">我们将从<a class="ae lj" href="https://storage.googleapis.com/openimages/web/visualizer/index.html?set=train&amp;type=detection&amp;c=%2Fm%2F0k5j" rel="noopener ugc nofollow" target="_blank"> OpenImagesV5 </a>获取数据。它于2016年首次推出，是一个合作发布，包含约900万张图片，标注了覆盖数千种对象类别的标签。新版本是对2018年<a class="ae lj" href="https://storage.googleapis.com/openimages/web/factsfigures_v4.html" rel="noopener ugc nofollow" target="_blank">公开图像V4 </a>的更新。</p><p id="68b1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Open Image V5为350个类别中的280万个对象的图像分割遮罩新增了注释。与仅识别对象所在的大致区域的边界框不同，这些图像分割掩模跟踪目标对象的轮廓，以更高的细节水平表征其空间范围。</p><p id="866d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我将从OpenImagesV5中选择4个类别，即<em class="lk">背包、手表、书和耳机</em>。你想选多少就选多少。</p><p id="2bbb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们必须先下载那些图像。GitHub 有一个很棒的<a class="ae lj" href="https://github.com/pythonlessons/OIDv4_ToolKit" rel="noopener ugc nofollow" target="_blank">工具包，里面有如何使用它的完整解释。这个工具包将帮助我们下载图像。工具包的安装很容易。</a><a class="ae lj" href="https://pylessons.com/YOLOv3-introduction/" rel="noopener ugc nofollow" target="_blank">这个家伙</a>写了一个使用yolov3使用Keras检测自定义对象的教程。你可以去看看，他已经解释了所有的步骤。在我的帖子中，我将使用PyTorch，并尽可能简化事情。</p><ol class=""><li id="1548" class="js jt hi iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated"><strong class="iw hj">下载工具包</strong></li></ol><p id="f136" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先，打开您的终端并克隆工具包存储库</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="648e" class="lu kh hi lq b fi lv lw l lx ly">git clone <a class="ae lj" href="https://github.com/pythonlessons/OIDv4_ToolKit.git" rel="noopener ugc nofollow" target="_blank">https://github.com/pythonlessons/OIDv4_ToolKit.git</a></span></pre><p id="c4c6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后去文件夹旁</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="20e4" class="lu kh hi lq b fi lv lw l lx ly">cd OIDv4_ToolKit</span></pre><p id="17c3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">通过以下方式安装所有依赖项</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="c58c" class="lu kh hi lq b fi lv lw l lx ly">pip3 install -r requirements.txt</span></pre><p id="27bb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> 2。使用工具箱</strong> <strong class="iw hj"> &amp;下载数据</strong></p><p id="74f7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先如何检查我们是否可以下载我们需要的合适的图像类？你需要进入OIDv5主页，点击“探索”,在搜索标签中找到你想要的课程。在我的例子中，我将搜索“手表”、“背包”、“书”和“耳机”。要下载它们，你只需运行</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="1836" class="lu kh hi lq b fi lv lw l lx ly">python3 main.py downloader --classes Watch Backpack Book Headphones --type_csv train --multiclasses 1 --limit 600</span></pre><p id="c3ee" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">使用这个命令，每个班级的600个训练图像将被下载。如果您是第一次使用，它会要求您下载(训练-注释-bbox或测试-注释-bbox) CSV文件。在运行命令时键入Y，以便下载该命令。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/921881329e01fcca5d6baf31b06f369c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v6VwiQJ70zIWgKWt_VUViQ.png"/></div></div></figure><p id="3d3d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你需要等待一段时间来完成下载。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/3a767c846ef6f908c20a74b5976c287b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y95aRGCablwt0NGEy8Od2A.png"/></div></div></figure><p id="ef63" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是文件夹结构:</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="55ed" class="lu kh hi lq b fi lv lw l lx ly">main_folder<br/>│   - main.py<br/>│   - oid_to_pascal_voc_xml.py<br/>│   ..<br/>└─── OID<br/>    │<br/>    └─── csv_folder<br/>    │   │<br/>    │   └─── class-descriptions-boxable.csv<br/>    │   │<br/>    │   └─── test-annotations-bbox.csv<br/>    │   │<br/>    │   └─── train-annotations-bbox.csv<br/>    └─── OID<br/>        │<br/>        └─── Dataset<br/>            │<br/>            └─── train<br/>                │<br/>                └─── Watch_Backpack_Book_Headphones0</span></pre><h1 id="7b7c" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">3.转换为YoloV3格式</h1><p id="e5f7" class="pw-post-body-paragraph iu iv hi iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr hb bi translated">打开<code class="du ma mb mc lq b">oid_to_pascal_voc_xml.py</code>并编辑第9行，然后</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="9d1f" class="lu kh hi lq b fi lv lw l lx ly">XML_DIR = 'TO_PASCAL_XML'</span></pre><p id="4afe" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在你需要跑</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="3e98" class="lu kh hi lq b fi lv lw l lx ly">python3 oid_to_pascal_voc_xml.py</span></pre><p id="2d8f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">以生成XML格式的对象坐标。运行上述文件后，您将在TO_PASCAL_XML文件夹中获得XML格式的对象标签文件。</p><p id="7fcc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">同样，我们需要将它转换成YoloV3格式。</p><p id="1f06" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要训练Yolo模型，需要满足以下要求:如何制作注释文件:</p><ul class=""><li id="7674" class="js jt hi iw b ix iy jb jc jf ju jj jv jn jw jr md jy jz ka bi translated">一个图像一行；</li><li id="b5c2" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr md jy jz ka bi translated">行格式:image _ file _ path box 1 box 2…boxN；</li><li id="9874" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr md jy jz ka bi translated">框格式:x_min，y_min，x_max，y_max，class_id(无空格)。</li></ul><p id="3718" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里有一个例子:</p><ul class=""><li id="0858" class="js jt hi iw b ix iy jb jc jf ju jj jv jn jw jr md jy jz ka bi translated">path/to/img1.jpg 50，100，150，200，0 30，50，200，120，3</li><li id="4be1" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr md jy jz ka bi translated">path/to/img2.jpg 120，300，250，600，4 …</li></ul><p id="9266" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在你将不得不用这些做一些小工作。请耐心等待，现在需要一些手工操作。</p><p id="2d85" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我将使用<a class="ae lj" href="https://github.com/ultralytics/yolov3" rel="noopener ugc nofollow" target="_blank"> Ultralytics </a>的代码来训练我们的YoloV3模型。一定要检查他们的仓库，这很好。我对文件夹结构做了一些修改，都是为了我们自己的模型。现在克隆我的存储库，以进行下一步。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="3b1e" class="lu kh hi lq b fi lv lw l lx ly">git clone <a class="ae lj" href="https://github.com/TheCaffeineDev/YoloV3-Custom-Object-Detection.git" rel="noopener ugc nofollow" target="_blank">https://github.com/TheCaffeineDev/YoloV3-Custom-Object-Detection.git</a></span></pre><p id="6f45" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是文件夹结构</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="6df0" class="lu kh hi lq b fi lv lw l lx ly">main_folder<br/>│   - detect.py<br/>│   - models.py<br/>│   - train.py<br/>│  - test.py<br/>│  - requirements.txt<br/>│  ...<br/>└─── cfg<br/>└─── conversion<br/>    │<br/>    └─── output<br/>    └─── xmls<br/>    │  - classes.txt<br/>    │  - xmltotxt.py<br/>    │  ...<br/>└─── data<br/>└─── training<br/>│ │<br/>│ └─── images<br/>│ └─── labels<br/>│ - object.names<br/>│ - trainer.data<br/>│ - yolov3.cfg<br/>│ - train_test.py<br/>│<br/>└─── utils<br/>└─── weights</span></pre><p id="62c1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，在主文件夹中，并在您的终端中运行它来安装所有需要的依赖项。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="1461" class="lu kh hi lq b fi lv lw l lx ly">pip3 install -r requirements.txt</span></pre><p id="3998" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后您必须返回到OIDV4_Toolkit文件夹<code class="du ma mb mc lq b">OIDv4_ToolKit/OID/Dataset/train/Watch_Backpack_Book_Headphones/</code>。这里你需要将所有的图片复制到我们的克隆库<code class="du ma mb mc lq b">/YoloV3-Custom-Object-Detection/training/images</code>的以下文件夹中</p><p id="e6b4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您需要将文件夹中的所有XML文件复制到<code class="du ma mb mc lq b">/YoloV3-Custom-Object-Detection/conversion/xmls</code>文件夹中。不要对以上这些步骤感到困惑。</p><p id="5a34" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">复制后，转到<code class="du ma mb mc lq b">conversion</code>文件夹。您需要编辑<code class="du ma mb mc lq b">classes.txt</code>文件，并将您自己的类放在那里。</p><p id="e4a5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">看起来是这样的:</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es me"><img src="../Images/7eadeb937c51cf32f94c32074305ac09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*GGorOPsvT93cLvjIil-OQA.png"/></div></figure><p id="2df0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在在转换文件夹运行</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="9115" class="lu kh hi lq b fi lv lw l lx ly"># In YoloV3-Custom-Object-Detection/conversion folder<br/>python3 xmltotxt.py -xml xmls -out output</span></pre><p id="defe" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这将在输出文件夹中生成yolov3格式的所有标签文件。</p><h1 id="60cf" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">3.设置培训渠道</h1><p id="5a47" class="pw-post-body-paragraph iu iv hi iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr hb bi translated">现在你必须将<code class="du ma mb mc lq b">YoloV3-Custom-Object-Detection/conversion/output</code>文件夹中的所有<code class="du ma mb mc lq b">.txt</code>文件复制到<code class="du ma mb mc lq b">YoloV3-Custom-Object-Detection/training/labels</code>文件夹中。</p><p id="f4e9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在转到<code class="du ma mb mc lq b">YoloV3-Custom-Object-Detection/training</code>文件夹。现在我们将在这里编辑一些文件。现在打开那个<code class="du ma mb mc lq b">object.names</code>文件，用你自己的类编辑它。</p><p id="4060" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在在</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="47c2" class="lu kh hi lq b fi lv lw l lx ly"># In YoloV3-Custom-Object-Detection/training folder<br/>python3 train_test.py</span></pre><p id="e6c8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面这个文件会生成<code class="du ma mb mc lq b">train.txt</code>和<code class="du ma mb mc lq b">test.txt</code>。您可以打开并检查文件以了解更多详细信息。基本上，我们将70% &amp; 30%分别用于培训和测试。</p><p id="d27e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后打开<code class="du ma mb mc lq b">trainer.data</code>。看起来是这样的。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/03d9e680596c21b0d73402d06e81b954.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ad6DAmFRAk56BMaSTyErEQ.png"/></div></div></figure><p id="c6b7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你需要在第一行输入你的班级号，<code class="du ma mb mc lq b">train.txt</code>和<code class="du ma mb mc lq b">test.txt</code>路径在第二和第三行，<code class="du ma mb mc lq b">object.names</code>路径在第四行。</p><p id="db08" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在您需要编辑<code class="du ma mb mc lq b"><strong class="iw hj">*.cfg</strong></code>文件。默认情况下，每个YOLO层有255个输出:每个锚点85个输出[4个框坐标+ 1个对象置信度+ 80个类别置信度]，乘以3个锚点。</p><p id="b8f3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在我们的例子中，我们只使用了四个类，然后我们需要编辑过滤器。您可以将过滤器减少到<code class="du ma mb mc lq b">filters=[4 + 1 + n] * 3</code>，其中<code class="du ma mb mc lq b">n</code>是您的类计数。这种修改应该在三个YOLO层的每一层之前进行。此外，修改<code class="du ma mb mc lq b">classes=80</code>到<code class="du ma mb mc lq b">classes=n</code>在每个YOLO层，其中<code class="du ma mb mc lq b">n</code>是你的类计数。</p><p id="1225" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在我们的案例中，在<code class="du ma mb mc lq b">yolov3.cfg</code>文件中，我更改了第<strong class="iw hj"> 6 </strong>和<strong class="iw hj"> 7 </strong>行中的批次大小&amp;细分。然后是行号<strong class="iw hj"> 610 </strong>(类=4)和<strong class="iw hj"> 603 </strong>(过滤器=27)，然后是行号<strong class="iw hj"> 689 </strong> &amp; <strong class="iw hj"> 696 </strong>，最后是行号<strong class="iw hj">776</strong>&amp;783。如果您使用tiny-yolo，行号会有所不同。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es mg"><img src="../Images/8f2dc02af3794b1a561d375eb664a725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*ad73ZBRiRep_M6KnUVpxJA.png"/></div></figure><p id="034d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在我们准备训练我们的yolov3模型。</p><h1 id="405f" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">4.培训模式</h1><p id="2fbc" class="pw-post-body-paragraph iu iv hi iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr hb bi translated">下面是我的桌面规范，我将在其中训练我的模型。</p><ul class=""><li id="a270" class="js jt hi iw b ix iy jb jc jf ju jj jv jn jw jr md jy jz ka bi translated"><strong class="iw hj">GPU:</strong>NVIDIA GeForce RTX<em class="lk">2080超级</em> (8GB)</li><li id="e9de" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr md jy jz ka bi translated"><strong class="iw hj">内存:</strong> 16GB DDR4</li><li id="718f" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr md jy jz ka bi translated">操作系统:Ubuntu 18.04</li></ul><p id="32b6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在在<code class="du ma mb mc lq b">YoloV3-Custom-Object-Detection</code>文件夹中打开终端并运行</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="5ec2" class="lu kh hi lq b fi lv lw l lx ly"># In YoloV3-Custom-Object-Detection run</span><span id="58bc" class="lu kh hi lq b fi mh lw l lx ly">python3 train.py --epochs 110 --data training/trainer.data --cfg training/yolov3.cfg --batch 16 --accum 1</span></pre><p id="0cf6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">那里有可选的参数，你可以签入<code class="du ma mb mc lq b">train.py</code>文件。</p><p id="c55e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">此外，您还可以在<code class="du ma mb mc lq b">train.py</code>中为您的特定任务<strong class="iw hj">更新超参数</strong>，如LR、LR调度程序、优化程序、增强设置、multi_scale设置等。我建议你先从所有默认设置开始更新。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/c436d1f4cbcfff93b00215c6ae23d947.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UCUL67zP_QKAiL1QVKwKdg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">模特培训</figcaption></figure><p id="0508" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要在训练时运行tensorboard，请打开另一个终端并运行</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="7bfd" class="lu kh hi lq b fi lv lw l lx ly"># In YoloV3-Custom-Object-Detection do<br/>tensorboard --logdir=runs</span></pre><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/c5e6231ac2edcdebad3f79c3fc589e83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z4fVasaZVg-8fKBvGrQhQA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">张量板</figcaption></figure><p id="f145" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我花了2个小时，用110个历元训练了4个对象。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/318ce3b1b27f6eef25da0d66c6c89819.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HJ2LkwSQoMNMga2s02lppA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">结果</figcaption></figure><p id="1cde" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你按照上面的步骤去做，你就能适当地训练出你自己的模型。</p><h1 id="e840" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">5.导出权重文件。</h1><p id="46d0" class="pw-post-body-paragraph iu iv hi iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr hb bi translated">训练完模型后，我们可以在weights文件夹中获得权重文件。它是<code class="du ma mb mc lq b">PyTorch</code>模型格式的。我们需要把它转换成<code class="du ma mb mc lq b">darknet</code>格式来测试它。先换算一下吧。打开终端运行</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="e7bb" class="lu kh hi lq b fi lv lw l lx ly"># convert cfg/pytorch model to darknet weights<br/># In YoloV3-Custom-Object-Detection<br/>python3  -c "from models import *; convert('training/yolov3.cfg', 'weights/best.pt')"<br/>​</span></pre><p id="0387" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您将在转换后获得此消息。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="cb2f" class="lu kh hi lq b fi lv lw l lx ly">Success: converted 'weights/yolov3-spp.pt' to 'converted.weights'</span></pre><p id="b3a2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在我们将测试我们的对象检测器。您将在<code class="du ma mb mc lq b">YoloV3-Custom-Object-Detection</code>文件夹中拥有<code class="du ma mb mc lq b">converted.weights</code>。</p><h1 id="5c3f" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">6.测试对象检测器</h1><p id="82b4" class="pw-post-body-paragraph iu iv hi iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr hb bi translated">现在要运行推理，打开您的终端并运行</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="f46c" class="lu kh hi lq b fi lv lw l lx ly"># In YoloV3-Custom-Object-Detection - for webcam<br/>python3 detect.py --source 0 --weights converted.weights --cfg training/yolov3.cfg --names training/object.names --img-size 416</span></pre><p id="856f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">详情请查看<code class="du ma mb mc lq b">detect.py</code>。</p><ul class=""><li id="7b72" class="js jt hi iw b ix iy jb jc jf ju jj jv jn jw jr md jy jz ka bi translated">图片:<code class="du ma mb mc lq b">--source file.jpg</code></li><li id="29f0" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr md jy jz ka bi translated">视频:<code class="du ma mb mc lq b">--source file.mp4</code></li><li id="6edb" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr md jy jz ka bi translated">目录:<code class="du ma mb mc lq b">--source dir/</code></li><li id="ee1f" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr md jy jz ka bi translated">网络摄像头:<code class="du ma mb mc lq b">--source 0</code></li><li id="3e57" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr md jy jz ka bi translated">RTSP流:<code class="du ma mb mc lq b">--source rtsp://192.168.0.1/rtp/470011235daa</code></li></ul><p id="3248" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下面你可以看到一些图像推论:</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/768536a4bc2c16ec3c770eaeab163dae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j9bQAdEsreFZdeANP1SBjA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">推理</figcaption></figure><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/b754fff5d7134128c0bb1d4897d39d0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d0SYwqCVEvakEHKHR_HaOA.jpeg"/></div></div></figure><p id="af0e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">由于GitHub文件大小的限制，我无法上传到GitHub。如果你想测试我的体重文件，你可以通过</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="b107" class="lu kh hi lq b fi lv lw l lx ly">wget <a class="ae lj" href="https://www.dropbox.com/s/tou8f0xvs8wdt8a/converted.weights?dl=0" rel="noopener ugc nofollow" target="_blank">https://www.dropbox.com/s/903xy5ba5htitga/converted.weights</a></span></pre><p id="2938" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">到存储库的链接:<a class="ae lj" href="https://github.com/TheCaffeineDev/YoloV3-Custom-Object-Detection" rel="noopener ugc nofollow" target="_blank">https://github . com/TheCaffeineDev/yolo v3-Custom-Object-Detection</a></p><p id="f021" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您想标记您自己的自定义图像，您可以使用<a class="ae lj" href="https://github.com/tzutalin/labelImg" rel="noopener ugc nofollow" target="_blank"> LabelImg </a>。训练的过程和所有的几乎一样。</p><p id="d7ae" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您有任何问题、建议或批评，可以通过<a class="ae lj" href="https://twitter.com/thecaffeinedev" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或通过我的<a class="ae lj" href="mailto:prabhat1015@gmail.com" rel="noopener ugc nofollow" target="_blank">邮件</a>联系我。请随时联系我。</p><p id="8dca" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="lk">原贴于我的</em> <a class="ae lj" href="https://thecodemonk.in/software/object-detection-yolov3" rel="noopener ugc nofollow" target="_blank"> <em class="lk">博客</em> </a> <em class="lk">。</em></p><p id="6d7e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> <em class="lk">【谢谢】</em> </strong></p><h1 id="136d" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">证明人和信用</h1><ol class=""><li id="1ae3" class="js jt hi iw b ix le jb lf jf mn jj mo jn mp jr jx jy jz ka bi translated"><a class="ae lj" rel="noopener" href="/syncedreview/google-releases-open-image-v5-launches-open-image-challenge-91fa802f0edf">https://medium . com/synced review/Google-releases-open-image-V5-launches-open-image-challenge-91fa 802 f 0 EDF</a></li><li id="4030" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated"><a class="ae lj" href="https://github.com/ultralytics/yolov3" rel="noopener ugc nofollow" target="_blank">https://github.com/ultralytics/yolov3</a></li><li id="4d85" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated"><a class="ae lj" href="https://pylessons.com/" rel="noopener ugc nofollow" target="_blank">https://pylessons.com/</a></li></ol></div></div>    
</body>
</html>