<html>
<head>
<title>How I achieved a 95.5% accuracy on a Kaggle Deep Learning competition</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何在Kaggle深度学习竞赛中获得95.5%的准确率</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-i-achieved-a-95-5-accuracy-on-a-kaggle-deep-learning-competition-35c96d568d7e?source=collection_archive---------15-----------------------#2020-05-05">https://medium.com/analytics-vidhya/how-i-achieved-a-95-5-accuracy-on-a-kaggle-deep-learning-competition-35c96d568d7e?source=collection_archive---------15-----------------------#2020-05-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2993" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个非常奇怪的时代。突然间，你手中有了这么多时间，以至于你真的不知道该做些什么。我写这篇博客是因为我厌倦了拖延。从没想过事情会发展到这一步，但事实就是如此。我的待办清单上有两项任务已经悬而未决很久了。第一，参加在线ML竞赛，第二，写科技博客。首先，我要感谢希亚·拉博夫激励人心的讲话。如果你缺乏动力，我建议你看看这个的视频。他睿智的话语可以激励一块岩石侵蚀得更快，只是说。</p><p id="6874" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开门见山，这个博客旨在为那些上过吴恩达的ML课程或者熟悉ML和深度学习概念但不知道从哪里开始以及如何为ML编写好代码的新手提供一些指导。我写这篇博客是因为我想到了一系列问题，以及当我遇到Kaggle挑战时我是如何回答的。</p><p id="3c81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的目标只是学习如何以正确的方式训练模型，用最佳的编码实践组织我的代码，并希望在这个过程中达到良好的准确性。我发现了一个有趣的挑战，叫做康奈尔大学主办的植物病理学挑战。问题陈述看起来相当简单，是一个很好的挑战。Kaggle中描述的问题的目标如下</p><p id="659e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">TL；大卫:给定一张叶子的图像，你必须诊断植物的健康状况。将其分为4类:健康、多种疾病、锈病或疮痂。</strong></p><blockquote class="je jf jg"><p id="d52c" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">“植物病理学挑战”的目标是使用训练数据集的图像来训练模型，以1)将来自测试数据集的给定图像准确地分类到不同的患病类别或健康叶片；2)准确区分多种病害，有时一片叶子上不止一种；3)处理罕见类和新奇症状；4)解决深度感知——角度、光、阴影、叶子的生理年龄；以及5)在识别、注释、量化和引导计算机视觉中结合专家知识，以在学习期间搜索相关特征。”</p></blockquote><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es jl"><img src="../Images/6186db770ff97e363d68d9849f4e38e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*onB8ipTtiaXTOqHV6n9uFA.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">来自叶<a class="ae jd" href="https://arxiv.org/abs/2004.11958" rel="noopener ugc nofollow" target="_blank">数据集</a>的4个样本输出</figcaption></figure><p id="ce71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">阅读完关于挑战的文章后，我的第一反应是什么？</strong></p><p id="2410" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的第一个想法是，我必须阅读最先进的CNN模型。目前，<a class="ae jd" href="https://arxiv.org/pdf/1905.11946.pdf" rel="noopener ugc nofollow" target="_blank"> EfficientNet </a> B7已经在ImageNet数据集上取得了84.4%的最高准确率，似乎是应对这一挑战的一个非常可靠的工具。</p><p id="12bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我如何训练一个最先进的通讯网络？ <br/>从零开始训练大型ConvNets是不可取的。最先进的ConvNets很大，有大量的参数(EfficientNet-B5有3000万个参数)。最好是加载在大型数据集上训练的预训练权重，然后针对您的任务进行训练，也就是迁移学习。</p><p id="50ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">把预加应力的重量想象成房子的地基。预训练重量的训练就像是在这个基础上建造房子的其余部分。调整预训练的权重以从图像中提取重要特征。因此，当您使用自定义数据集进行训练时，模型不需要学习如何提取重要特征。特征可以像图像上的垂直线一样简单，也可以像检测图像上的汽车一样复杂。模型学习提取的内容完全取决于对网络进行预训练的数据集。因此，在像ImageNet这样的大型数据集上训练的模型是非常可靠的！</p><p id="f038" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">我如何构建我的代码？</strong></p><p id="cac6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我有两年多的软件开发专业经验。在这2年里，我学到了一些写结构良好的代码的好方法<em class="jh"> </em>。此外，我浏览了Kaggle上发布的各种jupyter笔记本和多个开源GitHub项目。每个人都有自己写代码的方式，但是大多数开发者有一个总的趋势。我遵循对我有意义的结构。我已经用这个结构开发了植物病理学挑战的代码库。希望这对你也有意义。:)</p><p id="62b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我遵循的结构</p><blockquote class="je jf jg"><p id="43b0" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">1.把所有的超参数和常数放在开始的地方</p></blockquote><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="9bd0" class="kg kh hi kc b fi ki kj l kk kl">batch_size = 16<br/>epoch = 50<br/>model_name = 'efficientnet-b5'<br/>image_size = EfficientNet.get_image_size(model_name)<br/>device = torch.device("cuda:0" if torch.cuda.is_available() else "cpu")</span></pre><p id="8831" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是很有帮助的，因为你可以很容易地从一个地方改变你的超参数，把它放在一个地方是很好的，因为你会做整个超参数调整。</p><blockquote class="je jf jg"><p id="e837" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">2.为数据集创建自定义类，并定义满足您需求的函数。</p></blockquote><p id="8b14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一种非常典型的做事方式。基本上，这个想法是你创建一个自定义类，它导入数据(比如从一个csv)并进行各种转换，然后输出转换后的数据，这些数据可以输入到你的模型中。</p><p id="0af3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，我定义了一个类<em class="jh"> Dataset </em>，它根据我在创建它的对象时传递给它的参数加载训练/交叉验证/测试数据。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es km"><img src="../Images/4db7d19fa15ceefc4c900c3afd88592f.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*0TiVF4PB3TV2u4VZ6qai6w.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">类数据集的代码</figcaption></figure><p id="a259" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，我还定义了另外两个函数<em class="jh"> __next__() </em>和<em class="jh"> __iter__() </em>，这两个函数使类数据集<a class="ae jd" href="https://www.programiz.com/python-programming/iterator" rel="noopener ugc nofollow" target="_blank">的对象成为可迭代的</a>。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es kn"><img src="../Images/0882fbe4e2bfee31dd91345f334537e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*2X5bS1NyTpw604o5-gl0-g.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">使类数据集可迭代</figcaption></figure><p id="f487" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我添加了一个<em class="jh"> parse_annotations() </em>函数，它可以动态地放大图像。<a class="ae jd" href="http://cs231n.stanford.edu/reports/2017/pdfs/300.pdf" rel="noopener ugc nofollow" target="_blank">如果你想概括并防止你的模型过度适应训练数据，数据扩充</a>是必要的。查看<a class="ae jd" href="https://towardsdatascience.com/data-augmentation-for-deep-learning-4fe21d1a4eb9" rel="noopener" target="_blank">这篇</a>文章，了解各种增强库的概述。</p><blockquote class="je jf jg"><p id="0db4" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">3.初始化您的数据集</p></blockquote><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es ko"><img src="../Images/2adacd0e3959f76fce02c6d4f7bb1a31.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*gey_BLFRUBPNdpES288pfQ.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">初始化数据集</figcaption></figure><p id="f9bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:我已经将训练集80–20分成了训练集和交叉验证集。</p><blockquote class="je jf jg"><p id="b87f" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">4.定义你的损失函数</p></blockquote><p id="27d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">植物病理学挑战是一个多类分类问题。交叉熵损失最适合这种情况。幸运的是，Pytorch实现了损失函数。实现它是相当容易的。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es kp"><img src="../Images/187cdddc9127294e476c00d3d6b57c87.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*P2qptuH5nbZst4zXTbi3vw.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">损失函数</figcaption></figure><blockquote class="je jf jg"><p id="1b26" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">5.定义你的神经网络</p></blockquote><p id="f669" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通常，这是您定义自定义神经网络类的地方。我使用了EfficientNet的一个开源Pytorch实现。我已经定制了前几层来适应我的目的。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es kq"><img src="../Images/52ab4f3e8fb91a84ddb5784736908a72.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*ft-nvlGczv6dDpdkY0ROfg.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">神经网络定义</figcaption></figure><blockquote class="je jf jg"><p id="284b" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">6.定义你的优化函数</p></blockquote><p id="1c60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现代神经网络中的<em class="jh">事实上的</em>规则是学习速率衰减。它有助于优化和一般化。更多相关信息可在<a class="ae jd" href="https://arxiv.org/pdf/1908.01878.pdf" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="990f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可能已经猜到我在使用学习率衰减，因为我没有在超参数定义中定义它。我使用了一个实现余弦学习率衰减的库。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es kr"><img src="../Images/0177f7e67cb9f9f78d10199e1d97027a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HJmOpsw3Gum8U7qNUPzgaQ.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">优化功能</figcaption></figure><blockquote class="je jf jg"><p id="f0e1" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">7.定义训练和交叉验证模型的函数</p></blockquote><p id="7554" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">训练功能的任务如下:- <br/> a)将训练数据输入网络<br/> b)根据网络输出和目标数据计算损耗。<br/> c)它通过改变权重来反馈损失和调整网络。<br/> d)记录损失，用于以后制作<a class="ae jd" href="https://machinelearningmastery.com/learning-curves-for-diagnosing-machine-learning-model-performance/" rel="noopener ugc nofollow" target="_blank">训练和交叉验证损失图</a>，以了解您的模型性能。</p><p id="71f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">交叉验证功能的任务如下:- <br/> a)将交叉验证数据(无数据扩充)输入网络<br/> b)输出数据并计算损失<br/> c)不<strong class="ih hj">而</strong>训练网络<br/> d)记录交叉验证损失以制作训练和交叉验证损失图</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es ks"><img src="../Images/4f028180ba1e90abfc0bd8355e299c59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*m6eqpyScbmPLYhmEVTqyjA.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">培训和交叉验证功能</figcaption></figure><blockquote class="je jf jg"><p id="172c" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">8.训练你那该死的模型！</p></blockquote><p id="07a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们终于要回答题目中的问题了。我最初训练了一个我自己制作的神经网络。这并不新奇。它类似于AlexNet，但长度、宽度和分辨率更小。我首先在我自己的神经网络上训练，因为我想看看我的代码是否如预期的那样工作。我在测试数据集上达到了72%的准确率。为了进一步提高准确度，我在康文网上进行训练。我训练的第一个ConvNet是<a class="ae jd" href="https://arxiv.org/abs/1608.06993" rel="noopener ugc nofollow" target="_blank"> DenseNet </a>，批量为16，30个历元的学习率为0.001。我能够在交叉验证集上获得94%的准确率，在测试集上获得93%的准确率。<br/>有了最先进的EfficientNet，我的准确性有了很大提高。我在下面提到了我训练的网络列表，直到我获得了95.5 %的准确率。</p><p id="9bb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a)效率网B3，批量大小-16，分辨率-494，次数-50，余弦学习率衰减，交叉验证准确度- 94.3% <br/> b)效率网B7，批量大小-2，分辨率-494，次数-50，余弦学习率衰减，交叉验证准确度-93.44%<br/>B7的批量大小仅为2，因为它有6600万个参数，12 GB GPU因批量大小超过2而不堪重负。:(<br/> c) EfficientNet B5，批量-4，分辨率-494，历元-50，余弦学习率衰减，交叉验证准确率- 96.74%，测试准确率-95.5%</p><p id="3cfc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">目前领先的选手准确率为98.7%。我害羞了3.2%，这已经很多了！希望在下一次挑战中我能取得更好的成绩。对我的第一场比赛来说还不错吧？:)</p><p id="c3c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是艰难的时刻，到处都有很多不确定性。大多数事情都超出了我们的控制范围。我们能控制的是我们如何管理我们的时间，以及我们如何利用时间。做一些你喜欢的事情。对我来说，是学习如何更好地训练网络，更直观地了解神经网络的工作原理。你找到你的东西。</p><p id="abc4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用我们这个时代的先知和英雄希亚·拉博夫的一句美丽的话来结束这篇博客，</p><blockquote class="kt"><p id="f382" class="ku kv hi bd kw kx ky kz la lb lc jc dx translated">“不要让你的梦想成为梦想。做就是了！”</p></blockquote><p id="8028" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated"><a class="ae jd" href="https://giphy.com/gifs/just-do-it-24xRxrDCLxhT2" rel="noopener ugc nofollow" target="_blank">https://giphy.com/gifs/just-do-it-24xRxrDCLxhT2</a></p><p id="0be5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在这里找到我的完整代码<a class="ae jd" href="https://github.com/dawnofthedebayan/plant_pathology_challenge" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="8f51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">编辑:</strong>我用整个训练数据集训练了EfficientNet B5。换句话说，交叉验证集现在也被用于训练。我对网络进行了50个纪元的训练，得到了97.5%的准确率。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es li"><img src="../Images/d0f13c581826efdd4ec3d03a61ba5707.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DhfRHQV0UjdrrgA_tWPW9g.jpeg"/></div></div></figure></div></div>    
</body>
</html>