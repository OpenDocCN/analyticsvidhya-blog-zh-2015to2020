<html>
<head>
<title>How To Run Docker Images and Make Your Own! Docker for Data Science/Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何运行Docker图像并制作自己的图像！数据科学/Python的Docker</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-run-docker-images-and-make-your-own-docker-for-data-science-python-cba7311fdc92?source=collection_archive---------11-----------------------#2019-12-19">https://medium.com/analytics-vidhya/how-to-run-docker-images-and-make-your-own-docker-for-data-science-python-cba7311fdc92?source=collection_archive---------11-----------------------#2019-12-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/408575ad3eefb1e4f3a6cb05de4f5f4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*_kGFWRXCaNEyvOOJ4C_qEg.jpeg"/></div></figure><p id="61d0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是我上一篇文章的后续，<a class="ae jk" rel="noopener" href="/analytics-vidhya/what-is-docker-and-why-is-it-useful-for-data-science-683294a57b81"><em class="jl">Docker是什么，为什么它对数据科学有用？</em> </a> <em class="jl"> </em>在这篇文章中，我将向你展示如何在你的机器上设置Docker，并从Docker文件创建一个Docker映像，然后如何获得一个运行PostgreSQL的Docker容器。</p></div><div class="ab cl jm jn gp jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hb hc hd he hf"><h2 id="7e85" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ix ke kf kg jb kh ki kj jf kk kl km kn bi translated">安装Docker</h2><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es ko"><img src="../Images/940bccab565c088a55d7ab5a3643abbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iTFYudAaEup1HLim"/></div></div></figure><p id="f0c0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里有一个下载Docker桌面的链接。您需要注册才能免费下载该文件。下载完成后，双击下载文件夹中的Docker.dmg文件，将可爱的鲸鱼图标拖到应用程序文件夹中。</p><p id="04fc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当你看到鲸鱼图标出现在你的菜单栏上时，你就知道Docker正在运行(为了便于查看，我在图标周围加了一个红框)</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es kx"><img src="../Images/8573c82aabfb53a01df246a0436529c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lACrN4VKNhsf2k__"/></div></div></figure><p id="3722" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在是时候看看一切是否正常工作了。打开您的终端，输入以下命令:</p><pre class="kp kq kr ks fd ky kz la lb aw lc bi"><span id="2aa9" class="jt ju hi kz b fi ld le l lf lg">docker run hello-world        # The syntax for running images is <br/>                              # docker run &lt;image-name&gt;</span></pre><p id="ddaa" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您应该会看到一条弹出消息——恭喜，您刚刚运行了您的第一个Docker图像！要总结您看到显示的文本:</p><ul class=""><li id="b6f5" class="lh li hi io b ip iq it iu ix lj jb lk jf ll jj lm ln lo lp bi translated">Docker试图寻找该图像的本地副本(但失败了)</li><li id="ff3f" class="lh li hi io b ip lq it lr ix ls jb lt jf lu jj lm ln lo lp bi translated">它从<a class="ae jk" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker Hub </a>(各种Docker图片的存储库)中提取了“hello-world”的图片</li><li id="a80a" class="lh li hi io b ip lq it lr ix ls jb lt jf lu jj lm ln lo lp bi translated">它从该映像创建了一个容器，其中包含一个可执行的命令，该命令产生出现在终端上的文本</li></ul><p id="4f5e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请记住映像和容器之间的区别:映像是从Docker文件创建的，并从Docker Hub下载，但它们并不在您的机器上“运行”。Docker容器是正在运行(或短暂运行以运行可执行文件)的映像的实例。以下是一些其他有用的命令:</p><pre class="kp kq kr ks fd ky kz la lb aw lc bi"><span id="a8d9" class="jt ju hi kz b fi ld le l lf lg">docker help             #brings up the full help menu. There's A LOT<br/>docker &lt;command&gt; --help #this displays help for a certain command<br/>docker images           #shows all images stored on your machine<br/>docker rmi &lt;image name&gt; #removes an image (add -f to force it)<br/>docker ps               #shows all running containers<br/>docker run &lt;image name&gt; #create a container based upon an image</span></pre></div><div class="ab cl jm jn gp jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hb hc hd he hf"><h2 id="642c" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ix ke kf kg jb kh ki kj jf kk kl km kn bi translated">创建自己的docker文件</h2><p id="9077" class="pw-post-body-paragraph im in hi io b ip lv ir is it lw iv iw ix lx iz ja jb ly jd je jf lz jh ji jj hb bi translated">将您的工作/代码封装到Docker映像中进行共享的方法是使用Docker文件。Docker文件是一个包含命令的文本文档，Docker将读取这些命令来组合图像。我将向你展示如何制作一个非常基本的图像，然后探索更复杂的功能。但是如果你想继续阅读:<a class="ae jk" href="https://docs.docker.com/engine/reference/builder/" rel="noopener ugc nofollow" target="_blank"> Docker有大量关于Dockerfile命令的文档</a>。以下是步骤:</p><ol class=""><li id="ae29" class="lh li hi io b ip iq it iu ix lj jb lk jf ll jj ma ln lo lp bi translated">制作一个目录来存放你的作品。我在我的主目录中制作了一个名为<strong class="io hj"> docker </strong>的文件</li><li id="d2e5" class="lh li hi io b ip lq it lr ix ls jb lt jf lu jj ma ln lo lp bi translated">使用您最喜欢的IDE编写一个简短的Python脚本。并保存在您的Docker目录中。我做了这样的事情:</li></ol><pre class="kp kq kr ks fd ky kz la lb aw lc bi"><span id="1094" class="jt ju hi kz b fi ld le l lf lg">print(f'5 to the 100th power is {5**100}')</span></pre><p id="7823" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">3.打开另一个文本文档，保存为‘Dockerfile’(就docker file)。我使用VSCode，它有一个漂亮的Docker插件。输入以下命令:</p><pre class="kp kq kr ks fd ky kz la lb aw lc bi"><span id="e767" class="jt ju hi kz b fi ld le l lf lg">FROM python            # Use the latest image of Python</span><span id="5de8" class="jt ju hi kz b fi mb le l lf lg">RUN mkdir -p /docker   # Make a directory in the image</span><span id="3779" class="jt ju hi kz b fi mb le l lf lg">WORKDIR /docker        # Makes that directory the working directory</span><span id="0254" class="jt ju hi kz b fi mb le l lf lg">COPY ./ /docker        # Copy local files to that directory</span><span id="c107" class="jt ju hi kz b fi mb le l lf lg">CMD python hello.py    # When the image is ran, run this command</span></pre><ul class=""><li id="f54f" class="lh li hi io b ip iq it iu ix lj jb lk jf ll jj lm ln lo lp bi translated"><strong class="io hj"> FROM </strong>:通过设置一个“基础图像”来初始化构建图像在这里，您可以使用任何有效的图像，但是让我们对这个图像使用最新的Python。您必须提供此命令来创建新的映像。您可以通过在末尾添加一个位来指定版本。来自python:3.7将使用Python 3.7映像。</li><li id="b462" class="lh li hi io b ip lq it lr ix ls jb lt jf lu jj lm ln lo lp bi translated"><strong class="io hj">运行</strong>:这发出一个命令，在映像/容器中创建一个目录，我们将从这个目录开始工作。</li><li id="6e66" class="lh li hi io b ip lq it lr ix ls jb lt jf lu jj lm ln lo lp bi translated"><strong class="io hj"> WORKDIR </strong>:设置后续运行/CMD/ENTRYPOINT/COPY/ADD命令的工作目录。我们将工作目录设置为我们刚刚在RUN命令中创建的目录</li><li id="1949" class="lh li hi io b ip lq it lr ix ls jb lt jf lu jj lm ln lo lp bi translated"><strong class="io hj">复制</strong>:这里有两个论点。第一个，。/表示它正在复制Dockerfile所在目录中的所有文件。这些文件将被复制到我们创建的/docker目录中。因为我只复制了一个文件，所以我可以列出它而不是。/ command。</li><li id="aaab" class="lh li hi io b ip lq it lr ix ls jb lt jf lu jj lm ln lo lp bi translated"><strong class="io hj"> CMD </strong>:运行镜像时发出一个命令。为此，我们告诉它运行Python脚本“hello.py”，因为它在我们当前的工作目录中，我们可以只列出文件名。</li></ul></div><div class="ab cl jm jn gp jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hb hc hd he hf"><h2 id="61bb" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ix ke kf kg jb kh ki kj jf kk kl km kn bi translated">从您的Docker文件构建Docker映像</h2><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/0dd82d2379d87784744687018597c4b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:496/format:webp/1*xgaAd3wlrAs8BuWDfQnhqA.png"/></div><figcaption class="md me et er es mf mg bd b be z dx translated">使用docker文件和Python脚本导航到该目录</figcaption></figure><p id="f2b8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在来建立一个码头工人的形象！简单回顾一下，您应该在同一个目录中有一个Python脚本和一个docker文件，在您的终端中，您应该在那个目录中。现在是好东西！在您的终端中键入以下内容，将这一切转换成一个图像(称为构建Docker图像)。</p><pre class="kp kq kr ks fd ky kz la lb aw lc bi"><span id="5b55" class="jt ju hi kz b fi ld le l lf lg">docker build . -t docker-test   # This is saying to build all (.),<br/>                                # as well as to tag it (-t) with the<br/>                                # string proceeding, using the <br/>                                # Dockerfile in my directory</span></pre><p id="05e2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">按回车键。它应该会向你反馈一些信息。如果您查看每一步，就会发现它正在运行我们放在docker文件中的所有命令。首先，它从Docker Hub中提取Python，在映像中创建一个目录，将该目录指定为工作目录，将当前目录(在本地机器上)中的所有文件复制到映像中的目录。它存储CMD行，该行仅在容器启动时运行。</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es mh"><img src="../Images/ba1bba3d0fb3e993cc4b5ca9d9fed144.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JduQKRfM3V_Wyhx3K7W_1Q.png"/></div></div><figcaption class="md me et er es mf mg bd b be z dx translated">构建Docker映像的输出</figcaption></figure><p id="5fad" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">恭喜——你刚刚制作了你的第一个码头工人形象！你可以键入<strong class="io hj"> docker images </strong>来查看它的列表。</p><p id="2369" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，通过在下面的命令行中键入以下命令来运行它:</p><pre class="kp kq kr ks fd ky kz la lb aw lc bi"><span id="0f99" class="jt ju hi kz b fi ld le l lf lg">docker run &lt;image-name&gt;  # This is how you run any image in Docker<br/>docker run docker-test   # I named my image docker-test earlier</span></pre><p id="38cb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">它现在将运行我们放在docker file:<strong class="io hj">python hello . py</strong>中的<strong class="io hj"> CMD </strong>，并运行我们的脚本:</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es mi"><img src="../Images/2554dbaa7aef617a96b7ed92fc5f3c3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xShvwMdQhbvfe5oAzDySRw.png"/></div></div></figure><p id="8035" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">哇，这是一个很大的数字！</p><h2 id="0621" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ix ke kf kg jb kh ki kj jf kk kl km kn bi translated">一点关于CMD指令</h2><p id="89d7" class="pw-post-body-paragraph im in hi io b ip lv ir is it lw iv iw ix lx iz ja jb ly jd je jf lz jh ji jj hb bi translated">还有一个说明是，如果你用CMD替换，你不会看出和我们目前所做的有什么不同。是入口点。CMD是一个在容器启动时运行的命令，但是如果您在命令行参数中同时发出其他命令(稍后将详细介绍)，它将不会运行。ENTRYPOINT使容器像可执行文件一样被对待，它不会监听相同的添加命令，而是只执行提供给它的命令。尝试下面的代码，确保在容器名之前/之后添加<strong class="io hj"> -it </strong>和<strong class="io hj"> bash </strong>。这意味着我们将直接访问集装箱的码头。您将看到它忽略了CMD指令，并且不运行hello.py。</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es mj"><img src="../Images/088427b208453cb236c6a0c5bf8d2ab1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*hhx3F5zX4_3ccLuylT7xcA.png"/></div><figcaption class="md me et er es mf mg bd b be z dx translated">CMD函数被忽略，我们直接进入容器的终端</figcaption></figure><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es mk"><img src="../Images/e579c9b133751e5fbd1bfb2622420af2.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*-m5072Bz-GsBrg2ESdBT-g.png"/></div><figcaption class="md me et er es mf mg bd b be z dx translated">我们复制到Docker映像中的文件</figcaption></figure><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es ml"><img src="../Images/57c7f411d69328ad1f0837573bc27604.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*7-h3RiTtCt95LZIg5rlT_Q.gif"/></div></figure><p id="eab6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">试着输入<strong class="io hj"> ls </strong>看看容器里面是什么。您将看到我们位于Dockerfile中指定的<strong class="io hj"> /docker </strong>目录中，其中包含我们复制到其中的文件。</p><p id="8303" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">整洁，对不对？</p></div><div class="ab cl jm jn gp jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hb hc hd he hf"><h2 id="5b85" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ix ke kf kg jb kh ki kj jf kk kl km kn bi translated">一种数据库系统</h2><p id="9ffe" class="pw-post-body-paragraph im in hi io b ip lv ir is it lw iv iw ix lx iz ja jb ly jd je jf lz jh ji jj hb bi translated">这将是一个让PostgreSQL容器运行以及如何访问它的快速速成课程(注意:我自己还在学习过程中)。在以后的文章中，我将更彻底地探索这个方面。</p><p id="964f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><a class="ae jk" href="https://hub.docker.com/_/postgres" rel="noopener ugc nofollow" target="_blank">这里是官方PostgreSQL Docker Hub页面</a>的链接。</p><p id="0fa5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">启动实例非常简单，只需在命令行中尝试以下命令:</p><pre class="kp kq kr ks fd ky kz la lb aw lc bi"><span id="4e47" class="jt ju hi kz b fi ld le l lf lg">docker run --name posg -e POSTGRES_PASSWORD=bestpw -d postgres</span></pre><p id="5364" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您现在应该有一个运行着PostgreSQL的<strong class="io hj">Docker容器(在我们之前的例子中，它运行了一次，然后关闭了)!尝试在命令行中使用<strong class="io hj"> docker ps </strong>来查看正在运行的容器，您的容器现在应该在那里了。</strong></p><p id="df53" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要访问容器本身的命令行，请键入以下内容:</p><pre class="kp kq kr ks fd ky kz la lb aw lc bi"><span id="183d" class="jt ju hi kz b fi ld le l lf lg">docker exec -it posg bash # 'posg' is what we named the container in<br/>                          # the above command. We are using<br/>                          # 'exec' specifically to access a running<br/>                          # container's terminal</span></pre><p id="7411" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在你在这个容器里了！要打开PostgreSQL，请键入以下内容:</p><pre class="kp kq kr ks fd ky kz la lb aw lc bi"><span id="b43e" class="jt ju hi kz b fi ld le l lf lg">psql -U postgres          # access psql as the user postgres</span></pre><p id="f0da" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你被录取了。这里没有数据，但我会继续讨论。我的目标是描述如何设置PostgreSQL数据库来托管您的数据，以及如何为一个给定的项目设置并运行一个Jupyter笔记本。</p></div><div class="ab cl jm jn gp jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hb hc hd he hf"><h2 id="4e05" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ix ke kf kg jb kh ki kj jf kk kl km kn bi translated"><strong class="ak">接下来的步骤</strong></h2><ul class=""><li id="9391" class="lh li hi io b ip lv it lw ix mm jb mn jf mo jj lm ln lo lp bi translated">尝试编辑您的原始docker文件，用ENTRYPOINT替换CMD指令，并遵循上面的步骤。您将看到它不允许您访问容器的bash终端，而是执行您列出的命令。</li><li id="6d66" class="lh li hi io b ip lq it lr ix ls jb lt jf lu jj lm ln lo lp bi translated">尝试在容器的PostgreSQL实例中创建一个表。然后—退出PostgreSQL容器，停止容器(docker stop <strong class="io hj"> container </strong>)，重新启动它(docker start container)，并查找您的表。它还在那里！</li><li id="ba0e" class="lh li hi io b ip lq it lr ix ls jb lt jf lu jj lm ln lo lp bi translated">抱歉，这个帖子太单调了！</li></ul></div><div class="ab cl jm jn gp jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hb hc hd he hf"><p id="0a65" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">以下是我写这篇文章时使用的资源:</p><ul class=""><li id="c60e" class="lh li hi io b ip iq it iu ix lj jb lk jf ll jj lm ln lo lp bi translated"><a class="ae jk" href="https://docs.docker.com/engine/reference/builder/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/engine/reference/builder/</a></li><li id="8708" class="lh li hi io b ip lq it lr ix ls jb lt jf lu jj lm ln lo lp bi translated">https://goinbigdata.com/docker-run-vs-cmd-vs-entrypoint/<a class="ae jk" href="https://goinbigdata.com/docker-run-vs-cmd-vs-entrypoint/" rel="noopener ugc nofollow" target="_blank"/></li><li id="cacf" class="lh li hi io b ip lq it lr ix ls jb lt jf lu jj lm ln lo lp bi translated"><a class="ae jk" href="https://severalnines.com/database-blog/how-deploy-postgresql-docker-container-using-clustercontrol" rel="noopener ugc nofollow" target="_blank">https://several nines . com/database-blog/how-deploy-PostgreSQL-docker-container-using-cluster control</a></li></ul></div></div>    
</body>
</html>