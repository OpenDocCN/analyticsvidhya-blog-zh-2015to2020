<html>
<head>
<title>Running ML Models in Android using Tensorflow Lite</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Tensorflow Lite在Android中运行ML模型</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/running-ml-models-in-android-using-tensorflow-lite-e549209287f0?source=collection_archive---------1-----------------------#2020-07-27">https://medium.com/analytics-vidhya/running-ml-models-in-android-using-tensorflow-lite-e549209287f0?source=collection_archive---------1-----------------------#2020-07-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/9345894f755f942118a3af56bb7f36d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*y8XOrNwJuCyPy-n7D7n43w.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">使用Tensorflow Lite在Android中运行ML模型</figcaption></figure><h1 id="800f" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">简介:-</h1><p id="261e" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">通常，在我们训练一个模型之后，我们需要测试它。在开发阶段，可以使用CLI(命令行界面)来完成。但是当我们需要进入部署阶段时，我们需要让我们的模型在Web和Android上运行。对于Web，我们可以使用Tensorflow.js或Flask / Django框架运行我们的模型。当谈到android时，在android中运行模型会很困难，因为它通常需要更多的RAM和许多限制。为此，谷歌推出了一个名为TensorFlow-Lite的迷你API。通过使用Tensorflow-Lite API，我们可以将ML模型部署到任何android应用程序中。为了简要说明它的工作原理，我将向您展示如何创建一个基本的线性回归模型，并使用Tensorflow Lite将其部署为android应用程序。</p><h1 id="504f" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">了解Tensorflow-Lite API的架构:-</h1><p id="307a" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在此之前，我们需要了解TensorFlow-lite的工作原理。</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es km"><img src="../Images/eb82a0d6d1f79b568f77f14aaeeb3fce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fQpyz_YEyw5dZ-C-.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">Tensorflow Lite API的架构</figcaption></figure><p id="360c" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">它主要包括4个步骤</p><ol class=""><li id="5ac3" class="la lb hi jq b jr kv jv kw jz lc kd ld kh le kl lf lg lh li bi translated"><strong class="jq hj">训练和保存Tensorflow模型:- </strong>首先我们需要使用Keras框架训练一个模型，并将模型保存在. H5或。PB格式加载它在任何时候我们需要的。</li><li id="d90a" class="la lb hi jq b jr lj jv lk jz ll kd lm kh ln kl lf lg lh li bi translated"><strong class="jq hj">创建TensorFlow Lite转换器:-</strong><a class="ae lo" href="https://www.tensorflow.org/lite/convert" rel="noopener ugc nofollow" target="_blank">TensorFlow Lite转换器</a>是一个作为Python API提供的工具，可以将训练好的tensor flow模型转换为TensorFlow Lite格式。它还可以引入优化。</li><li id="b389" class="la lb hi jq b jr lj jv lk jz ll kd lm kh ln kl lf lg lh li bi translated"><strong class="jq hj">将TensorFlow Lite转换器转换为。tflite格式:- </strong>现在我们需要将这个对象转换成tflite格式，这将在android应用程序中进一步使用。</li><li id="acbd" class="la lb hi jq b jr lj jv lk jz ll kd lm kh ln kl lf lg lh li bi translated"><strong class="jq hj">正在部署。tflite进入android studio并运行推理:- </strong>现在我们将在Android Studio中使用Tensorflow解释器API来运行。用数据生成输出的tflite模型。</li></ol><p id="7513" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">这样，我们可以按照上面的步骤使用Tensorflow Lite API运行ML模型。现在我们来做一个简单的线性回归app，以x为输入，返回y。</p><h1 id="e986" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">使用TensorFlow Lite在Android Studio中实现简单线性回归应用:-</h1><ol class=""><li id="b16d" class="la lb hi jq b jr js jv jw jz lp kd lq kh lr kl lf lg lh li bi translated">首先我们做一个简单的线性回归模型，x和y为随机数。</li></ol><figure class="kn ko kp kq fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="5161" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">2.将模型保存到。pbtxt文件。</p><figure class="kn ko kp kq fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="10c5" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">3.现在我们需要创建一个TFLite Converter对象，它带有在步骤1中创建的预训练模型。</p><figure class="kn ko kp kq fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="218a" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">4.现在我们需要使用这个转换器将对象转换为tflite对象，并需要将对象保存为。将被进一步使用的tflite文件。</p><figure class="kn ko kp kq fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="b44e" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">5.现在打开Android Studio，创建一个空项目，语言选择为java。</p><p id="1063" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">6.现在您需要在项目级别创建assets文件夹，路径为<em class="lu"> app/src/main </em>文件夹。</p><p id="f39b" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">7.现在我们需要将一个<strong class="jq hj"> degree.tflite </strong>文件添加到assets文件夹中。项目结构如下所示。</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div class="er es lv"><img src="../Images/a802981fc2abbf167c11dd16c7197ee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/1*K8c3nx45ISz6a2km_PtVtw.jpeg"/></div><figcaption class="im in et er es io ip bd b be z dx translated">项目结构</figcaption></figure><p id="8fd3" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">8.现在转到build.gradle(Module: app)并在build types下添加以下脚本，这有助于在形成app apk时不压缩tflite文件。</p><pre class="kn ko kp kq fd lw lx ly lz aw ma bi"><span id="af57" class="mb ir hi lx b fi mc md l me mf">aaptOptions <strong class="lx hj">{<br/>    </strong>noCompress "tflite"<br/><strong class="lx hj">}</strong></span></pre><p id="8001" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">9.现在在build.gradle(Module: app)的dependencies中添加以下依赖项。</p><pre class="kn ko kp kq fd lw lx ly lz aw ma bi"><span id="5ab6" class="mb ir hi lx b fi mc md l me mf">implementation 'org.tensorflow:tensorflow-lite:+'</span></pre><p id="a015" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">10.现在同步您的项目。</p><p id="f110" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">11.现在，我们需要将以下代码添加到activity_main.xml中，其中添加了用于预测按钮的按钮、用于输入的编辑文本和用于显示输出的文本视图。</p><figure class="kn ko kp kq fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="4116" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">12.现在转到MainActivity.java，我们需要添加一个方法来加载。tflite模型文件。</p><figure class="kn ko kp kq fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="02cc" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">13.现在，我们需要初始化变量，并分配activity_main.xml文件中的元素的链接。</p><p id="3b7a" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">14.现在，我们需要从TensorFlow lite API导入解释器，方法是将下面一行添加到MainActivity.java</p><pre class="kn ko kp kq fd lw lx ly lz aw ma bi"><span id="de1a" class="mb ir hi lx b fi mc md l me mf">import org.tensorflow.lite.Interpreter;</span></pre><p id="ff53" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">15.现在，在onCreate方法中添加以下脚本，以创建从TFLite模型加载的tflite解释器对象。</p><pre class="kn ko kp kq fd lw lx ly lz aw ma bi"><span id="b890" class="mb ir hi lx b fi mc md l me mf">try {<br/>    tflite = new Interpreter(loadModelFile());<br/>}catch (Exception ex){<br/>    ex.printStackTrace();<br/>}</span></pre><p id="b56f" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">16.要进行推断，需要创建一个方法，将输入字符串作为输入，并将其转换为浮点数组，然后使用tflite.run()方法获取输出，并将输出作为浮点值返回。</p><figure class="kn ko kp kq fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="7839" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">17.现在，当我们单击predict时，方法doInference被调用，并获得在TextView中显示为预测输出的输出。</p><p id="faf5" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">18.最终的MainActivity.java看起来如下:-</p><figure class="kn ko kp kq fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="d2fc" class="pw-post-body-paragraph jo jp hi jq b jr kv jt ju jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl hb bi translated">19.现在运行并安装在模拟器/手机上，应用程序看起来如下。</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div class="er es mg"><img src="../Images/8c5e924254709ffb454c4295bf498d23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*CtYqIH1hWT1Nkx5tTlBXbg.jpeg"/></div><figcaption class="im in et er es io ip bd b be z dx translated">应用外观的快照</figcaption></figure><h1 id="aa21" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">结论:-</h1><p id="3423" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">这样，通过使用TensorFlow Lite API，我们可以在Android手机上运行我们的机器学习模型。</p><h1 id="8d04" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">参考资料:-</h1><div class="mh mi ez fb mj mk"><a href="https://www.tensorflow.org/lite/guide/android" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab dw"><div class="mm ab mn cl cj mo"><h2 class="bd hj fi z dy mp ea eb mq ed ef hh bi translated">Android快速入门| TensorFlow Lite</h2><div class="mr l"><h3 class="bd b fi z dy mp ea eb mq ed ef dx translated">要在Android上开始使用TensorFlow Lite，我们建议探索以下示例。Android图像…</h3></div><div class="ms l"><p class="bd b fp z dy mp ea eb mq ed ef dx translated">www.tensorflow.org</p></div></div><div class="mt l"><div class="mu l mv mw mx mt my ik mk"/></div></div></a></div></div></div>    
</body>
</html>