<html>
<head>
<title>Model deployment — MLDevOps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模型部署— MLDevOps</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/model-deployment-mldevops-f28f107b434b?source=collection_archive---------14-----------------------#2020-07-25">https://medium.com/analytics-vidhya/model-deployment-mldevops-f28f107b434b?source=collection_archive---------14-----------------------#2020-07-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a614f572ff59a5cfbed215207b54cfc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*y77NmO3K37gfhA-A"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://unsplash.com/@macauphotoagency?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">澳门图片社</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="a4bb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">像大多数数据科学家初学者一样，您是否也陷入了困境，并思考如何在系统中部署ML模型？</p><p id="bbf6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在ML/AI领域，几乎所有人都知道如何训练机器学习模型，即使我们有多个库(如sci-kit-learn、TensorFlow、PyTorch等)用于模型训练和预测。有时，我们在得到一个好的离开笔记本的预测后，在jupyter-notebook中训练那些模型。如果我们在实时系统中部署这些模型，那将是令人兴奋的。</p><p id="9aa5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通常，人们将模型放在笔记本中，因为他们发现很难在另一个环境中部署。在本文中，我将解释如何在复杂的应用环境中创建和部署我们的机器学习模型。</p><p id="c5bb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为此，让我们以一个用例为例，比如创建一个分类模型，根据胸部X射线对肺炎或正常进行分类。是的，它将是一个图像分类模型。</p><p id="dcfc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们的用例中，我们有3个主要任务——</p><ul class=""><li id="7e46" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">模型训练和测试</li><li id="977a" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">API开发</li><li id="ac10" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">应用程序部署</li></ul><p id="2216" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">先说培训流程。</p><ol class=""><li id="6c61" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js kh jz ka kb bi translated"><strong class="ix hj">模型训练— <br/> </strong>为了训练机器学习模型，我们使用了来自<a class="ae iu" href="https://www.kaggle.com/paultimothymooney/chest-xray-pneumonia" rel="noopener ugc nofollow" target="_blank"> kaggle </a>的免费可用数据。该数据集具有大约6000幅训练图像、600幅测试图像和16幅验证图像。</li></ol><figure class="kj kk kl km fd ij er es paragraph-image"><div class="er es ki"><img src="../Images/1abc3f12d885343d697d25c0ddaca6c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*ErufvyDiPskX8754DFDSlQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">训练模型</figcaption></figure><p id="05d6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们正在训练一个21层的CNN网络。有关型号详情，请查看<a class="ae iu" href="https://github.com/ai-bag/Pneumonia-Detection-using-Chest-X-ray/blob/master/Chest%20X-ray%20prediction.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a></p><p id="6b9a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> 2。API开发— </strong> <br/>对于应用程序开发，我们需要创建使用数据并做出预测的API。<br/>对于API，一般来说，人们使用FLASK，这是一个轻量级的基于Python的web框架。Flask只支持顺序请求(一次一个请求)。<br/>因此，我使用的不是flask，而是FastAPI，这是python中的一个高性能restful API库。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kn ko l"/></div></figure><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kp"><img src="../Images/72162ca43f7c09025ab21eba9533a6a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F3uiFtamwrP4Q7MihZVUKA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">API的文档</figcaption></figure><p id="8470" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> 3。应用程序部署— <br/> </strong>对于应用程序部署，我们使用Docker将应用程序容器化。</p><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kq"><img src="../Images/49e9e6ba8ceb267f8f98361c12cc0dbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MG-yllZMlPmCKa5ejS7X2w.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">部署架构</figcaption></figure><p id="d649" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在上面的架构中，我提到了多个组件。我们来讨论一下组件。</p><ul class=""><li id="0670" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated"><strong class="ix hj"> FastAPI </strong> — FastAPI框架，高性能，易学，快速编码，准备生产[ <a class="ae iu" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank"> FASTAPI </a> ]</li><li id="5eaa" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><strong class="ix hj">guni corn</strong>—guni corn“绿色独角兽”是一个Python Web服务器网关接口HTTP服务器。它是一个fork之前的工人模型，移植自Ruby的Unicorn项目。Gunicorn服务器广泛兼容许多web框架，实现简单，占用服务器资源少，速度相当快。[ <a class="ae iu" href="https://en.wikipedia.org/wiki/Gunicorn" rel="noopener ugc nofollow" target="_blank"> Gunicorn </a> ] <br/> FastAPI一般支持Uvicorn，Uvicorn是Gunicorn的异步分支。我们可以使用Uvicorn worker类来激活gunicorn对FastAPI的支持。</li><li id="5a17" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><strong class="ix hj"> Docker </strong> : Docker是一套平台即服务产品，使用OS级虚拟化来交付称为容器的软件包中的软件。容器是相互隔离的，捆绑了它们自己的软件、库和配置文件[ <a class="ae iu" href="https://en.wikipedia.org/wiki/Docker_(software)" rel="noopener ugc nofollow" target="_blank"> Wikipedia </a></li></ul><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kn ko l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">Dockerfile文件</figcaption></figure><p id="b3f2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面的命令将获取Dockerfile并构建名为“Classifier:v1”的docker映像。然后，我们使用docker映像创建容器，并传递多个参数，如</p><p id="fd67" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">"-d "标记将用于分离正在运行的容器。</p><p id="c51e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">“-p”标记是将从容器中暴露端口的端口标记。</p><p id="4e76" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">“-n”标记将采用容器的名称。</p><pre class="kj kk kl km fd kr ks kt ku aw kv bi"><span id="fd94" class="kw kx hi ks b fi ky kz l la lb">docker build -t Classifier:v1 .<br/>docker run -d -p 8000:8000 -n "Pneumonia Classifier" Classifier</span></pre></div><div class="ab cl lc ld gp le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hb hc hd he hf"><h1 id="dbbf" class="lj kx hi bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">结果</h1><p id="687e" class="pw-post-body-paragraph iv iw hi ix b iy mg ja jb jc mh je jf jg mi ji jj jk mj jm jn jo mk jq jr js hb bi translated">运行docker容器后，我们就可以调用API了。在我们的例子中，我们只有用于调用的<code class="du ml mm mn ks b">/pneumonia_classifier</code> API。</p><p id="0ca7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">它们的e在请求体中传递<code class="du ml mm mn ks b">form-data</code>。并在JSONResponse中获得响应</p><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/75041d76872e7bf8b1d85378dc4e78b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*saOTaZGkJpUPrh0No3W_dQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">API调用</figcaption></figure><div class="mp mq ez fb mr ms"><a href="https://github.com/ritikjain51/Chest-X-ray-prediction" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab dw"><div class="mu ab mv cl cj mw"><h2 class="bd hj fi z dy mx ea eb my ed ef hh bi translated">胸透预测</h2><div class="mz l"><h3 class="bd b fi z dy mx ea eb my ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="na l"><p class="bd b fp z dy mx ea eb my ed ef dx translated">github.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng io ms"/></div></div></a></div></div></div>    
</body>
</html>