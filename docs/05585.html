<html>
<head>
<title>Climate change visualization with Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Plotly实现气候变化可视化</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/climate-change-visualization-with-plotly-99905ae8d3bf?source=collection_archive---------13-----------------------#2020-04-26">https://medium.com/analytics-vidhya/climate-change-visualization-with-plotly-99905ae8d3bf?source=collection_archive---------13-----------------------#2020-04-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/6e3a9fa39010678376b192ce4a0a7427.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*elGMo3XwhOtxk7IywX-sTA.jpeg"/></div><figcaption class="im in et er es io ip bd b be z dx translated"><a class="ae iq" href="https://www.google.com/search?q=global+warming+&amp;tbm=isch&amp;ved=2ahUKEwiLzrvqz4bpAhX0hHIEHZBFBRMQ2-cCegQIABAA&amp;oq=global+warming+&amp;gs_lcp=CgNpbWcQAzIECCMQJzICCAAyAggAMgIIADICCAAyAggAMgIIADICCAAyAggAMgIIAFCPFFiGGGCbIGgAcAB4AIABOIgBlAGSAQEzmAEAoAEBqgELZ3dzLXdpei1pbWc&amp;sclient=img&amp;ei=ysWlXovBJfSJytMPkIuVmAE&amp;bih=888&amp;biw=1920&amp;rlz=1C1CHBF_enUS714US714#imgrc=UmCdj533FPpH4M" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="72e1" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">气候变化是人类面临的最紧迫的挑战之一，农业深受其影响。农民尤其受到极端天气条件的影响，包括干旱、酷热、洪水和其他变化的气候趋势。我很好奇气候变化对农作物产量的影响，并决定以此为主题做我的顶点项目。对于这篇博客，我将使用<a class="ae iq" href="http://www.fao.org/faostat/en/#data/QC" rel="noopener ugc nofollow" target="_blank">粮农组织的全球作物产量</a>数据集和Plotly进行可视化。</p><p id="b900" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">Plotly Python库(<a class="ae iq" href="https://plotly.com/python/" rel="noopener ugc nofollow" target="_blank"> plotly.py </a>)是一个交互式、<a class="ae iq" href="https://github.com/plotly/plotly.py" rel="noopener ugc nofollow" target="_blank">开源</a>绘图库，支持40多种独特的图表类型，涵盖了广泛的统计、金融、地理、科学和三维用例，构建于Plotly JavaScript库(<a class="ae iq" href="https://plotly.com/javascript/" rel="noopener ugc nofollow" target="_blank"> plotly.js </a>)之上，plotly.py使Python用户能够创建漂亮的交互式基于web的可视化，可以在Jupyter笔记本中显示，保存到独立的HTML文件中，或作为</p><h1 id="78f2" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">装置</h1><p id="d11b" class="pw-post-body-paragraph ir is hi it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hb bi translated">plotly.py可以使用pip安装</p><p id="94d5" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><code class="du ks kt ku kv b">pip install plotly==4.6.0</code></p><p id="1e18" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><code class="du ks kt ku kv b">conda install -c plotly plotly=4.6.0</code></p><h1 id="c777" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Plotly组件</h1><p id="3f3e" class="pw-post-body-paragraph ir is hi it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hb bi translated">Plotly中的主要组件是轨迹、数据和布局。</p><p id="92ef" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">轨迹</strong>是要绘制的数据参数的字典，以及关于颜色和线型的信息。</p><p id="3a4f" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">数据</strong>由图表中的图表列表组成，其中每个图表称为一个轨迹。</p><p id="be87" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">布局</strong>形成剧情的观感。包括背景、网格、字体等。所有的组成部分在被输入到一个Plotly函数时都会产生必要的交互图形。</p><p id="40bd" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">开始我们的可视化首先我们需要导入Plotly。</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="b3d6" class="le jq hi kv b fi lf lg l lh li"><em class="lj">from plotly.offline import iplot</em></span><span id="60b2" class="le jq hi kv b fi lk lg l lh li"><em class="lj">import plotly.graph_objects as go</em></span></pre><p id="eb8f" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">让我们看看同一轴上最高作物产量和最高温度异常之间的关系。类似于分剧情。我们可以很容易地做到这一点，只需将“secondary_y”子情节选项设置为True。</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="b450" class="le jq hi kv b fi lf lg l lh li">from plotly.subplots import make_subplots</span><span id="4d2a" class="le jq hi kv b fi lk lg l lh li"># Create figure with secondary y-axis<em class="lj"><br/>fig = make_subplots(specs=[[{“secondary_y”: True}]])</em></span><span id="b719" class="le jq hi kv b fi lk lg l lh li"><em class="lj">fig.add_trace(go.Scatter(x=df_cropw_max[“Year”], y=df_cropw_max[“yield”], mode=”lines+markers”, name=”Max Wheat”),secondary_y=False,)</em></span><span id="fa9f" class="le jq hi kv b fi lk lg l lh li"><em class="lj">fig.add_trace( go.Scatter(x=df_cropr_max[“Year”], y=df_cropr_max[“yield”], mode=”lines+markers”, name=”Max Rice”), secondary_y=False,)</em></span><span id="f453" class="le jq hi kv b fi lk lg l lh li"><em class="lj">fig.add_trace(go.Scatter(x=df_cropm_max[“Year”], y=df_cropm_max[“yield”], mode=”lines+markers”, name=”Max Maize”),secondary_y=False,)<br/> <br/>fig.add_trace(go.Scatter(x=df_temp_metro_max[“Year”], y=df_temp_metro_max[“temperature”], mode=”lines+markers”, name=”Max Temp”),secondary_y=True,)</em></span><span id="106a" class="le jq hi kv b fi lk lg l lh li"><em class="lj">fig.update_layout( title_text=”Max crop production &amp; Maximum Temperature”)<br/>fig.update_xaxes(title_text=”Year”)<br/>fig.update_yaxes(title_text=”crop production per Hectare“, secondary_y=False)<br/>fig.update_yaxes(title_text=”Temperature in celicious “, secondary_y=True)<br/>fig.show()</em></span></pre><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es ll"><img src="../Images/d3b65b38a5a245289438dfcb4e05be57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jgogYsOQxYjnjX1u83GQdw.png"/></div></div></figure><p id="6560" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">剧情表达:</strong></p><p id="2f51" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><a class="ae iq" href="https://plotly.com/python/plotly-express/" rel="noopener ugc nofollow" target="_blank"> Plotly Express </a>是Plotly易于使用的高级接口，<a class="ae iq" href="https://plotly.com/python/px-arguments/" rel="noopener ugc nofollow" target="_blank">对“整洁”的数据</a>进行操作。它是plotly.py的包装器，为复杂的图表提供简单的语法。只需一个导入和一行代码，您就可以制作丰富的交互式图形，如地图和动画。</p><p id="2137" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj"> Choropleth地图:</strong></p><p id="b400" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">choropleth地图是一种交互式地理彩色热图，用于在地理区域的顶部绘制数据。现在将看到一些高度互动的情节</p><p id="e150" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">全球变暖是我们不断变化的气候的最大组成部分之一，它是由自然和人为原因引起的地表温度升高。让我们通过使用Plotly express和choropleth地图和动画，来看看全球变暖是如何影响世界不同地区的。下面是数据:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lq"><img src="../Images/1d8996864ae460577b40c47cee5006d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xnCAEcI6KYGNiuZ6"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">各国全球气温异常</figcaption></figure><p id="185a" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">首先，我们需要导入plotly express。</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="3afd" class="le jq hi kv b fi lf lg l lh li"><em class="lj">import plotly.express as px</em></span><span id="3f58" class="le jq hi kv b fi lk lg l lh li"><em class="lj">fig=px.choropleth(df_temp_metro,locations=”Area”,<br/>locationmode=”countrynames”,animation_frame=”Year”,<br/>animation_group=”Area”,color=”pos_temp”,<br/>color_continuous_scale= ‘reds’ , hover_name=”Area”, <br/>title = ‘Global Temperature Anomaly’)</em></span><span id="ce74" class="le jq hi kv b fi lk lg l lh li"><em class="lj">fig.show()</em></span></pre><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="ea74" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">这幅图清楚地表明地球正在变暖。</p><p id="9fff" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">条形图</strong></p><p id="5892" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">人类活动和牲畜排放的温室气体是气候变化的重要驱动力，将热量滞留在地球大气中，引发全球变暖。让我们形象化地描述二氧化碳排放和温度异常随时间变化的关系。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lt"><img src="../Images/a2962213a8078be24ca3080246f74ac0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZTPwH1Jic8Y3Mq4p"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">全球二氧化碳排放、温度异常和作物产量</figcaption></figure><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="d762" class="le jq hi kv b fi lf lg l lh li"><em class="lj">import plotly.express as px</em></span><span id="45b2" class="le jq hi kv b fi lk lg l lh li"><em class="lj">fig = px.bar(df_temp_co2, x=’Year’, y=’co2',<br/>hover_data=[‘co2’, ‘temperature’], color=’temperature’, <br/>title= ‘Global Co2 Emission &amp; Temperature Anomaly’, <br/>labels={‘co2’:’World co2 emission’}, height=400)<br/>fig.show()</em></span></pre><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lu"><img src="../Images/bd900b539026bbbec5e653cfba6c271c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zbxusxq_ZQgg6Xq2dxd_Jg.png"/></div></div></figure><p id="35a3" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">该图清楚地表明，当二氧化碳排放量增加时，温度会升高。</p><p id="dbac" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">带动画的散点图</strong></p><p id="938b" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">随着时间的推移，二氧化碳排放、温度异常和作物产量之间的关系如何？这里，我们试图在一个图上显示4个不同的变量。我们只需使用"<em class="lj"> facet_col" </em>选项并选择我们想要显示的属性/列<em class="lj">来分割绘图。我想看看气候变化对世界各地农作物产量的影响，所以我选择了这个地区作为我的facet_col。</em></p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="2a3b" class="le jq hi kv b fi lf lg l lh li"><em class="lj">fig = px.scatter(df_crop_temp_co2_reg, x=”temperature”,y=”co2", animation_frame=”Year”, animation_group=”Area”,size=”yield”, color=”region”, hover_name=”Area”, facet_col=”region”,size_max=45)fig.show()</em></span></pre><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="fa17" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">将Plotly图表导出为HTML </strong></p><p id="4862" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">要将可视化导出为HTML文件:</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="d56c" class="le jq hi kv b fi lf lg l lh li"><strong class="kv hj">import</strong> <strong class="kv hj">plotly.io</strong> <strong class="kv hj">as</strong> <strong class="kv hj">pio</strong><br/>pio.write_html(fig, file='temp.html', auto_open=<strong class="kv hj">True</strong>)</span></pre><h2 id="f3e9" class="le jq hi bd jr lv lw lx jv ly lz ma jz jc mb mc kd jg md me kh jk mf mg kl mh bi translated">上传可视化到Plotly</h2><p id="03ed" class="pw-post-body-paragraph ir is hi it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hb bi translated">要将可视化上传到您的Plotly帐户，首先，您需要使用</p><p id="fd97" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><code class="du ks kt ku kv b">!pip install chart_studio</code></p><p id="be4c" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">然后使用导入它</p><p id="c8cb" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><code class="du ks kt ku kv b">import chart_studio</code></p><p id="8c6e" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">要从您的笔记本连接到它，您将需要您的Plotly帐户的用户名和API密钥。然后按如下方式设置您的凭据:</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="518a" class="le jq hi kv b fi lf lg l lh li">username = '' # your username<br/>api_key = '' # your api key keychart_studio.tools.set_credentials_file(username=username, api_key=api_key)</span></pre><p id="1328" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">使用以下代码行将可视化上传到您的帐户:</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="f8e3" class="le jq hi kv b fi lf lg l lh li">import chart_studio.plotly as py<br/>py.plot(fig, filename = 'file name', auto_open=True)</span></pre><p id="a2c8" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">好吧！我们看到了如何使用Plotly制作非常互动的可视化效果，将其导出到HTML，并上传到Plotly帐户。</p><p id="5cc2" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">感谢您的阅读！</p><p id="4553" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">参考资料:</p><div class="mi mj ez fb mk ml"><a href="https://towardsdatascience.com/how-to-create-a-plotly-visualization-and-embed-it-on-websites-517c1a78568b" rel="noopener follow" target="_blank"><div class="mm ab dw"><div class="mn ab mo cl cj mp"><h2 class="bd hj fi z dy mq ea eb mr ed ef hh bi translated">如何创建一个Plotly可视化，并将其嵌入网站</h2><div class="ms l"><h3 class="bd b fi z dy mq ea eb mr ed ef dx translated">Plotly是一个开源的、易于使用的python图表库。Plotly.express是作为Plotly.py的包装器构建的…</h3></div><div class="mt l"><p class="bd b fp z dy mq ea eb mr ed ef dx translated">towardsdatascience.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz ik ml"/></div></div></a></div><div class="mi mj ez fb mk ml"><a rel="noopener follow" target="_blank" href="/plotly/introducing-plotly-express-808df010143d"><div class="mm ab dw"><div class="mn ab mo cl cj mp"><h2 class="bd hj fi z dy mq ea eb mr ed ef hh bi translated">✨推出Plotly快递✨</h2><div class="ms l"><h3 class="bd b fi z dy mq ea eb mr ed ef dx translated">Plotly Express是一个新的高级Python可视化库:它是Plotly.py的包装器，公开了一个简单的…</h3></div><div class="mt l"><p class="bd b fp z dy mq ea eb mr ed ef dx translated">medium.com</p></div></div><div class="mu l"><div class="na l mw mx my mu mz ik ml"/></div></div></a></div></div></div>    
</body>
</html>