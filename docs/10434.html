<html>
<head>
<title>How to write Efficient DataPipeline in Keras/Tensorflow with TensorPipe.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 TensorPipe 在 Keras/Tensorflow 中编写高效的 DataPipeline？</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-write-efficient-datapipeline-in-keras-tensorflow-with-tensorpipe-3391b4be191d?source=collection_archive---------20-----------------------#2020-10-18">https://medium.com/analytics-vidhya/how-to-write-efficient-datapipeline-in-keras-tensorflow-with-tensorpipe-3391b4be191d?source=collection_archive---------20-----------------------#2020-10-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es im"><img src="../Images/6b58446bc042d5f7ca3cc953021920fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ILix6WoMWJ75Fxqm"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">在<a class="ae jc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae jc" href="https://unsplash.com/@samthewam24?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Samuel Sianipar </a>拍照</figcaption></figure><h1 id="7c25" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">TensorPipe:用 core TensorFlow 编写的高性能、灵活的数据管道。</h1><blockquote class="kb kc kd"><p id="1c0f" class="ke kf kg kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hb bi translated">为什么要让你宝贵而聪明的模型等待愚蠢的数据。</p></blockquote><p id="656e" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated">【github.com/kartik4949/TensorPipe T4】</p><p id="38ae" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated"><strong class="kh hj">作者。</strong></p><p id="af8f" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated">Kartik Sharma，我是 TensorPipe 的创造者。</p><p id="8575" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated"><strong class="kh hj">LinkedIn</strong>:<a class="ae jc" href="https://www.linkedin.com/in/kartik-sharma-aaa021169/" rel="noopener ugc nofollow" target="_blank"><em class="kg">https://www.linkedin.com/in/kartik-sharma-aaa021169/</em></a></p><p id="facf" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated"><strong class="kh hj">GitHub</strong>:<em class="kg">github.com/kartik4949</em></p><p id="8cfb" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated"><strong class="kh hj">让我们潜入 TensorPipe，</strong></p><p id="6e26" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated">在 TensorFlow 中，开发灵活且高性能的<strong class="kh hj">数据管道</strong>是一项痛苦的任务。</p><p id="5549" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated">艺术发展水平的增强是以一种非常笨拙的方式编写的，你没有必要在 Tensorflow 中找到它的版本。</p><p id="52a0" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated"><a class="ae jc" href="http://github.com/kartik4949/TensorPipe" rel="noopener ugc nofollow" target="_blank"> <strong class="kh hj"> TensorPipe </strong> </a>以<strong class="kh hj">高性能</strong>填补了这一“空白”，在 core TensorFlow 编写的一个软件包中灵活地加载了计算机视觉领域可用的所有 SOTA 增强功能。</p><p id="79e6" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated"><strong class="kh hj"> Github 链接:</strong>T30】T31】github.com/kartik4949/TensorPipeT33】</p><p id="5128" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated">TensorPipe 支持对象检测、关键点、分类和分段数据集。</p><h1 id="a682" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">一些增强列表:</h1><p id="5cd7" class="pw-post-body-paragraph ke kf hi kh b ki lg kk kl km lh ko kp ld li ks kt le lj kw kx lf lk la lb lc hb bi translated"><strong class="kh hj">混合</strong>:用给定的 alpha 值将两幅随机采样的图像混合成一幅。</p><p id="4a1e" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated"><strong class="kh hj"> CutMix: </strong>将一个调整大小的图像完全重叠在另一个随机图像上。</p><p id="0efc" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated"><strong class="kh hj">马赛克:</strong>用随机采样的四幅图像构建类似马赛克的图像。</p><p id="040e" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated"><strong class="kh hj"> GridMask: </strong>在给定的输入图像上屏蔽网格状屏蔽。</p><p id="8269" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated"><strong class="kh hj">随机选择酶:</strong>从给定图像中删除随机矩形。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es ll"><img src="../Images/b64db2caf4fabc3eebc9c1ddaa31bc20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ujbs77Cos8ZES8XiS-n4A.png"/></div></div></figure><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es lm"><img src="../Images/0983742afdc813ed0d7f9173937ebbe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*92rF17GpO-6XFZ7dr-zPKw.png"/></div></figure><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es ln"><img src="../Images/8f68d01921dc2ab2150a8552b3a8cb63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*ot72dy0fPx90zOiGMuNbOA.png"/></div></figure></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="0942" class="jd je hi bd jf jg lo ji jj jk lp jm jn jo lq jq jr js lr ju jv jw ls jy jz ka bi translated">配置</h1><ul class=""><li id="f404" class="lt lu hi kh b ki lg km lh ld lv le lw lf lx lc ly lz ma mb bi translated"><strong class="kh hj"> image_size </strong> —输出管道的图像尺寸。</li><li id="83f4" class="lt lu hi kh b ki mc km md ld me le mf lf mg lc ly lz ma mb bi translated"><strong class="kh hj"> batch_size </strong> —管道的批量。</li><li id="fcf9" class="lt lu hi kh b ki mc km md ld me le mf lf mg lc ly lz ma mb bi translated"><strong class="kh hj">转换</strong> —与相应关键字参数一起应用的转换字典。</li><li id="e828" class="lt lu hi kh b ki mc km md ld me le mf lf mg lc ly lz ma mb bi translated"><strong class="kh hj">分类编码</strong> —分类数据的编码— ('labelencoder '，' onehotencoder ')。</li></ul><h1 id="6eea" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">初学者 Keras 用法</h1><p id="84d0" class="pw-post-body-paragraph ke kf hi kh b ki lg kk kl km lh ko kp ld li ks kt le lj kw kx lf lk la lb lc hb bi translated">在本例中，我们将使用配置创建一个<strong class="kh hj"> TensorPipe </strong>管道，并将使用该管道训练<strong class="kh hj"> VGG16 </strong>网络。</p><p id="28b0" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated"><strong class="kh hj">步骤 1: </strong>让我们从导入和创建我们使用所需的配置开始。</p><p id="9975" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated">图像大小应为(100，100)，批次大小为 2，分类编码为标签编码器。</p><pre class="in io ip iq fd mh mi mj mk aw ml bi"><span id="cca5" class="mm je hi mi b fi mn mo l mp mq">import tensorflow as tf<br/>from pipe import Funnel<br/><br/>"""<br/>Create a Funnel for the Pipeline!<br/>"""<br/><br/>config = {<br/>    "batch_size": 2,<br/>    "image_size": [100, 100]}</span></pre><p id="72c1" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated">要应用于数据管道的转换。</p><ol class=""><li id="6654" class="lt lu hi kh b ki kj km kn ld mr le ms lf mt lc mu lz ma mb bi translated">左右翻转、网格遮罩和随机旋转。</li></ol><pre class="in io ip iq fd mh mi mj mk aw ml bi"><span id="54ff" class="mm je hi mi b fi mn mo l mp mq">"transformations": {<br/>        "flip_left_right": None,<br/>        "gridmask": {prob: 0.5},<br/>        "random_rotate": {rotate: 10},<br/>    },</span></pre><p id="b63a" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated"><strong class="kh hj">步骤 2: </strong>让我们用给定的配置为我们的管道创建一个漏斗。</p><pre class="in io ip iq fd mh mi mj mk aw ml bi"><span id="b92d" class="mm je hi mi b fi mn mo l mp mq">import tensorflow as tf<br/>from pipe import Funnel<br/><br/>"""<br/>Create a Funnel for the Pipeline!<br/>"""<br/><br/>config = {<br/>    "batch_size": 2,<br/>    "image_size": [100, 100],<br/>    "transformations": {<br/>        "flip_left_right": None,<br/>        "gridmask": {prob: 0.5},<br/>        "random_rotate": {rotate: 10},<br/>    },<br/>    "categorical_encoding": "labelencoder",<br/>}<br/>pipeline = Funnel(data_path="testdata", config=config, datatype="categorical")<br/># Created a Funnel with given config.</span></pre><p id="b6d9" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated">在上面的例子中，我们创建了一个具有灵活配置的数据管道，所有优化都将在 TensorPipe 内部处理。</p><p id="bcad" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated"><strong class="kh hj">第三步:</strong>让我们从给定的数据集中获取训练数据集。</p><pre class="in io ip iq fd mh mi mj mk aw ml bi"><span id="ee99" class="mm je hi mi b fi mn mo l mp mq">pipeline = pipeline.dataset(type="train")</span></pre><p id="43a6" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated"><strong class="kh hj">步骤 4: </strong>创建一个 Keras 模型。</p><pre class="in io ip iq fd mh mi mj mk aw ml bi"><span id="fa39" class="mm je hi mi b fi mn mo l mp mq"># Create Keras model<br/>model = tf.keras.applications.VGG16(<br/>    include_top=True, weights=None,input_shape=(100,100,3),<br/>    pooling=None, classes=2, classifier_activation='sigmoid'<br/>)<br/><br/># compile<br/>model.compile(loss='mse', optimizer='adam')<br/><br/># pass pipeline as iterable</span></pre><p id="851e" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated"><strong class="kh hj">步骤 5: </strong>最后让我们用给定的数据管道训练 Keras 模型。</p><pre class="in io ip iq fd mh mi mj mk aw ml bi"><span id="9c03" class="mm je hi mi b fi mn mo l mp mq">import tensorflow as tf<br/>from pipe import Funnel<br/><br/>"""<br/>Create a Funnel for the Pipeline!<br/>"""<br/><br/>config = {<br/>    "batch_size": 2,<br/>    "image_size": [100, 100],<br/>    "transformations": {<br/>        "flip_left_right": None,<br/>        "gridmask": None,<br/>        "random_rotate": None,<br/>    },<br/>    "categorical_encoding": "labelencoder",<br/>}<br/>pipeline = Funnel(data_path="testdata", config=config, datatype="categorical")<br/>pipeline = pipeline.dataset(type="train")<br/><br/># Create Keras model<br/>model = tf.keras.applications.VGG16(<br/>    include_top=True, weights=None,input_shape=(100,100,3),<br/>    pooling=None, classes=2, classifier_activation='sigmoid'<br/>)<br/><br/># compile<br/>model.compile(loss='mse', optimizer='adam')<br/><br/># pass pipeline as iterable<br/>model.fit(pipeline , batch_size=2,steps_per_epoch=5,verbose=1)</span></pre><p id="2ce1" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated"><strong class="kh hj">请启动我的存储库，将其用于分类数据集，因为当前 bbox 和关键点支持是 WIP。</strong></p><p id="dc70" class="pw-post-body-paragraph ke kf hi kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc hb bi translated"><a class="ae jc" href="http://github.com/kartik4949/TensorPipe" rel="noopener ugc nofollow" target="_blank">github.com/kartik4949/TensorPipe</a></p></div></div>    
</body>
</html>