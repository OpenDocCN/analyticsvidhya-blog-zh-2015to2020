<html>
<head>
<title>The ultimate OpenCV cross compilation guide for embedded processors</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">嵌入式处理器OpenCV交叉编译终极指南</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/the-ultimate-opencv-cross-compilation-guide-for-embedded-processors-f2fdc8ccb7b2?source=collection_archive---------8-----------------------#2020-03-12">https://medium.com/analytics-vidhya/the-ultimate-opencv-cross-compilation-guide-for-embedded-processors-f2fdc8ccb7b2?source=collection_archive---------8-----------------------#2020-03-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ae6451f09588b2aff395226d65600d91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eMHQao2QjwOBm8hlVHQiqw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">在<a class="ae iu" href="https://unsplash.com/s/photos/circuit-board?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae iu" href="https://unsplash.com/@_louisreed?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">路易斯·里德</a>拍摄的照片</figcaption></figure><p id="d903" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我在这里，致力于这个项目来评估计算机视觉和卷积神经网络的边缘。我已经将训练好的模型导出为冻结图，并准备使用OpenCV进行一些推理。一切都很顺利，直到我意识到OpenCV需要为我的设备从源代码构建，一个是基于ARMv8的，另一个是32位的PowerPC。</p><p id="410a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在ARMv8设备上构建OpenCV非常简单，因为它有足够的内存和足够的速度。PowerPC不能存储超过2个二进制文件，并且需要交叉编译OpenCV。OpenCV源代码带有交叉编译脚本，但是没有用于32位PowerPC的脚本。我在网上找不到任何具体的解决方案，所以我把我的放在这里作为其他人的参考。</p><p id="9e2e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意:下面的说明是针对32位PowerPC的，您只需要用您的体系结构替换PowerPC。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="44fd" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">a)下载交叉编译工具</h2><p id="83f0" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">根据您的主机和目标平台，下载gcc和g++编译器。可以在<a class="ae iu" href="https://gcc.gnu.org/install/specific.html" rel="noopener ugc nofollow" target="_blank"> GNU安装页面</a>找到支持的架构列表</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="1f99" class="ka kb hi lf b fi lj lk l ll lm">sudo apt-get install gcc-powerpc-linux-gnu g+-powerpc-linux-gnu</span></pre><h2 id="f518" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">b)克隆OpenCV</h2><p id="d445" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">将OpenCV从Github资源库下载或克隆到您选择的工作目录(在我的例子中是home)中，并在其中创建一个构建目录。</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="5bdd" class="ka kb hi lf b fi lj lk l ll lm">git clone <a class="ae iu" href="https://github.com/opencv/opencv.git" rel="noopener ugc nofollow" target="_blank">https://github.com/opencv/opencv.git</a><br/>cd ~/opencv<br/>mkdir build</span></pre><h2 id="a277" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">c)交叉编译OpenCV</h2><p id="01af" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">在opencv/platforms/linux目录下创建一个toolchain.cmake文件，如下所示。将路径替换为与a节中下载的工具链相对应的路径。</p><figure class="la lb lc ld fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="ad16" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">移动到构建目录并运行下面的命令。要更快地并行运行该命令，请将-j后面的数字替换为您想要使用的处理器数量。运行命令<em class="lp"> nproc </em>将给出可用处理器的数量。</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="2b5d" class="ka kb hi lf b fi lj lk l ll lm">cmake -D CMAKE_VERBOSE_MAKEFILE=ON \<br/>-D CMAKE_GENERATE_PKGCONFIG=YES \<br/>-D CMAKE_TOOLCHAIN_FILE=../platforms/linux/ppc-gnu.toolchain.cmake \ ..</span><span id="76a3" class="ka kb hi lf b fi lq lk l ll lm">make -j16<br/>sudo make install</span></pre><p id="c1d3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">OpenCV现在应该安装在install_prefix目录中。接下来，将二进制文件复制到目标平台。复制prefix_directory中的所有二进制文件可能会导致一些不匹配的错误，因此建议只复制安装OpenCV后添加的文件。</p><p id="b006" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，更新路径以定位新的OpenCV库。根据您的目标系统,/etc目录会有一个ld.so.conf.d目录或一个ld.so.conf文件。对于前者，创建一个open.cv文件，否则直接编辑该文件。在目标设备上运行以下命令。</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="9cb6" class="ka kb hi lf b fi lj lk l ll lm">vi /etc/ld.so.conf</span><span id="3fb2" class="ka kb hi lf b fi lq lk l ll lm">#add the path to the OpenCV library, save, and exit</span><span id="5bc4" class="ka kb hi lf b fi lq lk l ll lm">ldconfig -v<br/>export LD_LIBRARY_PATH = $LD_LIBRARY_PATH:/path/to/opencv/library</span></pre><h2 id="cba3" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">d)测试OpenCV</h2><p id="e280" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">我添加了一小段c++代码来使用OpenCV加载图像并调整其大小。</p><figure class="la lb lc ld fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="8605" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在您的主机平台上交叉编译这段代码。</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="ca9e" class="ka kb hi lf b fi lj lk l ll lm">powerpc-linux-gnu-g++-8 test_opencv.cpp -o test_opencv $(pkg-config --cflags --libs opencv4)</span></pre><p id="a964" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在目标设备上执行编译后的二进制文件。</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="e2a1" class="ka kb hi lf b fi lj lk l ll lm">./test_opencv imagepath</span></pre></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="b644" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢您的阅读，我希望这能帮助您加快工作速度。如果你喜欢它，请分享，这样其他人也可以从中受益！</p></div></div>    
</body>
</html>