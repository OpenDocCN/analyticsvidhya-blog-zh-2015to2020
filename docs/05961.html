<html>
<head>
<title>Market Basket Analysis with Apriori Algorithm</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Apriori算法的购物篮分析</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/market-basket-analysis-with-apriori-algorithm-d2b9dfba6360?source=collection_archive---------8-----------------------#2020-05-07">https://medium.com/analytics-vidhya/market-basket-analysis-with-apriori-algorithm-d2b9dfba6360?source=collection_archive---------8-----------------------#2020-05-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6b98d6e2f6d0f924abd998db04f08a3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*X115pgrT2PEcT-1P.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">资料来源:clip.cookdiary.net</figcaption></figure><p id="a020" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">大家好，这次我想分享一个关于关联规则挖掘的分析。关联规则挖掘是一种发现项目组合之间关联规则的数据挖掘技术。你明白了吗，伙计？例如，来自超市购买分析的关联规则是了解顾客有多大可能购买牛奶和麦片。有了这种分析，超市老板可以安排商品的摆放或设计针对某些组合商品的打折营销活动。</p><p id="e7da" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">关联规则挖掘成为零售业中常见的分析方法。关联规则挖掘也称为术语<em class="js">购物篮分析、</em>，我们可以在我们的分析中获得与三个重要参数(<strong class="iw hj">支持度</strong>、<strong class="iw hj">置信度</strong>、&amp;、T6】升力良好结合的信息</p><p id="edd8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">最大的零售公司的一个例子是亚马逊，它已经应用于分析客户的购买习惯，通过发现客户放在他们的“<em class="js">篮子</em>”中的不同商品之间的关联。在预处理这个数据集之前，让我先介绍一下我在这个分析中使用的算法。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="7a72" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">Apriori算法</h1><p id="a269" class="pw-post-body-paragraph iu iv hi iw b ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn lc jp jq jr hb bi translated">Apriori算法用于发现数据集中一个或多个项目之间的关系模式，该算法假设频繁项目集的任何子集都必须是频繁的。下面我们来可视化一个例子！</p><p id="32ad" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里是一个由四个发票(交易)组成的数据集。每张发票都是0和1的组合，其中0代表没有某个项目，1代表有该项目。</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ld"><img src="../Images/bd4ee1f9f0e14cccab316efd4b52fefd.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*PEQjXu5M8Io3jFeKRb9oDA.png"/></div></div></figure><p id="e433" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">就像我之前说的，关联规则的重要性可以由三个参数决定。</p><ol class=""><li id="b44f" class="li lj hi iw b ix iy jb jc jf lk jj ll jn lm jr ln lo lp lq bi translated"><strong class="iw hj"> Support </strong>是包含特定项目组合的事务相对于数据库中事务总数的百分比。</li></ol><p id="e3bb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">支持(谷物)=(涉及葡萄的交易)/(总交易)</p><p id="bfd6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">2.<strong class="iw hj">置信度</strong>是条件概率的度量。假设左手边的物品(<strong class="iw hj">前因</strong>)被购买，那么右手边的物品(<strong class="iw hj">后果</strong>)也将被购买。</p><p id="82d5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">置信度(<strong class="iw hj">前因</strong> = &gt; <strong class="iw hj">后果</strong> ) =(同时涉及<strong class="iw hj">前因</strong>和<strong class="iw hj">后果</strong>的交易)/(仅涉及<strong class="iw hj">前因</strong>的交易)</p><p id="7298" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">信心</strong>((牛奶、鸡蛋)= &gt;酸奶)= <strong class="iw hj">支持</strong>(牛奶&amp;鸡蛋&amp;酸奶)/ <strong class="iw hj">支持</strong>(牛奶&amp;鸡蛋)</p><p id="61f8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">3.<strong class="iw hj"> Lift是</strong>它是所有项目一起发生的概率除以<strong class="iw hj">前因</strong>和<strong class="iw hj">后果</strong>的乘积，就好像它们彼此独立地发生一样</p><p id="9bef" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Lift( <strong class="iw hj">前因</strong> = &gt; <strong class="iw hj">后果</strong> ) = Confidence( <strong class="iw hj">前因</strong>，<strong class="iw hj">后果</strong> ) / Support( <strong class="iw hj">后果</strong></p><p id="99ba" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，客户同时购买<strong class="iw hj">前因</strong>和<strong class="iw hj">后果</strong>的可能性是单独购买的机会的“提升价值”倍。</p><ul class=""><li id="1990" class="li lj hi iw b ix iy jb jc jf lk jj ll jn lm jr lr lo lp lq bi translated"><strong class="iw hj"> Lift(前因<em class="js"> </em> = &gt;后果)</strong> = 1表示项集内没有相关性。</li><li id="a9a4" class="li lj hi iw b ix ls jb lt jf lu jj lv jn lw jr lr lo lp lq bi translated"><strong class="iw hj">Lift(antecedent =&gt;outcome)</strong>&gt;1表示项目集内部存在正相关关系，即项目集中的产品，<strong class="iw hj"> antecedent </strong> <em class="js">，</em>和<strong class="iw hj">outcome</strong>更有可能一起购买。</li><li id="4180" class="li lj hi iw b ix ls jb lt jf lu jj lv jn lw jr lr lo lp lq bi translated"><strong class="iw hj">Lift(antecedent =&gt;outcome)</strong>&lt;1表示项目集内部存在负相关，即项目集中的产品，<strong class="iw hj"> antecedent </strong> <em class="js">，</em>和<strong class="iw hj">outcome</strong>不可能一起购买。</li></ul></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="f5be" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">apriori算法简介</h1><p id="3a22" class="pw-post-body-paragraph iu iv hi iw b ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn lc jp jq jr hb bi translated">这个数据集是我从kaggle获得的，包含了顾客在超市购买不同杂货的信息。我有大约7000行数据。在使用apriori算法进行建模之前，让我们先研究一下这个数据集。</p><figure class="le lf lg lh fd ij er es paragraph-image"><div class="ab fe cl lx"><img src="../Images/bb3c70984c195691e1617782ed9d3cad.png" data-original-src="https://miro.medium.com/v2/format:webp/1*m27QGlsZWZDMuBYyqgvWyA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">我有大约7500行数据，用于为每个组合项创建关联规则。</figcaption></figure><h2 id="c77c" class="ly kb hi bd kc lz ma mb kg mc md me kk jf mf mg ko jj mh mi ks jn mj mk kw ml bi translated">探索性数据分析</h2><figure class="le lf lg lh fd ij er es paragraph-image"><div class="er es mm"><img src="../Images/7e884275eed90074803845e5ef289eb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*guwFqAfevmp5JJ2UXWig3g.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">我用文字云和30个项目限制这个图像。</figcaption></figure><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/bd5063a88de1997b6132e9da22d69131.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d6bAdog_NUvm9N_l7k9ICA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">我用seaborn plot制作这个图。</figcaption></figure><p id="33db" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">从这个图中，我得出结论，这个交易主要是矿泉水，以及一些基本需求(可能是早餐)，如鸡蛋、意大利面和薯条。</p><h2 id="87ea" class="ly kb hi bd kc lz ma mb kg mc md me kk jf mf mg ko jj mh mi ks jn mj mk kw ml bi translated">apriori算法是如何工作的？</h2><p id="af9d" class="pw-post-body-paragraph iu iv hi iw b ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn lc jp jq jr hb bi translated">首先，我将为这个分析获取所有的“缺失值”,并尝试在结果的最后处理它。第一步使一个频繁项集的所有子集必须是频繁的，用<em class="js">频率表</em>对每个事务进行处理。</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/b376c0928fd5a426d88cdfe9701aaea8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hIUk77ZFA78YJkBXpBowog.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">交易编码器频率表的结果</figcaption></figure><p id="2c8d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下一步是构建apriori模型，您可以在mlxtend包中更改apriori模型的所有参数。我将尝试使用参数<strong class="iw hj">最小支持</strong>进行建模。这意味着支持大于参数将显示在结果中。</p><pre class="le lf lg lh fd mr ms mt mu aw mv bi"><span id="fa56" class="ly kb hi ms b fi mw mx l my mz"><strong class="ms hj">from</strong> mlxtend.frequent_patterns <strong class="ms hj">import</strong> apriori</span><span id="79c6" class="ly kb hi ms b fi na mx l my mz"><strong class="ms hj">frequent_itemsets</strong>= <strong class="ms hj">apriori</strong>(data, <strong class="ms hj">min_support</strong> = 0.01, use_colnames = True)</span></pre><figure class="le lf lg lh fd ij er es paragraph-image"><div class="er es nb"><img src="../Images/4dad1fc8975c70f0c7269c3a21b9098f.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*D2fUxjSWg8z2hn04vr76gA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">结果中有很多缺失值，所以我无法对缺失值的项集做出结论。</figcaption></figure><p id="274e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在我尝试处理丢失的值之前，我将生成最低支持度至少为1%的<em class="js">frequency _ items sets</em>,因为这是一个更有利的支持度，可以向我们显示更多的结果。</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nc"><img src="../Images/6fd7cbf8189632e6c72a725419439ceb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iZs3WEwoiW1TPRzQAFz0hA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">关联规则的结果为每个项集但有许多遗漏值。</figcaption></figure><h2 id="566b" class="ly kb hi bd kc lz ma mb kg mc md me kk jf mf mg ko jj mh mi ks jn mj mk kw ml bi translated">最终关联规则结果</h2><p id="92ab" class="pw-post-body-paragraph iu iv hi iw b ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn lc jp jq jr hb bi translated">从上面的关联规则结果来看，有许多遗漏的值。我无法将项目集与缺少的值组合起来。因此，我将尝试处理前件和后件中每个项目集缺少的值。他们俩的结果是一个<em class="js">冷冻群。</em></p><blockquote class="nd ne nf"><p id="eea3" class="iu iv js iw b ix iy iz ja jb jc jd je ng jg jh ji nh jk jl jm ni jo jp jq jr hb bi translated">frozenset()方法返回一个不可变的frozenset对象，该对象用给定iterable中的元素初始化。</p></blockquote><p id="ec90" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我将把不可变的frozenset改为项目集列表，然后尝试为每个有缺失值的项目集检测缺失值(<strong class="iw hj"> drop nan values </strong>)。</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nj"><img src="../Images/3eee7f65c8f0e2934d6a36c9aa054d0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mb3YzH_Y_FD8JELxF-a5pw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">对于每个关联规则项集的最终结果，我从最高置信度值到最低置信度值排序(按降序排序)。我取前10个项目集。</figcaption></figure><p id="96b9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">从结果来看，关联规则“if<strong class="iw hj">ground beef&amp;eggs</strong>then<strong class="iw hj">mineral water</strong>”的提升是2.12，因为置信度是50%(该数据集的最高置信度)。这意味着购买<strong class="iw hj">碎牛肉&amp;鸡蛋</strong>的消费者购买矿泉水的可能性是随机选择的消费者的2.12倍。更大的升力意味着更有趣的规则。高支持度的关联规则是潜在有趣的规则。类似地，高可信度的规则也是有趣的规则。所以，你可以得出关联规则中三个参数最高的结论。</p><blockquote class="nd ne nf"><p id="8b9f" class="iu iv js iw b ix iy iz ja jb jc jd je ng jg jh ji nh jk jl jm ni jo jp jq jr hb bi translated"><strong class="iw hj">成果及应用:</strong></p><p id="b792" class="iu iv js iw b ix iy iz ja jb jc jd je ng jg jh ji nh jk jl jm ni jo jp jq jr hb bi translated">交叉销售可以通过捆绑销售项目/产品来改善</p><p id="30ca" class="iu iv js iw b ix iy iz ja jb jc jd je ng jg jh ji nh jk jl jm ni jo jp jq jr hb bi translated">促销活动可以提高顾客不买的商品的销量</p><p id="18b4" class="iu iv js iw b ix iy iz ja jb jc jd je ng jg jh ji nh jk jl jm ni jo jp jq jr hb bi translated">商店布局可以修改，这样当某些项目/产品放在一起时，销售额可以提高。</p></blockquote></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="cd73" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">以上都是我的看法，希望大家能对这个数据集有所感悟。我做的每一个模型都还有很多错误和缺点。关于这些数据的更多细节，代码，和更多的可视化你可以通过点击这个链接<a class="ae nk" href="github.com/Anugrahn/Data-Science-Practice" rel="noopener ugc nofollow" target="_blank">https://github.com/Anugrahn</a>到达我的github。随便问，让我们开始讨论家伙！</p><p id="5f39" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">谢谢，我希望你们喜欢它。下一个故事再见。祝您愉快！:)</p><p id="fdec" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">来源:</p><ol class=""><li id="3cd9" class="li lj hi iw b ix iy jb jc jf lk jj ll jn lm jr ln lo lp lq bi translated">来自<em class="js">kaggle.com</em>的数据集购物篮优化</li><li id="5c55" class="li lj hi iw b ix ls jb lt jf lu jj lv jn lw jr ln lo lp lq bi translated">来自<em class="js">mlx tend&amp;frozenset python</em>的原始文档</li><li id="511d" class="li lj hi iw b ix ls jb lt jf lu jj lv jn lw jr ln lo lp lq bi translated">菜篮子分析入门从<a class="ae nk" href="https://towardsdatascience.com/market-basket-analysis-978ac064d8c6" rel="noopener" target="_blank"><em class="js">https://towardsdatascience.com/</em></a><em class="js">&amp;</em><a class="ae nk" href="https://datapenchant.com/market-basket-analysis/" rel="noopener ugc nofollow" target="_blank">https://datapenchant.com/market-basket-analysis/</a></li></ol></div></div>    
</body>
</html>