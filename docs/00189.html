<html>
<head>
<title>Webscraping Spotify reviews using ‘rvest’ in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在R中使用“rvest”抓取Spotify评论</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/webscraping-spotify-reviews-using-rvest-in-r-406e1d069c51?source=collection_archive---------1-----------------------#2018-11-19">https://medium.com/analytics-vidhya/webscraping-spotify-reviews-using-rvest-in-r-406e1d069c51?source=collection_archive---------1-----------------------#2018-11-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a9df137eeaca797f65acf6b7a1238afa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pvB0cVRjsmEv6LvE.jpg"/></div></div></figure><p id="9c60" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">R中的“rvest”库是我工具箱中最新的抓取网站的工具！为了测试它，我决定抓取“Trustpilot”网站，这是一个供评论者评论服务和其他网站的流行平台。在这个搜集练习中，我计划提取评论者对Spotify的评分和评论。让我们看看用户对Spotify音乐有什么看法！</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jo"><img src="../Images/cff49e73d94699b3bacdcef9ad279162.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jDvxfkvTZU17_GNCHVQB6A.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">带有Spotify评论的Trustpilot网站</figcaption></figure><p id="8faa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们从加载所有必要的库开始。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jx"><img src="../Images/f5042927f775964a3265c388908de59f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Iynos708pvtaS3LUfxwLJA.png"/></div></div></figure><p id="c1cd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们创建一个变量来存储源url的html，在我们的例子中是Trustpilot网站上的Spotify页面。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jy"><img src="../Images/19b5d31afe033e058a2305e5ab019a84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7EFKYChWanzpKBmkE0e4Gg.png"/></div></div></figure><p id="2020" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的相关url存储在变量“content1”中。稍后当我们有一个函数来输入这个变量时，我们会用到它。</p><p id="5414" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们向下滚动，看到总共有15页包含评论。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jz"><img src="../Images/7c1d5011461e7268f79b05e9625227f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ImccwUlRrXxuZCKvE736tQ.png"/></div></div></figure><p id="113d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以我们写了一个函数来获取所有的15页。在代码中，html_nodes(' . ')表示类标签，html_text()表示我们希望文本不在html中。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ka"><img src="../Images/5179ebc7f78f3c140aeac53f28ca1dcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mTiYN_p9xI2aMUDz-pKTig.png"/></div></div></figure><p id="1e72" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们编写4个小函数来获取评论、评论者的姓名、星级和评论的日期时间。让我们一个接一个地去做。</p><ol class=""><li id="f032" class="kb kc hi is b it iu ix iy jb kd jf ke jj kf jn kg kh ki kj bi translated">函数来提取评论的正文</li></ol><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kk"><img src="../Images/906248501cd55bb00068aa13761aeb18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I9APoSGsX7z0-hPokw7TEQ.png"/></div></div></figure><p id="b2c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.提取审阅者姓名的函数</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/024a4079c57f413a7407b5fe5fbe886b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A8YuwJqsei8QCRF1EAe0zA.png"/></div></div></figure><p id="417d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.函数提取每个评论者的星级</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es km"><img src="../Images/adba3d1d5ca89667406c566e143b273b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*luoKgb4Y2-mIiaZqsL8JlA.png"/></div></div></figure><p id="50e2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.函数来提取每个评论的日期时间</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/02a90099bdb22924a2dc30aa4bcfa036.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8BxY0iZUsYZ2wH3P16TS2w.png"/></div></div></figure><p id="d295" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在将上述四个函数合并成一个通用函数。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/21f89e17cc4db7966a8efd51fcbfa332.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R0SQw31qCI6v64Zt4NEqVw.png"/></div></div></figure><p id="c226" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了方便起见，我们缩短了上面的函数。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kp"><img src="../Images/14ec1d13ccfc59acd107c2db9558484b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LA7aPmLFIEIE9-CnlTnoFw.png"/></div></div></figure><p id="f36c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个函数只抓取一个url。我们创建了一个组合函数来从多个页面(在我们的例子中是15个页面)抓取URL。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kq"><img src="../Images/3c60b1d4aa3bd9efceecdc20d169b630.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SIx6fVA-MqkF25TdhNxcqw.png"/></div></div></figure><p id="5e80" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，将我们相关的url和公司名称输入到上面创建的函数中。记住，我们的相关url位于变量“content1”中！</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/af95bee8845131918c24c2ff0dae290d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IQX31brdXxG7xzYe0SPPzg.png"/></div></div></figure><p id="00b0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将spotify表格转换为. tsv文件，因为. tsv文件存储了一个数据表，其中的数据列由制表符分隔。此外，这些文件可以导出的电子表格程序，这使得数据可以查看一个基本的文本编辑器或文字处理程序。我们将把spotify表格导出到一个excel文件中，以便将所有评论汇总在一起。</p><p id="f618" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在导出之前，我们将显示输出。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/677b74badfeb8b82afd77c312fb5f14c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RoeUayPne3f-1pIAObjQMg.png"/></div></div></figure><p id="4a35" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们得到一张5乘4的桌子。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/949d4333051bd56b79ec2d9a3416ad6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jWCHODzLK_VYbXQReCL1_A.png"/></div></div></figure><p id="6eb3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们将整个表格导出到excel文件。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ku"><img src="../Images/63b5c9cff70f438a5c8043f7a4b47b21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aUIK5O_ALXe6l6s5quV6RA.png"/></div></div></figure><p id="6558" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以我们终于导出了文件！让我们看看它是什么样子的:)</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/660f1009b8ac1fd01e76c05d96dd9751.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KSV0rOQIPxhmLR_DGVrQpA.png"/></div></div></figure><p id="515e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi">…</p><p id="494c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi">…</p><p id="a4e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi">…</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/309d656c9f1be3f4785b6c28452b699a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gm-_cw8KSjj74eq1PL593g.png"/></div></div></figure><p id="531f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">哇哦。我们已经为Spotify收集了300条用户评论:)</p><p id="061f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你喜欢读这篇文章，请给我掌声！</p><p id="9c00" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">源代码存放在我的GitHub上。</p><div class="kx ky ez fb kz la"><a href="https://github.com/tanmayeewaghmare/Web-scraping-using-R/blob/master/Spotify%20user%20ratings.R" rel="noopener  ugc nofollow" target="_blank"><div class="lb ab dw"><div class="lc ab ld cl cj le"><h2 class="bd hj fi z dy lf ea eb lg ed ef hh bi translated">tanmayeewaghmare/Web-scraping-using-R</h2><div class="lh l"><h3 class="bd b fi z dy lf ea eb lg ed ef dx translated">在GitHub上创建一个帐户，为tanmayeewaghmare/Web-scraping-using-R开发做出贡献。</h3></div><div class="li l"><p class="bd b fp z dy lf ea eb lg ed ef dx translated">github.com</p></div></div><div class="lj l"><div class="lk l ll lm ln lj lo io la"/></div></div></a></div></div></div>    
</body>
</html>