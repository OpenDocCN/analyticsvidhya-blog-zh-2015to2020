<html>
<head>
<title>Are farmers reaching a Living Income? The Machine Learning technical companion</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">农民达到生活收入了吗？机器学习技术伙伴</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/are-farmers-reaching-a-living-income-the-machine-learning-technical-companion-c8e4574868da?source=collection_archive---------26-----------------------#2020-12-16">https://medium.com/analytics-vidhya/are-farmers-reaching-a-living-income-the-machine-learning-technical-companion-c8e4574868da?source=collection_archive---------26-----------------------#2020-12-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3fdd85daf6a429a9186a12bfc368cdf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m1xmNjJFE5ZNhUngbxNr4g.jpeg"/></div></div></figure><h1 id="48cb" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated"><strong class="ak"> 1。简介</strong></h1><p id="d553" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">2020年9月9日，我写了第一篇<a class="ae km" rel="noopener" href="/analytics-vidhya/are-cocoa-farmers-reaching-a-living-income-f7724af574c4?sk=344c18d46a7fd402d3a137061c6ba89a"><strong class="jq hj"/></a><strong class="jq hj"/>的文章，讨论了机器学习模型是否可以预测农民(在加纳和科特迪瓦)是否达到生活收入，以及为什么这很重要。2020年12月16日，我写了一篇<a class="ae km" href="https://mtyszler.medium.com/are-farmers-reaching-a-living-income-c15523a564b2" rel="noopener">后续文章</a>，其中我展示了一个仅使用9个变量解决相同问题的机器学习模型，以及使用该模型的<a class="ae km" href="https://living-income-model.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> web app </a>。</p><blockquote class="kn ko kp"><p id="3271" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated">本帖是技术伴侣。在这里，我深入到上面两篇文章背后的技术细节，并从头到尾解释我的道路。</p></blockquote><h1 id="c2b8" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">2.项目定义</h1><h2 id="597b" class="kz ir hi bd is la lb lc iw ld le lf ja jz lg lh je kd li lj ji kh lk ll jm lm bi translated">2.1项目概述</h2><p id="18ee" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">正如在第一篇<a class="ae km" rel="noopener" href="/analytics-vidhya/are-cocoa-farmers-reaching-a-living-income-f7724af574c4?sk=344c18d46a7fd402d3a137061c6ba89a"> <strong class="jq hj">帖子</strong> </a>中介绍的那样，<a class="ae km" href="https://www.living-income.com/" rel="noopener ugc nofollow" target="_blank">生活收入实践社区</a>在制定更具挑战性的生活标准参考值方面做了大量工作:一个家庭拥有基本但体面的生活标准所需的最低金额。</p><p id="1289" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">然而，制定生活收入基准并收集数据来计算农民是否达到生活收入既昂贵又耗时。</p><p id="c31b" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">此前，我主持了两份关于加纳和科特迪瓦生活收入值差距分析的报告(此处<a class="ae km" href="https://c69aa8ac-6965-42b2-abb7-0f0b86c23d2e.filesusr.com/ugd/0c5ab3_fc3386a550b94a898c7757ee13ab59e6.pdf" rel="noopener ugc nofollow" target="_blank">此处</a>和<a class="ae km" href="https://c69aa8ac-6965-42b2-abb7-0f0b86c23d2e.filesusr.com/ugd/0c5ab3_93560a9b816d40c3a28daaa686e972a5.pdf" rel="noopener ugc nofollow" target="_blank">此处</a>)。这些报告得益于我们的资助者公开提供的<a class="ae km" href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/82TWZJ" rel="noopener ugc nofollow" target="_blank">数据</a>(见<a class="ae km" href="https://www.kit.nl/project/demystifying-cocoa-sector/" rel="noopener ugc nofollow" target="_blank">项目网站</a>)。</p><p id="e5f1" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">我和我的同事们现有的数据和分类可以很容易地形成一个有监督的机器学习模型的训练数据集。即使数据集包含许多变量(这不是机器学习模型的阿瑟问题)，<strong class="jq hj">在这种特殊情况下，模型的现实世界可用性与它在多大程度上简化了原始数据收集的需求直接相关，即，它基于很少且(相对)容易收集的变量。</strong></p><blockquote class="kn ko kp"><p id="c30f" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated">最重要的是，我的目标是使模型(公开)在web应用程序中可用且易于使用(对于技术水平较低的用户)和可下载(对于技术水平较高的用户)。</p></blockquote></div><div class="ab cl ln lo gp lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hb hc hd he hf"><h2 id="dc5d" class="kz ir hi bd is la lb lc iw ld le lf ja jz lg lh je kd li lj ji kh lk ll jm lm bi translated">2.2问题陈述</h2><blockquote class="kn ko kp"><p id="ab55" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated">该项目的目标是创建一个具有不超过10个变量的高度稳健的机器学习模型，以预测农民是否达到生活收入。</p></blockquote><p id="eedd" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">为了解决这个问题，首先对原始数据进行处理，并为机器学习模型拟合做准备，对变量的数量没有限制。然后使用最佳模型来识别最具预测性的特征，从中选出前10个特征。然后，受限模型被重新校准以提高性能。</p><p id="b36c" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">在75%的完整数据集中进行了训练，剩下的25%用于测试。以目标标签的分层方式进行分割，以保证训练集和测试集具有相似的成功/失败份额。使用5重分层交叉验证优化超参数。交叉验证是分层的，以保证每个折叠也有相似的关键变量分布。</p><p id="aad3" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">预期的结果是一个模型，它将成功地根据农民是否达到生活收入对他们进行分类。成功通过测试集上的<strong class="jq hj">准确度、精确度、召回率</strong>和<strong class="jq hj">f-beta分数</strong> (beta=0.05)来衡量。</p></div><div class="ab cl ln lo gp lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hb hc hd he hf"><h2 id="016c" class="kz ir hi bd is la lb lc iw ld le lf ja jz lg lh je kd li lj ji kh lk ll jm lm bi translated">2.3指标</h2><p id="de0c" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">如上所述，这些模型在以下方面进行了比较:</p><ul class=""><li id="19ba" class="lu lv hi jq b jr kr jv ks jz lw kd lx kh ly kl lz ma mb mc bi translated">准确性:有多少预测是正确的？</li><li id="086d" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated"><strong class="jq hj">精度</strong>:as<code class="du mi mj mk ml b">true</code>的预测有多少是正确的？</li><li id="f959" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated"><strong class="jq hj">回忆:</strong>有多少<code class="du mi mj mk ml b">true</code>次观测被正确预测为<code class="du mi mj mk ml b">true</code></li><li id="cb9d" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated"><strong class="jq hj"> F-score: </strong>精确度和召回率调和平均值</li></ul><p id="b9e1" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">在这个项目中，达到生活收入的农民人数很少。所以准确度不能成为关键指标。原因是猜测没有人达到生活收入仍然产生一个高度准确的模型，只是因为大多数农民没有达到生活收入</p><p id="f11e" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">因此，精确度和召回率都非常重要。<strong class="jq hj">精确度稍微重要一点</strong>，因为我们不想在这里犯容易的错误:一旦模型说一个农民达到了生活收入，我们希望这实际上是真的。该模型的用户可能会用它来衡量进展，即在某项具体的发展/政策/经济举措实施后，有多少农民获得了生活收入。因此，在这里犯错误是有害的。</p><p id="e0cd" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">但是，回忆也很重要。我们不希望模型选择性太强，错过重要案例。一旦一个农民成为少数几个达到生活收入的人之一，我们希望这个模型能够很容易地发现这一点。</p><blockquote class="kn ko kp"><p id="5082" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated">因此，为了将<strong class="jq hj">精度</strong>和<strong class="jq hj">召回</strong>与精度的重要性稍微结合起来，我在机器学习训练中使用了<strong class="jq hj"> f-score (beta=0.5) </strong>作为<strong class="jq hj">关键优化指标</strong>。</p></blockquote></div><div class="ab cl ln lo gp lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hb hc hd he hf"><h1 id="04dc" class="iq ir hi bd is it mm iv iw ix mn iz ja jb mo jd je jf mp jh ji jj mq jl jm jn bi translated">3.方法学</h1><h1 id="faa6" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">3.1.机器学习模型</h1><h2 id="1e08" class="kz ir hi bd is la lb lc iw ld le lf ja jz lg lh je kd li lj ji kh lk ll jm lm bi translated">数据预处理</h2><blockquote class="kn ko kp"><p id="b11a" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated">数据的争论和数据的分析可以在这个<a class="ae km" href="https://github.com/mtyszler/LivingIncomeModel/blob/master/analysis%20notebooks/LivingIncomeAnalysis.ipynb" rel="noopener ugc nofollow" target="_blank"> jupyter笔记本</a>中看到</p></blockquote><p id="6aee" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">我首先以STATA 14二进制格式从<a class="ae km" href="https://doi.org/10.7910/DVN/82TWZJ" rel="noopener ugc nofollow" target="_blank">https://doi.org/10.7910/DVN/82TWZJ</a>提取数据集。我随后使用pandas的<code class="du mi mj mk ml b">read_stata</code>方法读取数据及其属性。</p><p id="80d2" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">太多变量</strong>(和观察值)</p><p id="6deb" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">下载的数据有3045和1252个变量。观察到的一些情况是，农民不生产可可，或者不知道自己的土地面积或产量数字。因为无法计算这些农民的收入，所以他们被从数据集中剔除。</p><p id="1129" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">因为这些显然是太多的变量(特别是相对于观察的数量而言)，我开始了移除我不感兴趣用于机器学习模型的变量的过程。其中包括:</p><ul class=""><li id="74b5" class="lu lv hi jq b jr kr jv ks jz lw kd lx kh ly kl lz ma mb mc bi translated">地点变量，国家除外，因为国家一级的分析就足够了</li><li id="4bc1" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">同意指示符，因为对于该数据集中包含的所有观察，这必须为“是”</li><li id="8d78" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">实例id，唯一标识符</li><li id="8616" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">关于被调查者的数据，如关于户主和整个家庭的数据就足够了</li><li id="a65d" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">使用估算值(前缀为<code class="du mi mj mk ml b">fm_</code>)的变量，因为估算仅基于国家级别，我更喜欢通过更详细的子组来完成</li><li id="626f" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">利润和生产价值的变量，因为这些可以在这里重新计算</li><li id="aff4" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">价格详情，因为将只使用以美元计的每公斤通用价格</li><li id="69e1" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">生产给定作物的农民子集的作物销售指标:该变量通过构造携带许多缺失值(那些没有生产给定作物的值),因此不感兴趣</li><li id="b11d" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">由于原始报告确认使用雇佣成本中值来调整回答中的噪音，因此报告了雇佣劳动日费率的变量</li><li id="2c55" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">关于人工活动或其他活动的“已知天数”的问题，因为这些是过滤人工天数的中间变量，因此不需要进行此分析</li><li id="d426" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">土地单位偏好，因为所有数据都已转换为公顷</li><li id="d03d" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated"><code class="du mi mj mk ml b">cocoa_certification_yn</code>，因为已经有一个<code class="du mi mj mk ml b">cocoa_certification_clean_yn </code>是更好的版本</li><li id="9d72" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">每项生产活动都有两个工人性别指标(<code class="du mi mj mk ml b">_gender_1, _gender_2</code>)，外加一个综合指标(<code class="du mi mj mk ml b">_gender</code>)。我可以晚点再谈</li><li id="c8ca" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">对于每项生产活动，有四种类型的工人指标(<code class="du mi mj mk ml b">hhhiredcom_</code>)，外加一个综合指标(<code class="du mi mj mk ml b">hh_hi</code>)。我可以放弃后者。</li><li id="3aec" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">产量分配有3组特征:公斤、公斤/公顷和占总产量的份额。我只保留了一份股份。</li><li id="2ef1" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">为了进行分析，我决定只包括了解自己土地和产量的可可种植户。因此，在过滤掉那些回答了这些变量的人之后，我可以去掉这些变量</li><li id="c683" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">对于这个分析，我只对一年的总产量感兴趣，而不是按季节分解。因此，特定季节的变量也可能被删除</li><li id="87dd" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">由于我只研究可可家庭，我也可以去掉一些其他家庭类型指标</li></ul><p id="28dd" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">去掉所有这些变量和观察值后，数据集现在有1455个观察值和871个变量</p><p id="5d3a" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">计算年收入</strong></p><p id="1be5" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">我计算的家庭总收入为:</p><p id="fbda" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><em class="kq">家庭总收入=(可可净收入)/(可可收入份额)</em></p><p id="9d57" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">换句话说，我计算了可可净收入，并通过使用可可收入在总收入中所占份额的信息来推断家庭收入</p><p id="3ec8" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">Te <em class="kq">可可净收入</em>计算如下:</p><p id="e685" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><em class="kq">可可净收入=(总产量(公斤/公顷)*价格(美元/公斤)-投入成本(美元/公顷)-劳动力成本(美元/公顷)*生产用地(公顷)</em></p><p id="9acb" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">为了计算投入成本和劳动力成本，我需要检查不同的投入类型和生产活动。对于每一项生产活动，投入和/或劳动力成本都有可能缺失。为了在这些情况下不丢弃观察值，我的策略是，如果活动没有完成，则强制值为0，否则，根据进行活动的同一个分析组中农民每公顷的中值来填充缺失值，并可以指定成本。</p><blockquote class="kn ko kp"><p id="1a91" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated"><strong class="jq hj">分析小组</strong></p><p id="5187" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated"><em class="hi">根据差距分析研究(</em> <a class="ae km" href="https://c69aa8ac-6965-42b2-abb7-0f0b86c23d2e.filesusr.com/ugd/0c5ab3_fc3386a550b94a898c7757ee13ab59e6.pdf" rel="noopener ugc nofollow" target="_blank"> <em class="hi">此处</em> </a> <em class="hi">和</em> <a class="ae km" href="https://c69aa8ac-6965-42b2-abb7-0f0b86c23d2e.filesusr.com/ugd/0c5ab3_93560a9b816d40c3a28daaa686e972a5.pdf" rel="noopener ugc nofollow" target="_blank"> <em class="hi">此处</em> </a> <em class="hi">)，我为每个国家创建了3个组:</em></p><p id="e10b" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated"><em class="hi">女户主</em></p><p id="e9d7" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated"><em class="hi">男户主，典型:多产可可土地达4公顷</em></p><p id="c787" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated"><em class="hi">男性户主，大:可可生产用地大于4公顷</em></p><p id="333c" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated"><em class="hi">由于组</em> <code class="du mi mj mk ml b"><em class="hi">Côte d'Ivoire: Female-headed</em></code> <em class="hi">太小(N = 15)，我将把它从分析中删除</em></p></blockquote><p id="8f24" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">数值随时间的调整</strong></p><p id="aa08" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">由于这种分析的主要目标是将总收入与生活收入基准值进行比较，因此它们需要在购买力方面具有可比性。</p><p id="e8ff" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">生活收入基准值参考Q1 2018年(加纳)和Q2 2018年(科特迪瓦)。另一方面，农户和生产数据参考了Q1 2016年数据。因此使用了一个<a class="ae km" href="http://data.imf.org/regular.aspx?key=61545849" rel="noopener ugc nofollow" target="_blank"> CPI修正系数</a>来得出2016年至2018年的调查数据值。</p><p id="bef5" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">生活收入基准值</strong></p><p id="c5d4" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">我创建了一个包含生活基准值的特性。这些值可以在<a class="ae km" href="https://c69aa8ac-6965-42b2-abb7-0f0b86c23d2e.filesusr.com/ugd/0c5ab3_fc3386a550b94a898c7757ee13ab59e6.pdf" rel="noopener ugc nofollow" target="_blank">这里</a>和<a class="ae km" href="https://c69aa8ac-6965-42b2-abb7-0f0b86c23d2e.filesusr.com/ugd/0c5ab3_93560a9b816d40c3a28daaa686e972a5.pdf" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="003f" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">达到生活收入指标</strong></p><blockquote class="kn ko kp"><p id="a26d" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated">最后，使用<em class="hi">总收入值</em>和<em class="hi">生活收入基准值</em>，我可以创建<strong class="jq hj">机器学习目标指标。</strong></p></blockquote><pre class="mr ms mt mu fd mv ml mw mx aw my bi"><span id="21ac" class="kz ir hi ml b fi mz na l nb nc">data['Living Income Achieved'] = data['Estimated total household income (USD/household/year)'] &gt;= data['Living Income Benchmark']</span></pre><p id="3b86" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">进一步的特征选择和缺失值填充</strong></p><p id="cc87" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">我通过移除ML模型不应该使用的<strong class="jq hj">特征或者有<strong class="jq hj">太多丢失值</strong>而无法使用的<strong class="jq hj">特征，进一步减小了数据集的大小。</strong></strong></p><blockquote class="kn ko kp"><p id="30bf" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated">目标是预测农户是否达到生活收入基准，而不知道他们的家庭总收入(如果知道家庭总收入，或者能够计算，就不需要分类器模型)。</p></blockquote><p id="d713" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">因此，我放弃了我刚刚构建的所有计算收入变量，加上劳动力和投入的合计和详细成本。我只保留了活动、性别和劳动类型的虚拟指标特征。此外，我:</p><ul class=""><li id="5c26" class="lu lv hi jq b jr kr jv ks jz lw kd lx kh ly kl lz ma mb mc bi translated">删除了调查中所有仅作为过滤器的<code class="du mi mj mk ml b">yes/no</code>问题</li><li id="56cc" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">删除了关于最重要作物的问题，因为这些都是种植可可的农民</li></ul><p id="f373" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">接下来，我创建了一个函数来计算每个变量中缺失值的数量，作为总数的一部分。这将有助于决定是填充缺失值还是删除要素。我注意到:</p><ul class=""><li id="6e83" class="lu lv hi jq b jr kr jv ks jz lw kd lx kh ly kl lz ma mb mc bi translated">树木数量和间距的变量也可以删除，因为它们有太多的缺失值</li><li id="b258" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">灌溉水源变量缺失(因为没人灌溉可可)。这些可以放弃。</li><li id="a685" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">大多数观察缺少最低膳食多样性(MDD)变量。这是一种解释，因为这些问题只问女性受访者。尽管它是一个潜在的好指标，但对于大多数样本来说，它被忽略了，所以我放弃了这些指标</li><li id="cbc0" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">出租土地的许多缺失值。仔细观察就会发现，只有那些租赁了土地的人才有价值。因此，如果土地没有租出去，我就实行<code class="du mi mj mk ml b">0</code>。</li></ul><p id="ba1d" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">缺失值调查还显示<code class="du mi mj mk ml b">times</code>、<code class="du mi mj mk ml b">hh_hi</code>、<code class="du mi mj mk ml b">gender</code>在施肥中有很多缺失值。这可能是因为对大多数农民来说，施用粪肥是第五年。这实际上是许多<code class="du mi mj mk ml b">yes/no</code>指标的情况，在第一个指标为<code class="du mi mj mk ml b">no</code>的情况下，详细的问题会丢失。因此，我将<code class="du mi mj mk ml b">no</code>应用于与之前<code class="du mi mj mk ml b">yes/no</code>问题的<code class="du mi mj mk ml b">no</code>答案相关的所有缺失特征。</p><p id="01b2" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">在处理孩子们的<code class="du mi mj mk ml b">yes/no</code>问题时我注意到了其他几个相关案例:</p><ul class=""><li id="babe" class="lu lv hi jq b jr kr jv ks jz lw kd lx kh ly kl lz ma mb mc bi translated"><code class="du mi mj mk ml b">cocoa_credit_whom</code>有许多缺失值。这是来自<code class="du mi mj mk ml b">cocoa_credit_yn</code>的一个规范，因为它只为那些赊账的人提供了一些额外的信息，我将省略它。</li><li id="02c0" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">有与<code class="du mi mj mk ml b">noloan</code>相关的特性。因为这对于那些贷款的人来说是未定义的，所以我将去掉它，只保留对整个样本有意义的特征。类似的论点也适用于<code class="du mi mj mk ml b">loan collateral</code>和<code class="du mi mj mk ml b">loan repayment success</code></li><li id="5825" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated"><code class="du mi mj mk ml b">loan_amount_</code>也有许多缺失值，如果没有贷款，这应该是0</li><li id="9293" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">如果没有进行培训，则<code class="du mi mj mk ml b">cocoa_training_days_cat</code>应为0</li></ul><p id="753c" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">对缺失值的重新检查导致以下决定:</p><ul class=""><li id="cf20" class="lu lv hi jq b jr kr jv ks jz lw kd lx kh ly kl lz ma mb mc bi translated"><code class="du mi mj mk ml b">_affect</code>变量缺失。他们测量不同类型损失对农民的影响。因为这仅在它们发生时相关，所以我放弃了它们。</li><li id="4519" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">放弃所有的<code class="du mi mj mk ml b">DHS</code>和<code class="du mi mj mk ml b">PPI</code>指数变量，因为它们是基于资产的指数，我想预测是否达到基准，而不考虑那些</li><li id="4da9" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated"><code class="du mi mj mk ml b">cocoa_intercrop_25yo</code>上的功能似乎有太多缺失，即使是在逻辑气势如虹之后。我把它丢了一整盘</li><li id="5b74" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">该功能<code class="du mi mj mk ml b">cocoa_land_inc_how_5ago</code>仅适用于增加土地的农民。所以我放弃了它，以保持特性的通用性</li><li id="58c1" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated"><code class="du mi mj mk ml b">all children at school</code>的指标只适用于有学龄儿童的农民。为了完整起见，如果没有孩子在场，我将<code class="du mi mj mk ml b">all children at school</code>设置为<code class="du mi mj mk ml b">yes</code>,因为这是上下文中更中性的答案</li><li id="3ac9" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">当<code class="du mi mj mk ml b">crops_important2</code>缺失时设置无</li></ul><p id="9e21" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">最终预处理步骤</strong></p><p id="7ca6" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">在为机器学习管道保存数据之前，我做了以下工作:</p><ul class=""><li id="de28" class="lu lv hi jq b jr kr jv ks jz lw kd lx kh ly kl lz ma mb mc bi translated">用数值(0或1)替换二进制类别，以简化扩展到虚拟对象时的特征数量</li><li id="eb9b" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">使用STATA字典将列重命名为更有意义的值</li></ul><blockquote class="kn ko kp"><p id="702d" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated">最终数据集包含1377个观测值和608个要素</p></blockquote></div><div class="ab cl ln lo gp lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hb hc hd he hf"><h2 id="c56e" class="kz ir hi bd is la lb lc iw ld le lf ja jz lg lh je kd li lj ji kh lk ll jm lm bi translated">3.1.2使用完整数据集的机器学习</h2><blockquote class="kn ko kp"><p id="808a" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated">完整的机器学习模型拟合和调整可以在这个<a class="ae km" href="https://github.com/mtyszler/LivingIncomeModel/blob/master/analysis%20notebooks/LivingIncome_MachineLearning.ipynb" rel="noopener ugc nofollow" target="_blank"> jupyter笔记本</a>中找到</p></blockquote><p id="b380" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">现在数据(几乎)准备好了，我可以进入项目的机器学习部分了</p><p id="1f1f" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">无缺失数据</strong></p><p id="da92" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">为了确保数据完全适合任何机器学习算法，我确保没有遗漏值。在数据处理中，我做了大量的预处理，但仍然有一些缺失值。我按照以下策略填写了这些表格:</p><ul class=""><li id="5e13" class="lu lv hi jq b jr kr jv ks jz lw kd lx kh ly kl lz ma mb mc bi translated">对于分类变量，模式</li><li id="ab21" class="lu lv hi jq b jr md jv me jz mf kd mg kh mh kl lz ma mb mc bi translated">对于数值变量，中位数</li></ul><p id="6be0" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">一键编码</strong></p><p id="6f79" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">此外，为了确保数据完全适合任何机器学习算法，我应用pandas的<code class="du mi mj mk ml b">get_dummies</code>将所有分类变量扩展为多个类别虚拟变量。</p><p id="c6c1" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">608个功能扩展为838个。</p><p id="2fc6" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">列车测试分割</strong></p><p id="4b05" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">然后，我将数据分成训练集和测试集。这是使用<code class="du mi mj mk ml b">sklearn</code> <code class="du mi mj mk ml b">train_test_split</code>方法完成的，训练规模为75%。</p><p id="3d74" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">基线分类器</strong></p><p id="f415" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">我创建了一个<code class="du mi mj mk ml b">baseline classifier</code>，它只是一个预测多数类的分类器。这样一个分类器有85%的<strong class="jq hj">准确率</strong>，我可以用这个作为参考来看看不同分类器带来的改进。</p><p id="d186" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">初始分类器</strong></p><p id="b0b8" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">我首先探索了几个算法:<strong class="jq hj">逻辑回归</strong>、<strong class="jq hj"> ADAboost </strong>和<strong class="jq hj">K-最近邻</strong>，因为这三个算法都适用于手头的问题。</p><p id="f17e" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">在使用1%、10%和100%样本的训练和测试集中，使用默认超参数比较算法的性能后，很明显<strong class="jq hj"> ADAboost </strong>是最有希望的分类器。</p><p id="5bcc" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">网格搜索</strong></p><p id="8c0f" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">然后，我使用网格搜索来为ADABoost分类器找到最佳超参数值。我首先应用了标准的5折交叉验证。但是，因为在这个问题中成功的几率太小，观察的数量也相对较少，所以我决定应用一个<strong class="jq hj">分层洗牌分裂</strong>交叉验证。这保证了目标的每个折叠都有相似的类分布。</p><p id="aae3" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">网格搜索旨在优化f值(β= 0.5)。</p><p id="1138" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj"> TPOT前奏曲</strong></p><p id="6c34" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">我还用TPOT搜索了非常广泛的模型空间。TPOT的优势是能看到我可能没有的模型，但缺点是它不了解手头的问题和难以编程的细微差别。</p><p id="356c" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">型号选择</strong></p><p id="89cd" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">我在测试集上比较了最佳ADAboost和最佳TPOT模型的性能</p><figure class="mr ms mt mu fd ij er es paragraph-image"><div class="er es nd"><img src="../Images/452e9c4e7687a65c67dbcab60c5f0b41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*b6Xv1Yo9E8c0cLcZdd9ZTg.png"/></div></figure><p id="77e0" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">因为<strong class="jq hj"> ADAboost </strong>型号在精确度和召回率上更平衡，我更喜欢那个型号，而不是最好的TPOT。</p></div><div class="ab cl ln lo gp lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hb hc hd he hf"><h2 id="9bdd" class="kz ir hi bd is la lb lc iw ld le lf ja jz lg lh je kd li lj ji kh lk ll jm lm bi translated">3.1.3具有受限特征的机器学习</h2><blockquote class="kn ko kp"><p id="6f87" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated">限于9个变量的机器学习模型拟合和调整可在本<a class="ae km" href="https://github.com/mtyszler/LivingIncomeModel/blob/master/analysis%20notebooks/LivingIncome_Model.ipynb" rel="noopener ugc nofollow" target="_blank"> jupyter笔记本</a>中找到</p></blockquote><p id="9cbc" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">使用具有完整数据集的最佳模型，我的目标是找到一个具有有限数量特征的良好性能的模型</p><p id="6632" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">选出十大特色</strong></p><p id="6c32" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">使用最好的<strong class="jq hj"> ADAboost </strong>模型，我使用<code class="du mi mj mk ml b">features_importances_</code>来识别前10个特性。</p><p id="a899" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">我意识到其中一个特征(<code class="du mi mj mk ml b">cocoa production (ha/kg)</code>)实际上可以由另外两个特征(<code class="du mi mj mk ml b">cocoa production (kg)</code>和<code class="du mi mj mk ml b">productive land(ha)</code>)来计算，但我决定保持原样，因为它们在数据集中，并且我想考虑算法中的非线性。</p><p id="dbf4" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">重新装配模型</strong></p><p id="3679" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">使用只有10个特征的数据集，我使用类似的网格搜索和分层洗牌分割优化f值(β= 0.5)，以找到(新的)最佳超参数。</p><p id="88ef" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">这里，出现了我没有预料到的复杂情况:最佳超参数位于搜索参数空间的极端。将最佳超参数置于极端情况并不是一个好的选择，因为它们次优的可能性很大。因此，我扩展了参数搜索并重新运行GridSearch，现在在搜索参数空间内找到了一个解决方案。</p><p id="419d" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj"> TPOT预赛，第二轮</strong></p><p id="9464" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">与具有所有功能的模型类似，我允许TPOT进行广泛搜索，以确保我没有遗漏任何重要的算法</p><p id="80c8" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">型号的最终选择</strong></p><p id="7522" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">我在测试集上比较了最佳ADAboost和最佳TPOT模型的性能</p><figure class="mr ms mt mu fd ij er es paragraph-image"><div class="er es ne"><img src="../Images/911940f27db1587fa8d1cd05111073ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*ExG05AQUwMkPgQYJesQb8w.png"/></div></figure><p id="2018" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">请记住以下几点:</p><ul class=""><li id="c278" class="lu lv hi jq b jr kr jv ks jz lw kd lx kh ly kl lz ma mb mc bi translated"><strong class="jq hj">准确性</strong>告知模型正确的频率。这衡量了所有预测中(即，每个农民被预测是否达到生活收入)，有多少是正确的。</li></ul><p id="cac3" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">这里我没有那么多可以选择的。这两个模型在精确度上非常相似。此外，正如已经讨论过的，任何模型都至少有85%的准确性，但只是猜测，没有人达到生活收入。</p><ul class=""><li id="ec03" class="lu lv hi jq b jr kr jv ks jz lw kd lx kh ly kl lz ma mb mc bi translated"><strong class="jq hj">精度</strong>告诉你当模型告诉你某人达到生活收入时，你能有多确定。</li></ul><blockquote class="kn ko kp"><p id="aa65" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated"><em class="hi">ADABoost模型有90%的精度。因此，从100个农民达到生活收入的预测中，90%实际上是正确的。考虑到这实际上是一个困难的案例，这已经很不错了！TPOT模型有97%的准确率，更好</em></p></blockquote><ul class=""><li id="98ac" class="lu lv hi jq b jr kr jv ks jz lw kd lx kh ly kl lz ma mb mc bi translated"><strong class="jq hj">回忆</strong>告诉你你的模型在寻找达到生活收入的农民方面有多好</li></ul><blockquote class="kn ko kp"><p id="05cb" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated">ADABoost的召回率为80%。因此，从100个实际达到生活收入的农民中，ADABoost模型将找到其中的80个。再说一次，这很好，因为这些很难找到！TPOT车型的召回率为73%，这更糟糕。</p></blockquote><p id="5875" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">所以现在我有了一个模型(<strong class="jq hj"> ADABoost </strong>)精度差，召回好，另一个模型(<strong class="jq hj"> TPOT </strong>)精度好，召回差。</p><p id="a8a7" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">为了结合精确度和召回率，我们可以使用f值。正如在2.3指标中提到的，f-score是精确度和召回率的调和平均值。<strong class="jq hj"> TPOT </strong>的f值更高。</p><p id="e3cb" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">然而，我需要考虑现实世界的影响。我们不希望模型在这里犯容易的错误:一旦模型说一个农民达到了生活收入，我们希望这实际上是真的(<em class="kq"> precision </em>)。但是，我们也不希望模型选择性太强，遗漏了重要的案例。一旦一个农民成为少数几个达到生活收入的人之一，我们希望这个模型能够很容易地发现这一点。</p><p id="6b46" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">TPOT更加精确:它犯的错误更少:一旦做出预测，我们就非常有信心。然而，这样做是因为过于保守，错过了更多的案例。由于我使用的是β= 0.5的f值，所选的TPOT模型通过过度降低召回率来优化f值。总而言之，因为ADAboost在精确度和召回率上更加平衡，我选择了它。</p><p id="d779" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">概率</strong></p><p id="e0c4" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">除了预测农民是否达到生活收入，我还对预测农民达到生活收入的概率感兴趣。</p><p id="046d" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">一开始我想用ADAboost模型<code class="du mi mj mk ml b">predict_proba</code>。然而，我遇到了一个复杂的问题，那就是概率的可变性太小了。此外，当我知道大约12%的预测是<code class="du mi mj mk ml b">true</code>并且我直觉地预期平均概率在12%左右时，计算每个观察的平均概率给了我47.5%的概率。在搜索了文档和论坛之后，我了解了概率校准。关于概率校准的详细信息可在<a class="ae km" href="https://scikit-learn.org/stable/modules/calibration.html#calibration" rel="noopener ugc nofollow" target="_blank">概率校准</a>和本交叉验证<a class="ae km" href="https://stats.stackexchange.com/questions/110981/why-is-adaboost-predicting-probabilities-with-so-little-standard-deviation" rel="noopener ugc nofollow" target="_blank">帖子</a>中找到。</p><p id="caa2" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">然后我使用<code class="du mi mj mk ml b">CalibratedClassifierCV</code>和<code class="du mi mj mk ml b">isotonic </code>方法实现了概率校准。校准模型的<code class="du mi mj mk ml b">predict_proba</code>如我所料，即平均概率与成功概率相似。</p><p id="d825" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">对比完整版和限制版</strong></p><p id="ae23" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">完整模型的准确率为96.5%，精确度为87%，召回率为87%。</p><blockquote class="kn ko kp"><p id="23d9" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated">具有9个变量的(重新校准的)模型具有96%的<strong class="jq hj">准确度</strong>、90%的<strong class="jq hj">精确度</strong>和80%的<strong class="jq hj">召回率</strong></p></blockquote><p id="576e" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">这意味着，当从838个变量下降到10个变量(实际上是9个变量)时,(重新校准的)模型几乎没有损失准确性，以稍差的回忆为代价获得了多一点的准确性。</p><p id="23fc" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">全型号</strong>有如下混淆表:</p><figure class="mr ms mt mu fd ij er es paragraph-image"><div class="er es nf"><img src="../Images/0fa422f7074648431d0112760da9598d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*wUQc6Au1X8wu99-um2LzEw.png"/></div></figure><p id="5b2b" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">而具有9个变量的模型</strong>具有以下内容:</p><figure class="mr ms mt mu fd ij er es paragraph-image"><div class="er es ng"><img src="../Images/ce6b55a0dd88cc2cb33e376f60c370dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*eKF7XdKrZw9TcdMZTf-jPw.png"/></div></figure><p id="e518" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">在混淆表中，我们希望左上角和右下角的单元格具有最多的值(这些是正确的预测)。你会发现两张表非常相似。</p><blockquote class="kn ko kp"><p id="e252" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated"><strong class="jq hj">只有9个变量的模型比完整的模型</strong>(这几乎是构造上的，并不奇怪)<strong class="jq hj">稍差，但损失是最小的，因为它使用了大约1%的完整功能！</strong></p></blockquote></div><div class="ab cl ln lo gp lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hb hc hd he hf"><h1 id="68c3" class="iq ir hi bd is it mm iv iw ix mn iz ja jb mo jd je jf mp jh ji jj mq jl jm jn bi translated">3.2.WEB应用程序</h1><p id="bfa4" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">为了让感兴趣的用户容易使用该模型，该模型被打包在一个web应用程序中</p><p id="de8d" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">设置</strong></p><p id="82f1" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">使用<strong class="jq hj"> Flask </strong>框架结合<strong class="jq hj"> Bootstrap来设置web应用。</strong>使用<strong class="jq hj"> Plot.ly </strong>制作图表</p><p id="aff6" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">首页(=登陆页)</strong></p><figure class="mr ms mt mu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nh"><img src="../Images/42843c9421e4f04ebd4bf88367b19cde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Q5sR8HopagPTkrBY.png"/></div></div></figure><p id="901b" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">该页面有表格输入9个农户特征。点击<code class="du mi mj mk ml b">Calculate chance</code>后，app返回实现生活收入基准的预测和概率。</p><p id="0234" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">这是app的主要用途。这是使用校准模型的<code class="du mi mj mk ml b">predict</code>和<code class="du mi mj mk ml b">predict_proba</code>方法完成的。</p><p id="2adb" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">关于数据集</strong></p><p id="859e" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">这个页面有一些关于训练和测试数据集的基本信息，以及关于所有特性的图表。它包含一个条形图，显示在训练和测试集中有多少观察值达到了生活收入基准。</p><figure class="mr ms mt mu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ni"><img src="../Images/8d151b047f6bff89bc0d6258c8c3f3a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kTJZT9CpCu4NT7Ew.png"/></div></div></figure><p id="93f5" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">它还具有所有9个特征的直方图，比较了在训练和测试集中达到和未达到生活收入基准的特征。</p><figure class="mr ms mt mu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nj"><img src="../Images/9925652f18d0a78fa195903cd6170216.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DFdkRvSArsFe84NJ.png"/></div></div></figure><p id="6d89" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">所有这些图形都是用python代码和plotly完成的。使用flask将它们传递给模板。</p><p id="b0a5" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj"> ML车型性能</strong></p><figure class="mr ms mt mu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nk"><img src="../Images/bb42a32228309098b68e2247ca845bce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cXOtweUQQGLT2iBW.png"/></div></div></figure><p id="797d" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">这个页面有一些关于ML模型性能的信息。它显示了一些指标和一个混淆表。</p><p id="accf" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">下载模型</strong></p><figure class="mr ms mt mu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ni"><img src="../Images/7712cc0c6756bf31d448f44a09458092.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IK-vPTpA-a7ECUSq.png"/></div></div></figure><p id="d497" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">在该页面中，用户可以在<code class="du mi mj mk ml b">python</code>中下载自己使用的模型。它包含解释如何使用模型的基本脚本。</p></div><div class="ab cl ln lo gp lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hb hc hd he hf"><h1 id="4d3e" class="iq ir hi bd is it mm iv iw ix mn iz ja jb mo jd je jf mp jh ji jj mq jl jm jn bi translated">4.结论</h1><p id="3ba2" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">该模型表现相当好，实现了它的目标:仅使用少数(相对)容易收集的变量，稳健地预测农民是否实现了生活收入。</p><p id="1bc4" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">尽管我对结果很满意，但仍需谨慎:这是一个仍处于起步阶段的模型。它显示出了希望，但是它还没有在更大的数据集上进行彻底的审查、测试或验证，也没有被带到训练/测试环境之外的另一个数据集上。因此，我不确定它的预测能力有多强。这里，可以通过在更大的数据集中进行(重新)训练来改进模型</p><p id="93df" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">从技术上讲，有一些改进是可能的:例如，可以制作一个更容易复制的预处理管道，模型可以更好地封装在python类中。然而，我相信web应用程序和pickle文件对于当前的需求是非常好的。一般来说，web应用程序之外的模型仅限于python，这对一些用户来说可能是一个障碍。让它在其他语言(比如R、STATA)中也可用会增加它的可用性。</p></div><div class="ab cl ln lo gp lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hb hc hd he hf"><p id="ac5c" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">参考文献</strong></p><p id="ce9f" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">与这篇博文相关的所有数据和文件都可以在这个<a class="ae km" href="https://github.com/mtyszler/LivingIncomeModel/" rel="noopener ugc nofollow" target="_blank"> Github页面</a>中找到</p><p id="1105" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj"> <em class="kq">参见我的专业</em> </strong> <a class="ae km" href="https://www.marcelotyszler.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj"> <em class="kq">网页</em> </strong> </a></p></div></div>    
</body>
</html>