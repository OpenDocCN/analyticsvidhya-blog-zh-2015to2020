<html>
<head>
<title>Introduction to Python Threading</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python线程介绍</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/introduction-to-python-threading-749d8c2af79f?source=collection_archive---------25-----------------------#2020-03-03">https://medium.com/analytics-vidhya/introduction-to-python-threading-749d8c2af79f?source=collection_archive---------25-----------------------#2020-03-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/5930c7efc9b566285f6d5a59154d4721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZuEZ0WpzpADyfLmgx8xfUg.png"/></div></div></figure><p id="86a3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本教程中，我们将学习如何使用python中的线程模块并发运行代码。</p><h2 id="4284" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">为什么我们要使用线程？</h2><p id="ac09" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">当我们想要加速程序时，我们使用线程，这种加速来自于同时运行不同的任务。</p><p id="29f3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">加速不一定是有保证的，它取决于你的程序在做什么。</p><figure class="ko kp kq kr fd ij"><div class="bz dy l di"><div class="ks kt l"/></div></figure></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><p id="3fa3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我们的简单任务是从网上下载图片。</p><p id="b176" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，让我们定义一个函数，它将从一个URL下载一张图片并保存在我们当前的文件夹中。</p><p id="b0f5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建一个名为<strong class="is hj"> <em class="lb">的新文件lorempicsum.py : </em> </strong></p><figure class="ko kp kq kr fd ij"><div class="bz dy l di"><div class="lc kt l"/></div></figure><p id="1fdc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个函数下载这个URL中包含的图片(每次刷新页面时图片都会改变),并接受一个参数，即保存图片的名称。</p><p id="f2b0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在创建另一个名为<strong class="is hj"> <em class="lb"> run.py </em> </strong>的文件，我们将在其中异步运行该函数15次:</p><figure class="ko kp kq kr fd ij"><div class="bz dy l di"><div class="lc kt l"/></div></figure><pre class="ko kp kq kr fd ld le lf lg aw lh bi"><span id="3a9e" class="jo jp hi le b fi li lj l lk ll">image1.jpg was downloaded...</span><span id="a2de" class="jo jp hi le b fi lm lj l lk ll">image2.jpg was downloaded...</span><span id="71f9" class="jo jp hi le b fi lm lj l lk ll">image3.jpg was downloaded...</span><span id="3844" class="jo jp hi le b fi lm lj l lk ll">image4.jpg was downloaded...</span><span id="0a57" class="jo jp hi le b fi lm lj l lk ll">image5.jpg was downloaded...</span><span id="8a94" class="jo jp hi le b fi lm lj l lk ll">image6.jpg was downloaded...</span><span id="f345" class="jo jp hi le b fi lm lj l lk ll">image7.jpg was downloaded...</span><span id="4c00" class="jo jp hi le b fi lm lj l lk ll">image8.jpg was downloaded...</span><span id="b02e" class="jo jp hi le b fi lm lj l lk ll">image9.jpg was downloaded...</span><span id="bb56" class="jo jp hi le b fi lm lj l lk ll">image10.jpg was downloaded...</span><span id="af50" class="jo jp hi le b fi lm lj l lk ll">image11.jpg was downloaded...</span><span id="7915" class="jo jp hi le b fi lm lj l lk ll">image12.jpg was downloaded...</span><span id="6d9f" class="jo jp hi le b fi lm lj l lk ll">image13.jpg was downloaded...</span><span id="dc02" class="jo jp hi le b fi lm lj l lk ll">image14.jpg was downloaded...</span><span id="5f0c" class="jo jp hi le b fi lm lj l lk ll">image15.jpg was downloaded...</span><span id="d9dd" class="jo jp hi le b fi lm lj l lk ll">Downloaded in 11.3468455 seconds</span></pre><p id="0cb5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了加快我们的程序，我们现在将使用线程。</p><p id="a24d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建一个新文件，命名为<strong class="is hj"> <em class="lb"> runsync.py </em> </strong></p><figure class="ko kp kq kr fd ij"><div class="bz dy l di"><div class="lc kt l"/></div></figure><p id="f284" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里我们创建了一个空列表，其中包含了我们将要创建的所有线程。</p><p id="18af" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在第10行，我们创建了一个线程<code class="du ln lo lp le b">threading.Thread()</code>，在那里我们将调用我们的lorem_picsum函数<code class="du ln lo lp le b">target=lorem_picsum</code>，由于我们的函数接受一个参数，我们指定了参数<code class="du ln lo lp le b">args=[i]</code>的值。</p><p id="3b43" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在第12行，我们循环所有线程并执行<code class="du ln lo lp le b">thread.join()</code></p><p id="27db" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个方法阻塞调用线程，直到其<code class="du ln lo lp le b">join()</code>方法被调用的线程终止。</p><pre class="ko kp kq kr fd ld le lf lg aw lh bi"><span id="359c" class="jo jp hi le b fi li lj l lk ll">8.jpg was downloaded...</span><span id="09e4" class="jo jp hi le b fi lm lj l lk ll">1.jpg was downloaded...</span><span id="e5ab" class="jo jp hi le b fi lm lj l lk ll">12.jpg was downloaded...</span><span id="44b3" class="jo jp hi le b fi lm lj l lk ll">2.jpg was downloaded...</span><span id="7155" class="jo jp hi le b fi lm lj l lk ll">10.jpg was downloaded...</span><span id="9322" class="jo jp hi le b fi lm lj l lk ll">13.jpg was downloaded...</span><span id="215b" class="jo jp hi le b fi lm lj l lk ll">9.jpg was downloaded...</span><span id="b792" class="jo jp hi le b fi lm lj l lk ll">4.jpg was downloaded...</span><span id="2083" class="jo jp hi le b fi lm lj l lk ll">6.jpg was downloaded...</span><span id="0f3b" class="jo jp hi le b fi lm lj l lk ll">14.jpg was downloaded...</span><span id="619a" class="jo jp hi le b fi lm lj l lk ll">7.jpg was downloaded...</span><span id="0ef3" class="jo jp hi le b fi lm lj l lk ll">5.jpg was downloaded...</span><span id="710a" class="jo jp hi le b fi lm lj l lk ll">0.jpg was downloaded...</span><span id="b80d" class="jo jp hi le b fi lm lj l lk ll">3.jpg was downloaded...</span><span id="c9a7" class="jo jp hi le b fi lm lj l lk ll">11.jpg was downloaded...</span><span id="3d4f" class="jo jp hi le b fi lm lj l lk ll">Downloaded in 0.9996082000000001 seconds</span></pre><figure class="ko kp kq kr fd ij"><div class="bz dy l di"><div class="lq kt l"/></div></figure><h1 id="f17d" class="lr jp hi bd jq ls lt lu ju lv lw lx jy ly lz ma kb mb mc md ke me mf mg kh mh bi translated">🏆奖励:更简单的方法</h1><p id="1ba2" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">我本可以首先向您展示这种方法，因为它更简单，但是我认为在充分利用这种技术之前，理解如何手动实现线程是很重要的。</p><p id="7cfc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Python的ThreadPoolExecutor最初是在3.2版中引入的，它为异步执行输入/输出任务提供了一个简单的高级接口。</p><p id="6db4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建一个名为<strong class="is hj">的新文件<em class="lb">runsyncpool . py:</em>T24】</strong></p><p id="49b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了使用<code class="du ln lo lp le b">ThreadPoolExecutor</code>我们<code class="du ln lo lp le b">import concurrent.futures</code></p><p id="7ac7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在第7行中，我们使用上下文管理器，它允许我们在需要的时候精确地分配和释放资源(这是实例化ThreadPoolExecutor的最流行的方法)。</p><p id="2e5a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，在第8行，我们使用<code class="du ln lo lp le b">submit()</code>方法来执行我们的函数，并在逗号后传递我们的参数(我们的参数是来自list comprehension for循环的<code class="du ln lo lp le b">i </code>)</p><pre class="ko kp kq kr fd ld le lf lg aw lh bi"><span id="a14e" class="jo jp hi le b fi li lj l lk ll">12.jpg was downloaded...</span><span id="5c72" class="jo jp hi le b fi lm lj l lk ll">10.jpg was downloaded...</span><span id="7c00" class="jo jp hi le b fi lm lj l lk ll">7.jpg was downloaded...</span><span id="47e2" class="jo jp hi le b fi lm lj l lk ll">11.jpg was downloaded...</span><span id="5234" class="jo jp hi le b fi lm lj l lk ll">2.jpg was downloaded...</span><span id="f3aa" class="jo jp hi le b fi lm lj l lk ll">8.jpg was downloaded...</span><span id="1d76" class="jo jp hi le b fi lm lj l lk ll">9.jpg was downloaded...</span><span id="bddf" class="jo jp hi le b fi lm lj l lk ll">5.jpg was downloaded...</span><span id="9b07" class="jo jp hi le b fi lm lj l lk ll">1.jpg was downloaded...</span><span id="e926" class="jo jp hi le b fi lm lj l lk ll">3.jpg was downloaded...</span><span id="2d73" class="jo jp hi le b fi lm lj l lk ll">6.jpg was downloaded...</span><span id="8f78" class="jo jp hi le b fi lm lj l lk ll">4.jpg was downloaded...</span><span id="4c91" class="jo jp hi le b fi lm lj l lk ll">13.jpg was downloaded...</span><span id="9ec4" class="jo jp hi le b fi lm lj l lk ll">14.jpg was downloaded...</span><span id="8d42" class="jo jp hi le b fi lm lj l lk ll">15.jpg was downloaded...</span><span id="226f" class="jo jp hi le b fi lm lj l lk ll">Downloaded in 2.2979992 seconds</span></pre><p id="b1c4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">结论:</strong></p><p id="4d68" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我希望这篇教程能够揭开Python中使用线程和ThreadPoolExecutor的艺术。如果你想了解更多关于Python中线程的工作原理，那么我推荐你查阅Python的官方文档。</p><p id="5b57" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以在这里下载所有文件<a class="ae mi" href="https://github.com/samibenazzouz/mediumTutorial2" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>