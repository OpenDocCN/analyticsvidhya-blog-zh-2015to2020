<html>
<head>
<title>Building a ETL pipeline</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建 ETL 管道</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/building-a-etl-pipeline-226656a22f6d?source=collection_archive---------1-----------------------#2020-12-17">https://medium.com/analytics-vidhya/building-a-etl-pipeline-226656a22f6d?source=collection_archive---------1-----------------------#2020-12-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1ae6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用 Python、Pandas 和 SQLite</p><h2 id="e15c" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">什么是 ETL 数据管道？</h2><figure class="jz ka kb kc fd kd er es paragraph-image"><div class="er es jy"><img src="../Images/52e07b6997fab691c96e3664e3b1a3b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*LQGXaF3nW8chNatOQ8x5_Q.jpeg"/></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">典型的 ETL 数据管道/流程</figcaption></figure><p id="c38f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ETL(数据提取、转换、加载)管道是一组用于从源到目标提取、转换和加载数据的过程。</p><p id="6857" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据来源可以是一个或多个来源，例如 API 调用、CSV 文件、数据库中的信息等等。</p><p id="5ffb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们获取这些信息源，然后以某种方式对其进行转换，以便其他客户端、用户或开发人员可以在某个目标存储中立即使用。</p><p id="9e0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实际上，ETL 管道很少运行。一般来说，有大量的信息未经过滤，难以处理和清理，通常需要花费大量的时间和资源来转换。</p><h2 id="1d47" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">为什么我们需要 ETL 管道？</h2><p id="f821" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">假设我们有一组想要使用的数据。但问题是这些数据不干净，缺少信息，而且不一致。一种解决方案是让一个程序清理并转换这些信息</p><ol class=""><li id="1c28" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">没有遗漏的信息</li><li id="fc74" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">数据一致</li><li id="e630" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">数据可以快速加载到另一个程序中</li></ol><p id="57b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在当今的智能设备、在线社区和电子商务行业中，有如此多未经过滤的原始数据。但是大部分都被浪费了，因为它太难解释了，因为它太乱了。ETL 管道的存在就是为了通过自动化数据收集和转换来解决这个问题，以便分析师可以使用它来获得业务洞察力。</p><h1 id="a717" class="ld je hi bd jf le lf lg jj lh li lj jn lk ll lm jq ln lo lp jt lq lr ls jw lt bi translated">ETL 管道</h1><p id="3944" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">有许多不同的工具和技术可以用来建立我们的数据管道。这完全取决于我们的数据是如何收集的。在我们的例子中，我们将从约翰·霍普斯金大学的 GitHub 收集原始数据。具体来说，我们将关注<a class="ae lu" href="https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_daily_reports" rel="noopener ugc nofollow" target="_blank">日报</a>。截至本文撰写时，数据跨度为 2020 年 1 月 22 日至 2020 年 12 月 16 日。</p><p id="fd2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的技术栈将包括使用库<strong class="ih hj">请求</strong>和<strong class="ih hj">熊猫</strong>的<strong class="ih hj"> Python </strong>。我们还将使用<strong class="ih hj"> SQLite </strong>来存储这些信息。</p><h2 id="0459" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">1.提取</h2><p id="ba96" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">在我们进行任何类型的数据转换之前，我们需要有数据！这些数据将从约翰·霍普斯金大学的 Github 收集。我们对每日报告特别感兴趣。从 Github 的 API 文档中，我们可以向这个端点发送一个 GET 请求来接收一个 JSON 响应，告诉我们每个 csv 文件的 URL，这样我们就可以直接读取了。</p><figure class="jz ka kb kc fd kd"><div class="bz dy l di"><div class="lv lw l"/></div></figure><ul class=""><li id="20f1" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc lx kv kw kx bi translated">所有者是 GitHub 存储库的所有者</li><li id="d313" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc lx kv kw kx bi translated">REPO 是存储库的名称</li><li id="1d3f" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc lx kv kw kx bi translated">路径是我们要检查的文件夹相对于回购的特定路径</li><li id="6e6b" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc lx kv kw kx bi translated">URL 是用于发送 GET 请求的 api 端点</li></ul><p id="0fac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用 Python 的请求库，我们将解释 JSON 响应并检查我们需要的信息。为了清楚起见，下图是使用名为 Postman 的程序返回的响应。使用 Python 的请求库将返回类似的响应。</p><figure class="jz ka kb kc fd kd er es paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="er es ly"><img src="../Images/e031402cce5a1ff1e7527cb33b441d5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RnRzMS72joFgyf8uIVCM6w.png"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">来自 GitHub API 的 JSON 响应</figcaption></figure><p id="f8bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">返回的是 github repo 中每个文件的对象描述数组。我们对“下载网址”感兴趣。我们将使用这个“download_url”通过 Pandas 直接下载这些数据，然后按照我们认为合适的方式进行转换。</p><p id="fb10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下脚本将所有“下载 url”收集到一个 Python 列表对象中</p><figure class="jz ka kb kc fd kd"><div class="bz dy l di"><div class="lv lw l"/></div></figure><h2 id="a548" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">2.改变</h2><p id="c9dc" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">我们现在有了一个指向 csv 文件的直接链接列表！我们可以使用<strong class="ih hj"> pandas.read_csv(url) </strong>直接读取这些网址。</p><p id="f10c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看看这些信息，我们对特定的值感兴趣。如果这些值不在 DataFrame 内，我们将用空值替换/添加这些列(例如 numpy.nan)。</p><p id="8333" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有些标签不一致。它们定义了相同类型的数据，但命名不同。比如，‘<strong class="ih hj">最后更新</strong>也叫“<strong class="ih hj">最后 _ 更新</strong>”。我们还将为<strong class="ih hj">一致性</strong>重新定义这些标签。这是一个非常基本的 ETL 管道，所以我们将只考虑少量的标签。这些标签将</p><pre class="jz ka kb kc fd md me mf mg aw mh bi"><span id="9393" class="jd je hi me b fi mi mj l mk ml">labels = ['Province_State', 'Country_Region', 'Last_Update', 'Confirmed', 'Deaths', 'Recovered']<br/></span></pre><figure class="jz ka kb kc fd kd"><div class="bz dy l di"><div class="lv lw l"/></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">转换代码</figcaption></figure><p id="a3cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的代码将已经收集的数据转换为 Pandas DataFrame add，通过添加和重新标记列使数据帧保持一致。随着我们的数据被清理、过滤和处理，下一步是将数据加载到数据库中。</p><h2 id="56c9" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">3.负荷</h2><p id="b545" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">我们可以使用 pandas 将 pandas 数据帧直接加载到 SQL 数据库中。DataFrame.to_sql。</p><p id="01cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果数据库中的表已经创建，则用新表替换它。在生产中，这是一种非常糟糕的方式。但是为了这个练习的简单性，这就足够了。</p><p id="df44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的代码描述了如何使用<strong class="ih hj"> sqlite3 </strong>连接到 SQLite 数据库。</p><figure class="jz ka kb kc fd kd"><div class="bz dy l di"><div class="lv lw l"/></div></figure><h1 id="351c" class="ld je hi bd jf le lf lg jj lh li lj jn lk ll lm jq ln lo lp jt lq lr ls jw lt bi translated">结论</h1><ul class=""><li id="1e3e" class="kp kq hi ih b ii kk im kl iq mm iu mn iy mo jc lx kv kw kx bi translated">我们描述了 ETL 管道在当今以数据为中心的行业和社会中的益处。</li><li id="2887" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc lx kv kw kx bi translated">我们解释了 ETL 过程如何根据收集的数据、数据类型和数据量而变化。</li><li id="b410" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc lx kv kw kx bi translated">我们使用 Python、Pandas、Requests 和 SQLite 实现了自己的基本 ETL 管道，并与 GitHub 的 API 进行了交互。</li></ul><p id="b2f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完整的代码可以在<a class="ae lu" href="https://github.com/anth7310/Covid19-ETL-API" rel="noopener ugc nofollow" target="_blank">这里找到</a></p></div></div>    
</body>
</html>