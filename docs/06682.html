<html>
<head>
<title>Understanding Facebook’s GrokNet - An Image Recognition System for commerce applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解脸书的GrokNet——一个用于商业应用的图像识别系统</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/understanding-facebooks-groknet-an-image-recognition-system-for-commerce-applications-54dde2096f19?source=collection_archive---------8-----------------------#2020-05-30">https://medium.com/analytics-vidhya/understanding-facebooks-groknet-an-image-recognition-system-for-commerce-applications-54dde2096f19?source=collection_archive---------8-----------------------#2020-05-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="000b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">脸书是世界上数据最丰富的公司之一。脸书的Groknet是最先进的产品识别系统。该模型在几个商业垂直领域的7个数据集上进行训练。</p><p id="dbde" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">脸书的市场已经成为全球销售和购买产品的巨大平台。当用户上传一个产品，产品的描述包括颜色，价格，地点，品牌，生产年份等。当描述完全或部分缺失时，用户可能会感觉不好。因此，脸书决定使用用户上传的图片来补充缺失的信息。</p><p id="59ea" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Groknet可以分析图像并预测:</p><ol class=""><li id="3a54" class="jk jl hi io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated">对象类别:“酒吧凳子”、“围巾”、“地毯”、“地毯”…</li><li id="c198" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">家居属性:物品颜色，材质，装饰风格，</li><li id="478d" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">时尚属性:款式，颜色，材质，袖长，…</li><li id="7899" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">车辆属性:品牌、型号、外部颜色、年代、</li><li id="8873" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">搜索查询:用户可能用来在市场搜索中找到产品的文本短语，</li><li id="c919" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">图像嵌入:256位哈希用于识别确切的产品，查找和排列相似的产品，提高搜索质量。</li></ol><figure class="jz ka kb kc fd kd er es paragraph-image"><div class="er es jy"><img src="../Images/424c4054e767c789227b6ec8816c63db.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*m981QbF3-pAzd7Xos9tNcQ.png"/></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">Groknet识别图像上的所有产品</figcaption></figure><p id="0459" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Groknet在人类注释、用户生成的标签和嘈杂的搜索引擎交互数据上接受训练。</p><h1 id="3ff2" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">数据准备</h1><p id="4683" class="pw-post-body-paragraph im in hi io b ip li ir is it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj hb bi translated">GrokNet旨在解决大量的计算机视觉任务。数据集由来自7个不同数据集的8900万张Facebook Marketplace图片组成。它使用80个分类损失函数和3个嵌入损失。</p><figure class="jz ka kb kc fd kd er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es ln"><img src="../Images/325901180322b865c9b382650a36975c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zGin17ar6BE6hAR05_O-hQ.png"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">8900万张图片的训练数据</figcaption></figure><h2 id="0313" class="ls kl hi bd km lt lu lv kq lw lx ly ku ix lz ma ky jb mb mc lc jf md me lg mf bi translated">对象类别</h2><p id="7aaa" class="pw-post-body-paragraph im in hi io b ip li ir is it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj hb bi translated">对象类别来自内部人工注释的市场图像数据集，有566个标签，如“椅子”、“手镯”和“自行车”。</p><h2 id="9d6f" class="ls kl hi bd km lt lu lv kq lw lx ly ku ix lz ma ky jb mb mc lc jf md me lg mf bi translated">属性(时尚、家居和交通工具)</h2><p id="2049" class="pw-post-body-paragraph im in hi io b ip li ir is it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj hb bi translated">在训练中使用时尚、人和车辆属性的多标签注释。</p><p id="543d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对于家居产品，颜色和材料是一些属性。</p><h2 id="a7d0" class="ls kl hi bd km lt lu lv kq lw lx ly ku ix lz ma ky jb mb mc lc jf md me lg mf bi translated">产品身份(时尚、家居和汽车)</h2><p id="227a" class="pw-post-body-paragraph im in hi io b ip li ir is it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj hb bi translated">同一产品的不同图像将在数据集中具有相同的id。</p><h2 id="6625" class="ls kl hi bd km lt lu lv kq lw lx ly ku ix lz ma ky jb mb mc lc jf md me lg mf bi translated">弱监督数据扩充</h2><p id="ba56" class="pw-post-body-paragraph im in hi io b ip li ir is it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj hb bi translated">获取产品id是非常困难的任务。他们用下面的方法完成了这个琐碎的任务。</p><figure class="jz ka kb kc fd kd er es paragraph-image"><div class="er es mg"><img src="../Images/6a21cd983371bf3c6152aa5f36efa668.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*keTn5c85nI0xv_Wt8C5NWA.png"/></div></figure><p id="0abd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">正如我们可以观察到的，从未标记的照片中检测到对象，并为每个对象提取特征。这些嵌入中的每一个都用于从已知产品中寻找最佳匹配。如果嵌入之间的距离小于阈值，则判定匹配。</p><p id="741c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">(脸书团队使用的阈值为0.2)</p><h2 id="fb05" class="ls kl hi bd km lt lu lv kq lw lx ly ku ix lz ma ky jb mb mc lc jf md me lg mf bi translated">市场搜索查询</h2><p id="b2ee" class="pw-post-body-paragraph im in hi io b ip li ir is it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj hb bi translated">收集来自搜索日志的图像-查询对的数据集。有几个图像可用，用户也搜索了很多产品。使用以下过程中的查询来标记图像。</p><figure class="jz ka kb kc fd kd er es paragraph-image"><div class="er es mh"><img src="../Images/da62485d05479c27dc814e51d8c3c8ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*dOWNg66g-oL8gcKNvmfXeg.png"/></div></figure><h1 id="3f43" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">体系结构</h1><p id="4c6b" class="pw-post-body-paragraph im in hi io b ip li ir is it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj hb bi translated">Groknet是一个卷积神经网络，构建为FBLearner框架中的分布式pytorch工作流。它使用ResNeXt-101 32×4d，有101层，32组，组宽4 (8B乘加触发器，43M参数)。</p><figure class="jz ka kb kc fd kd er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es mi"><img src="../Images/aa318e12df4f09bffb833f7be62dfc35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pFwbWvY7czgafCjTj0OdAQ.png"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">格罗耐特建筑</figcaption></figure><h2 id="7445" class="ls kl hi bd km lt lu lv kq lw lx ly ku ix lz ma ky jb mb mc lc jf md me lg mf bi translated">宝石池</h2><p id="fb28" class="pw-post-body-paragraph im in hi io b ip li ir is it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj hb bi translated">广义平均池是一种参数化池操作，它相当于p = 1时的平均池和p = ∞时的最大池。直观上，这允许嵌入将网络的更多注意力集中到每个特征的图像的显著部分。“p”是一个可学习的参数，它收敛到3。</p><h1 id="990c" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">损失函数</h1><p id="c7d5" class="pw-post-body-paragraph im in hi io b ip li ir is it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj hb bi translated">由于Groknet试图在单个架构中实现不同的任务，因此它使用多个损失函数的加权和。</p><p id="8cd3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了训练80个类别和属性标题，使用了Softmax和多标签Softmax。</p><p id="0cdd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了训练统一嵌入头，使用了在相同空间上操作的3个度量学习损失——ArcFace、多标签arc face和成对嵌入损失。</p><h2 id="a14f" class="ls kl hi bd km lt lu lv kq lw lx ly ku ix lz ma ky jb mb mc lc jf md me lg mf bi translated">软最大损失</h2><p id="52e0" class="pw-post-body-paragraph im in hi io b ip li ir is it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj hb bi translated">使用具有交叉熵损失的softmax向模型添加分类标签。添加的类别相互排斥。有80个组，因此有80个softmaxes。</p><p id="f8b4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">softmax的公式为</p><figure class="jz ka kb kc fd kd er es paragraph-image"><div class="er es mj"><img src="../Images/d0bcdf4b0c18557eea0d0c27310558a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:442/format:webp/1*Fjui5SI7z8MWWmNJEjp8FQ.png"/></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">软最大损失</figcaption></figure><p id="17ca" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">其中s是概率分数，C是类别数</p><h2 id="c9a4" class="ls kl hi bd km lt lu lv kq lw lx ly ku ix lz ma ky jb mb mc lc jf md me lg mf bi translated">多标签弧面损失</h2><p id="2574" class="pw-post-body-paragraph im in hi io b ip li ir is it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj hb bi translated">弧面是用于深度人脸识别的附加角裕度损失。弗罗穆拉群岛</p><figure class="jz ka kb kc fd kd er es paragraph-image"><div class="er es mk"><img src="../Images/3b19604ac995aabfd6fde68cefb52b98.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*ZzvxefoQH-Vhm1y1vAapGQ.png"/></div></figure><p id="c1f9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Wj ∈ Rd表示权重W ∈ Rd×n的第j列，并且bj ∈ Rn是偏置项。WjT xi =∨Wj∨Xi∨cosθj，其中θj是权重Wj和特征Xi之间的角度。m是保证金罚款。</p><p id="32c2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Arc Face loss期望每个训练示例只有一个标签。然而，我们的市场搜索查询数据集经常将每个产品图片与多个搜索查询相关联。为了解决这个问题，ArcFace loss被扩展为允许每个影像有多个标注。</p><figure class="jz ka kb kc fd kd er es paragraph-image"><div class="er es ml"><img src="../Images/43c53225345ff87b5b55ec69bf020d04.png" data-original-src="https://miro.medium.com/v2/resize:fit:366/format:webp/1*uq89-T7c5_WImhoaS1cQkQ.png"/></div></figure><figure class="jz ka kb kc fd kd er es paragraph-image"><div class="er es mm"><img src="../Images/9f3bb68d18006bf3ade804a7e5659057.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*VLOU6UsGRGha4oDKuQ86TQ.png"/></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">多标签弧面损失</figcaption></figure><h2 id="aae1" class="ls kl hi bd km lt lu lv kq lw lx ly ku ix lz ma ky jb mb mc lc jf md me lg mf bi translated">成对双倍利润损失</h2><p id="f0ea" class="pw-post-body-paragraph im in hi io b ip li ir is it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj hb bi translated">弧面限制了可以包含在训练集中的产品数量，因为每个产品都需要自己的类向量。两个损失用加权和管理相同的嵌入空间。</p><figure class="jz ka kb kc fd kd er es paragraph-image"><div class="er es mn"><img src="../Images/657af7c3f5d636c8178daf2efb042f1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*ZG8IlISvFlVcZIx9UqFYGA.png"/></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">成对双倍利润损失</figcaption></figure><p id="5055" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">其中xi是嵌入点，yi j ∈ {0，1}。D(xi，XJ)= | | Xi XJ ||^2是两点之间的距离的平方，Np是正的数量，Nn是负的数量，wn是控制正和负的相对影响的权重，α是增加更难的例子的权重的损失功率，mp1、mp2是正的双倍边距，mp1、mp2是负的双倍边距。</p><p id="968d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">通过首先预先计算完整的成对距离矩阵，可以有效地计算损失。</p><p id="24e3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用以下值:损耗功率α = 1.5，裕度mp1 = 0.1，mp2 = 0.7，mn1 = 0，mn2 = 0.7，负权重wn = 10000。</p><h2 id="d6c6" class="ls kl hi bd km lt lu lv kq lw lx ly ku ix lz ma ky jb mb mc lc jf md me lg mf bi translated">分布式成对计算</h2><p id="50ac" class="pw-post-body-paragraph im in hi io b ip li ir is it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj hb bi translated">他们使用GPU来计算所有GPU和所有主机之间所有可能对的距离。</p><figure class="jz ka kb kc fd kd er es paragraph-image"><div class="er es mo"><img src="../Images/8e636904d1e591aba40b1b1c8d76a183.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*zDWAxIwppZO6HP0QZuVDAw.png"/></div></figure><h1 id="9c3f" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">部署</h1><figure class="jz ka kb kc fd kd er es paragraph-image"><div class="er es mp"><img src="../Images/2e62cc785399761c3265b616a7602483.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*J4cyd85zHi8RZqAoJbsDWQ.png"/></div></figure><p id="61a3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">图像被上传并被安排在预测机器上运行，预测机器通过我们的卷积网络输入调整过大小的图像。</p><p id="4b89" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将输出存储在分布式键值存储中，并将其用于市场搜索、Feed、目录等应用程序，这些应用程序会在新列表创建后的几秒钟内消耗我们的信号。</p><h1 id="a10b" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">结论</h1><p id="fee7" class="pw-post-body-paragraph im in hi io b ip li ir is it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj hb bi translated">在本文中，我们看到了GrokNet使用的数据和架构，它是一个强大的图像识别系统。</p><h2 id="76c6" class="ls kl hi bd km lt lu lv kq lw lx ly ku ix lz ma ky jb mb mc lc jf md me lg mf bi translated">参考</h2><p id="fb14" class="pw-post-body-paragraph im in hi io b ip li ir is it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj hb bi translated"><a class="ae mq" href="https://ai.facebook.com/research/publications/groknet-unified-computer-vision-model-trunk-and-embeddings-for-commerce" rel="noopener ugc nofollow" target="_blank">https://ai . Facebook . com/research/publications/grok net-unified-computer-vision-model-trunk-and-embedding-for-commerce</a></p></div></div>    
</body>
</html>