<html>
<head>
<title>A very short intro to treating specific columns in a Pipeline in a Feature Union</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">这是一个非常简短的介绍，介绍如何在功能联合中处理管道中的特定列</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/a-very-short-intro-to-treating-specific-columns-in-a-pipeline-in-a-feature-union-ffd33178ffec?source=collection_archive---------30-----------------------#2020-03-30">https://medium.com/analytics-vidhya/a-very-short-intro-to-treating-specific-columns-in-a-pipeline-in-a-feature-union-ffd33178ffec?source=collection_archive---------30-----------------------#2020-03-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e4c4157ed831fe55394c5b7a26fb8448.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PsI9hsC9nyl90XFq5AXaEA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">维克多·加西亚在<a class="ae iu" href="https://unsplash.com/s/photos/pipeline?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="f739" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一个数据帧包含许多列。不同的列需要不同的预处理。管道、特征接头有助于形成一口井..管道，以便对训练和测试数据应用相同的转换。</p><p id="75fe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，让我们来学习如何在特性联合中预处理管道中的特定列！！！</p><p id="d47a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将使用虹膜数据集。所以让我们开始吧！！！</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="6823" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">先是一些进口货…</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="0e42" class="kj kk hi kf b fi kl km l kn ko">import pandas as pd<br/>import numpy as np<br/>from sklearn.datasets import load_iris<br/>from sklearn.pipeline import Pipeline, FeatureUnion</span><span id="ecf8" class="kj kk hi kf b fi kp km l kn ko">from sklearn.preprocessing import FunctionTransformer<br/>from sklearn.base import BaseEstimator, TransformerMixin</span></pre><p id="1da3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为什么这些进口？</p><ol class=""><li id="3b43" class="kq kr hi ix b iy iz jc jd jg ks jk kt jo ku js kv kw kx ky bi translated">load_iris将为我们提供虹膜数据集</li><li id="7986" class="kq kr hi ix b iy kz jc la jg lb jk lc jo ld js kv kw kx ky bi translated">管线和特征联合，用于创建管线和特征联合</li><li id="526a" class="kq kr hi ix b iy kz jc la jg lb jk lc jo ld js kv kw kx ky bi translated">函数变形金刚给我们的自定义函数变形金刚的力量！</li><li id="2953" class="kq kr hi ix b iy kz jc la jg lb jk lc jo ld js kv kw kx ky bi translated">基础评估和变压器混合创建我们自己的复杂变压器。</li></ol><p id="9991" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们简短地看一下我们的数据</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="7992" class="kj kk hi kf b fi kl km l kn ko">data = load_iris()<br/>df = pd.DataFrame(data[“data”],columns=data.feature_names)<br/>df.head()</span></pre><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es le"><img src="../Images/0b1bc60fe708b00cf4a7abb635bf0e04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WjwWfagWmmivrwe31RGWDw.png"/></div></div></figure><p id="07bf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的数据由鸢尾属植物的萼片和花瓣的尺寸组成。</p><p id="1511" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们做一个假设的场景，其中我们想要确定长度(萼片长度，花瓣长度)和宽度(萼片宽度，花瓣宽度)。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="e773" class="kj kk hi kf b fi kl km l kn ko">class LenFloor(BaseEstimator,TransformerMixin):<br/>    def __init__(self):<br/>        pass<br/>    <br/>    def fit(self,X):<br/>        return self<br/>    <br/>    def transform(self,X):<br/>        X = np.floor(X)<br/>        return X<br/>    <br/>class WidthCeil(BaseEstimator,TransformerMixin):<br/>    def __init__(self):<br/>        pass<br/>    <br/>    def fit(self,X):<br/>        return self<br/>    <br/>    def transform(self,X):<br/>        X = np.ceil(X)     <br/>        return X</span></pre><p id="68ba" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">怎么回事！</p><ol class=""><li id="dd24" class="kq kr hi ix b iy iz jc jd jg ks jk kt jo ku js kv kw kx ky bi translated">LenFloor和WidthCeil类可以充当转换器和估计器。</li><li id="ffe6" class="kq kr hi ix b iy kz jc la jg lb jk lc jo ld js kv kw kx ky bi translated">__init__函数在初始化时被调用。</li><li id="97dc" class="kq kr hi ix b iy kz jc la jg lb jk lc jo ld js kv kw kx ky bi translated">调用拟合函数来拟合数据。在这种情况下，因为我们只想将它们用作转换器，所以fit不会从传递的数据中获得任何东西。</li><li id="f7a8" class="kq kr hi ix b iy kz jc la jg lb jk lc jo ld js kv kw kx ky bi translated">transform函数将对LenFloor和WidthCeil中的数据帧值分别进行floor和ceil处理。</li><li id="a6d4" class="kq kr hi ix b iy kz jc la jg lb jk lc jo ld js kv kw kx ky bi translated">继承TransformerMixin自动为我们提供了函数fit_transform，它首先调用fit()，然后调用transform()</li></ol><p id="d649" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们想给一些柱子铺地板，给一些柱子装天花板。因此，我们需要一种方法来选择指定的列，并只从我们传递的数据帧中返回它们。是时候调用函数转换器了！</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="720b" class="kj kk hi kf b fi kl km l kn ko">def cols_selector(X,cols):<br/>    return X[cols]</span></pre><p id="b08f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该函数接受两个参数:</p><ul class=""><li id="7bf0" class="kq kr hi ix b iy iz jc jd jg ks jk kt jo ku js lf kw kx ky bi translated">x:数据帧</li><li id="3f17" class="kq kr hi ix b iy kz jc la jg lb jk lc jo ld js lf kw kx ky bi translated">cols:要选择的列名列表</li></ul><p id="ea8d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们制作管道来预处理长度。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="3867" class="kj kk hi kf b fi kl km l kn ko">len_pipe = Pipeline([<br/>    ("col_selector",FunctionTransformer(cols_selector,kw_args={"cols":["sepal length (cm)","petal length (cm)"]})),<br/>    ("subtractor",LenFloor())<br/>])</span></pre><p id="3cba" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">管道是一系列命名的步骤。每一步都有一个名称和一个转换器/估算器。一个步骤的输出是下一个步骤的输入。细节</p><blockquote class="lg lh li"><p id="b846" class="iv iw lj ix b iy iz ja jb jc jd je jf lk jh ji jj ll jl jm jn lm jp jq jr js hb bi translated">名为col_selector的步骤是一个函数转换器，它将把数据帧传递给我们的函数cols_selector</p><p id="a3b0" class="iv iw lj ix b iy iz ja jb jc jd je jf lk jh ji jj ll jl jm jn lm jp jq jr js hb bi translated">列的列表，即萼片长度(cm)和花瓣长度(cm)被指定为关键字参数。具有以下格式:</p></blockquote><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="87f8" class="kj kk hi kf b fi kl km l kn ko">kw_args = {key word argument name: value to be passed</span></pre><blockquote class="lg lh li"><p id="f5af" class="iv iw lj ix b iy iz ja jb jc jd je jf lk jh ji jj ll jl jm jn lm jp jq jr js hb bi translated">我们的函数转换器将选择传递的列并返回它们，这些列将被馈送给LenFloor()</p></blockquote><p id="860c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">LenFloor的fit_transform将被调用(fit()然后transform())，我们将得到已被Floor化的长度。</p><p id="2f3f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">天花板宽度也是如此:</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="a62b" class="kj kk hi kf b fi kl km l kn ko">width_pipe = Pipeline([<br/>    ("col_selector",FunctionTransformer(cols_selector,kw_args={"cols":["sepal width (cm)","petal width (cm)"]})),<br/>    ("square",WidthCeil())<br/>])</span></pre><p id="ac01" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们有了自己的管道，是时候并行执行它们并连接各个管道的结果了。输入FeatureUnion！</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="b307" class="kj kk hi kf b fi kl km l kn ko">fu = FeatureUnion([<br/>    ("len",len_pipe),<br/>    ("width",width_pipe)<br/>])</span></pre><p id="74be" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个特征联合又是一系列命名的步骤。每个步骤的输出将被连接起来以产生最终输出。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="7d5c" class="kj kk hi kf b fi kl km l kn ko">a=fu.fit_transform(df)<br/>print(a[:3,:])</span></pre><p id="d147" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们的特征联合上调用fit_transform将在我们的每个管道上调用fit_transform，这将在那些管道中的步骤上调用fit_transform。</p><figure class="ka kb kc kd fd ij er es paragraph-image"><div class="er es ln"><img src="../Images/a8d030bb92282b675e613b09c28274a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:448/format:webp/1*vNU36e36zzM8v_5IILVKNA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">输出</figcaption></figure><p id="da62" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如你所见，工作已经完成了！但是很难验证，因为我们已经丢失了列名。在一小段代码的帮助下，我们可以取回我们的列名。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="fe5f" class="kj kk hi kf b fi kl km l kn ko">cols = []<br/>for i in range(len(fu.transformer_list)):<br/>    cols.extend(fu.transformer_list[i][1].named_steps["col_selector"].get_params()["kw_args"]["cols"])</span></pre><p id="fc6b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">基本上，</p><ul class=""><li id="222e" class="kq kr hi ix b iy iz jc jd jg ks jk kt jo ku js lf kw kx ky bi translated">fu.transformer_list返回管道列表</li><li id="247c" class="kq kr hi ix b iy kz jc la jg lb jk lc jo ld js lf kw kx ky bi translated">fu.transformer_list[i]是第I个命名的步骤。</li><li id="85c5" class="kq kr hi ix b iy kz jc la jg lb jk lc jo ld js lf kw kx ky bi translated">fu.transformer_list[i][1]是第I个命名步骤中的管道。</li><li id="c3c9" class="kq kr hi ix b iy kz jc la jg lb jk lc jo ld js lf kw kx ky bi translated">fu.transformer_list[i][1]。named_steps["col_selector"]是我们的特征联合中所选管道中的步骤，该特征联合是函数转换器</li><li id="8660" class="kq kr hi ix b iy kz jc la jg lb jk lc jo ld js lf kw kx ky bi translated">fu.transformer_list[i][1]。命名步骤["列选择器"]。get_params()返回其参数的字典</li></ul><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/8a6bfae890dfe3467f66fad9d9493360.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NIWrluP-zvBxqMe5HNBB4w.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">函数转换器的参数</figcaption></figure><ul class=""><li id="4f8d" class="kq kr hi ix b iy iz jc jd jg ks jk kt jo ku js lf kw kx ky bi translated">fu.transformer_list[i][1]。命名步骤["列选择器"]。get_params()["cols"]返回键<em class="lj"> kw_args </em>的值</li></ul><p id="fe9b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们转换后的数据框架…</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="fb10" class="kj kk hi kf b fi kl km l kn ko">pd.DataFrame(a,columns=cols).head()</span></pre><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/4c198b436b4e3eadd6856686ee149b90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kSBwg9L1cHJrcSnk0Scw2w.png"/></div></div></figure><p id="fb7a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以看到长度已被地板覆盖，宽度已被天花板覆盖。</p><p id="5aea" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">任务完成！</p></div></div>    
</body>
</html>