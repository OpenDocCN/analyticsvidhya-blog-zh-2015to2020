<html>
<head>
<title>Big Data Streaming</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">大数据流</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/big-data-streaming-c483195751ee?source=collection_archive---------13-----------------------#2020-08-20">https://medium.com/analytics-vidhya/big-data-streaming-c483195751ee?source=collection_archive---------13-----------------------#2020-08-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/0ae0c6ffae88866cbb10ba9384bd330c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WTeRZku2HxTJJHRWUWgoVA.png"/></div></div></figure><p id="52b8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">实时或流式数据分析是当今的一种趋势，因为公司往往更重视来自不同来源的数据(例如物联网、传感器或社交媒体)或只是因为关键利益相关者希望即时获得洞察并进行趋势预测，而不想等待一夜或批量流程来运行。</p><p id="4d12" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了支持这种说法，诸如<a class="ae jo" href="https://eng.uber.com/kappa-architecture-data-stream-processing/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">【优步】</strong> </a>、<a class="ae jo" rel="noopener" href="/@alitech_2017/alibaba-blink-real-time-computing-for-big-time-gains-707fdd583c26"> <strong class="is hj">阿里巴巴</strong> </a> <strong class="is hj"> </strong>或<a class="ae jo" href="https://www.datanami.com/2018/04/30/how-netflix-optimized-flink-for-massive-scale-on-aws/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">【网飞】</strong> </a>等公司已经采用了微批处理和窗口技术，在实时处理环境中为客户提供有价值的指标，以提供最新的定价、反欺诈、改进个性化并提供运营见解。</p><p id="c48e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这种类型的数据管理架构既可以在关系数据库上使用，也可以在大数据上使用(如果数据量很大的话)。在本文中，我们将深入研究这些新技术，并增强它的一些功能。</p><p id="9999" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">几个技术是这个话题的趋势，但是让我们把重点放在阿帕奇Flink和阿帕奇Kafka上。这两种技术已经足够成熟，可以在任何实时数据流架构中实现，并且已经证明了自己，已经被一些提供商或公司采用，如Azure、AWS或Cloudera。</p><p id="afae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Apache Flink是一个分布式处理引擎和数据分析框架，创建于2016年，可以处理多个数据点或事件，并提供预测性见解。尽管如此，Apache Kafka围绕流处理和分析提出了他们自己的相关用例集。Flink采用流优先(over batch)方法来大规模处理大容量数据流，同时支持状态流、内置容错/弹性和高级窗口技术等关键功能。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jp"><img src="../Images/49fbdb3bf5537dc8198d6c70c7847db0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WpA9vMgnnoZaj6jBjoeYbQ.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">图1 - Apache Flink架构</figcaption></figure><p id="049b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Apache Flink的一些用例是:</p><ul class=""><li id="2f79" class="jy jz hi is b it iu ix iy jb ka jf kb jj kc jn kd ke kf kg bi translated"><strong class="is hj">电信网络监控:</strong>根据来自网络的流数据，使用复杂的窗口逻辑，通过预先计算的固定ETA响应来获取客户投诉</li><li id="9e20" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated"><strong class="is hj">欺诈检测:</strong>从各种数据源中检测欺诈模式</li><li id="ae81" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated"><strong class="is hj">推荐引擎:</strong>需要向最终用户提供推荐和搜索结果的服务</li><li id="d25c" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated"><strong class="is hj">点击流分析:</strong>高流量电子商务网站基于实时点击流数据收集和提供最佳客户体验</li><li id="3d50" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated"><strong class="is hj">应用程序监控:</strong>评估了数千个可定制的指标和日志流警报规则，并检测异常情况。</li></ul><p id="3b10" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一方面，在Apache Kafka中——创建于2011年——支持生产者-消费者消息流处理器，该处理器从输入主题中获取连续的数据流，对该输入执行一些处理，并产生连续的数据流以输出主题。</p><p id="e451" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Apache Kafka的一些用例是:</p><ul class=""><li id="b5b4" class="jy jz hi is b it iu ix iy jb ka jf kb jj kc jn kd ke kf kg bi translated"><strong class="is hj">网站活动跟踪:</strong>将用户活动跟踪管道重建为一组实时发布-订阅提要</li><li id="aabc" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated"><strong class="is hj">推荐引擎:</strong>从RSS源获取新闻文章内容，并将其发布到“文章”Kafka主题，处理该内容以标准化或移除重复内容，并将净化后的文章内容发布到新主题，并向用户推荐该数据。</li></ul><p id="f111" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">既然我们已经接触了这两种技术，那么它们如何参与数据流架构呢？</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es km"><img src="../Images/e7f5a4e8a0a54f058047b25638261dec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4cc5zKov-xeWc-kOw__YgQ.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">图2 -高级大数据流架构</figcaption></figure><p id="c7a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如图2所示，数据流来自Apache Kafka，为数据流提供持久性和发布者/订阅者功能。Kafka和Flink之间通常的协同作用始于事件流被推送到Kafka，然后被Flink jobs消费。这些工作从简单的数据导入/导出转换到更复杂的应用程序(在windows中聚合数据或实现复杂事件处理(CEP)功能)。我们所说的窗口是指将数据流分成小批量或有限的流，以便对其应用不同的转换。</p><p id="5cd5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些作业的结果可以输出回Kafka，供其他服务或几个目标系统(存储、消费层或面向用户的web前端)使用。</p><p id="82cf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在最后一层中做出的选择代表非关系数据库，以利用存储大量数据的能力，并在需要时对这些数据和关系数据库进行处理和聚合，以使用简单的JDBC连接器或传统商业智能世界中使用的仪表板/报告工具来访问聚合的见解。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/405d70ad0aa6ac7016d5d46f87d06163.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5TyQ-HKIDUaixMKrYKDvPA.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">图Apache Kafka和Flink协同的深入分析</figcaption></figure><p id="37e1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于消费或存储层，使用微批处理是一种有价值的解决方案，因此集成了容错功能，它本质上是一个批处理和吞吐量，用于高处理和检查点，针对一组记录一次性完成。但它会有一些延迟，感觉起来不像自然的流，保持有效的状态是一个挑战。</p><p id="4af8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在负载分布上，Flink提供一致的数据移动和计算，Kafka以队列的形式提供日志记录、持久性和消息顺序。</p><ol class=""><li id="bf2a" class="jy jz hi is b it iu ix iy jb ka jf kb jj kc jn ko ke kf kg bi translated">这两种技术的集成保证了以下关键点:</li><li id="799c" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn ko ke kf kg bi translated">事件的有效交付</li><li id="8291" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn ko ke kf kg bi translated">减少对期望的数据流产生阻力或压力的机会</li><li id="2b1d" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn ko ke kf kg bi translated">确保始终有计算资源可用于完成所需的计算任务</li><li id="ca03" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn ko ke kf kg bi translated">作为加速创建其他数据管道的基础/框架。</li></ol><p id="d487" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从更广的角度来看，要创建Kafka主题，用户必须定义分区的数量。这些分区被分配给Flink的任务实例，这些任务实例利用并行处理，并且只有在分配了Kafka分区时才会工作，否则它们将挂起并等待分区进行处理，如图4所示。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kp"><img src="../Images/5652f1d0c3fd0336f9444e70405824e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0DxhFlOawkorL0Wbo9sZyA.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">图4 -分区和Flink任务集成</figcaption></figure><p id="170e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Apache Flink中的Kafka消费者与Flink的检查点机制相结合，作为一个状态操作符，其状态是分区中的read事件。当触发检查点时，存储每个分区的偏移量，并且检查点机制确保操作员任务的所有状态(例如基于相同的输入数据)。</p><p id="7bb4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当所有操作员任务成功存储它们的状态时，检查点完成，这意味着系统提供恰好一次的状态更新，保证从系统故障重启时的有效性。</p><p id="e1b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在处理方面，Flink window在第一个数据元素到达时打开，在满足关闭窗口的条件时关闭。它可以基于时间、消息计数或更复杂的条件。</p><p id="c101" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有不同类型的窗口策略—翻转、滑动、会话和全局窗口。此外，您可以创建除预定义实现之外的自定义实现。</p><p id="fb8e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">翻滚窗口:</strong>将每个元素分配给一个指定窗口大小的窗口。滚动窗口有固定的大小，不会重叠。例如，如果您指定一个大小为5分钟的滚动窗口，将评估当前窗口，并且每五分钟启动一个新窗口。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kq"><img src="../Images/9d3998f724ea8a74dadac2cdfa64abd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fu_p5-cB_5mY8huijYAM6A.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">图5 -滚动窗口说明</figcaption></figure><p id="a4f1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">滑动窗口:</strong>给固定长度的窗口分配元素。类似于翻转窗口分配器，窗口的大小由窗口大小参数配置。一个附加的窗口滑动参数控制滑动窗口启动的频率。因此，如果幻灯片小于窗口大小，滑动窗口可能会重叠。在这种情况下，元素被分配给多个窗口。</p><p id="2e4f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，您可以将大小为10分钟的窗口滑动5分钟。这样，每隔5分钟就会出现一个窗口，其中包含最近10分钟内发生的事件。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/40f70a171a4333ff42616bd10a944265.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hKG3S_IHsE3kpQytHS983g.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">图6 -滑动窗口说明</figcaption></figure><p id="f735" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">会话窗口:</strong>根据活动的会话分配组元素，与滚动窗口和滑动窗口相比，不重叠且没有固定的开始和结束时间。相反，当会话窗口在一段时间内没有接收到元素时，即当出现不活动间隙时，会话窗口关闭。可以用静态会话间隙或会话间隙提取器功能配置会话窗口分配器，会话间隙提取器功能定义多长时间不活动。当该时间段到期时，当前会话关闭，后续元素被分配给新的会话窗口。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/8fde1e8288558adf3c1f7d1fd671bd7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*def9qungu3zA3FM_MXl7Qw.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">图7 -会话窗口说明</figcaption></figure><p id="5037" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">全局窗口:</strong>将所有具有相同关键字的元素分配给同一个全局窗口。只有在您还指定了自定义触发器的情况下，这种窗口方案才有用。否则，将不会执行任何计算，因为全局窗口没有我们可以处理聚集元素的自然终点。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kq"><img src="../Images/380373a4c0605b5a028db62676fc49a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9LDHWcB4btTVE6CoYdDXDw.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">图8 -全局窗口解释</figcaption></figure><p id="625a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">近年来，有一种趋势是将SQL查询融入大数据技术，试图覆盖更广泛的受众，并利用传统BI方法中的知识。</p><p id="5414" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就像Spark一样，Flink通过集成Blink SQL查询处理器，做了将SQL集成到其架构中的努力。这强化了流SQL，并通过Apache Hive(数据仓库软件，便于使用SQL读取、写入和管理驻留在分布式存储中的大型数据集)集成和TPC-DS(决策支持基准，模拟决策支持系统的几个普遍适用的方面，包括查询和数据维护)覆盖将成熟的批处理引入Flink，所有这些都通过表API和SQL实现，如图9所示。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es kt"><img src="../Images/8977c0b0856a31b742d2c3b051bb613c.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*V6Vs-xxeBgcxRbAshKwzNQ.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">图9 -闪烁SQL查询处理器组织</figcaption></figure><p id="f383" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">简而言之，Apache Flink是一个框架和分布式处理引擎，用于无界和有界数据流上的有状态计算，是在数据驱动世界的时代发挥作用并受到更多关注的许多技术之一，可以为解释和处理数据的人提供多种优势，而不管最终目的是什么。</p><p id="8b50" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个故事的一些来源:<a class="ae jo" href="https://flink.apache.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">阿帕奇·弗林克</strong> </a>，<a class="ae jo" href="https://kafka.apache.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">阿帕奇·卡夫卡</strong> </a>，<a class="ae jo" href="https://www.ververica.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">维韦里卡</strong> </a>，<a class="ae jo" href="http://eng.uber.com/" rel="noopener ugc nofollow" target="_blank"> U <strong class="is hj"> ber工程</strong> </a>，<a class="ae jo" href="https://www.cloudera.com" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> Cloudera </strong> </a></p></div></div>    
</body>
</html>