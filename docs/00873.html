<html>
<head>
<title>The Kubernetes Control Plane</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">库伯内特控制飞机</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/the-kubernetes-control-plane-f4bf460c848f?source=collection_archive---------4-----------------------#2019-09-15">https://medium.com/analytics-vidhya/the-kubernetes-control-plane-f4bf460c848f?source=collection_archive---------4-----------------------#2019-09-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/73f729d285f5b918656b705cf0f648fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*76EQLGlWqnRE5lzh60gFbg.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated"><a class="ae hv" href="https://buddy.works/blog/thumbnails/gke-authentication.png" rel="noopener ugc nofollow" target="_blank">https://buddy.works/blog/thumbnails/gke-authentication.png</a></figcaption></figure><div class=""/><figure class="ev ex iw ix iy hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es iv"><img src="../Images/a2b859667a2957df85b3ddf578c4d157.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5BUo9SV9idWAKP85w8L3Eg.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated"><a class="ae hv" href="https://kubernetes.io" rel="noopener ugc nofollow" target="_blank"> https://kubernetes.io </a></figcaption></figure><p id="64b8" class="pw-post-body-paragraph iz ja hy jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">我们来看看kubernetes内部是如何进行沟通的。</p><p id="a4d0" class="pw-post-body-paragraph iz ja hy jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">kubectl命令是用户与之交互的东西，也是用来与kubernetes后端建立内部连接的东西。该命令首先需要配置适当的凭证和kubernetes集群的位置。</p><p id="cbe6" class="pw-post-body-paragraph iz ja hy jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">$&gt; kubectl获取pod</p><ul class=""><li id="8127" class="jx jy hy jb b jc jd jg jh jk jz jo ka js kb jw kc kd ke kf bi translated">这将通过HTTPs向集群发送一个API调用</li><li id="be24" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">API响应通过HTTPS发送回控制台，并显示给用户。</li></ul><p id="1759" class="pw-post-body-paragraph iz ja hy jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">让我们进一步深入了解后端到底发生了什么。请看下图:</p><figure class="km kn ko kp fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kl"><img src="../Images/bf60ca6886da7e176ac5b3cf6056e8ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WpJklXWRiP-8APYeV4whkg.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">Kubernetes控制平面</figcaption></figure><h1 id="7ce8" class="kq kr hy bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">主人:</h1><ul class=""><li id="c99d" class="jx jy hy jb b jc lo jg lp jk lq jo lr js ls jw kc kd ke kf bi translated">主节点对集群做出全局决策，它们还检测集群事件并做出响应，例如当部署的现场“副本”不符合要求时启动新的pod。(副本规定了在任何给定时间点要保留的相同节点结构的数量)</li><li id="6b2d" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">主组件，设置脚本通常在同一台机器上启动所有主组件，为了简单起见，不在这台机器上运行用户容器。</li></ul><h1 id="c7a8" class="kq kr hy bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">主组件:</h1><ol class=""><li id="c245" class="jx jy hy jb b jc lo jg lp jk lq jo lr js ls jw lt kd ke kf bi translated">Kube API服务器:</li></ol><ul class=""><li id="d224" class="jx jy hy jb b jc jd jg jh jk jz jo ka js kb jw kc kd ke kf bi translated">接受查看或更改集群状态的命令，包括启动pod的命令。</li><li id="67f8" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">它验证请求并确定它们是否被授权和有效，从而管理准入控制。</li><li id="17b6" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">这是master的组件，它接收API调用并适当地为其提供服务。</li><li id="85c8" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">Kube API服务器也与kubelet建立连接。(kubelets将很快介绍..坚持住！).</li></ul><p id="28d9" class="pw-post-body-paragraph iz ja hy jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">2.etcd:</p><ul class=""><li id="a703" class="jx jy hy jb b jc jd jg jh jk jz jo ka js kb jw kc kd ke kf bi translated">这是集群数据库。</li><li id="3c3c" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">它可靠地存储集群的状态，包括关于集群配置的所有信息和更多的动态信息，如哪些节点需要运行等。</li><li id="5dfe" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">如图所示，kube API服务器直接与etcd交互。</li><li id="657a" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">如果您的Kubernetes集群使用etcd作为其后备存储，请确保您有一个安全的数据备份计划。</li></ul><p id="d880" class="pw-post-body-paragraph iz ja hy jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">3.kube-调度程序:</p><ul class=""><li id="939d" class="jx jy hy jb b jc jd jg jh jk jz jo ka js kb jw kc kd ke kf bi translated">它的任务是将pod调度到节点上，并评估每个pod的需求。</li><li id="fd7b" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">评估完成后，它必须选择最合适的节点。</li><li id="981d" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">实际上，它并不真正将pod启动到节点上，而是寻找没有分配节点的pod，然后简单地将该节点的名称写入pod对象。(这更像是一个经理在一家餐馆里，根据要求，一看到有桌子空着或空着，就进行预订)。</li><li id="d69e" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">因为它是一个调度程序，所以它也跟踪所有pod的状态。还要考虑硬件、软件和策略约束。</li></ul><p id="6110" class="pw-post-body-paragraph iz ja hy jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">4.Kube控制器经理:</p><ul class=""><li id="8d6c" class="jx jy hy jb b jc jd jg jh jk jz jo ka js kb jw kc kd ke kf bi translated">它通过kube API服务器持续监控集群的状态。</li><li id="7dce" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">当当前状态与所需状态不匹配时，它会进行更改以达到所需状态。(虽然进行了预订，但由于没有空桌，经理决定增加一张桌子来容纳顾客)。</li><li id="29f5" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">它被称为控制器管理器，因为Kubernetes对象是由称为控制器的代码循环维护的。</li><li id="2068" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">如果某个节点离线，控制器还会与重要信息进行通信。</li></ul><p id="27d0" class="pw-post-body-paragraph iz ja hy jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">5.Kube云管理器:</p><ul class=""><li id="2058" class="jx jy hy jb b jc jd jg jh jk jz jo ka js kb jw kc kd ke kf bi translated">云控制器管理器运行与底层云提供商交互的控制器。</li><li id="555e" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">cloud-controller-manager允许云供应商的代码和Kubernetes的代码相互独立地发展。在之前的版本中，Kubernetes的核心代码依赖于特定于云提供商的功能代码。</li><li id="c6f9" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">它负责负载平衡、按需存储卷等功能。</li></ul><h1 id="74dd" class="kq kr hy bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">该节点:</h1><p id="6a23" class="pw-post-body-paragraph iz ja hy jb b jc lo je jf jg lp ji jj jk lu jm jn jo lv jq jr js lw ju jv jw hb bi translated">到现在为止，我们都知道什么是节点，如果不是的话，我很惊讶你是如何理解这一点的… ( <a class="ae hv" rel="noopener" href="/@ajinkyabhanudas/overview-the-google-kuberenetes-engine-4c849c851da7?source=friends_link&amp;sk=c1d217c83379ed69d504dfdf8119bc41">快速阅读1 </a>，<a class="ae hv" rel="noopener" href="/@ajinkyabhanudas/kubernetes-features-and-why-gke-provides-an-improvised-orchestration-solution-to-kubernetes-5a038f436e5a">快速阅读2 </a>)。</p><h1 id="74a1" class="kq kr hy bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated"><strong class="ak">节点组件:</strong></h1><ol class=""><li id="4b66" class="jx jy hy jb b jc lo jg lp jk lq jo lr js ls jw lt kd ke kf bi translated">库伯莱:</li></ol><ul class=""><li id="4ef7" class="jx jy hy jb b jc jd jg jh jk jz jo ka js kb jw kc kd ke kf bi translated">它是每个节点上的kubernetes代理。</li><li id="bd13" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">当需要开始一个pod时，需要一个连接kubelet。</li><li id="3fa0" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">kubelet使用容器运行时来启动pod，监控它的生命周期，检查准备情况，等等。</li><li id="a879" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">Kubelet向kube API服务器报告。</li><li id="995a" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">关于GKE需要注意的一点是，它只利用Docker容器运行时。</li></ul><p id="61a1" class="pw-post-body-paragraph iz ja hy jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">2.Kube-proxy:</p><ul class=""><li id="ec0c" class="jx jy hy jb b jc jd jg jh jk jz jo ka js kb jw kc kd ke kf bi translated">它是运行在集群中每个节点上的网络代理。</li><li id="131a" class="jx jy hy jb b jc kg jg kh jk ki jo kj js kk jw kc kd ke kf bi translated">它维护集群中各单元之间的网络连接。(kube-proxy维护节点上的网络规则，这允许它维护网络连接)。</li></ul><p id="4c62" class="pw-post-body-paragraph iz ja hy jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">所有这些加在一起形成了Kubernetes控制平面。现在，您应该对这些组件如何交互以及它们执行什么任务有了清晰的理解。</p><p id="811f" class="pw-post-body-paragraph iz ja hy jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">在下一篇文章中，我们将尝试了解kubernetes中的操作和更多的kubectl命令，以及它是如何工作的。在那之前，继续学习:)</p></div></div>    
</body>
</html>