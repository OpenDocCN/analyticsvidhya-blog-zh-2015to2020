<html>
<head>
<title>Decision Optimization Sensitivity Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">决策优化灵敏度分析</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/decision-optimization-sensitivity-analysis-d1e4b123732e?source=collection_archive---------6-----------------------#2019-10-22">https://medium.com/analytics-vidhya/decision-optimization-sensitivity-analysis-d1e4b123732e?source=collection_archive---------6-----------------------#2019-10-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="0f7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您开发新的决策优化模型时，您希望了解新的输入数据如何影响解决方案。借助Watson Studio的决策优化，您可以轻松生成和解决许多场景，并查看影响。</p><h1 id="87f2" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">员工规划示例</h1><p id="b0f7" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">让我们用一个员工计划的例子。它是我们的示例之一，您可以从这个压缩文件中<a class="ae kg" href="https://github.com/IBMDecisionOptimization/DO-Samples/blob/watson_studio_cloud/Model_Builder/StaffPlanning.zip" rel="noopener ugc nofollow" target="_blank">创建一个新的模型构建器。问题包括决定你应该雇佣多少固定和临时员工来满足你的商店或餐馆的需求。</a></p><p id="4917" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随机数据用于表示两天的需求，在午餐和晚餐时有一些峰值。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/710deb6f0cbb0282df47437c584f0ea7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PQYJZUN78Xur6EZMkVIbsw.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">产生的需求示例</figcaption></figure><p id="9d9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不同的资源被建模为两种简单的类型，每一种都有不同的工作持续时间和每天的成本，具有最小和最大可用性。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kx"><img src="../Images/fa8d552f436ae4326dfac230a83a1f02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PjnowKYB8mUD3zuR_SonFg.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">资源数据示例</figcaption></figure><p id="ed8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么优化模型就是简单的覆盖模型。</p><p id="d43b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">决策变量包括每种类型的工作资源的数量，以及每种类型的资源在每个时期开始工作和工作的数量。</p><pre class="ki kj kk kl fd ky kz la lb aw lc bi"><span id="2a48" class="ld je hi kz b fi le lf l lg lh"># start[r,t] is number of resource r starting to work at period t<br/>start = mdl.integer_var_matrix(keys1=resources, keys2=periods, name="start")</span><span id="7944" class="ld je hi kz b fi li lf l lg lh"># work[r,t] is number of resource r working at period t<br/>work = mdl.integer_var_matrix(keys1=resources, keys2=periods, name="work")</span><span id="55a3" class="ld je hi kz b fi li lf l lg lh"># nr[r] is number of resource r working in total<br/>nr = mdl.integer_var_dict(keys=resources, name="nr")</span><span id="3eb8" class="ld je hi kz b fi li lf l lg lh"># nr[r,d] is number of resource r working on day d<br/>nrd = mdl.integer_var_matrix(keys1=resources, keys2=days, name="nrd")</span></pre><p id="e254" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">约束条件包括这些变量之间的联系、最小和最大可用性以及需求的覆盖范围。</p><pre class="ki kj kk kl fd ky kz la lb aw lc bi"><span id="311d" class="ld je hi kz b fi le lf l lg lh"># available per day<br/>for r in resources:<br/>    min_avail = int(df_resources[df_resources.id == r].min_avail)<br/>    max_avail = int(df_resources[df_resources.id == r].max_avail)<br/>    for d in range(N_DAYS):<br/>        mdl.add( mdl.sum(start[r,t] for t in range(d*N_PERIODS_PER_DAY, (d+1)*N_PERIODS_PER_DAY)) == nrd[r,d])<br/>        mdl.add( nrd[r,d] &lt;= nr[r] )<br/>    mdl.add( min_avail &lt;= nr[r] )<br/>    mdl.add(        nr[r] &lt;= max_avail )<br/>    <br/># working<br/>for r in resources:<br/>    duration = int(df_resources[df_resources.id == r].duration)*4<br/>    for t in periods:<br/>        mdl.add( mdl.sum(start[r,t2] for t2 in range(max(t-duration,0), t)) == work[r,t])<br/>        <br/># work vs demand<br/>for t in periods:<br/>    demand = int(df_demands[df_demands.period == t].demand)<br/>    mdl.add( mdl.sum( work[r,t] for r in resources) &gt;= demand)</span></pre><p id="28a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，添加了一些KPI和目标。</p><pre class="ki kj kk kl fd ky kz la lb aw lc bi"><span id="f1e7" class="ld je hi kz b fi le lf l lg lh">total_cost = mdl.sum( int(df_resources[df_resources.id == r].cost)*nr[r] for r in resources)<br/>n_fix_used = nr['fix']<br/>n_temp_used = nr['temp']</span><span id="fe25" class="ld je hi kz b fi li lf l lg lh">mdl.add_kpi(total_cost   , "Total Cost")<br/>mdl.add_kpi(n_fix_used   , "Nb Fix Used")<br/>mdl.add_kpi(n_temp_used   , "Nb Temp Used")</span><span id="8104" class="ld je hi kz b fi li lf l lg lh">mdl.minimize(total_cost)</span></pre><p id="62ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">求解此模型，您将获得为优化成本而雇佣的固定和临时资源的数量，以及每个资源的开始时间，如下图所示:</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es lj"><img src="../Images/c8fa3f339c88a425b0b63f93dac92f14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T7WuzKjD5mi-Oxn0_2Em8A.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">解决方案示例</figcaption></figure><p id="69fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<a class="ae kg" rel="noopener" href="/ibm-watson/decision-optimization-model-builder-now-in-open-beta-on-watson-studio-public-45db16628e5b">模型构建器</a>中可用的可视化工具可以轻松配置所有这些图表。</p><h1 id="605e" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">灵敏度分析</h1><p id="594e" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">下一个问题是:解决方案如何对输入数据敏感？总目标或固定和临时资源之间的划分是否从一种需求分布到另一种需求分布发生了很大变化？根据随机数据的生成方式(例如，我们可以使用历史数据和天气预报……)，以及分析过程中解决方案的哪一部分应被视为不变的(例如，我们可以固定固定员工的数量)，可以采用多种不同的方式进行敏感性分析。</p><p id="562b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有这些方法基本上包括(1)生成新的输入数据场景，然后(2)运行优化模型，可选地冻结一些解决方案。</p><p id="eb33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来看一个最简单的例子，您想要运行模型N次，每次都有一个新的随机生成的需求。，然后在没有任何冻结决策的情况下求解优化模型。</p><p id="7ccf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以从python笔记本中非常容易地做到这一点，在那里你可以编写如何生成和求解场景的脚本。</p><p id="9685" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将使用<code class="du lk ll lm kz b">dd_scenario</code> python包，它需要一个<code class="du lk ll lm kz b">project_context</code>和一个<code class="du lk ll lm kz b">apikey</code>来访问、修改和求解场景。有关如何获取这些的更多详细信息，请参见本<a class="ae kg" href="https://dataplatform.cloud.ibm.com/docs/content/DO/DODS_Notebooks/multiScenario.html?audience=wdp&amp;context=wdp" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="e387" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，您需要从pip安装<code class="du lk ll lm kz b">dd_scenario</code>包。</p><pre class="ki kj kk kl fd ky kz la lb aw lc bi"><span id="5a29" class="ld je hi kz b fi le lf l lg lh">pip install --user dd-scenario</span></pre><p id="ce2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后使用模型构建器和场景名称导入并创建一个新的<code class="du lk ll lm kz b">Client</code>。</p><pre class="ki kj kk kl fd ky kz la lb aw lc bi"><span id="0002" class="ld je hi kz b fi le lf l lg lh"><strong class="kz hj">from</strong> <strong class="kz hj">dd_scenario</strong> <strong class="kz hj">import</strong> *<br/><br/><em class="ln"># In order to use the solve() function, you must provide an API key when creating the client</em><br/>client = Client(pc=pc, apikey=apikey)<br/>decision = client.get_model_builder(name="StaffPlanning")<br/>scenario = decision.get_scenario(name="Scenario 1")</span></pre><p id="e0a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，根据您的需要，尽可能多次地复制和求解该场景(这里，使用<code class="du lk ll lm kz b">random_demand</code>函数生成新的随机需求)。</p><p id="3c60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码还创建了一个不同的<code class="du lk ll lm kz b">my_kpis</code>输出表，并将它们放在一边。</p><pre class="ki kj kk kl fd ky kz la lb aw lc bi"><span id="b866" class="ld je hi kz b fi le lf l lg lh">all_kpis = pd.DataFrame()<br/><br/><strong class="kz hj">for</strong> i <strong class="kz hj">in</strong> range(1, N_SCENARIOS+1):<br/>    sc_name = "Copy <strong class="kz hj">%02d</strong>" % (i)<br/>    print(sc_name)</span><span id="2dfd" class="ld je hi kz b fi li lf l lg lh">    copy = decision.get_scenario(name=sc_name)<br/>    <strong class="kz hj">if</strong> (copy != <strong class="kz hj">None</strong>):<br/>        print(" Deleting old...")<br/>        decision.delete_container(copy)</span><span id="f84f" class="ld je hi kz b fi li lf l lg lh">    print(" Copying from original scenario...")    <br/>    copy = scenario.copy(sc_name)</span><span id="5063" class="ld je hi kz b fi li lf l lg lh">    print(" Generating new demand...")<br/>    df_demands = random_demand(200)<br/>    copy.add_table_data("demands", df_demands, category='input')</span><span id="9d8e" class="ld je hi kz b fi li lf l lg lh">    print(" Solving...")<br/>    copy.solve()</span><span id="c3b1" class="ld je hi kz b fi li lf l lg lh">    print(" Grabbing solution kpis...")<br/>    kpis = copy.get_table_data('kpis')<br/>    kpis['scenario'] = sc_name<br/>    mk = [[ kpis.iloc[0]['VALUE'],  "<strong class="kz hj">%02d</strong>" % (kpis.iloc[1]['VALUE']), sc_name, "<strong class="kz hj">%02d</strong>" % (kpis.iloc[2]['VALUE'])]]<br/>    my_kpis = pd.DataFrame(data=mk, columns=['cost','fix','scenario','temp'])<br/>    copy.add_table_data('my_kpis', data=my_kpis, category='output')<br/>    all_kpis = all_kpis.append(kpis)<br/>    <br/>print("Done!")</span></pre><h1 id="2654" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">可视化灵敏度分析结果</h1><p id="c329" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">例如，您可以使用Brunel在笔记本中可视化结果。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es lo"><img src="../Images/393e5ccf13f546ba11e820d957e755f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mrg73E884v9i6VgY-T2wNg.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">显示笔记本中的所有结果。</figcaption></figure><p id="4b72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">见完整的笔记本代码<a class="ae kg" href="https://dataplatform.cloud.ibm.com/analytics/notebooks/v2/acc1a904-73aa-4fde-bc79-4937ad3ebb39/view?access_token=d84c99c090f66f601f68e8b9e5a96da44758bc3b8433a2ae28d29deea3c064c7" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="7035" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是您也可以在模型构建器中使用可视化效果，并比较多个场景。例如，您可以创建一个2D或3D视图，显示总成本如何根据所需的固定员工和临时员工的数量而变化。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es lp"><img src="../Images/74ce9345a8ad9ba0cbcd4f6fa8707a3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uf1U0L96lF6mPb1ydWMJIQ.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">模型构建器可视化。</figcaption></figure><h1 id="4099" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">试试看！</h1><p id="9714" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">你现在可以使用Watson Studio上的模型生成器的<a class="ae kg" rel="noopener" href="/ibm-watson/decision-optimization-model-builder-now-in-open-beta-on-watson-studio-public-45db16628e5b">正在进行的测试版</a>来尝试这一切。</p><p id="00ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">邮件:</strong>alain.chabrier@ibm.com</p><p id="7eaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">领英:</strong><a class="ae kg" href="https://www.linkedin.com/in/alain-chabrier-5430656/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/alain-chabrier-5430656/</a></p><p id="ea71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">推特:</strong>https://twitter.com/AlainChabrier<a class="ae kg" href="https://twitter.com/AlainChabrier" rel="noopener ugc nofollow" target="_blank"/></p></div></div>    
</body>
</html>