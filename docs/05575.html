<html>
<head>
<title>Association Rule Mining — concept and implementation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关联规则挖掘——概念和实现</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/association-rule-mining-concept-and-implementation-28443d16f611?source=collection_archive---------3-----------------------#2020-04-26">https://medium.com/analytics-vidhya/association-rule-mining-concept-and-implementation-28443d16f611?source=collection_archive---------3-----------------------#2020-04-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="07ea" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">解决购物篮分析问题的综合指南</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/d3480b6570196ba705c22bad1e6e36b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k4aQ4K9OhbHMTIGrky2vdQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">来源:https://www.exchange4media.com/</figcaption></figure><p id="1756" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">关联规则挖掘是数据挖掘和机器学习的主要概念之一，它简单地用于识别大型数据集中的出现模式。我们建立了一套规则来找出不同项目的定位是如何相互影响的。这些模式可以是任何类型，如电话联系模式、可疑活动模式、任何疾病症状的模式和顾客购物模式。在这里，我们将重点关注客户购物模式，更合适的术语是购物篮分析。</p><p id="c598" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">市场购物篮分析是最受欢迎的技术之一，用于寻找商店中的最佳产品位置，并决定提高整体销售额的报价。这个想法是把那些在使用上有某种相互依赖的产品集合在一起。这样做肯定能促进销售，因为将它们放在一起会提醒或鼓励顾客对相关产品的需求。为了解决这个问题，我们开发所有可能的产品关联规则集，并找出最有效的关联规则。现在的问题是我们如何开发和发现这些关联规则的有效性？答案是<strong class="jq hj"> Apriori算法</strong>。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="ed36" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">Apriori算法</h1><h2 id="b273" class="lj ks hi bd kt lk ll lm kx ln lo lp lb jx lq lr ld kb ls lt lf kf lu lv lh lw bi translated">概念:</h2><p id="aad5" class="pw-post-body-paragraph jo jp hi jq b jr lx ij jt ju ly im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">该算法由R. Agrawal先生和R. Srikant先生于1994年提出，他们称之为“Apriori ”,因为它使用先验信息，即现有的交易，来找出关联和模式。</p><p id="90b1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在我们深入研究它的工作原理之前，我们必须了解它的特性:</p><ul class=""><li id="cc5d" class="mc md hi jq b jr js ju jv jx me kb mf kf mg kj mh mi mj mk bi translated"><em class="ml">向下闭包性质</em>，它说一个频繁项集的子集也应该是频繁的。</li><li id="dcf4" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">所有非经常项目子集也有非经常项目超集。</li></ul><h2 id="d5ac" class="lj ks hi bd kt lk ll lm kx ln lo lp lb jx lq lr ld kb ls lt lf kf lu lv lh lw bi translated">关联措施:</h2><p id="3614" class="pw-post-body-paragraph jo jp hi jq b jr lx ij jt ju ly im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">它遵循三种方法来找出关联。让我们通过一个小示例集来了解这些度量是如何计算的:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mr"><img src="../Images/ddf193401f08615e41b05afa7eba5d79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*quOtc9dps0CsSPBPJ2Vccw.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">在不同交易中购买的项目</figcaption></figure><p id="f49c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">它只包含10个事务，因此计算和理解支持、信心和提升会更容易。</p><ol class=""><li id="2e78" class="mc md hi jq b jr js ju jv jx me kb mf kf mg kj ms mi mj mk bi translated"><strong class="jq hj"> <em class="ml">支持:</em> </strong>是项目/项目集的出现百分比，或者简单的说是项目的流行度。它可以通过简单地找出包含项目的交易的比例来计算。</li></ol><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mt"><img src="../Images/387e043cd30c56925c1c8dce04a957ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*73Q2TaVafCCfed91Sn_4jQ.png"/></div></figure><p id="5d01" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="ml">例如</em></p><p id="aed2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">支持(Soap) = (4/10)*100 = 40%</p><p id="426a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">意味着40%的交易包括巧克力。</p><p id="5076" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> 2。<em class="ml">置信度:</em> </strong>它是关联规则的可能性或可信度，或者简单地说，它告诉我们规则有效的频率；比方说，如果我们寻找的模式是Y在X之后购买，那么置信度可以计算为:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mt"><img src="../Images/886e5631b5df4f1aa492ef58f89ced4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gPgNq58vkvbvbxJZcEigUg.png"/></div></figure><p id="1d23" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="ml">例如:</em></p><p id="8de8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">信心(香水-&gt;肥皂)=支持(香水U肥皂)/支持(香水)</p><p id="3625" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi">= (30/40) * 100</p><p id="8b5e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">意味着75%的顾客在购买香水的时候，最终也会购买肥皂。</p><p id="8f38" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> <em class="ml"> 3。Lift: </em> </strong>它不过是(关联规则的)置信度和期望置信度的比值。这里的期望置信度意味着不存在这样的模式，意味着销售项目在关联规则中是独立的。看看这个公式，举一个例子可以更好理解:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mt"><img src="../Images/7ee1ecc030d42a40f46c5baf62e00ce7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TVmgjExd4A0wUIgIs8beRg.png"/></div></figure><p id="f3b6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在这个公式中，期望的置信度只不过是项目Y在交易中的出现，与项目x的关联无关。</p><p id="a49e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果我们得到:</p><p id="a119" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> Lift = ~1，</strong>表示项目Y的销售是独立的，无论如何都会以相同的金额发生，而不管它与任何其他项目的关联，因此我们不应该在这些项目之间找到任何关联。</p><p id="a6ba" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> Lift &gt; 1 </strong>，表示关联规则中项目的销售有很强的正相关关系，或者换句话说，人们倾向于一起购买这些项目，而不是单独购买Y，因此X在将Y放在一起时也会促进Y的销售。</p><p id="a36d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> Lift &lt; 1 </strong>，表示关联规则中项目的销售具有负/逆关系，即它们是相互替代的，一个项目的存在可以降低其他项目的销售，反之亦然。</p><p id="9f31" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Lift(香水-&gt;肥皂)=信心(香水-&gt;肥皂)/支持(肥皂)</p><p id="14d9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi">=75/40 =1.87</p><p id="3667" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">意味着香水和肥皂有很强的关系，香水的存在促进了肥皂的销售。</p><p id="35af" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在我们了解了识别强关联规则的各种方法，并准备好了解Apriori算法的完整工作原理。</p><h2 id="959d" class="lj ks hi bd kt lk ll lm kx ln lo lp lb jx lq lr ld kb ls lt lf kf lu lv lh lw bi translated">完成工作:</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mu"><img src="../Images/139fcaa7d19dd2e0c9c3681657fe69a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*E1Hs4BSbPEqScCVVxFcySQ.png"/></div></figure><p id="3bc9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">该流程图解释了该算法的工作原理，我们将通过一个示例来理解这一点，但首先我们需要获取支持度和置信度的阈值。</p><blockquote class="mv mw mx"><p id="c7e4" class="jo jp ml jq b jr js ij jt ju jv im jw my jy jz ka mz kc kd ke na kg kh ki kj hb bi translated"><strong class="jq hj"> <em class="hi">支持阈值(或min_supp) = 30% </em> </strong></p><p id="7ec1" class="jo jp ml jq b jr js ij jt ju jv im jw my jy jz ka mz kc kd ke na kg kh ki kj hb bi translated"><strong class="jq hj"> <em class="hi">【或min _ conf】= 70%</em></strong></p></blockquote><p id="da56" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这些阈值只不过是一个最低标准，将用于挑选流行项目集和强关联规则的剪枝。我们还需要理解，这些阈值应该基于商品的种类和市场规模。我的意思是，在真实情况下，任何商店都会有如此多的商品，所以你不能将30%设定为支持阈值，因为并非所有商品都是我们日常需求的一部分，所以它们可能不太受欢迎。</p><p id="a40b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">第一步:</strong></p><p id="96a0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> A. </strong>创建<em class="ml">1-项集</em>候选项，并计算所有项的支持度。</p><p id="21fb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> B. </strong>执行剪枝创建<em class="ml"> L1频繁项集。</em>在修剪中，我们将过滤掉支持度小于min_supp值(30)的所有项目。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mt"><img src="../Images/766b6b696e49ab798dc1b4df92ef5567.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*svCObKAaWi2We54-LHE6XQ.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">1-项集候选和L1频繁项集</figcaption></figure><p id="6a50" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">第二步:</strong></p><p id="f415" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> A. </strong>从<em class="ml"> L1频繁项集</em>中创建2个<em class="ml">-项集</em>候选项，并计算它们的支持度。</p><p id="b288" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> B. </strong>进行剪枝，创建<em class="ml"> L2频繁项集。</em>和以前一样，我们将再次过滤掉支持度小于min_supp值(30)的所有项目集。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mt"><img src="../Images/6dba2aca712dff231083cf034e47ebf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P-EhCNGU4VJHdfJOBDzBZg.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">2-项集候选和L2频繁项集</figcaption></figure><p id="9fdc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">第三步:</strong></p><p id="02a0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> A. </strong>从<em class="ml"> L2频繁项集</em>中创建3个<em class="ml">-项集</em>候选项，并计算它们的支持度。</p><p id="280e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> B. </strong>进行剪枝，创建<em class="ml"> L3频繁项集</em>。但是在这里你可以看到，对于所有的3-项集，Support都小于min_supp值(30 ),所以我们不能前进，只需要从<em class="ml"> L2频繁项集</em>中找到关联规则。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nb"><img src="../Images/cb7abe77a768159263e88682cbd15e48.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*FuanRvwbKR52eVP3f-FaQw.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">3项集候选者</figcaption></figure><p id="9652" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">最后一步:创建关联规则</strong></p><p id="8077" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们需要计算<em class="ml"> L2频繁项目集中所有项目组合的置信度。</em></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nc"><img src="../Images/03bdc17b2845880ef4d932b11afeb037.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*-LlnfBDQl7WcSBZavxw-3Q.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">获取的关联规则</figcaption></figure><p id="cfce" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> B. </strong>再次对执行剪枝，这次过滤掉所有那些置信度(%)小于min_conf(70%)的关联规则。</p><p id="ae02" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">此外，我们还计算了提升值，以更好地了解该关联规则将对单个商品的销售产生何种影响。但是，我们不会将其用作规则选择标准。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nd"><img src="../Images/2fc5db2c958fa9eb59bd4e614fb0e4b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*f78d8wtgx7dWUwQ4DHVKpA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">强关联规则</figcaption></figure><p id="d118" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">所以最后，我们获得了关联规则，可以在任何商店使用，以促进销售。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="ed7c" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">用Python实现</h1><p id="82eb" class="pw-post-body-paragraph jo jp hi jq b jr lx ij jt ju ly im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">我们将对一个非常小而简单的数据集进行简单的市场购物篮分析，该数据集包含对大约120种商品的交易模式的大约7500次观察，以下是该数据集的链接:</p><p id="e7d9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><a class="ae jn" href="https://www.kaggle.com/roshansharma/market-basket-optimization" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/roshan Sharma/market-basket-optimization</a></p><p id="9f39" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">库导入</p><pre class="iy iz ja jb fd ne nf ng nh aw ni bi"><span id="e59d" class="lj ks hi nf b fi nj nk l nl nm">import numpy as np <em class="ml"># linear algebra</em><br/>import pandas as pd <em class="ml"># data processing, CSV file I/O (e.g. pd.read_csv)</em><br/>pd.set_option('display.max_rows', None)</span><span id="99c5" class="lj ks hi nf b fi nn nk l nl nm">from matplotlib import pyplot as plt<br/>%matplotlib inline</span><span id="390a" class="lj ks hi nf b fi nn nk l nl nm">import seaborn as sns<br/>sns.set_style('whitegrid')</span><span id="b4ce" class="lj ks hi nf b fi nn nk l nl nm">from mlxtend.preprocessing import TransactionEncoder<br/>from mlxtend.frequent_patterns import apriori, association_rules</span></pre><p id="2550" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">读出数据</p><pre class="iy iz ja jb fd ne nf ng nh aw ni bi"><span id="6719" class="lj ks hi nf b fi nj nk l nl nm">market_basket_df = pd.read_csv('./Market_Basket_Optimisation.csv', header=None)<br/>market_basket_df.head()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es no"><img src="../Images/ae1403089e967e6e25d284b17dc35a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2uZi6hRYYuEDyrm6v0jOPQ.png"/></div></div></figure><p id="8ff6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如您所见，数据集不包含列或索引标签，所以让我们继续假设每一行都是一个事务或篮子。我们需要把它放在适当的结构中，只有这样我们才能做进一步的分析。我们可以为每个项目创建列，并根据它在事务中的出现情况将其行值保持为True/False。</p><pre class="iy iz ja jb fd ne nf ng nh aw ni bi"><span id="1ed7" class="lj ks hi nf b fi nj nk l nl nm">basket_items = []<br/>for index, row in market_basket_df.iterrows():<br/>   cleansed_items = [item for item in row if str(item)!=’nan’]<br/>   basket_items.append(cleansed_items)</span><span id="5fc1" class="lj ks hi nf b fi nn nk l nl nm">basket_items[:3]</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es np"><img src="../Images/ed1b4c25c9211b913efbe4098391b637.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CdfpBAHi6VQeXdM26m_10w.png"/></div></div></figure><p id="f252" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们将使用从我这里导入的TranscationEncoder扩展并传递我们创建的购物篮项目列表。正如我们所讨论的，它将根据事务列值的出现情况对它们进行热编码。</p><pre class="iy iz ja jb fd ne nf ng nh aw ni bi"><span id="c36a" class="lj ks hi nf b fi nj nk l nl nm">tran_encod = TransactionEncoder()<br/>tran_encod_list = tran_encod.fit(basket_items).transform(basket_items)<br/>transaction_df = pd.DataFrame(tran_encod_list, columns=tran_encod.columns_)</span><span id="8f34" class="lj ks hi nf b fi nn nk l nl nm">transaction_df.head()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nq"><img src="../Images/e081fca071f3b85d5dc1b2bd57d31b07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wtnvZsWf82ffC5Pfp3nzFw.png"/></div></div></figure><p id="cab5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为项目频率创建数据框架</p><pre class="iy iz ja jb fd ne nf ng nh aw ni bi"><span id="aeda" class="lj ks hi nf b fi nj nk l nl nm">item_count = {}<br/>for col in transaction_df.columns:<br/>    item_count[col] = transaction_df[col].sum()</span><span id="b8cf" class="lj ks hi nf b fi nn nk l nl nm">item_freq_df = pd.DataFrame(data=list(item_count.values()), index=list(item_count.keys()), columns=['frequency']).sort_values(by='frequency', ascending=False)<br/>item_freq_df.shape, item_freq_df.head(10)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nr"><img src="../Images/ac075476cbe25f8a6baf667190c57cdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NTVc6vL-V3etDG_jfqxh0w.png"/></div></div></figure><p id="f63a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">好了，我们有120个独特的项目，让我们检查它们在柱状图中的出现频率，洞察有助于进一步决策。</p><pre class="iy iz ja jb fd ne nf ng nh aw ni bi"><span id="8f85" class="lj ks hi nf b fi nj nk l nl nm">plt.figure(figsize=(16,7))<br/>sns.barplot(y=item_freq_df.index[:10], x=item_freq_df.frequency[:10])<br/>plt.xticks(rotation=90)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ns"><img src="../Images/1dd5334892a3b794deccfd55f4f19da3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bQGgxjwmjiv047-XivoOZw.png"/></div></div></figure><p id="6c8e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">此图仅包含前10项，请不要在您的<em class="ml">笔记本</em>上绘图时设置任何限制。一些有趣的观察(来自完整的情节):</p><ul class=""><li id="c81f" class="mc md hi jq b jr js ju jv jx me kb mf kf mg kj mh mi mj mk bi translated">人们越来越注重健康，比起茶，他们更喜欢绿茶。哦，坚持住..与燕麦片和蔬菜相比，他们消耗更多的意大利面、薯条、巧克力、汉堡、蛋糕和饼干..巧合！！！不，事情就是这样发生的，我们吃很多垃圾食品，试图用绿茶来平衡，我们很聪明😅</li><li id="0e2a" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">在Covid19之前的世界，餐巾纸的需求量并不大。</li></ul><p id="0219" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">好了，言归正传。我们总共有7501个观察值，只有7个项目的频率大于750。这意味着只有7个项目的支持率超过10%。让我们交叉验证:</p><pre class="iy iz ja jb fd ne nf ng nh aw ni bi"><span id="8d0e" class="lj ks hi nf b fi nj nk l nl nm">apriori(transaction_df, min_support=0.1, use_colnames=True)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nt"><img src="../Images/502cc9719f7b2e584ad400de7b244784.png" data-original-src="https://miro.medium.com/v2/resize:fit:382/format:webp/1*uR7N3OW_xtn7TcW917eZ4g.png"/></div></figure><p id="50dc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">那现在怎么办？？好了，现在我们需要决定一些现实的<em class="ml"> min_support </em>只有这样我们才能找到一些有用的关联规则。</p><pre class="iy iz ja jb fd ne nf ng nh aw ni bi"><span id="a4c9" class="lj ks hi nf b fi nj nk l nl nm">print(f’freq&gt;200: {item_freq_df[item_freq_df.frequency&gt;200].shape[0]} items’)<br/>print(f’freq&gt;100: {item_freq_df[item_freq_df.frequency&gt;100].shape[0]} items’)<br/>print(f’freq&gt;50: {item_freq_df[item_freq_df.frequency&gt;50].shape[0]} items’)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nu"><img src="../Images/88c4c58e3617a33d54620229d7bb259c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LeIsjRSQ-JS7EPnN0nApjg.png"/></div></div></figure><p id="bd23" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">看起来如果我们取220个频率限制，那么我们将得到50个独特的项目，这将给出一些体面的支持集。</p><pre class="iy iz ja jb fd ne nf ng nh aw ni bi"><span id="922d" class="lj ks hi nf b fi nj nk l nl nm">pd.set_option(‘display.max_rows’, 15)<br/>freq_itemset_support = apriori(transaction_df, min_support=0.03, use_colnames=True)<br/>freq_itemset_support</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nv"><img src="../Images/6fb4550f006b4c4e48362e8ab8ba2113.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/1*aFKBC8Fgqcuu0JSUuNCxsA.png"/></div></figure><p id="ea2f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">基于20%的最小置信度得分寻找最佳关联规则</p><pre class="iy iz ja jb fd ne nf ng nh aw ni bi"><span id="a8ad" class="lj ks hi nf b fi nj nk l nl nm">overal_association_rules = association_rules(freq_itemset_support, metric="confidence", min_threshold=0.2)<br/>overal_association_rules</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nw"><img src="../Images/4675668502e8e163edf5b0a1b02b03bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4gQZnMv5zGfyLsTv7ZBVTA.png"/></div></div></figure><p id="898a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">好吧，如果以20%作为置信度，关联规则多以矿泉水关联为主。矿泉水已经和大部分产品关联了，我们最好把它排除在交易之外，找出其他有意义的关联规则。</p><pre class="iy iz ja jb fd ne nf ng nh aw ni bi"><span id="2410" class="lj ks hi nf b fi nj nk l nl nm">trans_wo_water_df = transaction_df.drop(columns=['mineral water'])</span><span id="079e" class="lj ks hi nf b fi nn nk l nl nm">freq_itemset_wo_water_supp = apriori(trans_wo_water_df, min_support=0.02, use_colnames=True)<br/>freq_itemset_wo_water_supp</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nx"><img src="../Images/dcd813a21dcc427c4af8764c71bf9176.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*t5TiqwHKb2bk_2TXGFfw1g.png"/></div></figure><pre class="iy iz ja jb fd ne nf ng nh aw ni bi"><span id="d071" class="lj ks hi nf b fi nj nk l nl nm">wo_water_assoc_rules = association_rules(freq_itemset_wo_water_supp, metric=”confidence”, min_threshold=0.2)<br/>wo_water_assoc_rules</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ny"><img src="../Images/0ba534e85797be08727ef29d8ee545da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dNqz1I0PKfhMFUMOBMemJg.png"/></div></div></figure><p id="6cc8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">嗯，让我们先确定一下，然后再取消</p><pre class="iy iz ja jb fd ne nf ng nh aw ni bi"><span id="eccc" class="lj ks hi nf b fi nj nk l nl nm">wo_water_assoc_rules.sort_values('confidence', ascending=False)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nz"><img src="../Images/840a97e388aa093aff7b105d2fc59327.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mpmE4YjPITvzm4wawDOlaw.png"/></div></div></figure><pre class="iy iz ja jb fd ne nf ng nh aw ni bi"><span id="2132" class="lj ks hi nf b fi nj nk l nl nm">wo_water_assoc_rules.sort_values('lift', ascending=False)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oa"><img src="../Images/f1cb4d7e098aa3530ca04082ea89ff09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ACBuPMziRFRF0A-o8lpn2w.png"/></div></div></figure><p id="fbe4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">好了，现在我们看到一些有意义的联想，比如:</p><ul class=""><li id="e2ce" class="mc md hi jq b jr js ju jv jx me kb mf kf mg kj mh mi mj mk bi translated">碎牛肉-&gt;意大利面条</li><li id="0609" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">香草和胡椒-&gt;碎牛肉</li><li id="36a2" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">红酒-&gt;意大利面</li><li id="1ced" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">西红柿-&gt;冷冻蔬菜</li><li id="728a" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">冷冻蔬菜-&gt;意大利面条</li><li id="9587" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">(巧克力，意大利面)-&gt;牛奶</li><li id="ca76" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">汉堡-&gt;鸡蛋</li><li id="d2c9" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">汉堡-&gt;薯条</li><li id="4952" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">煎饼-&gt;薯条</li><li id="eb13" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">牛奶-&gt;巧克力</li><li id="8efc" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">牛奶-&gt;鸡蛋</li><li id="8f45" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">橄榄油-&gt;意大利面条</li></ul><p id="e33f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">还有一些奇怪的联想(至少按照印度人的口味):</p><ul class=""><li id="121f" class="mc md hi jq b jr js ju jv jx me kb mf kf mg kj mh mi mj mk bi translated">牛肉末-&gt;牛奶</li><li id="807e" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">香槟-&gt;巧克力</li><li id="48f4" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">橄榄油-&gt;巧克力</li><li id="6ff1" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">虾-&gt;牛奶</li><li id="1c26" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">绿茶-&gt;薯条</li></ul><p id="92c2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果您已经注意到这些关联规则仍然由几个最常见的产品主导:</p><ul class=""><li id="cda8" class="mc md hi jq b jr js ju jv jx me kb mf kf mg kj mh mi mj mk bi translated">蛋</li><li id="4794" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">意大利式细面条</li><li id="4090" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">巧克力</li><li id="d6cd" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">牛奶</li><li id="0838" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">牛肉糜</li><li id="d1a6" class="mc md hi jq b jr mm ju mn jx mo kb mp kf mq kj mh mi mj mk bi translated">冷冻蔬菜</li></ul><p id="72c2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以进一步缩小范围，基于置信度或lift应用各种过滤器，并生成许多其他关联规则。只是要注意，关联规则的质量依赖于数据的质量，或者我更好地说是数据的真实性。对于实际问题和真实数据集，不能心血来潮简单决定<em class="ml"> min_support </em>和<em class="ml">min _ confidence</em>；这需要一些批判性的思考。然而，你必须从某个地方开始，这就是我试图给你的。稍后我们将探讨<em class="ml">市场篮子差异分析</em>。</p><p id="6d11" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">有任何问题/反馈！随意评论。</p><p id="f2d4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">快乐学习。</p></div></div>    
</body>
</html>