<html>
<head>
<title>Tutorial on development of an AI engine for recommending great short stories</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">推荐优秀短篇小说的人工智能引擎开发教程</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/tutorial-on-development-of-an-ai-engine-for-recommending-great-short-stories-2e136b3afa27?source=collection_archive---------16-----------------------#2019-12-06">https://medium.com/analytics-vidhya/tutorial-on-development-of-an-ai-engine-for-recommending-great-short-stories-2e136b3afa27?source=collection_archive---------16-----------------------#2019-12-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="43c5" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">介绍</h1><p id="b84b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在今天的超数字时代，有多种产品争夺你的注意力，无论是社交网络(脸书、推特、Reddit等)还是电影推荐(网飞、Prime、Hulu)。这些产品的目的都是为了提高您使用产品获得服务的参与度。更多的参与意味着在门户网站上花费更多的时间，这意味着获得订阅、销售定向广告或其他收入机会的可能性更大。提高参与度的关键是根据你是谁、你在哪里、你的个性以及你喜欢或不喜欢什么，为用户提供高度个性化的推荐。技术代理应该为产品提供最佳和个性化的客户旅程，这是事情变得真正有趣的地方。</p><h1 id="5a89" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">推荐引擎</h1><p id="1bf6" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">推荐引擎无处不在，你用于服务的任何好的技术产品很可能都有个性化推荐的成分。以下是几个例子:</p><p id="af67" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">听音乐</strong></p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/9c8e8aea4c2270a26fb5e46cabdcbcf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cWIZDAES1lOW0-OF.png"/></div></div></figure><p id="e540" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">看电视节目</strong></p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ks"><img src="../Images/62c6933161e2461f895c04b931f55332.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VN5W2y4il24ySvNV.jpg"/></div></div></figure><p id="7fe5" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">社交网络</strong></p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kt"><img src="../Images/fd5fc1b55eaf2fe47b215b3f2aeb8310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bIJum9mu41BmnkGu.jpg"/></div></div></figure><p id="a1ab" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这一点以及更多，只要想想你可能正在使用的任何技术服务，它都试图为你提供一种更个性化的产品体验导航路径。他们能够通过使用他们在门户网站上拥有的关于你和其他用户的数据来做到这一点。用户越多，推荐算法就越好。</p><h1 id="056c" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">为什么我们需要一个短篇小说推荐引擎？</h1><p id="9b2f" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在众多基于推荐的产品中(都是付费产品)，我们有音乐、电影、社交网络服务，但对于现场阅读短文，没有可行的替代方案。亚马逊确实有一个很好的推荐引擎来推荐下一步该读什么，但它只推荐一本书或选集，而不是短文、故事、散文等。这个项目的想法是在根据用户的喜好和偏好推荐下一个最佳短文阅读的同时，增强短文内容的阅读。</p><h1 id="fa6b" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated"><strong class="ak">一个名为readnet的短篇小说免费阅读门户</strong></h1><p id="9c96" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们开发了readnet这个门户网站，任何人都可以去那里免费阅读一些著名作家的精彩散文。该网络应用还会根据用户当前可能正在阅读的短篇小说推荐其他短篇小说。用户之旅就像下面三点一样简单:</p><ol class=""><li id="5209" class="ku kv hi jf b jg kb jk kc jo kw js kx jw ky ka kz la lb lc bi translated">用户访问web应用程序</li></ol><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ld"><img src="../Images/6eaa9998b97036b2dd36f5f7b40627f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yNEhQNEJuwutwGAwRtsrSA.png"/></div></div></figure><p id="1511" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">2.用户可以选择六个短篇故事，开始他们的阅读冒险</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es le"><img src="../Images/5ec93073ec78859c28c61db0b3fea685.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*1_6Q92yp7xNYof6Mta7PaQ.gif"/></div></figure><p id="8dde" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">3.一旦用户选择了一个用户可能喜欢的故事，就会有一个选项来获得更多的推荐故事</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es le"><img src="../Images/69b4b89ceae85c08f9f72d12f616b4ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*083hcOrGkzknhk5UXimNaw.gif"/></div></figure><p id="8316" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">从用户体验的角度来看，这是一个非常简单的工作流，但在后端，当它被开发时，有大量的智能被开发出来，我们现在将研究这些智能。</p><h1 id="068c" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">我们是如何开发Readnet的？</h1><p id="1393" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">开发过程包括以下步骤:</p><ol class=""><li id="15f2" class="ku kv hi jf b jg kb jk kc jo kw js kx jw ky ka kz la lb lc bi translated">内容集合</li><li id="6d1f" class="ku kv hi jf b jg lf jk lg jo lh js li jw lj ka kz la lb lc bi translated">推荐算法的发展</li><li id="ebbc" class="ku kv hi jf b jg lf jk lg jo lh js li jw lj ka kz la lb lc bi translated">创建用于报道和推荐的源数据库</li><li id="1b0e" class="ku kv hi jf b jg lf jk lg jo lh js li jw lj ka kz la lb lc bi translated">为读者提供文本和推荐的后端API开发</li><li id="95f0" class="ku kv hi jf b jg lf jk lg jo lh js li jw lj ka kz la lb lc bi translated">前端用户界面开发，提供良好的用户阅读体验</li><li id="d33d" class="ku kv hi jf b jg lf jk lg jo lh js li jw lj ka kz la lb lc bi translated">在Heroku平台上部署web应用程序</li></ol><h2 id="0d7c" class="lk ig hi bd ih ll lm ln il lo lp lq ip jo lr ls it js lt lu ix jw lv lw jb lx bi translated">步骤1:内容收集</h2><p id="1aff" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">readnet上的所有短篇故事都是免费的，因为这是我们可以让用户免费使用的唯一方法。最大的免费版权书籍和故事库之一是<a class="ae ly" href="https://www.gutenberg.org/" rel="noopener ugc nofollow" target="_blank">https://www.gutenberg.org/</a>(古腾堡计划)。<strong class="jf hj">你能在网站上找到的所有内容都摘自古腾堡计划(请考虑向这个杰出的计划捐赠一小笔</strong><a class="ae ly" href="https://www.gutenberg.org/wiki/Gutenberg:Project_Gutenberg_Needs_Your_Donation" rel="noopener ugc nofollow" target="_blank"><strong class="jf hj"/></a><strong class="jf hj">)。</strong></p><p id="9858" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">手头的任务是浏览古腾堡网站上超过64K的电子书/故事，并找出短篇故事用于readnet推荐引擎。我在http://www.gutenberg.org/ebooks/search/?query=Short+Stories找到了大量短篇小说集</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lz"><img src="../Images/91fba05c58419650b13b6a2ca47c0977.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1n1-OvOzz7XOOH9p7Tefyw.png"/></div></div></figure><p id="e3d1" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">现在，我们知道从哪里可以获得我们需要的短篇故事，将它们提取到文件中，用于文本处理和web应用程序的开发。通过使用python中令人惊叹的漂亮的汤库，这很容易做到。首先，我们在webapp上获得我们想要的短篇故事的链接</p><pre class="kh ki kj kk fd ma mb mc md aw me bi"><span id="4b97" class="lk ig hi mb b fi mf mg l mh mi">/*Get the list of short stories*/<br/>while n&lt;1000:<br/>    url = f"<a class="ae ly" href="http://www.gutenberg.org/ebooks/search/?query=Short+Stories&amp;start_index={n" rel="noopener ugc nofollow" target="_blank">http://www.gutenberg.org/ebooks/search/?query=Short+Stories&amp;start_index={n</a>}"<br/>    page = requests.get(url)    <br/>    data = page.text<br/>    soup = BeautifulSoup(data)<br/>    for link in soup.find_all('a'):<br/>        List.append(link.get('href'))</span><span id="5ba5" class="lk ig hi mb b fi mj mg l mh mi">/*Get the urls for the corresponding short stories*/</span><span id="e086" class="lk ig hi mb b fi mj mg l mh mi">from bs4 import BeautifulSoup, SoupStrainer<br/>import pandas as pd<br/>import requests<br/>url_download=[]<br/>url=f"<a class="ae ly" href="http://www.gutenberg.org/files/" rel="noopener ugc nofollow" target="_blank">http://www.gutenberg.org/files/</a>"<br/>df=pd.read_csv('ID_shortstories2.csv')<br/>Ids=list(df['ID_shortstories'])</span><span id="910f" class="lk ig hi mb b fi mj mg l mh mi">for Id in Ids:<br/>    url2=url+str(Id)+'/'<br/>    page = requests.get(url2)    <br/>    data = page.text<br/>    soup = BeautifulSoup(data)<br/>    zips=[]<br/>    for link in soup.find_all('a'):<br/>        <br/>        if link.get('href').endswith('.txt'):<br/>            zips.append(link.get('href'))<br/>    if len(zips)==0:<br/>        print("The ID {} has no txt".format(Id))<br/>    else:<br/>        url3=url2+zips[0]<br/>        #print(url3)<br/>        url_download.append(url3)</span></pre><p id="f367" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">接下来，我们将所有短篇小说提取到单独的文本文档中。</p><pre class="kh ki kj kk fd ma mb mc md aw me bi"><span id="54e2" class="lk ig hi mb b fi mf mg l mh mi">import os<br/>import urllib.request<br/>check=[]</span><span id="f2b0" class="lk ig hi mb b fi mj mg l mh mi">DOWNLOADS_DIR = 'books/'</span><span id="1994" class="lk ig hi mb b fi mj mg l mh mi"># For every line in the file<br/>for url in open('links.txt'):<br/>    # Split on the rightmost / and take everything on the right side of that<br/>   # name2=os.path.split(url)[-1]<br/>    #name2=os.path.split(urllib.parse.urlparse(url).path)[-1]<br/>    #print(name2)<br/>    name = url.split('/')[-1]<br/>    name2=name.split(sep='txt')[0]<br/>    name3=name2+'txt'<br/>    #print(name)</span><span id="4051" class="lk ig hi mb b fi mj mg l mh mi"># Combine the name and the downloads directory to get the local filename<br/>    filename = os.path.join(DOWNLOADS_DIR, name3)<br/>    print(filename)<br/>    <br/>    # Download the file if it does not exist<br/>    if not os.path.isfile(filename):<br/>        <br/>        print(url)<br/>        urllib.request.urlretrieve(f"{url}",f"{filename}")</span></pre><p id="bdf1" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">现在我们将获得我们提取的短篇小说的标题、作者和语言</p><pre class="kh ki kj kk fd ma mb mc md aw me bi"><span id="2d1b" class="lk ig hi mb b fi mf mg l mh mi">import os</span><span id="9789" class="lk ig hi mb b fi mj mg l mh mi">bookno=[]<br/>Title=[]<br/>Author=[]<br/>Language=[]<br/>for a in os.listdir(path='books'):<br/>    if a.endswith('.txt'):</span><span id="deae" class="lk ig hi mb b fi mj mg l mh mi">with open(f"books/{a}",'r',errors='ignore') as f:</span><span id="7511" class="lk ig hi mb b fi mj mg l mh mi">Title1=[]<br/>            Author1=[]<br/>            Language1=[]<br/>            for line in f:</span><span id="b238" class="lk ig hi mb b fi mj mg l mh mi">y=line.split()<br/>                #raise Exception("The files is {}".format(f))<br/>                #print(len(y))<br/>                #if y[1]=='Title:':<br/>                if (len(y)&gt;0 and y[0]=='Title:'):<br/>                     Title1=y.copy()<br/>                if (len(y)&gt;0 and y[0]=='Author:'):<br/>                    Author1=y.copy()<br/>                if (len(y)&gt;0 and y[0]=='Language:'):<br/>                    Language1=y.copy()</span><span id="2881" class="lk ig hi mb b fi mj mg l mh mi">bookno.append(a)<br/>        Title.append(Title1)<br/>        Author.append(Author1)<br/>        Language.append(Language1)</span></pre><p id="a63b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">最后，我们将所有内容放入熊猫数据框，以便于可视化和分析</p><pre class="kh ki kj kk fd ma mb mc md aw me bi"><span id="f8f7" class="lk ig hi mb b fi mf mg l mh mi">import pandas as pd<br/>db_books=pd.DataFrame()<br/>db_books['bookno']=bookno</span><span id="7c98" class="lk ig hi mb b fi mj mg l mh mi"># db_books['Title']=[T for T in Title if T!='Title:' ]<br/># db_books['Author']=[A for A in Author if A!='Author']<br/># db_books['Language']=[L for L in Language if L!='Language']</span><span id="b968" class="lk ig hi mb b fi mj mg l mh mi">db_books['Title']=[' '.join(T) for T in Title]<br/>db_books['Author']=[' '.join(A) for A in Author]<br/>db_books['Language']=[' '.join(L) for L in Language]</span></pre><p id="5a24" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">现在，通过一些简单的编辑和检查，我们已经准备好了我们的源数据。</p><h2 id="eb7f" class="lk ig hi bd ih ll lm ln il lo lp lq ip jo lr ls it js lt lu ix jw lv lw jb lx bi translated">步骤2:开发推荐算法</h2><p id="fe04" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们将使用的推荐算法是一种无监督模型，它基于两个文本的相似程度，分配相应的相似性指数。这里有两个子流程，首先我们将对应短篇小说的所有文本转换成<a class="ae ly" href="http://www.tfidf.com/" rel="noopener ugc nofollow" target="_blank"> TFIDF </a>(词频-逆文档频)。我们需要这样做，因为算法/数学只能在数学或矢量表示上进行交互。</p><pre class="kh ki kj kk fd ma mb mc md aw me bi"><span id="aa05" class="lk ig hi mb b fi mf mg l mh mi">from sklearn.feature_extraction.text import  TfidfVectorizer<br/>from sklearn.feature_extraction import text<br/>my_stop_words = text.ENGLISH_STOP_WORDS.union(['gutenberg','ebook','online','distributed','transcriber','etext','note','copyright',"start",'project','end','produced','proofreading','team','http','www','pgdp','net','illustrated'])</span><span id="84c9" class="lk ig hi mb b fi mj mg l mh mi">vectorizer=TfidfVectorizer(stop_words=my_stop_words)<br/>vectorizer.fit(stories['content'])</span><span id="9541" class="lk ig hi mb b fi mj mg l mh mi">X_vector=vectorizer.transform(stories['content'])</span></pre><p id="83c6" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">接下来，基于两个文本有多相似(<a class="ae ly" href="https://www.sciencedirect.com/topics/computer-science/cosine-similarity" rel="noopener ugc nofollow" target="_blank">余弦相似度</a>)，我们将分配各自的等级。比如有哪些和故事A相似的top5短篇等等。</p><pre class="kh ki kj kk fd ma mb mc md aw me bi"><span id="91c2" class="lk ig hi mb b fi mf mg l mh mi">from sklearn.metrics.pairwise import cosine_similarity<br/>similarity_matrix=cosine_similarity(X_vector)</span></pre><p id="0364" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">步骤3:创建用于提供报道和推荐的源数据库</strong></p><p id="5eb7" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">现在，我们有了短篇小说及其元数据(作者、语言、标题)以及哪些故事彼此最相似，现在我们需要将它们全部存储到一个数据库中，可以通过我们的web应用程序进行查询。我使用的是Postgres数据库，但根据开发人员的喜好，也可以使用任何其他RDBMS。</p><pre class="kh ki kj kk fd ma mb mc md aw me bi"><span id="4286" class="lk ig hi mb b fi mf mg l mh mi">/*First the metadata*/</span><span id="cfc2" class="lk ig hi mb b fi mj mg l mh mi"><br/>from sqlalchemy import create_engine<br/>engine = create_engine('postgresql:///stories')</span><span id="93cf" class="lk ig hi mb b fi mj mg l mh mi">db_books.to_sql("metadata", engine,if_exists='append',index=False)</span><span id="7050" class="lk ig hi mb b fi mj mg l mh mi">/*Then the stories*/<br/>stories.to_sql("short_stories", engine,if_exists='append',index=False)</span></pre><p id="6323" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">除此之外，我们还需要另一个表，我们将其命名为recos，其中每个文本(短篇小说)都有前五个相似的文本。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es mk"><img src="../Images/8452e9a8fae11948e37646543c9597ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*qd2E3yQxP_m3GFlaocNcrQ.png"/></div></figure><h2 id="5166" class="lk ig hi bd ih ll lm ln il lo lp lq ip jo lr ls it js lt lu ix jw lv lw jb lx bi translated">步骤4:为读者提供文本和推荐的后端API开发</h2><p id="8b27" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在我们有了制造产品的所有肉。我们有:</p><ol class=""><li id="f05e" class="ku kv hi jf b jg kb jk kc jo kw js kx jw ky ka kz la lb lc bi translated">短篇小说的正文</li><li id="c06c" class="ku kv hi jf b jg lf jk lg jo lh js li jw lj ka kz la lb lc bi translated">我们有故事的元数据</li><li id="d8bb" class="ku kv hi jf b jg lf jk lg jo lh js li jw lj ka kz la lb lc bi translated">我们对每个短篇故事都有5个最佳推荐</li></ol><p id="decf" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">我们现在需要开发一个基于前端用户交互的API，从产品的角度推送所需的文本和数据。我们将使用flask，这是一个非常好的微框架，可以快速开发和服务产品的后端。下面是一个完整的代码，告诉你如何开发它</p><pre class="kh ki kj kk fd ma mb mc md aw me bi"><span id="1173" class="lk ig hi mb b fi mf mg l mh mi">import os</span><span id="1fd1" class="lk ig hi mb b fi mj mg l mh mi">from flask import Flask, session,render_template,request,session,redirect,url_for,escape,flash</span><span id="1ba2" class="lk ig hi mb b fi mj mg l mh mi">from flask_session import Session</span><span id="6138" class="lk ig hi mb b fi mj mg l mh mi">from werkzeug import check_password_hash, generate_password_hash</span><span id="23d3" class="lk ig hi mb b fi mj mg l mh mi">from itsdangerous import URLSafeTimedSerializer</span><span id="8d9f" class="lk ig hi mb b fi mj mg l mh mi">from sqlalchemy import create_engine</span><span id="fc48" class="lk ig hi mb b fi mj mg l mh mi">from sqlalchemy.orm import scoped_session, sessionmaker</span><span id="5996" class="lk ig hi mb b fi mj mg l mh mi">import requests</span><span id="de4c" class="lk ig hi mb b fi mj mg l mh mi">import os</span><span id="4f83" class="lk ig hi mb b fi mj mg l mh mi">import pandas as pd</span><span id="2096" class="lk ig hi mb b fi mj mg l mh mi">import time</span><span id="7d9b" class="lk ig hi mb b fi mj mg l mh mi"># Set up database</span><span id="b20b" class="lk ig hi mb b fi mj mg l mh mi">engine = create_engine(os.getenv("DATABASE_URL"))</span><span id="f220" class="lk ig hi mb b fi mj mg l mh mi">db = scoped_session(sessionmaker(bind=engine))</span><span id="6855" class="lk ig hi mb b fi mj mg l mh mi">app = Flask(__name__)</span><span id="30e8" class="lk ig hi mb b fi mj mg l mh mi"># Set the secret key to some random bytes. Keep this really secret!</span><span id="d46b" class="lk ig hi mb b fi mj mg l mh mi">app.secret_key ='#######'</span><span id="1087" class="lk ig hi mb b fi mj mg l mh mi">Security_password_salt='########'</span><span id="26f7" class="lk ig hi mb b fi mj mg l mh mi">@app.route("/",methods=["GET","POST"])</span><span id="37b1" class="lk ig hi mb b fi mj mg l mh mi">def home():</span><span id="b3ef" class="lk ig hi mb b fi mj mg l mh mi">stories=db.execute("select metadata.bookno,metadata.title,metadata.author,short_stories.content from metadata LEFT JOIN short_stories on metadata.bookno=short_stories.bookno order by random() LIMIT 6").fetchall()</span><span id="c9af" class="lk ig hi mb b fi mj mg l mh mi">return render_template("index.html",story=stories)</span><span id="0f7b" class="lk ig hi mb b fi mj mg l mh mi">@app.route("/recommendations",methods=["GET","POST"])</span><span id="a48b" class="lk ig hi mb b fi mj mg l mh mi">def reco():</span><span id="eb7b" class="lk ig hi mb b fi mj mg l mh mi">bookno=request.form.get("bookno")</span><span id="5202" class="lk ig hi mb b fi mj mg l mh mi"># return bookno</span><span id="1e7b" class="lk ig hi mb b fi mj mg l mh mi">recos=db.execute("select * from recos where bookno=:bookno",{'bookno':bookno}).fetchone()</span><span id="c0ad" class="lk ig hi mb b fi mj mg l mh mi">reco1=db.execute("select metadata.bookno,metadata.title,metadata.author,short_stories.content from metadata LEFT JOIN short_stories on metadata.bookno=short_stories.bookno  where metadata.bookno=:bookno",{'bookno':recos.first_reco}).fetchone()</span><span id="d9c1" class="lk ig hi mb b fi mj mg l mh mi">reco2=db.execute("select metadata.bookno,metadata.title,metadata.author,short_stories.content from metadata LEFT JOIN short_stories on metadata.bookno=short_stories.bookno  where metadata.bookno=:bookno",{'bookno':recos.second_reco}).fetchone()</span><span id="c357" class="lk ig hi mb b fi mj mg l mh mi">reco3=db.execute("select metadata.bookno,metadata.title,metadata.author,short_stories.content from metadata LEFT JOIN short_stories on metadata.bookno=short_stories.bookno  where metadata.bookno=:bookno",{'bookno':recos.third_reco}).fetchone()</span><span id="6230" class="lk ig hi mb b fi mj mg l mh mi">reco4=db.execute("select metadata.bookno,metadata.title,metadata.author,short_stories.content from metadata LEFT JOIN short_stories on metadata.bookno=short_stories.bookno  where metadata.bookno=:bookno",{'bookno':recos.fourth_reco}).fetchone()</span><span id="99fb" class="lk ig hi mb b fi mj mg l mh mi">reco5=db.execute("select metadata.bookno,metadata.title,metadata.author,short_stories.content from metadata LEFT JOIN short_stories on metadata.bookno=short_stories.bookno  where metadata.bookno=:bookno",{'bookno':recos.fifth_reco}).fetchone()</span><span id="8f7e" class="lk ig hi mb b fi mj mg l mh mi">return render_template("recommend.html",reco1=reco1,reco2=reco2,reco3=reco3,reco4=reco4,reco5=reco5)</span><span id="494c" class="lk ig hi mb b fi mj mg l mh mi"># reco2=db.execute("select * from metadata where bookno=:bookno",{'bookno':recos.second_reco}).fetchone()</span><span id="a7c7" class="lk ig hi mb b fi mj mg l mh mi"># reco3=db.execute("select * from metadata where bookno=:bookno",{'bookno':recos.third_reco}).fetchone()</span><span id="30c0" class="lk ig hi mb b fi mj mg l mh mi"># reco4=db.execute("select * from metadata where bookno=:bookno",{'bookno':recos.fourth_reco}).fetchone()</span><span id="35ca" class="lk ig hi mb b fi mj mg l mh mi"># reco5=db.execute("select * from metadata where bookno=:bookno",{'bookno':recos.fifth_reco}).fetchone()</span><span id="2c45" class="lk ig hi mb b fi mj mg l mh mi"># return render_template("recommend.html",reco1=reco1,reco2=reco2,reco3=reco3,reco4=reco4,reco5=reco5)</span></pre><h2 id="bd65" class="lk ig hi bd ih ll lm ln il lo lp lq ip jo lr ls it js lt lu ix jw lv lw jb lx bi translated">步骤5:开发前端用户界面以获得良好的用户阅读体验</h2><p id="a2bd" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果你像我一样，主要是一名数据科学家，而不是前端或产品人员，你很可能不熟悉前端设计如何工作的细节，以及围绕它的最佳实践是什么。在当今这个快速专业化的时代，拥有一套T型技能总是更好，一些HTML、CSS和Javascript的基础知识真的很有用。有一些奇妙的框架让我们的生活变得非常简单，比如Bootstrap(【https://getbootstrap.com/】<a class="ae ly" href="https://getbootstrap.com/" rel="noopener ugc nofollow" target="_blank"/>)。因为我们只是在开发一个原型，所以使用Bootstrap来快速投放市场比在前端开发上花费大量时间要有用得多。我们将使用一个非常流行的模板称为自由职业者模板。只需将模板从git克隆到您的本地，并针对您的版本进行所需的更改(<a class="ae ly" href="https://github.com/BlackrockDigital/startbootstrap-freelancer" rel="noopener ugc nofollow" target="_blank">https://github . com/black rock digital/start bootstrap-freelancer</a>)。需要的主要变化是在模板中。我有两个HTML文件，一个用于登录页面，另一个用于推荐。</p><h2 id="0751" class="lk ig hi bd ih ll lm ln il lo lp lq ip jo lr ls it js lt lu ix jw lv lw jb lx bi translated">步骤6:在Heroku平台上部署web应用程序</h2><p id="cf59" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在，您已经在您的个人机器上准备好了产品，包括一个数据库、一个基于flask代码的API和一个使用Bootstrap4开发的前端。现在，您可能希望将它部署在全世界面前，以便任何拥有可访问互联网的计算设备的人都能够连接到它并开始阅读。有多种平台可供使用，如Heroku、Pythonanywhere、Digital Ocean等。我们已经使用了Heroku，但是您可以随意使用任何您觉得合适的平台。只要您为项目的python环境创建了requirement.txt文件，就可以直接点击了。以下是使用Heroku用户界面的简单步骤:</p><ol class=""><li id="0261" class="ku kv hi jf b jg kb jk kc jo kw js kx jw ky ka kz la lb lc bi translated">登录Heroku</li><li id="326b" class="ku kv hi jf b jg lf jk lg jo lh js li jw lj ka kz la lb lc bi translated">创建新项目</li><li id="7c1c" class="ku kv hi jf b jg lf jk lg jo lh js li jw lj ka kz la lb lc bi translated">使用Github作为部署方法</li><li id="1598" class="ku kv hi jf b jg lf jk lg jo lh js li jw lj ka kz la lb lc bi translated">将数据库从本地迁移到Heroku</li><li id="51bc" class="ku kv hi jf b jg lf jk lg jo lh js li jw lj ka kz la lb lc bi translated">部署项目</li></ol><h2 id="60a7" class="lk ig hi bd ih ll lm ln il lo lp lq ip jo lr ls it js lt lu ix jw lv lw jb lx bi translated"><strong class="ak">最终想法</strong></h2><p id="c2a9" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">简单地说，以上五个步骤总结了如何从零开始快速开发一个非常有用的推荐引擎。可以在这些方面尝试的其他增强是，您可以使用Travis CI或类似工具开发CI/CD管道，以快速增强产品并进行测试。</p><p id="1703" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">感谢您抽出时间阅读本文！祝你一切顺利。</p></div></div>    
</body>
</html>