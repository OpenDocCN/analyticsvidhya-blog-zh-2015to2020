<html>
<head>
<title>Dealing with Dates in Pyspark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Pyspark中处理日期</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/dealing-with-dates-in-pyspark-a0f7d789c1fd?source=collection_archive---------5-----------------------#2020-08-23">https://medium.com/analytics-vidhya/dealing-with-dates-in-pyspark-a0f7d789c1fd?source=collection_archive---------5-----------------------#2020-08-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9082" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我在《火花深潜》中的一个故事</p><h2 id="6497" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated"><a class="ae jy" rel="noopener" href="/@somanathsankaran">https://medium.com/@somanathsankaran</a></h2><p id="f823" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">作为一名数据工程师，最常见的用例是调整各种来源的数据。</p><p id="203d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇博客中，我们将看到以下内容</p><ol class=""><li id="4901" class="ke kf hi ih b ii ij im in iq kg iu kh iy ki jc kj kk kl km bi translated">从一种日期形式转换到另一种日期形式</li><li id="7a75" class="ke kf hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">从一种时间戳格式转换为另一种格式</li><li id="c041" class="ke kf hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">每月、每周汇总数据</li></ol><blockquote class="ks kt ku"><p id="61dc" class="if ig kv ih b ii ij ik il im in io ip kw ir is it kx iv iw ix ky iz ja jb jc hb bi translated"><strong class="ih hj"> Spark默认假设日期为“YYYY-MM-DD”(2020–08–22)</strong></p></blockquote><h2 id="e6e4" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">从一种日期形式转换到另一种日期形式。</h2><p id="3eab" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated"><strong class="ih hj">第一步:将日期转换成标准格式</strong></p><p id="b69c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们从源系统获得的数据可能不符合如下所示的要求格式，这是很常见的，明智的做法是将数据作为字符串加载，因为作为日期加载会导致数据丢失。</p><figure class="la lb lc ld fd le er es paragraph-image"><div class="er es kz"><img src="../Images/e3c89c918a1c32fa6c081dc0bc8b0f2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*Pa-K0VoMkwK1OZlFAng9rg.png"/></div><figcaption class="lh li et er es lj lk bd b be z dx translated">无格式日期</figcaption></figure><blockquote class="ks kt ku"><p id="425d" class="if ig kv ih b ii ij ik il im in io ip kw ir is it kx iv iw ix ky iz ja jb jc hb bi translated">因此，为了将其转换为标准日期格式，我们必须使用<strong class="ih hj"> to_date </strong>函数，该函数接受字符串列和日期所在的格式</p></blockquote><p id="c337" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的例子中是“dd-MM-YYYY”</p><blockquote class="ks kt ku"><p id="0848" class="if ig kv ih b ii ij ik il im in io ip kw ir is it kx iv iw ix ky iz ja jb jc hb bi translated"><em class="hi">df _ date = df . select(f . to _ date(" dt "，" dd-MM-YYYY ")。别名(" date _ formatted ")</em></p></blockquote><figure class="la lb lc ld fd le er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es ll"><img src="../Images/f6af861236403fb4f117dde65b0576be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*SbNRBuvE3ajstAkM2bzqkQ.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">使用to_date转换为date</figcaption></figure><h2 id="82c6" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">第二步:转换成想要的格式:</h2><blockquote class="ks kt ku"><p id="3007" class="if ig kv ih b ii ij ik il im in io ip kw ir is it kx iv iw ix ky iz ja jb jc hb bi translated">我们可以使用date_format函数转换到所需的格式，该函数接受2个参数的日期字段和需要显示的格式，即“YYYY/MM/dd HH:mm:ss”</p></blockquote><blockquote class="lq"><p id="8a40" class="lr ls hi bd lt lu lv lw lx ly lz jc dx translated">注意:因为它不是spark日期格式，所以它的数据类型是string</p></blockquote><figure class="mb mc md me mf le er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es ma"><img src="../Images/4026eb7b9a10a3ec9f376543a7c886e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gF-dx97vzi_f39jejkK0rg.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">字符串形式的转换日期</figcaption></figure><p id="77e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">从一种时间戳格式转换为另一种格式</strong></p><p id="13e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与to_date类似，spark必须将to_timestamp转换成时间戳，然后我们就可以利用日期格式来转换我们需要的任何时间戳格式</p><figure class="la lb lc ld fd le er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mg"><img src="../Images/afcdadb8b85c08e6fe8fbf7c95ad9d69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IiLoEzPv6okPi8da8Xxwkw.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">转换时间戳</figcaption></figure><h2 id="eeb2" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated"><strong class="ak">每月、每周汇总数据</strong></h2><p id="20f4" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">这是一个常见的用例，我们可能需要在每月、每周等级别进行聚合，因为我们可以在spark中截断函数</p><blockquote class="ks kt ku"><p id="3d64" class="if ig kv ih b ii ij ik il im in io ip kw ir is it kx iv iw ix ky iz ja jb jc hb bi translated">例如，我们将考虑8月23日、24日、25日这三个日期，其中23日、24日在8月24日这一周(假设这一周从周一开始)，我们将按周进行求和</p></blockquote><figure class="la lb lc ld fd le er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mh"><img src="../Images/f228a0b0543c50c5ece1cde9fb72d10b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z4MiJjmjd13w5HPygFdOFQ.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">使用trunc函数将日期转换为周的开始</figcaption></figure><p id="f921" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们将汇总数据，并创建每月和每周的报告</p><figure class="la lb lc ld fd le er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mi"><img src="../Images/741a60a3301f33c01b3752aeb15fa36e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p0-PPfAhr0HOl2f7dwV82g.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">每周和每月的销售数量</figcaption></figure><p id="7a89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，在这篇博客中，我们学习了如何将数据从一种格式转换成另一种格式，以及如何每周进行汇总</p><p id="fb76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Github链接:<a class="ae jy" href="https://github.com/SomanathSankaran/spark_medium/tree/master/spark_csv" rel="noopener ugc nofollow" target="_blank">https://github . com/SomanathSankaran/spark _ medium/tree/master/spark _ CSV</a></p><p id="979a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"/></p></div></div>    
</body>
</html>