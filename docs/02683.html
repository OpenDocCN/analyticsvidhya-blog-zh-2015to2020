<html>
<head>
<title>Deploying a Python App to Heroku — AtoZ in 15 Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用15个步骤将Python应用程序部署到Heroku-AtoZ</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploying-a-python-app-to-heroku-atoz-in-15-steps-8e526f24c76f?source=collection_archive---------17-----------------------#2019-12-28">https://medium.com/analytics-vidhya/deploying-a-python-app-to-heroku-atoz-in-15-steps-8e526f24c76f?source=collection_archive---------17-----------------------#2019-12-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div class="er es hg"><img src="../Images/582e7353fd592d18f7b97bbec2b3f2fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*-1DQmBYwYrTUBess8PJ-Ow.png"/></div></figure><div class=""/><p id="94e3" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hq">目标:</strong>在您的本地机器上成功开发了一个python应用程序后，您希望将其托管在web上，以便通过公共URL进行查看/共享。</p><p id="4e91" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hq">背景:</strong>几周前，我制作了一个简单的python仪表盘，从Google BigQuery上的OpenAQ数据集获取实时空气质量数据，并将其可视化在地图上……类似这样:</p><figure class="jl jm jn jo fd hk er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jk"><img src="../Images/9d0e87656563f8d30d25d3fb563a1be3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SZYUH-HkeJnGcfxmemMIJw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">一氧化碳(CO)污染水平的世界地图，作为OpenAQ计划的一部分，在1500多个空气质量站进行测量。</figcaption></figure><p id="e54f" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">该脚本(用python版本3.6.8编写)使用了来自<em class="jx"> bigquery </em>库的模块来访问/查询数据集，<em class="jx">follow</em>包来制作交互式传单地图，以及<em class="jx"> panel </em>库来生成仪表板(我将在另一篇文章中详细讨论该脚本)。在您的计算机上生成这个仪表板很容易:您下载python脚本(或者从GitHub存储库中克隆它)，安装所需的库和依赖项，然后运行脚本…瞧！控制面板显示在本地主机的浏览器窗口中(例如，<a class="ae jy" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000/ </a>)。现在，假设您想从另一台计算机远程查看这个仪表板，或者向朋友展示它。听起来很简单，对吧？！嗯……不太好。如果你是一个R用户，你可能会遇到RStudio team的Shiny，这是一个简单易用的软件包，用于直接从R创建交互式web应用程序。然而，对于像我这样的生态系统新手来说，python中的过程并不那么简单。</p><blockquote class="jz ka kb"><p id="c5fb" class="im in jx io b ip iq ir is it iu iv iw kc iy iz ja kd jc jd je ke jg jh ji jj hb bi translated">您需要的是一种在web上托管您的python代码并获得一个公共URL的方法，使您能够查看/共享您的工作。如果你不知道如何去做，你和我当时的处境一样，这篇文章就是为你写的！</p></blockquote><p id="0e16" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">有许多平台可以托管python脚本，Heroku就是其中之一。Salesforce拥有的Heroku是一个云平台即服务(PaaS ),支持许多编程语言(包括python ),并且对于我们在这里要做的事情(即实验)是免费的。</p><p id="4f0c" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下面是我按照本文中的步骤创建的web应用程序的链接:<a class="ae jy" href="https://frozen-journey-90261.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://frozen-journey-90261.herokuapp.com/</a></p></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="9705" class="km kn hp bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">按照以下步骤将您的python应用程序部署到Heroku:</h1><p id="df7c" class="pw-post-body-paragraph im in hp io b ip lk ir is it ll iv iw ix lm iz ja jb ln jd je jf lo jh ji jj hb bi translated"><strong class="io hq">先决条件:</strong>确保<em class="jx"> Git </em>已经安装在您的计算机上，并且您已经对从您的命令shell(也就是mac上的终端)使用<em class="jx"> Git </em>有了基本的了解。我已经在mac电脑上测试了这些步骤，但我认为这个过程对pc用户来说是相似的。</p><ol class=""><li id="b9b5" class="lp lq hp io b ip iq it iu ix lr jb ls jf lt jj lu lv lw lx bi translated"><a class="ae jy" href="https://devcenter.heroku.com/articles/getting-started-with-python" rel="noopener ugc nofollow" target="_blank">Heroku</a>入门:创建一个免费的Heroku账户并设置Postgress(如果你打算在本地运行该应用，这是必需的——推荐！).</li><li id="ecdb" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">安装Heroku命令行界面(CLI)。对于macOS用户，您只需下载并运行<a class="ae jy" href="https://cli-assets.heroku.com/heroku.pkg" rel="noopener ugc nofollow" target="_blank">安装程序</a>。一旦安装完毕，您就可以从您的命令shell中使用<code class="du md me mf mg b">heroku</code>命令。</li><li id="92b3" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">打开命令shell并使用<code class="du md me mf mg b">heroku login</code>命令登录Heroku CLI。该命令打开您的web浏览器，进入Heroku登录页面。如果您的浏览器已经登录Heroku，只需点击页面上显示的<strong class="io hq"> <em class="jx">登录</em> </strong>按钮。为了使<code class="du md me mf mg b">heroku</code>和<code class="du md me mf mg b">git</code>命令正常工作，这种认证是必需的。</li><li id="8f24" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">为您的应用程序创建一个新目录(这将是您的应用程序的根目录)。</li><li id="ef5e" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">在Heroku <code class="du md me mf mg b">heroku create</code>上创建一个应用程序，让Heroku准备好接收你的源代码。这提供了一个随机生成的应用程序名称和URL，以及一个与您的项目相关联的git remote。</li><li id="b445" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">初始化git repo <code class="du md me mf mg b">git init</code>，并将Heroku git repo添加到遥控器<code class="du md me mf mg b">heroku git:remote -a &lt;app name&gt;</code></li><li id="aa51" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">创建一个虚拟环境* <code class="du md me mf mg b">python -m venv venv/</code> <br/> *这是一个很重要的步骤，但有时人们会忽略它！当您编写代码时，您需要许多模块/库来运行它。当您在本地运行应用程序时，这是可以的，但当您在服务器上部署python应用程序时，您需要确保包含所有依赖项，否则您的代码将无法运行(通常是由于缺少或过期的模块/库)。创建一个虚拟环境可以防止这样的问题，并为您节省大量时间，我将在下面解释原因。</li><li id="5dd8" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">不要忘记激活虚拟环境<code class="du md me mf mg b">source venv/bin/activate</code>，现在提示将以<em class="jx"> (venv) … </em>开始</li><li id="8b2a" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">包括python脚本(。py或者。ipynb文件扩展名)和目录中的其他必需文件(如凭证json文件)。</li><li id="d6d9" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">安装您的代码运行<code class="du md me mf mg b">pip install &lt;python library&gt;</code> <br/>所需的所有库因为您在虚拟环境中，所以您需要安装您的代码所需的所有<strong class="io hq"><em class="jx"/></strong>库。这确保您包含了所有正确版本的内容。</li><li id="27dd" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">确保应用程序与安装在<em class="jx"> venv </em>中的库一起工作，并且没有遗漏任何依赖项。现在，运行下面的代码，它在应用程序<code class="du md me mf mg b">pip freeze &gt; requirements.txt</code>的根目录下的一个新文件<strong class="io hq"> requirements.txt </strong>中捕获所有需要的库</li><li id="ebda" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">(可选)Heroku设置可以接受额外的信息，如凭据。例如，在我的脚本中，我需要google凭证来访问BigQuery数据集，因此要将它包含在部署中:<br/> <code class="du md me mf mg b">heroku config:set GOOGLE_APPLICATION_CREDENTIALS=’&lt;filename.json&gt;’</code></li><li id="c05e" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">执行最后一次本地测试，以确保应用程序顺利运行；为此，首先需要将一个<strong class="io hq"> Procfile </strong>添加到应用程序<strong class="io hq">的根目录中。</strong>一个<strong class="io hq"> Procfile </strong>是<strong class="io hq"> </strong>一个文本文件(虽然没有扩展名！)在应用程序的根目录中，显式声明应该执行什么命令来启动应用程序。该命令(Procfile中的一行文本)通常依赖于应用程序，例如面板:<strong class="io hq"><br/></strong><code class="du md me mf mg b">web: panel serve --address=”0.0.0.0" --port=$PORT &lt;script&gt;.ipynb</code><br/>…然后运行<code class="du md me mf mg b">heroku local</code></li><li id="2db6" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">现在我们有了一个防错代码，为服务器部署做准备:首先修改<strong class="io hq"> Procfile </strong>以包含一个指向Heroku URL的指针，指向应用<br/><code class="du md me mf mg b">web: panel serve --address=”0.0.0.0" --port=$PORT &lt;script&gt;.ipynb —-allow-websocket-origin=&lt;app name&gt;.herokuapp.com</code><br/>…然后更新git: <br/> <code class="du md me mf mg b">git add .<br/>git commit -m “&lt;message&gt;”<br/>git push heroku master</code></li><li id="3790" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">最后，运行应用程序<code class="du md me mf mg b">heroku open</code> <br/>这将在浏览器窗口中打开该应用程序，其网址为应用程序名称生成的URL，即“https:// &lt;应用程序名称&gt; .herokuapp.com/”</li></ol><p id="ebd1" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">提示:完成后，使用<a class="ae jy" href="https://devcenter.heroku.com/articles/logging" rel="noopener ugc nofollow" target="_blank">日志命令</a>、<code class="du md me mf mg b">heroku logs --tail</code>之一来查看关于正在运行的应用程序的信息是很有用的，在出现问题时，您也可以使用这些命令来进行诊断。</p></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><p id="49c0" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hq">总结:</strong>虽然R用户拥有出色的工具，但是python用户需要更多的工具来创建交互式web应用。在这里，我使用了面板库、follous包和Heroku平台的组合来创建一个全球空气污染的交互式地图。可以按照本文介绍的步骤在Heroku云平台上部署任何python web app。</p><h1 id="11fd" class="km kn hp bd ko kp mh kr ks kt mi kv kw kx mj kz la lb mk ld le lf ml lh li lj bi translated"><strong class="ak">参考文献</strong></h1><ul class=""><li id="256a" class="lp lq hp io b ip lk it ll ix mm jb mn jf mo jj mp lv lw lx bi translated">OpenAQ网站:<a class="ae jy" href="https://openaq.org/" rel="noopener ugc nofollow" target="_blank">https://openaq.org/</a></li><li id="d720" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj mp lv lw lx bi translated">Google Cloud上的OpenAQ数据集:<br/><a class="ae jy" href="https://console.cloud.google.com/marketplace/details/openaq/real-time-air-quality" rel="noopener ugc nofollow" target="_blank">https://console . Cloud . Google . com/market place/details/open AQ/real-time-air-quality</a></li><li id="4c15" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj mp lv lw lx bi translated">Heroku云平台:<a class="ae jy" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank">https://www.heroku.com/</a></li><li id="454f" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj mp lv lw lx bi translated">https://postgresapp.com/</li><li id="f9a8" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj mp lv lw lx bi translated">链接到python BigQuery客户端库:<a class="ae jy" href="https://cloud.google.com/bigquery/docs/reference/libraries#client-libraries-install-python" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/big query/docs/reference/libraries # client-libraries-install-python</a></li><li id="b54f" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj mp lv lw lx bi translated">链接到叶子:<a class="ae jy" href="https://python-visualization.github.io/folium/" rel="noopener ugc nofollow" target="_blank">https://python-visualization.github.io/folium/</a></li><li id="3ce3" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj mp lv lw lx bi translated">链接到面板:<a class="ae jy" href="https://panel.pyviz.org/" rel="noopener ugc nofollow" target="_blank">https://panel.pyviz.org/</a></li><li id="8d2a" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj mp lv lw lx bi translated">链接到RStudio闪亮:<a class="ae jy" href="https://shiny.rstudio.com/" rel="noopener ugc nofollow" target="_blank">https://shiny.rstudio.com/</a></li><li id="ce31" class="lp lq hp io b ip ly it lz ix ma jb mb jf mc jj mp lv lw lx bi translated">一个类似的空气质量数据的互动地图由闪亮在R:<a class="ae jy" href="https://edanesh.shinyapps.io/my_openaq/" rel="noopener ugc nofollow" target="_blank">https://edanesh.shinyapps.io/my_openaq/</a></li></ul></div></div>    
</body>
</html>