<html>
<head>
<title>Journey of Apache Kafka &amp; Zookeeper Administrator ( Part 6 )</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">阿帕奇卡夫卡与动物园管理员之旅(六)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/journey-of-apache-kafka-zookeeper-administrator-part-6-2e0c0afd1ae2?source=collection_archive---------21-----------------------#2020-08-25">https://medium.com/analytics-vidhya/journey-of-apache-kafka-zookeeper-administrator-part-6-2e0c0afd1ae2?source=collection_archive---------21-----------------------#2020-08-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="24c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2019年7月</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/4efd6a725ba7782caa406a91c10da884.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*vocQpMjZPDjNvjwlJQhsGw.jpeg"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">官方图片来自阿帕奇卡夫卡网站</figcaption></figure><p id="d4eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上一篇文章中，我们谈到了雅虎卡夫卡经理又名CMAK。</p><p id="0748" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们转到下一个有趣的话题，那就是使用MM1 的<strong class="ih hj">阿帕奇卡夫卡的<strong class="ih hj">跨dc复制</strong>。</strong></p><p id="21c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请问自己一个问题，你真的需要它吗？如果不是，那就不要做。</p><p id="350f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我开始这个项目时，时间镜像制作人2(又名MM2)还没有正式发布，所以我只能用MM1进行设计，并诚实地说“MM1适合我的用例”，我只需要确保数据被快速可靠地复制(不是100%)。</p><p id="83a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经在5月和6月对MM1做了相当多的研究，但没有实现它。这只是在我的脑海中，这就是我需要如何实现它。</p><p id="afa4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">为什么不用任何第三方复制器比如</strong><a class="ae jp" href="https://github.com/uber/uReplicator" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">u复制器</strong> </a> <strong class="ih hj">？</strong> <br/>当我检查它的设计时，它相当复杂，不需要那些功能，如偏移同步、配置同步&amp; 100%可靠。即使它使用<strong class="ih hj"> RDBMS </strong>作为源，这也是另一个问题，我必须为它管理数据库，然后对我的用例进行监控，这是非常复杂且不容易的解决方案。</p><p id="f4e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在我的过程中加入了一个非常重要的东西，来完美的利用MM1。<strong class="ih hj">由于MM1是单向的，</strong> <strong class="ih hj">我不得不引入主题后缀</strong>，这样MM1就可以在复制过程中使用它们。主题后缀提供了不同dc环境之间的分隔。</p><p id="65be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> MM1架构(远程读取和本地写入模式)</strong></p><ul class=""><li id="46e3" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">安装在DC 2中的MM1将从DC 1卡夫卡获取远程数据，并在本地写入DC 2卡夫卡。</li><li id="34c3" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">安装在DC 1中的MM1将从DC 2卡夫卡获取远程数据，并在本地写入DC 1卡夫卡。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ke"><img src="../Images/f0e495c997f968f7a0bf9b7a9008fcba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*eAkpi3Wgyex4BzuLvNGpzg.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">基于MM1的架构。</figcaption></figure><p id="9072" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">上述架构的优势</strong></p><ul class=""><li id="e7fe" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">每个DC的主题+数据的分离。</li><li id="7c30" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">支持MM1。</li><li id="ca2e" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">主题之间没有数据的循环/无限复制。</li><li id="754b" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">很好理解。</li><li id="2b21" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">如果需要，很容易扩展/缩小MM1的容量。</li></ul><p id="b8fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的架构已经完成，我必须在安装过程+测试阶段工作。</p><p id="41f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有的东西都已经在Apache Kafka包中，我必须为它生成两个配置，消费者和生产者配置，这样它就可以在某个地方读取和写入，以模拟跨DC复制。</p><p id="9d78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/configure/templates/kafka-mirror-maker-consumer.properties" rel="noopener ugc nofollow" target="_blank">消费者配置</a></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="29aa" class="kk kl hi kg b fi km kn l ko kp">bootstrap.servers={{ kafkaMirrorMakerSourceDcClusterAddressString }}</span><span id="108f" class="kk kl hi kg b fi kq kn l ko kp"># consumer group id<br/>group.id={{ kafkaMirrorMakerGroupId }}<br/>auto.offset.reset={{ kafkaMirrorMakerAutoOffsetReset }}<br/>partition.assignment.strategy={{ kafkaMirrorMakerPartitionAssignmentStrategy }}<br/>fetch.max.bytes={{ kafkaMirrorMakerFetchMaxBytes }}<br/>fetch.min.bytes={{ kafkaMirrorMakerFetchMinBytes }}<br/>fetch.max.wait.ms={{ kafkaMirrorMakerFetchMaxWaitMs }}<br/>exclude.internal.topics=true<br/>allow.auto.create.topics=false</span></pre><p id="15cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/configure/templates/kafka-mirror-maker-producer.properties" rel="noopener ugc nofollow" target="_blank">生产商配置</a></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="d24b" class="kk kl hi kg b fi km kn l ko kp">bootstrap.servers={{ kafkaMirrorMakerDestinationDcClusterAddress }}<br/>compression.type={{ kafkaMirrorMakerCompressionType }}<br/>partitioner.class={{ kafkaMirrorMakerPartitionerClass }}<br/>request.timeout.ms={{ kafkaMirrorMakerRequestTimeoutMs }}<br/>max.block.ms={{ kafkaMirrorMakerMaxBlockMs }}<br/>linger.ms={{ kafkaMirrorMakerLingerMs }}</span><span id="e76c" class="kk kl hi kg b fi kq kn l ko kp"># the maximum size of a request in bytes<br/>max.request.size={{ kafkaMirrorMakerMaxRequestSize }}<br/>batch.size={{ kafkaMirrorMakerBatchSize }}<br/>buffer.memory={{ kafkaMirrorMakerBufferMemory }}</span><span id="c975" class="kk kl hi kg b fi kq kn l ko kp">max.in.flight.requests.per.connection={{ MaxInFlightRequests }}</span><span id="0443" class="kk kl hi kg b fi kq kn l ko kp">client.id={{ kafkaMirrorMakerClientId }}</span><span id="9e15" class="kk kl hi kg b fi kq kn l ko kp">acks={{ kafkaMirrorMakerAcks }}</span></pre><p id="2ecb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新M <a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/configure/templates/kafka-mirror-maker.sh" rel="noopener ugc nofollow" target="_blank"> irror-Maker-Start.sh </a></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="f6ae" class="kk kl hi kg b fi km kn l ko kp">export JMX_PORT={{ kafkaMirrorMakerJmxInitialPort + item }}<br/>export KAFKA_HEAP_OPTS="-Xmx{{ MakerHeapSize }} -Xms{{ HeapSize }}"<br/>export KAFKA_LOG4J_OPTS="-Dlog4j.configuration=file:log4j.properties"</span><span id="1862" class="kk kl hi kg b fi kq kn l ko kp">exec $(dirname $0)/kafka-run-class.sh kafka.tools.MirrorMaker "$@"</span></pre><p id="3c1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">手动启动卡夫卡MM 1 </strong></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="5107" class="kk kl hi kg b fi km kn l ko kp">bin/kafka-mirror-maker.sh --consumer.config kafka-mirror-maker-consumer.properties --producer.config kafka-mirror-maker-producer.properties --whitelist '.*dc1' --abort.on.send.failure false</span></pre><p id="52f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦开始正常工作，我就开始考虑如何扩展MM1，这是MM1真正出色的地方，我必须添加更多具有相同消费者和生产者配置的MM1实例，因为MM1基于Kafka消费者和生产者，而Kafka消费者被设计为在集群模式下工作。</p><p id="7a47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如何运行MM1的多个实例？现在是施展魔法的时候了。我创建了配置模板，Ansible将为我生成配置。</p><p id="a8f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我取了一个初始变量，表示每个实例应该运行多少MM1？我可以为每个实例使用1个，但这是一种非常低效的方式，因此我必须在每个实例上移动到多个MM1实例，现在我可以有3个虚拟机，但我可以运行6/9/12个MM1实例，并平均分布在所有3个虚拟机上。</p><p id="2c7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">kafkamirormakerprocesscountpernode:2</p><p id="9bf3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/configure/tasks/mirrorMaker.yml" rel="noopener ugc nofollow" target="_blank">可执行任务代码</a> <br/>所有变量取自:<a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/inventory/development/group_vars/kafka-mirror-maker.yml" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">group _ vars/Kafka-mirror-maker . yml</strong></a></p><p id="2228" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，当我生成像consumer/producer这样的配置时，因为它们对于MM1的所有实例都应该是相同的，所以我需要为每个服务器生成一次它们，并且MM1的所有实例都将使用它们。</p><p id="36c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于日志和启动脚本的原因，我必须为每个MM1实例生成两个以上的文件。</p><ul class=""><li id="acd3" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/configure/templates/tools-log4j.properties" rel="noopener ugc nofollow" target="_blank"> log4j.properties </a></li><li id="ce75" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/configure/templates/kafka-mirror-maker.sh" rel="noopener ugc nofollow" target="_blank"> mirror-maker-start.sh </a></li></ul><p id="a385" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在Ansible拿着上面的模板，基于“kafkamirormakerprocesscountpernode”为我生成不同的日志和启动脚本。</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="d993" class="kk kl hi kg b fi km kn l ko kp">- name: Creating kafka Mirror Maker configurations | properties files<br/>  template:<br/>    src: "tools-log4j.properties"<br/>    dest: "{{ kafkaInstallDir }}/kafka_{{ kafkaScalaVersion }}-{{ kafkaVersion }}/config/kafka-mirror-log4j-{{ item }}.properties"<br/>    owner: "{{ kafkaUser }}"<br/>    group: "{{ kafkaGroup }}"<br/>    mode: 0775<br/>  loop: "{{ range(1, kafkaMirrorMakerProcessCountPerNode + 1, 1) | list }}"</span><span id="8b95" class="kk kl hi kg b fi kq kn l ko kp">- name: Creating kafka Mirror Maker configurations | kafka-mirror-maker.sh<br/>  template:<br/>    src: kafka-mirror-maker.sh<br/>    dest: "{{ kafkaInstallDir }}/kafka_{{ kafkaScalaVersion }}-{{ kafkaVersion }}/bin/kafka-mirror-maker-{{ item }}.sh"<br/>    owner: "{{ kafkaUser }}"<br/>    group: "{{ kafkaGroup }}"<br/>    mode: 0775<br/>  loop: "{{ range(1, kafkaMirrorMakerProcessCountPerNode + 1, 1) | list }}"</span></pre><p id="7501" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">需要生成的最后一个文件是SystemD文件，因此该流程可以由SystemD启动和管理，而不是由<strong class="ih hj"> Nohup </strong>或<strong class="ih hj"> PM2 </strong>或其他流程管理系统启动和管理。</p><p id="7842" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/service/templates/kafka-mirror-maker-service.j2" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> MM2 SystemD模板</strong> </a></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="8fdc" class="kk kl hi kg b fi km kn l ko kp">[Unit]<br/>Description=Apache Kafka Mirror Maker Process {{ item }}<br/>After=syslog.target network.target</span><span id="e715" class="kk kl hi kg b fi kq kn l ko kp">[Service]<br/>Type=simple<br/>User={{ kafkaUser }}<br/>Group={{ kafkaGroup }}</span><span id="899a" class="kk kl hi kg b fi kq kn l ko kp">ExecStart={{ kafkaInstallDir }}/kafka/bin/kafka-mirror-maker-{{ item }}.sh \<br/>--consumer.config {{ kafkaInstallDir }}/kafka/config/kafka-mirror-maker-consumer.properties \<br/>--producer.config {{ kafkaInstallDir }}/kafka/config/kafka-mirror-maker-producer.properties \<br/>--whitelist '{{ kafkaMirrorMakerReplicateTopicWhiteListPattern }}'\<br/>--abort.on.send.failure false</span><span id="6e66" class="kk kl hi kg b fi kq kn l ko kp">TimeoutStopSec=180<br/>Restart=no</span><span id="501d" class="kk kl hi kg b fi kq kn l ko kp">[Install]<br/>WantedBy=multi-user.target</span></pre><p id="0f5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个Configuration + SystemD进程都附加了进程号，这样以后我就可以区分它们了。</p><p id="f319" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">我相信，到目前为止你还没有想过要监测&amp;记录MM1。</strong></p><p id="e013" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">日志记录也非常简单，</strong>日志是基于每个进程号在Kafka Log Dir下生成的，因此相同的Splunk配置也能正常工作。</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="50bc" class="kk kl hi kg b fi km kn l ko kp">{{ kafkaLogDir }}/kafka-mirror-maker-1.log<br/>{{ kafkaLogDir }}/kafka-mirror-maker-2.log</span></pre><p id="3ad3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">监控<br/> </strong>这就像日志记录一样简单，因为现在我需要了解我需要监控哪些指标，以及从哪里获取这些指标。老实说，我已经知道我要怎么做，这是基于JMX，因为MM1已经在做，我只需要一个刮刀和时间序列数据库(又名新遗迹)。我有新遗迹与卡夫卡的集成，我只需要为MM1扩展它。</p><p id="4133" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你仔细检查过我之前的模板，你会在<a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/configure/templates/kafka-mirror-maker.sh" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">Kafka-mirror-maker . sh</strong></a>中看到我还添加了另一个小魔术，为每个MM1实例动态生成JMX端口。</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="aade" class="kk kl hi kg b fi km kn l ko kp"><strong class="kg hj">kafkaMirrorMakerJmxInitialPort</strong>: 9980</span></pre><p id="4e7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，每当我生成<a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/configure/templates/kafka-mirror-maker.sh" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">Kafka-mirror-maker . sh</strong></a><strong class="ih hj">，</strong>时，我在模板中做如下操作</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="4ae8" class="kk kl hi kg b fi km kn l ko kp">export JMX_PORT={{ kafkaMirrorMakerJmxInitialPort + item }}</span></pre><p id="19f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的代码/模板将为每个MM1实例生成start.sh，并且每个实例都有一个唯一的JMX端口。</p><p id="6a2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于我熟悉新的遗迹JMX集成，我只需要为它生成配置。</p><p id="c0e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">重要提示:</strong>Kafka和MM1的监控不能安装在同一台虚拟机上，这意味着您不应该在同一台机器上安装Kafka和MM1。</p><p id="433f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/nri-kafka/templates/kafka-mirror-maker-jmx-config.yml" rel="noopener ugc nofollow" target="_blank">新遗迹JMX配置模板</a></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="4aff" class="kk kl hi kg b fi km kn l ko kp">integration_name: com.newrelic.jmx</span><span id="4d49" class="kk kl hi kg b fi kq kn l ko kp">instances:<br/>{% for processCount in range(kafkaMirrorMakerProcessCountPerNode) %}</span><span id="9744" class="kk kl hi kg b fi kq kn l ko kp">- name: jmx<br/>    command: all_data<br/>    arguments:<br/>      jmx_host: {{ ansible_fqdn }}<br/>      jmx_port: {{ kafkaMirrorMakerJmxInitialPort + processCount + 1 }}<br/>      collection_files: "/etc/newrelic-infra/integrations.d/kafka-mirror-maker-jvm-metrics.yml,/etc/newrelic-infra/integrations.d/kafka-mirror-maker-metrics.yml"<br/>      metric_limit: 0<br/>    labels:<br/>      env: {{ kafkaClusterName }}<br/>      mirrorMakerProcessName: kafka-mirror-maker-{{ processCount + 1 }}<br/>{% endfor %}</span></pre><p id="7eba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/nri-kafka/templates/kafka-mirror-maker-jvm-metrics.yml" rel="noopener ugc nofollow" target="_blank"> JVM度量模板</a></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="c2bd" class="kk kl hi kg b fi km kn l ko kp">collect:<br/># Standard JVM Metrics<br/>    - domain: java.lang<br/>      event_type: kafkaMirrorMakerMonitoring<br/>      beans:<br/>          - query: type=GarbageCollector,name=*<br/>            attributes:<br/>                - CollectionCount<br/>                - CollectionTime<br/>          - query: type=Memory<br/>            attributes:<br/>                - HeapMemoryUsage.Max<br/>                - HeapMemoryUsage.Used<br/>                - NonHeapMemoryUsage.Used<br/>          - query: type=Threading<br/>            attributes:<br/>                - ThreadCount<br/>                - PeakThreadCount<br/>          - query: type=ClassLoading<br/>            attributes:<br/>                - LoadedClassCount</span></pre><p id="bbd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/nri-kafka/templates/kafka-mirror-maker-metrics.yml" rel="noopener ugc nofollow" target="_blank"> MM1公制模板</a></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="70de" class="kk kl hi kg b fi km kn l ko kp">collect:</span><span id="dc04" class="kk kl hi kg b fi kq kn l ko kp">- domain: kafka.consumer<br/>      event_type: kafkaMirrorMakerMonitoring<br/>      beans:<br/>          - query: type=consumer-coordinator-metrics,client-id=*<br/>          - query: type=consumer-fetch-manager-metrics,client-id=*<br/>          - query: type=consumer-fetch-manager-metrics,client-id=*,topic=*,partition=*<br/>          - query: type=consumer-metrics,client-id=*</span><span id="a7ce" class="kk kl hi kg b fi kq kn l ko kp">- domain: kafka.producer<br/>      event_type: kafkaMirrorMakerMonitoring<br/>      beans:<br/>          - query: type=producer-metrics,client-id=*<br/>          - query: type=producer-node-metrics,client-id=*,node-id=*</span><span id="abf0" class="kk kl hi kg b fi kq kn l ko kp">- domain: kafka.tools<br/>      event_type: kafkaMirrorMakerMonitoring<br/>      beans:<br/>          - query: type=MirrorMaker,name=MirrorMaker-numDroppedMessages</span></pre><p id="1857" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">关于新遗迹模板需要知道的几件事</strong></p><ul class=""><li id="a04d" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">我将指标放入新的insights数据库“<strong class="ih hj">kafkaMirrorMakerMonitoring</strong>”中，而不是“<strong class="ih hj"> kafkaMonitoring </strong>”中，这样我就可以分开了。</li><li id="a6b1" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">如果你记得MM1是基于Kafka消费者和生产者的，这意味着它将导出他们的所有指标，你可以在汇合页面上找到:【https://docs.confluent.io/current/kafka/monitoring.html<a class="ae jp" href="https://docs.confluent.io/current/kafka/monitoring.html" rel="noopener ugc nofollow" target="_blank"/></li><li id="457d" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">如果您找不到MM1指标的文档，那么使用<strong class="ih hj"> Jconsole </strong>进行探索。</li><li id="bee8" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">使用标签区分<a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/roles/nri-kafka/templates/kafka-mirror-maker-jmx-config.yml" rel="noopener ugc nofollow" target="_blank">新遗迹JMX配置模板</a>中的流程。</li></ul><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="f339" class="kk kl hi kg b fi km kn l ko kp">labels:<br/>   env: {{ kafkaClusterName }}<br/>   mirrorMakerProcessName: kafka-mirror-maker-{{ processCount + 1 }}</span></pre><p id="a27b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/clusterNewRelicSetup.yml" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">clusternewrelicsetup . yml</strong></a><strong class="ih hj">:</strong>扩展用于MM1新遗迹设置。<br/>如果你还记得的话，我提到过New Relic Insights被弃用，所以开始在<strong class="ih hj"> New Relic One </strong>中创建一个仪表板。</p><p id="1600" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">手动步骤😠<br/> </strong>创造新的遗迹一仪表板。</p><p id="3d66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="kr">需要记住的几件事是，New Relic Infra Agent将指标发布到New Relic Insights中的另一个数据库。</em> </strong> <br/> <strong class="ih hj">系统示例:</strong>用于存储CPU指标。<br/> <strong class="ih hj"> StorageSample: </strong>用于存储磁盘规格。<br/> <strong class="ih hj">网络示例:</strong>用于存储网络度量。<br/><strong class="ih hj">kafkamirormakermonitoring:</strong>用于存储实际的Kafka MM1指标。</p><p id="568c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<a class="ae jp" href="https://docs.newrelic.com/docs/apis/rest-api-v2/api-explorer-v2/use-api-explorer" rel="noopener ugc nofollow" target="_blank"> New Relic API Explorer </a>导入下面的dashboard JSON代码。<br/> <strong class="ih hj">新遗物仪表盘代码:</strong><a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/files/newrelic-dashboards/kafka-mirror-maker-v1.json" rel="noopener ugc nofollow" target="_blank">Kafka-Mirror-maker-v1 . JSON</a><br/><strong class="ih hj">新遗物仪表盘示例:</strong> <a class="ae jp" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/files/newrelic-dashboards/Apache%20Kafka%20Mirror%20Maker.pdf" rel="noopener ugc nofollow" target="_blank">阿帕奇卡夫卡镜Maker.pdf</a></p></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><p id="6a81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">旅程将在下一个话题继续！</p></div></div>    
</body>
</html>