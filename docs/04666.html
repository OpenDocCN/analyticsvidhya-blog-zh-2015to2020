<html>
<head>
<title>BERT: Using Hugging Face for Sentiment Extraction with PyTorch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">伯特:用PyTorch用拥抱脸提取情感</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/bert-using-hugging-face-for-sentiment-extraction-with-pytorch-2477980e7976?source=collection_archive---------3-----------------------#2020-03-28">https://medium.com/analytics-vidhya/bert-using-hugging-face-for-sentiment-extraction-with-pytorch-2477980e7976?source=collection_archive---------3-----------------------#2020-03-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/dc5e6ce37c7d2b9befa02ad0a9ff675c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cvc4AprWrRmPciYRmYylPw.png"/></div></div></figure><p id="a3b0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我将带你了解“情感提取”以及如何在这项任务中取得优异的成绩。</p><p id="4a42" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本演练中，我将使用kaggle的“Tweet情感提取”数据集。关于比赛和数据集的更多细节，你可以访问<a class="ae jo" href="https://www.kaggle.com/c/tweet-sentiment-extraction/" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/c/tweet-sentiment-extraction/</a>。</p><p id="ba65" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将在这篇文章中使用的所有代码都可以在https://github.com/aksub99/bert-sentiment的<a class="ae jo" href="https://github.com/aksub99/bert-sentiment" rel="noopener ugc nofollow" target="_blank">获得。如果你觉得它有用，请给它加星，这样它可以到达更广泛的受众。</a></p><p id="910f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，任务到底是什么？</p><p id="0873" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们收到一条推文，它是一种情绪(积极的、消极的或中性的)，我们被要求预测推文中支持/表明这种情绪的部分。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es jp"><img src="../Images/ab4ac2d57ebff900a99e2c0405a31580.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*-ByhHCbYmilxq7dTtjYyIA.png"/></div></figure><p id="1cb3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以看到，我们的数据集在“文本”栏中包含推文，在“情绪”栏中包含情绪。tweet中代表情感的部分在“selected_text”列中给出。</p><p id="fa5e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的工作是在给定“文本”和“情绪”的情况下，创建一个模型来预测“selected_text”。</p><p id="de01" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如你可能已经观察到的，这个任务非常类似于问题回答。唯一的区别是，问题被情感取代，上下文/段落被推文取代，回答被推文表示情感的部分取代。</p><p id="9102" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们已经理解了任务和数据集，让我们进入实现细节。</p><p id="b6f8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，让我们检查数据集的nan值并删除相应的行。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ju"><img src="../Images/8832df740160b314099cac7138d9a180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XrLr_lgwAS8CLH2Egm_EDQ.png"/></div></div></figure><p id="908e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用拥抱脸变形金刚。所以，让我们继续安装它。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es jv"><img src="../Images/03294f319c5e770fd86c0b541ac41c01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*Q0cymG8HcvD7IBvqLDKJzg.png"/></div></figure><p id="0988" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不同的NLP算法需要输入单词序列的不同类型的记号化。BERT体系结构要求输入单词被单词块标记化。“BertTokenizer”为我们做了这些。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jw"><img src="../Images/c178fbe6b067160f13b0dd188c2eb2ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pvS3NKaVTyAtHGUXa4bkLQ.png"/></div></div></figure><p id="b9ec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些代码行为我们获取了BERT模型所需的记号赋予器。稍后可以利用这一点将我们的输入序列转换成BERT所需的形式。</p><p id="9a43" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在需要填充输入的句子，使它们长度相同。为了找出不同句子所需的填充量，我们首先需要确定最长输入句子的长度。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es jx"><img src="../Images/1cb375e1f7e99115c90bdf54fd3612f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*HCjsZSSExMdd14XaPHDQhw.png"/></div></figure><p id="0e00" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们在推文中得到的最大长度是110。因此，我们将不得不填充所有推文，以实现110的共同长度。</p><p id="f56b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是等等……因为我们的伯特的输入将是“情绪”和“推文”的串联，我们的组合序列将必须被填充以实现这个组合序列的最大长度，而不仅仅是推文的长度。</p><p id="eb10" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以有把握地假设这个组合序列的最大长度为150。因此，我们将填充组合的输入序列，以实现所有序列的公共长度150。</p><p id="6fd6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，我们的模型需要某种方式来区分情绪和推文，因为我们将这些内容串联起来作为输入。类似地，我们的模型还需要能够区分对应于单词的标记和对应于填充标记的标记。</p><p id="8eee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">概括来说，我们需要:</p><ol class=""><li id="e9a8" class="jy jz hi is b it iu ix iy jb ka jf kb jj kc jn kd ke kf kg bi translated">连接情绪和推文。</li><li id="7e3f" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated">根据BERT的要求对这个组合序列进行记号化。</li><li id="bed2" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated">将这个组合序列填充到150的长度。</li><li id="f9ad" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated">有办法区分单词标记和pad标记，以及情绪和tweet。</li></ol><p id="c8e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所有这些步骤都可以在名为encode_plus的神奇函数的帮助下执行，encode _ plus是Tokenizer类下的一个可用方法。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es km"><img src="../Images/c7931106d14bf742f79814d972cd76db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*lX4OYdXgv6qKzuQjQNBS8g.png"/></div></figure><p id="bba0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们在上面得到3个张量——“输入_标识”、“注意_屏蔽”和“令牌_类型_标识”。</p><p id="4336" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">1)“input _ ids”包含输入序列的标记化形式的id序列。</p><p id="8fb5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2)“attention _ masks”包含0和1的序列。它帮助我们区分输入的句子和pad标记。</p><p id="e532" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3)“token _ type _ ids”还包含0和1的序列。它帮助我们区分第一个序列(情绪)和第二个序列(推文)。这将被模型用来在两个序列之间添加[SEP]标记。</p><p id="5e29" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们把这些张量打印出来，以便更好地理解它们所包含的内容。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es kn"><img src="../Images/35c2fc57d65098fdcf6b9629d3949b46.png" data-original-src="https://miro.medium.com/v2/resize:fit:520/format:webp/1*WmtwK5eNHpiwJXu2DDhTGA.png"/></div></figure><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es ko"><img src="../Images/91510cb046e60a8c793aa48d1cdcf65a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*OtpxRCOtbYtyXtWizEa_FQ.png"/></div></figure><p id="32cf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，由于“selected_text”只是tweet的一部分，它可以很容易地表示为开始和结束索引。我们需要在训练时将这些作为标签输入到我们的模型中。</p><p id="0479" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是，请注意，这个开始和结束索引必须参考组合序列(情感+推文)，而不仅仅是推文。因此，我们现在将“selected_text”列转换为开始和结束位置。</p><p id="a016" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用于提取开始和结束索引的代码在<a class="ae jo" href="https://github.com/aksub99/bert-sentiment" rel="noopener ugc nofollow" target="_blank">https://github.com/aksub99/bert-sentiment</a>中给出。为了简洁起见，我不会在这里展示它。</p><p id="6738" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们将数据集分成训练集和验证集，并为它们创建PyTorch数据加载器。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es kp"><img src="../Images/0d742d0794bde1978db193686f760268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*FWFaUzmCruFLDMuEjld27A.png"/></div></figure><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es kq"><img src="../Images/65c614bf1a1e26470ee5163ac1d07b1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*eZ-bdCwmH16J_cmzvnLCAQ.png"/></div></figure><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/3d3997851d1817e217416664dc687ee1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MJrXhPQiJ3FispIeDZAYIg.png"/></div></div></figure><p id="58c8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在将创建模型并加载预训练的重量。我们将使用“BertForQuestionAnswering ”,因为该任务与回答问题非常相似，因此需要相同的架构。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/e2d4acf84e24f30ec98f167334aab604.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CXrad7Mr53TIw5_Ht6K8XQ.png"/></div></div></figure><p id="3641" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，让我们设置优化器和学习率调度器，并为3个时期训练我们的模型。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/3e3a3946245cc0566a28ddc5d9bec11b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_IdfmdxynfE1rjwaYnWCHA.png"/></div></div></figure><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ku"><img src="../Images/9ea617feb61591e2bf1145713419306f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IsO1Bj06XhSh1rM6STUAkQ.png"/></div></div></figure><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/4ceff2eb4a23e4d083dcb6fe40793832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vatueFaTPoO5JKke1EESLg.png"/></div></div></figure><p id="b2f3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们在下面看到，模型在第三个时期后才开始过度拟合。因此，我们不会继续下去。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/d10700de377e3964e42a859830386a68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*djPWYfoTFXGsMW-JMHLCrw.png"/></div></figure><p id="6daf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们走吧！</p><p id="6524" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是你如何训练一个用于情感提取/问题回答的huggingface BERT模型。</p><p id="3431" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你有任何问题，请让我知道。</p></div></div>    
</body>
</html>