<html>
<head>
<title>Time Series: Stationarity Check</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列:平稳性检查</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/time-series-stationarity-check-57f0f018201a?source=collection_archive---------14-----------------------#2020-03-02">https://medium.com/analytics-vidhya/time-series-stationarity-check-57f0f018201a?source=collection_archive---------14-----------------------#2020-03-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/94acd732687750803f8fe4699302aec0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AfeBduTtQSmyK-9QWTVESA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片由<a class="ae iu" href="https://pixabay.com/users/ds_30-1795490/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4887138" rel="noopener ugc nofollow" target="_blank"> ds_30 </a>来自<a class="ae iu" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4887138" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></figcaption></figure><p id="57bd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated">时间序列的平稳性是预测技术的一个常见假设。根据NIST的工程统计手册，平稳过程具有这样的性质，即<strong class="ix hj">均值</strong>、<strong class="ix hj">方差</strong>、<strong class="ix hj">自相关</strong>结构<strong class="ix hj">不随时间变化</strong>。换句话说，平稳时间序列不依赖于时间(平稳序列在任何时间“冲击”后往往会返回到一个恒定值)。</p><p id="2883" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这篇博文一步一步地描述了我用来检查平稳性的方法，以及我为满足这个假设而应用的数据转换。</p></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h2 id="67ec" class="kj kk hi bd kl km kn ko kp kq kr ks kt jg ku kv kw jk kx ky kz jo la lb lc ld bi translated">索引</h2><blockquote class="le lf lg"><p id="a689" class="iv iw lh ix b iy iz ja jb jc jd je jf li jh ji jj lj jl jm jn lk jp jq jr js hb bi translated">1.平稳性检查</p><p id="b517" class="iv iw lh ix b iy iz ja jb jc jd je jf li jh ji jj lj jl jm jn lk jp jq jr js hb bi translated">2.趋势和季节性分析</p><p id="6562" class="iv iw lh ix b iy iz ja jb jc jd je jf li jh ji jj lj jl jm jn lk jp jq jr js hb bi translated">3.数据转换</p><p id="930b" class="iv iw lh ix b iy iz ja jb jc jd je jf li jh ji jj lj jl jm jn lk jp jq jr js hb bi translated">4.结论</p></blockquote></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h2 id="3958" class="kj kk hi bd kl km kn ko kp kq kr ks kt jg ku kv kw jk kx ky kz jo la lb lc ld bi translated">平稳性检查</h2><p id="4a94" class="pw-post-body-paragraph iv iw hi ix b iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">在用于本示例的资源列表下面:</p><ul class=""><li id="8f24" class="lq lr hi ix b iy iz jc jd jg ls jk lt jo lu js lv lw lx ly bi translated">数据集:中位数家庭价值。选择了八个邮政编码。2009年至2019年的月值。从zillow.com/research/data下载</li><li id="21f7" class="lq lr hi ix b iy lz jc ma jg mb jk mc jo md js lv lw lx ly bi translated">Jupyter实验室笔记本</li><li id="b15d" class="lq lr hi ix b iy lz jc ma jg mb jk mc jo md js lv lw lx ly bi translated">Python库(图1)</li></ul><figure class="mf mg mh mi fd ij er es paragraph-image"><div class="er es me"><img src="../Images/12820e10e1b7276f1ac4dcb96143ebd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*Ps8Xq4g3zgpqmvSpT9dzaA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">图一。Python库</figcaption></figure><p id="bedb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我绘制了<strong class="ix hj">滚动统计数据</strong>，并使用来自statsmodels的<strong class="ix hj">增强Dickey-Fuller </strong> (adfuller)测试来评估每个邮政编码时间序列的平稳性。下面是迪基-富勒检验的零假设和替代假设:</p><p id="3217" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="lh">H0 = AR模型中存在一个单位根(序列呈现时间相关趋势)</em></p><p id="1650" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="lh"> H1 =过程是平稳的(序列不依赖于时间)</em></p><p id="be78" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">图2显示了我用来评估平稳性的函数。我将这个函数应用于每个邮政编码的时间序列。在将数据传递给函数之前，一定要将数据转换成时间序列格式:包含测量值的单个变量，并将时间列设置为数据的索引。图3显示了我如何将我的pandas数据框转换成合适的时间序列格式。</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div class="er es mj"><img src="../Images/0e54a8890f6ed16376d17b550a936ca0.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*Xu5adIuevJ49swBozDcGbQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">图二。用于绘制滚动统计数据和应用Adfuller测试的函数</figcaption></figure><figure class="mf mg mh mi fd ij er es paragraph-image"><div class="er es mk"><img src="../Images/a9cf4a1193ecdd8066a76916be9d3002.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*0PCkmmQ3PsZPkJvLFARoZg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">图3。将数据帧转换为时间序列格式</figcaption></figure><p id="d17b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">来自statsmodels的adfuller测试结果包括用于评估的p值、测试统计和临界值。为了评估假设，我检查了p值是否低于我的阈值(0.05)，并将测试统计量与临界值进行了比较。</p><p id="6814" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我的一个时间序列中运行上述函数的结果如图4所示。下面是结果汇总:</p><p id="6ea5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">平均值(红线)随着时间的推移而增加</p><p id="7e70" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">p值&gt; 0.05阈值</p><p id="66cb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">检验统计&gt;临界值</p><p id="fa0a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，我无法拒绝H0(时间序列不是平稳的)。我对我的每个时间序列(总共8个)运行了这个函数，没有一个是稳定的。</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div class="er es ml"><img src="../Images/36f0a1042af2c1bc91359b965430b5c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*HPIfyK0XveLrDFepy_m6GA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">图4。滚动统计和Adfuller结果</figcaption></figure></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h2 id="18a0" class="kj kk hi bd kl km kn ko kp kq kr ks kt jg ku kv kw jk kx ky kz jo la lb lc ld bi translated">趋势和季节性分析</h2><p id="c994" class="pw-post-body-paragraph iv iw hi ix b iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">因为我的时间序列没有一个是稳定的，所以我做了一些额外的分析来定义接下来的步骤。</p><p id="4454" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我使用来自<strong class="ix hj"> statsmodels </strong>的<strong class="ix hj"> seasonal_decompose </strong>将我的时间序列分解成季节、趋势和剩余属性。在选择任何数据转换方法之前，理解时间序列的组成部分是很重要的。图5显示了我用来绘制每个时间序列的趋势、季节性和噪声的代码。图6显示了四个生成的图(我总共有8组图，每个城市/邮政编码一组)。请注意，您可以在代码中调整图形尺寸，以便更清楚地查看轴。</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/5dc73eb45aab7e18d578c4d3bbec9a15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vGtsaLIxYp8JhNpeAzvZXQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图5。绘制季节性分解属性的函数</figcaption></figure><figure class="mf mg mh mi fd ij er es paragraph-image"><div class="er es mn"><img src="../Images/a9395545d9494f1296c8a1fbedd2ef2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*71lZPlhLKvddr6E0V2aIHA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">图6。季节性_分解绘制结果</figcaption></figure></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h2 id="ad65" class="kj kk hi bd kl km kn ko kp kq kr ks kt jg ku kv kw jk kx ky kz jo la lb lc ld bi translated">数据转换</h2><p id="d24b" class="pw-post-body-paragraph iv iw hi ix b iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">在分析了图6中的图之后，我能够看到我的所有时间序列都呈现出上升趋势和季节性。我采取的下一步是为每个单独的时间序列确定适当的数据转换，以满足平稳性假设。</p><p id="b5f0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有几种数据转换方法可用于将序列转换为平稳序列。在这个练习中，我对我的序列应用了对数变换(稳定方差)和差分(去趋势)以达到平稳性。</p><p id="5492" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">对数变换</strong></p><p id="0bf8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我首先对我的每个时间序列进行对数转换，并对每个转换后的时间序列应用statsmodels adfuller测试来检查平稳性。图7显示了adfuller测试的代码和结果p值。正如你所看到的，没有一个时间序列在对数变换后变得稳定(所有p值&gt; 0.05)。</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div class="er es mo"><img src="../Images/00761b9fe31f8312d7da419c0f368106.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*BsToQFj_vOAuj6Mkc9kMOw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">图7。对数变换时间序列</figcaption></figure><p id="e263" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">差分</strong></p><p id="458a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我对数据应用的第二个转换是差分。图8显示了对时间序列进行差分后获得的代码和部分结果。我对每个时间序列进行了多达三次的差分，并打印了每个变换的adfuller测试p值(请注意，在这一步中，我对原始时间序列进行了差分，而不是对数变换的时间序列)。这样做之后，我能够看到我的五个城市在差分后达到平稳(p值&lt; 0.05). Keep in mind that, when differencing, you want to look for the minimal level of differencing that will give you a stationary time series.</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div class="er es mp"><img src="../Images/d75c93397bd4638a8325c85e6b15b1de.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*dIFEPgUOFfDjca8sJkXW6w.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">Figure 8. Differencing time series</figcaption></figure><p id="6d5a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">对数变换&amp;差分</strong></p><p id="51db" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了确保所有时间序列的平稳性，我做的第三个尝试是对经过对数变换的时间序列进行差分。图9显示了一些转换后的时间序列的代码和adfuller的p值。经过对数变换和差分后，其余三个时间序列达到平稳。</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div class="er es mq"><img src="../Images/36cdba622d7686993a9ddf1769dd163c.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*vmtFRqUza3VDM5lwGfPpvQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">图9。对数变换和差分时间序列示例</figcaption></figure><h2 id="d40e" class="kj kk hi bd kl km kn ko kp kq kr ks kt jg ku kv kw jk kx ky kz jo la lb lc ld bi translated">结论</h2><p id="c6b0" class="pw-post-body-paragraph iv iw hi ix b iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">为了达到平稳性，必须对时间序列进行转换。如果最终目标是通过组合自回归(AR)-移动平均(MA)模型(即ARIMA、萨里玛)进行建模，请确保让算法处理差分步骤。现在，如果您需要对数据进行日志转换，这需要在建模之前进行。</p><p id="95e9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您对如何更好地做到这一点有任何建议，请在下面分享您的评论。我总是乐于学习新的东西！</p></div></div>    
</body>
</html>