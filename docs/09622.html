<html>
<head>
<title>A Discord Bot For Dungeons And Dragons (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">龙与地下城的不和机器人(第一部分)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/a-discord-bot-for-dungeons-and-dragons-part-1-f967561ad73e?source=collection_archive---------20-----------------------#2020-09-13">https://medium.com/analytics-vidhya/a-discord-bot-for-dungeons-and-dragons-part-1-f967561ad73e?source=collection_archive---------20-----------------------#2020-09-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d011" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，我已经和我的室友玩了两年多的龙与地下城(以下简称 DnD)。桌面角色扮演游戏是增强我想象力和讲故事能力的好方法，我们每周的会议有助于打破大学生活的紧张节奏。然而，随着疫情让整个世界陷入停顿，我的团队已经有几个月没有见面了。自然，这意味着我们也不能玩了。不要被仅仅是全球隔离所吓倒，我们决定通过不和谐虚拟地玩这个游戏。这要求人工智能机器人能够:</p><ol class=""><li id="c67a" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">与其他玩家互动，</li><li id="2885" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">安排和取消会话，</li><li id="6564" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">提醒人们关于会话，最重要的是，</li><li id="2172" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">掷骰子(因为我的玩家懒得/吝啬买)</li></ol><p id="30c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为地下城主和事实上的组织者，制作它们的任务落在了我身上。这就是我如何创造出 DnD 机器人 Bort 的。</p><p id="e092" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">免责声明</strong>:这不是一个教程或指南。这就是我，一个学编程的学生，如何做出来的。可能有不必要的代码，或者我无法真正解释其功能的代码。请不要认为这是唯一的，甚至是正确的，创建一个类似的机器人的方式。</p><p id="40f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，您需要以下用于聊天机器人的 Python 包:</p><ol class=""><li id="3ea0" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">自然语言工具包(NLTK)</li><li id="3f40" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">Numpy</li><li id="370d" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">张量流</li><li id="4345" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">Tflearn</li></ol><p id="8e01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">NLTK 是一组用于自然语言处理(NLP)的库。简单来说，它将帮助程序解释和理解人类语言(在这里是英语)。</p><p id="84a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通常，如果我们要创建一个基于用户输入做出不同响应的机器人，我们要做的是将一组输入映射到一组响应。这种方法的一个问题是，机器人只能理解与预定义输入之一完全匹配的输入。例如，如果输入之一是“你叫什么名字？”用户输入“你叫什么名字？”，机器人将无法识别该命令。然而，使用 NLP，机器人将把输入剥离到最基本的内容，比如“什么，名字”，并相应地对其做出响应。</p><p id="cca0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Tensorflow 和 Tflearn 将用于代码的深度学习部分。</p><p id="d07f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们需要创建一组输入和相应的响应。我们可以创建一个 JSON 文件。</p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="6d58" class="ka kb hi jw b fi kc kd l ke kf">{"intents": [<br/>        {"tag": "greeting",<br/>         "patterns": ["Hi", "Is anyone there?", "Hello", "Good day", "Whats up"],<br/>         "responses": ["The Light illumine your path, author!", "Good to see you again, author!", "Well, well! author is here!"],<br/>        },<br/>        {"tag": "goodbye",<br/>         "patterns": ["cya", "See you later", "Goodbye", "I am Leaving", "Have a Good day"],<br/>         "responses": ["Fare thee well, author!", "Till we meet again, author!", "Goodbye!"],<br/>        },</span><span id="8009" class="ka kb hi jw b fi kg kd l ke kf">{"tag": "last",<br/>   "patterns": ["What happened last time?", "How did last game go?", "How was last game?"],<br/>   "responses": ["!summary"],<br/>  },<br/>{"tag": "chat",<br/>   "patterns": ["How are you?", "How's your day going?", "How is life?"],<br/>   "responses": ["I'm doing well, for a bot", "Quite well, glad you asked.","I'm just fine, thank you."],<br/>  }<br/> ]<br/>}</span></pre><p id="a99a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如你所看到的，这是一本字典。这个字典有一个输入集和相应响应的列表。我们的想法是让机器人将任何用户输入与其中一个输入模式进行匹配，并让它做出相应的响应。提供的示例只是实际 JSON 文件的摘录。随意添加更多的输入/响应对。</p><p id="327c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们开始编码，好吗？</p><p id="c508" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们需要导入必要的库。</p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="915b" class="ka kb hi jw b fi kc kd l ke kf">import random<br/>import re<br/>import os<br/>import nltk<br/>from nltk.stem.lancaster import LancasterStemmer<br/>import numpy<br/>import tflearn<br/>import tensorflow<br/>import json<br/>import pickle</span></pre><p id="6a8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们打开我们创建的 JSON 文件。</p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="64e3" class="ka kb hi jw b fi kc kd l ke kf">with open("intents.json") as file:<br/>  data = json.load(file)</span></pre><p id="06ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从字典中，我们必须将不同的输入模式添加到一个列表中，并将响应标记添加到另一个列表中。</p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="0aea" class="ka kb hi jw b fi kc kd l ke kf">words = []<br/>labels = []<br/>docs_x = []<br/>docs_y = []</span><span id="ea10" class="ka kb hi jw b fi kg kd l ke kf">for intent in data["intents"]:<br/>   for pattern in intent["patterns"]:<br/>      word = nltk.word_tokenize(pattern)<br/>      words.extend(word)<br/>      docs_x.append(word)<br/>      docs_y.append(intent["tag"])<br/>   if intent["tag"] not in labels:<br/>      labels.append(intent["tag"])</span><span id="0e3f" class="ka kb hi jw b fi kg kd l ke kf">stemmer = LancasterStemmer()<br/>words = [stemmer.stem(w.lower()) for w in words if w != "?"]</span><span id="6262" class="ka kb hi jw b fi kg kd l ke kf">words = sorted(<em class="kh">list</em>(<em class="kh">set</em>(words)))<br/>labels = sorted(labels)</span></pre><p id="8480" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">唷！一次有很多代码，不是吗？首先，我们取每个输入/响应集。“模式”变量存储输入类型的每个不同变化(如“问候”、“聊天”等)。").然后，我们对“模式”进行“标记化”，也就是说，将句子转换成单词列表。我们将模式中的每个单词添加到“单词”列表的最后。然后，我们将“模式”中的单词列表添加到“docs_x”中，并将输入集的标签添加到“docs_y”中。这意味着对于每个单词列表，我们可以获得相应的响应标签，因为它们将共享相同的索引。我们还将响应标签添加到“标签”列表中。最后，我们对单词列表中的每个单词进行“词干处理”，这意味着我们将其转换为小写，并将单词剥离为其词根，例如“running”转换为“run”，“asked”转换为“ask”，等等。</p><p id="76df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个代码段的末尾，我们会有一个可能输入的所有单词的列表，以及一个所有可能的响应标签的列表。我们可以把它们两个都排序(因为何乐而不为)。</p><p id="d103" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，这是我们为神经网络创建训练数据的地方。我不打算解释什么是神经网络，因为那会花太多时间。现在，你需要理解的是，我们将把输入/响应标签数据提供给一种伪人工智能，它将识别输入和响应之间的模式，因此，如果伪人工智能被给予一个不完全匹配任何预定义输入的用户输入，它仍然可以识别输入中的一些模式，以便它仍然可以预测最合适的响应。</p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="8007" class="ka kb hi jw b fi kc kd l ke kf">training = []<br/>output = []</span><span id="586a" class="ka kb hi jw b fi kg kd l ke kf">out_empty = [0 for _ in range(len(labels))]</span><span id="7247" class="ka kb hi jw b fi kg kd l ke kf">for x, doc in enumerate(docs_x):<br/>   bag = []<br/>   wrds = [stemmer.stem(w.lower()) for w in doc]<br/>   for w in words:<br/>      if w in wrds:<br/>         bag.append(1)<br/>      else:<br/>         bag.append(0)<br/>   output_row = out_empty[:]<br/>   output_row[labels.index(docs_y[x])] = 1<br/>   training.append(bag)<br/>   output.append(output_row)</span><span id="9ec9" class="ka kb hi jw b fi kg kd l ke kf">training = numpy.array(training)<br/>output = numpy.array(output)</span></pre><p id="6ba3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以在这里，我们创建两个列表，“训练”和“输出”。我们要做的是，我们将把每个输入句子的单词列表附加到“训练”中，以及它对“输出”的适当响应。唯一的事情是，我们将使用所谓的“单词袋”。基本上，我们不是添加实际的单词，而是添加一个 1 和 0 的列表，其长度等于所有输入的总字数。对于输入中的每个单词，列表的相应位置会有一个 1，对于不在列表中的单词，列表的相应位置会有一个 0。</p><p id="008f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，如果在组合的所有输入中，我们有 4 个单词:['什么'，'如何'，'名称'，'游戏']，并且我们添加到训练数据的输入是“什么名称”，要追加的单词列表包将是[1，0，1，0]。</p><p id="6407" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们对响应标记做同样的事情。我们附加一个长度为 0 的数组作为响应总数，正确的响应在它的位置上有 1。</p><p id="911b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们将这两个列表转换成 numpy 数组。</p><p id="1630" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在是时候创建神经网络，并使用我们准备的数据对其进行训练。</p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="e7d8" class="ka kb hi jw b fi kc kd l ke kf">tensorflow.reset_default_graph()</span><span id="4654" class="ka kb hi jw b fi kg kd l ke kf">net = tflearn.input_data(<em class="kh">shape</em>=[None, len(training[0])])<br/>net = tflearn.fully_connected(net, 16)<br/>net = tflearn.fully_connected(net, 16)<br/>net = tflearn.fully_connected(net,len(output[0]),<br/>                              <em class="kh">activation</em>="softmax")<br/>net = tflearn.regression(net)<br/>model = tflearn.DNN(net)<br/>model.fit(training, output, <em class="kh">n_epoch</em>=1000, <em class="kh">batch_size</em>=8,<em class="kh">show_metric</em>=True)</span><span id="f81b" class="ka kb hi jw b fi kg kd l ke kf">model.save("model.tflearn")</span></pre><p id="5f4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们已经完全训练好了神经网络。我们现在可以轻松地和它聊天了。我们需要做的就是编写一个函数来接收用户的输入，然后使用神经网络来预测一个适当的响应。</p><pre class="jr js jt ju fd jv jw jx jy aw jz bi"><span id="c11f" class="ka kb hi jw b fi kc kd l ke kf">def chat():<br/>   inp = input("Say something: ")<br/>   result = model.predict([bag_of_words(input,words)])<br/>   result_index = numpy.argmax(result)<br/>   tag = labels[result_index]<br/>   for tg in data["intents"]:<br/>      if tg['tag'] == tag:<br/>         responses = tg["responses"]<br/>   print(random.choice(responses)</span><span id="647d" class="ka kb hi jw b fi kg kd l ke kf"><em class="kh">def</em> bag_of_words(<em class="kh">s</em>, <em class="kh">words</em>):<br/>   bag = [0 for _ in range(len(words))]<br/>   s_words = nltk.word_tokenize(s)<br/>   s_words = [stemmer.stem(word.lower()) for word in s_words if word != "?"]<br/>   for se in s_words:<br/>      for i,w in enumerate(words):<br/>         if w==se:<br/>            bag[i] = 1<br/>   return numpy.array(bag)</span><span id="9ab2" class="ka kb hi jw b fi kg kd l ke kf">if __name__ == "__main__":<br/>   while True:<br/>      chat()</span></pre><p id="7ba3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们需要做的就是保存文档，运行它，然后等待奇迹发生。</p><figure class="jr js jt ju fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ki"><img src="../Images/31d70cf7620d7c73a1a50f0f09caf3c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vTTZ4N53ouPrkz88tKxNhw.png"/></div></div></figure><p id="8457" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它还活着！BWAHAHA！</p><p id="6a67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">反正这个 Bot 像现在这样，只会闲聊，如上图。我们需要增加它能做的任务。例如，如果我问下一场比赛是什么时候，我希望它用“下一场比赛在<date>”来响应。但是现在，它只会这样回应:</date></p><figure class="jr js jt ju fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ki"><img src="../Images/3bdb48a69f80139a6948dec1204a6603.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s4VMJ0yg6R7T6I-wjnT6Xg.png"/></div></div></figure><p id="517d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了解决这个问题，我们可以很容易地添加一个条件子句，在打印之前检查机器人的响应。所以，如果机器人的反应是这样的！下一个“或者”！schedule”，我们可以用适当的函数代替响应。现在，机器人先生，我命名你为伯特，我的龙与地下城的私人助理。</p><p id="4d0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您阅读这篇文章。你可以查看源代码并在你自己的设备上运行 Bort<a class="ae kq" href="https://github.com/AkshaySN99/BortTheDnDBot" rel="noopener ugc nofollow" target="_blank">这里</a>。在下一部分中，我们将进一步为 Bort 添加功能，包括安排会话、给会话添加提醒和掷骰子。在那之前，</p><figure class="jr js jt ju fd kj er es paragraph-image"><div class="er es kr"><img src="../Images/d3750507f0f5d78f2495b49d345e2dcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*AX8wYVoxcTTl2hLmxJEN9Q.png"/></div></figure></div></div>    
</body>
</html>