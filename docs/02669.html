<html>
<head>
<title>Building custom R Shiny UI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建自定义的闪亮用户界面</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/building-custom-r-shiny-ui-66d446ef4dad?source=collection_archive---------3-----------------------#2019-12-28">https://medium.com/analytics-vidhya/building-custom-r-shiny-ui-66d446ef4dad?source=collection_archive---------3-----------------------#2019-12-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="49a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为正在进行的为宾夕法尼亚州的ACLU(<a class="ae jd" href="https://www.aclupa.org/" rel="noopener ugc nofollow" target="_blank">https://www.aclupa.org)</a>构建定制仪表板项目的一部分，我们尝试了很多定制RShiny UI来满足我们的设计目标。在本帖中，我们将讨论一些用于定制仪表板设计的技术。</p><p id="9522" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们大致涵盖两个主题:</p><ul class=""><li id="01e1" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated"><strong class="ih hj">添加自定义UI元素</strong></li><li id="269c" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated"><strong class="ih hj">定制闪亮主题</strong></li></ul></div><div class="ab cl js jt gp ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hb hc hd he hf"><h1 id="7e48" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated"><strong class="ak">添加自定义UI元素</strong></h1><p id="532d" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">Shiny附带了很多默认的布局元素，比如<code class="du lc ld le lf b">navbarPage</code>、<code class="du lc ld le lf b">fluidPage</code>、<code class="du lc ld le lf b">tabsetPanel</code>等等。但是，有时这些选项可能不足以重新创建您想要的设计。在这种情况下，我们可以求助于使用定制的HTML代码来构建我们的UI。</p><p id="5959" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们对仪表板的目标是包括一个配置文件页面，在仪表板顶部有3个框，展示3个关键的统计数据。</p><figure class="lh li lj lk fd ll er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lg"><img src="../Images/faecec7098e82f7704c84f45557beb1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rcg6o50IaMGUYzJ501oTyQ.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx translated">个人资料页面的设计</figcaption></figure><p id="dcce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最初尝试使用<code class="du lc ld le lf b">fluidRow</code>和3 <code class="du lc ld le lf b">column</code>元素的组合并没有给我们提供我们需要的结果。此外，让这些盒子以正确的间距正确对齐是一项艰巨的任务。因此，我们最终使用自定义HTML来构建UI。</p><pre class="lh li lj lk fd lw lf lx ly aw lz bi"><span id="61fa" class="ma ka hi lf b fi mb mc l md me">boxStyle ='color:black; background-color:#DE4F53; margin: 0 3em 0 3em; border-radius: .5em; height :10vh; color:white; align:center; text-align:center; display: table-cell;<br/>    vertical-align: middle'</span><span id="eb6a" class="ma ka hi lf b fi mf mc l md me">fluidRow(style = "background-color: #ffffff; height :15vh;",<br/>       column(3,div(htmlOutput("box1")), style=boxStyle),<br/>       column(3,div(htmlOutput("box2")), style=boxStyle),<br/>       column(3,div(htmlOutput("box3")), style=boxStyle))<br/>)</span></pre><p id="4784" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们首先定义一个<code class="du lc ld le lf b">fluidRow</code>作为所有3个盒子的容器。在<code class="du lc ld le lf b">fluidRow</code>元素中，我们输入3个列元素，每个都有一个定义的宽度。</p><p id="0620" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一点上，重要的是要提到在你的R shiny应用中包含HTML代码有2种不同的方式。</p><ul class=""><li id="ee05" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">使用RShiny中预定义的HTML块元素，如<code class="du lc ld le lf b">div</code>、<code class="du lc ld le lf b">p</code>、<code class="du lc ld le lf b">img</code>等。</li><li id="5dd1" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">使用以正确的HTML语法编写的HTML代码，然后作为字符串传递给<code class="du lc ld le lf b">htmlOutput</code>方法。</li></ul><p id="e459" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于我们的实现，我们使用这两种方法。我们首先使用预定义的方法创建一个div块。这个div块将作为我们放置文本的主框。然后，我们通过在字符串中定义CSS样式参数并将其传递给div方法的样式参数来自定义div对象。在我们的例子中，所有CSS属性都在boxStyle变量中定义。这些属性确保盒子有特定的颜色、弯曲的角和响应的高度。</p><p id="ec70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，我们定义每个框中的文本。这是通过使用第二种方法完成的。</p><pre class="lh li lj lk fd lw lf lx ly aw lz bi"><span id="72a7" class="ma ka hi lf b fi mb mc l md me">output$box1 = renderUI({</span><span id="fb41" class="ma ka hi lf b fi mf mc l md me">    % Reactive function that retrieves the current data <br/>    df &lt;- data()</span><span id="d1b8" class="ma ka hi lf b fi mf mc l md me">    style='margin:0;position: absolute;left: 50%;top: 50%;transform:<br/>           translate(-50%, -50%);'</span><span id="a6d3" class="ma ka hi lf b fi mf mc l md me">    a = nrow(df)<br/>    b = "Total Cases"<br/>    <br/>    htmlCode= sprintf("&lt;p style= %s \&gt; &lt;span style='font-size :23px;<br/>        font-weight:bold;'&gt; %s &lt;/span&gt;&lt;/br&gt; %s &lt;/p&gt;", style, a, b)</span><span id="0186" class="ma ka hi lf b fi mf mc l md me">    HTML(htmlCode)<br/>    <br/>    <br/>  })</span></pre><p id="d9ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在服务器函数中，我们使用<code class="du lc ld le lf b">renderUI</code>方法定义了box1输出元素。我们使用当前数据构造了一个HTML <code class="du lc ld le lf b">p</code>元素，以使其具有响应性。我们还可以在字符串本身中输入CSS样式属性。然后，我们在通过HTML方法传递字符串之后返回它。需要注意的是，<code class="du lc ld le lf b">htmlOutput</code>不接受字符串输入，因此字符串在传递给<code class="du lc ld le lf b">htmlOutput</code>之前必须通过HTML方法。</p><blockquote class="mg mh mi"><p id="fbd9" class="if ig mj ih b ii ij ik il im in io ip mk ir is it ml iv iw ix mm iz ja jb jc hb bi translated">在上面提到的两个选项中，第二个选项更灵活，基本上可以完成第一个选项可以完成的所有工作。</p></blockquote><figure class="lh li lj lk fd ll er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mn"><img src="../Images/81863f54666a7ca406b70cc3e2b90d9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dGf7YgEYmy0QFkWbH6ECBQ.png"/></div></div></figure><p id="f425" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用定制HTML的另一个例子是我们添加到这个页面的信息面板。这个特定的面板由使用第二种方法添加的<code class="du lc ld le lf b">p</code>、<code class="du lc ld le lf b">img</code>和<code class="du lc ld le lf b">table</code> HTML元素组成。构建这样一个面板，尤其是带有自定义字体和文本对齐方式的表格元素，单独使用默认的RShiny布局选项几乎是不可能的。</p></div><div class="ab cl js jt gp ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hb hc hd he hf"><h1 id="c269" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated"><strong class="ak">定制闪亮主题</strong></h1><p id="683a" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">Shiny附带了很多主题选项(<a class="ae jd" href="https://rstudio.github.io/shinythemes/" rel="noopener ugc nofollow" target="_blank">https://rstudio . github . io/shiny themes)/</a>，可以通过使用<code class="du lc ld le lf b">shinythemes</code>包轻松实现。虽然有很多选项，但有时我们可能需要改变这些主题来反映我们应用程序的整体设计。在我们的例子中，由于我们正在为ACLU构建一个应用程序，我们希望在整个应用程序中坚持ACLU的颜色。</p><figure class="lh li lj lk fd ll er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mo"><img src="../Images/3e261f3d9ca36a599036d0b572f23363.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qO3O7piRdtx65To8GNM_NA.png"/></div></div></figure><p id="b7b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们开始使用Flatly主题构建我们的应用程序。这个主题有自己的默认配色方案，在整个应用程序中使用。</p><figure class="lh li lj lk fd ll er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mp"><img src="../Images/316fa04e2caedf3f91a1c244d7a71447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1BFTxht4oQJwOPxvcLBvyQ.png"/></div></div></figure><p id="a281" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要开始修改主题，我们需要首先获得这个主题的CSS文件。我们可以通过下载bootstrap.min.css文件在bootstratch(<a class="ae jd" href="https://bootswatch.com/flatly/" rel="noopener ugc nofollow" target="_blank">https://bootswatch.com/flatly</a>)获得所有闪亮主题的主题。</p><figure class="lh li lj lk fd ll er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mq"><img src="../Images/7d259163e14f5c9f73103ef1884c02cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SW9YvmmiEVP1raKbwjMfLA.png"/></div></div></figure><p id="ee6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">CSS文件应该看起来像这样。我们在这里看到的是在我们的应用中为所有不同类型的元素设置的属性，以及它们不同状态的<em class="mj">。</em></p><figure class="lh li lj lk fd ll er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mr"><img src="../Images/6339d365135c46cfb0445eada7d0fabc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nEY9syRDCj-fVF-KqXltzw.png"/></div></div></figure><p id="1057" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要使用这个CSS文件，在您的shiny项目中创建一个名为<code class="du lc ld le lf b">www</code>的文件夹，并将文件放在那里。</p><figure class="lh li lj lk fd ll er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es ms"><img src="../Images/e8c9386da29fb3c1803f5daf52e4a047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sjOG6TD5n-IkhCwXHU8JXA.png"/></div></div></figure><p id="d6c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，在您的UI函数中，将主题参数设置为指向该文件。在这个阶段，我们已经在我们的应用程序和CSS文件之间建立了一个链接，我们对CSS文件所做的任何更改都会反映在应用程序的设计上。</p><blockquote class="mg mh mi"><p id="e8a6" class="if ig mj ih b ii ij ik il im in io ip mk ir is it ml iv iw ix mm iz ja jb jc hb bi translated">更改UI的关键步骤是确定哪个CSS属性定义了您感兴趣的UI元素的设计。为此，最好的方法是在浏览器中打开应用程序并检查CSS代码。在Chrome中，这可以通过使用<code class="du lc ld le lf b">Developer Tools</code>选项来完成。</p></blockquote><figure class="lh li lj lk fd ll er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mt"><img src="../Images/4f33c2e5b83cce7451b43f7ff53f5d42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MUW1dc5E3XazyB9O5WzVVA.png"/></div></div></figure><p id="6577" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们选择想要修改的UI元素，并可以在<code class="du lc ld le lf b">Styles</code>选项卡下看到设计CSS属性。在这种情况下，我们感兴趣的是导航栏标题。我们可以看到导航栏标题的背景色属性设置在<code class="du lc ld le lf b">.nav&gt;li&gt;a</code>下，其值为#0055A8。它还告诉我们这段代码位于bootstrap.css文件的第2922行。</p><figure class="lh li lj lk fd ll er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mu"><img src="../Images/5c0f49da357abd706adfb204d718247c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bq7e8cpOacNWPHBb70x9Bg.png"/></div></div></figure><p id="b0b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，要修改背景色属性，我们回到CSS文件，将背景色改为红色，然后重新加载应用程序。</p><figure class="lh li lj lk fd ll er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mv"><img src="../Images/6629d4241fe8b5cf68b97aae7a744ac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WrXMrlrsvFmGTOf1Pz036A.png"/></div></div></figure><p id="8d7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在可以看到导航栏元素的背景色设置为红色。您还可以注意到，在Styles选项卡下，<code class="du lc ld le lf b">.nav&gt;li&gt;a</code>选择器现在显示了更新的背景色属性。</p><p id="881c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，通过对一些属性进行修改，我们可以修改默认的flatly主题来匹配我们想要的颜色主题。</p><div class="lh li lj lk fd ab cb"><figure class="mw ll mx my mz na nb paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><img src="../Images/bc4afcbfb2a2ca33c18e3916b76962e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*lpZ9yCtFfp_yqT2pj7vRSg.png"/></div></figure><figure class="mw ll nc my mz na nb paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><img src="../Images/6a04c221ab47343efafcb4f93ab7c5a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*iX97K_LaasIYpWMDHBEedw.png"/></div><figcaption class="ls lt et er es lu lv bd b be z dx nd di ne nf translated">CSS文件修改前后</figcaption></figure></div><p id="ea20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注释</strong></p><ul class=""><li id="42d5" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">Chrome并不总是加载最新的CSS文件，因此当你在浏览器中打开它时，最近的更改可能不会反映在应用程序中。要确认浏览器是否使用最新版本，请在开发者工具的<code class="du lc ld le lf b">Sources</code>标签下找到CSS文件，并检查最近的更改是否反映在显示的文件中。</li></ul><figure class="lh li lj lk fd ll er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es ng"><img src="../Images/0ae4de6e2c4b0c50717c68de518ab810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HlVE_id7sBv7On5nDMBm8g.png"/></div></div></figure><ul class=""><li id="8249" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">虽然我们主要修改了应用程序的颜色属性，但是使用这种方法，所有的CSS属性，比如文本颜色，字体等等都可以被修改。</li><li id="15cb" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">要查看UI元素在不同状态下的行为，可以使用<code class="du lc ld le lf b">Toggle Element state</code>选项将元素的状态强制设置为<code class="du lc ld le lf b">hover</code>、<code class="du lc ld le lf b">active</code>、<code class="du lc ld le lf b">focus</code>等。</li></ul><figure class="lh li lj lk fd ll er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es nh"><img src="../Images/64679eaa4c4c4a1c8001bc0b995ba180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hMGSU0__AbhRTx5N_cgzNw.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx translated">为UI元素设置不同的状态</figcaption></figure><ul class=""><li id="77ad" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">在某些情况下，需要为特定的元素单独设置CSS属性，而不是同一类型的所有实例。在这种情况下，我们可以将这些UI元素分配给特定的类，然后定义特定于该类的属性。在给定的例子中，我们定义了一个名为<code class="du lc ld le lf b">tabsetClass</code>的定制类，并专门为它定义了属性。</li></ul><figure class="lh li lj lk fd ll er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es ni"><img src="../Images/0429c70db8baa6b342898e26e330814f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rdrGWfGkRZO6QNv-UCcf1A.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx translated">为自定义类设置CSS属性</figcaption></figure></div></div>    
</body>
</html>