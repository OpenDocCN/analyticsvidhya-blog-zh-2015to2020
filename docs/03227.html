<html>
<head>
<title>How no. of cores and amount of memory of the executors can impact the performance of the Spark jobs?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">执行器的核心数量和内存量如何影响Spark作业的性能？</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-no-of-cores-and-amount-of-memory-of-the-executors-can-impact-the-performance-of-the-spark-276cf58900a3?source=collection_archive---------9-----------------------#2020-01-21">https://medium.com/analytics-vidhya/how-no-of-cores-and-amount-of-memory-of-the-executors-can-impact-the-performance-of-the-spark-276cf58900a3?source=collection_archive---------9-----------------------#2020-01-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f6eaaf3bd0b2e8c258ac68495af3f43c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8ONolzAjEVx8WfD0"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">利亚姆·布里斯在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="8372" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当我们处理大量数据时，我们显然会寻找并行性，以便能够快速处理数据，但有时更多的并行性会导致问题，有时会成为瓶颈并影响作业的性能。</p><p id="90e4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们通过一个例子来理解这一点。假设我们有一个8节点集群，每个集群有112 GB RAM和16个内核。首先，当我们将工作提交给集群时，我们脑海中很少出现以下问题。</p><blockquote class="jt ju jv"><p id="0f0c" class="iv iw jw ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated">-我们将如何选择合适的执行人数量来提交工作？<br/> -每个执行器应该使用多少个内核？<br/> -每个遗嘱执行人的记忆应该是怎样的？<br/> -最多可以并行运行多少个任务？</p></blockquote><p id="73b2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这些是我们在提交作业时需要考虑的几个问题，因为这会对作业的性能产生很大影响。提交带有不正确的群集中执行器数量和执行器配置的作业有时会占用本应在几分钟或几小时内完成的作业的时间。</p><p id="89fe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们继续并理解为什么这些问题如此重要。第一个问题是——我们如何选择合适的执行者数量来提交作业？现在，这完全取决于我们希望每个执行器有多少个内核。根据经验，研究人员发现，我们可以为每个执行器获取2到5个最大内核，如果我们使用这个数量，那么将获得最佳性能。我将在这篇博客的后面解释为什么为一个执行器选择正确的内核数量是如此重要。</p><p id="4150" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">基本上，核心数量决定了每个执行器可以并行运行的任务数量。例如，如果我为每个执行器分配了5个内核，这意味着我可以为执行器分配5个并行任务。现在，如果我想要最大的并行性，我将为每个执行器选择5个内核，这就回答了我的第二个问题，但是我们可以选择2到5个内核，为执行器选择5个内核总是正确的吗？我们以后会知道的。暂时让我们考虑一下我们采用5个内核。</p><p id="3230" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们知道每个节点有16个内核，我们希望每个执行器有5个内核，那么每个节点有3个执行器(16/3 ~ 5)，每个执行器有5个内核。(在这里，我们还需要考虑执行程序对线程和操作系统的要求，但在我们的情况下，考虑到我们有一些额外的内核和内存，我避免了这一点。)所以现在我们已经找到了每个节点的执行器总数和每个执行器所需的内核数。</p><p id="223d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在第三个问题，每个遗嘱执行人的记忆应该是怎样的？我们需要为每个执行程序分配内存，可以在三个执行程序之间平均分配112/3 ~ 36</p><p id="5fa5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们每个执行器都有36 GB内存和5个内核。</p><p id="fa69" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们来看下一个问题，可以并行运行的最大任务数是多少？这完全取决于执行器中有多少个内核。在我们当前的配置中，我们有5个内核，这意味着我们最多可以并行运行5个任务，36 GB ram将平均分配用于执行这5个任务。</p><p id="8622" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，每个任务将获得36/5 ~ 7 GB的内存。</p><p id="22b8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们每个任务都有7 GB内存。因为每个节点总共有3个执行器，总共有8个节点，这意味着我们最多有5*3*8 =&gt; 120个任务。</p><p id="de0c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在考虑这样一个场景:任务正在运行，每个任务的数据超过7 GB，资源管理器无法提供更多的RAM，因为executor总共有36 GB的RAM。这将导致数据溢出到磁盘上。现在，从spark的性能来看，将数据从RAM溢出到磁盘是一个非常昂贵的场景。虽然我们有5个任务来实现并行性，但这种溢出会降低性能。在这种场景调整中，配置可以显著提高作业的性能。</p><p id="e855" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们看到执行器的旧配置，因为我们希望有更多的并行性，我们为每个执行器配备了5个内核，因此每个执行器现在获得了7 GB RAM，因为我们在我们的场景中观察到RAM不足，所以我们将数据溢出到磁盘并进行处理。我们应该减少内核的数量，这样executor中的任务就可以有更多的内存。</p><p id="430d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们取4个核心。现在，如果这里有4个内核，35 GB RAM将在4个内核之间分配，因此每个内核将获得大约9 GB RAM。这意味着我们现在将有4个并行任务，每个任务可以处理大约8GB的数据。</p><p id="cf5d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，选择正确的内核数量有时很棘手。当我们设置执行程序的内存和内核数量时，我们应该对数据量有一个估计。此外，经过一段时间后，当数据量增加时，我们需要对执行器进行必要的修改，以适应这些变化。</p></div></div>    
</body>
</html>