<html>
<head>
<title>Part two: Continuously collect LIVE data from a REST API using AWS Cloud9 and Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第二部分:使用AWS Cloud9和Lambda从REST API持续收集实时数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/part-two-continuously-collect-live-data-from-a-rest-api-using-aws-cloud9-and-lambda-542a9d753528?source=collection_archive---------12-----------------------#2020-01-30">https://medium.com/analytics-vidhya/part-two-continuously-collect-live-data-from-a-rest-api-using-aws-cloud9-and-lambda-542a9d753528?source=collection_archive---------12-----------------------#2020-01-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/477319333f63fa320297f084a0824052.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*G2_ma1Jtkw3VhsZT"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">米卡·鲍梅斯特在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="23f1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">提醒:这是两部分系列的一部分。如果你需要参考它，第一部分可以在这里找到</em><a class="ae iu" rel="noopener" href="/@bickell.taylor/part-one-create-a-schema-and-tables-within-a-postgresql-database-to-support-data-collection-from-5c25a7db1ad4"><em class="jt"/></a><em class="jt">。</em></p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="597d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">无服务器是一个吸引人的选择，也是某些项目的最佳方向。无缝的可扩展性、更少的管理和按消费付费的模式是它吸引人的几个原因。亚马逊网络服务(AWS)已经开发了一套有吸引力的产品，通过Cloud9和Lambda等产品来满足无服务器计算。</p><p id="6066" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当谈到持续收集和自动化数据收集时，AWS RDS、Cloud9和Lambda被证明是一个有效的组合。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="8f5d" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated"><strong class="ak">自动气象站云9 </strong></h2><p id="fcfc" class="pw-post-body-paragraph iv iw hi ix b iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo la jq jr js hb bi translated">Cloud9是一个基于云的IDE，非常适合无服务器开发。它预装了python等流行编程语言的基本工具，显然是开始构建项目的好地方。</p><p id="860f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> <em class="jt">如何创建Cloud9环境？</em> </strong></p><h2 id="6f9b" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated"><strong class="ak">步骤1——如果你还没有在AWS控制台中，在这里登录</strong><a class="ae iu" href="https://signin.aws.amazon.com/signin?redirect_uri=https%3A%2F%2Fconsole.aws.amazon.com%2Fconsole%2Fhome%3Fnc2%3Dh_ct%26src%3Dheader-signin%26state%3DhashArgs%2523%26isauthcode%3Dtrue&amp;client_id=arn%3Aaws%3Aiam%3A%3A015428540659%3Auser%2Fhomepage&amp;forceMobileApp=0" rel="noopener ugc nofollow" target="_blank"><strong class="ak"/></a><strong class="ak">。找到并选择Cloud9服务。您应该会看到这样的页面。</strong></h2><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/76d1f9fe78ef87f05f284f5ad2885dbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5GCoyX0OJXVBS8L3SK7mzA.png"/></div></div></figure><h2 id="dba1" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated"><strong class="ak">步骤2-要开始创建环境，请单击“创建环境”继续为环境提供一个名称。如果你想添加描述，你可以，但它是可选的。完成后，选择“下一步”</strong></h2><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lg"><img src="../Images/041220ae03f4b85e095d3e571c646c2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aVNPPAGet4NQiKes4hCEmQ.png"/></div></div></figure><h2 id="b099" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated"><strong class="ak">第3步-确保您已经配置了环境的设置，以匹配下面显示的内容。验证完成后，单击“下一步”。</strong></h2><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/c4b2ac8514dcd51d2765ef4c2e7e59a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oPjNgC-qwcjYMRRPrxN6dQ.png"/></div></div></figure><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/5039bc31613b5c7df00a9dc8d04325b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yYzhVzHJUu3v17q5N3tn2g.png"/></div></div></figure><h2 id="f864" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated"><strong class="ak">步骤4-最后检查环境设置，确认后选择“创建环境”。</strong></h2><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/686787a6c2c2e66c2ea9fa4de01d3522.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nik5iczs5lr_-LFMVsgDEg.png"/></div></div></figure><h2 id="fcb6" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated"><strong class="ak">第5步-创建Cloud9环境可能需要几分钟时间。然而，一旦成功创建了环境，您应该会被引导到一个类似如下所示的页面。欢迎来到您的Cloud9环境。😁</strong></h2><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/cbd201298ea43fce6e745221527bf82a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yzkNV67W1z7umez_CAnzSg.png"/></div></div></figure><h2 id="9da6" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated"><strong class="ak">AWS Lambda的AWS cloud 9</strong></h2><h2 id="2d48" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated"><strong class="ak">第一步——现在是时候在Cloud9中创建一个Lambda函数了。你应该看到“创建Lambda函数…”位于屏幕的左中央。直接参考上面最后一步中的图像可能会有所帮助。点击</strong>“创建Lambda函数……”<strong class="ak">，你将进入一个屏幕，提示Lambda函数的名称。完成后，单击“下一步”。</strong></h2><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/1566487b336bf71248bbdf51deadeb27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PjO4VqBgfvp2F122jvnUzw.png"/></div></div></figure><h2 id="a7cc" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated"><strong class="ak">步骤2——我将为我的函数选择的蓝图是“empty-python”这可能会因您试图创建的语言和功能而异。选择蓝图后，单击“下一步”</strong></h2><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/9cb7736dc6ad8372ddd5548fee647e47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YXo9qW4OLHSo6cGRsu77cQ.png"/></div></div></figure><h2 id="8265" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated"><strong class="ak">第3步——这个时候，我们就不用担心函数触发器了。选择“下一步”继续。</strong></h2><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/5a47c89af23e7c19d284009e5569eb23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mAQ-xRi8_DnvTQ60YMMb1A.png"/></div></div></figure><h2 id="2402" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated"><strong class="ak">步骤4-内存和角色的默认设置足以完成此处的任务，单击“下一步”</strong></h2><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/654504fe15f6126a5295580e00b09577.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oc9U2CElVetfqs5gO7sN9Q.png"/></div></div></figure><h2 id="1e3a" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated"><strong class="ak">步骤5-在选择“完成”之前，最后一次检查功能设置</strong></h2><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/d601dfb476698a37ebdcc467e39ed932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TpadtrO02s17kkhl4nNGxw.png"/></div></div></figure><h2 id="6693" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated"><strong class="ak">第6步-当您选择“完成”时，您应该会看到如下所示的屏幕。Lambda函数已成功创建。</strong></h2><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/60fb86aff98615b24a45c8f4b84cfba7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0nw4Gxsv244-TMfbSAvmxg.png"/></div></div></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="84c2" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated"><strong class="ak"> <em class="lk"> Lambda函数示例(从Cryptowatch API中收集OHLC数据)</em> </strong></h2><p id="18b0" class="pw-post-body-paragraph iv iw hi ix b iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo la jq jr js hb bi translated"><strong class="ix hj">基于我用来从Cryptowatch API收集数据的Lambda函数，在部署之前需要安装一些包。要正确执行此操作，请右键单击外部文件夹。我的文件夹名为“插入数据”</strong></p><figure class="lc ld le lf fd ij er es paragraph-image"><div class="er es ll"><img src="../Images/4c7b7016331889f53879a27c0e162d05.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*byaO8lhDx4bWnQQeSDj40g.png"/></div></figure><p id="042a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">选择菜单底部的“在此打开终端”。</strong></p><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/dc73f2e46ec83954cc780c0abe503924.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*jkTEFZyxEVJTxG2Z2mQhDA.png"/></div></div></figure><p id="c617" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">关闭页面下半部分打开的终端，将新终端拖到旧终端所在的位置。完成后，在终端中键入命令</strong> <code class="du ln lo lp lq b"><strong class="ix hj">source venv/bin/activate</strong></code> <strong class="ix hj">。然后按键盘上的“回车”键。</strong></p><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/c5bb11d9a285827205e2df6a99c66885.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_K2dq-yEZvRnJwY2DX2OEw.png"/></div></div></figure><p id="bd38" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">为了执行该功能，特别需要安装两个包:</strong> <code class="du ln lo lp lq b"><strong class="ix hj">psycopg2-binary</strong></code> <strong class="ix hj">和</strong> <code class="du ln lo lp lq b"><strong class="ix hj">requests</strong></code> <strong class="ix hj">。我会安装它们。</strong></p><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/48cbd2eeb9d5eae9fa8a61cedeefb638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0DJ9K5w0Qhi_6XVqHRckgA.png"/></div></div></figure><p id="a0a5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">安装完上面的包后，我将Lambda函数的代码输入到</strong> <code class="du ln lo lp lq b"><strong class="ix hj">lambda_function.py</strong></code> <strong class="ix hj">文件中。一旦您安装了必要的包并且您的代码包含在。py文件，Lambda函数就可以部署了。</strong></p><p id="ea32" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我使用的Lambda函数的完整代码可以直接在下面找到。</p><figure class="lc ld le lf fd ij"><div class="bz dy l di"><div class="lr ls l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://gist.github.com/tcbic/1ba9b96f8d122f1725b1ac1066d6c7b0" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/TC BIC/1 ba 9 b 96 F8 d 122 f 1725 B1 AC 1066 d6c 7 b 0</a></figcaption></figure><p id="c632" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">关于设置Cloud9环境和部署Lambda功能的更多详细信息，我建议看看这篇文章</em> <a class="ae iu" rel="noopener" href="/analytics-vidhya/how-to-create-an-aws-lambda-function-in-cloud9-86255e456747"> <em class="jt">这里</em> </a> <em class="jt">。除了关于如何部署Lambda函数的更多细节，还讨论了关于配置事件触发器的信息，这是自动化数据收集的一个重要部分。</em></p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="70c2" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated"><strong class="ak">验证数据是否被插入PostgreSQL数据库</strong></h2><p id="e13b" class="pw-post-body-paragraph iv iw hi ix b iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo la jq jr js hb bi translated">您可以在pgAdmin中验证数据是否被直接插入到数据库中，但是，下面是一个使用python和SQL代码的查询示例，该示例可以在Jupyter或Google Colab笔记本中运行，以检查和确认最新的数据库条目。</p><pre class="lc ld le lf fd lt lq lu lv aw lw bi"><span id="9380" class="kb kc hi lq b fi lx ly l lz ma"># Define credentials.</span><span id="de17" class="kb kc hi lq b fi mb ly l lz ma">credentials = {"POSTGRES_ADDRESS" : "example.xxxxxxxxxxxx.us-east-1.rds.amazonaws.com",<br/>               "POSTGRES_PORT" : "5432", <br/>               "POSTGRES_USERNAME" : "test123",<br/>               "POSTGRES_PASSWORD" : "xxxxxxxxx",<br/>               "POSTGRES_DBNAME" : "example",<br/>               "API_KEY" : "xxxxxxxxxxxxxxxxxxxx"}</span><span id="9233" class="kb kc hi lq b fi mb ly l lz ma"># Import statements</span><span id="c472" class="kb kc hi lq b fi mb ly l lz ma">import psycopg2 as ps</span><span id="f77d" class="kb kc hi lq b fi mb ly l lz ma"># Establish a connection to the database.<br/><br/>conn = ps.connect(host=credentials['POSTGRES_ADDRESS'],<br/>                  port=credentials['POSTGRES_PORT'],<br/>                  user=credentials['POSTGRES_USERNAME'],<br/>                  password=credentials['POSTGRES_PASSWORD'],<br/>                  database=credentials['POSTGRES_DBNAME'])<br/><br/># Create a cursor.<br/>  <br/>cur = conn.cursor()<br/><br/># Create and execute a query to get the most recent 50 rows.<br/><br/>query = '''SELECT * FROM example1.coinbase_pro_eth_btc ORDER BY closing_time DESC LIMIT 50;'''<br/><br/>cur.execute(query)<br/><br/>recent_50_rows = cur.fetchall()<br/>  <br/>conn.commit()<br/><br/>for row in recent_50_rows:<br/>    print(row)<br/>       <br/>conn.close()</span></pre><p id="a5d1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">运行上面的代码将为<code class="du ln lo lp lq b">example1</code>模式中的<code class="du ln lo lp lq b">coinbase_pro_eth_btc</code>表打印PostgreSQL数据库中最近的50个烛台。您需要确保模式和表名与您在数据库中输入的相匹配。</p><p id="bf85" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">注意:在这种情况下，关闭时间为纪元时间。要把时间转换成更人类可读的格式，我推荐这个</em> <a class="ae iu" href="https://www.epochconverter.com/" rel="noopener ugc nofollow" target="_blank"> <em class="jt">网站</em> </a> <em class="jt">。</em></p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="d9d6" class="mc kc hi bd kd md me mf kh mg mh mi kl mj mk ml ko mm mn mo kr mp mq mr ku ms bi translated">主要成就👏</h1><p id="4e2e" class="pw-post-body-paragraph iv iw hi ix b iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo la jq jr js hb bi translated"><strong class="ix hj"> </strong>创建一个AWS Cloud9环境。</p><p id="4d6e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> </strong>在Cloud9内创建一个Lambda函数。</p><p id="0242" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> </strong>使用python和SQL代码验证数据是否被插入PostgreSQL数据库。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="5d16" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我很乐意连接！找到我最好的地方是在LinkedIn上。:)</p></div></div>    
</body>
</html>