<html>
<head>
<title>MakeYourOwn Covid-19 RealTime Data with Google Alerts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用谷歌快讯制作你自己的新冠肺炎实时数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/makeyourown-covid-19-realtime-data-with-google-alerts-e7ec70970cab?source=collection_archive---------10-----------------------#2020-03-22">https://medium.com/analytics-vidhya/makeyourown-covid-19-realtime-data-with-google-alerts-e7ec70970cab?source=collection_archive---------10-----------------------#2020-03-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4c00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">直奔主题——希望生成一个关于新型冠状病毒的实时知识反馈，就像它发生的那样。<br/>首先，配置Google Alerts — <br/>点击【https://www.google.com/alerts】的<a class="ae jd" href="https://www.google.com/alerts" rel="noopener ugc nofollow" target="_blank">并登录。输入您想要配置这些警报的文本</a></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/74e5cc281a7ec22d1eaa4000bd5429b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*W4MeoM57r1qD9THqzuprPA.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">去寻找完全匹配的词，如冠状病毒，新冠肺炎等。</figcaption></figure><p id="8ee3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">配置好警报后，看起来像是:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jq"><img src="../Images/f636157c0d882d312220e13f4af561e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*z5Kld3jeSrzXeTmWMxk2_w.png"/></div></figure><p id="d85b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你创建一个提醒时，进入“显示选项”并确保你有以下设置:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jr"><img src="../Images/3ad411c66758cbf2f2532c9b70933efb.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*BfGaTUgTJFQ9mlAVKM6KxQ.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">在“发送至”部分—选择您的“电子邮件id ”,然后单击“创建提醒”</figcaption></figure><p id="581d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> #ShowMeTheCode </strong> B-) : <br/>接下来几个简单的步骤，通过web请求检索这些提醒。右键单击打开“检查元素”部分，如下所示，并移动到“网络”选项卡。查找“xhr ”,然后点击/单击那里。可选地单击“垃圾桶”图标有助于使其看起来像:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es js"><img src="../Images/b7adf41dea6e4c82b3e7da08c4b938af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PbjXx3P475GnCQUNIYC5qQ.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">我在Mozilla Firefox、谷歌Chrome开发工具上做这个，可能类似或有点细微差别。</figcaption></figure><p id="c29d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">单击任一警报。比方说我点击“冠状病毒”，我看到网络选项卡如下，接下来:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es jx"><img src="../Images/68de841bbfd58614e3273b538213a75d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MgifmmlIG8IMkGhplN_Aog.png"/></div></div></figure><p id="4d9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你看，在正常情况下，你在“新闻”下面看到的是用蓝色高亮显示的“GET”方法请求的响应。</p><p id="0e18" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">右键单击它。并查找“复制为卷曲”。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es jy"><img src="../Images/b93f6fe054385fac23e455030ce1028e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H_1Wk8j-9p0UmZcMMsRtEA.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">您看到的头、Cookies和参数都被压缩成一个cURL请求，我们刚刚为这个GET请求复制了这个请求。这个请求为我们带来了所示的响应。</figcaption></figure><p id="487e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">蟒蛇男？我也是——哦，天哪！这些<a class="ae jd" href="https://pypi.org/project/galerts/" rel="noopener ugc nofollow" target="_blank"> galerts </a>和<a class="ae jd" href="https://pypi.org/project/google-alerts/" rel="noopener ugc nofollow" target="_blank"> googlealerts </a> python包，它们就是不工作。至少对我来说不是。无论如何，这是一个简单的提醒！</p><p id="ac6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一个方便的在线工具是“cURL to <a class="ae jd" href="https://pypi.org/project/requests/" rel="noopener ugc nofollow" target="_blank"> Python Requests </a>”转换器。启动<a class="ae jd" href="https://curl.trillworks.com/" rel="noopener ugc nofollow" target="_blank">https://curl.trillworks.com/</a>将复制的cURL请求转换成Python请求库代码。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es jz"><img src="../Images/6b9fef5a89c985013156a64170d906de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mXJJazdx26j_OoLnl50yVQ.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">下面没有显示文本，只是复制并粘贴cURL命令下的teh cURL，并查找右边的“Python请求”部分</figcaption></figure><p id="9e39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">试着将“Cookies”、“Headers”、“Params”部分与前面提到的“Inspect Element”网络标签中的部分区分开来，你就会意识到web请求是如何被制作成python源代码的。</p><p id="4b7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意Python请求部分的“params”元组——向下滚动就会发现。那里的1584868878，实际上是当前的纪元时间。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ka"><img src="../Images/8e02bc5d671d1e01e9925b1b4c63bca1.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*XF5p49J4IfZjbZswKXv4_g.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">保持其他参数不变。我们基本上需要明智地选择我们的时间纪元，以匹配当前的时间戳，即感兴趣的时间。</figcaption></figure><p id="23ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在python中，内置了“时间”包，您可以获得当前的时间戳，在我带您浏览时启动python shell:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kb"><img src="../Images/8287289af255bee090c7b166c0999c86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*59yTPkC2iuLlFYQ-Hxe-PQ.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">你在这里得到的这个值是当前的时间戳纪元，你可以在:<a class="ae jd" href="https://www.epochconverter.com/" rel="noopener ugc nofollow" target="_blank">https://www.epochconverter.com/</a>中输入这个纪元值来验证</figcaption></figure><p id="4439" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您至少已经完成了Google Alerts检索，只需粘贴代码片段就可以让我们进入同一页面:</p><pre class="jf jg jh ji fd kc kd ke kf aw kg bi"><span id="fbb1" class="kh ki hi kd b fi kj kk l kl km">import requests<br/>import time</span><span id="31ed" class="kh ki hi kd b fi kn kk l kl km">cookies = {//your cookies under the “python request” section in curl.trillworks.com tab}</span><span id="a149" class="kh ki hi kd b fi kn kk l kl km">headers={//your headers under the “python request” section in curl.trillworks.com tab}</span><span id="85cd" class="kh ki hi kd b fi kn kk l kl km">params = (<br/> (‘params’, ‘[null,null,%s,604800]’%(int(time.time()))),<br/> (‘s’, ‘&lt;value-for-this-under-curl.trillworks.com tab python section&gt;’),<br/>)</span><span id="a6c7" class="kh ki hi kd b fi kn kk l kl km">response = requests.get(‘<a class="ae jd" href="https://www.google.co.in/alerts/history'" rel="noopener ugc nofollow" target="_blank">https://www.google.co.in/alerts/history'</a>, <br/>headers=headers, params=params, cookies=cookies)</span><span id="466e" class="kh ki hi kd b fi kn kk l kl km">print(response.contents)</span></pre><p id="4261" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个“response.contents”在打印时将显示一个很长的html，从中可以找到所有这些警报。诀窍是通过用int(time.time())替换“params”中的第三个参数来获得最新的警报，即当前纪元时间。</p><p id="b21b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">接下来的回应是什么？</strong> <br/>到目前为止，我们已经自动检索了警报。但是这个响应还是一个html，我们需要从中解析/挖掘所需的属性。我相信，挖掘新闻来源、网络链接、标题和文本应该是一个很好的开始。我们开始吧！</p><p id="e5ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确保你已经安装了Python包、<a class="ae jd" href="https://pypi.org/project/bs4/" rel="noopener ugc nofollow" target="_blank">bs4</a>/<a class="ae jd" href="https://pypi.org/project/beautifulsoup4/" rel="noopener ugc nofollow" target="_blank">beautiful soup 4</a>和<a class="ae jd" href="https://pypi.org/project/lxml/" rel="noopener ugc nofollow" target="_blank"> lxml </a>。你可以这样安装:pip安装&lt;包名&gt;</p><p id="b676" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然您可能尝试在另一个在线实用程序中粘贴和格式化“response . contents:<a class="ae jd" href="https://jsonformatter.org/xml-parser" rel="noopener ugc nofollow" target="_blank">https://jsonformatter.org/xml-parser</a>我有以下代码片段来帮助您解析我们想要的内容:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es ko"><img src="../Images/7956972d92cfc107f1ff53b8742d0b91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HnLp4bxRYMhtMqjQ0dYABg.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">这将使您将这些警报的详细信息写入csv文件，以“；”分隔分号。</figcaption></figure><p id="e369" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看起来像这样:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es kp"><img src="../Images/4d07bae071b25bf4621223af348268e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d2NtxvEgV7t4nVkwK7NTig.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">我们打印警报的CSV文件。</figcaption></figure><p id="571a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很好。很容易。搞定了。<br/>虽然这是一篇博客要涵盖的大量工作，特别是对于python /编码新手来说，但这仅仅是开始，我们期待将它扩展到:</p><p id="a1c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">&gt;<em class="kq">自动化google alerts获取</em>:一个cron-job或一个调度的工作流来保持获取警报，并附加或创建每日CSV。</p><p id="39ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">&gt;<em class="kq">重复数据删除</em>:下一次当您运行它时，它可能不仅会获取更新的提醒，还会带来这些已经处理过的旧的google提醒。我们可以根据标题哈希来维护提取/处理的警报，并且在我们的迭代中只支持delta / new google alerts，这可能是“检索关于新冠肺炎/冠状病毒的google alerts”的v2.0版本，采用了本博客中描述的策略。</p><p id="8132" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">&gt;超越数据，深入洞察:可视化、文本挖掘，因为我们也将html解析扩展到新闻源链接，等等。这将使它成为一个成熟的工具，具有强大的功能和实用性，每个数据组织现在都试图受益于对冠状病毒和事态的见解！</p><p id="d035" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">敬请关注！</p></div></div>    
</body>
</html>