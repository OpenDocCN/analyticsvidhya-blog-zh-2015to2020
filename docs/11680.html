<html>
<head>
<title>SparkSQL and DataFrame (High Level API) Basics using Pyspark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Pyspark的SparkSQL和DataFrame(高级API)基础知识</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/sparksql-and-dataframe-high-level-api-basics-using-pyspark-eaba6acf944b?source=collection_archive---------5-----------------------#2020-12-14">https://medium.com/analytics-vidhya/sparksql-and-dataframe-high-level-api-basics-using-pyspark-eaba6acf944b?source=collection_archive---------5-----------------------#2020-12-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f8db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上一篇文章中，我们讨论了Spark RDDs，它是Spark core的基础部分(非结构化)。在本文中，我们将研究Spark核心的结构化部分；SparkSQL和DataFrames。SparkSQL是Spark中也使用数据帧处理结构化数据的模块。</p><h1 id="c7ac" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">数据帧</h1><p id="50fc" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">DataFrame是由行组成的结构化数据集合，分布在Spark的工作节点(执行器)上。基本上，数据帧就像关系数据库中的表，有自己的模式和标题。</p><p id="3d3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据帧由不同数据格式(如文件、csv、json)创建的数据行组成..)或者Spark自己的RDDs。</p><p id="4108" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将解释使用PySpark API对Spark数据帧进行的重要查询操作。让我们从创建一个数据帧开始。</p><h1 id="3b63" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">创建数据框架</h1><p id="d239" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">数据帧可以从txt、csv、json和parquet文件格式创建，也可以从现有的rdd创建。让我们从创建RDD的DataFrame开始；</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="dde8" class="kp je hi kl b fi kq kr l ks kt">from pyspark.sql.types import Row</span><span id="4949" class="kp je hi kl b fi ku kr l ks kt">list_rdd=sc.parallelize([('Messi',33),('Ronaldo',35),('Salah',28),('Neymar',28),('Mbappe',21)])<br/><br/>players = list_rdd.map(lambda x: Row(name=x[0], age=int(x[1])))</span><span id="072a" class="kp je hi kl b fi ku kr l ks kt">players_df = spark.createDataFrame(players)</span><span id="60dd" class="kp je hi kl b fi ku kr l ks kt">players_df.show()</span><span id="55fe" class="kp je hi kl b fi ku kr l ks kt">+-------+---+<br/>|   name|age|<br/>+-------+---+<br/>|  Messi| 33|<br/>|Ronaldo| 35|<br/>|  Salah| 28|<br/>| Neymar| 28|<br/>| Mbappe| 21|<br/>+-------+---+</span></pre><p id="6741" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们从不同类型的文件格式创建数据帧；</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="4af3" class="kp je hi kl b fi kq kr l ks kt">dataframe_json = spark.read.json('data\json_data.json')<strong class="kl hj"> </strong></span><span id="dfee" class="kp je hi kl b fi ku kr l ks kt">dataframe_txt = spark.read.text('data\text_data.txt')<strong class="kl hj"> </strong></span><span id="5ca6" class="kp je hi kl b fi ku kr l ks kt">dataframe_csv = spark.read.csv('data\csv_data.csv')<strong class="kl hj"> </strong></span><span id="9ac1" class="kp je hi kl b fi ku kr l ks kt">dataframe_parquet = spark.read.load('data\parquet_data.parquet')</span></pre><p id="e4a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">既然我们已经学习了如何创建数据帧，我们可以通过使用示例数据集来深入研究一些重要的数据帧方法。</p><p id="d32f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们将从用于检查数据帧中的数据的方法开始。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="799f" class="kp je hi kl b fi kq kr l ks kt">df= spark.read\<br/>.option('header','true')\<br/>.option('inferschema','true')\<br/>.csv('data\customers.csv')</span></pre><h2 id="95ab" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated"><strong class="ak">显示()</strong></h2><p id="0b14" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">函数的作用是:显示数据帧的内容，包括前20行。另外，show(n)方法返回DataFrame的前n行。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="e776" class="kp je hi kl b fi kq kr l ks kt">df.show(5)</span><span id="c513" class="kp je hi kl b fi ku kr l ks kt">+---+---------+---+------------+----------+------+<br/>| id|firstname|age|        city|profession|salary|<br/>+---+---------+---+------------+----------+------+<br/>|100|  Brianna| 32|San Fernando|    doctor|  1540|<br/>|101|  Mariele| 18|       Cairo| developer|  5800|<br/>|102|   Marnia| 30|        Baku| developer|  7136|<br/>|103|  Riannon| 56|Philadelphia|    doctor|  4986|<br/>|104|    Paule| 25|      Taipei|  engineer|  6553|<br/>+---+---------+---+------------+----------+------+<br/>only showing top 5 rows</span></pre><h2 id="298a" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated"><strong class="ak"> printSchema() </strong></h2><p id="b1d5" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">函数的作用是:以树的形式打印数据帧的模式。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="6423" class="kp je hi kl b fi kq kr l ks kt">df.printSchema()</span><span id="9915" class="kp je hi kl b fi ku kr l ks kt">root<br/> |-- id: integer (nullable = true)<br/> |-- firstname: string (nullable = true)<br/> |-- age: integer (nullable = true)<br/> |-- city: string (nullable = true)<br/> |-- profession: string (nullable = true)<br/> |-- salary: integer (nullable = true)</span></pre><h2 id="1e6f" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">计数()</h2><p id="cfbd" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">count()函数计算DataFrame中的行数。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="3d1f" class="kp je hi kl b fi kq kr l ks kt">df.count()</span><span id="af3c" class="kp je hi kl b fi ku kr l ks kt">100</span></pre><h2 id="8bb2" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">列()</h2><p id="6351" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">columns()函数返回DataFrame的列。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="70e8" class="kp je hi kl b fi kq kr l ks kt">df.columns()</span><span id="64d6" class="kp je hi kl b fi ku kr l ks kt">['id', 'firstname', 'age', 'city', 'profession', 'salary']</span></pre><h2 id="a61e" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">描述()</h2><p id="b237" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">describe(n)函数计算DataFrame中选定的(n)列的汇总统计信息。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="bd9a" class="kp je hi kl b fi kq kr l ks kt">df.describe("age","salary").show()</span><span id="9f12" class="kp je hi kl b fi ku kr l ks kt">+-------+------------------+------------------+<br/>|summary|               age|            salary|<br/>+-------+------------------+------------------+<br/>|  count|               100|               100|<br/>|   mean|             41.87|           4788.18|<br/>| stddev|14.444358585603409|2042.7282577351048|<br/>|    min|                17|              1051|<br/>|    max|                65|              7985|<br/>+-------+------------------+------------------+</span></pre><p id="c7fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，我们已经学习了许多用于检查数据的函数。现在我们可以继续查询操作。</p><h2 id="5827" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">选择()</h2><p id="5ee6" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">select()函数只显示数据帧中选定的一列或多列。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="e9f8" class="kp je hi kl b fi kq kr l ks kt">df.select("firstname","age").show(5)</span><span id="c5c7" class="kp je hi kl b fi ku kr l ks kt">+---------+---+<br/>|firstname|age|<br/>+---------+---+<br/>|  Brianna| 32|<br/>|  Mariele| 18|<br/>|   Marnia| 30|<br/>|  Riannon| 56|<br/>|    Paule| 25|<br/>+---------+---+</span></pre><h2 id="432b" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">当()</h2><p id="8005" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">when()函数根据我们要求的指定列的条件显示选定的列和指定的事例。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="e8f8" class="kp je hi kl b fi kq kr l ks kt">df.select("firstName",when(df.age &gt; 30, 1).otherwise(0)).show(5)</span><span id="ae62" class="kp je hi kl b fi ku kr l ks kt">+---------+--------------------------------------+<br/>|firstName|CASE WHEN (age &gt; 30) THEN 1 ELSE 0 END|<br/>+---------+--------------------------------------+<br/>|  Brianna|                                     1|<br/>|  Mariele|                                     0|<br/>|   Marnia|                                     0|<br/>|  Riannon|                                     1|<br/>|    Paule|                                     0|<br/>+---------+--------------------------------------+</span></pre><h2 id="fd78" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">喜欢()</h2><p id="cee6" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">like()函数显示选定的列，并通过指定“真”或“假”来筛选出我们要寻找的条件。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="ff39" class="kp je hi kl b fi kq kr l ks kt">df.select("firstName",df.city.like("Baku")).show(5)</span><span id="dc40" class="kp je hi kl b fi ku kr l ks kt">+---------+--------------+<br/>|firstName|city LIKE Baku|<br/>+---------+--------------+<br/>|  Brianna|         false|<br/>|  Mariele|         false|<br/>|   Marnia|          true|<br/>|  Riannon|         false|<br/>|    Paule|         false|<br/>+---------+--------------+</span></pre><h2 id="ffa1" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">开始于()</h2><p id="4d33" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">函数的作用是:从指定列中第一个单词的开头开始搜索括号中的字母。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="4d25" class="kp je hi kl b fi kq kr l ks kt">df.select("firstName",df.profession.startswith("dev")).show(5)</span><span id="a53a" class="kp je hi kl b fi ku kr l ks kt">+---------+---------------------------+<br/>|firstName|startswith(profession, dev)|<br/>+---------+---------------------------+<br/>|  Brianna|                      false|<br/>|  Mariele|                       true|<br/>|   Marnia|                       true|<br/>|  Riannon|                      false|<br/>|    Paule|                      false|<br/>+---------+---------------------------+</span></pre><h2 id="78ff" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">端点()</h2><p id="19fd" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">函数的作用是:从指定列中最后一个单词的末尾开始搜索括号中的字母。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="0dcb" class="kp je hi kl b fi kq kr l ks kt">df.select("firstName",df.profession.endswith("er")).show(5)</span><span id="9f77" class="kp je hi kl b fi ku kr l ks kt">+---------+------------------------+<br/>|firstName|endswith(profession, er)|<br/>+---------+------------------------+<br/>|  Brianna|                   false|<br/>|  Mariele|                    true|<br/>|   Marnia|                    true|<br/>|  Riannon|                   false|<br/>|    Paule|                    true|<br/>+---------+------------------------+</span></pre><h2 id="3b50" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">子字符串()</h2><p id="3f9b" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">substring()函数从指定长度的列中提取子串。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="c061" class="kp je hi kl b fi kq kr l ks kt">df.select(df["firstName"].substr(1, 3).alias("name")).show(5)</span><span id="8e1e" class="kp je hi kl b fi ku kr l ks kt">+----+<br/>|name|<br/>+----+<br/>| Bri|<br/>| Mar|<br/>| Mar|<br/>| Ria|<br/>| Pau|<br/>+----+</span></pre><h2 id="f999" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">介于()</h2><p id="ed5a" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">between()函数在提供的条件之间过滤列。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="9c93" class="kp je hi kl b fi kq kr l ks kt">df.select("firstName",df.age.between(22, 28)).show(5)</span><span id="ee77" class="kp je hi kl b fi ku kr l ks kt">+---------+-----------------------------+<br/>|firstName|((age &gt;= 22) AND (age &lt;= 28))|<br/>+---------+-----------------------------+<br/>|  Brianna|                        false|<br/>|  Mariele|                        false|<br/>|   Marnia|                        false|<br/>|  Riannon|                        false|<br/>|    Paule|                         true|<br/>+---------+-----------------------------+</span></pre><p id="d78a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Spark高级API中还提供了添加、更新和删除列的功能。下面让我们来看看其中的一些功能。</p><h2 id="8163" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">withColumn()</h2><p id="9539" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">withcolumn()函数在现有数据帧中添加或替换列。它还可以用于转换数据帧中现有列的数据类型。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="7875" class="kp je hi kl b fi kq kr l ks kt">df.withColumn("yearly_salary",df.salary*12).show(5)</span><span id="b563" class="kp je hi kl b fi ku kr l ks kt">+---+---------+---+------------+----------+------+-------------+<br/>| id|firstname|age|        city|profession|salary|yearly_salary|<br/>+---+---------+---+------------+----------+------+-------------+<br/>|100|  Brianna| 32|San Fernando|    doctor|  1540|        18480|<br/>|101|  Mariele| 18|       Cairo| developer|  5800|        69600|<br/>|102|   Marnia| 30|        Baku| developer|  7136|        85632|<br/>|103|  Riannon| 56|Philadelphia|    doctor|  4986|        59832|<br/>|104|    Paule| 25|      Taipei|  engineer|  6553|        78636|<br/>+---+---------+---+------------+----------+------+-------------+</span><span id="1fc0" class="kp je hi kl b fi ku kr l ks kt"><br/>df.withColumn("yearly_salary",col("yearly_salary").cast("float"))\<br/>.show(5)</span><span id="e878" class="kp je hi kl b fi ku kr l ks kt">+---+---------+---+------------+----------+------+-------------+<br/>| id|firstname|age|        city|profession|salary|yearly_salary|<br/>+---+---------+---+------------+----------+------+-------------+<br/>|100|  Brianna| 32|San Fernando|    doctor|  1540|      18480.0|<br/>|101|  Mariele| 18|       Cairo| developer|  5800|      69600.0|<br/>|102|   Marnia| 30|        Baku| developer|  7136|      85632.0|<br/>|103|  Riannon| 56|Philadelphia|    doctor|  4986|      59832.0|<br/>|104|    Paule| 25|      Taipei|  engineer|  6553|      78636.0|<br/>+---+---------+---+------------+----------+------+-------------+</span></pre><h2 id="c564" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">withColumnRenamed()</h2><p id="2f9f" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">顾名思义，withColumnRenamed()函数重命名DataFrame的现有列。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="932b" class="kp je hi kl b fi kq kr l ks kt">df.withColumnRenamed("firstname","name").show(5)</span><span id="54a8" class="kp je hi kl b fi ku kr l ks kt">+---+-------+---+------------+----------+------+-------------+<br/>| id|   name|age|        city|profession|salary|yearly_salary|<br/>+---+-------+---+------------+----------+------+-------------+<br/>|100|Brianna| 32|San Fernando|    doctor|  1540|        18480|<br/>|101|Mariele| 18|       Cairo| developer|  5800|        69600|<br/>|102| Marnia| 30|        Baku| developer|  7136|        85632|<br/>|103|Riannon| 56|Philadelphia|    doctor|  4986|        59832|<br/>|104|  Paule| 25|      Taipei|  engineer|  6553|        78636|<br/>+---+-------+---+------------+----------+------+-------------+</span></pre><h2 id="6171" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">toDF()</h2><p id="261d" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">函数的作用是:返回一个新的数据帧，并对它的所有列进行重命名。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="3904" class="kp je hi kl b fi kq kr l ks kt">people.toDF("id_no", "name", "years_old","address","job","wage","yearly_wage").show(5)</span><span id="6812" class="kp je hi kl b fi ku kr l ks kt">+-----+-------+---------+------------+---------+----+-----------+<br/>|id_no|   name|years_old|     address|      job|wage|yearly_wage|<br/>+-----+-------+---------+------------+---------+----+-----------+<br/>|  100|Brianna|       32|San Fernando|   doctor|1540|      18480|<br/>|  101|Mariele|       18|       Cairo|developer|5800|      69600|<br/>|  102| Marnia|       30|        Baku|developer|7136|      85632|<br/>|  103|Riannon|       56|Philadelphia|   doctor|4986|      59832|<br/>|  104|  Paule|       25|      Taipei| engineer|6553|      78636|<br/>+-----+-------+---------+------------+---------+----+-----------+</span></pre><h2 id="c7b3" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">丢弃()</h2><p id="82b5" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">drop()函数从DataFrame中删除一个现有列。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="ef56" class="kp je hi kl b fi kq kr l ks kt">df.drop("yearly_salary").show(5)</span><span id="80e4" class="kp je hi kl b fi ku kr l ks kt">+---+---------+---+------------+----------+------+<br/>| id|firstname|age|        city|profession|salary|<br/>+---+---------+---+------------+----------+------+<br/>|100|  Brianna| 32|San Fernando|    doctor|  1540|<br/>|101|  Mariele| 18|       Cairo| developer|  5800|<br/>|102|   Marnia| 30|        Baku| developer|  7136|<br/>|103|  Riannon| 56|Philadelphia|    doctor|  4986|<br/>|104|    Paule| 25|      Taipei|  engineer|  6553|<br/>+---+---------+---+------------+----------+------+</span></pre><p id="fedc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们可以进行一些对数据分析非常有用的其他功能。在这里，我们将触及一些我们通常在pyspark中使用的流行元素。</p><h2 id="d5d1" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">groupBy()</h2><p id="0b1b" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">groupBy()函数根据相同的值将数据分成不同的组。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="b412" class="kp je hi kl b fi kq kr l ks kt">df.groupBy("age").count().show(5)</span><span id="63d2" class="kp je hi kl b fi ku kr l ks kt">+---+-----+<br/>|age|count|<br/>+---+-----+<br/>| 31|    1|<br/>| 65|    2|<br/>| 34|    1|<br/>| 28|    1|<br/>| 27|    1|<br/>+---+-----+</span></pre><h2 id="59bc" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">过滤器()</h2><p id="5bc1" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">filter()函数按要求的条件过滤数据。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="ac50" class="kp je hi kl b fi kq kr l ks kt">df.filter((df.age&gt;30 )&amp;(df.firstname.startswith("B"))).show(5))</span><span id="506e" class="kp je hi kl b fi ku kr l ks kt">+---+----------+---+------------+----------+------+-------------+<br/>| id| firstname|age|        city|profession|salary|yearly_salary|<br/>+---+----------+---+------------+----------+------+-------------+<br/>|100|   Brianna| 32|San Fernando|    doctor|  1540|        18480|<br/>|173|Bernardine| 54|     Chennai|  engineer|  5399|        64788|<br/>|198|    Babita| 41|    Chişinău|     pilot|  7158|        85896|<br/>+---+----------+---+------------+----------+------+-------------+</span></pre><h2 id="5aa4" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">agg()</h2><p id="8575" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">agg()函数使用sum、avg、max、min、count等函数计算聚合并将结果作为DataFrame的列返回。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="f893" class="kp je hi kl b fi kq kr l ks kt">df.agg(sum("salary"),avg("salary"),max("salary"),min("salary"),count("salary")).show(5)</span><span id="1996" class="kp je hi kl b fi ku kr l ks kt">+-----------+-----------+-----------+-----------+-------------+<br/>|sum(salary)|avg(salary)|max(salary)|min(salary)|count(salary)|<br/>+-----------+-----------+-----------+-----------+-------------+<br/>|     478818|    4788.18|       7985|       1051|          100|<br/>+-----------+-----------+-----------+-----------+-------------+</span></pre><h2 id="ab9d" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">加入()</h2><p id="ec91" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">join()函数通过使用选择的连接表达式匹配指定的公共列，将一个数据帧与另一个数据帧连接起来。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="f697" class="kp je hi kl b fi kq kr l ks kt">df.show()</span><span id="ed4a" class="kp je hi kl b fi ku kr l ks kt">+---+---------+---+------------+----------+------+<br/>| id|firstname|age|        city|profession|salary|<br/>+---+---------+---+------------+----------+------+<br/>|100|  Brianna| 32|San Fernando|    doctor|  1540|<br/>|101|  Mariele| 18|       Cairo| developer|  5800|<br/>|102|   Marnia| 30|        Baku| developer|  7136|<br/>|103|  Riannon| 56|Philadelphia|    doctor|  4986|<br/>|104|    Paule| 25|      Taipei|  engineer|  6553|<br/>+---+---------+---+------------+----------+------+</span><span id="e50a" class="kp je hi kl b fi ku kr l ks kt">df2.show()</span><span id="5f16" class="kp je hi kl b fi ku kr l ks kt">+---+------+----------+--------------+<br/>| id|gender|   country|marital_status|<br/>+---+------+----------+--------------+<br/>|100|female|     Spain|        single|<br/>|101|female|     Eygpt|        single|<br/>|102|female|Azerbaijan|       married|<br/>|103|female|       USA|      divorced|<br/>|104|female|    Taiwan|       married|<br/>+---+------+----------+--------------+</span><span id="fab5" class="kp je hi kl b fi ku kr l ks kt">df_join=df.join(df2,"id","inner").show()</span><span id="6e30" class="kp je hi kl b fi ku kr l ks kt">+---+---------+---+------------+----------+------+------+----------+--------------+<br/>| id|firstname|age|        city|profession|salary|gender|   country|marital_status|<br/>+---+---------+---+------------+----------+------+------+----------+--------------+<br/>|100|  Brianna| 32|San Fernando|    doctor|  1540|female|     Spain|        single|<br/>|101|  Mariele| 18|       Cairo| developer|  5800|female|     Eygpt|        single|<br/>|102|   Marnia| 30|        Baku| developer|  7136|female|Azerbaijan|       married|<br/>|103|  Riannon| 56|Philadelphia|    doctor|  4986|female|       USA|      divorced|<br/>|104|    Paule| 25|      Taipei|  engineer|  6553|female|    Taiwan|       married|<br/>+---+---------+---+------------+----------+------+------+----------+--------------+</span></pre><h2 id="7790" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">联合()</h2><p id="ed01" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">union()函数返回一个新的数据帧，它将当前数据帧中的行与另一个数据帧绑定在一起。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="6106" class="kp je hi kl b fi kq kr l ks kt">df2.show()</span><span id="b2d8" class="kp je hi kl b fi ku kr l ks kt">+---+---------+---+--------------+--------------+------+<br/>| id|firstname|age|          city|    profession|salary|<br/>+---+---------+---+--------------+--------------+------+<br/>|105|   Averyl| 35|Guatemala City|      engineer|  5767|<br/>|106|     Mady| 23|      Freetown|police officer|  6087|<br/>|107|   Ardeen| 36|          Suez|      musician|  2879|<br/>|108|   Audrie| 17|        Puebla|      musician|  7792|<br/>|109|   Mignon| 34|  Saint-Pierre|     developer|  2922|<br/>+---+---------+---+--------------+--------------+------+</span><span id="ba10" class="kp je hi kl b fi ku kr l ks kt">df.union(df2).show()</span><span id="8491" class="kp je hi kl b fi ku kr l ks kt">+---+---------+---+--------------+--------------+------+<br/>| id|firstname|age|          city|    profession|salary|<br/>+---+---------+---+--------------+--------------+------+<br/>|100|  Brianna| 32|  San Fernando|        doctor|  1540|<br/>|101|  Mariele| 18|         Cairo|     developer|  5800|<br/>|102|   Marnia| 30|          Baku|     developer|  7136|<br/>|103|  Riannon| 56|  Philadelphia|        doctor|  4986|<br/>|104|    Paule| 25|        Taipei|      engineer|  6553|<br/>|105|   Averyl| 35|Guatemala City|      engineer|  5767|<br/>|106|     Mady| 23|      Freetown|police officer|  6087|<br/>|107|   Ardeen| 36|          Suez|      musician|  2879|<br/>|108|   Audrie| 17|        Puebla|      musician|  7792|<br/>|109|   Mignon| 34|  Saint-Pierre|     developer|  2922|<br/>+---+---------+---+--------------+--------------+------+</span></pre><h2 id="2e21" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">别名()</h2><p id="d0a9" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">alias()函数在显示DataFrame时重命名新的DataFrame列。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="c3f8" class="kp je hi kl b fi kq kr l ks kt">df.agg(sum("salary").alias("sum"),avg("salary").alias("average")).show(5)</span><span id="cf9c" class="kp je hi kl b fi ku kr l ks kt">+------+-------+<br/>|   sum|average|<br/>+------+-------+<br/>|478818|4788.18|<br/>+------+-------+</span></pre><h2 id="8f45" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">排序()&amp;排序依据()</h2><p id="6006" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">sort()和orderBy()函数以升序或降序对字母或数字列的数据进行排序。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="8f7c" class="kp je hi kl b fi kq kr l ks kt">df.sort("age").show(5)</span><span id="0b8a" class="kp je hi kl b fi ku kr l ks kt">+---+---------+---+---------+--------------+------+-------------+<br/>| id|firstname|age|     city|    profession|salary|yearly_salary|<br/>+---+---------+---+---------+--------------+------+-------------+<br/>|108|   Audrie| 17|   Puebla|      musician|  7792|        93504|<br/>|101|  Mariele| 18|    Cairo|     developer|  5800|        69600|<br/>|129|   Kerrin| 18|Cartagena|         pilot|  1093|        13116|<br/>|123| Joceline| 18|    Konya|        worker|  4468|        53616|<br/>|134|   Estell| 18|Milwaukee|police officer|  5102|        61224|<br/>+---+---------+---+---------+--------------+------+-------------+</span><span id="0b22" class="kp je hi kl b fi ku kr l ks kt">df.orderBy(desc("age")).show(5)</span><span id="2286" class="kp je hi kl b fi ku kr l ks kt">+---+---------+---+--------------------+-----------+------+-------------+<br/>| id|firstname|age|                city| profession|salary|yearly_salary|<br/>+---+---------+---+--------------------+-----------+------+-------------+<br/>|138|   Tracey| 65|           Port Vila|    teacher|  3978|        47736|<br/>|141| Tomasina| 65|Santa Cruz de Ten...|firefighter|  2333|        27996|<br/>|127|    Sadie| 64|            Helsinki|   musician|  1051|        12612|<br/>|151|   Philis| 64|            Timbuktu|firefighter|  3194|        38328|<br/>|110|Konstance| 62|             Fukuoka|  developer|  1507|        18084|<br/>+---+---------+---+--------------------+-----------+------+-------------+</span></pre><h2 id="ff6d" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">替换()</h2><p id="70eb" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">replace()函数用指定的新值替换匹配的值。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="e7ea" class="kp je hi kl b fi kq kr l ks kt">df.replace("Cairo","Egypt","city")\<br/>.replace(["Brianna", "Paule"], ["Maria", "Pepper"], "firstname")\<br/>.show(5)</span><span id="90b7" class="kp je hi kl b fi ku kr l ks kt">+---+---------+---+------------+----------+------+-------------+<br/>| id|firstname|age|        city|profession|salary|yearly_salary|<br/>+---+---------+---+------------+----------+------+-------------+<br/>|100|    Maria| 32|San Fernando|    doctor|  1540|        18480|<br/>|101|  Mariele| 18|       Egypt| developer|  5800|        69600|<br/>|102|   Marnia| 30|        Baku| developer|  7136|        85632|<br/>|103|  Riannon| 56|Philadelphia|    doctor|  4986|        59832|<br/>|104|   Pepper| 25|      Taipei|  engineer|  6553|        78636|<br/>+---+---------+---+------------+----------+------+-------------+</span></pre><h2 id="e4b4" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">菲尔娜</h2><p id="2ac0" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">fillna()函数用我们设计的值替换空值。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="8151" class="kp je hi kl b fi kq kr l ks kt">df_null.show(6)</span><span id="7c20" class="kp je hi kl b fi ku kr l ks kt">+---+---------+----+--------------+----------+------+<br/>| id|firstname| age|          city|profession|salary|<br/>+---+---------+----+--------------+----------+------+<br/>|100|  Brianna|null|  San Fernando|    doctor|  1540|<br/>|101|  Mariele|  18|         Cairo| developer|  5800|<br/>|102|   Marnia|  30|          Baku| developer|  7136|<br/>|103|  Riannon|  56|  Philadelphia|    doctor|  null|<br/>|104|    Paule|  25|        Taipei|  engineer|  6553|<br/>|105|   Averyl|  35|Guatemala City|  engineer|  5767|<br/>+---+---------+----+--------------+----------+------+</span><span id="06cd" class="kp je hi kl b fi ku kr l ks kt">df_null.fillna({"age":20,"salary":5000}).show(5)</span><span id="d0b4" class="kp je hi kl b fi ku kr l ks kt">+---+---------+---+------------+----------+------+<br/>| id|firstname|age|        city|profession|salary|<br/>+---+---------+---+------------+----------+------+<br/>|100|  Brianna| 20|San Fernando|    doctor|  1540|<br/>|101|  Mariele| 18|       Cairo| developer|  5800|<br/>|102|   Marnia| 30|        Baku| developer|  7136|<br/>|103|  Riannon| 56|Philadelphia|    doctor|  5000|<br/>|104|    Paule| 25|      Taipei|  engineer|  6553|<br/>+---+---------+---+------------+----------+------+</span></pre><h2 id="badb" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">德罗普纳()</h2><p id="9c90" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">dropna()函数删除包含空值的行。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="677b" class="kp je hi kl b fi kq kr l ks kt">df_null.dropna().show(5)</span><span id="cff6" class="kp je hi kl b fi ku kr l ks kt">+---+---------+---+--------------+--------------+------+<br/>| id|firstname|age|          city|    profession|salary|<br/>+---+---------+---+--------------+--------------+------+<br/>|101|  Mariele| 18|         Cairo|     developer|  5800|<br/>|102|   Marnia| 30|          Baku|     developer|  7136|<br/>|104|    Paule| 25|        Taipei|      engineer|  6553|<br/>|105|   Averyl| 35|Guatemala City|      engineer|  5767|<br/>|106|     Mady| 23|      Freetown|police officer|  6087|<br/>+---+---------+---+--------------+--------------+------+</span></pre><h2 id="1d3c" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">托伊森</h2><p id="a446" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">函数的作用是:将DataFrame中的行转换成JSON文档。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="296b" class="kp je hi kl b fi kq kr l ks kt">df.toJSON().take(5)</span><span id="988d" class="kp je hi kl b fi ku kr l ks kt">['{"id":100,"firstname":"Brianna","age":32,"city":"San Fernando","profession":"doctor","salary":1540,"yearly_salary":18480}',<br/> '{"id":101,"firstname":"Mariele","age":18,"city":"Cairo","profession":"developer","salary":5800,"yearly_salary":69600}',<br/> '{"id":102,"firstname":"Marnia","age":30,"city":"Baku","profession":"developer","salary":7136,"yearly_salary":85632}',<br/> '{"id":103,"firstname":"Riannon","age":56,"city":"Philadelphia","profession":"doctor","salary":4986,"yearly_salary":59832}',<br/> '{"id":104,"firstname":"Paule","age":25,"city":"Taipei","profession":"engineer","salary":6553,"yearly_salary":78636}']</span></pre><h2 id="c103" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">托潘达斯</h2><p id="9836" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">toPandas()将Spark数据帧返回到Pandas数据帧中。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="236d" class="kp je hi kl b fi kq kr l ks kt">df.toPandas().head()</span></pre><figure class="kg kh ki kj fd lj er es paragraph-image"><div class="er es li"><img src="../Images/ca4777918f9e325121aa7eed9b78a7f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*11KLV52SGnbS72D0tDB2-Q.png"/></div></figure><h2 id="5df8" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">缓存()</h2><p id="f43a" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">cache()函数将结果缓存到内存中的Spark RDD中，这样，缓存数据帧的任何重新运行都将在处理时间方面获得显著的性能优势。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="cf35" class="kp je hi kl b fi kq kr l ks kt">df.cache()</span><span id="3da9" class="kp je hi kl b fi ku kr l ks kt">df.is_cached</span><span id="11e3" class="kp je hi kl b fi ku kr l ks kt">True</span></pre><h2 id="4f01" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">rdd</h2><p id="7d6c" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">rdd函数将火花数据帧转换成火花RDD。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="40bf" class="kp je hi kl b fi kq kr l ks kt">df.rdd.take(5)</span><span id="ec67" class="kp je hi kl b fi ku kr l ks kt">[Row(id=100, firstname='Brianna', age=32, city='San Fernando', profession='doctor', salary=1540, yearly_salary=18480),<br/> Row(id=101, firstname='Mariele', age=18, city='Cairo', profession='developer', salary=5800, yearly_salary=69600),<br/> Row(id=102, firstname='Marnia', age=30, city='Baku', profession='developer', salary=7136, yearly_salary=85632),<br/> Row(id=103, firstname='Riannon', age=56, city='Philadelphia', profession='doctor', salary=4986, yearly_salary=59832),<br/> Row(id=104, firstname='Paule', age=25, city='Taipei', profession='engineer', salary=6553, yearly_salary=78636)]</span></pre><h2 id="5234" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">列</h2><p id="1bf2" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">columns函数以列表格式返回所有列名。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="a538" class="kp je hi kl b fi kq kr l ks kt">people.columns</span><span id="45df" class="kp je hi kl b fi ku kr l ks kt">['id', 'firstname', 'age', 'city', 'profession', 'salary', 'yearly_salary']</span></pre><h2 id="ae26" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">数据类型</h2><p id="e60a" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">dtypes函数以列表格式返回所有列名及其数据类型。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="6e7b" class="kp je hi kl b fi kq kr l ks kt">df.dtypes</span><span id="b5aa" class="kp je hi kl b fi ku kr l ks kt">[('id', 'int'),<br/> ('firstname', 'string'),<br/> ('age', 'int'),<br/> ('city', 'string'),<br/> ('profession', 'string'),<br/> ('salary', 'int'),<br/> ('yearly_salary', 'int')]</span></pre><h2 id="0846" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">(计划或理论的)纲要</h2><p id="188c" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">schema函数将数据帧的模式作为StructType返回。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="ed31" class="kp je hi kl b fi kq kr l ks kt">df.schema</span><span id="ec57" class="kp je hi kl b fi ku kr l ks kt">StructType(List(StructField(id,IntegerType,true),StructField(firstname,StringType,true),StructField(age,IntegerType,true),StructField(city,StringType,true),StructField(profession,StringType,true),StructField(salary,IntegerType,true),StructField(yearly_salary,IntegerType,true)))</span></pre><h2 id="6122" class="kp je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">写入并保存</h2><p id="ae80" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">写入和保存功能以指定的格式将数据帧保存到存储器中。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="a6aa" class="kp je hi kl b fi kq kr l ks kt">df.write.save("customers.csv",format="csv")</span><span id="8ef4" class="kp je hi kl b fi ku kr l ks kt">df.select("firstname","city").write.save("customers.csv",format="csv")</span></pre><h1 id="0227" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">数据清理示例</h1><p id="2d76" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">到目前为止，我们已经看到了大量用于数据处理的函数。现在最好通过一个关于数据清理的例子来添加一些其他的功能，作为我文章的最后一部分。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="554a" class="kp je hi kl b fi kq kr l ks kt">df_dirty.show(10)</span><span id="fd54" class="kp je hi kl b fi ku kr l ks kt">+---+---------+---+--------------+----------+------+<br/>| id|firstname|age|          city|profession|salary|<br/>+---+---------+---+--------------+----------+------+<br/>|100|  BRianna| 32|  San Fernando|    Doctor|  1540|<br/>|101|  Mariele| 18|       Cairo  | Developer|  null|<br/>|102| marnia  | 30|          Baku| Developer|  7136|<br/>|103|  Riannon| 56|  Philadelphia|    Doctor|  4986|<br/>|104|    Paule| 25|       Taipei |  Engineer|  6553|<br/>|105|   Averyl| 35|Guatemala City|  engineer|  5767|<br/>|106|     Mady| 23|      Freetown|      null|  6087|<br/>|107|   Ardeen| 36|          Suez|  musician|  2879|<br/>|108|   Audrie| 17|        Puebla|  musician|  7792|<br/>|109|   Mignon| 34|  Saint-Pierre| developer|  2922|<br/>+---+---------+---+--------------+----------+------+</span><span id="6c85" class="kp je hi kl b fi ku kr l ks kt">df_dirty.withColumn("firstname",trim(initcap("firstname")))\<br/>.withColumn("city",trim("city"))\<br/>.withColumn("profession",lower(when(df_dirty.profession.isNull(),"unknown")\<br/>.otherwise(df_dirty.profession)))\<br/>.withColumn("salary",when(df_dirty.salary.isNull(),df_dirty.agg(round(avg("salary"))).head()[0])\<br/>.otherwise(df_dirty.salary).cast("float")).show(10)</span><span id="1fb1" class="kp je hi kl b fi ku kr l ks kt">+---+---------+---+--------------+----------+------+<br/>| id|firstname|age|          city|profession|salary|<br/>+---+---------+---+--------------+----------+------+<br/>|100|  Brianna| 32|  San Fernando|    doctor|1540.0|<br/>|101|  Mariele| 18|         Cairo| developer|4778.0|<br/>|102|   Marnia| 30|          Baku| developer|7136.0|<br/>|103|  Riannon| 56|  Philadelphia|    doctor|4986.0|<br/>|104|    Paule| 25|        Taipei|  engineer|6553.0|<br/>|105|   Averyl| 35|Guatemala City|  engineer|5767.0|<br/>|106|     Mady| 23|      Freetown|   unknown|6087.0|<br/>|107|   Ardeen| 36|          Suez|  musician|2879.0|<br/>|108|   Audrie| 17|        Puebla|  musician|7792.0|<br/>|109|   Mignon| 34|  Saint-Pierre| developer|2922.0|<br/>+---+---------+---+--------------+----------+------+</span></pre><h1 id="960d" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">结论</h1><p id="de53" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">在本文中，我试图向您简要介绍在Apache Spark中使用Pyspark API对数据帧(结构化部分)进行的一些最常见的操作，我们在处理数据时会用到这些操作。DataFrame上还定义了一些操作，您可以通过在Apache Spark文档中搜索SparkSQL编程指南和pyspark的Python Api文档来提高您的知识。</p><p id="4a25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这篇文章对你有所帮助。在下一篇文章中，我将讨论Spark流，这也是Apache Spark编程的另一个非常重要的部分。</p><p id="7d0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将很高兴听到您的任何意见或问题。愿数据伴随你！</p></div></div>    
</body>
</html>