<html>
<head>
<title>Object detection using TFOD</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用TFOD的目标检测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/object-detection-using-tfod-c1ca7d5d04cc?source=collection_archive---------10-----------------------#2020-07-15">https://medium.com/analytics-vidhya/object-detection-using-tfod-c1ca7d5d04cc?source=collection_archive---------10-----------------------#2020-07-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2426" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗨，在这篇文章中，我们将看到如何使用Tensorflow对象检测(TFOD)来训练对象检测模型。大多数计算机视觉从业者都在努力设置TFOD。因此，目标检测的每个步骤将被清楚地讨论。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/b3e6b8aa87a1e7c873bc79038a4e08bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LuWSgSdncZ3LrtYu6hUrrg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">TFOD目标检测</figcaption></figure><p id="1e26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Step-1: </strong>每个物体检测项目都是从数据(图像)开始的。我们需要通过各种技术收集相应项目的数据，如图像报废，谷歌图像等等！</p><p id="9b6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第二步</strong>:在收集了所需的数据后，我们必须对图像进行标注。有一些网站提供收费的注释服务。然而，我们可以自己手动完成。我建议下载这个注释工具<strong class="ih hj"> ( </strong> <a class="ae jt" href="https://tzutalin.github.io/labelImg/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">链接</strong> </a> <strong class="ih hj"> ) </strong>。根据您的操作系统下载最新版本并安装。</p><p id="2300" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤3 </strong>:为每张图像的注释创建XML文件</p><p id="8792" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤-4 </strong>:我们必须为培训选择一个模型，此<a class="ae jt" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf1_detection_zoo.md" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">链接</strong> </a>中提供了各种最先进的模型。从这个链接下载需要的模型并解压。</p><p id="eccf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要一些额外的文件来处理TFOD。下载这两个文件并解压。<strong class="ih hj"/><a class="ae jt" href="https://github.com/tensorflow/models/tree/v1.13.0" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">link 1</strong></a><a class="ae jt" href="https://drive.google.com/file/d/12F5oGAuQg7qBM_267TCMt_rlorV-M7gf/view?usp=sharing" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">link 2</strong></a>。</p><p id="2f82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤6 </strong>:创建一个文件夹，将上述下载的文件移动到其中。将下载的模型文件夹(例如:faster_rcnn_inception_v2_coco)移动到models/research文件夹。将utils文件夹中的内容移动到models/research文件夹中。utils文件夹包含默认图像数据集，用您的数据集替换默认数据集。</p><p id="f3e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤7 </strong>:将research/object _ detection/legacy中的train.py复制到research文件夹中</p><p id="f91d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤8 </strong>:根据你下载的模型，从object _ detection/samples/configs中复制配置文件，粘贴到research/training文件夹中。</p><p id="1306" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤8 </strong>:将部署和网络文件夹从research/slim复制到research文件夹</p><p id="d331" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Step-9 </strong>:打开anaconda提示符，将anaconda提示符的工作目录改为research文件夹</p><p id="9dfa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤10 </strong>:使用以下命令创建一个虚拟环境</p><blockquote class="ju"><p id="b540" class="jv jw hi bd jx jy jz ka kb kc kd jc dx translated">conda create -n环境名称python=3.6</p></blockquote><p id="088b" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq kg is it iu kh iw ix iy ki ja jb jc hb bi translated"><strong class="ih hj">步骤11 </strong>:使用以下命令激活虚拟环境</p><blockquote class="ju"><p id="6f43" class="jv jw hi bd jx jy jz ka kb kc kd jc dx translated">conda激活环境名称</p></blockquote><p id="1ea1" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq kg is it iu kh iw ix iy ki ja jb jc hb bi translated"><strong class="ih hj">第12步</strong>:使用以下命令安装所需的软件包</p><blockquote class="ju"><p id="4bbf" class="jv jw hi bd jx jy jz ka kb kc kd jc dx translated">pip安装枕头lxml cy thon context lib 2 jupyter matplotlib pandas opencv-python tensor flow = = 1 . 14 . 0</p></blockquote><p id="1972" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq kg is it iu kh iw ix iy ki ja jb jc hb bi translated">上面的命令是针对CPU的，如果你想在GPU上训练使用下面的命令</p><blockquote class="ju"><p id="57be" class="jv jw hi bd jx jy jz ka kb kc kd jc dx translated">pip安装枕头lxml cy thon context lib 2 jupyter matplotlib pandas opencv-python tensor flow-GPU = = 1 . 14 . 0</p></blockquote><p id="f338" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq kg is it iu kh iw ix iy ki ja jb jc hb bi translated"><strong class="ih hj">步骤13 </strong>:使用以下命令安装所需的protobuf包</p><blockquote class="ju"><p id="910a" class="jv jw hi bd jx jy jz ka kb kc kd jc dx translated">巨蟒原蟾蜍</p></blockquote><p id="ed8c" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq kg is it iu kh iw ix iy ki ja jb jc hb bi translated"><strong class="ih hj">步骤14 </strong>:使用以下命令将protobuf文件转换成py文件</p><blockquote class="ju"><p id="51db" class="jv jw hi bd jx jy jz ka kb kc kd jc dx translated">protocol object _ detection/protos/*。proto — python_out=。</p></blockquote><p id="0759" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq kg is it iu kh iw ix iy ki ja jb jc hb bi translated"><strong class="ih hj">步骤-15 </strong>:使用以下命令在您的本地系统中安装对象检测</p><blockquote class="ju"><p id="da5b" class="jv jw hi bd jx jy jz ka kb kc kd jc dx translated">python setup.py安装</p></blockquote><p id="a383" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq kg is it iu kh iw ix iy ki ja jb jc hb bi translated"><strong class="ih hj">步骤-16 </strong>:使用以下命令将训练和测试数据的XML文件转换成CSV文件</p><blockquote class="ju"><p id="d888" class="jv jw hi bd jx jy jz ka kb kc kd jc dx translated">python xml_to_csv.py</p></blockquote><p id="9690" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq kg is it iu kh iw ix iy ki ja jb jc hb bi translated"><strong class="ih hj">步骤-17</strong>:tensor folow对象检测模型只接受TFrecords格式作为输入。将CSV文件和图像转换为TFrecords。根据generate_tfrecords.py文件中的图像类更改图像类，并使用以下命令进行转换</p><p id="0066" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于训练数据:</p><p id="a6f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">python generate _ TF record . py-CSV _ input = images/train _ labels . CSV-image _ dir = images/train-output _ path = train . record</p><p id="5a97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于测试数据:</p><p id="2323" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">python generate _ TF record . py-CSV _ input = images/test _ labels . CSV-image _ dir = images/test-output _ path = test . record</p><p id="28fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤-18 </strong>:在配置文件中做如下修改</p><p id="29f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">I:根据你的班级改变班级的数量</p><p id="b281" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ii:将fine_tune_checkpoint:更改为您的模型名称(例如“faster _ rcnn _ inception _ v2 _ coco/model . ckpt”)</p><p id="0f24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">三:根据你改变步数。我建议保持至少50，000步</p><p id="e00a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">iv:将input_path更改为:“train.record”(用于train)</p><p id="f4e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">v:更改label _ map _ path:“training/label map . Pb txt”(用于train)</p><p id="8802" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">vi:更改input _ path:“test . record”(用于测试)</p><p id="5443" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">七:更改label _ map _ path:“training/label map . Pb txt”(用于测试)</p><p id="5a63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤19 </strong>:使用以下命令开始训练</p><blockquote class="ju"><p id="a7a5" class="jv jw hi bd jx jy jz ka kb kc kd jc dx translated">python train . py-logtostderr-train _ dir = training/-pipeline _ config _ path = training/YOUR _ model . config</p></blockquote><p id="ffbe" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq kg is it iu kh iw ix iy ki ja jb jc hb bi translated"><strong class="ih hj">步骤-20 </strong>:要停止中间的训练，按ctrl+c。要再次恢复训练，运行上述命令。训练将从最后一个关卡重新开始。</p><p id="6770" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第22步</strong>:训练完成后，生成ckpt文件。这些ckpt文件包含训练模型的权重。</p><p id="9ec0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第23步</strong>:为了预测，我们需要将ckpt文件转换成冻结的推理图文件。运行以下命令进行转换</p><p id="5fce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">python export _ inference _ graph . py-input _ type image _ tensor-pipeline _ CONFIG _ path training/YOUR CONFIG FILE-trained _ check point _ prefix training/YOUR MODEL。CKPT文件—输出目录my_model</p><p id="d11a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(注意:根据您的配置更改大写字母的文本)</p><p id="034a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我想提一下训练时的一些重要事项。训练模型的最低系统要求是至少16GB的ram，GPU，如英伟达GTX 1080，采用最新一代的英特尔CPU。</p><p id="9546" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您不符合上述规范，您可以在云GPU服务器上训练模型，如Paperspace和AWS。</p><p id="adbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确保您有足够的数据用于培训。如果数据非常少，比如每类100个图像，那么模型将是不健壮的。每门课至少要拍500张不同的照片。</p></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><p id="db84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我受c17hawk的启发写了这篇文章。【https://github.com/c17hawke】T5<a class="ae jt" href="https://github.com/c17hawke" rel="noopener ugc nofollow" target="_blank">T6</a></p><p id="f6c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您在培训过程中遇到任何问题，请点击此<a class="ae jt" href="https://c17hawke.github.io/tfod-setup/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">链接</strong> </a></p></div></div>    
</body>
</html>