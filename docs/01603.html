<html>
<head>
<title>Introduction to SQL Using Python: Computing Statistics &amp; Aggregating Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python的SQL简介:计算统计数据和聚合数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/introduction-to-sql-using-python-computing-statistics-aggregating-data-c2861186b79f?source=collection_archive---------7-----------------------#2019-11-03">https://medium.com/analytics-vidhya/introduction-to-sql-using-python-computing-statistics-aggregating-data-c2861186b79f?source=collection_archive---------7-----------------------#2019-11-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a30b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的上一篇博客中，我讨论了如何使用<strong class="ih hj"> WHERE </strong>语句在SQL中过滤数据。这个博客是一个关于如何用SQL计算统计数据和聚集数据的教程。我们将讨论以下内容:</p><ul class=""><li id="1d04" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">计数功能</li><li id="dcd5" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">作为命令</li><li id="8311" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">选择不同</li><li id="7d76" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">最大和最小函数</li><li id="529e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">AVG和求和函数</li><li id="45c6" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">使用带有计算统计信息的WHERE语句</li><li id="89b8" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">按语句排序</li><li id="90e4" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">GROUP BY语句</li><li id="b8b3" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">HAVING语句</li></ul><p id="b071" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本教程中，我们将继续使用我上一篇博客中的数据库，可以在这里下载<a class="ae jr" href="https://www.kaggle.com/laudanum/footballdelphi" rel="noopener ugc nofollow" target="_blank"/>。我们将使用这个数据库中的Matches表和Teams表。如果你没有看过我的<a class="ae jr" rel="noopener" href="/analytics-vidhya/introduction-to-sql-using-python-filtering-data-with-the-where-statement-80d89688f39e">上一篇博客</a>的帖子，我推荐你在本教程之前阅读它。它涵盖了使用<strong class="ih hj"> WHERE </strong>语句过滤SQL中的数据，还查看了Matches表中的各个列。来自<a class="ae jr" href="https://www.kaggle.com/laudanum/footballdelphi" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/laudanum/footballdelphi</a>的团队表格中的列描述如下:</p><ul class=""><li id="6c60" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">赛季(str):数据有效的足球赛季</li><li id="30bc" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">TeamName (str):数据涉及的团队的名称</li><li id="7206" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">卡德尔霍姆(str):阵容中的球员数量</li><li id="7f0d" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">球员的平均年龄</li><li id="f02c" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">外籍球员家庭(str):为球队效力的外籍球员的数量(分别为非德国人、非英国人)</li><li id="4a6c" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">OverallMarketValueHome (str):球队季前赛的整体市场价值，单位为欧元(基于transfermarkt.de的数据)</li><li id="29eb" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">AvgMarketValueHome (str):球队季前赛的平均市值(每名球员),单位为欧元(基于transfermarkt.de的数据)</li><li id="9120" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">StadiumCapacity (str):球队主场的最大球场容量</li></ul><p id="6e0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们将下载必要的库，<strong class="ih hj"> sqlite3 </strong>和<strong class="ih hj"> pandas </strong>。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es js"><img src="../Images/d6b4cbd25e8de425196e7448ffc349df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LVOl6GeK7Zq6x2fqSn-Jug.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">导入必要的库</figcaption></figure><p id="76c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，您需要连接到数据库并创建一个游标对象。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es ki"><img src="../Images/b3c2b5f0feebec7a28a946bd3767ccb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xua5KeX6kbrKlxDZEXflLQ.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">连接到数据库并创建光标对象</figcaption></figure><p id="e29d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是我们在Python中运行SQL查询时将使用的格式。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es kj"><img src="../Images/9d93144d6d58133dcc505a93574c9ea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DSsSO53Khw2wVXh8C2kD1w.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">Python中SQL查询的格式</figcaption></figure><h1 id="3cd7" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">计数功能</h1><p id="66b0" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">我们要看的第一个函数是<strong class="ih hj">计数</strong>函数。以前，我们要么在<strong class="ih hj"> SELECT </strong>语句中添加一个星号，要么列出我们希望返回的列名。<strong class="ih hj"> COUNT </strong>函数也可以在<strong class="ih hj"> SELECT </strong>语句中列出，并将计算指定的行数。下面的查询使用了<strong class="ih hj"> SELECT </strong>语句中的函数<strong class="ih hj"> COUNT(*) </strong>。<strong class="ih hj"> COUNT(*) </strong>将计算指定表格中的所有行。以下查询对<strong class="ih hj">团队</strong>数据集中的所有行进行计数。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es ln"><img src="../Images/427f1ddf6153b1ea343b6f3f7e27452e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*duFlLWoe2YCQcWRQDbXTfQ.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">SELECT COUNT(*)FROM Teams；</figcaption></figure><p id="1e87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总共有468行包含在<strong class="ih hj">团队</strong>数据集中。我们还可以在<strong class="ih hj"> COUNT </strong>函数的括号之间插入一个列名来代替星号，例如<strong class="ih hj"> COUNT(Season) </strong>。然后，该函数将对<strong class="ih hj"> Season </strong>列中有非空值的所有行进行计数。如果<strong class="ih hj"> Season </strong>的值对于任何一行为空，那么该行将不被计数。如果<strong class="ih hj"> Season </strong>列中没有空值，那么下面的函数将返回468，与<strong class="ih hj"> Teams </strong>数据集中的总行数相同。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lo"><img src="../Images/9b19cf749ce790bec78c084870787325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hBAtSuQL6z2fA2Jw8NJLsg.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">从团队中选择计数(赛季)；</figcaption></figure><p id="0542" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太好了，具有非空值的行数是468，与包含在<strong class="ih hj">团队</strong>数据集中的总行数相同。这意味着没有空值。要练习使用<strong class="ih hj"> COUNT </strong>函数，请计算<strong class="ih hj">匹配</strong>数据集中的行数，并将您的查询与下面的查询进行比较:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lp"><img src="../Images/a04e60c5bb5c27b7a1c365e01a72ea8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xqb0_yQXCtYHrxDz1q1_RA.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">从匹配项中选择COUNT(*)；</figcaption></figure><p id="6df5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj">匹配</strong>数据集中应该有24，625行。检查<strong class="ih hj">匹配</strong>数据集的<strong class="ih hj">季节</strong>列中是否有任何缺失值，并将您的查询与下面的查询进行比较:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lq"><img src="../Images/3d97b1e3f503d28f8ce816a2c32fd5f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LzMyTYHUWNPeZX6sPaxECw.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">从比赛中选择计数(赛季)；</figcaption></figure><p id="925a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj">匹配</strong>数据集中的<strong class="ih hj">季节</strong>列中有24625行具有非空值。因为这与<strong class="ih hj">匹配</strong>数据集中的总行数相同，所以<strong class="ih hj">季节</strong>列中没有缺失/空值。</p><h1 id="f0ea" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">作为命令</h1><p id="5249" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">当我们使用<strong class="ih hj"> COUNT </strong>函数获得返回的结果时，我们返回的列的名称是<strong class="ih hj"> COUNT(Season) </strong>。这个列名不太清楚。这是重命名该列的好时机。我们可以使用<strong class="ih hj">作为</strong>命令来重命名一个列。<strong class="ih hj"> AS </strong>命令用于用别名重命名列甚至表。要查看如何使用<strong class="ih hj"> AS </strong>命令，请查看以下查询:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lr"><img src="../Images/1963cf9c0e414cbc420575042bb9825d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kMXMCA4VyDKRqu74qswnXg.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">SELECT COUNT(Season)作为Num _ of _ NonNull _ Season _ Rows FROM Matches；</figcaption></figure><p id="b042" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用了您刚刚自己练习过的查询。不同之处在于，使用<strong class="ih hj">作为</strong>命令，将列<strong class="ih hj"> COUNT(Season) </strong>重命名为别名<strong class="ih hj">Num _ of _ NonNull _ Season _ Rows</strong>。要练习使用<strong class="ih hj">作为</strong>命令，编写一个查询，计算<strong class="ih hj">团队</strong>数据集中<strong class="ih hj">团队名称</strong>不为空值的所有行，将列重命名为<strong class="ih hj">Num of _ NonNull _ team name _ Rows</strong>。将您的查询与下面的查询进行比较:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es ls"><img src="../Images/16a0719bb531129326d348d235904db0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DoD1qWuT0s2GvZ3iTIxRjA.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">SELECT COUNT(team name)AS Num _ of _ NonNull _ team name _ Rows FROM Teams；</figcaption></figure><h1 id="d8ad" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">选择不同</h1><p id="47da" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">使用<strong class="ih hj"> COUNT </strong>函数，我们能够看到在<strong class="ih hj">团队</strong>和<strong class="ih hj">匹配</strong>数据集中列出了多少行。我们还看到了两个数据集的<strong class="ih hj"> Seasons </strong>列中没有空值的行数。如果我们想知道<strong class="ih hj">团队</strong>数据集中<strong class="ih hj">季节</strong>列的独特值，该怎么办？我们不能使用<strong class="ih hj"> COUNT(Season) </strong>，因为这只能给出在<strong class="ih hj"> Season </strong>列中具有指定值的行数。相反，我们将在<strong class="ih hj"> SELECT </strong>语句中使用<strong class="ih hj"> DISTINCT </strong>子句。以下查询将向我们显示包含在<strong class="ih hj">团队</strong>数据集中的<strong class="ih hj">赛季</strong>列中的所有唯一值。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lt"><img src="../Images/7fde1c1074d64fff5a1617dd0110d56b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M-GqIXV9uyHsc8KXX2oGdA.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">从团队中选择不同的季节；</figcaption></figure><p id="32bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">练习选择<strong class="ih hj">匹配</strong>数据集中所有唯一的<strong class="ih hj"> AwayTeams </strong>，并将您的查询与下面的查询进行比较:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lu"><img src="../Images/0ce75d26853eaa94a97e4759de44ab3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gnk4yCO-RVRVm_l8RsHkYA.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">从比赛中选择不同的客场球队；</figcaption></figure><h1 id="f1f4" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">一起使用计数和非重复</h1><p id="51cd" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">我们刚刚看到了如何从上面的匹配数据集中获取所有唯一的<strong class="ih hj"> AwayTeam </strong>名称。当我们想知道<strong class="ih hj">返回了多少个</strong>唯一值时会发生什么？为了获得唯一的<strong class="ih hj"> AwayTeam </strong>名称的计数，我们可以使用<strong class="ih hj"> COUNT </strong>函数和<strong class="ih hj"> DISTINCT </strong>子句。下面的查询将查找<strong class="ih hj">数据集中所有与</strong>匹配的<strong class="ih hj"> AwayTeam </strong>名称，然后返回包含在<strong class="ih hj"> AwayTeam </strong>名称中的行数。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lv"><img src="../Images/fd374743ab3d26e19b2f60ed31db1d08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nq79zK-7r2xWE9DujFH_Qg.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">从比赛中选择计数(不同于客场队)；</figcaption></figure><p id="f70c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了练习一起使用<strong class="ih hj"> COUNT </strong>函数和<strong class="ih hj"> DISTINCT </strong>子句，查询<strong class="ih hj"> Teams </strong>数据集中包含的distinct <strong class="ih hj"> Seasons </strong>的数量，并将该列重命名为<strong class="ih hj"> Num_of_Seasons </strong>。将您的查询与下面的查询进行比较:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lw"><img src="../Images/a446a67e6ccd42edb661a74ff47d506e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XRMV7dGT7g028qYuHaUdRw.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">选择COUNT(DISTINCT Seasons)作为团队的赛季数；</figcaption></figure><h1 id="0527" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">最大和最小函数</h1><p id="39bc" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">我们将继续研究如何在<strong class="ih hj"> SELECT </strong>语句中计算数据。我们现在来看看如何使用<strong class="ih hj">最大</strong>功能和<strong class="ih hj">最小</strong>功能。<strong class="ih hj"> MAX </strong>函数将返回指定列中的最大值，而<strong class="ih hj"> MIN </strong>函数将返回指定列中的最小值。也许我们想知道<strong class="ih hj">队</strong>数据集中包含的最大体育场容量是多少。为此，我们可以使用下面的查询:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lx"><img src="../Images/1ba24c66d758a251ab1bdd62fcde9dc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e_izMiDkJJtS5VNScE6vFQ.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">选择MAX(StadiumCapacity)作为maximum _ stadium capacity FROM Teams；</figcaption></figure><p id="084f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上例中，81，359是<strong class="ih hj"> StadiumCapacity </strong>列中<strong class="ih hj"> Teams </strong>数据集中的最大值。为了查看<strong class="ih hj"> StadiumCapacity </strong>列中的最小值，我们将使用<strong class="ih hj"> MIN </strong>函数。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es ly"><img src="../Images/1f6136ac2e8dbe5e3770794363e04266.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fXTNbQS8mlrsqwbErcolTQ.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">选择MIN(StadiumCapacity)作为small _ stadium capacity FROM Teams；</figcaption></figure><p id="127d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到<strong class="ih hj">团队</strong>数据集中包含的最小体育场容量是15，000人。为了练习使用<strong class="ih hj"> MAX </strong>和<strong class="ih hj"> MIN </strong>函数，查询一个小队中玩家的最大数量<strong class="ih hj"> KaderHome </strong>，并将该列重命名为<strong class="ih hj"> Max_Players </strong>。在同一个查询中，返回队伍中最小数量的球员，并将该列重命名为<strong class="ih hj"> Min_Players </strong>，并将您的查询与下面的查询进行比较:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lz"><img src="../Images/f3d2ddd37ddb16d64bf4eb71c6736c5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8uTOCPjQCugy22vIa18FiA.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">从团队中选择MAX(KaderHome)作为Max_Players，MIN(KaderHome)作为Min _ Players</figcaption></figure><h1 id="f930" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">AVG函数和求和函数</h1><p id="96e7" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">现在我们来看看另外两个可以在<strong class="ih hj"> SELECT </strong>语句中使用的函数。<strong class="ih hj"> AVG </strong>函数将返回指定数值列的平均值。<strong class="ih hj"> SUM </strong>函数将返回指定的数字列的总和。我们将继续查看<strong class="ih hj">团队</strong>数据集中的<strong class="ih hj"> StadiumCapacity </strong>列。下面的查询显示了<strong class="ih hj">队</strong>数据集中的平均体育场容量。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es ma"><img src="../Images/da93a9f109cbbfb0479b42b68aa1fe17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4DG611ENC27qEzyM47_olQ.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">选择AVG(StadiumCapacity)作为球队的Average _ StadiumCapacity</figcaption></figure><p id="7f05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">小数点后面有很多数字。如果我们想舍入到第100位，我们可以在我们的<strong class="ih hj"> AVG </strong>函数周围添加一个<strong class="ih hj"> ROUND </strong>子句，如下所示:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es mb"><img src="../Images/61d63a3268941e35e50fba71eed39e61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-aAXdmvK5_qtRGMYDyLmQ.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">选择ROUND(AVG(StadiumCapacity)，2)作为球队的Average _ StadiumCapacity</figcaption></figure><p id="31ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于<strong class="ih hj">圆形</strong>功能的快速注释。格式如下:<strong class="ih hj"> ROUND(要四舍五入的数字，小数位数要四舍五入到)</strong>。我们想要舍入的数字是<strong class="ih hj"> AVG(StadiumCapacity) </strong>，我们想要舍入到最接近的百分之一，或者小数后面的<strong class="ih hj"> 2__个数字，因此我们使用的格式是__ROUND(AVG(StadiumCapacity)，2) </strong>。欲了解更多关于<strong class="ih hj">轮</strong>功能的信息，请访问<a class="ae jr" href="https://www.w3schools.com/sql/func_sqlserver_round.asp" rel="noopener ugc nofollow" target="_blank">https://www.w3schools.com/sql/func_sqlserver_round.asp</a>。</p><p id="dcd6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">函数将返回指定列的总和。例如，如果我们想要查看在<strong class="ih hj">匹配</strong>数据集中的主场进球总数，我们可以使用以下查询:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es mc"><img src="../Images/6d2376260154a7e0da339e7ca0c0c07e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GlaeZtC3ET5Muy9i56yuew.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">从匹配项中选择SUM(FTHG)作为Total _ HomeGoals</figcaption></figure><p id="ebed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要练习自己使用<strong class="ih hj"> AVG </strong>和<strong class="ih hj">总和</strong>函数，请从<strong class="ih hj">球队</strong>数据集中查询以欧元为单位的球队季前赛的平均总市值，<strong class="ih hj">总体市场价值主页</strong>，并将该值四舍五入到最接近的百分之一，然后将该列标记为<strong class="ih hj"> Avg_Market_Val </strong>。在同一个查询中，返回玩家平均年龄的总和，<strong class="ih hj"> AvgAgeHome </strong>，并将该列重命名为<strong class="ih hj"> Avg_Age </strong>。将您的查询与下面的查询进行比较:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es md"><img src="../Images/a026d2ebcb0740849afa34fb2a66afd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T7WZ7qQvki2QUrxvP787cA.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">SELECT ROUND(AVG(OverallMarketValueHome)，2)作为Avg_Market_Val，SUM(AvgAgeHome)作为Avg _ Age FROM Teams</figcaption></figure><h1 id="6d1b" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">使用带有计算统计信息的WHERE语句</h1><p id="c094" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">如果你没有读过我的上一篇关于在<strong class="ih hj"> WHERE </strong>语句中过滤数据的博文，现在可能是一个看一看的好时机。我们现在开始计算过滤数据的统计数据。</p><p id="6e28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想知道曼联在主场比赛中平均进了多少球。为了得到这个答案，我们可以使用下面的查询:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es me"><img src="../Images/baba9b36deefeb0ecd89d2d9c974ee76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aAd-b8QuMvSIZYbSMnf0Mw.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">选择ROUND(AVG(FTHG)，2)作为Avg_HomeGoals，来自HomeTeam = '曼联'的比赛；</figcaption></figure><p id="99fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过添加<strong class="ih hj"> WHERE </strong>语句，我们告诉我们的查询，我们只想过滤拥有“曼联”主场团队的数据。为了更好地理解这一点，我们将简要讨论与该查询相关的SQL操作顺序。虽然<strong class="ih hj"> SELECT </strong>语句是我们的SQL查询中的第一条语句，但是要执行的第一条语句是来自语句的<strong class="ih hj">。上面的</strong>语句中的<strong class="ih hj">告诉SQL我们正在使用<strong class="ih hj">匹配</strong>数据集作为我们的表。执行的下一条语句是<strong class="ih hj"> WHERE </strong>语句。<strong class="ih hj"> WHERE </strong>语句过滤我们的数据集，使其只包含我们想要的信息，在本例中，我们只想要包含<strong class="ih hj"> HomeTeam = 'Man United' </strong>所在的行。最后，执行<strong class="ih hj"> SELECT </strong>语句，它以我们指定的形式返回数据。在这种情况下，我们希望返回在查询执行过程中SQL查询筛选出的数据中得分的四舍五入平均值。通过编写一个查询来练习聚合和使用<strong class="ih hj"> WHERE </strong>语句，该查询显示了来自<strong class="ih hj"> Teams </strong>数据集的所有球队在2014赛季的球员总数。将“球队球员总数”列重命名为<strong class="ih hj"> Total_Soccer_Players </strong>。完成后，将您的查询与下面的查询进行比较:</strong></p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es mf"><img src="../Images/af90270e5c8c978e2a975bcf6eccbba9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MPKC861j7Pz5CxenDDhTeg.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">选择SUM(KaderHome)作为Season = 2014的球队的Total _ Soccer _ Players</figcaption></figure><h1 id="c77e" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">按语句排序</h1><p id="ff71" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated"><strong class="ih hj"> ORDER BY </strong>语句用于在给定指定列的情况下对返回的数据进行升序或降序排序。如果没有<strong class="ih hj"> ORDER BY </strong>语句，数据将不会按任何特定顺序排序。如果您查看下面的查询，2015赛季各队球员的独特平均年龄不会以任何特定的顺序返回:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es mg"><img src="../Images/1329332c17598d48a95569236cfd4e47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8-7jpGphKiwFPcNPYhgydA.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">从赛季= 2015的球队中选择不同的AvgAgeHome</figcaption></figure><p id="1760" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在将向同一个查询添加一个<strong class="ih hj"> ORDER </strong>语句。现在，返回的结果将按升序排列，最低不同平均年龄的玩家位于返回结果的顶部，最高不同平均年龄的玩家位于返回结果的底部。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es mh"><img src="../Images/950615ae9e36c79f29a91de57f33552e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6R5JyEyOms22-AFSpyJ2HQ.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">从Season = 2015 ORDER BY AvgAgeHome的球队中选择不同的AvgAgeHome；</figcaption></figure><p id="2706" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们也可以通过<strong class="ih hj"> AvgAgeHome </strong>以降序返回这个查询的结果。下面的查询与上面的查询相同，但是这个查询在AvgAgeHome语句的<strong class="ih hj">ORDER之后包括一个<strong class="ih hj">desc</strong>语句。这将按降序对返回的结果进行排序。团队中球员的最高不同平均年龄将在结果的顶部返回，而球员的最低不同平均年龄将在返回结果的底部返回。要查看运行中的<strong class="ih hj"> DESC </strong>子句，请查看下面的查询:</strong></p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es mi"><img src="../Images/2fda85f11791a36155e60470a0cc1adf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*huEn4GdMBPinotMaRqmSyA.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">从desc AvgAgeHome订购的赛季= 2015的球队中选择不同的AvgAgeHome；</figcaption></figure><p id="9eb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的结果现在按照2015赛季各队球员不同的平均年龄降序排列。如果我们没有将<strong class="ih hj"> DESC </strong>子句放在一个<strong class="ih hj"> ORDER BY </strong>语句的末尾，默认情况下，结果将按升序返回。您可以通过语句将<strong class="ih hj"> ASC </strong>放在<strong class="ih hj"> ORDER的末尾，以升序返回结果，但这不是必需的。通过编写从<strong class="ih hj"> Matches </strong>表中返回<strong class="ih hj"> HomeTeam </strong>、<strong class="ih hj"> FTHG </strong>(一场比赛中主场进球数量)和<strong class="ih hj"> FTAG </strong>(一场比赛中客场进球数量)的查询，练习使用<strong class="ih hj"> ORDER BY </strong>语句。仅包括2010年</strong>赛季的数据，其中<strong class="ih hj">亚琛</strong>是主队的名称。按照比赛中主场进球的数量降序返回结果。对于主场进球数量相同的结果，按比赛中客场进球数量升序排列。将您的查询与下面的查询进行比较:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es mj"><img src="../Images/e4150f9c100d15a765fb437084a16d35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i4_986W3_kv-2kD0yyy3Iw.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">从由FTAG亚琛的FTHG DESC订购的HomeTeam = '亚琛'和Season = 2010的比赛中选择HomeTeam，FTHG，FTAG；</figcaption></figure><h1 id="e191" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">GROUP BY语句</h1><p id="8af9" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">最后我们通过函数到达了<strong class="ih hj">组。<strong class="ih hj"> GROUP BY </strong>函数将指定列中具有匹配值的行组合在一起。为了理解<strong class="ih hj"> GROUP BY </strong>语句是如何工作的，我们将讨论下面的查询:</strong></p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es mk"><img src="../Images/775f22af883e30719c19347c65647580.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2n63uzikEK8A3Atrxlgc_w.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">选择HomeTeam，COUNT(FTR)作为Total_Home_Wins来自FTR = 'H '和Season = '2016 '分组按HomeTeam排序按COUNT(FTR)desc；</figcaption></figure><p id="8dab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该查询返回2016赛季每支球队赢得的主场比赛总数，按赢得的主场比赛数降序排列。在我们的<strong class="ih hj"> SELECT </strong>语句中有两个变量，<strong class="ih hj"> HomeTeam </strong>和<strong class="ih hj"> COUNT(FTR) </strong>。第一个变量是来自<strong class="ih hj">匹配</strong>数据集的非聚合列，第二个变量是来自<strong class="ih hj">匹配</strong>数据集的聚合列。<strong class="ih hj"> WHERE </strong>语句说只使用<strong class="ih hj"> FTR = 'H' </strong>(一场比赛的结果是主场获胜)和<strong class="ih hj">赛季= 2016 </strong>的数据。<strong class="ih hj">分组依据</strong>通过<strong class="ih hj"> HomeTeam </strong>将行分组在一起。<strong class="ih hj"> GROUP BY </strong>语句告诉查询将具有相同主队名称的所有行组合在一起。结果是每个主场球队被分组在一起，每次他们赢得一场主场比赛，它都被添加到最后结果的左边。</p><p id="2b65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> GROUP BY </strong>语句通常与聚合函数一起使用，就像我们前面提到的那些函数一样，<strong class="ih hj"> COUNT </strong>、<strong class="ih hj"> MAX </strong>、<strong class="ih hj"> MIN </strong>、<strong class="ih hj"> AVG </strong>和<strong class="ih hj"> SUM_。尝试通过编写一个查询来练习使用__GROUP BY </strong>语句，该查询显示来自<strong class="ih hj"> Teams </strong>数据集的每支球队的外籍球员平均人数。将外国玩家平均人数列重命名为<strong class="ih hj">Avg _ Num _ Foreign _ Players</strong>，并将该列四舍五入到最接近的百分之一。按照外国玩家的平均数量以升序返回您的结果。将您的查询与下面的查询进行比较:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es ml"><img src="../Images/c56f8ba35137962f875aecae9d49a5b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b4nOjACtS8H296IF8lbXuw.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">选举TeamName，ROUND(AVG(ForeignPlayersHome)，2)为Avg_Num_Foreign_Players从TeamName分组的球队中按ROUND排序(AVG(ForeignPlayersHome)，2)ASC；</figcaption></figure><h1 id="a388" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">HAVING语句</h1><p id="665b" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">具有语句的<strong class="ih hj">过滤组。它总是紧接在<strong class="ih hj"> GROUP BY </strong>语句之后使用。它类似于<strong class="ih hj"> WHERE </strong>语句，但仅用于过滤聚合行。为了了解其工作原理，我们将运行与之前相同的查询，但这一次我们只想显示外籍球员平均人数大于或等于15人的球队。</strong></p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es mm"><img src="../Images/10185c7f2cafccf8acfec3cb263d9ee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kgSV1pUHx3367n9HsjRhWg.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">SELECT TeamName，ROUND(AVG(外国玩家家)，2)作为Avg _ Num _ Foreign _ Players FROM team name GROUP HAVING ROUND(AVG(外国玩家家)，2) &gt;= 15 ORDER BY ROUND(AVG(外国玩家家)，2)ASC；</figcaption></figure><p id="b54a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尝试练习使用<strong class="ih hj"> HAVING </strong>语句来查询每个赛季球队季前平均市值(每名球员)的欧元总和(<strong class="ih hj"> AvgMarketValueHome </strong>)，其中球队季前平均市值(每名球员)的欧元总和等于或小于65，000，000。将您的查询与下面的查询进行比较:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lz"><img src="../Images/17dc5eed0b05fa2864d3bad0856ea575.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uRtuhw3QDxYKrrc_yn8tQA.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">从具有SUM(AvgMarketValueHome)&lt; = 65000000的按赛季分组的球队中选择Season，SUM(AvgMarketValueHome)；</figcaption></figure><p id="1ba8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经到了本教程的结尾。我们讨论了以下主题:</p><ul class=""><li id="fb2e" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">计数功能</li><li id="24a5" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">作为命令</li><li id="ff46" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">选择不同</li><li id="1dfc" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">最大和最小函数</li><li id="7c2b" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">AVG和求和函数</li><li id="c6f4" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">使用带有计算统计信息的WHERE语句</li><li id="d10d" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">按语句排序</li><li id="aee9" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">GROUP BY语句</li><li id="7302" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">HAVING语句</li></ul><p id="7b20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我鼓励您继续尝试我们在本教程中介绍的函数和语句，以便更深入地理解它们是如何工作的。</p></div></div>    
</body>
</html>