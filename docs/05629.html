<html>
<head>
<title>ChatBot in Python-Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的聊天机器人——第1部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/chatbot-in-python-part-1-919d94dbb3fa?source=collection_archive---------15-----------------------#2020-04-27">https://medium.com/analytics-vidhya/chatbot-in-python-part-1-919d94dbb3fa?source=collection_archive---------15-----------------------#2020-04-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="ef7c" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">据Gartner称，“到2022年，70%的白领将每天与对话平台互动”</p></blockquote><p id="eb0e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi jk translated">据估计，在过去的一年中，全球超过67%的消费者使用聊天机器人进行客户支持，到2020年，大约85%的客户互动将在没有人工代理的情况下进行。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es jt"><img src="../Images/804513025f47530a4946c1ec1dbb3c3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/0*HqJ4gyra6DYVjoGl.gif"/></div></figure></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><p id="8bd0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">这些不仅仅是估计，而是事实。在当今世界，我们大多数人在工作或日常活动中都依赖于<strong class="il hj">虚拟助手。</strong>考虑这样一个场景，客户希望解决他们的一些问题，然后登陆聊天机器人，只需描述他们的问题，他们就可以找到合适的解决方案，如果不可能找到合适的解决方案，他们可以为此创建一个票证，并可以检查他们的票证进度。ITOA任务变得无缝和无障碍。</p><p id="7bf0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">聊天机器人不仅使之成为可能，而且为轻松处理一些耗时的任务和客户满意度打开了一个新的大门。</p><p id="c354" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">所以在这篇文章(第一部分)中，我们将看到如何开发聊天机器人。许多框架可以用于聊天机器人的开发，在这篇文章中，我们将讨论如何使用<a class="ae ki" href="https://docs.microsoft.com/en-us/azure/bot-service/bot-service-overview-introduction?view=azure-bot-service-4.0" rel="noopener ugc nofollow" target="_blank">微软聊天机器人框架</a>用python开发聊天机器人。</p><p id="ce00" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">在直接进入开发之前，让我们首先设置使用bot SDK开发聊天机器人所需的所有要求。</p><ol class=""><li id="27f3" class="kj kk hi il b im in iq ir jh kl ji km jj kn jg ko kp kq kr bi translated">Python <a class="ae ki" href="https://www.python.org/downloads/release/python-369/" rel="noopener ugc nofollow" target="_blank"> 3.6 </a>或<a class="ae ki" href="https://www.python.org/downloads/release/python-370/" rel="noopener ugc nofollow" target="_blank"> 3.7 </a></li><li id="3779" class="kj kk hi il b im ks iq kt jh ku ji kv jj kw jg ko kp kq kr bi translated"><a class="ae ki" href="https://github.com/microsoft/BotFramework-Emulator/blob/master/README.md" rel="noopener ugc nofollow" target="_blank"> Bot框架模拟器</a></li><li id="b5e6" class="kj kk hi il b im ks iq kt jh ku ji kv jj kw jg ko kp kq kr bi translated">g<a class="ae ki" href="https://git-scm.com/downloads" rel="noopener ugc nofollow" target="_blank">it</a>-用于版本控制</li></ol><p id="b04a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">建立开发环境</strong></p><ol class=""><li id="8988" class="kj kk hi il b im in iq ir jh kl ji km jj kn jg ko kp kq kr bi translated">让我们从在python中设置一个虚拟env开始。为此，我们需要使用pip命令安装virtualenv</li></ol><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es kx"><img src="../Images/37ad6d35b86c78686f59a3b797efd1a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3zsuxeuRXTxHjfccEZP9Uw.png"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx translated">安装虚拟</figcaption></figure><p id="dec5" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">2.成功安装virtualenv后，使用以下命令创建一个虚拟环境</p><pre class="ju jv jw jx fd lg lh li lj aw lk bi"><span id="88b8" class="ll lm hi lh b fi ln lo l lp lq">###In Windows <br/>py -m venv env_chatbot</span><span id="0769" class="ll lm hi lh b fi lr lo l lp lq">### In Linux and macOS<br/>python3 -m venv env_chatbot </span></pre><p id="0780" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">3.激活虚拟环境</p><pre class="ju jv jw jx fd lg lh li lj aw lk bi"><span id="a063" class="ll lm hi lh b fi ln lo l lp lq">## In Linux and macOS<br/>source env_chatbot/bin/activate</span></pre><p id="aeb3" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">对于windows</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es ls"><img src="../Images/fd6b273e17e9c2c2e0a53e7c03cfa2f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*k8VOBfUJY-z4COFmZmAEcQ.png"/></div><figcaption class="lc ld et er es le lf bd b be z dx translated">在windows中激活虚拟环境</figcaption></figure><p id="bff7" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">安装所需的依赖关系</strong></p><ol class=""><li id="addd" class="kj kk hi il b im in iq ir jh kl ji km jj kn jg ko kp kq kr bi translated">要在python中本地开发bot，需要安装一些包botbuilder-core、asyncio和cookiecutter</li></ol><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lt"><img src="../Images/020556bfa484a09143f608ac6e9eb56a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*pj2eDEJjVqUfGZ1UJGr-mA.png"/></div><figcaption class="lc ld et er es le lf bd b be z dx translated">安装所需的软件包</figcaption></figure><p id="ee9f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">2.微软Bot框架提供了一些预定义的模板，可以快速入门。在这一步中，我们使用cookie cutter来安装一个echo bot模板，它是基本的<a class="ae ki" href="https://github.com/microsoft/BotBuilder-Samples/tree/master/generators/python/app/templates" rel="noopener ugc nofollow" target="_blank"> <em class="ik"> bot服务模板</em> </a>之一。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es lu"><img src="../Images/fa02c82dd93132bdab96e8f14f545185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8QqnLGKYFHrFgGhdkixAng.png"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx translated">下载预定义的bot服务模板</figcaption></figure><p id="48f2" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">3.现在，我们导航到微信文件夹，在那里保存我们的bot并安装requirement.txt中提到的运行bot所需的所有依赖项。</p><pre class="ju jv jw jx fd lg lh li lj aw lk bi"><span id="77e6" class="ll lm hi lh b fi ln lo l lp lq">pip install -r requirement.txt</span></pre><p id="4db8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">4.现在，在我们安装了所有的依赖项之后，我们将通过运行微信文件夹中的app.py文件来运行我们预定义的bot模板。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lv"><img src="../Images/7db93f0a523dcb784d7ef553f7b0452a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*7JPJPJXEB04kw4PlyNnKVQ.png"/></div><figcaption class="lc ld et er es le lf bd b be z dx translated">运行echo bot模板</figcaption></figure><p id="f2bd" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">5.我们打开bot模拟器，在3978端口号上连接到本地主机</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es lw"><img src="../Images/913a9fe725f1ea097369ec0ab8e29343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nHj3G-n8jGvwFF-xtjb5tw.png"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx translated">机器人回显用户给出的响应</figcaption></figure><p id="5dcd" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">这就完成了安装和运行bot模板的步骤。</p><p id="f2c6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">但是，当一个新的对话开始或一个用户加入到对话中时，机器人应该自己发送一条消息，让用户更多地了解它的特性或功能，这不是很好吗，因为机器人的主要目标是让用户参与到有意义的对话中。因此，从这里开始，我们开始向现有的bot模板添加欢迎消息。</p><p id="0a71" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">在创建机器人之前，了解机器人如何使用活动对象与其用户通信是很重要的。让我们首先来看看在运行一个简单的echo bot时交换的活动。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es lx"><img src="../Images/acbd7cffc259b3ef69ff2946e65c5771.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L5pVDQm7SxwZhdGY"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx translated">Bot工作流程</figcaption></figure><p id="99d2" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">一旦用户加入机器人并向其发送输入，就会发生两种类型的活动(参见上图)</p><ol class=""><li id="24bb" class="kj kk hi il b im in iq ir jh kl ji km jj kn jg ko kp kq kr bi translated">当新用户或机器人加入对话时，机器人发送更新消息</li><li id="3d5c" class="kj kk hi il b im ks iq kt jh ku ji kv jj kw jg ko kp kq kr bi translated">消息——消息活动携带最终用户和机器人之间的对话信息。在我们的Echo bot的例子中，它是一个由通道渲染的简单文本。或者，消息活动可以是要说的文本、建议的动作或卡片。</li></ol><blockquote class="if ig ih"><p id="8c2f" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">从上图中我们注意到，在对话中，人们可能一次说一个人，进行<em class="hi">“话轮”。</em> <strong class="il hj">那么我们如何实现这个案例中的一个bot呢？</strong>在机器人框架的情况下，一个<strong class="il hj"> <em class="hi">回合</em> </strong>由用户对机器人的输入活动和机器人作为即时响应发送回用户的活动组成。但这里的问题是，机器人如何处理用户传入的活动，并决定发送哪个响应。这是我们在机器人活动堆栈中关注的内容，我们可以看到机器人如何处理传入消息活动的到达。</p></blockquote><p id="f33c" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">当机器人接收到一个活动时，它将它传递给它的活动处理程序，活动处理程序下面有一个基础处理程序，叫做<em class="ik"> turn handler。</em>所有的活动都通过<em class="ik"> </em>到达<em class="ik">。</em>turn处理程序看到一个传入的活动，并将其发送给<strong class="il hj"><em class="ik">OnMessageActivityAsync</em></strong>活动处理程序。</p><p id="3be0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">当我们创建bot时，用于处理和响应消息的逻辑将进入OnMessageActivityAsync处理程序，用于处理添加到会话中的成员的逻辑将进入<strong class="il hj"><em class="ik">onmembersaddasync</em></strong>处理程序，每当有成员添加到处理程序时都会调用该处理程序。我已经讨论了这两个处理程序，简单来说，要了解它们更多请点击这个<a class="ae ki" href="https://docs.microsoft.com/en-us/azure/bot-service/bot-builder-basics?view=azure-bot-service-4.0&amp;tabs=python#the-activity-processing-stack" rel="noopener ugc nofollow" target="_blank"> <strong class="il hj">链接</strong> </a> <strong class="il hj"> <em class="ik">。</em> </strong></p><p id="a2de" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">因此，为了向添加到对话中的每个新用户发送欢迎消息，我们需要在OnMembersAddedAsync上应用逻辑，我们创建了一个属性<strong class="il hj"><em class="ik">welcome _ user _ state . did _ welcome _ user</em></strong>来检查用户是否收到了欢迎消息。因此，每当接收到新的用户输入时，我们检查该属性以查看它是否被设置为<em class="ik"> true </em>，如果该属性没有被设置为true，我们向用户发送初始欢迎消息。如果设置为<em class="ik">真</em>，基于用户输入的内容，该机器人将执行以下操作之一:</p><ul class=""><li id="1980" class="kj kk hi il b im in iq ir jh kl ji km jj kn jg ly kp kq kr bi translated">回显从用户处收到的问候。</li><li id="e03d" class="kj kk hi il b im ks iq kt jh ku ji kv jj kw jg ly kp kq kr bi translated">显示一张英雄卡，提供更多关于机器人的信息。</li></ul><p id="2282" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">ut，我们将向用户发送一个<a class="ae ki" href="https://adaptivecards.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="il hj">适配卡</strong> </a> <strong class="il hj"> </strong>作为欢迎消息，而不是向用户发送普通的文本消息。</p><p id="dc0c" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">在本文中，我不会过多讨论适配卡，因为这超出了本文的范围。我建议阅读此<a class="ae ki" href="https://docs.microsoft.com/en-us/adaptive-cards/getting-started/bots" rel="noopener ugc nofollow" target="_blank">文章</a>以获得更多关于适配卡的信息。</p><p id="9724" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">因此，现在，我们需要创建一个自适应卡，并将其作为一个活动发送给用户，以便在频道上看到。一旦欢迎了一个新用户，就会为每个消息回合评估用户输入信息，并且机器人会根据该用户输入的上下文提供响应。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="lz ma l"/></div><figcaption class="lc ld et er es le lf bd b be z dx translated">向新用户发送欢迎消息的代码片段</figcaption></figure><p id="fa9f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">现在，我们运行上面的代码，看看当一个新用户被添加到对话中时，用户是否会收到欢迎消息。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es mb"><img src="../Images/d90e3a91ed501e390f614765fe01bc53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*aZKYHPaXBQiY3NwQfI0KvA.gif"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx translated">Bot模拟器片段</figcaption></figure><h1 id="ff72" class="mc lm hi bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated"><strong class="ak">结论:</strong></h1><p id="352d" class="pw-post-body-paragraph ii ij hi il b im mz io ip iq na is it jh nb iw ix ji nc ja jb jj nd je jf jg hb bi translated">在本文中，我们看到了如何使用python和Microsoft Bot Framework创建高效的聊天机器人，以及如何向新用户发送欢迎消息。在接下来的文章中，我们将看到如何使用LUIS和微软认知服务来实现对话、意图和实体的概念。</p><p id="3fcf" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">要查看上述代码，请点击我的Github repo的链接。</p></div></div>    
</body>
</html>