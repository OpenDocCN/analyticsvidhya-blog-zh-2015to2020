<html>
<head>
<title>NBA Data: A Live-Example of Data Cleansing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NBA数据:数据清洗的活生生的例子</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/nba-data-a-live-example-of-data-cleansing-c2d75195f352?source=collection_archive---------15-----------------------#2020-01-08">https://medium.com/analytics-vidhya/nba-data-a-live-example-of-data-cleansing-c2d75195f352?source=collection_archive---------15-----------------------#2020-01-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f0d2157a935fbc50f76405b084c7f04c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mevF3WbFo2INafOGee4IHQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">用一点点努力和熊猫你能做什么</figcaption></figure><h1 id="40c8" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">摘要</h1><p id="82cd" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">这篇文章介绍了一个数据清理练习，该练习使用Pandas库检查NBA球员日志，涵盖了Python中的大量主题。</p><blockquote class="kq kr ks"><p id="8cf2" class="js jt kt ju b jv ku jx jy jz kv kb kc kw kx kf kg ky kz kj kk la lb kn ko kp hb bi translated">议程:<br/> 1。遍历文件列表并将它们合并成一个数据帧。<br/> 2。构建自定义函数来清理混合的字符串/数字数据。<br/> 3。处理缺失/不完整的源数据，并使用Pandas类似SQL的合并功能来合并不同的数据集。<br/> 4。使用Pandas工具(如聚合和选择器)聚焦您的质量保证(QA)工作流。<br/> 5。如何使用Pandas、Panel和Altair(标题图像)构建仪表板。<br/> 6。使用Pandas进行使用itertuples的按行计算。</p></blockquote><p id="f4df" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">跳到底部，查看所有细节的要点。由于细节在代码本身中，我将从概念上谈论上述主题，以免过于冗长。</p></div><div class="ab cl lc ld gp le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hb hc hd he hf"><h1 id="8546" class="iu iv hi bd iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn ln jp jq jr bi translated">背景</h1><p id="8efd" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">首先，问题陈述:我如何使用来自未记录的API的数据来QA 30年的NBA球员游戏日志？</p><p id="e313" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">Excel(必要时还有VBA)通常是我分析大多数数据集的首选；如果这样做不起作用，下一步通常是将MS-Access添加到较小数据集的工作流中，或者查询SQL数据库以获得较大数据集，但在这种情况下，Excel不会起作用，特别是因为它自己的日期格式晦涩难懂，而且对于时间计算(以及其他事情)来说很糟糕。我知道Excel将强制某些格式，这将在以后产生问题，除非我在VBA做一堆预处理，这不是时间效率。参见<a class="ae lo" href="https://www.sciencemag.org/news/2016/08/one-five-genetics-papers-contains-errors-thanks-microsoft-excel" rel="noopener ugc nofollow" target="_blank">https://www . science mag . org/news/2016/08/one-five-genetics-papers-contains-errors-thanks-Microsoft-excel</a>。Excel非常适合现金流建模和假设分析，但不是我清理数据的首选工具。</p><p id="768e" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">这给了我一个很好的借口，在我感兴趣的项目中使用Python。</p></div><div class="ab cl lc ld gp le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hb hc hd he hf"><h1 id="df8b" class="iu iv hi bd iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn ln jp jq jr bi translated">装置</h1><p id="0b8a" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">浏览本教程需要笔记本中包含以下库/模块:</p><blockquote class="kq kr ks"><p id="6ed6" class="js jt kt ju b jv ku jx jy jz kv kb kc kw kx kf kg ky kz kj kk la lb kn ko kp hb bi translated">1.熊猫和Numpy<br/> 2。日期时间和时间；<br/> 3。面板+ Altair + HTML(来自Ipython)用于视觉效果；<br/> 4。OS(如果您想要硬编码文件路径，则可选)；<br/> 5。日志记录(可选)；<br/> 6。Xlwings(可选)；和<br/> 7。web浏览器(可选)。</p></blockquote></div><div class="ab cl lc ld gp le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hb hc hd he hf"><h1 id="6995" class="iu iv hi bd iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn ln jp jq jr bi translated">说到点子上</h1><h2 id="5591" class="lp iv hi bd iw lq lr ls ja lt lu lv je kd lw lx ji kh ly lz jm kl ma mb jq mc bi translated">遍历一组文件</h2><p id="c473" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">Python使循环变得非常简单，OS模块有助于更有效地处理文件和目录。</p><blockquote class="kq kr ks"><p id="1877" class="js jt kt ju b jv ku jx jy jz kv kb kc kw kx kf kg ky kz kj kk la lb kn ko kp hb bi translated">1.<strong class="ju hj"> os.getcwd() </strong>会获取你的根目录并存储在一个字符串中。<br/> 2。<strong class="ju hj"> os.listdir() </strong>会让你得到一个目录下的文件列表。将您的路径放在()中，并将这些文件存储在一个列表中。<br/> 3。现在您可以用一个<strong class="ju hj"> for </strong>循环来循环这个列表，其中每个元素都是一个文件。如果只想打开某些文件，可以使用一个<strong class="ju hj"> if </strong>语句。</p></blockquote><pre class="md me mf mg fd mh mi mj mk aw ml bi"><span id="a52a" class="lp iv hi mi b fi mm mn l mo mp">For element in directory list:<br/>    If element.endswith('*.csv'): #If element meets condition<br/>      df=pd.read_csv(element) #Do something</span></pre><h2 id="c35d" class="lp iv hi bd iw lq lr ls ja lt lu lv je kd lw lx ji kh ly lz jm kl ma mb jq mc bi translated">数据框行或列的自定义函数。应用</h2><p id="7318" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">有时，您需要对DataFrame中的元素应用自定义函数。熊猫<strong class="ju hj">。apply() </strong>方法使这变得简单明了。在我的例子中，我需要标准化每个玩家在每场比赛中的上场时间，因为有时它是一个字符串，有时它是一个整数，但是为了说明这个概念，最好使用一个简单的例子。</p><pre class="md me mf mg fd mh mi mj mk aw ml bi"><span id="cae0" class="lp iv hi mi b fi mm mn l mo mp">Define custom_function (x):<br/>  x = str(x) + 'day(s)' #Do something to x<br/>  Return x</span></pre><p id="1ca2" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">假设我的函数是x的平方，我想在数据帧的一系列中使用它，我可以如下应用它:</p><pre class="md me mf mg fd mh mi mj mk aw ml bi"><span id="e293" class="lp iv hi mi b fi mm mn l mo mp">[df[‘series_adj’]= df[‘series’].apply(custom_function).</span></pre><p id="7dcb" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">就是这样！如果“系列”包含值1、2、3、4，则“系列_调整”将变成“1天”、“4天”、“9天”、“16天”。注意如果<strong class="ju hj">。apply() </strong>用于数据帧。通过设置“轴”参数，可将该函数应用于行或列。</p><h2 id="a8e7" class="lp iv hi bd iw lq lr ls ja lt lu lv je kd lw lx ji kh ly lz jm kl ma mb jq mc bi translated">合并数据帧(处理缺失数据)</h2><p id="d397" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">当我查看NBA的数据时，<em class="kt">大部分</em>看起来不错，但仍然有数据问题，我后来确认是在源数据本身。我需要的一个关键字段是比赛发生的日期，幸运的是它在另一个表中可用。</p><ol class=""><li id="396a" class="mq mr hi ju b jv ku jz kv kd ms kh mt kl mu kp mv mw mx my bi translated">我必须看看我是否能把数据拉到其他地方<em class="kt">并且</em>使用一个公共键把它链接到我的源数据。<em class="kt">在继续下一步之前，始终确保你有办法连接数据集。</em></li><li id="7956" class="mq mr hi ju b jv mz jz na kd nb kh nc kl nd kp mv mw mx my bi translated">对于曾经使用SQL连接过表的人来说，下一步相对简单和直观(<a class="ae lo" href="http://www.sql-join.com/" rel="noopener ugc nofollow" target="_blank">http://www.sql-join.com/</a>是关于连接的教程)。请注意，默认情况下，Pandas假设一个内部连接，并尝试对键进行来宾操作，但更谨慎的做法是显式连接。</li></ol><pre class="md me mf mg fd mh mi mj mk aw ml bi"><span id="c8e5" class="lp iv hi mi b fi mm mn l mo mp">Merged_DataFrame = DataFrame1(DataFrame2,<br/>left_on = 'DataFrame1_key',<br/>right_on = 'DataFrame2_key',<br/>how = 'left/right/inner/outer')</span></pre><h2 id="8939" class="lp iv hi bd iw lq lr ls ja lt lu lv je kd lw lx ji kh ly lz jm kl ma mb jq mc bi translated">向工具箱添加聚合</h2><p id="a690" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">在某些情况下，隔离数据问题相对容易。例如，我知道每个玩家都应该有一个名字(或者不能为空)。理想情况下，这就是你需要筛选的全部内容——实际上，这几乎是不可能的。完全有可能一个球员在一场比赛中从来不出手，或者他的任何一次出手都没有命中(不是每个人都像勒布朗一样优秀)。</p><p id="91be" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">然而，常识告诉我们，虽然一个玩家可能在一场比赛中得不到分，但如果比赛开始了，就会有人得分。这就是聚合和选择器派上用场的地方。</p><p id="2cc1" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">通过聚合，我将把不同的玩家放在一起，使用一组共同的特征。例如，我可以为一个特定的游戏将所有的玩家分组到同一个团队中；最后，我把一个特定游戏中的所有玩家分组在一起，集中精力统计数据。</p><div class="md me mf mg fd ab cb"><figure class="ne ij nf ng nh ni nj paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/ed2554f878ab6685a2632c7cdf658338.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/0*JTLO831k3YhSc_fA.jpg"/></div></figure><figure class="ne ij nk ng nh ni nj paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/b09e67042579081b4b99b6fa9297d6a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/0*sc_NwHmdcPZ4KiEN.jpg"/></div><figcaption class="iq ir et er es is it bd b be z dx nl di nm nn translated">左:未分组；右:分组。</figcaption></figure></div><p id="b07b" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">在Pandas中，对数据帧中的元素进行分组非常简单(<a class="ae lo" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html" rel="noopener ugc nofollow" target="_blank">https://Pandas . py data . org/Pandas-docs/stable/reference/API/Pandas)。DataFrame.groupby.html</a>。</p><pre class="md me mf mg fd mh mi mj mk aw ml bi"><span id="756b" class="lp iv hi mi b fi mm mn l mo mp">grouper = DataFrame.<strong class="mi hj">groupby([list of grouper columns])<br/></strong>grouper = df.groupby(['col1','col2')</span></pre><p id="c3f0" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">这就是如何创建一个名为“group”的选择器变量。<em class="kt">注意，如果你只使用一列来分组，那么[]是不需要的，但是，我建议养成使用列表的习惯，即使只有一个元素来保持事情的一致性。</em></p><p id="c902" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">然后，您可以使用grouper变量进行聚合。如果需要，您也可以在一行中完成此操作。</p><pre class="md me mf mg fd mh mi mj mk aw ml bi"><span id="e019" class="lp iv hi mi b fi mm mn l mo mp">grouper.[list of numeric to aggregate].sum() #aggregation_method<br/>grouper.['col1','col2'].sum()</span></pre><p id="1ef8" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">在代码中，sum()、mean()、median()等将是一个聚合方法。您还可以使用。更细粒度聚合的agg()方法(<a class="ae lo" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.agg.html" rel="noopener ugc nofollow" target="_blank">https://pandas . pydata . org/pandas-docs/stable/reference/API/pandas。DataFrame.agg.html</a>。</p><p id="9562" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">在使用Pandas(<a class="ae lo" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html" rel="noopener ugc nofollow" target="_blank">https://Pandas . py data . org/Pandas-docs/stable/user _ guide/indexing . html</a>)时，除了DataFrame选择器之外，这一点非常重要。</p><h2 id="7d32" class="lp iv hi bd iw lq lr ls ja lt lu lv je kd lw lx ji kh ly lz jm kl ma mb jq mc bi translated">制作简单的仪表板</h2><p id="cd17" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">我将在以后的文章中写一篇关于制作交互式仪表板的教程，但是我想展示如何使用面板库制作一个简单的仪表板(关于面板的更多信息，请参见<a class="ae lo" href="https://panel.pyviz.org/user_guide/Components.html" rel="noopener ugc nofollow" target="_blank">https://panel.pyviz.org/user_guide/Components.html</a>)。</p><blockquote class="kq kr ks"><p id="3b95" class="js jt kt ju b jv ku jx jy jz kv kb kc kw kx kf kg ky kz kj kk la lb kn ko kp hb bi translated">这是一个关于Panel如何为dashboarding工作的高级总结，使用一个公告板进行比较:<br/> 1。Panel创建一个容器。这就像公告板。<br/> 2。该容器保存您的数字对象，如图表、表格或照片。<br/> 3。您可以按行和/或列对这些对象进行分组。<br/> 4。你把它们放在面板上。</p></blockquote><p id="767b" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">这使您可以添加小部件，使图表具有交互性，甚至可以构建应用程序，供任何有浏览器访问权限的人共享。</p><div class="md me mf mg fd ab cb"><figure class="ne ij no ng nh ni nj paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/4f66ab665fe0862bcc80e0c471206b6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/1*9TiFovnwxNC0vn8huxH9dg.jpeg"/></div></figure><figure class="ne ij np ng nh ni nj paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/026a1b71c8c26ea945532b654db65066.png" data-original-src="https://miro.medium.com/v2/resize:fit:1464/format:webp/1*O8Y2J_a-mRZCDzf1LUhRGg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx nq di nr nn translated">Panel允许您制作自己的数字公告板</figcaption></figure></div><h2 id="c167" class="lp iv hi bd iw lq lr ls ja lt lu lv je kd lw lx ji kh ly lz jm kl ma mb jq mc bi translated">使用Pandas和itertuples逐行遍历数据帧</h2><p id="dc61" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">在数据帧中进行跨行计算通常很容易。如果詹姆斯·哈登打了30分钟，得到30分，我可以用分钟数除以得分数。但是，如果我想做一些更复杂的事情，比如根据比赛之间的休息天数计算出他的得分如何变化，在这种情况下，我需要计算出，对于特定的比赛，<em class="kt">，</em>他休息了多少天？</p><p id="3a13" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">在Excel中，这相对简单。我可以只过滤詹姆斯·哈登，按日期排序，并按照截图输入公式。</p><figure class="md me mf mg fd ij er es paragraph-image"><div class="er es ns"><img src="../Images/b816939f77efca3e3cf2c553947a0dc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*NdKmEbZDVvI5yX69jWpD6w.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">熊猫不打算飞了</figcaption></figure><p id="8e99" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">然而，这在大规模数据集上不起作用，而且，即使它起作用，您也可能需要打开手动计算，并遇到潜在的性能问题。但是在熊猫身上你会怎么做呢？你不能像在Excel中那样做B3-B2。有一些方法，但是一旦你掌握了它，itertuples就像一个魔咒一样工作。这将为您提供一个元组，其中包含数据帧中的一行数据，其中row[index]可用于访问特定的列，因此列1 =索引0，列=索引1，等等。</p><p id="3e4a" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">比如说，我想遍历一个数据帧来比较不同行的数据。如果当前行的第4列与前一行的第4列相同，下面的示例将打印“match”。</p><pre class="md me mf mg fd mh mi mj mk aw ml bi"><span id="a559" class="lp iv hi mi b fi mm mn l mo mp">for row in <strong class="mi hj">df.itertuples()</strong>:<br/>  if row[0] != 0: #no comparison possible for the first row<br/>    if row[3] == last[3]:<br/>      print('match')<br/>      last = row<br/>  else:<br/>    last=row</span></pre><p id="d867" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">原来如此！我们已经讨论过议程了。</p><p id="009c" class="pw-post-body-paragraph js jt hi ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">这里有一个链接，链接到实际项目文件的要点。</p><figure class="md me mf mg fd ij"><div class="bz dy l di"><div class="nt nu l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae lo" href="https://github.com/tkpca/Python-Scripts/tree/master/Data%20Cleansing%20Example" rel="noopener ugc nofollow" target="_blank">https://github . com/tkpca/Python-Scripts/tree/master/Data % 20 cleaning % 20示例</a></figcaption></figure></div></div>    
</body>
</html>