<html>
<head>
<title>Designing High Availability Architecture with S3 and CloudFront</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用S3和CloudFront设计高可用性架构</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/designing-high-availability-architecture-with-s3-and-cloudfront-67684d6aa879?source=collection_archive---------16-----------------------#2020-11-03">https://medium.com/analytics-vidhya/designing-high-availability-architecture-with-s3-and-cloudfront-67684d6aa879?source=collection_archive---------16-----------------------#2020-11-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="ebf5" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">AWS云锋</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/4d876fd8fc8b13a01311edf93d53b9fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WvJN7OOLhZ4hyLSs.png"/></div></div></figure><p id="8cac" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj"> CloudFront </strong>是一个<strong class="jr hj"> CDN(内容交付网络)</strong>。它从亚马逊S3桶中检索数据，并将其分发到多个数据中心位置。它通过名为<strong class="jr hj">边缘位置</strong>的数据中心网络传递数据。当用户请求数据时，路由最近的边缘位置，导致最低延迟、低网络流量、快速访问数据等。</p><h1 id="3260" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">AWS CloudFront如何交付内容？</h1><p id="0d6e" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">AWS CloudFront通过以下步骤交付内容。</p><p id="338c" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">步骤1 </strong>用户访问一个网站，请求下载一个像图像文件一样的对象。</p><p id="7bcb" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">步骤2 </strong> DNS将您的请求路由到最近的CloudFront edge位置，为用户请求提供服务。</p><p id="cd22" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">第3步</strong>在边缘位置，CloudFront检查其缓存中所请求的文件。如果找到，则将其返回给用户，否则执行以下操作</p><p id="8ae4" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">步骤4 </strong>对象现在处于边缘缓存中24小时或文件头中提供的持续时间。这也被称为TTL(生存时间)</p><h1 id="9eb8" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">先决条件:</h1><ul class=""><li id="8f5e" class="ks kt hi jr b js kn jw ko ka ku ke kv ki kw km kx ky kz la bi translated">创建了一个AWS帐户。</li><li id="2cb7" class="ks kt hi jr b js lb jw lc ka ld ke le ki lf km kx ky kz la bi translated">安装AWS CLI。</li><li id="2443" class="ks kt hi jr b js lb jw lc ka ld ke le ki lf km kx ky kz la bi translated">使用IAM用户配置AWS CLI。</li></ul><p id="6775" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">有关使用CLI启动EC2实例和附加EBS卷的更多信息，可以参考我的博客。</p><div class="lg lh ez fb li lj"><a rel="noopener follow" target="_blank" href="/analytics-vidhya/launching-ec2-instance-using-cli-and-attaching-ebs-volume-6ce00456e55d"><div class="lk ab dw"><div class="ll ab lm cl cj ln"><h2 class="bd hj fi z dy lo ea eb lp ed ef hh bi translated">使用CLI启动EC2实例并连接EBS卷</h2><div class="lq l"><h3 class="bd b fi z dy lo ea eb lp ed ef dx translated">先决条件:</h3></div><div class="lr l"><p class="bd b fp z dy lo ea eb lp ed ef dx translated">medium.com</p></div></div><div class="ls l"><div class="lt l lu lv lw ls lx jn lj"/></div></div></a></div><p id="e164" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">在上面的博客中，我在IAM和CloudFront不可用的地方使用了AWS Educate。</p><h1 id="bff6" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">问题陈述:</h1><ul class=""><li id="366f" class="ks kt hi jr b js kn jw ko ka ku ke kv ki kw km kx ky kz la bi translated">EC2实例上配置的web服务器</li><li id="81e2" class="ks kt hi jr b js lb jw lc ka ld ke le ki lf km kx ky kz la bi translated">通过安装在EBS块设备上使文档根(/var/www/html)持久化。</li><li id="3664" class="ks kt hi jr b js lb jw lc ka ld ke le ki lf km kx ky kz la bi translated">代码中使用的静态对象，如存储在S3的图片</li><li id="c3ef" class="ks kt hi jr b js lb jw lc ka ld ke le ki lf km kx ky kz la bi translated">使用CloudFront建立内容交付网络，并将源域用作S3存储桶。</li><li id="e333" class="ks kt hi jr b js lb jw lc ka ld ke le ki lf km kx ky kz la bi translated">最后，为了安全和低延迟，将云前端URL放在web应用程序代码上。</li></ul><h1 id="3974" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">启动了EC2实例</h1><p id="d861" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">(参考我上面的<a class="ae ly" rel="noopener" href="/analytics-vidhya/launching-ec2-instance-using-cli-and-attaching-ebs-volume-6ce00456e55d?source=friends_link&amp;sk=2f35d4841272ded769b75bb5164e2b49">博客</a>)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lz"><img src="../Images/aebf7da63cdb25372880f8bf25246df5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IBChy-13D3hwsPIVHkZYIw.png"/></div></div></figure><h1 id="1e98" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">创建了一个EBS卷并连接到正在运行的EC2实例</h1><p id="933e" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">(参考我上面的<a class="ae ly" rel="noopener" href="/analytics-vidhya/launching-ec2-instance-using-cli-and-attaching-ebs-volume-6ce00456e55d?source=friends_link&amp;sk=2f35d4841272ded769b75bb5164e2b49">博客</a>)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ma"><img src="../Images/ef55738abf94355cbc5cec0bf6b6cd5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aiaU4TIyN8lYV12FunwAbg.png"/></div></div></figure><h1 id="dd0c" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">登录您的EC2实例</h1><ul class=""><li id="77a4" class="ks kt hi jr b js kn jw ko ka ku ke kv ki kw km kx ky kz la bi translated">登录到您的root帐户</li></ul><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="4a22" class="mg ig hi mc b fi mh mi l mj mk">sudo su - root</span></pre><ul class=""><li id="868e" class="ks kt hi jr b js jt jw jx ka ml ke mm ki mn km kx ky kz la bi translated">安装httpd web服务器</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mo"><img src="../Images/738bb65875e429938bbf2052dcc8e95b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IFVd-X0CNnyyfjpzuVRhyA.png"/></div></div></figure><ul class=""><li id="f053" class="ks kt hi jr b js jt jw jx ka ml ke mm ki mn km kx ky kz la bi translated">键入fdisk -l以检查是否添加了2 GB卷</li></ul><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="9992" class="mg ig hi mc b fi mh mi l mj mk">fdisk -l</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mp"><img src="../Images/4d704b7124310e9014213639680bdd40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lnlg_WOTKxDgouPwzMCiIg.png"/></div></div></figure><ul class=""><li id="a46d" class="ks kt hi jr b js jt jw jx ka ml ke mm ki mn km kx ky kz la bi translated">创建分区</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mq"><img src="../Images/493e3aa0e0bba7b58c6919ebb3891796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E5CexUb4YAiLwSWb24fTIA.png"/></div></div></figure><ul class=""><li id="92d8" class="ks kt hi jr b js jt jw jx ka ml ke mm ki mn km kx ky kz la bi translated">格式化分区并挂载到/var/www/html文件夹</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mr"><img src="../Images/08206a9906a1c9aa41ca281826e33f31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2dX22qcmsTkLATSbk4Up3A.png"/></div></div></figure><ul class=""><li id="7bf0" class="ks kt hi jr b js jt jw jx ka ml ke mm ki mn km kx ky kz la bi translated">现在，您可以看到在/var/www/html上又安装了一个2 GB的分区</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ms"><img src="../Images/3fb1520090309504e6d31e5578e45744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*odmjvjoBHhd2SQcuopU64g.png"/></div></figure><ul class=""><li id="23fc" class="ks kt hi jr b js jt jw jx ka ml ke mm ki mn km kx ky kz la bi translated">创建具有唯一名称的S3存储桶</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mt"><img src="../Images/ade81fefed2825275812ad0289677aa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9MAE3lTKuE3vxLTfcDX-6Q.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mu"><img src="../Images/0c6254dd897ad5f1d822b08f4ab452eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*UzI2DUpE-a2sH_N_pVM8eg.png"/></div><figcaption class="mv mw et er es mx my bd b be z dx translated">S3·巴特创造了</figcaption></figure><ul class=""><li id="a82f" class="ks kt hi jr b js jt jw jx ka ml ke mm ki mn km kx ky kz la bi translated">将内容复制到s3存储桶，只有读取权限</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mz"><img src="../Images/346fd5c7571edd8988ba075c9b39e127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8lp5INwfd_TCSe20uzRjfA.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es na"><img src="../Images/de85fad8aadbc6c29bfcdf20e08748b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KebT1BLHugfY6xlbHiL_sA.png"/></div></div><figcaption class="mv mw et er es mx my bd b be z dx translated">me1.jpeg成功复制了</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es nb"><img src="../Images/30e49d7751be34a190d879e3fe8bff30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*Q2v9rVVnKBc0Xu1FrrUhfw.png"/></div><figcaption class="mv mw et er es mx my bd b be z dx translated">访问图像的公共url</figcaption></figure><ul class=""><li id="c3bc" class="ks kt hi jr b js jt jw jx ka ml ke mm ki mn km kx ky kz la bi translated">我在文件夹/var/ww/html里面写了一个简单的index.html，包含一个简单的标题和图片标签</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nc"><img src="../Images/361818faf3654699a88b44c859df57d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tWRvpqJGYcFsbTOCqiOAPw.png"/></div></div></figure><ul class=""><li id="4541" class="ks kt hi jr b js jt jw jx ka ml ke mm ki mn km kx ky kz la bi translated">现在复制EC2实例的公共URL并访问web页面</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nd"><img src="../Images/f2e5b3c779144998ae03e63db77176ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3h15xGr63uE-hhTm6QNJFQ.png"/></div></div></figure><h1 id="12d0" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">现在，使用CloudFront建立内容交付网络，并将源域用作S3存储桶。</h1><ul class=""><li id="5086" class="ks kt hi jr b js kn jw ko ka ku ke kv ki kw km kx ky kz la bi translated">创建内容传递网络</li></ul><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="d122" class="mg ig hi mc b fi mh mi l mj mk">aws cloudfront create-distribution --origin-domain-name &lt;bucket name&gt;.s3.amazonaws.com</span><span id="f5e8" class="mg ig hi mc b fi ne mi l mj mk">aws cloudfront create-distribution --origin-domain-name bucket-webserver-03091999.s3.amazonaws.com</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nf"><img src="../Images/aa171ba413522929dc97277e05c60b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k59hx3PgTy4ESWbr4w9khA.png"/></div></div></figure><ul class=""><li id="db23" class="ks kt hi jr b js jt jw jx ka ml ke mm ki mn km kx ky kz la bi translated">转到AWS管理控制台的CloudFront部分，您会看到域名。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ng"><img src="../Images/a45d5858e859b351aff8a060dd1ada42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*WDWdXOCQStyDPT4OX7qGHg.png"/></div></figure><ul class=""><li id="b737" class="ks kt hi jr b js jt jw jx ka ml ke mm ki mn km kx ky kz la bi translated">复制域名并替换为之前配置的S3存储桶url。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nh"><img src="../Images/a8d496499b7f8a5cbbac05b48ae7510b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uORG7lncu27sG6QJlX71vA.png"/></div></div></figure><ul class=""><li id="c975" class="ks kt hi jr b js jt jw jx ka ml ke mm ki mn km kx ky kz la bi translated">现在再次访问图像</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ni"><img src="../Images/426cd6cb5bc17b1df08e051eee7da1cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d7O89jWKAI3DhlLJOpzdVA.png"/></div></div></figure></div></div>    
</body>
</html>