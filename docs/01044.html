<html>
<head>
<title>Build a Web App to convert Image document to scanned PDF document using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python构建一个Web应用程序，将图像文档转换为扫描的PDF文档</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/build-working-web-app-for-image-documents-to-scanned-pdf-document-conversion-using-python-5badf2c1e4eb?source=collection_archive---------5-----------------------#2019-09-27">https://medium.com/analytics-vidhya/build-working-web-app-for-image-documents-to-scanned-pdf-document-conversion-using-python-5badf2c1e4eb?source=collection_archive---------5-----------------------#2019-09-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/632f5980aed96a4ced3c271cebc39aa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R4zi-4vF8g9NUn3bWjTq4w.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片鸣谢:21壁纸:<a class="ae iu" href="https://d3n32ilufxuvd1.cloudfront.net/5a46aa90c9cbeb0b048db35b/1404778/upload-70fe63fc-930d-4ad4-b79b-d75a77084cd2.jpg" rel="noopener ugc nofollow" target="_blank">https://d3n 32 ilufxuv D1 . cloudfront . net/5a 46 aa 90 c 9 CB eb0 b 048 db 35b/1404778/upload-70 Fe 63 fc-930d-4a D4-b79b-d75a 77084 CD 2 . jpg</a></figcaption></figure><p id="66c9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这篇文章是关于将文本文档的多个图像转换为扫描的PDF文档，并使用Python中的Flask将该模型部署为Web app。</p><h1 id="00ba" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">为我们的项目设置虚拟环境</h1><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="6e71" class="la ju hi kw b fi lb lc l ld le">$ pip install virtualenv</span></pre><p id="d07d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建虚拟环境，并将其命名为“imagetopdf”</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="b4a3" class="la ju hi kw b fi lb lc l ld le">$ virtualenv imagetopdf</span></pre><p id="e844" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">激活我们的虚拟环境</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="ddad" class="la ju hi kw b fi lb lc l ld le">$ source imagetopdf/bin/activate</span></pre><p id="4bee" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">移动到我们的项目文件夹“imagetopdf”并创建一个新文件夹“app”。<br/>我们所有的文件都存放在这个目录下，路径为<br/> "~/../imagetopdf/app/"</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="c858" class="la ju hi kw b fi lb lc l ld le">$ cd imagetopdf &amp;&amp; mkdir app &amp;&amp; cd app</span></pre><p id="a0c7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在安装所需的依赖项</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="2a21" class="la ju hi kw b fi lb lc l ld le">$ pip install opencv-python<br/>$ pip install PIL<br/>$ pip install scikit-image</span></pre><p id="d709" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">打开文本编辑器，创建一个名为“imagetopdf.py”的python文件</p><h1 id="810b" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">导入包</h1><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="lf lg l"/></div></figure><h1 id="66b3" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用cv2加载图像并转换成二进制图像</h1><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="e3cb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">用文件扩展名加载当前工作目录中的图像。jpeg，。png，。jpg <br/>作为cv2数组，通常是“BGR”格式。通过从目录加载将所有图像插入列表。</p><p id="9306" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">注意:</strong> PDF页面的构建顺序与从目录中读取图像的顺序相同。因此，名为' img_1 '，' img_2 '，…..理解图像的期望顺序。</p><p id="9d28" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了更好的图像操作，将“RGB”图像转换为二进制图像。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="88bc" class="la ju hi kw b fi lb lc l ld le">img_gray=cv2.cvtColor(img,cv2.COLOR_BGR2GRAY)</span></pre><p id="c6d1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将图像从“rgb”格式转换为“灰度”格式。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="edc0" class="la ju hi kw b fi lb lc l ld le">clahe=cv2.createCLAHE(clipLimit=4.0,tileGridSize=(16,16))<br/>img_gray=clahe.apply(img_gray)</span></pre><p id="09e3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上述线条通过应用<a class="ae iu" href="https://docs.opencv.org/master/d5/daf/tutorial_py_histogram_equalization.html" rel="noopener ugc nofollow" target="_blank">“直方图均衡化”</a>来提高图像对比度</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="e402" class="la ju hi kw b fi lb lc l ld le">ret,th=cv2.threshold(img_gray,130,255,cv2.THRESH_BINARY)<br/>thsh_images.append(th)</span></pre><p id="9924" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将图像阈值应用于threshold_value=130的灰度图像，并将二值图像存储在列表中。</p><figure class="kr ks kt ku fd ij er es paragraph-image"><div class="er es lh"><img src="../Images/5b8cb20c335c11c23cb0f06e9a9bf6fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*acMMiZTCxJDMG8qcz-ygEA.jpeg"/></div></figure><h1 id="2574" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">在图像中查找轮廓并使最大面积轮廓适合图像</h1><p id="86a4" class="pw-post-body-paragraph iv iw hi ix b iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo lm jq jr js hb bi translated">可能会出现只拍摄感兴趣区域的图像，即图像包含不需要的其他内容和背景，应该只缩放到单页。像下面的图像，其中包含背景和下一页的一些部分</p><figure class="kr ks kt ku fd ij er es paragraph-image"><div class="er es lh"><img src="../Images/0e01da592a7516e57572880272a7f08c.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*LQF5ozGShL0ztTzcd3UQEA.jpeg"/></div></figure><p id="5c14" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了从图像中只获取重要的内容，我们在opencv中使用轮廓提取我们感兴趣的区域。</p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="bb53" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由于我们感兴趣的区域是图像的最大区域，所以可以使用最大轮廓区域来识别它，该最大轮廓区域可以接近矩形形状。对于每幅图像，获得最大面积轮廓，这是我们的单页图像文件，并拟合图像的轮廓，就像在图像中画东西一样。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="e981" class="la ju hi kw b fi lb lc l ld le">contours,_=cv2.findContours(img.copy(),cv2.RETR_TREE,cv2.CHAIN_APPROX_SIMPLE)</span></pre><p id="c01d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">cv2。RETR树方法在层次顺序和cv2中寻找轮廓。CHAIN_APPROX_SIMPLE只适合描述整个轮廓的轮廓位置坐标，而不是占用更多空间的整个轮廓坐标。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="852c" class="la ju hi kw b fi lb lc l ld le">area=cv2.contourArea(cnt)<br/>if area &gt; max_area:<br/>   max_area=area<br/>   max_ind=ind</span></pre><p id="6a1e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">检索每个轮廓的面积，并找到轮廓的最大面积，如下所示</p><figure class="kr ks kt ku fd ij er es paragraph-image"><div class="er es lh"><img src="../Images/3edd5be379b9cd3eb5f3d8942c8a636c.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*HCb5PbKQbBmMyzhB2hTeVg.jpeg"/></div></figure><h1 id="5b93" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">绘制最接近最大轮廓的矩形形状，这通常描述一页PDF</h1><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="ebf5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">拟合轮廓可以是任何形状，但我们正在寻找矩形形状，这是桌面，智能手机正常屏幕的形状…</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="35e0" class="la ju hi kw b fi lb lc l ld le">epsilon=0.02*cv2.arcLength(image_conts[ind[max_area_conts[ind]],True)<br/>approx=cv2.approxPolyDP(image_conts[ind[max_area_conts[ind]],epsilon,True)</span></pre><p id="f611" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面的线为我们拟合的最大面积轮廓找到最近的矩形点，如下所示</p><figure class="kr ks kt ku fd ij er es paragraph-image"><div class="er es lh"><img src="../Images/d7d4cb511cb0e4d3098dc33ad967a74a.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*lGDbcuQORMS6zAUJn9thOQ.jpeg"/></div></figure><h1 id="4b5d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用透视变换将矩形的四条边变换为图像的全坐标</h1><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="6185" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们最终得到一个矩形轮廓，这就是感兴趣的区域。现在放大或提取这个矩形形状，就像从img1到img2</p><figure class="kr ks kt ku fd ij er es paragraph-image"><div class="er es lh"><img src="../Images/12fefd58d2536c6bf3509c55580c99fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*9CITlMSvJQbDX19oVq29Kg.jpeg"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">img1:带有不需要的背景的原始图像</figcaption></figure><figure class="kr ks kt ku fd ij er es paragraph-image"><div class="er es lh"><img src="../Images/784f8b72a2841350fe178bb29c7ca4e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*9GoBFFOZ71jEvhgUgaXt0A.jpeg"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">img2:所有背景都在一定程度上被移除</figcaption></figure><h1 id="af89" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用scikit-image提高灰度图像对比度并保存图像</h1><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="lf lg l"/></div></figure><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="943b" class="la ju hi kw b fi lb lc l ld le">th=threshold_local(img_gray.copy(),101,offset=10,method=”gaussian”)</span></pre><p id="85ab" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">$ pip install guni corn<br/>$ echo " web:guni corn-w4-b " 0 . 0 . 0 . 0:$ PORT " app:app "&gt;procfile above scikit-image的threshold_local()函数增加低对比度图像非常高的对比度像下面从img1到img2</p><figure class="kr ks kt ku fd ij er es paragraph-image"><div class="er es lh"><img src="../Images/bcf855770a212292e60ea56c9ec166e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*tdq5yOhIA2A6OF8fFyVZMQ.jpeg"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">img1:低对比度图像</figcaption></figure><figure class="kr ks kt ku fd ij er es paragraph-image"><div class="er es lh"><img src="../Images/b048564569b655c1aabe3a8593958b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*mKT_dpysIce4wa3sSC41aA.jpeg"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">img2:提高图像对比度</figcaption></figure><p id="f5a9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">用图像的“数字化_+原始名称”名称保存高对比度图像，这有助于查找要转换为PDF的图像。</p><h1 id="b5d9" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用PIL加载保存的高对比度图像并另存为PDF</h1><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="d74d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">加载保存的图像前缀“数字化_”与PIL图像，并保存为PDF文件。</p><h1 id="6369" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用Flask制作Web界面</h1><p id="d257" class="pw-post-body-paragraph iv iw hi ix b iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo lm jq jr js hb bi translated">安装烧瓶和Werkzeug</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="dd20" class="la ju hi kw b fi lb lc l ld le">$ pip install Flask</span></pre><p id="1b7d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Flask是一个轻量级框架，用于在python中构建简单的后端应用程序引擎。</p><p id="6b03" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">烧瓶模型通常包含以下骨架。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="45e3" class="la ju hi kw b fi lb lc l ld le">from flask import Flask <br/> <br/>app = Flask(__name__)   </span><span id="a01f" class="la ju hi kw b fi ln lc l ld le">@app.route("/") <br/>def hello():     <br/>    return "Hello World!"   </span><span id="e54e" class="la ju hi kw b fi ln lc l ld le">if __name__ == '__main__':     <br/>    app.run(debug=True)</span></pre><p id="0874" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第一行从flask包中导入Flask类，<br/>第二行用“__name__”为Flask类创建app对象，这是我们应用程序的主url，<br/>第三行定义了一个decorator，它路由前缀为“/”的主url之后的任何名称，如<a class="ae iu" href="http://home/," rel="noopener ugc nofollow" target="_blank"> http://home/，</a> <br/>第四和第五行定义了一个必须为上述decorator执行的函数，<br/>第七行运行我们的应用程序引擎，其中“debug=True”表示调试模式开启。<br/>如果我们运行这个脚本，文件名保存为“app.py ”,如果没有错误，我们可以看到这样的屏幕</p><figure class="kr ks kt ku fd ij er es paragraph-image"><div class="er es lo"><img src="../Images/c21c9b05001283537b7ae6d072060f60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*ZPT04uKRNXxIXJNg9207qA.png"/></div></figure><p id="f2d9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要测试我们的应用程序，打开浏览器并输入“localhost:5000”</p><figure class="kr ks kt ku fd ij er es paragraph-image"><div class="er es lp"><img src="../Images/7c9374b9dc995cef88f980e8507b845f.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*AWoKrPfSWRElBfQdRt8fKA.png"/></div></figure><p id="e8af" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，为了部署我们的模型，使用HTML对“app.py”文件进行更改，以添加从用户那里获取文件的接口</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="ce08" class="la ju hi kw b fi lb lc l ld le">"index.html"</span><span id="04c9" class="la ju hi kw b fi ln lc l ld le">&lt;html&gt;<br/>    &lt;head&gt;<br/>    &lt;/head&gt;<br/>    &lt;body&gt;   <br/>        &lt;!-- File Uploading--&gt;  <br/>        &lt;form action='/uploadimages' method="POST"  <br/>                       enctype="mutlipart/form-data&gt;              <br/>            &lt;input type="file" name="files" multiple /&gt;   <br/>            &lt;input value="Upload"&gt;<br/>        &lt;/form&gt;<br/>     &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="9b0d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在上面的代码片段中，在<form action="”/uploadimages”">中，部分“/uploadimages”说明了提交表单时app engine应该路由到哪里。这里“uploadimages”是app . route("/upload images ")decorator的名称，我们定义函数来处理这个文件请求。</form></p><p id="0ae6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了处理HTML文件请求，我们必须将我们HTML文件保存在一个名为“templates”的单独文件夹中，该文件夹将由Flask识别，用于路由HTML页面。你可以添加更多的CSS，JS，JQuery，Bootstrap和媒体内容，如图像，视频等。，但所有这些文件必须保存在另一个名为“static”的文件夹中。</p><p id="f45a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">注意:</strong>通过添加名为“imagetopdf”的类来更改“imagetopdf.py”，该类的函数“convert()”包含了我们之前将图像转换为pdf的所有代码。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="d3af" class="la ju hi kw b fi lb lc l ld le">from flask import Flask,requests,render_template,send_from_directory<br/>from imagetopdf import Imagetopdf<br/>import os</span><span id="ea94" class="la ju hi kw b fi ln lc l ld le">app=Flask(__name__)</span><span id="bc20" class="la ju hi kw b fi ln lc l ld le">@app.route('/uploadimages', methods=['POST','GET'])<br/>def uploadimages():<br/>    file_names=[]<br/>    curr_path=os.getcwd() <br/>    files_in_dir=os.listdir()<br/>    for file in file_names:<br/>        if file.split('.')[-1] is in ['jpeg','png','jpg','pdf']:<br/>            os.remove(file)<br/>    uploaded_files=request.files.getlist("files") <br/>    for file in uploaded_files:  <br/>        if file.filename.split('.')[-1] is in ['jpeg','png','jpg']:<br/>            file.save(file.filename)<br/>    imagetopdf_obj=imagetopdf.Imagetopdf()<br/>    imagetopdf.convert()<br/>    try:<br/>        return send_from_directory(curr_path,'digitised_images.pdf',<br/>                                             as_attachment=True)<br/>    except Exception:<br/>        abort(404)                     </span><span id="68c1" class="la ju hi kw b fi ln lc l ld le">@app.route("/")<br/>def index():<br/>    render_template("index.html")</span><span id="f6d0" class="la ju hi kw b fi ln lc l ld le">if __name__ == "__main__":<br/>    return app.run(debug=True)</span></pre><p id="8edd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在上面的代码片段中，我们通过添加文件请求处理例程来更改我们的“app.py”。我们首先删除任何以前的图像或pdf文件，然后保存上传的图像，使用我们的“imagetopdf.py”转换为PDF。</p><h1 id="6142" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用Heroku免费主机部署到web</h1><p id="842d" class="pw-post-body-paragraph iv iw hi ix b iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo lm jq jr js hb bi translated">使用命令安装Heroku CLI</p><p id="233c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lq lr ls kw b">$ sudo snap install --classic heroku</code></p><p id="f44c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在那之前在<a class="ae iu" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a>创建一个账户</p><p id="deb5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">登录你的Heroku账户</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="a63d" class="la ju hi kw b fi lb lc l ld le">$ heroku login -i</span></pre><p id="fcee" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在在Heroku中创建一个应用引擎</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="cff7" class="la ju hi kw b fi lb lc l ld le">$ heroku create {name of your app}</span></pre><p id="e0e3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">转到我们的虚拟环境的项目目录“app ”,在那里我们的文件和其他子目录结构</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="b1fa" class="la ju hi kw b fi lb lc l ld le">app<br/>--templates<br/>--static<br/>-app.py<br/>-imagetopdf.py</span></pre><p id="5bec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">用文本“web:guni corn-w4-b”0 . 0 . 0 . 0:$ PORT“app:app”创建一个“Procfile”。为此，首先安装“gunicorn”</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="488d" class="la ju hi kw b fi lb lc l ld le">$ pip install gunicorn<br/>$ echo “web: gunicorn -w 4 -b “0.0.0.0:$PORT” app:app” &gt; Procfile</span></pre><p id="7392" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由于我们的应用程序需要依赖项，Heroku安装这些依赖项，如果在一个名为“requirements.txt”的单独文件中提供。使用命令“pip freeze”可以很容易地检索到这种依赖性，并将其保存到文件“requirements.txt”中</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="6c06" class="la ju hi kw b fi lb lc l ld le">$ pip freeze &gt; requirements.txt</span></pre><p id="a8d4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">重要提示:</strong> OpenCv错误如<br/>“无法导入共享库libsm.co.6 ….”如果直接部署到Heroku可能会遭遇。这可以通过将“requirements.txt”文件中的<br/>“opencv-python = = 4 . 1 . 1 . 26”改为“opencv-python-headless = = 4 . 1 . 1 . 26”来处理。这将Opencv使用GPU支持的状态更改为仅使用CPU。</p><p id="5fe2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们的文件结构看起来像这样</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="d454" class="la ju hi kw b fi lb lc l ld le">app<br/>--templates<br/>--static<br/>-app.py<br/>-imagetopdf.py<br/>-Procfile<br/>-requirements.txt</span></pre><p id="ccbc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过“git ”,我们可以很好地将我们的应用程序部署到Heroku。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="80b2" class="la ju hi kw b fi lb lc l ld le">$ git init<br/>$ heroku git:remote -a {name of your app}<br/>$ git add . <br/>$ git commit -m “some message”<br/>$ git push heroku master</span></pre><p id="50af" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">检查Heroku dashboard中关于成功构建的日志。如果一切顺利，我们的应用程序现在已经部署到网络上，任何人都可以使用URL<br/>“https://{ nameofourapp } . heroku app . com/”来访问它</p><p id="05dc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里是我部署我的模型<a class="ae iu" href="https://imagetopts.herokuapp.com/imagetopdf" rel="noopener ugc nofollow" target="_blank">https://imagetopts.herokuapp.com/imagetopdf</a>的网站的链接(仅适用于imagetopdf功能)</p><p id="967c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">注意:</strong>上传小尺寸图片，因为免费帐户可能会面临超时错误，并且<br/>由于我们尚未订阅，从睡眠状态重新启动需要20秒。</p><p id="f176" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">也可以使用命令进行本地测试</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="def7" class="la ju hi kw b fi lb lc l ld le">$ heroku open</span></pre><p id="ffdf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果未启动或出现应用程序错误，请使用命令检查日志</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="49df" class="la ju hi kw b fi lb lc l ld le">$ heroku logs -t </span></pre><p id="189a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">检查我的Github库，我添加了另外两个特性Imagetotext和Imagetospeech。</p><div class="lt lu ez fb lv lw"><a href="https://github.com/santhalakshminarayana/image-to-pdf-text-speech" rel="noopener  ugc nofollow" target="_blank"><div class="lx ab dw"><div class="ly ab lz cl cj ma"><h2 class="bd hj fi z dy mb ea eb mc ed ef hh bi translated">santhalakshminarayana/图像-pdf-文本-语音</h2><div class="md l"><p class="bd b fp z dy mb ea eb mc ed ef dx translated">github.com</p></div></div></div></a></div><p id="ba55" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">随意连接<br/><a class="ae iu" href="https://www.linkedin.com/in/santhalakshminarayana/" rel="noopener ugc nofollow" target="_blank">Linkedin</a><a class="ae iu" href="https://github.com/santhalakshminarayana" rel="noopener ugc nofollow" target="_blank">Github</a></p></div></div>    
</body>
</html>