# 家庭每小时用电量的预测

> 原文：<https://medium.com/analytics-vidhya/prediction-of-hourly-household-power-consumption-c680a9eb9190?source=collection_archive---------4----------------------->

![](img/44865a3474bcd9f278c05ca5e34a9ed9.png)

马库斯·斯皮斯克在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

随着最近智能电表在住宅领域的增加，我们有了大量公开可用的数据集。有了这些数据，可以几乎实时地跟踪单个家庭的电力消耗。

这种预测可以帮助电力公司调节他们的供应；此外，消费者可以利用这些信息做出更好的财务和环保决策。

在这个项目中，我们通过尝试 4 种不同的机器学习算法来进行比较分析，以了解哪种方法效果最好，从而解决这一挑战。

***使用的 4 种方法是:***

*   ***【自回归(AR 模型)***
*   ***支持向量回归***
*   ***线性回归***
*   ***随机森林***

让我们把讨论转移到项目的介绍上来。

# 介绍

随着新设备的出现和全球范围内对更大电气化项目的推动，全球电力消耗正在上升。[(https://data.worldbank.org/indicator/EG.USE.ELEC.KH.PC)](https://data.worldbank.org/indicator/EG.USE.ELEC.KH.PC)。

因此，我们也可以预计，家庭或住宅用电量将会上升。随着对全球电力消耗数据的更多访问，预测电力消耗是一个新的挑战。

准确的预测对消费者和供应商都有帮助。对于消费者来说，电力预测有助于财务规划，因为总体上做出了更多的绿色选择。对于供应商来说，准确的预测肯定有助于供应调节。因此，此类模型有助于优化家用电力行业的整体供应链。

由于这是一个相当受欢迎的话题，迄今为止已经尝试了从神经网络到回归到随机森林的多种方法。由于本课程的范围主要限于最大似然算法，以下讨论和整个项目仅基于最大似然算法。

虽然研究显示了 DL 算法[(金泰永和宋培昭，2019)](https://www.sciencedirect.com/science/article/abs/pii/S0360544219311223?via%3Dihub) 的前景，但我们不会在这个项目中研究这些算法。

四种最大似然法显示了这种预测的巨大潜力。(尽管有时多种方法的结合也是有希望的)。**这些方法是:**

## 自动回归

理论上，ARIMA 模型最常用于预测时间序列数据的未来值。博克斯和詹金斯首先推广了 ARIMA 模型。它将时间序列的未来值预测为其自身过去值和/或预测误差滞后的线性组合(也称为随机冲击或创新)。

Box 和 Jenkins 指出，这些模型不涉及独立变量，而是使用序列中的信息来生成预测。因此，ARIMA 模型依赖于序列中的自相关模式。

## 支持向量回归机

SVR 是 SVM 的一种实现，用于预测连续值输出。在 SVR 中，我们使用与 SVM 相同的保证金。目标超平面周围的这个余量表示预测中可容许的误差量。

![](img/65b35b40700c79f5058bfdd4a9250dfe.png)

这个余量是由 SVR 的参数 **ϵ** (上图)定义的。处于裕量范围内的实例不会产生任何成本；这就是为什么我们称这种损失为“ε不敏感”

SVR 是一种最佳的边际回归算法，甚至可以很好地处理非线性数据(通过适当的内核技巧)。( [X. M. Zhang 等人，2018](https://ieeexplore.ieee.org/document/8614049) )在类似问题上已经显示出有希望的结果。

## 线性回归

线性回归试图在数据中拟合一条线。如果目标函数本质上是线性的，则线性回归很快，特征之间几乎没有相关性。

线性回归的问题是，有时模型过于简单，无法恰当地拟合复杂的现实世界数据。

在这项工作中，在进行更复杂的模型之前，该模型已被用于简单模型的基线性能。

## 随机森林

随机森林算法是基于决策树的。决策树非常快，但容易过度拟合。

随机森林仅用于解决这一特定原因。简而言之，我们使用一种叫做“引导聚合”或 Bagging 的方法，从总数据集中随机抽取样本进行替换。然后将每个随机样本与决策树相匹配。对于输出，我们聚合每个决策树的结果以获得单个结果。

随着森林中树的数量增加，树具有重叠训练集的机会就越大。但是，这样做的好处是在预测过程中会投更多的票，从而减少泛化误差。已经表明，随着树木数量的增加，精确度接近森林的理论极限( [L. Breiman，2001](https://www.stat.berkeley.edu/users/breiman/randomforest2001.pdf) )。

现在，我们已经对将要在这里使用的不同模型有了基本的了解，所以让我们继续进行数据集的预处理部分。

# 数据集分析和可视化

“[家庭用电量](https://archive.ics.uci.edu/ml/datasets/Individual+household+electric+power+consumption)数据集是一个多元时间序列数据集，描述了单个家庭四年的用电量。

该数据集包含 2006 年 12 月至 2010 年 11 月(47 个月)期间 Sceaux(距离法国巴黎 7 公里)单个家庭的每分钟功耗数据。

这是一个多变量序列，由七个变量组成(除了日期和时间)，它们是:

**1。日期:**格式为日/月/年的日期

**2。时间:**hh:mm:ss 格式的时间

**3。global_active_power:** 家庭全球分钟平均有功功率(千瓦)

**4。global_reactive_power:** 家庭全球分钟平均无功功率(千瓦)

**5。电压:**分钟平均电压(伏特)

**6。global_intensity:** 家庭全球分钟平均电流强度(安培)

**7。sub_metering_1** :能源分表№1(有功电能瓦时)对应于厨房，主要包含洗碗机、烤箱和微波炉(热板不是电动的，而是燃气驱动的)。

**8。sub_metering_2:** 电能子计量№2(有功电能的瓦特小时)对应于洗衣间，包含洗衣机、滚筒式烘干机、冰箱和灯。

**9。分表 3:** 电能分表№3(有功电能瓦时)对应电热水器和空调。

我们可以假设**电压*电流=功率**应该给出两者之间的线性关系，确认如下。

![](img/3e4e532bd8a26d14bb257c5fd5b3cd10.png)

由于电压和电流是决定有功功率的唯一因素，这两个特性已被删除，因为使用这种模型没有任何用处。

无功功率是由于所有设备造成的总功率损失，并且是随机分布的。

![](img/13e7c4f58d97bcd5c2447cb7a5af1f6a.png)

但是，我们可以看到的总体趋势是无功功率<< Active Power. So, finally, active power is being considered only as this the power which is metered.

Now, the below plot shows *有功功率与三个计量功率之和*。我们看到有功功率始终是> SUM(计量功率)。因此，我们得出结论，计量功率是有功功率的一部分，其余的是未计量功率。

![](img/4e70c59a1aa44de858c20c25ba208449.png)

目前，我们考虑了时间和计量功率来预测有功功率，因为计量功率的总和给出了有功功率的下限。此外，您可以扩展它以使模型更健壮，并且只包含预测时间。

接下来，我们研究*时间与有功功率:*

![](img/e4c605349c108e71fcd65bc5d9a547c8.png)

从图中，我们看到功耗在晚上 9 点最高，第二个高峰在上午 9 点左右。按月计算，我们注意到八月的平均功耗最低。

![](img/524509eed88a420b87f30a755b5293ef.png)

年度趋势显示，总体平均功耗在此期间有所下降。

![](img/521d6f6b81dfdd58f00c6212562d7e1a.png)

总的来说，我们看到时间是决定力量的一个巨大因素。基于此，选择时间和 3 米读数作为特征(自动回归模型除外)，同时选择有功功率作为目标变量。

# 对比分析和建议计划

为了进行比较分析，使用了 R2 参数。

R2 被定义为:

![](img/725dee30153129facf772182dec10f7e.png)

或者，

![](img/36613181ae922d61dc522e1502155c14.png)

因此，我们可以将 R2 分数解释为模型所解释的产量差异量。例如，R2 分数为 1 意味着该模型解释了数据中 100%的方差。因此，我们试图使 R2 分数尽可能高。然而，R2 分数并没有告诉我们，一个个体模型有多好。

因此，我们使用 R2 评分来比较等价模型，然后检查它们的 RMSE(如下所示)来估计回归误差。

![](img/744bc7ed8c25b7570fcfcaa5a4ca8b30.png)

现在我们来一个一个的模型。

## ARIMA 模型

ARIMA (p，d，q)模型有三个参数。AR 参数' p '表示自回归过程的阶，I 参数' d '表示序列为非平稳时差分得到平稳序列的阶，MA 参数' q '表示滑动平均过程的阶。自回归围绕着回归变量之前的条件。模型的 **I** 参数一般适用于样本中的数据非平稳的情况。如果数列是平稳的，那么 d=0，如果数列是一阶差分平稳的，那么 d=1，依此类推。移动平均参数表示变量线性依赖于随机项的当前和过去值。

此外，在自回归模型中，我们依赖于部分自相关函数，又名 PACF，对于移动平均线，我们依赖于自相关函数或简称为 ACF。为了了解 Lag 的值，我们将绘制 PACF 和 ACF 图。

![](img/01f987c4071c8ef5e6e0b66a1df3adac.png)

在这里，我们将主要关注 AR 模型，这意味着我们必须关注获得和观察 AR 参数‘p’PACF(偏自相关图)；获得“p”值并根据该预测训练我们的 AR 模型后，我们将获得:

![](img/84ca0711d2adc7dab970d2d3bdf616b2.png)

从上面的图看起来可能很模糊，所以让我们放大一下。

![](img/828821fb7508af6e4551aa2bb00fe969.png)

这个看起来好多了；正如我们所看到的，蓝色线显示的是实际值，红色线显示的是预测值。我们还可以观察预测值与实际值的接近程度，尽管它仍然给出了 0.433 的 R2 分数和 32.77 的 RMSE 分数，这不是我们想要的，所以让我们也尝试看看其他模型。

## **支持向量回归和线性回归模型**

在支持向量回归中，我们使用与 SVM 相同的边际。目标超平面周围的这个余量表示预测中可容许的误差量。SVR 的参数ϵ定义了这个余量。在此范围内的实例不会产生任何成本；这就是为什么我们称这种损失为“ε不敏感”这就是为什么我们不关心在这个范围内的点。SVR 的思想是在高维空间中计算线性回归，其中使用非线性函数映射输入数据点。

![](img/e0412308848710b7e9d0245f0f20dcb7.png)

在这种方法中，我们对数据使用了 5 次折叠分裂，以更好地了解 SVR 和 LR 模型在不同折叠下的表现。

因此，让我们对数据的相同折叠使用 SVR 和线性回归，并比较它们的性能。

![](img/458ccb6b89a3eda2455ae94ca7f30024.png)

R2 在 SVM 和 LR 上的不同折叠得分

![](img/4dd241a1bbecb4a454f853ce7e765303.png)

SVM 和 LR 上不同褶皱的 RMSE

从图中可以明显看出，在预测家庭用电量方面，线性回归的表现略好于支持向量回归。现在让我们继续我们的最后一个模型，随机森林，看看它与其他模型相比有多好。

## 随机森林模型

***随机森林(Random Forest)是一种分类器，它包含给定数据集的各个子集上的许多决策树，并取平均值以提高该数据集的预测准确性。***

随机森林使用自举或打包来组合来自多个决策树的输出。我们随机选择带有替换的多个数据点子集，用 1 个数据子集训练每个模型，然后取每个模型输出的平均值。

![](img/d3dfba8b57a322d06409b7389cae3dea.png)

对于我们的功耗数据，随机森林往往会消耗大量的磁盘空间，限制模型的最大深度很重要。否则，较高的深度也会导致过度拟合。

树的数量也很重要，树越多花费的时间越多，但也越准确。这里我们选择最大深度= 15，树的数量= 200，然后尝试绘制 RMSE 为

![](img/dd483704aac584b388531f8706cba396.png)

正如我们所看到的，这个模型的 RMSE 很低。此外，我们得到的 R2 分数是 R2=0.87，这个分数相当高，相当不错。因此，总的来说，我们看到随机森林在 R2=0.87 时给出了最好的结果，这是所有模型中性能最好的。

这是我们对所有模型进行的比较分析，下表以更好的方式向我们展示了这种比较。

![](img/52350c45ebefc794e6482ca75c141a1b.png)

我们现在可以得出结论，在我们的数据集上，具有最大 R2 分数和最小 RMSE 的自回归表现最差，随机森林表现最好。现在，接下来是什么？

在获得所有四个模型中的最佳模型后，我们现在可以只关注随机森林，以进一步分析和预测功耗。

## 利用随机森林模型进行预测

随机森林由多个个体回归树组成。每个回归树被允许增长到大量的节点(因此过度拟合)。通过计算它们的平均值来考虑每棵树的产量。出于训练目的，将总数据的 50%随机分配(替换)给每一棵树。

***超参数:*** 树的数量和每棵树的深度。

观察性能后，森林中的树木数量固定为 200，我们对深度进行了网格搜索。

***所用参数:*** 实现了 2 种不同类型的模型。

## ***第一款***

这里，我们考虑了时间数据和分项计量数据。因此，在该模型中，我们根据可用的分表读数和时间数据预测了总功耗(包括浪费的功耗)。

## 第二款

我们认识到，根据电表读数计算总功率在现实情况下可能效率不高。因此，该模型仅基于时间来预测每小时的功耗。

由于包括分表数据将允许模型训练更多的数据，并且总分表读数提供了总功率的硬下限(当浪费的功率= 0 时)，我们预计第一个模型的性能将明显更好。

让我们找出它。

## **带分项计量数据的模型**

***图为 R2 的分数:***

![](img/a0835256a36cde807d7d05ae9b2744df.png)

对于训练数据集

![](img/111b4ca3bc3bded7da2f14a538062844.png)

对于验证数据集

在亚微米数据可用的情况下，我们看到验证 R2 得分约为 0.87，与之前在比较分析中获得的值一致。我们还绘制误差值，以评估我们的模型有多好。这些分数如下所示:

***剧情为 RMSE:***

![](img/86cd587d4d3716f5d18119c135eefc40.png)

对于训练数据集

![](img/f29f91c096e8fb10aad32050c3bc7459.png)

对于验证数据集

总的来说，我们看到训练集和验证集中的结果是一致的，没有过度/不足的迹象。此外，RMSE 是大约 19-20 千瓦。

## 只有时间数据的模型

***剧情为 R2 评分:***

![](img/cecb15e292c1ccf79e43fade1eaaa123.png)

对于训练数据集

![](img/9b21c3b3f5e8357c66a108edd29cfeed.png)

对于验证数据集

在这里，我们看到，对于验证集，R2 分数明显较低，约为 0.48，我们还看到，模型实际上在最大深度 4000 后开始过度拟合。

***剧情为 RMSE:***

![](img/5f9c22fa5cd7407a9f866954c2a0c269.png)

对于训练数据集

![](img/a32d3fa3623cff5f1e0af7687700a82c.png)

对于验证数据集

数据中的平均全球功率约为 65.5 KW，在只有时间数据的情况下，该 RMSE 约为平均功率的 60%，当还包括分项计量时，约为平均功率的 30%。所以，现在是时候下结论了。

# 结论

该项目着眼于基于 ML 的短期电力预测的实现。我们尝试了随机森林、SVM、线性回归以及自动回归方法。其中，兰登森林最有前途。所以，我们对这个算法进行了更详细的研究。

总的来说，我们看到，该模型在预测总浪费功率(当计量功率已知时)方面表现出色，R2 得分约为 0.87，但在预测绝对功率(R2 得分约为 0.48)消耗方面表现不佳——仅基于一天中的一个小时。

RMSE 值仍然很高，因此也应该尝试其他方法。由于该数据本质上是时间性的，所以基于 RNN 的方法如 LSTM 等。，也可以研究一下。

总的来说，这篇项目文章将让您深入了解真实数据预测的世界及其各种挑战，如不完整数据、不一致数据等。

# 贡献者

## ***团队工作***

正如我们所看到的，我们在这个项目中实现了 4 个模型，并基于这些模型进行了深入的分析。我们作为一个由 3 名成员组成的小组，将这些模型进行了分组，并对它们进行了单独分析。为了完成这项工程，我们每个人都尽了最大的努力。

***团队成员有:阿尔纳夫·亚达夫、索拉迪普·桑亚尔和瓦伊巴夫·巴特***

***【阿纳夫】亚达夫(***[【https://www.linkedin.com/in/iamarnavyadav/】](https://www.linkedin.com/in/iamarnavyadav/)***)***【ARIMA】模型分析并准备了演示文稿以及本博客。

***【https://www.linkedin.com/in/souradip-sanyal-0889b73a/】****随机进行森林分析并准备了报告。*

****Vaibhav Bhat(******)***SVR 以及线性回归分析并为最终模型编写了代码。*

*项目报告和陈述的任务是一个团队的努力。*

*我们特别感谢我们的课程项目导师(**tan moy**博士)给我们这个极好的机会，下面是他的社交媒体资料链接*

****简介:【https://www.linkedin.com/in/tanmoy-chakraborty-89553324/】****

*****推特:*** @Tanmoy_chak**

## ****参考文献:****

**长度布雷曼，2001 年。[随机森林](https://www.stat.berkeley.edu/users/breiman/randomforest2001.pdf)，*机器学习*45.1:5–32**

**金泰永和宋培昭，2019。[使用 CNN-LSTM 神经网络预测住宅能耗](https://www.sciencedirect.com/science/article/abs/pii/S0360544219311223?via%3Dihub)。*能量，第 182 卷*:72–81。[https://doi.org/10.1016/j.energy.2019.05.230](https://doi.org/10.1016/j.energy.2019.05.230)**

**X.m .张，k .格罗林格，M. A. M .卡普里茨和 l .西沃德，2018。[预测住宅能耗:单户视角](https://ieeexplore.ieee.org/document/8614049)。*第 17 届 IEEE 机器学习与应用国际会议(ICMLA)* ，佛罗里达州奥兰多，2018:110–117，doi:[10.1109/ICMLA . 2018.00024](https://doi.org/10.1109/ICMLA.2018.00024)**