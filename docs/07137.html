<html>
<head>
<title>Make code Simple with DataBlock API part1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用数据块API第1部分简化代码</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/make-code-simple-with-datablock-api-part1-aff3f2367150?source=collection_archive---------30-----------------------#2020-06-14">https://medium.com/analytics-vidhya/make-code-simple-with-datablock-api-part1-aff3f2367150?source=collection_archive---------30-----------------------#2020-06-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="26c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2020年6月14日</p><p id="0f39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"># <strong class="ih hj"> Blog14 </strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/307e5f68054b79a30a4c428a7d706827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*65Z-CQFBUeU0-gvg.jpg"/></div></div></figure><p id="ee6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">欢迎光临！！！</p><p id="55ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">写这篇博客的目的是向你介绍fastai令人敬畏的数据块api。这是博客的第一部分，第二部分将是代码方法。</p><p id="1b51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尽管fastai遵循自上而下的方法，但我写博客的第一部分时没有代码，在第二部分中，理论解释设置了学习数据块的动机和代码。(当然，在编写代码之前，Jeremy给出了使用它的动机和令人敬畏的解释，所以我认为在编写代码之前这很重要。)</p><p id="eeb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以让我们开始吧！！！</p><p id="7166" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你使用过任何深度学习框架(我使用PyTorch，所以说w.r.t. it)来建立一个模型来解决深度学习问题，你会经历收集数据的步骤，这是什么类型的问题(如图像分类，分割)，看看什么是因变量和自变量，如何将数据分成训练和验证集，应用变换来提高准确性。</p><p id="3f94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个过程中，您可能还为所有这些任务编写了冗长代码，但是如果我告诉您，您可以在一个单独的块中完成这些任务，那就太棒了(您也可以用正常的方式完成所有这些任务，然后重构它，但是这种数据块方法对我来说看起来不错，因为我在遵循这种方法时犯的错误较少)</p><p id="7b04" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么什么是<strong class="ih hj">数据块</strong> api呢？？？</p><p id="1cc6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据块api是fastai中的高级api。数据块API是一个用于数据加载的表达性API。这是一种系统地定义为深度学习模型准备数据所需的所有步骤的方法，并为用户提供了一个混合和匹配这些片段(我们称之为数据块)的食谱</p><p id="5878" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们构建批处理和数据加载器时，可以把数据块想象成一个指令列表。它不需要明确地完成任何项目，而是一个如何操作的蓝图。编写数据块就像编写蓝图一样。</p><p id="5bcc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们刚才看到了数据加载器这个词。让我们看看。PyTorch和fastai有两个主要的类来表示和访问训练集或验证集:</p><p id="b600" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jp jq jr js b">Dataset</code>::返回单个项目的自变量和因变量元组的集合</p><p id="51a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jp jq jr js b">DataLoader</code>::提供小批量流的迭代器，其中每个小批量是一批自变量和一批因变量的组合</p><p id="d402" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有趣的是，fastai提供了两个类来将您的训练集和验证集结合在一起:</p><p id="44f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jp jq jr js b">Datasets</code>::包含训练数据集和验证数据集的对象</p><p id="35ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jp jq jr js b">DataLoaders</code>::包含训练数据加载器和验证数据加载器的对象。</p><p id="6e2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">fastai library有一种构建数据加载器的简单方法，这种方法足够简单，只需要很少的编码知识就可以获得，并且足够先进，可以进行探索。</p><p id="4ee4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建数据块的步骤如下。</p><p id="8b94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些步骤由数据块API定义，可以在查看数据时作为问题提出:</p><ul class=""><li id="e23b" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">你的输入/目标类型是什么？(<code class="du jp jq jr js b">Blocks</code>)</li><li id="e448" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">你的数据在哪里？(<code class="du jp jq jr js b">get_items</code>)</li><li id="3487" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">需要对输入应用什么吗？(<code class="du jp jq jr js b">get_x</code>)</li><li id="363a" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">需要对目标应用什么吗？(<code class="du jp jq jr js b">get_y</code>)</li><li id="c81b" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">如何拆分数据？(<code class="du jp jq jr js b">splitter</code>)</li><li id="91b5" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">我们需要在成形的物品上应用一些东西吗？(<code class="du jp jq jr js b">item_tfms</code>)</li><li id="8f61" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">我们需要在成型的批次上应用一些东西吗？(<code class="du jp jq jr js b">batch_tfms</code>)</li></ul><p id="4dfb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这个！！</p><p id="bb75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你回答这些问题时，你写了一个数据块。</p><p id="f894" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以将每个问题或步骤视为构建fastai数据块的砖块。</p><ul class=""><li id="9adb" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">阻碍</li><li id="451b" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">获取_项目</li><li id="2317" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">获取x/获取y</li><li id="347c" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">分流器</li><li id="9890" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">item_tfms</li><li id="a8e1" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">批处理_tfms</li></ul><p id="f727" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在构建数据加载器时，查看数据集非常重要。而使用数据块api是解决问题的策略或方法。首先要看的是数据是如何存储的，即以何种格式或方式存储，并与著名的数据集进行比较，是否以这种方式存储以及如何处理它。</p><p id="154a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">块</strong>这里用来定义预定义的问题域。例如，如果这是一个图像问题，我可以告诉图书馆使用枕头，而不用明确地说出来。并说是单标签还是多标签分类。还有很多像ImageBlock，CategoryBlock，MultiCategoryBlock，MaskBlock，PointBlock，BBoxBlock，BBoxLblBlock，TextBlock等等。(我将在博客的第二部分解释所有与代码相关的细节)</p><p id="5bc8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> get_items </strong>就是回答数据在哪里？</p><p id="b3e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，在图像问题中，我们可以使用<code class="du jp jq jr js b">get_image_files</code>函数获取我们图像的所有文件位置，我们可以查看数据(我将在博客的第2部分解释所有代码相关的细节)。</p><p id="004d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> get_x </strong>是回答需要对输入应用什么东西吗？</p><p id="cf2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> get_y </strong>就是你如何提取标签。</p><p id="4d13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">拆分器</strong>就是你想怎么拆分我们的数据。通常，这是训练数据集和验证数据集之间的随机分割。</p><p id="bcda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">datablock api剩下的两块砖是item_tfms和batch_tfms，是增广。</p><p id="eca8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> item_tfms </strong>是基于单个项目应用的项目转换。这是在CPU上完成的。</p><p id="d361" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> batch_tfms </strong>是应用于批量数据的批量转换。这是在GPU中完成的。</p><p id="594b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用datablock中的这些砖块，我们可以处理和构建数据加载器，为不同类型的问题做好准备，如分类、对象检测、分割和所有其他不同类型的问题。</p><p id="5e64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据块API提供了简明性和表达性的良好平衡。在数据科学领域，scikit-learn管道方法被广泛使用。该api提供了非常高的表达能力，但不够固执己见，无法确保用户完成所有必要的步骤，为建模准备好数据，但这是在fastai数据块API中完成的。</p><p id="313b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经了解了什么是数据块api，让我们包装所有的东西并构建一个。</p><p id="7f52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是时候了！！让我们看看牛津IIIT pets数据集的单标签分类的代码(仅数据块)。</p><pre class="je jf jg jh fd kh js ki kj aw kk bi"><span id="ea86" class="kl km hi js b fi kn ko l kp kq">pets = DataBlock(blocks=(ImageBlock, CategoryBlock), get_items=get_image_files, <br/>splitter=RandomSplitter(), <br/>get_y=Pipeline([attrgetter("name"), RegexLabeller(pat = r'^(.*)_\d+.jpg$')]), <br/>item_tfms=Resize(128), <br/>batch_tfms=aug_transforms())</span></pre><p id="b5b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是什么代码？？？</p><p id="0e23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">提醒:这是博客的介绍部分，</p><p id="cfa1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好奇想知道代码中有什么，以及如何编写代码，请阅读将于2020年6月21日星期日上午10:30 IST<a class="ae kr" href="https://kirankamath.netlify.app/blog/make-code-simple-with-datablock-api-part2/" rel="noopener ugc nofollow" target="_blank">发表的博客第二部分</a>。</p><p id="1ac6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">学分:</p><ul class=""><li id="ab92" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">fastai <a class="ae kr" href="https://dev.fast.ai/" rel="noopener ugc nofollow" target="_blank"> docs </a></li><li id="13b9" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">感谢扎克·穆勒，<a class="ae kr" href="https://muellerzr.github.io/fastblog/datablock/2020/03/21/DataBlockAPI.html" rel="noopener ugc nofollow" target="_blank">在datablock api上的博客</a>，请继续写博客和制作视频。</li><li id="9008" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">fastai深度学习的分层API<a class="ae kr" href="https://arxiv.org/pdf/2002.04688.pdf" rel="noopener ugc nofollow" target="_blank">论文</a></li></ul></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><p id="c184" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kz">最初发布于</em><a class="ae kr" href="https://kirankamath.netlify.app/blog/fastais-datablock-api/" rel="noopener ugc nofollow" target="_blank"><em class="kz">https://kirankamath . netlify . app</em></a><em class="kz">。</em></p></div></div>    
</body>
</html>