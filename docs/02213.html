<html>
<head>
<title>Severstal: Steel Defect Detection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谢韦尔钢铁公司:钢铁缺陷检测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/severstal-steel-defect-detection-2d2e836855c2?source=collection_archive---------6-----------------------#2019-12-06">https://medium.com/analytics-vidhya/severstal-steel-defect-detection-2d2e836855c2?source=collection_archive---------6-----------------------#2019-12-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1093b46fe8d76e9d9dba809c84c70cad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5vHZIy3o368v9R1m.jpg"/></div></div></figure><p id="c10e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">钢是现代最重要的建筑材料之一。钢结构建筑可以抵抗自然和人为的磨损，这使得这种材料在世界各地无处不在。</p><p id="21f4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">谢韦尔钢铁公司是高效钢铁开采和生产的领导者。他们相信冶金的未来需要行业的经济、生态和社会方面的发展——他们认真对待企业责任。钢铁缺陷检测比赛由谢韦尔钢铁公司通过Kaggle组织。</p><p id="0061" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">平板钢板的生产工艺特别精细。从加热和轧制，到干燥和切割，当扁钢准备装运时，几台机器会接触到它。本次竞赛的目的是使用所提供的图像预测钢铁制造中发现的缺陷的位置和类型，以提高过程的制造标准和过程效率。</p><p id="677a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 1。</strong> <strong class="is hj">描述</strong></p><p id="9beb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将预测在钢铁制造中发现的缺陷的位置和类型。图像以唯一的ImageId命名。我们必须对测试集中的缺陷进行分割和分类。每个图像可以没有缺陷、单一类别的缺陷或多个类别的缺陷。对于每幅图像，我们必须分割每一类缺陷(ClassId = [1，2，3，4])。即使图像上有几个不连续的缺陷位置，每个缺陷类别的段也将被编码成单行。</p><p id="8540" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该数据集根据平均Dice系数进行评估。Dice系数可用于比较预测的分割与其对应的基本事实之间的逐像素一致性。该公式由下式给出:</p><p id="ee04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2∫| X∩Y | | X |+| Y |</p><p id="01b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">其中X是预测的像素组，Y是地面实况。当X和Y都为空时，Dice系数定义为1。</p><p id="4ad1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 2。</strong> <strong class="is hj">数据</strong></p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es jo"><img src="../Images/352077f8bf5b08088496b6332dd31e18.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*beZGQgHqfyRg4aYqSq9FeQ.jpeg"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">图1: train.csv</figcaption></figure><p id="eec5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们为这项任务提供的数据来自Severstal，由12568幅独特的训练图像和1801幅独特的测试图像组成。它还包含一个. csv文件，该文件包含ImageId和一个编码像素列，该列告诉我们缺陷以及哪些像素受到了影响。该数据由50272行组成。</p><p id="89cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 3。</strong> <strong class="is hj">探索性数据分析</strong></p><p id="bd6a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们在train.csv文件中共有50272行，对应于每幅训练数据图像的4行。这是因为每个图像可以没有缺陷、有一个缺陷或缺陷的组合。因此，我们开始将缺陷类分离到数据的一个单独的列中。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es jx"><img src="../Images/49758dc654c3054d0df06356e25dc523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*imp2MMe95Wgpi3IxnBMUdw.jpeg"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">图2: DefectClass分离</figcaption></figure><p id="83d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们还试图了解每张图像的缺陷发生率。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es jy"><img src="../Images/6e7e981789c3ade9b6966a76f626130e.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*Z_nOMG392r45XT3N6bLbDA.jpeg"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">图3:每幅图像的缺陷</figcaption></figure><p id="7178" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以看到，这个问题是一个多标签分类问题。每个图像可以有多个缺陷，它们可以被分类并且不互相排斥。我们还发现53%的数据包含有缺陷的图像。</p><p id="b1ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们进一步观察了训练图像中每个缺陷类别的出现频率。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jz"><img src="../Images/fd04dd82ff094ace46a64c3a09496aad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*zoTTxvy0Jdkt30Wi_bNiGQ.jpeg"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">图4:缺陷类型频率</figcaption></figure><p id="930e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以观察到，大多数缺陷存在于类型3中，其余类型的缺陷在它们之间具有较少的、相等的分布。</p><p id="41d1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可视化了一些数据，以便使用来自<a class="ae ka" href="https://www.kaggle.com/kenmatsu4/visualize-steel-defect" rel="noopener ugc nofollow" target="_blank">源</a>的代码更好地查看训练数据。</p><p id="8e1a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">缺陷类型1: </strong></p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kb"><img src="../Images/dfd655ef9c2897ed05b4d4595a9bde63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oHCfqsb9RTGWwFM9JMFr4g.png"/></div></div></figure><p id="2051" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">缺陷用红色掩盖，我们可以看到它们非常小。</p><p id="0c30" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">缺陷类型2: </strong></p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kc"><img src="../Images/0d19669230cffea826adebb3366361ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jm7SBy5tZs-MgnfIGrUbRg.png"/></div></div></figure><p id="d96a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些缺陷被绿色所掩盖，看起来是线性的。</p><p id="b998" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">缺陷类型3: </strong></p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/0935f8518112d6ff103ccaeef7d33cb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*raUboGfghnWzuKhHDZbGew.png"/></div></div></figure><p id="8b03" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">与之前的缺陷类别相比，这些缺陷似乎更严重、更大。</p><p id="20f5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">缺陷类型4: </strong></p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ke"><img src="../Images/67a6f02de7010b59afe27106f1611f39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WBeJpN-CgsLevADhDZTDQQ.png"/></div></div></figure><p id="d24a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">与之前的缺陷类别相比，这些缺陷似乎更严重、更大。我们可以观察到，与类3和类4相比，类1和类2非常小，因此可能更容易识别和训练。</p><p id="c277" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 4。</strong> <strong class="is hj">数据清理和预处理</strong></p><p id="8ead" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们已经把所有重复的名字删除了，并把数据按缺陷分类。我们还从测试数据中删除了所有重复的ImageId。由于这不是一个时间序列数据集，我们可以直接将我们的数据分为训练和CV数据。由于测试数据集可能与训练集不相似，我们将图像的大小调整为相同的大小，并增加训练数据集，以便部分解决这个问题。我们使用了来自这个<a class="ae ka" href="https://keras.io/preprocessing/image/" rel="noopener ugc nofollow" target="_blank">源</a>的数据生成器。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es kf"><img src="../Images/58f9dfd587bf0e65dda643f4131f9cc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*n0I4MAOvlki-IhOebd3btA.png"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">图4:数据生成器</figcaption></figure><p id="7bb6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 5。分类方法</strong></p><p id="08ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的目标是识别有缺陷的图像，并进一步分类为缺陷的类型。为此，我们将使用两种模型。第一个模型将根据图像是否包含缺陷来对图像进行分类，并且被分类为有缺陷的图像将被转发到下一个模型。</p><p id="a2e2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第二个模型将接收先前被分类为有缺陷的图像，并确定代表哪种类型的缺陷。</p><p id="218e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.1如果存在缺陷，进行分类</p><p id="1595" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于第一个任务，我们使用了一个DenseNet模型，该模型根据从image-net数据训练的权重进行训练。我们使用二元交叉熵作为损失函数以及Adam优化器。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es kg"><img src="../Images/b5f54b6fcef59a6e8256586138e90f7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*E5Ig_-VLoC7nXlz5s5TOoQ.png"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">图5:确定缺陷是否存在的DenseNet模型</figcaption></figure><p id="7ff5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦我们训练了模型并保存它以备将来使用，我们就要求模型预测测试图像，以便我们可以将有缺陷的图像与没有任何缺陷的图像分开。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es kh"><img src="../Images/380f27994db268ca658d2b2bac77012f.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*EEyYlxyLEc-jz4KpsQMBMA.png"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">图6:预测和过滤有缺陷的图像</figcaption></figure><p id="8f8b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">基于该图像，我们过滤掉具有小于0.5的存在缺陷的概率的所有图像。这将是下一个模型的输入测试数据。我们还过滤掉了我们的训练数据，只包含存在缺陷的图像，因为我们现在不需要无缺陷的图像。</p><p id="b745" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.2在4个缺陷类别中进行分类</p><p id="99bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了实现这一点，我们需要获得编码像素数据，并基于预测图像中存在的缺陷类型，并对我们发现的缺陷类型进行分类。我们使用下面的函数将掩码转换为游程长度编码器，反之亦然，并构建掩码。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es ki"><img src="../Images/a856ee50c7e37519e82408154d6a450f.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*KgZWbGHx4EBf1g2zI2WlMQ.png"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">图7:构建遮罩的实用函数</figcaption></figure><p id="57a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们还需要为我们的生成器获取编码像素进行训练，因此我们使用斯坦福Edu的图像生成器。为了实现这一点。</p><p id="3483" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，为了预测缺陷和掩模的类型，我们使用了U-Net模型架构，该架构具有作为损失函数的二进制交叉熵和Adam优化器。我们在过滤后的训练数据集上训练它。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kj"><img src="../Images/3e4429d4f1984837da58525e1d75e0a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*CeS7vr5b8-3omSiAH0yEPw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">图8: U-Net模型</figcaption></figure><p id="0928" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦我们训练了模型并保存了权重，我们就用它来预测我们的测试数据。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es kk"><img src="../Images/42bd5293eed964ef8c9614bb048ca67c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*0JYdT6Z88jeWRMDltOzmHw.png"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">图9:缺陷类型的分类</figcaption></figure><p id="0c33" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们还重新组合先前过滤的无缺陷图像数据，以得到由无缺陷图像id和具有缺陷类型的缺陷图像id组成的最终输出。</p><p id="b22d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 6。结论</strong></p><p id="591e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们从由12568幅训练数据图像和1801幅测试数据图像组成的数据集开始，我们将其分类为有缺陷或无缺陷，如果存在缺陷，我们将其分类为一个或多个缺陷类型类别。我们以级联方式使用两个模型实现了这一点。</p><p id="99b8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面我们可以看到一些预测的口罩。这些图像是用这个<a class="ae ka" href="https://www.kaggle.com/a03102030/practice-for-visualizing-mask" rel="noopener ugc nofollow" target="_blank">代码</a>生成的。我们可以观察到我们的模型在任务中表现良好。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es kl"><img src="../Images/053ee597d532bc591691ea0fd794f71b.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*ojuTezb-e7jBV9nMAr7OYA.png"/></div></figure><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es km"><img src="../Images/3707ed8230b168bf0eb361ef64643f3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*w1L0oTh6q88vbbZTZd7Yug.png"/></div></figure><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es kn"><img src="../Images/de1135a480861b761b034ac6fe2d36b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*CleWM2vttlayxfO3t70iKg.png"/></div></figure><p id="c7ee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，我们可以通过使用更好的数据扩充方法、更好的流程管道或两者同时使用来进一步提高这项任务的性能:)。我们还可以尝试将图像调整到比我们使用的256x512更高的分辨率，因为更大的图像会导致我们面临资源耗尽的错误。</p><p id="a59d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">来源:<a class="ae ka" href="https://www.kaggle.com/c/severstal-steel-defect-detection/data" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/c/severstal-steel-defect-detection/data</a></p><p id="8b85" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">领英:<a class="ae ka" href="https://www.linkedin.com/in/shashidhar-mangam/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/shashidhar-mangam/</a></p></div></div>    
</body>
</html>