<html>
<head>
<title>Scikit-Learn Pipelines with Custom Transformer — A Step by Step Guide.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">sci kit-学习定制变压器的管道-一步一步的指南。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/scikit-learn-pipelines-with-custom-transformer-a-step-by-step-guide-9b9b886fd2cc?source=collection_archive---------2-----------------------#2020-05-27">https://medium.com/analytics-vidhya/scikit-learn-pipelines-with-custom-transformer-a-step-by-step-guide-9b9b886fd2cc?source=collection_archive---------2-----------------------#2020-05-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c2e41960df7a37007b7132b5dd1e5c29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xC6xaRq4ilwHLfONAK01SA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">sci kit-学习管道</figcaption></figure><p id="6ae0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">数据和模型算法是完整的机器学习所依赖的两个核心模块。在数据模块中，数据提取和数据预处理(或称为特征工程)在整个建模生命周期中起着至关重要的作用。</p><p id="e25e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在现实生活中，任何机器学习问题往往有数百个输入特征，围绕这些特征需要概念化解决方案。为了理解数据特征并生成相应用例的拟合分析报告，需要通过不同的技术来清理和处理数据，这些技术不仅限于编码分类值、缩放连续特征、输入、归一化等。处理大量输入要素时，这种数据转换过程会变得非常繁琐。</p><p id="712b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这就是为什么简化这个完整的转换过程总是一个好的做法，它可以无缝地应用于训练和测试数据。这就是Scikit-Learn Pipeline发挥作用的地方，它通过一系列转换器和一个最终估计器(分类器)来实现这种流线型转换。为了避免更多的理论进入他的帖子，如果你想阅读更多关于<strong class="iw hj">变形金刚</strong>和<strong class="iw hj">估算师</strong>的内容，Sklearn教程网站对这些术语有很好的解释。</p><p id="4980" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这篇文章中，我将尝试涵盖以下几个方面。</p><ul class=""><li id="14bc" class="js jt hi iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">sklearn管道中如何写<strong class="iw hj">标准变形金刚</strong></li><li id="910e" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">如何编写<strong class="iw hj">自定义变形金刚</strong>并添加到sklearn管道中</li><li id="279a" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">最后，如何使用Sklearn管道进行建模和预测</li></ul><blockquote class="kg kh ki"><p id="da58" class="iu iv kj iw b ix iy iz ja jb jc jd je kk jg jh ji kl jk jl jm km jo jp jq jr hb bi translated">注意:我正在使用“泰坦尼克号幸存者”问题数据集，这是一个分类问题，以解释Sklearn管道集成。</p></blockquote><p id="4005" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">从Sklearn Pipline变压器开始，首先我将数据导入到我的Jupyter笔记本中。<strong class="iw hj">PassengerId '</strong>列被删除，因为它不会在模型训练中使用。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/5151a10f2437aead0c4d997686d3b069.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZIVdtuGdVzKu5RyRVqoZeg.png"/></div></div></figure><p id="2fe1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在该数据集中，大约有9个输入特征和1个输出标签，即“幸存”。</p><ul class=""><li id="6ae2" class="js jt hi iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">Pclass、Sex、SibSp、Parch和oaked是分类特征。我们将应用标准转换器来处理空值，并将它们编码成连续值。</li><li id="5f53" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">年龄和票价是连续的特征。我们将应用标准转换器来处理空值并执行特征缩放</li><li id="c2e8" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">Name和Cabin是自由文本特性，不能直接在模型训练中使用，所以我们将编写自定义转换来将它们转换成一些有用的数据</li></ul><p id="f3ae" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">将数据分为训练和测试数据，并根据它们的数据类型对列名进行分组。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/0aa13bb346e5e849ae2e7f6d65b458b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_4rC5AcHuwKTxogM9R_OXA.png"/></div></div></figure><blockquote class="kg kh ki"><p id="78e6" class="iu iv kj iw b ix iy iz ja jb jc jd je kk jg jh ji kl jk jl jm km jo jp jq jr hb bi translated"><strong class="iw hj">变压器(称为数据预处理机)</strong></p></blockquote><p id="c04f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">从数据转换开始，</p><ul class=""><li id="138d" class="js jt hi iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated"><strong class="iw hj">标准转换器</strong>:让我们首先为每种数据类型(分类和连续)编写不同的标准转换器。在这里，我创建了numeric_transformer和categorical _ transformer来处理连续和分类特征值。在numeric_transformer中，有两个步骤；首先是用相应列的中值替换空(NaN)值。第二步是对连续特征应用缩放。类似地，在categorical _ transformer中有两个步骤用于输入和应用一个热编码到分类属性上。在这里，所有这些转换器(如SimpleImputer、StandardScalar、OneHotEnocder)将内置“fit”和“transform”方法的实现，这些方法将在管道执行时调用。</li></ul><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/6f4a454df0d5212159fdc8602c224348.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mArjFAyfdExk8EGiJVOsXg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd ku">标准变压器</strong></figcaption></figure><ul class=""><li id="74ea" class="js jt hi iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated"><strong class="iw hj">自定义转换器:</strong>现在为了处理客舱和名称输入功能，我们将编写自定义转换器，因为这两个功能不能使用标准转换器直接转换(在下面的例子中你会更好地理解)。每个自定义转换器必须定义至少两个方法'<strong class="iw hj">适合</strong> ' &amp; ' <strong class="iw hj">转换</strong>。</li></ul><blockquote class="kv"><p id="35d7" class="kw kx hi bd ky kz la lb lc ld le jr dx translated"><strong class="ak">在执行管道的fit方法时，将依次调用Transformer的“fit”和“transform”方法。</strong></p><p id="1abd" class="kw kx hi bd ky kz lf lg lh li lj jr dx translated"><strong class="ak">其中，在执行管道的预测方法时，将只调用Transformer的转换方法。</strong></p></blockquote><blockquote class="kg kh ki"><p id="9a61" class="iu iv kj iw b ix lk iz ja jb ll jd je kk lm jh ji kl ln jl jm km lo jp jq jr hb bi translated"><strong class="iw hj">举例详细说明</strong>:</p></blockquote><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/4c3a65e835dfb611f6758a41191e5225.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KvlcwaIRm8OTp79oKUACpg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd ku">为“驾驶室”功能定制变压器</strong></figcaption></figure><p id="de5c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我以“Cabin”输入特征为例详细解释拟合和转换方法的用法。对于代码片段，请参考上面的截图。</p><p id="c206" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">在‘适合’方法中</strong></p><ul class=""><li id="5f03" class="js jt hi iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">对于“客舱”功能，用“U”替换所有空(na)值</li><li id="efc2" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">用各自值的第一个字符替换客舱值</li><li id="58bd" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">在接下来的几行中，我们将确定“Cabin”特性的唯一值(通过get_dummies方法)并将其保存在“self.cabin_columns”中。它将在“转换”方法中使用。</li></ul><p id="4677" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">在‘变换’法中</strong></p><ul class=""><li id="a956" class="js jt hi iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">对于“客舱”功能，用“U”替换所有空(na)值</li><li id="0f16" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">用各自值的第一个字符替换客舱值</li><li id="a884" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">在接下来的几行中，我们使用get_dummies方法，通过为每个唯一值创建新列，将Cabin的分类值转换为数值。</li><li id="c4a3" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">我们正在根据已经保存的“self.cabin_columns”值重新索引这些新列。这样做的目的是为了避免根据试验数据中的新座舱值增加新的列。否则，由于特征计数不匹配，模型预测将在测试数据上失败。这就是为什么，我们没有在这个功能上应用标签编码器或一个热编码器，而是使用自定义转换器。更多详情请参考此<a class="ae lq" href="https://stackoverflow.com/questions/21057621/sklearn-labelencoder-with-never-seen-before-values" rel="noopener ugc nofollow" target="_blank">链接</a>。</li></ul><p id="7d65" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">类似地，我为“Name”输入特性创建了另一个自定义转换器。</p><blockquote class="kg kh ki"><p id="51aa" class="iu iv kj iw b ix iy iz ja jb jc jd je kk jg jh ji kl jk jl jm km jo jp jq jr hb bi translated"><strong class="iw hj"> ColumnTransformer合并所有变压器定义</strong></p></blockquote><p id="3727" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下一步是使用ColumnTransformer合并所有转换器定义，如下图所示。当我们执行这个块时，每个自定义转换器都将调用'<strong class="iw hj"> _init_' </strong>方法。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/e5ce1ec154920f72dcdcd07cfd4991e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zRy2suHlUKHE-V4z1c6-og.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd ku">组合变压器定义</strong></figcaption></figure><blockquote class="kg kh ki"><p id="9efe" class="iu iv kj iw b ix iy iz ja jb jc jd je kk jg jh ji kl jk jl jm km jo jp jq jr hb bi translated"><strong class="iw hj">组装—组合变压器和估算器</strong></p></blockquote><p id="6f43" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是最后一步，我们将转换器和估计器(在本例中，它是RandomForestClassifier)结合起来，并创建将用于训练模型和预测的最终管道。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/89cb93b45ae4d963f3605d41d641fe10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gt-0TMRUmjXj6SAzXD5iog.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd ku">最终管道组装</strong></figcaption></figure><blockquote class="kg kh ki"><p id="69d8" class="iu iv kj iw b ix iy iz ja jb jc jd je kk jg jh ji kl jk jl jm km jo jp jq jr hb bi translated"><strong class="iw hj">管道拟合和转换方法</strong></p></blockquote><p id="2e91" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">管道“安装”方法</strong></p><ul class=""><li id="11bf" class="js jt hi iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">它用于根据训练数据训练模型</li><li id="0a09" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">它接受两个参数；列车输入特征和列车输出标签，即x_train和y_train</li><li id="079d" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated"><strong class="iw hj">当调用此“拟合”方法时，将依次调用拟合和转换两种方法，输入特征值将被转换并传递给估算器进行模型训练</strong></li></ul><p id="829b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">管道‘预测’方法</strong></p><ul class=""><li id="1fe8" class="js jt hi iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">管道“预测”方法用于对测试数据进行预测，如下面的代码片段所示。</li><li id="a7fd" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">当我们调用' predict '方法时，只有Transformer 's ' transform '方法被调用</li></ul><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/5c01212f08084e58387f946b3a9a7726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XmaIcZVnrHG2-I_aZGjJDg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd ku">利用管道预测</strong></figcaption></figure><p id="08c6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">注意</strong>:我们可以保存这个管道对象以供将来参考，如下图所示。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/d6f408c2119db0909c3c9a3dc17ddff0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JGfDX88AgLoQcm9IhBmTnw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd ku">保存管道并重复使用</strong></figcaption></figure><blockquote class="kg kh ki"><p id="6819" class="iu iv kj iw b ix iy iz ja jb jc jd je kk jg jh ji kl jk jl jm km jo jp jq jr hb bi translated"><strong class="iw hj">我的例子中端到端管道的流程图</strong></p></blockquote><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/bc83f69dedb87eaf0d5661408c02a4c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*va14ybPOa1z3wF5ViEyLqQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd ku">sk learn管道流程图</strong></figcaption></figure><p id="a20f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这个练习的笔记本可以在<a class="ae lq" href="https://github.com/abhi-rawat1/machine_learning_projects/tree/master/Sklearn_Pipeline_Custom_transformer" rel="noopener ugc nofollow" target="_blank">这里</a>得到。</p><p id="3b00" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">感谢阅读这个博客…如果你喜欢就鼓掌吧:)</p></div></div>    
</body>
</html>