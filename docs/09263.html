<html>
<head>
<title>Creating Twitter Bot Using Tweepy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Tweepy创建Twitter Bot</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/creating-twitter-bot-using-tweepy-66565fe59cd9?source=collection_archive---------20-----------------------#2020-08-30">https://medium.com/analytics-vidhya/creating-twitter-bot-using-tweepy-66565fe59cd9?source=collection_archive---------20-----------------------#2020-08-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6aa7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">自动化不那么无聊的东西</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/8cfbaca69643a7e2ee194931eb605e6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-HNW88bfZu4wFFX4.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Twitter图标</figcaption></figure><p id="2147" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">自动化我们日常无聊的任务是一回事，自动化你喜欢做的事情是完全不同的另一回事。同样的任务，我试图完成一项我喜欢的任务，即活跃在社交媒体上。是的，我试图通过使用一个名为<a class="ae jt" href="https://www.tweepy.org/" rel="noopener ugc nofollow" target="_blank"> Tweepy的流行python库来自动化我在twitter上的活动。</a></p><p id="e71e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jt" href="https://www.tweepy.org/" rel="noopener ugc nofollow" target="_blank"> Tweepy </a>是一个非常有趣的python库，它使得与Python开发者API的交互变得非常容易，并且隐藏了许多低级细节，这些细节对于一个刚刚开始使用REST API的初学者来说可能是难以理解的。</p><p id="cc26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们需要用<a class="ae jt" href="https://developer.twitter.com/en" rel="noopener ugc nofollow" target="_blank"> twitter </a>创建一个开发者账户，然后你可以创建一个应用程序，提供我们在创建机器人时必须使用的以下凭证。</p><ul class=""><li id="4c9e" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated">访问令牌</li><li id="9540" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">访问令牌密码</li><li id="f852" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">API_KEY</li><li id="fb03" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">API_SECRET_KEY</li></ul><p id="6f91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些凭证应该保密，不应该以任何方式共享，将这些细节放在源代码中并推送到GitHub是一个常见的错误，因此这些应该只在环境变量中使用。</p><pre class="je jf jg jh fd ki kj kk kl aw km bi"><span id="503a" class="kn ko hi kj b fi kp kq l kr ks">__API_KEY = os.environ['API_KEY']<br/>__API_SECRET_KEY = os.environ['API_SECRET_KEY']<br/>__ACCESS_TOKEN = os.environ['ACCESS_TOKEN']<br/>__ACCESS_TOKEN_SECRET = os.environ['ACCESS_TOKEN_SECRET']</span></pre><p id="7b62" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有一件事要开始，我们需要通过pip安装<a class="ae jt" href="https://www.tweepy.org/" rel="noopener ugc nofollow" target="_blank"> tweepy </a>库</p><p id="f0ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要快速完成这项工作，你可以使用我从Github获得的示例机器人，这里是<a class="ae jt" href="https://github.com/amanchourasiya/twitter-bot" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><pre class="je jf jg jh fd ki kj kk kl aw km bi"><span id="abf7" class="kn ko hi kj b fi kp kq l kr ks">git clone <a class="ae jt" href="https://github.com/amanchourasiya/twitter-bot" rel="noopener ugc nofollow" target="_blank">https://github.com/amanchourasiya/twitter-bot</a><br/>export ACCESS_TOKEN="&lt;access token from twitter developer account&gt;"<br/>export ACCESS_TOKEN_SECRET="&lt;access token from twitter developer account&gt;"<br/>export API_KEY="&lt;api key from twitter developer account&gt;"<br/>export API_SECRET_KEY="&lt;api secret key from twitter developer account&gt;"<br/>python3 bot.py</span></pre><p id="6f1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个机器人目前被编程为喜欢和转发来自特定帐户的推文，并且这个机器人还根据特定的过滤器实时过滤推文。</p><h1 id="5b8f" class="kt ko hi bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">此机器人中使用的组件</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lq"><img src="../Images/dcf95ff66d4db520d47ed24e5772f101.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ELomfpVr0lOrZv-W.png"/></div></div></figure><p id="4007" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个机器人没有很多组件，但它具有足够的可扩展性，可以针对不同的目的进行定制。</p><h1 id="4452" class="kt ko hi bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">1.正在为Twitter API创建授权配置</h1><p id="095b" class="pw-post-body-paragraph if ig hi ih b ii lr ik il im ls io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">使用Tweepy创建到twitter API的认证连接需要我们从twitter开发者帐户获得的所有四个秘密值。</p><pre class="je jf jg jh fd ki kj kk kl aw km bi"><span id="fd95" class="kn ko hi kj b fi kp kq l kr ks">class Bot:<br/>    def __init__(self):<br/>        try:<br/>            __API_KEY = os.environ['API_KEY']<br/>            __API_SECRET_KEY = os.environ['API_SECRET_KEY']<br/>            __ACCESS_TOKEN = os.environ['ACCESS_TOKEN']<br/>            __ACCESS_TOKEN_SECRET = os.environ['ACCESS_TOKEN_SECRET']</span><span id="10da" class="kn ko hi kj b fi lw kq l kr ks">auth = tweepy.OAuthHandler(__API_KEY, __API_SECRET_KEY)<br/>            auth.set_access_token(__ACCESS_TOKEN, __ACCESS_TOKEN_SECRET)<br/>            self.api = tweepy.API(auth, wait_on_rate_limit=True, wait_on_rate_limit_notify=True)<br/>            self.api.verify_credentials()<br/>            print('Authentication successful')<br/>        except KeyError:<br/>            print('Twitter credentials not supplied.')<br/>        except Exception as e:<br/>            print(e)</span></pre><p id="e2bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它处理创建与twitter API的OAuth连接，并设置警报和通知的速率限制，twitter有一些设置的API使用限制，如果我们超过该限制，那么我们的API处理程序将等待该时间，然后再次开始调用twitter API。</p><h1 id="e011" class="kt ko hi bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">2.创建效用函数。</h1><p id="50da" class="pw-post-body-paragraph if ig hi ih b ii lr ik il im ls io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">应该为这个机器人的基本使用创建一些实用函数，这些可能包括</p><ul class=""><li id="3553" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated">获得前20条推文。</li><li id="5e59" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">获得10个热门标签。</li><li id="9500" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">从特定用户获取最近的推文。</li><li id="8ab1" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">获取所有关注者的列表。</li></ul><p id="7158" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个列表可以是无穷无尽的，因为这些是twitter API的无限用例，使用这些实用函数，我们可以调整我们的机器人，以基于这些函数的结果触发一些函数。</p><p id="f2d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，假设我们计划制作一个功能，如果用户转发推文，我们会自动关注该用户，这样我们可以制作多个功能并定期运行它们。</p><h1 id="1f83" class="kt ko hi bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">3.从推特上传实时数据。</h1><p id="ead9" class="pw-post-body-paragraph if ig hi ih b ii lr ik il im ls io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">我们可以使用Teeepy的StreamListerner对象从twitter新闻提要中流式传输和过滤实时数据，并在此基础上指示我们的机器人做出一些决定。这些数据也可以用来对Twitter数据进行实时分析。</p><pre class="je jf jg jh fd ki kj kk kl aw km bi"><span id="70ae" class="kn ko hi kj b fi kp kq l kr ks">class WorkerStreamListener(tweepy.StreamListener):<br/>    def __init__(self, api):<br/>        self.api = api<br/>        self.me = api.me()</span><span id="44b9" class="kn ko hi kj b fi lw kq l kr ks">def on_status(self, tweet):</span><span id="4155" class="kn ko hi kj b fi lw kq l kr ks"># Check if this tweet is just a mention<br/>        print(f'{tweet.user.name}: {tweet.text}')</span><span id="00de" class="kn ko hi kj b fi lw kq l kr ks">print(f'{tweet.user.id}')</span><span id="473a" class="kn ko hi kj b fi lw kq l kr ks"># Check if tweet is reply<br/>        if tweet.in_reply_to_status_id is not None:<br/>            return</span><span id="9607" class="kn ko hi kj b fi lw kq l kr ks"># Like and retweet if not done already<br/>        if not tweet.favorited:<br/>            try:<br/>                tweet.favorite()<br/>            except Exception as e:<br/>                print(f'Exception during favourite {e}')<br/>        if not tweet.retweeted:<br/>            try:<br/>                tweet.retweet()<br/>            except Exception as e:<br/>                print(f'Exception during retweet {e}')</span><span id="a376" class="kn ko hi kj b fi lw kq l kr ks">print(f'{tweet.user.name}:{tweet.text}')</span><span id="422a" class="kn ko hi kj b fi lw kq l kr ks">def on_error(self, status):<br/>        print('Error detected')</span><span id="7b5d" class="kn ko hi kj b fi lw kq l kr ks">stream.filter(track=["Hacking"], languages=["en"], is_async=True)</span></pre><p id="9346" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就像这样，我们可以创建流对象并根据一些目标关键字过滤数据，这个流监听器正在做的是，每当有任何包含关键字<strong class="ih hj"> Hacking </strong>的推文时，它就会自动喜欢并自动转发该推文。</p><p id="f778" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这只是twitter机器人功能的一个示例，通过研究这个API的所有特性可以实现更多功能。当我写这篇博客时，我的twitter-bot项目也在第一阶段。</p></div><div class="ab cl lx ly gp lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hb hc hd he hf"><p id="7e86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="me">最初发表于</em><a class="ae jt" href="https://www.amanchourasiya.com/blog/creating-twitter-bot-using-tweepy/" rel="noopener ugc nofollow" target="_blank">T5【https://www.amanchourasiya.com】</a><em class="me">。</em></p><p id="97d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关注我的更多博客<a class="ae jt" href="https://twitter.com/TechieAman" rel="noopener ugc nofollow" target="_blank">https://twitter.com/TechieAman</a></p><p id="9227" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">个人博客https://www.amanchourasiya.com</p></div></div>    
</body>
</html>