<html>
<head>
<title>Beginner to Advance — Web Scraping Guide in Python : Introduction to Asynchronous Programming</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">初级到高级Python中的Web抓取指南:异步编程简介</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/beginner-to-advance-web-scraping-guide-in-python-introduction-to-asynchronous-programming-24bce03dafa7?source=collection_archive---------12-----------------------#2020-06-14">https://medium.com/analytics-vidhya/beginner-to-advance-web-scraping-guide-in-python-introduction-to-asynchronous-programming-24bce03dafa7?source=collection_archive---------12-----------------------#2020-06-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/9bc557c4f5ea853f4d4328eaa9af418d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4DFFM_HJCacB12CN"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">在<a class="ae hv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae hv" href="https://unsplash.com/@hiteshchoudhary?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Hitesh Choudhary </a>拍摄的照片</figcaption></figure><div class=""/><p id="c74a" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本教程将概述异步编程，包括其概念元素、Python异步API的基础知识，以及异步web scraper的示例实现。同步程序很简单:启动一个任务，等待它完成，然后重复直到所有的任务都被执行。然而，等待会浪费宝贵的CPU周期。异步程序通过使用上下文切换来交错任务，以改善程序响应，并最小化处理器空闲时间和总程序执行时间，从而解决了这个问题。<br/>在同步编程中，如果我们将一个请求的超时时间设置为10秒，那么我们的系统在理想状态下会等待10秒，这段时间可以用来处理之前的请求和发送新的请求。</p><h1 id="9826" class="jt ju hy bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">Python中的异步编程</h1><p id="caf0" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">在<a class="ae hv" rel="noopener" href="/@kaus.pathak_30409/beginner-to-advance-web-scraping-guide-in-python-ba24dca5dce0">之前的教程</a>中，我们实现了Requests异步编程，允许您编写在单线程中运行的并发代码。与多线程相比，第一个优势是您可以决定调度程序从一个任务切换到另一个任务的位置，这意味着在任务之间共享数据更加安全和容易。实现Asyncio Web Scrapping的主要库是<code class="du kw kx ky kz b">aiohttp</code>。<code class="du kw kx ky kz b">aiohttp</code>的示例代码附后:</p><figure class="la lb lc ld fd hk"><div class="bz dy l di"><div class="le lf l"/></div></figure><h1 id="fc12" class="jt ju hy bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">aiohttp库的复杂性</h1><ul class=""><li id="4694" class="lg lh hy ix b iy kr jc ks jg li jk lj jo lk js ll lm ln lo bi translated">虽然创建aiohttp库是为了处理多个请求，但它不是为了从单独的代理和头发送每个请求。</li><li id="4034" class="lg lh hy ix b iy lp jc lq jg lr jk ls jo lt js ll lm ln lo bi translated">aiohttp的概念在python中相对较新，python对Asyncio编程的支持有限。</li><li id="1e7e" class="lg lh hy ix b iy lp jc lq jg lr jk ls jo lt js ll lm ln lo bi translated">针对python中复杂并发函数的文章相对较少，但针对串行编程的文章较多。</li></ul><p id="b8b1" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，我们将实现我们的Asyncio编程，不使用aiohttp，使用本教程中介绍的进程<a class="ae hv" href="https://www.hackernoon.com/how-to-run-asynchronous-web-requests-in-parallel-with-python-3-5-without-aiohttp-264dc0f8546" rel="noopener ugc nofollow" target="_blank"/>。但这是我们将要遵循的示例代码。</p><figure class="la lb lc ld fd hk"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="56ae" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae hv" href="https://docs.python.org/3.4/library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor" rel="noopener ugc nofollow" target="_blank"> ThreadPoolExecutor </a>是一个<a class="ae hv" href="https://docs.python.org/3.4/library/concurrent.futures.html#concurrent.futures.Executor" rel="noopener ugc nofollow" target="_blank"> Executor </a>子类，它使用线程池来异步执行调用。它使用最多<em class="lu"> max_workers </em>线程池来执行调用。ThreadPoolExecutor提供了一个简单的抽象，围绕着旋转多个线程并使用这些线程以并发方式执行任务。在适当的环境下，为应用程序添加线程有助于显著提高应用程序的速度。通过使用多线程，我们可以加速面临输入/输出瓶颈的应用程序。</p><h1 id="ad04" class="jt ju hy bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">更深入</h1><p id="3a06" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">在之前的教程中，我们创建了一个类来删除其他站点的用户代理和代理。但是我们搜集的大部分代理都不工作，或者服务器上的端口被屏蔽了。因此，为了从我们收集的代理中过滤工作代理，我们必须通过继承代理类并扩展该类来发送请求和分离工作代理。</p><figure class="la lb lc ld fd hk"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="1fd7" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里我们使用max_workers为50来限制线程数量为50，但是您也可以为具有更高处理能力和更高带宽的系统增加这个值。这段代码将被追加到bin/proxy . py文件中。</p><blockquote class="lv lw lx"><p id="fc2e" class="iv iw lu ix b iy iz ja jb jc jd je jf ly jh ji jj lz jl jm jn ma jp jq jr js hb bi translated"><strong class="ix hz">你已经在Python中成功实现了异步函数。做得好…！！！</strong></p></blockquote><h1 id="8877" class="jt ju hy bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">从这里继续前进。</h1><h2 id="98f5" class="mb ju hy bd jv mc md me jz mf mg mh kd jg mi mj kh jk mk ml kl jo mm mn kp mo bi translated">教程1 —简介</h2><p id="d14a" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">在<a class="ae hv" rel="noopener" href="/@kaus.pathak_30409/beginner-to-advance-web-scraping-guide-in-python-799ffd367067">之前的教程</a>中，我们了解了网页抓取的基本概念，并创建了简单的函数来使用请求和BeautifulSoup从页面提取歌词。</p><h2 id="6fc6" class="mb ju hy bd jv mc md me jz mf mg mh kd jg mi mj kh jk mk ml kl jo mm mn kp mo bi translated">教程2 —使用Python中的头池和代理循环请求。</h2><p id="3c04" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">为了创建一个更大的项目，可以从互联网上删除成千上万的页面，你需要一个更清晰的工作环境，使用面向对象和继承的概念。你还需要有更详细的关于头文件池和代理池的知识来保持对服务器的匿名，我们已经在本教程的第二部分中讨论过了。</p><h2 id="a5d6" class="mb ju hy bd jv mc md me jz mf mg mh kd jg mi mj kh jk mk ml kl jo mm mn kp mo bi translated">教程3 —工作环境和异步I/O编程</h2><p id="5e6c" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我们将进行异步I/O编程来提高你的报废速度，这将在本教程的第三部分<a class="ae hv" rel="noopener" href="/@kaus.pathak_30409/beginner-to-advance-web-scraping-guide-in-python-introduction-to-asynchronous-programming-24bce03dafa7?postPublishedType=initial">中介绍。</a></p><h2 id="c114" class="mb ju hy bd jv mc md me jz mf mg mh kd jg mi mj kh jk mk ml kl jo mm mn kp mo bi translated">教程4 —自动化站点抓取</h2><p id="1c77" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">有了之前教程中学习的所有概念，我们将在本教程的第四部分中创建实际的自动抓取器来从网页下载并保存歌词。</p><h2 id="cf2b" class="mb ju hy bd jv mc md me jz mf mg mh kd jg mi mj kh jk mk ml kl jo mm mn kp mo bi translated">教程5 — API访问</h2><p id="3218" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">为了方便地从网上访问歌词，我们将创建Flask API和前端来访问我们在本教程第五部分<a class="ae hv" rel="noopener" href="/analytics-vidhya/beginner-to-advance-web-scraping-guide-in-python-build-and-deploy-a-python-web-app-using-flask-202ffdf8fd40">中废弃的歌词。</a></p><h2 id="6813" class="mb ju hy bd jv mc md me jz mf mg mh kd jg mi mj kh jk mk ml kl jo mm mn kp mo bi translated">教程6 —在Heroku上托管我们的Flask服务器</h2><p id="1284" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">为了提供容易的歌词访问，我们将在本教程的第六部分<a class="ae hv" rel="noopener" href="/@kaus.pathak_30409/beginner-to-advance-web-scraping-guide-in-python-deploy-a-python-web-app-using-flask-and-a0e3cc8ce9f6">的Heroku上托管我们的Flask服务器。</a></p><figure class="la lb lc ld fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mp"><img src="../Images/cda93aa49539c4fe06f0885477abdc08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SQPN6AQo4rL5eEf1"/></div></div></figure><h1 id="7781" class="jt ju hy bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">最后的话</h1><p id="e6e6" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">感谢你阅读这篇文章，我们希望听到你的反馈。请随意评论任何问题。如果你喜欢，请为我们鼓掌:)。关注我们，获取我们的最新文章。</p></div></div>    
</body>
</html>