<html>
<head>
<title>Making Historical Weather Data for any place using Dark Sky API calls</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用黑暗天空API调用生成任何地方的历史天气数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/making-historical-weather-data-for-any-place-using-dark-sky-api-calls-d5876de0ec01?source=collection_archive---------7-----------------------#2020-02-10">https://medium.com/analytics-vidhya/making-historical-weather-data-for-any-place-using-dark-sky-api-calls-d5876de0ec01?source=collection_archive---------7-----------------------#2020-02-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="17f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">日常天气对我们的生活影响很大。从那个地区种植的食物到我们选择的衣服和我们的交通方式都取决于天气。网上有很多关于天气如何影响我们健康和幸福的帖子。那么为什么不利用历史天气数据来预测未来的天气甚至我们的总体情绪呢？如今，如果有什么可以预测的话，那就是使用深度学习模型进行预测。深度学习模型需要什么？</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/d25ede5f76dbe6cb8cb4571dd816f609.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/1*_eFKhJcx_TXJUhzZhDFgww.gif"/></div></figure><p id="8551" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，让我们开始收集使用python中的API调用的历史天气数据，并最终从中创建一个CSV文件。</p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es js"><img src="../Images/c99da55ad1c44fc04f9432fe51d19a71.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*iL-HXC09QS55FPnKw8K9fg.jpeg"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">黑暗天空的标志。摘自<a class="ae jx" href="https://darksky.net/dev/img/logo.png" rel="noopener ugc nofollow" target="_blank">此处</a></figcaption></figure><p id="554c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用黑暗天空API来完成这项任务。它每天提供1000次免费的API调用，之后每次调用只需0.0001美元。鉴于我们必须创建一个数据集，我们将使它保持在每天1000个呼叫的限制内，如果我们用尽了我们的限制，我们可以等待第二天。我们可以用它来执行两种类型的API调用，它可以返回大量信息。从它的<a class="ae jx" href="https://darksky.net/dev/docs" rel="noopener ugc nofollow" target="_blank">文档</a>:</p><blockquote class="jy jz ka"><p id="d515" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">天气API调用类型</p><p id="58f8" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">我们提供两种类型的API请求来检索世界上任何地方的天气:</p><p id="9ac1" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated"><a class="ae jx" href="https://darksky.net/dev/docs#forecast-request" rel="noopener ugc nofollow" target="_blank">预报请求</a>返回下周的当前天气预报。</p><p id="7923" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated"><a class="ae jx" href="https://darksky.net/dev/docs#time-machine-request" rel="noopener ugc nofollow" target="_blank"> Time Machine请求</a>返回过去或未来某一天的观测或预测天气情况。</p><p id="d4fa" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">气象条件</p><p id="d5ba" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">黑暗天空API以39种不同的语言提供完整的气象条件集合，包括:</p><p id="7683" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">表观(感觉)温度</p><p id="c945" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">大气压力</p><p id="9692" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">云量</p><p id="063d" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">露点</p><p id="f434" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">湿度</p><p id="aec2" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">液体沉淀速率</p><p id="40d6" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">月相</p><p id="bc9d" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">最近风暴距离</p><p id="e8cc" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">最近的风暴方向</p><p id="a775" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">臭氧</p><p id="099c" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">沉淀类型</p><p id="248a" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">降雪</p><p id="e4b1" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">日出/日落</p><p id="7d38" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">温度</p><p id="3620" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">文本摘要</p><p id="390e" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">紫外线指数</p><p id="f5ef" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">阵风</p><p id="c0fb" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">风速</p><p id="d993" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated">风向</p></blockquote><p id="9086" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于本文，我们将利用Time Machine请求，创建一个包含最低和最高温度以及日出和日落时间的CSV文件。您可以查看并选择您想要的任何天气属性。</p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><p id="26a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在python中，我们使用<code class="du kf kg kh ki b">requests.get</code>来执行API调用，我们只需将我们的基本URL作为参数传递给它。基本URL如下所示:</p><pre class="je jf jg jh fd kj ki kk kl aw km bi"><span id="4ea5" class="kn ko hi ki b fi kp kq l kr ks"><a class="ae jx" href="https://api.darksky.net/forecast/[key]/[latitude],[longitude],[time]" rel="noopener ugc nofollow" target="_blank">https://api.darksky.net/forecast/[key]/[latitude],[longitude],[time]</a></span></pre><p id="ae4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将key替换为您的私有API key，从google maps获取您想要获取其天气数据的地点的纬度和经度，对于时间，我们将使用UNIX时间。</p><blockquote class="jy jz ka"><p id="a276" class="if ig kb ih b ii ij ik il im in io ip kc ir is it kd iv iw ix ke iz ja jb jc hb bi translated"><strong class="ih hj"> Unix </strong>时间(或<strong class="ih hj"> Unix epoch </strong>或POSIX time或<strong class="ih hj"> Unix timestamp </strong> ) <strong class="ih hj">是</strong>一种用于描述时间点的系统，定义为自1970年1月1日午夜前协调世界时(UTC)起经过的秒数，不包括闰秒。</p></blockquote><p id="c8ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个<a class="ae jx" href="https://www.unixtimestamp.com/index.php" rel="noopener ugc nofollow" target="_blank">站点</a>可以用来将任何日期和时间转换成UNIX时间。结果将是一个JSON文件。我们将使用<em class="kb">每日</em>获取所有特征。</p><p id="9080" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将利用<code class="du kf kg kh ki b">namedtuple</code>将我们的数据附加到数据帧中。在<code class="du kf kg kh ki b">collections</code>中有一个<code class="du kf kg kh ki b">namedtuple</code>，它就像一个字典，增加了从键值和迭代中访问的选项。最后，当我们的数据集被创建时，我们可以向它添加我们的列名，并使用<code class="du kf kg kh ki b">df.to_csv</code>将我们的数据集转换成CSV文件。</p><pre class="je jf jg jh fd kj ki kk kl aw km bi"><span id="7f82" class="kn ko hi ki b fi kp kq l kr ks">import requests<br/>import pandas as pd<br/>from collections import namedtuple</span><span id="699f" class="kn ko hi ki b fi kt kq l kr ks">df1 = []<br/>features = ['temperatureMin', <br/>            'temperatureMax',<br/>            'sunriseTime',<br/>            'sunsetTime']<br/>DailySummary = namedtuple("DailySummary", features)<br/>for unix in range(1546300800, 1577836800, 86400):<br/>    BASE_URL = "<a class="ae jx" href="https://api.darksky.net/forecast/0d3b960fe7362e11cc9f6213b6fc192a/26.8371648,75.5625925" rel="noopener ugc nofollow" target="_blank">https://api.darksky.net/forecast/&lt;API-KEY&gt;/26.8371648,75.5625925</a>," + str(unix) + "?exclude=currently,flags,alerts,hourly"<br/>    response = requests.get(BASE_URL)<br/>    data = response.json()<br/>    df = pd.DataFrame(data["daily"]["data"])<br/>    df1.append(DailySummary(temperatureMin = df.at[0, 'temperatureMin'],<br/>                            temperatureMax = df.at[0, 'temperatureMax'],<br/>                            sunriseTime = df.at[0, 'sunriseTime'],<br/>                            sunsetTime = df.at[0, 'sunsetTime']))<br/>res = pd.DataFrame(df1, columns=features)<br/>res.to_csv('year_2019.csv', index=False)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es ku"><img src="../Images/40752fbd5305af7da510a546f4168fde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RoGCtI6Co8FLywlvSOitRg.png"/></div></div></figure></div></div>    
</body>
</html>