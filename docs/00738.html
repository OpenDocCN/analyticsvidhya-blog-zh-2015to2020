<html>
<head>
<title>Hypothesis Testing with the Northwind Database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Northwind数据库进行假设检验</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/hypothesis-testing-with-the-northwind-database-d0382c9328bd?source=collection_archive---------9-----------------------#2019-09-02">https://medium.com/analytics-vidhya/hypothesis-testing-with-the-northwind-database-d0382c9328bd?source=collection_archive---------9-----------------------#2019-09-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/4b0596d27aa69fc7205aabf37e1b4af8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IftYrkeqLegdBWDlRPgqpA.png"/></div></div></figure><p id="95e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设你是一名零售商，为一家虚构的国际特色食品供应商Northwind Traders工作。你的工作是确保你有足够的库存来完成每一个订单，并且产品不会在你的货架上放太久，可能会变质或变得不新鲜。产品告罄可能会导致你的客户转向竞争对手，临近保质期的食品将会降价销售，从而降低Northwind的利润率。</p><p id="5eb9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">幸运的是，您的数据库中有三年的订单历史记录，所以是时候开始工作了。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h2 id="00b8" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jb kg kh ki jf kj kk kl jj km kn ko kp bi translated">首先，我们必须定义我们的假设。</h2><p id="ed52" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">𝐻₀星期几对订单数量没有影响。<br/> H₁一周中的哪一天会导致订单数量的差异。</p><p id="35fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将试图拒绝零假设，即每天的订货量没有不同。这是一个双尾T检验，将检验样本均值是显著小于还是大于总体均值。显著性水平为0.05时，样本均值必须在概率分布的前2.5%或后2.5%。</p><h2 id="e47b" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jb kg kh ki jf kj kk kl jj km kn ko kp bi translated">现在，让我们得到我们的数据。</h2><p id="9251" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">(这里可以下载北风数据库<a class="ae kv" href="https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/sql/linq/downloading-sample-databases" rel="noopener ugc nofollow" target="_blank">)</a></p><p id="999f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用SQLite3来获取数据，并使用Python来操作数据。以下是Northwind数据库的ERD:</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kw"><img src="../Images/4225a79c6d3fc5797f3b2cdcc07b63ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kJE-hZ894AbAgnMgaL-ClA.png"/></div></div></figure><p id="8c5a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们最感兴趣的是查看订购的产品、订购日期和订购数量。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="3892" class="jv jw hi lc b fi lg lh l li lj">cur.execute("""Select od.ProductId, od.Quantity, o.OrderDate<br/>               FROM OrderDetail AS od<br/>               JOIN 'Order' as o<br/>               ON o.Id = od.OrderID;""")<br/>order_df = pd.DataFrame(cur.fetchall()) <br/>order_df.columns = [i[0] for i in cur.description]<br/>order_df.head()</span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es lk"><img src="../Images/79520eb661306531e044e89353fae813.png" data-original-src="https://miro.medium.com/v2/resize:fit:476/format:webp/1*FRB-6rgf9z1KVCqTs5gyvg.png"/></div></figure><p id="02f3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如您所见，OrderDate列不包括星期几。下面的代码将列从字符串更改为日期时间格式，并添加一个包含产品订购日期的新列。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="b474" class="jv jw hi lc b fi lg lh l li lj">order_df['OrderDate'] = pd.to_datetime(order_df.OrderDate)<br/>order_df['day_of_week'] = order_df['OrderDate'].dt.day_name()</span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es ll"><img src="../Images/5b2668ce2057e525172756d0e33ebfd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*MkbNiYXrHfrye3txYMlx6w.png"/></div></figure><p id="8601" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">维奥拉。现在我们有了一周中的每一天。但在我们超越自己之前，我们需要确保数据遵循正态分布。(提示:并没有。)以下可视化显示了使用以下代码对Quantity列进行对数转换之前和之后的:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="444c" class="jv jw hi lc b fi lg lh l li lj">order_df.Quantity = order_df.Quantity.apply(np.log)</span></pre><div class="kx ky kz la fd ab cb"><figure class="lm ij ln lo lp lq lr paragraph-image"><img src="../Images/8680905f60a8d4e8650822d3cb01b651.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*BYExFtsxpAOyKv0E_H8BDA.png"/></figure><figure class="lm ij ls lo lp lq lr paragraph-image"><img src="../Images/84b31b572f60df929e4d33215ef387d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*WaqJ3_Hi8Cf6-yjBlYrfJQ.png"/></figure></div><p id="c987" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">既然我们的数据已经标准化，我们需要查看一周中每天的平均订单量。为此，我们将创建一个数据透视表，并将其展平为一个数据帧。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="3968" class="jv jw hi lc b fi lg lh l li lj">weekday_quantity_pivot = pd.pivot_table(order_df, <br/>                                      index="ProductId", <br/>                                      columns='day_of_week', <br/>                                      values="Quantity",<br/>                                      fill_value=0.0, <br/>                                      margins=True)<br/>weekday_quantity = pd.DataFrame(weekday_quantity_pivot.to_records())<br/>weekday_quantity.drop(77, axis=0, inplace=True)<br/>weekday_quantity.head()</span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/4af42a80ec78d6e6159a17450bb6f693.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*XPL9Y5x6_vKRihG0UI8_hQ.png"/></div></figure><p id="15da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“所有”列显示了所有订单的平均订单数量，无论是哪一天，幸运的是，在我们进行分析时，“所有”列最终将作为我们的总体平均值。</p><h2 id="8c28" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jb kg kh ki jf kj kk kl jj km kn ko kp bi translated">考验的时候到了！</h2><p id="82e1" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">我们将使用stats.ttest_1samp进行单样本T检验。因为这是一个双尾测试(我们想知道你在那几天应该多点还是少点)，p值需要减半。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="7408" class="jv jw hi lc b fi lg lh l li lj">pop_means = weekday_quantity.All # Population mean<br/>alpha = .05 # Significance level</span><span id="d87a" class="jv jw hi lc b fi lu lh l li lj">p_vals = []<br/>d_o_w = []<br/>significant_or_not = []<br/>difference = []<br/>for day in order_days:<br/>    day_order = order_df.loc[order_df["day_of_week"] == day] #sort by day<br/>    for i in np.arange(1,78): # Sort by product ID<br/>        pop_mean = pop_means[i-1] #Population mean series begins at 0<br/>        a = day_order.loc[day_order["ProductId"]==i].Quantity<br/>        difference.append(a.mean()-pop_mean)<br/>        T, two_tailed_p = stats.ttest_1samp(a=a, popmean=pop_mean)<br/>        p_vals.append(round(two_tailed_p,2))<br/>        d_o_w.append(day)<br/>        if <strong class="lc hj">alpha/2</strong> &gt; two_tailed_p: <br/>            significant_or_not.append(True)<br/>        else:<br/>            significant_or_not.append(False)    <br/>            <br/>results_df = pd.DataFrame([p_vals, d_o_w, significant_or_not, difference]).transpose()<br/>results_df.columns = ['PVal', "Day", "RejectNull", "Difference"]</span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es lv"><img src="../Images/6924b08f56c5d91e26f15e1cba6cffac.png" data-original-src="https://miro.medium.com/v2/resize:fit:454/format:webp/1*vm8r_AmkUuXLtuPgrnzCcg.png"/></div></figure><p id="2c86" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">经过一天的重新索引和排序，我们得到了结果。该数据框架仅展示了p值小于阈值的产品，具有统计学意义。差值列是样本平均值减去总体平均值的差值。例如，产品2的平均订单量大于样本量，因此作为一名库存商，您可以减少周一的库存量，以应对可能变质的产品过剩，但产品10的库存在周一应该会增加，因为平均订单量小于样本量。</p><h1 id="830a" class="lw jw hi bd jx lx ly lz kb ma mb mc kf md me mf ki mg mh mi kl mj mk ml ko mm bi translated">所以…</h1><p id="b324" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">有了这些信息，你将在Northwind Traders的历史上巩固自己的地位，成为减少浪费、改善客户关系、增加利润的股票经纪人。但是工作还没有完成。节假日前后销量增加怎么办？季节性呢？产品订购的地区呢？数据科学家的工作永远不会结束。</p></div></div>    
</body>
</html>