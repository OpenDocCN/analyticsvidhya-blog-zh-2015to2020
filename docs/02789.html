<html>
<head>
<title>Person / Pedestrian Detection in Real-Time and Recorded Videos in Python — Windows and macOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Python-Windows和macOS中实时检测人/行人并录制视频</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/person-pedestrian-detection-in-real-time-and-recorded-videos-in-python-windows-and-macos-4c81142f5f59?source=collection_archive---------8-----------------------#2020-01-02">https://medium.com/analytics-vidhya/person-pedestrian-detection-in-real-time-and-recorded-videos-in-python-windows-and-macos-4c81142f5f59?source=collection_archive---------8-----------------------#2020-01-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex if ig ih ii"><div class="bz dy l di"><div class="ij ik l"/></div><figcaption class="il im et er es in io bd b be z dx translated">视频来源于宝莱坞歌曲<em class="ip"> Birju </em>的前10秒</figcaption></figure><p id="209c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">人员检测是目前公司和组织广泛使用的功能之一。这项技术使用计算机视觉来检测人，通常是过马路的行人，或者识别房屋周围的任何运动。</p><p id="5195" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个项目中，我们将通过简单的步骤用python创建一个人检测系统。</p><p id="0731" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们首先安装OpenCV(开源计算机视觉)库，该库旨在帮助开发人员执行与计算机视觉相关的任务。我们需要为OpenCV库做一个pip安装。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="e6e1" class="jx jy hi jt b fi jz ka l kb kc">install opencv-python</span></pre><h1 id="b377" class="kd jy hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">现在让我们用Python来构建这个系统</h1><p id="71d8" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">我们已经安装了所需的库。该技术的工作方式是，我们在要检测的对象(本例中为人)的各种图像参数上训练模型，用于识别我们目标中的对象。</p><p id="f795" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可以把它想象成任何机器学习模型的训练和测试数据集。</p><p id="da4b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这种情况下:</p><p id="bde9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">训练数据集:</strong>。捕获目标对象图像细节的xml文件</p><p id="cd2e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">测试数据集:</strong>直播流视频/录制视频</p><p id="ba9e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完整代码的链接可以在本文末尾找到。我将分步分块地解释代码，以帮助您理解它是如何工作的:</p><p id="9d3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第一步:</strong>打开Spyder</p><p id="fce7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第二步:</strong>导入库</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="733b" class="jx jy hi jt b fi jz ka l kb kc">import cv2</span></pre><p id="f7c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤3: </strong>将输入引用到您的网络摄像头或保存在硬盘上的视频文件(mp4格式)</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="8efb" class="jx jy hi jt b fi jz ka l kb kc"><strong class="jt hj">Webcam: </strong>cap = cv2.VideoCapture(0)<br/><strong class="jt hj">Video: </strong>cap = cv2.VideoCapture(<strong class="jt hj">&lt;enter file path.mp4&gt;</strong>)</span></pre><p id="9455" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第4步:</strong>我们将使用一个预先训练好的。xml文件，包含使用个人图像构建的人(全身)的数据。你可以在这里下载文件<a class="ae lf" href="https://github.com/chandravenky/Computer-Vision---Object-Detection-in-Python/tree/master/xml%20files" rel="noopener ugc nofollow" target="_blank"/></p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="d201" class="jx jy hi jt b fi jz ka l kb kc">pedestrian_cascade = cv2.CascadeClassifier(<strong class="jt hj">&lt;enter file path&gt;</strong>/haarcascade_fullbody.xml’)</span></pre><p id="284d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第五步:</strong>视频分帧，代码一次读取一帧。在每一帧中，我们使用上面导入的API来检测人在帧中的位置。对于每一个被检测到的人，我们定位坐标并在它周围画一个矩形，然后将视频发布给观众。</p><p id="c69f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完整的代码如下所示——代码下面有解释</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="5cf3" class="jx jy hi jt b fi jz ka l kb kc">while True:<br/>    # reads frames from a video<br/>    ret, frames = cap.read()<br/>    # convert to gray scale of each frames<br/>    #gray = cv2.cvtColor(frames, cv2.COLOR_BGR2GRAY)<br/>    # Detects pedestrians of different sizes in the input image<br/>    pedestrians = pedestrian_cascade.detectMultiScale( frames, 1.1, <br/>    1)<br/>    # To draw a rectangle in each pedestrians<br/>    for (x,y,w,h) in pedestrians:<br/>        cv2.rectangle(frames,(x,y),(x+w,y+h),(0,255,0),2)<br/>        font = cv2.FONT_HERSHEY_DUPLEX<br/>        cv2.putText(frames, 'Person', (x + 6, y - 6), font, 0.5, (0, <br/>        255, 0), 1)<br/>        # Display frames in a window<br/>        cv2.imshow('Pedestrian detection', frames)<br/>    # Wait for Enter key to stop<br/>    if cv2.waitKey(33) == 13:<br/>        break</span></pre><p id="bc31" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">模块1: </strong></p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="23f1" class="jx jy hi jt b fi jz ka l kb kc"># reads frames from a video<br/> ret, frames = cap.read()<br/> # convert to gray scale of each frames<br/> gray = cv2.cvtColor(frames, cv2.COLOR_BGR2GRAY)</span></pre><p id="71c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">视频是按单个帧读取的。接下来，帧被转换为灰度，这有助于快速检测人类。图像转换为灰度的原因是，训练数据集是以灰度构建的，以减小文件的大小。</p><p id="977a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第二区:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="dfd0" class="jx jy hi jt b fi jz ka l kb kc"># Detects pedestrians of different sizes in the input image<br/>    pedestrians = pedestrian_cascade.detectMultiScale( gray, 1.1, 1)</span><span id="77ab" class="jx jy hi jt b fi lg ka l kb kc"># To draw a rectangle in each pedestrians<br/>    for (x,y,w,h) in pedestrians:<br/>        cv2.rectangle(frames,(x,y),(x+w,y+h),(0,255,0),2)<br/>        font = cv2.FONT_HERSHEY_DUPLEX<br/>        cv2.putText(frames, 'Person', (x + 6, y - 6), font, 0.5, (0, <br/>        255, 0), 1)</span></pre><p id="29b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">代码的第一部分检测帧中的人，并存储他们的坐标(x、y轴，以及人的宽度和高度)。第二部分在检测到人的区域周围绘制一个矩形，并在矩形上方显示文本“person”。您可以更改文本的字体，代码(0，255，0)是B-G-R序列中矩形和文本的颜色代码。</p><p id="9448" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第三块:</strong></p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="1b78" class="jx jy hi jt b fi jz ka l kb kc"># Display frames in a window<br/>        cv2.imshow('Pedestrian detection', frames)<br/># Wait for Enter key to stop<br/>    if cv2.waitKey(33) == 13:<br/>        break</span></pre><p id="5d29" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">结果图像(帧)被释放给查看者，并且循环继续运行，直到用户按下键盘上的回车键。</p><p id="0d95" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第六步:</strong>所有拍摄的视频必须发布。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="55b8" class="jx jy hi jt b fi jz ka l kb kc">cap.release()<br/>cv2.destroyAllWindows()</span></pre><h1 id="0bd2" class="kd jy hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">在命令行中运行程序</h1><p id="08c6" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">下一步是<a class="ae lf" rel="noopener" href="/@venkatesh.chandra_75550/saving-output-of-object-recognition-in-macos-opencv-python-5914bb5d9ca8">保存</a>文件。py格式并在命令行/Anaconda提示符下运行它。</p><p id="fe94" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我在Anaconda提示符下运行它，首先使用命令cd导航到该文件夹。</p><p id="a326" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我在Anaconda提示符下运行它，首先使用命令cd导航到该文件夹。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="baaa" class="jx jy hi jt b fi jz ka l kb kc">cd &lt;folder path&gt;</span></pre><p id="327a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行python文件</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="7360" class="jx jy hi jt b fi jz ka l kb kc">python filename.py</span></pre><p id="517e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您将看到一个弹出窗口，视频正在播放。视频可能会很慢，这是因为OpenCV中的帧数通常很大。但是，如果将视频保存在硬盘上，写入的视频速度并不慢，并且与输入视频的fps(每秒帧数)相匹配。</p><figure class="jo jp jq jr fd ii er es paragraph-image"><div class="er es lh"><img src="../Images/546a659147584a868361f62455d19594.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*9ANUUWfjreOeQmrLwO5lBg.gif"/></div><figcaption class="il im et er es in io bd b be z dx translated">在方框周围显示检测的置信度通常有助于减少错误分类</figcaption></figure><p id="7383" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以在这里下载更多免费视频<a class="ae lf" href="https://www.pexels.com/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="3acc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">哒哒！你现在可以很容易地发现窃贼和安全。将它与警报系统集成在一起以确保安全。</strong></p><p id="94e1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">玩玩模仿人类行走方式的两足动物和机器人，并在下面的评论区告诉我进展如何。</strong></p><p id="0c04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">面对问题？发布您的查询。</p><h1 id="f53e" class="kd jy hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">用例</h1><ul class=""><li id="cb52" class="lk ll hi is b it la ix lb jb lm jf ln jj lo jn lp lq lr ls bi translated">教师可以使用此功能来记录出勤情况</li><li id="5482" class="lk ll hi is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls bi translated">估计人群中的人数——避免骚乱等。</li></ul><h1 id="d0b5" class="kd jy hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">编码</h1><div class="ly lz ez fb ma mb"><a href="https://github.com/chandravenky/Computer-Vision---Object-Detection-in-Python/tree/master" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab dw"><div class="md ab me cl cj mf"><h2 class="bd hj fi z dy mg ea eb mh ed ef hh bi translated">chandravenky/Python中的计算机视觉对象检测</h2><div class="mi l"><h3 class="bd b fi z dy mg ea eb mh ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mj l"><p class="bd b fp z dy mg ea eb mh ed ef dx translated">github.com</p></div></div><div class="mk l"><div class="ml l mm mn mo mk mp li mb"/></div></div></a></div><h1 id="320c" class="kd jy hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">相关链接</h1><p id="5e44" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated"><a class="ae lf" rel="noopener" href="/@venkatesh.chandra_75550/vehicle-car-detection-in-real-time-and-recorded-videos-in-python-windows-and-macos-c5548b243b18"> <strong class="is hj">使用OpenCV的Python中的车辆检测— Windows和macOS </strong> </a></p><p id="c596" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae lf" rel="noopener" href="/@venkatesh.chandra_75550/real-time-webcam-face-detection-system-using-opencv-in-python-windows-and-macos-86c31fddd2bc"><strong class="is hj">Python中的实时人脸检测系统——Windows和macOS </strong> </a></p><p id="31b9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae lf" rel="noopener" href="/@venkatesh.chandra_75550/face-detection-on-recorded-videos-using-opencv-in-python-windows-and-macos-407635c699"><strong class="is hj">Python中录制视频的人脸检测— Windows和macOS </strong> </a></p><p id="311a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae lf" rel="noopener" href="/@venkatesh.chandra_75550/saving-output-of-object-recognition-in-macos-opencv-python-5914bb5d9ca8"> <strong class="is hj">在macOS中保存物体识别输出</strong> </a></p><h1 id="da4c" class="kd jy hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">去哪里找我🤓</h1><ol class=""><li id="e833" class="lk ll hi is b it la ix lb jb lm jf ln jj lo jn mq lq lr ls bi translated">在<a class="ae lf" href="https://www.linkedin.com/in/venkateshchandra/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>/<a class="ae lf" href="https://github.com/chandravenky" rel="noopener ugc nofollow" target="_blank">GitHub</a>/<a class="ae lf" href="http://chatraja.com/" rel="noopener ugc nofollow" target="_blank">我的网站</a>上与我联系</li><li id="b89e" class="lk ll hi is b it lt ix lu jb lv jf lw jj lx jn mq lq lr ls bi translated">感觉大方？在这里给我买杯咖啡☕️</li></ol></div></div>    
</body>
</html>