<html>
<head>
<title>I made a contactless Secret Santa algorithm with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我用 Python 做了一个非接触式秘密圣诞老人算法</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/i-made-a-contactless-secret-santa-algorithm-with-python-7374d4a79c56?source=collection_archive---------9-----------------------#2020-11-03">https://medium.com/analytics-vidhya/i-made-a-contactless-secret-santa-algorithm-with-python-7374d4a79c56?source=collection_archive---------9-----------------------#2020-11-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9ce140830a3cf69bd77e156f292b6acd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q_g8MhVbh9gWk9P6_7Yupg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">罗曼·桑博尔斯基在 Dreamstime.com 拍摄的照片</figcaption></figure><p id="e801" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">今年，我的朋友们给了我一个任务:组织今年的神秘圣诞老人。通常这不是我的角色。但是通常组织它的人已经离开我们去英国喝茶和会见女王了。现在，你可能会问，为什么不把名字写在纸上，揉成一团，塞进帽子里呢？你为什么不像正常人那样做呢？然而，你可能注意到了，也可能没有注意到，我们现在正处于疫情。没有正常的做事方式，除非你指的是新常态。所以我需要让它无接触，便于我携带——因为我很懒。</p><p id="cf5d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以把名字贴在帽子里，然后一个一个地挑选。然而，a)我们组有 5 个人以上，这是非法的，b)这需要一段时间，如果我选了自己的名字，我们必须重新开始，我可能会痛苦地哭。我可以只分配名字，但这意味着我被排除在外。没有给我的礼物，没有用我的超级侦探能力找出谁得到了谁。我做不到。不，我知道我必须用 Python 创建一个算法！</p><p id="5a42" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以我走到绘图板前，列出了这个程序的功能:</p><ul class=""><li id="89d9" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">获取所有参与者的姓名和电子邮件并存储起来。</li><li id="07d6" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">给每个参与者分配一个神秘的圣诞老人，确保每个人都有一个不属于自己的名字。</li><li id="e8a6" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">通过电子邮件向每个人发送他们的分配，实现真正的无接触体验！</li></ul><p id="2daf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我需要找到工作所需的 Python 库。有不少:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="8361" class="kq kr hi km b fi ks kt l ku kv"><strong class="km hj">import </strong>re<strong class="km hj"><br/>import</strong> random<br/><strong class="km hj">import</strong> smtplib<br/><strong class="km hj">from</strong> email.mime.multipart <strong class="km hj">import</strong> MIMEMultipart<br/><strong class="km hj">from</strong> email.mime.text <strong class="km hj">import</strong> MIMEText</span></pre><p id="fc3b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">随机库是这样的，我可以使用<strong class="ix hj"> randint </strong>函数来随机化圣诞老人的秘密分配。其余的库是我的程序的电子邮件部分所必需的。re 库是这样我可以验证电子邮件！</p><p id="517b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我还初始化了几个变量:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="d700" class="kq kr hi km b fi ks kt l ku kv">sender_address = 'email'<br/>sender_pass = 'password'</span><span id="c4c8" class="kq kr hi km b fi kw kt l ku kv">names = []<br/>emails = []<br/>recipient = []<br/>budget = 50</span><span id="b55c" class="kq kr hi km b fi kw kt l ku kv">count = 0</span></pre><p id="1986" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，我需要决定如何将名字和电子邮件放入程序中。我决定有两种数据输入方法:</p><ul class=""><li id="00bc" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated"><strong class="ix hj">通过文字(。txt)文件</strong>:用户设置一个特定格式的文本文件<em class="kx">名称，email </em>。每一个新的行都有一个新的参与者，程序将处理文本文件并将所有的参与者存储在列表中。</li><li id="f4f1" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><strong class="ix hj">手动输入</strong>:用户手动输入每个参与者的姓名和邮箱，程序会提示(“输入参与者 1 的姓名:”、“输入参与者 1 的邮箱:”)等。).</li></ul><p id="92ba" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是数据输入代码的样子(包括验证！):</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="cf17" class="kq kr hi km b fi ks kt l ku kv"><strong class="km hj"># asks the for data entry method</strong><br/>print("""Welcome to the secret santa decision-maker! How would you like to enter the information?<br/>   1. give a text (.txt) file with format of: name, email address<br/>   2. manually enter information""")</span><span id="313a" class="kq kr hi km b fi kw kt l ku kv">x = 0<br/>while(x == 0):<br/>   try:<br/>      option = int(input("Info entry method (1 or 2): "))<br/>      if(option &gt; 2 or option &lt; 1):<br/>         print("ERROR: You can only input 1 or 2!")<br/>         print("""How would you like to enter the information?<br/>            1. give a text (.txt) file<br/>            2. manually enter information""") else:<br/>      x = 1<br/>   except ValueError:<br/>      print("ERROR: Please input 1 or 2!")<br/>      print("""How would you like to enter the information?<br/>         1. give a text (.txt) file<br/>         2. manually enter information""")</span><span id="37e3" class="kq kr hi km b fi kw kt l ku kv"><strong class="km hj"># gets the number of participants</strong><br/>x = 0<br/>while(x == 0):<br/>   try:<br/>      count = int(input("Enter number of participants: "))<br/>      if(count &lt; 2):<br/>         print("ERROR: Number of participants must be 2 or more!")<br/>      else:<br/>         x = 1<br/>   except ValueError:<br/>      print("ERROR: Please input a valid integer number!")</span><span id="c26c" class="kq kr hi km b fi kw kt l ku kv"><strong class="km hj"># option 1: read the file (assumes file format is correct)</strong><br/>if(option == 1): <br/>   x = 0<br/>   while(x == 0):<br/>      filename = str(input("Name of text file (must end in .txt): "))<br/>      if (filename[-4:] == '.txt'):<br/>         x = 1 <br/>      else:<br/>         print("ERROR: Please input a file name which ends with .txt")<br/>   text = open(filename, "r") <br/>   for i in range(0, count):<br/>      info = text.readline().split(', ')<br/>      names.append(info[0])<br/>      emails.append(info[1])</span><span id="0586" class="kq kr hi km b fi kw kt l ku kv"><strong class="km hj"># option 2: manually get info (assumes email is correct)</strong><br/>elif(option == 2):<br/>   <br/>   <!-- --># for validating an Email<br/>   regex <strong class="km hj">=</strong> <!-- -->'^[a-z0-9]+[\._]?[a-z0-9]+[@]\w+[.]\w{2,3}$'</span><span id="2e44" class="kq kr hi km b fi kw kt l ku kv">   print("Ok! It's time for you to input the participants' information!")<br/>   for i in range(1, count + 1):<br/>      name = str(input(f'Enter participant the name of participant {i}: '))<br/>      names.append(name)<br/>      x = 0<br/>      while(x == 0):<br/>         email = str(input(f'Enter the email of participant {i}: '))<br/>         <!-- -->if(re.search(regex, email)):<br/>            emails.append(email)<br/>            x = 1<br/>         else:<br/>            print("ERROR: invalid email!")</span></pre><p id="56f7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在是节目的主要部分:神秘的圣诞老人分配。首先，我复制了<strong class="ix hj"> names </strong>列表——我将从这个列表中选择分配，并在分配后删除该名称。然后，我使用了一个<strong class="ix hj"> for 循环</strong>来遍历<strong class="ix hj">名字</strong>列表中的每个名字，并分配他们将成为谁的秘密圣诞老人。为此，我将使用内置 Python <strong class="ix hj"> random </strong>库中的<strong class="ix hj"> randint </strong>函数。这个随机数代表收件人的<strong class="ix hj">索引</strong>。然后，我将收件人的名字添加到<strong class="ix hj">收件人</strong>列表中。然而，有一些情况我必须检查:</p><ul class=""><li id="3f6f" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">如果收件人的名字和神秘圣诞老人的名字一样。这是不可能的，因为你不能成为自己的秘密圣诞老人！因此，我设置了一个<strong class="ix hj"> if，else </strong>自变量。如果名称相同，程序将再次运行<strong class="ix hj"> randint </strong>函数来选择另一个索引。</li><li id="8b2e" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">如果唯一留下的收件人名字和神秘圣诞老人的名字一样。如果我继续使用 randint 函数，我将陷入无限循环，因为没有其他选择！因此，我有另一个<strong class="ix hj"> if </strong>语句，检查<strong class="ix hj"> possible_santa </strong>列表的长度是否为 1(意味着程序必须再次运行)。这将<strong class="ix hj">重做</strong>布尔设置为<strong class="ix hj">真</strong>，允许程序再次运行。</li></ul><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="f495" class="kq kr hi km b fi ks kt l ku kv">possible_santa = names.copy()</span><span id="bfbe" class="kq kr hi km b fi kw kt l ku kv">cont = 0</span><span id="1cd0" class="kq kr hi km b fi kw kt l ku kv">while(cont == 0):<br/>    <br/>    redo = False<br/>    <br/>    possible_santa = names.copy()<br/>    <br/>    for i in range(0, len(names)):<br/>        recip = random.randint(0, len(possible_santa) - 1)<br/>        x = 0<br/>        while(x == 0):<br/>            if(names[i] == possible_santa[recip]):<br/>                if(len(possible_santa) == 1):<br/>                    redo = True<br/>                    x = 1<br/>                else:<br/>                    recip = random.randint(0, len(possible_santa) - 1)<br/>            else:<br/>                x = 1<br/>        if(redo != True):<br/>            recipient.append(possible_santa[recip])<br/>            possible_santa.pop(recip)<br/>            cont = 1<br/>        else:<br/>            cont = 0</span></pre><p id="534c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">既然分配已经设置好了，我需要将它们通过电子邮件发送给参与者！为此，我使用了 SMTP——Python 有一个内置的电子邮件发送库，smtplib。我还使用了 email.mime.multipart 和 email.mime.text —更多的 Python 库。我用了这个网站:<a class="ae iu" href="https://www.freecodecamp.org/news/send-emails-using-code-4fcea9df63f/" rel="noopener ugc nofollow" target="_blank">https://www . freecodecamp . org/news/send-emails-using-code-4 fcea 9 df 63 f/</a>做参考，确实很有帮助！</p><p id="5aa2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是代码片段，还有一些注释，我希望这些注释能解释一切！</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="6f16" class="kq kr hi km b fi ks kt l ku kv"># this code must run for each name<br/>for i in range(0, count):</span><span id="b8e4" class="kq kr hi km b fi kw kt l ku kv">    # the message which will be sent in the email<br/>    mail_content = f'''Hello {names[i]},<br/>    <br/>You are the secret santa of {recipient[i]}!<br/>    <br/>Remember the budget is ${budget}<br/>    '''<br/>    <br/>    # sets the email address the email will be sent to<br/>    receiver_address = emails[i]<br/>    <br/>    # sets up the MIME<br/>    message = MIMEMultipart()<br/>    message['From'] = sender_address # your email address<br/>    message['To'] = receiver_address # Secret Santa's email address<br/>    message['Subject'] = 'Secret Santa' # subject of the <br/>    <br/>    # sets the body of the mail<br/>    message.attach(MIMEText(mail_content, 'plain'))<br/>    <br/>    # creates the SMTP session for sending the mail<br/>    session = smtplib.SMTP('smtp.gmail.com', 587)<br/>    session.connect("smtp.gmail.com", 587)<br/>    session.ehlo()<br/>    session.starttls()<br/>    session.login(sender_address, sender_pass)<br/>    text = message.as_string()<br/>    session.sendmail(sender_address, receiver_address, text)<br/>    session.quit()</span></pre><p id="2fc0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我还想创建一个文本文件，保存分配，以防出错！这确保了我可以仔细检查每件事，我们有一个备份列表。</p><p id="58fd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为此，我使用 open 函数创建了一个新的文本文件。然后我使用了一个 for 循环来遍历每个秘密圣诞老人和接收者，并将每个分配写入文件中的一个新行！请确保您也关闭了文本文件！</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="319c" class="kq kr hi km b fi ks kt l ku kv">allocations = open("SantaAllocations.txt", "w+")</span><span id="c290" class="kq kr hi km b fi kw kt l ku kv">for i in range(0, len(names)):<br/>    allocations.write(f'{names[i]} is the secret santa of {recipient[i]}\n')<br/>    <br/>allocations.close()</span></pre><p id="b6c5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这不是创建这个生成器的唯一方法，如果你能想到任何其他方法，请告诉我！</p><p id="6508" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我迫不及待地想使用这个程序，并得到所有的礼物，我希望你喜欢编码和使用它！祝你圣诞快乐，如果你喜欢这个，可以看看我的博客<a class="ae iu" href="https://itsliterallymonique.wordpress.com/" rel="noopener ugc nofollow" target="_blank">https://itsliterallymonique.wordpress.com/</a>了解更多类似的内容！</p><p id="b65c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你想下载这段代码，就在这个 github 仓库里:【https://github.com/moniquethemuffin/Secret-Santa-Generator<a class="ae iu" href="https://github.com/moniquethemuffin/Secret-Santa-Generator" rel="noopener ugc nofollow" target="_blank"/></p></div></div>    
</body>
</html>