<html>
<head>
<title>Introducing PyFiguration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简介配置</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/introducing-pyfiguration-4d306cbf6321?source=collection_archive---------31-----------------------#2020-07-06">https://medium.com/analytics-vidhya/introducing-pyfiguration-4d306cbf6321?source=collection_archive---------31-----------------------#2020-07-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/c8a696f685af7076668ba7840caca33b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*C_Y4ez5Uxl17xmqL"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">塞萨尔·卡利瓦里诺·阿拉贡在<a class="ae hv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><div class=""/><div class=""><h2 id="db59" class="pw-subtitle-paragraph iv hx hy bd b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm dx translated">Python配置库，使配置接近您的代码。</h2></div><p id="70d7" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">有许多(很棒的)库可以用来配置Python脚本。你可以使用带有<a class="ae hv" href="https://docs.python.org/3/library/argparse.html" rel="noopener ugc nofollow" target="_blank"> argparse </a>或<a class="ae hv" href="https://click.palletsprojects.com/en/7.x/" rel="noopener ugc nofollow" target="_blank"> Click </a>的命令行选项，使用带有<a class="ae hv" href="https://json-schema.org/" rel="noopener ugc nofollow" target="_blank"> JSON模式</a>的JSON文件，使用带有<a class="ae hv" href="https://github.com/yaml/pyyaml" rel="noopener ugc nofollow" target="_blank"> PyYAML </a>的YAML，或者使用老式的。带有<a class="ae hv" href="https://docs.python.org/3/library/configparser.html" rel="noopener ugc nofollow" target="_blank"> configparser </a>的INI文件。我曾经在某个时间点使用过上述所有方法，但不知何故，我总是以不再有效或不再使用的配置条目结束，并且我一直打开代码来检查哪些选项是可用的。</p><p id="2d3b" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">配置与代码分离，这是一件好事，但是为了优化代码的使用，您应该能够快速显示哪些配置选项是可用的，允许的值是什么，以及它将如何影响您的代码。这就是我开始<a class="ae hv" href="https://pyfiguration.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">py configuration</a>的原因。</p><p id="019b" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">使用<a class="ae hv" href="https://pyfiguration.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">p配置</a>您可以在代码中用装饰器定义配置选项。您将按预期使用这些配置，当您完成时,<a class="ae hv" href="https://pyfiguration.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">p配置</a>命令行工具帮助记录所有配置选项。它甚至会检查配置文件是否有效，这对CI/CD管道非常有用！</p><p id="48da" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><a class="ae hv" href="https://github.com/gijswobben/pyfiguration" rel="noopener ugc nofollow" target="_blank">https://github.com/gijswobben/pyfiguration</a></p><h1 id="9a28" class="kj kk hy bd kl km kn ko kp kq kr ks kt je ku jf kv jh kw ji kx jk ky jl kz la bi translated">说够了，秀点代码！</h1><p id="b691" class="pw-post-body-paragraph jn jo hy jp b jq lb iz js jt lc jc jv jw ld jy jz ka le kc kd ke lf kg kh ki hb bi translated">让我们从一个简单的例子开始，为一个<a class="ae hv" href="https://flask.palletsprojects.com/en/1.1.x/" rel="noopener ugc nofollow" target="_blank"> Flask </a>服务器定义一些配置:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="0e08" class="lp kk hy ll b fi lq lr l ls lt"># script.py</span><span id="8436" class="lp kk hy ll b fi lu lr l ls lt">from pyfiguration import conf<br/>from flask import Flask</span><span id="666c" class="lp kk hy ll b fi lu lr l ls lt">app = Flask(__name__)</span><span id="b6cc" class="lp kk hy ll b fi lu lr l ls lt">@conf.add_int_field(<br/>    "server.port",<br/>    description="The port that the server will run on",<br/>    default=5000,<br/>    <em class="lv">minValue</em>=80,<br/>    <em class="lv">maxValue</em>=65535<br/>)<br/><em class="lv">def</em> startServer():<br/>    port = conf["server"]["port"]<br/>    app.run(<em class="lv">port</em>=port)</span><span id="ff22" class="lp kk hy ll b fi lu lr l ls lt">if __name__ == "__main__":<br/>    startServer()</span></pre><p id="bad5" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在这个例子中，我们用Flask创建了一个简单的服务器，并用一个新的配置选项修饰了<code class="du lw lx ly ll b">startServer</code>方法。通过这种方式，我们保持配置接近代码。此外，我们还定义了一个默认值，因此当没有可用的配置文件时，我们将在端口5000上启动服务器。最后，我们希望确保服务器端口为80或更高，并且低于65535(这是机器上最大的可用端口号)。</p><p id="663e" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在我们可以使用<a class="ae hv" href="https://pyfiguration.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">py configuration</a>命令行工具来检查这个脚本:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="a612" class="lp kk hy ll b fi lq lr l ls lt">$ pyfiguration inspect script -s ./script.py<br/>The following options can be used in a configuration file for the module './examples/simple/x.py':<br/>server:<br/>  port:<br/>    allowedDataType: int<br/>    default: 5000<br/>    description: The port that the server will run on<br/>    maxValue: 65535<br/>    minValue: 80<br/>    required: true</span></pre><p id="422e" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">输出(YAML格式)告诉我们在一个配置文件中允许哪些键(<code class="du lw lx ly ll b">server </code>和<code class="du lw lx ly ll b">port</code>)，以及端口字段的特征是什么。</p><p id="bf95" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在让我们创建一个配置文件:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="3b01" class="lp kk hy ll b fi lq lr l ls lt"># config.yaml</span><span id="aada" class="lp kk hy ll b fi lu lr l ls lt">server:<br/>  port: 6000</span></pre><p id="0bd6" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">或者在JSON中:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="fca5" class="lp kk hy ll b fi lq lr l ls lt"># config.json</span><span id="d123" class="lp kk hy ll b fi lu lr l ls lt">{<br/>  "server": {<br/>    "port": 6000<br/>  }<br/>}</span></pre><p id="c5eb" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">用其中一个运行我们的脚本:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="6941" class="lp kk hy ll b fi lq lr l ls lt">$ python script.py -c config.yaml<br/> * Serving Flask app "x" (lazy loading)<br/> * Environment: production<br/>   WARNING: Do not use the development server in a production environment.<br/>   Use a production WSGI server instead.<br/> * Debug mode: off<br/> * Running on <a class="ae hv" href="http://127.0.0.1:5000/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:6000/</a> (Press CTRL+C to quit)</span></pre><p id="f477" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">成功！您甚至可以提供多个配置文件来覆盖某些配置密钥，或者提供一个配置文件文件夹来加载所有配置文件。</p><p id="4d54" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在假设我们在配置文件中犯了一些错误:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="e62d" class="lp kk hy ll b fi lq lr l ls lt"># config_with_warnings.yaml</span><span id="3147" class="lp kk hy ll b fi lu lr l ls lt">server:<br/>  port: 500.0<br/>  not_needed_key: some random value</span></pre><p id="f8e4" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们可以使用<a class="ae hv" href="https://pyfiguration.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">py configuration</a>命令行工具来找到这些:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="6085" class="lp kk hy ll b fi lq lr l ls lt">$ pyfiguration inspect config -s script.py -c config_with_warnings.yaml<br/>--------<br/> Errors <br/>--------<br/>   ✗ Value '500.0' is not of the correct type. The allowed data type is: int<br/>----------<br/> Warnings <br/>----------<br/>   ! Key 'server.not_needed_key' doesn't exist in the definition and is not used in the module.</span></pre><p id="96a8" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">请注意，错误的服务器端口被标记为错误，代码未使用的密钥被标记为警告。代码没有使用的键没有错，但是它可能会导致脚本的意外结果。</p><h1 id="9c51" class="kj kk hy bd kl km kn ko kp kq kr ks kt je ku jf kv jh kw ji kx jk ky jl kz la bi translated">…以及更多！</h1><p id="172f" class="pw-post-body-paragraph jn jo hy jp b jq lb iz js jt lc jc jv jw ld jy jz ka le kc kd ke lf kg kh ki hb bi translated">配置继承，检查，解析，…这个帖子讲的太多了。前往<a class="ae hv" href="https://github.com/gijswobben/pyfiguration" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>、<a class="ae hv" href="https://pypi.org/project/pyfiguration/" rel="noopener ugc nofollow" target="_blank"> PyPi </a>或<a class="ae hv" href="https://pyfiguration.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> ReadTheDocs </a>获取更多信息！</p></div></div>    
</body>
</html>