<html>
<head>
<title>Quick guide for Stock Price Prediction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">股票价格预测快速指南</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/quick-guide-for-stock-price-prediction-d6624eb29248?source=collection_archive---------9-----------------------#2019-09-16">https://medium.com/analytics-vidhya/quick-guide-for-stock-price-prediction-d6624eb29248?source=collection_archive---------9-----------------------#2019-09-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="18eb" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">熊猫、sklearn和Keras股票价格分析和可视化初学者指南。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/1706e053d084e74123441dc611e55b79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hhq3ybwbyA3p0dWuLFtLMQ.jpeg"/></div></div></figure><p id="1798" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">最近我对股票交易和投资感兴趣，所以，当然，我的目标是通过股票分析和预测赚钱。作为一个机器学习爱好者，我认为尝试使用机器学习来预测股票价格和赚钱。</p><p id="098d" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">本文的目的是快速启动股票预测之旅，并不断改进我们的模型。</p><h2 id="0356" class="kf kg hi bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz bi translated">资料组</h2><p id="6a76" class="pw-post-body-paragraph jj jk hi jl b jm la ij jo jp lb im jr js lc ju jv jw ld jy jz ka le kc kd ke hb bi translated">使用熊猫网络阅读器功能和雅虎财经API，我们将提取股票的数据。</p><pre class="iy iz ja jb fd lf lg lh li aw lj bi"><span id="392a" class="kf kg hi lg b fi lk ll l lm ln">import pandas as pd<br/>import datetime<br/>import pandas_datareader.data as web<br/>from pandas import Series, DataFrame</span><span id="8dd6" class="kf kg hi lg b fi lo ll l lm ln">start = datetime.datetime(2001, 1, 1)<br/>end = datetime.datetime(2019, 9, 11)</span><span id="c6e0" class="kf kg hi lg b fi lo ll l lm ln">df = web.DataReader("RELIANCE.NS", 'yahoo', start, end)<br/>df.head()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lp"><img src="../Images/5ec87c0f9e855358454024a2a88e7fff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*M1bC6CmezTx9JRBBvSsXSw.png"/></div></figure><p id="a712" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这段代码将从雅虎财经中提取2001年1月到2019年9月的数据。您可以调整代码，从不同的时间戳中提取数据。</p><p id="9032" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">下面简单的代码将取股票的高低百分比和开盘价-收盘价百分比。当我们预测股票时，这是不必要的，它只是帮助我们进行可视化。</p><pre class="iy iz ja jb fd lf lg lh li aw lj bi"><span id="aaa5" class="kf kg hi lg b fi lk ll l lm ln">df['HighLow_PCT']= (df['High'] - df['Low']) / df['Close'] * 100<br/>df['PCT_CHANGE'] = (df['Close'] - df['Open']) / df['Open'] * 100</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lq"><img src="../Images/2fe8886a0ee7ee283e113f0e71377706.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZpVC7B3bMSnI5buAtObTQA.png"/></div></div></figure><h2 id="bf20" class="kf kg hi bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz bi translated">如何利用这些数据进行预测？</h2><p id="a5cd" class="pw-post-body-paragraph jj jk hi jl b jm la ij jo jp lb im jr js lc ju jv jw ld jy jz ka le kc kd ke hb bi translated">所以我们知道，我们需要一些带标签的训练数据来训练我们的模型。但是，如果我们使用这些高、低、开、收盘价格作为训练，并希望预测每天的“Adj Close ”,会发生什么呢？如果我们使用这些数据来训练，那么我们将无法预测未来数据的模型，因为我们没有未来时间戳的任何这些值。</p><p id="5c00" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">那么这个问题的解决方法是什么呢？</p><p id="cc3f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们可以将该问题视为时间序列问题，并且只有一个特征“Adj Close”将用于模型的训练和模型的预测。</p><pre class="iy iz ja jb fd lf lg lh li aw lj bi"><span id="74f6" class="kf kg hi lg b fi lk ll l lm ln">window_size = 32 <em class="lr">#</em></span><span id="20e3" class="kf kg hi lg b fi lo ll l lm ln">num_samples = len(df) - window_size<br/>indices = np.arange(num_samples).astype(np.int)[:,<strong class="lg hj">None</strong>] + np.arange(window_size + 1).astype(np.int)<br/>data = df['Adj Close'].values[indices]</span></pre><p id="d6c4" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们以这样一种方式准备数据，我们有32天的窗口，并预测第二天的股票价格。</p><p id="9327" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在预处理并将数据分成训练和测试之后，我们将尝试机器学习模型。</p><h1 id="1d67" class="ls kg hi bd kh lt lu lv kl lw lx ly kp io lz ip ks ir ma is kv iu mb iv ky mc bi translated">1)岭回归。</h1><p id="2af9" class="pw-post-body-paragraph jj jk hi jl b jm la ij jo jp lb im jr js lc ju jv jw ld jy jz ka le kc kd ke hb bi translated"><code class="du md me mf lg b"><a class="ae mg" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Ridge.html#sklearn.linear_model.Ridge" rel="noopener ugc nofollow" target="_blank"><strong class="jl hj">Ridge</strong></a></code>回归将L2惩罚添加到<a class="ae mg" href="https://scikit-learn.org/stable/modules/linear_model.html#ordinary-least-squares" rel="noopener ugc nofollow" target="_blank">普通最小二乘法</a>中，防止模型过度拟合。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mh"><img src="../Images/f3638734ab521790087f5dbf24e0702c.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*8w40vxd4vpB0sOxnC7qptA.png"/></div></figure><p id="5895" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">为了简单起见，我们不调整任何超参数。下面的简单代码为数据集构建岭回归。</p><pre class="iy iz ja jb fd lf lg lh li aw lj bi"><span id="6ff8" class="kf kg hi lg b fi lk ll l lm ln">ridge_model = Ridge()<br/>ridge_model.fit(X_train, y_train)</span><span id="38c1" class="kf kg hi lg b fi lo ll l lm ln"><em class="lr"># Infer</em><br/>y_pred_ridge = ridge_model.predict(X_test)</span></pre><p id="e2bd" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">从下面我们可以看到，岭模型对于股票数据非常有效，因为它可以识别数据的趋势。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/dfabcc9eb6c8afb009db7636fa00082f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_4lrfr0ffaxvHwQ_RqfSug.png"/></div></div></figure><h1 id="6ff4" class="ls kg hi bd kh lt lu lv kl lw lx ly kp io lz ip ks ir ma is kv iu mb iv ky mc bi translated">2)梯度推进树</h1><p id="55b3" class="pw-post-body-paragraph jj jk hi jl b jm la ij jo jp lb im jr js lc ju jv jw ld jy jz ka le kc kd ke hb bi translated">GBM是一种以弱预测模型的<a class="ae mg" href="https://en.wikipedia.org/wiki/Ensemble_learning" rel="noopener ugc nofollow" target="_blank">集合</a>的形式产生预测模型的技术，通常是决策树。下面的代码为我们的数据创建了GBM模型。</p><pre class="iy iz ja jb fd lf lg lh li aw lj bi"><span id="36eb" class="kf kg hi lg b fi lk ll l lm ln"><strong class="lg hj">from</strong> <strong class="lg hj">sklearn.ensemble</strong> <strong class="lg hj">import</strong> RandomForestRegressor<br/>rf_model = RandomForestRegressor()<br/>rf_model.fit(X_train,y_train)</span><span id="0b64" class="kf kg hi lg b fi lo ll l lm ln">y_pred_rf = rf_model.predict(X_test)</span></pre><p id="599b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">从下图可以看出，我们的模型拟合不足，无法正确预测数据，当然可以通过使用适当的超参数进行改进。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/28377f39a15e0a2f3275b1afb2ce635a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uo6IoGOONuTaL4U3VX4g2w.png"/></div></div></figure><h1 id="86dd" class="ls kg hi bd kh lt lu lv kl lw lx ly kp io lz ip ks ir ma is kv iu mb iv ky mc bi translated">3)随机森林回归量</h1><p id="a84e" class="pw-post-body-paragraph jj jk hi jl b jm la ij jo jp lb im jr js lc ju jv jw ld jy jz ka le kc kd ke hb bi translated"><strong class="jl hj">随机森林</strong>是一种<a class="ae mg" href="https://en.wikipedia.org/wiki/Ensemble_learning" rel="noopener ugc nofollow" target="_blank">集成学习</a>方法，通过在训练时构建大量的<a class="ae mg" href="https://en.wikipedia.org/wiki/Decision_tree_learning" rel="noopener ugc nofollow" target="_blank">决策树</a>并输出类，即类(分类)或个体树的均值预测(回归)的<a class="ae mg" href="https://en.wikipedia.org/wiki/Mode_(statistics)" rel="noopener ugc nofollow" target="_blank">模式</a>。随机森林纠正了决策树过度适应的习惯。</p><p id="8236" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">从下面的图表中我们可以看到，它并没有很好地处理这些数据。当然，我们可以调整超参数以获得更好的结果。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/8846ce0290946467d26ca50137feeb2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lVBbcW789_2_9P4n7FkbYg.png"/></div></div><figcaption class="mj mk et er es ml mm bd b be z dx translated">随机森林预测与实际</figcaption></figure><h1 id="f85a" class="ls kg hi bd kh lt lu lv kl lw lx ly kp io lz ip ks ir ma is kv iu mb iv ky mc bi translated">4)回归神经网络</h1><p id="327a" class="pw-post-body-paragraph jj jk hi jl b jm la ij jo jp lb im jr js lc ju jv jw ld jy jz ka le kc kd ke hb bi translated">股票价格是时间序列问题，当涉及到解决时间序列问题时，神经网络通常工作得更好。下面的代码将使用Keras构建一个基本的神经网络来预测价格。</p><pre class="iy iz ja jb fd lf lg lh li aw lj bi"><span id="7009" class="kf kg hi lg b fi lk ll l lm ln"><strong class="lg hj">from</strong> <strong class="lg hj">keras</strong> <strong class="lg hj">import</strong> Sequential<br/><strong class="lg hj">from</strong> <strong class="lg hj">keras.layers</strong> <strong class="lg hj">import</strong> Dense,Dropout<br/><strong class="lg hj">def</strong> build_regressor():<br/>    regressor = Sequential()<br/>    regressor.add(Dense(units=128, input_dim=32))<br/>    regressor.add(Dense(units=64))<br/>    regressor.add(Dense(units=32))<br/>    regressor.add(Dense(units=16))<br/>    regressor.add(Dense(units=8))<br/>    regressor.add(Dense(units=1))<br/>    regressor.compile(optimizer='adam', loss='mean_squared_error',)<br/>    <strong class="lg hj">return</strong> regressor<br/><strong class="lg hj">from</strong> <strong class="lg hj">keras.wrappers.scikit_learn</strong> <strong class="lg hj">import</strong> KerasRegressor<br/>regressor = KerasRegressor(build_fn=build_regressor, batch_size=1024,epochs=1000)</span></pre><p id="4131" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们使用sklearn Keras包装器，因为Keras不能直接用作回归变量。下图显示了实际价格与预测价格的对比，表明我们的模型可以预测价格的趋势。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/f869259929ac148289f01e7a6b3e90af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oaZXPIeeJJ7Brf2Bed8UNQ.png"/></div></div></figure><p id="f839" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">本文的代码可以在<a class="ae mg" href="https://github.com/isapansoni/stock-prediction" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p><h1 id="1344" class="ls kg hi bd kh lt lu lv kl lw lx ly kp io lz ip ks ir ma is kv iu mb iv ky mc bi translated">结论</h1><ol class=""><li id="974d" class="mn mo hi jl b jm la jp lb js mp jw mq ka mr ke ms mt mu mv bi translated">我们可以尝试LSTM，而不是完全连接的神经网络，因为LSTM在时间序列数据上工作得更好。</li><li id="4bc7" class="mn mo hi jl b jm mw jp mx js my jw mz ka na ke ms mt mu mv bi translated">我们可以对所有模型进行超参数调整，以获得更好的结果</li><li id="7fdd" class="mn mo hi jl b jm mw jp mx js my jw mz ka na ke ms mt mu mv bi translated">我们可以进行情感分析，并将其作为预测价格的一个特征</li></ol><p id="4abc" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如果你想联系我，请用我的<a class="ae mg" href="https://www.linkedin.com/in/isapansoni/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我</p><p id="ba52" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">感谢您阅读帖子。</p></div></div>    
</body>
</html>