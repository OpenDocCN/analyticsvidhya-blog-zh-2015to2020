<html>
<head>
<title>Why to Optimize with Momentum</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么要用动量优化</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/why-use-the-momentum-optimizer-with-minimal-code-example-8f5d93c33a53?source=collection_archive---------2-----------------------#2019-10-06">https://medium.com/analytics-vidhya/why-use-the-momentum-optimizer-with-minimal-code-example-8f5d93c33a53?source=collection_archive---------2-----------------------#2019-10-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ee70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我们将解释什么是动量，以及为什么动量是对随机梯度下降的一个简单而容易的改进。我们还在MNIST数据集上展示了一个最小的代码示例，其中添加动量提高了模型的准确性和训练损失。</p><h1 id="81ce" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">1.指数平滑(或指数加权平均值)</h1><p id="fc5b" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">当查看有噪声的时间序列数据时，例如tensorboard中的训练/验证误差图，您可能会经常注意到原始值通常非常有噪声。通常，你可以在图表中看到一个趋势。当您对原始图形值进行一些平滑处理时，这些趋势通常会变得更加明显。</p><p id="3623" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">指数平滑是向数据添加平滑的最简单方法之一。</p><p id="3ac6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">指数平滑公式:</strong></p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/21844647dc9cdf1e458e51ee8d10ab20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5BnpVU2wsD0CcSVaMYeP2A.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">图1:指数平滑</figcaption></figure><p id="16ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的等式中，动量指定了我们想要的平滑量。动量的典型值是0.9。从这个等式中，我们可以看到时间步长t处的值考虑了时间步长(t-1)和之前的先前值。先前时间步长的权重呈指数下降，因此最近的时间步长影响最大。</p><h1 id="359c" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">2.动量优化器</h1><p id="0deb" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">动量优化器在优化损失函数时使用相同的等式。在这种情况下，指数平滑被称为动量，它允许优化程序保持以前时间步长的速度和轨迹，以影响当前时间步长。</p><pre class="kh ki kj kk fd kw kx ky kz aw la bi"><span id="60c4" class="lb je hi kx b fi lc ld l le lf">from __future__ import absolute_import, division, print_function, unicode_literals<br/># Install Tensorflow<br/>import tensorflow as tf</span><span id="0766" class="lb je hi kx b fi lg ld l le lf">mnist = tf.keras.datasets.mnist</span><span id="d8ad" class="lb je hi kx b fi lg ld l le lf">(x_train, y_train), (x_test, y_test) = mnist.load_data()<br/>x_train, x_test = x_train / 255.0, x_test / 255.0</span></pre><h1 id="56f5" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">没有动量的例子</h1><p id="0cb3" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">从上面的图表中，我们可以看到，在第一个历元之后，训练损失达到. 4。经过5个历元后，准确率达到94%左右。这个结果提供了一个基线结果，我们可以用它来比较增加动量对随机梯度下降的影响。</p><pre class="kh ki kj kk fd kw kx ky kz aw la bi"><span id="4f3e" class="lb je hi kx b fi lc ld l le lf">import matplotlib.pyplot as plt</span><span id="2159" class="lb je hi kx b fi lg ld l le lf">model = tf.keras.models.Sequential([<br/>    tf.keras.layers.Flatten(input_shape=(28, 28)),<br/>    tf.keras.layers.Dense(128, activation='relu'),<br/>    tf.keras.layers.Dropout(0.2),<br/>    tf.keras.layers.Dense(10, activation='softmax')<br/>])</span><span id="1368" class="lb je hi kx b fi lg ld l le lf">sgd = tf.keras.optimizers.SGD(lr=0.01, decay=1e-6, momentum=0.0, nesterov=True)<br/>model.compile(optimizer=sgd,<br/>              loss='sparse_categorical_crossentropy',<br/>              metrics=['accuracy'])</span><span id="cc6c" class="lb je hi kx b fi lg ld l le lf">history = model.fit(x_train, y_train, epochs=5)<br/>model.evaluate(x_test, y_test, verbose=2)</span><span id="f7d8" class="lb je hi kx b fi lg ld l le lf"># Plot training &amp; validation accuracy values<br/>plt.plot(history.history['acc'])<br/>plt.title('Model accuracy')<br/>plt.ylabel('Accuracy')<br/>plt.xlabel('Epoch')<br/>plt.legend(['Train', 'Test'], loc='upper left')<br/>plt.show()</span><span id="a8b6" class="lb je hi kx b fi lg ld l le lf"># Plot training &amp; validation loss values<br/>plt.plot(history.history['loss'])<br/>plt.title('Model loss')<br/>plt.ylabel('Loss')<br/>plt.xlabel('Epoch')<br/>plt.legend(['Train', 'Test'], loc='upper left')<br/>plt.show()</span></pre><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lh"><img src="../Images/f43d6e4f1367fa168ab4e457ae787b38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CUU68jYVttMrqeZvrm7vvg.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">图2:没有动量的训练损失曲线</figcaption></figure><h1 id="d9f9" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">有动量的例子</h1><p id="3379" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">在一个时期之后，优化器能够达到大约0.17的损失。5个时期后的最终准确度约为97%。从这个实验可以看出，动量优化器在这个问题中优化模型的速度更快，效果更好。这个实验是一种快速的方法，可以看出动量是一种改进标准随机梯度下降的简单而快速的方法，用于优化神经网络模型。</p><pre class="kh ki kj kk fd kw kx ky kz aw la bi"><span id="a5ec" class="lb je hi kx b fi lc ld l le lf">import matplotlib.pyplot as plt</span><span id="99f7" class="lb je hi kx b fi lg ld l le lf">model = tf.keras.models.Sequential([<br/>    tf.keras.layers.Flatten(input_shape=(28, 28)),<br/>    tf.keras.layers.Dense(128, activation='relu'),<br/>    tf.keras.layers.Dropout(0.2),<br/>    tf.keras.layers.Dense(10, activation='softmax')<br/>])</span><span id="d940" class="lb je hi kx b fi lg ld l le lf">sgd = tf.keras.optimizers.SGD(lr=0.01, decay=1e-6, momentum=0.9, nesterov=True)<br/>model.compile(optimizer=sgd,<br/>              loss='sparse_categorical_crossentropy',<br/>              metrics=['accuracy'])</span><span id="d7f6" class="lb je hi kx b fi lg ld l le lf">history = model.fit(x_train, y_train, epochs=5)<br/>model.evaluate(x_test, y_test, verbose=2)</span><span id="4ed8" class="lb je hi kx b fi lg ld l le lf"># Plot training &amp; validation accuracy values<br/>plt.plot(history.history['acc'])<br/>plt.title('Model accuracy')<br/>plt.ylabel('Accuracy')<br/>plt.xlabel('Epoch')<br/>plt.legend(['Train', 'Test'], loc='upper left')<br/>plt.show()</span><span id="dc54" class="lb je hi kx b fi lg ld l le lf"># Plot training &amp; validation loss values<br/>plt.plot(history.history['loss'])<br/>plt.title('Model loss')<br/>plt.ylabel('Loss')<br/>plt.xlabel('Epoch')<br/>plt.legend(['Train', 'Test'], loc='upper left')<br/>plt.show()</span></pre><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es li"><img src="../Images/2caf62846a9b31ec38d5ffe4456a7b5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rvZN9ob4jJ5Y5g_dWKkMvg.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">图3:带动量的训练损失曲线</figcaption></figure><h1 id="d4ce" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">结论</h1><p id="3906" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">在这篇文章中，我们解释了什么是动量，以及为什么它是对随机梯度下降的简单改进。我们还给出一个最小的代码示例，展示动量如何在深度学习模型中提高准确性和训练损失。</p><h1 id="6063" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">资源</h1><p id="5d3b" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated"><a class="ae lj" href="https://www.tensorflow.org/tutorials/quickstart/beginner" rel="noopener ugc nofollow" target="_blank"> Tensorflow初学者快速入门</a></p></div></div>    
</body>
</html>