<html>
<head>
<title>Spark Hierarchy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">火花等级</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/spark-hierarchy-953c1eb56a81?source=collection_archive---------5-----------------------#2019-12-24">https://medium.com/analytics-vidhya/spark-hierarchy-953c1eb56a81?source=collection_archive---------5-----------------------#2019-12-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c030" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文将让您对大数据和Spark世界中使用的术语有一个基本的了解。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/a30c37fc4b31b6a07a269f825c10e3b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W0-aMNg-g0VHYCXXZiAXjQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Spark硬件层次结构</figcaption></figure><p id="23ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">硬件层级</strong></p><p id="5eb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">集群</strong>:</p><ol class=""><li id="eed9" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">驾驶员</li><li id="2489" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated"><strong class="ih hj">执行者</strong></li></ol><ul class=""><li id="67b3" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc kh jz ka kb bi translated">核心/插槽——每个执行器都可以被视为服务器，它们都有核心。核心可以被视为一个插槽，用于放置工作负载。每个内核可以处理一个工作。</li></ul><p id="58d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">记忆</strong></p><p id="afb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个服务器也有内存。但并不是所有的都给了Spark。平均90%的内存都给了Spark。<br/>在高层次上，这种记忆分为储存记忆和工作记忆。</p><blockquote class="ki kj kk"><p id="0975" class="if ig kl ih b ii ij ik il im in io ip km ir is it kn iv iw ix ko iz ja jb jc hb bi translated">存储内存是缓存或保存数据的地方。</p><p id="c456" class="if ig kl ih b ii ij ik il im in io ip km ir is it kn iv iw ix ko iz ja jb jc hb bi translated">工作内存是Spark进行所有内存计算的地方</p></blockquote><p id="7840" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">存储内存</strong></p><ul class=""><li id="2b14" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc kh jz ka kb bi translated">存储持久化对象</li><li id="d48e" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc kh jz ka kb bi translated">默认配置限制—总存储的50%</li></ul><p id="d122" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">工作记忆</strong></p><ul class=""><li id="f2a7" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc kh jz ka kb bi translated">将由spark工作负载使用</li><li id="6701" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc kh jz ka kb bi translated">总存储的50%将用于spark工作负载</li></ul><p id="558e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">磁盘</strong></p><p id="8480" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每台服务器还具有本地连接/装载的存储。</p><ul class=""><li id="2a78" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc kh jz ka kb bi translated">内存/固态硬盘/NFS硬盘</li><li id="2ffa" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc kh jz ka kb bi translated">更好的磁盘将确保数据的快速洗牌</li></ul><p id="0410" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些磁盘非常重要，因为-很多时候，Spark会进行<em class="kl">洗牌(数据四处移动)。在中间阶段，当数据四处移动时，这些数据会进入磁盘。磁盘越快，洗牌越快。</em></p><blockquote class="ki kj kk"><p id="94a7" class="if ig kl ih b ii ij ik il im in io ip km ir is it kn iv iw ix ko iz ja jb jc hb bi translated">要了解更多关于Spark内存管理的信息，请参考这篇<a class="ae kp" rel="noopener" href="/@tharun026/spark-memory-management-583a16c1253f">文章。</a></p></blockquote><p id="b60f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">软件层级</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kq"><img src="../Images/b3f939e7f0fd2c031847a6f7e9c17b48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*S7pqR2wM__UdH_denCv80Q.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Spark软件层次结构</figcaption></figure><p id="91c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">转变</strong>(懒惰):</p><ul class=""><li id="598e" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc kh jz ka kb bi translated">窄(转换所需的所有数据同时可供CPU使用)</li><li id="bfaa" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc kh jz ka kb bi translated">宽(数据需要在节点间移动)(需要随机移动)</li></ul><p id="f62b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">动作</strong></p><p id="3b60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们调用一个操作时，我们剥离了spark已经进行的所有转换。操作根据转换启动一个或多个作业。</p><ul class=""><li id="f659" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc kh jz ka kb bi translated">作业<br/> —一个作业可以有多个阶段。</li><li id="51c0" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc kh jz ka kb bi translated">阶段<br/> —这是将要完成的一部分工作。<br/> — 1个阶段可以有很多任务。</li><li id="a04b" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc kh jz ka kb bi translated">作业和阶段是编排的一部分</li><li id="d5ae" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc kh jz ka kb bi translated">任务(直接与硬件交互)</li><li id="812d" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc kh jz ka kb bi translated">一个阶段中的每个任务都做同样的事情，只是在另一个数据段上。</li><li id="e3d6" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc kh jz ka kb bi translated">如果一个任务需要做一些不同的事情，它需要在另一个阶段的内部。</li><li id="b7c5" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc kh jz ka kb bi translated">一个任务由一个内核在一个分区上完成。</li></ul><p id="48da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">洗牌</strong></p><p id="fb4f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每当Spark无法在单个分区上执行任务，或者需要来自其他分区的数据进行计算时，就会发生洗牌。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kr"><img src="../Images/2f387a5ecb93ac5be4467298ca776beb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L209XarTN7CC3grRup4dWw.png"/></div></div></figure><p id="dc40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上图中，我们在3个分区中有3个名字，我们试图得到每个第一个字符的名字的数量。获取每个名称的第一个字符可以独立完成。但是groupBy任务要求所有的A都在一个分区中，因此需要Shuffle。Shuffle将所有的A收集到一个分区中，然后计算每个第一个字符的名字。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ks"><img src="../Images/6b65e929045c3d59a2de39b45a51ade2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3PNoFwiuV606cmbgENCOyw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">洗牌</figcaption></figure><p id="cb57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在混洗过程中，每个分区的数据都根据哈希键写入磁盘。在这种情况下，阶段1根据第一个字符将数据写入磁盘。阶段2从磁盘中提取数据并获取计数。</p><p id="41ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">火花数据读取速度</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kt"><img src="../Images/dd066c75e6cb1c887c53de1dd0cde894.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XLJebpOWmgtxWjNWHzB9RA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">火花数据读取速度</figcaption></figure><p id="2795" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Spark快得惊人的一个主要原因是它在内存中完成所有的处理。Spark大量利用内存，因为CPU可以以10 GB/s的速度从内存中读取数据。然而，如果Spark从内存磁盘中读取数据，速度将降至约100 MB/s，SSD读取将在600 MB/s的范围内。</p><p id="81cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果CPU必须通过网络读取数据，速度将下降到大约125 MB/s。</p><p id="5125" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望现在您能够理解Spark中的基本术语。如果你想了解Spark在每个执行器中是如何利用内存的，可以参考这篇<a class="ae kp" rel="noopener" href="/@tharun026/spark-memory-management-583a16c1253f"> <em class="kl">文章</em> </a> <em class="kl">。<br/> </em>如果想进高级星火，参考这篇<a class="ae kp" rel="noopener" href="/analytics-vidhya/understanding-resource-allocation-configurations-for-a-spark-application-9c1307e6b5e3"> <em class="kl">文章</em> </a>。</p></div></div>    
</body>
</html>