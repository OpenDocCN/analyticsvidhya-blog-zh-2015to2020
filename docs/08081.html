<html>
<head>
<title>Predicting Customer Churn using Spark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Spark预测客户流失</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/predicting-customer-churn-using-spark-cb14e1ffe00b?source=collection_archive---------27-----------------------#2020-07-16">https://medium.com/analytics-vidhya/predicting-customer-churn-using-spark-cb14e1ffe00b?source=collection_archive---------27-----------------------#2020-07-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="964d" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated"><strong class="il hj">火花</strong>分析；音乐流媒体平台</p></blockquote><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jh"><img src="../Images/c965e8a9fcfdc29e7b58fdf2115984bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4a9lufUa-P3pUdRY.png"/></div></div></figure><p id="d86e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated"><strong class="il hj"> Sparkify </strong>是一个虚拟的音乐流媒体平台，在这个项目中，我在<strong class="il hj"> IBM Cloud </strong>上使用了<strong class="il hj"> Apache Spark </strong>，分析了该平台两个月的数据，以建立一个机器学习模型来帮助预测客户流失。</p><p id="5f70" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated"><strong class="il hj"> Spark </strong>是一个针对大数据和机器学习的闪电般快速的统一分析引擎。当处理非常大的数据集时，在<strong class="il hj"> Spark </strong>上运行分析非常有效。<strong class="il hj"> Spark </strong>利用集群计算的计算(分析)能力和存储能力。这意味着它可以使用连接在一起的许多计算机处理器的资源进行分析。</p><h1 id="7da2" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">问题陈述</h1><p id="631e" class="pw-post-body-paragraph ii ij hi il b im ku io ip iq kv is it jt kw iw ix ju kx ja jb jv ky je jf jg hb bi translated">在这个项目中，我试图建立一个机器学习模型，帮助预测<strong class="il hj"> Sparkify的客户流失。</strong>该模型如果有效，将有助于确定有流失风险的客户，并针对这些客户群进行有针对性的营销，以防止他们流失，从而为公司节省大量资金。</p><h1 id="11cc" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated"><strong class="ak">数据理解</strong></h1><p id="5252" class="pw-post-body-paragraph ii ij hi il b im ku io ip iq kv is it jt kw iw ix ju kx ja jb jv ky je jf jg hb bi translated"><strong class="il hj"> Sparkify </strong>数据由<strong class="il hj"> 286，500 </strong>行和<strong class="il hj"> 18 </strong>列组成，跨越<strong class="il hj"> 2 </strong>个月；2018年9月至10月。</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div class="er es kz"><img src="../Images/986b274b21847c9555e7d6a63d267bee.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*JN1Kbd4_cYa3Ds1qVkvPqA.png"/></div><figcaption class="la lb et er es lc ld bd b be z dx translated">火花数据的维度</figcaption></figure><p id="b56b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated">不同的列包含用户活动的数据，如<strong class="il hj">艺术家</strong>、<strong class="il hj">是否登录的状态</strong>、<strong class="il hj">名字</strong>、<strong class="il hj">性别</strong>、<strong class="il hj">级别</strong>(付费或免费账户)、<strong class="il hj">位置</strong>、<strong class="il hj">每次会话在应用上花费的时间长度</strong>等。</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es le"><img src="../Images/6bbea679248ab6dd669ed0af58a790d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WFENH1whGgFjEv-DHq5RpQ.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">数据样本快照</figcaption></figure><p id="107b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated">下图说明了<strong class="il hj"> Sparkify </strong>数据集中各列之间的关系。</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es lf"><img src="../Images/b000b6e740f3ebc620bc720cf1eb1997.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qXsqin_Av3U4jKZm.png"/></div></div></figure><h1 id="482e" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">数据处理</h1><p id="1921" class="pw-post-body-paragraph ii ij hi il b im ku io ip iq kv is it jt kw iw ix ju kx ja jb jv ky je jf jg hb bi translated"><strong class="il hj"> Sparkify </strong>数据相对干净，只有<strong class="il hj"> userID </strong>列有实际丢失的数据。这些丢失的数据点指的是访问流媒体网站而没有实际登录的实际用户，或者只是浏览网站的未订阅用户，因此没有为这些交互捕获用户信息。通过扩展列捕获个人信息，如<strong class="il hj">名</strong>、<strong class="il hj">姓</strong>、<strong class="il hj">性别</strong>等。对于这些数据点也是缺失的。</p><p id="d1c8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated">我们还缺少像<strong class="il hj">艺术家</strong>、<strong class="il hj">歌曲播放时长</strong>和<strong class="il hj">歌名</strong>等栏目的数据。对于用户不主动听歌的交互，这些列是空的。</p><p id="f412" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated">我们将删除缺少userID的行，因为我们只关心现有用户的流失。丢失歌曲数据决不是交易的破坏者，因为在人们不听歌曲的所有情况下，我们不会期望得到任何与歌曲相关的信息。</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es lg"><img src="../Images/5427ffd7d4300a679bbbefa74839f1e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nui3A_2BgiDqMJ6Aqx6kPQ.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">显示缺少数据的列</figcaption></figure><figure class="ji jj jk jl fd jm er es paragraph-image"><div class="er es lh"><img src="../Images/fee54a93a2485ba1c9830bb18312769d.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*wuwWi-LfTNmsAHikbkA-EQ.png"/></div><figcaption class="la lb et er es lc ld bd b be z dx translated">删除缺失数据后火花数据的维度</figcaption></figure><h1 id="7989" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">探索性数据分析</h1><p id="4b58" class="pw-post-body-paragraph ii ij hi il b im ku io ip iq kv is it jt kw iw ix ju kx ja jb jv ky je jf jg hb bi translated">在仔细检查数据后，我发现<strong class="il hj"> Sparkify </strong>有225个独立用户，平均每个用户在2个月的时间里有大约1236次互动。</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es li"><img src="../Images/7e44732ba0bc42c40c915fb2a2ff7c3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_FesUL7kaToTScJwDuFcMQ.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">唯一用户的数量</figcaption></figure><p id="0b08" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated">此外，大多数用户的总交互次数低于2500次，少数用户高达9000次。</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es lj"><img src="../Images/2f599a65080b8c6525438a468d83f507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qwy1ddk_mFGYHzjabCcm3Q.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">互动次数</figcaption></figure><p id="deb2" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated"><strong class="il hj">定义流失</strong></p><p id="ec6a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated">当名为<strong class="il hj">取消确认</strong>的事件出现在活动日志中时，用户感到不适。这个事件发生在付费和免费用户身上。</p><p id="5ae4" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated">让我们探索我们的列和我们的目标变量<strong class="il hj"> churn之间的关系。</strong></p><p id="ea2c" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated"><strong class="il hj">按性别划分的人员变动</strong></p><figure class="ji jj jk jl fd jm er es paragraph-image"><div class="er es lk"><img src="../Images/d2c0a18ca3990d961898616767038224.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*SlKzAyDhzXLPDC6zcZyCNQ.png"/></div><figcaption class="la lb et er es lc ld bd b be z dx translated">1表示用户搅动，0表示用户没有搅动</figcaption></figure><p id="5e09" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated">从上图中我们可以看到，使用<strong class="il hj"> Sparkify的男性用户多于女性。</strong>男性和女性在这两个类别中的分布(搅拌过的用户=1，没有搅拌过的用户=0)相似。</p><p id="89f8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated"><strong class="il hj">按级别流失</strong></p><figure class="ji jj jk jl fd jm er es paragraph-image"><div class="er es lk"><img src="../Images/c3d0c187eaca2050aac6bec77cc2d07d.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*Rl3y2qMsrVW9G3PDlQ5URQ.png"/></div><figcaption class="la lb et er es lc ld bd b be z dx translated">按级别变动</figcaption></figure><p id="7b1a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated">从上图我们可以看到，付费计划的用户比免费计划的用户更容易流失。</p><h1 id="84bd" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">特征工程</h1><p id="ff27" class="pw-post-body-paragraph ii ij hi il b im ku io ip iq kv is it jt kw iw ix ju kx ja jb jv ky je jf jg hb bi translated">以下特征用于建立预测模型；<strong class="il hj"> <em class="ik">自注册以来的时间</em>，<em class="ik">听的歌曲总数</em>，<em class="ik">竖起/放下大拇指的次数</em>，<em class="ik">添加到播放列表的歌曲数</em>，<em class="ik">添加的好友数</em>，<em class="ik">总听时长</em>，<em class="ik">每期听的歌曲数</em>，<em class="ik">性别</em> </strong>和<strong class="il hj"> <em class="ik">听的艺人数【T44</em></strong>这些特征被合并到目标变量<strong class="il hj"> churn中。</strong></p><p id="1547" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated">接下来，我矢量化，随后使用最小最大缩放器缩放特征。然后，数据被分成训练集、测试集和验证集。</p><h1 id="d92a" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">型号选择</h1><p id="6db1" class="pw-post-body-paragraph ii ij hi il b im ku io ip iq kv is it jt kw iw ix ju kx ja jb jv ky je jf jg hb bi translated">没有搅动的用户比例是搅动过的用户比例的三倍多，因此我们有一个不平衡的数据集。原则上，我们可以通过对大量用户进行过采样来解决这个问题，但特别是在大数据的情况下，这种方法可能会有问题。</p><p id="3a55" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated">相反，我们可以通过相应地选择度量来解决这个问题。对于不平衡的类别，准确性将是一个糟糕的选择，但如果我们转而追求F1分数，我们应该能够获得一个好的模型。</p><p id="7a21" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated"><strong class="il hj"> Logistic回归</strong>、<strong class="il hj">梯度推进树</strong>、<strong class="il hj">支持向量机</strong>和<strong class="il hj">随机森林</strong>模型利用交叉验证对数据进行训练，选择出<strong class="il hj"> f1 </strong> <strong class="il hj">得分</strong>最好的模型。</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es ll"><img src="../Images/aa51a5cd2779c05b99abd01ff684fd49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qkqddPLZK4v6CKjlhEKw8A.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">逻辑回归模型结果</figcaption></figure><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es lm"><img src="../Images/d55762ba2b578833a9b6746e31c9d14b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wLZ0IfCCia6z4G_soUFT2A.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">梯度推进模型结果</figcaption></figure><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es ln"><img src="../Images/78f64152ab5861525f6046f7f2092c72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2nTMEp309B_zQsXfpqGnsQ.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">支持向量机结果</figcaption></figure><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es lo"><img src="../Images/3128915425728ce35556c9d4601f67ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ezwNOSVSYUmuI6IpRsw1bQ.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">随机森林模型结果</figcaption></figure><p id="2225" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated">从上面的结果来看，<strong class="il hj">逻辑回归</strong>和<strong class="il hj">支持向量</strong>模型都有最高的<strong class="il hj"> f1分</strong>为<strong class="il hj"> 0.8 </strong>，但我选择了<strong class="il hj">逻辑回归</strong>模型，因为它的精度稍高，训练时间也较短。</p><h1 id="1b41" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated"><strong class="ak">结论</strong></h1><p id="e702" class="pw-post-body-paragraph ii ij hi il b im ku io ip iq kv is it jt kw iw ix ju kx ja jb jv ky je jf jg hb bi translated">我们最终的<strong class="il hj">逻辑回归</strong>模型的f1值为0.8，这对于我们的最终目标来说已经足够好了。我尝试用超参数调整来优化这个模型，但是这个模型几乎没有改进。</p><p id="439d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated">我们可以进一步改进该模型的方法包括:</p><ul class=""><li id="caf7" class="lp lq hi il b im in iq ir jt lr ju ls jv lt jg lu lv lw lx bi translated">寻找要创建的其他变量，例如从用户代理列中提取用户的操作系统，可能有助于改善结果。</li><li id="6e6a" class="lp lq hi il b im ly iq lz jt ma ju mb jv mc jg lu lv lw lx bi translated">在更长的时间内收集数据。</li><li id="9076" class="lp lq hi il b im ly iq lz jt ma ju mb jv mc jg lu lv lw lx bi translated">对从付费服务降级到免费服务的用户的单独分析也可能提供额外的有趣见解。</li></ul><blockquote class="if ig ih"><p id="68e8" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated"><em class="hi">这个项目的Github库可以在</em> <a class="ae md" href="https://github.com/ObinnaIheanachor/Predicting-Customer-Churn-using-Spark" rel="noopener ugc nofollow" target="_blank"> <em class="hi">这里</em> </a>找到</p></blockquote><h1 id="6f93" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">关于作者</h1><p id="216f" class="pw-post-body-paragraph ii ij hi il b im ku io ip iq kv is it jt kw iw ix ju kx ja jb jv ky je jf jg hb bi translated"><strong class="il hj"> Obinna Iheanachor </strong>是一名创新型数据专家，拥有丰富的分析经验，并成功处理大量数据集来分解信息、收集相关见解和解决高级业务问题。<em class="ik">你会在数据分析、科学和艺术的交汇处找到他</em>。</p><p id="457f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jt iv iw ix ju iz ja jb jv jd je jf jg hb bi translated">你可以在<a class="ae md" href="https://www.linkedin.com/in/obinnaiheanachor/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae md" href="https://twitter.com/DatascientistOb" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上和我联系。</p></div></div>    
</body>
</html>