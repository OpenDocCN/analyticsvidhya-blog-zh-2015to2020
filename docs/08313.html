<html>
<head>
<title>Building A Whatsapp Chatbot With Python ChatterBot + Flask+ Ngrok+Twilio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python chatter bot+Flask+Ngrok+Twilio构建Whatsapp聊天机器人</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/building-a-whatsapp-chatbot-with-python-chatterbot-flask-ngrok-twilio-877e29e7511f?source=collection_archive---------2-----------------------#2020-07-25">https://medium.com/analytics-vidhya/building-a-whatsapp-chatbot-with-python-chatterbot-flask-ngrok-twilio-877e29e7511f?source=collection_archive---------2-----------------------#2020-07-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6e7ad0a536fb61e14476664cd18a2316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AWQoAnkzJ5od2qnrsWgOiQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片来源:shutterstock.com 409765726</figcaption></figure><p id="b6ce" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在下面的录音中，我在我的Google Dialogflow聊天机器人和我创建的另一个新机器人之间建立了一个对话。超现实的欢乐接踵而至…</p><figure class="js jt ju jv fd ij"><div class="bz dy l di"><div class="jw jx l"/></div></figure></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="b316" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">走一遍…</h1><figure class="js jt ju jv fd ij"><div class="bz dy l di"><div class="jw jx l"/></div></figure></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="fde2" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">说话机器人计算机程序</h1><h2 id="f987" class="ld kg hi bd kh le lf lg kl lh li lj kp jf lk ll kt jj lm ln kx jn lo lp lb lq bi translated">聊天机器人</h2><p id="5aa4" class="pw-post-body-paragraph iu iv hi iw b ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn lv jp jq jr hb bi translated">我在互联网上做了一些快速浏览，有很多基于神经网络的技术来创建聊天机器人。</p><p id="735f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然而，我想从小处着手，因为我的目标是学习如何创建一个“简单”的机器人，可以快速部署到Whatsapp的外部，所以我不想浪费超参数设置和等待时间来训练神经网络模型。</p><div class="lw lx ez fb ly lz"><a href="https://github.com/gunthercox/ChatterBot" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hj fi z dy me ea eb mf ed ef hh bi translated">冈瑟考克斯/聊天机器人</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">ChatterBot是一个基于机器学习的对话引擎，用Python编写，可以生成…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">github.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn io lz"/></div></div></a></div><p id="8075" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">进入聊天机器人。这是一个Python库，一旦你向它提供查询-响应训练数据，“<em class="mo">通过搜索与输入最匹配的已知语句来选择最匹配的响应，然后根据机器人与</em>通信的人发出每个响应的频率，返回最可能的响应</p><figure class="js jt ju jv fd ij er es paragraph-image"><div class="er es mp"><img src="../Images/7d7264a0afa89f4b604485e62f7c9dc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*iwNlAiryP0tavsVQbg72Gg.jpeg"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">【https://chatterbot.readthedocs.io/en/stable/index.html T4】</figcaption></figure><p id="3ead" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">而不是使用一些<a class="ae mq" href="https://github.com/gunthercox/chatterbot-corpus/tree/master/chatterbot_corpus/data" rel="noopener ugc nofollow" target="_blank">提供的预设训练语料库</a>(语料库？corpii？)，我用自己的历史whatsapp聊天记录做了实验。</p><p id="9157" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然而，回想起来，我的训练数据质量并不是很好，因为许多对话都是长时间的交流，非常具体，所以机器人经常会回一些无意义的跑题回复。(如果你还没有看视频，你会明白我的意思)。我告诉自己，因为另一种选择是我天生语无伦次(我希望&gt; _ </p><h2 id="e9ac" class="ld kg hi bd kh le lf lg kl lh li lj kp jf lk ll kt jj lm ln kx jn lo lp lb lq bi translated"><strong class="ak">烧瓶</strong></h2><p id="2092" class="pw-post-body-paragraph iu iv hi iw b ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn lv jp jq jr hb bi translated">然后，我使用POST方法(<em class="mo">和一些额外的行，以允许它处理从Twilio到&amp;的信息，我将在下面进一步解释</em>)将这个机器人包装在一个简单的Flask webapp中。Flask是一个简单的微型web框架，允许你使用Python创建web应用程序。</p><div class="lw lx ez fb ly lz"><a href="https://flask.palletsprojects.com/en/1.1.x/" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hj fi z dy me ea eb mf ed ef hh bi translated">欢迎使用Flask - Flask文档(1.1.x)</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">欢迎阅读Flask的文档。开始安装，然后了解快速入门概述。有…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">flask.palletsprojects.com</p></div></div><div class="mi l"><div class="mr l mk ml mm mi mn io lz"/></div></div></a></div><p id="22dc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">基本上，如果您查看下面github链接中的python文件，您会看到我刚刚设置了一个函数，它通过POST方法监听传入的消息，并从经过训练的Chatterbot对象返回一个回复</p><h2 id="a265" class="ld kg hi bd kh le lf lg kl lh li lj kp jf lk ll kt jj lm ln kx jn lo lp lb lq bi translated"><strong class="ak"> Ngrok </strong></h2><p id="669d" class="pw-post-body-paragraph iu iv hi iw b ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn lv jp jq jr hb bi translated">之后，我使用Ngrok将web应用程序在我的本地PC上运行的适当端口暴露给互联网</p><div class="lw lx ez fb ly lz"><a href="https://ngrok.com/" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hj fi z dy me ea eb mf ed ef hh bi translated">ngrok -保护到本地主机的内部隧道</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">到本地主机webhook开发工具和调试工具的ngrok安全自省隧道</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">ngrok.com</p></div></div><div class="mi l"><div class="ms l mk ml mm mi mn io lz"/></div></div></a></div><p id="32b6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">TLDR，Ngrok创建一个连接你的网络应用和外部网络的url。</p><figure class="js jt ju jv fd ij er es paragraph-image"><div class="er es mt"><img src="../Images/fe54b608e221cca8226868a328310067.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*CeyUg_H3TkFwFMmAecwrOw.jpeg"/></div></figure><h2 id="a4ee" class="ld kg hi bd kh le lf lg kl lh li lj kp jf lk ll kt jj lm ln kx jn lo lp lb lq bi translated"><strong class="ak"> Twilio </strong></h2><p id="7ddf" class="pw-post-body-paragraph iu iv hi iw b ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn lv jp jq jr hb bi translated">Twilio是一项服务，允许你以编程方式(即通过代码)设置你的应用程序如何与普通电话线、短信甚至Whatsapp等通信渠道合作。</p><p id="48ac" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">https://www.twilio.com<a class="ae mq" href="https://www.twilio.com/" rel="noopener ugc nofollow" target="_blank"/></p><p id="5905" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">一旦你在Twilio中建立了一个可编程的信息项目，它就会注册一个号码，你可以在Whatsapp中与之交换信息。然后使用Ngrok中的URL连接到Twilio Whatsapp控制台，并将其键入如下所示的配置页面。</p><figure class="js jt ju jv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mu"><img src="../Images/20a71aa170783d3a2f3143cfd9f88b69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pZp10IjyP1wMRu2iRu6Bug.jpeg"/></div></div></figure><p id="58e2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">之后，一旦你使用初始化代码向Whatsapp帐户注册了你的手机号码，无论何时你向Whatsapp帐户发送任何进一步的消息，Twilio都会将该消息传递给Python Flask WebApp，并接收和显示任何返回的响应。</p><p id="69ad" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我把代码贴在了下面的Github上:</p><div class="lw lx ez fb ly lz"><a href="https://github.com/ZhijingEu/ZChatterbot" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hj fi z dy me ea eb mf ed ef hh bi translated">志津古/兹查特博特</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">这是一个使用聊天机器人库的简单聊天机器人。GitHub是超过5000万开发者的家园，他们一起工作…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">github.com</p></div></div><div class="mi l"><div class="mv l mk ml mm mi mn io lz"/></div></div></a></div><p id="a95a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">注意:</p><ol class=""><li id="e7cd" class="mw mx hi iw b ix iy jb jc jf my jj mz jn na jr nb nc nd ne bi translated">你需要注册自己的Twilio账户(他们有免费试用版)</li><li id="4fcd" class="mw mx hi iw b ix nf jb ng jf nh jj ni jn nj jr nb nc nd ne bi translated">鉴于这是我的一堆whatsapp聊天记录，我故意省略了我使用的训练数据，所以github只有一个名为“data.txt”的虚拟文件，你必须自己填写。</li><li id="26af" class="mw mx hi iw b ix nf jb ng jf nh jj ni jn nj jr nb nc nd ne bi translated">这种方法对于一个“有趣”的演示来说很好，因为我使用了Flask的内置开发服务器，根据<a class="ae mq" href="https://flask.palletsprojects.com/en/1.1.x/tutorial/deploy/#:~:text=When%20running%20publicly%20rather%20than,efficient%2C%20stable%2C%20or%20secure." rel="noopener ugc nofollow" target="_blank">文档本身</a>的说法，这些服务器并没有被设计成特别高效、稳定或安全的 。然而，如果你真的想为产品开发一个机器人，你可能需要探索一个“合适的”Python HTTP服务器，比如Gnuicorn</li></ol></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="988d" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">对话流</h1><p id="0e09" class="pw-post-body-paragraph iu iv hi iw b ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn lv jp jq jr hb bi translated">那些在LinkedIn上关注我的人可能已经看到了我通过谷歌的Dialogflow服务首次涉足聊天机器人。</p><div class="lw lx ez fb ly lz"><a href="https://cloud.google.com/dialogflow" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hj fi z dy me ea eb mf ed ef hh bi translated">对话流|谷歌云</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">发送反馈创建跨设备和平台的对话体验。查看该产品的文档…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">cloud.google.com</p></div></div><div class="mi l"><div class="nk l mk ml mm mi mn io lz"/></div></div></a></div><p id="f9b6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Dialogflow是一个托管服务，提供了一个自然语言理解模块，您可以在其中指定“意图”,帮助机器人识别正在讨论的主题。</p><p id="bffb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">根据你输入给Dialogflow的“训练短语”，它会根据你提供给它的预设回复给出回复。Dialogflow甚至允许采取行动(例如创建购买请求或预约)</p><figure class="js jt ju jv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nl"><img src="../Images/1486dec9b1477dbb793abf9c57652179.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DL3kMIslYZs6P3krOuIMqQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae mq" href="https://cloud.google.com/dialogflow/docs/basics" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/dialogflow/docs/basics</a></figcaption></figure><p id="c632" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">毫无疑问，Dialogflow的强大之处在于，它使用自然语言理解来正确解析传入的消息，以识别含义模糊的单词的正确上下文，并处理不同的时态或句子语法。</p><p id="9c90" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">此外，由于它是一项托管服务，谷歌已经准备了一系列现成的集成，所以你甚至可以与机器人交谈。我构建了与视频中相同的Web演示页面</p><p id="791f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我没有在视频中介绍它，但Dialogflow有许多其他功能，如<a class="ae mq" href="https://cloud.google.com/dialogflow/docs/quick/fulfillment" rel="noopener ugc nofollow" target="_blank">自动链接到数据库以创建医生预约、食品订单，仅根据用户的聊天输入设置交付日期</a>。</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="066f" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">最后</h1><p id="d727" class="pw-post-body-paragraph iu iv hi iw b ix lr iz ja jb ls jd je jf lt jh ji jj lu jl jm jn lv jp jq jr hb bi translated">希望你也玩得开心，并且可以看到，只需一点点工作，几乎任何人都可以设置自己的聊天机器人来做各种各样的事情，特别是使用Dialogflow这样的服务，这非常容易。</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><p id="eee0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">PS:我<a class="ae mq" href="https://www.linkedin.com/feed/update/urn:li:activity:6692385229543489536/" rel="noopener ugc nofollow" target="_blank">已经在Linkedin上发布了这个例子，作为‘游戏化’的一个很好的例子</a>，但它值得重复:我强烈推荐你去看看Twilio的互动训练游戏TwilioQuest。这真的是值得一看的，因为他们制作了一个基于16位复古1980年代冒险游戏的教程游戏。</p><div class="lw lx ez fb ly lz"><a href="https://www.twilio.com/quest" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hj fi z dy me ea eb mf ed ef hh bi translated">TwilioQuest -发现您用代码改变世界的力量。</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">什么是TwilioQuest？TwilioQuest是一款教育视频游戏，旨在教导新一代开发人员如何…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">www.twilio.com</p></div></div><div class="mi l"><div class="nm l mk ml mm mi mn io lz"/></div></div></a></div></div></div>    
</body>
</html>