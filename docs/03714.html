<html>
<head>
<title>Masking an area in a video in OpenCV in Python— Harry Potter Invisible Cloak example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python在OpenCV中掩蔽视频中的一个区域——哈利·波特隐形斗篷示例</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/masking-an-area-in-a-video-in-opencv-in-python-harry-potter-invisible-cloak-example-a25279fdc26c?source=collection_archive---------0-----------------------#2020-02-15">https://medium.com/analytics-vidhya/masking-an-area-in-a-video-in-opencv-in-python-harry-potter-invisible-cloak-example-a25279fdc26c?source=collection_archive---------0-----------------------#2020-02-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex if ig ih ii"><div class="bz dy l di"><div class="ij ik l"/></div><figcaption class="il im et er es in io bd b be z dx translated">观看视频了解行动</figcaption></figure><p id="b591" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated">你们大多数人都知道隐形斗篷，这是邓布利多匿名送给哈利·波特的圣诞礼物。嗯，现在可以在网上买了！但是，假设您想在购买该产品之前检查一下它穿在您身上的效果。你会怎么做？</p><p id="a98e" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated">如果你正在考虑一个答案，那么你就在正确的网页上！诀窍是使用Python中的OpenCV库。</p><p id="b173" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated">在本教程中，我们将学习如何在Python中为直播视频创建一个屏蔽视频。</p><p id="8ac0" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated">在开始之前，我们需要安装OpenCV(开源计算机视觉)库，该库旨在帮助开发人员执行与计算机视觉相关的任务。我们需要为OpenCV库做一个pip安装。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="c0b6" class="jx jy hi jt b fi jz ka l kb kc">install opencv-python</span></pre><h1 id="cc89" class="kd jy hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">现在让我们用Python来构建这个系统</h1><p id="fecf" class="pw-post-body-paragraph ip iq hi ir b is la iu iv iw lb iy iz ja lc jc jd je ld jg jh ji le jk jl jm hb bi translated">现在，我们已经安装了所需的库。我们将开始实现如下所示的代码。我解释了每个代码块，以帮助您理解后台发生了什么。</p><p id="1355" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated">请随意跳到这一页的末尾，获得Jupyter笔记本完整代码的链接。</p><p id="72f7" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated"><strong class="ir hj">第一步:</strong>打开Spyder</p><p id="8403" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated"><strong class="ir hj">第二步:</strong>导入库</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="d2f4" class="jx jy hi jt b fi jz ka l kb kc">import cv2<br/>import numpy as np<br/>import time</span></pre><p id="52a6" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated"><strong class="ir hj">第三步:</strong>将您的视频引用到您的网络摄像头</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="e1fe" class="jx jy hi jt b fi jz ka l kb kc">video_capture = cv2.VideoCapture(0)</span></pre><p id="ec2f" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated"><strong class="ir hj">第四步:</strong>定义视频的输出</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="74e2" class="jx jy hi jt b fi jz ka l kb kc">fourcc = cv2.VideoWriter_fourcc(‘m’,’p’,’4',’v’)# note the lower case<br/>frame_width = int(video_capture.get(3))<br/>frame_height = int(video_capture.get(4))<br/>out = cv2.VideoWriter(‘Harry_Potter.mp4’,fourcc , 10, (frame_width,frame_height), True)</span></pre><p id="c3aa" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated"><strong class="ir hj">步骤5: </strong>指定系统启动的等待时间</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="e4bd" class="jx jy hi jt b fi jz ka l kb kc">time.sleep(3)<br/>background = 0</span></pre><p id="8602" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated"><strong class="ir hj">第六步:</strong>捕捉平时的环境。此代码是必要的，以确保您遮罩的颜色具有环境中对象的细节。这些代码在下面的多个模块中进行了解释:</p><p id="f6dc" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated"><strong class="ir hj">模块1: </strong></p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="5536" class="jx jy hi jt b fi jz ka l kb kc">while(video_capture.isOpened()):<br/>    ret, image = video_capture.read()<br/>    if not ret:<br/>        break<br/>    image = np.flip(image,axis=1)<br/>    <br/>    # Change to HSV<br/>    hsv = cv2.cvtColor(image, cv2.COLOR_BGR2HSV)</span></pre><p id="55eb" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated">这里，我们一次处理一帧。使用cv2库提取帧，cv2库以BGR(蓝-绿-红)颜色捕获帧，而遮罩库使用HSV格式。因此，我们翻转框架的颜色代码。</p><p id="8740" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated"><strong class="ir hj">模块2: </strong></p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="11a9" class="jx jy hi jt b fi jz ka l kb kc">#Create masks with coordinates to detect the color<br/>    lower_blue = np.array([94, 80, 2])<br/>    upper_blue = np.array([126, 255, 255])<br/>    mask_all = cv2.inRange(hsv,lower_blue,upper_blue)</span><span id="6925" class="jx jy hi jt b fi lf ka l kb kc">mask_all = cv2.morphologyEx(mask_all, cv2.MORPH_OPEN, np.ones((3,3),np.uint8))<br/>    mask_all = cv2.morphologyEx(mask_all, cv2.MORPH_DILATE, np.ones((3,3),np.uint8))</span></pre><p id="27fd" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated">此块中的代码创建带有坐标的遮罩对象来检测指定的颜色。颜色以HSV格式在范围中指定。在本例中，我们指定浅蓝色。有关其他颜色的代码片段，请参见下文。</p><p id="3ed1" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated"><strong class="ir hj">第3块:</strong></p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="26ac" class="jx jy hi jt b fi jz ka l kb kc">#Hide the blue part away<br/>    mask2 = cv2.bitwise_not(mask_all)<br/> <br/>    streamA = cv2.bitwise_and(image,image,mask=mask2)</span><span id="2267" class="jx jy hi jt b fi lf ka l kb kc">#Copy the masked area's original part<br/>    streamB = cv2.bitwise_and(background, background, mask = mask_all)</span></pre><p id="4371" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated">这个块有代码删除检测到的彩色区域，并在其上添加背景流层。</p><p id="caf9" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated">第4块:编写代码，在你的硬盘上录制视频</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="5765" class="jx jy hi jt b fi jz ka l kb kc">#Write the video in the file specified in the previous block<br/>    output = cv2.addWeighted(streamA,1,streamB,1,0)<br/>    out.write(output)<br/>    cv2.imshow("cloak_trick",output)<br/>    if cv2.waitKey(25) == 13:<br/>        break</span></pre><p id="2984" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated"><strong class="ir hj">第八步:</strong>必须发布所有拍摄的视频。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="c771" class="jx jy hi jt b fi jz ka l kb kc">video_capture.release()<br/>out.release()<br/>cv2.destroyAllWindows()</span></pre><h1 id="2bff" class="kd jy hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">在命令行中运行程序</h1><p id="80f6" class="pw-post-body-paragraph ip iq hi ir b is la iu iv iw lb iy iz ja lc jc jd je ld jg jh ji le jk jl jm hb bi translated">下一步是将文件保存在。py格式并在命令行/Anaconda提示符下运行它。</p><p id="e675" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated">我在Anaconda提示符下运行它，首先使用命令cd导航到该文件夹。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="a44f" class="jx jy hi jt b fi jz ka l kb kc">cd &lt;folder path&gt;</span></pre><p id="f7a1" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated">运行python文件</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="d929" class="jx jy hi jt b fi jz ka l kb kc">python filename.py</span></pre><p id="6c6a" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated">您将看到一个弹出窗口，视频正在播放。让视频捕捉环境45秒左右。之后，你可以玩蓝色的物体/夹克/运动衫甚至斗篷！</p><figure class="jo jp jq jr fd ii er es paragraph-image"><div class="er es lg"><img src="../Images/d60eb69e71c6d95ea97a1c9d6fed6a2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*zAHne2Liz8RpCfTgqbCwYw.gif"/></div></figure><p id="1f2b" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated"><strong class="ir hj"> Wohoo！你已经成功地用Python构建了一个隐形斗篷替换代码。</strong></p><p id="f26f" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated"><strong class="ir hj">尝试用不同的物体和想法做视频实验，并在下面的评论区告诉我效果如何。</strong></p><p id="e11c" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated">如果你有任何问题，请在评论区告诉我。</p><h1 id="387e" class="kd jy hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated"><strong class="ak">其他颜色的附加代码片段</strong></h1><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="99d9" class="jx jy hi jt b fi jz ka l kb kc">Red color<br/>low_red = np.array([161, 155, 84]) high_red = np.array([179, 255, 255]) red_mask = cv2.inRange(hsv_frame, low_red, high_red) red = cv2.bitwise_and(frame, frame, mask=red_mask)</span><span id="975c" class="jx jy hi jt b fi lf ka l kb kc">Blue color<br/>low_blue = np.array([94, 80, 2]) high_blue = np.array([126, 255, 255]) blue_mask = cv2.inRange(hsv_frame, low_blue, high_blue) blue = cv2.bitwise_and(frame, frame, mask=blue_mask)</span><span id="be3e" class="jx jy hi jt b fi lf ka l kb kc">Green color<br/>low_green = np.array([25, 52, 72]) high_green = np.array([102, 255, 255]) green_mask = cv2.inRange(hsv_frame, low_green, high_green) green = cv2.bitwise_and(frame, frame, mask=green_mask)</span><span id="dedd" class="jx jy hi jt b fi lf ka l kb kc">Every color except white<br/>low = np.array([0, 42, 0]) high = np.array([179, 255, 255]) mask = cv2.inRange(hsv_frame, low, high) result = cv2.bitwise_and(frame, frame, mask=mask)</span></pre><h1 id="b75a" class="kd jy hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">编码</h1><div class="lj lk ez fb ll lm"><a href="https://github.com/chandravenky/Computer-Vision---Object-Detection-in-Python/blob/master/Masking%20a%20color%20in%20video_HarryPotterCloak.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="ln ab dw"><div class="lo ab lp cl cj lq"><h2 class="bd hj fi z dy lr ea eb ls ed ef hh bi translated">chandravenky/Python中的计算机视觉对象检测</h2><div class="lt l"><h3 class="bd b fi z dy lr ea eb ls ed ef dx translated">permalink dissolve GitHub是4000多万开发人员的家园，他们一起工作来托管和审查代码，管理…</h3></div><div class="lu l"><p class="bd b fp z dy lr ea eb ls ed ef dx translated">github.com</p></div></div><div class="lv l"><div class="lw l lx ly lz lv ma lh lm"/></div></div></a></div><h1 id="e6cb" class="kd jy hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">相关链接</h1><p id="6572" class="pw-post-body-paragraph ip iq hi ir b is la iu iv iw lb iy iz ja lc jc jd je ld jg jh ji le jk jl jm hb bi translated"><a class="ae jn" rel="noopener" href="/@venkatesh.chandra_75550/real-time-webcam-face-detection-system-using-opencv-in-python-windows-and-macos-86c31fddd2bc"><strong class="ir hj">Python中的实时人脸检测系统— Windows和macOS </strong> </a></p><p id="471e" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated"><a class="ae jn" rel="noopener" href="/@venkatesh.chandra_75550/vehicle-car-detection-in-real-time-and-recorded-videos-in-python-windows-and-macos-c5548b243b18"> <strong class="ir hj">使用OpenCV的Python中的车辆检测— Windows和macOS </strong> </a></p><p id="408e" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated"><a class="ae jn" rel="noopener" href="/@venkatesh.chandra_75550/person-pedestrian-detection-in-real-time-and-recorded-videos-in-python-windows-and-macos-4c81142f5f59"> <strong class="ir hj">使用OpenCV的Python中的行人检测— Windows和macOS </strong> </a></p><p id="0159" class="pw-post-body-paragraph ip iq hi ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm hb bi translated"><a class="ae jn" rel="noopener" href="/@venkatesh.chandra_75550/saving-output-of-object-recognition-in-macos-opencv-python-5914bb5d9ca8"> <strong class="ir hj">保存macOS中物体识别的输出</strong> </a></p><h1 id="56d0" class="kd jy hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">去哪里找我🤓</h1><ol class=""><li id="c831" class="mb mc hi ir b is la iw lb ja md je me ji mf jm mg mh mi mj bi translated">通过<a class="ae jn" href="https://www.linkedin.com/in/venkateshchandra/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>/<a class="ae jn" href="https://github.com/chandravenky" rel="noopener ugc nofollow" target="_blank">GitHub</a>/<a class="ae jn" href="http://chatraja.com/" rel="noopener ugc nofollow" target="_blank">我的网站</a>与我联系</li><li id="5c9e" class="mb mc hi ir b is mk iw ml ja mm je mn ji mo jm mg mh mi mj bi translated">感觉大方？给我买一杯☕️咖啡</li></ol></div></div>    
</body>
</html>