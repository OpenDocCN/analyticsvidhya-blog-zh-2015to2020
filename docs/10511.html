<html>
<head>
<title>Chatbot with TensorFlow 2.0 — Going Merry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 TensorFlow 2.0 的聊天机器人—尽情欢乐</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/chatbot-with-tensorflow-2-0-going-merry-2f79284a6104?source=collection_archive---------1-----------------------#2020-10-22">https://medium.com/analytics-vidhya/chatbot-with-tensorflow-2-0-going-merry-2f79284a6104?source=collection_archive---------1-----------------------#2020-10-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/fba2ef8a77e57d54c865d09411c96ff4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SAHhdvu3v9l81OjsfBa_Yw.jpeg"/></div></div></figure><p id="f52d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意:所有的代码文件都可以在:<a class="ae jo" href="https://github.com/ashwinhprasad/Chatbot-GoingMerry" rel="noopener ugc nofollow" target="_blank">https://github.com/ashwinhprasad/Chatbot-GoingMerry</a>获得</p><p id="0b7f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Going Merry </strong>是我为<strong class="is hj">海盗招募过程</strong>创造的聊天机器人。它有助于招募世界各地的海盗。这回答了用户关于招聘流程、先决条件等的简单问题。同样的模型也可以用于为任何组织创建聊天机器人</p><h1 id="8b75" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">介绍</h1><p id="75e0" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">聊天机器人是一种用于通过文本进行在线聊天的软件应用程序。在这篇博文中，我将展示如何使用 tensorflow 2 为您的组织创建一个简单的聊天机器人。</p><h1 id="5892" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">数据集准备</h1><p id="521a" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">一旦建立了数据集。一半的工作已经完成了。我们构建数据集的方式是聊天机器人的主要内容。我已经使用 json 文件创建了一个数据集。</p><p id="a7ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">json 文件就像 python 中的字典一样。您可以像在 python 的字典中一样存储在 json 文件中</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/7a11d9dccf5f4ebf1adfe74bd646ff2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pEs8PA8UP3b0GNwXsoAA-g.png"/></div></div></figure><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kx"><img src="../Images/8080552cc9bd6b6d0e287faf29b1d343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ZM68RPfILIolhNFcpIGMQ.png"/></div></div></figure><p id="18ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="ky">输入:</em> </strong>这些正是用户将要发送给机器人的消息。</p><p id="3b6e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="ky">标签:</em> </strong>标签用于对输入进行分类，并将其映射到特定类型的响应</p><p id="2e3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="ky">响应:</em> </strong>一旦我们将一个输入映射到一个适当的标签，我们就可以选择一个响应返回给用户。</p><p id="d78b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是聊天机器人数据集的基本结构。</p><h1 id="8e0a" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">机器学习部分:</h1><ol class=""><li id="493e" class="kz la hi is b it kn ix ko jb lb jf lc jj ld jn le lf lg lh bi translated"><strong class="is hj">导入库</strong></li></ol><pre class="kt ku kv kw fd li lj lk ll aw lm bi"><span id="5dfa" class="ln jq hi lj b fi lo lp l lq lr">#importing the libraries<br/>import tensorflow as tf<br/>import numpy as np<br/>import pandas as pd<br/>import json<br/>import nltk<br/>from tensorflow.keras.preprocessing.text import Tokenizer<br/>from tensorflow.keras.layers import Input, Embedding, LSTM , Dense,GlobalMaxPooling1D,Flatten<br/>from tensorflow.keras.models import Model<br/>import matplotlib.pyplot as plt</span></pre><p id="76ec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 2。导入数据</strong></p><pre class="kt ku kv kw fd li lj lk ll aw lm bi"><span id="8661" class="ln jq hi lj b fi lo lp l lq lr">#importing the dataset<br/>with open('content.json') as content:<br/>  data1 = json.load(content)<br/></span><span id="b497" class="ln jq hi lj b fi ls lp l lq lr">#getting all the data to lists<br/>tags = []<br/>inputs = []<br/>responses={}<br/>for intent in data1['intents']:<br/>  responses[intent['tag']]=intent['responses']<br/>  for lines in intent['input']:<br/>    inputs.append(lines)<br/>    tags.append(intent['tag'])</span><span id="372c" class="ln jq hi lj b fi ls lp l lq lr">#converting to dataframe<br/>data = pd.DataFrame({"inputs":inputs,<br/>                     "tags":tags})</span><span id="78d4" class="ln jq hi lj b fi ls lp l lq lr">print(data)</span></pre><p id="dd80" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">输出:</strong></p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/cf5f7cb3d585cf88fdbba241acd1279d.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*2fYTm-atHJrb0fcR4aWIvQ.png"/></div></figure><p id="ec0f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数据存储在一个 json 文件中，该文件可以作为 pandas 数据框架导入和使用。这个数据是我手动创建的。因此，它不是那么大。<br/>我们都知道深度学习需要大块的数据。但是，这里的情况并非如此。我已经利用了一个足够强大的神经网络架构来处理这少量的数据</p><p id="d41e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 3。数据预处理</strong></p><pre class="kt ku kv kw fd li lj lk ll aw lm bi"><span id="6308" class="ln jq hi lj b fi lo lp l lq lr">#removing punctuations<br/>import string<br/>data['inputs'] = data['inputs'].apply(lambda wrd:[ltrs.lower() for ltrs in wrd if ltrs not in string.punctuation])<br/>data['inputs'] = data['inputs'].apply(lambda wrd: ''.join(wrd))</span><span id="69df" class="ln jq hi lj b fi ls lp l lq lr">#tokenize the data<br/>from tensorflow.keras.preprocessing.text import Tokenizer<br/>tokenizer = Tokenizer(num_words=2000)<br/>tokenizer.fit_on_texts(data['inputs'])<br/>train = tokenizer.texts_to_sequences(data['inputs'])</span><span id="3b81" class="ln jq hi lj b fi ls lp l lq lr"><br/>#apply padding<br/>from tensorflow.keras.preprocessing.sequence import pad_sequences<br/>x_train = pad_sequences(train)</span><span id="90c7" class="ln jq hi lj b fi ls lp l lq lr"><br/>#encoding the outputs<br/>from sklearn.preprocessing import LabelEncoder<br/>le = LabelEncoder()<br/>y_train = le.fit_transform(data['tags'])</span></pre><p id="c237" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Tensorflow 的 tokenizer 为每个不同的单词分配一个唯一的令牌。并且进行填充以使所有数据具有相同的长度，以便将其发送到 RNN 层。目标变量也被编码成十进制值。</p><p id="2615" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 4。输入长度、输出长度和词汇</strong></p><pre class="kt ku kv kw fd li lj lk ll aw lm bi"><span id="0da3" class="ln jq hi lj b fi lo lp l lq lr">#input length<br/>input_shape = x_train.shape[1]<br/>print(input_shape)</span><span id="ac47" class="ln jq hi lj b fi ls lp l lq lr">#define vocabulary<br/>vocabulary = len(tokenizer.word_index)<br/>print("number of unique words : ",vocabulary)</span><span id="6cf5" class="ln jq hi lj b fi ls lp l lq lr">#output length<br/>output_length = le.classes_.shape[0]<br/>print("output length: ",output_length)</span><span id="abd4" class="ln jq hi lj b fi ls lp l lq lr"><strong class="lj hj">output</strong></span><span id="e185" class="ln jq hi lj b fi ls lp l lq lr">number of unique words :  96<br/>output length:  8</span></pre><p id="1ebd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输入长度和输出长度很明显。它们是神经网络的输入形状和输出形状。词汇大小用于嵌入层为每个单词创建唯一的向量表示</p><p id="9b14" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 5。神经网络</strong></p><pre class="kt ku kv kw fd li lj lk ll aw lm bi"><span id="a3b5" class="ln jq hi lj b fi lo lp l lq lr">#creating the model<br/>i = Input(shape=(input_shape,))<br/>x = Embedding(vocabulary+1,10)(i)<br/>x = LSTM(10,return_sequences=True)(x)<br/>x = Flatten()(x)<br/>x = Dense(output_length,activation="softmax")(x)<br/>model  = Model(i,x)</span><span id="1b27" class="ln jq hi lj b fi ls lp l lq lr">#compiling the model<br/>model.compile(loss="sparse_categorical_crossentropy",optimizer='adam',metrics=['accuracy'])</span><span id="6e8b" class="ln jq hi lj b fi ls lp l lq lr">#training the model<br/>train = model.fit(x_train,y_train,epochs=200)</span></pre><p id="57bf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">网络由嵌入层组成，这是自然语言处理领域中最强大的东西之一。嵌入层的输出是具有 lstm 门的接收层的输入。然后，展平输出，并使用带有 softmax 激活功能的常规密集图层。</p><p id="7a1e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">主要部分是嵌入层，它为数据集中的每个单词提供相应的向量</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es et"><img src="../Images/7837731e61809369a2ab8256eda9b3a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_yPEUYjEoB5e4upvco9ZNA.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">模型精度</figcaption></figure><p id="8c10" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 6。模型分析<br/> </strong>该模型获得了 100%的完美准确率。</p><p id="9f06" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 7。测试</strong></p><pre class="kt ku kv kw fd li lj lk ll aw lm bi"><span id="17ed" class="ln jq hi lj b fi lo lp l lq lr">#chatting<br/>import random</span><span id="5bfd" class="ln jq hi lj b fi ls lp l lq lr">while True:<br/>  texts_p = []<br/>  prediction_input = input('You : ')</span><span id="d51f" class="ln jq hi lj b fi ls lp l lq lr">  #removing punctuation and converting to lowercase<br/>  prediction_input = [letters.lower() for letters in prediction_input if letters not in string.punctuation]<br/>  prediction_input = ''.join(prediction_input)<br/>  texts_p.append(prediction_input)</span><span id="2c3f" class="ln jq hi lj b fi ls lp l lq lr">  #tokenizing and padding<br/>  prediction_input = tokenizer.texts_to_sequences(texts_p)<br/>  prediction_input = np.array(prediction_input).reshape(-1)<br/>  prediction_input = pad_sequences([prediction_input],input_shape)</span><span id="af9d" class="ln jq hi lj b fi ls lp l lq lr">  #getting output from model<br/>  output = model.predict(prediction_input)<br/>  output = output.argmax()</span><span id="b8db" class="ln jq hi lj b fi ls lp l lq lr">  #finding the right tag and predicting<br/>  response_tag = le.inverse_transform([output])[0]<br/>  print("Going Merry : ",random.choice(responses[response_tag]))<br/>  if response_tag == "goodbye":<br/>    break</span></pre><p id="4fb0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">输出:</strong></p><pre class="kt ku kv kw fd li lj lk ll aw lm bi"><span id="ccb9" class="ln jq hi lj b fi lo lp l lq lr">You : hi there</span><span id="f5d6" class="ln jq hi lj b fi ls lp l lq lr">Going Merry :  welcome aboard, how may I help you ?</span><span id="4dde" class="ln jq hi lj b fi ls lp l lq lr">You : how do i join the pirates ?</span><span id="6100" class="ln jq hi lj b fi ls lp l lq lr">Going Merry :  you need to contact the nearest straw hats center <br/>once you have completed the pre-requisites</span><span id="7660" class="ln jq hi lj b fi ls lp l lq lr">You : what are the pre requisites ?</span><span id="8760" class="ln jq hi lj b fi ls lp l lq lr">Going Merry :  you gotta master the art of swordfight or master Cooking and become a furious cook or you have to be the best navigator in the entire world or you need to be as strong and intelligent as god usop</span><span id="a3a8" class="ln jq hi lj b fi ls lp l lq lr">You : alright , who are you ?</span><span id="0621" class="ln jq hi lj b fi ls lp l lq lr">Going Merry :  Going Merry at your service</span><span id="1d58" class="ln jq hi lj b fi ls lp l lq lr">You : how are you doing ?</span><span id="4121" class="ln jq hi lj b fi ls lp l lq lr">Going Merry :  Yeah , am fine</span><span id="3117" class="ln jq hi lj b fi ls lp l lq lr">You : nice , thanks for the response</span><span id="2e37" class="ln jq hi lj b fi ls lp l lq lr">Going Merry :  Okay, Bye</span></pre><p id="c030" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是创建聊天机器人的全部内容</p><h1 id="7bc6" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">关于去快乐</h1><p id="2ada" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">《寻欢作乐》是一部名为《海贼王》的漫画中的一艘船，围绕着一群海盗的故事展开。毫无疑问,“快乐号”是一艘神奇的船。但是，它去世了。<br/>要知道，更多关于行乐:<a class="ae jo" href="https://onepiece.fandom.com/wiki/Going_Merry" rel="noopener ugc nofollow" target="_blank">https://onepiece.fandom.com/wiki/Going_Merry</a></p><h1 id="4df3" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="405a" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">这是我用 tensorflow2 利用嵌入矩阵的力量创建的聊天机器人。同样的方法可以用于为任何类型的组织构建聊天机器人，但不能用于一般的组织。</p></div></div>    
</body>
</html>