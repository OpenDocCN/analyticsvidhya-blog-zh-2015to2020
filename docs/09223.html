<html>
<head>
<title>Simple Classification in Neural Network</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">神经网络中的简单分类</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/simple-classification-in-neural-network-c349744d608a?source=collection_archive---------17-----------------------#2020-08-29">https://medium.com/analytics-vidhya/simple-classification-in-neural-network-c349744d608a?source=collection_archive---------17-----------------------#2020-08-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5111" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们知道，许多复杂的机器学习问题可以使用神经网络<em class="jd">轻松</em>解决。例如，在监督学习(分类)中，我们可以使用它们来对图像或文本进行分类。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/d4fb5abe18c5ca74fd69a912c3490997.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_aMtDHBoZVL26vA8.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">作者:<a class="ae ju" href="https://blog.frankfurt-school.de/neural-networks-vs-random-forests-does-it-always-have-to-be-deep-learning/" rel="noopener ugc nofollow" target="_blank">法兰克福学派</a></figcaption></figure><blockquote class="jv jw jx"><p id="07dd" class="if ig jd ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated"><strong class="ih hj">现在，如果我们对实际上可以使用“常规”机器学习解决的简单数据集进行处理，会怎么样？</strong></p></blockquote><p id="cd0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本帖中，我们将尝试使用来自 Kaggle 的名为“<a class="ae ju" href="https://www.kaggle.com/hb20007/gender-classification" rel="noopener ugc nofollow" target="_blank">性别分类</a>”的简单数据集。该数据仅包含 66 行，4 个特征(在我们的目标变量中表示用户性别的兴趣)。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kb"><img src="../Images/e1821f3b7bfab63e7e7f085ea2fa95b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w76HKT9T7Ffy0N9hF4M7Mg.png"/></div></div></figure><p id="849a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的目标是只根据用户的兴趣/偏好对他们的性别进行分类。通过使用<code class="du kc kd ke kf b">data.info()</code>，我们可以看到数据集中没有空值。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kg"><img src="../Images/b16eee6889701a01f0e065e92b20b8dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Ip6-8YS88x0r-s1SKgGsvg.png"/></div></figure><p id="3686" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，尽管我们的数据中没有空值，因为我们只有 4 个特征和 2 个类，我们仍然有一个问题。我们不能确定我们的数据中没有来自相同特征值的不一致标注。我们可以通过对数据进行如下分组来检测它们。</p><pre class="jf jg jh ji fd kh kf ki kj aw kk bi"><span id="7d05" class="kl km hi kf b fi kn ko l kp kq">grouping = data.groupby(list(data.columns)[:-1]).apply(lambda x: x.Gender.nunique())<br/>grouping[grouping.eq(2)]</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kr"><img src="../Images/826c5489cbce828c10d6dd4a4b7a63b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K1xUoJopLvXHL2Z9BKmBSg.png"/></div></div></figure><blockquote class="jv jw jx"><p id="8629" class="if ig jd ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated"><strong class="ih hj">如果相同的特征值(输入)有不同的标签(输出)，我们该怎么办？</strong></p></blockquote><p id="a1c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种情况下，我们现在无能为力。如果是因为数据输入期间发生的错误(<em class="jd">人为错误</em>，那么我们可以删除这些值。然而，我们不能这样做，因为这会使我们的模型产生偏差。</p><p id="30ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实际上，两性对<em class="jd">颜色</em>、<em class="jd">音乐类型</em>、<em class="jd">饮料</em>和<em class="jd">软饮料</em>有共同的兴趣是合理的。因此，我们可以通过添加更多的功能来解决这个问题，特别是通过找到每个性别的独特特征。但是现在，我们就顺其自然吧。</p><h1 id="f46c" class="ks km hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">预处理数据</h1><p id="d045" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">接下来要考虑的是，我们不能直接将数据输入神经网络模型，因为数据仍然是分类文本。因此，我们必须使用一键编码和标签编码对数据进行编码。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lu"><img src="../Images/4f5a95f4dc916d2686797c024f058d12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5fMxOwECefIe9flX"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">作者:<a class="ae ju" rel="noopener" href="/@michaeldelsole/what-is-one-hot-encoding-and-how-to-do-it-f0ae272f1179"> @michaeldelsole </a></figcaption></figure><p id="107a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击<a class="ae ju" href="https://towardsdatascience.com/categorical-encoding-using-label-encoding-and-one-hot-encoder-911ef77fb5bd" rel="noopener" target="_blank">链接</a>了解更多信息。</p><pre class="jf jg jh ji fd kh kf ki kj aw kk bi"><span id="30c8" class="kl km hi kf b fi kn ko l kp kq"># Split the features and labels<br/>X = data.iloc[:,:-1]<br/>y = data.iloc[:,-1]</span><span id="13a2" class="kl km hi kf b fi lv ko l kp kq"># Change the data into one-hot encoding (for features) and change label to 0-1<br/>X = pd.get_dummies(X)<br/>y = le.fit_transform(y)</span></pre><p id="9ee8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，由于我们的数据中有一个异常，我更喜欢使用 K-Fold 来评估模型，并尝试找到最佳的训练-测试分离场景，该场景在训练和测试集中给出最佳的准确性。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lw"><img src="../Images/0f90f0ef6c60d8314b9cea9df285f179.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*O09ogHn-1Rwjy63u.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">作者:<a class="ae ju" href="https://www.researchgate.net/figure/K-fold-cross-validation-method_fig2_331209203" rel="noopener ugc nofollow" target="_blank">李明朝</a></figcaption></figure><h1 id="fe0a" class="ks km hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">训练和测试模型</h1><p id="76d1" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">我们定义模型，这样我们可以为 K-Fold 中的每次迭代创建新的模型。对于输入层，我们用 shape 20 输入数据(因为预处理数据后我们总共得到了 20 列)，并使用' float32 '作为 dtype(因为我将把这个模型导出到 TFJS 中—它支持 float32)。</p><p id="7055" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们选择 Adam 作为我们的优化器，因为它是最受欢迎的。你可以在这个链接上找到更多关于其他优化者<a class="ae ju" rel="noopener" href="/datadriveninvestor/overview-of-different-optimizers-for-neural-networks-e0ed119440c3">的信息，在这里</a>了解更多关于亚当<a class="ae ju" href="https://towardsdatascience.com/adam-latest-trends-in-deep-learning-optimization-6be9a291375c" rel="noopener" target="_blank">的信息。</a></p><pre class="jf jg jh ji fd kh kf ki kj aw kk bi"><span id="17de" class="kl km hi kf b fi kn ko l kp kq">def train_model(X_train, X_test, y_train, y_test):<br/>  model = tf.keras.models.Sequential([<br/>            tf.keras.Input(shape=(20), dtype='float32'),<br/>            tf.keras.layers.Dense(units=1024, activation='relu'),<br/>            tf.keras.layers.Dropout(0.4),<br/>            tf.keras.layers.Dense(units=1, activation='sigmoid')<br/>          ])</span><span id="0e17" class="kl km hi kf b fi lv ko l kp kq">  model.compile(optimizer=Adam(lr=0.0001),<br/>                loss='binary_crossentropy',<br/>                metrics=['accuracy'])</span><span id="0b98" class="kl km hi kf b fi lv ko l kp kq">  # Callback to reduce learning rate if no improvement in validation loss for certain number of epochs<br/>  reduce_lr = ReduceLROnPlateau(monitor='val_loss', factor=0.1, patience=10, min_lr=1e-8, verbose=0)</span><span id="d1ed" class="kl km hi kf b fi lv ko l kp kq"># Callback to stop training if no improvement in validation loss for certain number of epochs<br/>  early_stop = EarlyStopping(monitor='val_loss', patience=20, verbose=0)</span><span id="a3d7" class="kl km hi kf b fi lv ko l kp kq">  history = model.fit(<br/>              X_train, y_train,<br/>              epochs=1000,<br/>              validation_data=(X_test, y_test),<br/>              callbacks=[reduce_lr, early_stop],<br/>              verbose=0<br/>            )</span><span id="be11" class="kl km hi kf b fi lv ko l kp kq">  tr_loss, tr_acc = model.evaluate(X_train, y_train)<br/>  loss, accuracy = model.evaluate(X_test, y_test)<br/>  return model, history, tr_loss, tr_acc, loss, accuracy</span></pre><p id="c795" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们运行并试图在 K-Fold 的每次迭代中找到最佳模型。</p><pre class="jf jg jh ji fd kh kf ki kj aw kk bi"><span id="6734" class="kl km hi kf b fi kn ko l kp kq">kfold = KFold(n_splits=5, random_state=42, shuffle=True)</span><span id="30f8" class="kl km hi kf b fi lv ko l kp kq">loss_arr = []<br/>acc_arr = []<br/>trloss_arr = []<br/>tracc_arr = []</span><span id="55e5" class="kl km hi kf b fi lv ko l kp kq">temp_acc = 0</span><span id="defb" class="kl km hi kf b fi lv ko l kp kq">for train, test in kfold.split(data):<br/>  model, history, trloss_val, tracc_val, loss_val, acc_val =   train_model(X.iloc[train], X.iloc[test], y[train], y[test])</span><span id="be83" class="kl km hi kf b fi lv ko l kp kq">  # If we got better accuracy in validation, then we save the split scenario and the model<br/>  if acc_val &gt; temp_acc:<br/>      print("Model changed")<br/>      temp_acc = acc_val<br/>      model.save('best_model.h5')<br/>      train_index = train<br/>      test_index = test<br/>      best_history = history</span><span id="5668" class="kl km hi kf b fi lv ko l kp kq">  trloss_arr.append(trloss_val)<br/>  tracc_arr.append(tracc_val)<br/>  loss_arr.append(loss_val)<br/>  acc_arr.append(acc_val)</span></pre><p id="74cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是每次迭代的精确度的结果。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lx"><img src="../Images/f334b9bb5e4e5cc5b4ab426d7f2c18ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*6_sM8y1cysuXNTQT1fJgDA.png"/></div></figure><p id="9186" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是我们的最佳模型(在第五次迭代中)的精度和损失图。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ly"><img src="../Images/eead1ef6ff7b550959bff08e2f106b23.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*K06lfWvrPw_xOqcaSlqcyA.png"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ly"><img src="../Images/c91c4f6333cf2b27cd681f1884d45b0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*z3MkKZgOi2KyblEq4YS5BA.png"/></div></figure><p id="910e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我制作了 ReactJS 应用程序，并将其部署在 Github 页面上。你可以试着从选择的偏好中交互式地预测性别。</p><div class="lz ma ez fb mb mc"><a href="https://musmeong.github.io/gender-guess/" rel="noopener  ugc nofollow" target="_blank"><div class="md ab dw"><div class="me ab mf cl cj mg"><h2 class="bd hj fi z dy mh ea eb mi ed ef hh bi translated">性别猜！</h2><div class="mj l"><h3 class="bd b fi z dy mh ea eb mi ed ef dx translated">该网站仅用于项目</h3></div><div class="mk l"><p class="bd b fp z dy mh ea eb mi ed ef dx translated">musmeong.github.io</p></div></div></div></a></div><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ml"><img src="../Images/2ce2061dc5ec3942e2b20737d219ce80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DuIXbRpArOse7JULu3hNwg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">来自<a class="ae ju" href="https://musmeong.github.io/gender-guess/" rel="noopener ugc nofollow" target="_blank">https://musmeong.github.io/gender-guess/</a></figcaption></figure><p id="ecad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用的模型与我在这篇文章中提出的模型相同，然后使用下面的代码将其转换为 TFJS(在<code class="du kc kd ke kf b">pip install tensorflowjs</code>之后)。</p><pre class="jf jg jh ji fd kh kf ki kj aw kk bi"><span id="4ea5" class="kl km hi kf b fi kn ko l kp kq">!tensorflowjs_converter --input_format keras best_model.h5 models/</span></pre></div><div class="ab cl mm mn gp mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="hb hc hd he hf"><p id="50a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">React App 的回购链接:<a class="ae ju" href="https://github.com/musmeong/gender-guess/tree/master" rel="noopener ugc nofollow" target="_blank">https://github.com/musmeong/gender-guess/tree/master</a></p><p id="532a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Kaggle 笔记本:<a class="ae ju" href="https://www.kaggle.com/musmeong/gender-classification-using-neural-network" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/mus meong/gender-class ification-using-neural-network</a></p></div></div>    
</body>
</html>