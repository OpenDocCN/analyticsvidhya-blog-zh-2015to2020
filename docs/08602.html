<html>
<head>
<title>Predicting the trends in opening stock price of Google using LSTM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 LSTM 预测谷歌开盘价的趋势</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/predicting-the-trends-in-opening-stock-price-of-google-using-lstm-c9094d2bd69b?source=collection_archive---------25-----------------------#2020-08-04">https://medium.com/analytics-vidhya/predicting-the-trends-in-opening-stock-price-of-google-using-lstm-c9094d2bd69b?source=collection_archive---------25-----------------------#2020-08-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="eb65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章正是关于实现一个 LSTM，根据从 Yahoo Finance 获得的数据来预测 Google 的开盘价趋势。训练数据集包含从 2012 年 1 月 3 日到 2016 年 12 月 30 日的 Google 股票价格信息。测试集包含关于 2017 年 1 月的谷歌股票价格的信息，记录在该月的 20 个金融日。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/f6cd49d8d4aeef195c37c7143af3eb71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*3LfCoqD29U8iOkOcnzTf1A.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">谷歌 2012 年 1 月 3 日至 2016 年 12 月 30 日的开盘价。图片作者。</figcaption></figure><p id="dfb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我将直接转到 Python 中的这个实现，在此之前，我将简短地提到什么是开盘价。</p><ul class=""><li id="653f" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">股票的开盘价是某一证券在交易日开市时首次交易的价格。任何上市股票的第一笔交易价格就是其每日开盘价。</li></ul><p id="a7c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将从导入基本库开始。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="df90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我将导入数据集。点击给出的链接可以获得<a class="ae ka" href="https://drive.google.com/file/d/1sMtdtOa5HN3wRbNwJrj70GvIDNs3lehJ/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">训练</a>和<a class="ae ka" href="https://drive.google.com/file/d/1Tk3_4prJujEd-WwYYboDZnjVYhytNT-4/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">测试</a>套。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="4ea7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我将标准化我们的数据。归一化是一种特征缩放类型，其中如果 x_new 是缩放变量，那么，</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es kb"><img src="../Images/f2de9151bd03322dd568d5ea80f46583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*stldoqOy59jWkgrzTAubNw.jpeg"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">图片来源:<a class="ae ka" href="https://www.google.com/url?sa=i&amp;url=https%3A%2F%2Fwww.educba.com%2Fnormalization-formula%2F&amp;psig=AOvVaw1S7j-t7neAMVI1F_ryLxKr&amp;ust=1596650091220000&amp;source=images&amp;cd=vfe&amp;ved=0CAMQjB1qFwoTCLDa3KaPgusCFQAAAAAdAAAAABAD" rel="noopener ugc nofollow" target="_blank"> eduCBA </a></figcaption></figure><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="149c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在是有趣的部分。在这里，对于我们的 LSTM 训练，基于我建立这个 RNN 的几次尝试，我将选择 60 <strong class="ih hj">时间步长</strong>。我所说的 60 个<strong class="ih hj">时间步长</strong>是指在每个<strong class="ih hj"> T </strong>时刻，RNN 会回顾在<strong class="ih hj"> T </strong>时刻和<strong class="ih hj"> T </strong>时刻之前的 60 个开盘价，并根据其捕捉的趋势，预测<strong class="ih hj"> T+1 </strong>时刻的开盘价。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="2652" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将创建一个 x_train 形状数组(1198，60)和一个 y_train 形状数组(1198，)。</p><p id="1396" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们必须将这个二维输入数组(x_train)改造成一个三维张量。在这里，因为我只使用一个输入来预测，所以我的第三维度将是 1。如果您认为任何其他特征在预测开盘价中起着重要的作用，那么可以随意将它包含到 x_train 中，然后适当地将第三维度更改为相应的输入数量。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="f6a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据<a class="ae ka" href="http://keras.io" rel="noopener ugc nofollow" target="_blank"> keras </a>文档，你会发现一个张量的维度，它将被我们的模型接受。</p><p id="52de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我开始实现 RNN 的时候，首先导入重要的模块。如果没有预先安装 keras 和 TensorFlow，请使用 pip 命令安装它们。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="fca9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">序列函数用于铺设模型，密集函数用于创建密集连接的层，LSTM 层用于实现我们的 RNN 中的长短期记忆，而丢弃层用于防止过拟合。辍学率是神经网络在每次迭代训练中忽略的神经元的百分比。</p><p id="e9f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们建立递归神经网络。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="1310" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们添加最终的输出层。因为我们预测的是连续值，所以输出层将只包含 1 个单元(即一个神经元)。这将是一个紧密相连的层。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="f5dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经完成了创建我们的 RNN！太好了！现在，我们将编译该模型，并根据我们的训练数据对其进行训练。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="cf90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然默认的优化器是<strong class="ih hj">‘rms prop’</strong>，均方根传播，我总是发现使用<strong class="ih hj">‘亚当’</strong>，自适应矩估计作为优化器是一个安全的赌注。您可以将它改为 rmsprop，看看结果如何变化。代码都是一样的，除了用 rmsprop 代替 adam。</p><p id="cfd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将在这里上传训练过程，这样你就可以知道损失是如何收敛的。这部分没什么可看的，就观察损失如何收敛。</p><pre class="je jf jg jh fd kg kh ki kj aw kk bi"><span id="7f41" class="kl km hi kh b fi kn ko l kp kq">Epoch 1/100<br/>38/38 [==============================] - 8s 205ms/step - loss: 0.0468<br/>Epoch 2/100<br/>38/38 [==============================] - 8s 205ms/step - loss: 0.0062<br/>Epoch 3/100<br/>38/38 [==============================] - 6s 154ms/step - loss: 0.0054<br/>Epoch 4/100<br/>38/38 [==============================] - 6s 152ms/step - loss: 0.0051<br/>Epoch 5/100<br/>38/38 [==============================] - 7s 182ms/step - loss: 0.0050<br/>Epoch 6/100<br/>38/38 [==============================] - 10s 255ms/step - loss: 0.0048<br/>Epoch 7/100<br/>38/38 [==============================] - 9s 228ms/step - loss: 0.0050<br/>...<br/>...<br/>...<br/>...<br/>Epoch 92/100<br/>38/38 [==============================] - 6s 159ms/step - loss: 0.0016<br/>Epoch 93/100<br/>38/38 [==============================] - 6s 157ms/step - loss: 0.0016 1s - l<br/>Epoch 94/100<br/>38/38 [==============================] - 6s 160ms/step - loss: 0.0016<br/>Epoch 95/100<br/>38/38 [==============================] - 6s 161ms/step - loss: 0.0015<br/>Epoch 96/100<br/>38/38 [==============================] - 8s 203ms/step - loss: 0.0014<br/>Epoch 97/100<br/>38/38 [==============================] - 8s 213ms/step - loss: 0.0014<br/>Epoch 98/100<br/>38/38 [==============================] - 8s 222ms/step - loss: 0.0016<br/>Epoch 99/100<br/>38/38 [==============================] - 7s 181ms/step - loss: 0.0013<br/>Epoch 100/100<br/>38/38 [==============================] - 9s 224ms/step - loss: 0.0014</span></pre><p id="e1ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有 100 个时期，所以我只显示前 7 步和后 9 步发生了什么。你可以很好地看到，损失已经收敛，并没有显示出任何实质性的变化，在最后几步。</p><p id="042b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将预测和可视化我们的结果。为了预测 2017 年 1 月的开盘价，我们必须导入测试数据集。正如你将看到的，测试集只有 20 个观察值，因为 2017 年 1 月只有 20 个金融或交易日。但是我们的模型是通过查看之前的 60 个观察值来训练执行的。没关系。我们将简单地连接测试集和训练集(原始的未缩放的训练集)。在这之后，我们将再次归一化它们，把它们转换成一个三维张量，然后把它提供给我们的 RNN 进行预测。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="bcfb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好吧！我们处于最后一步，现在我们将可视化预测，并将它们与实际值进行比较，以便亲自查看我们的模型是否已经捕捉到了开盘股票价格的潜在趋势。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es kr"><img src="../Images/e59e8b92fee17af48a623be6194b4f9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*buA5Q2qlXSzqRJUNf_jSdw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">实际与预测的谷歌股价。图片作者。</figcaption></figure><p id="8b29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">毫无疑问，我们的模型已经能够捕捉到 2017 年 1 月谷歌开盘价的趋势。然而，我们的模型对库存时间的不规则性反应不佳。这完全没问题，因为根据金融工程中的布朗运动数学概念，股票价格的未来变化与过去无关。</p><p id="4a89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢你坚持到最后！希望你喜欢阅读！</p></div></div>    
</body>
</html>