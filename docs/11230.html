<html>
<head>
<title>Docker(volumes) with DVC for Versioning data and Models for ML projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Docker(volumes)与DVC一起用于ML项目的版本控制数据和模型</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/docker-volumes-with-dvc-for-versioning-data-and-models-for-ml-projects-4885935db3ec?source=collection_archive---------2-----------------------#2020-11-24">https://medium.com/analytics-vidhya/docker-volumes-with-dvc-for-versioning-data-and-models-for-ml-projects-4885935db3ec?source=collection_archive---------2-----------------------#2020-11-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f847" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇博客详细解释了如何将DVC用于版本数据和模型，以及如何将应用程序文档化。如果你有兴趣学习如何使用DVC进行版本控制，你可以在这里阅读博客<a class="ae jd" href="https://bhuvana-kundumani.medium.com/versioning-data-and-models-in-ml-projects-using-dvc-and-aws-s3-286e664a7209" rel="noopener"/>。</p><p id="4b71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在之前的博客<a class="ae jd" href="https://bhuvana-kundumani.medium.com/versioning-data-and-models-in-ml-projects-using-dvc-and-aws-s3-286e664a7209" rel="noopener">中，我们详细讨论了使用DVC和AWS S3 </a>在ML项目中对数据和模型进行版本控制。我们将把这个应用程序转换成一个docker容器。在这个应用程序中，我们将使用单个容器。然而，在实时应用程序中，我们将有多个容器在运行，我们可能还必须与其他容器共享数据和模型。有了docker中的<a class="ae jd" href="https://docs.docker.com/storage/volumes/" rel="noopener ugc nofollow" target="_blank"> Volumes </a>，我们可以保存数据并跨容器共享数据。</p><p id="8f04" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此博客的代码可从<a class="ae jd" href="https://github.com/bhuvanakundumani/NER_tf_docker_dvc" rel="noopener ugc nofollow" target="_blank">这里</a>获得</p><h2 id="7ec2" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">中的AWS凭据。环境文件</h2><p id="f2c2" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">我们的数据和模型存储在AWS s3存储桶中。我们已经使用<code class="du ke kf kg kh b">dvc push</code>命令推送数据。如果你需要更多细节，请浏览<a class="ae jd" href="https://bhuvana-kundumani.medium.com/versioning-data-and-models-in-ml-projects-using-dvc-and-aws-s3-286e664a7209" rel="noopener">博客</a>。我们需要提供我们的AWS凭证(访问密钥id和秘密访问密钥)。我们将使用<code class="du ke kf kg kh b">.env</code>文件传递凭证。<code class="du ke kf kg kh b">vim .env</code>创造一个。env文件并存储凭据，如下所示。(注意:用您的访问密钥id替换access_key_id，用您的秘密访问密钥替换secret_access_key)</p><pre class="ki kj kk kl fd km kh kn ko aw kp bi"><span id="2cf7" class="je jf hi kh b fi kq kr l ks kt">AWS_ACCESS_KEY_ID=access_key_id<br/>AWS_SECRET_ACCESS_KEY=secret_access_key</span></pre><h2 id="ddbb" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">docker-撰写文件</h2><p id="62e4" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">Docker Compose构建了一个应用程序栈来运行一个完整的服务。使用pip安装docker-compose。</p><pre class="ki kj kk kl fd km kh kn ko aw kp bi"><span id="a825" class="je jf hi kh b fi kq kr l ks kt">pip install docker-compose</span></pre><p id="af4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用vim创建一个<code class="du ke kf kg kh b">docker-compose.yml</code>文件，并将下面的代码复制到<code class="du ke kf kg kh b">docker-compose.yml</code>文件中。</p><pre class="ki kj kk kl fd km kh kn ko aw kp bi"><span id="ca20" class="je jf hi kh b fi kq kr l ks kt">version: '3'<br/>services:<br/>  webserver:<br/>    build:<br/>      dockerfile: Dockerfile<br/>      context: ./<br/>      args:<br/>        AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID} # from .env<br/>        AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY} #from .env</span><span id="31a4" class="je jf hi kh b fi ku kr l ks kt">    volumes:<br/>      - app-vol:/voldata<br/>    ports:<br/>      - "8088:8088"</span><span id="b669" class="je jf hi kh b fi ku kr l ks kt">volumes:<br/>  app-vol:</span></pre><p id="fc2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ke kf kg kh b"><a class="ae jd" href="https://docs.docker.com/compose/compose-file/#build" rel="noopener ugc nofollow" target="_blank">build</a></code> <a class="ae jd" href="https://docs.docker.com/compose/compose-file/#build" rel="noopener ugc nofollow" target="_blank">键</a>告诉docker-compose在哪里可以找到构建指令。构建指令是通过一个<code class="du ke kf kg kh b">Dockerfile.</code> <code class="du ke kf kg kh b">context</code>提供的，它或者有一个包含Dockerfile的目录的路径。在本例中，它是当前目录。</p><p id="d450" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ke kf kg kh b">args</code>下的<code class="du ke kf kg kh b">AWS_ACCESS_KEY_ID</code>和<code class="du ke kf kg kh b">AWS_SECRET_ACCESS_KEY</code>从<code class="du ke kf kg kh b">.env</code>文件中获取数值。</p><p id="0ecf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<code class="du ke kf kg kh b">volumes</code>下的<code class="du ke kf kg kh b">app-vol:/voldata</code>创建一个名为<code class="du ke kf kg kh b">app-vol</code>的卷，驻留在<code class="du ke kf kg kh b">/voldata</code>中。我们将使用在<code class="du ke kf kg kh b">ports.</code>中提到的端口8088</p><h2 id="2164" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">Dockerfile文件</h2><p id="fc90" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">使用vim创建一个名为<code class="du ke kf kg kh b">Dockerfile</code>的文件，并将下面的代码复制到<code class="du ke kf kg kh b">Dockerfile</code></p><pre class="ki kj kk kl fd km kh kn ko aw kp bi"><span id="69ec" class="je jf hi kh b fi kq kr l ks kt">FROM python:3.7-slim<br/>RUN apt update<br/>RUN apt install -y git<br/>ARG AWS_ACCESS_KEY_ID<br/>ARG AWS_SECRET_ACCESS_KEY</span><span id="7153" class="je jf hi kh b fi ku kr l ks kt">ADD requirements.txt /<br/>RUN pip install -r /requirements.txt</span><span id="a592" class="je jf hi kh b fi ku kr l ks kt">ADD . /app<br/>VOLUME /voldata<br/>WORKDIR /app</span><span id="b7aa" class="je jf hi kh b fi ku kr l ks kt">RUN dvc remote modify myremote access_key_id ${AWS_ACCESS_KEY_ID}<br/>RUN dvc remote modify myremote secret_access_key ${AWS_SECRET_ACCESS_KEY}<br/>RUN dvc pull</span><span id="38d9" class="je jf hi kh b fi ku kr l ks kt">ENV PORT 8088<br/>EXPOSE $PORT</span><span id="25a9" class="je jf hi kh b fi ku kr l ks kt">CMD cp -r /app/* /voldata &amp;&amp; exec gunicorn --bind :$PORT --workers 1 --threads 8 api:app</span></pre><p id="a390" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ke kf kg kh b">FROM</code>指令，告诉docker compose使用<code class="du ke kf kg kh b">python:3.7-slim</code>作为我们的基础图像。<code class="du ke kf kg kh b">RUN</code>命令更新<code class="du ke kf kg kh b">apt</code>并安装<code class="du ke kf kg kh b">git</code>。<code class="du ke kf kg kh b">ARG</code>指令定义了我们在<code class="du ke kf kg kh b">.env</code>文件中的两个变量。</p><p id="70bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ke kf kg kh b">ADD</code>命令将文件/目录复制到文件系统的指定容器中。这里它将当前目录复制到/ <code class="du ke kf kg kh b">app</code>容器中。<code class="du ke kf kg kh b">VOLUME</code>命令告诉docker<code class="du ke kf kg kh b">/appdata</code>是一个卷。</p><p id="f6aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ke kf kg kh b">WORKDIR</code>命令用于定义Docker容器的工作目录。这里<code class="du ke kf kg kh b">/app</code>是容器的工作目录。</p><p id="14dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">DVC的AWS S3凭据应该设置在<code class="du ke kf kg kh b">.dvc/config</code>中。这两个<code class="du ke kf kg kh b">RUN</code>命令会处理这些。</p><pre class="ki kj kk kl fd km kh kn ko aw kp bi"><span id="1117" class="je jf hi kh b fi kq kr l ks kt">RUN dvc remote modify myremote access_key_id ${AWS_ACCESS_KEY_ID}<br/>RUN dvc remote modify myremote secret_access_key ${AWS_SECRET_ACCESS_KEY}<br/>RUN dvc pull</span></pre><p id="d09a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ke kf kg kh b">dvc pull</code>命令从在<code class="du ke kf kg kh b">.dvc/config</code>文件中配置的S3桶s3://dvcexample/ner中提取数据。</p><p id="1f05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">端口8088用于我们的容器。</p><pre class="ki kj kk kl fd km kh kn ko aw kp bi"><span id="db0f" class="je jf hi kh b fi kq kr l ks kt">ENV PORT 8088<br/>EXPOSE $PORT</span></pre><p id="b8ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">命令<code class="du ke kf kg kh b">CMD cp -r /app/* /voldata</code>将当前目录的所有内容复制到<code class="du ke kf kg kh b">/voldata</code>文件夹，该文件夹是我们在<code class="du ke kf kg kh b">docker-compose.yml</code>文件中声明的一个卷，其中包括使用DVC提取的数据和模型。<code class="du ke kf kg kh b">/voldata</code>中的数据可以跨容器共享。</p><pre class="ki kj kk kl fd km kh kn ko aw kp bi"><span id="6efb" class="je jf hi kh b fi kq kr l ks kt">CMD cp -r /app/* /voldata &amp;&amp; exec gunicorn --bind :$PORT --workers 1 --threads 8 api:app</span></pre><p id="ef08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ke kf kg kh b">exec --bind :$PORT --workers 1 --threads 8 api:app</code>在为<code class="du ke kf kg kh b">api.py</code>中的应用服务的8088端口运行<code class="du ke kf kg kh b">gunicorn</code></p><h2 id="cec5" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">启动和停止容器</h2><p id="77a7" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated"><code class="du ke kf kg kh b">docker-compose up</code>该命令将获取本地目录中的<strong class="ih hj"> docker-compose.yml </strong>文件，并开始构建容器。构建完成后，当我们的容器准备就绪时，它将拥有所有的数据和模型。容器启动并运行，如下所示。</p><figure class="ki kj kk kl fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kv"><img src="../Images/3b76de9c311a99739bf7bfe27157c9dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AEFKWvjooWO-ogSucKWqWg.png"/></div></div></figure><p id="b88a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以在另一个终端中使用curl命令来获取句子的NER。</p><figure class="ki kj kk kl fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es ld"><img src="../Images/82bf16cc5917a7d20f03b024aaeadf7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ppoVTMdmJveBbU7Z2jAYQA.png"/></div></div></figure><p id="e7b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ke kf kg kh b">docker-compose down </code>将停止容器。</p><h2 id="e4f4" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">参考资料:</h2><div class="le lf ez fb lg lh"><a href="https://vsupalov.com/docker-arg-env-variable-guide/" rel="noopener  ugc nofollow" target="_blank"><div class="li ab dw"><div class="lj ab lk cl cj ll"><h2 class="bd hj fi z dy lm ea eb ln ed ef hh bi translated">Docker参数、环境和。env -完整指南</h2><div class="lo l"><h3 class="bd b fi z dy lm ea eb ln ed ef dx translated">错误:Docker映像构建失败。构建Docker映像和配置您的Docker化应用程序并不一定是一件…</h3></div><div class="lp l"><p class="bd b fp z dy lm ea eb ln ed ef dx translated">vsupalov.com</p></div></div><div class="lq l"><div class="lr l ls lt lu lq lv lb lh"/></div></div></a></div><div class="le lf ez fb lg lh"><a href="https://twg.io/blog/things-i-wish-i-knew-about-docker-before-i-started-using-it/" rel="noopener  ugc nofollow" target="_blank"><div class="li ab dw"><div class="lj ab lk cl cj ll"><h2 class="bd hj fi z dy lm ea eb ln ed ef hh bi translated">我希望在开始使用Docker之前就了解它——TWG</h2><div class="lo l"><h3 class="bd b fi z dy lm ea eb ln ed ef dx translated">在这篇博文中，TWG软件工程师Nicole Chung解释了她对Docker的印象，Docker是一个开发人员用来…</h3></div><div class="lp l"><p class="bd b fp z dy lm ea eb ln ed ef dx translated">twg.io</p></div></div><div class="lq l"><div class="lw l ls lt lu lq lv lb lh"/></div></div></a></div></div></div>    
</body>
</html>