<html>
<head>
<title>Subtitle Synchronization — AI + Probabilitistc Approach to the rescue</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">字幕同步——人工智能+概率主义的救援方法</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/subtitle-synchronization-ai-probabilitistc-approach-to-the-rescue-e59e166c5f25?source=collection_archive---------19-----------------------#2020-05-25">https://medium.com/analytics-vidhya/subtitle-synchronization-ai-probabilitistc-approach-to-the-rescue-e59e166c5f25?source=collection_archive---------19-----------------------#2020-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/dc63c1f1c7caa6c03d1a111e8afcfca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VL_htU64ucmYCv8Z.png"/></div></div></figure><p id="0972" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">字幕同步是人工智能有趣的应用之一，我们很容易联想到它。</p><p id="3c26" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设你有一部外语电影，你并不知道，但你想借助字幕观看。但不幸的是，在播放视频时，视频和字幕播放之间存在同步问题，这严重影响了你的电影观看体验——破坏了你的周末:-( :-(。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jo"><img src="../Images/8cd4dcae51d23608ea53d630ff645d93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lFyq12_IbXNgJTbh.jpg"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">人工智能拯救src</figcaption></figure><p id="cc06" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">基于人工智能的解决方案可以帮助你解决这个问题。</p><p id="aa17" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是一个需要解决的有趣问题——因为它涉及音频处理、字幕(SRT)文件处理、对字幕校正的概率应用等。</p><p id="a594" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本博客旨在向您概述库中使用的字幕同步活动所涉及的概念和方法— <a class="ae jx" href="https://github.com/Subtitle-Synchronizer/SubtitleSynchronizer" rel="noopener ugc nofollow" target="_blank">字幕同步器</a>。这个库受到了另一个库'<a class="ae jx" href="https://github.com/oseiskar/autosubsync" rel="noopener ugc nofollow" target="_blank"> autosubsync </a>'的启发</p><p id="bab6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">字幕同步主要包括两个主要的处理步骤:</p><p id="0ca7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">→识别视频文件中的声乐部分。</p><p id="3270" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">→根据确定的声乐部分进行字幕定时校正。</p><h1 id="16d9" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated"><strong class="ak">人声识别</strong></h1><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kw"><img src="../Images/4218b1cc4c999008b22fa55b644efee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DSwh9B73YT16QANA.jpg"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">视频中的声部识别。<a class="ae jx" href="https://www.google.com/url?sa=i&amp;url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3Ds_LmC-ynqGM&amp;psig=AOvVaw03hZSWnHO10HO1MfziwmsZ&amp;ust=1590525735005000&amp;source=images&amp;cd=vfe&amp;ved=0CAIQjRxqFwoTCJiYrKPwz-kCFQAAAAAdAAAAABAD" rel="noopener ugc nofollow" target="_blank"> src </a></figcaption></figure><p id="9534" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">人声识别是识别视频中人声部分的过程。典型地，视频将包括各种音频信号，例如人声部分、背景音乐、无声部分等。同步的SRT文件将包含与视频的各个有声部分对齐的“字幕”记录。因此，为了纠正字幕的同步错误，第一步是识别给定视频的有声部分。</p><p id="be0e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里可以使用基于音频分类的预测模型来识别发声部分——其中音频块的mfcc值将充当特征(要了解mfcc和音频处理，请参考此处),并且可以从“同步SRT”文件中检索标签值以充当训练数据。你可以参考这个<a class="ae jx" href="https://albertosabater.github.io/Automatic-Subtitle-Synchronization/" rel="noopener ugc nofollow" target="_blank">博客</a>来获得更多关于这个方法的细节。</p><p id="44c8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是这种方法有一些固有的限制，我们主要依赖字幕文件进行标记，下面是一些限制:</p><p id="1de1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">→创建SRT文件时考虑到了观众的可读性。如果演员讲2秒钟，字幕可以用附加缓冲区显示，以便观众可以阅读。当我们以亚秒级别对音频进行分块时，这个缓冲区会破坏数据质量。</p><p id="e40f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">→ SRT档案经常为观众提及非有声音频，如“下雨”、“打雷”、“人群欢呼”等。当从这些文件创建标签时，标签会错误地将这些音频部分指示为有声部分，这将影响预测准确性。</p><p id="91d8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了克服这一点，我们可以利用“音频分离”概念从给定的视频中分离出人声部分，并通过“人声分类”模型对其进行处理，以识别人声部分。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jo"><img src="../Images/0a7558dd8d458adaadcd965b25d583bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cmkn7U9AHnepy619.jpeg"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">Deezer的Spleeter</figcaption></figure><p id="7953" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Spleeter是一个优秀的开源库，它使用深度学习技术将音轨分成人声和其他伴奏。我们将使用Spleeter来分离音轨，并将分离的音轨提供给“人声分类”预测模型，以识别音频文件中存在的人声部分。</p><p id="0bad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下图总结了从原始视频中识别声乐部分的整个过程:</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kx"><img src="../Images/e00ddcfed2cbaa31148ae99a6168f928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Iw0BAzU8sXVIs0o_UgqUDw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">与来自给定视频文件的声乐部分识别相关联的过程图</figcaption></figure><p id="6992" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> SRT文件更正:</strong></p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es ky"><img src="../Images/86912145006ee978b65fbf688dd0b1e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/0*Op4Xxwu3LTIU5P2l"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">SRT文件校正</figcaption></figure><p id="20f8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们已经确定了有声部分，下一步是根据有声部分校正/对齐字幕记录文件，使它们同步。但是对齐字幕记录并不像看起来那么简单，它需要一种概率方法来解决这个问题。</p><p id="0596" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我在这里要解释的方法来自于我对autosubsync库使用的“字幕修正”代码的理解。作者在构建这种方法方面做得非常出色——在这篇文章中，我只是描述这种方法对每个人都有好处。</p><p id="49e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们进入方法…</p><p id="cdb1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，让我们定义同步问题的原因:</p><p id="e423" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">→文件的预静态延迟和后静态延迟:考虑当您播放视频文件时，在显示相应语音内容的字幕时存在+2秒的持续延迟。这个值也可以是负数。这种延迟将是恒定的延迟，并且它将在整个视频长度中保持恒定。</p><p id="0979" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">→与帧速率相关的延迟:考虑这种情况，您的SRT文件是以25帧/秒的视频帧速率创建的，当您播放视频时，视频播放器以28帧/秒的速率播放视频。在这种情况下，与字幕显示相关的延迟会随着时间而增加。</p><p id="c6b4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了我们的分析，让我们考虑SRT档案中的一种或两种问题。我们不要在分析中考虑人为错误或不正确生成的SRT文件，因为它们在现实世界中非常罕见。</p><p id="4e79" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们已经定义了我们的问题陈述。让我们进入解决方案部分。</p><p id="b3f8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">帧率定义:</strong></p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kz"><img src="../Images/a6c1052be178f81523e635015af61345.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SeDykLk7FLJp5rdK.jpg"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">视频和SRT文件回放的帧速率是导致同步问题的原因之一。<a class="ae jx" href="https://www.google.com/url?sa=i&amp;url=https%3A%2F%2Fwww.techradar.com%2Fau%2Fnews%2Fhfr-explained-high-frame-rate-is-coming-to-tvs-heres-what-you-need-to-know&amp;psig=AOvVaw2pNhdzwfcHkiYZx96Vjjeb&amp;ust=1590526083670000&amp;source=images&amp;cd=vfe&amp;ved=0CAIQjRxqFwoTCIDToMjxz-kCFQAAAAAdAAAAABAI" rel="noopener ugc nofollow" target="_blank"> src </a></figcaption></figure><p id="c127" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">行业中通常用于视频回放的帧速率是24帧/秒、25帧/秒和28帧/秒。</p><p id="6be2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">考虑到这一点，当我们将帧速率不匹配视为一个问题时，可能会产生SRT文件，视频回放帧速率差异可能会落入以下组合中:[[24，24]，[24，25]，[24，28]，[25，24]，[25，25]，[25，28]，[28，24]，[28，25]，[28，28]]。</p><p id="039a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们将这些组合称为“不对称率”，并让我们将它们之间的比率计算如下[24/25，24/28，25/24，25/28，28/24，28/25，1/1]。</p><p id="fe8d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，如果SRT文件中因为帧速率不匹配而出现了异步问题，那么它肯定会落入上面提到的不对称速率中，这将对不匹配产生指数级影响。由于我们不知道导致问题的确切不对称率，我们不得不使用每个不对称率来处理我们的文件，并应用概率选择最佳的一个。</p><p id="c960" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">等等！！！帧速率差异是我们正在考虑的问题之一，还有一个“静态延迟”问题，我们也需要考虑进行校正。大家讨论一下怎么处理吧。</p><p id="e931" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">SRT文件上的前/后静态延迟</strong></p><p id="fa26" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如我们之前所讨论的，在我们的SRT文件中可能存在“n”秒的静态延迟，我们需要应用概率来确定该延迟。让我们考虑SRT文件中存在的范围为“+/- [0到20]秒”的延迟，并为每个值处理文件。</p><p id="12dc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">加工段:</strong></p><p id="f0ea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如前所述，我们将考虑两种问题，我们已经确定了处理输入SRT文件所用的偏斜率组合和前/后静态延迟，如下所示:</p><p id="d889" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">→偏差率组合:[24/25，24/28，25/24，25/28，28/24，28/25，1/1] —总共7个值</p><p id="65bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">→前/后静态延迟:+/-值[0至20秒] —总共41个值</p><p id="cacf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">根据上述值的组合，让我们考虑给定的SRT文件受到“24/25”的“不对称率”问题的影响，并且它具有2秒的“静态后延迟”。有了这些值，异步SRT文件将需要按照下面的等式进行移位:</p><blockquote class="la lb lc"><p id="898d" class="iq ir ld is b it iu iv iw ix iy iz ja le jc jd je lf jg jh ji lg jk jl jm jn hb bi translated">x = x*skew_rate —静态延迟</p></blockquote><p id="26ca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">其中“x”是字幕记录文件的“秒(时间)”值。</p><p id="4faa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">人声分类结果</strong></p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es lh"><img src="../Images/786e815b09c7253e87cc795bcee4fc8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:610/format:webp/0*dD6CP7MAW9C_FfYs.jpg"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">雅各布·伯努利<a class="ae jx" href="https://www.google.com/url?sa=i&amp;url=https%3A%2F%2Fwww.britannica.com%2Fbiography%2FJakob-Bernoulli&amp;psig=AOvVaw20oLfvifVfEFvfyK2u2sEU&amp;ust=1590526384299000&amp;source=images&amp;cd=vfe&amp;ved=0CAIQjRxqFwoTCOjAt9zyz-kCFQAAAAAdAAAAABAF" rel="noopener ugc nofollow" target="_blank"> src </a></figcaption></figure><p id="2916" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">由于我们不知道影响“偏斜率”和“静态延迟”的确切值，我们需要用这些值的每个组合来处理SRT文件，并通过使用“伯努利方程”比较识别的“声音分类”结果来识别最佳移位SRT文件。</p><blockquote class="la lb lc"><p id="458e" class="iq ir ld is b it iu iv iw ix iy iz ja le jc jd je lf jg jh ji lg jk jl jm jn hb bi translated">NP . sum(probs[标签])+NP . sum(1.0—probs[~标签])/float(len(标签)</p></blockquote><p id="d425" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里，</p><p id="747f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">→“probs[labels]”对应于通过视频在人声分类结果中识别的概率值，其中根据每个组合的移位SRT文件，存在“人声”部分。</p><p id="8392" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如上所述，这是“概率”概念的一个有趣的应用，用于基于声音分类结果从各种集合中识别最佳偏移的SRT文件。</p><p id="c568" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">再说一遍，我在这里解释的关于SRT文件处理的一切都来自于我对伟大的“自动同步”库的理解，以及对作者解决这个问题的赞扬。</p><p id="4ce1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请随时评论您的疑问。</p></div></div>    
</body>
</html>