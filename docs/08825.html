<html>
<head>
<title>Pseudo File Server with Google Cloud Storage and GoLang.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">伪文件服务器与谷歌云存储和 GoLang。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/pseudo-file-server-with-google-cloud-bucket-and-golang-7dacce1a3e5a?source=collection_archive---------6-----------------------#2020-08-15">https://medium.com/analytics-vidhya/pseudo-file-server-with-google-cloud-bucket-and-golang-7dacce1a3e5a?source=collection_archive---------6-----------------------#2020-08-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7d4b1a699a233ded1939d6dcc3032067.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YDj5w5i39iVO7rJsVQ1Z8A.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd iu">“你什么都不知道琼恩·雪诺”——耶哥蕊特</strong></figcaption></figure><h1 id="5e1c" class="iv iw hi bd iu ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">介绍</h1><p id="974a" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">我们知道文件服务器在 web 应用程序中的重要性。在很多情况下，我们需要制作网络资源(图片、文件等)。)可由客户端访问。</p><p id="a3a6" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">文件服务器通常不代表其客户端工作站执行计算任务或运行程序。<br/>文件服务器常见于办公室，用户使用<a class="ae kv" href="https://en.wikipedia.org/wiki/Local_area_network" rel="noopener ugc nofollow" target="_blank">局域网</a>连接他们的客户端计算机以访问资源。<br/>它是存放贵公司数据的地方。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kw"><img src="../Images/f15ec35fa01a71145b7583b92bea88fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8xIOmBh6eFWb894xTWY2rQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">当你内心发生变化时，你周围的事情也会发生变化。<strong class="bd iu"> ―未知</strong></figcaption></figure><p id="e8a7" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">在技术和公共云的新兴时代，类似的设置可以迁移到公共云。</p><p id="8355" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">谷歌云产品(GCP)以谷歌云存储(GCS)的形式提供了这样一种产品。</p><p id="aaad" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated"><strong class="ju hj">谷歌云存储(GCS) </strong>是一个<a class="ae kv" href="https://en.wikipedia.org/wiki/Representational_state_transfer" rel="noopener ugc nofollow" target="_blank"> RESTful </a> <a class="ae kv" href="https://en.wikipedia.org/wiki/Online_file_storage" rel="noopener ugc nofollow" target="_blank">在线文件存储</a> <a class="ae kv" href="https://en.wikipedia.org/wiki/Web_service" rel="noopener ugc nofollow" target="_blank"> web 服务</a>用于存储和访问<a class="ae kv" href="https://en.wikipedia.org/wiki/Google_Cloud_Platform" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>基础设施上的数据。该服务将谷歌云的性能和可扩展性与高级安全和共享功能相结合。这是一个<em class="lb">基础设施即服务</em> ( <a class="ae kv" href="https://en.wikipedia.org/wiki/Infrastructure_as_a_service#Infrastructure" rel="noopener ugc nofollow" target="_blank"> IaaS </a>)，堪比<a class="ae kv" href="https://en.wikipedia.org/wiki/Amazon_S3" rel="noopener ugc nofollow" target="_blank">亚马逊 S3 </a>在线存储服务。</p><p id="78dd" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">GoLang 因其易用性和高度并发性而越来越受欢迎。</p><p id="6c77" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">在本文中，我们将使用 GoLang 构建一个简单的 web 服务客户端，它将使用 Google Cloud Bucket 作为存储。<br/>我们将构建几个端点，用于从 Google bucket 存储和检索文档。</p><p id="0120" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">那么，让我们开始吧…</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/94bc3d0e8f8e40b9d53e0a887ee36fec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cIhBnPf3jG9B-YfRwZdwug.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">“只要记得打开灯，即使在最黑暗的时候也能找到幸福。”――阿不思·邓布利多</figcaption></figure><h1 id="e30f" class="iv iw hi bd iu ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated"><strong class="ak">设置</strong></h1><p id="62b7" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">我们将为 Golang 使用 GCS 云库。<br/>您可以通过在 mac 或等效 CLI 上的终端中运行以下命令来下载依赖项。</p><ol class=""><li id="a527" class="ld le hi ju b jv kq jz kr kd lf kh lg kl lh kp li lj lk ll bi translated">获取谷歌云图书馆。</li></ol><pre class="kx ky kz la fd lm ln lo lp aw lq bi"><span id="7aae" class="lr iw hi ln b fi ls lt l lu lv">go get -v cloud.google.com/go/storage</span></pre><p id="dfaa" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">2.从你的<a class="ae kv" href="https://cloud.google.com/docs/authentication/getting-started" rel="noopener ugc nofollow" target="_blank">谷歌控制台账户</a>下载服务账户凭证。</p><p id="5b5a" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">3.设置以下环境变量，以便您的客户端可以访问服务帐户。</p><pre class="kx ky kz la fd lm ln lo lp aw lq bi"><span id="2ef6" class="lr iw hi ln b fi ls lt l lu lv">Set <strong class="ln hj">export</strong><em class="lb"> </em><strong class="ln hj">GOOGLE_APPLICATION_CREDENTIALS=[PATH]<em class="lb"> </em></strong>as ENV variable, where [PATH] is the location of google credentials on file system.</span></pre><h1 id="1f43" class="iv iw hi bd iu ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated"><strong class="ak">功能</strong></h1><p id="64a0" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">我们将添加以下功能作为云集成的一部分。</p><ul class=""><li id="5d70" class="ld le hi ju b jv kq jz kr kd lf kh lg kl lh kp lw lj lk ll bi translated">上传功能，将采取多种形式的数据作为输入，并上传到谷歌存储。</li><li id="fba0" class="ld le hi ju b jv lx jz ly kd lz kh ma kl mb kp lw lj lk ll bi translated">下载功能，它将资源链接作为请求的一部分，并通过从 GCS 获取资源来返回相应的资源。</li><li id="c70e" class="ld le hi ju b jv lx jz ly kd lz kh ma kl mb kp lw lj lk ll bi translated">此外，我们将创建一个单例存储客户机，作为连接 API 和 GCS 的桥梁。</li></ul><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/bfacb0d413fc4b820ca409c88a58eb3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*20C3i9nw9QjGM-gl9Yo11Q.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">世界是一本书，那些不旅行的世卫组织人只读了其中的一页~圣奥古斯丁</figcaption></figure><blockquote class="mc md me"><p id="eccc" class="js jt lb ju b jv kq jx jy jz kr kb kc mf ks kf kg mg kt kj kk mh ku kn ko kp hb bi translated">创建将用于所有云交互的单一存储客户端。</p></blockquote><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="mi mj l"/></div></figure><h1 id="19b6" class="iv iw hi bd iu ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">文件上传</h1><p id="c56e" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">上传功能实现。这将把多表单数据作为请求的一部分，并将其存储到 GCS。</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="mi mj l"/></div></figure><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/60478e9625b46ea47284b0195a20f099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R-0ahqo2OZg1X-hDapYixw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd iu">“我们不是从祖先那里继承了地球，我们是从子孙那里借来的。”</strong></figcaption></figure><h1 id="be06" class="iv iw hi bd iu ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">文件下载</h1><p id="1ae4" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">这是下载功能，它将资源名作为路径参数。我们将返回一组响应头作为响应的一部分。<br/>假设客户端在大多数情况下是浏览器，我们可以设置一个名为<em class="lb"> Content-Disposition </em>的附加头，该头将以<code class="du ml mm mn ln b">&lt;disposition-type&gt;;<em class="lb"> </em>filename=&lt;file-name&gt;</code> <em class="lb"> </em>的形式取值，其中<code class="du ml mm mn ln b">&lt;disposition-type&gt;</code> <em class="lb"> </em>可以取值为<code class="du ml mm mn ln b"><strong class="ju hj">inline</strong></code>以内联方式呈现内容，也可以取值为<code class="du ml mm mn ln b"><strong class="ju hj">attachment</strong></code> <strong class="ju hj"> <em class="lb"> </em> </strong>以附件方式下载内容。</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="mi mj l"/></div></figure><h1 id="0e23" class="iv iw hi bd iu ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">路线</h1><p id="6bb0" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">我们将分别为上传和下载端点配置两条路由。</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="mi mj l"/></div></figure><h1 id="e347" class="iv iw hi bd iu ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">最后</h1><p id="9850" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">这是最后的主文件。试试吧！！！</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="mi mj l"/></div></figure></div><div class="ab cl mo mp gp mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hb hc hd he hf"><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mv"><img src="../Images/3c521c5f9a56ea5e0a341697533fe609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lCyLOu9oSdv6_r_3LjW5YQ.jpeg"/></div></div></figure><h1 id="2e6a" class="iv iw hi bd iu ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">谢谢大家！编码快乐！！！</h1></div></div>    
</body>
</html>