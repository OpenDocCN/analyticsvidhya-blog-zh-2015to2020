<html>
<head>
<title>Automation Deployment using CI/CD Pipelines (With Docker builder, Git Submodules, and Amazon Web Service)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CI/CD管道的自动化部署(使用Docker builder、Git子模块和Amazon Web Service)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/automation-deployment-using-ci-cd-pipelines-with-docker-builder-git-submodules-and-amazon-web-ecd09a38f14?source=collection_archive---------3-----------------------#2020-04-09">https://medium.com/analytics-vidhya/automation-deployment-using-ci-cd-pipelines-with-docker-builder-git-submodules-and-amazon-web-ecd09a38f14?source=collection_archive---------3-----------------------#2020-04-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/77de2667111b732bf5a67d44959822ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*LioG7l9MpRfdmHtOjRpYDQ.jpeg"/></div></figure><p id="d117" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> CI/CD管道</strong></p><p id="1437" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">部署过程是通过利用docker服务将产品放置在客户端的服务器(premis)或云服务上，以获得一些相关的依赖。作为docker服务的输出，docker映像将作为docker容器在每个服务器上运行。在先进技术领域，技术部署应该快速、准确和可靠。过去我们习惯于手工构建系统，但现在CI管道可以提供系统构建器和打包器。</p><p id="8895" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">CI(持续集成)是如何使我们的应用程序在同一个过程中自动构建或运行并到达同一个地方的方法。CI渠道通常必须包括5个阶段(构建阶段、测试、部署、最终测试、生产部署)，但在这种情况下，我们总结为3个阶段。构建、模块和部署。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es jk"><img src="../Images/639245d73ed5e8c387407ad07807fd45.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*dk4C5jBhqUgmzBCf9eMYZw.png"/></div></figure><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es jp"><img src="../Images/4378bd2061f752b45652c03940dcc5e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/1*plcGedh92ymRK2AAadBllg.png"/></div></figure><p id="61ec" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">添加变量</strong></p><pre class="jl jm jn jo fd jq jr js jt aw ju bi"><span id="1b62" class="jv jw hi jr b fi jx jy l jz ka">IMAGE_DEVELOPMENT : images development name</span><span id="5cff" class="jv jw hi jr b fi kb jy l jz ka">IMAGE_RELEASE: images production name</span><span id="3ccc" class="jv jw hi jr b fi kb jy l jz ka">IMAGE_TAG_DEVELOPMENT: image development tag</span><span id="fef9" class="jv jw hi jr b fi kb jy l jz ka">IMAGE_TAG_RELEASE: image production tag</span></pre><p id="df0e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">变量:</strong></p><pre class="jl jm jn jo fd jq jr js jt aw ju bi"><span id="3698" class="jv jw hi jr b fi jx jy l jz ka"><strong class="jr hj">IMAGE_DEVELOPMENT:group/project/image</strong></span><span id="95b0" class="jv jw hi jr b fi kb jy l jz ka"><strong class="jr hj">IMAGE_RELEASE:$CI_REGISTRY/group/project/image</strong></span><span id="8b16" class="jv jw hi jr b fi kb jy l jz ka"><strong class="jr hj">IMAGE_TAG_DEVELOPMENT:dev</strong></span><span id="a00e" class="jv jw hi jr b fi kb jy l jz ka"><strong class="jr hj">IMAGE_TAG_RELEASE:v1.0.0</strong></span></pre><p id="f22a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">阶段构建</strong></p><p id="30c6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在阶段构建中，我们将docker文件构建为开发映像，然后将该映像docker推送到本地注册表或其他服务中。当代码被推送到存储库、运行unittest和cythonize每个依赖项时，这个阶段被触发。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kc"><img src="../Images/38ced4ee7fbfe200f4324e44e1fcca1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:242/format:webp/1*AUS3g8ctO4cRTBWRlbzvww.png"/></div></figure><pre class="jl jm jn jo fd jq jr js jt aw ju bi"><span id="6ef5" class="jv jw hi jr b fi jx jy l jz ka">docker build -f Dockerfile --squash --build-arg SSH_PRIVATE_KEY=<br/>"${SSH_PRIVATE_KEY}" -t $IMAGE_DEVELOPMENT:$IMAGE_TAG_DEVELOPMENT .</span></pre><p id="a5d7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">相位模块</strong></p><p id="c98b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">子模块是作为模块添加到另一个git存储库中的存储库。这个特性允许您将其他存储库分开，但仍然引用它们。如果您有一些项目更新，使用子模块更新命令。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kc"><img src="../Images/dc00528b0b46003d4fd6ad21e94a914f.png" data-original-src="https://miro.medium.com/v2/resize:fit:242/format:webp/1*inV9FUKUHFtsTHTmEY7MiQ.png"/></div></figure><pre class="jl jm jn jo fd jq jr js jt aw ju bi"><span id="bae5" class="jv jw hi jr b fi jx jy l jz ka">git submodule add url_repos_project folder1/folder2/project-module</span></pre><ul class=""><li id="024b" class="kd ke hi io b ip iq it iu ix kf jb kg jf kh jj ki kj kk kl bi translated">你制作了folder 1/folder 2/project _ modules并生成。gitmodules文件</li></ul><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es km"><img src="../Images/d2dfd919641da968853762ae15b6c919.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*om7w9m5To3k5XkJId6NV1g.png"/></div></figure><ul class=""><li id="2954" class="kd ke hi io b ip iq it iu ix kf jb kg jf kh jj ki kj kk kl bi translated">编辑。gitmodules文件并从许可证模块添加当前分支/标签。</li></ul><pre class="jl jm jn jo fd jq jr js jt aw ju bi"><span id="97c0" class="jv jw hi jr b fi jx jy l jz ka">[submodule “folder1/folder2/project-module”]</span><span id="9f14" class="jv jw hi jr b fi kb jy l jz ka">path = folder1/folder2/project-module</span><span id="9700" class="jv jw hi jr b fi kb jy l jz ka">url = https://gitserver.com/group/project-module.git</span></pre><ul class=""><li id="25db" class="kd ke hi io b ip iq it iu ix kf jb kg jf kh jj ki kj kk kl bi translated">更新配置项中的子模块</li></ul><p id="7598" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当您使用<em class="kn">子模块更新-远程</em>时。更新仅发生在您注册的分行。gitmodules文件。</p><pre class="jl jm jn jo fd jq jr js jt aw ju bi"><span id="03b7" class="jv jw hi jr b fi jx jy l jz ka">git submodule init</span><span id="70e0" class="jv jw hi jr b fi kb jy l jz ka">git submodule update --init --recursive</span><span id="ef79" class="jv jw hi jr b fi kb jy l jz ka">git submodule update --remote</span></pre><p id="a526" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">阶段部署</strong></p><p id="923d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Amazon Web服务提供了映像dockers存储，以简化不同位置一致性和远程部署步骤。映像部署是您用作生产的映像，包括许可证。第一步。在docker映像上安装aws cli并登录aws控制台，如果您使用aws服务，请获取其他映像。将图像推送到runner注册表服务器和gitlab注册表，然后删除runner服务器中的其他图像。确保该服务器始终保持清洁。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es ko"><img src="../Images/f0e04922ba35c0c488dd2356078b9196.png" data-original-src="https://miro.medium.com/v2/resize:fit:244/format:webp/1*nj5yxVkpcFDTP6sX7Cjhsg.png"/></div></figure><ul class=""><li id="4b03" class="kd ke hi io b ip iq it iu ix kf jb kg jf kh jj ki kj kk kl bi translated">登录aws控制台</li></ul><pre class="jl jm jn jo fd jq jr js jt aw ju bi"><span id="9423" class="jv jw hi jr b fi jx jy l jz ka">$(aws ecr get-login --no-include-email --region “regional-user”)</span></pre><ul class=""><li id="93bd" class="kd ke hi io b ip iq it iu ix kf jb kg jf kh jj ki kj kk kl bi translated">转到许可证路径，使用以下命令重建映像</li></ul><pre class="jl jm jn jo fd jq jr js jt aw ju bi"><span id="28de" class="jv jw hi jr b fi jx jy l jz ka">docker build --squash --build-arg SSH_PRIVATE_KEY="${SSH_PRIVATE_KEY}" --build-arg     IMG_NAME="${IMAGE_DEVELOPMENT}:${IMAGE_TAG_DEVELOPMENT}" -t $IMAGE_RELEASE:$IMAGE_TAG_RELEASE .</span></pre><p id="a79c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">构建过程完成后。下一步，QA团队进行产品最终测试并发布产品报告。使用CI渠道更有价值，每个团队可以推动更多的改进。所有参与这个项目的开发人员总是注意到并不断重复。这就是为什么我们应该移动并重复我们生产系统的方式。</p></div></div>    
</body>
</html>