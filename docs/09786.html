<html>
<head>
<title>Data Reconciliation in Spark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spark 中的数据协调</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/data-reconciliation-in-spark-b185c6a2952b?source=collection_archive---------5-----------------------#2020-09-20">https://medium.com/analytics-vidhya/data-reconciliation-in-spark-b185c6a2952b?source=collection_archive---------5-----------------------#2020-09-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/cc17c1c35b764720a514cd8adf934d63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LPe9SCnSiDQXq99R.png"/></div></div></figure><p id="7666" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数据协调被定义为在数据迁移期间验证数据的过程。在此过程中，将目标数据与源数据进行比较，以确保迁移按预期进行。</p><h2 id="68c1" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated"><strong class="ak">需要数据对账</strong></h2><ul class=""><li id="f7fe" class="kj kk hi is b it kl ix km jb kn jf ko jj kp jn kq kr ks kt bi translated">没有数据验证，你不能相信你的数据。</li><li id="34de" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated">比较记录数和填充率并不总是有效的。</li><li id="b756" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated">不可信的数据导致有缺陷的见解。</li></ul><p id="2c30" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">数据核对器</strong>是一个数据核对工具，检查你的数据的准确性。在向您介绍技术实现之前，我想向您展示一下协调工具的输出。您可以按照下一节中的说明自己运行这段代码。</p><p id="7bb6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输入数据集有 4 个字段，记录数为 5000 万条，大小约为 1 GB，采用拼花格式。在对这个数据集执行协调之后，我们得到以下输出。</p><figure class="kz la lb lc fd ij"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="d804" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上述输出提供了以下信息。</p><ul class=""><li id="3810" class="kj kk hi is b it iu ix iy jb lf jf lg jj lh jn kq kr ks kt bi translated"><strong class="is hj">匹配记录计数</strong>(记录 6) —两个数据集中主键匹配的记录数。换句话说，在数据集之间执行内部连接后的记录计数。该值将用作计算每列匹配记录百分比的分母。</li><li id="ebb4" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated"><strong class="is hj">丢弃的记录</strong>(记录 7)——旧表中存在但新表中不存在的记录数。换句话说，左反连接的输出。</li><li id="7a18" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated"><strong class="is hj">新记录</strong>(记录 8)——新表中存在但旧表中不存在的记录数。</li><li id="9eb6" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated"><strong class="is hj">旧文件路径</strong>(记录 9) —旧表中的实际记录数。</li><li id="caa1" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated"><strong class="is hj">新文件路径</strong>(记录 10) —新表中的实际记录数。</li><li id="efd5" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated"><strong class="is hj">字段名</strong>(列 1) —包含旧表中可用的每一列。</li><li id="6b50" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated"><strong class="is hj">匹配记录数</strong>(第 2 列)—新旧两列中值相同的记录数。</li><li id="c184" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated"><strong class="is hj">不匹配记录数</strong>(第 3 列)—新旧两列中值不同的记录数。</li><li id="ea8e" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated"><strong class="is hj">匹配记录百分比</strong>(第 4 列)—单个列的匹配记录数/数据集之间的匹配记录数(记录 6)</li></ul><h2 id="a83e" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">如何运行数据协调器？</h2><p id="737d" class="pw-post-body-paragraph iq ir hi is b it kl iv iw ix km iz ja jb li jd je jf lj jh ji jj lk jl jm jn hb bi translated">数据协调器的源代码可在<a class="ae ll" href="https://github.com/tharun026/SparkDataReconciler" rel="noopener ugc nofollow" target="_blank"> github </a>中获得。目前，该工具只支持 Parquet 格式的数据，数据应该有一个主键或主键的组合。如果需要，您可以下载代码并添加定制，然后构建它。一旦有了 jar，就可以将其加载到大数据环境中，并使用命令触发作业</p><pre class="kz la lb lc fd lm ln lo lp aw lq bi"><span id="8e8b" class="jo jp hi ln b fi lr ls l lt lu">/usr/lib/spark/bin/spark-submit --deploy-mode cluster --executor-cores 5 --name Data_Reconciliation --class com.github.tharun.datareconciler.Pipeline {JAR_PATH} --qualityCheckType reconciler --oldTable {PATH_OF_OLD_DATA} --newTable {PATH_OF_NEW_DATA} --outputPath {PATH_OF_OUTPUT_DATA} --primaryKey {COMMA_SEPARATED_PRIMARY_KEYS}</span></pre><h2 id="037c" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">参数:</h2><ul class=""><li id="a2fb" class="kj kk hi is b it kl ix km jb kn jf ko jj kp jn kq kr ks kt bi translated"><em class="lv">执行器内核</em> — 5。这是为了实现并行性和相等负载的平衡。</li><li id="5704" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated"><em class="lv">名称</em> —数据 _ 对账。你的火花工作的名字。</li><li id="1e5f" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated"><em class="lv">类</em>—com . github . tharun . data reconciler . pipeline . spark 作业的主类或入口点。</li><li id="ddf2" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated"><em class="lv"> JAR_PATH </em> —放置罐子的路径。</li><li id="c310" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated"><em class="lv">质量检查类型</em> —调解器。用于触发代码的协调部分。</li><li id="53a7" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated"><em class="lv">旧表</em> —旧数据的路径。存储旧数据集的路径。</li><li id="8c12" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated"><em class="lv">新表</em> —新数据的路径。存储新数据集的路径。</li><li id="f663" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated"><em class="lv">主键</em> —逗号分隔的主键列名。</li></ul><h2 id="ccdc" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">技术实现</h2><p id="9c69" class="pw-post-body-paragraph iq ir hi is b it kl iv iw ix km iz ja jb li jd je jf lj jh ji jj lk jl jm jn hb bi translated">一旦输入了两个数据集，它们就会基于主键被连接起来。现在，对于每条记录，如果列“A”中的值与列“B”中的值匹配，则创建一个值为“1”的新列，如果值不匹配，则用值“0”填充新列。这个新列的总和给出了每一列的匹配记录总数。一旦我们有了匹配的记录计数，就可以计算不匹配记录计数、匹配百分比等其他值。</p><h2 id="2d88" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">运行时统计</h2><h2 id="086f" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated"><em class="lw">数据集 1 </em></h2><ul class=""><li id="1ce4" class="kj kk hi is b it kl ix km jb kn jf ko jj kp jn kq kr ks kt bi translated">五千万张唱片</li><li id="53e5" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated">镶木地板 6 GB</li><li id="8238" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated">170 列</li><li id="e3af" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated">AWS r5.12x 大型— 5 个节点</li><li id="27c4" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated">3 分钟运行时间</li></ul><h2 id="6f88" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">数据集 2</h2><ul class=""><li id="fe33" class="kj kk hi is b it kl ix km jb kn jf ko jj kp jn kq kr ks kt bi translated">3.5 亿条记录</li><li id="00ce" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated">镶木地板 30 GB</li><li id="d710" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated">170 列</li><li id="c6f3" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated">AWS r5.12x 大型— 10 个节点</li><li id="ed6c" class="kj kk hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated">6 分钟运行时间</li></ul><p id="f81f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Github 网址—<a class="ae ll" href="https://github.com/tharun026/SparkDataReconciler" rel="noopener ugc nofollow" target="_blank">https://github.com/tharun026/SparkDataReconciler</a></p><p id="45c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有问题吗？在这里随意评论。</p><p id="d1cc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你喜欢这篇文章，请点击👏所以其他人会在媒体上看到它。</p></div></div>    
</body>
</html>