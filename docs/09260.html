<html>
<head>
<title>Using SQL syntax to pull data from Pandas Dataframes in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 SQL 语法从 Python 中的 Pandas 数据帧中提取数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/using-sql-syntax-to-pull-data-from-pandas-dataframes-in-python-8497772e1045?source=collection_archive---------17-----------------------#2020-08-30">https://medium.com/analytics-vidhya/using-sql-syntax-to-pull-data-from-pandas-dataframes-in-python-8497772e1045?source=collection_archive---------17-----------------------#2020-08-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1a8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">*如果您了解 SQL 并熟悉其语法，您可能会发现这篇博客文章在使用 Pandas 数据框时很有帮助。*</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="a723" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从多个 pandas 数据框中收集数据可能是一件令人头疼的事情，尤其是如果您不熟悉 Python 并且不熟悉 Pandas 的话。然而，有一个名为 pandasql 的简洁包可以简化这一切。有点像翻译器，Pandasql 能够接受用 sql 语法编写的查询，并将它们应用于 Pandas 数据帧。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="534d" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">设置 pandasql</h1><p id="a04a" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">首先，需要安装 pandasql。为此，您只需在终端中运行这一行:</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="51eb" class="kw jl hi ks b fi kx ky l kz la">$ pip install -U pandasql</span></pre><p id="716c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后可以将包导入 python，如下所示:</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="3138" class="kw jl hi ks b fi kx ky l kz la">from pandasql import sqldf</span></pre><p id="8022" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">sqldf 使用两个参数来运行。第一个是表示为<strong class="ih hj"> q </strong>的查询，第二个是一组会话/环境变量<strong class="ih hj"> (locals()或 globals()) </strong>。可以创建一个快捷函数来帮助简化事情，这样我们就不必一直输入第二个参数:</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="715d" class="kw jl hi ks b fi kx ky l kz la">pysqldf = lambda q: sqldf(q, globals())</span></pre><p id="120a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们都设置好了。Pandasql 能够自动检测数据帧，因此只要在查询中正确键入名称，该函数就应该工作。我们唯一要做的就是编写查询并通过 pysqldf 传递它。</p><p id="9586" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么什么是查询呢？查询基本上是对信息的请求。使用查询可以做很多事情，但是基本结构可以分为三部分:</p><ul class=""><li id="e5b3" class="lb lc hi ih b ii ij im in iq ld iu le iy lf jc lg lh li lj bi translated">选择—这是我们想要的信息</li><li id="dc88" class="lb lc hi ih b ii lk im ll iq lm iu ln iy lo jc lg lh li lj bi translated">自-这是信息所在的数据框</li><li id="a09a" class="lb lc hi ih b ii lk im ll iq lm iu ln iy lo jc lg lh li lj bi translated">其中—这是我们要选择的条件</li></ul><h1 id="b1fd" class="jk jl hi bd jm jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh bi translated">现在，让我们浏览一些数据帧，看看它们是如何组合在一起的。</h1><p id="5423" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">免责声明:数据框中的信息是出于这些示例的目的而编造的。</p><figure class="kn ko kp kq fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es lu"><img src="../Images/fec3fb7d07f7a43b513ddd8938c9caeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7lmz_UPTfyx2eAH9eq9-AQ.png"/></div></div><figcaption class="mc md et er es me mf bd b be z dx translated">设置第一个数据帧</figcaption></figure><p id="da7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们编写一个查询，它将从数据帧(来自 DogsLifespan)中选择生命周期等于或大于 10(其中生命周期≥10)的所有列(SELECT *)。</p><figure class="kn ko kp kq fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mg"><img src="../Images/acd63b529c7d528afb7eaeed5b6fe725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Wr3-7so-AgbPnUFHGOuwg.png"/></div></div></figure><p id="618f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太好了！我们看到我们能够选择正确的狗品种。查询语法的编写方式与在 SQL 数据库中的编写方式完全相同。现在，假设我们有一个新的表格，上面有狗的尺寸，我们想知道大狗的寿命。</p><figure class="kn ko kp kq fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mh"><img src="../Images/820c92e13af7fb5fc36620dceec25da7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7MR2E2ezbC5ZWprn5RQAsA.png"/></div></div><figcaption class="mc md et er es me mf bd b be z dx translated">设置第二数据帧</figcaption></figure><p id="adf8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在查询中，我们可以使用语句 JOIN 来组合数据帧。JOIN 语句通过使用包含相同类型信息的列来联接数据框。在本例中，我们可以使用名为“品种”的列。在同一个查询中，我们还将选择 20 英寸或更高的狗的品种和寿命。</p><figure class="kn ko kp kq fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mi"><img src="../Images/79778055b5f8ed202472f0f77de80199.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z4rOON_xUGzvGtNvtmQNhQ.png"/></div></div></figure></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="fd2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以上两个例子非常简单，但是您可以想象使用 SQL 语法是如何快速简便地从大型/多个数据框中收集数据的。</p></div></div>    
</body>
</html>