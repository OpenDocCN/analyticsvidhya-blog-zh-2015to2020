<html>
<head>
<title>Introduction to Machine Learning in Google BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google BigQuery中的机器学习介绍</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/introduction-to-machine-learning-in-google-bigquery-452194ec2bed?source=collection_archive---------10-----------------------#2020-04-08">https://medium.com/analytics-vidhya/introduction-to-machine-learning-in-google-bigquery-452194ec2bed?source=collection_archive---------10-----------------------#2020-04-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7a9966a0a018f43e204ce087ded6e99a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pi5TvCc8YU03wYEQSjX1Rg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">BigQuery机器学习</figcaption></figure><p id="faad" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Google将BigQuery描述为"<strong class="iw hj">一个无服务器、高度可扩展且经济高效的云数据仓库，旨在帮助您快速做出明智的决策，从而轻松实现业务转型</strong></p><p id="2d97" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然而，在机器学习方面，BigQuery提供了更多的东西。BigQuery平台在使用标准SQL语法存储在BigQuery中的数据之上提供机器学习功能。</p><p id="49e1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们将研究使用样本IRIS数据集在BigQuery中构建机器学习模型有多容易。</p><p id="5c85" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">用例</strong>:我们将尝试建立一个模型，根据4个输入特征，即萼片长度、萼片宽度、花瓣长度、花瓣宽度，来预测花的种类。</p><p id="5103" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">数据集</strong>:<a class="ae js" href="https://gist.github.com/387878da45a36d32e4ccced3c6cad3ef.git" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/387878 da 45 a 36d 32 e 4 cc ced 3c 6 CAD 3 ef . git</a></p><ul class=""><li id="8adf" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">在GCP平台中创建一个名为“机器学习”的新项目。(<strong class="iw hj"> <em class="kc">注意:你也可以继续你现有的项目。但是，如果您正在进行POC，您可以创建一个新项目，以便在POC结束时将其删除，从而确保与POC相关的所有资源也被删除。</em> </strong>)</li><li id="ab05" class="jt ju hi iw b ix kd jb ke jf kf jj kg jn kh jr jy jz ka kb bi translated">下载虹膜数据集。请查看下面关于数据集外观的快照:</li></ul><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ki"><img src="../Images/26d2673d5f87be0e5ed3d8f539e35a46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7TT_cO6UNNJ-1Ley9-vHAQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">虹膜数据集</figcaption></figure><ul class=""><li id="9e5d" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">在GCS中创建一个bucket，并上传bucket中的数据(CSV格式)。你可以在https://cloud.google.com/storage<a class="ae js" href="https://cloud.google.com/storage" rel="noopener ugc nofollow" target="_blank">阅读更多关于谷歌云存储的信息</a></li></ul><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/d13f79d6c2632ddf982c0359c7b44fdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nBXcV6wTwb1FJEdQDYh1Cw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">将IRIS数据集文件上传到GCS存储桶</figcaption></figure><ul class=""><li id="e751" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">转到BigQuery Web UI。你可以在https://cloud.google.com/bigquery阅读更多关于BigQuery的内容</li></ul><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/978ebd21ac3c68c8ecb3aa28f7dd4490.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V3fYe4Y8fYIKrFzcg4gn9Q.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">BigQuery WebUI</figcaption></figure><ul class=""><li id="4059" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">在新创建的项目下创建一个名为“irisdataset”的新数据集。您可以根据自己的需求选择合适的位置。你可以在https://cloud.google.com/bigquery/docs/datasets-intro阅读更多关于BigQuery数据集的信息</li></ul><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/e766efb7b2b0a19afee55c82554f5471.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w3OSZxEuhZusZDGeFi9i3g.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">创建数据集</figcaption></figure><ul class=""><li id="f336" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">单击“irisdataet ”,然后在BigQuery WebUI中单击“Create Table”。</li></ul><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/b9c83178a22da9ffb9d567c50386ef4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BuN2g-yvTAW3QeeAjjKiSg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">在数据集中创建表</figcaption></figure><ul class=""><li id="46a5" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">如前所述设置创建表属性:"创建表自"-&gt; "Google云存储"，"从GCS桶中选择文件"-&gt; " &lt;<path to="" the="" gcs="" file="">&gt; " "文件格式"-&gt; "CSV "，"项目名称"-&gt; " &lt;<name of="" your="" project="">&gt; " "数据集名称"-&gt; "irisdateset "，"表类型"-&gt; "本地表"，"表名"-&gt; "irisdata "，"模式和输入参数"-&gt; "启用复选框"</name></path></li></ul><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/33e86bce49183b63e8e238ec7c4f8eef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZvAsNqLi7B4sM05pu4qgMQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">创建表属性</figcaption></figure><ul class=""><li id="ad2c" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">在“高级选项”下，将“要跳过的标题行”的值设置为1。你可以在https://cloud.google.com/bigquery/docs/tables-intro阅读更多关于BigQuery表的信息</li></ul><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/5a5dc587d775271bab4573c3e9ce07d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*An4RBhPlA-RD1Rhyp8grsw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">将要跳过的标题行设置为“1”</figcaption></figure><ul class=""><li id="6174" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">通过运行以下查询，验证表“irisdata”是否已按照下面的快照导入了所需数据</li></ul><pre class="kj kk kl km fd ko kp kq kr aw ks bi"><span id="7ab6" class="kt ku hi kp b fi kv kw l kx ky">SELECT<br/>  *<br/>FROM<br/>  `&lt;&lt;ProjectID&gt;&gt;.irisdataset.irisdata`<br/>LIMIT<br/>  1000</span></pre><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/a9c11d18c593adcf0ad5a1ff7e6da740.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8W5f81hxyP_fyNcHeGnPKQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">BigQuery表输出</figcaption></figure><ul class=""><li id="0ffd" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">现在我们将在这些数据的基础上创建一个机器学习模型。你可以在https://cloud.google.com/bigquery-ml/docs/bigqueryml-intro<a class="ae js" href="https://cloud.google.com/bigquery-ml/docs/bigqueryml-intro" rel="noopener ugc nofollow" target="_blank">的</a>阅读更多关于BigQuery机器学习的内容</li><li id="a898" class="jt ju hi iw b ix kd jb ke jf kf jj kg jn kh jr jy jz ka kb bi translated">请执行以下语句来创建机器学习模型。一旦执行，它将在irisdataset下创建一个训练好的模型“irisdata_model”。上面的链接还提供了BigQuery支持的机器学习模型。你可以在<a class="ae js" href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create#model_option_list" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/big query-ml/docs/reference/standard-SQL/bigqueryml-syntax-CREATE # MODEL _ option _ list</a>了解更多关于CREATE MODEL语句的信息</li></ul><pre class="kj kk kl km fd ko kp kq kr aw ks bi"><span id="a3dc" class="kt ku hi kp b fi kv kw l kx ky">CREATE OR REPLACE MODEL<br/>  `irisdataset.irisdata_model`<br/>OPTIONS<br/>  ( model_type='LOGISTIC_REG',<br/>    auto_class_weights=TRUE,<br/>    data_split_method='NO_SPLIT',<br/>    input_label_cols=['species'],<br/>    max_iterations=10) AS<br/>SELECT<br/>  *<br/>FROM<br/>  `irisdataset.irisdata`</span></pre><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/24a50b10959d5b48f4da19175d46f94e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hEw0KRRd8s-ZUVhftmvQjw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">模型创建查询</figcaption></figure><ul class=""><li id="b76f" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">我们可以通过点击“细节”标签来找到关于机器学习模型的信息，从而获得模型细节</li></ul><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/790bb5175776e60448b6bf132cf42908.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J-jnf7ddgNUq5UidhoUThw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">模型细节</figcaption></figure><ul class=""><li id="48a6" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">我们可以通过点击“训练”标签来找到关于机器学习模型的训练信息，从而获得模型的训练信息。</li></ul><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kz"><img src="../Images/7bbda2b2b07b6bcc3aaf23883ff1125b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D56gGrDTjIa0JMrgw7cxJw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">模型训练信息</figcaption></figure><ul class=""><li id="bb66" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">我们可以通过点击“评估”标签来找到关于机器学习模型的训练信息，从而获得模型的评估信息。</li></ul><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es la"><img src="../Images/d6137bd768b695df84fdf77e9a803679.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y3NIlzaLor0mocu_fD5_ng.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">模型评估信息</figcaption></figure><ul class=""><li id="8ca0" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">我们可以通过点击schema选项卡找到关于机器学习模型的训练信息来获得模型的schema信息。</li></ul><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/9bbff0aa7aeccb65a306ebc57d915dc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EpLCkly0RFS4p-v-VjoZIg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">模型架构详细信息</figcaption></figure><ul class=""><li id="a1a2" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">现在模型创建好了，我们可以用它来预测任何输入数据或大查询中存储的数据的物种。现在我们来看看如何做预测。让我们看看如何对任何输入数据进行处理。</li></ul><pre class="kj kk kl km fd ko kp kq kr aw ks bi"><span id="a1b4" class="kt ku hi kp b fi kv kw l kx ky">SELECT<br/>  *<br/>FROM<br/>  ML.PREDICT (MODEL `irisdataset.irisdata_model`,<br/>    (<br/>    SELECT<br/>      5.1 AS sepal_length,<br/>      2.5 AS sepal_width,<br/>      3 AS petal_length,<br/>      1.1 AS petal_width ) )</span></pre><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/573a05f72b2f815e0a63927b194e75fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*153_QqMhoUGE3AcvTW30RQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">输入数据预测</figcaption></figure><ul class=""><li id="91b4" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">正如你在上面看到的，它已经预测了所有3个类的概率。概率值最大的可以考虑。</li><li id="2d25" class="jt ju hi iw b ix kd jb ke jf kf jj kg jn kh jr jy jz ka kb bi translated">现在让我们预测存储在BigQuery本身中的数据。我们将使用相同的数据集5行作为输入。但是，只要输入保持不变，您就可以使用任何数据集。</li></ul><pre class="kj kk kl km fd ko kp kq kr aw ks bi"><span id="d410" class="kt ku hi kp b fi kv kw l kx ky">SELECT<br/>  *<br/>FROM<br/>  ML.PREDICT (MODEL `irisdataset.irisdata_model`,<br/>    (<br/>    SELECT<br/>      *<br/>    FROM<br/>      `irisdataset.irisdata`<br/>    LIMIT<br/>      5 ) )</span></pre><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ld"><img src="../Images/88b134b99e04a3f0ec8ed106c22ea9e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gL0zNaCrL3UWd3Ao11J5KQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">BigQuery中的数据预测</figcaption></figure><ul class=""><li id="ee01" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">希望本文向您介绍了BigQuery机器学习功能。如果你有任何疑问或傲慢，请评论，我会尽力帮助。</li></ul></div></div>    
</body>
</html>