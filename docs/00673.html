<html>
<head>
<title>Deploying a Linear Regression ML model as a Web Application on Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Docker上将线性回归ML模型部署为Web应用程序</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploying-linear-regression-ml-model-as-web-application-on-docker-3409f9464a27?source=collection_archive---------5-----------------------#2019-08-25">https://medium.com/analytics-vidhya/deploying-linear-regression-ml-model-as-web-application-on-docker-3409f9464a27?source=collection_archive---------5-----------------------#2019-08-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b4b933886cc26384aab2a3e6ba4e4e2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dikqi_HettkDzV7V"/></div></div></figure><p id="b164" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">线性回归算法是基本的<a class="ae jo" href="https://en.wikipedia.org/wiki/Supervised_learning" rel="noopener ugc nofollow" target="_blank">监督机器学习</a>算法之一。这是一种简单但最常用的机器学习技术之一。有很多关于线性回归的文章。我发现<a class="ae jo" href="https://towardsdatascience.com/linear-regression-detailed-view-ea73175f6e86" rel="noopener" target="_blank">这个</a>是理解线性回归的有用资源。</p><p id="a02c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我将解释如何在docker container上部署经过训练的线性回归机器学习模型作为轻量级web应用程序。Docker是一个<em class="jp">高度</em> <em class="jp">可扩展的开源环境</em>，在应用开发公司中最受欢迎。</p><p id="ec08" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为大部分机器学习的高级库都可以在python中使用，所以我也将使用python来开发web应用程序，以避免任何跨语言的依赖性。这篇文章有三个简单的步骤</p><h1 id="3e5a" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">第一步:训练/完成/保存你的机器学习模型。</h1><p id="093f" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">举一些线性回归实际应用的例子。比方说，我们想建立一些汽车的价格预测网络应用程序，预测你的汽车价格的基础上，你的汽车的特点，如汽车的发动机类型，汽车的发动机马力，汽车的颜色，汽车的年龄等。我们需要一些数据来训练和评估我们的ML模型。Kaggle 是获取数据集的好地方。对于这个应用程序，我选择<a class="ae jo" href="https://www.kaggle.com/gunishj/carpricepred/downloads/carpricepred.zip/1" rel="noopener ugc nofollow" target="_blank">这个</a>数据集来训练我的ML模型。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="kx ky l"/></div><figcaption class="kz la et er es lb lc bd b be z dx translated">图1:汽车预测模型代码。</figcaption></figure><p id="bd59" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的代码中，请注意，我们得到的RMSE是1250美元，这是合理的。您可以继续对模型进行微调(通过选择最优特性)，但是这超出了本文的范围，所以我不打算这样做。在模型训练之后，你可以看到我正在以文件名“car_price_prediction.pkl”保存模型。这是一个经过训练的模型文件，可以部署在web、移动或任何其他平台或应用程序上。</p><h1 id="06c8" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">步骤2:创建应用程序(Web/Mobile)。</h1><p id="7b4b" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">现在让我们创建一个web应用程序，使用我们训练好的模型来预测新车销售价格。我用的是<a class="ae jo" href="https://palletsprojects.com/p/flask/" rel="noopener ugc nofollow" target="_blank">砂箱</a>框架和它的<a class="ae jo" href="https://palletsprojects.com/p/jinja/" rel="noopener ugc nofollow" target="_blank">金甲2 </a>模板。Flask是一个用于开发web应用程序的轻量级web框架。你可以从<a class="ae jo" href="https://github.com/jinesh90/CarPricePrediction" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">点击</strong> </a>查看网络应用的全部代码。你可能注意到我已经创建了一个名为“<em class="jp"> mlmodel </em>的文件夹。在这个文件夹中，我放置了名为<em class="jp">“car _ price _ prediction . pkl”的线性回归模型。</em></p><p id="95b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以很容易地在web应用程序中使用训练好的模型。pkl文件。下面是代码示例。</p><pre class="kt ku kv kw fd ld le lf lg aw lh bi"><span id="2988" class="li jr hi le b fi lj lk l ll lm">@app.route("/", methods=["POST"])<br/>def result():<br/>    try:<br/>        form = request.form<br/>        model = joblib.load("mlmodel/car_price_prediction.pkl")<br/>        if int(form['car_fuel']) == 1:<br/>            fuel = 1<br/>        else:<br/>            fuel = 0<br/>        if int(form['car_transmission']) == 1:<br/>            car_transmission = 1<br/>        else:<br/>            car_transmission = 0<br/>        if int(form['car_color']) == 1:<br/>            car_color = 0<br/>        else:<br/>            car_color = 1<br/>        new_car = np.array(<br/>            [int(form['car_odometer']), fuel, int(form['car_doors']), car_transmission,<br/>             int(form['car_horsepower']), car_color, int(form['car_cc']), int(form['car_weight']),<br/>             int(form['car_age'])]).reshape(1, -1)<br/>        predicted_price = model.predict(new_car)<br/>        if predicted_price &lt; 0:<br/>            predicted_price = 0<br/>        return render_template("result.html", price=int(predicted_price))<br/>    except ValueError:<br/>        return render_template("error.html")</span></pre><p id="f57c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意这里，</p><pre class="kt ku kv kw fd ld le lf lg aw lh bi"><span id="336f" class="li jr hi le b fi lj lk l ll lm">model = joblib.load("mlmodel/car_price_prediction.pkl")</span></pre><p id="9efa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面的代码将线性回归模型加载到您的应用程序中。</p><h1 id="6ade" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">步骤3:部署线性回归应用程序。</h1><p id="9614" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">第三也是最后一部分是关于部署。我正在使用<a class="ae jo" href="https://www.docker.com/resources/what-container" rel="noopener ugc nofollow" target="_blank"> docker容器</a>来部署我们汽车的价格预测应用程序。Docker只需要两个基本文件进行部署。1)docker file 2)docker-compose . yml。</p><p id="61ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">DockerFile文件</p><pre class="kt ku kv kw fd ld le lf lg aw lh bi"><span id="aa48" class="li jr hi le b fi lj lk l ll lm"><strong class="le hj">FROM </strong>python:3<br/><strong class="le hj">WORKDIR /</strong>usr<strong class="le hj">/</strong>src<strong class="le hj">/</strong>app<br/><strong class="le hj">COPY </strong>requirements.txt .<br/><strong class="le hj">RUN </strong>pip install <strong class="le hj">--</strong>no-cache-dir <strong class="le hj">-</strong>r requirements.txt<br/><strong class="le hj">COPY </strong>. .<br/><strong class="le hj">COPY </strong>src<strong class="le hj">/ </strong>.<br/><strong class="le hj">CMD </strong>["python", "app.py"]</span></pre><p id="513e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">docker-compose.yml</p><pre class="kt ku kv kw fd ld le lf lg aw lh bi"><span id="0aee" class="li jr hi le b fi lj lk l ll lm"><strong class="le hj">version: </strong>'3'<br/><br/><strong class="le hj">services:<br/>  web:<br/>    build: </strong>./web<br/>    <strong class="le hj">ports:<br/>      </strong>- "9090:9090"</span></pre><p id="9fa9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将DockerFile和docker-compose.yml文件放入源代码后，用户需要执行两个简单的命令:</p><pre class="kt ku kv kw fd ld le lf lg aw lh bi"><span id="8c33" class="li jr hi le b fi lj lk l ll lm">sudo docker-compose build<br/>sudo docker-compose up</span></pre><p id="2c60" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您将在控制台中看到此输出。</p><pre class="kt ku kv kw fd ld le lf lg aw lh bi"><span id="d2ee" class="li jr hi le b fi lj lk l ll lm">web_1_2c1857cc6429 |   warnings.warn(msg, category=DeprecationWarning)<br/>web_1_2c1857cc6429 |  * Running on <a class="ae jo" href="http://0.0.0.0:9090/" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:9090/</a> (Press CTRL+C to quit)<br/>web_1_2c1857cc6429 |  * Restarting with stat</span></pre><p id="bddf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">恭喜你！！您的汽车价格预测应用程序已经启动并运行。现在点击链接或进入浏览器。您将看到输入汽车数据的用户界面。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/73febb69932994a9c948f26722959049.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_bojBkGCAemrzqroeD3uxA.png"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx translated">图2: Web应用程序UI。</figcaption></figure><p id="9abb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦用户填写了所有输入，并点击“预测”后端服务器将饲料输入值模型，并获得预测的汽车价格。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/7c9f6687ce65c0c648ada7724e31118e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wu8F17w22dLqruVknEgCmw.png"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx translated">图3:基于线性回归模型预测的汽车价格</figcaption></figure><p id="7d86" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个机器学习应用程序具有高度可扩展性，因为它与真实模型学习(高度计算繁重的操作)相分离。每个计算都是离线的。如果用户想更改车型，只需替换“car_price_prediction.pkl”文件，通过执行上面提到的两条命令重新构建/重启docker app即可。</p><h1 id="a8e9" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">最终结论:</h1><p id="30ed" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">训练机器学习模型是一项计算量很大的操作。应用程序(移动/web)应该从模型训练/测试/调整中分离出来。像docker这样的部署工具为您的机器学习应用程序提供了可伸缩性和易部署性。你也可以部署另一种机器学习算法，如SVM、KNN、决策树，作为高度可扩展的web、移动应用程序。</p></div></div>    
</body>
</html>