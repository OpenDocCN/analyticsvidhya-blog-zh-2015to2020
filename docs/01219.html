<html>
<head>
<title>SMOTE-NC in ML Categorization Models for Imbalanced Datasets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">非平衡数据集ML分类模型中的SMOTE-NC</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/smote-nc-in-ml-categorization-models-fo-imbalanced-datasets-8adbdcf08c25?source=collection_archive---------0-----------------------#2019-10-09">https://medium.com/analytics-vidhya/smote-nc-in-ml-categorization-models-fo-imbalanced-datasets-8adbdcf08c25?source=collection_archive---------0-----------------------#2019-10-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="6baa" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">介绍</h1><p id="24e4" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">对于这个项目，我使用了从UCI机器学习知识库中获得的<strong class="jf hj">在线购物者购买意向数据集</strong>。目标是建立一个预测性的机器学习模型，可以根据用户在浏览网站时的行为将用户分为创收和非创收两类。</p><p id="d69d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这篇博文将重点关注SMOTE-NC，以及它对用于分类数据的机器学习模型分数的影响。对于本项目中使用的探索性数据分析或数据转换技术，将不会讨论太多细节。如果您想查看整个笔记本以了解更多详细信息，请点击以下链接:</p><p id="85fd" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><a class="ae kg" href="https://github.com/feraguilari/dsc-mod-5-project-online-ds-pt-021119/blob/master/student.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/feraguilari/DSC-mod-5-project-online-ds-pt-021119/blob/master/student . ipynb</a></p><h1 id="227b" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">数据集</h1><p id="ebe9" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">数据集包含18列，其中17列是特性，1列是目标变量，在本例中为“收入”。下面描述了数据集中每一列的含义:</p><ul class=""><li id="3d56" class="kh ki hi jf b jg kb jk kc jo kj js kk jw kl ka km kn ko kp bi translated">管理:查看的“管理”页面数</li><li id="9809" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">Administrative_Duration:查看“管理”页面所花费的时间</li><li id="acc6" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">信息:查看的“信息”页面的数量</li><li id="33d7" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">Informational_Duration:查看“信息”页面所花费的时间</li><li id="93e0" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">产品相关:查看的“产品相关”页面的数量</li><li id="fb06" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">ProductRelated_Duration:查看“产品相关”页面所花费的时间</li><li id="9674" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">反弹率:从该页面进入网站，然后离开(“反弹”)而没有在该会话期间触发任何其他对分析服务器的请求的访问者的百分比</li><li id="786d" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">ExitRates:它是根据该页面的所有页面浏览量计算的，是该会话中最后一次的百分比</li><li id="ec06" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">PageValues:表示用户在完成电子商务交易之前访问的网页的平均值</li><li id="c0a6" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">特殊日:表示现场访问时间与特定特殊日(如母亲节、情人节)的接近程度，在该特殊日，会议更有可能最终完成交易</li><li id="9ef3" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">月份:会话的月份</li><li id="9598" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">OperatingSystems:用于会话的操作系统</li><li id="2314" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">浏览器:用于会话的浏览器</li><li id="e948" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">区域:用户所在的区域</li><li id="2e92" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">流量类型:流量类型</li><li id="a8d5" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">访问者类型:访问者的类型</li><li id="f0ca" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">周末:会议是否发生在周末</li><li id="64a2" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">RevenueRevenue:表示用户是否产生了收入</li></ul><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/08e85c9f2d5058a840de5634a6f1a6ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Acn4FyZkkPskSW_Z9TiqCw.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">数据集头，首次检验</figcaption></figure><p id="26cd" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">该数据集可在以下网站下载:<a class="ae kg" href="https://archive.ics.uci.edu/ml/datasets/Online+Shoppers+Purchasing+Intention+Dataset" rel="noopener ugc nofollow" target="_blank">https://archive . ics . UCI . edu/ml/datasets/Online+购物者+购买意愿+数据集</a></p><h1 id="a70e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">不平衡数据集</h1><p id="67ca" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">此数据集的一个问题是，目标变量中的关联显示数据集可能不平衡。目标发生率显示数据集是平衡的还是不平衡的。它被定义为数据集中每个单独目标值的事例数。这很重要，因为项目的目标是预测用户会话是否产生收入。这个模型是一个二元分类器，意味着只有两种可能的结果:</p><ol class=""><li id="8825" class="kh ki hi jf b jg kb jk kc jo kj js kk jw kl ka ll kn ko kp bi translated">False(值:0)-会话没有产生收入。</li><li id="95fa" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka ll kn ko kp bi translated">True(值:1)-会话产生收入。</li></ol><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lm"><img src="../Images/7270ef108cb4d94ec6342d8802d15098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H40acBwU5OmC1CJw6KoLVg.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">标准化目标变量关联的条形图</figcaption></figure><p id="0a71" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">考虑到数据集中的数据量，15%的目标发生率是可行的，但是这个比例仍然很小，我认为这是不平衡的。因此，我将实施数据扩充技术，以便用合成数据提高目标发生率。为了解决类不平衡的问题，Chawla等人[3]在2002年引入了合成少数过采样技术(SMOTe)。</p><h1 id="0990" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">合成少数过采样技术(SMOTE)</h1><p id="003b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">SMOTE是一种基于最近邻的技术，通过特征空间中数据点之间的欧几里德距离来判断。对于这个项目，我使用了不平衡学习库中的名义和连续特征的合成少数过采样技术(SMOTE-NC ),该技术为数据集中的分类和定量特征创建了合成数据。SMOTE-NC稍微改变了生成新样本的方式，对分类特征执行了一些特定的操作。事实上，新生成样本的类别是通过挑选在生成期间出现的最频繁类别的最近邻来决定的。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es ln"><img src="../Images/cc5957fb91a5bfe9a0cdc06a57484db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rydXwrLyJk1ZNbHO3RMA9g.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">基于k-最近邻使用SMOTE生成新的合成数据点。不平衡学习</figcaption></figure><p id="ffec" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">到目前为止，原始数据集已经过一次热编码和缩放。数据已被分成训练数据集和测试数据集。仅将SMOTE应用于训练集而非测试集是非常重要的，以避免污染和向模型中引入偏差。</p><h1 id="fe42" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">测试</h1><p id="c481" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在将SMOTE-NC应用于训练集之前，我训练了四种普通的机器学习算法。机器学习算法有:决策树、逻辑回归、随机森林和梯度推进。鉴于数据的不平衡性质，最好的分类分数是f1和曲线下面积分数。</p><p id="ff80" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">为了比较在数据集上执行SMOTE-NC的有效性，这里是在数据集已经被清理、一次热编码、缩放和分割之后每个模型的第一个分数。</p><p id="c0e4" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">值得注意的是，在分割过程中，使用sklearn库中的训练测试分割工具，通过设置超参数“分层=目标”来保持训练和测试数据集上的相同目标发生率，从而完成分割。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="lo lp l"/></div></figure><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="lo lp l"/></div></figure><pre class="kw kx ky kz fd lq lr ls lt aw lu bi"><span id="be42" class="lv ig hi lr b fi lw lx l ly lz">#Display scores for each of the models<br/>results3 = baseline_models(data=[X_train, X_test, y_train, y_test])<br/>results3.sort_values('f1',ascending=False)</span></pre><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es ma"><img src="../Images/8988ecddf4b321dda8f502c9bfd47e5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6x0ngXwyxV7RSXEbTd7VFg.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">之前每个模型的分数</figcaption></figure><p id="488e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">因此，目前表现最好的模型是梯度提升模型，F1值接近67%，roc_auc值约为78%。现在让我们在训练集上执行一个默认的SMOTE-NC。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="lo lp l"/></div></figure><pre class="kw kx ky kz fd lq lr ls lt aw lu bi"><span id="1557" class="lv ig hi lr b fi lw lx l ly lz">0    0.625<br/>1    0.375<br/>Name: outcome, dtype: float64</span></pre><p id="2e23" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在训练数据集上应用SMOTE-NC后，新的目标发生率从15.47%上升到37.5%，上升了60%。产生过采样的因子可以在sampling_startegy超参数中指定。该参数可以设置为您选择的任何百分比。如果显示的百分比是100，那么对于每个实例，将创建一个新的样本。因此，少数类实例的数量将会翻倍。</p><p id="0e60" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">另一个可以调整的超参数是k_neighbors。默认值为5，这是最适合我的数据集的值。该超参数指示用于构建合成样本的最近邻的数量。</p><p id="c6b3" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">关于我的数据集中模型性能的提高，最大的改进是roc-auc得分从78%上升到84%多一点。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es mb"><img src="../Images/eabd1cd42d790a91fb151178d1a3821a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1SqulRLS9Oa561Znexxn6A.png"/></div></div></figure><h1 id="6492" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">结论</h1><p id="4275" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">SMOTE-NC是生成合成数据以对不平衡数据集中的少数目标类进行过采样的强大工具。可以调整的参数有k-neighbors和采样策略，k-neighbors允许确定创建新样本的最近邻的数量，采样策略允许指示创建多少个新样本。重要的是要记住只将其应用于训练数据集，以避免给模型带来偏差。</p><h1 id="87ec" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">参考资料和进一步阅读</h1><div class="mc md ez fb me mf"><a href="https://imbalanced-learn.readthedocs.io/en/stable/over_sampling.html#smote-adasyn" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab dw"><div class="mh ab mi cl cj mj"><h2 class="bd hj fi z dy mk ea eb ml ed ef hh bi translated">2.过采样-不平衡-学习0.5.0文档</h2><div class="mm l"><h3 class="bd b fi z dy mk ea eb ml ed ef dx translated">可以参考不同过采样算法的比较。解决这个问题的一个方法是产生新的…</h3></div><div class="mn l"><p class="bd b fp z dy mk ea eb ml ed ef dx translated">不平衡-learn.readthedocs.io</p></div></div></div></a></div><div class="mc md ez fb me mf"><a rel="noopener follow" target="_blank" href="/towards-artificial-intelligence/application-of-synthetic-minority-over-sampling-technique-smote-for-imbalanced-data-sets-509ab55cfdaf"><div class="mg ab dw"><div class="mh ab mi cl cj mj"><h2 class="bd hj fi z dy mk ea eb ml ed ef hh bi translated">综合少数过采样技术在不平衡数据集上的应用</h2><div class="mm l"><h3 class="bd b fi z dy mk ea eb ml ed ef dx translated">在数据科学中，不平衡的数据集并不奇怪。如果数据集用于分类问题，如…</h3></div><div class="mn l"><p class="bd b fp z dy mk ea eb ml ed ef dx translated">medium.com</p></div></div><div class="mo l"><div class="mp l mq mr ms mo mt lf mf"/></div></div></a></div><div class="mc md ez fb me mf"><a href="https://github.com/feraguilari/dsc-mod-5-project-online-ds-pt-021119/blob/master/student.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab dw"><div class="mh ab mi cl cj mj"><h2 class="bd hj fi z dy mk ea eb ml ed ef hh bi translated">网上购物者购买意向分类</h2><div class="mm l"><h3 class="bd b fi z dy mk ea eb ml ed ef dx translated">完整笔记本</h3></div><div class="mn l"><p class="bd b fp z dy mk ea eb ml ed ef dx translated">github.com</p></div></div><div class="mo l"><div class="mu l mq mr ms mo mt lf mf"/></div></div></a></div></div></div>    
</body>
</html>