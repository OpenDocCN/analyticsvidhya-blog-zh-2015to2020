<html>
<head>
<title>Keras[TF 2.0] Custom Callbacks — Key feature to understand how model trains at various stages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Keras[TF 2.0]自定义回调—了解模型在不同阶段如何训练的关键功能</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/keras-custom-callbacks-key-feature-to-understand-how-model-trains-at-various-stages-111fb838d37c?source=collection_archive---------18-----------------------#2020-03-13">https://medium.com/analytics-vidhya/keras-custom-callbacks-key-feature-to-understand-how-model-trains-at-various-stages-111fb838d37c?source=collection_archive---------18-----------------------#2020-03-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f3f4d1ab4d1a35bcd4da367881f8ac5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mU0AQK8cM1AzliURGVkVyA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">来源:<a class="ae iu" href="https://apisyouwonthate.com/blog/openapi-callbacks-and-webhooks" rel="noopener ugc nofollow" target="_blank">https://apisyouwonthate . com/blog/open API-callbacks-and-web hooks</a></figcaption></figure><p id="e184" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在Keras中，回调是一个强大的功能，可以让你了解你的神经网络是如何训练的。它可以让您在训练的不同阶段执行这些功能，例如在每次训练的开始和结束、每个时期或批次。使用此功能，您可以编写自定义回调，让您在每个时期/批次结束时计算F1分数、精确度和召回率，从而了解您的训练是如何进行的。</p><p id="9814" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这篇博客中，我将展示我们如何编写自定义回调函数来监控前面提到的“时尚MNIST”数据集的图像分类问题的指标。我们将利用迷你VGG网络作为我们的CNN网络来执行这项行动。</p><p id="5826" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这段代码是作为TF 2.0中可用的Keras的一部分编写的。有很多博客描述了旧版本keras的这一功能，但是在互联网上很少发现新版本的参考文献。</p><p id="83a7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们开始吧，你可以在这里找到这个博客<a class="ae iu" href="https://github.com/VVasanth/MachineLearning/tree/master/KerasCustomCallbacks" rel="noopener ugc nofollow" target="_blank">的python笔记本</a>。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jt"><img src="../Images/28a242508b5379ad607b1c2fb7ff8c82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WPNOEt1SHwUj5BU8rNneqw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">用于图像分类的迷你VGGNet来源:pyimagesearch.com</figcaption></figure><p id="20af" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们首先将迷你VGG网络定义为我们的CNN网络。这来源于pyimagesearch，您可以在参考资料部分找到网络的更多详细信息。</p><p id="0822" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在笔记本的其余部分，我们将从keras加载时尚MNIST数据集，并执行所需的处理以将数据输入网络。</p><p id="9d93" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后定义自定义回调类，如下所示:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jy"><img src="../Images/90824e396089491be210bab42fc011cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b17F5XuKGyq7xG7V4RQwXg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">自定义回调函数来计算每个时期的F1分数</figcaption></figure><p id="cf7f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">自定义回调是一个抽象基类，具有“on_train_begin”、“on_train_end”、“on_epoch_begin”、“on_epoch_end”、“on_batch_begin”和“on_batch_end”等方法。一旦我们扩展了基类并实现了对各个阶段的调用，我们就能够在定义的阶段跟踪模型的性能。</p><p id="7384" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这篇博客中，我们仅利用“on_epoch_end”来衡量关键指标，如F1、每个epoch结束时的精度。此外，请注意，我们使用构造函数“init”来初始化值，并且我们将在定义“metrics”类时将验证测试作为参数传递给构造函数，如下所示:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jz"><img src="../Images/e01cb59436b5f1ec040ab0466901f18d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zSOdAZTjVg7_POe9_V014A.png"/></div></div></figure><p id="c57e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在启动网络的“Fit”操作时，将定义的自定义回调对象传递给“Callback”参数:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ka"><img src="../Images/4214661ad14714a0824810d0d8961099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DGnjj8XVm4XcSHTc5v5Z1g.png"/></div></div></figure><p id="c40e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，网络将接受训练，并在每个时期结束时计算F1分数和相关指标。</p><p id="ad03" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以在培训后检索指标值，并使用它们进行分析，如下所示:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kb"><img src="../Images/7d65600bc0d8acd120bd1eb414ef0b1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7OVfBYh4orz90mSmmEOP4w.png"/></div></div></figure><p id="de7c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果没有这个特征，我们将被限制于仅使用默认的度量来监控网络的训练过程，例如在每个时期结束时的“准确性”和“损失”。但这一功能甚至可以让我们定义自定义指标和培训的各个阶段。</p><p id="e0af" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">参考资料:</p><div class="kc kd ez fb ke kf"><a href="https://www.tensorflow.org/guide/keras/custom_callback" rel="noopener  ugc nofollow" target="_blank"><div class="kg ab dw"><div class="kh ab ki cl cj kj"><h2 class="bd hj fi z dy kk ea eb kl ed ef hh bi translated">Keras自定义回调| TensorFlow核心</h2><div class="km l"><h3 class="bd b fi z dy kk ea eb kl ed ef dx translated">自定义回调是一个强大的工具，可以在训练、评估或其他过程中自定义Keras模型的行为</h3></div><div class="kn l"><p class="bd b fp z dy kk ea eb kl ed ef dx translated">www.tensorflow.org</p></div></div></div></a></div><div class="kc kd ez fb ke kf"><a href="https://keunwoochoi.wordpress.com/2016/07/16/keras-callbacks/" rel="noopener  ugc nofollow" target="_blank"><div class="kg ab dw"><div class="kh ab ki cl cj kj"><h2 class="bd hj fi z dy kk ea eb kl ed ef hh bi translated">Keras回调指南和代码</h2><div class="km l"><h3 class="bd b fi z dy kk ea eb kl ed ef dx translated">更新:这篇文章是为Keras 1.x写的。事情变化不大，但回购对Keras来说是最新的…</h3></div><div class="kn l"><p class="bd b fp z dy kk ea eb kl ed ef dx translated">keunwoochoi.wordpress.com</p></div></div></div></a></div><div class="kc kd ez fb ke kf"><a href="https://www.pyimagesearch.com/2019/02/11/fashion-mnist-with-keras-and-deep-learning/" rel="noopener  ugc nofollow" target="_blank"><div class="kg ab dw"><div class="kh ab ki cl cj kj"><h2 class="bd hj fi z dy kk ea eb kl ed ef hh bi translated">时尚MNIST与Keras和深度学习</h2><div class="km l"><h3 class="bd b fi z dy kk ea eb kl ed ef dx translated">在本教程中，你将学习如何训练一个简单的卷积神经网络(CNN)与时尚的Keras</h3></div><div class="kn l"><p class="bd b fp z dy kk ea eb kl ed ef dx translated">www.pyimagesearch.com</p></div></div><div class="ko l"><div class="kp l kq kr ks ko kt io kf"/></div></div></a></div></div></div>    
</body>
</html>