<html>
<head>
<title>Face Mask Detection using Google Colab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Google Colab的人脸面具检测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/face-mask-detection-using-google-colab-160f7b20cdea?source=collection_archive---------12-----------------------#2020-06-13">https://medium.com/analytics-vidhya/face-mask-detection-using-google-colab-160f7b20cdea?source=collection_archive---------12-----------------------#2020-06-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f29eb9fc4e411e4ec6cfe98d279a8561.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ru5aJrPImBEVJs4nfUs6xA.jpeg"/></div></div></figure><h1 id="ffd9" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">项目鸟瞰图:</h1><ol class=""><li id="7829" class="jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">业务问题:关于业务问题的描述</li><li id="43bc" class="jo jp hi jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">问题陈述:关于机器学习的问题描述。</li><li id="6da6" class="jo jp hi jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">数据的来源。</li><li id="110b" class="jo jp hi jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">我对这个问题的看法。</li><li id="8671" class="jo jp hi jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">结论。</li><li id="2ad8" class="jo jp hi jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">参考文献。</li></ol><h1 id="e02a" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">业务问题:</h1><p id="c016" class="pw-post-body-paragraph kl km hi jq b jr js kn ko jt ju kp kq jv kr ks kt jx ku kv kw jz kx ky kz kb hb bi translated">在这个新时代，我们正在经历疫情，周围的人都被建议戴口罩，一些人不习惯，并避免戴口罩。这个项目背后的动机是，如果我们可以借助人工智能来检测公共场所戴口罩或不戴口罩的人，这将有助于提高我们的安全性。如果部署正确，面具探测器有可能被用来帮助确保我们的安全。</p><p id="8386" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">此外，生活在这个时期是非常令人沮丧的，目睹这个世界上发生的这么多事情，我决定为什么不做点什么，即把现实世界中我们人类外出必须戴口罩的问题转化为机器学习问题。</p><h1 id="899e" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">问题陈述:</h1><p id="d324" class="pw-post-body-paragraph kl km hi jq b jr js kn ko jt ju kp kq jv kr ks kt jx ku kv kw jz kx ky kz kb hb bi translated">这里的任务是给定一幅图像或一段视频，预测人们戴不戴面具。这是一个对象检测和分类问题，有两种不同的类别(有无遮罩)。</p><p id="2475" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">有许多方法来检测物体，但是，为此我决定使用YOLO v3，因为它简单快速，是最准确的方法之一。</p><h1 id="cbb4" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">数据来源:</h1><p id="1a12" class="pw-post-body-paragraph kl km hi jq b jr js kn ko jt ju kp kq jv kr ks kt jx ku kv kw jz kx ky kz kb hb bi translated">所以有多种数据来源可以用来解决这个问题。你可以从网上下载图片并对其进行注释，或者你可以简单地得到一个准备好的数据，可以很容易地用于训练。</p><p id="fb43" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">我使用了Kaggle中现有的数据集。</p><p id="10fa" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">链接:<a class="ae lf" href="https://www.kaggle.com/alexandralorenzo/maskdetection" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/alexandralorenzo/maskdetection</a></p><p id="d539" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">收集完数据后，将所有的图像及其注释放入YOLO格式，如下所示，并将文件夹命名为“<em class="lg"> obj </em>”。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/aabde09cabee37237c8a530b1d98552e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zLgOa3DFnFlJtp-gO7ODHA.png"/></div></div></figure><p id="e941" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">注释必须包含YOLO格式的类和盒子坐标。<class> <x> <y> <w> <h/></w></y></x></class></p><h1 id="cd20" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">YOLO v3:</h1><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es lm"><img src="../Images/dfd57e8060201530a13f60914dff3c7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*LlPcxdPQzLlv4p3RKnMaKg.png"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">演职员表:<a class="ae lf" href="https://pjreddie.com/darknet/yolo/" rel="noopener ugc nofollow" target="_blank">https://pjreddie.com/darknet/yolo/</a></figcaption></figure><p id="a4be" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">YOLO v3是YOLO系列(YOLO v1、YOLO v2)的一个物体探测网络部分。这是一个相当简单的对象检测方法，具有非常好的性能。它将图像作为输入，通过神经网络传递，并获得一个包围盒和类预测的向量作为输出。YOLO v3使用DarkNet-53进行特征检测，然后是卷积层。Darknet-53是一个在ImageNet上训练的53层卷积神经网络，主要由3 × 3和1× 1滤波器组成，像ResNet中的残差网络一样具有跳跃连接。</p><p id="e3cf" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">有关输入格式、输出格式或架构的更多信息，请访问<a class="ae lf" href="https://hackernoon.com/understanding-yolo-f5a74bbc7967" rel="noopener ugc nofollow" target="_blank">此链接</a>。</p><h1 id="f22e" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated"><strong class="ak">第一次切入方式:</strong></h1><p id="dcc2" class="pw-post-body-paragraph kl km hi jq b jr js kn ko jt ju kp kq jv kr ks kt jx ku kv kw jz kx ky kz kb hb bi translated">注意:如果你使用的是Colab，那么连接你的Google Drive，这样你就可以很容易地存储备份权重，也可以管理所有必要的文件。</p><ol class=""><li id="b71f" class="jo jp hi jq b jr la jt lb jv lr jx ls jz lt kb kc kd ke kf bi translated">由于我已经使用了YOLO v3，第一件事就是克隆Darknet Github库，因为我们将使用它来训练我们的模型。</li><li id="57dd" class="jo jp hi jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">下载YOLO v3配置文件，并根据我们的数据集进行编辑。将Yolo块中的所有“类”值设置为2，将“随机”值设置为0。另外，将Yolo块正上方的卷积块中的【T4过滤器】的值更改为(类别数+ 5)*3，在本例中为21。</li></ol><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/71d920d56ce85397a8bc9e18ed03f1f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Br9GcwshB0uBaXbSFeovA.png"/></div></div></figure><p id="a89c" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">3.另外，将'<em class="lg"> max_batches </em>'值更改为2000 *类数，在我们的示例中为4000，并将'<em class="lg"> steps </em>'分别更改为'<em class="lg"> max_batches </em>'值的80%和90%。您可以在我的<a class="ae lf" href="https://github.com/shibam-banerjee/Face_Mask_Detection" rel="noopener ugc nofollow" target="_blank"> Github中获得配置文件的副本。</a></p><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es lv"><img src="../Images/bf84fddd48fb374bde2a5be54c9534ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:426/format:webp/1*HJ1EGegYNmd9Sc3061lcrw.png"/></div></figure><p id="2c18" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">4.创建一个名为“<em class="lg"> obj.names </em>的文件，该文件将包含数据标签的名称。在我们的例子中，我们有两个标签——屏蔽和不屏蔽。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es lw"><img src="../Images/36e57e79a2ddb5eb41276aa9607561f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:314/format:webp/1*EJOQJtZf5RzewB9KrpcitA.png"/></div></figure><p id="0af7" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">5.创建另一个名为'<em class="lg"> obj.data </em>的文件，该文件将包含以下信息。训练和有效是包含训练和验证图像的位置的文件。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es lx"><img src="../Images/c3b8c279a2fe32f06df49786dcbb5f80.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*bx1hqNwTUsh8Au3MZbuFAQ.png"/></div></figure><p id="7e8a" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">6.根据您的数据创建两个名为'<em class="lg"> train </em>和'<em class="lg"> valid </em>的<em class="lg"> txt </em>文件，这些文件将包含图像的位置，并且必须如下图所示。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es ly"><img src="../Images/2ada4a78d338df5e8d9dcf54b4715c1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*LQz8sQNVKJxorJtldjdTlA.png"/></div></figure><figure class="li lj lk ll fd ij"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="7294" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">上面的代码可以用来创建txt文件。</p><p id="0a54" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">7.之后，将文件和数据放在<strong class="jq hj"> Darknet </strong>目录中，并执行培训。有关确切位置和命令的更多信息，请访问我的<a class="ae lf" href="https://github.com/shibam-banerjee/Face_Mask_Detection" rel="noopener ugc nofollow" target="_blank"> Github </a>。</p><p id="a68f" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">8.执行1000+个时期的训练。低于1的损失值表现非常好。</p><p id="c17f" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">9.一旦你达到了一个低损耗值，在一些图像或视频上测试它。</p><h1 id="1526" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">结果:</h1><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/a52a5eb06c135fa0ab16ede87586e3c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sJ3eqr4jR3azY8JVpZp8VQ.jpeg"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">示例输出</figcaption></figure><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/3b61f3e8ad2e9344463811ac8536b231.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kU0fcSXHpQuSfWcz3Ye4XQ.jpeg"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">示例输出</figcaption></figure><p id="309d" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">可以在各种图像上试试。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es md"><img src="../Images/75c195d831167c23da69fb824c2bd71a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*k5abbAmYAVWL_MQHGNj8_w.png"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">历元与损失图</figcaption></figure><p id="e329" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">我们可以看到，在大约300+个时期后，损耗急剧下降。我已经训练了超过1000个周期，但是图显示了大约700个周期，因为我不得不使用我的备用重量重新训练。</p><h1 id="5f50" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">结论:</h1><ol class=""><li id="61af" class="jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">该模型在如此小的数据集和仅1000个时期的训练下表现相当好。</li><li id="857e" class="jo jp hi jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">该模型可以通过使用具有不同类型图像的更大数据集来改进。在这个实现中用于训练的数据集非常简单，并且大多数图像包含单个人。在生产场景中，图像中有变化的大型数据集是必须的。</li></ol><p id="89b5" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">希望你喜欢这篇文章！</p><h1 id="50b4" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">参考资料:</h1><ol class=""><li id="518b" class="jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">最新研究论文<a class="ae lf" href="https://arxiv.org/pdf/2003.09093.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">蒙面人脸识别数据集及应用</strong> </a></li><li id="340c" class="jo jp hi jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">YOLO v3: <a class="ae lf" href="https://pjreddie.com/darknet/yolo/" rel="noopener ugc nofollow" target="_blank">暗网</a></li></ol><p id="bb1b" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">3.使用<a class="ae lf" href="https://colab.research.google.com/drive/1lTGZsfMaGUpBG4inDIQwIJVW476ibXk" rel="noopener ugc nofollow" target="_blank"> Colab </a>的YOLO v3</p><p id="cf6e" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">我的Github:<a class="ae lf" href="https://github.com/shibam-banerjee/Face_Mask_Detection" rel="noopener ugc nofollow" target="_blank">https://github.com/shibam-banerjee/Face_Mask_Detection</a></p><p id="7649" class="pw-post-body-paragraph kl km hi jq b jr la kn ko jt lb kp kq jv lc ks kt jx ld kv kw jz le ky kz kb hb bi translated">领英:<a class="ae lf" href="https://www.linkedin.com/in/shibam-banerjee-b59727169/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/shibam-banerjee-b59727169/</a></p></div></div>    
</body>
</html>