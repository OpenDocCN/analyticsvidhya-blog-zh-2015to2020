<html>
<head>
<title>Share and Secure your Cloud Services: An Introduction to Cloud Endpoints</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">共享和保护您的云服务:云端点简介</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/share-and-secure-your-cloud-services-an-introduction-to-cloud-endpoints-7a3ec56eefb2?source=collection_archive---------1-----------------------#2019-10-02">https://medium.com/analytics-vidhya/share-and-secure-your-cloud-services-an-introduction-to-cloud-endpoints-7a3ec56eefb2?source=collection_archive---------1-----------------------#2019-10-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="86a9" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">您是一名数据科学家或开发人员，并且您想要安全地共享模型或Web服务，让我们开始吧！</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/2cd5097986606b9c2b8a5e87dd27109f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-7NwKUrLm2-ezppO"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">照片由<a class="ae jn" href="https://unsplash.com/@ericjamesward?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">埃里克·沃德</a>在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><h1 id="f946" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">解决方案概述</h1><p id="c419" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">为了演示如何共享和保护云服务，让我们以一个解决方案为例，该解决方案从RSS新闻提要<em class="lc">中提取数据(参见</em> <a class="ae jn" rel="noopener" href="/@ezzatdemnati/web-scraping-news-data-rss-feeds-python-and-google-cloud-platform-7a0df2bafe44?source=friends_link&amp;sk=788d4a355ca31b7c2270770c929371cc"> <em class="lc">上一篇文章</em> </a> <em class="lc"> ) </em>，我们希望向最终用户公开这些数据。基本上，我们希望:</p><ul class=""><li id="5430" class="ld le hi ki b kj lf km lg kp lh kt li kx lj lb lk ll lm ln bi translated">允许授权用户<strong class="ki hj">使用安全API启动</strong>搜索和提取<em class="lc">后台进程，</em></li><li id="a7dc" class="ld le hi ki b kj lo km lp kp lq kt lr kx ls lb lk ll lm ln bi translated">允许授权用户<strong class="ki hj">使用第二个安全API</strong>访问文章。</li></ul><p id="6b34" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">这些功能由两个<a class="ae jn" href="https://cloud.google.com/functions/" rel="noopener ugc nofollow" target="_blank">云功能</a>实现:</p><ol class=""><li id="5db3" class="ld le hi ki b kj lf km lg kp lh kt li kx lj lb lw ll lm ln bi translated"><em class="lc">publish _ RSS _ feed _ Search _ message():</em>通过向<a class="ae jn" href="https://cloud.google.com/pubsub/" rel="noopener ugc nofollow" target="_blank"> Cloud Pubsub </a>主题发布事件消息来触发<em class="lc">搜索和提取流程</em>，这将启动一个涉及多个步骤的后台流程。</li><li id="e4c7" class="ld le hi ki b kj lo km lp kp lq kt lr kx ls lb lw ll lm ln bi translated"><em class="lc"> read_news_articles() </em>:从<a class="ae jn" href="https://firebase.google.com/docs/firestore" rel="noopener ugc nofollow" target="_blank"> Cloud Firestore </a>数据库返回新闻文章。</li></ol><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lx"><img src="../Images/8af3150b577e28c54d8a72009686027a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UkxBeVukI45pDyA9fRcBZA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">共享和保护云服务的解决方案概述</figcaption></figure></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h1 id="ae6a" class="jo jp hi bd jq jr mf jt ju jv mg jx jy io mh ip ka ir mi is kc iu mj iv ke kf bi translated">云端点:它是如何工作的？</h1><blockquote class="mk ml mm"><p id="d3e1" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated">“Endpoints是一个API管理系统，它使用Google为自己的API使用的相同基础架构，帮助您保护、监控、分析和设置API配额。将API部署到端点后，您可以使用<a class="ae jn" href="https://cloud.google.com/endpoints/docs/dev-portal-overview" rel="noopener ugc nofollow" target="_blank">云端点门户</a>创建开发人员门户，API用户可以访问该网站查看文档并与API交互。”[ <a class="ae jn" href="https://cloud.google.com/endpoints/docs/" rel="noopener ugc nofollow" target="_blank">来源</a> ]</p></blockquote><p id="1e6c" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">云端点可用于公开不同的云服务，如云功能、应用引擎、Kubernetes、计算引擎(Docker)等。</p><p id="4df1" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">我们将在这里介绍如何创建一个安全的API端点，以便向最终用户公开云功能。如果应用于其他云服务，以下步骤基本相同。</p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h1 id="b303" class="jo jp hi bd jq jr mf jt ju jv mg jx jy io mh ip ka ir mi is kc iu mj iv ke kf bi translated">云端点:循序渐进</h1><blockquote class="mk ml mm"><p id="0006" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated"><em class="hi">参考</em>:<a class="ae jn" href="https://cloud.google.com/endpoints/docs/openapi/get-started-cloud-functions" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/endpoints/docs/open API/get-started-cloud-functions</a></p></blockquote><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mq"><img src="../Images/2460700f331ff8d54ebcaa31c106c6ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:290/format:webp/1*aazwBJAKp8qO5gj9P4cIWA.png"/></div></figure><ol class=""><li id="9dca" class="ld le hi ki b kj lf km lg kp lh kt li kx lj lb lw ll lm ln bi translated">部署云功能</li><li id="3682" class="ld le hi ki b kj lo km lp kp lq kt lr kx ls lb lw ll lm ln bi translated">将ESP部署到云运行</li><li id="242a" class="ld le hi ki b kj lo km lp kp lq kt lr kx ls lb lw ll lm ln bi translated">创建OpenAPI文档来描述API规范</li><li id="4299" class="ld le hi ki b kj lo km lp kp lq kt lr kx ls lb lw ll lm ln bi translated">部署端点配置</li><li id="a7d5" class="ld le hi ki b kj lo km lp kp lq kt lr kx ls lb lw ll lm ln bi translated">配置ESP，以便它可以找到您的端点服务的配置</li><li id="4b6b" class="ld le hi ki b kj lo km lp kp lq kt lr kx ls lb lw ll lm ln bi translated">授予ESP调用目标云函数的权限</li></ol></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h2 id="eaa8" class="mr jp hi bd jq ms mt mu ju mv mw mx jy kp my mz ka kt na nb kc kx nc nd ke ne bi translated"><strong class="ak">部署</strong> <a class="ae jn" href="https://cloud.google.com/functions/" rel="noopener ugc nofollow" target="_blank"> <strong class="ak">云功能</strong> </a></h2><p id="a5c3" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">为了为我们的解决方案部署云功能，我们需要创建这两个文件:</p><ol class=""><li id="f2e9" class="ld le hi ki b kj lf km lg kp lh kt li kx lj lb lw ll lm ln bi translated"><em class="lc"> main.py </em>文件包含我们的python函数，</li><li id="9d76" class="ld le hi ki b kj lo km lp kp lq kt lr kx ls lb lw ll lm ln bi translated"><em class="lc"> requirements.txt </em>文件，列出了要安装的python库。在这种情况下，它将包含以下库:</li></ol><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="b28c" class="mr jp hi ng b fi nk nl l nm nn">google-cloud-pubsub== 0.41.0<br/>pandas==0.25.1<br/>Flask==1.0.2</span></pre><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="no np l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">main.py</figcaption></figure><blockquote class="mk ml mm"><p id="4d98" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated">私有包<code class="du nq nr ns ng b">mylib.gcp_cloud_util.gcp_cloud_util</code>封装了与google-cloud包(storage、pubsub、firestore等)的交互。)以简化其可重复使用的用法。你可以参考这个公共的Github库来安装这个包:</p></blockquote><div class="nt nu ez fb nv nw"><a href="https://github.com/edemnati/public/tree/master/my_lib/gcp" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab dw"><div class="ny ab nz cl cj oa"><h2 class="bd hj fi z dy ob ea eb oc ed ef hh bi translated">edemnati/public</h2><div class="od l"><h3 class="bd b fi z dy ob ea eb oc ed ef dx translated">python setup . py sdist from GCP _ CLOUD _ util . GCP _ CLOUD _ util导入GCP _ CLOUD _ util CD[CLOUD _ FUNCTION _ FOLDER]pip安装…</h3></div><div class="oe l"><p class="bd b fp z dy ob ea eb oc ed ef dx translated">github.com</p></div></div></div></a></div><p id="8571" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">让我们使用<a class="ae jn" href="https://cloud.google.com/sdk/" rel="noopener ugc nofollow" target="_blank"> Google Cloud SDK </a>部署这个云功能:</p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="5d5f" class="mr jp hi ng b fi nk nl l nm nn">gcloud functions deploy publish_rss_feed_search_message --runtime python37 --trigger-http</span></pre></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h2 id="1518" class="mr jp hi bd jq ms mt mu ju mv mw mx jy kp my mz ka kt na nb kc kx nc nd ke ne bi translated"><strong class="ak">将ESP部署到云运行</strong></h2><blockquote class="mk ml mm"><p id="a062" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated"><em class="hi">参考</em>:<a class="ae jn" href="https://cloud.google.com/sdk/gcloud/reference/beta/run/deploy" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/SDK/g cloud/Reference/beta/run/deploy</a></p><p id="910a" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated"><em class="hi">注:</em>目前云运行只支持<code class="du nq nr ns ng b">us-central1</code>。</p></blockquote><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="4f53" class="mr jp hi ng b fi nk nl l nm nn">gcloud beta run deploy rss-news-search --image=”gcr.io/endpoints-release/endpoints-runtime-serverless:1" --[YOUR GCP PROJECT ID]  --platform managed</span></pre><blockquote class="mk ml mm"><p id="5e7d" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated"><em class="hi">解释</em>:</p></blockquote><ul class=""><li id="6efc" class="ld le hi ki b kj lf km lg kp lh kt li kx lj lb lk ll lm ln bi translated"><code class="du nq nr ns ng b">gcloud beta</code>:我们正在使用glcoud命令的beta版本，所以我们应该迁移到未来的稳定版本。</li><li id="a5f1" class="ld le hi ki b kj lo km lp kp lq kt lr kx ls lb lk ll lm ln bi translated"><code class="du nq nr ns ng b">rss-news-search:</code> <strong class="ki hj"> </strong>这是将在云运行中创建的服务名。它也将是云端点服务主机名的一部分。</li><li id="5fbb" class="ld le hi ki b kj lo km lp kp lq kt lr kx ls lb lk ll lm ln bi translated"><code class="du nq nr ns ng b">--platform managed</code>:这个选项意味着我们将使用完全托管版本的云运行。如果省略，gcloud会让你选择一个目标平台(<code class="du nq nr ns ng b">[1] Cloud Run (fully managed), [2] Cloud Run on GKE, [3] cancel</code>)。</li></ul><blockquote class="mk ml mm"><p id="72f8" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated"><em class="hi">成功的结果应该是这样的:</em></p></blockquote><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="c408" class="mr jp hi ng b fi nk nl l nm nn">Deploying container to Cloud Run service [rss-news-search] in project <!-- -->[YOUR GCP PROJECT ID]<!-- --> region [us-central1]<br/> Deploying new service…<br/> Setting IAM Policy…done<br/> Creating Revision…done<br/> Routing traffic…\<br/> Done.<br/> Service [rss-news-search] revision [rss-news-search-00001] has been deployed and is serving traffic at https://<a class="ae jn" href="https://rss-news-search-e2j5ntpmpq-uc.a.run.app" rel="noopener ugc nofollow" target="_blank">[</a>GENERATED SERVICE HOSTNAME]</span></pre><p id="df13" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">请注意，<code class="du nq nr ns ng b"><a class="ae jn" href="https://rss-news-search-e2j5ntpmpq-uc.a.run.app" rel="noopener ugc nofollow" target="_blank">[</a>GENERATED SERVICE HOSTNAME]</code>将用于设置OpenAPI文档中的<em class="lc">主机</em>参数。</p><p id="a3b4" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">在谷歌云控制台中，您应该看到:</p><ul class=""><li id="96d2" class="ld le hi ki b kj lf km lg kp lh kt li kx lj lb lk ll lm ln bi translated">在云运行中创建了新服务:</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es of"><img src="../Images/1bbbc9d9f753607a6c82f0bed77049e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*scxihO_Na9sraDf25cnYFw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">云运行—新增服务</figcaption></figure><ul class=""><li id="dce7" class="ld le hi ki b kj lf km lg kp lh kt li kx lj lb lk ll lm ln bi translated">在云端点中创建了新服务:</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es og"><img src="../Images/57d6e4fab2ef798b4fced9fd90e32b6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ixBCCMsCJfZHZjdfztjI-A.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">云端点—添加了新服务</figcaption></figure></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h2 id="8e50" class="mr jp hi bd jq ms mt mu ju mv mw mx jy kp my mz ka kt na nb kc kx nc nd ke ne bi translated">创建<a class="ae jn" href="https://swagger.io/docs/specification/2-0/basic-structure/" rel="noopener ugc nofollow" target="_blank"> OpenAPI文档</a>来描述API规范</h2><p id="c678" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">参考:<a class="ae jn" href="https://swagger.io/docs/specification/basic-structure/" rel="noopener ugc nofollow" target="_blank"><em class="lc">https://swagger . io/docs/specification/descripting-parameters/</em></a></p><p id="d125" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">我们应该创建一个名为<code class="du nq nr ns ng b">openapi-functions.yaml</code>的文件。我们想要公开的每个函数都必须在<code class="du nq nr ns ng b">paths</code>部分列出。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="no np l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><a class="ae jn" href="https://gist.github.com/edemnati/8846462f6ba244fcaa85fa2d92f8b6ec#file-rss-search-process-openapi-functions-yaml" rel="noopener ugc nofollow" target="_blank"> RSS搜索流程— openapi-functions.yaml </a></figcaption></figure><blockquote class="mk ml mm"><p id="dcb0" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated"><em class="hi">解说</em>:</p></blockquote><p id="b302" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">在<em class="lc">主机</em>部分的<code class="du nq nr ns ng b">host: [GENERATED SERVICE HOSTNAME]</code>中，您应该复制我们将ESP部署到云运行时生成的URL。您也可以从云端点控制台界面获取is。</p><p id="7fad" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated"><strong class="ki hj">参数</strong></p><p id="d37e" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">在<code class="du nq nr ns ng b">paths </code>部分中，<code class="du nq nr ns ng b">/rsssearchprocess/start</code>是惟一的API路径名。它将连接到<code class="du nq nr ns ng b">host</code> URL以获得完整的API请求URL，比如<code class="du nq nr ns ng b"><a class="ae jn" href="https://rss-news-search-e2j5ntpmpq-uc.a.run.app/rsssearchprocess/start" rel="noopener ugc nofollow" target="_blank">https://[host][</a>api path]</code>。</p><blockquote class="mk ml mm"><p id="4a12" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated">有许多方法可以将参数传递给API。如果我们使用GET操作创建一个API，我们可以直接在URL中传递参数:路径参数如<code class="du nq nr ns ng b">/users/{id}</code>，或者查询参数如/ <code class="du nq nr ns ng b">users?role=admin</code>。</p></blockquote><p id="cbd4" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">在我们的例子中，我们将使用POST操作，因此我们需要指定一个<em class="lc">请求体</em>来使用json格式向后端传递参数。这在yaml文件中由下面突出显示的选项表示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es oh"><img src="../Images/2d06186a58522cbc81dedac6a660d486.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*MGDxUt_Z8vDS6qBi4-iARw.png"/></div></figure><p id="a1de" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">然后我们需要描述主体模式对象:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oi"><img src="../Images/285b2b11ff18523deafa640e25b4e75f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j-3jhBApGSSU1HCOg0P7bw.png"/></div></div></figure><ul class=""><li id="85be" class="ld le hi ki b kj lf km lg kp lh kt li kx lj lb lk ll lm ln bi translated"><code class="du nq nr ns ng b">required </code>部分标识强制属性。在这种情况下，<em class="lc"> url </em>、<em class="lc"> source </em>和<em class="lc"> keyword </em>必须非空，但是<em class="lc"> limit </em>属性仍然是可选的。</li><li id="84ae" class="ld le hi ki b kj lo km lp kp lq kt lr kx ls lb lk ll lm ln bi translated">对于每个属性，我们指定了一个<code class="du nq nr ns ng b">type</code>，它引用了一个<a class="ae jn" href="https://swagger.io/docs/specification/data-models/data-types/" rel="noopener ugc nofollow" target="_blank">数据类型</a>和一个<code class="du nq nr ns ng b">description</code>，后者提供了关于属性的描述性信息。我们还可以添加其他的<a class="ae jn" href="https://swagger.io/docs/specification/data-models/data-types/" rel="noopener ugc nofollow" target="_blank">规范</a>，比如<code class="du nq nr ns ng b">minimum</code>，我们在本例中使用它来为<em class="lc">限制</em>属性指定最小值1。</li></ul><blockquote class="mk ml mm"><p id="91fb" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated">之前的信息将作为API文档的一部分在端点门户中使用。</p></blockquote><p id="6dc9" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated"><strong class="ki hj">安全</strong></p><p id="e61f" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">在本例中，我们使用API密钥来限制API的使用，但是也可以使用其他认证方法。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es oj"><img src="../Images/8c1350e0069af99ff4e496313cbbfec6.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*Mc98W3FGJkEzQesoOnqIsw.png"/></div></figure><p id="b453" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">yaml文件的末尾描述了安全定义:</p><p id="b9f5" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated"><code class="du nq nr ns ng b">in: “query”</code>意味着API键将作为URL的一部分作为查询参数传递，就像<code class="du nq nr ns ng b">/start?key=[YOUR_API_KEY]</code></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ok"><img src="../Images/880aef24f688b7b870602f62d10b07a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t_dlcWnGZQWtCN3yFzrG7w.png"/></div></div></figure><p id="c550" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">最后，<code class="du nq nr ns ng b">x-google-backend</code>部分用于定位云函数URL: <code class="du nq nr ns ng b">address: <a class="ae jn" href="https://us-central1-[YOUR" rel="noopener ugc nofollow" target="_blank">https://us-central1-[YOUR</a> GCP PROJECT ID].cloudfunctions.net/[Cloud Function Name]</code>。</p><p id="5dc9" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated"><code class="du nq nr ns ng b"><a class="ae jn" href="https://us-central1-[YOUR" rel="noopener ugc nofollow" target="_blank">[YOUR</a> GCP PROJECT ID]</code>:应该是部署云功能的项目ID。</p><p id="3207" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated"><code class="du nq nr ns ng b">[Cloud Function Name]</code>:应该是云函数名，就是这个例子<code class="du nq nr ns ng b">publish_rss_feed_search_message</code>。</p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h2 id="3789" class="mr jp hi bd jq ms mt mu ju mv mw mx jy kp my mz ka kt na nb kc kx nc nd ke ne bi translated">部署端点配置</h2><p id="0f50" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">填写完OpenAPI文档后，我们应该使用以下命令部署它:</p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="e23a" class="mr jp hi ng b fi nk nl l nm nn">gcloud endpoints services deploy openapi-functions.yaml --<a class="ae jn" href="https://us-central1-[YOUR" rel="noopener ugc nofollow" target="_blank">[YOUR</a> GCP PROJECT ID]</span></pre></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h2 id="6f1b" class="mr jp hi bd jq ms mt mu ju mv mw mx jy kp my mz ka kt na nb kc kx nc nd ke ne bi translated">配置ESP，以便它可以找到您的端点服务的配置</h2><p id="d399" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">以下命令将使用配置ESP:</p><ul class=""><li id="8bc4" class="ld le hi ki b kj lf km lg kp lh kt li kx lj lb lk ll lm ln bi translated"><code class="du nq nr ns ng b">rss-news-search</code>:云运行服务名称</li><li id="80e1" class="ld le hi ki b kj lo km lp kp lq kt lr kx ls lb lk ll lm ln bi translated"><code class="du nq nr ns ng b">[GENERATED SERVICE HOSTNAME]</code>:云端端点服务主机名</li><li id="0942" class="ld le hi ki b kj lo km lp kp lq kt lr kx ls lb lk ll lm ln bi translated"><code class="du nq nr ns ng b">[YOUR GCP PROJECT ID]</code>:部署端点的项目ID</li></ul><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="9b50" class="mr jp hi ng b fi nk nl l nm nn">gcloud beta run services update rss-news-search -- set-env-vars ENDPOINTS_SERVICE_NAME=[GENERATED SERVICE HOSTNAME] --<a class="ae jn" href="https://us-central1-[YOUR" rel="noopener ugc nofollow" target="_blank">[YOUR</a> GCP PROJECT ID]<!-- --> -- platform managed</span></pre><blockquote class="mk ml mm"><p id="f84a" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated">如果您收到类似于<code class="du nq nr ns ng b">gcloud crashed (AttributeError): ‘NoneType’ object has no attribute 'revisionTemplate'</code>的错误，更新gcloud组件可能会解决问题。运行以下命令来执行此操作:<code class="du nq nr ns ng b">gcloud components update</code></p><p id="da61" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated">成功的结果应该是这样的:</p></blockquote><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="7e38" class="mr jp hi ng b fi nk nl l nm nn">Deploying…<br/> Creating Revision…done<br/> Routing traffic…done<br/> Done.<br/> Service [rss-news-search] revision [rss-news-search-00001] is active and serving traffic at <a class="ae jn" href="https://rss-news-search-e2j5ntpmpq-uc.a.run.app" rel="noopener ugc nofollow" target="_blank">https://</a>[GENERATED SERVICE HOSTNAME]</span></pre></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h2 id="67f8" class="mr jp hi bd jq ms mt mu ju mv mw mx jy kp my mz ka kt na nb kc kx nc nd ke ne bi translated">授予ESP调用目标云函数的权限</h2><p id="2ddf" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">以下命令将授予ESP使用以下命令调用云函数的权限:</p><p id="79be" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated"><code class="du nq nr ns ng b">publish_rss_feed_search_message</code>:云功能名称</p><p id="ad34" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated"><code class="du nq nr ns ng b">[Default compute service account]</code>:进入<em class="lc"> IAM控制台</em>找到<em class="lc">默认计算服务账号</em></p><p id="f04c" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated"><code class="du nq nr ns ng b">[YOUR GCP PROJECT ID]:</code>部署云功能的项目ID</p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="3692" class="mr jp hi ng b fi nk nl l nm nn">gcloud beta functions add-iam-policy-binding publish_rss_feed_search_message --member "serviceAccount:<a class="ae jn" href="mailto:171048761773-compute@developer.gserviceaccount.com" rel="noopener ugc nofollow" target="_blank">[</a>Default compute service account] --role "roles/cloudfunctions.invoker" --project <a class="ae jn" href="https://us-central1-[YOUR" rel="noopener ugc nofollow" target="_blank">[YOUR</a> GCP PROJECT ID]</span></pre><blockquote class="mk ml mm"><p id="6f96" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated"><em class="hi">成功的结果应该是这样的:</em></p></blockquote><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="ba5f" class="mr jp hi ng b fi nk nl l nm nn">bindings:<br/> - members:<br/>   - serviceAccount:<a class="ae jn" href="mailto:171048761773-compute@developer.gserviceaccount.com" rel="noopener ugc nofollow" target="_blank">[</a>Default compute service account]<br/>   role: roles/cloudfunctions.invoker<br/> etag: xxxxxxxxxxx<br/> version: 1</span></pre></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h1 id="ea53" class="jo jp hi bd jq jr mf jt ju jv mg jx jy io mh ip ka ir mi is kc iu mj iv ke kf bi translated">云端点:如何…</h1><h2 id="ec7a" class="mr jp hi bd jq ms mt mu ju mv mw mx jy kp my mz ka kt na nb kc kx nc nd ke ne bi translated"><em class="ol">删除云端点服务</em></h2><ul class=""><li id="08a9" class="ld le hi ki b kj kk km kn kp om kt on kx oo lb lk ll lm ln bi translated">服务列表:<code class="du nq nr ns ng b">gcloud endpoints services list</code></li><li id="7bc6" class="ld le hi ki b kj lo km lp kp lq kt lr kx ls lb lk ll lm ln bi translated">删除一个服务:<code class="du nq nr ns ng b">gcloud endpoints services delete [GENERATED SERVICE HOSTNAME]</code></li></ul><h2 id="679f" class="mr jp hi bd jq ms mt mu ju mv mw mx jy kp my mz ka kt na nb kc kx nc nd ke ne bi translated"><em class="ol">授予对Enpoints门户网站的访问权限</em></h2><p id="f1a6" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">参考:Ref:<a class="ae jn" href="https://cloud.google.com/endpoints/docs/grpc/control-api-access" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/endpoints/docs/grpc/control-API-access</a></p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="ea41" class="mr jp hi ng b fi nk nl l nm nn">gcloud beta run services add-iam-policy-binding <!-- -->[GENERATED SERVICE HOSTNAME]<!-- --> --member='[User email]'  --role='roles/run.invoker'</span></pre><h2 id="c16c" class="mr jp hi bd jq ms mt mu ju mv mw mx jy kp my mz ka kt na nb kc kx nc nd ke ne bi translated"><em class="ol">配置配额</em></h2><p id="2926" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">参考:<a class="ae jn" href="https://cloud.google.com/endpoints/docs/openapi/quotas-configure" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/endpoints/docs/open API/quotas-configure</a></p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h1 id="6bad" class="jo jp hi bd jq jr mf jt ju jv mg jx jy io mh ip ka ir mi is kc iu mj iv ke kf bi translated">部署第二个安全API</h1><p id="2f02" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">前面的分步过程用于部署第二个API，以允许授权用户访问文章。以下是这些步骤的简短总结:</p><blockquote class="mk ml mm"><p id="72e8" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated">部署云功能</p></blockquote><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="no np l"/></div></figure><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="f78d" class="mr jp hi ng b fi nk nl l nm nn">gcloud functions deploy read_articles_firestore --runtime python37 --trigger-http</span></pre><blockquote class="mk ml mm"><p id="1863" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated">将ESP部署到云运行</p></blockquote><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="01fb" class="mr jp hi ng b fi nk nl l nm nn">gcloud beta run deploy read-news-articles --image="gcr.io/endpoints-release/endpoints-runtime-serverless:1" --allow-unauthenticated --project=[YOUR GCP PROJECT ID] --platform managed</span></pre><blockquote class="mk ml mm"><p id="3862" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated">创建OpenAPI文档来描述API规范</p></blockquote><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="no np l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><a class="ae jn" href="https://gist.github.com/edemnati/44f8c88f8f06ef6ac2a1eca43e5ddffd#file-read-news-articles-openapi-functions-yaml" rel="noopener ugc nofollow" target="_blank">阅读新闻文章— openapi-functions.yaml </a></figcaption></figure><p id="0ab0" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">在这种情况下，我们部署了两个接入点来测试不同的安全模型:</p><ul class=""><li id="dae5" class="ld le hi ki b kj lf km lg kp lh kt li kx lj lb lk ll lm ln bi translated"><code class="du nq nr ns ng b">/readnewsarticlesapi/start</code>:将使用<em class="lc"> API键</em>固定，如前所示。</li><li id="5d37" class="ld le hi ki b kj lo km lp kp lq kt lr kx ls lb lk ll lm ln bi translated"><code class="du nq nr ns ng b">/readnewsarticlesuser/start</code>:将使用<a class="ae jn" href="https://cloud.google.com/endpoints/docs/openapi/authenticating-users-firebase" rel="noopener ugc nofollow" target="_blank"> <em class="lc"> Firebase认证方法</em> </a>进行保护。<code class="du nq nr ns ng b">securityDefintion </code>部分应配置为:</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es op"><img src="../Images/8c53d46cccdcb54f3981c9df39453612.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I1K5ByBg3WMFwW52sMX30g.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><a class="ae jn" href="https://cloud.google.com/endpoints/docs/openapi/authenticating-users-firebase" rel="noopener ugc nofollow" target="_blank"> <em class="ol"> Firebase认证方法</em> </a></figcaption></figure><blockquote class="mk ml mm"><p id="324d" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated">部署端点配置</p></blockquote><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="7ec4" class="mr jp hi ng b fi nk nl l nm nn">gcloud endpoints services deploy openapi-functions.yaml --project [YOUR GCP PROJECT ID]</span></pre><blockquote class="mk ml mm"><p id="35c2" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated">配置ESP，以便它可以找到您的端点服务的配置</p></blockquote><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="89c6" class="mr jp hi ng b fi nk nl l nm nn">gcloud beta run services update read-news-articles --set-env-vars ENDPOINTS_SERVICE_NAME=[GENERATED SERVICE HOSTNAME] --project [YOUR GCP PROJECT ID] --platform managed</span></pre><blockquote class="mk ml mm"><p id="f73e" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated">授予ESP调用目标云函数的权限</p></blockquote><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="0c83" class="mr jp hi ng b fi nk nl l nm nn">gcloud beta functions add-iam-policy-binding read_articles_firestore --member "serviceAccount:<a class="ae jn" href="mailto:171048761773-compute@developer.gserviceaccount.com" rel="noopener ugc nofollow" target="_blank">[</a>Default compute service account] --role "roles/cloudfunctions.invoker" --project [YOUR GCP PROJECT ID]</span></pre></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h1 id="e367" class="jo jp hi bd jq jr mf jt ju jv mg jx jy io mh ip ka ir mi is kc iu mj iv ke kf bi translated">测试您的API</h1><h2 id="2ab1" class="mr jp hi bd jq ms mt mu ju mv mw mx jy kp my mz ka kt na nb kc kx nc nd ke ne bi translated">端点门户</h2><p id="29a5" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">您可以从云端点控制台的<em class="lc">开发者门户</em>部分创建一个门户。创建后，您应该会看到端点门户的URL:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oq"><img src="../Images/bf41af560f94e0cf31a9c8b5331331e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bo3mk4qsJINLPvTU0ffh6w.png"/></div></div></figure><p id="c6ba" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">如果您转到门户网站，您应该会看到您的API服务:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es or"><img src="../Images/6b484bb3c977f1d87755e81fd4d1f7ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z9jG22DlpLVYKJxQ52VJJg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">端点开发人员门户</figcaption></figure><blockquote class="mk ml mm"><p id="c32d" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated">RSS搜索过程</p></blockquote><p id="d99c" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">您必须将API密钥配置为能够通过API密钥保护API。进入<em class="lc">设置</em>并输入授权的API密钥。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es os"><img src="../Images/813148ac6769d184876cbd8b719afdf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WWj3VFFYHuQ3Wr0QSg7Z0w.png"/></div></div></figure><blockquote class="mk ml mm"><p id="c4fb" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated">如果您还没有API密钥，请按照以下步骤创建一个:</p></blockquote><ol class=""><li id="df2a" class="ld le hi ki b kj lf km lg kp lh kt li kx lj lb lw ll lm ln bi translated">登录GCP控制台，进入<em class="lc">API&amp;服务&gt;凭证</em></li></ol><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ot"><img src="../Images/988eba19027561be630ce62a0cab0b8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5h9CvxVFHB3sV-DxMtNGBQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">创建新的API密钥</figcaption></figure><p id="c803" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">2.点击创建<em class="lc">凭证&gt; API键</em></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ou"><img src="../Images/591c2e40471f039a81494f668f630293.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VlL-TEWk3jIla5pTPkBQRw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">API密钥已创建</figcaption></figure><p id="ad5c" class="pw-post-body-paragraph kg kh hi ki b kj lf ij kl km lg im ko kp lt kr ks kt lu kv kw kx lv kz la lb hb bi translated">3.点击<em class="lc">限制键</em>选项，将API键限制在特定范围内。在这种情况下，我们将API键限制为只能访问我们之前创建的两个API:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ov"><img src="../Images/973f98ebe0ecad1642ec5873e3ab4d61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*soD-cBPhphBZxlYi6ZaQJQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">限制API密钥</figcaption></figure><h2 id="3fd6" class="mr jp hi bd jq ms mt mu ju mv mw mx jy kp my mz ka kt na nb kc kx nc nd ke ne bi translated">让我们来测试一下！</h2><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ow np l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">测试端点门户API</figcaption></figure><h2 id="62f7" class="mr jp hi bd jq ms mt mu ju mv mw mx jy kp my mz ka kt na nb kc kx nc nd ke ne bi translated">使用Python测试您的API</h2><p id="9296" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">此示例代码来自端点门户。其他示例代码可用于cURL、HTTP、NODE。JS，Javascript，JAVA和PHP。</p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="7464" class="mr jp hi ng b fi nk nl l nm nn"># Demo code sample. Not indended for production use.</span><span id="82aa" class="mr jp hi ng b fi ox nl l nm nn"># See instructions for installing Requests module for Python<br/># <a class="ae jn" href="http://docs.python-requests.org/en/master/user/install/" rel="noopener ugc nofollow" target="_blank">http://docs.python-requests.org/en/master/user/install/</a></span><span id="5e0e" class="mr jp hi ng b fi ox nl l nm nn">import requests</span><span id="d58e" class="mr jp hi ng b fi ox nl l nm nn">def execute():<br/>  requestUrl = "<a class="ae jn" href="https://read-news-articles-e2j5ntpmpq-uc.a.run.app/readnewsarticlesuser/start" rel="noopener ugc nofollow" target="_blank">https://</a>[GENERATED SERVICE HOSTNAME]<a class="ae jn" href="https://read-news-articles-e2j5ntpmpq-uc.a.run.app/readnewsarticlesuser/start" rel="noopener ugc nofollow" target="_blank">/readnewsarticlesuser/start</a>"<br/>  requestBody = {<br/>    "entity": "Apple"<br/>  }<br/>  requestHeaders = {<br/>    "Authorization": "Bearer [YOUR_API_KEY]",<br/>    "Accept": "application/json",<br/>    "Content-Type": "application/json"<br/>  }</span><span id="c79b" class="mr jp hi ng b fi ox nl l nm nn">request = requests.post(requestUrl, headers=requestHeaders, json=requestBody)</span><span id="d29e" class="mr jp hi ng b fi ox nl l nm nn">print request.content</span><span id="0be9" class="mr jp hi ng b fi ox nl l nm nn">if __name__ == "__main__":<br/>  execute()</span></pre><h1 id="765b" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">分享你的作品</h1><blockquote class="mk ml mm"><p id="e037" class="kg kh lc ki b kj lf ij kl km lg im ko mn lt kr ks mo lu kv kw mp lv kz la lb hb bi translated">既然我们已经创建了安全API，我们可以选择在Web应用程序中使用它们，或者与其他用户共享它们。</p></blockquote><ul class=""><li id="6e77" class="ld le hi ki b kj lf km lg kp lh kt li kx lj lb lk ll lm ln bi translated">对于API密钥认证，我们可以创建不同的API密钥来跟踪用户或应用程序调用。</li><li id="943f" class="ld le hi ki b kj lo km lp kp lq kt lr kx ls lb lk ll lm ln bi translated">对于Firebase身份验证方法，您应该授权用户访问您的服务。</li><li id="db35" class="ld le hi ki b kj lo km lp kp lq kt lr kx ls lb lk ll lm ln bi translated">您还可以允许某人在他们自己的云项目中启用您的服务来调用API。您需要为他们分配<em class="lc">服务消费者角色</em>。您可以使用<a class="ae jn" href="https://cloud.google.com/endpoints/docs/openapi/control-api-callers" rel="noopener ugc nofollow" target="_blank"> gcloud commands </a>或者转到云端点控制台，选择一个服务并点击<em class="lc"> Permissions </em>来添加成员并赋予他们<em class="lc">服务消费者角色</em>。</li></ul></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h1 id="6e30" class="jo jp hi bd jq jr mf jt ju jv mg jx jy io mh ip ka ir mi is kc iu mj iv ke kf bi translated">临终遗言</h1><p id="20b3" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">您的API也可以在<em class="lc">API&amp;服务库</em>中看到。您可以通过私有标签过滤来查看您的API。点击一个API就可以管理它。您将能够禁用它，查看一些关于流量、错误、延迟的指标，并查看哪些API键被授权访问它。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oy"><img src="../Images/82c480e1443362d3ac9f3efa96d87ce9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UDl45HpNg9jmt-qOZktBIA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">API和服务屏幕</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oz"><img src="../Images/60adc1853b166226f2249ed0a31a8ac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SUWLG9nlvCSrokojN3cdNA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">管理API屏幕</figcaption></figure></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es pa"><img src="../Images/e4d335ddc88a00b0c6ac638ba1a8f091.png" data-original-src="https://miro.medium.com/v2/resize:fit:66/format:webp/1*X03LnZofEJHVwuh2PMGpyw.png"/></div></figure><blockquote class="pb"><p id="f52e" class="pc pd hi bd pe pf pg ph pi pj pk lb dx translated">我希望你喜欢这篇文章。请分享您的意见、感受和改进...</p></blockquote></div></div>    
</body>
</html>