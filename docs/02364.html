<html>
<head>
<title>Setting Up a Multi-GPU Machine and Testing With a TensorFlow Deep Learning Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设置多GPU机器并用TensorFlow深度学习模型进行测试</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/setting-up-a-multi-gpu-machine-and-testing-with-a-tensorflow-deep-learning-model-c35ad76603cf?source=collection_archive---------1-----------------------#2019-12-13">https://medium.com/analytics-vidhya/setting-up-a-multi-gpu-machine-and-testing-with-a-tensorflow-deep-learning-model-c35ad76603cf?source=collection_archive---------1-----------------------#2019-12-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/85836fa9b4066fd85c0bb52bad723dd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zaV6NE5Iiwf2tSZL"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Alexandre Debiève 在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="6436" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">过去，我使用GeForce GTX 1080构建了一台GPU计算机，并训练了几个深度学习模型。最近有机会为一些深度学习和多GPU处理用例搭建了一台多GPU计算机。在下面的文章中，我将带您完成设置，我们将训练一个可通过TensorFlow的GitHub页面访问的TensorFlow模型。</p><p id="e009" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">硬件规格和操作系统的建立</strong></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jt"><img src="../Images/6b386abe53f3c591a143250f9de622a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YXaCWuNPUTWHPxqvHC7Vcw.png"/></div></div></figure><p id="588c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我需要CUDA工具包和Nvidia驱动程序来使用我的显卡。我最初安装CUDA Toolkit 10.1时遇到了一个问题，这是本文发表时的第二个最新版本，但与TensorFlow存在一些兼容性问题，所以我降级到了10.0。查看哪些CUDA工具包和驱动程序是兼容的，哪些TensorFlow适用于特定的CUDA版本，这一点非常重要。我最终选择的司机是435</p><p id="f02a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">这里是每个CUDA工具包版本和Nvidia驱动程序版本的兼容性图表</strong></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jy"><img src="../Images/b952846d0792c0335a9b194cb69bc9b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*JQp6LxbCZRhQADaYKAlsrQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">CUDA兼容性图表</figcaption></figure><p id="4809" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以，既然我们已经有了CUDA版本和Nvidia驱动程序，我们需要开始安装所有的东西。从更新升级、Ubuntu库开始，验证显卡是否可用。如果运行命令<strong class="ix hj"><em class="jz">“lspci | grep-I NVIDIA”</em></strong>而看不到卡。重启电脑并再次运行该命令。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ka"><img src="../Images/022cddca57a5789d8cc809a2fcf6db9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l7faSGYfwQH37FiWS2cMQA.png"/></div></div></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ka"><img src="../Images/b02a3275ab5b603a54fda2c4c0017780.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NK9raDjnvqr5WXr5DTWuhQ.png"/></div></div></figure><p id="deeb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">安装显卡驱动</strong></p><p id="303b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在Ubuntu 18上安装驱动程序非常容易。通过以下路径找到更换驱动程序的位置</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kb"><img src="../Images/548f15db5257470b2d095988d64d26d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*RwVOF3iWUBvMbUBfQ4lm5Q.png"/></div></figure><p id="5bb6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您将看到以下带有单选按钮的弹出框。默认是新的显示驱动程序。我把它改成nvidia-driver-435，然后点击<strong class="ix hj"> <em class="jz">“应用更改”</em> </strong>按钮。这大约需要10分钟才能完成。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kc"><img src="../Images/60a15ad01d4d0c19fb2f41746b57433a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iXbtXnfTIJamVgRRpVY1qg.png"/></div></div></figure><p id="8eb6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">完成后，重新启动您的电脑，并输入到命令提示符，以验证驱动程序已成功安装。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ka"><img src="../Images/dce6afbc58b27fc22bf75b029dcb1e4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mh4n5TiokAP7-SbKWLCMEw.png"/></div></div></figure><p id="efa9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您应该会看到如下输出:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/45a6eb8cc402c0747eb86252af6cb0e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vkbs7Ta5IzeYD65LykBP5A.png"/></div></div></figure><p id="0491" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">安装CUDA和libcudnn </strong></p><p id="d1ed" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，让我们为CUDA安装正确的Nvidia存储库，并安装CUDA和libcudnn的特定版本。这种情况下是CUDA 10和libcudnn 7。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ke"><img src="../Images/a019a8a6fe3be5a6d5b2b5478e3522c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DIqM0u5z6nE2gEwjUnEhuQ.png"/></div></div></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kf"><img src="../Images/c6d6ce8edd78bee76a4f56054ab2791f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K-Qa4SFcM1-Aj0ZLe2zqDQ.png"/></div></div></figure><p id="5675" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">添加环境变量的路径</strong></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kg"><img src="../Images/f452a4351f2d55de82cb015116dedd30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PLbWz6N4EtficgfqhhC2og.png"/></div></div></figure><p id="85fb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">验证CUDA的安装和版本</strong></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kh"><img src="../Images/f28ec2f2786d46994df9dadc02f0d2f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wkwRlZM5OCcq3xhgqtboyA.png"/></div></div></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ki"><img src="../Images/2874c47a6b0f2803b58c0cf83921d2a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ma5V5VLR2ug3iav3ICwZ2g.png"/></div></div></figure></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><p id="d748" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">测试GPU的</strong></p><p id="64fe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在是测试GPU的时候了，确保它们都得到利用。我们将使用TensorFlow的GitHub页面中的“cifar10_estimator”示例:<a class="ae iu" href="https://github.com/tensorflow/models/tree/master/tutorials/image/cifar10_estimator" rel="noopener ugc nofollow" target="_blank">https://GitHub . com/tensor flow/models/tree/master/tutorials/image/cifar 10 _ estimator</a></p><p id="fc2f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此命令下载cifar-10数据集:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kq"><img src="../Images/1ae6a71fdc87c6319080967ea8b20540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*75o-VsTuRRwPh8DagB2TJw.png"/></div></div></figure><p id="ce3a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下载完数据后，您可以运行以下代码来启动python脚本，该脚本使用最近下载的数据集来训练和测试模型。你可以看到我在哪里用这部分<strong class="ix hj"><em class="jz">-num-GPU = 2 "</em></strong>加上了GPU的数量。如果你有4个GPU，你可以把它改成<strong class="ix hj"><em class="jz">-num-GPU = 4 "</em></strong>。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/1b8c33ca091d37118fb589d1ccaf8e53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b22CCr4JtOmd2E6YqOmWlw.png"/></div></div></figure><p id="f206" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我喜欢监控GPU的功率、内存使用和利用率。有一个很棒的内置工具可以为你显示这个叫做<strong class="ix hj"><em class="jz">“NVIDIA-SMI”</em></strong>。要持续监控，您可以使用以下命令。你会看到我选择了数字5。这意味着它将每5秒刷新一次。您可以根据自己的选择更改这个数字。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kf"><img src="../Images/b9051a8795bc87ec1d27d6558eae5e45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2jKrQ7LjbpBVLttHBCpYNQ.png"/></div></div></figure><p id="4433" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以看到在深度学习模型启动之前这是什么样子。瓦数、内存和利用率较低或为0%。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/ef0d4e624e398fdee8ea9eb3013f0a80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fsX1lLDMq3AzNImG6xhwzw.png"/></div></div></figure><p id="b588" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">模型启动后，您可以看到所有这3项都有所增加。显示两个GPU都在致力于这个模型的训练。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/31af434eb82c3ed0957538889df61f78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OUF1cdOqlx-11lw-dMOlCA.png"/></div></div></figure><p id="84d6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在你知道了。还不错，只需安装和下载几个程序，你也可以在多个GPU上运行深度学习模型。</p></div></div>    
</body>
</html>