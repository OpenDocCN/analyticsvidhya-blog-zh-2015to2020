<html>
<head>
<title>COVID19-API.org Data Exploration and Visualizing Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python进行COVID19-API.org数据探索和可视化</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/covid19-api-org-data-exploration-and-visualizing-using-python-203639996d35?source=collection_archive---------24-----------------------#2020-10-14">https://medium.com/analytics-vidhya/covid19-api-org-data-exploration-and-visualizing-using-python-203639996d35?source=collection_archive---------24-----------------------#2020-10-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="d94b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Covid19是一种已经传播到全世界的疫情。世界上大多数国家都被感染了。根据政府政策，每个国家的处理方式是不同的。这导致不同国家COVID病例增加或减少的趋势存在差异。</p><p id="5bd6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这种情况下，我们将尝试从一个可用的明火中挖掘covid19数据，即<a class="ae jk" href="https://covid19-api.org/" rel="noopener ugc nofollow" target="_blank">https://covid19-api.org/.</a></p><div class="jl jm ez fb jn jo"><a href="https://covid19-api.org/" rel="noopener  ugc nofollow" target="_blank"><div class="jp ab dw"><div class="jq ab jr cl cj js"><h2 class="bd hj fi z dy jt ea eb ju ed ef hh bi translated">免费新冠肺炎API</h2><div class="jv l"><h3 class="bd b fi z dy jt ea eb ju ed ef dx translated">你可以在Postman中查看我们API的文档。它包含所有请求的描述，它们被接受…</h3></div><div class="jw l"><p class="bd b fp z dy jt ea eb ju ed ef dx translated">covid19-api.org</p></div></div><div class="jx l"><div class="jy l jz ka kb jx kc kd jo"/></div></div></a></div><blockquote class="ke kf kg"><p id="51e6" class="im in kh io b ip iq ir is it iu iv iw ki iy iz ja kj jc jd je kk jg jh ji jj hb bi translated">简单来说，API可以理解为计算机与其他计算机进行通信的一种方式，以便可以发生数据交换事务。因此在这个项目中，我们将学习从API检索数据的技术、准备数据的技术以及数据分析和可视化。</p></blockquote><h1 id="e40e" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">导入库</h1><p id="c556" class="pw-post-body-paragraph im in hi io b ip lj ir is it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj hb bi translated">首先，导入需要的库。</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="a263" class="lx km hi lt b fi ly lz l ma mb">import json</span><span id="76ff" class="lx km hi lt b fi mc lz l ma mb">import numpy as np</span><span id="0690" class="lx km hi lt b fi mc lz l ma mb">import pandas as pd</span><span id="e861" class="lx km hi lt b fi mc lz l ma mb">import requests</span><span id="8ae3" class="lx km hi lt b fi mc lz l ma mb">import matplotlib.pyplot as plt</span><span id="2d64" class="lx km hi lt b fi mc lz l ma mb">import datetime</span></pre><h1 id="5f1b" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">加载数据</h1><p id="62a8" class="pw-post-body-paragraph im in hi io b ip lj ir is it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj hb bi translated">用api_url参数创建一个python get_json函数。如果结果status_code为200，此函数将返回一个python字典值。否则，返回值为None。</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="e64b" class="lx km hi lt b fi ly lz l ma mb">def get_json(api_url):</span><span id="9fd6" class="lx km hi lt b fi mc lz l ma mb">response = requests.get(api_url)</span><span id="66d2" class="lx km hi lt b fi mc lz l ma mb">if response.status_code == 200:</span><span id="dd23" class="lx km hi lt b fi mc lz l ma mb">return json.loads(response.content.decode('utf-8'))</span><span id="74f1" class="lx km hi lt b fi mc lz l ma mb">else:</span><span id="5244" class="lx km hi lt b fi mc lz l ma mb">return None</span></pre><p id="1aa3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">全球COVID19数据在covid19-api.org。我们通过“2020–09–7”使用record_date变量，并将API响应结果放入df_covid_worldwide变量中。</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="9ce3" class="lx km hi lt b fi ly lz l ma mb">record_date = '2020-10-12'</span><span id="72ea" class="lx km hi lt b fi mc lz l ma mb">covid_url = 'https://covid19-api.org/api/status?date='+record_date</span><span id="abad" class="lx km hi lt b fi mc lz l ma mb">df_covid_worldwide = pd.io.json.json_normalize(get_json(covid_url))</span></pre><p id="7beb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了获得COVID19数据帧，我们应该规范化并调用之前创建的函数。然后，我们可以看到数据框中的前5个数据。</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="fd65" class="lx km hi lt b fi ly lz l ma mb">df_covid_worldwide.head()</span><span id="258f" class="lx km hi lt b fi mc lz l ma mb">country          last_update    cases  deaths  recovered<br/>0      US  2020-08-16T23:27:50  5401167  170019    1833067<br/>1      BR  2020-08-16T23:27:50  3340197  107852    2655017<br/>2      IN  2020-08-16T23:27:50  2589682   49980    1862258<br/>3      RU  2020-08-16T23:27:50   920719   15653     731444<br/>4      ZA  2020-08-16T23:27:50   587345   11839     472377</span></pre><h1 id="5ad6" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">数据探索和可视化</h1><h2 id="1d2a" class="lx km hi bd kn md me mf kr mg mh mi kv ix mj mk kz jb ml mm ld jf mn mo lh mp bi translated">—各大洲的案例</h2><p id="596e" class="pw-post-body-paragraph im in hi io b ip lj ir is it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj hb bi translated">让我们从名为countries.csv的<a class="ae jk" href="https://github.com/dwiknrd/medium-code/blob/master/covid19-eda/countries.csv" rel="noopener ugc nofollow" target="_blank"> my GitHub </a>中取出一个不同的数据帧，然后作为熊猫数据帧加载。将先前的数据帧与新的数据帧合并</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="ce36" class="lx km hi lt b fi ly lz l ma mb">countries_df = pd.read_csv("countries.csv")</span><span id="f23c" class="lx km hi lt b fi mc lz l ma mb">countries_df = countries_df.rename(columns = {'location': 'name'}, inplace = False)</span><span id="cbee" class="lx km hi lt b fi mc lz l ma mb">covid_df = countries_df.merge(df_covid_denormalized, on='name')</span></pre><p id="94a2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">通过可视化，我们可以看到病例百分比很高的大陆。</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="5ebb" class="lx km hi lt b fi ly lz l ma mb">continent_case = covid_df.groupby('continent')['cases'].sum()</span><span id="18cd" class="lx km hi lt b fi mc lz l ma mb">plt.style.use('fivethirtyeight')</span><span id="62ce" class="lx km hi lt b fi mc lz l ma mb">plt.figure(figsize=(13,7))</span><span id="a418" class="lx km hi lt b fi mc lz l ma mb">plt.title("Percentage of Confirmed Cases on Each Continent")</span><span id="f3a7" class="lx km hi lt b fi mc lz l ma mb">g = plt.pie(continent_case, labels=continent_case.index,autopct='%1.1f%%', startangle=180)</span><span id="32f0" class="lx km hi lt b fi mc lz l ma mb">plt.show()</span></pre><figure class="lo lp lq lr fd mr er es paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="er es mq"><img src="../Images/25f01dfcf8c79df868628e272ad89c9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fSL82sDSA-Uadn2uy6tZkQ.png"/></div></div></figure><p id="6bdf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">正如我们在上面的饼图中所看到的，亚洲在Covid19的高确诊病例中占据首位。</p><h2 id="f114" class="lx km hi bd kn md me mf kr mg mh mi kv ix mj mk kz jb ml mm ld jf mn mo lh mp bi translated">—病死率(CFR)</h2><p id="ff31" class="pw-post-body-paragraph im in hi io b ip lj ir is it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj hb bi translated">在流行病学中，有一个致死率，它是指在特定时期内，死于某种疾病的人数占被诊断患有该疾病的总人数的比例。</p><p id="3bc5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以，让我们为死亡率做一个新的栏目。</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="28a0" class="lx km hi lt b fi ly lz l ma mb">df_covid_denormalized['fatality_ratio'] = df_covid_denormalized['deaths']/df_covid_denormalized['cases']</span></pre><p id="bedf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">通过可视化，我们可以看到死亡率高的20个国家。</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="d60d" class="lx km hi lt b fi ly lz l ma mb">plt.figure(figsize=(17, 7))</span><span id="3288" class="lx km hi lt b fi mc lz l ma mb">y = df_top_20_fatality_rate['name']</span><span id="cdc7" class="lx km hi lt b fi mc lz l ma mb">x = df_top_20_fatality_rate['fatality_ratio']</span><span id="b01e" class="lx km hi lt b fi mc lz l ma mb">plt.ylabel('Country Name')</span><span id="0806" class="lx km hi lt b fi mc lz l ma mb">plt.xlabel('Fatality Rate')</span><span id="ca9e" class="lx km hi lt b fi mc lz l ma mb">plt.title('Top 20 Highest Fatality Rate Countries')</span><span id="ebc7" class="lx km hi lt b fi mc lz l ma mb">plt.xticks(rotation=45)</span><span id="6ba5" class="lx km hi lt b fi mc lz l ma mb">plt.hlines(y=y, xmin=0, xmax=x, color='indianred', alpha=0.8, linewidth=10)</span><span id="9e50" class="lx km hi lt b fi mc lz l ma mb">plt.plot(x, y, "o", markersize=8, color='#007acc', alpha=0.8)</span><span id="4f5d" class="lx km hi lt b fi mc lz l ma mb">plt.tight_layout()</span></pre><figure class="lo lp lq lr fd mr er es paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="er es mq"><img src="../Images/51f3ee2fff17a91945fcb36a567dbc5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hURr8trG_pBX9Lv_f3JQ_Q.png"/></div></div></figure><h2 id="e51f" class="lx km hi bd kn md me mf kr mg mh mi kv ix mj mk kz jb ml mm ld jf mn mo lh mp bi translated">死亡率</h2><p id="9c1c" class="pw-post-body-paragraph im in hi io b ip lj ir is it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj hb bi translated">死亡率是对特定人群中死亡人数的一种度量，与该人群的规模成比例。我们用死亡病例数除以人口数来计算死亡率。</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="ab0c" class="lx km hi lt b fi ly lz l ma mb">covid_df["mortality_rate"] = round((covid_df['deaths']/covid_df['population'])*100,2)</span><span id="787e" class="lx km hi lt b fi mc lz l ma mb">covid_mortality_top_20 = covid_df.sort_values(by='mortality_rate', ascending=False).head(20)</span></pre><p id="9ea5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">通过可视化，我们可以看到死亡率高的20个国家。</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="504f" class="lx km hi lt b fi ly lz l ma mb">plt.figure(figsize=(17, 7))</span><span id="8255" class="lx km hi lt b fi mc lz l ma mb">y = covid_mortality_top_20['name']</span><span id="a922" class="lx km hi lt b fi mc lz l ma mb">x = covid_mortality_top_20['mortality_rate']</span><span id="7661" class="lx km hi lt b fi mc lz l ma mb">plt.ylabel('Country Name')</span><span id="490a" class="lx km hi lt b fi mc lz l ma mb">plt.xlabel('Mortality Rate')</span><span id="1164" class="lx km hi lt b fi mc lz l ma mb">plt.title('Top 20 Highest MortalityRate Countries')</span><span id="1300" class="lx km hi lt b fi mc lz l ma mb">plt.xticks(rotation=45)</span><span id="f90d" class="lx km hi lt b fi mc lz l ma mb">plt.hlines(y=y, xmin=0, xmax=x, color='darkblue', alpha=0.8, linewidth=10)</span><span id="fe91" class="lx km hi lt b fi mc lz l ma mb">plt.plot(x, y, "o", markersize=8, color='#007acc', alpha=0.8)</span><span id="056b" class="lx km hi lt b fi mc lz l ma mb">plt.tight_layout()</span></pre><figure class="lo lp lq lr fd mr er es paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="er es mx"><img src="../Images/4a87d3553f3bfdf7c8c38d1781accb8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dR_iUZgh-7X6H1DQJk6utg.png"/></div></div></figure><h2 id="a6a1" class="lx km hi bd kn md me mf kr mg mh mi kv ix mj mk kz jb ml mm ld jf mn mo lh mp bi translated">—恢复比率</h2><p id="35a5" class="pw-post-body-paragraph im in hi io b ip lj ir is it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj hb bi translated">我们通过治愈病例数除以确诊病例数来计算治愈率。</p><p id="3845" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">通过可视化，我们可以看到回收率较高的20个国家。</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="8f1d" class="lx km hi lt b fi ly lz l ma mb">covid_df["recovered_rate"] = round((covid_df['recovered']/covid_df['cases'])*100,2)</span><span id="0495" class="lx km hi lt b fi mc lz l ma mb">covid_recovered_top_20 = covid_df.sort_values(by='recovered_rate', ascending=False).head(20)</span><span id="6167" class="lx km hi lt b fi mc lz l ma mb">plt.figure(figsize=(15, 7))</span><span id="ebd5" class="lx km hi lt b fi mc lz l ma mb">y = covid_recovered_top_20['name']</span><span id="621b" class="lx km hi lt b fi mc lz l ma mb">x = covid_recovered_top_20['recovered_rate']</span><span id="3d4a" class="lx km hi lt b fi mc lz l ma mb">plt.ylabel('Country Name')</span><span id="0421" class="lx km hi lt b fi mc lz l ma mb">plt.xlabel('Recovered Rate')</span><span id="37b9" class="lx km hi lt b fi mc lz l ma mb">plt.title('Top 20 Highest Recovered Rate Countries')</span><span id="7b03" class="lx km hi lt b fi mc lz l ma mb">plt.xticks(rotation=45)</span><span id="65b4" class="lx km hi lt b fi mc lz l ma mb">plt.hlines(y=y, xmin=0, xmax=x, color='dodgerblue', alpha=0.8, linewidth=10)</span><span id="1ca4" class="lx km hi lt b fi mc lz l ma mb">plt.plot(x, y, "o", markersize=8, color='#007acc', alpha=0.8)</span><span id="1fd0" class="lx km hi lt b fi mc lz l ma mb">plt.tight_layout()</span><span id="cfe9" class="lx km hi lt b fi mc lz l ma mb">plt.show()</span></pre><figure class="lo lp lq lr fd mr er es paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="er es mq"><img src="../Images/18377083d192b0af0ad2cefeea608b99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3HbJfQ5xfJOPK2QHcAy3rw.png"/></div></div></figure><h1 id="75b7" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">按时间表分列的新冠肺炎数据</h1><p id="9d79" class="pw-post-body-paragraph im in hi io b ip lj ir is it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj hb bi translated">这一节，我们想看看新冠肺炎发展的时间线。从前面的API源开始，我们开始创建API函数</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="be63" class="lx km hi lt b fi ly lz l ma mb">timeline_url = ‘https://covid19-api.org/api/timeline'</span><span id="af30" class="lx km hi lt b fi mc lz l ma mb">covid_timeline_df = pd.io.json.json_normalize(get_json(timeline_url))</span></pre><p id="ee4c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我们想象时间线上的差异</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="f5a9" class="lx km hi lt b fi ly lz l ma mb">plt.clf()</span><span id="ebbe" class="lx km hi lt b fi mc lz l ma mb">fig, ax = plt.subplots(figsize=(15,7))</span><span id="4572" class="lx km hi lt b fi mc lz l ma mb">covid_timeline_df.plot(x='last_update', kind='line', ax=ax, lw=3, color=['salmon', 'slategrey','olivedrab'])</span><span id="3405" class="lx km hi lt b fi mc lz l ma mb">ax.set_title("Dynamic COVID-19 Cases")</span><span id="594c" class="lx km hi lt b fi mc lz l ma mb">ax.set_xlabel('')</span><span id="c07c" class="lx km hi lt b fi mc lz l ma mb">plt.grid()</span><span id="ae76" class="lx km hi lt b fi mc lz l ma mb">plt.tight_layout()</span></pre><figure class="lo lp lq lr fd mr er es paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="er es my"><img src="../Images/2929beb84e07567c865182808f9d6a34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o3kWB4PuPd8ns5u5RracKg.png"/></div></div></figure><h1 id="8fa6" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">结论</h1><p id="29c4" class="pw-post-body-paragraph im in hi io b ip lj ir is it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj hb bi translated">从显示的数据和图表中，我们可以得出结论，世界上的新冠肺炎病例正在增加。因此，我们必须保持健康和清洁，以避免新冠肺炎。呆在家里，注意安全。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="9d47" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您可以通过我的GitHub下载数据和python代码文档:</p><div class="jl jm ez fb jn jo"><a href="https://github.com/dwiknrd/medium-code/tree/master/covid19-eda" rel="noopener  ugc nofollow" target="_blank"><div class="jp ab dw"><div class="jq ab jr cl cj js"><h2 class="bd hj fi z dy jt ea eb ju ed ef hh bi translated">dwiknrd/中等代码</h2><div class="jv l"><h3 class="bd b fi z dy jt ea eb ju ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="jw l"><p class="bd b fp z dy jt ea eb ju ed ef dx translated">github.com</p></div></div><div class="jx l"><div class="mz l jz ka kb jx kc kd jo"/></div></div></a></div></div></div>    
</body>
</html>