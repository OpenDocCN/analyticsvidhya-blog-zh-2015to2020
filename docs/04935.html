<html>
<head>
<title>Telecom Churn Prediction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">电信流失预测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/telecom-churn-prediction-model-aa5c71ef944c?source=collection_archive---------3-----------------------#2020-04-06">https://medium.com/analytics-vidhya/telecom-churn-prediction-model-aa5c71ef944c?source=collection_archive---------3-----------------------#2020-04-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/02496ab9d874ccea4a09adf41d03c4e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XW4SbCQIAD8LPkrS"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片来源:Superoffice.com</figcaption></figure><p id="e2bd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">客户是任何公司或企业最重要的资源。如果这些客户由于高收费、更好的竞争对手报价、糟糕的客户服务或其他未知原因而离开公司，该怎么办？因此，<strong class="iw hj">客户流失率</strong>是公司评价其业绩的重要指标之一。</p><p id="1131" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">客户流失率是了解离职客户的一个KPI。流失率代表公司在间隔开始时失去的客户占所有客户的百分比。</p><p id="f8f6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">例如，如果公司在月初有400个客户，而在月底只有360个，这意味着公司的流失率是10%，因为公司失去了10%的客户群。公司总是试图将流失率降至接近0%。</p><h1 id="042c" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">目录</h1><h2 id="8eaa" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated">1)简介</h2><ul class=""><li id="7748" class="le lf hi iw b ix lg jb lh jf li jj lj jn lk jr ll lm ln lo bi translated">数据集、特征和目标值</li><li id="80dd" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">问题描述</li></ul><h2 id="b914" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated">2)描述性分析和EDA(探索性数据分析)</h2><ul class=""><li id="24de" class="le lf hi iw b ix lg jb lh jf li jj lj jn lk jr ll lm ln lo bi translated">特征之间的流失率和相关性</li><li id="c2ba" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">流失客户与现有客户的概况</li><li id="ddbd" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">任期和每月费用分配</li></ul><h2 id="bfc9" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated">3)聚类分析</h2><ul class=""><li id="b89f" class="le lf hi iw b ix lg jb lh jf li jj lj jn lk jr ll lm ln lo bi translated">流失聚类检测</li><li id="d8e6" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">流失客户聚类分析——按人口统计、账户类型和服务使用情况</li></ul><h2 id="ffd3" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated">4)客户流失预测模型</h2><ul class=""><li id="5264" class="le lf hi iw b ix lg jb lh jf li jj lj jn lk jr ll lm ln lo bi translated">预测模型过程</li><li id="1d4b" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">模型评估</li></ul><h2 id="7972" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated">5)保留计划</h2><h1 id="054f" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">源代码—笔记本</h1><p id="8fa4" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf lu jh ji jj lv jl jm jn lw jp jq jr hb bi translated">链接— <a class="ae lx" href="https://github.com/ShivaliPatel/Data-science-projects/blob/master/Telco_customer_churn/Notebooks/Telecom%20Churn%20Prediction-v2.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a></p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h1 id="272f" class="js jt hi bd ju jv mf jx jy jz mg kb kc kd mh kf kg kh mi kj kk kl mj kn ko kp bi translated">1.介绍</h1><h2 id="1c71" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated">数据集、特征和目标值</h2><p id="b9e5" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf lu jh ji jj lv jl jm jn lw jp jq jr hb bi translated">来源:https://www.kaggle.com/blastchar/telco-customer-churn<a class="ae lx" href="https://www.kaggle.com/blastchar/telco-customer-churn" rel="noopener ugc nofollow" target="_blank"/>(IBM样本数据集)</p><p id="a0b3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这里，IBM为电信行业提供了客户数据，以根据人口统计、使用和基于帐户的信息来预测客户流失。这里的主要目标是分析流失客户的行为，并制定增加客户保留率的策略。</p><p id="c436" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">假设—这里，数据源没有提供任何与时间相关的信息；所以我假设所有的记录都是特定月份的。</p><p id="4e0d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">数据集包含以下相关信息:</p><p id="922a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">人口统计:</strong></p><ul class=""><li id="d4d3" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated">性别—男性/女性</li><li id="3809" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">年龄范围——根据伴侣、受抚养人和老年人</li></ul><p id="698f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">服务:</strong></p><ul class=""><li id="82e9" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated">电话服务—如果客户有电话服务，则是与电话相关的服务，如多线电话服务</li><li id="dcde" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">互联网服务-如果客户有互联网服务，则提供与互联网相关的服务，如在线安全、在线备份、设备保护、技术支持、流媒体电视、流媒体电影</li></ul><p id="8912" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">账户类型:</strong></p><ul class=""><li id="fd82" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated">任期——客户在公司工作多长时间？</li><li id="c24e" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">合同类型——他们与公司有什么样的合同？就像每月的基础上，持续的基础上，如果持续的基础上，那么一个月的合同或两年的合同</li><li id="8c87" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">无纸化账单—客户是否拥有无纸化十亿选项？</li><li id="34f7" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">付款方式—客户有哪种付款方式？邮寄支票、电子支票、信用卡(自动)、银行转账(自动)</li></ul><p id="d99d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">用法:</strong></p><ul class=""><li id="55e5" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated">每月费用</li><li id="b1dd" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">总费用</li></ul><p id="9c2d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">目标:</strong></p><ul class=""><li id="da4c" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated">客户流失——客户是离开了公司还是仍然留在公司？</li></ul><h1 id="dc85" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">问题描述</h1><h2 id="b923" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated">顾客为什么离开公司？</h2><p id="d681" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf lu jh ji jj lv jl jm jn lw jp jq jr hb bi translated">客户离开公司的原因可能是</p><ul class=""><li id="1f7e" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated">高收费</li><li id="c52d" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">竞争对手的更好报价</li><li id="db32" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">糟糕的客户服务</li><li id="4300" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">一些未知的原因</li></ul><h2 id="aa7a" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated">如何检测流失客户？</h2><ul class=""><li id="90cd" class="le lf hi iw b ix lg jb lh jf li jj lj jn lk jr ll lm ln lo bi translated">监控使用情况</li><li id="0a0c" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">分析投诉</li><li id="232d" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">分析竞争对手的报价</li></ul><h2 id="ac29" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated">如何防止客户离开一家公司？</h2><p id="b0f9" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf lu jh ji jj lv jl jm jn lw jp jq jr hb bi translated">一旦你发现高风险客户，申请</p><ul class=""><li id="872d" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated">保留计划</li><li id="22f3" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">改善客户服务</li></ul></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h1 id="a739" class="js jt hi bd ju jv mf jx jy jz mg kb kc kd mh kf kg kh mi kj kk kl mj kn ko kp bi translated">2.描述性分析和EDA(探索性数据分析)</h1><h2 id="1a3d" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated">计算流失率</h2><blockquote class="mn"><p id="6839" class="mo mp hi bd mq mr ms mt mu mv mw jr dx translated">流失率=客户流失率/客户总数</p></blockquote><pre class="mx my mz na nb nc nd ne nf aw ng bi"><span id="6035" class="kq jt hi nd b fi nh ni l nj nk">Churn_rate = df_cal['Churn'].value_counts() / df_cal.shape[0]<br/>Generate_bar_graph(Churn_rate.index.map({0:'Existing',1:"Churn"})<br/>                   , Churn_rate.values<br/>                   , 'Customers'<br/>                   , 'Percentage'<br/>                   , 'Customer Distribution')</span><span id="5e2c" class="kq jt hi nd b fi nl ni l nj nk">print(Churn_rate)</span></pre><figure class="nn no np nq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nm"><img src="../Images/86b07a61eae8db15187d350088ca93c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sxBeVjvaKFjmUgie.png"/></div></div></figure><p id="766d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">分析显示，<strong class="iw hj"> <em class="nr">电信公司的流失率在26%左右。</em> </strong></p><h2 id="f4aa" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated">特征之间的相关性</h2><pre class="nn no np nq fd nc nd ne nf aw ng bi"><span id="b9cd" class="kq jt hi nd b fi nh ni l nj nk"><strong class="nd hj">def</strong> Generate_heatmap_graph(corr, chart_title, mask_uppertri=<strong class="nd hj">False</strong> ):<br/>    <em class="nr">""" Based on features , generate correlation matrix """</em><br/>    mask = np.zeros_like(corr)<br/>    mask[np.triu_indices_from(mask)] = mask_uppertri</span><span id="6e64" class="kq jt hi nd b fi nl ni l nj nk">    fig,ax = plt.subplots(figsize=(12,12))<br/>    sns.heatmap(corr<br/>                , mask = mask<br/>                , square = <strong class="nd hj">True</strong><br/>                , annot = <strong class="nd hj">True</strong><br/>                , annot_kws={'size': 10.5, 'weight' : 'bold'}<br/>                , cmap=plt.get_cmap("YlOrBr")<br/>                , linewidths=.1)<br/>    plt.title(chart_title, fontsize=14)<br/>    plt.show()</span><span id="e351" class="kq jt hi nd b fi nl ni l nj nk">var_corr = round(df_cal.corr(),2)<br/>Generate_heatmap_graph(var_corr<br/>                       ,chart_title = 'Correlation Heatmap'<br/>                       ,mask_uppertri = <strong class="nd hj">True</strong>)</span></pre><figure class="nn no np nq fd ij er es paragraph-image"><div class="er es ns"><img src="../Images/8e10b376d2746ae38c8a16f89fc38e61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/0*-jy0siMoa03PJGLH.png"/></div></figure><p id="8d22" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">从关联矩阵来看，租期、月费和总费用等功能与多电话线服务和互联网服务(如在线安全、在线备份、设备保护、技术支持、流媒体电视和流媒体电影服务)高度相关。</p><h2 id="28d6" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated">按目标分类和二元变量的分布(流失与非流失)</h2><pre class="nn no np nq fd nc nd ne nf aw ng bi"><span id="e28c" class="kq jt hi nd b fi nh ni l nj nk"><strong class="nd hj">def</strong> Create_data_label(ax):<br/>    <em class="nr">""" Display data label for given axis """</em><br/>    <strong class="nd hj">for</strong> bar <strong class="nd hj">in</strong> ax.patches:<br/>            ax.text(bar.get_x() + bar.get_width()/ 2<br/>                    , bar.get_height() + 0.01<br/>                    , str(round(100 * bar.get_height(),2)) + '%'<br/>                    , ha = 'center'<br/>                    , fontsize = 13)<br/>            <br/>            <br/><strong class="nd hj">def</strong> Categorical_var_churn_dist(data, cols, distribution_col):<br/>    <em class="nr">""" Distribution of categorical variable based on target variable """</em><br/>    <br/>    <strong class="nd hj">for</strong> i,feature <strong class="nd hj">in</strong> enumerate(cols):<br/>        <br/>        feature_summary = data[feature].value_counts(normalize=<strong class="nd hj">True</strong>).reset_index(name='Percentage')<br/>        <br/>        plt_cat = sns.catplot(x=feature<br/>                , y='Percentage'<br/>                , data = feature_summary<br/>                , col=distribution_col<br/>                , kind='bar'<br/>                , aspect = 0.8<br/>                , palette = plotColor<br/>                , alpha = 0.6)<br/>        <br/>        <strong class="nd hj">if</strong> feature == 'PaymentMethod':<br/>            plt_cat.set_xticklabels(rotation= 65, horizontalalignment = 'right')<br/>        <br/>        <br/>        <strong class="nd hj">for</strong> ax1, ax2 <strong class="nd hj">in</strong> plt_cat.axes:<br/>            Create_data_label(ax1)<br/>            Create_data_label(ax2)<br/>        <br/>        <br/>        plt.ylim(top=1)<br/>        plt.subplots_adjust(top = 0.9)<br/>        plt.gcf().suptitle(feature+" distribution",fontsize=14)<br/>    plt.show()</span><span id="5e03" class="kq jt hi nd b fi nl ni l nj nk">churn_summary = df_cal.groupby('Churn')<br/>Categorical_var_churn_dist(churn_summary, cat_cols,'Churn')<br/></span></pre><figure class="nn no np nq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nt"><img src="../Images/2d0cf60619fb2f79e108af76e168a37b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uSzUneOuM9tCY4XqM9N28g.png"/></div></div></figure><figure class="nn no np nq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nu"><img src="../Images/9b9f89c8678b2b24febbb88f8389fda8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S6cOnriCms-svUr1Vwgl1g.png"/></div></div></figure><h2 id="5d4e" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated">基于上述分析的流失客户与现有客户的概况</h2><p id="22bd" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf lu jh ji jj lv jl jm jn lw jp jq jr hb bi translated">流失客户很可能</p><ul class=""><li id="cdb6" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated"><em class="nr">没有伴侣和家眷；意思是可能单身。</em></li><li id="3db3" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated"><em class="nr">有互联网服务，特别是光纤</em></li><li id="ba72" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated"><em class="nr">没有在线安全服务、在线备份服务、设备保护服务、技术支持服务</em></li><li id="6ebb" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated"><em class="nr">拥有流媒体电视和流媒体电影服务</em></li><li id="a430" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated"><em class="nr">根据月度计划</em></li><li id="5f99" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated"><em class="nr">拥有无纸化计费服务</em></li><li id="73df" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated"><em class="nr">有电子支票支付方式</em></li></ul><h2 id="660a" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated">租期、月费和总费用的分配</h2><pre class="nn no np nq fd nc nd ne nf aw ng bi"><span id="8cde" class="kq jt hi nd b fi nh ni l nj nk"><em class="nr"># Mean summary of customers (Churn vs Non churn)</em><br/>print(churn_summary['Tenure','MonthlyCharges','TotalCharges'].mean())</span><span id="1c7c" class="kq jt hi nd b fi nl ni l nj nk">Tenure  MonthlyCharges  TotalCharges<br/>Churn                                         <br/>0      37.569965       61.265124   2549.911442<br/>1      17.979133       74.441332   1531.796094</span></pre><p id="552f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">结果显示，与现有客户相比，流失客户的月费用<strong class="iw hj"> <em class="nr">要多</em> </strong>。此外，流失客户与现有客户的<strong class="iw hj">任期</strong>和<strong class="iw hj">总费用</strong>也存在巨大差异。</p><p id="e6b9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们用目标变量来检查每个特性的分布。</p><pre class="nn no np nq fd nc nd ne nf aw ng bi"><span id="960e" class="kq jt hi nd b fi nh ni l nj nk"><strong class="nd hj">def</strong> Numerical_distribution(df_cal,feature):<br/>    <em class="nr">""" Distribution of numerical variable based on target variable"""</em><br/>    fig = plt.figure(figsize=(15,10))<br/>    <br/>    plt.subplot(2,1,1)<br/>    ax = sns.kdeplot(df_cal[feature]<br/>                     , color = 'g'<br/>                     , shade = <strong class="nd hj">True</strong>)<br/>    <br/>    title_str = "Original " +feature + " Distribution"<br/>    plt.title(title_str)<br/>    <br/>    plt.subplot(2,1,2)<br/>    ax = sns.kdeplot(df_cal.loc[(df_cal['Churn']==1),feature]<br/>                     , color = 'g'<br/>                     , shade = <strong class="nd hj">True</strong><br/>                     , label='Chrun')</span><span id="2752" class="kq jt hi nd b fi nl ni l nj nk">    ax = sns.kdeplot(df_cal.loc[(df_cal['Churn']==0) ,feature]<br/>                     , color = 'b'<br/>                     , shade = <strong class="nd hj">True</strong><br/>                     , label='No chrun')<br/>    <br/>    title_str = feature + " Distribution: Churn vs No churn"<br/>    plt.title(title_str)<br/>    plt.show()</span></pre><p id="87e0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">任期与流失分布</strong></p><pre class="nn no np nq fd nc nd ne nf aw ng bi"><span id="b6d1" class="kq jt hi nd b fi nh ni l nj nk">Numerical_distribution(df_cal,'Tenure')</span></pre><figure class="nn no np nq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nv"><img src="../Images/f27dd58db309039ae551298e1de464c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gW7i9VMKE2rrc9SC.png"/></div></div></figure><p id="37b4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">月度费用与流失分布</strong></p><pre class="nn no np nq fd nc nd ne nf aw ng bi"><span id="0ec8" class="kq jt hi nd b fi nh ni l nj nk">Numerical_distribution(df_cal,'MonthlyCharges')</span></pre><figure class="nn no np nq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nw"><img src="../Images/e44194b517a14cd0406b052a93c8c648.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KsMRmIGwU7f-oq0U.png"/></div></div></figure><p id="9cf3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">从分布来看，流失用户是</p><ul class=""><li id="b27d" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated"><em class="nr">任期不到一年的人更容易离开公司</em></li><li id="b6ac" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated"><em class="nr">更有可能每月收费超过65美元</em></li></ul></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h1 id="991d" class="js jt hi bd ju jv mf jx jy jz mg kb kc kd mh kf kg kh mi kj kk kl mj kn ko kp bi translated">3.聚类分析</h1><p id="e04c" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf lu jh ji jj lv jl jm jn lw jp jq jr hb bi translated">让我们看看任期和月费之间是否有任何关系。</p><pre class="nn no np nq fd nc nd ne nf aw ng bi"><span id="f665" class="kq jt hi nd b fi nh ni l nj nk">sns.lmplot(x='Tenure'<br/>           ,y='MonthlyCharges'<br/>           ,data=df_cal<br/>           ,hue='Churn'<br/>            ,fit_reg=<strong class="nd hj">False</strong><br/>            ,markers=["o", "x"]<br/>            ,palette= plotColor)<br/>plt.show()</span></pre><figure class="nn no np nq fd ij er es paragraph-image"><div class="er es nx"><img src="../Images/b590334fecfd4be5e08f02742d2efcc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*6J9ht_5o_wz5MIfZYpwwoA.png"/></div></figure><p id="2c3c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">从分析来看，有一些基于任期和月收费的集群。</p><p id="0f98" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们应用K-means聚类算法来查看聚类。在将数据传递给K-means算法之前，需要标准化任期和月费。</p><pre class="nn no np nq fd nc nd ne nf aw ng bi"><span id="7db1" class="kq jt hi nd b fi nh ni l nj nk"><strong class="nd hj">def</strong> Normalize_feature(feature):<br/>    <em class="nr">""" Return normalized features """</em><br/>    <strong class="nd hj">return</strong> prepro.StandardScaler().fit_transform(feature)</span><span id="78c5" class="kq jt hi nd b fi nl ni l nj nk"><em class="nr"># normalized tenure and monthlycharges</em></span><span id="bf33" class="kq jt hi nd b fi nl ni l nj nk">df_cal['Tenure_norm'] = Normalize_feature(df_cal[['Tenure']])<br/>df_cal['MonthlyCharges_norm'] = Normalize_feature(df_cal[['MonthlyCharges']])</span><span id="871f" class="kq jt hi nd b fi nl ni l nj nk"><strong class="nd hj">def</strong> Create_elbow_curve(data):<br/>    <em class="nr">""" Display elbow curve for K-means algo for given data """</em><br/>    df_kmeans_data = data</span><span id="c844" class="kq jt hi nd b fi nl ni l nj nk">    k = range(1,10)<br/>    kmeans = [KMeans(n_clusters=i) <strong class="nd hj">for</strong> i <strong class="nd hj">in</strong> k]</span><span id="9d66" class="kq jt hi nd b fi nl ni l nj nk">    score = [kmeans[i].fit(df_kmeans_data).score(df_kmeans_data)  <strong class="nd hj">for</strong> i <strong class="nd hj">in</strong> range(len(kmeans))]</span><span id="4b77" class="kq jt hi nd b fi nl ni l nj nk">    plt.figure(figsize=(10,6))<br/>    plt.plot(k,score)<br/>    plt.xlabel("Clusters")<br/>    plt.ylabel("Score")<br/>    plt.title("Elbow curve",fontsize=15)<br/>    plt.show()</span><span id="c360" class="kq jt hi nd b fi nl ni l nj nk"><em class="nr"># checking number of clusters</em><br/><br/>Create_elbow_curve(df_cal[df_cal.Churn==1][['Tenure_norm','MonthlyCharges_norm']])</span></pre><figure class="nn no np nq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ny"><img src="../Images/b2180347e90ac97db0bd1e1968d8127e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B6FPcewRS5qlNm1aBm7k0g.png"/></div></div></figure><p id="57c3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">从肘部曲线来看，3似乎最有效。</p><pre class="nn no np nq fd nc nd ne nf aw ng bi"><span id="6cd9" class="kq jt hi nd b fi nh ni l nj nk"><strong class="nd hj">def</strong> Create_kmeans_cluster_graph(df_cal, data, n_clusters, x_title, y_title, chart_title):<br/>    <em class="nr">""" Display K-means cluster based on data """</em><br/>    <br/>    kmeans = KMeans(n_clusters=n_clusters <em class="nr"># No of cluster in data</em><br/>                    , random_state = random_state <em class="nr"># Selecting same training data</em><br/>                   ) <br/><br/>    kmeans.fit(data)<br/>    kmean_colors = [plotColor[c] <strong class="nd hj">for</strong> c <strong class="nd hj">in</strong> kmeans.labels_]<br/><br/><br/>    fig = plt.figure(figsize=(12,8))<br/>    plt.scatter(x= x_title + '_norm'<br/>                , y= y_title + '_norm'<br/>                , data=data <br/>                , color=kmean_colors <em class="nr"># color of data points</em><br/>                , alpha=0.25 <em class="nr"># transparancy of data points</em><br/>               )<br/><br/>    plt.xlabel(x_title)<br/>    plt.ylabel(y_title)<br/><br/>    plt.scatter(x=kmeans.cluster_centers_[:,0]<br/>                , y=kmeans.cluster_centers_[:,1]<br/>                , color='black'<br/>                , marker='X' <em class="nr"># Marker sign for data points</em><br/>                , s=100 <em class="nr"># marker size</em><br/>               )<br/>    <br/>    plt.title(chart_title,fontsize=15)<br/>    plt.show()<br/>    <br/>    <strong class="nd hj">return</strong> kmeans.fit_predict(df_cal[df_cal.Churn==1][[x_title+'_norm', y_title +'_norm']])</span><span id="0b63" class="kq jt hi nd b fi nl ni l nj nk"><br/>df_cal['Cluster'] = -1 <em class="nr"># by default set Cluster to -1</em><br/>df_cal.loc[(df_cal.Churn==1),'Cluster'] = Create_kmeans_cluster_graph(df_cal<br/>                            ,df_cal[df_cal.Churn==1][['Tenure_norm','MonthlyCharges_norm']]<br/>                            ,3<br/>                           ,'Tenure'<br/>                           ,'MonthlyCharges'<br/>                           ,"Tenure vs Monthlycharges : Churn customer cluster")<br/><br/>df_cal['Cluster'].unique()</span></pre><figure class="nn no np nq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e370454af5b63fc96873626ea1da4939.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AQD-bPeenZdVMcZj.png"/></div></div></figure><p id="392e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">根据月费和租期，有三种类型的集群。</p><ul class=""><li id="5a1e" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated">低租期和低月费(蓝色)</li><li id="c491" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">低租期和高月费(绿色)</li><li id="a218" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">高任期和高月费(红色)</li></ul><pre class="nn no np nq fd nc nd ne nf aw ng bi"><span id="5263" class="kq jt hi nd b fi nh ni l nj nk"><em class="nr"># Distribution of clusters</em><br/>churn_distribution =  df_cal[df_cal['Churn']==1].Cluster.value_counts(normalize=<strong class="nd hj">True</strong>).sort_index()</span><span id="d605" class="kq jt hi nd b fi nl ni l nj nk">Generate_bar_graph( x= churn_distribution.index<br/>                   , y = churn_distribution.values<br/>                   , x_title = 'Clusters'<br/>                   , y_title = 'Percentage'<br/>                   , chart_title = 'Cluster distribution'<br/>                  , color = plotColor)</span></pre><figure class="nn no np nq fd ij er es paragraph-image"><div class="er es nz"><img src="../Images/ee514e0cea123f9d2466e319a8ca3083.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*XEPRJMMdU0C_fAErxzkwCA.png"/></div></figure><p id="f127" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">大约50%的流失客户属于低租期和高月费客户。</p><p id="f797" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">当我深入到每一组时，我发现了一些有趣的发现。</p><p id="2af6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">基于<strong class="iw hj">人口统计信息</strong>，</p><figure class="nn no np nq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es et"><img src="../Images/c516b16f5589bdb3aaf58f8f433ab0f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OrwCjjJ-kRcA0bzW.png"/></div></div></figure><p id="41ef" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">低租期和低月费的客户</p><ul class=""><li id="ecec" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated"><em class="nr">男，家眷</em></li></ul><p id="fdb7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">租期短、月费高的客户</p><ul class=""><li id="5505" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated"><em class="nr">老年公民，女性</em></li></ul><p id="47bb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">高租期和高月费的客户</p><ul class=""><li id="2cc4" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated"><em class="nr">男性、伴侣、家属和老人</em></li></ul><p id="0a42" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">基于<strong class="iw hj">账户信息</strong>，</p><figure class="nn no np nq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nu"><img src="../Images/77f10f53f06df166fde3437503d15ff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xn2gTnVkn2zO6WfE.png"/></div></div></figure><p id="eb8b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">低租期和低月费的客户</p><ul class=""><li id="b570" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated"><em class="nr">逐月合同计划</em></li></ul><p id="fbfe" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">租期短、月费高的客户</p><ul class=""><li id="2659" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated"><em class="nr">无纸化计费，逐月合同计划</em></li></ul><p id="d018" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">高租期和高月费的客户</p><ul class=""><li id="d13a" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated"><em class="nr">无纸化计费，一年/两年合同类型</em></li></ul><p id="8b79" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">基于<strong class="iw hj">使用信息</strong>，</p><figure class="nn no np nq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es oa"><img src="../Images/0a822601f9b4bda64dffd429150630b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*L5kiHFxMEJRPPWm8.png"/></div></div></figure><p id="304a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">低租期和低月费的客户</p><ul class=""><li id="3258" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated"><em class="nr">有DSL互联网服务</em></li></ul><p id="3b92" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">租期短、月费高的客户</p><ul class=""><li id="e6d4" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated"><em class="nr">拥有流媒体电视/流媒体电影、光纤互联网服务</em></li></ul><p id="3ba9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">高租期和高月费的客户</p><ul class=""><li id="38dc" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated"><em class="nr">在线服务，如在线备份、设备保护和技术支持、光纤互联网服务、流媒体电视/流媒体电影</em></li></ul></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h1 id="d3f7" class="js jt hi bd ju jv mf jx jy jz mg kb kc kd mh kf kg kh mi kj kk kl mj kn ko kp bi translated">4.流失客户预测模型</h1><h2 id="25a2" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated"><strong class="ak">数据预处理</strong></h2><ul class=""><li id="bfc3" class="le lf hi iw b ix lg jb lh jf li jj lj jn lk jr ll lm ln lo bi translated">将数据集分为两组—培训和测试</li></ul><pre class="nn no np nq fd nc nd ne nf aw ng bi"><span id="e4a9" class="kq jt hi nd b fi nh ni l nj nk"><strong class="nd hj">def</strong> Train_test_df(feature, target, test_size):<br/>    <em class="nr">""" Spliting data to train and test"""</em><br/>    <strong class="nd hj">return</strong> train_test_split(feature<br/>                     ,target<br/>                     ,test_size= test_size<br/>                     ,random_state= random_state)</span><span id="d94f" class="kq jt hi nd b fi nl ni l nj nk">x_train, x_test, y_train, y_test = Train_test_df(df_model_feature<br/>                                                 , df_model_target<br/>                                                 , test_size = 0.2)</span><span id="8c8e" class="kq jt hi nd b fi nl ni l nj nk">----------------------------<br/>Original features shape,  (7043, 28)<br/>Original target shape,  (7043,)<br/>x train shape,  (5634, 28)<br/>y train shape,  (5634,)<br/>x test shape,  (1409, 28)<br/>y test shape,  (1409,)<br/>----------------------------</span></pre><ul class=""><li id="f340" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated">现有客户和流失客户分布不平等导致的阶层失衡问题</li></ul><pre class="nn no np nq fd nc nd ne nf aw ng bi"><span id="69a6" class="kq jt hi nd b fi nh ni l nj nk"><em class="nr"># Upsampling using SMOTE</em><br/>sm = SMOTE(random_state = random_state<br/>           , ratio = 1.0)<br/>x_train_sm , y_train_sm = sm.fit_sample(x_train,y_train)</span><span id="183b" class="kq jt hi nd b fi nl ni l nj nk">print("----------------------------")<br/>print("Original x train shape, ", x_train.shape)<br/>print("Resample x train shape, ", x_train_sm.shape)<br/>print("----------------------------")</span></pre><h2 id="f9bd" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated"><strong class="ak">超参数调谐</strong></h2><ul class=""><li id="ab0f" class="le lf hi iw b ix lg jb lh jf li jj lj jn lk jr ll lm ln lo bi translated">使用GridSearchCV()方法，为相应的模型找出最佳参数</li></ul><pre class="nn no np nq fd nc nd ne nf aw ng bi"><span id="6365" class="kq jt hi nd b fi nh ni l nj nk"><strong class="nd hj">def</strong> Parameter_tunning(x, y, models, clsModelsNm, parameters, score):<br/>    <br/>    tuned_params = {}<br/>    <strong class="nd hj">for</strong> i,model <strong class="nd hj">in</strong> enumerate(models):<br/>        print(clsModelsNm[i])<br/>        grid = GridSearchCV(estimator = model <br/>                            , cv = 5<br/>                            , param_grid = parameters[clsModelsNm[i]]<br/>                            , scoring = score<br/>                            , n_jobs = 3)<br/>        grid.fit(x,y)<br/>        print(grid.best_score_)<br/>        print(grid.best_params_)<br/>        tuned_params[clsModelsNm[i]] = {'params':grid.best_params_}<br/>    <br/>    <strong class="nd hj">return</strong> tuned_params</span></pre><h2 id="19fc" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated"><strong class="ak">型号对比</strong></h2><ul class=""><li id="a5a0" class="le lf hi iw b ix lg jb lh jf li jj lj jn lk jr ll lm ln lo bi translated">使用corss_val_score()方法比较逻辑回归、随机森林和梯度增强等模型</li><li id="2429" class="le lf hi iw b ix lp jb lq jf lr jj ls jn lt jr ll lm ln lo bi translated">测量准确度、精确度、召回率和F1指标等分数</li></ul><pre class="nn no np nq fd nc nd ne nf aw ng bi"><span id="063a" class="kq jt hi nd b fi nh ni l nj nk"><em class="nr"># Graph of precision &amp; recall against threshold</em><br/><strong class="nd hj">def</strong> plot_precision_recall_vs_thresold(precisions, recalls, thresholds):<br/>    plt.plot(thresholds,precisions[:-1],label="Precision")<br/>    plt.plot(thresholds,recalls[:-1],label="Recall")<br/>    plt.plot(thresholds,2 * (precisions[:-1] * recalls[:-1]) / (precisions[:-1]+recalls[:-1]) ,label="F1")<br/>    plt.title("Precision, recall &amp; F1 vs thresold")<br/>    plt.xlabel("Thresold")<br/>    plt.legend(loc='lower right')<br/>    plt.show()</span><span id="6d27" class="kq jt hi nd b fi nl ni l nj nk"><strong class="nd hj">def</strong> Cross_validation_score(clsModels, clsModelsNm, clsSample, scoreMatrix):<br/>    <em class="nr">""" Cross validation using cross_val_score method """</em><br/>    <strong class="nd hj">for</strong> i,model <strong class="nd hj">in</strong> enumerate(clsModels):<br/>        print("===============================================")<br/>        print(clsModelsNm[i])<br/><br/>        <strong class="nd hj">for</strong> j, sample <strong class="nd hj">in</strong> enumerate(clsSample):<br/>            print("************************************************")<br/>            print(sample[2])<br/>            <br/>            <strong class="nd hj">for</strong> score <strong class="nd hj">in</strong> scoreMatrix:<br/>                scores = cross_val_score(model, sample[0], sample[1], cv=5 , scoring = score)<br/>                print(score, " score:", scores.mean())<br/>                <br/>            y_scores = cross_val_predict(model, sample[0], sample[1], cv=5, method="predict_proba") <br/>            <br/>            <br/>            precisions, recalls, thresholds = metrics.precision_recall_curve(sample[1], y_scores[:][:,1]) <br/>            plot_precision_recall_vs_thresold(precisions, recalls, thresholds)<br/>            score_matrix = pd.DataFrame({'Precisions': precisions[:-1]<br/>                                ,'Recalls': recalls[:-1]<br/>                                ,'F1': 2 * (precisions[:-1] * recalls[:-1]) / (precisions[:-1]+recalls[:-1])<br/>                                ,'Threshold': thresholds<br/>                               })<br/>            <em class="nr">#print("When percision and recall are same \n" , score_matrix[ score_matrix['Precisions'] == score_matrix['Recalls']] )</em><br/>            print("When F1 score is max <strong class="nd hj">\n</strong>" , score_matrix[ score_matrix['F1'] == max(score_matrix['F1'])] )</span></pre><h2 id="2436" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated"><strong class="ak">模型评估</strong></h2><ul class=""><li id="5a28" class="le lf hi iw b ix lg jb lh jf li jj lj jn lk jr ll lm ln lo bi translated">使用分类报告和日志损失分数，为我们的数据计算最佳模型</li></ul><pre class="nn no np nq fd nc nd ne nf aw ng bi"><span id="3099" class="kq jt hi nd b fi nh ni l nj nk"><strong class="nd hj">def</strong> Cus_log_loss(target, predicted):<br/>    <strong class="nd hj">if</strong> len(predicted) != len(target):<br/>        print("Data object initiated")<br/>        <strong class="nd hj">return</strong><br/>    <br/>    target = [float(x) <strong class="nd hj">for</strong> x <strong class="nd hj">in</strong> target] <em class="nr"># converting target into float</em><br/>    predicted = [min([max([x,1e-15]), 1-1e-15]) <strong class="nd hj">for</strong> x <strong class="nd hj">in</strong> predicted]<br/>        <br/>    <strong class="nd hj">return</strong> -1.0 / len(target) *  sum([ target[i] * math.log(predicted[i]) + (1.0 - target[i]) * math.log(1.0 - predicted[i]) <br/>                                      <strong class="nd hj">for</strong> i <strong class="nd hj">in</strong> range(len(predicted))])</span><span id="1e05" class="kq jt hi nd b fi nl ni l nj nk"><strong class="nd hj">def</strong> Model_evaluation(models, clsModelsNm, x_train, y_train, x_test, y_test,  threshold ):<br/>    <br/>    predicted_val = {}<br/>    <strong class="nd hj">for</strong> i, model <strong class="nd hj">in</strong> enumerate(clsModelsNm):<br/>        models[i].fit(x_train,y_train)<br/>        predicted_proba = models[i].predict_proba(x_test)<br/>        <br/>        predicted = predicted_proba[:,1].copy()<br/>        predicted[predicted &gt;=threshold[i]] = 1<br/>        predicted[predicted &lt; threshold[i]] = 0<br/>        <br/>        confusion_matrix_matrix = metrics.confusion_matrix(y_true = y_test<br/>                                                   ,y_pred = predicted<br/>                                                   <em class="nr">#,normalize = 'true' </em><br/>                                                   )<br/>        <br/>        print("***********",clsModelsNm[i], "*************")<br/>        print(metrics.classification_report(y_test, predicted))<br/>        print("*******************************************")<br/>        <em class="nr">#print("Log loss score", round(metrics.log_loss(y_test,models[i].predict_proba(x_test)[:,1]),2))</em><br/>        print("Log loss score", round(Cus_log_loss(y_test,predicted_proba[:,1]),2))<br/>        print("*******************************************")<br/>        print("Confusion matrix")<br/>        sns.heatmap(confusion_matrix_matrix<br/>                    , annot=<strong class="nd hj">True</strong><br/>                    , fmt="d"<br/>                   )<br/>        plt.xlabel("Predicted label")<br/>        plt.ylabel("Actual label")<br/>        plt.show()<br/>        print("*******************************************")<br/>        <br/>        predicted_val[model] = predicted</span></pre><h2 id="888c" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated"><strong class="ak">模型结论</strong></h2><p id="2493" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf lu jh ji jj lv jl jm jn lw jp jq jr hb bi translated">基于模型比较和评估过程，上采样数据在训练过程中工作得更好，但是对于看不见的数据(基于测井损失分数)则不行。原因之一可能是cross_val_score步骤中的数据泄漏。</p><p id="a929" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然而，原始数据集测井损失分数与训练数据集和测试数据集保持相同。</p><p id="e0e3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">从上面的分析来看，使用原始数据集的梯度提升具有稳定和最好的分数。所以，我用它来预测过程。</p><p id="5996" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">梯度推进模型显示了如下重要特征</p><ul class=""><li id="a6a6" class="le lf hi iw b ix iy jb jc jf mk jj ml jn mm jr ll lm ln lo bi translated">总费用、期限、月费、合同类型、付款方式、互联网服务类型、无纸化计费</li></ul><p id="5635" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">其中大多数，我们已经在EDA过程中分析过了。</p><figure class="nn no np nq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ob"><img src="../Images/59ad870547b307b9b4c70f47222baf81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tzsZEh1D25GlHeNF.png"/></div></div></figure><h1 id="3aa5" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">5.保留计划</h1><p id="10d3" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf lu jh ji jj lv jl jm jn lw jp jq jr hb bi translated">因为我们基于客户流失和现有客户生成了一个模型，这有助于对他们进行分类。现在，我们可以对现有客户使用相同的模型来找出客户流失的可能性。</p><figure class="nn no np nq fd ij er es paragraph-image"><div class="er es oc"><img src="../Images/0692a3561102ca35f5c6fae7515f4ecd.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/0*OVDtSQqHl2BsJRUo.PNG"/></div></figure><pre class="nn no np nq fd nc nd ne nf aw ng bi"><span id="5e27" class="kq jt hi nd b fi nh ni l nj nk">existing_customer_churn_prob = clsGB.predict_proba(existing_cust_feature)</span><span id="a2d5" class="kq jt hi nd b fi nl ni l nj nk"><br/>existing_cust.loc[existing_cust['Churn_proba'] &gt;= 0.8 , 'Risk_type'] = 'Very high'<br/>existing_cust.loc[(existing_cust['Churn_proba'] &gt;= 0.6) &amp; (existing_cust['Churn_proba'] &lt; 0.8)  , 'Risk_type'] = 'High'<br/>existing_cust.loc[(existing_cust['Churn_proba'] &gt;= 0.4) &amp; (existing_cust['Churn_proba'] &lt; 0.6) , 'Risk_type'] = 'Medium'<br/>existing_cust.loc[(existing_cust['Churn_proba'] &gt;= 0.2) &amp; (existing_cust['Churn_proba'] &lt; 0.4) , 'Risk_type'] = 'Low'<br/>existing_cust.loc[(existing_cust['Churn_proba'] &gt; 0.0) &amp; (existing_cust['Churn_proba'] &lt; 0.2) , 'Risk_type'] = 'Very low'</span></pre><h2 id="476c" class="kq jt hi bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated">按风险类型划分的现有客户分布</h2><pre class="nn no np nq fd nc nd ne nf aw ng bi"><span id="7ed3" class="kq jt hi nd b fi nh ni l nj nk">existing_cust['Risk_type'].value_counts().plot(kind = 'barh')<br/>plt.title("Existing customer risk type distribution", fontsize=14)<br/>plt.ylabel("Risk type", fontsize = 13)<br/>plt.xlabel("Customers", fontsize = 13)</span></pre><figure class="nn no np nq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es od"><img src="../Images/a289c20c2f47b2ffd635aa8381cc3c52.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/0*7fN6HA1jaVfuefKo.png"/></div></div></figure><p id="d303" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">一旦我们确定了非常高/高流失率的客户，我们就可以应用适当的保留计划。</p><h1 id="b94d" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">结论</h1><p id="6730" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf lu jh ji jj lv jl jm jn lw jp jq jr hb bi translated">在这个项目中，我试图将客户流失预测问题分为探索、剖析、聚类、模型选择和评估以及保留计划等步骤。基于这种分析，我们可以帮助保留团队在高风险客户离开公司之前分析他们。</p><p id="b237" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">此外，我们可以聚合不同的数据源，如客户查询、销售的季节性、更多的人口统计信息，以使我们的预测更加准确。</p></div></div>    
</body>
</html>