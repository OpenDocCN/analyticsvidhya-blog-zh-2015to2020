<html>
<head>
<title>Step-Wise Approach To Train An Image Classifier CNN With High Accuracy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">高精度训练图像分类器 CNN 的分步方法</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/step-wise-approach-to-increase-accuracy-in-image-classifier-cnn-d5fe7fabbff6?source=collection_archive---------30-----------------------#2020-08-23">https://medium.com/analytics-vidhya/step-wise-approach-to-increase-accuracy-in-image-classifier-cnn-d5fe7fabbff6?source=collection_archive---------30-----------------------#2020-08-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9566" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你那令人费解的神经网络[CNN]测试准确率极差？是不是过度拟合了你的训练数据？你的准确度随着每个时代而波动？如果有，这就是你要找的文章！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/92d1a72098f6dfa8ec61d52ab05f80d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p03W77KJVKiu5LTemNOePA.jpeg"/></div></div></figure><p id="b393" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将为您提供一个通用的过程，它将使您从许多不必要的麻烦中解脱出来，这些麻烦经常出现在训练用于图像分类的复杂的神经网络的过程中。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="b077" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated"><strong class="ak">从小数据集开始</strong></h1><p id="3bb7" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">你可能听说过，你提供的数据越多，模型就越好，我不打算提出相反的建议。然而，如果你从一个庞大的数据集开始，网络将花费大量的时间和资源来训练。</p><p id="bcda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们计划优化网络架构和微调超参数的初始阶段，少量的训练时间就能产生巨大的影响。</p><p id="76ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从数量上来说，一个小的训练数据集包含大约 100-200 个图像。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="fdb6" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">使用基本代码</h1><p id="aab1" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">你可能会被从头开始的想法所诱惑。然而，这有许多缺点:</p><ol class=""><li id="0cce" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated">大量语法错误</li><li id="248b" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">没有性能提升</li><li id="1e0f" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">浪费你宝贵的时间</li></ol><p id="98dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果这不是你第一次开发神经网络，我宁愿建议从你以前的项目中借用源代码，或者从你正在使用的框架的官方网站上借用样本代码，例如<a class="ae ln" href="https://www.tensorflow.org/tutorials/images/classification" rel="noopener ugc nofollow" target="_blank"> TensorFlow </a>、<a class="ae ln" href="https://pytorch.org/tutorials/beginner/blitz/cifar10_tutorial.html" rel="noopener ugc nofollow" target="_blank"> PyTorch </a>等。</p><p id="759d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设您已经完全理解了您的代码是如何工作的，那么您现在可以避免愚蠢的语法错误并专注于改进您的模型。</p><p id="84e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，如果这是你第一次在 CNN 工作，那么从头开始编写程序的痛苦是值得的，你不应该走这条捷径。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="0fc5" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">从简单的架构开始</h1><p id="5378" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">假设您遵循了我的建议，从一个小数据集开始，并且已经有了加载数据的示例代码，接下来的事情就是使用一个简单的架构。</p><p id="81ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从更专业的角度来说，我将一个简单的架构描述为:</p><ol class=""><li id="23d2" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated">几个错综复杂的层(2 或 3)。</li><li id="e57e" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">没有辍学层。</li><li id="44d1" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">L1 和 L2 正则化的缺失。</li><li id="b75a" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">不会很深(1 或 2 个致密层)。</li><li id="e2fe" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">批量大小为 1 或 2</li><li id="2d4b" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">标准“Adam”优化器</li></ol><p id="43cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个简单的架构通常足以对不到 50 个类别进行分类。这也减少了过拟合的机会，降低了计算成本。</p><p id="fe2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里有一个很好的例子:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lo"><img src="../Images/abf4dfdaf19b821cf982320bb0652ee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*VrU3iW7Smm9SqQSQRucs6g.png"/></div><figcaption class="lp lq et er es lr ls bd b be z dx translated">CNN 有 3 个回旋层和 1 个致密层</figcaption></figure><p id="b573" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">亲提示:</strong></p><p id="d956" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你找到一个已经被训练来预测你希望预测的相同/相似类别的分类器模型，我会强烈推荐迁移学习，因为它在时间和准确性方面非常有益。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="8b3c" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">现在我们随机应变</h1><p id="c1a6" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">你试过在你的小数据集上运行我们简单的神经网络吗？最有可能的结果是你的模型过度拟合[在某个时期后，你的测试误差开始增加，但你的训练误差继续减少]。</p><p id="e970" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不要担心这是意料之中的，因为我们从一个小数据集开始！但是，如果您的模型没有过度拟合，您也可以</p><ol class=""><li id="71d7" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated">增加纪元的数量或</li><li id="58eb" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">增加网络的复杂性，直到出现过度拟合。</li></ol><blockquote class="lt lu lv"><p id="452e" class="if ig lw ih b ii ij ik il im in io ip lx ir is it ly iv iw ix lz iz ja jb jc hb bi translated">现在，下一步是将你所有的数据提供给你的神经网络。这将帮助它概括而不是过度拟合训练数据。</p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ma"><img src="../Images/030c59f6240acdf5009153efe3a5e6ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*QgZefXyct88yCVDb.jpg"/></div></figure><p id="ef95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您的模型仍有过度拟合的迹象，请按上述顺序执行以下操作:</p><ol class=""><li id="27f9" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated"><strong class="ih hj">应用数据增强</strong>【一个奇特的术语，用于应用旋转、裁剪、亮度改变等效果。]</li><li id="2185" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated"><strong class="ih hj">使用脱落层</strong>【它们通常非常有效】</li><li id="a506" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated"><strong class="ih hj">使用 L1 或 L2 正则化</strong>【就像在损失函数中加入一个惩罚项】</li><li id="acba" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated"><strong class="ih hj">在测试误差开始增加的时期停止</strong></li></ol><p id="cbe1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据您使用的框架，应用前三种解决方案的确切语法略有不同。在本文中，我将使用 Keras 和 TensorFlow 来实现上述方法。</p><h2 id="0a52" class="mb jx hi bd jy mc md me kc mf mg mh kg iq mi mj kk iu mk ml ko iy mm mn ks mo bi translated">数据扩充</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mp"><img src="../Images/dd039c049e35ed12f7c67d3d911e32dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EZ2mBZTsqHEVBzmrIU7LvA.png"/></div></div></figure><p id="e74f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Keras 已经配备了一个名为“ImageDataGenerator()”的函数，它有几个参数来更改您的输入图像。例如:</p><p id="a5b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a)此处的重新缩放有助于转换 0 到 1 范围内的所有像素。</p><p id="6326" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b) Brightness_range 帮助改变图像的原始亮度。</p><p id="62a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">c)水平翻转有助于沿垂直轴镜像图像。</p><p id="2da8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有很多，但我在这里的目标是给你提供方法和见解，而不是用细节来烦扰你。如果你想探索其他的(我强烈推荐你去)，你可以在这里找到它们。</p><h2 id="c9dc" class="mb jx hi bd jy mc md me kc mf mg mh kg iq mi mj kk iu mk ml ko iy mm mn ks mo bi translated">脱落层</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mq"><img src="../Images/c1a4d78ecff23040f59966c453b8ff76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yGGlNIKWYBw_d8qiioQzxA.png"/></div></div></figure><p id="a819" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是的，就是这样。只需将这段代码添加到您想要设置 dropout 的图层之后，就大功告成了。</p><p id="da16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里的 0.2 指的是在特定时间点将被去激活的神经元的百分比。还有一些很少使用的其他参数。尽管如此，你可以在这里读到它们<a class="ae ln" href="https://keras.io/api/layers/regularization_layers/dropout/" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="0497" class="mb jx hi bd jy mc md me kc mf mg mh kg iq mi mj kk iu mk ml ko iy mm mn ks mo bi translated">L1 和 L2 正规化</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mr"><img src="../Images/cac69a0a6eab831df2a887e40f90e14d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uRcSdHqwzGJMvCE8jU9zCQ.png"/></div></div></figure><p id="a24a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将把 L1 和 L2 正则化的数学描述留给以后的博客。然而，如果你真的很想知道它们，你可以在这里查阅。</p><p id="2edb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关注实施 Keras 再次拯救了我们。你所需要做的就是给你的层增加一个参数，指定 l1 和 l2 的值。</p><h2 id="2dfd" class="mb jx hi bd jy mc md me kc mf mg mh kg iq mi mj kk iu mk ml ko iy mm mn ks mo bi translated"><strong class="ak">提前停止</strong></h2><p id="4fa0" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">这更像是最后一招，应该在上述三种技术都经过测试和应用后实施。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ms"><img src="../Images/8968d51a9ca924c8a9a537814ad5fcc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/0*9d-5qtVlscotGiMT"/></div><figcaption class="lp lq et er es lr ls bd b be z dx translated">图片提供:stats.stackexchange.com</figcaption></figure><p id="fd39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如上图所示，如果我们在测试误差开始增加的时期停止，我们可以防止模型在训练数据上过度拟合。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="5398" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">事情还是不行怎么办！</h1><p id="66c3" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">一般来说，在正确执行了前面讨论的所有步骤之后，神经网络确实表现出可接受的准确度。</p><blockquote class="lt lu lv"><p id="5df2" class="if ig lw ih b ii ij ik il im in io ip lx ir is it ly iv iw ix lz iz ja jb jc hb bi translated">但是有时我们亲爱的朋友——神经网络……拒绝学习【而且很遗憾他们不告诉我们背后的原因！]</p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mt"><img src="../Images/044668c104d14b59fb327e3f93265c3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/0*4fr4AULU4H6ZwVbe"/></div></figure><p id="6b34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，现在我们执行超参数调整:<em class="lw">，这基本上意味着我们试图改变我们能做的一切，看看是否有帮助</em>。</p><p id="891a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，根据你所面临的问题类型，这里列出了你应该做的事情:</p><h2 id="e0e5" class="mb jx hi bd jy mc md me kc mf mg mh kg iq mi mj kk iu mk ml ko iy mm mn ks mo bi translated">如果模型的训练和测试精度较差:</h2><ol class=""><li id="c17e" class="kz la hi ih b ii ku im kv iq mu iu mv iy mw jc le lf lg lh bi translated">增加层数</li><li id="fce4" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">增加密集层中神经元的数量</li><li id="ef54" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">增加卷积层中的滤镜数量</li></ol><h2 id="51b4" class="mb jx hi bd jy mc md me kc mf mg mh kg iq mi mj kk iu mk ml ko iy mm mn ks mo bi translated">如果模型过度拟合数据:</h2><ol class=""><li id="9525" class="kz la hi ih b ii ku im kv iq mu iu mv iy mw jc le lf lg lh bi translated">减少层数</li><li id="d76d" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">减少密集层中的神经元</li><li id="f185" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">添加更多脱落层</li></ol><h2 id="99d3" class="mb jx hi bd jy mc md me kc mf mg mh kg iq mi mj kk iu mk ml ko iy mm mn ks mo bi translated">在上述任何一种情况下，您都可以:</h2><ol class=""><li id="730c" class="kz la hi ih b ii ku im kv iq mu iu mv iy mw jc le lf lg lh bi translated">更改池层的跨度</li><li id="c3d8" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">改变激活功能</li><li id="ec9d" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">更改优化器功能</li></ol><p id="3ba1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我知道，为了让你的神经网络获得完美或接近完美的结果，你需要进行大量的调整，这让你大吃一惊。但是在你沮丧和放弃之前，我为你看到了一丝希望。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mx"><img src="../Images/2d607634186680d8981f6a0096c7f2b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*U309IAXoi1XF35Z-.jpg"/></div></figure><blockquote class="lt lu lv"><p id="6126" class="if ig lw ih b ii ij ik il im in io ip lx ir is it ly iv iw ix lz iz ja jb jc hb bi translated">世界上有许多研究人员尝试了许多网络架构，有时甚至发明了新的架构。他们进行了大量的超参数微调，并取得了惊人的成果。幸运的是，这些模型已经提供给普通大众，也就是你和我！</p></blockquote><p id="bbef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以为了图像分类的目的，可以使用:</p><ol class=""><li id="41a4" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated">AlexNet</li><li id="0599" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">VGG-16</li><li id="3caa" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">VGG-19</li><li id="3c4e" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">谷歌网</li></ol><p id="76e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我按照复杂程度的顺序把它们列出来了。如果你的分类问题在数据和分类类别方面很小，AlexNet 和 VGG-16 可能是你最好的选择！</p><p id="ae72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，如果你要处理大量的数据和分类，VGG-19 和谷歌网可能会帮你减少很多努力！</p><blockquote class="lt lu lv"><p id="2779" class="if ig lw ih b ii ij ik il im in io ip lx ir is it ly iv iw ix lz iz ja jb jc hb bi translated">如果这篇文章以任何方式帮助了你，你可以在下面留下掌声让我知道！</p></blockquote></div></div>    
</body>
</html>