<html>
<head>
<title>Handling Imbalanced Data — Intuition to Implementation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">处理不平衡数据—实施的直觉</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/handling-imbalanced-data-intuition-to-implementation-295ccad749f4?source=collection_archive---------14-----------------------#2020-11-01">https://medium.com/analytics-vidhya/handling-imbalanced-data-intuition-to-implementation-295ccad749f4?source=collection_archive---------14-----------------------#2020-11-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d9607518f00367aa57478359ba879842.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bWKOV2C7o8tWXqT0BAIclA.jpeg"/></div></div></figure><p id="1e8e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你有没有发现自己处于这样一种情况，在训练你的机器学习模型时，你获得了90%以上的准确率，但随后意识到该模型正在用大多数记录预测类中的一切？</p><h2 id="d998" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">在那里你实际上闻到了不平衡数据的味道，现在你知道你的模型是一个完全的浪费！</h2><p id="722d" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">什么是<strong class="is hj">不平衡数据</strong>？</p><p id="9e34" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不平衡意味着不同类别可用的数据点数量不同。例如，假设您有著名的“正常”和“欺诈”信用卡交易数据集，其中“正常”交易的记录数为284315，而“欺诈”交易的记录数仅为492。</p><p id="e077" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当你处理这样的问题时，你可能会处理不平衡的数据，如果在用你首选的机器/深度学习算法拟合之前没有正确平衡，这可能会被证明是有偏见和不准确的，从而导致错误的预测，这可能是灾难性的。</p><p id="e3c8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个博客会给你一个非常清晰的直觉和洞察力，告诉你如何处理不平衡的数据，用最好的方法，并对每一种方法进行比较，让你决定最好的方法来将你的数据改造成平衡的，以运行一个完美的模型！</p><h2 id="88e6" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">在这里，我们将讨论-</h2><ol class=""><li id="fe7f" class="ko kp hi is b it kj ix kk jb kq jf kr jj ks jn kt ku kv kw bi translated">处理不平衡数据的欠采样和过采样技术。</li><li id="2a64" class="ko kp hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">NearMiss、SMOTETomek和RandomOverSampler算法来平衡不平衡的数据。</li><li id="aec7" class="ko kp hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">比较步骤2中使用的算法，并选择具有适当推理的最佳算法。</li></ol><h2 id="c393" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">好吧！所以让我们开始吧！</h2><p id="6fdb" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">我们将使用Kaggle上著名的信用卡数据集来完成我们的任务。你可以从<a class="ae lc" href="https://www.kaggle.com/mlg-ulb/creditcardfraud" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">这里</strong> </a> <strong class="is hj">下载数据集。</strong></p><p id="67bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们先动手做好数据准备工作！查看下面的代码，并在您喜欢的IDE中亲自尝试一下！</p><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="1fd2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您执行此操作时，您将获得自变量(X)和因变量/目标变量(Y)的形状。</p><p id="d707" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可能会得到这样的输出-</p><pre class="ld le lf lg fd lj lk ll lm aw ln bi"><span id="8931" class="jo jp hi lk b fi lo lp l lq lr">(284807, 30)<br/>(284807,)</span></pre><p id="609a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们来做一些探索性的数据分析，搞清楚数据的本质！</p><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="bd3a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">生成的可视化如下所示-</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/6a6754417f4dd8e3702980246aed036c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DS_J-8u5Pmq7C-6LJyCI9w.png"/></div></div></figure><p id="16e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有趣。:)</p><p id="203a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数据非常不平衡，欺诈交易的分布接近0，而正常交易的分布甚至超过250000个边界。所以你看到了不平衡数据类的分布是什么样的！</p><p id="50db" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们统计欺诈和正常交易的数量，以获得数字估计，然后我们将尝试不同的方法来平衡我们的数据。</p><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="ff83" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可能会得到这样的输出-</p><pre class="ld le lf lg fd lj lk ll lm aw ln bi"><span id="545f" class="jo jp hi lk b fi lo lp l lq lr">(492, 31) (284315, 31)</span></pre><p id="6e10" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以我们只有492笔欺诈交易和284315笔正常交易。</p><p id="a956" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们来探索平衡数据的各种技巧！</p><h2 id="7ad4" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">欠采样</h2><p id="4e71" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">这项技术包括从多数类中随机抽取样本，有或没有替换。这是最早用于缓解数据集中不平衡的技术之一。</p><p id="322d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将在这里使用近似缺失欠采样算法，该算法通过基于多数类示例到少数类示例的距离来选择示例来起作用。</p><p id="b4be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">看看这里的代码，自己试试吧！</p><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="8bf1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输出将类似于下图所示:</p><pre class="ld le lf lg fd lj lk ll lm aw ln bi"><span id="364f" class="jo jp hi lk b fi lo lp l lq lr">((984, 30), (984,))</span></pre><p id="de3a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">耶！我们的数据现在平衡了！</p><p id="ee71" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是等等。您是否意识到我们丢失了大量数据，或者说，大量有价值的信息？！！！</p><p id="c63e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">是的。我们做到了。这就是过采样胜过欠采样技术的地方！</p><p id="3334" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们看看过采样是如何工作的</p><h2 id="4a04" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">过采样</h2><p id="bfed" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">过采样包括用一些少数类的多个副本来补充训练数据。过采样可以多次进行(2倍、3倍、5倍、10倍等。)这是最早提出的方法之一，也被证明是健壮的，并且比欠采样好得多，因为在这里数据没有丢失，而是产生了新的数据！</p><p id="fabd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">而且你知道，数据越多，你的模型越健壮！</p><p id="feaf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，让我们看看使用RandomOverSampler算法的过采样的实际实现。</p><p id="3482" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">随机过采样包括从少数类中随机选择样本，并替换，然后将它们添加到训练数据集中。</p><p id="a868" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">再次查看代码，并在您自己的空闲时间尝试一下-</p><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="a029" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输出可能会像下面这样重塑您的数据-</p><pre class="ld le lf lg fd lj lk ll lm aw ln bi"><span id="7b28" class="jo jp hi lk b fi lo lp l lq lr">((426472, 30), (426472,))</span></pre><p id="4227" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您是否注意到了欠采样和过采样的输出差异？！</p><p id="5d20" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们使用过采样，就会产生如此大量的数据！很棒，对吧？</p><p id="7099" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不过还是那句话，凡事有利有弊，对吧？</p><p id="bd12" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">已知随机过采样会增加发生过拟合的可能性，因为它精确复制了少数类示例。</p><p id="5e0d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，你一定在想，</p><p id="d0c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">平衡数据的最佳和首选方法是什么？</p><p id="eb5f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好了，让我们向您介绍混合智能算法<strong class="is hj">smetomek</strong>，它击败了几乎所有修复不平衡数据的方法！</p><p id="5561" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们欢迎圣杯！</p><p id="ef1a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">smetomek</strong></p><p id="595b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">SMOTETomek(这是<strong class="is hj"> imblearn的一个方法。SMOTETomek，</strong>是一种使用欠采样方法(Tomek)和过采样方法(SMOTE)的混合方法，包括移除Tomek链接，这些链接是彼此最接近<strong class="is hj">的实例对，或者称为最近邻居，但是属于相反的类。</strong></p><p id="dfbe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，生成的数据集没有中间类拥挤重叠，因此所有以最小距离放置的最近邻只属于一个类！</p><p id="31e6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">的确很棒！</strong></p><p id="dc4b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们看看<strong class="is hj">smetomek算法</strong>的实际实现！</p><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="74c3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输出可能会像下面这样对数据进行重采样-</p><pre class="ld le lf lg fd lj lk ll lm aw ln bi"><span id="6986" class="jo jp hi lk b fi lo lp l lq lr">((424788, 30), (424788,))</span></pre><p id="68f1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们来看看原始数据和改造后的数据，并进行比较</p><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="797b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输出-</p><pre class="ld le lf lg fd lj lk ll lm aw ln bi"><span id="037f" class="jo jp hi lk b fi lo lp l lq lr">Original dataset shape Counter({0: 284315, 1: 492})<br/>Resampled dataset shape Counter({0: 283473, 1: 141315})</span></pre><p id="9a70" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以清楚地看到，在原始数据集中，有284315条记录属于类0，只有492条属于类1，而SMOTETomek将其重新采样为283473条属于类0的记录和141315条属于类1的记录。</p><p id="5612" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">牛逼！</strong></p><h1 id="24e7" class="lt jp hi bd jq lu lv lw ju lx ly lz jy ma mb mc kb md me mf ke mg mh mi kh mj bi translated"><strong class="ak">结论</strong></h1><p id="1878" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">总之，我们总是同意这样一个事实，即<strong class="is hj">smetomek</strong>是一个为多数类和少数类示例提供<strong class="is hj">改进的准确性的方法，而<strong class="is hj">处理两个</strong>的完整性。</strong></p><p id="afb6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">不平衡学习是数据工程和知识发现领域中一个非常关键和具有挑战性的问题，其中错误分类的成本可能非常高。</strong></p><blockquote class="mk ml mm"><p id="5be1" class="iq ir mn is b it iu iv iw ix iy iz ja mo jc jd je mp jg jh ji mq jk jl jm jn hb bi translated">此外，我不会否认所有这些方法都受限于某些标准或条件，在这些标准或条件下，它们表现得更好。或者换句话说，需要为使用每种方法设置某些经验法则或标准，以便该方法在其指定的数据集范围内表现良好。</p></blockquote><p id="637a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">所以，永远保持好奇和细心，好好研究你的数据，这样你才能把最好的方法应用到其中！</strong></p><blockquote class="mk ml mm"><p id="e228" class="iq ir mn is b it iu iv iw ix iy iz ja mo jc jd je mp jg jh ji mq jk jl jm jn hb bi translated"><strong class="is hj">如果你是数据科学和机器学习的初学者，并对数据科学/ML-AI、向数据科学的职业过渡指导、面试/简历准备有一些具体的疑问，甚至想在你的D-Day之前获得模拟面试，请随时在这里</strong>  <strong class="is hj">预约1:1电话</strong> <a class="ae lc" href="https://topmate.io/sukannya" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">。我很乐意帮忙！</strong></a></p></blockquote><p id="3faa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">希望你喜欢这个博客，再次感谢你耐心地坚持到最后！</p><p id="f2ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">快乐的机器学习！:)</strong></p><p id="2977" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下次见…！</p></div></div>    
</body>
</html>