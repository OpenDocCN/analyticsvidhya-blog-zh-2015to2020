<html>
<head>
<title>Introduction to Apache Spark and Implicit Collaborative Filtering in PySpark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Apache Spark简介和PySpark中的隐式协作过滤</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/introduction-to-apache-spark-and-implicit-collaborative-filtering-in-pyspark-7c8c83eba008?source=collection_archive---------5-----------------------#2020-01-01">https://medium.com/analytics-vidhya/introduction-to-apache-spark-and-implicit-collaborative-filtering-in-pyspark-7c8c83eba008?source=collection_archive---------5-----------------------#2020-01-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="fcce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">阿帕奇火花:</strong></p><p id="831c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Apache Spark是开源的快速分布式计算框架。它提供了编程并行和容错机器集群的APIs。它最初是在加州大学伯克利分校开发的，后来捐赠给了阿帕奇基金会。</p><p id="3c56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它与Hadoop兼容，可以使用Yarn、Kubernetes、Mesos或独立模式运行Hadoop集群。它可以处理许多著名的分布式数据系统的数据，如卡珊德拉，HDFS，HBase等。对于批处理(如map-reduce)和任务(如流和机器学习)，它是一个非常好的平台。它的受欢迎程度在过去几年里迅速攀升，许多组织使用它来完成各种数据处理任务。</p><p id="4f05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">派斯帕克:</strong></p><p id="17e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Spark提供了Scala、Java、Python和r的高级API，Python对Spark的包装器叫做PySpark。PySpark是执行数据分析任务和构建机器学习应用程序的主要语言之一。Python语言在数据分析中的广泛应用使得PySpark非常直观，任何人都可以轻松使用。</p><p id="4c2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像Azure Databricks、微软的HDInsights等平台。使用高计算能力使PySpark非常容易设置和开始实验。在这篇技术评论中，我主要关注什么是隐式协同过滤以及如何在PySpark中实现它。我在下面的实验中使用了Azure Databricks。</p><p id="b016" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">隐式协同过滤:</strong></p><p id="21e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">协同过滤(CF)是推荐系统使用的最新技术。CF的动机来自于这样一个想法，即人们经常从与自己品味相似的人那里得到最好的推荐。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="ab fe cl ji"><img src="../Images/5138009ef59bf2c1b0f5446bcfc35832.png" data-original-src="https://miro.medium.com/v2/format:webp/1*FefgqLfxJ6RNJf0YPz4Vgg.jpeg"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">由<br/> Mohamed BEN ELLEFI拍摄的关于<a class="ae jp" href="https://www.slideshare.net/MohamedBENELLEFI/profilebased-dataset-recommendation-for-rdf-data-linking" rel="noopener ugc nofollow" target="_blank">基于个人资料的数据集推荐的照片</a></figcaption></figure><p id="5a11" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">隐式CF用于没有显式数据但可以访问大量隐式数据的场景，如从搜索历史中提取用户的兴趣，从观看历史中预测用户是否喜欢该电影(他观看该电影的时间等)。亚马逊和网飞等公司在推荐产品和电影时采用了这种技术。Bing和Google等搜索引擎公司使用它来确定用户兴趣。</p><p id="3a75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">显式CF使用低秩矩阵分解来近似矩阵中的条目。显式CF的一个非常著名的应用是在电影领域。低分(用户不喜欢该项目)和缺失值(意味着用户没有对该项目评分)之间有明显的区别。在优化过程中不需要计算用户-项目矩阵中的空白空间，因此它是计算稀疏的。</p><p id="1765" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一方面，隐性CF更为复杂，因为用户与项目之间的交互次数少可能意味着用户不喜欢该项目或者用户没有听说过该项目。它也是计算密集型的，因为您需要在优化期间计算矩阵中所有条目的值。</p><p id="88bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">PySpark内置了对隐式CF的支持。我们将在这里讨论几个重要的API</p><p id="9116" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jq">样本输入:</em> </strong></p><p id="4f16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是示例输入的快照。这是给定用户在搜索引擎中搜索产品的次数的数据集。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jr"><img src="../Images/0cae819fef39aa15627fcb489440d175.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*6p2YWYhwMI5sir0JL7QEDg.png"/></div></figure><p id="a187" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jq">拟合模型:</em> </strong></p><blockquote class="js jt ju"><p id="f1a2" class="if ig jq ih b ii ij ik il im in io ip jv ir is it jw iv iw ix jx iz ja jb jc hb bi translated">als = ALS(maxIter=30，regParam=0.1，implicitPrefs=True，userCol="userId "，itemCol="productId "，ratingCol="ClickCount ")</p><p id="dbcd" class="if ig jq ih b ii ij ik il im in io ip jv ir is it jw iv iw ix jx iz ja jb jc hb bi translated">savedModel = als.fit(培训)</p></blockquote><p id="85d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">处理时间取决于各种因素。使用大约50个内核和大约200 GB的RAM(data bricks上的DDRv2实例),对2000万用户和10万个产品进行培训大约需要1.5小时。</p><p id="e429" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jq">对给定集合进行预测:</em> </strong></p><blockquote class="js jt ju"><p id="5310" class="if ig jq ih b ii ij ik il im in io ip jv ir is it jw iv iw ix jx iz ja jb jc hb bi translated">预测= savedModel.transform(测试)</p></blockquote><p id="3a29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">样本输出</strong></p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jy"><img src="../Images/af3a5e64a2a6e94ac15ae846284a009e.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*VLYFgGBVmaBlJffuqk4xpQ.png"/></div></figure><p id="0acb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jq">为用户推荐商品:</em> </strong></p><blockquote class="js jt ju"><p id="6437" class="if ig jq ih b ii ij ik il im in io ip jv ir is it jw iv iw ix jx iz ja jb jc hb bi translated"><em class="hi"> #为每个用户生成前10个产品推荐</em></p><p id="0bad" class="if ig jq ih b ii ij ik il im in io ip jv ir is it jw iv iw ix jx iz ja jb jc hb bi translated">user RECs = saved model . recommendedforallusers(10)</p></blockquote><p id="3591" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jq">为用户推荐一件物品:</em> </strong></p><blockquote class="js jt ju"><p id="79e6" class="if ig jq ih b ii ij ik il im in io ip jv ir is it jw iv iw ix jx iz ja jb jc hb bi translated"><em class="hi"> #为每种产品生成前10名用户推荐</em></p><p id="e66c" class="if ig jq ih b ii ij ik il im in io ip jv ir is it jw iv iw ix jx iz ja jb jc hb bi translated">product RECs = saved model . recommendedforallitems(10)</p></blockquote><p id="a13a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jq">为子集生成建议:</em> </strong></p><blockquote class="js jt ju"><p id="a369" class="if ig jq ih b ii ij ik il im in io ip jv ir is it jw iv iw ix jx iz ja jb jc hb bi translated"><em class="hi"> #为用户子集生成10大产品推荐</em></p><p id="06f3" class="if ig jq ih b ii ij ik il im in io ip jv ir is it jw iv iw ix jx iz ja jb jc hb bi translated">userSubsetRecs = saved model . recommendeforusersubset(user subset，10)</p><p id="6d3d" class="if ig jq ih b ii ij ik il im in io ip jv ir is it jw iv iw ix jx iz ja jb jc hb bi translated"><em class="hi"> #为一组特定产品生成前10名用户推荐</em></p><p id="0080" class="if ig jq ih b ii ij ik il im in io ip jv ir is it jw iv iw ix jx iz ja jb jc hb bi translated">productSubSetRecs = saved model . recommendedforitemsubset(products subset，10)</p></blockquote><p id="6c31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Azure认知服务、Databricks ML Flow等各种服务，也可以使用构建的模型为实时用户提供服务。并且不在本文讨论范围内。</p><p id="bc21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考文献</strong>:</p><ol class=""><li id="83c9" class="jz ka hi ih b ii ij im in iq kb iu kc iy kd jc ke kf kg kh bi translated">PySpark官方文档:<a class="ae jp" href="https://spark.apache.org/docs/latest/api/python/index.html" rel="noopener ugc nofollow" target="_blank">https://spark.apache.org/docs/latest/api/python/index.html</a></li><li id="ab63" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc ke kf kg kh bi translated">阿帕奇火花:<a class="ae jp" href="https://spark.apache.org/faq.html" rel="noopener ugc nofollow" target="_blank">https://spark.apache.org/faq.html</a></li><li id="2275" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc ke kf kg kh bi translated">阿帕奇火花:<a class="ae jp" href="https://en.wikipedia.org/wiki/Apache_Spark" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Apache_Spark</a></li><li id="ae1f" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc ke kf kg kh bi translated">隐含CF:【http://yifanhu.net/PUB/cf.pdf T42】</li><li id="50ac" class="jz ka hi ih b ii ki im kj iq kk iu kl iy km jc ke kf kg kh bi translated">PySpark CF:<a class="ae jp" href="https://spark.apache.org/docs/latest/ml-collaborative-filtering.html" rel="noopener ugc nofollow" target="_blank">https://spark . Apache . org/docs/latest/ml-collaborative-filtering . html</a></li></ol></div></div>    
</body>
</html>