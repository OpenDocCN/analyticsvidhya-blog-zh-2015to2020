<html>
<head>
<title>Writing R Functions — 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写R函数— 3</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/writing-r-functions-3-2fe03faecfbe?source=collection_archive---------11-----------------------#2019-11-29">https://medium.com/analytics-vidhya/writing-r-functions-3-2fe03faecfbe?source=collection_archive---------11-----------------------#2019-11-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="97c6" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">如果您还没有阅读R基础系列的第2部分，请阅读下面的文章，在这篇文章中我们讨论了R-2中的高级数据结构。本系列涵盖了R的基础知识，包括数据类型、控制结构、循环、函数和高级数据结构。</p><p id="9f18" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">如果您已经熟悉这些主题，并且正在使用r寻找统计和机器学习中所有重要主题的全面介绍，请从以下系列开始，其中讨论了与数据科学相关的所有必要主题。</p><p id="03db" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated"><a class="ae jh" rel="noopener" href="/@viveksrinivasan/many-ways-of-reading-data-into-r-1-52b02825cb27">将数据读入R — 1的多种方式</a></p><p id="90aa" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">这篇文章的内容是我在IIM-B时代得到介绍的几本书的要点。</p><p id="2b5d" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">人人为我——贾里德·p·兰德</p><p id="0624" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">实用数据科学与R — Nina Zumel和John Mount</p><p id="8a0f" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">文中讨论的所有代码块都以R markdown的形式出现在<a class="ae jh" href="https://github.com/viveksrinivasanss/Data_Science_Using_R" rel="noopener ugc nofollow" target="_blank"> Github链接</a>中。</p><p id="32be" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">要查看我写的所有文章，请使用链接<a class="ae jh" rel="noopener" href="/@viveksrinivasan"> Vivek Srinivasan </a>。</p></blockquote><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es ji"><img src="../Images/ea95f61d3becca1f48c11a1ca14c646b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sbPBjHYawQ1MN_FIk3ZQiw.png"/></div></div></figure><p id="a00d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi jx translated"><span class="l jy jz ka bm kb kc kd ke kf di">如果</span>我们发现自己在重复运行相同的代码，那么把它变成一个函数可能是个好主意。在编程中，最好尽可能减少冗余。这样做有几个原因，包括可维护性和易于重用。有一种方便的方法来创建函数，但是它与其他语言有很大的不同，所以可能需要一些预期调整。</p><h2 id="6750" class="kk kl hi bd km kn ko kp kq kr ks kt ku ju kv kw kx jv ky kz la jw lb lc ld le bi translated">你好世界</h2><p id="86d1" class="pw-post-body-paragraph ii ij hi il b im lf io ip iq lg is it ju lh iw ix jv li ja jb jw lj je jf jg hb bi translated">如果我们不包括“你好，世界！”这就不是一个关于编程语言的严肃博客例子，我们就从这个开始。让我们构建一个简单地打印“Hello，World！”到控制台。</p><pre class="jj jk jl jm fd lk kj ll lm aw ln bi"><span id="d79a" class="kk kl hi kj b fi lo lp l lq lr">say.hello &lt;- function()<br/> {<br/>  print("Hello, World!")<br/> }</span><span id="97c4" class="kk kl hi kj b fi ls lp l lq lr">say.hello()</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es lt"><img src="../Images/8e7b02eed64ddb96ebf1c24dac4070c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JMRXqOnfMG6C5btwVtJhyQ.png"/></div></div></figure><p id="e86e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">首先，注意在<code class="du kg kh ki kj b">R</code>中，句号<code class="du kg kh ki kj b">(.)</code>只是另一个字符，没有特殊的含义，1不像在其他语言中。这允许我们调用这个函数<code class="du kg kh ki kj b">say.hello</code>。</p><p id="d8ea" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">接下来，我们看到函数被分配给对象，就像任何其他变量一样，使用<code class="du kg kh ki kj b">&lt;-</code>操作符。对于来自其他语言的人来说，这是编写函数最奇怪的地方。</p><p id="2fe7" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">函数后面是一组括号，可以是空的(没有任何参数)，也可以包含任意数量的参数。</p><p id="ce81" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">函数体用花括号<code class="du kg kh ki kj b">({ and })</code>括起来。如果函数只包含一行，这是不必要的，但这种情况很少见。注意函数内部命令的缩进。虽然不是必需的，但适当缩进代码以确保可读性是一个好习惯。我们将希望函数执行的代码行放在主体的这里。分号<code class="du kg kh ki kj b">(;) </code>可以用来表示行尾，但不是必须的，而且它的使用实际上是不被允许的。</p><h2 id="6458" class="kk kl hi bd km kn ko kp kq kr ks kt ku ju kv kw kx jv ky kz la jw lb lc ld le bi translated">函数参数</h2><p id="5c27" class="pw-post-body-paragraph ii ij hi il b im lf io ip iq lg is it ju lh iw ix jv li ja jb jw lj je jf jg hb bi translated">我们经常希望将参数传递给函数。这些很容易添加到函数声明的括号中。我们将使用一个参数来打印<code class="du kg kh ki kj b">“Hello Jared.”</code></p><p id="516a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">然而，在此之前，我们需要简要了解一下<code class="du kg kh ki kj b">sprintf </code>函数。它的第一个参数是一个带有特殊输入字符的字符串，后续参数将被替换到特殊输入字符中。</p><pre class="jj jk jl jm fd lk kj ll lm aw ln bi"><span id="5876" class="kk kl hi kj b fi lo lp l lq lr">sprintf("Hello %s, today is %s", "Jared", "Sunday")</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es lu"><img src="../Images/8a1e0f6d702262d14ba28c3200200414.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*klwdCOm3juvv7mHPBYGcXA.png"/></div></div></figure><p id="dfa8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">参数<code class="du kg kh ki kj b">name</code>可以作为函数内部的变量使用(它不存在于函数外部)。它也可以像任何其他变量一样使用，并作为进一步函数调用的参数。</p><pre class="jj jk jl jm fd lk kj ll lm aw ln bi"><span id="dca9" class="kk kl hi kj b fi lo lp l lq lr">hello.person &lt;- function(name)<br/>{<br/>  print(sprintf("Hello %s", name))<br/>}<br/>  <br/>hello.person("Jared")</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es lv"><img src="../Images/103665cab86b7a38e1ec3bddc98116a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yf9-eSNhKMMjUyWZvgljOQ.png"/></div></div></figure><p id="74c2" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">参数<code class="du kg kh ki kj b">name </code>可以作为函数内部的变量(在函数外部不存在)。它也可以像任何其他变量一样使用，并作为进一步函数调用的参数。</p><p id="e3ec" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">我们还可以添加第二个要打印的参数。当调用带有多个参数的函数时，有两种方法可以指定哪个参数带有哪个值，要么是按位置要么是按名称。</p><pre class="jj jk jl jm fd lk kj ll lm aw ln bi"><span id="8c4d" class="kk kl hi kj b fi lo lp l lq lr">hello.person &lt;- function(first, last)<br/>  {<br/>    print(sprintf("Hello %s %s", first, last))<br/>  }</span><span id="4282" class="kk kl hi kj b fi ls lp l lq lr">hello.person("vivek","srinivasan") or</span><span id="f39a" class="kk kl hi kj b fi ls lp l lq lr">hello.person(first="vivek",last="srinivasan")</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es lw"><img src="../Images/e57eddaf8f01c90e363a3a23ee928612.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DVshT_2ZE22e7M5NMi3EqA.png"/></div></div></figure><p id="864c" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">能够通过名称指定参数为调用函数增加了很多灵活性。甚至可以提供部分参数名，但是要小心。</p><pre class="jj jk jl jm fd lk kj ll lm aw ln bi"><span id="adce" class="kk kl hi kj b fi lo lp l lq lr">hello.person(fir="Jared", l="Lander")</span></pre><h2 id="1c9c" class="kk kl hi bd km kn ko kp kq kr ks kt ku ju kv kw kx jv ky kz la jw lb lc ld le bi translated">默认参数</h2><p id="e4c6" class="pw-post-body-paragraph ii ij hi il b im lf io ip iq lg is it ju lh iw ix jv li ja jb jw lj je jf jg hb bi translated">使用多个参数时，有时不需要为每个参数输入值。在其他语言中，可以通过多次定义函数来重载函数，每次使用不同数量的参数。相反，r提供了指定默认参数的能力。这些可以是<code class="du kg kh ki kj b">NULL</code>、<code class="du kg kh ki kj b">characters</code>、<code class="du kg kh ki kj b">numbers </code>或任何有效的<code class="du kg kh ki kj b">R</code>对象。让我们重写<code class="du kg kh ki kj b">hello.person </code>以提供<code class="du kg kh ki kj b">“Doe”</code>作为默认姓氏。</p><p id="0fa4" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">让我们重写<code class="du kg kh ki kj b">hello.person</code>以提供<code class="du kg kh ki kj b">“Doe”</code>作为默认姓氏</p><pre class="jj jk jl jm fd lk kj ll lm aw ln bi"><span id="b2e2" class="kk kl hi kj b fi lo lp l lq lr">hello.person &lt;- function(first, last="Srinivasan")<br/>  {<br/>    print(sprintf("Hello %s %s", first, last))<br/>  }</span><span id="9356" class="kk kl hi kj b fi ls lp l lq lr"># call without specifying last<br/>hello.person("Vivek")</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es lx"><img src="../Images/407e648a9b46cffaab819df6bb0aac54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eYnpPaq_mLvGc96PN7Z5Nw.png"/></div></div></figure><h2 id="cbcb" class="kk kl hi bd km kn ko kp kq kr ks kt ku ju kv kw kx jv ky kz la jw lb lc ld le bi translated">额外参数</h2><p id="d919" class="pw-post-body-paragraph ii ij hi il b im lf io ip iq lg is it ju lh iw ix jv li ja jb jw lj je jf jg hb bi translated">r提供了一个特殊的操作符，使函数可以接受任意数量的参数，而这些参数不需要在函数定义中指定。这就是点-点-点论证<code class="du kg kh ki kj b">(…)</code>。尽管这可以提供很大的灵活性，但应该非常小心地使用。现在，我们将只是看看它如何吸收额外的参数；稍后我们会发现它在函数间传递参数时的用途。</p><pre class="jj jk jl jm fd lk kj ll lm aw ln bi"><span id="c47e" class="kk kl hi kj b fi lo lp l lq lr"># call hello.person with an extra argument <br/>hello.person("Jared", extra="Goodbye")</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es ly"><img src="../Images/907a35a43dba88ed9882e37027a0bc96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yS5JypNCmp1slGAN1cdWIg.png"/></div></div></figure><pre class="jj jk jl jm fd lk kj ll lm aw ln bi"><span id="e805" class="kk kl hi kj b fi lo lp l lq lr">hello.person &lt;- function(first, last="Srinivasan",...)<br/>  {<br/>    print(sprintf("Hello %s %s and %s", first,last,...))<br/>  }</span><span id="caf2" class="kk kl hi kj b fi ls lp l lq lr"># call hello.person with an extra argument<br/>hello.person ("Vivek", extra="Goodbye")</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es lz"><img src="../Images/e94e1e954fdbb3824e9ca07b53ecc600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IXDvjcyxpNnEqm66IwZOUA.png"/></div></div></figure><h2 id="00ea" class="kk kl hi bd km kn ko kp kq kr ks kt ku ju kv kw kx jv ky kz la jw lb lc ld le bi translated">返回值</h2><p id="4f5d" class="pw-post-body-paragraph ii ij hi il b im lf io ip iq lg is it ju lh iw ix jv li ja jb jw lj je jf jg hb bi translated">函数通常用于计算某个值，因此它们需要一种机制将该值返回给调用者。这就是所谓的回归，而且很容易做到。使用<code class="du kg kh ki kj b">R</code>有两种方法可以实现这一点。函数中最后一行代码的值会自动返回，尽管这可能是一种不好的做法。举例来说，我们将构建一个函数，它将唯一的参数加倍并返回该值。</p><pre class="jj jk jl jm fd lk kj ll lm aw ln bi"><span id="1a94" class="kk kl hi kj b fi lo lp l lq lr"># first build it without an explicit return<br/>double.num &lt;- function(x)<br/>{<br/>  x * 2<br/>}<br/>double.num(5)</span></pre><p id="cafa" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated"><code class="du kg kh ki kj b">return </code>命令更明确地指定了应该返回值和应该退出函数。</p><pre class="jj jk jl jm fd lk kj ll lm aw ln bi"><span id="586d" class="kk kl hi kj b fi lo lp l lq lr"># build it again, this time with another argument after the explicit return<br/>double.num  &lt;- function(x)<br/>{<br/>  return(x * 2)<br/>  # below here is not executed because the function already exited<br/>  print("Hello!")<br/>  return(17)<br/>}</span><span id="c9cf" class="kk kl hi kj b fi ls lp l lq lr">double.num(5)</span></pre><h2 id="acf0" class="kk kl hi bd km kn ko kp kq kr ks kt ku ju kv kw kx jv ky kz la jw lb lc ld le bi translated">打电话</h2><p id="8dea" class="pw-post-body-paragraph ii ij hi il b im lf io ip iq lg is it ju lh iw ix jv li ja jb jw lj je jf jg hb bi translated">一个特别未被充分利用的技巧是<code class="du kg kh ki kj b">do.cal</code> l函数。这允许我们将函数名指定为<code class="du kg kh ki kj b">character </code>或<code class="du kg kh ki kj b">object</code>，并将参数指定为<code class="du kg kh ki kj b">list</code>。</p><pre class="jj jk jl jm fd lk kj ll lm aw ln bi"><span id="7570" class="kk kl hi kj b fi lo lp l lq lr">do.call("hello.person", args=list(first="Jared", last="Lander"))</span><span id="6a0e" class="kk kl hi kj b fi ls lp l lq lr">or </span><span id="f606" class="kk kl hi kj b fi ls lp l lq lr">do.call(hello.person, args=list(first="Jared", last="Lander"))</span></pre><p id="c1ee" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">这在构建允许用户指定动作的函数时特别有用。在下面的例子中，用户提供一个<code class="du kg kh ki kj b">vector </code>和一个<code class="du kg kh ki kj b">function </code>来运行。</p><pre class="jj jk jl jm fd lk kj ll lm aw ln bi"><span id="491a" class="kk kl hi kj b fi lo lp l lq lr">run.this  &lt;- function(x, func=mean)<br/>{<br/>  do.call(func, args=list(x))<br/>}</span><span id="a666" class="kk kl hi kj b fi ls lp l lq lr">## calling the run.this with vector and function<br/>run.this(c(1,2,3,4),mean)</span><span id="c60c" class="kk kl hi kj b fi ls lp l lq lr">run.this(c(1,2,3,4),sum)</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es ma"><img src="../Images/f6244056aade136545e041fc2e447ffc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_nBYhC-lr5pdmbjVeMJfIw.png"/></div></div></figure><p id="9cc6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">函数允许我们创建可重用的代码，避免重复并允许容易的修改。需要记住的要点是函数参数、默认值和返回值。在接下来的文章中，我们将会看到比我们目前看到的更复杂的函数。在下一篇文章中，我们将讨论r。</p><blockquote class="if ig ih"><p id="5ba3" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated"><a class="ae jh" rel="noopener" href="/@viveksrinivasan/control-statement-and-loops-in-r-4-3663b782b064">R—4中的控制语句和循环</a></p><p id="f7c2" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated"><em class="hi">一定要通过评论和分享文章来分享你的想法和支持。</em></p></blockquote></div></div>    
</body>
</html>