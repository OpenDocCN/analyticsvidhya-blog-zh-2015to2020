<html>
<head>
<title>Tutorial: Amazon price tracker using Python and MongoDB (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:使用Python和MongoDB的Amazon价格跟踪器(第1部分)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/tutorial-amazon-price-tracker-using-python-and-mongodb-part-1-aece6347ec63?source=collection_archive---------1-----------------------#2019-07-26">https://medium.com/analytics-vidhya/tutorial-amazon-price-tracker-using-python-and-mongodb-part-1-aece6347ec63?source=collection_archive---------1-----------------------#2019-07-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="510c" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">关于如何创建亚马逊价格追踪器的两部分教程。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/4e04be5e3ea1594587c9d7af00414a5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9yrEnlgpzV0DWGOP"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><a class="ae jn" href="https://unsplash.com/@m_b_m?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> M. B. M. </a>在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="1c29" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最近有一个亚马逊的销售，我想买一个我已经看了很久的产品。但是，当我准备买下它时，我注意到价格上涨了，我怀疑这种销售是否合法。所以我想通过创建这个价格跟踪应用程序，它不仅可以提高我在python方面的流畅性，还可以让我拥有自己的自制应用程序来跟踪亚马逊的价格。</p><blockquote class="kk"><p id="534f" class="kl km hi bd kn ko kp kq kr ks kt kj dx translated">虽然我已经编程很长时间了，但是直到最近我才开始学习python，但是到目前为止这是一种享受。如果你们中的任何python专家发现我的代码不太“python化”，我道歉，我会学习更多:)。</p></blockquote><blockquote class="ku kv kw"><p id="7dee" class="jo jp kx jq b jr ky ij jt ju kz im jw la lb jz ka lc ld kd ke le lf kh ki kj hb bi translated">本教程假设您至少具备python的基础知识。另外，您的系统上安装了Python和MongoDB。</p><p id="5429" class="jo jp kx jq b jr js ij jt ju jv im jw la jy jz ka lc kc kd ke le kg kh ki kj hb bi translated">请注意，本教程旨在演示如何创建亚马逊价格追踪器，而不是教授编程。</p></blockquote><p id="8a42" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">所以，事不宜迟，让我们开始本教程的第1部分。</p><h1 id="9d3b" class="lg lh hi bd li lj lk ll lm ln lo lp lq io lr ip ls ir lt is lu iu lv iv lw lx bi translated">这个教程到2022年就过时了。我将很快创建一个更新的版本。</h1></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h2 id="eaa1" class="mf lh hi bd li mg mh mi lm mj mk ml lq jx mm mn ls kb mo mp lu kf mq mr lw ms bi translated">步骤1:为项目创建文件和文件夹</h2><ul class=""><li id="b382" class="mt mu hi jq b jr mv ju mw jx mx kb my kf mz kj na nb nc nd bi translated">打开你喜欢的任何目录，创建一个文件夹，命名为amazon_price_tracker或任何你想要的名字。</li><li id="2f10" class="mt mu hi jq b jr ne ju nf jx ng kb nh kf ni kj na nb nc nd bi translated">现在打开文件夹，创建两个文件<code class="du nj nk nl nm b">scraper.py</code>和<code class="du nj nk nl nm b">db.py</code>。</li></ul><p id="7f74" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是第一步，现在打开项目目录中的<em class="kx">终端</em>，进入下一步。</p><h2 id="7239" class="mf lh hi bd li mg mh mi lm mj mk ml lq jx mm mn ls kb mo mp lu kf mq mr lw ms bi translated">步骤2(可选):使用virtualenv创建虚拟环境</h2><p id="8232" class="pw-post-body-paragraph jo jp hi jq b jr mv ij jt ju mw im jw jx nn jz ka kb no kd ke kf np kh ki kj hb bi translated">这是一个<strong class="jq hj">可选的</strong>步骤，用于隔离正在安装的软件包。你可以在这里找到更多关于virtualenv <a class="ae jn" href="https://virtualenv.pypa.io/en/latest/userguide/" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="d6d1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">运行此命令来创建一个环境。</p><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="eae3" class="mf lh hi nm b fi nu nv l nw nx">$ virtualenv ENV</span></pre><p id="2d3d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">运行这个来激活环境。</p><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="175b" class="mf lh hi nm b fi nu nv l nw nx">$ source ENV/bin/activate</span></pre><p id="c5c5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果您想停用环境，只需运行以下命令。</p><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="f2a1" class="mf lh hi nm b fi nu nv l nw nx">$ deactivate</span></pre><p id="8a1a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，如果您还没有激活环境，请执行第3步。</p><h2 id="4559" class="mf lh hi bd li mg mh mi lm mj mk ml lq jx mm mn ls kb mo mp lu kf mq mr lw ms bi translated">步骤3:安装所需的软件包。</h2><ul class=""><li id="0a02" class="mt mu hi jq b jr mv ju mw jx mx kb my kf mz kj na nb nc nd bi translated">运行这个命令来安装<strong class="jq hj">请求</strong>(一个产生HTTP请求的库)</li></ul><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="5242" class="mf lh hi nm b fi nu nv l nw nx">$ pip install requests</span></pre><ul class=""><li id="8a77" class="mt mu hi jq b jr js ju jv jx ny kb nz kf oa kj na nb nc nd bi translated">运行这个命令来安装<strong class="jq hj"> BeautifulSoup4 </strong>(一个从网页中抓取信息的库)</li></ul><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="2b9b" class="mf lh hi nm b fi nu nv l nw nx">$ pip install bs4</span></pre><ul class=""><li id="dd19" class="mt mu hi jq b jr js ju jv jx ny kb nz kf oa kj na nb nc nd bi translated">运行这个命令来安装<strong class="jq hj"> html5lib </strong>(现代HTML5解析器)</li></ul><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="44de" class="mf lh hi nm b fi nu nv l nw nx">$ pip install html5lib</span></pre><ul class=""><li id="06a7" class="mt mu hi jq b jr js ju jv jx ny kb nz kf oa kj na nb nc nd bi translated">运行这个命令来安装<strong class="jq hj"> pymongo </strong>(访问MongoDB的驱动程序)</li></ul><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="f631" class="mf lh hi nm b fi nu nv l nw nx">$ pip install pymongo</span></pre><h2 id="12fc" class="mf lh hi bd li mg mh mi lm mj mk ml lq jx mm mn ls kb mo mp lu kf mq mr lw ms bi translated">步骤4:开始编写extract_url(URL)函数</h2><p id="380b" class="pw-post-body-paragraph jo jp hi jq b jr mv ij jt ju mw im jw jx nn jz ka kb no kd ke kf np kh ki kj hb bi translated">现在，打开<code class="du nj nk nl nm b">scraper.py</code>，我们需要导入一些我们之前安装的包。</p><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="9b15" class="mf lh hi nm b fi nu nv l nw nx">import requests<br/>from bs4 import BeautifulSoup</span></pre><p id="bca6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，让我们创建一个函数<strong class="jq hj"> </strong> <code class="du nj nk nl nm b">extract_url(URL)</code>来缩短URL，并验证该URL是否是有效的<a class="ae jn" href="http://www.amazon.in" rel="noopener ugc nofollow" target="_blank"> www.amazon.in </a> URL。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ob oc l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">URL提取功能</figcaption></figure><p id="76c6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">该函数接受一个Amazon India URL，例如:</p><blockquote class="ku kv kw"><p id="6f69" class="jo jp kx jq b jr js ij jt ju jv im jw la jy jz ka lc kc kd ke le kg kh ki kj hb bi translated"><a class="ae jn" href="https://www.amazon.in/dp/B07HGJJ58K/" rel="noopener ugc nofollow" target="_blank">https://www . Amazon . in/Samsung-Galaxy-M30-Gradation-Blue/DP/b 07 hgj 58k/ref = br _ MSW _ PDT-1？_ encoding = UTF8&amp;smid = a1 eweiv 3 f 4 b 24 b&amp;pf _ rd _ m = a1 vbal 9 TL 5 wcbf&amp;pf _ rd _ s =&amp;pf _ rd _ r = vfj 98 f 93 x 80 ywyqnr 3 gn&amp;pf _ rd _ t = 36701&amp;pf _ rd _ p = 9806 B2 C4-09 c8-4373-b954-BAE 25 b 7 ea 043</a></p></blockquote><p id="18de" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">并将它们转换成更容易管理的更短的URL<a class="ae jn" href="https://www.amazon.in/dp/B07HGJJ58K/" rel="noopener ugc nofollow" target="_blank">https://www.amazon.in/dp/B07HGJJ58K</a>。此外，如果URL无效<a class="ae jn" href="http://www.amazon.in" rel="noopener ugc nofollow" target="_blank"> www.amazon.in </a> URL，那么它将返回一个<em class="kx"> None </em></p><h2 id="24c5" class="mf lh hi bd li mg mh mi lm mj mk ml lq jx mm mn ls kb mo mp lu kf mq mr lw ms bi translated">第五步:下一个函数我们需要什么</h2><p id="0e90" class="pw-post-body-paragraph jo jp hi jq b jr mv ij jt ju mw im jw jx nn jz ka kb no kd ke kf np kh ki kj hb bi translated">对于下一个函数Google <a class="ae jn" href="https://www.google.co.in/search?q=my+user+agent" rel="noopener ugc nofollow" target="_blank">“我的用户代理</a>”，复制你的用户代理并将其分配给变量头。</p><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="39ba" class="mf lh hi nm b fi nu nv l nw nx">headers = { "User-Agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36"<br/>}</span></pre><p id="e350" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在我们创建一个从页面中删除细节的函数之前，让我们访问一个亚马逊产品页面，比如<a class="ae jn" href="https://www.amazon.in/dp/B07HGJJ58K" rel="noopener ugc nofollow" target="_blank">这个</a>页面，找到包含产品名称和价格的元素。我们将需要元素的id，以便在提取数据时能够找到元素。</p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es od"><img src="../Images/9dcf066969858b639cf025e86d2dcd82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SY2KtViywQoey2jKD0bqzQ.png"/></div></div></figure><p id="1998" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">页面呈现后，右键单击产品名称，然后单击“inspect ”,这将显示包含产品名称的元素。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es oe"><img src="../Images/2000a12e22e419f805dc630ecc345adc.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*KrYoUtGHlfknkcIJctI2TA.png"/></div></figure><p id="5990" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们可以看到，<em class="kx"> </em> <code class="du nj nk nl nm b">&lt;span&gt;</code>元素与<code class="du nj nk nl nm b"> id=“productTitle”</code> <em class="kx"> </em>现在紧紧抓住这个id，我们以后会用它来报废产品的名称。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es od"><img src="../Images/8ddb1cf8b4ae1eda1fef13895067a5ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uMz87W6Z9Nk8uelqYHKcwg.png"/></div></div></figure><p id="f649" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们将对价格进行同样的操作，现在右键单击价格，然后单击inspect。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es of"><img src="../Images/7a1f7516e06a76a2358fabf1231eafd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*4zTHFCsDzqMjB9l_1_bFVg.png"/></div></figure><p id="942b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">带有<code class="du nj nk nl nm b">id=“priceblock_dealprice”</code> <em class="kx"> </em>的<code class="du nj nk nl nm b">&lt;span&gt;</code>元素有我们需要的价格。但是，该产品正在销售，因此其id不同于普通id<code class="du nj nk nl nm b">id=“priceblock_ourprice”</code><em class="kx">。</em></p><h2 id="076f" class="mf lh hi bd li mg mh mi lm mj mk ml lq jx mm mn ls kb mo mp lu kf mq mr lw ms bi translated">步骤6:创建价格转换器函数</h2><p id="0660" class="pw-post-body-paragraph jo jp hi jq b jr mv ij jt ju mw im jw jx nn jz ka kb no kd ke kf np kh ki kj hb bi translated">如果你仔细观察,<code class="du nj nk nl nm b">&lt;span&gt;</code>元素有价格，但是它有许多不需要的东西，比如₹卢比符号、空格、逗号分隔符和小数点。</p><p id="2772" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们只需要价格的整数部分，所以我们将创建一个价格转换器函数，它将删除不需要的字符，并给出整数类型的价格。</p><p id="4d6d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们将这个函数命名为<code class="du nj nk nl nm b">get_converted_price(price)</code></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ob oc l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">价格转换功能</figcaption></figure><p id="653b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">通过一些简单的字符串操作，该函数将以整数形式给出转换后的价格。</p><blockquote class="ku kv kw"><p id="ace5" class="jo jp kx jq b jr js ij jt ju jv im jw la jy jz ka lc kc kd ke le kg kh ki kj hb bi translated"><strong class="jq hj"> <em class="hi">更新:</em> </strong> <em class="hi">正如@ </em> <a class="og oh ge" href="https://medium.com/u/19e438f9aee?source=post_page-----aece6347ec63--------------------------------" rel="noopener" target="_blank"> oorjahalt </a> <em class="hi">所提到的，我们可以简单地使用regex来提取价格。</em></p></blockquote><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ob oc l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">更新的价格函数。</figcaption></figure><blockquote class="ku kv kw"><p id="d7a8" class="jo jp kx jq b jr js ij jt ju jv im jw la jy jz ka lc kc kd ke le kg kh ki kj hb bi translated"><strong class="jq hj">注意</strong>:虽然tracker是为<a class="ae jn" href="http://www.amazon.in" rel="noopener ugc nofollow" target="_blank"> www.amazon.in </a>准备的，但它也可以用于<a class="ae jn" href="http://www.amazon.com" rel="noopener ugc nofollow" target="_blank">www.amazon.com</a>或其他类似的网站，只需做很小的改动，例如:</p></blockquote><p id="1336" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">要使其与amazon的全球版本兼容，只需执行以下操作:</p><ul class=""><li id="93c0" class="mt mu hi jq b jr js ju jv jx ny kb nz kf oa kj na nb nc nd bi translated">将₹兑换成美元</li></ul><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="a1ee" class="mf lh hi nm b fi nu nv l nw nx">stripped_price = price.strip("$ ,")</span></pre><ul class=""><li id="cad4" class="mt mu hi jq b jr js ju jv jx ny kb nz kf oa kj na nb nc nd bi translated">我们可以完全跳过<code class="du nj nk nl nm b">find_dot</code>和<code class="du nj nk nl nm b">to_convert_price</code> <strong class="jq hj"> <em class="kx"> </em> </strong>，就这么做</li></ul><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="af0b" class="mf lh hi nm b fi nu nv l nw nx">converted_price = float(replace_price)</span></pre><p id="262a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">但是，我们会将价格转换为浮动类型。</p><ul class=""><li id="e346" class="mt mu hi jq b jr js ju jv jx ny kb nz kf oa kj na nb nc nd bi translated">并在<code class="du nj nk nl nm b">extract_url(URL)</code>功能中将<a class="ae jn" href="http://www.amazon.in" rel="noopener ugc nofollow" target="_blank"><em class="kx">www . Amazon . in</em></a>改为<em class="kx"/><a class="ae jn" href="http://www.amazon.com" rel="noopener ugc nofollow" target="_blank"><em class="kx">【www.amazon.com】</em></a></li></ul><p id="48b2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这将使它与www.amazon.com的<a class="ae jn" href="http://www.amazon.com." rel="noopener ugc nofollow" target="_blank">和<em class="kx">兼容。</em> </a></p><p id="83f1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，当我们系好安全带时，我们终于可以开始创建刮刀功能了。</p><h2 id="344c" class="mf lh hi bd li mg mh mi lm mj mk ml lq jx mm mn ls kb mo mp lu kf mq mr lw ms bi translated">第七步:进入细节刮刀功能</h2><p id="f1e6" class="pw-post-body-paragraph jo jp hi jq b jr mv ij jt ju mw im jw jx nn jz ka kb no kd ke kf np kh ki kj hb bi translated">好了，让我们创建一个函数，提取产品的详细信息，如名称、价格，并返回一个包含产品名称、价格和URL的字典。我们将这个函数命名为<code class="du nj nk nl nm b">get_product_details(URL)</code>。</p><p id="aaee" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这个函数的前两个变量是<code class="du nj nk nl nm b">headers</code>和<code class="du nj nk nl nm b">details</code> <strong class="jq hj"> <em class="kx">，</em> </strong> <code class="du nj nk nl nm b">headers</code> <strong class="jq hj"> </strong>，其中<strong class="jq hj"> </strong>将包含您的用户代理，<code class="du nj nk nl nm b">details</code>是一个字典，将包含产品的详细信息。</p><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="bdfe" class="mf lh hi nm b fi nu nv l nw nx">headers = {<br/>        "User-Agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36"<br/>}<br/>details = {"name": "", "price": 0, "deal": True, "url": ""}</span></pre><p id="d9e8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">另一个变量<code class="du nj nk nl nm b">_url</code>将为我们保存提取的URL，我们将检查该URL是否有效。无效的URL会是<code class="du nj nk nl nm b">return None</code>，如果<strong class="jq hj"><em class="kx"/></strong>URL无效，那么我们会将详细信息设置为<code class="du nj nk nl nm b">None</code> <strong class="jq hj"> <em class="kx"> </em> </strong>并在末尾返回，以便我们知道URL有问题。</p><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="11a2" class="mf lh hi nm b fi nu nv l nw nx">_url = extract_url(url)<br/>if _url is None:<br/>    details = None</span></pre><p id="1043" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，我们来到<code class="du nj nk nl nm b">else</code>部分。这有4个变量<code class="du nj nk nl nm b">page</code>、<code class="du nj nk nl nm b">soup</code>、<code class="du nj nk nl nm b">title</code>和<code class="du nj nk nl nm b">price</code>。</p><p id="7c53" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><code class="du nj nk nl nm b">page</code> <strong class="jq hj"> <em class="kx"> </em> </strong>变量<strong class="jq hj"> <em class="kx"> </em> </strong>将保存被请求产品的页面。</p><p id="8ab7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">变量将保存HTML，用它我们可以做很多事情，比如找到一个有id的元素并提取它的文本，这就是我们将要做的。你可以在这里找到更多关于其他美丽组的功能<a class="ae jn" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="4484" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><code class="du nj nk nl nm b">title</code>顾名思义，变量将保存具有产品标题的元素。</p><p id="2bd8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><code class="du nj nk nl nm b">price</code>变量将保存包含产品价格的元素。</p><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="2de5" class="mf lh hi nm b fi nu nv l nw nx">page = requests.get(url, headers=headers)<br/>soup = BeautifulSoup(page.content, "html5lib")<br/>title = soup.find(id="productTitle")<br/>price = soup.find(id="priceblock_dealprice")</span></pre><p id="cfbc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在我们已经有了标题和价格的元素，我们将做一些检查。</p><p id="b909" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们从价格开始，如前所述，价格id可以是交易日的<code class="du nj nk nl nm b">id=”priceblock_dealprice”</code>或普通日的<code class="du nj nk nl nm b">id=”priceblock_ourprice”</code><strong class="jq hj"><em class="kx"/></strong><strong class="jq hj"><em class="kx"/></strong>。</p><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="44af" class="mf lh hi nm b fi nu nv l nw nx">if price is None:<br/>    price = soup.find(id="priceblock_ourprice")<br/>    details["deal"] = False</span></pre><p id="bd4a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">由于我们首先检查是否有交易价格，代码将把<code class="du nj nk nl nm b">price</code>从交易价格改为正常价格，如果没有交易价格，还将<code class="du nj nk nl nm b">details[“deal”]</code> <strong class="jq hj"> <em class="kx"> </em> </strong>中的交易设置为<code class="du nj nk nl nm b">false</code>。这样做是为了让我们知道价格是正常的。</p><p id="619c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，即使我们没有得到价格，这意味着页面有问题，可能是产品缺货，或者可能是产品还没有发布，或者是其他一些可能性。下面的代码将检查是否有标题和价格。</p><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="6f2f" class="mf lh hi nm b fi nu nv l nw nx">if title is not None and price is not None:<br/>    details["name"] = title.get_text().strip()<br/>    details["price"] = get_converted_price(price.get_text())<br/>    details["url"] = _url</span></pre><p id="0160" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果有产品的价格和标题，那么我们将存储它们。</p><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="e970" class="mf lh hi nm b fi nu nv l nw nx">details["name"] = title.get_text().strip()</span></pre><p id="22c6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这将存储产品的名称，但是我们必须从标题中去掉任何不需要的空格。函数的作用是:删除所有的前后空格。</p><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="42b3" class="mf lh hi nm b fi nu nv l nw nx">details["price"] = get_converted_price(price.get_text())</span></pre><p id="4220" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这将存储产品的价格。在前面创建的get_converted_price(price)函数的帮助下，我们可以得到整数类型的转换价格。</p><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="0f49" class="mf lh hi nm b fi nu nv l nw nx">details["url"] = _url</span></pre><p id="7ea8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这将存储提取的URL。</p><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="f1c3" class="mf lh hi nm b fi nu nv l nw nx">else:<br/>    details = None<br/>return details</span></pre><p id="dfb2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果价格或标题不存在，我们将把细节设置为<code class="du nj nk nl nm b">None</code>。</p><p id="a951" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最后，函数完成了，这是完整的代码</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ob oc l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">提取产品详细信息的函数。</figcaption></figure><blockquote class="ku kv kw"><p id="422b" class="jo jp kx jq b jr js ij jt ju jv im jw la jy jz ka lc kc kd ke le kg kh ki kj hb bi translated"><strong class="jq hj">注意</strong>:虽然这个代码不适用于书籍，因为书籍有不同的<code class="du nj nk nl nm b">productid</code>，但是如果你调整代码，你可以让它适用于书籍。</p></blockquote><h2 id="0e28" class="mf lh hi bd li mg mh mi lm mj mk ml lq jx mm mn ls kb mo mp lu kf mq mr lw ms bi translated">第八步:让我们运行scraper.py</h2><p id="944c" class="pw-post-body-paragraph jo jp hi jq b jr mv ij jt ju mw im jw jx nn jz ka kb no kd ke kf np kh ki kj hb bi translated">在文件末尾添加以下内容。</p><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="b29a" class="mf lh hi nm b fi nu nv l nw nx">print(get_product_details("Insert an Amazon URL"))</span></pre><p id="da45" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">打开存有scraper.py文件的终端，像这样运行scraper.py。</p><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="fb90" class="mf lh hi nm b fi nu nv l nw nx">$ python3 scraper.py</span></pre><p id="ad67" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果你做的一切都正确，你应该得到这样的输出。</p><pre class="iy iz ja jb fd nq nm nr ns aw nt bi"><span id="6c2d" class="mf lh hi nm b fi nu nv l nw nx">{‘name’: ‘Nokia 8.1 (Iron, 4GB RAM, 64GB Storage)’, ‘price’: 19999, ‘deal’: False, ‘url’: ‘<a class="ae jn" href="https://www.amazon.in/dp/B077Q42J32'" rel="noopener ugc nofollow" target="_blank">https://www.amazon.in/dp/B077Q42J32'</a>}</span></pre><p id="4b93" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">瞧，我们已经完成了亚马逊价格跟踪教程的第1部分。</p><p id="f484" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下周我们将在后续的第2部分见面，我们将探索使用P <strong class="jq hj"> yMongo </strong>来存储我们的数据的<strong class="jq hj"> MongoDB </strong>。</p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><blockquote class="kk"><p id="78be" class="kl km hi bd kn ko kp kq kr ks kt kj dx translated">这是我第一篇关于媒体或博客的文章，我很高兴将来能在这里分享我的想法、实验和故事。希望你会喜欢。</p></blockquote><p id="c197" class="pw-post-body-paragraph jo jp hi jq b jr ky ij jt ju kz im jw jx lb jz ka kb ld kd ke kf lf kh ki kj hb bi translated"><em class="kx">在下面找到本文的完整源代码。</em></p><div class="oi oj ez fb ok ol"><a href="https://github.com/ArticB/amazon_price_tracker" rel="noopener  ugc nofollow" target="_blank"><div class="om ab dw"><div class="on ab oo cl cj op"><h2 class="bd hj fi z dy oq ea eb or ed ef hh bi translated">ArticB/亚马逊价格跟踪系统</h2><div class="os l"><h3 class="bd b fi z dy oq ea eb or ed ef dx translated">这是一个使用Python和MongoDB的亚马逊价格追踪器</h3></div><div class="ot l"><p class="bd b fp z dy oq ea eb or ed ef dx translated">github.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz jh ol"/></div></div></a></div><p id="71f1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">点击第二部分的链接。</strong></p><div class="oi oj ez fb ok ol"><a rel="noopener follow" target="_blank" href="/@deeprajpradhan/tutorial-amazon-price-tracker-using-python-and-mongodb-part-2-5a9107ed2204"><div class="om ab dw"><div class="on ab oo cl cj op"><h2 class="bd hj fi z dy oq ea eb or ed ef hh bi translated">教程:使用Python和MongoDB的Amazon价格跟踪器(第2部分)</h2><div class="os l"><h3 class="bd b fi z dy oq ea eb or ed ef dx translated">关于如何创建亚马逊价格跟踪系统的两部分教程</h3></div><div class="ot l"><p class="bd b fp z dy oq ea eb or ed ef dx translated">medium.com</p></div></div><div class="ou l"><div class="pa l ow ox oy ou oz jh ol"/></div></div></a></div></div></div>    
</body>
</html>