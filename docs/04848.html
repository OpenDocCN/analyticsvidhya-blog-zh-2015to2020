<html>
<head>
<title>Jupyter/Python for COVID-19 data analysis (part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于新冠肺炎数据分析的Jupyter/Python(第二部分)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/jupyter-python-for-covid-19-data-analysis-part-2-c7aef8fb2ac6?source=collection_archive---------20-----------------------#2020-04-02">https://medium.com/analytics-vidhya/jupyter-python-for-covid-19-data-analysis-part-2-c7aef8fb2ac6?source=collection_archive---------20-----------------------#2020-04-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4b20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">昨天我们看了，分析了新冠肺炎新增确诊病例动态的大致趋势。我们已经看到，至少对意大利来说，新增病例的曲线很快就会变平。但是封锁什么时候会取消？看起来，尽管曲线正在变平，医院仍然在倒塌。我们能想象一下情况什么时候会好转吗？</p><p id="0bbe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">至于之前的帖子，我准备了一个Jupyter笔记本:</p><p id="45bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://github.com/dmitrii303/covid/blob/master/Covid%20part2.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/Dmitri 303/Covid/blob/master/Covid % 20 part 2 . ipynb</a></p><h2 id="b39e" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">现状</h2><p id="7c14" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">医院的负荷是由活跃病例的数量来定义的——还没有从疾病中康复的人。所以，影响这个数字的有三个过程:新人得病，死亡，康复。要获得活动病例的历史动态，我们可以从病例总数中减去死亡人数和康复人数:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ke"><img src="../Images/13fe82be103dd673c0c1324ea9271e1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9LTWDOq5EUX5vme06i2Y9Q.png"/></div></div></figure><p id="9a42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以看出，活跃病例的数量仍在增加，因此医院的工作量也在增加。问题是，我们能预测这个数字何时开始减少吗？</p><h2 id="f9f1" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">死亡和康复的概率</h2><p id="d2d5" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">为了回答这个问题，我们需要能够预测死亡和恢复情况。这并不简单，因为死亡和恢复过程相对于疾病检测都是延迟的。这个过程是动态的，第一天<em class="kq">的死亡/康复数量应该取决于疫情的整个历史。</em></p><p id="4924" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们想象一下，一个人在第<em class="kq"> k </em>天第一次被观察到呈阳性。并且对于接下来的任何一天，我们都可以知道这个人在那一天死亡(康复)的概率。我们可以假设这个概率是<em class="kq"> i </em>和<em class="kq"> k </em>之差的函数:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es kr"><img src="../Images/43a4209c5f72e1ae4f841bc9b296f454.png" data-original-src="https://miro.medium.com/v2/resize:fit:552/1*eqZSQYkZ-0qYl3ozvMIpgQ.gif"/></div></figure><p id="814a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以说，当<em class="kq"> i = k </em>时，这些函数可能会在零附近，然后会朝着某个有限值增长(实际上，在第60天恢复的概率应该与第61天的概率大致相同)。同样，在这个上限，两个概率的总和应该是1，因为我们假设一段时间后，这个人要么死了，要么康复了。</p><p id="67da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不幸的是，我们没有按队列统计的死亡/康复数据。如果我们有它，我们可以直接观察概率函数的形状。在我们的例子中，我们可以提出一些简单的函数，定性地满足条件。</p><p id="8016" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">假设</strong>:让我们尝试使用我们在之前的分析中使用的相同的逻辑(Sigmoid)函数。在这种情况下，我们可以写:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es ks"><img src="../Images/1aaee880cf58d41e784b9f5fb2aee5f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/1*ro-MVjT27L7QHIhAo5UZ_A.gif"/></div></figure><p id="a928" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">条件为:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es kt"><img src="../Images/4cb60768535f0c1dd4cac4283a1dce6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:334/1*LFg85NJTtAcYLcK_sRaUWg.gif"/></div></figure><p id="ce1b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中<em class="kq"> md(r) </em>表示该人死亡(恢复)的最大概率。对于死亡病例，实际上是CFR——病例死亡率。</p><h2 id="b276" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">寻找价值</h2><p id="6e5b" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">所以现在死亡和恢复过程的动力学由5个参数描述:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es ku"><img src="../Images/be4410b9a7ff21cab242c859cd695890.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/1*1yZIK1kbtwn5g0btH7vs6A.gif"/></div></figure><p id="8590" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了找到它们的值，我们必须实现函数，给定这些参数和新病例的历史将返回死亡和恢复的历史。死亡和恢复过程都遵循相似的规律，只是参数值不同。因此，为了描述一个抽象状态(最终状态可能是死亡或恢复)进化的动态，我创建了一组下列函数:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es kv"><img src="../Images/cb6eed0f447de2e2a622560711b701a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uBFw9sZ2Wl7th09DG5Nk1g.png"/></div></div></figure><p id="7f9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">稍微澄清一下:</p><ul class=""><li id="bd38" class="kw kx hi ih b ii ij im in iq ky iu kz iy la jc lb lc ld le bi translated"><code class="du lf lg lh li b">get_prob_vector(m, k, x0)</code> —该函数构建90天的概率向量。向量的每个元素显示了在与向量中的元素索引相对应的天数之后，人处于某种状态(死亡或恢复)的概率。</li><li id="7a4a" class="kw kx hi ih b ii lj im lk iq ll iu lm iy ln jc lb lc ld le bi translated"><code class="du lf lg lh li b">predict_final_state(day, prob_vector, daily_cases=None)</code> —该功能给出了<code class="du lf lg lh li b">day</code>当天处于<code class="du lf lg lh li b">prob_vector</code>对应状态的人数。<code class="du lf lg lh li b">daily_cases</code>是新病例的历史。如果是<code class="du lf lg lh li b">None</code>，那么就用真实的历史数据。</li><li id="df3b" class="kw kx hi ih b ii lj im lk iq ll iu lm iy ln jc lb lc ld le bi translated"><code class="du lf lg lh li b">final_state_function(x, m, k, x0, daily_cases=None)</code> —此函数获取日向量x，并返回由逻辑函数参数定义的状态下的每日人数</li></ul><p id="9b0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，有了这个函数，我们可以建立一个目标函数。它将是每日预测死亡/恢复数量和实际死亡/恢复数量之间的累计差异。剩下的就是用我们想要找到的五个参数最小化这个函数:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lo"><img src="../Images/9f96c5cf9416a9c22cd0c5a54d5cb967.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l83u6Ls2B_mVcEpVoiq-iw.png"/></div></div></figure><p id="ae84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果显示，真正的死亡概率在15%左右(我提醒你，取的数据是意大利的)。此外，典型的死亡时间约为4天，而相应的恢复值为31天。</p><h2 id="059e" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">预测动态</h2><p id="d8bf" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">有了描述概率的参数，我们可以预测死亡和复苏的数量，并将其与真实的历史数据进行比较:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lo"><img src="../Images/a213bba92890c5d37b692db6cf38aa90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l5Jsa8MunCtgVACKFmZKsw.png"/></div></div></figure><p id="7d10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将预测延伸到未来，我们可以得到预期的死亡总数:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lp"><img src="../Images/209d5a60466e09e01a7ee68eec4c5f8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*90cxPogMspwQDfRTGW-yqQ.png"/></div></div></figure><p id="526f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，在意大利，预计总死亡人数约为2万。</p><p id="e0c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为最后一步，我们可能希望看到积极的情况下的动态预测。结合我们所有的数据，我们可以得到这样的结果:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lq"><img src="../Images/c3618812939f1cc129f53672803bf07a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zt8Mn3RsvB4Pm9gFSRIP8Q.png"/></div></div></figure><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lr"><img src="../Images/132d43f7827ca650fa63784eab503a8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vaFbQbdqK3PtjIQKCnQR8g.png"/></div></div></figure><p id="6296" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它表明真正的高峰将在4月5日左右到来，这很快。</p><h2 id="6c8c" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">其他国家</h2><p id="62db" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">此外，我还尝试在其他几个国家运行它，这就是我得到的结果:</p><ul class=""><li id="690f" class="kw kx hi ih b ii ij im in iq ky iu kz iy la jc lb lc ld le bi translated">西班牙——预计约有2.4万人死亡。高峰在4月2日左右</li><li id="2fa4" class="kw kx hi ih b ii lj im lk iq ll iu lm iy ln jc lb lc ld le bi translated">德国——预计死亡人数约为1500人。高峰在4月2日左右</li></ul><h2 id="4d0d" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">摘要</h2><p id="198f" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">在这两篇文章中，我们对新冠肺炎动态做了一个天真的描述和预测。未来会证明它有多好。最有可能的是，真实的数字会有所不同，但我不指望会有数量级的差异。真正的预测是困难的，真正的流行病的动态强烈地依赖于所采取的措施，依赖于测试策略，依赖于地理，等等。所有这些因素都是随时间变化的，无法用数学模型完全描述。但是仍然可以用有限的资源在短时间内完成一些粗略的估计。</p></div></div>    
</body>
</html>