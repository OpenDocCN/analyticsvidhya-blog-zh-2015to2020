<html>
<head>
<title>YAiM — Yet Another iMessage Mining</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">YAiM——又一个iMessage挖掘</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/https-medium-com-gss-yaim-yet-another-imessage-mining-1bb0d812b002?source=collection_archive---------1-----------------------#2019-01-26">https://medium.com/analytics-vidhya/https-medium-com-gss-yaim-yet-another-imessage-mining-1bb0d812b002?source=collection_archive---------1-----------------------#2019-01-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="2c34" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">TLDR:是的，我用Python分析了我和我最好朋友的iMessage对话。但我保证不止如此。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/1d146ef127eb5ea647d61cfadb24a35d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mTGkB8ITENN44AYi0JON9g.jpeg"/></div></div></figure><p id="097f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi kf translated"><span class="l kg kh ki bm kj kk kl km kn di"> B </span>在我进入编码部分之前，这里有一个简短的背景故事，关于我如何最终试图掌握使用Python分析iMessage上的对话的复杂艺术…</p><p id="1b8a" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我一直是那种不喜欢做礼物的人。不管是圣诞节、你的生日，还是你刚刚生了一个孩子；我不会给你买任何东西。郑重声明，这不代表我不喜欢/不爱你。我不喜欢的另一件事是收到礼物。我有时觉得我不需要它，或者它只是增加了混乱…但我不是愚蠢的女孩。如果你带着一包哈里波的令人兴奋的Goldbä ren或一块好巧克力来，我会感到飘飘然。</p><p id="67a6" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我为什么要告诉你这些？我最好的朋友在12月满25岁，我觉得应该送他一份生日礼物——但我不知道具体是什么。我在Illustrator中为他设计一些东西和跑到最近的书店买我看到的第一本书之间摇摆不定。但我想到，如果我最终设法将我的一些Python和数据仓库技能结合起来，我将能够对我们在iMessage上的对话进行某种分析。</p><p id="9388" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">就这样开始了。</p></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h1 id="8174" class="kv kw hi bd kx ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">你到底是怎么…</h1><h2 id="faab" class="ln kw hi bd kx lo lp lq lb lr ls lt lf js lu lv lh jw lw lx lj ka ly lz ll ma bi translated">…查看您的iMessage短信？！</h2><p id="5606" class="pw-post-body-paragraph jj jk hi jl b jm mb ij jo jp mc im jr js md ju jv jw me jy jz ka mf kc kd ke hb bi translated">在阅读了许多文章和博客后，我花了几个小时才弄明白这一点。你可以在这里找到最有用的棋子<a class="ae mg" href="https://apple.stackexchange.com/questions/321521/can-i-access-contact-names-in-chat-db" rel="noopener ugc nofollow" target="_blank">，在这里</a>找到<a class="ae mg" href="http://osxdaily.com/2010/07/08/read-iphone-sms-backup/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="2ff3" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">首先，我在我所有的苹果设备上同步了我的短信。我是这样做的。这样做之后，名为<code class="du mh mi mj mk b">chat.db</code>的文件就自动在我的Mac上创建了。那个文件是苹果保存你所有iMessage数据的地方。这是文件的路径:<code class="du mh mi mj mk b">~/Library/Message</code>。</p><p id="a442" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我发现在<code class="du mh mi mj mk b">chat.db</code>中访问数据的最简单的方法之一是使用SQLite  (DB4S)的<em class="ml"> DB浏览器。DB4S允许您添加、删除和浏览数据库中的记录，还有其他功能。你可以在这里下载<a class="ae mg" href="https://github.com/sqlitebrowser/sqlitebrowser" rel="noopener ugc nofollow" target="_blank">。很安全，我保证。</a></em></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mm"><img src="../Images/35de51e17b7978fe689234cefae81695.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IU73dKzNiRfaB1V2yHBp-A.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">chat.db已加载到SQLite的db浏览器中</figcaption></figure><p id="0f75" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如果您想做同样的事情并使用DB4S检索数据，下面是一个简短的分步指南。</p><ol class=""><li id="113a" class="mr ms hi jl b jm jn jp jq js mt jw mu ka mv ke mw mx my mz bi translated">运行DB4S</li><li id="caf8" class="mr ms hi jl b jm na jp nb js nc jw nd ka ne ke mw mx my mz bi translated">点击<em class="ml">打开数据库</em>并加载<code class="du mh mi mj mk b">chat.db</code></li><li id="82b4" class="mr ms hi jl b jm na jp nb js nc jw nd ka ne ke mw mx my mz bi translated">点击<em class="ml">浏览数据</em>并从下拉菜单中选择<em class="ml">消息</em>。</li><li id="591e" class="mr ms hi jl b jm na jp nb js nc jw nd ka ne ke mw mx my mz bi translated"><em class="ml">文本</em>栏包含您发送和接收的所有文本的预览。查看该列，确定您想要分析的文本，并从从左到右的第六列获得<em class="ml"> handle_id </em>。记住那个数字。你以后会用到它。</li><li id="1336" class="mr ms hi jl b jm na jp nb js nc jw nd ka ne ke mw mx my mz bi translated">点击<em class="ml">执行SQL </em>并运行以下代码:</li></ol><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nf ng l"/></div></figure><p id="a383" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">6.一旦运行它，您将看到下面的输出。将其导出为<code class="du mh mi mj mk b">csv</code>和……<em class="ml">瞧</em>！</p><h2 id="94c0" class="ln kw hi bd kx lo lp lq lb lr ls lt lf js lu lv lh jw lw lx lj ka ly lz ll ma bi translated">…阅读。Python中的csv？！</h2><p id="c763" class="pw-post-body-paragraph jj jk hi jl b jm mb ij jo jp mc im jr js md ju jv jw me jy jz ka mf kc kd ke hb bi translated">我在我的JupyterLab中导入了所有必需的包，并阅读了<code class="du mh mi mj mk b">csv</code>。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nf ng l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nh"><img src="../Images/73b77d2f500d4cb2bfd677cb7eeb3a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H40qIiV96tCjCZ3bDo8s7Q.png"/></div></div></figure><p id="4da7" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">哇！这是数据帧前四行的预览。<code class="du mh mi mj mk b">text</code>包括所有交换过的信息——是的，那是西班牙语——，<code class="du mh mi mj mk b">is_from_me</code>表示是我(1)还是其他人(0)发送的信息，<code class="du mh mi mj mk b">Date</code>给出了信息发送的时间。您可能注意到了，日期不是人类可读的格式。我必须改变这一点。</p><h2 id="6e93" class="ln kw hi bd kx lo lp lq lb lr ls lt lf js lu lv lh jw lw lx lj ka ly lz ll ma bi translated">…处理那些日期？！</h2><p id="8ba5" class="pw-post-body-paragraph jj jk hi jl b jm mb ij jo jp mc im jr js md ju jv jw me jy jz ka mf kc kd ke hb bi translated">我会说这是最耗时的。我不得不浏览大量的博客、文章和软件文档，想出一个简单的方法来格式化<code class="du mh mi mj mk b">Date</code>列。你可以在这里<a class="ae mg" href="https://stackoverflow.com/questions/10746562/parsing-date-field-of-iphone-sms-file-from-backup" rel="noopener ugc nofollow" target="_blank">这里</a><a class="ae mg" href="https://www.timeanddate.com/date/durationresult.html?d1=1&amp;m1=1&amp;y1=1970&amp;d2=1&amp;m2=1&amp;y2=2001&amp;h1=0&amp;i1=0&amp;s1=0&amp;h2=0&amp;i2=0&amp;s2=0" rel="noopener ugc nofollow" target="_blank">这里</a><a class="ae mg" href="https://cr.yp.to/libtai/tai64.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到帮我解决这个<a class="ae mg" href="https://stackoverflow.com/questions/1832714/18-digit-timestamp" rel="noopener ugc nofollow" target="_blank">的文章。</a></p><p id="9e02" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">长话短说:显然，苹果使用Mac绝对时间(MacTime)来表示自2001年1月1日起的<em class="ml">纳秒</em>，而不是基于Unix的自1970年1月1日起的<em class="ml">秒</em>的其他类型的日期。在整整四个小时毫无意义的阅读和编写代码之后，我最终将最初的MacTime日期除以1，000，000，000，转换成秒。我还添加了978，307，200秒(31年)，因为一旦日期转换为UnixTime，就会缺少31年(2001年1月1日-1970年1月1日)。以下是一步一步的步骤:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nf ng l"/></div></figure><h2 id="3102" class="ln kw hi bd kx lo lp lq lb lr ls lt lf js lu lv lh jw lw lx lj ka ly lz ll ma bi translated">…开始分析文本？！</h2><p id="3b7e" class="pw-post-body-paragraph jj jk hi jl b jm mb ij jo jp mc im jr js md ju jv jw me jy jz ka mf kc kd ke hb bi translated">在开始分析文本之前，我必须对数据框架做一些调整:识别发送者(G &amp; L)，删除不必要的行和列，等等。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nf ng l"/></div></figure><p id="7669" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我继续创建了一个列来表示每条消息中的字数，另一个列包括每条消息中的字符数。我还把单词改成了小写，以避免重复计算。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nf ng l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ni"><img src="../Images/95274f6fefc8fefd83fd10a97ffe9d02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VFqmSraSyD6BblLx0R5jMg.png"/></div></div></figure><p id="e97d" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">准备好数据框架后，我开始做一些探索性的数据分析。我将数据帧按<code class="du mh mi mj mk b">is_from_me</code>列分组，看看哪个发送者使用了更多的字符和单词。我是这样编码的:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nf ng l"/></div></figure><p id="7f42" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">哪一天发送的消息最多？</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nf ng l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nj"><img src="../Images/5872976369fc4c6b29670f0ebe75e175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IJFTjQHNbW0ZkN6q6d5ssA.png"/></div></div></figure><p id="be8e" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">最常发送的信息是什么？</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nf ng l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nk"><img src="../Images/87b6352dc79a20643d85d0ed74627785.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0lzAp1hMAhWTQjzEzHSHBg.png"/></div></div></figure><p id="b84a" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">然后我创建了一个函数，调用任何单词作为输入，并返回每个发送者说这个单词的次数。第一个功能——<code class="du mh mi mj mk b">iWantToCountWords</code>——要求用户键入一个单词。第二个是<code class="du mh mi mj mk b">count</code>——统计并绘制每个发送者说这个词的次数。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nf ng l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nl"><img src="../Images/89454ba045625631744a6a5b428dd2a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sh6tI-VABuM7_ptPBh88TQ.png"/></div></div></figure><p id="1947" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">但是如果一个人想在一定的时间范围内计算和绘制一个单词呢？首先，我定义了一个函数，它需要一个单词、一个开始日期和一个结束日期作为输入。这个函数是<code class="du mh mi mj mk b">iWantToCountWordsInTime</code>，它返回第二个函数——<code class="du mh mi mj mk b">countDate</code>——进行计数和绘图。对于第二个函数，我使用了一个掩码来根据选择的日期过滤<code class="du mh mi mj mk b">g</code>和<code class="du mh mi mj mk b">l</code>数据帧。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nf ng l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nm"><img src="../Images/8f060f2dfd710e8b644ff9f9d5235ac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZItyWhAIdEbFWmWGjpn0KA.png"/></div></div></figure><p id="00c5" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">对像这样的数据集进行更深入的分析还有很大的空间。如果对话包括两个以上的人，可以查看对话动态、谁回复谁的网络分析、探索消息的情感、识别主题等。</p><p id="3428" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">现在，如果你决定开始分析你的iMessage数据，我希望这篇教程能帮助你理解如何检索数据和处理那些乱七八糟的MacTime日期。</p><p id="3b2b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">黑客快乐！</p></div></div>    
</body>
</html>