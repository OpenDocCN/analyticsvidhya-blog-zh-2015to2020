<html>
<head>
<title>Classification of Chest-Xrays using PyTorch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PyTorch对胸部x射线进行分类</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/classification-of-chest-xrays-using-pytorch-d50eddd9ebb0?source=collection_archive---------6-----------------------#2020-06-29">https://medium.com/analytics-vidhya/classification-of-chest-xrays-using-pytorch-d50eddd9ebb0?source=collection_archive---------6-----------------------#2020-06-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/eda3b803c99e780d4012af9abe56a227.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NlzSMftqZs69Rg3L"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">亚当·尼西奥鲁克在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="f602" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">肺炎是一种单侧或双侧肺部感染。细菌、病毒和真菌导致它。这种感染会导致肺部气囊发炎，这些气囊被称为肺泡。肺泡充满液体或脓，使呼吸困难。</p><p id="8750" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">新冠肺炎(冠状病毒疾病2019)是由严重急性呼吸综合征冠状病毒2型(新型冠状病毒)引起的高度传染性疾病。</p><p id="5a1c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">【COVID的胸部X线影像学新冠肺炎的胸部X线影像学特征为非典型肺炎或机化性肺炎。这意味着新冠肺炎病和肺炎之间的区别是微妙的。尽管它们都有肺实变的特征(通常充满肺部小气道的空气被其他东西取代。根据病因的不同，空气可能被替换为:液体，如脓、血或水。(胸部X线片上的实变表现为“白肺”区)，毛玻璃样阴影(肺看起来有一层灰色玻璃状和无光泽的贴面))但在新冠肺炎病中，胸腔积液是罕见的(3%)。胸片上肺实变的分布似乎是双侧的、周围的，在新冠肺炎更多的是在下叶。</p><p id="f955" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">胸腔积液是胸腔壁和肺部之间的积液。像肺实变一样，在胸部x光片上，它看起来像白色区域，与较暗的充满空气的肺相对。由于积液是一种相对开放空间内的流体，当你改变位置时，它通常会因重力而移动。</p><p id="cd39" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">肺实变也可能是流体，但它在你的肺里面，所以当你改变位置时它不能移动。这是你的医生区分两者的一种方式。</p><p id="b155" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最终，根据疾病控制中心(CDC)的说法，即使胸部CT或X射线显示新冠肺炎，病毒检测也是诊断的唯一具体方法。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jt"><img src="../Images/c5e83ac6faeaef75bd150d8d25d2a527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7b8kovqIQjaciqLv.png"/></div></div></figure><p id="bfd6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在最上面一行，“白肺”区域(实变)位于新冠肺炎两肺的下叶或部分区域(也更靠近边缘(为了清晰起见，请查看最上面一行的第三张图像)。)</p><p id="f6e6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，在其他类型的肺炎中，实变似乎更为普遍。</p><p id="1d39" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">数据集</strong></p><p id="1e88" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">数据被组织到2个文件夹(训练、测试)中，训练和测试都包含3个子文件夹(COVID19、肺炎、正常)。该数据包含总共6432张x射线图像，测试数据占总图像的20%。</p><p id="c319" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们导入以下相关的库</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="6451" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Kaggle平台用于这项工作。让我们加载数据并从数据中创建数据集。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="5cdd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过将train_dir文件夹传递给ImageFolder函数，创建并转换了Pytorch数据集。然后使用变换参数对其进行变换。在这里，我调整了它们的大小以加快训练时间，将它们转换为张量，并使用数据集的平均值和标准差对它们进行归一化。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="a714" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们看几张图片。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="ee66" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们想象一下这些图像</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="807c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里的<strong class="ix hj"> showexample </strong>函数中，我们必须对图像的维度进行重新排序，使通道数成为我们使用matplotlib库的最后一个通道。</p><p id="a293" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将通过应用种子生成器和random_split函数，将train_dir文件夹中的训练数据集拆分为训练集和验证集。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="2bb4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我需要使用RandromCrop、RandomHorinzontalFlip和ColorJitter对训练集进行一些额外的转换，以创建额外的特征供我的图像分类器学习。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="4b49" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">确定train变量中存在的类的计数的函数</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="36f9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">数据集似乎不平衡。因此，我们将使用WeightedRandomSampler对少数类进行过采样。计算权重并将其传递到上面的采样器中，然后将训练数据和验证数据传递到各自的数据加载器函数中。我将batch_size设置为28，以防止使用Kaggle内核的会话崩溃。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="7643" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们已经准备好了数据加载器，我们可以定义我们的模型和一些用于训练、验证和预测准确性的辅助函数。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="7098" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们借助一些辅助函数将选定的模型传输到GPU。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="3e8b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在上面的单元格中，模型、训练集和验证集被传递到DeviceDataLoader中</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="7676" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以看到一批28，3 x 128 x128的输入，得到28，3的输出。对于28个输入图像中的每一个，我们得到3个输出，每个类一个。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="024a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">拟合函数的超参数被传递到优化函数中，模型被训练和验证四个时期，损失和验证精度被记录。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="3645" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我做的卷积神经网络的验证精度是0.6762。我训练了其他模型(Resnet-50，Resnet-101(0.6491，0.6638)。</p><p id="cb1d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Resnet-18、wide-resnet-101和alexnet的表现非常糟糕，平均准确率为20%。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="5832" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里验证损失比训练损失高得多，但是随着重量衰减和梯度剪辑的使用，验证损失开始下降。</p><p id="8a38" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">观察到Res-nets变化比卷积神经网络具有更高的验证损失。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">表现不佳的wide res-net的培训和验证损失101</figcaption></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">表现良好的resnet-50的训练和验证损失(使用CNN val_acc作为基准)</figcaption></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="5886" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们做一些预测，好吗？测试数据被转换并传递到数据加载器中。然后调用一个辅助函数来帮助我们进行预测。请注意，测试准确度分数与验证准确度分数接近。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="45a4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，我们看到了预测肺炎的模型，而实际类别是新冠肺炎，这可能是因为肺炎患者和新冠肺炎患者的胸部x光片之间只有细微的变化。</p><p id="7755" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在不久的将来，我想使用一个集合模型来提高性能(我目前正在研究一个集合模型，但Kaggle和Google Colab会话一直崩溃)。我还会尝试使用暗网分类器和对象检测框架(YOLO)的图像分割技术(在<a class="ae iu" href="https://github.com/muhammedtalo/COVID-19" rel="noopener ugc nofollow" target="_blank">https://github.com/muhammedtalo/COVID-19</a>有售)</p><p id="cb18" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是了。我会很快发布这个分类任务的更新。</p><h1 id="1113" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated"><strong class="ak">参考文献</strong></h1><p id="8827" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated"><a class="ae iu" href="https://www.healthline.com/health/lung-consolidation#vs.-pleural-effusion)" rel="noopener ugc nofollow" target="_blank">https://www . health line . com/health/lung-consolidation # vs .-胸膜腔积液</a></p><p id="4a12" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">沙科迪·BD、Kwadwo Osei-Poku2和Edmund Brakohiapa(2020年)</p><p id="ba78" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">https://medical-case-reports . imed pub . com/diagnosing-covid 19-from-chest-x ray-in-resource-limited-environment case-report . pdf</p></div></div>    
</body>
</html>