<html>
<head>
<title>Machine Learning for Winning Algorithm Trading? It probably doesn’t work.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">赢算法交易的机器学习？很可能没用。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/machine-learning-for-winning-algorithm-trading-it-probably-doesnt-work-c0b11f801d34?source=collection_archive---------10-----------------------#2020-11-24">https://medium.com/analytics-vidhya/machine-learning-for-winning-algorithm-trading-it-probably-doesnt-work-c0b11f801d34?source=collection_archive---------10-----------------------#2020-11-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1f43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">至少对于我在这篇文章中使用的LSTM。</p><p id="fa84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大多数机器学习算法都只是一种回归模型。也就是说，当机器学习算法试图预测未来时，它们会预测一个趋势，同时假设任何与趋势的偏离都会逆转。当应用平方误差族中的损失函数时，情况尤其如此。</p><p id="71de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了对此有一个直观的理解，让我们看一个例子。假设信号周围有随机噪声。灰线或黄线将受到损失函数的严重惩罚，因为数据和预测之间的平方差将很高。只有中间的橙色线被认为是更好的“适合”。就预测均值而言，这不一定是坏的，但它能产生有意义的完整交易信号吗？</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/1b3e11ecfcc2ba6e4b1959562dcb4eaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b_S5_D6vnJ_VtUNsbCt5EQ.png"/></div></div></figure><p id="74c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将使用LSTM模型来预测标准普尔500指数的ETF SPY的未来价格。我还将尝试评估该预测是否能产生可交易的盈利信号。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="5e13" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">密码</h1><p id="ace2" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">在这一节中，我将解释我所使用的数据和代码。我使用python和VS代码来实现我的分析。我非常详细地解释了一切。如果你不想麻烦编码，请随意跳过这一部分。</p><p id="3f51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae la" href="https://github.com/xieyutongcn/LSTM_DONT_WORK" rel="noopener ugc nofollow" target="_blank"> Github在此。</a></p><p id="02e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是我使用的库:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lb"><img src="../Images/546fb7742d3eeb51f68738c04346e2be.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*YbP2g1mPWokm3O2t-noh4Q.png"/></div></figure><p id="f52c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，下载每日数据，并保留每天的收盘价:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lc"><img src="../Images/446b119a2ce87341916403ae54e70d47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bz5r2HS6XeTXYEPJn7_ZWA.png"/></div></div></figure><p id="6876" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为我试图预测指数，我会包括至少1个完整的经济周期。SPY于1990年首次推出，这让它经历了2次(网络泡沫和08年金融危机)。2000年是网络泡沫的开始。如果你想自己试试这个，其实可以从《间谍》开始。</p><p id="5fde" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该数据有5221行，这意味着有5221个交易日，1列是收盘价。</p><p id="72ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其次，我将数据分为训练集和测试集。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ld"><img src="../Images/edf98451c6210dab00fd7eb884b9db13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ujzCYpQWtBacDQv5dgYIiQ.png"/></div></div></figure><p id="14cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在选择训练集时，我使用整个样本的前80%。这条线</p><blockquote class="le lf lg"><p id="d38f" class="if ig kz ih b ii ij ik il im in io ip lh ir is it li iv iw ix lj iz ja jb jc hb bi translated">training _ data _ len = math . ceil(len(dataset)* 0.8)</p></blockquote><p id="6a1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">告诉我们不小于数据长度80%的最小整数(总共5221行)。0.8x 5221 = 4176.8。不小于4，176.8的最小整数是4，177，因此该表达式给出了定型数据的长度-4，177。所以从第4178次观察到最后，5221次将是我们的测试集。</p><p id="41a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我有一个名为<em class="kz"> pstep，</em>的变量，它代表我们希望预测多少天后的价格。</p><p id="04a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当在训练数据集中构造x和y变量时，该步骤还涉及一个循环。代码的基本原理如下:对于某一天的每个收盘价，我想使用前60天的收盘价来预测它。如果数据是按历史顺序组织的，并且pstep = 0，则前60个观察值应该预测第61个观察值，第2到61个观察值应该预测第62个观察值，依此类推。索引I应该从60到训练数据的末尾。每列应该有60行，每个单元格有1个值，即收盘价。</p><p id="84b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们需要重塑数据，因为LSTM期望数据是三维的——样本数乘以时间步长数乘以特征数。时间步长的数量是60，特征的数量是1。样本的数量基本上就是我们可以做多少次重复来做预测。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lk"><img src="../Images/8c57341d38c65e2606c9f1d7a7489994.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*genQ9eDdVxF5m8fNC47XfA.png"/></div></div></figure><p id="089c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我需要建立模型，编译模型，估计参数(拟合模型)。我挑选的神经元数量微不足道。10或100个神经元的结果在性质上是相同的。我真的太适合这里了。如果我过度拟合，那么结果将是非常具体的样本。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ll"><img src="../Images/bc02fc4c9f192239c007612b33bbd224.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9uYAj0gteOlheXmX1hruUg.png"/></div></div></figure><h1 id="402f" class="jw jx hi bd jy jz lm kb kc kd ln kf kg kh lo kj kk kl lp kn ko kp lq kr ks kt bi translated">结果可视化</h1><p id="16ee" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">所以我在这张图上画出了预测值和实现值的时间序列。我使用pstep=15，这意味着我使用之前的60天来预测15天后的价格。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lr"><img src="../Images/6b8e1cbae1302943b91f535611ac7339.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oPj5ABvvRJRx4QaqKO8QOA.png"/></div></div></figure><p id="600a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我相信这在大多数LSTM的文章中都可以看到。如果放大验证期间，您会看到模型在某些期间高估，而在其他期间低估。由于均方误差损失函数，这使得模型“平均”预测未来罚款。</p><p id="50eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下图中，我绘制了15天后的实际价格和15天后的预测价格以及当前收盘价。我正在看第一个100 obs。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/712e3f0f2b13b52cd74aa930f4ac90d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UnCYm12nYvmc7At8OWtw7A.png"/></div></div></figure><p id="9370" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果绿线和橙线都在蓝线之上，那么预测值和未来值都在当前价格之上。相应地，我们可以在当前价格买入股票，持有15天并获得利润。如果绿线在蓝线之上，而橙线在蓝线之下，那么如果我们按照橙线交易，我们就会亏钱；反之亦然。如果你检查图表，大多数时候我们都会错。</p><h1 id="894a" class="jw jx hi bd jy jz lm kb kc kd ln kf kg kh lo kj kk kl lp kn ko kp lq kr ks kt bi translated">裁决</h1><p id="b6bc" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">感谢您的阅读！我希望我们都理解模型预测，以及什么是更好地预测回报。</p></div></div>    
</body>
</html>