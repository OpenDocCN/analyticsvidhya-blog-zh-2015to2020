<html>
<head>
<title>Connecting Drill to python on Mac &amp; Windows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Mac和Windows上将Drill连接到python</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/connecting-drill-to-python-on-mac-windows-aaed59ad9385?source=collection_archive---------5-----------------------#2020-02-19">https://medium.com/analytics-vidhya/connecting-drill-to-python-on-mac-windows-aaed59ad9385?source=collection_archive---------5-----------------------#2020-02-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/eb03db46e297f6cf7814b01689052e9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/0*_ikp6024SA7TgBsc.jpg"/></div></figure></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><h1 id="2d0a" class="it iu hi bd iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq bi translated">介绍</h1><p id="79fe" class="pw-post-body-paragraph jr js hi jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">Apache Drill是一个支持大规模数据集交互分析的软件框架。几个数据库可以连接到Drill，所有这些数据库都可以通过python脚本访问。这篇博客描述了如何使用ODBC驱动程序在Drill和python之间建立连接。</p></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><h2 id="a861" class="kp iu hi bd iv kq kr ks iz kt ku kv jd kc kw kx jh kg ky kz jl kk la lb jp lc bi translated">步骤1:下载和安装</h2><p id="768c" class="pw-post-body-paragraph jr js hi jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">从提供的链接下载并安装最新的ODBC驱动程序→<a class="ae ld" href="http://package.mapr.com/tools/MapR-ODBC/MapR_Drill/" rel="noopener ugc nofollow" target="_blank">http://package.mapr.com/tools/MapR-ODBC/MapR_Drill/</a></p><p id="02f7" class="pw-post-body-paragraph jr js hi jt b ju le jw jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko hb bi translated">当我们从python访问ODBC连接时，还需要下载和安装一些python包。必备包是pyodbc。要安装这些软件包，请在终端上使用以下命令</p><blockquote class="lj lk ll"><p id="9adb" class="jr js lm jt b ju le jw jx jy lf ka kb ln lg ke kf lo lh ki kj lp li km kn ko hb bi translated">pip安装pyodbc</p></blockquote><h2 id="4c46" class="kp iu hi bd iv kq kr ks iz kt ku kv jd kc kw kx jh kg ky kz jl kk la lb jp lc bi translated"><strong class="ak">第二步:ODBC的配置</strong></h2><p id="1033" class="pw-post-body-paragraph jr js hi jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">一旦安装了所有必需的包，就需要配置ODBC驱动程序。对于mac和windows，ODBC驱动程序的配置有所不同。虽然交互式GUI可用于windows，但在mac上，odbc.ini文件需要手动配置。无论使用哪种操作系统，下面都给出了设置说明。</p><p id="caae" class="pw-post-body-paragraph jr js hi jt b ju le jw jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko hb bi translated"><strong class="jt hj">在窗户上</strong></p><p id="4c72" class="pw-post-body-paragraph jr js hi jt b ju le jw jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko hb bi translated">在windows系统的情况下，可以下载ODBC管理器，用于GUI附带的配置。它简化了这个过程，但是仍然有一些细节需要注意。</p><p id="1646" class="pw-post-body-paragraph jr js hi jt b ju le jw jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko hb bi translated">安装后，ODBC数据源管理器如下所示:</p><figure class="lr ls lt lu fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/ea1c269e9c8231f0a4468a390d2509af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*kSKe1bTy5cXUe3oddP1hKg.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">ODBC管理器</figcaption></figure><p id="bdc7" class="pw-post-body-paragraph jr js hi jt b ju le jw jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko hb bi translated">要连接到特定数据库，请在上面的选项卡中选择系统DSN，并找到MapR Drill数据源，如果还不可用，则通过提供驱动程序详细信息来添加它。要配置设置，请选择配置选项。</p><figure class="lr ls lt lu fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/14f2d38debf8c076588d79bd16c2fb72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*c0T7DTssG-389_aaWMidnA.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">添加连接</figcaption></figure><p id="9fc9" class="pw-post-body-paragraph jr js hi jt b ju le jw jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko hb bi translated">DSN设置窗口如下所示，当连接到现有的MapR数据库时，选择连接类型为Zookeeper，并提供Quorum和Cluster_id的详细信息。当使用LDAP用户id时，选择身份验证类型为plain，这提供了输入用户和密码的选项。现在测试连接，如果一切正常，你就成功了。</p><figure class="lr ls lt lu fd ij er es paragraph-image"><div class="er es lz"><img src="../Images/63e5c556543f50936a26fded9f043936.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*5cV206mlbA9qcOdlHFy-HQ.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">配置和测试连接</figcaption></figure><p id="0ee8" class="pw-post-body-paragraph jr js hi jt b ju le jw jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko hb bi translated"><strong class="jt hj">在Mac上</strong></p><p id="102a" class="pw-post-body-paragraph jr js hi jt b ju le jw jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko hb bi translated">应该在Mac上手动更改文件系统以进行配置。在我们连接到Mac OS X上的ODBC客户端工具Drill through之前，驱动程序安装程序在<strong class="jt hj">/Library/mapr/Drill/Setup</strong>中有以下配置文件。将下面提到的文件复制到您的主目录中，除非这些文件已经存在于您的主目录中(有时这些文件已经在安装过程中复制到主目录中):</p><ul class=""><li id="eed2" class="ma mb hi jt b ju le jy lf kc mc kg md kk me ko mf mg mh mi bi translated">mapr.drillodbc.ini</li><li id="2967" class="ma mb hi jt b ju mj jy mk kc ml kg mm kk mn ko mf mg mh mi bi translated">odbc.ini</li><li id="bdd9" class="ma mb hi jt b ju mj jy mk kc ml kg mm kk mn ko mf mg mh mi bi translated">odbcinst.ini</li></ul><p id="fe2f" class="pw-post-body-paragraph jr js hi jt b ju le jw jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko hb bi translated">不需要对位置/Library/mapr/drill/Setup中的ini文件进行任何更改。对主目录中的隐藏ini文件进行了以下所有更改。</p><p id="01e9" class="pw-post-body-paragraph jr js hi jt b ju le jw jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko hb bi translated">在你的<strong class="jt hj">主目录</strong>中，将文件重命名为<strong class="jt hj">隐藏文件</strong>。如有必要，使用sudo:</p><ul class=""><li id="fe2d" class="ma mb hi jt b ju le jy lf kc mc kg md kk me ko mf mg mh mi bi translated">. mapr.drillodbc.ini</li><li id="5ef7" class="ma mb hi jt b ju mj jy mk kc ml kg mm kk mn ko mf mg mh mi bi translated">. odbc.ini</li><li id="e959" class="ma mb hi jt b ju mj jy mk kc ml kg mm kk mn ko mf mg mh mi bi translated">. odbcinst.ini</li></ul><p id="2e93" class="pw-post-body-paragraph jr js hi jt b ju le jw jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko hb bi translated">注意，在用户主文件夹中应该有三个隐藏的配置文件(ini文件)。以下应该是. odbc.ini中带有各自用户名和密码的文件的内容，其余内容应该保持原样，不做任何更改。</p><ol class=""><li id="df18" class="ma mb hi jt b ju le jy lf kc mc kg md kk me ko mo mg mh mi bi translated">. mapr.drillodbc.ini →</li></ol><pre class="lr ls lt lu fd mp mq mr ms aw mt bi"><span id="c7b4" class="kp iu hi mq b fi mu mv l mw mx">## - Note that this default DriverManagerEncoding of UTF-32 is for iODBC.<br/>## DriverManagerEncoding=UTF-32<br/>DisableAsync=0<br/>ErrorMessagesPath=/Library/mapr/drill/lib<br/>LogLevel=0<br/>LogPath=<br/>SwapFilePath=/tmp</span></pre><p id="be71" class="pw-post-body-paragraph jr js hi jt b ju le jw jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko hb bi translated">2.. odbcinst.ini →</p><pre class="lr ls lt lu fd mp mq mr ms aw mt bi"><span id="7fe1" class="kp iu hi mq b fi mu mv l mw mx">MapR Drill ODBC Driver=Installed</span><span id="cf95" class="kp iu hi mq b fi my mv l mw mx">[MapR Drill ODBC Driver]<br/>Description=MapR Drill ODBC Driver<br/>Driver=/Library/mapr/drill/lib/libdrillodbc_sbu.dylib<!-- --> </span></pre><p id="fb23" class="pw-post-body-paragraph jr js hi jt b ju le jw jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko hb bi translated">3.. odbc.ini →不要忘记更改连接字符串、集群id、用户名和密码⚠️</p><pre class="lr ls lt lu fd mp mq mr ms aw mt bi"><span id="eb67" class="kp iu hi mq b fi mu mv l mw mx">Trace=no</span><span id="10ed" class="kp iu hi mq b fi my mv l mw mx">[ODBC Data Sources]<br/>MapR Drill=MapR Drill ODBC Driver</span><span id="471d" class="kp iu hi mq b fi my mv l mw mx">[MapR Drill]</span><span id="0fdd" class="kp iu hi mq b fi my mv l mw mx"># Description: DSN Description.<br/># This key is not necessary and is only to give a description of the data source.<br/>Description=MapR Drill ODBC Driver</span><span id="bbe8" class="kp iu hi mq b fi my mv l mw mx"># Driver: The location where the ODBC driver is installed to.<br/>Driver=/Library/mapr/drill/lib/libdrillodbc_sbu.dylib</span><span id="c8d1" class="kp iu hi mq b fi my mv l mw mx"># The DriverUnicodeEncoding setting is only used for MapRDM<br/># When set to 1, MapRDM runs in UTF-16 mode.<br/># When set to 2, MapRDM runs in UTF-8 mode.<br/>#DriverUnicodeEncoding=2</span><span id="739f" class="kp iu hi mq b fi my mv l mw mx"># Values for ConnectionType, AdvancedProperties, Catalog, Schema should be set here.<br/># If ConnectionType is Direct, include Host and Port. If ConnectionType is ZooKeeper, include ZKQuorum and ZKClusterID<br/># They can also be specified on the connection string.<br/># AuthenticationType: No authentication; Username; Plain; Kerberos; MapRSASL;<br/>ConnectionType=ZooKeeper<br/>HOST=<br/>PORT=<br/><strong class="mq hj">ZKQuorum= &lt;Your connection string&gt;<br/>ZKClusterID= &lt;ClusterID&gt;</strong><br/>AuthenticationType=Basic Authentication<br/><strong class="mq hj">UID=&lt;user_name&gt;<br/>PWD=&lt;ur_password_goes_here&gt;</strong><br/>DelegationUID=<br/>KrbServiceName=mapr<br/>KrbServiceHost=<br/>krbSpnConfigurationsRequired=1<br/>AdvancedProperties=CastAnyToVarchar=true;HandshakeTimeout=5;QueryTimeout=180;ExcludedSchemas=sys,INFORMATION_SCHEMA;TimestampTZDisplayTimezone=utc;NumberOfPrefetchBuffers=5;<br/>Catalog=DRILL<br/>Schema=<br/>SSL=0<br/>DisableHostVerification=0<br/>DisableCertificateVerification=0<br/>TrustedCerts=/Library/mapr/drill/lib/cacerts.pem<br/>UseSystemTrustStore=0<br/># The key, "UseExactTLSProtocolVersion", toggles between "Min_TLS" or "TLSProtocol".<br/># UseExactTLSProtocolVersion=1 indicates that the driver should use the exact TLS Protocol version to communicate with the drillbit.<br/># UseExactTLSProtocolVersion=0 indicates that the driver should use the minimum TLS Protocol version to communicate with the drillbit.<br/>UseExactTLSProtocolVersion=0<br/>Min_TLS=<br/>TLSProtocol=</span></pre><p id="6beb" class="pw-post-body-paragraph jr js hi jt b ju le jw jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko hb bi translated"><strong class="jt hj">第三步:测试连接</strong></p><p id="8d0a" class="pw-post-body-paragraph jr js hi jt b ju le jw jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko hb bi translated">复制粘贴以下函数连接到数据库，并以python dataframe的形式返回提取的数据。</p><p id="0bad" class="pw-post-body-paragraph jr js hi jt b ju le jw jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko hb bi translated">函数connect_drill接受要执行的查询作为输入，并返回一个dataframe，其中包含最终提取的数据。</p><pre class="lr ls lt lu fd mp mq mr ms aw mt bi"><span id="acad" class="kp iu hi mq b fi mu mv l mw mx"># with Drill<br/><strong class="mq hj"># Note that the query should NOT have ; at the end</strong></span><span id="95d6" class="kp iu hi mq b fi my mv l mw mx">def connect_drill(query):<br/>    import pyodbc</span><span id="3b97" class="kp iu hi mq b fi my mv l mw mx">    # initialize the connection<br/>    conn = pyodbc.connect("DSN=MapR Drill", autocommit=True)<br/>    cursor = conn.cursor()<br/>    <br/>    # fetch and display filtered output with column names<br/>    cursor.execute(query)<br/>    c = (cursor.fetchall())<br/>    for x in range(len(c)):<br/>        c[x] = list(c[x])</span><span id="9914" class="kp iu hi mq b fi my mv l mw mx">return (pd.DataFrame(c, columns = [column[0] for column in cursor.description]))</span></pre><p id="f49c" class="pw-post-body-paragraph jr js hi jt b ju le jw jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko hb bi translated">下面显示了一个查询示例，该查询提取的数据结果现在可以作为pandas数据帧使用。</p><pre class="lr ls lt lu fd mp mq mr ms aw mt bi"><span id="efa0" class="kp iu hi mq b fi mu mv l mw mx"><em class="lm"># Sample table extraction</em><br/>query =  """ SELECT week, <br/>                app,<br/>                SUM(num_opens) AS opens,<br/>                SUM(num_clicks) AS clicks<br/>          FROM members.activity<br/>          GROUP BY week,app"""<br/><br/>sample_table =  connect_drill(query)<br/>sample_table.head()</span></pre></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><h1 id="209b" class="it iu hi bd iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq bi translated"><strong class="ak">结论</strong></h1><p id="fb7c" class="pw-post-body-paragraph jr js hi jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">通过以上设置，在本地系统上，可以直接在jupyter笔记本上提取数据，或者通过任何形式的python/R脚本和python中可用的库来提取数据，这提供了数据操作的无限可能性。几个数据科学模型可以直接应用于容易提取的数据。</p></div></div>    
</body>
</html>