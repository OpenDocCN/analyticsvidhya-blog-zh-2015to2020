<html>
<head>
<title>Part 5.2 !! Pandas DataFrame to PostgreSQL using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第 5.2 部分！！使用 Python 将数据帧转换为 PostgreSQL</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/part-5-2-pandas-dataframe-to-postgresql-using-python-450607b763b4?source=collection_archive---------17-----------------------#2020-11-30">https://medium.com/analytics-vidhya/part-5-2-pandas-dataframe-to-postgresql-using-python-450607b763b4?source=collection_archive---------17-----------------------#2020-11-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="044d" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">用 Python 提取、转换和加载 PostgreSQL 数据</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/0b9f9246595e94fbfe82475c76257ced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t---AE1A1gcldaW8KNXoJw.png"/></div></div></figure><h1 id="f17f" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">先决条件</h1><p id="ac82" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated"><strong class="kd hj"> Python 3.8.3 : </strong> <a class="ae kx" href="https://www.anaconda.com/products/individual" rel="noopener ugc nofollow" target="_blank">蟒蛇下载链接</a></p><p id="c45e" class="pw-post-body-paragraph kb kc hi kd b ke ky ij kg kh kz im kj kk la km kn ko lb kq kr ks lc ku kv kw hb bi translated"><strong class="kd hj">PostgreSQL 13:</strong>T6<strong class="kd hj">T8】下载链接</strong></p><p id="0d80" class="pw-post-body-paragraph kb kc hi kd b ke ky ij kg kh kz im kj kk la km kn ko lb kq kr ks lc ku kv kw hb bi translated"><strong class="kd hj"> Psycopg2 : </strong>安装<strong class="kd hj"> Psycopg2 </strong>使用命令:<strong class="kd hj"> pip install psycopg2，petl </strong></p><h1 id="271b" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">目标</h1><p id="186c" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">通常，我们通过将 csv 文件导入 pandas 数据帧来创建训练和测试数据，但当我们在数据库服务器中存储大量数据时，我们需要一种方法来直接从数据库服务器将其提取到 pandas 数据帧中。为了这个目标，我们将一步一步地学习不同方法的工作代码。</p><h1 id="a0c0" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">步骤 1:导入库</h1><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="a426" class="li jk hi le b fi lj lk l ll lm"># import sys to get more detailed Python exception info<br/>import sys<br/># import the connect library for psycopg2<br/>import psycopg2<br/># import the error handling libraries for psycopg2<br/>from psycopg2 import OperationalError, errorcodes, errors<br/>import psycopg2.extras as extras<br/>from sqlalchemy import create_engine<br/>import pandas as pd</span><span id="3cbf" class="li jk hi le b fi ln lk l ll lm"># Extract Trabsforl &amp; Load<br/>import petl as etl</span></pre><h1 id="ad97" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">步骤 2:指定连接参数</h1><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="3b5b" class="li jk hi le b fi lj lk l ll lm"><strong class="le hj"># Note: please change your database, username &amp; password as per your own values<br/></strong>conn_params_dic = {<br/>    "host"      : "localhost",<br/>    "database"  : "irisdb",<br/>    "user"      : "postgres",<br/>    "password"  : "Passw0rd"<br/>}</span></pre><h1 id="70cb" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">第三步:支持功能</h1><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="9aab" class="li jk hi le b fi lj lk l ll lm"><strong class="le hj"><em class="lo"># Define a function that handles and parses psycopg2 exceptions</em><br/>def show_psycopg2_exception(err):</strong><br/>    <strong class="le hj"># get details about the exception</strong><br/>    err_type, err_obj, traceback = sys.exc_info()   <strong class="le hj"> <br/>    # get the line number when exception occured</strong><br/>    line_n = traceback.tb_lineno    <br/>    <strong class="le hj"># print the connect() error</strong><br/>    print ("\npsycopg2 ERROR:", err, "on line number:", line_n)<br/>    print ("psycopg2 traceback:", traceback, "-- type:", err_type) <br/>    <strong class="le hj"># psycopg2 extensions.Diagnostics object attribute</strong><br/>    print ("\nextensions.Diagnostics:", err.diag)   <strong class="le hj"> <br/>    # print the pgcode and pgerror exceptions</strong><br/>    print ("pgerror:", err.pgerror)<br/>    print ("pgcode:", err.pgcode, "\n")</span><span id="2725" class="li jk hi le b fi ln lk l ll lm"><strong class="le hj"><em class="lo"># Define a connect function for PostgreSQL database server</em><br/>def connect(conn_params_dic):</strong><br/>    conn = None<br/>    try:<br/>        print('Connecting to the PostgreSQL...........')<br/>        conn = psycopg2.connect(**conn_params_dic)<br/>        print("Connection successfully..................")<br/>        <br/>    except OperationalError as err:<br/>        <strong class="le hj"># passing exception to function</strong><br/>        show_psycopg2_exception(err)       <strong class="le hj"> <br/>        # set the connection to 'None' in case of error</strong><br/>        conn = None<br/>    return conn</span></pre><h1 id="3921" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">步骤 4:将 PostgreSQL 数据加载到 CSV 文件中:提取、转换和加载 PostgreSQL 数据</h1><p id="84b7" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">我们可以使用 petl 来提取、转换和加载 PostgreSQL 数据。在本例中，我们提取 PostgreSQL 数据，按物种列对数据进行排序，并将数据加载到一个 CSV 文件中。</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="edcf" class="li jk hi le b fi lj lk l ll lm"># Connecting to PostgreSQL Data<br/>conn = connect(conn_params_dic)</span><span id="3e81" class="li jk hi le b fi ln lk l ll lm"># Create a SQL Statement to Query PostgreSQL<br/>#sql = "SELECT * FROM iris WHERE species = 'testing'"<br/>sql = "SELECT * FROM iris "</span><span id="fbf7" class="li jk hi le b fi ln lk l ll lm">extractData = etl.fromdb(conn,sql)<br/> <br/>extractData.head()</span></pre><h1 id="1014" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">改变</h1><p id="de87" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">在这里，您可以在加载后对数据执行不同的运算。例如，您可以执行以下操作</p><ol class=""><li id="7624" class="lp lq hi kd b ke ky kh kz kk lr ko ls ks lt kw lu lv lw lx bi translated">连接表，</li><li id="6323" class="lp lq hi kd b ke ly kh lz kk ma ko mb ks mc kw lu lv lw lx bi translated">排序，</li><li id="c573" class="lp lq hi kd b ke ly kh lz kk ma ko mb ks mc kw lu lv lw lx bi translated">填充缺失值</li><li id="f63b" class="lp lq hi kd b ke ly kh lz kk ma ko mb ks mc kw lu lv lw lx bi translated">改造桌子等。</li></ol><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="c3fa" class="li jk hi le b fi lj lk l ll lm">transformData = etl.sort(extractData,'species')</span></pre><h1 id="be37" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">加载(写入数据)</h1><p id="3ccb" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">在所有的数据操作之后，现在可以将你的数据保存在你的磁盘中，以备报告或以后使用。</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="7237" class="li jk hi le b fi lj lk l ll lm">etl.tocsv(transformData,'../Learn Python Data Access/iris_v1.csv')</span></pre><p id="cda3" class="pw-post-body-paragraph kb kc hi kd b ke ky ij kg kh kz im kj kk la km kn ko lb kq kr ks lc ku kv kw hb bi translated"><strong class="kd hj">结论:</strong>我们的 5.2 部分到此结束。在本教程中，我们学习了如何提取、转换和加载数据。</p><p id="2c71" class="pw-post-body-paragraph kb kc hi kd b ke ky ij kg kh kz im kj kk la km kn ko lb kq kr ks lc ku kv kw hb bi translated">这篇文章的所有代码都可以作为 GitHub    <em class="lo">上的<a class="ae kx" href="https://github.com/Muhd-Shahid/Learn-Python-Data-Access/tree/main/PostgreSQL" rel="noopener ugc nofollow" target="_blank"> <strong class="kd hj"> <em class="lo"> Jupyter 笔记本获得。</em></strong></a></em></p><blockquote class="md me mf"><p id="258f" class="kb kc lo kd b ke ky ij kg kh kz im kj mg la km kn mh lb kq kr mi lc ku kv kw hb bi translated"><strong class="kd hj"> <em class="hi">以前的学习:</em> </strong></p><p id="5423" class="kb kc lo kd b ke ky ij kg kh kz im kj mg la km kn mh lb kq kr mi lc ku kv kw hb bi translated"><a class="ae kx" href="https://shahid-dhn.medium.com/pandas-dataframe-to-postgresql-using-python-part-1-93f928f6fac7" rel="noopener"> <strong class="kd hj">第一部分</strong> </a> <strong class="kd hj">:简介、连接&amp;数据库创建</strong></p><p id="9cbb" class="kb kc lo kd b ke ky ij kg kh kz im kj mg la km kn mh lb kq kr mi lc ku kv kw hb bi translated"><a class="ae kx" href="https://shahid-dhn.medium.com/pandas-dataframe-to-postgresql-using-python-part-2-3ddb41f473bd" rel="noopener"> <strong class="kd hj">第二部分</strong> </a> <strong class="kd hj">使用 Python 在 PostgreSQL 数据库中创建表</strong></p><p id="e4fc" class="kb kc lo kd b ke ky ij kg kh kz im kj mg la km kn mh lb kq kr mi lc ku kv kw hb bi translated"><a class="ae kx" href="https://shahid-dhn.medium.com/part-3-1-pandas-dataframe-to-postgresql-using-python-8a3e3da87ff1" rel="noopener"> <strong class="kd hj">第 3.1 部分</strong> </a> <strong class="kd hj">:使用 executemany()将批量数据插入 PostgreSQL 数据库</strong></p><p id="85cf" class="kb kc lo kd b ke ky ij kg kh kz im kj mg la km kn mh lb kq kr mi lc ku kv kw hb bi translated"><a class="ae kx" rel="noopener" href="/analytics-vidhya/part-3-2-pandas-dataframe-to-postgresql-using-python-8dc0b0741226"> <strong class="kd hj">第 3.2 部分</strong> </a> <strong class="kd hj">:使用 execute_batch()将批量数据插入 PostgreSQL 数据库</strong></p><p id="650a" class="kb kc lo kd b ke ky ij kg kh kz im kj mg la km kn mh lb kq kr mi lc ku kv kw hb bi translated"><a class="ae kx" href="https://shahid-dhn.medium.com/part-3-3-pandas-dataframe-to-postgresql-using-python-57e68fe39385" rel="noopener"> <strong class="kd hj">第 3.3 部分</strong> </a> <strong class="kd hj">:使用 Python </strong>将使用 execute_values()方法的批量数据插入 PostgreSQL 数据库</p><p id="2fab" class="kb kc lo kd b ke ky ij kg kh kz im kj mg la km kn mh lb kq kr mi lc ku kv kw hb bi translated"><a class="ae kx" href="https://shahid-dhn.medium.com/part-3-4-pandas-dataframe-to-postgresql-using-python-d94e644a332" rel="noopener"> <strong class="kd hj">第 3.4 部分</strong> </a> <strong class="kd hj">:使用 mogrify()将批量数据插入 PostgreSQL 数据库</strong></p><p id="2c64" class="kb kc lo kd b ke ky ij kg kh kz im kj mg la km kn mh lb kq kr mi lc ku kv kw hb bi translated"><a class="ae kx" href="https://shahid-dhn.medium.com/part-3-5-pandas-dataframe-to-postgresql-using-python-d3bc41fcf39" rel="noopener"> <strong class="kd hj">第 3.5 部分</strong> </a> <strong class="kd hj">:使用 copy_from()将批量数据插入 PostgreSQL 数据库</strong></p><p id="42c7" class="kb kc lo kd b ke ky ij kg kh kz im kj mg la km kn mh lb kq kr mi lc ku kv kw hb bi translated"><a class="ae kx" href="https://shahid-dhn.medium.com/part-3-6-pandas-dataframe-to-postgresql-using-python-ec80cb33ca4a" rel="noopener"> <strong class="kd hj">第 3.6 部分</strong> </a> : <strong class="kd hj">使用 copy_from()和 StringIO 将批量数据插入 PostgreSQL 数据库</strong></p><p id="dbd6" class="kb kc lo kd b ke ky ij kg kh kz im kj mg la km kn mh lb kq kr mi lc ku kv kw hb bi translated"><a class="ae kx" rel="noopener" href="/analytics-vidhya/part-3-7-pandas-dataframe-to-postgresql-using-python-6590fda63f41"> <strong class="kd hj">第 3.7 部分</strong> </a> : <strong class="kd hj">使用 to_sql()(alchemy)将批量数据插入 PostgreSQL 数据库</strong></p><p id="486c" class="kb kc lo kd b ke ky ij kg kh kz im kj mg la km kn mh lb kq kr mi lc ku kv kw hb bi translated"><a class="ae kx" href="https://shahid-dhn.medium.com/part-4-pandas-dataframe-to-postgresql-using-python-8ffdb0323c09" rel="noopener"> <strong class="kd hj">第四部分</strong> </a> : <strong class="kd hj">使用 Python 将批量 CSV 数据导入 PostgreSQL 的方法比较</strong></p><p id="9445" class="kb kc lo kd b ke ky ij kg kh kz im kj mg la km kn mh lb kq kr mi lc ku kv kw hb bi translated"><a class="ae kx" href="https://shahid-dhn.medium.com/part-5-1-pandas-dataframe-to-postgresql-using-python-e2588e65c235" rel="noopener"> <strong class="kd hj">第 5.1 部分</strong> </a> : <strong class="kd hj">如何从 PostgreSQL 读取数据到 Pandas DataFrame？</strong></p></blockquote><p id="7db2" class="pw-post-body-paragraph kb kc hi kd b ke ky ij kg kh kz im kj kk la km kn ko lb kq kr ks lc ku kv kw hb bi translated"><strong class="kd hj"> <em class="lo">参考:petl:</em></strong><a class="ae kx" href="https://petl.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"><strong class="kd hj"><em class="lo">petl—提取、转换和加载(数据表)— petl 1.6.8 文档</em> </strong> </a></p><p id="2db1" class="pw-post-body-paragraph kb kc hi kd b ke ky ij kg kh kz im kj kk la km kn ko lb kq kr ks lc ku kv kw hb bi translated">保持积极的态度！！注意安全！！继续学习:))</p><p id="cc57" class="pw-post-body-paragraph kb kc hi kd b ke ky ij kg kh kz im kj kk la km kn ko lb kq kr ks lc ku kv kw hb bi translated"><strong class="kd hj">感谢您的阅读！！</strong></p></div></div>    
</body>
</html>