<html>
<head>
<title>Scraping All-Party Parliamentary Groups in R with parlygroups</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与议会团体一起清除所有党派的议会团体</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/scraping-all-party-parliamentary-groups-in-r-with-parlygroups-29b05907afda?source=collection_archive---------15-----------------------#2019-12-04">https://medium.com/analytics-vidhya/scraping-all-party-parliamentary-groups-in-r-with-parlygroups-29b05907afda?source=collection_archive---------15-----------------------#2019-12-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7fec027b2881dd61af981e573d1d631c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VV9A7kwwGfQtwPTNhGAweg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">菲尔·杜比在<a class="ae iu" href="https://www.flickr.com/" rel="noopener ugc nofollow" target="_blank"> Flickr </a>上的照片</figcaption></figure><p id="38f0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">请注意:我是以个人身份写这篇文章的。表达的任何观点都不是我雇主的观点。</em></p><p id="9a72" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在过去的几个月里，议员们和他们的工作人员向我提出了一些相当简单直接的问题，这些问题都是关于各党派议会团体的。</p><p id="a09a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">他们问:“谁在APPGs中担任最多的官员角色，APPGs从外部来源获得的资金价值是多少？”紧接着是一句:“我能尽快拿到这个吗？”</p><p id="ef6f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">不幸的是，回答这些问题远非快速或简单——包含APPGs详细信息的登记册仅由议会以网页或PDF文档的形式发布。拿出了纸和笔。没有整洁的Excel文件给我！几个小时后，我有了答案:对他们来说，这是一个他们可以使用的干净的号码；对我来说，意识到这显然不是我长期工作的最佳方式。</p><p id="3d01" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">想到未来我不得不重复费力地一页一页筛选《APPG登记簿》的任务，我感到恐惧，于是我决定做任何天生懒惰的人都会做的事情——让一台机器为我做这件事。幸运的是，解散就在眼前，这给了我开始写一些代码的绝佳机会。</p><p id="e068" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">几个星期和几次碰壁之后，我可以自豪地介绍<a class="ae iu" href="https://github.com/dempseynoel/parlygroups" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj">parlygroups</strong></a>——一个R包，它具有所有需要的功能，可以毫不费力地将讨厌的APPG寄存器的内容刮到漂亮整洁的数据表中。让我们看看现在回答同样的问题有多快多简单…</p><p id="de38" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，让我们安装<strong class="ix hj"> parlygroups </strong>包并下载APPG注册。对于本演练，我们将使用日期为2019年11月5日<a class="ae iu" href="https://publications.parliament.uk/pa/cm/cmallparty/191105/contents.htm" rel="noopener ugc nofollow" target="_blank"/>的最新可用登记簿。我们需要使用<strong class="ix hj"> download_appg() </strong>函数将注册表放入R中，它需要做的只是ISO 8061格式的<strong class="ix hj">注册日期</strong>——“2019–11–05”。还有两个额外的参数可以使用，<strong class="ix hj"> pause </strong>，这是抓取每个APPG页面之间等待的秒数，以及<strong class="ix hj"> save </strong>，这允许您将抓取的数据保存在您的机器上，尽管这些不是强制的。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ju"><img src="../Images/df6879c474aa71f720267092f8d3d12e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pEY1EOUZwbpUwQPYbSoADQ.png"/></div></div></figure><p id="a70b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦注册被下载(有一个方便的小进度条告诉你还有多长时间可以等待)，我们终于可以看一些数据了。我们的第一个问题是“谁在APPGs中担任最多的官员角色？”为了帮助回答这个问题，我们所需要的是<strong class="ix hj"> appg_officers() </strong>函数，该函数将返回一个表，显示每个appg的议员和上议院议员的详细姓名。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jz"><img src="../Images/3540373c569325e68442680030a26494.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EAR2jMBrF5lEbbXlR7qgWg.png"/></div></div></figure><p id="5325" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们有了一个充满数据的表格，我们可以再写几行代码来看看哪个议员或勋爵是最多产的APPG官员。<a class="ae iu" href="https://cran.r-project.org/web/packages/dplyr/index.html" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj">dplyr</strong></a><strong class="ix hj"/>包内的函数非常适合这种数据争论——只需将我们的<strong class="ix hj">军官</strong>表<strong class="ix hj">组</strong>中<strong class="ix hj">军官_姓名</strong>列的所有议员和上议院议员的姓名，然后<strong class="ix hj">将他们</strong>排列起来<strong class="ix hj">按<strong class="ix hj">降序</strong>排列</strong>即可。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ka"><img src="../Images/13db44d93ce1c9e214224f4431ec99e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MsyQcJF0FMWo5SmdcwVz_A.png"/></div></div></figure><p id="2746" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">哈！因此，结果是彼得·博顿利爵士拥有最多的官员职位。只要稍加调整，我们就能算出哪个政党拥有最多的官员，哪个议员或上议院议员拥有最少的官员，或者介于两者之间。</p><p id="de43" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的第二个问题是“APPGs从外部来源获得的资金价值是多少？”回答这个问题现在也一样简单。让我们使用<strong class="ix hj"> appg_financial() </strong>函数，因为它将给出一个表格，显示所有从外部来源获得资金的appg。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jz"><img src="../Images/eac842a405d160e7324f2040f52fa259.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WkHvhZ0SYN8AVtFwggiK0g.png"/></div></div></figure><p id="77c8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，我们可以看到有198个外部来源，如公司、慈善机构或其他组织，向APPG提供资金。现在，我们可以简单地对<strong class="ix hj"> financial_value </strong>列求和，得到我们的答案(1，517，997)，尽管让我们更进一步，得到每个组收到的总资金，并将它们从高到低排序。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jz"><img src="../Images/b881477d3e8a61e5dfaa59d84305b837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pgtJGE874-cTfnnV-I8Bvg.png"/></div></div></figure><p id="b4b1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">事实证明，第四次工业革命中的APPG获得了最多的外部资助。如果现在你想调查到底是谁在资助这个团体，这是非常容易的——你所要做的就是再次调用<strong class="ix hj"> appg_financial() </strong>函数，并将这个团体的名称提供给<strong class="ix hj"> appg </strong>参数。</p><p id="0d2f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这两个简单的问题第一次回答就花了我一生的时间。现在可以在几分钟内完成。在新的一年里，这肯定会让我的生活轻松很多！</p></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><p id="e921" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你对我如何改进<a class="ae iu" href="https://github.com/dempseynoel/parlygroups" rel="noopener ugc nofollow" target="_blank">讨论组</a>有任何意见或建议，请在这里留言或在Github上提出问题。</p></div></div>    
</body>
</html>