<html>
<head>
<title>Make a Weather Application using Django</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Django制作一个天气应用程序</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/make-a-weather-application-using-django-a9a131e3bae7?source=collection_archive---------6-----------------------#2019-12-24">https://medium.com/analytics-vidhya/make-a-weather-application-using-django-a9a131e3bae7?source=collection_archive---------6-----------------------#2019-12-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2e02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你好，这次我想分享一下如何用django做一个天气应用。这个天气应用程序将向您显示我们想要了解的城市的温度和一些云的描述。让我们开始吧！</p><p id="39fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先你必须在你的终端上运行这个来安装django。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="9393" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj">django-admin startproject the_weather<br/>cd the_weather<br/>python manage.py startapp weather</strong></span></pre><p id="b206" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后打开settings.py，在INSTALLED_APPS上添加“天气”。然后我们想先在我们的网站上创建一个超级用户，在你的终端上运行这个。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="bae0" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj">python manage.py migrate<br/>python manage.py createsuperuser</strong></span></pre><p id="83d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后在空白处填入您自己的用户名和密码。接下来，通过在终端中键入python manage.py runserver来尝试运行网站，并填写您之前制作的用户名和密码。</p><p id="21f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，在“天气”目录下创建一个名为“模板”的文件目录，并在“模板”目录下创建一个名为“天气”的新文件目录，在“天气”目录下创建一个名为“天气. html”的新html文件，删除HTML中的代码，从<a class="ae js" href="https://github.com/Verdyevan/Weather_App/blob/master/the_weather/weather/templates/weather/weather.html" rel="noopener ugc nofollow" target="_blank">https://github . com/Verdyevan/Weather _ App/blob/master/the _ Weather/Weather/templates/Weather/Weather . HTML</a>中复制HTML代码，并粘贴到“天气. HTML”中。</p><p id="39b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在urls.py上像这样键入</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="2635" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj">from django.contrib import admin<br/>from django.urls import path, include<br/><br/>urlpatterns = [<br/>    path('admin/', admin.site.urls),<br/>    path('', include('weather.urls')),<br/>]</strong></span></pre><p id="2f66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在“天气”目录下创建一个名为“urls.py”的新python文件，并在其中键入以下代码</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="d482" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj">from django.urls import path<br/>from . import views<br/><br/>urlpatterns = [<br/>    path('', views.index),<br/>]</strong></span></pre><p id="30fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后在views.py上键入这段代码，并尝试通过在终端上键入python manage.py runserver来运行服务器。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="f77d" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj">from django.shortcuts import render<br/><br/>def index(request):<br/>    return render(request, 'weather/weather.html')</strong></span></pre><p id="1b00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，在终端中运行“pipenv install requests ”,在等待安装时，您可以在views.py上添加一些代码，以便在您的网站上像这样设置api。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="fad5" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj">import requests<br/>from django.shortcuts import render<br/><br/>def index(request):<br/>    url = 'http://api.openweathermap.org/data/2.5/weather?q={}&amp;units=imperial&amp;appid=271d1234d3f497eed5b1d80a07b3fcd1'<br/>    city = 'Las Vegas'<br/><br/>    r = requests.get(url.format(city)).json()<br/><br/>    city_weather = {<br/>        'city': city,<br/>        'temperature': r["main"]["temp"],<br/>        'description': r["weather"][0]["description"],<br/>        'icon': r["weather"][0]["icon"],<br/>    }<br/>    context = {'city_weather' : city_weather}<br/>    return render(request, 'weather/weather.html', context)</strong></span></pre><p id="ee58" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">去weather.html把代码改成这样。</p><ul class=""><li id="7932" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">要更改城市，请在第56行输入<span class="”title”"> {{ city_weather.city }} </span></li><li id="bbe7" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">要更改温度，请在第58行<span class="”subtitle”">{ { city _ weather . temperature } } F</span>处输入此值</li><li id="b58b" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">要更改描述，请在第59行<br/>{ { city _ weather . description } }</li><li id="f527" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">要更改图标，请在第50行键入此内容<img src="”http://openweathermap.org/img/w/{{" city_weather.icon="" alt="”Image”"/></li></ul><p id="d2a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尝试运行代码，它将被更改为该城市的当前天气。这将工作，但只有一个城市，我们必须改变城市的看法。如果我们想改变另一个当前城市的天气。所以在models.py上输入这个。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="a494" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj">from django.db import models<br/><br/>class City(models.Model):<br/>    name = models.CharField(max_length=25)<br/><br/>    def __str__(self):<br/>        return self.name<br/><br/>    class Meta:<br/>        verbose_name_plural = 'cities'</strong></span></pre><p id="07d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在终端上运行python manage.py makemigrations和python manage.py migrate。在admin.py上输入这个。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="bc95" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj">from django.contrib import admin<br/>from .models import City<br/><br/>admin.site.register(City)</strong></span></pre><p id="7c6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行服务器，查看管理网站，并添加一些像这样的城市。</p><figure class="jd je jf jg fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es kh"><img src="../Images/8ac02713d72f68b268aeba423c4314f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2mz0FgZpiElb6qTVUqIMog.png"/></div></div></figure><p id="9cdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们希望在我们的网站上显示这三个城市的当前天气。因此，如果我们想这样做，就像这样在views.py上添加一些代码。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="5795" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj">import requests<br/>from django.shortcuts import render<br/>from .models import City<br/><br/>def index(request):<br/>    url = 'http://api.openweathermap.org/data/2.5/weather?q={}&amp;units=imperial&amp;appid=271d1234d3f497eed5b1d80a07b3fcd1'<br/>    city = 'Las Vegas'<br/><br/>    cities = City.objects.all()<br/><br/>    weather_data = []<br/><br/>    for city in cities:<br/>        r = requests.get(url.format(city)).json()<br/><br/>        city_weather = {<br/>            'city': city.name,<br/>            'temperature': r["main"]["temp"],<br/>            'description': r["weather"][0]["description"],<br/>            'icon': r["weather"][0]["icon"],<br/>        }<br/>        weather_data.append(city_weather)<br/><br/>    context = {'weather_data' : weather_data}<br/>    return render(request, 'weather/weather.html', context)</strong></span></pre><p id="d429" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后转到“weather.html”并键入:</p><ul class=""><li id="120b" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">在第46行，在weather_data %}中为city_weather键入{%</li><li id="8dab" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">在第66行键入{% endfor %}</li></ul><p id="105e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你会变成这样。</p><figure class="jd je jf jg fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es kp"><img src="../Images/4faf4eb407204c601a74e36d4a3dddb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J3V2jXHGYODFg6nDUxaqLg.png"/></div></div></figure><p id="131b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在天气目录中创建一个名为“forms.py”的新python文件。</p><figure class="jd je jf jg fd ki er es paragraph-image"><div class="er es kq"><img src="../Images/674a0cc0b58c08829b2fe6d9585134b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*jxImIy3RcGJOx96TrGw2hw.png"/></div></figure><p id="567a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后在上面打这个。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="b0ca" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj">from django.forms import ModelForm, TextInput<br/>from .models import City<br/><br/>class CityForm(ModelForm):<br/>    class Meta:<br/>        model = City<br/>        fields = ['name']<br/>        widgets = {'name' : TextInput(attrs={'class' : 'input', 'placeholder' : 'City Name'})}</strong></span></pre><p id="38a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">返回到views.py并键入以下内容。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="109e" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj">import requests<br/>from django.shortcuts import render<br/>from .models import City<br/>from .forms import CityForm<br/><br/>def index(request):<br/>    url = 'http://api.openweathermap.org/data/2.5/weather?q={}&amp;units=imperial&amp;appid=271d1234d3f497eed5b1d80a07b3fcd1'<br/><br/>    if request.method == "POST":<br/>        pass<br/><br/>    form = CityForm()<br/><br/>    cities = City.objects.all()<br/><br/>    weather_data = []<br/><br/>    for city in cities:<br/>        r = requests.get(url.format(city)).json()<br/><br/>        city_weather = {<br/>            'city': city.name,<br/>            'temperature': r["main"]["temp"],<br/>            'description': r["weather"][0]["description"],<br/>            'icon': r["weather"][0]["icon"],<br/>        }<br/>        weather_data.append(city_weather)<br/><br/>    context = {'weather_data' : weather_data, 'form' : form}<br/>    return render(request, 'weather/weather.html', context)</strong></span></pre><p id="5681" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在“weather.html”上，将一些代码更改为:</p><ul class=""><li id="0390" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">删除第29行，改为{{ form.name }}</li><li id="bd6c" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">在第33行键入这样的代码<button type="”submit”" class="”button" is-info=""/></li><li id="1877" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">在第26行下面，键入如下代码{% csrf_token %}</li></ul><p id="9637" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，如果我们在搜索栏中键入一个城市并提交它，我们希望显示该城市的当前天气，所以在您的views.py中，在第8行下面像这样键入。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="5792" class="jm jn hi ji b fi jo jp l jq jr"><strong class="ji hj">if request.method == "POST":<br/>    form = CityForm(request.POST)<br/>    form.save()</strong></span></pre><p id="5269" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">试着运行服务器，添加一些城市，你就会得到你想要的。</p><figure class="jd je jf jg fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es kr"><img src="../Images/4edb005075efafeaf40b4ba5cc712ba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a8tn8bB_qCi7r9XLnI8R0A.png"/></div></div></figure><p id="d1c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以这就是这个教程，下一篇文章也许我想分享这个网站的发展，就像你可以删除城市或添加一些描述或什么的。</p><p id="9fd4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢，请继续关注我的下一篇文章！</p></div></div>    
</body>
</html>