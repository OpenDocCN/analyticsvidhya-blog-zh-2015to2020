<html>
<head>
<title>Consumer Data Analysis in SQL &amp; Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL和Python中的消费者数据分析</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/consumer-data-analysis-using-sql-python-2a11beb5446b?source=collection_archive---------5-----------------------#2019-09-12">https://medium.com/analytics-vidhya/consumer-data-analysis-using-sql-python-2a11beb5446b?source=collection_archive---------5-----------------------#2019-09-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1e94a14370d2f20cd6781167bb1ca322.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0RsO2PAMm0MZsnqagc1Yfw.jpeg"/></div></div></figure><p id="d57f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本帖中，我们将讨论一个<strong class="is hj">电子商务应用</strong>的业务指标以及他们的SQL和Python解决方案。</p><p id="d273" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请随时提供反馈，并回复你们作为业务KPI一部分跟踪的任何其他指标。</p><p id="3f21" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们开始吧</p><p id="9e84" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注意</strong> :-在这篇文章中，我们将关注市场买方的衡量标准。</p><p id="41cd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">认知/获得</strong></p><p id="ef07" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">(关键指标—<strong class="is hj">#整体应用下载量</strong>、<strong class="is hj">#跨细分市场的应用下载量</strong>(设备、营销渠道、平台、电子邮件)<strong class="is hj">#成功注册量</strong>、<strong class="is hj">#用户到达主页/登录页面前的跳出率</strong>、<strong class="is hj">#退出率</strong>(#完全退出应用且从未注册的用户数)<strong class="is hj"> LTV </strong>(终身价值)/ <strong class="is hj"> CAC </strong>(成本)</p><p id="fa8f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">问题1:-找出2019年获得的整体新用户以及前5个月的增长率？</em> </strong></p><p id="8f2d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们假设用户表包含以下列:</p><p id="0354" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">客户id，姓名，登录日期，设备登录</strong></p><p id="18aa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">在SQL数据库中加载数据:- </strong></p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jp"><img src="../Images/5b132bb0c8a1871cd1c1e59d1156e53a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gw46n-HYku1r99G_w-n__Q.png"/></div></div></figure><p id="8285" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> SQL解决方案</strong></p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ju"><img src="../Images/274b1cea4d0578d01ccd5fc58ac97df7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nLJm9ZXAYKM_FTHaAT_44g.png"/></div></div></figure><p id="0127" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的查询中，我们首先找出我们每个月搭载的不同新用户，并将这些表与新用户总数和增长率结合起来。</p><p id="e4c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Python解决方案</strong></p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jv"><img src="../Images/c79ec58149f262c3560d9072be444cf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T5qXXdiGYmiaxFYUfqLLuw.png"/></div></div></figure><p id="0738" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的代码中，我们将数据初始化并加载到dataframe中，汇总以找到总体和月度增长率数字，最后将它们组合起来。</p><p id="81ac" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注</strong> :- month_sign_in = 0指2019年整体新用户获取量</p><p id="b6b4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">输出</strong></p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jw"><img src="../Images/cb9e57363d8b57b1553691dc27b57b88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z57SFCjB6NZOjkfj0KpObg.png"/></div></div></figure><p id="ba01" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">问题2:——计算新用户获取的平均YOY增长率</em> </strong></p><p id="b24e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有两种方法可以计算平均值-</p><ol class=""><li id="399b" class="jx jy hi is b it iu ix iy jb jz jf ka jj kb jn kc kd ke kf bi translated">平均每月增长率(风险—对异常值/每月波动敏感)</li><li id="b3eb" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">合计每年的新用户总数，然后计算增长率(风险-无法捕捉周期性波动的相关性)</li></ol><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/be625823359eff8e3617cedc345f09b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5urSMKUOeII7Xs8uVPLdrw.png"/></div></div></figure><p id="fc25" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Python解决方案</strong></p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es km"><img src="../Images/2869ac145febab69c3cf90619c060cc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FQzFTyYZOSML7-99Rd8uww.png"/></div></div></figure><p id="cac8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">在上面的python代码</strong>中需要注意的关键点:——如何透视一个数据帧？如何展平列名索引？</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/2f1add64ef708ca08f53bd528e6c254e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Lo04A44w9LndAo0Q1RDpA.png"/></div></div></figure><p id="3773" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">两种方法得出的结果截然不同，因为在某些月份(2019年4月)波动很大。低音量也是造成差异的原因之一。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/4e1eacee61f6efd87400e1d55f0dd6fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wfUvSU3Z-qSeBkrHxyISeA.png"/></div></div></figure><p id="7be0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">接合/保持</strong></p><p id="f5b8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">(<strong class="is hj">关键指标</strong> — <strong class="is hj">、【WAU】、MAU </strong>、粘性指数(<strong class="is hj"> DAU/MAU </strong>)、<strong class="is hj">平均花费时间/ DAU </strong>、<strong class="is hj">从注册到首次购买的平均时间</strong>、# <strong class="is hj">订阅率</strong>、# <strong class="is hj">订单</strong>、$ <strong class="is hj">平均价值/订单</strong>、<strong class="is hj">用户购买模式</strong>按<strong class="is hj">队列</strong></p><p id="6bc1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">问题3:——找出X公司</em> </strong>的最投入用户<em class="jo"/></p><p id="5ebe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们必须为大多数参与的用户提出一个定义。我们可以考虑RFM公制框架:-</p><p id="1c4d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">最近:</strong>——想想那些每天至少登录一次应用的人，或者广为人知的<strong class="is hj"> DAU </strong>。为了进一步筛选，我们还可以应用一个阈值来衡量在应用程序中花费的时间或查看/点击的页面数量。为简单起见，我们考虑DAU。即使每次访问可能不会转化为购买，但那些每天登录的用户比其他用户有更高的意向。</p><p id="9e7a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">频率:</strong> -由于我们的应用程序的目标是激励用户进行交易，我们可以认为参与度最高的用户是那些每周至少订购一件产品的用户。以下是计算频率阈值的定量方法</p><ol class=""><li id="2a86" class="jx jy hi is b it iu ix iy jb jz jf ka jj kb jn kc kd ke kf bi translated">过滤掉在过去几个月中访问过你的应用至少两次的用户。确保时间框架不受季节性影响，如假期、活动、竞争性产品发布。排除任何可能受到前面列出的任何内部/外部因素影响的市场/用户/平台/设备。</li><li id="6a01" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">计算第一次和第二次购买之间的时间</li><li id="96d1" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">绘制每个时差仓中用户的直方图。</li><li id="4b08" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">选择至少80%的用户至少购买过两次的阈值</li></ol><p id="37cd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">货币</strong> :-考虑产生最大货币价值的用户。对于这个问题，我考虑过整体购买价值≥50。根据帕累托法则，大约80%的收入来自20%的用户。我们可以使用类似于频率的定量方法来得出数据驱动的阈值。</p><p id="349a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">满足上述标准的用户被视为<strong class="is hj">超级用户。</strong></p><p id="9809" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> SQL查询:</strong> -</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kp"><img src="../Images/c22d65585d17534828d0f4f911bfc372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xsCSKZyf6Ck7GhPhh5XeCg.png"/></div></div></figure><p id="d6cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Python解决方案:- </strong></p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/3be9a4e6314f439f5cd6bf159f8dcc72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qx3r_s5zyhA7k5Mf6H6KCg.png"/></div></div></figure><p id="8590" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">问题4:-评估每个用户在2019年1月的每日累计购买价值？</em>T47】</strong></p><p id="c34b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们先来分解一下需求。我们有一个订单历史表，其中存储了每个用户的订单详细信息。我们希望为2019年1月的每一天生成一个表，其中包含每个用户的累计购买值。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es kq"><img src="../Images/214ad10b3e2c7e602cda528a881de068.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*UuqNQKpSfjAlXvlXvSiC9A.png"/></div></figure><p id="3eef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了简单起见，我假设我们的数据库中已经有了下面的表</p><ol class=""><li id="8eb0" class="jx jy hi is b it iu ix iy jb jz jf ka jj kb jn kc kd ke kf bi translated"><strong class="is hj">日历日期表</strong> —存储每年的所有日期</li><li id="75df" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">2018年度<strong class="is hj">累计余额</strong>表</li></ol><p id="80b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">SQL查询-</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/204aadda15023e979574f0af47bed7e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cDxLysAfs-SOeZIlZO2L4Q.png"/></div></div></figure><p id="bf31" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">对上述查询的解释:- </strong></p><p id="c9a1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">订单_详情:- </strong></p><p id="7647" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有3个样本用户，其中1112在2019年1月1日购买了产品，并且从2018年开始有滚动余额。1113本年度的首次购买是在2019年1月4日，也有2018年的滚动余额。1114是2019年获得的新用户，首次购买是在2019年1月12日。</p><p id="12e1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">笛卡儿_表格:- </strong></p><p id="1157" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个表是在查询中创建的，它是每个用户和日历日期的笛卡尔连接。</p><p id="10f9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">逻辑</strong> :-</p><ol class=""><li id="af6f" class="jx jy hi is b it iu ix iy jb jz jf ka jj kb jn kc kd ke kf bi translated">如果用户在2019年1月1日进行了购买，则将前一年的余额与第一天的购买量相加</li><li id="8c9b" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">如果用户在2019年1月1日没有购买，但有上一年的滚动余额，则填充上一年的余额</li><li id="bf01" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">如果用户在2019年1月1日没有购买，并且没有上一年的滚动余额，请填充0</li><li id="ddae" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">最后一步是使用无界行的概念计算cumulative_daily_balance</li></ol><p id="4f69" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">输出</strong> :-我刚刚展示了2019年1月前5天的结果。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/81fb68a4d97c89a9ddcea6cc8dc094a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FuVcRrWdcvA68j0ob_AA0A.png"/></div></div></figure><p id="67eb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Python解决方案</strong></p><p id="70e6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在python中使用<strong class="is hj"> cumsum </strong>()要容易得多。你自己试试吧。一旦你实现了逻辑的初始步骤，就应该更容易找到累积和。</p><p id="e724" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">让我知道你对这篇文章的看法。我将创建另一个关于可视化这些指标的帖子。</em> </strong></p><p id="aaef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我的Linkedin网址:-<a class="ae kt" href="https://www.linkedin.com/in/banani-mohapatra/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/notifications/</a></p></div></div>    
</body>
</html>