<html>
<head>
<title>Step-by-step Upgrade of Tensorflow 1.x to Tensorflow 2.2 with Nvidia’s GPU and CUDA in Windows 10</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Windows 10中使用Nvidia的GPU和CUDA逐步将Tensorflow 1.x升级到Tensorflow 2.2</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/step-by-step-upgrade-of-tensorflow-1-x-to-tensorflow-2-2-with-nvidias-gpu-and-cuda-in-windows-10-a9c0d04739e4?source=collection_archive---------13-----------------------#2020-06-21">https://medium.com/analytics-vidhya/step-by-step-upgrade-of-tensorflow-1-x-to-tensorflow-2-2-with-nvidias-gpu-and-cuda-in-windows-10-a9c0d04739e4?source=collection_archive---------13-----------------------#2020-06-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ee1c994951c27bea6c69814d23ef3186.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oFi_cuxE2K3F4HJH.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片来源:<a class="ae iu" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank">https://www.tensorflow.org/</a></figcaption></figure><p id="7383" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated"><span class="l ju jv jw bm jx jy jz ka kb di">由于</span>我最近需要在一台运行Windows 10的机器上将Tensorflow 1.x升级到2.2，我发现有很多文章在谈论如何从头开始安装必要的包/软件。但是，关于如何使用以前安装的软件包/软件，尤其是Tensorflow 2.2和CUDA 10.1来完成此操作的资源非常有限。我写这篇文章来分享详细的步骤，同时保持一个干净的系统环境。</p><p id="2441" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第一步。</strong>通过Windows搜索栏，转到应用程序&amp;功能。然后，卸载所有与Nvidia相关的应用。(您不需要担心图形驱动程序，我们很快会重新安装)。某些应用程序可能需要重新启动计算机。</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kc"><img src="../Images/5b49b0619397a2c674ee39913b3cabec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fbKi1ewvwNDv2fj0JMXs1Q.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">卸载Nvidia应用程序的位置示例</figcaption></figure><p id="8d3f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第二步。</strong>删除C:\Program Files和C:\Program Files (x86)中名称中含有“Nvidia”的文件夹。此外，从搜索栏转到“编辑系统环境变量”。然后，转到“环境变量”并删除包含“Nvidia”的用户和系统变量中定义的“路径”。</p><p id="08bb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第三步。</strong>使用您喜欢的任何方法卸载当前的Tensorflow和Keras，例如<em class="kh"> pip </em>和<em class="kh"> conda </em>。作为参考，在Tensorflow 2.x中，您不需要导入Keras，而是使用tensorflow.keras。例如:</p><pre class="kd ke kf kg fd ki kj kk kl aw km bi"><span id="ebd9" class="kn ko hi kj b fi kp kq l kr ks">pip uninstall tensorflow<br/>pip uninstall tensorflow-gpu<br/>pip uninstall keras</span></pre><p id="26f8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第四步。</strong>从<a class="ae iu" href="https://visualstudio.microsoft.com/downloads/" rel="noopener ugc nofollow" target="_blank">官网</a>安装Visual Studio社区2019。【重要】请安装工作负载“用C++进行桌面开发”。如果您已经有了Visual Studio，但没有上述配置，您需要卸载现有的Visual Studio，然后安装软件，或者将此工作负载添加到您当前的Visual Studio中。</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/aef551186c982e682f43ecb8ca47d863.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I6_vXTU2VlNRx1Lf4Nz7ag.png"/></div></div></figure><p id="3912" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">[注意]从下一步开始，我们的程序需要遵循<a class="ae iu" href="https://www.tensorflow.org/install/gpu" rel="noopener ugc nofollow" target="_blank"> Tensorflow GPU支持网站</a>中的指导。软件包的版本将来可能会有所不同。本教程基于截至2020年6月20日提供的版本。</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ku"><img src="../Images/1b8ac001c8a282bf76206fc6066a26f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z-f_FZGhHsF5-xsUSPSd5w.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">具有指定版本的需求包</figcaption></figure><p id="92e1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">步骤五。</strong>从<a class="ae iu" href="https://www.nvidia.com/download/index.aspx?lang=en-us" rel="noopener ugc nofollow" target="_blank"> Nvidia驱动程序下载网站</a>根据你的GPU规格安装Nvidia驱动程序。</p><p id="3592" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第六步。</strong>从<a class="ae iu" href="https://developer.nvidia.com/cuda-toolkit-archive" rel="noopener ugc nofollow" target="_blank">官网</a>安装Nvidia CUDA工具包。请注意，我们需要使用上面提到的版本(10.1)，即使CUDA工具包11.0也是可用的。具体来说，我使用下面这个没有任何问题。</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/29023bc5e2ed0b6ef4d2bdcb99fdc208.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hClL5anlsahHWBqCRvOFvw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">CUDA工具包</figcaption></figure><p id="6384" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第七步。</strong>从<a class="ae iu" href="https://developer.nvidia.com/cudnn" rel="noopener ugc nofollow" target="_blank">官网</a>安装cuDNN SDK。如果你从来没有下载cuDNN，你需要创建一个帐户。请下载与我们安装的CUDA工具包版本相关的版本。</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kw"><img src="../Images/6e40540c62a3f0c4ca0e8c91ef143098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ZBANGIvn4ciJqMqcVjObg.png"/></div></div></figure><p id="1f01" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后我们需要将这些源代码“合并”到CUDA工具包中。我没有找到关于这方面的详细/全面的介绍。这里我就来详细介绍一下。我们实际上有两种方法可以做到这一点。</p><p id="3f4d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">备选方案1。解压缩cuDNN SDK并执行以下复制粘贴操作:a)。将文件bin/cudnn64_7.dll复制到C/program files/NVIDIA GPU计算工具包/CUDA/v 10.1/bin/cud nn 64 _ 7 . dll；b)。将文件include/cudnn.h复制到C/program files/NVIDIA GPU计算工具包/CUDA/v 10.1/include/cud nn . h；c)。将lib/x64/cudnn.lib中的文件复制到C/program files/NVIDIA GPU计算工具包/CUDA/v10.1/lib/x64/cudnn.lib中。</p><p id="e97a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">选项2。解压缩cuDNN SDK并将其保存到系统驱动器，即您的c盘。为了一致性，假设我们将文件夹保存为C:\ cud nn-10.1-windows 10-x64-v 7 . 6 . 5 . 32，如果我们选择这个选项的话。</p><p id="3626" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第八步。</strong>将带有cuDNN的CUDA工具包添加到环境中。再次从搜索栏转到“编辑系统环境变量”。然后，转到“环境变量”，接着是“用户变量”，并编辑“路径”。由于step 7中有两个选项，我们这里的操作会略有不同。</p><p id="0d6a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们使用step 7选项1，在“路径”中添加以下两个路径:a)C:\ Program Files \ NVIDIA GPU Computing Toolkit \ CUDA \ v 10.1 \ libnvvp；b) C:\Program Files\NVIDIA GPU计算工具包\CUDA\v10.1\bin。</p><p id="24db" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们使用step 7选项2，在“路径”中添加以下一个路径:C:\ cud nn-10.1-windows 10-x64-v 7 . 6 . 5 . 32 \ cuda \ bin。</p><p id="5f23" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第九步。</strong>进入你的代码编译器或者cmd.exe，然后安装Tensorflow。例如:</p><pre class="kd ke kf kg fd ki kj kk kl aw km bi"><span id="38af" class="kn ko hi kj b fi kp kq l kr ks">pip install tensorflow</span></pre><p id="bbe1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">【注意】截至2020年6月20日，您将默认安装Tensorflow 2.2。正如Tensorflow网站所述，Tensorflow 2.x的版本(包括此版本)将能够在有或没有GPU支持的情况下运行，即您不需要像我们在安装Tensorflow 1.x时那样将属性指定为tensorflow-gpu。</p><p id="04b7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">终于，我们完成了！我在这里提供一个非常简单的代码，用于检查你的GPU是否可用于Tensorflow 2.2。</p><pre class="kd ke kf kg fd ki kj kk kl aw km bi"><span id="e3cd" class="kn ko hi kj b fi kp kq l kr ks">import tensorflow as tf</span><span id="3c53" class="kn ko hi kj b fi kx kq l kr ks">print(tf.__version__)</span><span id="28dd" class="kn ko hi kj b fi kx kq l kr ks">if tf.test.gpu_device_name():<br/>    print('Available GPU: {}'.format(tf.test.gpu_device_name()))<br/>else:<br/>    print("No GPU available")</span></pre><p id="6b6c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果在运行代码时出现任何问题，请检查日志记录信息，并在此基础上搜索解决方案。</p><p id="d0bb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">【最后的注释1】如果你大量使用python库，我强烈推荐用Anaconda这样的软件创建虚拟环境来进行包版本控制。有很多教程可用。</p><p id="1412" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">【最后注意2】对于使用Linux或者macOS的人来说，做这个升级是非常容易的。只需跟随到<a class="ae iu" href="https://www.tensorflow.org/install/gpu" rel="noopener ugc nofollow" target="_blank"> Tensorflow GPU支持网站</a>。</p><p id="081c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">酷毙了。享受你的Tensorflow 2和快乐编码！</p></div></div>    
</body>
</html>