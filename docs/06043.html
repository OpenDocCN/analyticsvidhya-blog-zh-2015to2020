<html>
<head>
<title>Creating Gstreamer Multimedia Pipeline With C++ Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用C++创建Gstreamer多媒体管道第1部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/creating-gstreamer-multimedia-pipeline-with-c-part-1-a7f0f86b5e1f?source=collection_archive---------0-----------------------#2020-05-10">https://medium.com/analytics-vidhya/creating-gstreamer-multimedia-pipeline-with-c-part-1-a7f0f86b5e1f?source=collection_archive---------0-----------------------#2020-05-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/feb652d2a31f0f69b770c87fca3beb62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LCrtxX2GRePommCRNUNIQQ.jpeg"/></div></div></figure><p id="2908" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Gstreamer是一个功能强大的通用框架，用于创建流媒体应用程序。它为构建实时IVA ( <em class="jo">智能视觉分析</em>)应用提供了广泛的动力。</p><p id="e17d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">NVIDIA DeepStream SDK是基于Gstreamer框架构建的。因此，学习Gstreamer将为您提供构建IVA应用程序的广阔视角。我开发IVA应用程序的主要语言是C++。</p><p id="b34a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本指南旨在帮助您理解GStreamer框架，以便您可以基于它开发应用程序。本系列的第一部分将重点介绍一个简单的Gstreamer Hello world程序的开发。我们正在处理多媒体应用，所以我们要播放一个网络视频。</p><p id="c780" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Gstreamer可以在Linux、Mac OS X、Windows，</p><h2 id="39cb" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated"><strong class="ak">安装:</strong></h2><p id="c89b" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">在Ubuntu 18.04.4 LTS版上安装Gstreamer</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="ee81" class="jp jq hi ku b fi ky kz l la lb">sudo apt-get update</span><span id="3b81" class="jp jq hi ku b fi lc kz l la lb">sudo apt-get upgrade</span><span id="a430" class="jp jq hi ku b fi lc kz l la lb">sudo apt install g++ cmake pkg-config</span><span id="d930" class="jp jq hi ku b fi lc kz l la lb">sudo apt-get install libgstreamer1.0-0 gstreamer1.0-plugins-base gstreamer1.0-plugins-good gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly gstreamer1.0-libav gstreamer1.0-doc gstreamer1.0-tools gstreamer1.0-x gstreamer1.0-alsa gstreamer1.0-gl gstreamer1.0-gtk3 gstreamer1.0-qt5 gstreamer1.0-pulseaudio</span></pre><p id="ad1c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Windows和Mac安装请点击此链接<br/><a class="ae ld" href="https://gstreamer.freedesktop.org/documentation/installing/index.html?gi-language=c" rel="noopener ugc nofollow" target="_blank">https://gstreamer . freedesktop . org/documentation/installing/index . html？gi-language=c </a></p><h2 id="7e7e" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">文件结构</h2><ul class=""><li id="819a" class="le lf hi is b it kk ix kl jb lg jf lh jj li jn lj lk ll lm bi translated"><em class="jo"> CmakeLists.txt </em></li><li id="dd88" class="le lf hi is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm bi translated"><em class="jo"> main.cpp </em></li></ul><p id="6aa6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们正在使用cmake工具来构建cpp程序。有关cmake的更多信息，请点击此链接<a class="ae ld" href="https://cmake.org/cmake/help/v3.17/" rel="noopener ugc nofollow" target="_blank"><em class="jo">https://cmake.org/cmake/help/v3.17/</em></a></p><p id="f83e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"><em class="jo">cmakelists . txt</em></strong></p><figure class="kp kq kr ks fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure></div><div class="ab cl lu lv gp lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="hb hc hd he hf"><p id="b358" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo"> main.cpp </em> </strong></p><figure class="kp kq kr ks fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="b237" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">代码遍历</strong></p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="cfd3" class="jp jq hi ku b fi ky kz l la lb">gst_init(&amp;arg, &amp;argv);</span></pre><ul class=""><li id="6dc3" class="le lf hi is b it iu ix iy jb mb jf mc jj md jn lj lk ll lm bi translated">它初始化所有内部结构</li><li id="3522" class="le lf hi is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm bi translated">检查有哪些插件可用</li><li id="b615" class="le lf hi is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm bi translated">执行任何用于Gstreamer的命令行选项</li></ul><p id="ed4b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您总是将命令行参数argc和argv传递给gst_init()，您的应用程序将自动受益于GStreamer标准命令行选项</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="f52a" class="jp jq hi ku b fi ky kz l la lb">pipeline = gst_parse_launch(<br/>        "playbin uri=https://www.freedesktop.org/software/gstreamer-sdk/data/media/sintel_trailer-480p.webm",<br/>        <em class="jo">nullptr</em>);</span></pre><p id="12d9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这一行是这个例子的核心。gst_parse_launch()和playbin。Gstreamer是一个设计用来处理多媒体流的框架，媒体通过源(生产者)传播到接收器(消费者)，传递一系列中间元素来执行所有任务。所有相互连接的元素的集合称为管道。</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es me"><img src="../Images/df6fd5ccfe12efbc0721dbb7b4f9b1f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*6oJk08_TDAKnn00h83JWKA.png"/></div></figure><p id="8d39" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在Gstreamer中，通常通过手工组装各个元素来构建管道。对于这个简单的演示，我们使用gst_parse_launch()，这个函数获取管道的文本表示，并转换成实际的管道。</p><p id="86f2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Playbin是一个特殊的元素，它起着源和汇的作用，是一个完整的管道。在内部，它将创建和连接所有必要的元素来播放您的媒体。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="79a2" class="jp jq hi ku b fi ky kz l la lb">gst_element_set_state(pipeline, GST_STATE_PLAYING);</span></pre><p id="62ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每个gstreamer元素都有一个关联的状态，为了播放媒体，我们需要将管道设置为播放状态。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="28c5" class="jp jq hi ku b fi ky kz l la lb">bus = gst_element_get_bus(pipeline);<br/>msg = gst_bus_timed_pop_filtered(bus, <strong class="ku hj">GST_CLOCK_TIME_NONE</strong>,<br/>                                 <em class="jo">static_cast</em>&lt;GstMessageType&gt;(GST_MESSAGE_ERROR | GST_MESSAGE_EOS));</span></pre><p id="059a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这一行将一直等待，直到出现任何错误或找到流的结尾</p><p id="fcce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">退出应用程序之前，请释放资源。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="85cd" class="jp jq hi ku b fi ky kz l la lb"><em class="jo">if </em>(msg != <em class="jo">nullptr</em>)<br/>    gst_message_unref(msg);</span><span id="0a03" class="jp jq hi ku b fi lc kz l la lb">gst_object_unref(bus);<br/>gst_element_set_state(pipeline, GST_STATE_NULL);<br/>gst_object_unref(pipeline);</span></pre><h2 id="84a6" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">构建和执行:</h2><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="e1a8" class="jp jq hi ku b fi ky kz l la lb">git clone <a class="ae ld" href="https://github.com/karthickai/gstreamer.git" rel="noopener ugc nofollow" target="_blank">https://github.com/karthickai/gstreamer.git</a><br/>cd gstreamer/gstreamer-01<br/>mkdir build; cd build<br/>cmake ../<br/>make<br/>./gstreamer-01</span></pre><h2 id="0340" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">输出:</h2><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/0a301b89fcb7f9cdfe8857260fcf8e85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*enlEqgL6fYkONMXlVOxhcg.gif"/></div></div></figure><p id="96b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢阅读。</p><p id="2f77" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你有任何建议/问题，请在评论区告诉我们！</p></div></div>    
</body>
</html>