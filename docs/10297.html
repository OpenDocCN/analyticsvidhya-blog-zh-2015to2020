<html>
<head>
<title>Invoking AWS lambda from S3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从 S3 调用 AWS lambda</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/invoking-aws-lambda-from-s3-33ae8bee8c35?source=collection_archive---------16-----------------------#2020-10-12">https://medium.com/analytics-vidhya/invoking-aws-lambda-from-s3-33ae8bee8c35?source=collection_archive---------16-----------------------#2020-10-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="01ac" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">学习目标</h2></div><ol class=""><li id="4406" class="ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo bi translated">设置 AWS 帐户</li><li id="a1cd" class="ix iy hi iz b ja jp jc jq je jr jg js ji jt jk jl jm jn jo bi translated">AWS 服务 S3、Lambda、IAM 等概述</li><li id="c60f" class="ix iy hi iz b ja jp jc jq je jr jg js ji jt jk jl jm jn jo bi translated">为 Lambda 创建 IAM 角色</li><li id="eb17" class="ix iy hi iz b ja jp jc jq je jr jg js ji jt jk jl jm jn jo bi translated">创建 Lambda 函数</li><li id="80d7" class="ix iy hi iz b ja jp jc jq je jr jg js ji jt jk jl jm jn jo bi translated">为 Lambda 函数创建触发器</li></ol><h1 id="fade" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">设置 AWS 帐户</h1><p id="1c89" class="pw-post-body-paragraph km kn hi iz b ja ko ij kp jc kq im kr je ks kt ku jg kv kw kx ji ky kz la jk hb bi translated">开始之前，请准备好您的 AWS 帐户。您可以使用<a class="ae lb" href="https://aws.amazon.com/free/?all-free-tier.sort-by=item.additionalFields.SortRank&amp;all-free-tier.sort-order=asc" rel="noopener ugc nofollow" target="_blank"> AWS 免费层</a>，AWS 免费层会在每个新的 AWS 帐户上自动激活。通过 AWS 免费层，您可以在一定的使用限制内免费试用一些 AWS 服务。</p><p id="55c3" class="pw-post-body-paragraph km kn hi iz b ja jb ij kp jc jd im kr je lc kt ku jg ld kw kx ji le kz la jk hb bi translated">AWS 免费层包括三种不同类型的产品:</p><ul class=""><li id="a7d8" class="ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk lf jm jn jo bi translated"><strong class="iz hj">试用:</strong>这些是从您激活服务之日开始的短期试用优惠。试用期结束后，您需要支付标准费用。</li><li id="44f4" class="ix iy hi iz b ja jp jc jq je jr jg js ji jt jk lf jm jn jo bi translated"><strong class="iz hj"> 12 个月免费:</strong>这些优惠提供初始注册日期后 12 个月内的有限使用。在 12 个月免费使用期限到期后，或者如果您的应用程序使用超出了免费等级限制，您需要支付标准费率。</li><li id="c433" class="ix iy hi iz b ja jp jc jq je jr jg js ji jt jk lf jm jn jo bi translated"><strong class="iz hj">永远免费:</strong>这些优惠面向所有 AWS 客户，不会在您的 12 个月 AWS 免费层期限结束时过期。</li></ul><blockquote class="lg lh li"><p id="9bc7" class="km kn lj iz b ja jb ij kp jc jd im kr lk lc kt ku ll ld kw kx lm le kz la jk hb bi translated">然而，并不是所有的 AWS 服务都是免费的。您可以通过 AWS 免费层使用情况警报来跟踪您的免费层使用情况。</p></blockquote><h1 id="8469" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">AWS 服务 S3、Lambda、IAM 等概述</h1><ul class=""><li id="9875" class="ix iy hi iz b ja ko jc kq je ln jg lo ji lp jk lf jm jn jo bi translated"><strong class="iz hj"> IAM </strong> : AWS 身份和访问管理(<a class="ae lb" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html" rel="noopener ugc nofollow" target="_blank"> IAM </a>)是一个 web 服务，帮助您安全地控制对 AWS 资源的访问。您使用 IAM 来控制谁被验证(登录)和授权(有权限)使用资源。</li><li id="cf1f" class="ix iy hi iz b ja jp jc jq je jr jg js ji jt jk lf jm jn jo bi translated"><strong class="iz hj"> S3 </strong>:亚马逊简单存储服务(<a class="ae lb" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank">亚马逊 S3 </a>)是互联网存储。你可以使用亚马逊 S3 在任何时间、任何地点存储和检索任何数量的数据。</li></ul><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es lq"><img src="../Images/3c842939aa91da969b81277abd7da34b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jmWg9VVpAWVJmPjwsk1aAA.png"/></div></div><figcaption class="mc md et er es me mf bd b be z dx translated">图片来源:AWS</figcaption></figure><ul class=""><li id="92e7" class="ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk lf jm jn jo bi translated"><strong class="iz hj">Lambda</strong>:<a class="ae lb" href="https://docs.aws.amazon.com/lambda/latest/dg/welcome.html" rel="noopener ugc nofollow" target="_blank">AWS Lambda</a>是一个事件驱动的无服务器计算平台，由亚马逊提供，作为亚马逊网络服务的一部分。它是一种计算服务，运行代码以响应事件，并自动管理该代码所需的计算资源。</li></ul><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mg"><img src="../Images/dc39389105c0078359eccf00f7aae45c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*atMzgYuf4rLJhcVI.png"/></div></div><figcaption class="mc md et er es me mf bd b be z dx translated">图片来源:AWS</figcaption></figure><h2 id="897e" class="mh jv hi bd jw mi mj mk ka ml mm mn ke je mo mp kg jg mq mr ki ji ms mt kk mu bi translated"><strong class="ak">自动气象站组件</strong></h2><p id="3b92" class="pw-post-body-paragraph km kn hi iz b ja ko ij kp jc kq im kr je ks kt ku jg kv kw kx ji ky kz la jk hb bi translated"><strong class="iz hj">函数:</strong>Lambda 函数由您提供的代码、相关的依赖项和配置组成。这是一个独立的部署单位。一个 Lambda 函数将被一个事件触发，所以你有越多的事件，越多的 Lambda 函数将被调用。此外，lambda 函数可以同步或异步触发其他 Lambda 函数。</p><p id="28c9" class="pw-post-body-paragraph km kn hi iz b ja jb ij kp jc jd im kr je lc kt ku jg ld kw kx ji le kz la jk hb bi translated"><strong class="iz hj">触发器:</strong>触发器是调用 Lambda 函数的 AWS 服务或资源。你可以用 Lambda <strong class="iz hj">控制台</strong>，Lambda <strong class="iz hj"> API </strong>，AWS <strong class="iz hj"> SDK </strong>，AWS <strong class="iz hj"> CLI </strong>和 AWS 工具包直接调用 Lambda 函数。您还可以配置其他 AWS 服务来调用您的函数，或者您可以配置 Lambda 从流或队列中读取并调用您的函数。</p><p id="66a6" class="pw-post-body-paragraph km kn hi iz b ja jb ij kp jc jd im kr je lc kt ku jg ld kw kx ji le kz la jk hb bi translated">触发器类型/调用</p><ul class=""><li id="b31b" class="ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk lf jm jn jo bi translated"><strong class="iz hj">同步调用</strong>:等待函数处理事件并返回响应。</li><li id="4c51" class="ix iy hi iz b ja jp jc jq je jr jg js ji jt jk lf jm jn jo bi translated"><strong class="iz hj">异步调用</strong> : Lambda 将事件排队等待处理，并立即返回响应。</li></ul><blockquote class="lg lh li"><p id="634c" class="km kn lj iz b ja jb ij kp jc jd im kr lk lc kt ku ll ld kw kx lm le kz la jk hb bi translated">对于异步调用，Lambda 处理重试，并可以将调用记录发送到目的地。</p></blockquote><p id="61be" class="pw-post-body-paragraph km kn hi iz b ja jb ij kp jc jd im kr je lc kt ku jg ld kw kx ji le kz la jk hb bi translated"><strong class="iz hj">目的地:</strong>目的地是 AWS 资源，它在调用成功或失败后接收调用的记录。如果要设置目的地，应该创建一个角色并附加相关权限，授权 Lambda 函数访问 AWS 资源。</p><blockquote class="lg lh li"><p id="6dc8" class="km kn lj iz b ja jb ij kp jc jd im kr lk lc kt ku ll ld kw kx lm le kz la jk hb bi translated">运行代码时不考虑服务器。仅为您消耗的计算时间付费— <strong class="iz hj"> AWS </strong></p></blockquote><h1 id="24d9" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">为 Lambda 创建 IAM 角色</h1><p id="aa20" class="pw-post-body-paragraph km kn hi iz b ja ko ij kp jc kq im kr je ks kt ku jg kv kw kx ji ky kz la jk hb bi translated">如果一个 Lambda 函数需要调用其他 AWS 服务，我们需要创建一个 IAM 角色，它可以在执行时承担这个角色。为我们的 Lambda 函数创建一个<strong class="iz hj"> IAM </strong>角色，以便能够连接到<strong class="iz hj"> S3 </strong>和<strong class="iz hj"> CloudWatch 日志</strong>。</p><p id="3f81" class="pw-post-body-paragraph km kn hi iz b ja jb ij kp jc jd im kr je lc kt ku jg ld kw kx ji le kz la jk hb bi translated"><strong class="iz hj">导航到 IAM 控制台页面，从左侧菜单中选择角色，如果没有 lambda 角色，则创建一个新角色。</strong></p><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mv"><img src="../Images/be70263f91932066fb8e8a36d60186d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r94a_pRxr1xrBEm-JPazww.png"/></div></div><figcaption class="mc md et er es me mf bd b be z dx translated">图片来源:AWS</figcaption></figure><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mw"><img src="../Images/d5951936811239de1d7fa5c1912c192c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Aa22TnyoHnz5AxTZQC7W_g.png"/></div></div><figcaption class="mc md et er es me mf bd b be z dx translated">图片来源:AWS</figcaption></figure><p id="c85c" class="pw-post-body-paragraph km kn hi iz b ja jb ij kp jc jd im kr je lc kt ku jg ld kw kx ji le kz la jk hb bi translated">选择 Lambda 作为受信任的实体，添加以下受管策略:</p><ul class=""><li id="aa45" class="ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk lf jm jn jo bi translated"><strong class="iz hj">亚马逊 3ReadOnlyAccess </strong></li><li id="8f0c" class="ix iy hi iz b ja jp jc jq je jr jg js ji jt jk lf jm jn jo bi translated"><strong class="iz hj">CloudWatchLogsFullAccess</strong></li></ul><p id="45c9" class="pw-post-body-paragraph km kn hi iz b ja jb ij kp jc jd im kr je lc kt ku jg ld kw kx ji le kz la jk hb bi translated">给角色起个名字<strong class="iz hj">“S3-拉姆达-角色”。</strong></p><h1 id="3f45" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">创建 Lambda 函数</h1><h2 id="aa49" class="mh jv hi bd jw mi mj mk ka ml mm mn ke je mo mp kg jg mq mr ki ji ms mt kk mu bi translated"><strong class="ak">导航至 AWS Lambda 控制台页面。</strong></h2><p id="fe26" class="pw-post-body-paragraph km kn hi iz b ja ko ij kp jc kq im kr je ks kt ku jg kv kw kx ji ky kz la jk hb bi translated">选择创建函数，从头开始创建一个函数，将其命名为<strong class="iz hj">“S3-λ-Fxn”</strong>。选择 Python 3.6 <strong class="iz hj">你可以选择你的版本</strong>。</p><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mx"><img src="../Images/2283bd734d775a023a992b27ec78e7f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WceUWURD66unN9fQwyXOng.png"/></div></div><figcaption class="mc md et er es me mf bd b be z dx translated">图片来源:AWS</figcaption></figure><p id="d385" class="pw-post-body-paragraph km kn hi iz b ja jb ij kp jc jd im kr je lc kt ku jg ld kw kx ji le kz la jk hb bi translated"><strong class="iz hj">使用从上一任务创建的策略。</strong></p><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es my"><img src="../Images/e74fa12dd962fe4e9ee14fd8140d2abb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N2U6sx_cZ_QmKhX25la6Og.png"/></div></div><figcaption class="mc md et er es me mf bd b be z dx translated">图片来源:AWS</figcaption></figure><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mz"><img src="../Images/a001c2730bf11354e7e3115464419a16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cjwPOC6xtXN6FaA13eYD8A.png"/></div></div><figcaption class="mc md et er es me mf bd b be z dx translated">图片来源:AWS</figcaption></figure><h1 id="ac78" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">为 Lambda 函数创建触发器</h1><p id="20ac" class="pw-post-body-paragraph km kn hi iz b ja ko ij kp jc kq im kr je ks kt ku jg kv kw kx ji ky kz la jk hb bi translated">现在是时候配置我们的 Lambda 函数由 S3 事件触发了。</p><h2 id="9c30" class="mh jv hi bd jw mi mj mk ka ml mm mn ke je mo mp kg jg mq mr ki ji ms mt kk mu bi translated">为 Lambda 配置 S3 事件</h2><ol class=""><li id="5959" class="ix iy hi iz b ja ko jc kq je ln jg lo ji lp jk jl jm jn jo bi translated">导航到 AWS S3 控制台页面。</li><li id="f301" class="ix iy hi iz b ja jp jc jq je jr jg js ji jt jk jl jm jn jo bi translated">导航到我们的输入设置-…桶。</li><li id="19e4" class="ix iy hi iz b ja jp jc jq je jr jg js ji jt jk jl jm jn jo bi translated">导航到存储桶的属性。</li><li id="8ad4" class="ix iy hi iz b ja jp jc jq je jr jg js ji jt jk jl jm jn jo bi translated">滚动到该时段的事件。</li><li id="fa8d" class="ix iy hi iz b ja jp jc jq je jr jg js ji jt jk jl jm jn jo bi translated">在 Events 窗口中，选择 Add notification 并设置以下属性:<br/>为事件添加一个有意义的名称，选中所有对象创建事件，并在“<strong class="iz hj">Send to”</strong>中选择在之前的任务中创建的 Lambda 函数并保存。</li></ol><h2 id="b34b" class="mh jv hi bd jw mi mj mk ka ml mm mn ke je mo mp kg jg mq mr ki ji ms mt kk mu bi translated">确认 S3 事件触发器是否被添加到我们的 Lambda 函数中。</h2><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es na"><img src="../Images/631bf0e645d46f24afca466e90020ed6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ydM-SX3NbSEXVI02D4puw.png"/></div></div><figcaption class="mc md et er es me mf bd b be z dx translated">图片来源:AWS</figcaption></figure><h2 id="3b4c" class="mh jv hi bd jw mi mj mk ka ml mm mn ke je mo mp kg jg mq mr ki ji ms mt kk mu bi translated">尝试触发一个 S3 事件并检查 CloudWatch 日志，您会看到显示的消息。</h2><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es nb"><img src="../Images/3a9734a07a8cd48efd0219b4e03539e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jhXEHLzXuU6-N3JN"/></div></div><figcaption class="mc md et er es me mf bd b be z dx translated">照片由<a class="ae lb" href="https://unsplash.com/@semisunar?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯捷潘·乌纳尔</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure></div></div>    
</body>
</html>