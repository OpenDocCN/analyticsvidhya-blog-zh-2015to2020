<html>
<head>
<title>T-SQL : Finding Fill Rate of Table</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">T-SQL:查找表的填充率</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/t-sql-finding-fill-rate-of-table-908b67220ea?source=collection_archive---------14-----------------------#2020-11-28">https://medium.com/analytics-vidhya/t-sql-finding-fill-rate-of-table-908b67220ea?source=collection_archive---------14-----------------------#2020-11-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ff77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">填充率是许多业务相关决策中最重要的指标之一。因此，了解填充率是业务流程中数据分析和决策的基本任务之一。在本文中，我们将解释如何使用T-SQL查询来查找表的填充率。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/fdea0147de02d9af0f960751fc12bd04.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*cXAxdy7Q3pH69msSK34w7Q.jpeg"/></div></figure><p id="c673" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">观察填充率是了解和提高数据质量的关键因素，这为我们的管理层和最终用户创造了满足感。需要找到一个表的填充率，怎么做？</p><h1 id="c7b8" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">填充率是什么意思？</h1><p id="aa73" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated"><strong class="ih hj">填充率</strong>被定义为每一列级别的填充条目数除以表中的总行数。根据表中的总行数，我们可以很容易地计算出填充率。</p><h1 id="ea26" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">挑战</h1><p id="b99c" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">像下面这样的<strong class="ih hj"> <em class="ko">模式变化</em> </strong>使得我们的填充率方法比实际几乎没有困难。</p><ul class=""><li id="d9e5" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">表名更改</li><li id="261b" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">列名更改</li><li id="12af" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">数据类型更改</li><li id="e27e" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">删除现有列</li><li id="59db" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">添加新列</li></ul><p id="e292" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于上述挑战，我们不能简单地用静态解决方案来寻找表格的填充率。相反，我们需要类似动态方法的东西来避免我们未来的返工。</p><h1 id="40d6" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">先决条件</h1><p id="69fe" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">在下面的示例中，我们将使用一个名为'<strong class="ih hj"> <em class="ko"> Get_FillRate </em> </strong>'的存储过程进行演示。如果任何一个在数据库中有相同的对象名，请确保更改下面的存储过程名。</p><h1 id="b3e9" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">使用数据加载脚本创建示例表</h1><p id="24ee" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated"><code class="du ld le lf lg b">--dropping temp table if exists</code></p><p id="20fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">IF OBJECT_ID('TempDb..#TestEmp') <strong class="ih hj">IS</strong></code> <code class="du ld le lf lg b">NOT</code> <code class="du ld le lf lg b">NULL</code></p><p id="d52f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">DROP</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">TABLE</strong></code> <code class="du ld le lf lg b">#TestEmp;</code></p><p id="747c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">CREATE</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">TABLE</strong></code> <code class="du ld le lf lg b">#TestEmp</code></p><p id="bc14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">(</code></p><p id="1855" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[TestEmp_Key] <strong class="ih hj">INT</strong></code> <code class="du ld le lf lg b">IDENTITY(1,1) NOT</code> <code class="du ld le lf lg b">NULL,</code></p><p id="79ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[EmpName] <strong class="ih hj">VARCHAR</strong>(100) NOT</code>T15】</p><p id="5c34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[Age] <strong class="ih hj">INT</strong></code> <code class="du ld le lf lg b">NULL,</code></p><p id="814c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[Address] <strong class="ih hj">VARCHAR</strong>(100) NULL,</code></p><p id="a068" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[PhoneNo] <strong class="ih hj">VARCHAR</strong>(11) NULL,</code></p><p id="5b6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[Inserted_dte] DATETIME NOT</code> <code class="du ld le lf lg b">NULL,</code></p><p id="0a6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[Updated_dte] DATETIME NULL,</code></p><p id="0694" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">CONSTRAINT</strong></code><code class="du ld le lf lg b">[PK_TestEmp] <strong class="ih hj">PRIMARY</strong></code><code class="du ld le lf lg b"><strong class="ih hj">KEY</strong></code>T6】</p><p id="e277" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">(</code></p><p id="c129" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">TestEmp_Key <strong class="ih hj">ASC</strong></code></p><p id="d4d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">)</code></p><p id="06da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">);</code></p><p id="a4e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">GO</code></p><p id="9d22" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">INSERT</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">INTO</strong></code> <code class="du ld le lf lg b">#TestEmp</code></p><p id="e08a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">(EmpName,Age,[Address],PhoneNo,Inserted_dte)</code></p><p id="4b0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">VALUES</strong></code></p><p id="27e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">('Arul',24,'xxxyyy','1234567890',GETDATE()),</code></p><p id="0fdf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">('Gokul',22,'zzzyyy',NULL,GETDATE()),</code></p><p id="ddef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">('Krishna',24,'aaa','',GETDATE()),</code></p><p id="fbff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">('Adarsh',25,'bbb','1234567890',GETDATE()),</code></p><p id="a729" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">('Mani',21,'',NULL,GETDATE()),</code></p><p id="f1ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">('Alveena',20,'ddd',NULL,GETDATE()),</code></p><p id="0afa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">('Janani',30,'eee','',GETDATE()),</code></p><p id="f58a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">('Vino',26,NULL,'1234567890',GETDATE()),</code></p><p id="f9de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">('Madhi',25,'ggg',NULL,GETDATE()),</code></p><p id="da36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">('Ronen',25,'ooo',NULL,GETDATE()),</code></p><p id="6d8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">('Visakh',25,'www',NULL,GETDATE()),</code></p><p id="9411" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">('Jayendran',NULL,NULL,NULL,GETDATE());</code></p><p id="6f87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">GO</code></p><p id="3d52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SELECT</strong></code>T31<code class="du ld le lf lg b">#TestEmp;</code></p><p id="95a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">GO</code></p><p id="12c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">临时表— #TestEmp </strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lh"><img src="../Images/0deff3da455ac0e2d630926d7bcb0ac2.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*KsDkHCu0tbvTbc9OIRG62w.png"/></div></figure><h1 id="f548" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">在表中查找填充率的SQL过程—动态方法</h1><p id="880c" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">输入参数</p><p id="9190" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这两个输入参数都是必需的。</p><p id="4966" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.<em class="ko"> @p_TableName </em> —用于此输入参数的数据类型为NVARCHAR(128)，可空性不为NULL。</p><p id="0e90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.<em class="ko">@ p _ Include _ BlankAsNotFilled</em>—用于此输入参数的数据类型为BIT，可空性不为NULL，需要给出0或1。默认为0，0表示关闭。1为开(当给定为1时—空白条目将被视为未填充数据)。</p><p id="6f1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出列</p><p id="22d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有两个输出列。这两个都是不可空的输出列。</p><p id="cbe5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.<em class="ko">【列名】</em> —用于此输出列的数据类型为sysname，可空性不为NULL。用户给定表名的所有列名将作为行值出现。</p><p id="0d0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.<em class="ko">[填充率(%)] </em> —用于此输出列的数据类型为DECIMAL(5，2)，可空性不为NULL。从0.00到100.00的值将以各自的列名出现在结果中。</p><p id="194b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">信息注册存储过程</p><ul class=""><li id="f2a8" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">创建了名为—'<strong class="ih hj"><em class="ko">Get _ FillRate</em></strong>'的存储过程。</li><li id="8062" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">为了避免返回的行数，请将NOCOUNT设置为ON。</li><li id="f12a" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">Try，Catch块是为错误处理添加的。</li><li id="e2a3" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">若要读取未提交的修改，请将事务隔离级别设置为read Uncommitted。</li><li id="a738" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">还包括参数嗅探概念。</li><li id="6613" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">对表名输入参数进行了一些处理，以支持用户键入表名格式，如。表名'，'..表名'，'…表名'，'表名'，'[表名]'，' dbo .表名'，' dbo。'[表名]'，'[数据库]。[table_name]'等。,</li><li id="9922" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">开始时包括验证，当用户给出的不是“表名”时，存储过程将抛出“<em class="ko">表不在此数据库</em>中”作为错误消息。</li><li id="f22d" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">名为SYS的系统表。对象和系统。名为INFORMATION_SCHEMA的列和系统视图。列在存储过程中使用。</li><li id="e2e2" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">INFORMATION_SCHEMA的ORDINAL_POSITION。COLUMNS用于返回与表结构已有的列顺序相同的结果集。</li><li id="a4b3" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">来自信息架构的排序规则名称。列是用来支持条件的，像空白是要么需要考虑要么不需要，作为未填充的条目。</li><li id="5093" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">信息架构中的COLUMN_NAME。列来显示具有各自填充率的最终结果集。</li><li id="a5f7" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">使用动态查询来支持动态方法，这将避免静态解决方案中出现的所有挑战，如模式更改。</li><li id="e8cd" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">方法1(使用WHILE循环的动态查询)和方法2(使用UNION ALL的动态查询)产生相同的结果集，并具有相同的功能，其中一些指标(如CPU时间、运行时间、逻辑读取)在方法2中更好。</li></ul><h1 id="6557" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">方法1-使用WHILE循环</h1><p id="1e41" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">CREATE</strong></code><code class="du ld le lf lg b">OR</code><code class="du ld le lf lg b"><strong class="ih hj">ALTER</strong></code><code class="du ld le lf lg b"><strong class="ih hj">PROCEDURE</strong></code>T4】</p><p id="7e9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">(</code></p><p id="0870" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">@p_TableName NVARCHAR(128),</code></p><p id="ccff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">@p_Include_BlankAsNotFilled <strong class="ih hj">BIT</strong></code> <code class="du ld le lf lg b">= 0 -- 0-OFF(Default); 1-ON(Blank As Not Filled Data)</code></p><p id="e3fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">)</code></p><p id="851f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">AS</strong></code></p><p id="8925" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">BEGIN</strong></code></p><p id="699d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">BEGIN</strong></code> <code class="du ld le lf lg b">TRY</code></p><p id="45f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SET</strong></code>T3】</p><p id="90f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">TRANSACTION</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">ISOLATION</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">LEVEL</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">READ</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">UNCOMMITTED</strong>;</code></p><p id="5c6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">--Parameter Sniffing</code></p><p id="ff80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">DECLARE</strong></code>T12】</p><p id="c548" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">@Include_BlankAsNotFilled <strong class="ih hj">BIT</strong>,</code></p><p id="4ced" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">@ColumnName NVARCHAR(128),</code></p><p id="fdbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">@R_NO <strong class="ih hj">INT</strong>,</code></p><p id="b152" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">@DataType_Field <strong class="ih hj">BIT</strong>,</code></p><p id="d643" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">@i <strong class="ih hj">INT</strong>, --Iteration</code></p><p id="f9ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">@RESULT NVARCHAR(<strong class="ih hj">MAX</strong>);</code></p><p id="e67f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SELECT</strong></code> <code class="du ld le lf lg b">@TableName = @p_TableName,</code></p><p id="307e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">@Include_BlankAsNotFilled = @p_Include_BlankAsNotFilled,</code></p><p id="1e45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">@i = 1;</code></p><p id="6ba4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">--To Support some of the table formats that user typing.</code></p><p id="6fca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SELECT</strong></code>T25】</p><p id="ae15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">--validation</code></p><p id="dcdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">IF NOT</code><code class="du ld le lf lg b">EXISTS(<strong class="ih hj">SELECT</strong></code><code class="du ld le lf lg b">1 <strong class="ih hj">FROM</strong></code><code class="du ld le lf lg b">SYS.OBJECTS <strong class="ih hj">WHERE</strong></code><code class="du ld le lf lg b">[TYPE]='U'</code><code class="du ld le lf lg b">AND</code><code class="du ld le lf lg b">[<strong class="ih hj">NAME</strong>]=@TableName )</code></p><p id="db72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">BEGIN</strong></code></p><p id="f50d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SELECT</strong></code><code class="du ld le lf lg b">Result = 1 , Reason ='Table not exists in this Database'</code>T37】</p><p id="0c72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">RETURN</strong></code> <code class="du ld le lf lg b">1;</code></p><p id="8b50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">END</strong>;</code></p><p id="e7e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">--dropping temp table if exists - for debugging purpose</code></p><p id="f6fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">【T2<code class="du ld le lf lg b">NOT</code><code class="du ld le lf lg b">NULL</code></p><p id="a6fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">DROP</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">TABLE</strong></code> <code class="du ld le lf lg b">#<strong class="ih hj">Temp</strong>;</code></p><p id="e6e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">IF OBJECT_ID('TempDb..#Columns') <strong class="ih hj">IS</strong></code> <code class="du ld le lf lg b">NOT</code> <code class="du ld le lf lg b">NULL</code></p><p id="a909" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">DROP</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">TABLE</strong></code> <code class="du ld le lf lg b">#Columns;</code></p><p id="f810" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">--temp table creations</code></p><p id="c7d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">CREATE</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">TABLE</strong></code> <code class="du ld le lf lg b">#<strong class="ih hj">Temp</strong></code></p><p id="93c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">(</code></p><p id="64a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[R_NO] <strong class="ih hj">INT</strong></code> <code class="du ld le lf lg b">NOT</code> <code class="du ld le lf lg b">NULL,</code></p><p id="0ae4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[ColumnName] NVARCHAR(128) NOT</code> <code class="du ld le lf lg b">NULL,</code></p><p id="a902" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[FillRate] <strong class="ih hj">DECIMAL</strong>(5,2) NOT</code>T25】</p><p id="0f1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">PRIMARY</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">KEY</strong></code> <code class="du ld le lf lg b">CLUSTERED (ColumnName)</code></p><p id="9ef7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">);</code></p><p id="695b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">CREATE</strong></code>T31<code class="du ld le lf lg b">#Columns</code></p><p id="c777" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">(</code></p><p id="7e91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[R_NO] <strong class="ih hj">INT</strong></code>T35】T36】</p><p id="b98c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[<strong class="ih hj">Name</strong>] [sysname] NOT</code> <code class="du ld le lf lg b">NULL,</code></p><p id="8df1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[DataType_Field] <strong class="ih hj">BIT</strong></code> <code class="du ld le lf lg b">NOT</code> <code class="du ld le lf lg b">NULL</code></p><p id="1794" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">PRIMARY</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">KEY</strong></code> <code class="du ld le lf lg b">CLUSTERED ([<strong class="ih hj">Name</strong>])</code></p><p id="f081" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">);</code></p><p id="1ccc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">INSERT</strong></code><code class="du ld le lf lg b"><strong class="ih hj">INTO</strong></code>T2】</p><p id="aa30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SELECT</strong></code></p><p id="88c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">COLUMN_ID,</code></p><p id="8b5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[<strong class="ih hj">Name</strong>],</code></p><p id="da97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">IIF(collation_name <strong class="ih hj">IS</strong></code> <code class="du ld le lf lg b">NULL,0,1)</code></p><p id="84cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">FROM</strong></code> <code class="du ld le lf lg b">SYS.COLUMNS <strong class="ih hj">WHERE</strong></code> <code class="du ld le lf lg b">OBJECT_ID = OBJECT_ID(@TableName);</code></p><p id="5a86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">WHILE @i &lt;= ( <strong class="ih hj">SELECT</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">MAX</strong>(R_NO) <strong class="ih hj">FROM</strong></code> <code class="du ld le lf lg b">#Columns) --Checking of Iteration till total number of columns</code></p><p id="1624" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">BEGIN</strong></code></p><p id="f575" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SELECT</strong></code> <code class="du ld le lf lg b">@DataType_Field=DataType_Field,@ColumnName=[<strong class="ih hj">Name</strong>],@R_NO=[R_NO] <strong class="ih hj">FROM</strong></code> <code class="du ld le lf lg b">#Columns <strong class="ih hj">WHERE</strong></code> <code class="du ld le lf lg b">R_NO = @i;</code></p><p id="0034" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SET</strong></code> <code class="du ld le lf lg b">@RESULT =</code></p><p id="a743" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">'INSERT INTO #Temp ([R_NO],[ColumnName], [FillRate]) '</code> <code class="du ld le lf lg b">+</code></p><p id="67d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">'SELECT '</code>T24】</p><p id="47d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">'''</code> <code class="du ld le lf lg b">+ @ColumnName + ''',</code></p><p id="d783" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">CAST((100*(SUM(</code></p><p id="1957" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">CASE WHEN '</code>T29】</p><p id="2e90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">CASE</code></p><p id="0bb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">WHEN</strong></code> <code class="du ld le lf lg b">@Include_BlankAsNotFilled = 0</code></p><p id="f9c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">THEN</strong></code>T34<code class="du ld le lf lg b">+ @ColumnName + '] IS NOT NULL'</code></p><p id="90d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">WHEN</strong></code> <code class="du ld le lf lg b">@DataType_Field = 0</code></p><p id="3dc9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">THEN</strong></code>T39<code class="du ld le lf lg b">+ @ColumnName + '] IS NOT NULL'</code></p><p id="fa45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">ELSE</strong></code><code class="du ld le lf lg b">'ISNULL(['</code><code class="du ld le lf lg b">+ @ColumnName + '],'''')&lt;&gt;'''' '</code><code class="du ld le lf lg b"><strong class="ih hj">END</strong></code>T4】</p><p id="9d45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">' THEN 1 ELSE 0 END)*1.0 / COUNT(*)))</code></p><p id="b623" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">AS DECIMAL(5,2))</code></p><p id="5a83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">FROM '</code> <code class="du ld le lf lg b">+ @TableName;</code></p><p id="4286" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">--PRINT(@RESULT); --for debug purpose</code></p><p id="e9a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">EXEC</strong>(@RESULT);</code></p><p id="0dd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SET</strong></code>T12】</p><p id="879d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">END</strong>;</code></p><p id="0221" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">--Final Result Set</code></p><p id="d714" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SELECT</strong></code></p><p id="25cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">ColumnName <strong class="ih hj">AS</strong></code> <code class="du ld le lf lg b">[<strong class="ih hj">Column</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">Name</strong>],</code></p><p id="ad6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">FillRate <strong class="ih hj">AS</strong></code> <code class="du ld le lf lg b">[Fill Rate (%)]</code></p><p id="59e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">FROM</strong></code> <code class="du ld le lf lg b">#<strong class="ih hj">TEMP</strong></code></p><p id="1291" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">ORDER</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">BY</strong></code> <code class="du ld le lf lg b">[R_NO];</code></p><p id="f221" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">RETURN</strong></code> <code class="du ld le lf lg b">0;</code></p><p id="d9d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">END</strong></code>T29】</p><p id="2471" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">BEGIN</strong></code> <code class="du ld le lf lg b">CATCH --error handling even it is fetching stored procedure</code></p><p id="a550" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SELECT</strong></code></p><p id="ed4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">ERROR_NUMBER() <strong class="ih hj">AS</strong></code> <code class="du ld le lf lg b">ErrorNumber</code></p><p id="4298" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">,ERROR_SEVERITY() <strong class="ih hj">AS</strong></code> <code class="du ld le lf lg b">ErrorSeverity</code></p><p id="fef5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">,ERROR_STATE() <strong class="ih hj">AS</strong></code> <code class="du ld le lf lg b">ErrorState</code></p><p id="8e2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">,ERROR_PROCEDURE() <strong class="ih hj">AS</strong></code> <code class="du ld le lf lg b">ErrorProcedure</code></p><p id="35ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">,ERROR_LINE() <strong class="ih hj">AS</strong></code> <code class="du ld le lf lg b">ErrorLine</code></p><p id="3226" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">,ERROR_MESSAGE() <strong class="ih hj">AS</strong></code> <code class="du ld le lf lg b">ErrorMessage;</code></p><p id="4cce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">RETURN</strong></code>T3】</p><p id="58e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">END</strong></code> <code class="du ld le lf lg b">CATCH;</code></p><p id="3b27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">END</strong>;</code></p><p id="9358" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">通过传递如下表名来执行存储过程方法1</strong></p><p id="55af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们需要单独将空值视为未填充，则执行如下</p><p id="5784" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">EXEC</strong></code> <code class="du ld le lf lg b">[Get_FillRate] @p_TableName='#TestEmp',@p_Include_BlankAsNotFilled=0;</code></p><p id="11ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们需要将空值和空值都视为未填充，则按如下方式执行</p><p id="4336" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">EXEC</strong></code> <code class="du ld le lf lg b">[Get_FillRate] @p_TableName='#TestEmp',@p_Include_BlankAsNotFilled=1;</code></p><p id="e9d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">方法1-输出</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es li"><img src="../Images/f996d043ab890396d46bb5582b6831af.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*6Kz07A8Z5eB4VQwTUfkEtA.png"/></div></figure><h1 id="3c4c" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">方法2 —使用UNION ALL</h1><p id="3b54" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">CREATE</strong></code> <code class="du ld le lf lg b">OR</code> <code class="du ld le lf lg b"><strong class="ih hj">ALTER</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">PROCEDURE</strong></code> <code class="du ld le lf lg b">[dbo].[Get_FillRate]</code></p><p id="eaa2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">(</code></p><p id="29d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">@p_TableName NVARCHAR(128),</code></p><p id="e635" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">@p_Include_BlankAsNotFilled <strong class="ih hj">BIT</strong></code>T19】</p><p id="3cd4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">)</code></p><p id="5d85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">AS</strong></code></p><p id="6eaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">BEGIN</strong></code></p><p id="3f20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">BEGIN</strong></code>T24】</p><p id="3722" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SET</strong></code> <code class="du ld le lf lg b">NOCOUNT <strong class="ih hj">ON</strong>;</code></p><p id="bc79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SET</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">TRANSACTION</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">ISOLATION</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">LEVEL</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">READ</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">UNCOMMITTED</strong>;</code></p><p id="1369" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">--Parameter Sniffing</code></p><p id="ca16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">DECLARE</strong></code> <code class="du ld le lf lg b">@TableName NVARCHAR(128),</code></p><p id="e846" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">@Include_BlankAsNotFilled <strong class="ih hj">BIT</strong>,</code></p><p id="29b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">@RESULT NVARCHAR(<strong class="ih hj">MAX</strong>);</code></p><p id="2311" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SELECT</strong></code> <code class="du ld le lf lg b">@TableName = @p_TableName,</code></p><p id="0aac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">@Include_BlankAsNotFilled = @p_Include_BlankAsNotFilled,</code></p><p id="9e4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">@RESULT = '';</code></p><p id="6110" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">--To Support some of the table formats that user typing.</code></p><p id="1d83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SELECT</strong></code> <code class="du ld le lf lg b">@TableName =REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@TableName,'[',''),']',''),'dbo.',''),'...',''),'..',''),'.','');</code></p><p id="9430" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">--validation</code></p><p id="5398" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">【T9<code class="du ld le lf lg b">EXISTS(<strong class="ih hj">SELECT</strong></code><code class="du ld le lf lg b">1 <strong class="ih hj">FROM</strong></code><code class="du ld le lf lg b">SYS.OBJECTS <strong class="ih hj">WHERE</strong></code><code class="du ld le lf lg b">[TYPE]='U'</code><code class="du ld le lf lg b">AND</code><code class="du ld le lf lg b">[<strong class="ih hj">NAME</strong>]=@TableName )</code></p><p id="fcd9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">BEGIN</strong></code></p><p id="3459" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SELECT</strong></code> <code class="du ld le lf lg b">Result = 1 , Reason ='Table not exists in this Database'</code> <code class="du ld le lf lg b">;</code></p><p id="db19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">RETURN</strong></code> <code class="du ld le lf lg b">1;</code></p><p id="6b48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">END</strong>;</code></p><p id="5b26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">--dropping temp table if exists - for debugging purpose</code></p><p id="bbbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">IF OBJECT_ID('TempDb..#Columns') <strong class="ih hj">IS</strong></code> <code class="du ld le lf lg b">NOT</code> <code class="du ld le lf lg b">NULL</code></p><p id="e742" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">DROP</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">TABLE</strong></code> <code class="du ld le lf lg b">#Columns;</code></p><p id="94fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">--temp table creations</code></p><p id="22dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">CREATE</strong></code>T32<code class="du ld le lf lg b">#Columns</code></p><p id="ecc0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">(</code></p><p id="691a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[ORDINAL_POSITION] <strong class="ih hj">INT</strong></code><code class="du ld le lf lg b">NOT</code>T37】</p><p id="72f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[COLUMN_NAME] [sysname] NOT</code> <code class="du ld le lf lg b">NULL,</code></p><p id="48f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[DataType_Field] <strong class="ih hj">BIT</strong></code> <code class="du ld le lf lg b">NOT</code> <code class="du ld le lf lg b">NULL,</code></p><p id="94f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[TABLE_NAME] [sysname] NOT</code> <code class="du ld le lf lg b">NULL</code></p><p id="11f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">【T2<code class="du ld le lf lg b"><strong class="ih hj">KEY</strong></code><code class="du ld le lf lg b">CLUSTERED ([ORDINAL_POSITION],[COLUMN_NAME])</code></p><p id="64aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">);</code></p><p id="b805" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">INSERT</strong></code> <code class="du ld le lf lg b"><strong class="ih hj">INTO</strong></code> <code class="du ld le lf lg b">#Columns ([ORDINAL_POSITION],[COLUMN_NAME],[DataType_Field],[TABLE_NAME])</code></p><p id="b865" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SELECT</strong></code></p><p id="d02d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[ORDINAL_POSITION],</code></p><p id="7036" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[COLUMN_NAME],</code></p><p id="4f87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">CASE</code><code class="du ld le lf lg b"><strong class="ih hj">WHEN</strong></code><code class="du ld le lf lg b">COLLATION_NAME <strong class="ih hj">IS</strong></code><code class="du ld le lf lg b">NOT</code><code class="du ld le lf lg b">NULL</code><code class="du ld le lf lg b"><strong class="ih hj">THEN</strong></code><code class="du ld le lf lg b">1 <strong class="ih hj">ELSE</strong></code>T19】</p><p id="9c15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">[TABLE_NAME]</code></p><p id="8706" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">FROM</strong></code> <code class="du ld le lf lg b">INFORMATION_SCHEMA.COLUMNS <strong class="ih hj">WHERE</strong></code> <code class="du ld le lf lg b">TABLE_NAME =@tablename; --Using System_View</code></p><p id="459a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">--Final Result Set</code></p><p id="3dd3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SELECT</strong></code> <code class="du ld le lf lg b">@RESULT = @RESULT+ N'SELECT '''+C.COLUMN_NAME+''' AS [Column Name],</code></p><p id="da9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">CAST((100*(SUM(</code></p><p id="364e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">CASE WHEN '</code>T29】</p><p id="c1e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">CASE</code></p><p id="8c98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">WHEN</strong></code> <code class="du ld le lf lg b">@include_blankasnotfilled = 0</code></p><p id="1073" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">THEN</strong></code>T34<code class="du ld le lf lg b">+ C.COLUMN_NAME + '] IS NOT NULL'</code></p><p id="36df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">WHEN</strong></code> <code class="du ld le lf lg b">C.[DataType_Field]=0</code></p><p id="1148" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">THEN</strong></code>T39<code class="du ld le lf lg b">+ C.COLUMN_NAME + '] IS NOT NULL'</code></p><p id="99c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">ELSE</strong></code><code class="du ld le lf lg b">'ISNULL(['</code><code class="du ld le lf lg b">+ C.COLUMN_NAME + '],'''')&lt;&gt;'''' '</code><code class="du ld le lf lg b"><strong class="ih hj">END</strong></code>T4】</p><p id="2ae0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">' THEN 1 ELSE 0 END)*1.0 / COUNT(*)))</code></p><p id="17d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">AS DECIMAL(5,2)) AS [Fill Rate (%)]</code></p><p id="8f86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">FROM '+C.TABLE_NAME+' UNION ALL '</code></p><p id="3567" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">FROM</strong></code>T9】</p><p id="df81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SET</strong></code>T11】</p><p id="f01c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">--PRINT(@RESULT); --for debug purpose</code></p><p id="6c2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">EXEC</strong>(@RESULT);</code></p><p id="4d5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">RETURN</strong></code>T15】</p><p id="e638" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">END</strong></code> <code class="du ld le lf lg b">TRY</code></p><p id="6c60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">BEGIN</strong></code>T19】</p><p id="5f7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">SELECT</strong></code></p><p id="77f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">ERROR_NUMBER() <strong class="ih hj">AS</strong></code> <code class="du ld le lf lg b">ErrorNumber</code></p><p id="1cef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">,ERROR_SEVERITY() <strong class="ih hj">AS</strong></code>T24】</p><p id="8a4f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">,ERROR_STATE() <strong class="ih hj">AS</strong></code> <code class="du ld le lf lg b">ErrorState</code></p><p id="0980" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">,ERROR_PROCEDURE() <strong class="ih hj">AS</strong></code> <code class="du ld le lf lg b">ErrorProcedure</code></p><p id="9552" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">,ERROR_LINE() <strong class="ih hj">AS</strong></code> <code class="du ld le lf lg b">ErrorLine</code></p><p id="1e42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">,ERROR_MESSAGE() <strong class="ih hj">AS</strong></code> <code class="du ld le lf lg b">ErrorMessage;</code></p><p id="6ad1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">RETURN</strong></code> <code class="du ld le lf lg b">1;</code></p><p id="ec0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">END</strong></code> <code class="du ld le lf lg b">CATCH;</code></p><p id="8af0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">END</strong>;</code></p><p id="2314" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">通过如下方式传递表名来执行存储过程方法2</strong></p><p id="2991" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们需要单独将空值视为未填充，则执行如下</p><p id="10de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">EXEC</strong></code> <code class="du ld le lf lg b">[Get_FillRate] @p_TableName='#TestEmp',@p_Include_BlankAsNotFilled=0;</code></p><p id="a870" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们需要将空值和空值都视为未填充，则按如下方式执行</p><p id="fb7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b"><strong class="ih hj">EXEC</strong></code> <code class="du ld le lf lg b">[Get_FillRate] @p_TableName='#TestEmp',@p_Include_BlankAsNotFilled=1;</code></p><p id="6175" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">方法2-输出</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lj"><img src="../Images/62d8cc25ce5d8f074b6798094dcf6de3.png" data-original-src="https://miro.medium.com/v2/resize:fit:472/format:webp/1*3DBlBm5f38Lo1bvIGdirdw.png"/></div></figure><h1 id="d613" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">方法1与方法2之间的指标差异</h1><p id="f6e9" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">为了了解方法1与方法2之间的区别，需要考虑以下四个指标</p><ul class=""><li id="f56a" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">执行查询计划中查询集的数量</li><li id="31eb" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">总CPU时间(毫秒)</li><li id="78a2" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">总运行时间(毫秒)</li><li id="8991" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">逻辑读取总数</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lk"><img src="../Images/ec904d966a672b53a829fa7147e5138b.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*I0BMZUsEbRjNhjfFtfu5rw.png"/></div></div></figure><p id="2069" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总之，我们已经看到了如何使用T-SQL查询来查找表的填充率，该查询适用于在AZURE和本地SQL数据库中运行。因此，它将帮助我们有效且迅速地做出商业决策。</p><h1 id="7b87" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">未来范围</h1><p id="9784" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">作为未来的范围，我们可以做更多的增强(下面提到的一些想法),并可以做更多的事情，如支持填充率</p><ul class=""><li id="bdb2" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">数据库中表的必需列列表(使用exclude/include选项和column_list作为输入参数)</li><li id="6411" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">数据库中必需的列列表(通过为列名引入单独的输入参数并支持表名中的null)</li><li id="63f2" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">数据库中所需的表列表(通过更改输入参数中的数据长度)</li><li id="3071" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">数据库中的所有表(通过删除表名过滤器)</li></ul><h1 id="f2cd" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">参考</h1><ul class=""><li id="27a6" class="kp kq hi ih b ii kj im kk iq lp iu lq iy lr jc ku kv kw kx bi translated"><a class="ae ls" href="https://arulmouzhi.wordpress.com/2019/11/22/to-find-fill-rate-in-a-table-on-both-azure-and-on-premise-key-metric-in-data-analysis/" rel="noopener ugc nofollow" target="_blank">在AZURE和本地的表格中查找填充率—数据分析中的关键指标</a></li></ul></div></div>    
</body>
</html>