<html>
<head>
<title>A dive into D3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深入D3</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/a-dive-into-d3-216c8d9b84de?source=collection_archive---------29-----------------------#2020-06-01">https://medium.com/analytics-vidhya/a-dive-into-d3-216c8d9b84de?source=collection_archive---------29-----------------------#2020-06-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/196b1a7a8187e44eccd25296f4c8ac08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bUOe_sh9jSSkHnakoVLtDA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd iu">米卡·鲍梅斯特在Unsplash上拍摄的照片</strong></figcaption></figure><p id="ebc3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae jt" href="https://d3js.org/" rel="noopener ugc nofollow" target="_blank"> D3 </a>，或者数据驱动文档，仍然是浏览器中数据可视化的首选。它的强大之处在于它不仅仅是一个图表库，而是一种添加和操作DOM元素以响应数据的方式。</p><p id="0c68" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae jt" href="https://bl.ocks.org/mbostock/e6962a152275373f8504" rel="noopener ugc nofollow" target="_blank">正如</a> <a class="ae jt" href="https://observablehq.com/@mbostock/epicyclic-gearing" rel="noopener ugc nofollow" target="_blank">这些</a> <a class="ae jt" href="https://qz.com/296941/interactive-graphic-every-active-satellite-orbiting-earth/" rel="noopener ugc nofollow" target="_blank">例子</a> <a class="ae jt" href="https://www.nytimes.com/interactive/2014/upshot/buy-rent-calculator.html" rel="noopener ugc nofollow" target="_blank">展示</a>，这为用数据说明的原创方式以及创造性编码提供了看似无限的可能性。</p><p id="f564" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，所有这些能力都伴随着陡峭的学习曲线，D3需要一些投资才能成为可靠的工具。如果您的用例只是将标准数据图表添加到前端应用程序中，请使用<a class="ae jt" href="https://www.chartjs.org/" rel="noopener ugc nofollow" target="_blank">图表。Js </a>(以及一些商业产品)可能是一个更友好的解决方案。但是，如果您对呈现特别大、独特或复杂的数据集的原始方式感兴趣，那么深入研究D3无疑是值得的。</p><p id="2275" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本教程将作为一个出发点。我们将构建一个简单的SPA，用折线图展示一个地点未来五天的预测。虽然不是一个特别令人兴奋的结果，但我的意图是展示D3使用数据操纵DOM的一些基本方式。这可以作为使用该工具进一步探索的起点，并有助于理解<a class="ae jt" href="https://bl.ocks.org/" rel="noopener ugc nofollow" target="_blank">众多D3示例</a>中的代码。注意，为了构建本教程的折线图，我大量借鉴了<a class="ae jt" href="https://bl.ocks.org/pstuffa/26363646c478b2028d36e7274cedefa6" rel="noopener ugc nofollow" target="_blank">这个例子</a>。</p><h1 id="d273" class="ju jv hi bd iu jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">0.先决条件</h1><p id="335c" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">本教程是为任何初学者到高级前端开发人员设计的，他们正在寻找设置一些标准D3方法的介绍。我将介绍使用来自<a class="ae jt" href="https://openweathermap.org/api" rel="noopener ugc nofollow" target="_blank"> OpenWeatherMap </a> API的数据创建线图的一些基本步骤，描述我们在每个步骤中分配给D3的任务。本教程假设您熟悉基本的前端概念，如javascript函数、AJAX调用，并使用jQuery来简化DOM元素的选择。要设置和运行样板代码，您至少需要熟悉Github并运行本地HTTP服务器(全局安装<a class="ae jt" href="https://www.npmjs.com/package/http-server" rel="noopener ugc nofollow" target="_blank"> http-server </a>是一个简单的选择)。</p><h1 id="1caf" class="ju jv hi bd iu jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">1.样板文件之旅</h1><p id="4598" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">Github repo的<a class="ae jt" href="https://github.com/jsheridanwells/dive-into-d3" rel="noopener ugc nofollow" target="_blank">drive-Into-D3</a>有一些样板文件可以让我们开始。<code class="du kw kx ky kz b">master</code>分支包含我们的起点。如果只是想看结果，可以切换到<code class="du kw kx ky kz b">final</code>分支。要么克隆回购(<code class="du kw kx ky kz b">$ git clone git@github.com:jsheridanwells/dive-into-d3.git</code>)或下载并解压压缩文件。从项目的根目录运行您的HTTP服务器(如果您使用http-server，则为<code class="du kw kx ky kz b">$ http-server -o</code>)。</p><p id="88d3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">导航到项目的<code class="du kw kx ky kz b">index.html</code>文件(对我来说是<code class="du kw kx ky kz b">http://localhost:8080</code>，我们可以看到一个非常基本的导航条，让用户输入美国邮政编码(我硬编码了<a class="ae jt" href="https://en.wikipedia.org/wiki/Willis_Tower" rel="noopener ugc nofollow" target="_blank"> 60606 </a>以使手动测试更容易)。因为我是从美国写信的，所以我使用华氏温度的邮政编码来表示地点和温度，但是代码可以很容易地调整以适应其他地区。</p><p id="e55d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面将是一个空间，以显示天气图时，建立。如果您单击submit按钮，什么也不会发生，您会在浏览器的控制台中看到一个404错误，但是如果您已经到了这一步，那么样板代码在您的机器上正常工作。下一步，我们将注册一个<a class="ae jt" href="https://openweathermap.org/api" rel="noopener ugc nofollow" target="_blank"> OpenWeatherMap </a> api键，并消除错误。</p><p id="e584" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们开始添加代码之前，这里是我们迄今为止的回购清单:</p><ul class=""><li id="f925" class="la lb hi ix b iy iz jc jd jg lc jk ld jo le js lf lg lh li bi translated"><code class="du kw kx ky kz b">index.html</code>是一个基本的引导启动页面，有一个名为<code class="du kw kx ky kz b">#nav</code>的导航栏用于输入位置，还有一个名为<code class="du kw kx ky kz b">#chart</code>的视窗用于显示结果。</li><li id="81fe" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lf lg lh li bi translated"><code class="du kw kx ky kz b">ajax.js</code>包含一个名为<code class="du kw kx ky kz b">getWeather</code>的函数，它从OpenWeatherMap api中检索数据。如果您不想完成api的注册和设置，有一个相同函数的注释版本，它只是从本地json文件中提取一些样本数据。如果你想跳过第2步，你可以注释掉第一个<code class="du kw kx ky kz b">getWeather</code>，取消第二个的注释，一切应该仍然正常。</li><li id="6386" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lf lg lh li bi translated"><code class="du kw kx ky kz b">line-chart.js</code>包含一个名为<code class="du kw kx ky kz b">drawChart</code>的功能。这是我们将要添加代码的文件，以便在下面的步骤中创建折线图。</li><li id="8ca2" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lf lg lh li bi translated"><code class="du kw kx ky kz b">main.js</code>是从DOM中得到的控制。有一个jQuery监听器调用我们的<code class="du kw kx ky kz b">getWeather</code>函数，然后调用<code class="du kw kx ky kz b">drawChart</code>来呈现数据。还有一个名为<code class="du kw kx ky kz b">sortTimeTemps</code>的助手函数，它处理OpenWeatherMap json结果，因此更容易在D3函数中使用。</li><li id="447b" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lf lg lh li bi translated">包含我们需要的任何样式。我不会深入讨论D3如何利用CSS来设计图表的样式，但是从这里开始，您当然可以自己处理折线图的外观。</li></ul><p id="6f44" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本教程中，除了<code class="du kw kx ky kz b">line-chart.js</code>，你不必修改上面的任何文件。</p><h1 id="0cc5" class="ju jv hi bd iu jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">2.获取OpenWeatherMap api密钥</h1><p id="99af" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">OpenWeatherMap API是我喜欢的一个选项，用于使用外部来源的数据测试新工具。浏览他们的注册过程，然后你可以生成你自己的API密匙，可以在<a class="ae jt" href="https://home.openweathermap.org/api_keys" rel="noopener ugc nofollow" target="_blank">这个url </a>找到。</p><p id="8d53" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用您的api密钥，我们将执行一个快速而肮脏的命令来创建一个api密钥文件，该文件将在源代码控制中被忽略，但会被线程化到应用程序的其余部分中:</p><pre class="lo lp lq lr fd ls kz lt lu aw lv bi"><span id="2c0f" class="lw jv hi kz b fi lx ly l lz ma"># bash</span><span id="f005" class="lw jv hi kz b fi mb ly l lz ma">$ echo 'export const apiKey = "&lt;YOUR OPEN WEATHER MAP API KEY&gt;";' &gt;&gt; javascripts/apiKey.js</span></pre><p id="0795" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当您看到一个名为<code class="du kw kx ky kz b">apiKey.js</code>的包含以下内容的新javascript文件时，您应该准备好了:</p><pre class="lo lp lq lr fd ls kz lt lu aw lv bi"><span id="979d" class="lw jv hi kz b fi lx ly l lz ma">// javascript</span><span id="eaa2" class="lw jv hi kz b fi mb ly l lz ma">export const apiKey = "&lt;YOUR OPEN WEATHER MAP API KEY&gt;";</span></pre><p id="4ba3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">刷新您的应用程序，如果一切都成功，它应该调用OpenWeatherMap API，当您输入不同的美国邮政编码时，您会在结果框中看到不同的城市。同样，如果打开控制台，应该会看到来自OpenWeatherMap api的响应。</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/e82534ea9ea46887d8a94fd88e2dc6fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*CcB5xy5LLBo-IP_Dz5fSRQ.png"/></div></figure><p id="d025" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意，这不是保护生产应用程序api密钥的好方法，但目前这将使密钥不受源代码控制。</p><p id="9b1a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从这里，我们将打开<code class="du kw kx ky kz b">line-chart.js</code>文件并开始添加到<code class="du kw kx ky kz b">drawChart</code>函数中。请注意，我们将创建一个非常长的函数，以命令式的方式，使构建D3插图的步骤更加清晰。</p><h1 id="03a3" class="ju jv hi bd iu jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">3.设置SVG</h1><p id="e390" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我们将通过设置一个将呈现我们的插图的SVG元素来开始我们的图表。SVG是一种基于矢量的图像格式，它使用纯文本来确定如何放置图像的所有形状和颜色。这与JPEG或PNG等基于光栅的图像格式相反，后者通过设置区域中每个像素的颜色来创建图像。这里是对<a class="ae jt" href="https://www.sitepoint.com/svg-101-what-is-svg/" rel="noopener ugc nofollow" target="_blank">SVG及其用例</a>的一个很好的概述。此外，这篇文章介绍了使用SVGs和D3 的<a class="ae jt" href="https://www.dashingd3js.com/svg-basic-shapes-and-d3js" rel="noopener ugc nofollow" target="_blank">绘图，这也非常有帮助。</a></p><p id="65a6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<code class="du kw kx ky kz b">drawChart</code>函数中，我们将首先设置图表的高度、宽度和边距，使其适合我们在页面上分配给它的空间。</p><pre class="lo lp lq lr fd ls kz lt lu aw lv bi"><span id="8b76" class="lw jv hi kz b fi lx ly l lz ma">// javascript<br/>export function drawChart(chartData) {<br/><br/>  // 1. Set the height, width, and margin of the chart based on the window and height of the navbar.<br/>  let margin = {top: 50, right: 50, bottom: 50, left: 50},<br/>      width = $('#chart').width() - margin.left - margin.right,<br/>      height = window.innerHeight - margin.top - margin.bottom - $('#nav').height() - 20;<br/><br/>  // 2. Create an SVG using the dimensions set above.<br/>  let svg = d3.select('#chart').append('svg')<br/>      .attr('width', width + margin.left + margin.right)<br/>      .attr('height', height + margin.top + margin.bottom)<br/>      .append('g')<br/>      .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');<br/><br/>}</span></pre><p id="48f4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第一组变量——<code class="du kw kx ky kz b">margin</code>、<code class="du kw kx ky kz b">width</code>和<code class="du kw kx ky kz b">height</code>——使用浏览器窗口的高度以及<code class="du kw kx ky kz b">#chart</code>和<code class="du kw kx ky kz b">#nav</code>div的高度来设置。这向我们保证，无论浏览器窗口的大小，我们的图表都将适合它应该在的地方。</p><p id="7bec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第二个变量— <code class="du kw kx ky kz b">svg — </code>来自D3选择<code class="du kw kx ky kz b">#chart</code> div，并追加一个<code class="du kw kx ky kz b">svg</code>元素。<code class="du kw kx ky kz b">height</code>和<code class="du kw kx ky kz b">width</code>是SVG属性，使用我们在第一步中得到的高度、宽度和边距变量来设置。一个空的<code class="du kw kx ky kz b">&lt;g&gt;</code>元素被添加到SVG中。<code class="du kw kx ky kz b">&lt;g&gt;</code>是一个元素，用于“分组”稍后将添加到SVG中的其他子元素。最后，我们设置<code class="du kw kx ky kz b">transform</code>属性来移动SVG，以便在SVG和它所在的<code class="du kw kx ky kz b">&lt;div&gt;</code>的边缘之间有一些空间。</p><p id="aa2d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，重新加载页面，点击<strong class="ix hj">提交</strong>按钮，您应该会在<code class="du kw kx ky kz b">#chart</code>区域看到一个矩形轮廓。在该div中，应该呈现一个空的SVG:</p><pre class="lo lp lq lr fd ls kz lt lu aw lv bi"><span id="b928" class="lw jv hi kz b fi lx ly l lz ma">&lt;!-- html --&gt;<br/>&lt;svg width="1270" height="896"&gt;<br/>    &lt;g transform="translate(50,50)"&gt;&lt;/g&gt;<br/>&lt;/svg&gt;</span></pre><h1 id="ef7f" class="ju jv hi bd iu jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">4.设置X轴和Y轴</h1><p id="70ed" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">接下来，我们将设置X轴和Y轴的比例。图表的Y轴是未来五天的温度，而X轴是日期和时间。</p><p id="ccd3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将在<code class="du kw kx ky kz b">drawChart</code>函数中添加下两个步骤:</p><pre class="lo lp lq lr fd ls kz lt lu aw lv bi"><span id="129d" class="lw jv hi kz b fi lx ly l lz ma">// javascript<br/>export function drawChart(chartData) {<br/><br/>  // [...]<br/><br/>  // 3. Set the scale for the y-axis, mapped from 0 to highest temperature + 10<br/>  const yScale = d3.scaleLinear()<br/>      .domain([0, d3.max(chartData, d =&gt; d.temp_max) + 10])<br/>      .range([height, 0]);<br/><br/>  // 4. Set the scale for the x-axis, mapped to range of times in dataset<br/>  const xScale = d3.scaleTime()<br/>      .domain(d3.extent(chartData, d =&gt; d.time))<br/>      .range([0, width]);<br/>}</span></pre><p id="2710" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的数据——称为<code class="du kw kx ky kz b">chartData</code>——将作为一个带有两个键的对象数组传入:<code class="du kw kx ky kz b">temp_max</code>和<code class="du kw kx ky kz b">time</code>，如下所示:</p><pre class="lo lp lq lr fd ls kz lt lu aw lv bi"><span id="a55e" class="lw jv hi kz b fi lx ly l lz ma">// javascript<br/>[<br/>    {<br/>        temp_max: 62.4,<br/>        time: 1589749200000<br/>    },<br/>    // [...]<br/>]</span></pre><p id="3fb7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du kw kx ky kz b">yScale</code>用D3的<code class="du kw kx ky kz b">scaleLinear</code>方法设定。这种方法基本上将数据集的最低和最高值映射到图表中Y轴的高度。<code class="du kw kx ky kz b">domain</code>方法告诉我们取数组中最低到最高的<code class="du kw kx ky kz b">temp_max</code>值，并将其映射到我们的<code class="du kw kx ky kz b">range</code>，0表示图表的高度(加10表示我们的线条将到达的最高点上方的一点空间)。</p><p id="c563" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du kw kx ky kz b">xScale</code>的工作方式类似，为我们的<code class="du kw kx ky kz b">time</code>值设置一个刻度，并将其从0映射到图表的宽度。用<code class="du kw kx ky kz b">scaleTime()</code>而不是<code class="du kw kx ky kz b">scaleLinear()</code>创建刻度，可以让我们访问特殊的基于时间的值，而后者函数返回一系列线性整数。</p><p id="0dbc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">比例是映射对象，将在接下来的步骤中使用，所以它们还没有在我们的HTML中产生任何东西。</p><h1 id="b893" class="ju jv hi bd iu jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">5.为线添加点</h1><p id="3070" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我们将回到另一个SVG方法，这次是在图表上为每个时间和温度交叉点放置点。让我们把这个加到<code class="du kw kx ky kz b">drawChart</code>:</p><pre class="lo lp lq lr fd ls kz lt lu aw lv bi"><span id="4c45" class="lw jv hi kz b fi lx ly l lz ma">// javascript<br/>export function drawChart(chartData) {<br/><br/>  // [...]<br/><br/>  // 5. Append dots for each temperature<br/>  svg.selectAll('.dot')<br/>      .data(chartData)<br/>      .enter().append('circle')<br/>      .attr('class', 'dot')<br/>      .attr('cx', (d) =&gt; xScale(d.time))<br/>      .attr('cy', (d) =&gt; yScale(d.temp_max))<br/>      .attr('r', 2);<br/>}</span></pre><p id="84a2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是D3难以推理的地方。它从<code class="du kw kx ky kz b">selectAll</code>开始，它说用CSS类<code class="du kw kx ky kz b">.dot</code>选择元素，但是直到链的更下游，我们才拥有那个类的元素(我认为它就像在您指示要选择的表之前，SQL查询中第一个出现<code class="du kw kx ky kz b">SELECT</code>)。</p><p id="baa2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们声明我们的<code class="du kw kx ky kz b">data</code>是我们发送到函数中的<code class="du kw kx ky kz b">chartData</code>。<code class="du kw kx ky kz b">enter</code>表示需要向SVG添加新元素，而<code class="du kw kx ky kz b">append('circle')</code>表示要添加什么元素。它将为<code class="du kw kx ky kz b">chartData</code>数组中的每一项添加一个圆圈(如果你感到困惑，我不怪你，<a class="ae jt" href="https://www.d3indepth.com/enterexit/" rel="noopener ugc nofollow" target="_blank">这个解释<code class="du kw kx ky kz b">enter</code>中的</a>和D3中的<code class="du kw kx ky kz b">exit</code>是有帮助的)。</p><p id="826a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，每个圆都将拥有CSS类<code class="du kw kx ky kz b">.dot</code>(在第一步中选择)。我们添加的最终SVG属性是<code class="du kw kx ky kz b">'cx'</code>和<code class="du kw kx ky kz b">'cy' </code>，它们是圆的X和Y轴位置，然后是<code class="du kw kx ky kz b">r</code>，它们是圆的半径。注意，前面的<code class="du kw kx ky kz b">xScale</code>和<code class="du kw kx ky kz b">yScale</code>函数用于获取时间和温度值，并将它们映射到每个圆的x，y位置。</p><p id="b76b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们刷新页面并提交另一个邮政编码，我们会在折线图区域看到一系列点:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/cb55546318da24cdb19fa19e1f5c13bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u5yfSG2k8ZrBvl6TeQhKHg.png"/></div></div></figure><p id="e85a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">同样，我们所有的圈子都将被添加到SVG中:</p><h1 id="5958" class="ju jv hi bd iu jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">6.连接各点</h1><p id="7df7" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">接下来，我们将画一条线来连接这些圆:</p><pre class="lo lp lq lr fd ls kz lt lu aw lv bi"><span id="60f7" class="lw jv hi kz b fi lx ly l lz ma">// javascript<br/>export function drawChart(chartData) {<br/><br/>  // [...]<br/>    const line = d3.line()<br/>        .x(d =&gt; xScale(d.time))<br/>        .y(d =&gt; yScale(d.temp_max));<br/>}</span></pre><p id="f53f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du kw kx ky kz b">d3.line()</code>返回一个函数，该函数将输出我们要跟随的行的X，Y坐标，我们指出<code class="du kw kx ky kz b">time</code>和<code class="du kw kx ky kz b">temp_max</code>属性将决定这些值。<code class="du kw kx ky kz b">d3.line()</code>函数的输出是一个SVG路径字符串:一个路径命令字符串。</p><p id="9fe7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了实际绘制这条线，我们将向SVG添加一个<code class="du kw kx ky kz b">&lt;path&gt;</code>元素:</p><pre class="lo lp lq lr fd ls kz lt lu aw lv bi"><span id="8f42" class="lw jv hi kz b fi lx ly l lz ma">// javascript<br/>export function drawChart(chartData) {<br/><br/>  // [...]<br/>    svg.append('path')<br/>        .datum(chartData)<br/>        .attr('d', line)<br/>        .attr('class', 'line');<br/>}</span></pre><p id="8cfe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将路径附加到SVG，表明<code class="du kw kx ky kz b">chartData</code>是我们的数据，并使用<code class="du kw kx ky kz b">line</code>的输出来设置路径的<code class="du kw kx ky kz b">d</code>属性(显然<a class="ae jt" href="https://stackoverflow.com/a/23440390/9316547" rel="noopener ugc nofollow" target="_blank"> d代表数据</a>)。最后，我们将添加一个名为“line”的CSS类来设置线条的外观。在<code class="du kw kx ky kz b">main.css</code>中，我是这样设计样板文件中的代码行的，但是你可以随意摆弄它:</p><pre class="lo lp lq lr fd ls kz lt lu aw lv bi"><span id="573d" class="lw jv hi kz b fi lx ly l lz ma">/* css */<br/>.line {<br/>    fill: none;<br/>    stroke: steelblue;<br/>    stroke-width: 1;<br/>}</span></pre><p id="9e46" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，如果您刷新浏览器并提交另一个邮政编码，将会有一条线将这些点连接起来:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/2b96473aa5caf315f9bdebcc00003115.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JsFZ0i1A9wpb-bYEc-sK9A.png"/></div></div></figure><h1 id="a6fe" class="ju jv hi bd iu jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">7.添加标签</h1><p id="6dde" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">没有轴标签，我们的行就没有多大意义。我们将把另外两组(<code class="du kw kx ky kz b">&lt;g&gt;</code>)附加到我们的SVG中，以在X轴上指示每六个小时的时间:</p><pre class="lo lp lq lr fd ls kz lt lu aw lv bi"><span id="44f8" class="lw jv hi kz b fi lx ly l lz ma">// javascript<br/>export function drawChart(chartData) {<br/><br/>  // [...]<br/><br/>  svg.append('g')<br/>      .attr('transform', 'translate(0,' + height + ')')<br/>      .call(d3.axisBottom(xScale)<br/>      .ticks(d3.timeHour.every(6)));<br/>}</span></pre><p id="4016" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我们用<code class="du kw kx ky kz b">translate</code>命令将对象推到SVG的底部，然后我们使用xScale函数中的映射来确定值，而<code class="du kw kx ky kz b">ticks</code>设置间隔。</p><p id="f8a6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Y轴的<code class="du kw kx ky kz b">append</code>命令添加起来稍微简单一点，但是更加复杂:</p><pre class="lo lp lq lr fd ls kz lt lu aw lv bi"><span id="0e4c" class="lw jv hi kz b fi lx ly l lz ma">// javascript<br/>export function drawChart(chartData) {<br/><br/>  // [...]<br/>  svg.append('g')<br/>      .call(d3.axisLeft(yScale))<br/>}</span></pre><p id="9a76" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于yScale输出的数组中的每一项，D3都添加一个垂直对齐，然后在yScale数组设置的每个间隔添加一个SVG <code class="du kw kx ky kz b">&lt;text&gt;</code>元素。<a class="ae jt" href="https://observablehq.com/collection/@d3/d3-axis" rel="noopener ugc nofollow" target="_blank"> D3轴方法</a>值得进一步熟悉，因为它们节省了设置轴标签的大量繁琐工作。</p><p id="64a4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后一个缺失的部分是，我们的观众不知道我们的Y轴数字代表什么。我们最后要做的是添加一个<em class="mf">‘温度(F)’</em>标签。我们将进一步扩展最后一个<code class="du kw kx ky kz b">append</code>函数:</p><pre class="lo lp lq lr fd ls kz lt lu aw lv bi"><span id="10ae" class="lw jv hi kz b fi lx ly l lz ma">// javascript<br/>export function drawChart(chartData) {<br/><br/>  // [...]<br/>svg.append('g')<br/>      .call(d3.axisLeft(yScale))<br/>      .append('text')<br/>      .attr('fill', '#000000')<br/>      .text('Temperature (F)')<br/>      .attr('transform', 'rotate(-90)')<br/>      .attr('y', 5)<br/>      .attr('dy', '0.71em')<br/>      .attr('text-anchor', 'end');<br/>}</span></pre><p id="cc55" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du kw kx ky kz b">append('text')</code>和接下来的一切只是手动设置一个额外的SVG <code class="du kw kx ky kz b">&lt;text&gt;</code>元素的属性。</p><p id="d733" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们有了折线图:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/f00c4b059b294d444529ee565d92265b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ya_eG51GM7_uw-LJuYKxLg.png"/></div></div></figure><h1 id="d4eb" class="ju jv hi bd iu jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="606c" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">有了上面的函数，您就有了一个对发送给它的不同数据集做出动态反应的SVG。通过操作SVG元素、设置比例，并利用D3的一些广泛功能来操作和呈现数据，您可以看到可以应用于用原始数据创建可视化的细节层次。我们对建立一个D3可视化的过程有所了解，我们可以进一步实验，并研究那里成千上万其他令人印象深刻的D3数据说明和创造性编码。</p></div></div>    
</body>
</html>