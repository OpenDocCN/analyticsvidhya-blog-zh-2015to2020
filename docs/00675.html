<html>
<head>
<title>Property Based Testing: ScalaTest + ScalaCheck</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于属性的测试:ScalaTest + ScalaCheck</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/property-based-testing-scalatest-scalacheck-52261a2b5c2c?source=collection_archive---------7-----------------------#2019-08-25">https://medium.com/analytics-vidhya/property-based-testing-scalatest-scalacheck-52261a2b5c2c?source=collection_archive---------7-----------------------#2019-08-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d36c84e1afa57f87895ac2f570028401.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Usatj5KHYlMb6qQXV3iquQ.png"/></div></div></figure><p id="43a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">基于属性的测试是测试软件的另一种策略或哲学</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="c9d2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一个<em class="jv">属性</em>可以是一个方法或对象的任何行为特征，它应该在任何模糊情况下保持<em class="jv">为真</em>。</p><p id="8f56" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jv">基于属性的测试</em>源自函数式编程社区:<strong class="is hj">快速检查</strong>在<strong class="is hj"> Haskell </strong>中</p><p id="1643" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">定义:</strong></p><blockquote class="jw jx jy"><p id="1920" class="iq ir jv is b it iu iv iw ix iy iz ja jz jc jd je ka jg jh ji kb jk jl jm jn hb bi translated">基于属性的测试是这样构造测试的，当这些测试被模糊化时，测试中的失败揭示了被测系统的问题，这些问题不能通过直接模糊化该系统来揭示。</p></blockquote></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="4425" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们快速看看ScalaTest和ScalaCheck是如何工作的</p><p id="ac33" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> ScalaTest: </strong></p><p id="cfe9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ScalaTest是一个简洁、易读的测试框架，开发它是为了快速编写测试用例，并以近乎纯文本的方式表达它们</p><p id="0d83" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> ScalaCheck: </strong></p><p id="ebb0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">scalaCheck是基于属性测试的Scala框架。它与ScalaTest也有很好的集成。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="6dfe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们跳到代码，看看它们有多简单，</p><p id="edab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">美芬依赖:</strong></p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="6da0" class="km kn hi ki b fi ko kp l kq kr">&lt;dependency&gt;<br/>    &lt;groupId&gt;org.scalatest&lt;/groupId&gt;<br/>    &lt;artifactId&gt;scalatest_2.11&lt;/artifactId&gt;<br/>    &lt;version&gt;3.0.8&lt;/version&gt;<br/>    &lt;scope&gt;test&lt;/scope&gt;<br/>&lt;/dependency&gt;<br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;org.scalacheck&lt;/groupId&gt;<br/>    &lt;artifactId&gt;scalacheck_2.11&lt;/artifactId&gt;<br/>    &lt;version&gt;1.14.0&lt;/version&gt;<br/>    &lt;scope&gt;test&lt;/scope&gt;<br/>&lt;/dependency&gt;</span></pre><p id="fc08" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设我们有两个方法，</p><ul class=""><li id="d969" class="ks kt hi is b it iu ix iy jb ku jf kv jj kw jn kx ky kz la bi translated"><em class="jv"> div </em> —将两个数相除</li><li id="c8b4" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated"><em class="jv">追加— </em>在列表末尾追加一个整数</li></ul><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="ccbc" class="km kn hi ki b fi ko kp l kq kr"><strong class="ki hj">object </strong>Main {<br/><br/>  <strong class="ki hj">def </strong>div(n: Int, d: Int): Double = {<br/>    <em class="jv">require</em>(d != 0, "Denominator should not be 0")<br/>    n / d<br/>  }<br/><br/>  <strong class="ki hj">def </strong>append(list: List[Int], postfix: Int): List[Int] = { <br/>    list :+ postfix <br/>  }<br/>}</span></pre><p id="beb4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<strong class="is hj"> ScalaTest </strong>中，我们有两种写ScalaCheck的风格——</p><ol class=""><li id="5fcf" class="ks kt hi is b it iu ix iy jb ku jf kv jj kw jn lg ky kz la bi translated">斯卡拉切克风格</li><li id="088f" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn lg ky kz la bi translated">使用ScalaTest <strong class="is hj"> <em class="jv">匹配器</em> </strong>【我们将使用这个】</li></ol><p id="02a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将解释我们如何在使用和不使用<strong class="is hj"> <em class="jv"> ScalaCheck </em> </strong>的情况下进行测试，以了解差异，</p><p id="2f1e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jv">不带ScalaCheck: </em> </strong></p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="2ff6" class="km kn hi ki b fi ko kp l kq kr">"div function" should "return expected values" in {<br/>  <em class="jv">div</em>(4, 2) shouldBe 2<br/>}</span><span id="8e27" class="km kn hi ki b fi lh kp l kq kr">"append function" should "return only one element when added in empty list" in {<br/>  <strong class="ki hj">val </strong>emptyList = <em class="jv">List</em>.<em class="jv">empty</em>[Int]<br/><br/>  <em class="jv">append</em>(emptyList, 1) should <em class="jv">have </em>size 1<br/>}</span></pre><p id="bd24" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">测试使用<em class="jv">匹配器</em> trait来使用<em class="jv">should</em>子句定义断言。ScalaTest 支持许多类似的断言简写，这使得它具有可读性和简洁性。</p><p id="50db" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jv">同</em> </strong></p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="ffe6" class="km kn hi ki b fi ko kp l kq kr">"div function" should "return expected values" in {<br/>   forAll(<em class="jv">arbitraryInts</em>, <em class="jv">nonZeroInts</em>) { (n: Int, d: Int) =&gt;<br/>     <em class="jv">div</em>(n, d) shouldBe n / d<br/>   }<br/>}</span><span id="8548" class="km kn hi ki b fi lh kp l kq kr">"append function" should "return only one element when added in empty list" in {<br/>  <strong class="ki hj">val </strong>emptyList = <em class="jv">List</em>.<em class="jv">empty</em>[Int]<br/><br/>  forAll(<em class="jv">arbitraryInts</em>) { n: Int =&gt;<br/>    <em class="jv">append</em>(emptyList, n) should <em class="jv">have </em>size 1<br/>  }<br/>}</span></pre><p id="6a88" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<em class="jv"> ScalaCheck </em>中定义属性非常简单:在上面的例子中，我们正在测试<em class="jv"> div </em>和<em class="jv"> append </em>函数的属性，给定一些模糊或随机的输入，它们仍然产生预期的结果。</p><p id="2958" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jv"> forAll </em>方法用于提供输入—上面的例子有两个随机<em class="jv"> Gen </em>对象，它们产生随机<em class="jv"> Int </em>来测试<em class="jv"> div </em>功能。</p><p id="0145" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">随机输入定义如下，</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="2bc4" class="km kn hi ki b fi ko kp l kq kr"><strong class="ki hj">val </strong><em class="jv">arbitraryInts</em>: Gen[Int] = arbitrary[Int]<br/><strong class="ki hj">val </strong><em class="jv">nonZeroInts</em>: Gen[Int]   = arbitrary[Int] suchThat (_ != 0)</span></pre><p id="108a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jv"> arbitrary[Int] </em>是产生<em class="jv"> Gen </em>对象的方法之一，该对象是用于生成给定类型的任意输入的抽象。</p><p id="d7d7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面给出了其他几个例子，</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="3b33" class="km kn hi ki b fi ko kp l kq kr">Gen.choose(0,100) // Will give you one Int from the range</span><span id="deda" class="km kn hi ki b fi lh kp l kq kr">Gen.oneOf('A', 'E', 'I', 'O', 'U', 'Y') // One from the list</span><span id="f20c" class="km kn hi ki b fi lh kp l kq kr">Gen.containerOf[List,Int](Gen.oneOf(1, 3, 5))</span><span id="c186" class="km kn hi ki b fi lh kp l kq kr">// With some condition : any even number from 0 - 200<br/>Gen.choose(0,200) suchThat (_ % 2 == 0)</span><span id="d9fe" class="km kn hi ki b fi lh kp l kq kr">// Picking any 5 from the range 1 to 6<br/>Gen.pick(5, 1 to 6)</span><span id="8c2b" class="km kn hi ki b fi lh kp l kq kr">// Even with some distribution of each value<br/>Gen.frequency(<br/>  (3, 'A'),<br/>  (4, 'E'),<br/>  (2, 'I'),<br/>  (3, 'O'),<br/>  (1, 'U'),<br/>  (1, 'Y')<br/>)</span></pre><p id="f4d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以上所有方法为我们提供了<em class="jv">Gen</em>object——它将在<em class="jv"> forAll </em>方法中使用，为我们的测试用例提供模糊性。</p><p id="17c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">基于属性的测试为我们提供了一种在测试逻辑中包含模糊性的简单方法，这种方法在我们传统的测试方法中是无法评估的。在传统的方法中，我们提供一组期望的输入和期望的输出，通过它们我们不测试方法属性的极端情况——这可能导致生产中的严重错误。</p><p id="4ac7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<em class="jv"> ScalaCheck </em>中，我们可以配置模糊度并测试负载以及以下属性:</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="d340" class="km kn hi ki b fi ko kp l kq kr">forAll(<em class="jv">nonZeroInts</em>, minSuccessful(50)) { n: Int =&gt;<br/>  <em class="jv">div</em>(n, n) shouldBe 1<br/>}</span></pre><p id="488f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jv"> forAll </em>方法包含变量argument来提供<em class="jv">属性检查配置</em>来定义测试条件。上面示例定义了要执行的最少50次成功执行。</p><p id="0d86" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jv"> maxDiscardedFactor，sizeRange，workers </em>是其他可以使用的配置。</p><p id="02b2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jv"> ScalaCheck </em>还提供了一些复杂的模糊创建逻辑，包括生成整个case类对象。有关详细的实现以及与ScalaTest的集成，请参考下面给出的链接。</p><p id="f151" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于Scala开发者来说，<em class="jv"> ScalaTest </em>和<em class="jv"> ScalaCheck </em>是非常好的选择，可以快速编写简洁易读的测试用例。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="5102" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">参考文献:</strong></p><p id="eabe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jv">示例代码</em></p><div class="li lj ez fb lk ll"><a href="https://github.com/subashprabanantham/hakuna-matata/tree/master/scalatest" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab dw"><div class="ln ab lo cl cj lp"><h2 class="bd hj fi z dy lq ea eb lr ed ef hh bi translated">subashprabanantham/hakuna-matata</h2><div class="ls l"><h3 class="bd b fi z dy lq ea eb lr ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="lt l"><p class="bd b fp z dy lq ea eb lr ed ef dx translated">github.com</p></div></div><div class="lu l"><div class="lv l lw lx ly lu lz io ll"/></div></div></a></div><p id="d9e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jv"> ScalaTest </em></p><div class="li lj ez fb lk ll"><a href="http://www.scalatest.org/user_guide/using_the_scalatest_maven_plugin" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab dw"><div class="ln ab lo cl cj lp"><h2 class="bd hj fi z dy lq ea eb lr ed ef hh bi translated">ScalaTest</h2><div class="ls l"><h3 class="bd b fi z dy lq ea eb lr ed ef dx translated">ScalaTest Maven插件允许您通过Maven运行ScalaTest测试，而不需要…</h3></div><div class="lt l"><p class="bd b fp z dy lq ea eb lr ed ef dx translated">www.scalatest.org</p></div></div></div></a></div><p id="9470" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jv">Scala test中的Scala check</em></p><div class="li lj ez fb lk ll"><a href="http://www.scalatest.org/user_guide/property_based_testing" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab dw"><div class="ln ab lo cl cj lp"><h2 class="bd hj fi z dy lq ea eb lr ed ef hh bi translated">ScalaTest</h2><div class="ls l"><h3 class="bd b fi z dy lq ea eb lr ed ef dx translated">ScalaTest支持基于属性的测试，其中属性是行为的高级规范，应该包含…</h3></div><div class="lt l"><p class="bd b fp z dy lq ea eb lr ed ef dx translated">www.scalatest.org</p></div></div></div></a></div><p id="bb5a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jv"> ScalaCheck用户指南</em></p><div class="li lj ez fb lk ll"><a href="https://github.com/typelevel/scalacheck/blob/master/doc/UserGuide.md" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab dw"><div class="ln ab lo cl cj lp"><h2 class="bd hj fi z dy lq ea eb lr ed ef hh bi translated">类型级别/标量检查</h2><div class="ls l"><h3 class="bd b fi z dy lq ea eb lr ed ef dx translated">ScalaCheck是一个测试Scala和Java程序的工具，基于属性规范和自动测试数据…</h3></div><div class="lt l"><p class="bd b fp z dy lq ea eb lr ed ef dx translated">github.com</p></div></div></div></a></div></div></div>    
</body>
</html>