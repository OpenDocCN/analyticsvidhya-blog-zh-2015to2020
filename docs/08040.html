<html>
<head>
<title>Deploying WordPress and MySql server in our own VPC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在VPC部署WordPress和MySql服务器</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploying-wordpress-and-mysql-server-in-our-own-vpc-59d5d4a2fedd?source=collection_archive---------22-----------------------#2020-07-15">https://medium.com/analytics-vidhya/deploying-wordpress-and-mysql-server-in-our-own-vpc-59d5d4a2fedd?source=collection_archive---------22-----------------------#2020-07-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/182fb65133dc0febb5ab770c99d231a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JHcz1Dg7cDsiFX3TQGgmhg.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="4858" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated">*我们会做什么？</h2></div><p id="4d1f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">1)使用Terraform将基础架构编写为代码，这会自动创建VPC。</p><p id="e7e6" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">2)创建一个面向公众的互联网网关，将我们的VPC/网络连接到互联网世界，并将此网关连接到我们的VPC。</p><p id="f34e" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">3)在VPC中，我们必须创建2个子网:</p><p id="b54d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">a)公共子网[公共世界可访问！]</p><p id="635a" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">b)私有子网[仅限公共领域！].</p><p id="f7c3" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">4)为Internet gateway创建一个路由表，以便实例可以连接到外部世界，更新并将其与公共子网相关联。</p><p id="bc2f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">5)启动一个ec2实例，它的WordPress设置已经有了允许端口80的安全组，这样我们的客户就可以连接到我们的WordPress站点。</p><p id="43d6" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">此外，将密钥附加到实例，以便进一步登录。</p><p id="7004" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">6)启动一个ec2实例，该实例已经用安全组设置了MYSQL，允许在私有子网中使用端口3306，这样我们的WordPress VM就可以连接相同的端口。</p><p id="f803" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">此外，将密钥与相同的。</p><p id="632b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">注意:WordPress实例必须是公共子网的一部分，这样我们的客户才能连接我们的站点。</p><p id="5138" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">MySQL实例必须是私有子网的一部分，这样外界就不能连接到它。</p><p id="583c" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">不要忘记添加要启用的自动IP分配和自动DNS名称分配选项。</p></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h2 id="0824" class="kl km ht bd kn ko kp kq kr ks kt ku kv jr kw kx ky jv kz la lb jz lc ld le lf bi translated">*在进入解决方案部分之前，我们先来看看本任务中的一些主要术语</h2><ul class=""><li id="658f" class="lg lh ht jk b jl li jo lj jr lk jv ll jz lm kd ln lo lp lq bi translated"><strong class="jk hu"> <em class="lr">什么是aws？</em>T3】</strong></li></ul><p id="41ea" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">Amazon web service是一个平台，提供灵活、可靠、可扩展、易于使用且经济高效的云计算解决方案。</p><p id="37ca" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">AWS是亚马逊提供的一个全面、易于使用的计算平台。该平台结合了基础设施即服务(IaaS)、平台即服务(PaaS)和打包软件即服务(SaaS)产品。</p><ul class=""><li id="e24c" class="lg lh ht jk b jl jm jo jp jr ls jv lt jz lu kd ln lo lp lq bi translated"><strong class="jk hu"><em class="lr">AWS(亚马逊网络服务)的7大好处</em> </strong></li></ul><ol class=""><li id="e950" class="lg lh ht jk b jl jm jo jp jr ls jv lt jz lu kd lv lo lp lq bi translated">全面的</li><li id="92d5" class="lg lh ht jk b jl lw jo lx jr ly jv lz jz ma kd lv lo lp lq bi translated">性价比高</li><li id="6d08" class="lg lh ht jk b jl lw jo lx jr ly jv lz jz ma kd lv lo lp lq bi translated">适合的</li><li id="5bba" class="lg lh ht jk b jl lw jo lx jr ly jv lz jz ma kd lv lo lp lq bi translated">安全性</li><li id="e09f" class="lg lh ht jk b jl lw jo lx jr ly jv lz jz ma kd lv lo lp lq bi translated">创新ˌ革新</li><li id="78d8" class="lg lh ht jk b jl lw jo lx jr ly jv lz jz ma kd lv lo lp lq bi translated">全球领导者</li><li id="d751" class="lg lh ht jk b jl lw jo lx jr ly jv lz jz ma kd lv lo lp lq bi translated">提高生产力</li></ol></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><ul class=""><li id="9051" class="lg lh ht jk b jl jm jo jp jr ls jv lt jz lu kd ln lo lp lq bi translated"><strong class="jk hu"> <em class="lr">该发球了</em> </strong></li></ul><blockquote class="mb mc md"><p id="e37e" class="ji jj lr jk b jl jm iu jn jo jp ix jq me js jt ju mf jw jx jy mg ka kb kc kd hb bi translated">VPC</p></blockquote><p id="e7b8" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi mh translated"><span class="l mi mj mk bm ml mm mn mo mp di">V</span>I virtual Private Cloud(亚马逊VPC)允许您提供AWS云的逻辑隔离部分，您可以在您定义的虚拟网络中启动AWS资源。您可以完全控制虚拟网络环境，包括选择自己的IP地址范围、创建子网以及配置路由表和网络网关。您可以在您的VPC中同时使用IPv4和IPv6，以便安全轻松地访问资源和应用程序。</p><blockquote class="mb mc md"><p id="d2b0" class="ji jj lr jk b jl jm iu jn jo jp ix jq me js jt ju mf jw jx jy mg ka kb kc kd hb bi translated"><strong class="jk hu"> <em class="ht">以下是VPCs的关键概念:</em> </strong></p></blockquote><ul class=""><li id="d9e4" class="lg lh ht jk b jl jm jo jp jr ls jv lt jz lu kd ln lo lp lq bi translated"><strong class="jk hu">虚拟私有云(VPC) </strong> —专用于您的AWS帐户的虚拟网络。</li><li id="8e4a" class="lg lh ht jk b jl lw jo lx jr ly jv lz jz ma kd ln lo lp lq bi translated"><strong class="jk hu">子网</strong>—VPC中的一系列IP地址。</li><li id="bf72" class="lg lh ht jk b jl lw jo lx jr ly jv lz jz ma kd ln lo lp lq bi translated"><strong class="jk hu">路由表</strong> —一组称为路由的规则，用于确定网络流量的流向。</li><li id="8b19" class="lg lh ht jk b jl lw jo lx jr ly jv lz jz ma kd ln lo lp lq bi translated"><strong class="jk hu">互联网网关</strong> —连接到VPC的网关，用于实现VPC中的资源与互联网之间的通信。</li></ul><blockquote class="mb mc md"><p id="0457" class="ji jj lr jk b jl jm iu jn jo jp ix jq me js jt ju mf jw jx jy mg ka kb kc kd hb bi translated"><em class="ht">子网</em></p></blockquote><p id="6da0" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi mh translated">T4的子网是一个网络内部的网络。子网使网络更加高效。通过子网划分，网络流量可以传输更短的距离，而无需通过不必要的路由器到达目的地。</p><p id="dfd3" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">互联网上的每台计算机或主机都至少有一个IP地址作为唯一标识符。组织将使用子网将大型网络细分为更小、更高效的子网。子网的一个目标是将一个大型网络分成一组较小的互连网络，以帮助减少流量。</p><blockquote class="mb mc md"><p id="ff1f" class="ji jj lr jk b jl jm iu jn jo jp ix jq me js jt ju mf jw jx jy mg ka kb kc kd hb bi translated">路由表</p></blockquote><p id="0083" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi mh translated"><span class="l mi mj mk bm ml mm mn mo mp di"> R </span> oute <em class="lr">表</em>包含一组规则，称为<em class="lr">路由</em>，用于确定来自子网或网关的网络流量被定向到哪里。</p><blockquote class="mb mc md"><p id="fddf" class="ji jj lr jk b jl jm iu jn jo jp ix jq me js jt ju mf jw jx jy mg ka kb kc kd hb bi translated">互联网网关</p></blockquote><p id="c5f9" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi mh translated">互联网网关是一个水平扩展的、冗余的、高度可用的VPC组件，它允许您的VPC与互联网之间的通信。</p><p id="668d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">internet网关有两个用途:在VPC路由表中为可路由到internet的流量提供一个目标，并为已经分配了公共IPv4地址的实例执行网络地址转换(NAT)。</p><p id="4ff3" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">互联网网关支持IPv4和IPv6流量。它不会对您的网络流量造成可用性风险或带宽限制。</p><blockquote class="mb mc md"><p id="9e7c" class="ji jj lr jk b jl jm iu jn jo jp ix jq me js jt ju mf jw jx jy mg ka kb kc kd hb bi translated"><em class="ht"> EC2 </em></p></blockquote><p id="d47b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi mh translated"><span class="l mi mj mk bm ml mm mn mo mp di">E</span>Elastic Block Store(EBS)是一种易于使用的高性能块存储服务，旨在与亚马逊弹性计算云(EC2)配合使用，用于任何规模的吞吐量和事务密集型工作负载。各种各样的工作负载，如关系和非关系数据库、企业应用程序、容器化应用程序、大数据分析引擎、文件系统和媒体工作流，都广泛部署在Amazon EBS上。</p><blockquote class="mb mc md"><p id="61d1" class="ji jj lr jk b jl jm iu jn jo jp ix jq me js jt ju mf jw jx jy mg ka kb kc kd hb bi translated"><em class="ht">密钥对和安全组</em></p></blockquote><p id="75ba" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi mh translated">由一个私钥和一个公钥组成的密钥对是一组安全凭证，用于在连接到实例时证明您的身份。Amazon EC2存储公钥，您存储私钥。您使用私钥而不是密码来安全地访问您的实例。</p><p id="fff1" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi mh translated">安全组充当EC2实例的虚拟防火墙，控制传入和传出流量。入站规则控制您的实例的传入流量，出站规则控制您的实例的传出流量。…如果没有指定安全组，Amazon EC2会使用默认的安全组。</p><ul class=""><li id="f086" class="lg lh ht jk b jl jm jo jp jr ls jv lt jz lu kd ln lo lp lq bi translated"><strong class="jk hu"> <em class="lr">什么是terraform？</em> </strong></li></ul><p id="5efe" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi mh translated">erraform是一个安全有效地构建、更改和版本控制基础设施的工具。Terraform可以管理现有的和受欢迎的服务提供商以及定制的内部解决方案。</p><p id="8cb4" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">配置文件描述了运行单个应用程序或整个数据中心所需组件的平台化。Terraform生成一个执行计划，描述它将做什么来达到期望的状态，然后执行它来构建所描述的基础设施。随着配置的变化，Terraform能够确定发生了什么变化，并创建可以应用的增量执行计划。</p><p id="5fb9" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">Terraform可以管理的基础设施包括低级组件，如计算实例、存储和网络，以及高级组件，如DNS条目、SaaS功能等。</p><blockquote class="mb mc md"><p id="2ab6" class="ji jj lr jk b jl jm iu jn jo jp ix jq me js jt ju mf jw jx jy mg ka kb kc kd hb bi translated"><strong class="jk hu"><em class="ht">terra form的关键特性有</em> </strong></p></blockquote><ol class=""><li id="d5f6" class="lg lh ht jk b jl jm jo jp jr ls jv lt jz lu kd lv lo lp lq bi translated">执行计划</li><li id="0e03" class="lg lh ht jk b jl lw jo lx jr ly jv lz jz ma kd lv lo lp lq bi translated">基础设施作为代码</li><li id="b068" class="lg lh ht jk b jl lw jo lx jr ly jv lz jz ma kd lv lo lp lq bi translated">变革自动化</li><li id="27e0" class="lg lh ht jk b jl lw jo lx jr ly jv lz jz ma kd lv lo lp lq bi translated">资源图表</li></ol></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h2 id="bd48" class="kl km ht bd kn ko kp kq kr ks kt ku kv jr kw kx ky jv kz la lb jz lc ld le lf bi translated">*解决方案</h2><ol class=""><li id="cc8f" class="lg lh ht jk b jl li jo lj jr lk jv ll jz lm kd lv lo lp lq bi translated">创造了VPC。</li></ol><pre class="mr ms mt mu fd mv mw mx my aw mz bi"><span id="9a73" class="kl km ht mw b fi na nb l nc nd"># — Creating vpc</span><span id="88ff" class="kl km ht mw b fi ne nb l nc nd">resource “aws_vpc” “ak-vpc” {<br/> cidr_block = “192.168.0.0/16”<br/> instance_tenancy = “default”<br/> enable_dns_hostnames = “true”</span><span id="bc72" class="kl km ht mw b fi ne nb l nc nd">tags = {<br/> Name = “ak-vpc”<br/> }<br/>}</span></pre><p id="58fb" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><strong class="jk hu"> 192.168.0.0/16 </strong>:范围在192.168.0.0和192.168.255.255之间，有65，534个可能的主机。这意味着在这个vpc下可以启动将近65，520个实例。</p><figure class="mr ms mt mu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nf"><img src="../Images/9c05a20b24dfb9363cb873d2c9503720.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e3VzQukoW0x7n5O7cIFd2w.png"/></div></div><figcaption class="ng nh et er es ni nj bd b be z dx translated">VPC</figcaption></figure></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><p id="5f5c" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">2.创建一个面向公众的互联网网关，将我们的VPC/网络连接到互联网世界，并将此网关连接到此VPC。</p><pre class="mr ms mt mu fd mv mw mx my aw mz bi"><span id="8858" class="kl km ht mw b fi na nb l nc nd"># — Creating internet-gateway</span><span id="bf4b" class="kl km ht mw b fi ne nb l nc nd">resource “aws_internet_gateway” “ak-igw” {<br/> vpc_id = “${aws_vpc.ak-vpc.id}”</span><span id="9237" class="kl km ht mw b fi ne nb l nc nd">tags = {<br/> Name = “ak-igw”<br/> }<br/>}</span></pre><p id="6e10" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">而且，没什么好解释的。</p><figure class="mr ms mt mu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nf"><img src="../Images/413ce4f3e206d606dd06831f98effbc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AvJD6-Y7m-QFWHRwX3Axrw.png"/></div></div><figcaption class="ng nh et er es ni nj bd b be z dx translated">互联网网关</figcaption></figure></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><p id="c6d8" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">3.在此VPC中，创建了2个子网:</p><p id="46aa" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">a)公共子网[公共世界可访问！]</p><p id="396b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">b)私有子网[仅限公共领域！].</p><pre class="mr ms mt mu fd mv mw mx my aw mz bi"><span id="0f4c" class="kl km ht mw b fi na nb l nc nd"># — Creating subnet</span><span id="3474" class="kl km ht mw b fi ne nb l nc nd">data “aws_availability_zones” “zones” {<br/> state = “available”<br/>}</span><span id="866d" class="kl km ht mw b fi ne nb l nc nd"># — Creating public subnet</span><span id="b3cb" class="kl km ht mw b fi ne nb l nc nd">resource ”aws_subnet” “public-subnet-1a” {<br/> availability_zone = “${data.aws_availability_zones.zones.names[0]}”<br/> cidr_block = “192.168.0.0/24”<br/> vpc_id = “${aws_vpc.ak-vpc.id}”<br/> map_public_ip_on_launch = “true”<br/> <br/> tags = {<br/> Name = “public-subnet-1a”<br/> }<br/>}</span><span id="e62f" class="kl km ht mw b fi ne nb l nc nd"># — Creating private subnet</span><span id="35da" class="kl km ht mw b fi ne nb l nc nd">resource ”aws_subnet” “private-subnet-1b” {<br/> availability_zone = “${data.aws_availability_zones.zones.names[1]}”<br/> cidr_block = “192.168.1.0/24”<br/> vpc_id = “${aws_vpc.ak-vpc.id}”</span><span id="a9b8" class="kl km ht mw b fi ne nb l nc nd">tags = {<br/> Name = “private-subnet-1b”<br/> }<br/>}</span></pre><p id="0382" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><strong class="jk hu"> 192.168.0.0/24: </strong>范围在192.168.0.0和192.168.0.255之间，有254个可能的主机。</p><p id="2a7e" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">在这里，数据“aws_availability_zones”意味着获取我们地区(ap-south-1)下的所有可用区域。因为“0”表示“ap-south-1a”子网，“1”表示“ap-south-1b”子网。</p><div class="mr ms mt mu fd ab cb"><figure class="nk hk nl nm nn no np paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/36dc4f3262bdd40466e4dacb03d9cde7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*zADsx1aX4VPZQ9vI_aaaRg.png"/></div></figure><figure class="nk hk nl nm nn no np paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/2002c0f09333af25f207df0a97e2715e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*dgOAlVqD5nRqxX541fCwqg.png"/></div></figure></div><div class="ab cb"><figure class="nk hk nq nm nn no np paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/907db0a8a3d623fb7e1b7c5b10f8eab3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*8hdo_WgutKvhur8r03V_yw.png"/></div></figure><figure class="nk hk nr nm nn no np paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/0c55b41a973eb6751085b2421e13ce7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*dvRtOuJu0pjM-VLizVVI7A.png"/></div><figcaption class="ng nh et er es ni nj bd b be z dx ns di nt nu translated">公共和私有子网</figcaption></figure></div></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><p id="7a69" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">4.为Internet gateway创建一个路由表，以便该实例可以连接到外部世界，更新并将其与公共子网相关联。</p><pre class="mr ms mt mu fd mv mw mx my aw mz bi"><span id="eca3" class="kl km ht mw b fi na nb l nc nd"># — Create route table</span><span id="d3ff" class="kl km ht mw b fi ne nb l nc nd">resource “aws_route_table” “ak-route-igw” {<br/> vpc_id = “${aws_vpc.ak-vpc.id}”</span><span id="4469" class="kl km ht mw b fi ne nb l nc nd">route {<br/> cidr_block = “0.0.0.0/0”<br/> gateway_id = “${aws_internet_gateway.ak-igw.id}”<br/> }<br/> <br/> tags = {<br/> Name = “ak-route-igw”<br/> }<br/>}</span></pre><p id="834a" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">就像剪指甲一样简单。</p><p id="15c2" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">现在，将其更新到公共子网。</p><pre class="mr ms mt mu fd mv mw mx my aw mz bi"><span id="80ed" class="kl km ht mw b fi na nb l nc nd"># — Subnet Association</span><span id="af54" class="kl km ht mw b fi ne nb l nc nd">resource “aws_route_table_association” “subnet-1a-asso” {<br/> subnet_id = “${aws_subnet.public-subnet-1a.id}”<br/> route_table_id = “${aws_route_table.ak-route-igw.id}”<br/>}</span></pre><div class="mr ms mt mu fd ab cb"><figure class="nk hk nl nm nn no np paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/336fe4e76772e591bda5dea22314aba8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*A3ekOTf98TdugDYSJqgWlg.png"/></div></figure><figure class="nk hk nl nm nn no np paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/852437ba32837de674c682faaf397e84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*tLO49plzPrmHnfR7LPtDEQ.png"/></div><figcaption class="ng nh et er es ni nj bd b be z dx ns di nt nu translated">路由表</figcaption></figure></div></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><p id="1bdf" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">5.启动一个ec2实例，它已经用安全组设置了MYSQL，允许在私有子网中使用端口3306，这样我们的WordPress VM就可以连接到相同的端口。</p><p id="4c20" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">此外，将密钥与相同的。</p><ul class=""><li id="ca63" class="lg lh ht jk b jl jm jo jp jr ls jv lt jz lu kd ln lo lp lq bi translated">创建密钥对。</li></ul><pre class="mr ms mt mu fd mv mw mx my aw mz bi"><span id="f3a4" class="kl km ht mw b fi na nb l nc nd"># — Creating Key Pairs for mySql</span><span id="28eb" class="kl km ht mw b fi ne nb l nc nd">resource “tls_private_key” “key4” {<br/> algorithm = “RSA”<br/> rsa_bits = 4096<br/>}</span><span id="b75a" class="kl km ht mw b fi ne nb l nc nd">resource “local_file” “key5” {<br/> content = “${tls_private_key.key4.private_key_pem}”<br/> filename = “mysql_key.pem”<br/> file_permission = 0400<br/>}</span><span id="e51c" class="kl km ht mw b fi ne nb l nc nd">resource “aws_key_pair” “key6” {<br/> key_name = “mysql_key”<br/> public_key = “${tls_private_key.key4.public_key_openssh}”<br/>}</span></pre><ul class=""><li id="cc03" class="lg lh ht jk b jl jm jo jp jr ls jv lt jz lu kd ln lo lp lq bi translated">创建安全组。</li></ul><pre class="mr ms mt mu fd mv mw mx my aw mz bi"><span id="dc6c" class="kl km ht mw b fi na nb l nc nd"># — Creating Security Groups for mySql</span><span id="db3e" class="kl km ht mw b fi ne nb l nc nd">resource “aws_security_group” “sg-db” {<br/> depends_on = [<br/> aws_security_group.sg-wp,<br/> ]<br/> name = “mySql-sg”<br/> description = “Allow TLS inbound traffic”<br/> vpc_id = “${aws_vpc.ak-vpc.id}”</span><span id="3180" class="kl km ht mw b fi ne nb l nc nd">ingress {<br/> description = “MYSQL/Aurora”<br/> from_port = 3306<br/> to_port = 3306<br/> protocol = “tcp”<br/> security_groups = [ “${aws_security_group.sg-wp.id}” ]<br/> }</span><span id="bf8f" class="kl km ht mw b fi ne nb l nc nd">egress {<br/> from_port = 0<br/> to_port = 0<br/> protocol = “-1”<br/> cidr_blocks = [“0.0.0.0/0”]<br/> }</span><span id="5559" class="kl km ht mw b fi ne nb l nc nd">tags = {<br/> Name = “mySql-sg”<br/> }<br/>}</span></pre><p id="939a" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">在这里，security _ groups =[" $ { AWS _ security _ group . SG-WP . id } "]表示MySql的安全组将只允许Wordpress实例在私有空间中安全连接。</p><p id="9401" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">只允许MySql端口3306和ssh 22。</p><ul class=""><li id="d951" class="lg lh ht jk b jl jm jo jp jr ls jv lt jz lu kd ln lo lp lq bi translated">正在启动实例。</li></ul><pre class="mr ms mt mu fd mv mw mx my aw mz bi"><span id="02d1" class="kl km ht mw b fi na nb l nc nd"># — Creatig Ec2 instance for mySql</span><span id="8bc5" class="kl km ht mw b fi ne nb l nc nd">resource “aws_instance” “database_server” {<br/> ami = “ami-08706cb5f68222d09”<br/> subnet_id = “${aws_subnet.private-subnet-1b.id}”<br/> availability_zone = “${data.aws_availability_zones.zones.names[1]}”<br/> instance_type = “t2.micro”<br/> root_block_device {<br/> volume_type = “gp2”<br/> delete_on_termination = true<br/> }<br/> key_name = “${aws_key_pair.key6.key_name}”<br/> vpc_security_group_ids = [ “${aws_security_group.sg-db.id}” ]<br/> <br/> tags = {<br/> Name = “MySql”<br/> }<br/>}</span></pre><p id="035f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">成功地在没有任何公共IP和DNS主机名的私有子网中启动MySql实例。</p><div class="mr ms mt mu fd ab cb"><figure class="nk hk nv nm nn no np paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/1c24ca85259c24436e1f3c082c67106a.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*2KYJfG9BuJjttUbZv0f1Wg.png"/></div></figure><figure class="nk hk nw nm nn no np paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/3d1c9ef91c05ffacae5bc01c6885d0ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*1GoncetYCRZPCtWkjCtQeg.png"/></div></figure><figure class="nk hk nx nm nn no np paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/f78005ba96274fe689c11e01b83562bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*tBrz5EhTVET6B9pnaC-oDw.png"/></div><figcaption class="ng nh et er es ni nj bd b be z dx ny di nz nu translated">关系型数据库</figcaption></figure></div></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><p id="dfcb" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">6.启动一个ec2实例，它的WordPress设置已经有了允许端口80的安全组，这样我们的客户端就可以连接到我们的WordPress站点。</p><p id="964d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">此外，将密钥附加到实例，以便进一步登录。</p><ul class=""><li id="1bc4" class="lg lh ht jk b jl jm jo jp jr ls jv lt jz lu kd ln lo lp lq bi translated">创建密钥对。</li></ul><pre class="mr ms mt mu fd mv mw mx my aw mz bi"><span id="73a1" class="kl km ht mw b fi na nb l nc nd"># — Creating Key Pairs for wordpress</span><span id="8998" class="kl km ht mw b fi ne nb l nc nd">resource “tls_private_key” “key1” {<br/> algorithm = “RSA”<br/> rsa_bits = 4096<br/>}</span><span id="7453" class="kl km ht mw b fi ne nb l nc nd">resource “local_file” “key2” {<br/> content = “${tls_private_key.key1.private_key_pem}”<br/> filename = “wordpress_key.pem”<br/> file_permission = 0400<br/>}</span><span id="7318" class="kl km ht mw b fi ne nb l nc nd">resource “aws_key_pair” “key3” {<br/> key_name = “wordpress_key”<br/> public_key = “${tls_private_key.key1.public_key_openssh}”<br/>}</span></pre><ul class=""><li id="1933" class="lg lh ht jk b jl jm jo jp jr ls jv lt jz lu kd ln lo lp lq bi translated">创建安全组。</li></ul><pre class="mr ms mt mu fd mv mw mx my aw mz bi"><span id="2ed9" class="kl km ht mw b fi na nb l nc nd"># — Creating Security Groups for wordpress</span><span id="25ba" class="kl km ht mw b fi ne nb l nc nd">resource “aws_security_group” “sg-wp” {<br/> name = “wordpress-sg”<br/> description = “Allow TLS inbound traffic”<br/> vpc_id = “${aws_vpc.ak-vpc.id}”</span><span id="1fc1" class="kl km ht mw b fi ne nb l nc nd">ingress {<br/> description = “SSH”<br/> from_port = 22<br/> to_port = 22<br/> protocol = “tcp”<br/> cidr_blocks = [ “0.0.0.0/0” ]<br/> }</span><span id="ba07" class="kl km ht mw b fi ne nb l nc nd">ingress {<br/> description = “HTTP”<br/> from_port = 80<br/> to_port = 80<br/> protocol = “tcp”<br/> cidr_blocks = [ “0.0.0.0/0” ]<br/> }</span><span id="6902" class="kl km ht mw b fi ne nb l nc nd">egress {<br/> from_port = 0<br/> to_port = 0<br/> protocol = “-1”<br/> cidr_blocks = [“0.0.0.0/0”]<br/> }</span><span id="6414" class="kl km ht mw b fi ne nb l nc nd">tags = {<br/> Name = “wordpress-sg”<br/> }<br/>}</span></pre><p id="2292" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">仅允许端口80和ssh端口22。</p><ul class=""><li id="953a" class="lg lh ht jk b jl jm jo jp jr ls jv lt jz lu kd ln lo lp lq bi translated">正在启动实例。</li></ul><pre class="mr ms mt mu fd mv mw mx my aw mz bi"><span id="7c33" class="kl km ht mw b fi na nb l nc nd"># — Creating Ec2 instance for wordpress</span><span id="d08b" class="kl km ht mw b fi ne nb l nc nd">resource “aws_instance” “web_server” {<br/> depends_on = [<br/> aws_instance.database_server,<br/> ]<br/> <br/> ami = “ami-004a955bfb611bf13”<br/> subnet_id = “${aws_subnet.public-subnet-1a.id}”<br/> availability_zone = “${data.aws_availability_zones.zones.names[0]}”<br/> instance_type = “t2.micro”<br/> root_block_device {<br/> volume_type = “gp2”<br/> delete_on_termination = true<br/> }<br/> key_name = “${aws_key_pair.key3.key_name}”<br/> vpc_security_group_ids = [ “${aws_security_group.sg-wp.id}” ]<br/> associate_public_ip_address = true<br/> <br/> tags = {<br/> Name = “Wordpress”<br/> }<br/>}</span></pre><p id="ef38" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">成功，在具有公共IP和DNS主机名的公共子网上启动。</p><div class="mr ms mt mu fd ab cb"><figure class="nk hk oa nm nn no np paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/8e52af0df77824707dcb93b836160eab.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*2KYJfG9BuJjttUbZv0f1Wg.png"/></div></figure><figure class="nk hk ob nm nn no np paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/5050747358ca22561623095563dfffd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*UrMLlO0Q473UnDNCChhErQ.png"/></div></figure><figure class="nk hk oa nm nn no np paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/cf7ddcab4beab83b96063916caa77ea5.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*8m2Jq5NaUMrqNZUVURnPfg.png"/></div><figcaption class="ng nh et er es ni nj bd b be z dx oc di od nu translated">wordpress软件</figcaption></figure></div></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h2 id="ee87" class="kl km ht bd kn ko kp kq kr ks kt ku kv jr kw kx ky jv kz la lb jz lc ld le lf bi translated">*用于运行所有上述命令或运行任何所需的设置</h2><pre class="mr ms mt mu fd mv mw mx my aw mz bi"><span id="dbe3" class="kl km ht mw b fi na nb l nc nd">terraform init<br/># to install desired plugins for that provider used.<br/><strong class="mw hu"><em class="lr">Note/- Use the above command only once after creating the code</em></strong></span><span id="08ad" class="kl km ht mw b fi ne nb l nc nd">terraform validate <br/># to check any error in the code.</span><span id="0b2b" class="kl km ht mw b fi ne nb l nc nd">terraform plan <br/># to see what you are going to create.</span><span id="8168" class="kl km ht mw b fi ne nb l nc nd">terraform apply<br/># to run the code or whole infrastructure at once.</span><span id="6bc3" class="kl km ht mw b fi ne nb l nc nd">terraform destroy<br/># to destroy whole infrastructure at once.</span></pre><h2 id="107f" class="kl km ht bd kn ko kp kq kr ks kt ku kv jr kw kx ky jv kz la lb jz lc ld le lf bi translated">*最终结果</h2><div class="mr ms mt mu fd ab cb"><figure class="nk hk nl nm nn no np paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/b8da2c97573421d7edb33eafc75516db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*pUH9mg5kQehd9Rbwm6Jp8A.png"/></div></figure><figure class="nk hk nl nm nn no np paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/7a072b66c45fda978ce61c3246b5a2a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Jddu5pqGVl5GTJGdNnB3Ew.png"/></div><figcaption class="ng nh et er es ni nj bd b be z dx ns di nt nu translated">WordPress网站</figcaption></figure></div></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><blockquote class="mb mc md"><p id="e518" class="ji jj lr jk b jl jm iu jn jo jp ix jq me js jt ju mf jw jx jy mg ka kb kc kd hb bi translated">完整代码请参考我的Github</p></blockquote><div class="hh hi ez fb hj oe"><a href="https://github.com/Akashdeep-47/cloud_task3.git" rel="noopener  ugc nofollow" target="_blank"><div class="of ab dw"><div class="og ab oh cl cj oi"><h2 class="bd hu fi z dy oj ea eb ok ed ef hs bi translated">Akashdeep-47/cloud_task3</h2><div class="ol l"><h3 class="bd b fi z dy oj ea eb ok ed ef dx translated">在我们自己的VPC亚马逊网络服务下，在公共和私有子网中启动Wordpress和MySql是一个…</h3></div><div class="om l"><p class="bd b fp z dy oj ea eb ok ed ef dx translated">github.com</p></div></div><div class="on l"><div class="oo l op oq or on os hp oe"/></div></div></a></div><h2 id="1f57" class="kl km ht bd kn ko kp kq kr ks kt ku kv jr kw kx ky jv kz la lb jz lc ld le lf bi translated">感谢阅读！！</h2><p id="2724" class="pw-post-body-paragraph ji jj ht jk b jl li iu jn jo lj ix jq jr ot jt ju jv ou jx jy jz ov kb kc kd hb bi translated">热烈欢迎掌声和建议。</p></div></div>    
</body>
</html>