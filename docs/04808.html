<html>
<head>
<title>PolyBase in SQL Server — A Dark Horse ETL Solution?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL Server中的PolyBase一个黑马ETL解决方案？</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/polybase-in-sql-server-a-dark-horse-etl-solution-99b3cfbc6c5c?source=collection_archive---------4-----------------------#2020-04-01">https://medium.com/analytics-vidhya/polybase-in-sql-server-a-dark-horse-etl-solution-99b3cfbc6c5c?source=collection_archive---------4-----------------------#2020-04-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/31ec5fa64983737452ea9fdbee61be70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jtQTbrryX8exV49L"/></div></div></figure><p id="03e8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">截至2020年，有数以千计的组织和微软商店运行在SQL Server上，使用各种各样的<em class="jo"> ETL </em>工具，如SSIS (SQL Server集成服务)和Azure Data Factory，用于<em class="jo">提取、转换&amp;加载</em>到各种不同数据源的数据。在这里，我们将看看PolyBase如何成为满足您所有ETL需求的一站式商店，因为它经常被忽略。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h2 id="2b72" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jb kh ki kj jf kk kl km jj kn ko kp kq bi translated">什么是PolyBase？</h2><p id="314e" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">PolyBase允许SQL Server实例轻松访问外部数据源，如链接服务器或数据库链接。该功能首次在SQL Server 2016中引入，允许访问Hadoop/HDFS和Azure Blob存储。</p><p id="76b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">随着SQL Server 2019的发布——除了Hadoop和Azure Blob存储，我们还可以访问存储在SQL Server、Oracle、Teradata和MongoDB中的外部数据。它还扩展到微软数据平台下的产品，即PDW(分析平台)和Azure Synapse Analytics(以前称为Azure SQL数据仓库)。</p><h2 id="10b4" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jb kh ki kj jf kk kl km jj kn ko kp kq bi translated">停下来。PolyBase和链接服务器不是一样的吗？</h2><p id="8c51" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">不完全是，虽然<a class="ae kw" href="https://docs.microsoft.com/en-us/sql/relational-databases/linked-servers/linked-servers-database-engine?view=sql-server-ver15" rel="noopener ugc nofollow" target="_blank">链接服务器</a>已经存在很久了——poly base是一个更加充实的功能，可以通过从外部来源获取数据来进行分析。PolyBase和链接服务器之间的一些区别是:</p><p id="499c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">PolyBase是<em class="jo">数据库范围的</em>,在其中您可以有效地查询数据，就像从Db中的任何其他表查询数据一样，并且可以有效地使用横向扩展特性。另一方面，链接服务器是实例范围的，其中主机数据库有效地对外部数据库进行单线程调用。(<em class="jo">旁注:Oracle Db link通过支持多线程调用在这里做得更好)</em></p><p id="7504" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">PolyBase使用ODBC连接，而SQL Server中的链接服务器使用OLEDB。微软在这里有一个成熟的常见问题解答。</p><h2 id="fc8f" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jb kh ki kj jf kk kl km jj kn ko kp kq bi translated">为什么使用SSIS和Azure数据工厂而不是PolyBase？</h2><p id="6423" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">虽然PolyBase使您的SQL Server成为访问外部数据源的一站式商店，但仍然需要使用微软生态系统中可用的成熟数据集成工具，即Azure Data Factory和SSIS:</p><ul class=""><li id="1563" class="kx ky hi is b it iu ix iy jb kz jf la jj lb jn lc ld le lf bi translated">延迟和性能问题——SSIS和Azure Data Factory都能很好地管理lrage工作负载，并允许细粒度控制，以避免延迟和性能障碍</li><li id="bc60" class="kx ky hi is b it lg ix lh jb li jf lj jj lk jn lc ld le lf bi translated">花哨的拖放UI——使用PolyBase的大部分基础工作和配置都是通过SQL查询完成的，而Azure Data Factory和SSIS都为构建强大的ETL管道提供了直观的界面</li></ul><p id="9d75" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">公平地说，PolyBase并不意味着完全取代你的ETL管道。</p><h2 id="62b1" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jb kh ki kj jf kk kl km jj kn ko kp kq bi translated">那么，我们何时以及如何使用PolyBase呢？</h2><p id="69a6" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">根据我使用所有这些工具的经验，PolyBase更适合ODS系统和staging、QA或测试环境，在这些环境中，需要在多个数据源之间进行快速原型制作和数据交换，或者需要导入固定数量的数据用于分析目的。</p><p id="4235" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一个强大的用例是从数据库或数据仓库导出旧数据进行归档，比如Azure Blob存储。</p><h2 id="19da" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jb kh ki kj jf kk kl km jj kn ko kp kq bi translated">安装和使用PolyBase</h2><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/f9786e96b9a9ee57d9873f100ed0005c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*499np2HwkaY83VAI8e79vw.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx translated">安装SQL Server时的功能选择</figcaption></figure><p id="9535" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在安装SQL Server的过程中选中PolyBase复选框，最重要的是，我们需要通过运行以下查询来启用该功能:</p><pre class="lm ln lo lp fd lu lv lw lx aw ly bi"><span id="8fd4" class="jw jx hi lv b fi lz ma l mb mc">exec sp_configure @configname = 'polybase enabled', @configvalue = 1;<br/>RECONFIGURE</span></pre><p id="6a36" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您还需要从<em class="jo"> services.msc </em>重新启动SQL Server引擎</p><p id="1c7e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在Linux (Ububtu)上:</p><p id="6d99" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装PolyBase并重新启动SQL Server:</p><pre class="lm ln lo lp fd lu lv lw lx aw ly bi"><span id="9432" class="jw jx hi lv b fi lz ma l mb mc">sudo apt-get remove mssql-server-polybase<br/>sudo apt-get update <br/>sudo apt-get install mssql-server-polybase</span><span id="570d" class="jw jx hi lv b fi md ma l mb mc">sudo systemctl restart mssql-server</span></pre><h2 id="b4f2" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jb kh ki kj jf kk kl km jj kn ko kp kq bi translated">添加外部数据源和运行查询</h2><p id="feac" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">您可以通过向导使用SSMS (SQL Server Management Studio)添加外部数据源，并查看外部表下的表和外部资源下的数据源。</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/40db04bd2c9ccd5fc73d418a51d2a67d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dWXciWmY6gDtnC30kwXCyg.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx translated">配置外部数据源</figcaption></figure><p id="1285" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">配置外部数据源的关键步骤包括:</p><ol class=""><li id="9076" class="kx ky hi is b it iu ix iy jb kz jf la jj lb jn mf ld le lf bi translated">为机密&amp;数据库范围的凭证创建主密钥</li><li id="890d" class="kx ky hi is b it lg ix lh jb li jf lj jj lk jn mf ld le lf bi translated">创建外部数据源(Hadoop、Oracle、Azure Blob存储等。)</li><li id="8c45" class="kx ky hi is b it lg ix lh jb li jf lj jj lk jn mf ld le lf bi translated">创建外部数据格式(CSV、拼花等)。</li><li id="41f5" class="kx ky hi is b it lg ix lh jb li jf lj jj lk jn mf ld le lf bi translated">创建外部表</li><li id="2820" class="kx ky hi is b it lg ix lh jb li jf lj jj lk jn mf ld le lf bi translated">创建统计信息和索引(聚集、非聚集或列存储)</li></ol><p id="6ee1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以上添加外部数据源和表的步骤，比如将数据导入Azure Blob存储和从Azure Blob存储导出数据——下面的GitHub repo中嵌入了一个示例用例:</p><p id="c468" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae kw" href="https://github.com/robathija/PolyBase-SQLServer-AzureBlobStorage/blob/master/PolyBase-SQLServer-AzureBlob-Query.sql" rel="noopener ugc nofollow" target="_blank">PolyBase-SQL server-AzureBlobStorage</a></p><p id="e133" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">配置其他数据源如Oracle和Hadoop可以在<a class="ae kw" href="https://docs.microsoft.com/en-us/sql/relational-databases/polybase/polybase-configure-oracle?view=sql-server-ver15" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="3b23" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如我们所看到的，PolyBase可以而且应该与传统的ETL工具一起使用，以享受两个世界的好处。</p></div></div>    
</body>
</html>