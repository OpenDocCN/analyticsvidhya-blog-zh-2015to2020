<html>
<head>
<title>Introduction to Anomaly Detection Using PyCarat</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PyCarat 异常检测简介</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/introduction-to-anomaly-detection-using-pycarat-519a13be24c5?source=collection_archive---------14-----------------------#2020-10-16">https://medium.com/analytics-vidhya/introduction-to-anomaly-detection-using-pycarat-519a13be24c5?source=collection_archive---------14-----------------------#2020-10-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7c88ed358996702f30a99274cb86da3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YNba4J7Rot_Aovtv.png"/></div></div></figure><h1 id="0235" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">什么是异常？</h1><p id="772f" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">根据定义，<a class="ae km" href="https://en.wikipedia.org/wiki/Anomaly_detection" rel="noopener ugc nofollow" target="_blank">异常</a>是偏离标准、正常或预期的东西。</p><p id="831b" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">当处理关于二元分类问题的数据集时，我们通常处理平衡数据集。这确保了模型挑选正确的特征来学习。现在，如果属于一个类的数据非常少，而几乎所有的数据点都属于另一个类，会发生什么呢？</p><p id="0475" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">在这种情况下，我们认为一个分类是“正常的”，稀疏数据点是“正常”分类点的偏差。</p><p id="7dbb" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">比如你每天两次锁门，上午 11 点去办公室前，晚上 10 点睡觉前。如果锁在凌晨 2 点被打开，这将被视为异常行为。异常检测是指预测这些情况，用于入侵检测、欺诈检测、健康监控等。</p><p id="551f" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated"><em class="ks">在本文中，我将向您展示如何在数据集上使用 pycaret 进行异常检测。</em></p><h1 id="21c2" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">PyCaret 是什么？</h1><p id="31eb" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated"><a class="ae km" href="https://pycaret.org/guide/" rel="noopener ugc nofollow" target="_blank"> PyCaret 是 Python 中的一个开源、<strong class="jq hj">低代码</strong>机器学习库，旨在减少从假设到洞察的周期时间。它非常适合想要通过在工作流程中使用 PyCaret 来提高其 ML 实验生产率的经验丰富的数据科学家，或者是公民数据科学家和对数据科学很少或没有编码背景的新手。PyCaret 允许您使用您选择的笔记本电脑环境，在几秒钟内从准备数据到部署模型。</a></p><p id="d7b5" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">因此，简而言之，pycaret 让您在 3 行代码内可视化和训练数据集上的模型变得非常容易！</p><p id="a67d" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">所以让我们开始吧！</p><h2 id="717e" class="kt ir hi bd is ku kv kw iw kx ky kz ja jz la lb je kd lc ld ji kh le lf jm lg bi translated">欺诈检测数据集</h2><p id="42c3" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我们使用来自 Kaggle competition 的<a class="ae km" href="https://www.kaggle.com/mlg-ulb/creditcardfraud" rel="noopener ugc nofollow" target="_blank">信用卡数据集进行欺诈检测</a>，其字段如下:</p><ol class=""><li id="0368" class="lh li hi jq b jr kn jv ko jz lj kd lk kh ll kl lm ln lo lp bi translated"><strong class="jq hj"> Time: </strong>包含每个事务与数据集中第一个事务之间经过的秒数。</li><li id="415a" class="lh li hi jq b jr lq jv lr jz ls kd lt kh lu kl lm ln lo lp bi translated"><strong class="jq hj"> V1-V28: </strong>应用 PCA 后获得的特征</li><li id="45c1" class="lh li hi jq b jr lq jv lr jz ls kd lt kh lu kl lm ln lo lp bi translated"><strong class="jq hj">金额:</strong>交易金额</li><li id="f265" class="lh li hi jq b jr lq jv lr jz ls kd lt kh lu kl lm ln lo lp bi translated"><strong class="jq hj">类:</strong> 0 —正常，1 —欺诈交易。我们不使用它来训练我们的模型，但是稍后将使用它来计算精确度。</li></ol><p id="e7ff" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">该数据集包含欧洲持卡人在 2013 年 9 月的信用卡交易。如下图所示，数据集高度不平衡，欺诈交易仅占 0.1%。使用 pyCaret，我们将尝试创建一个欺诈检测模型。</p><figure class="lw lx ly lz fd ij er es paragraph-image"><div class="er es lv"><img src="../Images/90eb62a6ebcca6bda35bc5d3641b3ae7.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*asCplU97UAfTQX-H8C4avg.png"/></div><figcaption class="ma mb et er es mc md bd b be z dx translated">这是数据集的计数图。</figcaption></figure><h2 id="68fe" class="kt ir hi bd is ku kv kw iw kx ky kz ja jz la lb je kd lc ld ji kh le lf jm lg bi translated">1.正在安装 PyCaret</h2><p id="5551" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">要安装 pycaret，请在命令提示符/google colab 中运行以下命令:</p><pre class="lw lx ly lz fd me mf mg mh aw mi bi"><span id="8551" class="kt ir hi mf b fi mj mk l ml mm">pip install pycaret</span></pre><p id="2ed8" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">如果您使用 Google Colab，请确保运行以下命令来渲染交互式绘图:</p><pre class="lw lx ly lz fd me mf mg mh aw mi bi"><span id="6e30" class="kt ir hi mf b fi mj mk l ml mm">from pycaret.utils import enable_colab</span><span id="4f82" class="kt ir hi mf b fi mn mk l ml mm">enable_colab()</span></pre><h2 id="be31" class="kt ir hi bd is ku kv kw iw kx ky kz ja jz la lb je kd lc ld ji kh le lf jm lg bi translated"><strong class="ak"> 2。设置环境</strong></h2><p id="bf02" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">设置功能要求数据为 pandas 数据帧，可选字段为 normalize、ignore_features 等。下面是设置命令:</p><pre class="lw lx ly lz fd me mf mg mh aw mi bi"><span id="450a" class="kt ir hi mf b fi mj mk l ml mm">exp_ano101 = setup(data, normalize = True, ignore_features = [''])</span></pre><p id="b473" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated"><em class="ks">数据</em>是熊猫数据帧，我们<a class="ae km" href="https://towardsdatascience.com/3-ways-to-load-csv-files-into-colab-7c14fcbdcb92" rel="noopener" target="_blank">使用 read_csv()从 csv 文件读取到数据帧</a>。因为我们使用的是无监督的异常检测，记得删除<em class="ks">类</em>列或者只在<em class="ks"> ignore_features </em>标志中提及它。</p><h2 id="34ea" class="kt ir hi bd is ku kv kw iw kx ky kz ja jz la lb je kd lc ld ji kh le lf jm lg bi translated">3.创建模型</h2><p id="9570" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">PyCaret 使得导入和使用模型变得很容易。<a class="ae km" href="https://pycaret.org/create-model/" rel="noopener ugc nofollow" target="_blank">你可以使用另一组模型，如逻辑回归、主成分分析等。</a></p><pre class="lw lx ly lz fd me mf mg mh aw mi bi"><span id="3283" class="kt ir hi mf b fi mj mk l ml mm">model_created = create_model('iforest')<br/>model_results = assign_model(model_created)</span></pre><p id="b7f4" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">在创建和分配模型之后，我们可以使用 model_results.head()来检查结果。将有两列追加到数据集，称为标签和分数。标签是数据点的预测类别。</p><h2 id="5448" class="kt ir hi bd is ku kv kw iw kx ky kz ja jz la lb je kd lc ld ji kh le lf jm lg bi translated">4.在二维和三维空间中绘制数据点</h2><p id="0e05" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">Pycaret 的<a class="ae km" href="https://pycaret.org/plot-model/" rel="noopener ugc nofollow" target="_blank"> plot_model </a>函数在分析不同方面的异常检测模型时派上了用场。此函数接受一个经过训练的模型对象并返回一个绘图。</p><p id="74fc" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">对于二维图(均匀流形近似和投影(UMAP)):</p><pre class="lw lx ly lz fd me mf mg mh aw mi bi"><span id="cd2e" class="kt ir hi mf b fi mj mk l ml mm">plot_model(iforest, plot = 'umap')</span></pre><figure class="lw lx ly lz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/20795052c9384592aefefda6b55f4367.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QthsVoDMahdCILFvBRcDOQ.png"/></div></div></figure><p id="c866" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">对于三维图(T-分布式随机相邻嵌入(t-SNE)):</p><pre class="lw lx ly lz fd me mf mg mh aw mi bi"><span id="3e59" class="kt ir hi mf b fi mj mk l ml mm">plot_model(iforest)</span></pre><figure class="lw lx ly lz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/a3515587ac66cc56919ec267ba3aa8e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wSWK-HgqEsP51MnzTD7p3g.png"/></div></div></figure><h2 id="d042" class="kt ir hi bd is ku kv kw iw kx ky kz ja jz la lb je kd lc ld ji kh le lf jm lg bi translated">4.检查模型的准确性</h2><p id="d642" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">现在，使用看不见的数据来获得模型的测试精度。使用上面的例子，我们得到了 95%的准确率</p><h1 id="ee2f" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">摘要</h1><p id="ce70" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">本文简要概述了异常检测以及如何在数据集上使用 PyCaret 进行异常检测。</p><p id="53df" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">您可以在此处查看该笔记本:<a class="ae km" href="https://github.com/pycaret/pycaret/blob/master/tutorials/Anomaly%20Detection%20Tutorial%20Level%20Beginner%20-%20ANO101.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/py caret/py caret/blob/master/tutorials/Anomaly % 20 detection % 20 tutorial % 20 level % 20 beginner % 20-% 20 ano 101 . ipynb</a></p></div></div>    
</body>
</html>