<html>
<head>
<title>Machine Learning Prediction as a RESTful Web Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">作为RESTful Web服务的机器学习预测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/ml-prediction-as-a-restful-web-service-9fa33d01566f?source=collection_archive---------2-----------------------#2019-10-18">https://medium.com/analytics-vidhya/ml-prediction-as-a-restful-web-service-9fa33d01566f?source=collection_archive---------2-----------------------#2019-10-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/68b46b0ee45d5d4e8c11f244938b80bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tDwHPaiMwyAZHOIu7BA8nA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">作为RESTful Web服务的ML预测</figcaption></figure><blockquote class="iu iv iw"><p id="bbf3" class="ix iy iz ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">对此类话题感兴趣或需要一些帮助？</p><p id="ac67" class="ix iy iz ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated"><strong class="ja hj">取得联系—</strong><a class="ae jw" href="https://linktr.ee/pranaychandekar" rel="noopener ugc nofollow" target="_blank"><strong class="ja hj">【https://linktr.ee/pranaychandekar】</strong>T5】</a></p></blockquote><p id="500a" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jx jk jl jm jy jo jp jq jz js jt ju jv hb bi translated">请仅参考<strong class="ja hj">演示</strong>部分(包括在内)。这篇文章是旧的，在<strong class="ja hj">演示</strong>部分之后的组件已经过时。<a class="ae jw" href="https://github.com/pranaychandekar/ml-prediction-web-service" rel="noopener ugc nofollow" target="_blank"> <strong class="ja hj"> GitHub </strong> </a>仓库中的master分支用最新的框架— <a class="ae jw" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ja hj"> FastAPI </strong> </a>更新。在<strong class="ja hj">简介</strong>部分可以找到更新后的存储库的链接。由于项目是容器化的，您仍然可以用相同的步骤托管web服务。</p><h1 id="3caf" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">介绍</h1><p id="5125" class="pw-post-body-paragraph ix iy hi ja b jb ky jd je jf kz jh ji jx la jl jm jy lb jp jq jz lc jt ju jv hb bi translated">通常我们会花很多时间在数据处理和微调机器学习模型上。但是假设我们令人满意地训练了一个ML模型。接下来呢？然后我们想用这个模型来预测生产。怎么会？</p><p id="6bac" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jx jk jl jm jy jo jp jq jz js jt ju jv hb bi translated">我们可以通过两种方式做到这一点:</p><ol class=""><li id="d297" class="ld le hi ja b jb jc jf jg jx lf jy lg jz lh jv li lj lk ll bi translated">我们可以将该模型集成到所有需要该模型预测的下游服务中。</li><li id="b69c" class="ld le hi ja b jb lm jf ln jx lo jy lp jz lq jv li lj lk ll bi translated">我们可以在web服务中托管ML模型，并公开一个<a class="ae jw" rel="noopener" href="/extend/what-is-rest-a-simple-explanation-for-beginners-part-1-introduction-b4a072f8740f"> REST API </a>，所有下游服务都可以调用它来进行预测。</li></ol><blockquote class="iu iv iw"><p id="efbf" class="ix iy iz ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated"><strong class="ja hj">注意</strong>:没有理想的方法去做。根据不同的需求，一种方法可能比另一种更好。</p></blockquote><p id="7445" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jx jk jl jm jy jo jp jq jz js jt ju jv hb bi translated">在本文中，我们将尝试第二种方法，即<strong class="ja hj"> ML预测Web服务。</strong></p><p id="c0fa" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jx jk jl jm jy jo jp jq jz js jt ju jv hb bi translated">作为开源贡献，我最近在GitHub上创建了一个项目，可以用作模板。</p><div class="lr ls ez fb lt lu"><a href="https://github.com/pranaychandekar/ml-prediction-web-service" rel="noopener  ugc nofollow" target="_blank"><div class="lv ab dw"><div class="lw ab lx cl cj ly"><h2 class="bd hj fi z dy lz ea eb ma ed ef hh bi translated">pranaychandekar/ml-预测-网络-服务</h2><div class="mb l"><h3 class="bd b fi z dy lz ea eb ma ed ef dx translated">一个简单的python web服务，以REST API的形式托管用于预测的机器学习模型。集装箱火车…</h3></div><div class="mc l"><p class="bd b fp z dy lz ea eb ma ed ef dx translated">github.com</p></div></div><div class="md l"><div class="me l mf mg mh md mi io lu"/></div></div></a></div><p id="be33" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jx jk jl jm jy jo jp jq jz js jt ju jv hb bi translated">我们将使用这个模板，而不是从头开始编写整个web服务，并且只关注那些需要根据个人需要来定制这个项目的组件。</p><h1 id="bc59" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">演示</h1><p id="5563" class="pw-post-body-paragraph ix iy hi ja b jb ky jd je jf kz jh ji jx la jl jm jy lb jp jq jz lc jt ju jv hb bi translated">通常，我们先实施，然后进行演示。但是我觉得我们应该通过演示来感受一下。然后，我们可以深入研究实现细节。所以在这一点上，我会推荐你尝试使用一个<a class="ae jw" href="https://docs.docker.com/install/" rel="noopener ugc nofollow" target="_blank"> Docker引擎</a>来构建和运行<a class="ae jw" href="https://github.com/pranaychandekar/ml-prediction-web-service" rel="noopener ugc nofollow" target="_blank">这个项目</a>。</p><p id="69f5" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jx jk jl jm jy jo jp jq jz js jt ju jv hb bi translated">从演示开始，请参考<a class="ae jw" href="https://github.com/pranaychandekar/ml-prediction-web-service" rel="noopener ugc nofollow" target="_blank">这个库</a>的主页文档。</p><h1 id="a07f" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">履行</h1><p id="e1bf" class="pw-post-body-paragraph ix iy hi ja b jb ky jd je jf kz jh ji jx la jl jm jy lb jp jq jz lc jt ju jv hb bi translated">需求:<a class="ae jw" href="https://docs.docker.com/install/" rel="noopener ugc nofollow" target="_blank"> Docker引擎</a>和一个文本编辑器</p><p id="f7b6" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jx jk jl jm jy jo jp jq jz js jt ju jv hb bi translated">该项目包括一个<strong class="ja hj"> <em class="iz"> Dockerfile </em> </strong>并使用<strong class="ja hj"><em class="iz"/></strong><a class="ae jw" href="https://sanic.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">Sanic框架</a>构建。以下是该项目的目录结构:</p><figure class="mk ml mm mn fd ij er es paragraph-image"><div class="er es mj"><img src="../Images/2c7e16900abb4708248edcd6a7219fec.png" data-original-src="https://miro.medium.com/v2/resize:fit:430/format:webp/1*3X_BmxP1ITt6BxgN3MDGbw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">项目目录结构</figcaption></figure><p id="efae" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jx jk jl jm jy jo jp jq jz js jt ju jv hb bi translated">目录的一些详细信息:</p><ol class=""><li id="9dbb" class="ld le hi ja b jb jc jf jg jx lf jy lg jz lh jv li lj lk ll bi translated"><strong class="ja hj"> conf </strong>:该目录包含两个文件I)<em class="iz"/><strong class="ja hj"><em class="iz">app . conf</em></strong>——包含服务配置和ii) <strong class="ja hj"> <em class="iz">日志。配置</em> </strong> —包含记录器配置。</li><li id="b699" class="ld le hi ja b jb lm jf ln jx lo jy lp jz lq jv li lj lk ll bi translated">文档:这个目录包含了所有与项目相关的文档。</li><li id="4df6" class="ld le hi ja b jb lm jf ln jx lo jy lp jz lq jv li lj lk ll bi translated"><strong class="ja hj"> logs </strong>:服务被配置为将所有日志文件写入该目录。</li><li id="2afb" class="ld le hi ja b jb lm jf ln jx lo jy lp jz lq jv li lj lk ll bi translated"><strong class="ja hj">资源</strong>:该目录包含了我们服务所需的所有资源，如模型、数据等。</li><li id="4cf5" class="ld le hi ja b jb lm jf ln jx lo jy lp jz lq jv li lj lk ll bi translated">src :这个目录包含了我们web服务的全部源代码，包括获取配置、解析请求、预测、准备响应、写日志等等。</li><li id="86d1" class="ld le hi ja b jb lm jf ln jx lo jy lp jz lq jv li lj lk ll bi translated">这个文件夹包含了我们的web服务的测试用例。</li></ol><p id="fdf2" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jx jk jl jm jy jo jp jq jz js jt ju jv hb bi translated"><em class="iz">有关单个文件的更多详细信息，请参考其中的源代码文档。</em></p><p id="75eb" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jx jk jl jm jy jo jp jq jz js jt ju jv hb bi translated">每当我们启动docker容器时，它将运行<strong class="ja hj"><em class="iz">start-server . sh</em></strong>脚本，该脚本在内部运行<strong class="ja hj"> <em class="iz"> train.py </em> </strong>(为预测训练模型)和<strong class="ja hj"><em class="iz">prediction . py</em></strong>(启动我们的web服务)。</p><blockquote class="iu iv iw"><p id="4378" class="ix iy iz ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated"><strong class="ja hj">注</strong>:文件<strong class="ja hj"> train.py </strong>为<strong class="ja hj">可选</strong>。我没有包含模型，这个模型很大，而是包含了数据和一个训练脚本来训练运行演示服务的模型。在创建您自己的定制web服务时，请删除start-server.sh中调用train.py的行，并将您自己的模型包含在<strong class="ja hj"> resource- &gt; model </strong>中。</p></blockquote><p id="3c32" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jx jk jl jm jy jo jp jq jz js jt ju jv hb bi translated"><strong class="ja hj"><em class="iz">prediction . py</em></strong>是我们定义所有端点和相应逻辑的控制器。</p><figure class="mk ml mm mn fd ij"><div class="bz dy l di"><div class="mo mp l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">预测. py</figcaption></figure><p id="a5a8" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jx jk jl jm jy jo jp jq jz js jt ju jv hb bi translated">运行上述脚本将公开两个基于web的API。正如我们在演示中已经体验过的，<em class="iz"> sanic-openapi </em>集成允许我们直接从<a class="ae jw" href="http://localhost:8080/swagger/" rel="noopener ugc nofollow" target="_blank">浏览器</a>访问这些api。</p><figure class="mk ml mm mn fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/9d16c482ebb3a9d97ea2063b58740043.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KB2ajxjKBgA0n3LLVGgTPQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Swagger UI</figcaption></figure><p id="53cb" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jx jk jl jm jy jo jp jq jz js jt ju jv hb bi translated">要更改以使用此模板托管您的自定义模型的文件:</p><ol class=""><li id="ea14" class="ld le hi ja b jb jc jf jg jx lf jy lg jz lh jv li lj lk ll bi translated"><a class="ae jw" href="https://github.com/pranaychandekar/ml-prediction-web-service/blob/master/conf/app.conf" rel="noopener ugc nofollow" target="_blank"> <strong class="ja hj"> <em class="iz"> app.conf </em> </strong> </a>:根据您的业务需求添加配置，如数据库连接详情等。</li><li id="e854" class="ld le hi ja b jb lm jf ln jx lo jy lp jz lq jv li lj lk ll bi translated"><a class="ae jw" href="https://github.com/pranaychandekar/ml-prediction-web-service/blob/master/src/services/classifier.py" rel="noopener ugc nofollow" target="_blank"><strong class="ja hj"><em class="iz">classifier . py</em></strong></a>:添加一个singleton类来加载你的ML模型。</li><li id="02bf" class="ld le hi ja b jb lm jf ln jx lo jy lp jz lq jv li lj lk ll bi translated"><a class="ae jw" href="https://github.com/pranaychandekar/ml-prediction-web-service/blob/master/src/services/prediction_service.py" rel="noopener ugc nofollow" target="_blank"><strong class="ja hj"><em class="iz">prediction _ service . py</em></strong></a>:调用分类器实例，执行预测任务。准备要发回的响应。</li><li id="af2a" class="ld le hi ja b jb lm jf ln jx lo jy lp jz lq jv li lj lk ll bi translated"><a class="ae jw" href="https://github.com/pranaychandekar/ml-prediction-web-service/blob/master/src/utils/request_parser.py" rel="noopener ugc nofollow" target="_blank"><strong class="ja hj"><em class="iz">request _ parser . py</em></strong></a>:添加解析自定义请求的逻辑。</li><li id="b748" class="ld le hi ja b jb lm jf ln jx lo jy lp jz lq jv li lj lk ll bi translated"><a class="ae jw" href="https://github.com/pranaychandekar/ml-prediction-web-service/blob/master/test/test_inference.py" rel="noopener ugc nofollow" target="_blank"><strong class="ja hj"><em class="iz">test _ prediction . py</em></strong></a>:添加您的业务逻辑对应的测试用例。</li><li id="1a02" class="ld le hi ja b jb lm jf ln jx lo jy lp jz lq jv li lj lk ll bi translated"><a class="ae jw" href="https://github.com/pranaychandekar/ml-prediction-web-service/blob/master/start-server.sh" rel="noopener ugc nofollow" target="_blank"><strong class="ja hj"><em class="iz">start-server . sh</em></strong></a>:移除第二行调用<a class="ae jw" href="https://github.com/pranaychandekar/ml-prediction-web-service/blob/master/train.py" rel="noopener ugc nofollow" target="_blank"><strong class="ja hj"><em class="iz">train . py</em></strong></a><strong class="ja hj"/>并将其从项目中移除。要托管web服务，我们只需要运行<a class="ae jw" href="https://github.com/pranaychandekar/ml-prediction-web-service/blob/master/prediction.py" rel="noopener ugc nofollow" target="_blank"><strong class="ja hj"><em class="iz">prediction . py</em></strong></a>。</li><li id="bb5b" class="ld le hi ja b jb lm jf ln jx lo jy lp jz lq jv li lj lk ll bi translated"><a class="ae jw" href="https://github.com/pranaychandekar/ml-prediction-web-service/blob/master/Dockerfile" rel="noopener ugc nofollow" target="_blank"><strong class="ja hj"><em class="iz">docker file</em></strong></a>:需要时更新。</li><li id="644b" class="ld le hi ja b jb lm jf ln jx lo jy lp jz lq jv li lj lk ll bi translated">更新代码文档。</li></ol><p id="8f18" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jx jk jl jm jy jo jp jq jz js jt ju jv hb bi translated">经过这些最小的改动，我们现在可以托管我们的自定义预测服务了。</p><h1 id="081d" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">外卖食品</h1><p id="b73d" class="pw-post-body-paragraph ix iy hi ja b jb ky jd je jf kz jh ji jx la jl jm jy lb jp jq jz lc jt ju jv hb bi translated">经过训练的ML模型可以通过直接将模型与下游服务集成来用于预测，或者我们可以将它作为RESTful web服务托管。在本教程中，我们探索了一个开源项目，我们可以使用它作为模板，只需稍作调整，就可以在docker容器中将我们的定制ML模型作为web服务托管。</p><p id="c055" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jx jk jl jm jy jo jp jq jz js jt ju jv hb bi translated">为了保持有趣，我建议通过调整项目来集成您的定制模型。<strong class="ja hj"> <em class="iz">分享你的经验和反馈</em> </strong>。</p><blockquote class="iu iv iw"><p id="733b" class="ix iy iz ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">对此类话题感兴趣或需要一些帮助？</p><p id="9f7f" class="ix iy iz ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">【联系方式】——<a class="ae jw" href="https://linktr.ee/pranaychandekar" rel="noopener ugc nofollow" target="_blank"><strong class="ja hj">https://linktr.ee/pranaychandekar</strong></a></p></blockquote><h1 id="0549" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">引文</h1><ol class=""><li id="d17c" class="ld le hi ja b jb ky jf kz jx mr jy ms jz mt jv li lj lk ll bi translated"><a class="ae jw" href="https://github.com/pranaychandekar/ml-prediction-web-service" rel="noopener ugc nofollow" target="_blank">ml-预测-web-服务</a>项目。</li><li id="8c37" class="ld le hi ja b jb lm jf ln jx lo jy lp jz lq jv li lj lk ll bi translated"><a class="ae jw" href="https://www.analyticsvidhya.com/blog/2016/11/an-introduction-to-apis-application-programming-interfaces-5-apis-a-data-scientist-must-know/" rel="noopener ugc nofollow" target="_blank">API介绍</a></li><li id="12f8" class="ld le hi ja b jb lm jf ln jx lo jy lp jz lq jv li lj lk ll bi translated"><a class="ae jw" rel="noopener" href="/extend/what-is-rest-a-simple-explanation-for-beginners-part-1-introduction-b4a072f8740f"> REST API </a></li><li id="18bc" class="ld le hi ja b jb lm jf ln jx lo jy lp jz lq jv li lj lk ll bi translated"><a class="ae jw" href="https://docs.docker.com/engine/reference/commandline/docker/" rel="noopener ugc nofollow" target="_blank">码头工人</a></li><li id="56d8" class="ld le hi ja b jb lm jf ln jx lo jy lp jz lq jv li lj lk ll bi translated"><a class="ae jw" href="https://fasttext.cc/docs/en/supervised-tutorial.html" rel="noopener ugc nofollow" target="_blank">模特培训</a></li></ol></div></div>    
</body>
</html>