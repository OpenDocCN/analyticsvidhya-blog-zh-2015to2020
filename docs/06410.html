<html>
<head>
<title>How to list all indexes in SQL Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何列出SQL Server中的所有索引</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-list-all-indexes-in-sql-server-6bb45c2c10e9?source=collection_archive---------14-----------------------#2020-05-21">https://medium.com/analytics-vidhya/how-to-list-all-indexes-in-sql-server-6bb45c2c10e9?source=collection_archive---------14-----------------------#2020-05-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="012d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我创建了一个列出SQL Server中所有索引脚本。同时，我想向您展示一些SQL Server脚本属性。我使用了<strong class="ih hj"> sp_MSforeachtable </strong>存储的过程来列出索引。下面的脚本显示了所有的索引，包括列和表名。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="5d75" class="jm jn hi ji b fi jo jp l jq jr">drop table if exists ##tmpTablesAndIndexes</span><span id="718a" class="jm jn hi ji b fi js jp l jq jr">create table ##tmpTablesAndIndexes</span><span id="c3a3" class="jm jn hi ji b fi js jp l jq jr">(</span><span id="8a48" class="jm jn hi ji b fi js jp l jq jr">id            int identity(1,1),</span><span id="8cbf" class="jm jn hi ji b fi js jp l jq jr">tname         varchar(100) null,</span><span id="8374" class="jm jn hi ji b fi js jp l jq jr">index_name    varchar(250) null,</span><span id="74b3" class="jm jn hi ji b fi js jp l jq jr">index_descr   varchar(250) null,</span><span id="1ca7" class="jm jn hi ji b fi js jp l jq jr">index_columns varchar(250) null</span><span id="8133" class="jm jn hi ji b fi js jp l jq jr">)</span><span id="adec" class="jm jn hi ji b fi js jp l jq jr">EXEC sp_MSforeachtable @command1='declare @tname varchar(100)</span><span id="f524" class="jm jn hi ji b fi js jp l jq jr">SELECT @tname=''?''</span><span id="be53" class="jm jn hi ji b fi js jp l jq jr">insert into#tmpTablesAndIndexes (index_name,index_descr,index_columns)<br/>exec sp_helpindex ''?''</span><span id="8e0d" class="jm jn hi ji b fi js jp l jq jr">update ##tmpTablesAndIndexes<br/>set tname=@tname<br/>where tname is null<br/>'</span><span id="9021" class="jm jn hi ji b fi js jp l jq jr">select tname,index_name,index_descr,index_columns</span><span id="3308" class="jm jn hi ji b fi js jp l jq jr">from ##tmpTablesAndIndexes</span><span id="af17" class="jm jn hi ji b fi js jp l jq jr">order by tname asc</span></pre><figure class="jd je jf jg fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es jt"><img src="../Images/e83b2e19e6e079931828876343e1dc7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z6ZVQiw7Y11qMfo486i9Hw.png"/></div></div></figure><p id="eadf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来分析脚本:</p><p id="6a36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在SQL Server 2016之前，如果要删除现有对象，可以使用以下类型的脚本:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="952c" class="jm jn hi ji b fi jo jp l jq jr">IF OBJECT_ID('dbo.Product, 'U') IS NOT NULL  DROP TABLE dbo.Product;</span></pre><p id="38ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是在2016版之后你可以使用<strong class="ih hj"> drop如果存在</strong>。例如:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="7b57" class="jm jn hi ji b fi jo jp l jq jr">DROP TABLE IF EXISTS dbo.Product</span></pre><p id="9c7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">表名前的##符号是什么？</p><p id="1ef4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">意思是全局临时表。临时表在表名前显示一个#符号。临时表在当前会话期间有效。但是在主会话关闭之前，可以从其他会话访问全局临时表。主会话是指创建表的时间。</p><p id="fd50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">什么是<strong class="ih hj"> sp_MSforeachtable？</strong></p><p id="90fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">sp_MSforeachtable 是一个存储过程，用于对当前数据库中的每个表迭代应用T-SQL命令。'?'表示表名。</p><p id="825b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一些样品:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="dcdb" class="jm jn hi ji b fi jo jp l jq jr">--- display all table names in a database</span><span id="a70e" class="jm jn hi ji b fi js jp l jq jr">exec sp_MSforeachtable @command1='select ''?'''</span><span id="2da0" class="jm jn hi ji b fi js jp l jq jr">---  display the size of all tables in a database</span><span id="13b4" class="jm jn hi ji b fi js jp l jq jr">EXEC sp_MSforeachtable @command1="EXEC sp_spaceused '?'"</span><span id="1e7c" class="jm jn hi ji b fi js jp l jq jr">--- rebuild all indexes of all tables in a database with fillfactor 80<br/>EXEC sp_MSforeachtable @command1="print '?' DBCC DBREINDEX ('?', ' ', 80)"</span></pre></div></div>    
</body>
</html>