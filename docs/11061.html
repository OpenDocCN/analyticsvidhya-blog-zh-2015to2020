<html>
<head>
<title>How to Query SQL on Data File</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在数据文件上查询SQL</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-query-sql-on-data-file-eaadbeff2abe?source=collection_archive---------7-----------------------#2020-11-16">https://medium.com/analytics-vidhya/how-to-query-sql-on-data-file-eaadbeff2abe?source=collection_archive---------7-----------------------#2020-11-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/d62f4e8143155885addff06dbc39e57e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*0UfmJNoFqxZi_WbDcoFYwA.png"/></div></figure><p id="9894" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在SQL中操作数据库数据既方便又高效。当我们试图计算文件时，将数据加载到数据库并在SQL中处理它是很自然的。问题是数据加载本身并不简单。如果有一种方法可以直接在文件上执行SQL查询，那将会非常方便。这里我将引入这样一个工具，esProc SPL，列出各种SQL文件查询场景并提供esProc示例程序。esProc是一个专门的数据计算引擎，SPL(esProc使用的结构化过程语言的缩写)拥有一套完整的SQL文件查询方法。</p><p id="7bd2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">本文在所有例子中都使用了文本文件。事实上，这些方法也适用于Excel文件。</p><h1 id="ca1b" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">1.过滤</h1><p id="9741" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">根据SQL中的指定条件从文本文件中选择记录。</p><p id="2592" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">示例:从学生成绩表<em class="kn"> Students_scores.txt </em>中选择1班学生的成绩。在该文件中，第一行包含列名，详细数据从第二行开始:</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es ko"><img src="../Images/ec5cf121bfa2eaccdbd30dca61f401da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/0*ZV4Jvadqgna5nx6e.png"/></div></figure><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="72a2" class="ky jl hi ku b fi kz la l lb lc">$select * from E:/txt/Students_scores.txt where CLASS = 1</span></pre><h1 id="dea1" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">2.聚合</h1><p id="87bc" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">在SQL文本文件中汇总数据。</p><p id="ed9f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">示例:根据学生成绩表计算语文平均分、数学最高分、英语总分。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="af88" class="ky jl hi ku b fi kz la l lb lc">$select avg(Chinese),max(Math),sum(English) from E:/txt/Students_scores.txt</span></pre><h1 id="51f5" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">3.列间计算</h1><p id="4e77" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">在SQL的文本文件中执行列间计算。</p><p id="4de9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">例:计算学生成绩表中每个学生的总分。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="d297" class="ky jl hi ku b fi kz la l lb lc">$select *,English+Chinese+Math as total_score from E:/txt/students_scores.txt</span></pre><p id="c0df" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下面是结果，其中添加了计算列total_score。</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ld"><img src="../Images/62b946c5a528552af65ecfe6495430b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lYQGV6pvq9GE1W_a.png"/></div></div></figure><h1 id="956a" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">4.选择语句</h1><p id="4352" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">我们可以使用CASE语句在SQL中执行复杂的条件查询。</p><p id="fc0d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">示例:确定学生成绩表中每个学生的英语成绩是否合格。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="f62f" class="ky jl hi ku b fi kz la l lb lc">$select *, case when English&gt;=60 then ‘Pass’ else ‘Fail’ end as English_evaluation from E:/txt/students_scores.txt</span></pre><p id="42f7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下面是A1的结果，其中添加了一个计算列English_evaluation。</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es li"><img src="../Images/497075b7202cfb117eb9d78df1155a72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cF-g67m1gSj6g5RF.png"/></div></div></figure><h1 id="955e" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">5.整理</h1><p id="6f26" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">在SQL中将文本文件中的数据按升序(或降序)排序。</p><p id="a202" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">示例:按班级升序和总分降序对学生成绩表进行排序。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="2e22" class="ky jl hi ku b fi kz la l lb lc">$select * from E:/txt/students_scores.txt order by CLASS,English+Chinese+Math desc</span></pre><h1 id="ad7a" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">6.顶级的</h1><p id="4227" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">在SQL中获取文本文件的Top-N。</p><p id="e0c9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">例如:获取英语成绩最高的三名学生的记录。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="d159" class="ky jl hi ku b fi kz la l lb lc">$select top 3 * from E:/txt/students_scores.txt order by English desc</span></pre><h1 id="d817" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">7.分组和聚合</h1><p id="2f11" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">在SQL中对文本文件中的数据执行分组和聚合。</p><p id="22c9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">例:求各班英语最低分，语文最高分，数学总分。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="5827" class="ky jl hi ku b fi kz la l lb lc">$select CLASS,min(English),max(Chinese),sum(Math) from E:/txt/students_scores.txt group by CLASS</span></pre><h1 id="e3e1" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">8.分组后过滤</h1><p id="a45a" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">对文本文件中的数据进行分组和汇总，然后在SQL中执行过滤。</p><p id="6d74" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">例子:找出英语平均成绩在70分以下的班级。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="2528" class="ky jl hi ku b fi kz la l lb lc">$select CLASS,avg(English) as avg_En from E:/txt/students_scores.txt group by CLASS having avg(English)&lt;70</span></pre><p id="f46a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是结果。</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es lj"><img src="../Images/b679044d66f8abae8c65d10636fb6599.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/0*xtSl8bZ2XvDV5eXc.png"/></div></figure><h1 id="320c" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">9.明显的</h1><p id="d4f2" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">在SQL中对文本文件中的数据执行不同的操作。</p><p id="2a10" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">示例:获取所有类的id。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="4cfa" class="ky jl hi ku b fi kz la l lb lc">$select distinct CLASS from E:/txt/students_scores.txt</span></pre><h1 id="da8e" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">10.独特计数</h1><p id="c21a" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">在SQL中对文本文件中的数据执行distinct操作后计数。</p><p id="301c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">示例:根据产品信息文件，统计不同种类产品的数量。以下是文件的一部分:</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es lk"><img src="../Images/06467b3dfed55bd17050bdfd1f2a1b16.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/0*MLO0pRY69_dVieEJ.png"/></div></figure><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="d0f6" class="ky jl hi ku b fi kz la l lb lc">$select count(distinct PID) from E:/txt/PRODUCT_SALE.txt</span></pre><h1 id="91e4" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">11.不同分组和计数</h1><p id="351c" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">对文本文件中的数据进行分组，并在SQL中对文本文件中的数据进行非重复计数。</p><p id="86a2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">示例:根据销售表，计算每种产品有销售记录的天数。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="6658" class="ky jl hi ku b fi kz la l lb lc">$select PID,count(distinct DATE) as no_sdate from E:/txt/PRODUCT_SALE.txt group by PID</span></pre><h1 id="3d1a" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">12.两表连接查询</h1><p id="5920" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">在SQL中对两个文本文件执行连接查询。</p><p id="1068" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">示例:产品信息和销售信息分别存储在两个文本文件中。我们想计算每份订单数量小于10的产品的总销售额。以下是文件的数据结构及其关系:</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es ll"><img src="../Images/93d1507735d942adeb82c1da7da1e9e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/0*YcDnuWHTy1TqGYRn.png"/></div></figure><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="edae" class="ky jl hi ku b fi kz la l lb lc">$select sum(S.quantity*P.Price) as total <br/>from E:/txt/Sales.txt as S join E:/txt/Products.txt as P on S.productid=P.ID <br/>where S.quantity&lt;=10</span></pre><h1 id="c321" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">13.多表连接查询</h1><p id="4b64" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">在SQL中对两个以上的文本文件执行连接查询。</p><p id="2060" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">示例:州信息、部门信息和员工信息存储在三个不同的文本文件中。我们想在人力资源部找到加州雇员的信息。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="bc1f" class="ky jl hi ku b fi kz la l lb lc">$select e.NAME as NAME<br/>from E:/txt/EMPLOYEE_J.txt as e <br/> join E:/txt/DEPARTMENT.txt as d on e.DEPTID=d.DEPTID <br/> join E:/txt/STATE.txt as s on e.STATEID=s.STATEID <br/>where <br/> d.NAME=’HR’ and s.NAME=’California’</span></pre><h1 id="30b4" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">14.多表、多级连接查询</h1><p id="3d6d" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">在SQL中对两个以上的文本文件执行多级连接查询。</p><p id="edf3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">示例:州信息、部门信息和员工信息存储在三个不同的文本文件中。我们想找到经理来自加利福尼亚的纽约州雇员的信息。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="afbb" class="ky jl hi ku b fi kz la l lb lc">$select e.NAME as ENAME<br/>from E:/txt/EMPLOYEE.txt as e <br/> join E:/txt/DEPARTMENT.txt as d on e.DEPT=d.NAME<br/> join E:/txt/EMPLOYEE.txt as emp on d.MANAGER=emp.EID <br/>where e.STATE=’New York’ and emp.STATE=’California’</span></pre><h1 id="a414" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">15.嵌套子查询</h1><p id="2a89" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">在嵌套子查询中使用非常复杂的SQL。</p><p id="b8dc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">示例:员工信息和部门信息存储在两个文本文件中。我们想找到拥有最年轻经理的部门。以下是这两个文件的部分内容:</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es lm"><img src="../Images/64c079d2e16b4d202392ff55b29cb43f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Hdl5qv8UYwBmQP1R.png"/></div></div></figure><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ln"><img src="../Images/94504ae8ab8d2de2804b564515702fc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*V7d_TYqGtbElXHzF.png"/></div></div></figure><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="06c3" class="ky jl hi ku b fi kz la l lb lc">$select emp.BIRTHDAY as BIRTHDAY,emp.DEPT as DEPT<br/>from E:/txt/DEPARTMENT.txt as dept <br/> join E:/txt/EMPLOYEE.txt emp <br/> on dept.MANAGER=emp.EID <br/>where <br/> emp.BIRTHDAY=(select max(BIRTHDAY) <br/> from ( select emp1.BIRTHDAY as BIRTHDAY <br/> from E:/txt/DEPARTMENT.txt as dept1 <br/> join E:/txt/EMPLOYEE.txt as emp1 <br/> on dept1.MANAGER=emp1.EID<br/>  )<br/> )</span></pre><h1 id="9a18" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">16.公共表表达式</h1><p id="cf98" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">使用SQL WITH子句计算文本文件中的数据。</p><p id="c3b2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">示例:基于上一示例中的相同文本文件，从部门表中找到指定的部门(人力资源、R&amp;D、销售),并对这些部门中的女性员工进行计数并计算平均工资。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="1e43" class="ky jl hi ku b fi kz la l lb lc">$with A as <br/>(select NAME as DEPT from E:/txt/DEPARTMENT.txt<br/>where NAME=’HR’ or NAME=’R&amp;D’ or NAME=’Sales’) </span><span id="e796" class="ky jl hi ku b fi lo la l lb lc">select A.DEPT DEPT,count(*) NUM,avg(B.SALARY) AVG_SALARY from <br/>A left join E:/txt/EMPLOYEE.txt B<br/>on A.DEPT=B.DEPT <br/>where B.GENDER=’F’ group by A.DEPT</span></pre></div></div>    
</body>
</html>