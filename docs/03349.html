<html>
<head>
<title>How to Create your own Search Engine with Python Language and Laravel Framework Step 2 of 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Python语言和Laravel框架创建自己的搜索引擎第2步，共4步</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-create-your-own-search-engine-with-python-language-and-laravel-framework-step-2-of-4-1e356e0efb90?source=collection_archive---------8-----------------------#2020-01-27">https://medium.com/analytics-vidhya/how-to-create-your-own-search-engine-with-python-language-and-laravel-framework-step-2-of-4-1e356e0efb90?source=collection_archive---------8-----------------------#2020-01-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="25f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤2:使用Python Scrapy进行数据爬行</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/75a10d73994c82c1002aace6c3efdf37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZDR7Q1F5ExAWaKfB3hA0sw.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><a class="ae jt" href="https://i.ytimg.com/vi/ve_0h4Y8nuI/maxresdefault.jpg" rel="noopener ugc nofollow" target="_blank">https://i.ytimg.com/vi/ve_0h4Y8nuI/maxresdefault.jpg</a></figcaption></figure><p id="d5aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一部分，我将编写一个网络爬虫，它将从<a class="ae jt" href="http://books.toscrape.com/index.html" rel="noopener ugc nofollow" target="_blank">书籍中抓取数据来抓取</a>网站。但是在我开始写代码之前，先简单介绍一下Scrapy本身。</p><h1 id="09aa" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">什么是Scrapy？</h1><p id="355c" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">来自<a class="ae jt" href="https://en.wikipedia.org/wiki/Scrapy" rel="noopener ugc nofollow" target="_blank">维基百科</a>:</p><blockquote class="kx ky kz"><p id="7346" class="if ig la ih b ii ij ik il im in io ip lb ir is it lc iv iw ix ld iz ja jb jc hb bi translated">Scrapy(发音为skray-pee)是一个免费的开源网络爬行框架，用Python编写。最初是为web抓取而设计的，它也可以用于使用API提取数据，或者作为通用的web爬虫。它目前由Scrapinghub Ltd .维护，这是一家网络抓取开发和服务公司。</p></blockquote><h1 id="8e35" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">先决条件</h1><p id="918e" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">因此，与上一部分一样，在本部分教程中，您应该具备:</p><ul class=""><li id="230e" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated">python 3.x.x</li><li id="384b" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">软件包管理器PIP</li><li id="29d0" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">代码编辑器(在本教程中，我将使用Visual Studio代码，可选)</li></ul><h1 id="594f" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">安装刮刀</h1><p id="4c6e" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">现在，在我们开始我们的第一个Scrapy项目之前，我们需要安装Scrapy，所以打开您的终端并键入:</p><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="42c3" class="lx jv hi lt b fi ly lz l ma mb">pip install scrapy</span></pre><h1 id="aad2" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">开始你的第一个项目</h1><p id="0f8f" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">在您的终端中键入:</p><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="f7f2" class="lx jv hi lt b fi ly lz l ma mb">scrapy startproject &lt;project_name&gt;</span></pre><p id="83f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中<em class="la"> &lt; project_name &gt; </em>是项目名称，想怎么叫就怎么叫。但是在本教程中，我将使用“web_scrap”</p><h1 id="01fa" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">杂乱的项目结构</h1><p id="9e30" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">在我们开始刮削过程之前，我们最好知道scrapy项目的结构</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mc"><img src="../Images/d08b0eeb70a9f8c0dabdb3ee63157df1.png" data-original-src="https://miro.medium.com/v2/resize:fit:562/format:webp/1*TkDcr3mGcPnxV771rmX7YA.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Scrapy项目的结构</figcaption></figure><p id="0962" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi md translated">如运行<strong class="ih hj"> <em class="la"> startproject </em> </strong>命令后所见，scrapy将自动创建项目。但是在新创建的项目中，你不会看到文件<strong class="ih hj">"<em class="la">book _ list . py</em>"</strong>，因为它是手动创建的用于抓取的文件。而<strong class="ih hj"> " <em class="la"> book.json </em> " </strong>这是不是一个刺儿头过程的结果。</p><h1 id="8d0c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">制作杂乱的脚本</h1><p id="2aca" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">和前面项目的结构一样，我们将在<strong class="ih hj"><em class="la">【蜘蛛】</em> </strong>目录下为scrapy创建一个脚本。在本教程中，我创建了一个名为“<strong class="ih hj"> book_list.py </strong>”的剪贴簿脚本。如果您有VS代码，只需键入:</p><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="2bb6" class="lx jv hi lt b fi ly lz l ma mb">code &lt;project_name&gt;/spiders/book_list.py</span></pre><p id="c562" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用这个脚本填充你的空白脚本:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="me mf l"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">book_list.py</figcaption></figure><h1 id="f08b" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">介绍剧本</h1><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="3ef0" class="lx jv hi lt b fi ly lz l ma mb">import scrapy<br/>import json</span><span id="3c50" class="lx jv hi lt b fi mg lz l ma mb">filename = "book.json"  # To save store data</span></pre><p id="bf58" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一行中，代码是声明废料和确定输出文件的地方。在本教程中，我将输出文件导出到JSON格式文件。</p><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="a297" class="lx jv hi lt b fi ly lz l ma mb"><em class="la">class</em> IntroSpider(<em class="la">scrapy</em>.<em class="la">Spider</em>):<br/>    name = "book_spider"     # Name of the scraper</span></pre><p id="3cbc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“<strong class="ih hj"> <em class="la">名称</em> </strong>”属性描述了要创建的蜘蛛废料的名称。您可以使用其他名称来代替。<strong class="ih hj">名称</strong>类属性，基本上我们用来从命令行调用或启动蜘蛛记住在Scrapy中每个蜘蛛都应该有一个唯一的名称。</p><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="0ae3" class="lx jv hi lt b fi ly lz l ma mb">urls = ['http://books.toscrape.com/catalogue/page-{x}.html'.format(x=x) for x in range(1, 50) ]</span></pre><p id="954b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">URL列表，我们用它来指定我们想要抓取的网站/页面。</p><p id="688d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一个是负责解析DOM的<strong class="ih hj"> parse </strong>方法，我们在这里编写CSS选择器表达式来提取数据。</p><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="e9e7" class="lx jv hi lt b fi ly lz l ma mb">book_list = response.css('article.product_pod &gt; h3 &gt; a::attr(title)').extract()  # accessing the titles</span><span id="2b51" class="lx jv hi lt b fi mg lz l ma mb">link_list = response.css('article.product_pod &gt; h3 &gt; a::attr(href)').extract()  # accessing the title links</span><span id="93bf" class="lx jv hi lt b fi mg lz l ma mb">price_list = response.css('article.product_pod &gt; div.product_price &gt; p.price_color::text').extract() # accessing the price</span><span id="88eb" class="lx jv hi lt b fi mg lz l ma mb">image_link = response.css('article.product_pod &gt; div.image_container &gt; a &gt; img::attr(src)').extract()  # accessing the image links</span></pre><p id="4106" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要得到你所需要的CSS选择器，你只需要访问网站并做这些事情。</p><ul class=""><li id="c5e1" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated">打开网站</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mh"><img src="../Images/4251a999172bb70bf928bbede028860e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uLCY1dxc1tj--UsbyoGFGA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><a class="ae jt" href="http://books.toscrape.com/catalogue/page-2.html" rel="noopener ugc nofollow" target="_blank">http://books.toscrape.com/catalogue/page-2.html</a></figcaption></figure><ul class=""><li id="85e4" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated">按下键盘上的“<strong class="ih hj"><em class="la">”CTRL+Shift+I</em></strong>”，或者你可以点击鼠标右键，在浏览器上选择“检查元素”</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mi"><img src="../Images/603813e4447ef09357098e9669b1e513.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P-Mc2a8MQlGSfTXW8pQIpA.png"/></div></div></figure><ul class=""><li id="470d" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated">最后右键点击你想抓取的代码行，复制CSS选择器。然后你得到CSS选择器路径，或者你可以复制CSS路径，然后自己修改成CSS选择器</li></ul><p id="d05f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们希望用下面的代码将输出写入JSON文件:</p><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="5b6b" class="lx jv hi lt b fi ly lz l ma mb">i=0;<br/>for book_title in book_list:<br/>  data={<br/>       'book_title' : book_title,<br/>       'price' : price_list[i],<br/>       'image-url' : image_link[i],<br/>       'url' : link_list[i]<br/>   }<br/>  i+=1<br/>  list_data.append(data)</span><span id="77b5" class="lx jv hi lt b fi mg lz l ma mb">with open(filename, 'a+') as f:   # Writing data in the file<br/>   for data in list_data :<br/>   app_json = json.dumps(data)<br/>   f.write(app_json+"\n")</span></pre><p id="f980" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这一行代码的JSON格式的结果是:</p><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="92de" class="lx jv hi lt b fi ly lz l ma mb">{ "book_title": "the title", "price": "the price", "image-url": "the image url", "url" : "the title url" }</span></pre><h1 id="e68e" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">执行Scrapy</h1><p id="6c17" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">在执行你的scrapy之前，你必须在项目目录中，所以从命令行或你的终端导航到你的项目文件夹</p><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="ce49" class="lx jv hi lt b fi ly lz l ma mb">cd &lt;project_name&gt;</span></pre><p id="1465" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，在命令行中，您可以使用以下命令启动蜘蛛</p><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="3d6b" class="lx jv hi lt b fi ly lz l ma mb">scrapy crawl &lt;spider_name&gt; </span></pre><p id="9a34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><spider_name>是从"<strong class="ih hj"> <em class="la"> name </em> </strong>"属性中早先得到的，所以在我的例子中我将运行:</spider_name></p><pre class="je jf jg jh fd ls lt lu lv aw lw bi"><span id="8c1f" class="lx jv hi lt b fi ly lz l ma mb">scrapy crawl book_spider</span></pre><h1 id="6e77" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">输出</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mj"><img src="../Images/ebd4251d31790e4bccc8fcda06ec3138.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4aXPYNlQXJ5WmduWSQpu2Q.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">book.json</figcaption></figure><p id="c448" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果成功，您将得到名为“<strong class="ih hj"> book.json </strong>的输出结果，其中包含我们创建搜索引擎所需的数据集</p><h1 id="9223" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">参考:</h1><p id="640c" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">代号:<a class="ae jt" href="https://github.com/Andika7/searchbook" rel="noopener ugc nofollow" target="_blank">https://github.com/Andika7/searchbook</a></p><h1 id="c9f1" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">进行下一部分！</h1><p id="808b" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">我希望本教程的第二部分对你有所帮助。我们学习了用Python Scrapy收集数据集</p><p id="330a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下一部分，我们将使用Python编程语言制作索引器和查询脚本</p><p id="4695" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请参考该部分的链接:</p><p id="3b3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第一部分</strong>:<a class="ae jt" rel="noopener" href="/analytics-vidhya/how-to-create-your-own-search-engine-with-python-language-and-laravel-framework-step-1-of-4-f25e5ba1ab92">https://medium . com/analytics-vid hya/how-to-create-your-own-search-engine-with-python-language-and-laravel-framework-step-1-of-4-f 25 e 5 ba 1 ab 92</a></p><p id="990a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第三部分</strong>:<a class="ae jt" href="https://builtin.com/machine-learning/index-based-search-engine-python" rel="noopener ugc nofollow" target="_blank">https://builtin . com/machine-learning/index-based-search-engine-python</a></p><p id="6a8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第四部分:<a class="ae jt" rel="noopener" href="/analytics-vidhya/how-to-create-your-own-search-engine-with-python-language-and-laravel-framework-step-4-of-4-4e91cf2557d6">https://medium . com/analytics-vid hya/how-to-create-your-own-search-engine-with-python-language-and-laravel-framework-step-4-of-4 e 91 cf 2557d 6</a></p></div></div>    
</body>
</html>