<html>
<head>
<title>Deploy Deep Learning Models With FastAPI Step by Step</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用FastAPI逐步部署深度学习模型</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/fastapi-for-serve-simple-deep-learning-models-step-by-step-d054cf240a4c?source=collection_archive---------5-----------------------#2020-10-17">https://medium.com/analytics-vidhya/fastapi-for-serve-simple-deep-learning-models-step-by-step-d054cf240a4c?source=collection_archive---------5-----------------------#2020-10-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d7a39aced3e9d1c1bc139b5782442bee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XLgguWcLu7NchsCQ"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">卢克·切瑟在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="e32e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://fastapi.tiangolo.com" rel="noopener ugc nofollow" target="_blank"> FastAPI </a>如今越来越受欢迎，因为它的性能和简单易学。</p><p id="0542" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我将展示如何使用Keras创建模型，以及如何使用FastAPI服务模型。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="b0d1" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">使用Keras创建模型</h1><p id="a33a" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">在本节中，我们将学习如何使用Keras和深度学习来执行回归。我们将学习如何为回归和连续值预测训练Keras模型，特别是在简单函数预测的上下文中。</p><p id="eb94" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">举个例子，如果你在为这样的函数写代码，你已经知道规则了。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="eced" class="lm kb hi li b fi ln lo l lp lq">def f(x):<br/>    y = (2 * x) - 1<br/>    return y</span></pre><p id="0da9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">那么，你如何训练一个神经网络来完成同样的任务呢？用数据！通过给它输入X的集合，和Y的集合，它应该能弄清楚它们之间的关系。</p><p id="b2eb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">想象一下数据是:</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="c36a" class="lm kb hi li b fi ln lo l lp lq">xs = np.array([-1.0,  0.0, 1.0, 2.0, 3.0, 4.0], dtype=float)</span><span id="55f8" class="lm kb hi li b fi lr lo l lp lq">ys = np.array([-3.0, -1.0, 1.0, 3.0, 5.0, 7.0], dtype=float)</span></pre><p id="d334" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，我们将创建尽可能简单的神经网络。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="382b" class="lm kb hi li b fi ln lo l lp lq">import tensorflow as tf<br/>import numpy as np<br/>from tensorflow import keras</span><span id="f80f" class="lm kb hi li b fi lr lo l lp lq">model = tf.keras.Sequential([<br/>   keras.layers.Dense(units=4, input_shape=[1]),<br/>   keras.layers.Dense(units=8),<br/>   keras.layers.Dense(units=1),<br/>   ])</span><span id="d0a0" class="lm kb hi li b fi lr lo l lp lq">model.summary()</span></pre><figure class="ld le lf lg fd ij er es paragraph-image"><div class="er es ls"><img src="../Images/8e002d2bc678aef737674211a84e90f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*HdUprZnvuI1EffBPBypwKg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">模型.摘要()</figcaption></figure><p id="428b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你想看模型图，我们可以用keras utils来看。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="45fd" class="lm kb hi li b fi ln lo l lp lq">tf.keras.utils.plot_model(model, show_shapes=True)</span></pre><figure class="ld le lf lg fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/e33ad9b87924baae96152c300cd123ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*4RLwSm55agrczsXujGmaYw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">Keras模型图</figcaption></figure><p id="0445" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来我们将输入一些数据。在这种情况下，我们取6x和6y。你可以看到它们之间的关系是y = 2x-1。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="c874" class="lm kb hi li b fi ln lo l lp lq">xs = np.array([-1.0,  0.0, 1.0, 2.0, 3.0, 4.0], dtype=float)<br/>ys = np.array([-3.0, -1.0, 1.0, 3.0, 5.0, 7.0], dtype=float)</span><span id="d9ef" class="lm kb hi li b fi lr lo l lp lq">model.compile(optimizer='sgd', loss='mean_squared_error')</span><span id="26c4" class="lm kb hi li b fi lr lo l lp lq">model.fit(xs, ys, epochs=100)</span></pre><p id="9127" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">好了，现在我们有了一个模型，它已经被训练来学习X和Y之间的关系。你可以使用<strong class="ix hj"> model.predict </strong>方法来计算出先前未知的X的Y。例如，如果X = 10，那么你认为Y会是多少？</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="9278" class="lm kb hi li b fi ln lo l lp lq">print(model.predict([10.0])</span></pre><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/444e298ef42d58f75207ddcc2ddc5644.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bg4k53qJltSo7SLN6mZzEA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">预测模型的结果([10])</figcaption></figure><p id="d435" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可能有强硬的19权利，但它结束了有点下。为什么？？</p><p id="d21f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">记住神经网络处理概率。只有6个数据点，我们无法确定答案。因此，10的结果非常接近19，但不一定是19。</p><p id="0e9d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后用model.save('model ')保存模型。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="81a8" class="lm kb hi li b fi ln lo l lp lq">model.save('model')</span></pre><p id="cb81" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">它将创建名为model的新文件夹。在下一篇教程中，我们将使用该模型通过FastAPI创建API。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="9c00" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">带有Keras模型的FastAPI</h1><p id="4cd3" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">首先，您必须确保您已经安装了所有的需求。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="a8d6" class="lm kb hi li b fi ln lo l lp lq">pip install fastapi<br/>pip install uvicorn </span><span id="b4c9" class="lm kb hi li b fi lr lo l lp lq">pip install tensorflow</span></pre><p id="7ad7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后在我们之前保存的模型目录下创建一个名为<strong class="ix hj"> main.py </strong>的新文件。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="5785" class="lm kb hi li b fi ln lo l lp lq"> --your-directory/<br/>    -model/<br/>    -main.py</span></pre><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="lv lw l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">简单快速api代码</figcaption></figure><p id="f5c7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后用紫玉米做实验。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="f4cb" class="lm kb hi li b fi ln lo l lp lq">uvicorn main:app --reload</span></pre><p id="5b8b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<strong class="ix hj"> localhost:8000 </strong>打开浏览器。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/af2aecffb2d3da44f6a6660f6d3f48b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tTP5_hxhvui_qcijp4bNbQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">用浏览器打开</figcaption></figure><p id="ac27" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">FastAPI基于OpenAPI和JSON模式的开放标准。因此，它可以自动为我们的web API构建一个SwaggerUI，而无需任何额外的编码。打开浏览器，打开<strong class="ix hj"> localhost:8000/docs </strong>。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/45dca5bd1a3c6f39f895b785dc91cc69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9LExULRpQlRmh62Pf6lMdA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">FastAPI文档</figcaption></figure><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/96a9b95ba7d83918dd01d1485b812350.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mC9gAkxj9khP-6eXxQtYtw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">FastAPI</figcaption></figure><p id="6b81" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们将尝试使用之前训练过模型进行预测。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ma"><img src="../Images/aff55e858b32f6ee065337f206e4a7d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q-WaWoScR2_FBtfsXi7bhw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">如果用户输入= 10，则结果为18.9794</figcaption></figure><p id="01c7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我只想给大家展示一下如何使用终端与FastAPI进行交互(因为我并不真正擅长现代Web框架)。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/594c7752fb4c4891aad98a5ce2c1a30e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vk94UQb23IiLJo3gIo5cSA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">使用终端的结果。</figcaption></figure><h1 id="d572" class="ka kb hi bd kc kd mc kf kg kh md kj kk kl me kn ko kp mf kr ks kt mg kv kw kx bi translated">摘要</h1><p id="214b" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">在本教程中，我们看到了使用FastAPI部署机器学习/深度学习模型有多容易。随便问。</p><p id="8d13" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我的github仓库里的所有源代码。</p><div class="mh mi ez fb mj mk"><a href="https://github.com/rahmatfaisal/simple-fastapi-kerasModel" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab dw"><div class="mm ab mn cl cj mo"><h2 class="bd hj fi z dy mp ea eb mq ed ef hh bi translated">rahmatfaisal/simple-fastapi-kerasModel</h2><div class="mr l"><h3 class="bd b fi z dy mp ea eb mq ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ms l"><p class="bd b fp z dy mp ea eb mq ed ef dx translated">github.com</p></div></div><div class="mt l"><div class="mu l mv mw mx mt my io mk"/></div></div></a></div><div class="mh mi ez fb mj mk"><a href="https://fastapi.tiangolo.com" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab dw"><div class="mm ab mn cl cj mo"><h2 class="bd hj fi z dy mp ea eb mq ed ef hh bi translated">FastAPI</h2><div class="mr l"><h3 class="bd b fi z dy mp ea eb mq ed ef dx translated">FastAPI框架，高性能，简单易学，快速编码，准备生产文档…</h3></div><div class="ms l"><p class="bd b fp z dy mp ea eb mq ed ef dx translated">fastapi.tiangolo.com</p></div></div><div class="mt l"><div class="mz l mv mw mx mt my io mk"/></div></div></a></div><p id="88ab" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所有神经神经代码都属于劳伦斯·莫罗尼(谷歌首席人工智能倡导者)。</p><div class="mh mi ez fb mj mk"><a href="https://github.com/lmoroney/dlaicourse" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab dw"><div class="mm ab mn cl cj mo"><h2 class="bd hj fi z dy mp ea eb mq ed ef hh bi translated">lmoroney/dlaicourse</h2><div class="mr l"><h3 class="bd b fi z dy mp ea eb mq ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ms l"><p class="bd b fp z dy mp ea eb mq ed ef dx translated">github.com</p></div></div><div class="mt l"><div class="na l mv mw mx mt my io mk"/></div></div></a></div></div></div>    
</body>
</html>