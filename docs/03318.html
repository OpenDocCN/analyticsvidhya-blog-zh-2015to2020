<html>
<head>
<title>How to create a Python library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建Python库</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-create-a-python-library-7d5aea80cc3f?source=collection_archive---------0-----------------------#2020-01-26">https://medium.com/analytics-vidhya/how-to-create-a-python-library-7d5aea80cc3f?source=collection_archive---------0-----------------------#2020-01-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/27615ab13153e18315a5f1ce18e1f833.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*S8WritM-1NnZr_Yk"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://unsplash.com/@inakihxz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">伊尼基·德尔奥尔莫</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="e84c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有没有想过创建一个Python库，不管是为你的团队工作还是为一些在线开源项目？在这个博客中，你将学会如何！</p><p id="da28" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当您使用相同的工具时，本教程最容易理解，但是您也可以使用不同的工具。</p><p id="e845" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本教程使用的工具有:<br/> - Linux命令提示符<br/> - Visual Studio代码</p><p id="7c80" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第一步:创建一个目录，在其中放置你的库<br/> </strong>打开你的命令提示符，创建一个文件夹，在其中你将创建你的Python库。</p><p id="4d0a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">记住:<br/>——用<code class="du jt ju jv jw b">pwd</code>可以看到你现在的工作目录。<br/> -使用<code class="du jt ju jv jw b">ls</code>您可以列出目录中的文件夹和文件。<br/> -使用<code class="du jt ju jv jw b">cd &lt;path&gt;</code>你可以改变你当前所在的目录。<br/> -使用<code class="du jt ju jv jw b">mkdir &lt;folder&gt;</code>您可以在工作目录中创建一个新文件夹。</p><p id="60b8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我的例子中，我将使用的文件夹是<code class="du jt ju jv jw b">mypythonlibrary</code>。将当前工作目录更改为您的文件夹。</p><p id="3adf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第二步:为你的文件夹创建一个虚拟环境<br/> </strong>在开始你的项目时，创建一个虚拟环境来封装你的项目总是一个好主意。虚拟环境由某个Python版本和一些库组成。</p><p id="4d8e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">虚拟环境可以防止以后遇到依赖性问题。例如，在旧的项目中，您可能已经使用了旧版本的<code class="du jt ju jv jw b">numpy</code>库。一些曾经工作得很好的旧代码，一旦你更新了它的版本，就可能停止工作。也许<code class="du jt ju jv jw b">numpy</code>的某些部分不再与你程序的其他部分兼容。创建虚拟环境可以防止这种情况。当您与其他人协作，并且您希望确保您的应用程序在他们的计算机上运行时，它们也很有用，反之亦然。</p><p id="dfe5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">(确保将当前工作目录更改为将要创建Python库的文件夹(<code class="du jt ju jv jw b">cd &lt;path/to/folder&gt;</code>)。)</p><p id="4871" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">输入<br/> <code class="du jt ju jv jw b">&gt; python3 -m venv venv</code>创建一个虚拟环境</p><p id="252e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦创建完毕，您现在必须使用<br/> <code class="du jt ju jv jw b">&gt; source venv/bin/activate</code>激活环境</p><p id="75f4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">激活虚拟环境会修改PATH和shell变量，以指向您创建的特定独立Python设置。PATH是Linux和其他类似Unix的操作系统中的环境变量，它告诉shell在哪些目录中搜索可执行文件(即准备运行的程序)以响应用户发出的命令。命令提示符会改变，通过前置(<code class="du jt ju jv jw b">yourenvname</code>)来指示您当前所在的虚拟环境。</p><p id="1060" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在您的环境中，确保您已经安装了pip<code class="du jt ju jv jw b">wheel</code>、<code class="du jt ju jv jw b">setuptools</code>和<code class="du jt ju jv jw b">twine</code>。我们将需要它们来构建我们的Python库。<br/> <code class="du jt ju jv jw b">&gt; pip install wheel<br/>&gt; pip install setuptools<br/>&gt; pip install twine</code></p><p id="b217" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第三步:在Visual Studio代码中创建一个文件夹结构<br/> </strong>，打开你的文件夹<code class="du jt ju jv jw b">mypythonlibrary</code>(或者你给你的文件夹起的任何名字)。它应该是这样的:</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div class="er es jx"><img src="../Images/0d91a1e2d362ceb51f96e9fd92799ce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*jyLAXHsrlwIQ0wQr-gf5SA.png"/></div></figure><p id="44c5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您可以开始向项目中添加文件夹和文件。您可以通过命令提示符或Visual Studio代码本身来实现这一点。</p><ol class=""><li id="e215" class="kc kd hi ix b iy iz jc jd jg ke jk kf jo kg js kh ki kj kk bi translated">创建一个名为<code class="du jt ju jv jw b">setup.py</code>的空文件。这是创建Python库时最重要的文件之一！</li><li id="078d" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js kh ki kj kk bi translated">创建一个名为<code class="du jt ju jv jw b">README.md</code>的空文件。这是您可以编写markdown来为其他用户描述您的库内容的地方。</li><li id="5ab4" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js kh ki kj kk bi translated">创建一个名为<code class="du jt ju jv jw b">mypythonlib</code>的文件夹，或者您希望Python库在pip安装时被调用的名称。(如果要在以后发布，该名称在pip上应该是唯一的。)</li><li id="27c0" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js kh ki kj kk bi translated">在<code class="du jt ju jv jw b">mypythonlib</code>中创建一个名为<code class="du jt ju jv jw b">__init__.py</code>的空文件。基本上，任何包含一个<code class="du jt ju jv jw b">__init__.py</code>文件的文件夹，在我们构建的时候都会包含在库中。大多数情况下，您可以将<code class="du jt ju jv jw b">__init__.py</code>文件留空。在导入时，<code class="du jt ju jv jw b">__init__.py</code>中的代码被执行，所以它应该只包含运行项目所需的最少量的代码。现在，我们将让它们保持原样。</li><li id="2546" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js kh ki kj kk bi translated">同样，在同一个文件夹中，创建一个名为<code class="du jt ju jv jw b">myfunctions.py</code>的文件。</li><li id="40a0" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js kh ki kj kk bi translated">最后，在您的根文件夹中创建一个文件夹tests。在内部，创建一个空的<code class="du jt ju jv jw b">__init__.py</code>文件和一个空的<code class="du jt ju jv jw b">test_myfunctions.py</code>。</li></ol><p id="3d5f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您的设置现在应该看起来像这样:</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div class="er es kq"><img src="../Images/b76160610054b0b483b4e2284f92cc90.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*BMZScStiIsRE1BGHcnM61g.png"/></div></figure><p id="8f90" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">步骤4:为您的库创建内容<br/> </strong>要将函数放入您的库中，您可以将它们放在<code class="du jt ju jv jw b">myfunctions.py</code>文件中。例如，将<a class="ae iu" href="https://stackoverflow.com/questions/4913349/haversine-formula-in-python-bearing-and-distance-between-two-gps-points" rel="noopener ugc nofollow" target="_blank">哈弗辛函数</a>复制到您的文件中:</p><pre class="jy jz ka kb fd kr jw ks kt aw ku bi"><span id="710e" class="kv kw hi jw b fi kx ky l kz la">from math import radians, cos, sin, asin, sqrt</span><span id="67bc" class="kv kw hi jw b fi lb ky l kz la">def haversine(lon1: float, lat1: float, lon2: float, lat2: float) -&gt; float:<br/>    """<br/>    Calculate the great circle distance between two points on the <br/>    earth (specified in decimal degrees), returns the distance in<br/>    meters.</span><span id="6f75" class="kv kw hi jw b fi lb ky l kz la">    All arguments must be of equal length.</span><span id="b698" class="kv kw hi jw b fi lb ky l kz la">    :param lon1: longitude of first place<br/>    :param lat1: latitude of first place<br/>    :param lon2: longitude of second place<br/>    :param lat2: latitude of second place<br/>    :return: distance in meters between the two sets of coordinates<br/>    """<br/>    <!-- --># Convert decimal degrees to radians<br/>    lon1, lat1, lon2, lat2 = map(radians, [lon1, lat1, lon2, lat2])<br/><br/>    # Haversine formula<br/>    dlon = lon2 - lon1<br/>    dlat = lat2 - lat1<br/>    a = sin(dlat/2)**2 + cos(lat1) * cos(lat2) * sin(dlon/2)**2<br/>    c = 2 * asin(sqrt(a))<br/>    r = 6371 # Radius of earth in kilometers</span><span id="3559" class="kv kw hi jw b fi lb ky l kz la">    return c * r</span></pre><p id="fdeb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个函数将给出两个经纬度点之间的距离，单位为米。</p><p id="0adc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">无论何时你写任何代码，强烈建议你也为这些代码写测试。对于Python的测试，你可以使用库<code class="du jt ju jv jw b">pytest</code>和<code class="du jt ju jv jw b">pytest-runner</code>。在你的虚拟环境中安装库:<br/> <code class="du jt ju jv jw b">&gt; pip install pytest==4.4.1<br/>&gt; pip install pytest-runner==4.4</code></p><p id="35cf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们为哈弗辛函数创建一个小测试。复制以下内容，并将其放入<code class="du jt ju jv jw b">test_myfunctions.py</code>文件中:</p><pre class="jy jz ka kb fd kr jw ks kt aw ku bi"><span id="7f8c" class="kv kw hi jw b fi kx ky l kz la">from mypythonlib import myfunctions</span><span id="c878" class="kv kw hi jw b fi lb ky l kz la">def test_haversine():<br/>    assert myfunctions.haversine(52.370216, 4.895168, 52.520008,<br/>    13.404954) == 945793.4375088713</span></pre><p id="e604" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，让我们创建一个<code class="du jt ju jv jw b">setup.py</code>文件，它将帮助我们构建库。限量版的<code class="du jt ju jv jw b">setup.py</code>大概是这样的:</p><pre class="jy jz ka kb fd kr jw ks kt aw ku bi"><span id="b928" class="kv kw hi jw b fi kx ky l kz la">from setuptools import find_packages, setup</span><span id="e82c" class="kv kw hi jw b fi lb ky l kz la">setup(<br/>    name='mypythonlib',<br/>    packages=find_packages(),<br/>    version='0.1.0',<br/>    description='My first Python library',<br/>    author='Me',<br/>    license='MIT',<br/>)</span></pre><p id="0238" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">设置中的name变量包含您希望您的package wheel文件具有的任何名称。为了方便起见，我们将它命名为与文件夹相同的名称。</p><p id="214c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">设置您想要创建的包<br/> </strong>虽然原则上您可以不带任何参数地使用<code class="du jt ju jv jw b">find_packages()</code>，但这可能会导致包含不需要的包。例如，如果您在<code class="du jt ju jv jw b">tests/</code>目录中包含了一个<code class="du jt ju jv jw b">__init__.py</code>(我们确实这样做了)，就会发生这种情况。或者，您也可以使用exclude参数来显式地阻止在包中包含测试，但是这种方法不够健壮。让我们把它改成如下:</p><pre class="jy jz ka kb fd kr jw ks kt aw ku bi"><span id="0efb" class="kv kw hi jw b fi kx ky l kz la">from setuptools import find_packages, setup</span><span id="8921" class="kv kw hi jw b fi lb ky l kz la">setup(<br/>    name='mypythonlib',<br/>    packages=find_packages(include=['mypythonlib']),<br/>    version='0.1.0',<br/>    description='My first Python library',<br/>    author='Me',<br/>    license'MIT',<br/>)</span></pre><p id="93b9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">设置你的库需要的需求<br/> </strong>注意，当你的项目被别人作为依赖项安装时，pip不使用<code class="du jt ju jv jw b">requirements.yml</code> / <code class="du jt ju jv jw b">requirements.txt</code>。通常，为此，您必须在您的<code class="du jt ju jv jw b">setup.py</code>文件中的<code class="du jt ju jv jw b">install_requires</code>和<code class="du jt ju jv jw b">tests_require</code>参数中指定依赖关系。</p><p id="4d7e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du jt ju jv jw b">Install_requires</code>应限于绝对需要的包列表。这是因为你不想让用户安装不必要的软件包。还要注意，您不需要列出标准Python库的包。</p><p id="9c82" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，由于我们到目前为止只定义了哈弗辛函数，并且它只使用数学库(在Python中总是可用的)，我们可以将该参数留空。</p><p id="11bd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">也许你能记得我们之前安装的<code class="du jt ju jv jw b">pytest</code>库。当然，您不希望将<code class="du jt ju jv jw b">pytest</code>添加到您在<code class="du jt ju jv jw b">install_requires</code>中的依赖项中:您的软件包的用户并不需要它。为了在运行测试时只自动安装<em class="lc">，您可以将以下内容添加到您的<code class="du jt ju jv jw b">setup.py</code>中:</em></p><pre class="jy jz ka kb fd kr jw ks kt aw ku bi"><span id="5cd9" class="kv kw hi jw b fi kx ky l kz la">from setuptools import find_packages, setup</span><span id="4c4c" class="kv kw hi jw b fi lb ky l kz la">setup(<br/>    name='mypythonlib',<br/>    packages=find_packages(include=['mypythonlib']),<br/>    version='0.1.0',<br/>    description='My first Python library',<br/>    author='Me',<br/>    license='MIT',<br/>    install_requires=[],<br/>    setup_requires=['pytest-runner'],<br/>    tests_require=['pytest==4.4.1'],<br/>    test_suite='tests',<br/>)</span></pre><p id="4c9a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">运行:<br/> <code class="du jt ju jv jw b">&gt; python setup.py pytest<br/></code>将执行存储在‘测试’文件夹中的所有测试。</p><p id="a9f2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第五步:构建你的库<br/> </strong>现在所有的内容都在那里了，我们要构建我们的库。确保你现在的工作目录是<code class="du jt ju jv jw b">/path/to/mypythonlibrary </code>(所以是你项目的根文件夹)。在命令提示符下，运行:<br/> <code class="du jt ju jv jw b">&gt; python setup.py bdist_wheel</code></p><p id="a69e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您的车轮文件存储在现在创建的“dist”文件夹中。您可以使用<br/> <code class="du jt ju jv jw b">&gt; pip install /path/to/wheelfile.whl</code>来安装您的库</p><p id="db88" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意，您也可以将您的库发布到工作场所的intranet上的内部文件系统，或者发布到官方的PyPI存储库，并从那里安装它。</p><p id="939e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦你安装了你的Python库，你可以使用<br/> <code class="du jt ju jv jw b">import mypythonlib<br/>from mypythonlib import myfunctions</code>来导入它</p></div></div>    
</body>
</html>