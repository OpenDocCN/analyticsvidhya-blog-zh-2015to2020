<html>
<head>
<title>Export images from Jupyter Notebook using a single command line with Junix</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Junix的单一命令行从Jupyter笔记本中导出图像</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/export-images-from-jupyter-notebook-with-a-single-command-422db2b66e92?source=collection_archive---------1-----------------------#2019-09-15">https://medium.com/analytics-vidhya/export-images-from-jupyter-notebook-with-a-single-command-422db2b66e92?source=collection_archive---------1-----------------------#2019-09-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="07ee" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">问题是</h1><p id="4187" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我在Jupyter Notebook上做了很多EDAs，并且经常用matplotlib和seaborn之类的包通过这个过程生成很多图像。我偶尔需要导出这些情节，以便将它们包含在我的演示文稿或文档中。</p><p id="5e68" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">我使用的导出方法非常手动:</p><ul class=""><li id="1371" class="kg kh hi jf b jg kb jk kc jo ki js kj jw kk ka kl km kn ko bi translated"><strong class="jf hj">选项1 </strong>:以编程方式保存数字(如matplotlib的fig.savefig)</li><li id="3897" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka kl km kn ko bi translated"><strong class="jf hj">选项2 </strong>:右键点击图像，“图像另存为”</li><li id="c852" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka kl km kn ko bi translated"><strong class="jf hj">选项三</strong>:截图！</li></ul><p id="98e7" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">当我处理少量图像时，上面的这些方法工作得很好。但是，对于大量的图像，如果每天都这样做，这个过程会变得非常乏味…</p><p id="0251" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">当我做一些研究来寻找更自动化的解决方案时，我没有为我的用例找到任何令人满意的解决方案。</p><p id="4c13" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">由于我不想在“将图像另存为”上浪费宝贵的时间，我决定想出自己的解决办法，并最终编写了一个名为<strong class="jf hj"> Junix </strong>的小软件包，它可以自动完成这个过程。</p><p id="cd73" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">下面是我在构建这个包时遵循的快速浏览过程。希望你会觉得很有见地！</p><p id="45bd" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">如果你没有时间，你可以直接跳到回购，看看它是否适合你的用例。在<a class="ae ku" href="https://github.com/damienmarlier51/JupyterNotebookImageExporter" rel="noopener ugc nofollow" target="_blank">https://github . com/Damien marlier 51/JupyterNotebookImageExporter</a>查看</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es kv"><img src="../Images/98a42464248736bbdc71a81500e0277b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*db8R9BlD1HlK7lsTKT8_Eg.jpeg"/></div></figure><h1 id="0a57" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">解决方案</h1><h1 id="722a" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">步骤1:查看Jupyter笔记本文件结构</h1><p id="f0c5" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">首先，重要的是更好地理解什么是<em class="ld">。ipynb </em>文件从内部看起来像。让我们考虑一个包含以下内容的笔记本:</p><pre class="kw kx ky kz fd le lf lg lh aw li bi"><span id="f75b" class="lj ig hi lf b fi lk ll l lm ln"># [cell 1] <br/>import matplotlib.pyplot as plt\n<br/>import numpy as np</span><span id="f8e8" class="lj ig hi lf b fi lo ll l lm ln"># [cell 2]<br/>x = np.linspace(0, 10, 100)<br/>y0 = np.sin(x)<br/>y1 = np.cos(x)</span><span id="31a9" class="lj ig hi lf b fi lo ll l lm ln"># [cell 3]<br/>plt.plot(x, y0)<br/>plt.show()<br/>plt.plot(x, y1)<br/>plt.show()</span></pre><p id="d138" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">代码非常简单。<br/>它得到一个0到10之间的100个数字的列表。计算每个数字的正弦值和余弦值。然后使用<em class="ld"> matplotlib </em>可视化库绘制并显示这些点。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lp"><img src="../Images/8ec149f96a2f89f40e828c0b68327f43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AurxuUt9P1-bKD6VkulFYA.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">这是它从外面看起来的样子</figcaption></figure><p id="6040" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">如果您用文本编辑器打开此笔记本，您将看到它的内部外观:</p><pre class="kw kx ky kz fd le lf lg lh aw li bi"><span id="54c3" class="lj ig hi lf b fi lk ll l lm ln">{<br/> "cells": [<br/>  {<br/>   "cell_type": "code",<br/>   "execution_count": 1,<br/>   "metadata": {<br/>    "collapsed": true<br/>   },<br/>   "outputs": [],<br/>   "source": [<br/>    "import matplotlib.pyplot as plt\n",<br/>    "import numpy as np"<br/>   ]<br/>  },<br/>  {<br/>   "cell_type": "code",<br/>   "execution_count": 2,<br/>   "metadata": {<br/>    "collapsed": true<br/>   },<br/>   "outputs": [],<br/>   "source": [<br/>    "x = np.linspace(0, 10, 100)\n",<br/>    "y0 = np.sin(x)\n",<br/>    "y1 = np.cos(x)"<br/>   ]<br/>  },<br/>  {<br/>   "cell_type": "code",<br/>   "execution_count": 3,<br/>   "metadata": {},<br/>   "outputs": [<br/>    {<br/>     "data": {<br/>      "image/png": "iVBORw0...",<br/>      "text/plain": [<br/>       "&lt;Figure size 432x288 with 1 Axes&gt;"<br/>      ]<br/>     },    {<br/>     "data": {<br/>      "image/png": "iVBORw0...",<br/>      "text/plain": [<br/>       "&lt;Figure size 432x288 with 1 Axes&gt;"<br/>      ]<br/>     },<br/>     "metadata": {},<br/>     "output_type": "display_data"<br/>    }<br/>   ],<br/>   "source": [<br/>    "plt.plot(x, y0)\n",<br/>    "plt.show()\n",<br/>    "plt.plot(x, y1)\n",<br/>    "plt.show()"<br/>   ]<br/>  },<br/>  ........<br/>}</span></pre><p id="dc93" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">嗯，没有那么可怕！</p><p id="3278" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">我们可以看到该文件的结构是JSON。此外，我们可以注意到，绘制的图像是base64编码的，并且直接嵌入到JSON中，相关的关键字是“image/png”。</p><p id="1561" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">因此，我们的问题的快速解决方案似乎是解析笔记本文件并检索编码图像。好吧！我们走吧！</p><h1 id="775c" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">步骤2:用python解析</h1><p id="befa" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">为了解决我们的问题，我们需要我们的代码做以下事情:</p><ul class=""><li id="ccd9" class="kg kh hi jf b jg kb jk kc jo ki js kj jw kk ka kl km kn ko bi translated">将笔记本文件转换为嵌套的python字典</li><li id="3160" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka kl km kn ko bi translated">定位编码图像在字典中的位置</li><li id="0933" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka kl km kn ko bi translated">从字典中提取编码图像</li><li id="c000" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka kl km kn ko bi translated">将编码图像作为图像文件保存在所需文件夹中</li></ul><p id="04da" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">跳过所有细节，下面是最终文件(<em class="ld"> exporter.py) </em>的样子:</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="ly lz l"/></div><figcaption class="lu lv et er es lw lx bd b be z dx translated"><a class="ae ku" href="https://gist.github.com/b722af3d65d2af9137f796145f0a3c5e.git" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/b 722 af 3d 65 D2 af 9137 f 796145 f 0 a3 C5 e . git</a></figcaption></figure><h1 id="2288" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">第三步:打包时间！</h1><p id="3ac5" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">太好了！我们现在已经准备好了一些python代码。<br/>然而，如果可能的话，我不想在我的笔记本上添加额外的代码。如果我能使用命令行直接从终端导出我的图像，那就太好了。类似于下面的内容:</p><pre class="kw kx ky kz fd le lf lg lh aw li bi"><span id="e270" class="lj ig hi lf b fi lk ll l lm ln">my_command -f my_notebook_filepath -o my_output_directory</span></pre><p id="0c6e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">让我们一起努力吧！</p></div><div class="ab cl ma mb gp mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="hb hc hd he hf"><p id="aaa4" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">第一件事是创建一个<em class="ld"> setup.py </em>文件。我们需要给我们的命令取一个名字。暂且称之为<strong class="jf hj"> junix </strong>(用于JUpyter笔记本图片导出器)。丑陋的名字，但…短。</p><p id="699f" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">为了让我们的python代码可以从命令行调用，我们需要指定一个入口点。这个入口点是一个简单的python函数<em class="ld"> main </em>，它将调用我们在上面的<em class="ld"> exporter.py </em>中的export_images()函数。</p><p id="ce77" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这是我们的<em class="ld"> setup.py </em>的样子:</p><pre class="kw kx ky kz fd le lf lg lh aw li bi"><span id="e552" class="lj ig hi lf b fi lk ll l lm ln">from setuptools import setup <br/>setup(<br/>    name=”junix”, <br/>    version=”0.1.4", <br/>    author=”Damien Marlier”,<br/>    author_email=”damien.marlier@hotmail.fr”, <br/>    description=”Utils to export images from Jupyter notebook”,<br/>    packages=[“junix”], <br/>    entry_points={<br/>        “console_scripts”: [<br/>            “junix = junix.cli:export_images”<br/>        ]<br/>    }, <br/>    install_requires=[ “click”, ],<br/>)</span></pre><p id="5b70" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这就是我们的入口点(<em class="ld"> cli.py </em>)的样子:</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="ly lz l"/></div><figcaption class="lu lv et er es lw lx bd b be z dx translated"><a class="ae ku" href="https://gist.github.com/damienmarlier51/6b820d95043c52c20e807e314dc14e64" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/Damien marlier 51/6b 820d 95043 c 52 c 20 e 807 e 314 DC 14 e 64</a></figcaption></figure><p id="479c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">最后，下面是我们最终代码的结构:</p><pre class="kw kx ky kz fd le lf lg lh aw li bi"><span id="d651" class="lj ig hi lf b fi lk ll l lm ln">.gitignore<br/>README.md<br/>setup.py<br/>junix/<br/>    - cli.py<br/>    - junix.py</span></pre><p id="4b4e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">而且……导出可以这样执行:</p><pre class="kw kx ky kz fd le lf lg lh aw li bi"><span id="644b" class="lj ig hi lf b fi lk ll l lm ln">junix -f /path/to/my/notebook.ipynb -o /path/to/folder</span></pre><p id="8baf" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">就是这样！你可以在Github上找到完整的代码:<a class="ae ku" href="https://github.com/damienmarlier51/JupyterNotebookImageExporter" rel="noopener ugc nofollow" target="_blank">https://Github . com/Damien marlier 51/JupyterNotebookImageExporter</a></p><p id="bc09" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">我花了一段时间来写这个包，但它绝对是值得的，节省了我相当多的时间！</p></div></div>    
</body>
</html>