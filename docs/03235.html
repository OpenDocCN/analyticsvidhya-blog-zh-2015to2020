<html>
<head>
<title>Forecasting Stock in Jakarta Composite Index using python machine learning and achieve 72.4% accuracy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用python机器学习预测雅加达综合指数股票，准确率达到72.4%</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/forecasting-unilever-stock-in-jakarta-composite-index-using-python-machine-learning-and-achieve-5f3b90e21b17?source=collection_archive---------17-----------------------#2020-01-21">https://medium.com/analytics-vidhya/forecasting-unilever-stock-in-jakarta-composite-index-using-python-machine-learning-and-achieve-5f3b90e21b17?source=collection_archive---------17-----------------------#2020-01-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9287" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于那些不熟悉印尼股市的人来说，雅加达综合指数(股票代码:雅虎财经^JKSE)有678只股票可供选择。我选择联合利华是因为它的市值、流动性和良好的公司治理是基金经理最广泛选择的股票之一，它是雅加达综合指数中上市时间最长的股票之一，也是LQ45(相当于标准普尔500)的股票之一</p><p id="bd61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们需要导入必要的包来执行所需的功能:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="051c" class="jm jn hi ji b fi jo jp l jq jr">import numpy as np<br/>import pandas as pd<br/>import datetime as dt<br/>import pandas_datareader.data as web<br/>import talib as tlb<br/>import talib<br/>from sklearn.metrics import confusion_matrix</span></pre><p id="cf63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们需要定义数据的时间范围:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="4c6e" class="jm jn hi ji b fi jo jp l jq jr">start = dt.datetime(2014,1,1)<br/>finish = dt.datetime.today()<br/>source = ‘yahoo’</span></pre><p id="2eaf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于经济周期的原因，我选择了5年左右的数据，但这取决于你，你可以自由选择时间框架</p><p id="5354" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们提取数据:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="05ba" class="jm jn hi ji b fi jo jp l jq jr">df = web.DataReader(‘UNVR.JK’, source, start, finish)<br/>df.head()</span></pre><figure class="jd je jf jg fd jt er es paragraph-image"><div class="er es js"><img src="../Images/4261965244349bd3e0bf898fe1491cd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*NSQqtd9bigE4jzwV8nQ8TQ.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">简单看一下我们的数据，如下所示</figcaption></figure><p id="8902" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">出于我们的目的，我将使用“Adj Close”数据。至于每天预测股票的准确价格，很难用机器学习来做，所以我会预测股票的运动，无论股票是下跌还是上涨。为此，我将计算今天的股票价格相对于昨天的百分比变化，以此类推，如果是正数，将标记为+1.0，反之亦然。为此，我们只需编写这些代码:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="9191" class="jm jn hi ji b fi jo jp l jq jr">data = pd.DataFrame(index=df.index)<br/>data[‘Today’] = df[‘Adj Close’]<br/>data[‘pct change’] = data[‘Today’].pct_change()<br/>data[‘direction’] = np.sign(data[‘pct change’])</span></pre><p id="4b93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将使用talib软件包的技术分析进行一些特征工程，并通过将结果除以调整后的收盘价来归一化结果，使其在相同的范围内:</p><figure class="jd je jf jg fd jt er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es ka"><img src="../Images/6c8f2b06e25d94a6a94787d694ec9d87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H-y4FNhUhdHccOJ_aWkd5w.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">特征工程结果移动平均和相对强度指数</figcaption></figure><p id="3762" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的代码主要做的是创建5、14、30和50天的简单移动平均线和相对强弱指数。当然，我们可以使用其他技术分析指标和其他时间段进行更好的预测。你可以随意摆弄它。</p><p id="4ad7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们再简单看一下使用data.head(10)进行特征工程后的数据。</p><figure class="jd je jf jg fd jt er es paragraph-image"><div class="er es kf"><img src="../Images/9773afa6e12da89afe2a16d1ee9da023.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*QmWWWPsHucZ3FewCMaIJlg.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">我们需要删除丢失的数据</figcaption></figure><p id="758a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看起来我们的数据由于技术分析包中周期的计算有很多缺失的数据。为此，我们只需这样做:</p><p id="6715" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">data.dropna(inplace = True)</p><p id="a879" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们重新检查我们的数据，现在它是干净的，可以进行机器学习了。这很重要，因为大多数机器学习无法接受缺失数据和无限数量。</p><figure class="jd je jf jg fd jt er es paragraph-image"><div class="er es kg"><img src="../Images/68d4fcd73eb3e5221f23f7d701019a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*EzBcBmsbl5BHwErBuEublw.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">现在它干净了</figcaption></figure><p id="019a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们要删除“今天”和“百分比变化”列，因为我们在预测中不需要它，因为我们只预测股票的方向。为此，我们编写了以下简单的代码:</p><p id="8e83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kh ki kj ji b">data.drop([‘Today’, ‘pct change’], axis = 1, inplace = True)</code></p><p id="74c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们开始我们的目标预测和机器学习所需的数据:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="93c1" class="jm jn hi ji b fi jo jp l jq jr">y = data[‘direction’]<br/>x = data.drop(‘direction’, axis = 1)</span></pre><p id="4009" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将把数据分成训练集和测试集。我使用80%的比率作为80%的训练集，20%的测试集，但你可以使用不同的比率。</p><figure class="jd je jf jg fd jt er es paragraph-image"><div class="er es kk"><img src="../Images/ab479aac4e895685bf59ee1f984eb806.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*W5Ykf202MIjn5bJaxkXvaQ.png"/></div></figure><p id="7d18" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将使用3个机器学习包，看看哪一个性能更好。即<strong class="ih hj"> KNN、逻辑回归和支持向量机</strong>。让我们导入这些包:</p><figure class="jd je jf jg fd jt er es paragraph-image"><div class="er es kl"><img src="../Images/0c73aa6b22a0fbfc10d6d4ea503a491f.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*6YJFk9w_bgRQCYtFkJ0Syw.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">KNN、逻辑回归和支持向量机</figcaption></figure><p id="b528" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将做<strong class="ih hj"> KNN </strong>并检查我们模型的准确性:</p><figure class="jd je jf jg fd jt er es paragraph-image"><div class="er es km"><img src="../Images/5d8f0096cf5a4c98a409874427e625ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*FbedslxPQsH5WrtWGipP4w.png"/></div></figure><p id="f41f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果是:</p><figure class="jd je jf jg fd jt er es paragraph-image"><div class="er es kn"><img src="../Images/63c3cb0b3d88f8260018ea93fbf36e79.png" data-original-src="https://miro.medium.com/v2/resize:fit:496/format:webp/1*7ARnwpqvjUS8ceI_2Vp9bw.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">准确率为64.2%</figcaption></figure><p id="2e71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将尝试<strong class="ih hj">逻辑回归</strong>:</p><figure class="jd je jf jg fd jt er es paragraph-image"><div class="er es ko"><img src="../Images/3b6fff410f1e60390feb0d230b4a13b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*qS0O4pIfVDlr5OSlLpvRbw.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">准确率为64.2%</figcaption></figure><p id="4860" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们试试<strong class="ih hj">支持向量机</strong>:</p><figure class="jd je jf jg fd jt er es paragraph-image"><div class="er es kp"><img src="../Images/b41332d92b30306a0621db3e0c1cc228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*kgk5QxbKvpeAGPlBLNATYw.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">准确率63.8%</figcaption></figure><p id="17ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看起来所有3个不同的机器学习包产生了相同的结果，但是我们可以超参数调整我们的机器学习包和稍微不同的包之一以达到更好的结果吗？我将使用常规SVC而不是LinearSVC，并使用超参数对其进行调整:</p><figure class="jd je jf jg fd jt er es paragraph-image"><div class="er es kq"><img src="../Images/8e8747d7a2fdb98d08dcd840fc6e7802.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*MVIXyPZ6IdTqe0F-1X6Xvw.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">准确率为72.4%</figcaption></figure><p id="6255" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">准确率提高到72.4%。</p><p id="d01f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">结论:</strong></p><p id="5cbc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有许多处理预测的机器学习包，这篇文章是为了学习和学术目的，它不是为了实际投资，因为有许多问题我没有处理，例如，前瞻偏差和测试过度拟合等。我希望这篇文章对那些想进一步研究机器学习与股市预测或其他应用的人有用。感谢阅读。</p><p id="7d53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在这里查看我的代码<a class="ae kr" href="https://github.com/mrhenryher/UNVR_ML" rel="noopener ugc nofollow" target="_blank"/></p><p id="bc39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你有任何问题或批评，随时联系我:henryhermawan09@gmail.com</p></div></div>    
</body>
</html>