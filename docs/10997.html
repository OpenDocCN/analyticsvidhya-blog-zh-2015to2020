<html>
<head>
<title>Excel Grouping &amp; Aggregation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Excel分组和聚合</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/excel-grouping-aggregation-a5b1f2384943?source=collection_archive---------16-----------------------#2020-11-12">https://medium.com/analytics-vidhya/excel-grouping-aggregation-a5b1f2384943?source=collection_archive---------16-----------------------#2020-11-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="06ef" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">一、普通全除法</h1><p id="9f79" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">下面的2019年产品销售表记录了每个销售人员的某个产品的销售明细。任务是按销售额列出前三名销售人员。</p><p id="a8f1" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">下面是Excel数据:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es kg"><img src="../Images/e215177b1bae52d7622a2957118674d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/0*iyMm3QWd6y37IfS4.png"/></div></figure><p id="f486" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">预期结果:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es ko"><img src="../Images/088d8820fe31ced73a1d2b50b760522b.png" data-original-src="https://miro.medium.com/v2/resize:fit:484/format:webp/0*0hFoDo3qJLJhyfXf.png"/></div></figure><p id="741d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">Excel数据表在处理这项任务时很有用，但很难使用。它很有用，因为该特性可以设法获取合计，对它们进行排序，找到前三名销售人员，并复制相关记录作为期望的结果。但是当原始数据量很大或者要计算的秩很多时，手工处理所有操作是不方便的。</p><p id="e34c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">然而，SPL遵循直觉思维，以循序渐进的方式处理这项任务:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es kp"><img src="../Images/da33a97d1418ea9a7eaf09d9539541f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GsreKsLKRIbPBx5gkKjFlQ.png"/></div></div></figure><p id="4c6e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">脚本执行后，只需要将结果粘贴到Excel中，就可以得到预期的表格。</p><p id="58f0" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">SPL脚本通过剪贴板与Excel交互。它将待分析的数据复制并粘贴到剪贴板，在esProc designer中编辑并执行脚本，然后将结果粘贴到Excel。</p><h1 id="0dcd" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">II与“其他记录”合并分组</h1><p id="2e44" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">有时候是我们关注的原始详细数据中的一部分，我们只是汇总了其他所有的数据。基于上例中的Excel数据，我们想计算每种水果的总销售额，并汇总所有蔬菜的销售数量。</p><p id="4e1d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">预期结果:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es ku"><img src="../Images/844c8cecbb5803e744db9afae1162a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/0*nndQxt_2Ou6-R8qG.png"/></div></figure><p id="1472" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">分组基础太具体，无法使用数据透视表处理。你必须用VBA写一个宏来使用这个程序根据特定的值对数据进行分组。很复杂也很难。</p><p id="6749" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">SPL使用枚举值处理这种类型的分组:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es kv"><img src="../Images/07535d75ea443fc7c4e76b33c478d14f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g55s2umdrb044MxZiJmiAA.png"/></div></div></figure><p id="02b4" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">然后将剪贴板内容传递到Excel中，以获得所需的结果。</p><h1 id="c959" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">III通过提供缺失值进行对齐分组</h1><p id="01cd" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">数据透视表不会为分组基础中缺少的值创建分组。当我们使用数据透视表按日期对几个月没有销售记录的销售表进行分组时，我们会得到以下结果:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es kw"><img src="../Images/578b04548173c65e0d8d4a0e8b07385c.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/0*4zVePPDb2c3FN4MR"/></div></figure><p id="8d9a" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">由于某些月份没有相应的数据，因此没有相应的组。结果是没有规律的。但是我们想要的是这个:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es kx"><img src="../Images/0706244ee4aebaa6f84cf2eb511edaf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:462/format:webp/0*8zYjNPYeLWKEBle1.png"/></div></figure><p id="9c18" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">数据透视表不能做到这一点。在VBA也很难做到这一点。</p><p id="85fd" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">SPL通过定义分组基础来处理这种类型的:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es kp"><img src="../Images/6376f00f8ecd712458876561cb4810b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GNBCc_DPAmWOT-QHIfOGtA.png"/></div></div></figure><h1 id="599f" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">IV按间隔分组</h1><p id="f53e" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">下面是学生成绩表。评分尺度是这样的:≤60为a C，&gt; 60 &amp; &lt; 90为B，≥90为a，任务是统计各层次的学生。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ky"><img src="../Images/333b3bedce72a463b1e52ca29b7d7a82.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/0*LOahR3AqG7Vdtifd.png"/></div></div></figure><p id="0953" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">预期结果:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es kz"><img src="../Images/4faf7ab98fb63b4c7db04641e9352ac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:406/format:webp/0*XW-DS60bnOTAxfJ4.png"/></div></figure><p id="8e61" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">定义分数区间后，您可以使用pseg函数来划分学生分数，然后对每个组进行计数。</p><p id="175d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">SPL剧本:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es la"><img src="../Images/f1d7ae7734af679b2a4f622b297dc0db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2QxTPGVfw2dP32OshWF9EA.png"/></div></div></figure><h1 id="180a" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">五.按重叠条件分组</h1><p id="495c" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">下表列出了2019年部分国家的GDP。任务是计算发达国家、发展中国家和金砖国家的平均GDP。</p><p id="57f7" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">2019年部分国家GDP数字(单位:十亿美元):</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es lb"><img src="../Images/fc7074639d26b5fb5e0e9d27debbd203.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/0*2DmcCSkJtWyLcNNr.png"/></div></figure><p id="cb01" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">预期结果:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es lc"><img src="../Images/177231c6032a5c6f4c7f48fbdf866a2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:444/format:webp/0*wMXv78zYOc7hUdJD.png"/></div></figure><p id="7af6" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">发展中国家和金砖国家有着共同的价值观。为了处理具有重叠条件的分组任务，SPL提供了枚举功能，以灵活的方式定义枚举条件。</p><p id="739b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">SPL剧本:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es kp"><img src="../Images/3cd386e3058a54547aed5e5051d48605.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DZsRkC210kwUjVBdsLLZhg.png"/></div></div></figure></div></div>    
</body>
</html>