# æ“…é•¿ç”Ÿäº§

> åŸæ–‡ï¼š<https://medium.com/analytics-vidhya/excel-in-prod-181ab49d06a9?source=collection_archive---------15----------------------->

## æˆ–è€…*å¦‚ä½•ä½¿ç”¨æ°´ç®¡å·¥*æˆ–*å¾® excel å¾®æœåŠ¡*å°† excel æ•´åˆåˆ°ç”Ÿäº§ API ä¸­

![](img/08df472421b3555b40b2eab4fe9aba9e.png)

ç…§ç‰‡ç”±[ç±³å¡Â·é²æ¢…æ–¯ç‰¹](https://unsplash.com/@mbaumi?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„

*æœ€åˆå‘è¡¨äº*[*http://josiahparry.com*](http://josiahparry.com/post/2020-03-01-excel-in-prod/)*ã€‚*

æˆ‘æœ€è¿‘æœ‰ä¸€æ¬¡è°ˆè¯ï¼Œè°ˆåˆ°äº†ä½¿ç”¨è‡ªåŠ¨è§£æ Excel æ–‡æ¡£æ¥ç®¡ç†æ•°æ®ç§‘å­¦èµ„äº§ã€‚è¿™å¼•å‡ºäº†ä¸€äº›éå¸¸æœ‰è¶£çš„è§‚ç‚¹:

1.  Excel æœ‰æ—¶æ˜¯ä¸å¯é¿å…çš„ï¼Œæˆ‘ä»¬éœ€è¦æ¥å—è¿™ä¸€ç‚¹ã€‚
2.  å¦‚ä½•æ‰èƒ½å°† Excel èå…¥åˆ°ç”Ÿäº§ä¸­ï¼Ÿ

> *æ³¨æ„ï¼Œç°åœ¨ä¸æ˜¯æ—¶å€™ğŸ’©åœ¨ Excel ä¸Šã€‚å®ƒæœåŠ¡äºéå¸¸çœŸå®çš„å•†ä¸šç›®çš„ï¼Œä¸å¹¸çš„æ˜¯ä¸æ˜¯æ¯ä¸ªäººéƒ½èƒ½å­¦ä¼šç¼–ç¨‹ğŸ˜•ã€‚å¯¹äº h8rs æ¥è¯´ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜:å‡ ä¹æ¯ä¸ªæ€»ç»Ÿé€‰ä¸¾æ´»åŠ¨çš„æ•°æ®ç¨‹åºéƒ½æ˜¯åŸºäº Google Sheets çš„èƒŒé¢ã€‚*

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å¼€å§‹æ¢ç´¢æ˜¯å¦ä»¥åŠå¦‚ä½•å°† Excel æ•´åˆåˆ°ç”Ÿäº§ä»£ç ä¸­ã€‚è¿™é‡Œä½¿ç”¨çš„ä»£ç è¯·å‚è§ [GitHub åº“](https://github.com/JosiahParry/plumber-excel)ã€‚

ç”Ÿäº§åŒ–ä»£ç æ˜¯ä»€ä¹ˆæ„æ€â€”â€”ä¹Ÿå°±æ˜¯æŠŠå®ƒæ”¾åˆ°äº§å“ä¸­ï¼Ÿè¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€å®šä¹‰ï¼Œæ¯ä¸ªç»„ç»‡éƒ½æœ‰ä¸åŒçš„æ“ä½œæ–¹æ³•ã€‚

> *å¯æ“ä½œåŒ–çš„å®šä¹‰*ï¼Œè‡³å°‘ä»ç¤¾ä¼šç§‘å­¦çš„è§’åº¦æ¥çœ‹ï¼Œæ˜¯å¦‚ä½•å®šä¹‰ä¸€ä¸ªäº‹ç‰©ï¼Œä»¥ä¾¿å¯¹è¯¥äº‹ç‰©æœ‰ä¸€ä¸ªå…±åŒçš„ç†è§£ã€‚**

*æ ¼é›·æ ¼Â·å¨å°”é€Šå°†å…¶å®šä¹‰ä¸ºâ€œä¸ä¼šè®©è¿è¥å›¢é˜Ÿå“­æ³£çš„ä»£ç â€(å¼ºè°ƒä»–çš„)ã€‚è¿™æ˜¯æˆ‘æœ€å–œæ¬¢çš„å®šä¹‰ï¼Œå› ä¸ºå®ƒæ˜¯å¼‚æƒ³å¤©å¼€çš„ã€è®½åˆºçš„ã€è¯šå®çš„ï¼Œå¹¶ä¸”æ‰¿è®¤ä»£ç å°†ä¸å¾—ä¸ç¦»å¼€æ•°æ®ç§‘å­¦çš„æ ¸å¿ƒåœˆå­ã€‚*

*æ®æˆ‘æ‰€çŸ¥ï¼Œå½“å‰çš„æ•°æ®ç§‘å­¦è®¨è®ºå¼ºè°ƒä½¿ç”¨ RESTful APIs ä½œä¸ºæœ€å¥½çš„ï¼Œæˆ–è€…è‡³å°‘æ˜¯ä¸»å¯¼çš„ï¼Œç”Ÿäº§ä»£ç çš„æ–¹å¼ã€‚*

*API æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ã€‚å½“æˆ‘ç¬¬ä¸€æ¬¡å­¦ä¹ ä»€ä¹ˆæ˜¯ API æ—¶ï¼Œæˆ‘å”å”å‘Šè¯‰æˆ‘æŠŠå®ƒä»¬æƒ³è±¡æˆâ€œä¸å…¶ä»–æœºå™¨å¯¹è¯çš„æœºå™¨â€é‚£å¹¶ä¸é¥è¿œï¼*

*RESTful API æ˜¯ä¸€ç§ç‰¹æ®Šçš„ APIã€‚å¦ç‡åœ°è¯´ï¼Œæˆ‘ä¸çŸ¥é“è¿™åˆ°åº•æ„å‘³ç€ä»€ä¹ˆã€‚æ®æˆ‘ç†è§£ï¼ŒREST å®é™…ä¸Šæ˜¯ä¸€ç§è‡ªä»¥ä¸ºæ˜¯çš„ API æ¶æ„æ–¹å¼ã€‚RESTful APIs ä½¿ç”¨ HTTP è¯·æ±‚ï¼Œè¿™ä½¿å¾—å®ƒä»¬éå¸¸å®¹æ˜“è®¿é—®ã€‚RESTful APIs æ˜¯å¼€å‘å¾®æœåŠ¡çš„å…³é”®ï¼Œå¾®æœåŠ¡æ˜¯å°†ä»£ç æ”¾å…¥äº§å“çš„æ ¸å¿ƒã€‚åœ¨ python ç”Ÿæ€ç³»ç»Ÿä¸­ï¼ŒFlask æ˜¯åˆ¶ä½œå¾®æœåŠ¡çš„é¢†å…ˆåº“ä¹‹ä¸€ã€‚åœ¨ R ç©ºé—´ä¸­ï¼Œä¸€ä¸ªåä¸º`plumber`çš„åŒ…æ‰¿æ‹…äº†è¿™ä¸ªè§’è‰²ã€‚*

*æˆ‘ä»¬å¯ä»¥è®¾æƒ³ä¸€ä¸ªå‡è®¾çš„åœºæ™¯ï¼Œå…¶ä¸­æˆ‘ä»¬é€šè¿‡ä¸€äº›æ•°æ®æ”¶é›†è¿‡ç¨‹æ¥æ”¶ Excel æ–‡ä»¶ã€‚ä¸€æ—¦æ”¶åˆ°è¯¥ Excel æ–‡ä»¶ï¼Œå®ƒå°†ç”¨äºå¯åŠ¨ä¸€äº›å…¶ä»–æµç¨‹ï¼Œä¾‹å¦‚æŠ¥å‘Šç¼–å†™æˆ–æ•°æ®å¤„ç†ã€‚äººä»¬é€šå¸¸ä¼šåˆ›å»ºé—ªäº®çš„åº”ç”¨ç¨‹åºæ¥æä¾›ä¸Šä¼ å’Œæ•°æ®è¾“å…¥çš„ UIã€‚å½“æˆ‘ä»¬æƒ³å¼€å‘ä¸€ä¸ªä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„ç•Œé¢æ—¶ï¼Œè¿™çœŸçš„å¾ˆæ£’ã€‚ä½†æ˜¯å½“æˆ‘ä»¬æƒ³è¦è‡ªåŠ¨åŒ–è¿™ä¸ªè¿‡ç¨‹æˆ–è€…è‡³å°‘è®©å…¶ä»–å·¥å…·å¯ä»¥ä½¿ç”¨è¿™ä¸ªè¿‡ç¨‹çš„æ—¶å€™å‘¢ï¼Ÿè¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ±‚åŠ©äº plumber æ¥åˆ›å»ºä¸€ä¸ªå¾®æœåŠ¡æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚*

*ä¸Šå›¾(ç”¨åˆ¶ä½œ)å±•ç¤ºäº†ä¸¤ç§ä¸åŒçš„æ–¹æ³•ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†æ”¶åˆ° Excel æ–‡ä»¶ã€‚ä»é‚£é‡Œï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›å°†æ–‡ä»¶ä¸Šä¼ åˆ°å…±äº«é©±åŠ¨å™¨ã€æ•°æ®åº“æˆ–ä¸¤è€…ã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¯èƒ½ä¸æƒ³å­˜å‚¨æ•°æ®ï¼Œè€Œæ˜¯æƒ³ç«‹å³ä½¿ç”¨å®ƒã€‚*

*ä» API å¼€å‘çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ªæµç¨‹æƒ³è±¡æˆä¸€ä¸ª API *ç«¯ç‚¹*ã€‚ç«¯ç‚¹æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª urlï¼Œå®ƒè¡¨æ˜æ¯ä¸ªåº”ç”¨ç¨‹åºäº¤äº’å°†åœ¨å“ªé‡Œå‘ç”Ÿã€‚åœ¨è¿™ä¸ªå°ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªç«¯ç‚¹:`/read_excel`å’Œ`/upload`ã€‚ç¬¬ä¸€ä¸ªä¼šï¼Œä½ çŒœå¯¹äº†ï¼Œè¯»å–ä¸€ä¸ªéšè¯·æ±‚å‘é€çš„ Excel æ–‡ä»¶ã€‚ç¬¬äºŒä¸ªå°†ä¸Šä¼ æ‰€è¿°æ–‡ä»¶ã€‚*

*åœ¨æˆ‘ä»¬ç€æ‰‹åˆ›å»º API ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆå¼„æ¸…æ¥šå¦‚ä½•é€šè¿‡ API å‘é€æ–‡ä»¶ã€‚åœ¨æˆ‘ä»¬å¼„æ¸…æ¥šè¿™ä¸€ç‚¹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æˆ‘ä»¬å¯ä»¥å‘ API å‘å‡ºä»€ä¹ˆç±»å‹çš„è¯·æ±‚ã€‚å› ä¸º REST API å°†æ˜¯ä¸€ä¸ª HTTP APIï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»çŸ¥é“ä½¿ç”¨ HTTP åè®®å¯ä»¥å‘å‡ºä»€ä¹ˆç±»å‹çš„è¯·æ±‚ã€‚æœ‰ 7 ç§ HTTP è¯·æ±‚ç±»å‹ã€‚*

*å¦ç™½åœ°è¯´ï¼Œæˆ‘ä¸è®°å¾—`HEAD`ã€`PATCH`å’Œ`OPTIONS`æ˜¯åšä»€ä¹ˆçš„â€”â€”å¦‚æœä½ ä¸ä½¿ç”¨å®ƒï¼Œä½ å°±ä¼šå¤±å»å®ƒï¼Œå¯¹å—ï¼Ÿå¯¹äºè¶…çº§ç®€å•çš„ APIï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“`GET`å’Œ`POST`è¯·æ±‚â€”â€”ä¸è¦è®©æˆ‘åšä»»ä½•äº‹æƒ…ï¼Œæˆ‘ä¸å¯ä¿¡ã€‚*

*`GET`ç”¨äº*ä»èµ„æºä¸­è·å–*æ•°æ®ã€‚æ‚¨å¯ä»¥å°†é”®å€¼å¯¹ä½œä¸ºå‚æ•°ä¼ é€’ç»™`GET`è¯·æ±‚ã€‚"`GET`è¯·æ±‚ä»…ç”¨äºè¯·æ±‚æ•°æ®(ä¸èƒ½ä¿®æ”¹)."ä½ æ°¸è¿œä¸åº”è¯¥é€šè¿‡`GET`è¯·æ±‚å‘é€æ•æ„Ÿä¿¡æ¯ã€‚*

*è¿™å°±æŠŠæˆ‘ä»¬å¸¦åˆ°äº†`POST`æ–¹æ³•ã€‚`POST`æ–¹æ³•ç”¨äºå‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œä»¥ä¾¿åˆ›å»ºã€ä¿®æ”¹æˆ–æ›´æ–°èµ„æºã€‚å½“ä½ æœ‰å¾ˆå¤šå‚æ•°è¦å‘é€ï¼Œæˆ–è€…å¦‚æœå®ƒä»¬æ˜¯æ•æ„Ÿçš„ï¼Œæˆ–è€…å¦‚æœä½ éœ€è¦é€šè¿‡ API å‘é€ä¸€ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨`POST`ã€‚*

*åœ¨ç ”ç©¶è¿™ä¸ª API è®¾è®¡æ—¶ï¼Œæˆ‘æœ‰ä¸‰ä¸ªé—®é¢˜ã€‚*

1.  *ä½ æ˜¯å¦‚ä½•é€šè¿‡ HTTP è¯·æ±‚å‘é€æ–‡ä»¶çš„ï¼Ÿ*
2.  *ä¸€æ—¦æˆ‘ä»¬å‘é€äº†å®ƒï¼Œæˆ‘ä»¬å¦‚ä½•è®¿é—®æ–‡ä»¶ï¼Œå®ƒå»äº†å“ªé‡Œï¼Ÿ*
3.  *æˆ‘ä»¬å¦‚ä½•å°† API ä¸­çš„æ•°æ®ä¼ é€’ç»™ Rï¼Ÿ*

*æˆ‘ä¸ä¼šè¯´ Linuxï¼Œæ‰€ä»¥ç¥ç¦`httr`è®©è¿™å˜å¾—ç®€å•(æœ‰ç‚¹)ã€‚`httr`åŒ…å«å‘å¸ƒ excel æ–‡ä»¶çš„ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ã€‚æœ‰`POST()`ç”¨äºå‘å‡º post è¯·æ±‚ï¼Œè¿˜æœ‰`upload_file()`ç”¨äºä¸Šä¼  POST è¯·æ±‚ä¸­çš„æ–‡ä»¶ã€‚*

> *æˆ‘ä»¬èƒ½ä¸èƒ½èŠ±ç‚¹æ—¶é—´æ¥æ¬£èµä¸€ä¸‹å‡½æ•°æœ‰æ—¶æ˜¯å¤šä¹ˆå®Œç¾çš„å‘½åï¼Ÿè¶Šä¸è¨€è‡ªæ˜è¶Šå¥½ã€‚*

*å¦‚æœä½ æ²¡æœ‰å¤ªå¤šä½¿ç”¨`httr`åˆ¶ä½œè¯·æ±‚çš„ç»éªŒï¼Œæˆ‘å»ºè®®ä½ ä»[å¿«é€Ÿå…¥é—¨ç®€ä»‹](https://cran.r-project.org/web/packages/httr/vignettes/quickstart.html)å¼€å§‹ã€‚*

*æˆ‘ä»¬çš„ POST è¯·æ±‚çš„ç»“æ„å¦‚ä¸‹æ‰€ç¤º*

```
*POST(end_point, body = list(param = upload_file("file-path.ext")) )*
```

# *æ„å»ºç¬¬ä¸€ä¸ªç«¯ç‚¹*

*ç°åœ¨æˆ‘ä»¬çŸ¥é“*æ–‡ä»¶å°†å¦‚ä½•å‘é€ã€‚ä½†æ˜¯å›°éš¾çš„éƒ¨åˆ†å®é™…ä¸Šæ˜¯æ„å»ºå°†æ¥æ”¶å®ƒçš„ç®¡é“å·¥ API ç«¯ç‚¹ã€‚å…³äºå¦‚ä½•é€šè¿‡æ°´ç®¡å·¥ä¸Šä¼ æ–‡ä»¶æœ‰ç›¸å½“å¤šçš„è®¨è®ºã€‚è¿˜å¥½ï¼Œ [@krlmlr](https://github.com/krlmlr) æŒ‡å‡ºäº†`mime::parse_multipart()`å¯ä»¥ç”¨æ¥å¤„ç†è¯·æ±‚ä¸­å‘é€çš„æ–‡ä»¶ã€‚**

> *æ³¨æ„:MIME æ˜¯é€šè¿‡äº’è”ç½‘å‘é€æ–‡ä»¶çš„æ ‡å‡†æ–¹å¼ã€‚æˆ‘å¯¹å“‘å‰§ç±»å‹ä¸€æ— æ‰€çŸ¥ï¼Œéå¸¸æ¬£èµè°¢ä¸€è¾‰ã€æ°å¼—é‡ŒÂ·éœçº³å’Œè¾¹Â·è´å‹’ç”¨è¿™ä¸ªåŒ…æ‰€åšçš„å·¥ä½œï¼Œä»–ä»¬æŠŠæ‰€æœ‰è¿™äº›éƒ½æŠ½è±¡äº†å‡ºæ¥ã€‚*

*`parse_multipart()`å°†æ¥å—ä¼ å…¥çš„è¯·æ±‚å¹¶è¿”å›ä¸€ä¸ªå‘½ååˆ—è¡¨ã€‚å¯¹æˆ‘ä»¬æ¥è¯´æœ€é‡è¦çš„æ˜¯ï¼Œè¿”å›çš„å¯¹è±¡åŒ…å«äº†æˆ‘ä»¬å‘å¸ƒåˆ°ä¸´æ—¶ä½ç½®çš„æ–‡ä»¶ã€‚åœ¨ç»“æœåˆ—è¡¨ä¸­æ˜¯ä¸´æ—¶æ–‡ä»¶çš„è·¯å¾„ã€‚åœ¨æˆ‘ä»¬çš„ç®¡é“å·¥å‡½æ•°å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬è§£æè¯·æ±‚ï¼Œå¹¶å–å‡º`datapath`ã€‚ä¿å­˜çš„è·¯å¾„ç„¶åè¢«æä¾›ç»™`readxl::read_excel()`,åè€…è¿”å›ä¸€ä¸ª tibbleï¼*

```
*#* Read excel file #* @post /read_excel function(req) { multipart <- mime::parse_multipart(req) 
  fp <- purrr::pluck(multipart, 1, "datapath", 1)
  readxl::read_excel(fp) }pr <- plumber::plumb("plumber.R") 
pr$run(host = "127.0.0.1", port = 5846)# start a background job using the RStudio job launcher rstudioapi::jobRunScript(
  path = file.path(here::here(), "activate.R"),
  workingDir = here::here()
)*
```

*![](img/f81427e6793e5a86796be0111f805ed9.png)*

```
*#* Read excel file 
#* @post /read_excel 
function(req) { 
  mime::parse_multipart(req) 
}*
```

# *åˆ›å»º API åŒ…è£…*

*åˆ›å»º API åŒ…è£…å™¨æ˜¯æˆ‘æœ€å–œæ¬¢çš„æ´»åŠ¨ä¹‹ä¸€ï¼Œå› ä¸ºå®ƒç›¸å½“ç®€å•ï¼Œè€Œä¸”æ„Ÿè§‰è¶…çº§å¼ºå¤§ğŸ’ªğŸ¼ã€‚å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬åˆ›å»º POST è¯·æ±‚æ‰€éœ€è¦åšçš„å°±æ˜¯æŒ‡å®šåœ¨å“ªé‡Œå‘å‡ºè¯·æ±‚(ç«¯ç‚¹)ï¼Œå¹¶ä¸ºå…¶æä¾›ä¸€äº›å‚æ•°ã€‚*

*åœ¨åå°å¯åŠ¨ APIã€‚*

```
*# start a background job using the RStudio job launcher rstudioapi::jobRunScript(
  path = file.path(here::here(), "activate.R"),
   workingDir = here::here())*
```

*æˆ‘ä»¬é¦–å…ˆç”¨ç«¯ç‚¹å®šä¹‰ä¸€ä¸ªåä¸º`b_url`(åŸºæœ¬ url)çš„å¯¹è±¡ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨`upload_file()`å‘½ä»¤ä¸­æŒ‡å®šæƒ³è¦ä¸Šä¼ çš„æ–‡ä»¶çš„è·¯å¾„ã€‚åœ¨å­˜å‚¨åº“ä¸­ï¼Œæˆ‘å·²ç»åŒ…å«äº†`test.xls`ï¼Œå®ƒåŒ…å«äº†ç¾å›½ç¤¾åŒºè°ƒæŸ¥(ç¤¾ä¼šç§‘å­¦ï¼Œamiriteï¼Ÿ).è¯·æ³¨æ„ï¼Œä¸Šä¼ çš„æ–‡ä»¶æ˜¯`body`å‚æ•°ä¸­å‘½ååˆ—è¡¨çš„ä¸€éƒ¨åˆ†ã€‚ä»»ä½•éœ€è¦ä¼ é€’ç»™ API çš„å‚æ•°éƒ½éœ€è¦åœ¨æä¾›ç»™`body`çš„åˆ—è¡¨ä¸­å®šä¹‰ã€‚æˆ‘*è®¤ä¸º*ä¸Šä¼ æ–‡ä»¶çš„åç§°éœ€è¦ä¸ plumber API ( `req`)ä¸­å®šä¹‰çš„åç§°ç›¸åŒ¹é…ã€‚æˆ‘å¯èƒ½é”™äº†ï¼Œä½†ä¸ºäº†å®‰å…¨èµ·è§ï¼*

```
*library(httr) 
library(tidyverse)

# define the url b_url <- "http://127.0.0.1:5846/read_excel" # make the request! 
req <- POST(b_url, body = list(req = upload_file("data/test.xls")))*
```

*æˆ‘ä»¬ç°åœ¨å·²ç»ä¸Šä¼ äº†æ–‡ä»¶å¹¶æå‡ºäº†æˆ‘ä»¬çš„è¯·æ±‚ï¼è™½ç„¶å¦‚æœæˆ‘ä»¬ä¸èƒ½è®¿é—®æ•°æ®ï¼Œè¿™ä¸ªè¯·æ±‚å¯¹æˆ‘ä»¬æ²¡æœ‰ç”¨ğŸ˜®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`httr::content()`è·å¾—è¯·æ±‚çš„å†…å®¹ã€‚æˆ‘è®¾ç½®äº†`type = "text/json"`,å› ä¸ºæˆ‘å‘ç°å°† json è½¬æ¢æˆ tibble æ¯”è½¬æ¢æˆå‘½ååˆ—è¡¨æ›´å®¹æ˜“ã€‚*

```
*# get json 
res_json <- content(req, type = "text/json")

# show the first 50 characters of resultant json 
strtrim(res_json, 50)## [1] "[{\"statefip\":1,\"costelec\":7440,\"costgas\":5760,\"cos"*
```

*è¦å°†è¿™ä¸ª json æ”¾å…¥ tibbleï¼Œå°†ä½¿ç”¨`jsonlite::fromJSON()`å’Œ`tibble::as_tibble()`ã€‚*

```
*res <- content(req, type = "text/json") %>% 
  jsonlite::fromJSON() %>% 
  as_tibble() glimpse(res)## Observations: 52 ## Variables: 27
## $ statefip <int> 1, 2, 4, 5, 6, 8, 9, 10, 11, 12, 13, 15, 16, 17, 18... 
## $ costelec <int> 7440, 7080, 7320, 6600, 7800, 6240, 7800, 6720, 648... 
## $ costgas <int> 5760, 6240, 4800, 5880, 5400, 5520, 6840, 6360, 528... 
## $ costwatr <int> 3100, 3400, 3800, 3100, 4100, 3300, 3100, 2800, 360... 
## $ costfuel <int> 3900, 7100, 2800, 3300, 2900, 2400, 5700, 3500, 430... 
## $ condofee <int> 1100, 690, 1000, 870, 1200, 920, 940, 950, 1400, 14... 
## $ rent <int> 2400, 2800, 2900, 2000, 3900, 3200, 3300, 2800, 390... 
## $ proptx99 <int> 66, 69, 69, 67, 69, 69, 69, 69, 69, 69, 69, 69, 69,... 
## $ propinsr <int> 5400, 7500, 5000, 5200, 8100, 7200, 9800, 6000, 770... 
## $ mortamt1 <int> 3400, 4000, 5000, 3600, 7300, 5400, 7400, 4000, 700... 
## $ mortamt2 <int> 1600, 2900, 2400, 2200, 3900, 3600, 2900, 2700, 540... 
## $ moblhome <int> 4300, 7900, 10300, 4800, 13900, 12000, 8000, 10100,... 
## $ rooms <int> 16, 16, 15, 15, 14, 17, 17, 16, 16, 14, 18, 14, 17,... 
## $ bedrooms <int> 8, 8, 6, 6, 7, 7, 7, 7, 7, 6, 7, 7, 7, 7, 8, 8, 7, ... 
## $ valueh <int> 1551000, 1945000, 2387000, 1901000, 6288000, 348100... ## $ incwage <int> 391000, 439000, 412000, 422000, 565000, 498000, 718... ## $ incbus00 <int> 335000, 256000, 280000, 295000, 372000, 320000, 448... ## $ incinvst <int> 299000, 96000, 306000, 263000, 353000, 290000, 3230... ## $ incretir <int> 109000, 148000, 138000, 113000, 169000, 129000, 158... ## $ incother <int> 64000, 33200, 73000, 67000, 78000, 76000, 79000, 72... ## $ incwelfr <int> 10200, 11800, 12700, 11300, 18900, 14500, 19000, 75... ## $ incsupp <int> 22700, 24000, 25800, 22700, 25400, 26200, 26600, 24... ## $ incss <int> 34500, 32400, 34400, 35100, 35300, 35100, 37700, 36... ## $ age <int> 93, 91, 93, 94, 94, 93, 96, 92, 94, 95, 92, 96, 94,... ## $ trantime <int> 152, 162, 145, 129, 141, 157, 142, 157, 111, 150, 1... ## $ incbus00_min <int> -6900, -6500, -5000, -7800, -4800, -5800, -4800, -6... ## $ incincst_min <int> -1500, -800, -1600, -920, -2300, -1800, -1800, -140...*
```

*å˜£ï¼ï¼ï¼æˆåŠŸäº†ã€‚ç°åœ¨æ˜¯æ—¶å€™æŠŠå®ƒå˜æˆä¸€ä¸ªå‡½æ•°äº†ã€‚ä¸ºäº†ä½¿å…¶é€šç”¨åŒ–ï¼Œæˆ‘ä»¬éœ€è¦è®©ç”¨æˆ·å¯ä»¥ä¸º`upload_file()`æŒ‡å®šæ–‡ä»¶è·¯å¾„ã€‚*

```
*# define `post_excel()` 
post_excel <- function(file) { b_url <- "http://127.0.0.1:5846/read_excel"   req <- POST(b_url, body = list(req = upload_file(file)))    res <- content(req, type = "text/json") %>% 
             jsonlite::fromJSON() %>%
             tibble::as_tibble() res 
}*
```

*æ‚¨å·²ç»ä¸ºæ‚¨çš„ API åˆ›å»ºäº†ä¸€ä¸ªåŒ…è£…å™¨ï¼ç°åœ¨æ‚¨å·²ç»æœ‰äº†ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å¾®æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡ R åŒ…è£…å™¨è®¿é—®å®ƒã€‚*

```
*post_excel("data/test.xls")## # A tibble: 52 x 27 
## statefip costelec costgas costwatr costfuel condofee rent proptx99 
## <int> <int> <int> <int> <int> <int> <int> <int> 
## 1 1 7440 5760 3100 3900 1100 2400 66 
## 2 2 7080 6240 3400 7100 690 2800 69
## 3 4 7320 4800 3800 2800 1000 2900 69 
## 4 5 6600 5880 3100 3300 870 2000 67 
## 5 6 7800 5400 4100 2900 1200 3900 69 
## 6 8 6240 5520 3300 2400 920 3200 69 
## 7 9 7800 6840 3100 5700 940 3300 69 
## 8 10 6720 6360 2800 3500 950 2800 69 
## 9 11 6480 5280 3600 4300 1400 3900 69 
## 10 12 6720 3480 3400 3600 1400 3300 69 
## # ... with 42 more rows, and 19 more variables: propinsr <int>, ## # mortamt1 <int>, mortamt2 <int>, moblhome <int>, rooms <int>, 
## # bedrooms <int>, valueh <int>, incwage <int>, incbus00 <int>, 
## # incinvst <int>, incretir <int>, incother <int>, incwelfr <int>, ## # incsupp <int>, incss <int>, age <int>, trantime <int>, 
## # incbus00_min <int>, incincst_min <int>*
```

*æˆ‘ä»¬å¯ä»¥ä¸º`/upload`ç«¯ç‚¹åˆ›å»ºä¸€ä¸ªç±»ä¼¼çš„å‡½æ•°ã€‚*

```
*upload <- function(file) {   b_url <- "http://127.0.0.1:5846/upload" usethis::ui_info(glue::glue("Copying {file} to /data/{file}"))  req <- POST(b_url, body = list(req = upload_file(file)))   invisible(req) 
}upload("data/test.xls")## â„¹ Copying data/test.xls to /data/data/test.xls*
```

> **æ³¨:æˆ‘å»ºè®®ä½¿ç”¨{usethis}çš„* `*ui_*()*` *åŠŸèƒ½ï¼Œä¸ºç”¨æˆ·æä¾›ä¿¡æ¯æ€§æ¶ˆæ¯ã€‚
> ç¬¬äºŒä¸ªæ³¨æ„:å¦‚æœä½ æ‰“ç®—åªå…è®¸ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ä¸€æ¬¡ï¼Œå°±åƒè¿™ä¸ªå‡½æ•°æ‰€åšçš„é‚£æ ·ï¼Œä½ å¯èƒ½å®é™…ä¸Šåº”è¯¥ä½¿ç”¨ä¸€ä¸ªä¸Šä¼ è¯·æ±‚ã€‚**

*å§å—’å§å—’å˜£ã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ plumber åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿå¤„ç† Microsoft Excel æ–‡ä»¶çš„å¾®æœåŠ¡ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªå°å£®ä¸¾ï¼ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿæ‚¨åº”è¯¥ä¸ºæ–°åˆ›å»ºçš„ API åˆ›å»ºä¸€ä¸ªæ¼‚äº®çš„å° python åŒ…è£…å™¨ã€‚python åŒ…è£…å™¨å¯¹æ‚¨çš„å›¢é˜Ÿæ¥è¯´å°†æ˜¯ä¸€ç¬”å·¨å¤§çš„è´¢å¯Œï¼Œç°åœ¨æ‚¨çš„åŸºäº R çš„å·¥å…·å¯ä»¥è¢«ä»»ä½•èƒ½å¤Ÿå‘å‡º HTTP è¯·æ±‚çš„äººæˆ–äº‹ç‰©è®¿é—®ï¼ï¼ï¼*