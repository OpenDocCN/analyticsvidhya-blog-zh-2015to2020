<html>
<head>
<title>Easy Analysis of HDF5 Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">轻松分析HDF5数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/easy-analysis-of-hdf5-data-1bb986302b97?source=collection_archive---------14-----------------------#2020-02-11">https://medium.com/analytics-vidhya/easy-analysis-of-hdf5-data-1bb986302b97?source=collection_archive---------14-----------------------#2020-02-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4e08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有一种数据格式叫做<a class="ae jd" href="https://en.wikipedia.org/wiki/Hierarchical_Data_Format" rel="noopener ugc nofollow" target="_blank"> HDF5(分层数据格式)</a>，在科学研究中被广泛使用。HDF5是一种有趣的格式，因为它就像文件中的文件系统，性能极高。然而，HDF5格式可能很难实际访问以HDF5格式编码的数据。但是，正如标题所示，这篇文章将带您了解如何使用我最喜欢的工具Apache Drill轻松访问和查询HDF5数据集。</p><p id="5185" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">自1.18版本起，Drill将原生支持读取HDF5文件。</p><h1 id="9b7a" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">配置钻取以查询HDF5</h1><p id="37ab" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">为了配置Drill以查询HDF5文件，您首先必须在文件系统的配置中设置以下变量。这应该适用于存储在Hadoop、S3/Azure/谷歌云或本地文件系统上的HDF5文件。这也适用于压缩的HDF5文件。唯一不显而易见的变量是<code class="du kh ki kj kk b">defaultPath</code>，我稍后会谈到它，但现在让它保持为<code class="du kh ki kj kk b">null</code>。</p><p id="47d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kh ki kj kk b">"hdf5": {"type": "hdf5","extensions": ["h5"],"defaultPath": null}</code></p><p id="c152" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦将它添加到配置中，Drill就可以查询HDF5了。</p><h1 id="222a" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">在Drill中查询HDF5文件</h1><p id="fd35" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">现在Drill已经设置好了，您可以直接在Drill中查询HDF5文件。然而，Drill以两种方式查询HDF5:元数据查询和数据查询。元数据查询允许您浏览HDF5文件的内容，记住一个HDF5文件将包含多个数据集，而数据查询允许您直接查询数据集。让我们首先来看看元数据查询。确定Drill是执行元数据查询还是数据集查询的方法是设置前面提到的<code class="du kh ki kj kk b">defaultPath</code>变量。当它被设置为<code class="du kh ki kj kk b">null</code>时，您将获得文件元数据，所以现在，我们将把它保留为<code class="du kh ki kj kk b">null</code>，看看会发生什么。</p><p id="7b3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本例中，我们将查询一个名为scalar.h5的文件，这是一个包含几个样本数据集的简单文件。元数据查询至少会返回以下字段:</p><ul class=""><li id="2b02" class="kl km hi ih b ii ij im in iq kn iu ko iy kp jc kq kr ks kt bi translated">路径:这是到单个数据集的<strong class="ih hj"> HDF5路径</strong>。当您想要查询数据集时，这是您将在<code class="du kh ki kj kk b">defaultPath</code>变量中设置的值。</li><li id="f12b" class="kl km hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated">data_type:这是包含在特定路径中的对象类型。选项有组、数据集、软链接。</li><li id="5a30" class="kl km hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated">file_name:实际文件的名称。</li><li id="5edf" class="kl km hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated">属性:HDF5数据集可以有属性。Drill将这些映射到键/值对的映射。</li></ul><figure class="la lb lc ld fd le er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es kz"><img src="../Images/ad034ac80c79b17c603ad92a41640af6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Lm0m6ww79F7ClHbc.png"/></div></div></figure><p id="b5c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了元数据之外，元数据查询还将返回实际的数据集。数据的字段名为<code class="du kh ki kj kk b">&lt;data type&gt;_data</code>。因此，在本例中，有一个名为double_data的列，它包含实际数据的嵌套列表。</p><figure class="la lb lc ld fd le er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es ll"><img src="../Images/06fdccce9133ef412f35f3f821cebedd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vjVMJdQ2MMYx0jaq.png"/></div></div></figure><p id="2abd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用下面的查询直接查询这些数据，但是，这样效率不高，并且会导致极其复杂的查询。</p><p id="a74d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kh ki kj kk b"><strong class="ih hj">SELECT</strong></code> <code class="du kh ki kj kk b">flatten(double_data)</code></p><p id="123d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kh ki kj kk b"><strong class="ih hj">FROM</strong></code> <code class="du kh ki kj kk b">dfs.test.`browsing.h5`</code></p><p id="12ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kh ki kj kk b"><strong class="ih hj">WHERE</strong></code> <code class="du kh ki kj kk b">path='/groupB/dmat'</code></p><p id="53c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查询这个数据集的一个更好的方法是使用<code class="du kh ki kj kk b">defaultPath</code>选项，我一直避免讨论这个选项。</p><h1 id="8daa" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">查询数据集</h1><p id="91df" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">除了查询HDF5文件元数据，Drill还允许您只需在HDF5配置中设置<code class="du kh ki kj kk b">defaultPath</code>选项，即可查询HDF5文件中的单个数据集。这可以直接在配置中完成，也可以在查询时使用<code class="du kh ki kj kk b">table()</code>功能完成。例如，如果您想要查询上面的数据集，您可以使用以下查询:</p><p id="6c9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kh ki kj kk b"><strong class="ih hj">SELECT</strong></code>T11】</p><p id="a1f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kh ki kj kk b"><strong class="ih hj">FROM</strong></code>T13】</p><p id="bf7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您会注意到<code class="du kh ki kj kk b">table() </code>功能的使用，该功能将<code class="du kh ki kj kk b">defaultPath</code>设置为<code class="du kh ki kj kk b">/groupB/dmat</code>。该查询的结果如下所示。</p><figure class="la lb lc ld fd le er es paragraph-image"><div class="er es lm"><img src="../Images/44982bc0244da1849a31255600f24db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/0*ZrVkj11BvZ6ogX4v.png"/></div></figure><p id="5994" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您所看到的，这个查询产生了三列，它们反映了数据的类型:<code class="du kh ki kj kk b">double_col_n</code>。然后，可以单独选择、筛选、聚合这些列，在函数中使用这些列，或者以任何其他方式与Drill可以查询的任何数据相结合。</p><p id="0171" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">需要指出的一点是，HDF5支持无限维的嵌套数据。虽然Drill也是如此，但这实际上意味着数据变得难以处理，因此Drill会自动展平任何嵌套深度超过2层的数据。</p><h1 id="2fd7" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">有多快？</h1><p id="0f73" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">这就是问题所在，不是吗？我只有一个词…快！不幸的是，HDF5库有一个很大的限制，我不打算在这里讨论，但如果这个限制得到解决，这个东西会更快！！我用实际的HDF5数据文件做了一些测试，在我的Macbook上，Drill能够在不到2秒的时间内查询1GB HDF5中的大型数据集。然而，更重要的不仅仅是“它有多快”，而是“它有多容易？”在我看来，这才是钻探真正闪光的地方。使用Drill查询HDF5数据非常简单，因为Drill使用标准SQL。它让您的HDF5数据看起来就像是数据库中的另一张表！</p><h1 id="09a3" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="d1a8" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">总之，如果您正在进行科学研究并处理HDF5数据，但不想处理HDF5库或编码，或者只是喜欢使用SQL，您真的应该尝试一下Drill。Drill可以轻松高效地查询HDF5数据集，就像它们是常规的数据库表一样。这就对了。</p></div></div>    
</body>
</html>