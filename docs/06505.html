<html>
<head>
<title>Python flask-restful web backend</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python flask-restful web后端</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/python-flask-restful-web-backend-598e86e74fd7?source=collection_archive---------15-----------------------#2020-05-24">https://medium.com/analytics-vidhya/python-flask-restful-web-backend-598e86e74fd7?source=collection_archive---------15-----------------------#2020-05-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><ul class=""><li id="b8fd" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated">这是一个基于<code class="du ix iy iz ja b">flask-restful</code>的web后端项目，编码在<code class="du ix iy iz ja b">python3.8</code>中。</li><li id="f89c" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">你可以把它当作学习web-framework的模板，或者只是开始使用python编写web项目。</li><li id="388b" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">该项目使用<strong class="ih hj">输入</strong>进行输入提示。</li><li id="c744" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">本项目使用<strong class="ih hj"> Unittest </strong>进行测试。</li><li id="7675" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">这个项目的资源库网址是<a class="ae jg" href="https://github.com/RuiCoreSci/flask-restful" rel="noopener ugc nofollow" target="_blank">这里</a></li></ul><h1 id="c069" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">1.需要</h1><ul class=""><li id="ee22" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated">Python3.8</li><li id="a7b5" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">MySql(5.7或以上版本)</li></ul><h1 id="57fa" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">2.奔跑</h1><h1 id="ac61" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">2.1 Docker(推荐)</h1><ol class=""><li id="0b66" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is kk iu iv iw bi translated">安装<a class="ae jg" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">对接器</a>。</li><li id="08fb" class="if ig hi ih b ii jb ik jc im jd io je iq jf is kk iu iv iw bi translated">光盘到项目目录，运行<code class="du ix iy iz ja b">make run</code>直到完成。</li></ol><ul class=""><li id="79e7" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated"><code class="du ix iy iz ja b">make run</code>会构建docker镜像，启动服务器(比如Mysql)。</li></ul><ol class=""><li id="7d78" class="if ig hi ih b ii ij ik il im in io ip iq ir is kk iu iv iw bi translated">运行<code class="du ix iy iz ja b">make init</code>到初始数据库(创建数据库，创建表格，<strong class="ih hj">无数据导入</strong>)。</li></ol><ul class=""><li id="4fe8" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated">到<a class="ae jg" href="http://0.0.0.0:24579/health" rel="noopener ugc nofollow" target="_blank"> localhost </a>检查是否正确启动。</li></ul><p id="61b5" class="pw-post-body-paragraph kl km hi ih b ii ij kn ko ik il kp kq im kr ks kt io ku kv kw iq kx ky kz is hb bi translated"><strong class="ih hj">注意</strong> : <code class="du ix iy iz ja b">make test</code>将运行文件夹<code class="du ix iy iz ja b">tests</code>中的所有单元测试。</p><h1 id="9057" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">2.2外壳</h1><ol class=""><li id="3211" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is kk iu iv iw bi translated">使用类似<code class="du ix iy iz ja b">CREATE DATABASE flask DEFAULT CHARSET utf8</code>的命令或GUI工具(如<a class="ae jg" href="https://www.jetbrains.com/datagrip/" rel="noopener ugc nofollow" target="_blank"> DataGrip </a>)在您自己的DB服务器中创建一个数据库。</li><li id="5fcc" class="if ig hi ih b ii jb ik jc im jd io je iq jf is kk iu iv iw bi translated">将文件<code class="du ix iy iz ja b">settings.py</code>中的<code class="du ix iy iz ja b">SQLALCHEMY_DATABASE_URI</code>和<code class="du ix iy iz ja b">SQLALCHEMY_DATABASE_BASE</code>修改为您自己的设置。</li><li id="ac9f" class="if ig hi ih b ii jb ik jc im jd io je iq jf is kk iu iv iw bi translated">运行:</li></ol><pre class="la lb lc ld fd le ja lf lg aw lh bi"><span id="2e90" class="li ji hi ja b fi lj lk l ll lm">python3.8 -m venv --clear venv</span><span id="7a90" class="li ji hi ja b fi ln lk l ll lm">source ./venv/bin/active</span><span id="fcf3" class="li ji hi ja b fi ln lk l ll lm">pip install -r requirements.txt</span><span id="9ae8" class="li ji hi ja b fi ln lk l ll lm">python server.py</span></pre><ol class=""><li id="0f26" class="if ig hi ih b ii ij ik il im in io ip iq ir is kk iu iv iw bi translated">进入<a class="ae jg" href="http://0.0.0.0:24579/health" rel="noopener ugc nofollow" target="_blank">本地主机</a>检查是否正确启动。</li></ol><h1 id="8f7e" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">2.3加载样本数据</h1><ul class=""><li id="66b5" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated">如果你想加载soma数据来玩这个项目，使用这个项目提供的<code class="du ix iy iz ja b">data.sql</code>。</li></ul><ol class=""><li id="e754" class="if ig hi ih b ii ij ik il im in io ip iq ir is kk iu iv iw bi translated">打开DataGrip，连接Mysql数据库；</li><li id="ff50" class="if ig hi ih b ii jb ik jc im jd io je iq jf is kk iu iv iw bi translated">使用任意编辑器打开<code class="du ix iy iz ja b">data.sql</code>，将其内容复制到控制台，执行；</li></ol><ul class=""><li id="5b8b" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated">使用DataGrip，您应该得到类似这样的结果:</li></ul><figure class="la lb lc ld fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lo"><img src="../Images/9778ed58706a0a5fdb52c6eccaf08444.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sh2fStRAkiFf-nll"/></div></div></figure><h1 id="6c0f" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">3.休息</h1><ul class=""><li id="7e74" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated">什么是<strong class="ih hj">休息</strong>？REST代表<strong class="ih hj">(资源)表述性状态转移</strong>，它是一种无状态通信协议。rest的核心概念是<strong class="ih hj">资源</strong>。在<strong class="ih hj"> REST </strong>的观点中，每一个可以被抽象的概念都被称为资源。假设属性<code class="du ix iy iz ja b">name</code>、<code class="du ix iy iz ja b">age</code>、<code class="du ix iy iz ja b">email</code>可以抽象为用户模型，那么<code class="du ix iy iz ja b">User</code>可以表示为资源。</li><li id="c376" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated"><strong class="ih hj">转移</strong>是指资源从服务器端转移到客户端。</li><li id="c438" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">在<strong class="ih hj"> REST </strong>世界中，每个操作都是在某种资源上操作的，并且有预定义的<strong class="ih hj">动词</strong>来描述。如<strong class="ih hj"> Post </strong>表示创建一个资源，<strong class="ih hj"> Put </strong>表示更新一个资源，<strong class="ih hj"> Delete </strong>表示删除一个资源。这三个动词是主要使用的，你可以查看这里的<a class="ae jg" href="https://realpython.com/flask-connexion-rest-api/" rel="noopener ugc nofollow" target="_blank">了解更多细节。</a></li></ul><h1 id="fcf9" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">4.休息的好处</h1><ul class=""><li id="227e" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated">使用REST，您将获得一些优势:</li></ul><ol class=""><li id="8724" class="if ig hi ih b ii ij ik il im in io ip iq ir is kk iu iv iw bi translated">每个<strong class="ih hj"> URI </strong>(或者URL)都是针对一个特定的资源，它让你的代码变得干净<a class="ae jg" href="https://en.wikipedia.org/wiki/Self-documenting_code" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">自描述</strong> </a>。基本上，自我描述意味着你所见即所得，你可以快速猜测你将从URI得到什么。</li><li id="bc43" class="if ig hi ih b ii jb ik jc im jd io je iq jf is kk iu iv iw bi translated">资源与视图函数是分离的，这意味着你可以在不影响其他人的情况下改变你的后端逻辑函数，前提是你采用相同的参数并返回相同的资源，这很容易实现。</li><li id="0e49" class="if ig hi ih b ii jb ik jc im jd io je iq jf is kk iu iv iw bi translated">它是无状态的，这意味着在请求资源之前，你不需要担心被包围的上下文。</li></ol><h1 id="266d" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">5.统一响应结构</h1><ul class=""><li id="cebc" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated">使用Rest，我们应该使返回到<strong class="ih hj">的响应保持不变</strong>。大多数情况下，响应数据应该包含两部分:<strong class="ih hj">元</strong>和<strong class="ih hj">数据</strong>。</li><li id="7540" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated"><strong class="ih hj"> Meta </strong>表示关于请求的信息，来自客户端的请求是成功还是失败？是否被服务器成功理解但请求不被允许？</li><li id="87fb" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated"><strong class="ih hj">数据</strong>表示请求者想要得到的资源。</li><li id="e391" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">在本项目中，响应定义如下:</li></ul><pre class="la lb lc ld fd le ja lf lg aw lh bi"><span id="c4cc" class="li ji hi ja b fi lj lk l ll lm">{<br/>    "data": data,<br/>    "error_code": error_code,<br/>    "error_msg": error_msg,<br/>}</span></pre><ul class=""><li id="941e" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated">例如，当一个请求想要得到一个用户，比如说<strong class="ih hj">用户1 </strong>，它可能得到:</li></ul><pre class="la lb lc ld fd le ja lf lg aw lh bi"><span id="0270" class="li ji hi ja b fi lj lk l ll lm">{<br/>    "data": {<br/>        "id": 1,<br/>        "name": "John",<br/>        "web_site": "https://github.com/account",<br/>        "email": "hrui801@gmail.com",<br/>        "create_time": "2020-05-22 13:41:49",<br/>        "update_time": "2020-05-22 13:41:49"</span><span id="78ca" class="li ji hi ja b fi ln lk l ll lm">    },<br/>    "error_code": 0,<br/>    "error_msg": "success"<br/>}</span></pre><ul class=""><li id="a69b" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated"><strong class="ih hj">你应该知道的一些事情</strong>:</li><li id="0d8b" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">基本上，我们不直接在处理函数中返回JSON数据，而是返回一个对象。</li><li id="3b36" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">因此，在返回前端之前，我们应该将对象编组为JSON格式。</li><li id="e680" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">在flask中，您可以使用<strong class="ih hj"> jsonify </strong>函数来实现这一点，要将定制的数据传输到JSON，您可以重写<strong class="ih hj"> json。JSONEncoder </strong>函数。</li><li id="0a5b" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">在这个项目中，json。JSONEncoder被重写为:</li></ul><pre class="la lb lc ld fd le ja lf lg aw lh bi"><span id="e410" class="li ji hi ja b fi lj lk l ll lm">class JsonEncoder(json.JSONEncoder):<br/>    def default(self, value) -&gt; Any:<br/>        if isinstance(value, (datetime.datetime, datetime.date)):<br/>            return value.strftime("%Y-%m-%d %H:%M:%S")<br/>        if isinstance(value, ApiResponse):<br/>            return value.get()<br/>        if isinstance(value, BaseModel):<br/>            return value.marshal()<br/>        if isinstance(value, types.GeneratorType):<br/>            return [self.default(v) for v in value]</span><span id="ad0c" class="li ji hi ja b fi ln lk l ll lm">        return json.JSONEncoder.default(self, value)</span></pre><ul class=""><li id="fe34" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated">然后注册到flask app:</li></ul><pre class="la lb lc ld fd le ja lf lg aw lh bi"><span id="cdcc" class="li ji hi ja b fi lj lk l ll lm">app.json_encoder = JsonEncoder</span></pre><ul class=""><li id="911f" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated">Finlay，在你返回数据到前端之前，调用<code class="du ix iy iz ja b">jsonify</code>函数:</li></ul><pre class="la lb lc ld fd le ja lf lg aw lh bi"><span id="8d0a" class="li ji hi ja b fi lj lk l ll lm">def schema(query_model: BaseQueryModel, response_model: ApiDataType):<br/>    def decorator(func):</span><span id="a633" class="li ji hi ja b fi ln lk l ll lm">        @wraps(func)<br/>        def wrapper(self, **kwargs) -&gt; Callable:<br/>            """Some logic """<br/>            # jsonify function is called here<br/>            return jsonify(func(self, **kwargs)) </span><span id="902e" class="li ji hi ja b fi ln lk l ll lm">        return wrapper</span><span id="5c5f" class="li ji hi ja b fi ln lk l ll lm">    return decorator</span></pre><h1 id="e0fa" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">6.统一异常处理</h1><ul class=""><li id="4cae" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated">异常<strong class="ih hj">并不意味着不好，另一方面，让用户知道他们正在做服务器不满意的事情是很重要的。他们需要知道原因。</strong></li><li id="d51f" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">为了给用户相应的错误信息，并正确地引发异常，本项目使用文件<strong class="ih hj">异常</strong>来阐明所有异常。</li></ul><pre class="la lb lc ld fd le ja lf lg aw lh bi"><span id="b512" class="li ji hi ja b fi lj lk l ll lm">class ServerException(Exception):<br/>    code = 500<br/></span><span id="521b" class="li ji hi ja b fi ln lk l ll lm">class ArgumentInvalid(ServerException):<br/>    code = 400</span></pre><ul class=""><li id="f223" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated">你可以给每个类添加一个<strong class="ih hj">消息</strong>属性。</li><li id="b44a" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">我们想在代码中引发异常，需要一个<strong class="ih hj">统一异常处理函数</strong>:</li></ul><pre class="la lb lc ld fd le ja lf lg aw lh bi"><span id="764c" class="li ji hi ja b fi lj lk l ll lm">def handle_exception(e) -&gt; Tuple[Dict[str, Union[Union[int, str, list], Any]], Union[int, Any]]:<br/>    code = 500<br/>    if isinstance(e, (HTTPException, ServerException)):<br/>        code = e.code</span><span id="5374" class="li ji hi ja b fi ln lk l ll lm">    logger.exception(e)<br/>    exc = [v for v in traceback.format_exc(limit=10).split("\n")]<br/>    if str(code) == "500":<br/>        send_dingding_alert(request.url, request.args, request.json, repr(e), exc)<br/>    return {'error_code': code, 'error_msg': str(e), 'traceback': exc}, code</span></pre><ul class=""><li id="3e65" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated">然后注册应用程序:</li></ul><pre class="la lb lc ld fd le ja lf lg aw lh bi"><span id="37f4" class="li ji hi ja b fi lj lk l ll lm">app.register_error_handler(Exception, handle_exception)</span></pre><ul class=""><li id="e7e3" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated"><strong class="ih hj">注意</strong>:如果想直接在代码中引发异常，又不想写异常处理函数，那么所有的异常<strong class="ih hj">必须是<strong class="ih hj">werkzeug . exceptions . httpexception</strong>的子类</strong>。</li></ul><h1 id="2b72" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">7.统一查询模型、响应模型和数据库模型</h1><ul class=""><li id="47f4" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated">在面向对象编程中，最好将参数保持为单个对象，而不是多个独立的参数。Python和Flask里就是这样。</li><li id="dc3f" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">假设您想通过用户的<strong class="ih hj">姓名</strong>和/或<strong class="ih hj">年龄</strong>和/或<strong class="ih hj">电子邮件</strong>来查询用户，最好这样写:</li></ul><pre class="la lb lc ld fd le ja lf lg aw lh bi"><span id="7f3e" class="li ji hi ja b fi lj lk l ll lm">def get_user(filter_obj):<br/>    # filter_obj will have property:name, age, email<br/>        pass</span></pre><ul class=""><li id="4837" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated">不是:</li></ul><pre class="la lb lc ld fd le ja lf lg aw lh bi"><span id="88cb" class="li ji hi ja b fi lj lk l ll lm">def get_user(name, age, email):<br/>        pass</span></pre><h2 id="bc1e" class="li ji hi bd jj lw lx ly jn lz ma mb jr im mc md jv io me mf jz iq mg mh kd mi bi translated">7.1本项目对请求参数使用查询模型</h2><pre class="la lb lc ld fd le ja lf lg aw lh bi"><span id="7a6c" class="li ji hi ja b fi lj lk l ll lm">class BaseQueryModel(BaseModel):<br/>    def __init__(self, **kwargs: dict):<br/>        super().__init__(drop_missing=False, **kwargs)<br/>        """ Some logic """</span></pre><ul class=""><li id="ae65" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated">并且<strong class="ih hj">查询模式的args验证</strong>可以写入BaseModel。</li></ul><h2 id="f989" class="li ji hi bd jj lw lx ly jn lz ma mb jr im mc md jv io me mf jz iq mg mh kd mi bi translated">7.2本项目对响应结果采用响应模型</h2><pre class="la lb lc ld fd le ja lf lg aw lh bi"><span id="f4e8" class="li ji hi ja b fi lj lk l ll lm">class BaseResponseModel(BaseModel):<br/>    def __init__(self, **kwargs):<br/>        super().__init__(**kwargs)<br/>        """ Some logic """</span></pre><ul class=""><li id="21ef" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated"><strong class="ih hj">在返回前端</strong>之前，不要忘记jsonify你的响应模型。</li></ul><h2 id="ec75" class="li ji hi bd jj lw lx ly jn lz ma mb jr im mc md jv io me mf jz iq mg mh kd mi bi translated">7.3本项目使用ORM管理数据库</h2><ul class=""><li id="01ee" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated"><strong class="ih hj">对象关系映射</strong>用于与数据库通信，它让你从编写SQL语句中解脱出来，让你以对象方式<strong class="ih hj">编码</strong>。</li></ul><pre class="la lb lc ld fd le ja lf lg aw lh bi"><span id="c825" class="li ji hi ja b fi lj lk l ll lm">from flask_sqlalchemy import SQLAlchemy</span><span id="16d4" class="li ji hi ja b fi ln lk l ll lm">class Base(db.Model, SurrogatePK):<br/>    """DataBase Model that Contains CRUD Operations"""</span><span id="3bf3" class="li ji hi ja b fi ln lk l ll lm">    __abstract__ = True</span><span id="49a2" class="li ji hi ja b fi ln lk l ll lm">    """Some logic that all subclass should be inherited """</span></pre><h2 id="7978" class="li ji hi bd jj lw lx ly jn lz ma mb jr im mc md jv io me mf jz iq mg mh kd mi bi translated">7.4本项目使用Alembic更新数据库</h2><pre class="la lb lc ld fd le ja lf lg aw lh bi"><span id="0e93" class="li ji hi ja b fi lj lk l ll lm">from sqlalchemy.ext.declarative import declarative_base</span><span id="0b19" class="li ji hi ja b fi ln lk l ll lm">Meta = declarative_base()<br/>db = SQLAlchemy(model_class=Meta)</span><span id="0579" class="li ji hi ja b fi ln lk l ll lm">class Base(db.Model, SurrogatePK):<br/>    """DataBase Model that Contains CRUD Operations"""</span></pre><ul class=""><li id="ef7c" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated">Alembic 有点像git，它保存你的数据库模型的每个版本。它会生成一个文件夹<code class="du ix iy iz ja b">alembic</code>、<code class="du ix iy iz ja b">alembic/versions</code>，所有版本都存储在<code class="du ix iy iz ja b">versions</code>中。</li></ul><h1 id="79b0" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">8.招摇还是不招摇</h1><ul class=""><li id="2528" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated">Swagger提供了一种自动生成文档的方法，因此您不需要自己更新文档。Web前端开发人员可以检查它进行开发。</li><li id="6f32" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">但是以我的经验，前端开发人员和后端开发人员在开发之前讨论产品需求，自动生成的文档不够详细，不足以声明需求。所以这个项目不要用它。</li><li id="2498" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">不过用它也无妨，如果你想用swagger，在这里查看一下<a class="ae jg" href="https://flask-restplus.readthedocs.io/en/stable/swagger.html" rel="noopener ugc nofollow" target="_blank">。</a></li></ul><h1 id="fc8d" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">9.本项目的结构</h1><figure class="la lb lc ld fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mj"><img src="../Images/f760a7b25f645b6b694d9116e0fb01f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MoH7gDex3zqwQ7dT"/></div></div></figure><ul class=""><li id="7b9c" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated"><strong class="ih hj"> MVC(模型、视图、控制器)</strong>是典型的设计模式。这个项目是在MVC模式编程，但并不严格坚持它。</li></ul><h2 id="55b9" class="li ji hi bd jj lw lx ly jn lz ma mb jr im mc md jv io me mf jz iq mg mh kd mi bi translated">9.1模型(这个项目中的模型):存储关于资源的信息</h2><ul class=""><li id="46d0" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated">具体来说，它们是:</li><li id="074a" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">数据库模型，<strong class="ih hj"> ORM </strong>在这个文件夹中，它将你的python对象转移到数据库行中。</li><li id="bf34" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">QueryModel，作为一个模型组织在一起的参数。所以前端发送参数给后端，后端把它们放在一起创建一个新的对象来做参数验证工作，因为使用模型，一些默认的函数可以绑定到它。</li><li id="ec74" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">ResponseModel，返回到前端的资源。</li></ul><h2 id="10fc" class="li ji hi bd jj lw lx ly jn lz ma mb jr im mc md jv io me mf jz iq mg mh kd mi bi translated">9.2查看(本项目中的资源):做路由工作</h2><ul class=""><li id="6326" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated">视图处理路由工作，当一个URL被请求时，视图函数知道调用什么逻辑函数。</li></ul><h2 id="bac1" class="li ji hi bd jj lw lx ly jn lz ma mb jr im mc md jv io me mf jz iq mg mh kd mi bi translated">9.3控制器(本项目中的处理程序):做逻辑工作</h2><ul class=""><li id="01a3" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated">处理程序用来做逻辑工作，比如<strong class="ih hj"> CRUD </strong>。</li></ul><h2 id="48bb" class="li ji hi bd jj lw lx ly jn lz ma mb jr im mc md jv io me mf jz iq mg mh kd mi bi translated">9.4其他一些文件夹/文件</h2><ul class=""><li id="5706" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated">文件夹<strong class="ih hj">豁免</strong>存储定制的异常文件和一个发送错误到丁丁的文件。</li><li id="3549" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">文件夹<strong class="ih hj">蓝图</strong>用于组织所有API。</li><li id="e6ab" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">文件夹<strong class="ih hj"> tests </strong>存储所有<strong class="ih hj">单元测试用例</strong>，<strong class="ih hj">使用一个测试用例</strong>是在开发新特性时保持项目良好运行的好方法。</li></ul><h1 id="b53a" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">10.N + 1问题</h1><ul class=""><li id="32f8" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated">每次查询一个表10次以获取一行比查询一个表一次以获取10行要慢。</li><li id="2fff" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated"><strong class="ih hj"> ORM </strong>将程序员从编写原始SQL语句中解放出来，但也引入了一些新问题。数据库查询<strong class="ih hj"> N+1 </strong>问题是一个常见的问题。</li><li id="7b0d" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">假设你有两个表，<strong class="ih hj">用户</strong>和<strong class="ih hj">帖子</strong>，一个用户可以写很多帖子。考虑下面的场景:</li><li id="c283" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">你有一个页面，需要显示10个随机用户的信息，还要求你显示每个用户的所有帖子。</li><li id="f9d6" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">在这种情况下ORM会做什么？<strong class="ih hj">先</strong>，查询用户表<strong class="ih hj">一次</strong>得到十个用户；<strong class="ih hj">第二个</strong>，为循环用户查询每个用户一次帖子表，ORM查询帖子表<strong class="ih hj">十次</strong>。</li><li id="6a09" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">代码应该是这样的:</li></ul><pre class="la lb lc ld fd le ja lf lg aw lh bi"><span id="c8d4" class="li ji hi ja b fi lj lk l ll lm">users = User.query.limit(10) # query once</span><span id="6548" class="li ji hi ja b fi ln lk l ll lm">for user in users:<br/>    posts = Post.query.filter_by(user_id==user.id)<br/># Query ten times<br/># All times Query Table is 1 + 10</span></pre><ul class=""><li id="528d" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated">如果你查询用户表1次，得到<strong class="ih hj"> N </strong>个用户，那么你需要查询帖子表<strong class="ih hj"> N </strong>次才能得到帖子，所有次查询表都是<strong class="ih hj"> 1+N </strong>，这叫<strong class="ih hj"> N+1 </strong>问题(也许叫1+N似乎更合理)。</li><li id="4ef7" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">其实如果你熟悉join的话，是不需要查询N+1次的。</li><li id="ef3d" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">所以在你的项目中，<strong class="ih hj">小心地</strong>处理这个场景。</li><li id="58b3" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">脸书提供了一个名为<strong class="ih hj">数据加载器</strong>的解决方案来解决这个问题。</li></ul><h1 id="c6c2" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">11.休息的坏处</h1><ul class=""><li id="81fb" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated">虽然休息有很多好处，但也确实有一些坏处。</li><li id="16cc" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">主要缺点是浪费资源，比如网络IO。</li><li id="6960" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">在REST中，你查询一个资源，你得到它的所有字段。很多时候，你只是想要其中的一部分。</li><li id="2d27" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">另一个问题是URL混杂，在REST中，每个资源需要一个URL，当有很多资源时，管理这些URL可能是一个困难的问题。</li><li id="f744" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">因为所有这些，另一个框架<strong class="ih hj"> Graphql </strong>由脸书发明。</li><li id="e600" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">在<strong class="ih hj"> Graphql </strong>中，有一个URL，您编写查询来请求您想要获得的字段。它解决了REST的问题。</li><li id="4842" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">如果你想了解更多关于graphql的信息，请点击 查看<a class="ae jg" href="https://graphql.org/learn/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">。</strong></a></li></ul><h1 id="9430" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">12.丰富</h1><ul class=""><li id="4f62" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated">在这个项目中，一些代码可以抽象为一个基类。在<strong class="ih hj">处理程序</strong>中，基本上它们都做CRUD工作，只有不同的参数和稍微不同的逻辑。</li><li id="de9f" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">如果凝乳工作被抽象为一个基类，代码可能会更干净和简单。</li></ul><h1 id="d8ea" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">13.应该提到一些工具</h1><ul class=""><li id="6fcc" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated"><strong class="ih hj"> Docker </strong>，使用Docker在不同平台上运行项目。</li><li id="5c41" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">Docker-compose ，一个为你提供管理Docker的简单方法的工具。</li><li id="831e" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">Makefile自动编译工具，可以节省你很多时间。</li><li id="0511" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">预提交，在提交之前自动格式化你的代码，它保持你的项目格式良好，在团队工作时特别有用。</li><li id="5b74" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated"><a class="ae jg" href="https://travis-ci.com/" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">travis-ci.com</strong></a>，自动集成平台，推送后可以自动运行你的测试。</li><li id="d7b1" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated"><a class="ae jg" href="http://coveralls.io/" rel="noopener ugc nofollow" target="_blank"/></li><li id="8b7f" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated"><a class="ae jg" href="https://codebeat.co/" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj"/></a>，计算你的代码的复杂程度。</li><li id="d9af" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated"><a class="ae jg" href="https://shields.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> shields.io </strong> </a>，为您的项目提供精美的元数据徽章。你可以简单地把你的GitHub库URL放在空白，它会自动为你生成建议的徽章。</li></ul><h1 id="760d" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">14.一句话</h1><ul class=""><li id="abed" class="if ig hi ih b ii kf ik kg im kh io ki iq kj is it iu iv iw bi translated">这个项目是用Python3.8使用flask-restful框架编码的，你可以把它当作<strong class="ih hj">一个学习web-framework的模板</strong>或者仅仅是一个<strong class="ih hj">开始使用Python编写web项目</strong>。</li><li id="5677" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">我尽量把上面的框架解释清楚，但是如果你发现任何错误或者想改进代码，欢迎你<strong class="ih hj">打</strong><a class="ae jg" href="mailto:hrui835@gmail.com" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">hrui835@gmail.com</strong></a>联系我。</li><li id="6814" class="if ig hi ih b ii jb ik jc im jd io je iq jf is it iu iv iw bi translated">如果<a class="ae jg" href="https://github.com/RuiCoreSci/flask-restful" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">对本项目有帮助，请点击一颗星</strong> </a>。</li></ul><h1 id="afe1" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">保持器</h1><p id="8b7e" class="pw-post-body-paragraph kl km hi ih b ii kf kn ko ik kg kp kq im mk ks kt io ml kv kw iq mm ky kz is hb bi translated"><a class="ae jg" href="https://github.com/ruicore" rel="noopener ugc nofollow" target="_blank"> @RuiCore </a></p><h1 id="ccae" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">贡献的</h1><p id="fd3f" class="pw-post-body-paragraph kl km hi ih b ii kf kn ko ik kg kp kq im mk ks kt io ml kv kw iq mm ky kz is hb bi translated">接受PRs。</p><p id="be4e" class="pw-post-body-paragraph kl km hi ih b ii ij kn ko ik il kp kq im kr ks kt io ku kv kw iq kx ky kz is hb bi translated">小注:如果编辑自述文件，请遵守<a class="ae jg" href="https://github.com/RichardLitt/standard-readme" rel="noopener ugc nofollow" target="_blank">标准-自述文件</a>规范。</p><h1 id="bfc0" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">许可证</h1><p id="47e9" class="pw-post-body-paragraph kl km hi ih b ii kf kn ko ik kg kp kq im mk ks kt io ml kv kw iq mm ky kz is hb bi translated">麻省理工学院2020 ruicore</p></div></div>    
</body>
</html>