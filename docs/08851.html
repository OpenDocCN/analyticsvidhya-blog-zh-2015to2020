<html>
<head>
<title>ML Pipeline</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ML管道</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/ml-pipeline-59f0252ff85?source=collection_archive---------8-----------------------#2020-08-16">https://medium.com/analytics-vidhya/ml-pipeline-59f0252ff85?source=collection_archive---------8-----------------------#2020-08-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bbae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建工作流程并保持数据的可重复性</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/f6eddc31af75d6de728b1aa96dda6af9.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/1*2mpHdzE3EtR-bmtXuR1EUQ.gif"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">图片来源:gifer.com</figcaption></figure><p id="0974" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本帖中，我们将了解什么是管道，为什么它是必不可少的，以及有哪些可用的管道版本。</p><blockquote class="jp jq jr"><p id="92be" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">什么是<strong class="ih hj">管道</strong>，为什么在ml中有必要？</p></blockquote><p id="2046" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于任何机器学习模型，都有必要维护工作流和数据集。对于任何需要重复的过程，比如缺失值的插补、连续变量的缩放、分类变量的编码或文本的计数矢量器。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jw"><img src="../Images/cebb44137e0a9642f3cfda68a31d53fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*SvhJqJfL3fKppWst7IWRIQ.gif"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">图片来源:gify.com</figcaption></figure><p id="4fcf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">流水线</strong>——它帮助我们简化过程，维护我们机器学习模型的执行顺序。该管道可用于将多个步骤整合为一个步骤，以便数据可以通过一系列步骤。因此，流水线将所有步骤连接成一个特定的系统，而不是分别调用上述步骤，增强了可读性和可再现性。</p><h2 id="1148" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">根据sk learn——管道的定义:</h2><blockquote class="jp jq jr"><p id="e9cd" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">顺序应用变换列表和最终估计器。管道的中间步骤必须是“转换”，也就是说，它们必须实现fit和transform方法。最终的估计器只需要实现fit。</p></blockquote><p id="7679" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了创建上述管道，我们可以使用<em class="js"> make_pipeline </em>函数，该函数在最新版本的<strong class="ih hj"> sklearn </strong>库中可用，以前被称为<em class="js">管道</em>(在早期版本中)</p><p id="30bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="js">为什么要走管道</em>？</p><ol class=""><li id="ca40" class="ks kt hi ih b ii ij im in iq ku iu kv iy kw jc kx ky kz la bi translated">每当未知或测试数据进入时，必须以系统的方式执行一系列转换。</li></ol><p id="18d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.当一个不期望的类别进入测试集时。</p><p id="1f78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.当数据集中有缺失值时(测试集和训练集)。</p><p id="2980" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想要处理不同的数据类型，并使它们同步，并且始终遵循顺序，管道是更好的选择。</p><p id="4cd5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将每个转换称为管道中一个名为步骤的<strong class="ih hj">。</strong></p><p id="1e9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来看看make_pipeline和pipeline之间的一些细微差别</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es lb"><img src="../Images/0ab84f99b0709dec68f02a58bc163828.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HBG8n7M-i3ZmZ5ayfwjPRw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">管道和make_pipeline的区别</figcaption></figure><h1 id="5bf0" class="lg jy hi bd jz lh li lj kd lk ll lm kh ln lo lp kk lq lr ls kn lt lu lv kq lw bi translated">Pipeline和make_pipeline的结构:都是元组的形式。</h1><p id="de57" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated">让我们用一个随机的例子来看看他们的符号:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mc"><img src="../Images/23675335394c5a6c8502130ac891f5b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*ZTfb3_zOzu_-3an6t6Qu_Q.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es md"><img src="../Images/22f2be43ba4de7ad5fb3ffc1b1980aa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-tiEh8CbaYrzT_9kD0DIOw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">如果你看到上面的截图，你将能够区分这两者。</figcaption></figure><p id="79ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们进入管道及其转换的更多细节。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es me"><img src="../Images/a8e8d9082682e89ffc4c302b3ede97bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*vgjOINKN_oEs-cT2_WtSFg.gif"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">转型的时候到了——Pic片酬:giphy.com</figcaption></figure><p id="257f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Pipeline引入了它的一个子部分，称为<em class="js">列变压器</em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mf"><img src="../Images/03232695f22a4f5cceece14e5f83d472.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*H6BhqwaNlD8LTtbq2FH9QQ.png"/></div></figure><h2 id="5579" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated"><a class="ae mg" href="https://scikit-learn.org/stable/auto_examples/compose/plot_column_transformer_mixed_types.html" rel="noopener ugc nofollow" target="_blank">管道中的柱形变压器</a>结构</h2><blockquote class="jp jq jr"><p id="6e2c" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">(“转换的名称”，Some_transformer(参数-如果有)，column_name)</p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es mh"><img src="../Images/78a87717cbebdb7d17cc058bf687a29b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-73M6etQLnmK5BLozEh87w.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">仅举一个例子来说明该结构</figcaption></figure><p id="bae0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的定义中，如果我们决定使用Pipeline及其列转换(它需要是显式的),那么转换的名称是强制性的，但是对于make_pipeline及其列转换器(它不是强制性的——它是隐式的)。</p><h2 id="6067" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated"><a class="ae mg" href="https://scikit-learn.org/stable/modules/generated/sklearn.compose.make_column_transformer.html" rel="noopener ugc nofollow" target="_blank">柱式变压器</a>make _ pipeline结构</h2><blockquote class="jp jq jr"><p id="3750" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">(Some_transformer(参数-如果有)，column_name)</p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es mi"><img src="../Images/ccbb38b9985b775d9eabf8931a10e832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bT9wGwnQUl4hy77dTvPccQ.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">仅举一个例子来说明该结构</figcaption></figure><p id="d927" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="js">列转换器</em>:这对于包含<em class="js">异构</em>数据类型的数据集来说特别方便，因为我们可能想要缩放数字特征并一次性编码分类特征。在这里，您可以具体说明哪一列需要什么转换，区分分类列和连续列，以及相应地需要做什么转换。</p><p id="73b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这会将转换器应用于数组或pandas数据框的列。</p><p id="1fbd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="js">列变压器符号</em>:</p><p id="74c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通常它是一个元组的形式</p><h2 id="00ad" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">符号:</h2><p id="5aa4" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated"><code class="du mj mk ml mm b">sklearn.compose.<strong class="ih hj">make_column_transformer</strong></code>(<em class="js">*变形金刚</em>，<em class="js">* *夸格斯</em>)</p><p id="f5c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以上语法取自sklearn库</p><p id="2254" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">柱式变压器的一般流程:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es mn"><img src="../Images/62174af04fbf8138990b089607170efd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IuiX5z-4Sht4TjGa3aM57A.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">柱式变压器的典型流程</figcaption></figure><p id="91b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们也可以通过管道连接到列转换器。</p><p id="4ead" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果涉及到多个流程，我们可以将列转换器传递到管道中，然后将其与列转换器集成，再次将它们与模型管道以及ML算法集成。</p><p id="0c4f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于上述内容，考虑一个场景，其中我们将考虑一个分类列(名义类型),假设此列有缺失值，它需要一个热编码，因此这里通常我们可以首先使用列转换器进行估算，然后传递到管道——再次将此管道对象用于主列转换器(对于一个热编码),然后将其馈送到模型的管道中。(即)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es mo"><img src="../Images/34c85857ba8c06ce6c3712227f11cdd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s-U-yfXj0QzUhadCd2lLtA.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">将列变压器集成到管道，然后再集成到主模型管道</figcaption></figure><p id="0aae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您一定会想到一个问题，为什么我们需要遵循上述场景:</p><p id="c64e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">问题是，当我们在列转换器中同时进行插补和热编码时，输出将有多个列(包括插补和非插补的列),这对于最终管道来说并不理想。因此，遵循上面提到的步骤总是更好的。在我们的示例问题中，我们也会看到这种类型。</p><p id="e7f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="js">需要注意的一点是，除了最后一个步骤之外，管道中包含的所有步骤都应该始终是一个转换器。</em></p><p id="2be8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后一步可以是一个转换器或一个模型，但更有可能是一个模型。</p><h2 id="0113" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">柱式变压器的规格:</h2><p id="6397" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated">也可以从列转换器中检索特征名称。所有的变压器都存储在<em class="js">named _ transformers</em>dictionary属性中。</p><p id="6fd0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们将借助penguin数据集，详细探讨管道和列转换器。</p><p id="91cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下数据集引用自:</p><p id="b28a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae mg" href="https://github.com/allisonhorst/palmerpenguins/blob/master/README.md" rel="noopener ugc nofollow" target="_blank">阿里森霍斯特-帕尔默彭金斯</a></p><p id="7637" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这也可以安装在python3中，或者使用</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mp"><img src="../Images/ed386b72023414d2b7eca46673ae1bf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:518/format:webp/1*IPCR3EZvpjCmzqAQ_wQXhQ.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">Pip安装上面的企鹅数据集库。</figcaption></figure><p id="dbb7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae mg" href="https://scikit-lego.readthedocs.io/en/latest/api/datasets.html#" rel="noopener ugc nofollow" target="_blank">https://sci kit-Lego . readthedocs . io/en/latest/API/datasets . html #</a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mq"><img src="../Images/df816d7819a920e6ea337511b0cd8506.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*xP7uVxmbNZX13-XEWn_PUg.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es mr"><img src="../Images/ab73693b37cdb30493b10c814d498777.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KU-V8tWWQU3nDtw12-bQ_g.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">palmerpenguins art——由@allison_horst创作的艺术品</figcaption></figure><p id="779e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将只看到make_pipeline。确保您的sklearn库已更新。</p><p id="3e95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确保您的版本是最新的—推荐版本为0.22.1以上</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es ms"><img src="../Images/f22138eac5f15e6daea759de8ded7d8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OHwW08_vu3qsA1Ut2nIpew.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">我们这里的目标变量是<strong class="bd jz">物种</strong>，它是多类的。</figcaption></figure><p id="6ed7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们在使用管道进入逻辑回归之前做一个快速的EDA</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es mt"><img src="../Images/e9389b1cf41bcda1c1bb4d8de8209817.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qAQ7FnQbAIbcVtzjC1CW7Q.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mu"><img src="../Images/6fc3b4093fd5dd60d8051ddf22b0c064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*EvtOzTrRmb_YVYCs5smmwQ.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es mv"><img src="../Images/8a3c13460062088838b5f8bf1a144db9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OMCKp-a6RRXoX0cAq7DB8Q.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">从上面可以明显看出，我们的数据集中存在缺失值</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es mw"><img src="../Images/400bf4fd55d4f32b93a595367fbd5f5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nvl3r2G20gptZXQDwXyiXA.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es mx"><img src="../Images/b6ec32df8e1e6f8912f9a385b82aec1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aeFWPSHB3re3b9jP8xHq9A.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es ms"><img src="../Images/691c5c8c87019b464ab768a8dc140a19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jDcwhNGFpwhsY2d_1GkAVw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">在上面的→这里，我们为目标(一个标签编码器)定义了一个函数</figcaption></figure><p id="80f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们进入列转换器部分</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es my"><img src="../Images/6ae26356119faf49fa110b3efdf9f926.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0CfaTPQEtb6gWXx3nd6v5g.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">在上面的示例数据集中，我们将在传递到一个热编码和一个简单的估算器(数值变量的平均值)之前，为我们的名义变量(岛屿和性别)估算常量值</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es mz"><img src="../Images/3cfcfffa97f03b5f7d603e9b66775b5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*82C-ZmZyYkaZ_3pxv7KIrw.png"/></div></div></figure><p id="df2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面imp_ohe →的场景中，里面是什么？？</p><p id="1838" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经建立了一个管道的变压器，首先估算缺失值，然后应用一个热点。现在，我们将该管道添加到<em class="js"> make_column_transformer </em>，添加到我们需要估算缺失值并对其进行一次性编码的列中。</p><p id="970f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面给出的数据集中，<em class="js"> — </em>列<em class="js">性别</em>有缺失值，而<em class="js">岛</em>没有，应用将缺失值归入两者的管道没有关系，因为<em class="js">岛</em>列没有缺失值，我们的目标是对两个标称列进行热编码。</p><p id="973d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里对于上述<em class="js">make _ column _ transformer</em>，对于参数<em class="js">余数</em>我们有以下选项:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es na"><img src="../Images/9dc3985d4867db2f7146003a356bfe12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*PFYhJMAM49ogvRi2EOx17w.png"/></div></figure><p id="6347" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">pro tip for one hot encoder for the parameter—handle _ unknown:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es nb"><img src="../Images/3bf5128faae80e23c74c3cb12595663c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_9Dbi9GcHs7bXgUAu6s45g.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">如果你的模型包含新的类别，用数据重新训练它总是更好</figcaption></figure><p id="1dd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">需要注意的另一点是，您还可以通过切片和切块或者使用regex模式或数据类型来选择列:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es nc"><img src="../Images/d8cc5c044b8a789bdce334817ea525da.png" data-original-src="https://miro.medium.com/v2/resize:fit:618/format:webp/1*_udhNiSRphpkY2n6olXl_g.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">用于选择数字列的切片选项</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es nd"><img src="../Images/39ee062416b07f147f070a59ae495e41.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*KNHn1hpcT1Nfm6sV7O-zOg.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">这种颜色可以用在我们的ct中</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ne"><img src="../Images/a023f97d9fa500fa505c5aae7d34f844.png" data-original-src="https://miro.medium.com/v2/resize:fit:568/format:webp/1*ZiS5gtHUFuMxb8QNSe33ow.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">在上述步骤中使用了上述reg表达模式。</figcaption></figure><p id="3d91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的快照只是为了解释——您可以尝试这些选项并看看。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es nf"><img src="../Images/ba7e55fc1db2ff6dac525c9e9255fa80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oDWfkGDJRLSuYNuWR4p_bg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es ng"><img src="../Images/a4e6fb9e2bd80d31ab096b3551601bfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LW16QxkC_lEzsZKditoGeQ.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">大部分管道都遵循上述步骤</figcaption></figure><p id="d2fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="js">何时使用fit()和fit_transform(): </em></p><p id="401e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一般而言</p><p id="c989" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">I)当使用以模型结束的管道时，fit()方法用于拟合管道，而predict()用于对未知数据进行预测</p><p id="8adf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ii)当管道以变压器结束时。建议使用fit_transform() [对训练数据]，并且只使用transform() [对测试或未知数据]</p><p id="358c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="js">总结:</em></p><p id="f20b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当管道以模型结束时，使用pipe.fit()，当管道以转换器本身结束时，使用pipe.fit_transform()。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es nh"><img src="../Images/dd79b8205e98d58675af1714e0e9e62d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H14PFQg1SNu731rmGOqyzw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">如果您想查看管道内部的对象，您可以只输入管道，然后查看它由什么组成</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es mv"><img src="../Images/97d99231c48f8bc8a0fbb390841faf58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9g8Opxdzyia2WK5aWcSPIw.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es ni"><img src="../Images/6c9593dce55930fb9287449bdd4e96a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*em0ckelfSwUQ48oEadV8lA.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">让我们分开数字和分类来确定重要的特征</figcaption></figure><p id="c32a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，我们已经了解了如何构建和使用管道和柱形变压器，但是突然之间，如果有人想了解模型管道是由什么组成的，那么图表表示将真正有助于最终用户理解。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es nj"><img src="../Images/79b5edcfabdd1c15a4835f9cbafc1226.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*gnLbW72crKaHNLWzvL0PXw.gif"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">鸣谢:谷歌图片</figcaption></figure><p id="3260" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看里面是什么！！⊙▃⊙</p><p id="fcec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">sklearn版本0.23.2中提供了以下模块</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es nk"><img src="../Images/a4d667d27bc75e4613918ce40a5c7bee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yXw-8cQlBG_pCSe63heo-Q.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es nl"><img src="../Images/0801cf3d75fac3016e164f2b96aa6773.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*S1TYoHf2FNW37b3FlSHHSg.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">它将显示我们的管道经历的整个步骤，当我们点击这些SimpleImputer或OneHotEncoder或LogisticRegression时，我们将看到完整的定义及其参数</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es nm"><img src="../Images/0e3c0099717509ca6e1bca36c62d4fe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*ImHfyfW_NcXol6njqifWUQ.png"/></div></figure><p id="3702" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过使用名为<em class="js"> eli5 </em>的库，我们还可以看到重要的变量或特性</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es nn"><img src="../Images/99e1a4c088468c08dca071ae67ca0413.png" data-original-src="https://miro.medium.com/v2/resize:fit:276/format:webp/1*RItpv3HGK4PWNF7V5dIQIw.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es no"><img src="../Images/608e5dd0071d3e8e002d0f0a008383a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lOqqOS174Qwub6-IaQR6Mg.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">上面的代码将给出我们已经构建的管道的重要特性</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mu"><img src="../Images/e2e015fdf694319b95b9782a813bd86f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*PKQSzjViZopv3oRP0_3nSQ.png"/></div></figure><p id="e4dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="js">网格搜索CV </em>和<em class="js">交叉验证</em>来评估我们的模型:</p><p id="a8b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像任何其他ML对象一样，GridSearchCV和交叉验证也可以在管道上执行。让我们看看如何进行:</p><pre class="je jf jg jh fd np mm nq nr aw ns bi"><span id="5737" class="jx jy hi mm b fi nt nu l nv nw"><em class="js"># For parameters to be used in GridSearchCV:<br/># Create a dictionary of all the parameter options </em><br/><em class="js"># Note that: you can access the parameters of steps of a pipeline by using '__’</em></span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es nx"><img src="../Images/f1133cc5aa424352b7ac9dae88d1c5ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wJqfwRjsdsZvodJeNp-tnw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">在将参数输入GridSearchCV之前，请注意参数调整的要点</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es ny"><img src="../Images/6cc36b1c893b7d54c3cf2725005e4d96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z9gsjTdRfJ9fLigxqGdYjA.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">打印GridSearchCV的最佳参数</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es nz"><img src="../Images/c33607a1bcf69ced547c62f1dc9edc98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*183s4PCb18UY9vPeV38_nQ.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es nz"><img src="../Images/4dd07c16eb5385c5f6b1a63f78beceee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Uw1YVaZrtHgl1v8qPUKfw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">在上面的屏幕截图中，我们可以看到cross_val_score中如何利用管道(因为我们的类是多类的，所以我们没有具体给出任何评分)</figcaption></figure><p id="050e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如何使用pickle库导出或保存该模型:</p><p id="90a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">比较<strong class="ih hj"> pickle </strong>和<strong class="ih hj"> joblib </strong>。我建议对scikit-learn对象使用joblib(它对sklearn对象在效率方面更有优势)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es ng"><img src="../Images/182f96834342ba2b521f4cbf132f4278.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v4Irp-_rDgI_zAHu5-M0VQ.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">代替X_test -&gt;任何新的数据集都可以用X_train的相同结构来传递</figcaption></figure><p id="aaf6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以上。<em class="js"> joblib </em>可以在任何其他文件中调用，以便根据其他列值预测企鹅的种类(即预测全新的数据集)。</p><p id="2535" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，我们所看到的用图解描述如下</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es oa"><img src="../Images/cf6c245217dd88ce41acd1c36927bc66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CVczuEsb0kNWSAA3nUp4UA.png"/></div></div></figure><p id="f21d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"><em class="js">imb learn管道快速概述:</em> </strong></p><p id="ccca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有另一个库可供pipeline使用(<strong class="ih hj"> imblearn </strong>)</p><p id="f6fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们不禁会问,<em class="js">我们已经有了sklearn渠道，那为什么还要选择imblearn呢？</em></p><p id="418a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于sklearn管道有一个限制，sklearn的管道只允许将其中的一行转换到另一行(具有不同的或添加的功能)。如果您想要对更多行进行采样(比如增加或减少(过采样、欠采样或SMOTE))，使用sklearn管道是不可能的。</p><p id="eec1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要取消采样，我们需要增加行数。<em class="js">不平衡学习概括了管道</em>，但是试图保持语法和函数名相同:</p><blockquote class="ob"><p id="b56a" class="oc od hi bd oe of og oh oi oj ok jc dx translated"><strong class="ak">从</strong><strong class="ak">imb learn . Pipeline</strong><strong class="ak">导入</strong>管道，make_pipeline</p></blockquote><p id="8234" class="pw-post-body-paragraph if ig hi ih b ii ol ik il im om io ip iq on is it iu oo iw ix iy op ja jb jc hb bi translated"><a class="ae mg" href="https://imbalanced-learn.readthedocs.io/en/stable/generated/imblearn.pipeline.make_pipeline.html" rel="noopener ugc nofollow" target="_blank"> imblearn </a>包包含许多不同的采样器，便于数据的过采样或欠采样。这些采样器<strong class="ih hj">不能</strong>放置在标准<em class="js"> sklearn </em>管道中。为了允许这些采样器使用管道，imblearn包还实现了一个扩展管道。这个管道非常类似于sklearn管道，只是增加了允许采样器。</p><p id="88fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简而言之——如果你想<em class="js">在管道中包含采样器</em>,那么就选择<strong class="ih hj"> imblearn </strong>管道，否则就选择<strong class="ih hj"> sklearn </strong>管道。</p><p id="d1de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意<code class="du mj mk ml mm b">make_pipeline</code>只是一个创建新管道的方便方法，这里的区别实际上在于管道本身。</p><p id="8a5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">总结一下</strong>:</p><p id="414d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a)管道通常可以有多个步骤。</p><p id="eecc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b)它不能有多个算法，一个管道中只允许有一个算法。</p><p id="52ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">c)可以对管道进行网格搜索、交叉验证和超参数调整，但不能在管道中包含这些项目。</p><blockquote class="jp jq jr"><p id="e8e0" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">您可以在这里找到本文中使用的全部代码库— <a class="ae mg" href="https://github.com/NallaperumalK/Data-science-Projects/tree/master/ML%20Pipelines" rel="noopener ugc nofollow" target="_blank"> Github </a> repo，数据集也可以在那里找到。</p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es oq"><img src="../Images/3acc58aa71eb61c559bdc8aab04a30f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/1*LVNH3-RWk7t6eAxp734jaA.gif"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">图片来源:Giphy.com</figcaption></figure><p id="fe92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望本文能帮助您对管道及其功能有一个全面的了解。</p><p id="879c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你喜欢这篇文章，别忘了鼓掌，并在评论中告诉我你对pipeline的看法。</p><p id="3853" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">快乐学习！！！◕ ◡ ◕</p></div></div>    
</body>
</html>