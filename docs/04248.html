<html>
<head>
<title>Using Empirical Bayes Estimation to Define the Best NHL Shooter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用经验贝叶斯估计确定最佳NHL射手</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/using-empirical-bayes-estimation-to-define-the-best-nhl-shooter-e6bda9361d58?source=collection_archive---------12-----------------------#2020-03-11">https://medium.com/analytics-vidhya/using-empirical-bayes-estimation-to-define-the-best-nhl-shooter-e6bda9361d58?source=collection_archive---------12-----------------------#2020-03-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="15b3" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">2019-20常规赛NHL球员的统计分析</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/17ef76e575e1748117d4ff363fe34db7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nfwnt6uxzFLPMWbk"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">格哈德·克劳斯在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="0e99" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">当我们开始分析成功率时，通常会遇到1/1和0/1的情况，即百分之百的成功或百分之零。随着NHL常规赛接近尾声，我问自己，谁是这个赛季的最佳射手。我知道大卫·帕斯特拉克在我写这篇文章的时候已经进了48个球，当我写完这篇文章的时候，他可能已经进了2个球，马修斯和奥韦奇金也是。但是，这些家伙通常有他们的线(一线)，并在游戏中发挥巨大的时间。肯定比任何队友都多。这是有道理的，更好的球员总是打得更多，在曲棍球，篮球，棒球等。带着这个问题，我开始寻找科学理论来作为我判断的基础，至少在我所知的科学没有偏见的地方，不要为布鲁因斯队欢呼，也不要为树叶队或帽子队欢呼。</p><p id="7246" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在我的探索过程中，我看到了<a class="ae jn" href="http://varianceexplained.org/r/empirical_bayes_baseball/" rel="noopener ugc nofollow" target="_blank">这篇</a>大卫·罗宾逊写的关于经验贝叶斯估计的文章。谁描述了如何使用它来提高对每个球员在MLB击球率的期望。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="9159" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">数学背景</h1><p id="92dd" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">该方法在于找到一个符合真实数据的概率密度函数(PDF ),即给定x₁、x₂、…、xₙ的值，有一个带有未知参数θ的函数<em class="lo"> f </em>,它能够以最大的可能性给出x₁、x₂、…、xₙ.的值</p><blockquote class="lp lq lr"><p id="7bcf" class="jo jp lo jq b jr js ij jt ju jv im jw ls jy jz ka lt kc kd ke lu kg kh ki kj hb bi translated">因为θ被假设为未知，我们也把f写成θ的函数。现在，由于f <em class="hi"> ( </em> x₁，x₂，…，xₙ <em class="hi"> |θ) </em>表示当θ为参数的真值时，将观察到值x₁，x₂，…，xₙ的可能性，因此似乎θ的合理估计值将是产生观察值的最大可能性的值。</p></blockquote><p id="24e6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一旦我们要用一个<a class="ae jn" href="https://en.wikipedia.org/wiki/Beta_distribution" rel="noopener ugc nofollow" target="_blank">贝塔分布</a>。所以θ~θ( <em class="lo"> α，β </em> ) <em class="lo">。</em>所以这个想法很简单，用我们在这一季到目前为止的数据去寻找估计量<em class="lo"> α </em>和<em class="lo"> β </em>。最后，我们期望得到一个有序的球员名单，这些球员有更好的标准化投篮命中率。这个新的值列表也被称为<em class="lo">后验</em>密度函数，并且可以被定义为，<em class="lo"> f(θ| </em> x₁，x₂，…，xₙ <em class="lo">，即</em>给定参数<em class="lo"> θ，</em>一个函数<em class="lo"> f </em>，其具有产生<em class="lo"> </em> x₁，x₂，…，xₙ.的最大可能性</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lv lw l"/></div></figure><p id="f261" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是目前联盟中最佳得分手的名单，要注意的是成功率或射门次数。好吧，统计数据告诉我们是的，但是在我们的内心深处，我们知道，它不是。为了调整这一点，我们将使用经验贝叶斯收缩对贝塔先验，这个名字看起来很花哨，但你会发现这很容易。首先，我们收集本赛季所有现役球员的数据。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lv lw l"/></div></figure><p id="f878" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">首先，我们可以通过下面的方法得到本赛季的平均投篮命中率，并以100次投篮为阈值进行过滤，尽管这有点奇怪，但该方法必须能够计算出我们的<em class="lo"> α </em>和<em class="lo"> β </em>。另一种方法可以使用整个数据来拟合PDF，但它们更复杂，我们坚持简单。</p><p id="42a1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，使用r中的<strong class="jq hj"> fitdistplus </strong>软件包，我们将拟合一个可以代表我们数据的密度函数，这次我们将使用beta分布。</p><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="e5b1" class="mc ks hi ly b fi md me l mf mg">fitpdf &lt;- fitdistrplus::fitdist(career$average, “<strong class="ly hj">beta</strong>”, method = “<strong class="ly hj">mle</strong>”)</span></pre><p id="0c16" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后我们就只有<em class="lo"> α </em>和<em class="lo"> β </em>了。</p><p id="b458" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">关于<strong class="jq hj"> fitdistplus </strong>的好处是，如果你绘制对象。它给出了一些其他的图，比如Q-Q，P-P和CDF。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mh"><img src="../Images/695ceb6404404309325bb11d50e71172.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QxaTXIwxE8gM3z_c5VTv_w.png"/></div></div></figure><p id="cd32" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">关注第一个图，我想指出两件事，一旦我们没有大量的数据，我们的PDF就不能完美地拟合。但是现在这是我们最好的选择。第二，我们将尝试将蓝色虚线“推向”红色虚线，也就是说，我们将在PDF的平均值方向上“缩小”这些值。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/caa5ef214fa9db449d5f999c64eebbf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WHV5bTkPSIQACYUtNTUZBw.png"/></div></div></figure><p id="4da6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">要做到这一点，我们只需用每个球员的数据更新PDF 的整体先验<em class="lo">均值。我们已经有了球员数据，PDF的含义有点复杂，我不打算在这里证明，你可以在这里看到<a class="ae jn" href="https://en.wikipedia.org/wiki/Conjugate_prior#Example" rel="noopener ugc nofollow" target="_blank"/>。我们只接受PDF的期望值，定义为E[θ|X₁，X₂，…，Xₙ] = ( <em class="lo"> α /α+β)。</em>新的估计投篮命中率将由下式给出:</em></p><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="11b6" class="mc ks hi ly b fi md me l mf mg">SH% = (Goals + <em class="lo">α</em>)<em class="lo"> </em>/ ( Shots<em class="lo"> + α + β</em>)</span></pre><p id="c6c7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">通过下面的代码，我们可以更新和提取2019-20常规赛NHL的最佳射手。</p><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="ffb5" class="mc ks hi ly b fi md me l mf mg">career_eb &lt;- career %&gt;% <br/>mutate(eb_average = (G + fitpdf$estimate[1]) / (SHOTS + fitpdf$estimate[1] + fitpdf$estimate[2]))</span></pre></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="4668" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">结果</h1><p id="69e4" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">应用上面的方法，我们可以重新排序射手的排名，看看平均发生了什么。需要注意的是，上面的列表中没有一个是图表。那些玩家被“缩小”到PDF的平均水平，离最佳结果很远。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/40ab411a64bf199ae6ee9ce417fbba99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3efEZ6Y84_RTx86b-EC3_A.png"/></div></div></figure><p id="697d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在我们可以看到“收缩”对真实数据的影响。虚线是PDF的均值，实线是x = y，我们可以看到，出手次数多的球员接近连续线，均值没有变化。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/e136b904d60340cf856892465747aadd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ls2Cc8lvgxpVUeyYigHwcQ.png"/></div></div></figure><p id="a77d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这幅图清楚地表明，少数几个事件并不代表事件的平均数。我的意思是，如果你有几次运气好或者运气不好，并不意味着你会一直这样下去。你可以在10次投篮中得5分，在7次击球中击中5次，等等。但是所有的事件都趋向于向平均值移动。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="485c" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">结束语</h1><p id="4857" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">经验贝叶斯估计是一种更精确方法的近似，但由于结果的简单性和准确性，它已被经常使用。在科学媒体中，它已被应用于工程、医学和生物领域。但是这种方法可以用于调整任何事件遵循<a class="ae jn" href="https://en.wikipedia.org/wiki/Binomial_distribution" rel="noopener ugc nofollow" target="_blank">二项式分布</a>的情况。</p><p id="4a20" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">使用R中的<strong class="jq hj">fitdistplus</strong>包，编码被减少到几行，并且可以很容易地完成。最困难的部分是数据争论。</p><p id="3232" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">正如我们所看到的，即使是一个简单的方法也是获得一个好的估计的好方法，没有必要使用更复杂和更难实现的方法。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="b0b0" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">参考</h1><ol class=""><li id="5cc2" class="mj mk hi jq b jr lj ju lk jx ml kb mm kf mn kj mo mp mq mr bi translated">http://varianceexplained.org/r/empirical_bayes_baseball/,于2020年5月3日抵达T4。</li><li id="53d0" class="mj mk hi jq b jr ms ju mt jx mu kb mv kf mw kj mo mp mq mr bi translated">工程师和科学家概率统计导论。<strong class="jq hj">谢尔登·M·罗斯</strong>，学术出版社，2014年。</li></ol></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="a10f" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">感谢</h1><p id="ae20" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">我要感谢quanthockey.com<a class="ae jn" href="https://www.quanthockey.com/" rel="noopener ugc nofollow" target="_blank">的家伙们提供的数据。</a></p></div></div>    
</body>
</html>