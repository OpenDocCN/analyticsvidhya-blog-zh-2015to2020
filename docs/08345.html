<html>
<head>
<title>Movie Recommendation with Collaborative Filtering in Pyspark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pyspark协同过滤的电影推荐</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/movie-recommendation-with-collaborative-filtering-in-pyspark-8385dccecfca?source=collection_archive---------8-----------------------#2020-07-26">https://medium.com/analytics-vidhya/movie-recommendation-with-collaborative-filtering-in-pyspark-8385dccecfca?source=collection_archive---------8-----------------------#2020-07-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/c0300768c189b53f494ed8c568f5c562.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*7x_wVI-ndHoSxU0R0r0JJQ.jpeg"/></div></figure><p id="2c0c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">嘿伙计们，</p><p id="2db8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">今天，我们将探索一种名为“<a class="ae jk" href="https://spark.apache.org/docs/latest/mllib-collaborative-filtering.html" rel="noopener ugc nofollow" target="_blank">带ALS </a>的协同过滤”的酷机器学习算法，它通常用于根据用户和用户对电影的偏好(通过用户给出的评级来判断)推荐电影/歌曲或任何功能。这个算法被许多著名的<a class="ae jk" href="https://en.wikipedia.org/wiki/Collaborative_filtering#Application_on_social_web" rel="noopener ugc nofollow" target="_blank">公司使用，比如Youtube、Reddit、网飞</a>和我。很酷不是吗？</p><p id="6d39" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以基本上，协同过滤模型以userId，item列和ratings列作为特征列，并训练自己为每个用户推荐项目。所以，让我们不要在无聊的理论部分浪费太多时间，直接进入有趣的编码部分。不过，如果你想了解更多关于这个算法的内容，你可以点击这里访问<a class="ae jk" href="https://databricks.com/blog/2014/07/23/scalable-collaborative-filtering-with-spark-mllib.html" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="f4d3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，让我们开始吧！我将使用公开可用的电影数据集，可以在这里找到<a class="ae jk" href="https://grouplens.org/datasets/movielens/" rel="noopener ugc nofollow" target="_blank"/>。因此，首先让我们读取和显示数据。</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="de15" class="ju jv hi jq b fi jw jx l jy jz">ratings = spark.read.option(“inferSchema”,True)\<br/>                    .option(“header”,True)\<br/>                    .csv(“ml-latest-small/ratings.csv”)</span><span id="39e5" class="ju jv hi jq b fi ka jx l jy jz">ratings.show(5)</span></pre><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kb"><img src="../Images/34fb35fdaf3d7be97b66bd21e0f4486c.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*3fxuUGDbcmwYCPgttpgbcQ.png"/></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">电影数据集</figcaption></figure><p id="0091" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，让我们继续前进，启动我们的ALS模型，并将我们的数据集分成两部分进行训练和测试(事实上是80:20的比例)。</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="c93a" class="ju jv hi jq b fi jw jx l jy jz">from pyspark.ml.recommendation import ALS</span><span id="f033" class="ju jv hi jq b fi ka jx l jy jz">als = ALS(maxIter=10, regParam=0.5, userCol="userId", <br/>                      itemCol = "movieId", ratingCol =    "rating", coldStartStrategy = "drop")</span><span id="9514" class="ju jv hi jq b fi ka jx l jy jz">train, test = ratings.randomSplit([0.8, 0.2])</span></pre><p id="c5f3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">简单介绍一下所使用的参数，三个参数userCol、itemCol和ratingCol用于设置功能，maxIter用于ALS将执行的迭代次数(可根据使用情况决定)，regParam指定ALS中的正则化参数(默认值为1.0)，而<a class="ae jk" href="https://spark.apache.org/docs/2.2.0/ml-collaborative-filtering.html#cold-start-strategy" rel="noopener ugc nofollow" target="_blank"> coldStartStrategy </a>表示当运行预测且模型未针对特定用户进行训练/未找到某个用户的评级或项目时，如果给定“drop”作为参数值，它将删除这些用户。</p><p id="dd21" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以，现在让我们训练我们的模型并生成预测。</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="6c3a" class="ju jv hi jq b fi jw jx l jy jz">#Training the Model<br/>alsModel = als.fit(train)</span><span id="a114" class="ju jv hi jq b fi ka jx l jy jz">#Generating Predictions<br/>prediction = alsModel.transform(test)</span><span id="3c7a" class="ju jv hi jq b fi ka jx l jy jz">prediction.show(10)</span></pre><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kg"><img src="../Images/3a97302ad62f56b65310febb6b4809dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*Fx8zb9nASNE0CBiXu8u3JQ.png"/></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">生成的预测</figcaption></figure><p id="cbd0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，有些预测似乎很准确，但有些很糟糕(坦白地说:P)，不管怎样，现在我们的模型已经训练好了，让我们来看看它有多好。</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="b673" class="ju jv hi jq b fi jw jx l jy jz">from pyspark.ml.evaluation import RegressionEvaluator</span><span id="371c" class="ju jv hi jq b fi ka jx l jy jz">evaluator = RegressionEvaluator(metricName="mse", labelCol="rating",  predictionCol="prediction")</span><span id="298a" class="ju jv hi jq b fi ka jx l jy jz">mse = evaluator.evaluate(prediction)</span><span id="d7d6" class="ju jv hi jq b fi ka jx l jy jz">print(mse)</span><span id="f746" class="ju jv hi jq b fi ka jx l jy jz">Output: 1.0168009658367847</span></pre><p id="3b57" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">嗯，精度也不错(没必要一开始就判断模型)。因此，这个模型似乎运行得很好。所以让他给每个用户推荐前3部电影吧。</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="de0a" class="ju jv hi jq b fi jw jx l jy jz">recommended_movie_df = alsModel.recommendForAllUsers(3)</span><span id="13dc" class="ju jv hi jq b fi ka jx l jy jz">recommended_movie_df.show(10, False)</span></pre><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kh"><img src="../Images/1ed036f41c850fdd61d33dada9bed03b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*7JbWimsTEL7R4yZkpcH94g.png"/></div></figure><p id="1cad" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">输出是给每个用户的推荐列表，可以很容易地转换成列。您还可以传递数据集，并通过使用<em class="ki">recommendeforusersubit()</em>函数为其生成建议。</p><p id="cdb8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以，这就是我的观点。希望你会喜欢我的文章，如果有任何建议，请在下面评论。请检查我以前的文章，链接如下:</p><div class="kj kk ez fb kl km"><a rel="noopener follow" target="_blank" href="/analytics-vidhya/spark-delta-lake-d05dd480287a"><div class="kn ab dw"><div class="ko ab kp cl cj kq"><h2 class="bd hj fi z dy kr ea eb ks ed ef hh bi translated">火花三角洲湖</h2><div class="kt l"><h3 class="bd b fi z dy kr ea eb ks ed ef dx translated">火花上的酸以及一些升级。</h3></div><div class="ku l"><p class="bd b fp z dy kr ea eb ks ed ef dx translated">medium.com</p></div></div><div class="kv l"><div class="kw l kx ky kz kv la ik km"/></div></div></a></div><p id="540f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以，下次见，再见，再见！</p></div></div>    
</body>
</html>