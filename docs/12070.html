<html>
<head>
<title>Web Scraping NBA Data with Pandas, BeautifulSoup, and RegEx (Pt. 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用熊猫、BeautifulSoup 和 RegEx (Pt。1)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/web-scraping-nba-data-with-pandas-beautifulsoup-and-regex-pt-1-e3d73679950a?source=collection_archive---------5-----------------------#2020-12-30">https://medium.com/analytics-vidhya/web-scraping-nba-data-with-pandas-beautifulsoup-and-regex-pt-1-e3d73679950a?source=collection_archive---------5-----------------------#2020-12-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/0c347623a2ef34d1f69b1c58cb1f5987.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6gU0pC8eJG21AbCJ.jpg"/></div></div></figure><p id="5e14" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2020-2021 NBA 赛季终于来临了！作为一名崭露头角的数据科学家和长期的 NBA 粉丝，为了庆祝这一重大时刻，我认为从<a class="ae jo" href="https://www.basketball-reference.com/" rel="noopener ugc nofollow" target="_blank"> Basketball-Reference </a>网站收集数据将是一个有趣的做法，该网站拥有所有职业篮球的统计数据，从 NBA 到 WNBA 和 G 联赛。因为我支持华盛顿奇才队(是的，到目前为止这里很艰难，但我们必须保持忠诚😤)，这篇文章的重点将是提取每个奇才球员 2020-2021 年每场比赛的统计数据，以及其他一些个人信息。</p><p id="d5b1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于门外汉来说，网络抓取是从网站中提取和重组数据的过程，通常是为了进行某种最终分析。在这种情况下，我将利用<code class="du jp jq jr js b">requests</code>和<code class="du jp jq jr js b">BeautifulSoup</code>，这两个 Python 库用于访问网站和解析 HTML (Graham Cox 在这里给出了解析<a class="ae jo" href="https://qr.ae/pNJYGd" rel="noopener ugc nofollow" target="_blank">的精彩解释)，以及<code class="du jp jq jr js b">pandas</code>，这是一个 Python 库，允许将信息组织成可操作的数据帧。最后，我将使用<code class="du jp jq jr js b">re</code> Python 库，它为在 Python 中使用</a><a class="ae jo" href="https://www.tutorialspoint.com/python/python_reg_expressions.htm" rel="noopener ugc nofollow" target="_blank">正则表达式</a>提供支持。我将使用正则表达式从每个球员的个人网页 HTML 中提取他们的体重、身高和位置。</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div><figcaption class="jz ka et er es kb kc bd b be z dx translated">首先将这些库导入 Python</figcaption></figure><h1 id="9716" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">提取 2020-21 年奇才队每场比赛的统计数据</h1><p id="31ee" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">现在我已经导入了必要的库，下一步是使用<code class="du jp jq jr js b">requests</code>从指定的 URL 获取数据，将其命名为<code class="du jp jq jr js b">wiz_res:</code></p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="af51" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面的截图显示了 URL 在前端的外观与在后端编写的 HTML 的对比——<code class="du jp jq jr js b">wiz_res</code>的内容现在实际上是 HTML 文本。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lg"><img src="../Images/0860b6f55e83485cdd2c371ab3439e5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sXyUDh5PIosl_fAsJntZ8Q.png"/></div></div></figure><p id="6f18" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，我将使用<code class="du jp jq jr js b">BeautifulSoup</code>通过<code class="du jp jq jr js b">lxml</code>解析器解析内容，将结果对象命名为<code class="du jp jq jr js b">wiz_soup</code>。这将重新构造文本，以便我可以对它运行额外的编码命令。为了将搜索范围缩小到每场比赛的统计数据，我将使用 BeautifulSoup 的<code class="du jp jq jr js b">.find()</code>方法来查找“table”标签，以及“per_game”的 id 属性。通过搜索网页的 HTML 并分析突出显示我感兴趣的表的文本，我找到了合适的标签和属性，如下所示。孤立的“每场比赛”表现在被命名为<code class="du jp jq jr js b">wiz_per_game</code>。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/db3ce6bf12719094d38e10f8035e6287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qp5RCx32_RtlOIHiOjwAmQ.png"/></div></div></figure><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><h1 id="e493" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">为玩家统计创建一个熊猫数据框架</h1><p id="6c05" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">我将通过首先创建一个字典列表来创建这个熊猫数据框架，其中每个玩家都是一个字典，每个键代表一个统计类别，对应的值代表该玩家在该类别中的值。</p><p id="b30e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每个玩家的统计数据在<code class="du jp jq jr js b">wiz_per_game</code>表格中按行划分，如 HTML 中的<code class="du jp jq jr js b">tr</code>(表格行)所示。在<code class="du jp jq jr js b">tr</code>上使用<code class="du jp jq jr js b">.find_all()</code>方法将从每个游戏表中返回所有行的列表。因此，我将在<code class="du jp jq jr js b">wiz_per_game.find_all(‘tr’)[1:]</code>上做一个<code class="du jp jq jr js b">for</code>循环来遍历每一行。循环从第二行开始，因为第一行包含标题。</p><p id="603a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在每次迭代中，我将创建一个<code class="du jp jq jr js b">player</code>字典，并使用<code class="du jp jq jr js b">.find()</code>来收集每个<code class="du jp jq jr js b">player</code>的统计数据，例如姓名、年龄、每场比赛的时间、每场比赛的分数等...一旦添加了所有信息，循环将把<code class="du jp jq jr js b">player</code>追加到<code class="du jp jq jr js b">wiz_stats</code>列表，并迭代到表的下一行。在所有玩家都被添加后，我将把字典列表转换成熊猫数据帧。</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="83a5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行上面的代码应该会输出以下内容:</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/84d06819dd049042017b08a79f204630.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ELsMWcIj4OZl1FkKqWiHtw.png"/></div></div></figure><h1 id="aa7c" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">为 Twitter 句柄创建一个熊猫数据框架</h1><p id="ca08" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">上面的数据框架看起来不错，但我还想包括只在每个球员的个人篮球参考网页上提供的信息。也就是说，我想要玩家的身高、体重、位置和 Twitter 句柄。幸运的是，每个玩家的个人页面的 URL 都包含在他的每场游戏表格的行中。</p><p id="b9b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从 Twitter 开始，我将像以前一样制作相同的字典列表和<code class="du jp jq jr js b">for</code>循环，只是这一次，每次迭代都将把球员的 URL 结尾追加到篮球参考基 URL，并为该球员的网页创建一个新的 GET request/BeautifulSoup 实例。一旦我访问了那个玩家的数据，我将把文本缩小到包含我所关心的信息的部分，并将那个变量命名为<code class="du jp jq jr js b">player_info</code>。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/431cf81136fab7340cb02db8a147ea58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9jez_fcBl55oiloV6QVANw.png"/></div></div><figcaption class="jz ka et er es kb kc bd b be z dx translated">这是我为每个玩家准备的部分</figcaption></figure><p id="868d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Twitter 句柄是超链接的一部分，如上面 russwest44 所示。在<code class="du jp jq jr js b">for</code>循环中，我将使用<code class="du jp jq jr js b">find_all()</code>和<code class="du jp jq jr js b">a</code>来获取<code class="du jp jq jr js b">player_info</code>中所有超链接部分的列表(<code class="du jp jq jr js b">a</code>通常表示 HTML 中的超链接信息)，并将该部分的<code class="du jp jq jr js b">href</code>(超链接的 URL)添加到一个名为<code class="du jp jq jr js b">player_links</code>的新列表中。然后，由于 Twitter 帐户总是列在<code class="du jp jq jr js b">player_links</code>中的第二个 URL，我将把那个 URL 分配给玩家，去掉<code class="du jp jq jr js b"><a class="ae jo" href="https://twitter.com/" rel="noopener ugc nofollow" target="_blank">https://twitter.com/</a></code>，这样只保留玩家的句柄。如果玩家没有列出 Twitter，他将得到一个值<code class="du jp jq jr js b">Not Listed</code>。</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="3cfa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">生成的数据帧如下所示:</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es lk"><img src="../Images/b73760bdcee414bb805e301fbb5396b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:530/format:webp/1*gwwVXwvlAsTSitrMwiHxZA.png"/></div><figcaption class="jz ka et er es kb kc bd b be z dx translated"><code class="du jp jq jr js b">for</code>循环从 12 个不同的 URL(每个玩家一个)自动化了 Twitter 抓取过程，非常简洁</figcaption></figure><p id="f6c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">很好，现在我可以轻松地跟踪我最喜欢的球员的社交媒体了！</p><h1 id="5708" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">为身高、体重和位置创建一个熊猫数据框架</h1><p id="1f35" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">最后，让我们使用正则表达式来获取身高、体重和位置。首先，我将制作另一个字典列表，并使用与上次相同的<code class="du jp jq jr js b">for</code>循环和代码来获取<code class="du jp jq jr js b">player_info</code>。</p><p id="7619" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我将把来自<code class="du jp jq jr js b">player_info</code>的所有段落<code class="du jp jq jr js b">p</code>文本的字符串<code class="du jp jq jr js b">str(player_info.find_all('p'))</code>赋值给变量<code class="du jp jq jr js b">s</code>。<code class="du jp jq jr js b">s</code>现在包含了具有所需高度、重量和位置的字符串。</p><p id="6b68" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<code class="du jp jq jr js b">s</code>上应用来自<code class="du jp jq jr js b">re</code>的<code class="du jp jq jr js b">.search()</code>和<code class="du jp jq jr js b">.group()</code>方法允许我使用正则表达式代码根据 HTML 中的某些字符模式提取文本。在这种情况下，<code class="du jp jq jr js b">.*</code>正则表达式允许从两个已知子字符串之间提取任何字符(<a class="ae jo" href="https://www.rexegg.com/regex-quickstart.html#morechars" rel="noopener ugc nofollow" target="_blank">除了换行符</a>)，其中子字符串放在<code class="du jp jq jr js b">(.*)</code>的两边。</p><p id="26b2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，我知道 HTML 中玩家的体重列在<code class="du jp jq jr js b">\"weight\"&gt;</code>和<code class="du jp jq jr js b">lb&lt;/span&gt;</code>之间，如果仔细观察下面拉塞尔·维斯特布鲁克的<code class="du jp jq jr js b">s</code>输出中的第 8 行，就可以看到这一点。</p><pre class="jt ju jv jw fd ll js lm ln aw lo bi"><span id="be6e" class="lp ke hi js b fi lq lr l ls lt">'[&lt;p&gt;\n&lt;strong&gt;\n&lt;strong&gt;Russell Westbrook III&lt;/strong&gt;\n&lt;/strong&gt;\n    \n  ▪\n  &lt;a href="/friv/twitter.html"&gt;Twitter&lt;/a&gt;:\n  &lt;a href="<a class="ae jo" href="https://twitter.com/russwest44" rel="noopener ugc nofollow" target="_blank">https://twitter.com/russwest44</a>"&gt;russwest44&lt;/a&gt;\n&lt;/p&gt;, &lt;p&gt;\n(The Brodie, Russ, Beastbrook)\n&lt;/p&gt;, &lt;p&gt;\n&lt;strong&gt;\n  Position:\n  &lt;/strong&gt;\n  Point Guard\n\n\n  \n  ▪\n  \n  &lt;strong&gt;\n  Shoots:\n  &lt;/strong&gt;\n  Right\n&lt;/p&gt;, &lt;p&gt;&lt;span itemprop="height"&gt;6-3&lt;/span&gt;,\xa0&lt;span itemprop="weight"&gt;200lb&lt;/span&gt;\xa0(190cm,\xa090kg) &lt;/p&gt;, &lt;p&gt;&lt;strong&gt;Team&lt;/strong&gt;: &lt;a href="/teams/WAS/2021.html"&gt;Washington Wizards&lt;/a&gt;&lt;/p&gt;, &lt;p&gt;\n&lt;strong&gt;Born: &lt;/strong&gt;\n&lt;span data-birth="1988-11-12" id="necro-birth" itemprop="birthDate"&gt;\n&lt;a href="/friv/birthdays.fcgi?month=11&amp;amp;day=12"&gt;November 12&lt;/a&gt;,\n            &lt;a href="/friv/birthyears.fcgi?year=1988"&gt;1988&lt;/a&gt;\n&lt;/span&gt;\n&lt;span itemprop="birthPlace"&gt;\n    in\xa0Long Beach,\xa0&lt;a href="/friv/birthplaces.fcgi?country=US&amp;amp;state=CA"&gt;California&lt;/a&gt;&lt;/span&gt;\n&lt;span class="f-i f-us"&gt;us&lt;/span&gt;\n&lt;/p&gt;, &lt;p&gt;\n&lt;strong&gt;\n    \n      College:\n    \n    &lt;/strong&gt;\n&lt;a href="/friv/colleges.fcgi?college=ucla"&gt;UCLA&lt;/a&gt;\n&lt;/p&gt;, &lt;p&gt;\n&lt;strong&gt;\n    \n      High School:\n    \n    &lt;/strong&gt;\n    \n      Leuzinger in Lawndale, &lt;a href="/friv/high_schools.fcgi?country=US&amp;amp;state=CA"&gt;California&lt;/a&gt;\n&lt;/p&gt;, &lt;p&gt;\n&lt;strong&gt;\n  Draft:\n  &lt;/strong&gt;\n&lt;a href="/teams/OKC/draft.html"&gt;Seattle SuperSonics&lt;/a&gt;, 1st round (4th pick, 4th overall), &lt;a href="/draft/NBA_2008.html"&gt;2008 NBA Draft&lt;/a&gt;\n&lt;/p&gt;, &lt;p&gt;\n&lt;strong&gt;NBA Debut: &lt;/strong&gt;&lt;a href="/boxscores/200810290OKC.html"&gt;October 29, 2008&lt;/a&gt;\n&lt;/p&gt;, &lt;p&gt;\n&lt;strong&gt;\n  Experience:\n  &lt;/strong&gt;\n  12 years\n&lt;/p&gt;]'</span></pre><p id="cd15" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，<code class="du jp jq jr js b">re.search(‘\”weight\”&gt;(.*)lb&lt;/span&gt;’, s).group(1)</code>将输出权重<code class="du jp jq jr js b">200</code>(这里的<code class="du jp jq jr js b">group(0)</code>将输出整个匹配，而不仅仅是<code class="du jp jq jr js b">200</code>)。下面是查找所有巫师玩家的身高、体重和位置的代码:</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="0c3c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是上面代码的输出:</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es lu"><img src="../Images/92fcf129b5fde5e909bd36f4a9a75f4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*2oI1a1H9_38q4LexHvN93Q.png"/></div></figure><h1 id="dcb3" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">将所有内容整合到一个熊猫数据框架中</h1><p id="2451" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">本系列第 1 部分的最后一步是将我浏览过的所有代码合并成一个巨大的<code class="du jp jq jr js b">for</code>循环，如下所示:</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="39e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下是最终的数据框架:</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/9f5da4b4dd68fd7b1a7cdd135bb7b451.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LO-zgd8DLuRA4E2daoZqsw.png"/></div></div></figure><p id="cbad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有了这个整洁的小数据框架，人们可以使用 pandas operations 来挖掘 2020-21 奇才队的深刻趋势和模式。然而，在进行数据分析之前，我们可以使这个项目更加健壮。即将推出—在本系列的第二部分，我将介绍以下内容:</p><ul class=""><li id="631e" class="lw lx hi is b it iu ix iy jb ly jf lz jj ma jn mb mc md me bi translated">扩大数据池，包括所有 NBA 球队的球员</li><li id="3379" class="lw lx hi is b it mf ix mg jb mh jf mi jj mj jn mb mc md me bi translated">创建一个函数，其中用户输入球队名称/年份，该函数输出该赛季特定球队在此帖子中创建的数据帧</li><li id="dc57" class="lw lx hi is b it mf ix mg jb mh jf mi jj mj jn mb mc md me bi translated">玩探索性数据分析😎</li></ul><p id="6f9b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你对我有任何问题，或者发现文章中的错误，请不要犹豫，随时联系我。感谢阅读！</p></div></div>    
</body>
</html>