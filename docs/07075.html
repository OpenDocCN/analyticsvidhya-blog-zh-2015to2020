<html>
<head>
<title>Flutter and Automated Firebase push Notification Complete Integration.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flutter和自动化Firebase推送通知完全集成。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/flutter-and-automated-firebase-push-notification-complete-integration-8377b4fc928b?source=collection_archive---------1-----------------------#2020-06-13">https://medium.com/analytics-vidhya/flutter-and-automated-firebase-push-notification-complete-integration-8377b4fc928b?source=collection_archive---------1-----------------------#2020-06-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/b12f04e77f55a9f212b95090f0a538e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*e4jGUs1O3Q-5AaHRuXk0Ng.png"/></div></figure><p id="2055" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">大家好，今天我们将讨论flutter和firebase推送通知。</p><p id="d505" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因为我一直在做像优步这样的应用程序，所以我遇到了关于推送通知的问题，向可用的司机发送关于位置等的通知。</p><p id="74db" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你需要做的是首先建立一个带有云消息和云firestore的firebase的flutter项目。</p><p id="6610" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">第一步:首先，我们将在电脑中安装firebase功能:</p><ol class=""><li id="d4cc" class="jk jl hi io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated">转到命令提示符，写下:' npm install -g firebase-tools '，并等待它完成。</li><li id="04c2" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">然后写“firebase登录”,你会被提示登录谷歌浏览器，然后从你与firebase关联的账户登录。如果你想从不同的id登录，那么使用:' firebase log in-re auth '其中'—'是双破折号。</li><li id="932b" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">现在用命令创建一个目录:mkdir firebasefunctions</li><li id="6d48" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">现在转到那个目录:“cd firebasefunctions”</li><li id="d6ca" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">现在编写“firebase init函数”并按y键。</li><li id="5cc0" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">现在选择默认的项目，要么新建，要么选择一个现有的项目，在其中集成firebase功能</li><li id="d1c0" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">选择项目后，您会得到两个选项javascript或typescript，选择javascript。</li><li id="cb78" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">然后，它会要求通过npm安装依赖项，按y。这将需要几分钟的时间</li><li id="f05d" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">现在输入“代码”在visual studio代码或您拥有的任何其他ide中打开项目。</li></ol><p id="3917" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你已经成功地在你的电脑上为一个特定的项目安装了firebase函数。</p><p id="e145" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">步骤2:现在，从firebase数据库选项中启用云firestore并创建一个集合，因为我们正在使用虚拟数据进行此操作。您也可以根据需要进行集成，让我们使用虚拟数据来完成此操作:</p><p id="4c98" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">转到firebase控制台，转到数据库，在测试模式下创建firestore DB，然后执行我正在执行的操作:</p><ol class=""><li id="c323" class="jk jl hi io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated">点击“开始收藏”并为收藏命名，报价如下:</li></ol><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es jy"><img src="../Images/513d7be1fb4ed2281ee27e452cb2cb5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JfcI4D1IlhHcIgcEcULkcg.png"/></div></div></figure><p id="814f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">2)在文档id字段中，按下auto-id，然后给出如下字段名，所有字段名都应该相同，以便正确工作并保存，请始终记住字段名应该相同。</p><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es kh"><img src="../Images/8611ebfcff68742bd76682ac04bc8dbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lCT_0pnV1CidxDZ_FMpCRw.png"/></div></div></figure><p id="e269" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">3)现在点击“添加文档”,再次对文档id执行相同的操作，按下auto-id，相同的名称使用不同的数据，始终记住字段名应该相同。</p><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es kh"><img src="../Images/8611ebfcff68742bd76682ac04bc8dbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lCT_0pnV1CidxDZ_FMpCRw.png"/></div></div></figure><p id="640b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">步骤2:现在转到安装firebase的visual studio代码，在firebase文件夹中转到index.js，删除所有代码并复制粘贴以下代码:</p><pre class="jz ka kb kc fd ki kj kk kl aw km bi"><span id="f7c9" class="kn ko hi kj b fi kp kq l kr ks"><strong class="kj hj">const </strong>functions = require(<strong class="kj hj">'firebase-functions'</strong>);<br/><br/><br/><strong class="kj hj">const </strong>admin = require(<strong class="kj hj">'firebase-admin'</strong>);<br/><br/><br/>admin.initializeApp(functions.config().firebase);<br/><strong class="kj hj">var </strong>msgData;<br/><br/><br/>exports.offerTrigger = functions.firestore.document(<br/><strong class="kj hj">'offers/{offerId}'<br/></strong>).onCreate((snapshot,context)=&gt;{<br/><br/>msgData = snapshot.data();<br/><br/>admin.firestore().collection(<strong class="kj hj">'tokens'</strong>).<strong class="kj hj">get</strong>().then((snapshots)=&gt;{<br/><strong class="kj hj">var </strong>tokens = [];<br/><strong class="kj hj">if</strong>(snapshots.empty)<br/>{<br/>console.log(<strong class="kj hj">'No Devices Found'</strong>);<br/>}<br/><strong class="kj hj">else</strong>{<br/><strong class="kj hj">for</strong>(<strong class="kj hj">var </strong>pushTokens <strong class="kj hj">of </strong>snapshots.docs){<br/>tokens.push(pushTokens.data().token);<br/>}<br/><br/><strong class="kj hj">var </strong>payload ={<br/>   <strong class="kj hj">'notification'</strong>:{<br/>         <strong class="kj hj">'title'</strong>: <strong class="kj hj">'From ' </strong>+ msgData.businessType,<br/>         <strong class="kj hj">'body'</strong>: <strong class="kj hj">'Offer is : ' </strong>+ msgData.offer,<br/>         <strong class="kj hj">'sound'</strong>: <strong class="kj hj">'default'</strong>,<br/>       },<br/><strong class="kj hj">'data'</strong>:{<br/>        <strong class="kj hj">'sendername'</strong>: msgData.businessType,<br/>        <strong class="kj hj">'message'</strong>: msgData.offer,<br/>      }<br/>    };<br/><br/><strong class="kj hj">return </strong>admin.messaging().sendToDevice(tokens,    payload).then((response) =&gt; {<br/>       console.log(<strong class="kj hj">'pushed them all'</strong>)<br/>     }).<strong class="kj hj">catch</strong>((err) =&gt; {<br/>           console.log(err);<br/>       });<br/>     }<br/>   });<br/>});</span></pre><p id="6450" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在让我们了解一下这里发生了什么，因为这是设置您的通知系统的主要部分:</p><ol class=""><li id="f645" class="jk jl hi io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated">首先，我们已经初始化了firebase应用程序。</li></ol><pre class="jz ka kb kc fd ki kj kk kl aw km bi"><span id="0774" class="kn ko hi kj b fi kp kq l kr ks">exports.offerTrigger = functions.firestore.document(<br/><strong class="kj hj">'offers/{offerId}'<br/></strong>)</span></pre><p id="0382" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">每当我们添加一个新的文档或数据到我们的offers集合中时，这个方法总是会调用。在集成到您的项目中时，请记住，您必须将集合名称放在这里，集合中的微小变化都会向用户发送通知。</p><pre class="jz ka kb kc fd ki kj kk kl aw km bi"><span id="5356" class="kn ko hi kj b fi kp kq l kr ks">admin.firestore().collection(<strong class="kj hj">'tokens'</strong>).<strong class="kj hj">get</strong>().then((snapshots)=&gt;{<br/><strong class="kj hj">var </strong>tokens = [];<br/><strong class="kj hj">if</strong>(snapshots.empty)<br/>{<br/>console.log(<strong class="kj hj">'No Devices Found'</strong>);<br/>}<br/><strong class="kj hj">else</strong>{<br/><strong class="kj hj">for</strong>(<strong class="kj hj">var </strong>pushTokens <strong class="kj hj">of </strong>snapshots.docs){<br/>tokens.push(pushTokens.data().token);<br/>}<br/><br/><strong class="kj hj">var </strong>payload ={<br/>   <strong class="kj hj">'notification'</strong>:{<br/>         <strong class="kj hj">'title'</strong>: <strong class="kj hj">'From ' </strong>+ msgData.businessType,<br/>         <strong class="kj hj">'body'</strong>: <strong class="kj hj">'Offer is : ' </strong>+ msgData.offer,<br/>         <strong class="kj hj">'sound'</strong>: <strong class="kj hj">'default'</strong>,<br/>       },<br/><strong class="kj hj">'data'</strong>:{<br/>        <strong class="kj hj">'sendername'</strong>: msgData.businessType,<br/>        <strong class="kj hj">'message'</strong>: msgData.offer,<br/>      }<br/>    };<br/><br/><strong class="kj hj">return </strong>admin.messaging().sendToDevice(tokens,    payload).then((response) =&gt; {<br/>       console.log(<strong class="kj hj">'pushed them all'</strong>)<br/>     }).<strong class="kj hj">catch</strong>((err) =&gt; {<br/>           console.log(err);<br/>       });<br/>     }<br/>   });<br/>});</span></pre><p id="ffaa" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，此集合将在令牌节点上工作，不要担心，我们将动态生成令牌，但首先，我们可能会理解此代码，此代码将进入令牌集合并获取所有令牌，如果没有令牌，则不会找到任何设备，否则，如果它找到一个令牌，则它将遍历文档并从中取出一个令牌，现在请理解:</p><p id="721b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">业务类型和报价将从我们创建的报价集合中获取，如下所示:</p><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es kh"><img src="../Images/c622fb3fabec0f46afbbab14a9b59100.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q0pmz6wBKGLhPmg8c8ZiJg.png"/></div></div></figure><p id="74a7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如您所见，business-type和offer与我们的index.js文件中所写的相同。</p><pre class="jz ka kb kc fd ki kj kk kl aw km bi"><span id="8dd6" class="kn ko hi kj b fi kp kq l kr ks"><strong class="kj hj">for</strong>(<strong class="kj hj">var </strong>pushTokens <strong class="kj hj">of </strong>snapshots.docs){<br/>tokens.push(pushTokens.data().token);<br/>}</span></pre><p id="744e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Tokens.push正在将数据添加到令牌数组中。</p><pre class="jz ka kb kc fd ki kj kk kl aw km bi"><span id="f317" class="kn ko hi kj b fi kp kq l kr ks">pushTokens.data().token</span></pre><p id="bf0a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，这里写的“令牌”是文档的字段名，即如果您将令牌密钥保存为MyToken，那么“令牌”将被替换为“MyToken”。</p><pre class="jz ka kb kc fd ki kj kk kl aw km bi"><span id="19e9" class="kn ko hi kj b fi kp kq l kr ks"><strong class="kj hj">var </strong>payload ={<br/>   <strong class="kj hj">'notification'</strong>:{<br/>         <strong class="kj hj">'title'</strong>: <strong class="kj hj">'From ' </strong>+ msgData.businessType,<br/>         <strong class="kj hj">'body'</strong>: <strong class="kj hj">'Offer is : ' </strong>+ msgData.offer,<br/>         <strong class="kj hj">'sound'</strong>: <strong class="kj hj">'default'</strong>,<br/>       },<br/><strong class="kj hj">'data'</strong>:{<br/>        <strong class="kj hj">'sendername'</strong>: msgData.businessType,<br/>        <strong class="kj hj">'message'</strong>: msgData.offer,<br/>      }<br/>    };<br/><br/><strong class="kj hj">return </strong>admin.messaging().sendToDevice(tokens,    payload).then((response) =&gt; {<br/>       console.log(<strong class="kj hj">'pushed them all'</strong>)<br/>     }).<strong class="kj hj">catch</strong>((err) =&gt; {<br/>           console.log(err);<br/>       });<br/>     }<br/>   });<br/>});</span></pre><p id="2dd0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，有效负载是我们希望发送给用户的通知设置数据。</p><p id="64bb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">通知:也应该是一样的，通知将带有标题和正文，它们将在通知上显示给用户。</p><p id="38d0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">数据:这需要谁发送数据以及消息是什么。</p><pre class="jz ka kb kc fd ki kj kk kl aw km bi"><span id="f184" class="kn ko hi kj b fi kp kq l kr ks"><strong class="kj hj">return </strong>admin.messaging().sendToDevice(tokens,    payload).then((response) =&gt; {<br/>       console.log(<strong class="kj hj">'pushed them all'</strong>)<br/>     }).<strong class="kj hj">catch</strong>((err) =&gt; {<br/>           console.log(err);<br/>       });<br/>     }<br/>   });<br/>});</span></pre><p id="1d3c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这部分告诉我们将这个通知推送给集合中所有可用令牌。</p><p id="f068" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在打开cmd，在那里你有你的firebase函数，例如，你已经保存了你的firebase函数在D驱动器，然后去D驱动器和内部地址栏删除所有和写cmd和按下回车键，然后光盘firebase函数后，你在你的地址部署你的firebase函数运行这个命令:</p><p id="fb18" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">firebase deploy-only functions ' where-表示两个破折号，如果您得到一个身份验证错误，则编写此命令' firebase log in-re auth ' where-表示两个破折号。</p><p id="b268" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后转到firebase，检查开发层级下的功能，你会看到一个触发器出现在那里。如果你没有看到，那么你可能已经忘记了上面的步骤。</p><p id="d112" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，让我们转向我们的应用程序，转到main.dart，删除所有代码，并复制粘贴以下代码:</p><pre class="jz ka kb kc fd ki kj kk kl aw km bi"><span id="9612" class="kn ko hi kj b fi kp kq l kr ks"><strong class="kj hj">import 'package:cloud_firestore/cloud_firestore.dart'</strong>;<br/><strong class="kj hj">import 'package:firebase_messaging/firebase_messaging.dart'</strong>;<br/><strong class="kj hj">import 'package:flutter/material.dart'</strong>;<br/><br/><strong class="kj hj">void </strong>main() {<br/>  runApp(MyApp());<br/>}<br/><br/><strong class="kj hj">class </strong>MyApp <strong class="kj hj">extends </strong>StatelessWidget {<br/>  <em class="kt">// This widget is the root of your application.<br/>  </em>@override<br/>  Widget build(BuildContext context) {<br/>    <strong class="kj hj">return </strong>MaterialApp(<br/>      title: <strong class="kj hj">'Flutter Demo'</strong>,<br/>      theme: ThemeData(<br/>        primarySwatch: Colors.<em class="kt">blue</em>,<br/>        visualDensity: VisualDensity.<em class="kt">adaptivePlatformDensity</em>,<br/>      ),<br/>      home: MyHomePage(),<br/>    );<br/>  }<br/>}<br/><br/><strong class="kj hj">class </strong>MyHomePage <strong class="kj hj">extends </strong>StatefulWidget {<br/>  @override<br/>  _MyHomePageState createState() =&gt; _MyHomePageState();<br/>}<br/><br/><strong class="kj hj">class </strong>_MyHomePageState <strong class="kj hj">extends </strong>State&lt;MyHomePage&gt; {<br/>  <strong class="kj hj">final </strong>FirebaseMessaging <strong class="kj hj">firebaseMessaging </strong>= FirebaseMessaging();<br/>  <strong class="kj hj">final _firestore </strong>= Firestore.<em class="kt">instance</em>;<br/>  <strong class="kj hj">final key </strong>= GlobalKey&lt;ScaffoldState&gt;();<br/><br/>  @override<br/>  <strong class="kj hj">void </strong>initState() {<br/>    <strong class="kj hj">super</strong>.initState();<br/>    <strong class="kj hj">firebaseMessaging</strong>.getToken().then((token) {<br/>      saveTokens(token);<br/>    });<br/><br/>  <br/>  }<br/><br/>  Future&lt;<strong class="kj hj">void</strong>&gt; saveTokens(<strong class="kj hj">var </strong>token) <strong class="kj hj">async </strong>{<br/>    <strong class="kj hj">try </strong>{<br/>      <strong class="kj hj">await _firestore</strong>.collection(<strong class="kj hj">'tokens'</strong>).add({<br/>        <strong class="kj hj">'token'</strong>: token,<br/>      });<br/>    } <strong class="kj hj">catch </strong>(e) {<br/>      print(e);<br/>    }<br/>  }<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    <strong class="kj hj">return </strong>Scaffold(<br/>      key: <strong class="kj hj">key</strong>,<br/>      appBar: AppBar(<br/>        title: Text(<strong class="kj hj">'Push Notification'</strong>),<br/>      ),<br/>      body: Center(<br/>        child: Column(<br/>          mainAxisAlignment: MainAxisAlignment.<strong class="kj hj">center</strong>,<br/>          children: &lt;Widget&gt;[],<br/>        ),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="d33c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，在init状态下，我们获取令牌并将其保存到firestore中，同时保存一个新的集合，您只需执行一次即可将您的设备id保存到firestore中。</p><p id="56c2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们运行应用程序，您将看到如下的firestore:</p><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es kh"><img src="../Images/6350df68daea8333db9674bffe27ed72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q4WXCtHirbN76nnhenAhfw.png"/></div></div></figure><p id="1c6d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">令牌集合是用一个与index.js字段相同的令牌字段生成的。</p><p id="3cbd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在复制粘贴初始状态下的代码:</p><pre class="jz ka kb kc fd ki kj kk kl aw km bi"><span id="1545" class="kn ko hi kj b fi kp kq l kr ks">@override<br/>  <strong class="kj hj">void </strong>initState() {<br/>    <strong class="kj hj">super</strong>.initState();<br/><em class="kt">//    firebaseMessaging.getToken().then((token) {<br/>//      saveTokens(token);<br/>//    });<br/><br/>    </em><strong class="kj hj">firebaseMessaging</strong>.configure(<br/>      <em class="kt">//called when app is in foreground<br/>      </em>onMessage: (Map&lt;String, <strong class="kj hj">dynamic</strong>&gt; message) <strong class="kj hj">async </strong>{<br/>        print(<strong class="kj hj">'init called onMessage'</strong>);<br/>        <strong class="kj hj">final </strong>snackBar = SnackBar(<br/>          content: Text(message[<strong class="kj hj">'notification'</strong>][<strong class="kj hj">'body'</strong>]),<br/>          action: SnackBarAction(label: <strong class="kj hj">'GO'</strong>, onPressed: () {}),<br/>        );<br/>        <strong class="kj hj">key</strong>.<strong class="kj hj">currentState</strong>.showSnackBar(snackBar);<br/>      },<br/>      <em class="kt">//called when app is completely closed and open from push notification<br/>      </em>onLaunch: (Map&lt;String, <strong class="kj hj">dynamic</strong>&gt; message) <strong class="kj hj">async </strong>{<br/>        print(<strong class="kj hj">'init called onLaunch'</strong>);<br/>      },<br/>      <em class="kt">//called when app is in background  and open from push notification<br/><br/>      </em>onResume: (Map&lt;String, <strong class="kj hj">dynamic</strong>&gt; message) <strong class="kj hj">async </strong>{<br/>        print(<strong class="kj hj">'init called onResume'</strong>);<br/>      },<br/>    );<br/><br/>  }</span></pre><p id="7662" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们已经注释掉了令牌代码，因为我们已经保存了一个令牌，不再需要它了。</p><p id="da96" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们了解一下配置部分:</p><ol class=""><li id="3a0e" class="jk jl hi io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated">OnMessage:当应用程序在前台时，即用户正在使用应用程序时，调用该方法，因此我们向用户显示某种类型的弹出通知，例如小吃店或对话框或烤面包等。</li><li id="a97b" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">onLaunch:当应用程序被完全销毁时，即它不在后台或完全关闭时，调用该方法，每当通知出现时，应用程序将随之打开。</li><li id="a9d9" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">onResume:当应用程序没有被完全破坏时调用这个方法，也就是说，它在后台，用户没有使用这个应用程序，每当有通知出现时，应用程序就会打开。</li></ol><p id="03f7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Map <string>消息是我们在index.js文件上返回的JSON，即:</string></p><pre class="jz ka kb kc fd ki kj kk kl aw km bi"><span id="f94b" class="kn ko hi kj b fi kp kq l kr ks"><strong class="kj hj">var </strong>payload ={<br/>  <strong class="kj hj">'notification'</strong>:{<br/>    <strong class="kj hj">'title'</strong>: <strong class="kj hj">'From ' </strong>+ msgData.businessType,<br/>    <strong class="kj hj">'body'</strong>: <strong class="kj hj">'Offer is : ' </strong>+ msgData.offer,<br/>    <strong class="kj hj">'sound'</strong>: <strong class="kj hj">'default'</strong>,<br/>  },<br/>  <strong class="kj hj">'data'</strong>:{<br/>    <strong class="kj hj">'sendername'</strong>: msgData.businessType,<br/>    <strong class="kj hj">'message'</strong>: msgData.offer,<br/>  }<br/>};</span></pre><p id="a5e6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是我们在“Map <string dynamic=""> message”参数中得到的JSON。</string></p><p id="8b82" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在转到android文件夹，然后是app，然后是src，然后是main，然后是manifest文件，将这个意图过滤器复制粘贴到activity标签中:</p><pre class="jz ka kb kc fd ki kj kk kl aw km bi"><span id="913c" class="kn ko hi kj b fi kp kq l kr ks">&lt;<strong class="kj hj">intent-filter</strong>&gt;<br/>    &lt;<strong class="kj hj">action android:name="FLUTTER_NOTIFICATION_CLICK" </strong>/&gt;<br/>    &lt;<strong class="kj hj">category android:name="android.intent.category.DEFAULT" </strong>/&gt;<br/>&lt;/<strong class="kj hj">intent-filter</strong>&gt;</span></pre><p id="f1c0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，让我们运行应用程序，看看通知的魔力:</p><ol class=""><li id="ed4e" class="jk jl hi io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated">让我们首先检查我们的应用程序的onMessage状态，即不要退出应用程序并等待收到通知，现在转到Firestore并在offers节点中添加一个新文档。你可能会看到，在你保存文件后的几分钟内，你会收到一个通知，作为你的应用程序中的一个小吃店。</li><li id="ba37" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">现在，让我们让我们的应用程序处于后台状态，以测试我们的onResume方法是否有效，因此按下手机上的home按钮，并在offers collection中再次创建一个文档。你可能会看到，在你保存文件内提供节点，一个通知会出现在你的手机通知栏，当你按下通知，它会去应用程序。</li><li id="4ab4" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">现在，让我们让我们的应用程序处于完全销毁或关闭的状态，以测试我们的on launch方法是否工作，在offers集合中再次创建一个文档。您可能会看到，当您在“优惠”节点中保存文档后，手机的通知栏上会出现一个通知。当您按下通知时，它会转到应用程序。</li></ol><p id="b423" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请记住，在令牌过程中，当您在应用程序中注册用户时，您会保存每个用户的令牌。</p><p id="2700" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">今天就到这里，我们今天已经学习了如何使用firebase推送通知在flutter上发送自动通知。你可以根据自己的需要定制它，它将在uber类型的应用程序或电子商务或用户对用户的聊天应用程序中有用。</p><p id="89e4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是如何使用此类通知的基本设置。我还没有在GitHub中添加index.js，所以从上面我解释index.js代码的地方复制粘贴。</p><p id="94ef" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">留下掌声，如果对你有帮助的话，也跟着我上medium。</p><p id="96c6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">谢谢你。</p><p id="5580" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Github回购链接:</p><div class="ku kv ez fb kw kx"><a href="https://github.com/Mashood97/flutter_push_notification" rel="noopener  ugc nofollow" target="_blank"><div class="ky ab dw"><div class="kz ab la cl cj lb"><h2 class="bd hj fi z dy lc ea eb ld ed ef hh bi translated">mashood 97/flutter _ push _ notification</h2><div class="le l"><h3 class="bd b fi z dy lc ea eb ld ed ef dx translated">新的颤振应用。这个项目是颤振应用的起点。一些资源让你…</h3></div><div class="lf l"><p class="bd b fp z dy lc ea eb ld ed ef dx translated">github.com</p></div></div><div class="lg l"><div class="lh l li lj lk lg ll ik kx"/></div></div></a></div><p id="a4cb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">留下一颗星星，在GitHub ❤上跟随我</p><p id="94d6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">再次感谢你❤</p></div></div>    
</body>
</html>