<html>
<head>
<title>Excel Post-grouping Calculations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Excel 分组后计算</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/excel-post-grouping-calculations-b7525890ce55?source=collection_archive---------43-----------------------#2020-11-30">https://medium.com/analytics-vidhya/excel-post-grouping-calculations-b7525890ce55?source=collection_archive---------43-----------------------#2020-11-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="132b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">介绍一个简单的代码来处理 Excel 分组的难题</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/ee94d1436536dc8fe75d2131491a5fce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XbTtvyFTs9qceqD-eT5MHQ.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">照片由<a class="ae jt" href="https://www.pexels.com/photo/person-holding-blue-and-clear-ballpoint-pen-590022/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae jt" href="https://www.pexels.com/@goumbik?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Lukas </a>拍摄</figcaption></figure><p id="c6d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Excel 支持对数据进行分组和聚合，并提供数据透视表来执行多维分析。但是 Excel 的方法和操作过于简单，无法处理复杂的任务或方便地管理它们。这些任务包括获取每个子集的排名，以及按集合进行过滤和排序。在这篇文章中，我们将给出后分组计算的例子，分析它，并提供 SPL 代码解决方案。SPL(结构化过程语言)是专用数据计算引擎 esProc 使用的语言。用它来处理结构化计算很方便。</p><h1 id="1c3b" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">一、组内排序</h1><p id="9348" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">下面是学生成绩表。我们想得到每个科目的排名。为此，我们需要首先按主题对记录进行分组，然后对每个组进行排序。</p><p id="6abb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是 Excel 数据:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kx"><img src="../Images/8f70ecc51dc35c58e00cce91de6b3051.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/format:webp/0*jU3sQY-r6v6SuQL_.png"/></div></figure><p id="b3dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预期结果:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ky"><img src="../Images/ce769202f009be2c7838870291a37aa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/0*8ExV5GXfy0YeaVLu.png"/></div></figure><p id="20a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SPL 脚本通过剪贴板与 Excel 交互。我们在 esProc designer 中编辑一个 SPL 脚本，将待分析的 Excel 数据粘贴到剪贴板，执行脚本，然后将结果粘贴到 Excel。</p><p id="f467" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SPL 以一种简单的方式提供逐步编码:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kz"><img src="../Images/d736348a30c128602e4cf70bdf35c700.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9MWbthw6nfg_sYJwM7OKSw.png"/></div></div></figure><p id="77c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们只需将结果粘贴到 Excel 中，以获得所需的表格。</p><p id="c0c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要获得仅包含每个科目前 3 分的记录，我们只需使用 top 函数从每个组中获得合格的记录。</p><p id="4839" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预期结果:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es la"><img src="../Images/c05ff76707b79d84f5ead3d1a407a2a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/0*ScJjhCNIPu4qwVXT.png"/></div></figure><p id="d39d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SPL 使用 top 函数获得前 3 名得分的记录:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lb"><img src="../Images/98958e7176689d99c13eadcc92e26284.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WnVf0-y2K5uT1zIOLKx9SA.png"/></div></div></figure><p id="3671" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们只需将结果粘贴到 Excel 中，以获得所需的表格。</p><h1 id="78fd" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">II 按次骨料分类</h1><p id="90d5" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">另一个场景是根据子集合对组进行排序，例如根据学生分数表，根据学生的总分数对学生进行排名。预期结果如下:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lc"><img src="../Images/3a908fee7773408cd8f1878b851de2e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/0*6qhOFnZXKlDm8Mna.png"/></div></figure><p id="86ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，SPL 使用 groups 函数对记录进行分组，同时计算每个组的总数:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kz"><img src="../Images/c98516a09bd8b7cdc920f60b0d936549.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D1xperverg3fGqdrJnLuvw.png"/></div></div></figure><h1 id="b9ce" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">III 组内过滤</h1><p id="ac23" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">这次要找成绩不理想的同学。由于各科考试的难度不同，以不及格来衡量考试是不合适的。相反，我们需要找到那些每科分数低于平均水平的学生。</p><p id="85dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预期结果:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ld"><img src="../Images/c348a3fb58c1f8c7161c5f02492ff9bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/format:webp/0*q_h1piJd3GU-6a0V.png"/></div></figure><p id="ef98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">于是我们把记录按科目分组，计算各科平均分，找出成绩低于平均分的学生。</p><p id="7cb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SPL 剧本:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kz"><img src="../Images/843fd2700f9defeced50f503a5ece79f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*enr2uvJsXUPZ7HYpYJMINA.png"/></div></div></figure><h1 id="03e4" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">IV 按子集合过滤</h1><p id="c355" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">在另一个场景中，我们希望按姓名对记录进行分组，计算每组的总分，并查找总分低于平均总分的学生。</p><p id="3734" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预期结果:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es le"><img src="../Images/334e1ee35b899543850567e16d4b1d0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/0*E32b2Pu8HGm1Y2hE.png"/></div></figure><p id="3b69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了执行一个操作，过滤这里的小计，我们使用 groups 函数来分组记录，计算小计，得到平均总数，并找到符合条件的学生。</p><p id="db81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SPL 剧本:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lf"><img src="../Images/ed6657e210f33641e13c9498f61848e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*roUuEk1inOWzfs7JAQEgqQ.png"/></div></div></figure><h1 id="3757" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">五.组内百分比计算</h1><p id="62b3" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">以下 Excel 表格存储了 2019 年部分国家的 GDP 值。任务是按洲对记录进行分组，并计算每个国家占其洲 GDP 的百分比。</p><p id="ea2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是 2019 年 GDP 表(单位:十亿美元):</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lg"><img src="../Images/30259511a009ff6fb074f0e4a2790e35.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/0*Wnaui-Y-yxSUTRMy.png"/></div></figure><p id="b416" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预期结果:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lh"><img src="../Images/3d467cb17fe944afdc79983ff4fe7a2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/0*25rByv6u4flX9a8Q.png"/></div></figure><p id="c7d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以将记录按区域分组，将各大洲的 GDP 总量相加，然后计算每个国家的 GDP 在每个组中所占的百分比。</p><p id="fefb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SPL 剧本:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kz"><img src="../Images/b3b062336c3fafafc02f46f864dc6910.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2_TcQMGnwRWxKD83Wa6-9g.png"/></div></div></figure><h1 id="7c13" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">VI 计算每组的百分比</h1><p id="2de4" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">我们来看看如何计算各大洲的 GDP 占全球总量的百分比。</p><p id="3564" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预期结果:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es li"><img src="../Images/becfeba8eb6406a5b5fb885d4ab5e3ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/0*QYVw242Crakm0vuW.png"/></div></figure><p id="24ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们还使用 groups 函数对记录进行分组，计算每个大洲的 GDP，然后得到每个大洲的 GDP 在全球总量中所占的百分比。</p><p id="227f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SPL 剧本:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lf"><img src="../Images/23431fd4bd19e4e6d072e0c38f93de19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GxDnUWSmrJoLiQZqvvGLVA.png"/></div></div></figure></div></div>    
</body>
</html>