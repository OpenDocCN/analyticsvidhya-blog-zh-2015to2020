<html>
<head>
<title>Geospatial Analysis of NYC Crime Data with GridDB | GridDB: Open Source Time Series Database for IoT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GridDB | GridDB对纽约市犯罪数据进行地理空间分析:面向物联网的开源时间序列数据库</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/geospatial-analysis-of-nyc-crime-data-with-griddb-griddb-open-source-time-series-database-for-2a80c70ea395?source=collection_archive---------29-----------------------#2020-05-05">https://medium.com/analytics-vidhya/geospatial-analysis-of-nyc-crime-data-with-griddb-griddb-open-source-time-series-database-for-2a80c70ea395?source=collection_archive---------29-----------------------#2020-05-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ebafa3df255a0c290abf0e52aeb0cfbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*saZl-YtGWgD7UrN9.jpeg"/></div></div></figure><p id="a513" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">GridDB Community Edition 4.1和更新版本提供了一种几何数据类型，允许开发人员在他们的应用程序中结合时间序列和地理空间分析。我们之前在关于<a class="ae jo" href="https://griddb.net/en/blog/using-geometry-values-griddb/" rel="noopener ugc nofollow" target="_blank">的文章中讨论过GridDB的几何特性，使用GridDB </a>和<a class="ae jo" href="https://griddb.net/en/blog/geometry-data-application/" rel="noopener ugc nofollow" target="_blank">几何数据应用</a>的几何值。</p><p id="694c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇博文通过查看纽约市的历史犯罪投诉数据，深入研究了几何数据类型的实际用途。该数据提供了所报告犯罪的纬度和经度，因此我们将使用GridDB来查看投诉发生在哪个区域。在演示了如何从纽约市开放数据中获取犯罪数据后，我们将看看中央公园每月的犯罪率有何不同。我们还将通过查看各个辖区的投诉数量来加载外部多边形数据。</p><p id="e404" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将GridDB的几何数据类型用于地理空间数据点的主要目的是能够搜索点、多段线(路径)或多边形(区域)的相交处。使用<a class="ae jo" href="https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry" rel="noopener ugc nofollow" target="_blank">众所周知的文本(WKT) </a>定义点、折线和多边形，这是一种在地图上定义矢量几何对象的标记语言。</p><h1 id="390f" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">吸收</h1><p id="95a6" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我们从纽约市公开数据中获取了历史犯罪数据。下表显示了CSV数据字段和GridDB模式。</p><p id="6643" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">CSV值GridDB架构</p><ul class=""><li id="6d44" class="ks kt hi is b it iu ix iy jb ku jf kv jj kw jn kx ky kz la bi translated">CMPLNT_NUM(唯一ID)</li><li id="b889" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">CMPLNT_FR_DT(投诉日期)</li><li id="7b9a" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">CMPLNT_FR_TM(投诉时间)</li><li id="7fff" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">CMPLNT_TO_DT</li><li id="49ab" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">CMPLNT_TO_TM</li><li id="157b" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">ADDR _百分比_光盘</li><li id="9cb2" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">RPT_DT</li><li id="6b5e" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">KY_CD</li><li id="c630" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">OFNS</li><li id="2398" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">PD_CD</li><li id="36d5" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">PD</li><li id="ca49" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">CPTD的客户关系管理</li><li id="3aea" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">法律_猫_光盘</li><li id="4e38" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">博罗纳米</li><li id="189a" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">DESC发生地点</li><li id="de6a" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">desc TYP PREM</li><li id="96aa" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">DESC朱利斯</li><li id="d09c" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">管辖区_代码</li><li id="a7c2" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">公园_NM</li><li id="7681" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">HADEVELOPT</li><li id="296e" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">住房_PSA</li><li id="d197" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">x坐标CD</li><li id="b0a8" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">y _坐标_CD</li><li id="dbc1" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">SUSP年龄组</li><li id="8e2c" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">SUSP赛跑</li><li id="7a02" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">SUSP _性别</li><li id="244e" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">公交_区</li><li id="ee48" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">纬度(浮点纬度)</li><li id="b9ab" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">经度(浮点经度)</li><li id="30e3" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">拉特隆(拉特隆WKT)</li><li id="18e5" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">巡逻_博罗</li><li id="1f45" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">车站名称</li><li id="c3bd" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">维克年龄组</li><li id="d2c4" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">维克比赛</li><li id="6d4f" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">维克性别</li></ul><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="153e" class="lp jq hi ll b fi lq lr l ls lt">public class Complaint {<br/>    int CMPLNT_NUM;<br/>    Date CMPLNT_FR_DT;<br/>    Date CMPLNT_TO_DT;<br/>    int ADDR_PCT_CD;<br/>    Date RPT_DT;<br/>    int KY_CD;<br/>    String OFNS_DESC;<br/>    int PD_CD;<br/>    String PD_DESC;<br/>    String CRM_ATPT_CPTD_CD;<br/>    String LAW_CAT_CD;<br/>    String BORO_NM;<br/>    String LOC_OF_OCCUR_DESC;<br/>    String PREM_TYP_DESC;<br/>    String JURIS_DESC;<br/>    int JURISDICTION_CODE;<br/>    String PARKS_NM;<br/>    String HADEVELOPT;<br/>    String HOUSING_PSA;<br/>    int X_COORD_CD;<br/>    int Y_COORD_CD;<br/>    String SUSP_AGE_GROUP;<br/>    String SUSP_RACE;<br/>    String SUSP_SEX;<br/>    int TRANSIT_DISTRICT;<br/>    float Latitude;<br/>    float Longitude;<br/>    Geometry Lat_Lon;<br/>    String PATROL_BORO;<br/>    String STATION_NAME;<br/>    String VIC_AGE_GROUP;<br/>    String VIC_RACE;<br/>    String VIC_SEX;<br/>}</span></pre><p id="6b4a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了简单起见，我们只使用一个容器，而不是将数据分成多个容器。</p><p id="70f9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用CSVParser库解析CSV很容易:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="c85c" class="lp jq hi ll b fi lq lr l ls lt">Iterable records = CSVFormat.RFC4180.withFirstRecordAsHeader().parse(in);<br/>   for (CSVRecord record : records) {<br/>        Complaint c = parseCsvRecord(record);<br/>        if(c != null)<br/>            col.put(c);<br/>   }<br/>   col.commit();</span></pre><p id="c26e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">需要在parseCsvRecord函数中对数据进行一些更改。首先，投诉时间是一种非标准但容易解析的格式，如MM/DD/YYYY和HH:MM:SS。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="ca2a" class="lp jq hi ll b fi lq lr l ls lt">String dt[] = r.get("CMPLNT_FR_DT").split("/");<br/>String tm[] = r.get("CMPLNT_FR_TM").split(":");<br/>c.CMPLNT_FR_DT = new Date(Integer.parseInt(dt[2])-1900, Integer.parseInt(dt[0])-1, Integer.parseInt(dt[1]), Integer.parseInt(tm[0]), Integer.parseInt(tm[1]), Integer.parseInt(tm[2]));</span></pre><p id="b8a2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">虽然原始CSV包含“lat lon”中犯罪发生点的WKT文本，但可接受的WKT格式是POINT(x y”)，纬度表示Y轴，经度表示X轴，因此我们翻转它们。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="a007" class="lp jq hi ll b fi lq lr l ls lt">c.Lat_Lon =   Geometry.valueOf("POINT("+c.Longitude+" "+c.Latitude+")");</span></pre><h1 id="ffbf" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">按辖区划分的犯罪</h1><p id="ed06" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">纽约市开放数据中心还提供了WKT各个警区的多边形，可点击此处<a class="ae jo" href="https://data.cityofnewyork.us/Public-Safety/Police-Precincts/78dh-3ptz" rel="noopener ugc nofollow" target="_blank">https://Data . cityofnewyork . us/Public-Safety/Police-Precincts/78dh-3 ptz<br/></a>。与投诉数据一样，使用CSVParser很容易加载该数据，但由于每个辖区可能由多个多边形组成，并且使用WKT多多边形类型，因此需要进行一些进一步的处理，以将多多边形分割成简单的多边形。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="ae82" class="lp jq hi ll b fi lq lr l ls lt">String polys[] = record.get("the_geom").split("\\),");<br/>int count=0;<br/>for(int i=0; i &lt; polys.length; i++) {<br/>    String subpoly = polys[i].replace("MULTIPOLYGON (", "").replace(")))", ")");<br/>    query = col.query("select * where ST_MBRIntersects(Lat_Lon, ST_GeomFromText('POLYGON"+subpoly+")') )");<br/>    rs = query.fetch(false);<br/>    count =+ rs.size();<br/>}</span></pre><p id="3c2e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">结果如下:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="171a" class="lp jq hi ll b fi lq lr l ls lt">Precinct 1: 243         Precinct 52: 888<br/>Precinct 5: 177         Precinct 60: 185<br/>Precinct 6: 216         Precinct 61: n/a<br/>Precinct 71: 227        Precinct 62: 210<br/>Precinct 72: 262        Precinct 63: 324<br/>Precinct 7: 132         Precinct 66: 261<br/>Precinct 9: 233         Precinct 68: 233<br/>Precinct 22: 345        Precinct 69: 220<br/>Precinct 10: 203        Precinct 70: 369<br/>Precinct 13: 400        Precinct 76: 135<br/>Precinct 14: 428        Precinct 77: 334<br/>Precinct 17: 174        Precinct 78: 211<br/>Precinct 20: 132        Precinct 81: 12<br/>Precinct 18: 379        Precinct 83: 498<br/>Precinct 19: 225        Precinct 84: 175<br/>Precinct 23: 225        Precinct 88: 174<br/>Precinct 24: 147        Precinct 90: 290<br/>Precinct 25: 336        Precinct 94: 102<br/>Precinct 79: 266        Precinct 100: 8<br/>Precinct 26: 217        Precinct 101: 0<br/>Precinct 28: 213        Precinct 102: 283<br/>Precinct 30: 206        Precinct 103: 367<br/>Precinct 32: 361        Precinct 104: 511<br/>Precinct 73: 410        Precinct 105: 481<br/>Precinct 33: 152        Precinct 106: 227<br/>Precinct 34: 224        Precinct 107: 294<br/>Precinct 75: 529        Precinct 108: 262<br/>Precinct 40: 444        Precinct 109: 299<br/>Precinct 41: 304        Precinct 110: 431<br/>Precinct 42: 487        Precinct 111: 138<br/>Precinct 43: 408        Precinct 112: 178<br/>Precinct 48: 495        Precinct 113: n/a<br/>Precinct 44: 559        Precinct 114: 28<br/>Precinct 45: 323        Precinct 115: 246<br/>Precinct 46: 400        Precinct 120: 228<br/>Precinct 47: 441        Precinct 121: 194<br/>Precinct 49: 267        Precinct 122: 217<br/>Precinct 50: 219        Precinct 123: 83<br/>Precinct 67: 504</span></pre><h1 id="9d16" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">中央公园</h1><p id="7258" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我们的第一个地理空间分析是逐月观察中央公园的犯罪情况，看看犯罪投诉是否随着温度的变化而增加或减少。由于中央公园没有与南北轴对齐，你不能简单地使用一个边界框(其中lat &gt; min &amp; &amp; lat&lt; max &amp;&amp; lon &gt;min &amp; &amp; lon&lt; max) as you would rudimentary geospatial analysis queries. Instead we can build a polygon of each corner of Central Park and query crime complaints that intersect with that polygon. To find the points of Central Park and build the WKT object a useful tool is <a class="ae jo" href="https://arthur-e.github.io/Wicket/sandbox-gmaps3.html" rel="noopener ugc nofollow" target="_blank">Wicket</a>)。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/f4ec25222b53f2bc0fa0030ed352e167.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LrPROd6Br5iNDKoj.png"/></div></div></figure><p id="50d7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这样，我们就可以构建TQL查询了</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="79ed" class="lp jq hi ll b fi lq lr l ls lt">String CentralParkWKT = "POLYGON((-73.97308900174315 40.764422448981996,-73.98192956265623 40.76812781417226,-73.9584064734938 40.80087951931638,-73.94982340464614 40.797240957024385,-73.97308900174315 40.764422448981996))";<br/><br/>for(int month=0; month &lt;= 11; month++) {<br/>    int count=0;<br/>    for (int year=108; year &lt;= 118; year++) {<br/>        Date start = new Date(year, month, 1);<br/>        Date end = new Date(year, month+1, 1);<br/><br/>	Query query = col.query("select * where ST_MBRIntersects(Lat_Lon, ST_GeomFromText('"+CentralParkWKT+"')) and CMPLNT_FR_DT &gt;= TO_TIMESTAMP_MS("+start.getTime()+")  and CMPLNT_FR_DT &lt; TO_TIMESTAMP_MS("+ end.getTime()+") ");<br/>        RowSet rs = query.fetch(false);<br/>        count += rs.size(); <br/>    }<br/>    System.out.println(month+": "+count);<br/>}</span></pre><p id="261b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在来回答我们最初的问题，犯罪率会随着温度的变化而变化吗？</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="f699" class="lp jq hi ll b fi lq lr l ls lt">January: 30<br/>February: 23<br/>March: 36<br/>April: 33<br/>May: 29<br/>June: 19<br/>July: 26<br/>August: 49<br/>September: 25<br/>October: 23<br/>November: 26<br/>December: 18</span></pre><p id="b053" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">12月和8月的总数会支持这一论点，但1月和6月不一致，因此结果是不确定的。</p><p id="ee11" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您有兴趣进一步探索数据或查看完整的代码，可以在<a class="ae jo" href="https://griddb.net/en/download/26535/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl lv lw gp lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="hb hc hd he hf"><p id="0dd8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mc">原载于2020年5月5日https://griddb.net</em><em class="mc">的</em> <a class="ae jo" href="https://griddb.net/en/blog/geospatial-analysis-of-nyc-crime-data-with-griddb/" rel="noopener ugc nofollow" target="_blank"> <em class="mc">。</em></a></p></div></div>    
</body>
</html>