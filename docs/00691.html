<html>
<head>
<title>AWS DeepRacer — Looking under the hood for design of the reward function and adjusting Hyperparameters</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS DeepRacer —深入了解奖励函数的设计并调整超参数</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/aws-deepracer-looking-under-the-hood-for-design-of-the-reward-function-and-adjusting-e9dd3805ebbf?source=collection_archive---------0-----------------------#2019-08-27">https://medium.com/analytics-vidhya/aws-deepracer-looking-under-the-hood-for-design-of-the-reward-function-and-adjusting-e9dd3805ebbf?source=collection_archive---------0-----------------------#2019-08-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/702393c410c46cd1f44b17f3456b26ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6Y-iZva182T1GmmW.jpg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片鸣谢<a class="ae iu" href="https://pixabay.com/photos/sports-automobiles-driving-vehicles-203007/" rel="noopener ugc nofollow" target="_blank">https://pix abay . com/photos/sports-automobiles-driving-vehicles-203007/</a></figcaption></figure><p id="2f0c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你想亲手编写一个缩小版的自动驾驶汽车来参加比赛吗？→欢迎来到<a class="ae iu" href="https://aws.amazon.com/deepracer/" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj"><em class="jt">AWS Deep-racer</em></strong></a><strong class="ix hj"><em class="jt"/></strong>一个非常创新的概念，向一辆对真实世界一无所知的自动驾驶汽车教授强化学习。</p><p id="78ea" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我参加了一个为期两天的关于<a class="ae iu" href="https://aws.amazon.com/deepracer/" rel="noopener ugc nofollow" target="_blank"> AWS DeepRacer </a>的研讨会，在那里我得到了构建奖励功能的实践培训。该模型在单圈比赛中排名第三，在真实世界中，在真实模型赛道上驾驶真实的AWS Deep-Racer赛车，完成时间为14.17秒！！！(图在最后)</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="3759" class="kd ke hi jz b fi kf kg l kh ki"><strong class="jz hj">Pre-requisite </strong>—  AWS account &amp; some basic understanding of mathematics</span><span id="cfa1" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj">Level </strong>— Novice to intermediate</span><span id="d9bd" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj">Tags </strong>— #machinelearning, #deepracer, #league, #reinforcement</span></pre><p id="d872" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，我想分享我在<strong class="ix hj"> 7大类</strong>中的学习，以便对DeepRacer模型和幕后的机器学习有一个整体的了解。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="fc0a" class="kd ke hi jz b fi kf kg l kh ki"><strong class="jz hj"><em class="jt">1. Basics of reinforcement learning</em></strong></span><span id="615f" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj"><em class="jt">2. Input parameters at your disposal for building the reward function</em></strong></span><span id="cce0" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj"><em class="jt">3. Action Space — Customizing your car and adjust the drive parameters</em></strong></span><span id="9dc7" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj"><em class="jt">4. Default reward function provided by AWS</em></strong></span><span id="fb01" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj"><em class="jt">5. Customize the reward function</em></strong></span><span id="6cb1" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj"><em class="jt">6. The mathematics behind the reward function &amp; Hyperparameters</em></strong></span><span id="0a8b" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj"><em class="jt">7. AWS SageMaker behind the scene that does the heavy lifting</em></strong></span></pre><h1 id="6108" class="kk ke hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">1.<em class="lh">强化学习的基础知识</em></h1><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/7e1929220f27b815e8ea4c1a9e2f77f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EDL8Kqu-5IvsmJ9TFA1Evg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片鸣谢—<a class="ae iu" href="https://pixabay.com/photos/teapots-pots-cook-stove-flame-1858601/" rel="noopener ugc nofollow" target="_blank">https://pix abay . com/photos/teapots-pots-cook-stove-flame-1858601/</a></figcaption></figure><p id="0374" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> <em class="jt">“你会赤手空拳去触摸一把热水壶还是燃烧的火？不，显然不是！！但是你是怎么知道/学会的呢？</em> </strong></p><p id="aee9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在你生命中的某个时刻，你一定被烧伤了，意识到火是热的，所以不要碰它，因为它会给你带来痛苦。你通过获得痛苦或快乐而得到强化，这种强化在记忆中根深蒂固，从而为你提供了一种学习。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="33df" class="kd ke hi jz b fi kf kg l kh ki">Reinforcement learning --&gt;</span><span id="d856" class="kd ke hi jz b fi kj kg l kh ki">If temperature == hot then go_back as it will hurt</span><span id="5d01" class="kd ke hi jz b fi kj kg l kh ki">If temperature == cool then go_forward as it will NOT hurt</span></pre><p id="0034" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是<a class="ae iu" href="https://en.wikipedia.org/wiki/Reinforcement_learning" rel="noopener ugc nofollow" target="_blank">强化学习</a>的症结所在。你奖励令人满意的行为，惩罚令人不快的行为。这也是AWS DeepRacer中奖励功能的基础。T29】</p><p id="a34c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在每一种状态下，机器都会采取一种行动，使其回报随着时间的推移而最大化。它随着时间的推移进行训练，以加强这种学习，从而建立一个模型。然后将该模型应用于现实世界，在现实世界中，强化学习用于确定下一步行动，以最大化奖励值。</p><h1 id="c3e3" class="kk ke hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">2.为构建reward_function输入参数</h1><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/308511803fccde69b8263a8429bd4672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Lgl_UU-L8spWHCwg.jpg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://pixabay.com/photos/helicopter-cockpit-pilot-dashboard-983979/" rel="noopener ugc nofollow" target="_blank">https://pix abay . com/photos/直升机-驾驶舱-飞行员-仪表盘-983979/ </a></figcaption></figure><p id="8a1b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">AWS DeepRacer汽车提供由各种传感器收集的当前状态的实时值。使用这些实时值，您可以对奖励功能进行编程，以启动为当前状态和未来状态提供最高奖励的行动选择过程。</p><p id="e7ba" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">AWS DeepRacer传感器提供的一些输入参数包括:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="1f88" class="kd ke hi jz b fi kf kg l kh ki"><em class="jt"> track_width = </em><strong class="jz hj"><em class="jt">params[‘track_width’]</em></strong><em class="jt"><br/> distance_from_center = </em><strong class="jz hj"><em class="jt">params[‘distance_from_center’]</em></strong><em class="jt"><br/> steering = </em><strong class="jz hj"><em class="jt">abs(params[‘steering_angle’])</em></strong><em class="jt"><br/> direction_stearing=</em><strong class="jz hj"><em class="jt">params[‘steering_angle’]</em></strong><em class="jt"><br/> speed = </em><strong class="jz hj"><em class="jt">params[‘speed’]</em></strong><em class="jt"><br/> steps = </em><strong class="jz hj"><em class="jt">params[‘steps’]</em></strong><em class="jt"><br/> progress = </em><strong class="jz hj"><em class="jt">params[‘progress’]</em></strong><em class="jt"><br/> all_wheels_on_track = track_width = </em><strong class="jz hj"><em class="jt">params[‘track_width’]</em></strong><em class="jt"><br/> distance_from_center = </em><strong class="jz hj"><em class="jt">params[‘distance_from_center’]</em></strong><em class="jt"><br/> steering = </em><strong class="jz hj"><em class="jt">abs(params[‘steering_angle’])</em></strong><em class="jt"><br/> direction_stearing=</em><strong class="jz hj"><em class="jt">params[‘steering_angle’]</em></strong><em class="jt"><br/> speed = </em><strong class="jz hj"><em class="jt">params[‘speed’]</em></strong><em class="jt"><br/> steps = </em><strong class="jz hj"><em class="jt">params[‘steps’]</em></strong><em class="jt"><br/> progress = </em><strong class="jz hj"><em class="jt">params[‘progress’]</em></strong><em class="jt"><br/> all_wheels_on_track = </em><strong class="jz hj"><em class="jt">params[‘all_wheels_on_track’]</em></strong></span></pre><p id="30ae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">输入参数的名称是不言自明的，表明它们为决策提供的值。</p><p id="79d9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有些返回一个<strong class="ix hj">数值</strong>，有些返回一个<strong class="ix hj">布尔值</strong>。</p><p id="061c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，<strong class="ix hj">params[' all _ wheels _ on _ track ']</strong>返回一个布尔值—是或否，而<strong class="ix hj"> params['speed'] </strong>返回一个数值，即汽车的当前速度。</p><p id="ea36" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用这些参数，您可以创建奖励函数；这反过来有助于赛车在赛道上做出决定，转弯，加速，保持在赛道上..以使奖励值最大化。</p><h1 id="83d1" class="kk ke hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated"><strong class="ak"> 3。<em class="lh">行动空间—定制您的汽车并调整驱动参数</em> </strong></h1><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/65f990f5acfb918a16269dc7283d19f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*beX2_287htHpW4gj.jpg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片来源—<a class="ae iu" href="https://pixabay.com/photos/vintage-car-turquoise-interior-852239/" rel="noopener ugc nofollow" target="_blank">https://pix abay . com/photos/vintage-car-turquoise-interior-852239/</a></figcaption></figure><p id="41a4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以选择定制和更改一些关键参数的默认基线值。</p><p id="39ff" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这允许调整转向角度，速度限制和粒度，以建立一个定制的奖励功能。</p><p id="466f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">行动空间包括以下内容:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/4c7d5108cca92154fe7450d324609145.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W2YfY-AY8gviJ4C29pBB6w.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://console.aws.amazon.com/deepracer" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/deepracer</a></figcaption></figure><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="e07b" class="kd ke hi jz b fi kf kg l kh ki"><strong class="jz hj">Maximum steering angle - </strong>The value must be between 0 &amp; 30 degrees</span><span id="2a26" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj">Steering granularity —</strong>      Different angles by which the car can turn</span><span id="efa2" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj">Maximum Speed —</strong>  This goes from 0.8 m/sec all the way up to 8.0 m/sec</span><span id="bf54" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj">Speed granularity - </strong>Can take the values of 1, 2 &amp; 3</span></pre><p id="5404" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这些参数共同定义汽车在动作空间中采取的动作。本质上你得到(<strong class="ix hj">转向角度粒度X速度粒度)</strong>的组合。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/1852dd91b0887cb17a2ff884c0612fee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yVTOIdAgEKgXJ92h22zWGQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://console.aws.amazon.com/deepracer" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/deepracer</a></figcaption></figure><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="2010" class="kd ke hi jz b fi kf kg l kh ki">E.g. 1 — We have 3X2 combination of Steering angle &amp; Speed granularity</span></pre><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/f14c4304825a2ed5b0e05ef28f7a7e1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g3cNWpJfrFo_5WzSffDbAg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://console.aws.amazon.com/deepracer" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/deepracer</a></figcaption></figure><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="39c8" class="kd ke hi jz b fi kf kg l kh ki">E.g. 2 — We have 5X2 combination of Steering angle &amp; Speed granularity</span><span id="18c8" class="kd ke hi jz b fi kj kg l kh ki">Note - There are 5 steering angle --&gt; +- 30, +-15 and ZERO</span></pre><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/9bc4428d8a6a1c34cf61300c0a1e19ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wpzmfrwZ8Ivlgb0tzh7-Ug.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://console.aws.amazon.com/deepracer" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/deepracer</a></figcaption></figure><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="256b" class="kd ke hi jz b fi kf kg l kh ki">E.g. 3 — We increased the speed granularity to 3. So now we have 5 X 3 combinations. </span><span id="5367" class="kd ke hi jz b fi kj kg l kh ki">Note — The speed 1 m/s is repeated for 5 different angle granularity. </span></pre><h1 id="7a3c" class="kk ke hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">4.AWS提供的默认奖励功能</h1><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/598ea992cb3bc5ffeb2ae7112d682cf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*r8GzRbEu5qOFZsYc.jpg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片鸣谢—<a class="ae iu" href="https://pixabay.com/photos/street-road-horizon-endless-238458/" rel="noopener ugc nofollow" target="_blank">https://pix abay . com/photos/street-road-horizon-endless-238458/</a></figcaption></figure><p id="df36" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">AWS提供了一个默认的奖励函数，可以很容易地用来运行模型。重要的是要理解，可以使用输入参数的任意组合来构建奖励函数。</p><p id="53fe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">默认奖励功能→</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="59a2" class="kd ke hi jz b fi kf kg l kh ki">def reward_function(params):<br/> ‘’’<br/> Example of rewarding the agent to follow center line<br/> ‘’’<br/> <br/> # Read input parameters<br/> <strong class="jz hj">track_width</strong> = params[‘track_width’]<br/> <strong class="jz hj">distance_from_center</strong> = params[‘distance_from_center’]<br/> <br/> # Calculate 3 markers that are at varying distances away from the center line<br/> marker_1 = 0.1 * track_width<br/> marker_2 = 0.25 * track_width<br/> marker_3 = 0.5 * track_width<br/> <br/> # Give higher reward if the car is closer to center line and vice versa<br/> if distance_from_center &lt;= marker_1:<br/><strong class="jz hj"> reward = 1.0</strong><br/> elif distance_from_center &lt;= marker_2:<br/><strong class="jz hj"> reward = 0.5</strong><br/> elif distance_from_center &lt;= marker_3:<br/><strong class="jz hj"> reward = 0.1</strong><br/> else:<br/> <strong class="jz hj">reward = 1e-3 # likely crashed/ close to off track</strong><br/> <br/> return float(reward)<br/></span></pre><p id="b7a1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">(注意——网上有许多免费代码资源)</p><p id="e004" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">默认代码使用汽车提供的2个输入参数—</p><ol class=""><li id="52e1" class="ln lo hi ix b iy iz jc jd jg lp jk lq jo lr js ls lt lu lv bi translated"><strong class="ix hj">轨道宽度</strong></li><li id="e224" class="ln lo hi ix b iy lw jc lx jg ly jk lz jo ma js ls lt lu lv bi translated"><strong class="ix hj">距离中心</strong></li></ol><p id="7cc0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果汽车没有偏离中心线太多，这个功能实质上是奖励汽车。如果赛车冲出赛道，该功能还会通过指数减少奖励值来惩罚赛车。</p><p id="39d5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个奖励函数加强了赛车保持在赛道上，因为它的目标是最大化奖励函数。因此，它试图采取行动，增加整体奖励值。</p><h1 id="c8f1" class="kk ke hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated"><em class="lh"> 5。自定义奖励功能</em></h1><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/4d76be1a99eb49b4c812a23573fac2d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4V0qDLin5oHmaYHs.jpg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片来源——pixabay.com</figcaption></figure><p id="efbe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">默认的<a class="ae iu" href="https://hal.archives-ouvertes.fr/hal-00331752v2/document" rel="noopener ugc nofollow" target="_blank">奖励功能</a>运行良好，给出22+秒的圈速来完成标准圈速。</p><p id="3af6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，目标是减少单圈时间。因此，让我们探索如何使用其他参数，并建立一个最佳的奖励函数，以进一步减少单圈时间。</p><p id="9e41" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是我的代码(片段),给出了14.17秒的圈速。奖励功能根据相对于赛道方向的接近角来训练赛车，并确保赛车在整个比赛过程中保持高速。</p><p id="bdd7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">注意-模拟是在50%节气门开度下进行的。在实际比赛中，你可以根据你的模型表现的稳定性选择加大油门。</em></p><p id="cc52" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当汽车没有偏离太多并且保持高速时，我们会奖励它。当奖励偏离太多或低于速度限制时，我们会惩罚或减少奖励。T13】</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="34ec" class="kd ke hi jz b fi kf kg l kh ki">import math<br/>def reward_function(params):<br/>    '''<br/>     '''<br/># Read all input parameters<br/>    track_width = params['track_width']<br/>    distance_from_center = params['distance_from_center']<br/>    steering = abs(params['steering_angle'])<br/>    direction_stearing=params['steering_angle']<br/>    speed = params['speed']<br/>    steps = params['steps']<br/>    progress = params['progress']<br/>    all_wheels_on_track = params['all_wheels_on_track']<br/>    ABS_STEERING_THRESHOLD = 15<br/>    TOTAL_NUM_STEPS = 85<br/>    waypoints = params['waypoints']<br/>    closest_waypoints = params['closest_waypoints']<br/>    heading = params['heading']<br/>--------------------------------------------------------------------    #Set the reward reward_function<br/>    reward = 1<br/> -------------------------------------------------------------------<br/>#Reward if the car completes the track<br/>   if progress == 100:<br/>        reward = reward + 100<br/>-------------------------------------------------------------------<br/>#calculate the current &amp; next waypoints<br/>    prev_point = waypoints[closest_waypoints[0]]<br/>    next_point = waypoints[closest_waypoints[1]]<br/>--------------------------------------------------------------------    <br/>#calculate the direction_steering in radius, arctan2(dy, dx), the result is (-pi, pi) in radians<br/>    track_direction = math.atan2((next_point[1] - prev_point[1]), (next_point[0] - prev_point[0])) <br/>    <br/>#convert to degrees<br/>    track_direction = math.degrees(track_direction)<br/>-------------------------------------------------------------------    <br/># Calculate the difference between the track direction and the heading direction of the car<br/>    direction_diff = abs(track_direction - heading)<br/>    <br/># Penalize the reward if the difference is too large<br/>    DIRECTION_THRESHOLD = 12.0<br/>    SPEED_THRESHOLD = 2.25 <br/>    <br/>    reward_calculator=1<br/>--------------------------------------------------------------------    <br/>    if direction_diff &gt; DIRECTION_THRESHOLD:<br/>        reward_calculator=1-(direction_diff/50)<br/>        if reward_calculator&lt;0 or reward_calculator&gt;1:<br/>            reward_calculator = 0<br/>        reward *= reward_calculator<br/>--------------------------------------------------------------------        <br/># Penalize if the car goes off track        <br/>    if not all_wheels_on_track:<br/>       reward = reward - 1.0<br/>    elif speed &lt; SPEED_THRESHOLD:<br/># Penalize if the car goes too slow<br/>        reward = reward - 2.0<br/>    else:<br/># High reward if the car stays on track and goes fast<br/>        reward = reward + 2.0<br/>--------------------------------------------------------------------    <br/>    return float(reward)</span></pre><p id="0cfb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">(注意——网上有许多免费代码资源)</p><p id="e3b7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里我们利用<strong class="ix hj"> <em class="jt">路点</em> </strong>来确定汽车相对于轨道的当前位置。把<strong class="ix hj"> <em class="jt">路点</em> </strong>想象成赛道上的里程碑坐标。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/25222488aa42059929946865f75517e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*71i0j6mjz4Sc7--urjKG0g.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">培训后奖励图</figcaption></figure><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="563b" class="kd ke hi jz b fi kf kg l kh ki">The reward graph as obtained post training. </span><span id="8474" class="kd ke hi jz b fi kj kg l kh ki">Note — By the look of it, there are too may variations/spikes in the reward graph. </span><span id="fb59" class="kd ke hi jz b fi kj kg l kh ki">A good reward graph should have a steady increasing slope </span></pre><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/dcbafe902e52dea8d152ff04e85e3143.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BrM3_VAYToPkzCaHW6I84A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片来源—<a class="ae iu" href="https://console.aws.amazon.com/deepracer/home?region=us-east-1#createModel" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/deepracer/home?region = us-east-1 # create model</a></figcaption></figure><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="6bc4" class="kd ke hi jz b fi kf kg l kh ki">There are multiple race tracks on which you can train the model. </span><span id="7372" class="kd ke hi jz b fi kj kg l kh ki">Note — Over-fitting may occur when you customize the reward function to perform on a particular track, resulting in sub-optimal performance on other tracks. </span><span id="3dea" class="kd ke hi jz b fi kj kg l kh ki">It is important to keep your model generic so that it can perform on any track.</span></pre><p id="80c8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意——通过可视化性能、分析日志来微调模型，有许多方法可以让您更上一层楼。AWS生态系统提供的选项足以构建一个世界级的模型。</p><h1 id="4161" class="kk ke hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">6.奖励函数背后的数学&amp;超参数</h1><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/127729f655181a18755ac2c800e92c98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sUuiawFD03wxdabN.jpg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片鸣谢—<a class="ae iu" href="https://pixabay.com/illustrations/geometry-mathematics-cube-1023846/" rel="noopener ugc nofollow" target="_blank">https://pix abay . com/illustrations/geometry-mathematics-cube-1023846/</a></figcaption></figure><p id="e6fc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">奖励功能和参数设置是AWS-DeepRacer的前置属性。有一个复杂的数学模型，它在汽车训练的场景后面，然后使用该训练建立一个模型，该模型反过来用于在现实世界中执行。</p><p id="1284" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">汽车训练有三个主要目标—</p><ol class=""><li id="bde1" class="ln lo hi ix b iy iz jc jd jg lp jk lq jo lr js ls lt lu lv bi translated"><strong class="ix hj">最大化奖励函数— </strong>在每一步，学习模型计算奖励值，其目标是需要采取增加奖励值的动作，并避免减少奖励值的动作。</li><li id="0fb1" class="ln lo hi ix b iy lw jc lx jg ly jk lz jo ma js ls lt lu lv bi translated"><strong class="ix hj">行动的概率— </strong>没有奖励函数，所有行动的概率(例如—汽车以所有可能的速度在所有可能的角度向所有方向移动)都是相同的。这将导致汽车处于静止状态，因为所有的动作都有相同的概率。奖励功能有助于增加在特定时刻采取正确行动的可能性。</li><li id="b2f3" class="ln lo hi ix b iy lw jc lx jg ly jk lz jo ma js ls lt lu lv bi translated"><strong class="ix hj">受物理定律束缚</strong> —奖励函数再好，车还是受物理定律束缚。因此，高速急转弯将导致赛车脱离赛道，除非它被计入训练的奖励函数中。</li></ol><p id="7843" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以下是<strong class="ix hj">超参数</strong>列表，您可以根据对幕后数学模型的理解进行更改。建议在不改变和<strong class="ix hj">超参数</strong>的情况下进行初始迭代<em class="jt">，但是当您微调性能时，这些参数会发挥重要作用。</em></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/caa1d7eae9f20a9b76da76e6f65652e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B2zPOniq1bWUFNU94LIFtQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">这是我在https://console.aws.amazon.com/deepracer的模型的真实快照</figcaption></figure><p id="0712" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">(这些参数中的每一个都是单独的主题，在这里，我从较高的层面总结了使用的目的)</p><ol class=""><li id="35e2" class="ln lo hi ix b iy iz jc jd jg lp jk lq jo lr js ls lt lu lv bi translated"><strong class="ix hj"> <em class="jt">梯度下降批量大小— </em> </strong>批量大小决定了考虑多少数据点或<strong class="ix hj">样本大小</strong>来更新训练模型。所以如果总样本空间是1200，批量是120，那么就有1200/120 = 10批。</li><li id="e8a0" class="ln lo hi ix b iy lw jc lx jg ly jk lz jo ma js ls lt lu lv bi translated"><strong class="ix hj">熵</strong> —这是数据中随机性或杂质的度量。由于AWS DeepRacer使用AWS DeepLense，数据可以相当干净，没有随机性。这就是我们使用默认值0.01的原因，这意味着100个数据输入中有1个可能无法对正确的操作进行分类。</li><li id="1a32" class="ln lo hi ix b iy lw jc lx jg ly jk lz jo ma js ls lt lu lv bi translated"><strong class="ix hj">贴现因子</strong> —贴现因子决定未来事件的权重，以便做出当前决策。未来的所有事件都会有所不同，但是，需要考虑的因素有多少是由贴现因子提供的。例如，您今天获得100美元，它将具有100美元的价值，获得100美元(明天-第1天)将具有90美元的价值，折扣系数为0.9，获得100美元(后天-第2天)将具有81卢比的折扣系数，折扣系数为0.9 ( 0.9平方X 100)。</li></ol><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="4d4c" class="kd ke hi jz b fi kf kg l kh ki"> A df( hereby df denotes the discount factor)= 0 means, you do not look ahead; and take an action based on the current state. All future rewards has ZERO significance. </span><span id="5b99" class="kd ke hi jz b fi kj kg l kh ki">A df of 1 means all the future state reward are taken with equal importance to take a current action. All future rewards has EQUAL significance.</span><span id="94aa" class="kd ke hi jz b fi kj kg l kh ki">A df of 0.5 means that next state reward value is considered at 50% of the value. All future rewards DECREASES in significance.</span><span id="f891" class="kd ke hi jz b fi kj kg l kh ki">So the value of df is used to train the model on how much future action consequence needs to be taken into account at the current state. </span><span id="4b57" class="kd ke hi jz b fi kj kg l kh ki">Note - A high discount factor makes the model look further into the future thereby slowing down the training, but it is forward looking, where as low discount factor trains the model quickly as it does not look far into the future, but it may become short-sighted </span></pre><p id="3a1f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> 4。损失类型— </strong>假设你的体重秤总是少了1公斤。所以每当你拿一个重量，你就增加1公斤。这是损失函数的工作。<em class="jt">补偿计算或模型</em>中可能出现的误差。我不建议改变它，除非你精通相同的数学概念，并相应地调整其他参数。</p><p id="b1c0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> 5。学习率— </strong>幕后，梯度下降函数进入画面寻找<strong class="ix hj"> <em class="jt">极大值</em> </strong>(奖励)。学习率是梯度下降的阶跃函数。学习率是您改变参数以检查您是否有奖励函数的<strong class="ix hj"> <em class="jt">最大值</em> </strong>的速率。</p><p id="1f81" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> 6。历元数</strong> —历元表示循环处理训练数据集以更新学习参数的次数。如果您有一个小的训练数据集要处理以获得稳定的结果，请增加历元的数量。较大的数据集具有较小的值以减少训练时间。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="84f7" class="kd ke hi jz b fi kf kg l kh ki">Lets work out with an example</span><span id="65be" class="kd ke hi jz b fi kj kg l kh ki">Total sample size → 1000</span><span id="b5ef" class="kd ke hi jz b fi kj kg l kh ki">Batch size → 5</span><span id="5887" class="kd ke hi jz b fi kj kg l kh ki">Number of batches → 1000/5 = 200</span><span id="773a" class="kd ke hi jz b fi kj kg l kh ki">Epoch → 10</span><span id="ddf3" class="kd ke hi jz b fi kj kg l kh ki">Number of times the sample will be processed → 10 times</span><span id="47fa" class="kd ke hi jz b fi kj kg l kh ki">Total number of batches that will be processed → 200 X 10 = 2000 </span></pre><h1 id="ac25" class="kk ke hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated"><strong class="ak"> <em class="lh"> 7。AWS SageMaker幕后做重活</em> </strong></h1><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3bacec7b96262b0326391d5b01e0a253.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*k8FdLNgfPGK4h8UA.jpg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片鸣谢—<a class="ae iu" href="https://pixabay.com/photos/men-trail-running-trail-ultratrail-1245982/" rel="noopener ugc nofollow" target="_blank">https://pix abay . com/photos/men-trail-running-trail-ultra trail-1245982/</a></figcaption></figure><p id="085a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">DeepRacer的所有机器学习都是由<a class="ae iu" href="https://aws.amazon.com/sagemaker/" rel="noopener ugc nofollow" target="_blank"> AWS SageMaker完成的。</a></p><p id="9895" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将处理所有的训练数据，以便为DeepRacer汽车构建在现实世界中运行的模型。AWS SageMaker 负责模型的构建→培训→部署。</p><p id="1687" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦构建了模型，就可以将其导出到边缘设备并进行部署。</p><p id="7ff3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，在我们的案例中，一旦模型构建完成，我们就可以下载模型&amp;通过USB驱动器将模型部署到DeepRacer汽车上并运行。</p><blockquote class="me mf mg"><p id="b94f" class="iv iw jt ix b iy iz ja jb jc jd je jf mh jh ji jj mi jl jm jn mj jp jq jr js hb bi translated">AWS SageMaker通过提供基础设施和处理复杂机器学习模型所需的大量计算，打开了处理复杂机器学习模型的大门。</p><p id="de39" class="iv iw jt ix b iy iz ja jb jc jd je jf mh jh ji jj mi jl jm jn mj jp jq jr js hb bi translated"><strong class="ix hj"> <em class="hi">通过应用强化学习和利用AWS SageMaker进行建模，您可以想到哪些用例来解决业务问题？</em>T3】</strong></p></blockquote><p id="3484" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">活动部分图片→</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/d4858b10f4cb1281156c533670c2a97c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z6rtUNrtKcebswcEw7j-mw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">AWS深赛车</figcaption></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/8610af2167fa44b9b641565e6e195c29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hldCeYh4zoJ0yxyNSO-vkQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">AWS DeepRacer汽车，摄像头在前面</figcaption></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/80a208499ac77d6a00114a46f7515837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IuVqtvfNsnth4rrdgseySw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">AWS DeepRacer汽车引擎盖下</figcaption></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/c5d57831058c3778a9d019e78fe70f68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bYmTPnTM1CrO7X9Q2einGw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">AWS DeepRacer赛道</figcaption></figure><p id="2712" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢阅读。随时欢迎反馈和问题！这篇博客是根据我对数据科学和分析的巨大世界的有限理解而写的。感谢AWS团队组织此次研讨会。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="45dc" class="kd ke hi jz b fi kf kg l kh ki">For further reading — Please visit AWS for DeepRacer, and look up <br/>Machine Learning or AI on Google.</span><span id="844b" class="kd ke hi jz b fi kj kg l kh ki"><a class="ae iu" href="https://docs.aws.amazon.com/deepracer/latest/developerguide/deepracer-console-train-evaluate-models.html#deepracer-reward-function-signature" rel="noopener ugc nofollow" target="_blank">https://docs.aws.amazon.com/deepracer/latest/developerguide/deepracer-console-train-evaluate-models.html#deepracer-reward-function-signature</a></span><span id="8e87" class="kd ke hi jz b fi kj kg l kh ki"><a class="ae iu" href="https://ai.google/" rel="noopener ugc nofollow" target="_blank">https://ai.google/</a></span><span id="11a8" class="kd ke hi jz b fi kj kg l kh ki"><a class="ae iu" href="https://mml-book.github.io/book/mml-book.pdf" rel="noopener ugc nofollow" target="_blank">https://mml-book.github.io/book/mml-book.pdf</a></span></pre></div></div>    
</body>
</html>