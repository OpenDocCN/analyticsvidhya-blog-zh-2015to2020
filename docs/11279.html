<html>
<head>
<title>Churn Report in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫的流失报告</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/churn-report-in-pandas-94a461e50014?source=collection_archive---------6-----------------------#2020-11-27">https://medium.com/analytics-vidhya/churn-report-in-pandas-94a461e50014?source=collection_archive---------6-----------------------#2020-11-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="60fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我在熊猫帖子中的<a class="ae jd" rel="noopener" href="/analytics-vidhya/sales-report-in-pandas-c4ef777cc490">销售报告的延续，它从其中的最终表格开始。这是给一个随机顾客的。</a></p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="c332" class="jn jo hi jj b fi jp jq l jr js">report[report['CustomerID'] == 12347.0]</span></pre><figure class="je jf jg jh fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es jt"><img src="../Images/69bc9a2adf92859ebb07fef4bb753c20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2FvFmvo8Mm8U95Gzx0LHeQ.png"/></div></div></figure><p id="5332" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它表示该特定客户在整个可用日期范围内的活动，按月汇总。可以看出这个活动并不规律。</p><p id="d28e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我想添加一个标志，表明客户在上个月是否活跃。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="8884" class="jn jo hi jj b fi jp jq l jr js">report['active_prev'] = (report.sort_values(by=['month'], ascending=True)<br/>.groupby(['CustomerID'])['active'].shift(1))</span></pre><p id="97b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个硬东西有点像sql中的窗口函数。因为我有很多顾客，所以我必须以某种方式对熊猫说，它们应该被分开对待，这就是groupby的目的。我也希望月份是有序的，这就是sort_values的作用。最后，shift给出前一行的值(在本例中为月份)。检查一下。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="2aef" class="jn jo hi jj b fi jp jq l jr js">report[report['CustomerID'] == 12347.0]</span></pre><figure class="je jf jg jh fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kb"><img src="../Images/5882851a972064de44cb987013c40de2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mQwVZNUfxycykFyONKvrKg.png"/></div></div></figure><p id="1259" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正确。将活动列与active_prev进行比较。现在，我想了解客户何时从活跃变为不活跃，反之亦然。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="552b" class="jn jo hi jj b fi jp jq l jr js">report['change_status'] = (report['active'] != report['active_prev']) * 1</span><span id="c24c" class="jn jo hi jj b fi kc jq l jr js">report[report['CustomerID'] == 12347.0]</span></pre><figure class="je jf jg jh fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kd"><img src="../Images/38285725266287df9a09f353cba1e0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yodCsmux7c89UD9HXLoXcA.png"/></div></div></figure><p id="24fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看起来不错。接下来，我想为每个状态更改分配某种id。这里有一个非常巧妙的累积求和技巧。查看change_status列。如果我对这一列执行累积求和，那么每当用户改变状态时，我都会得到一个增量。这就是我想要的。我再次使用这个可怕的结构，因为我想让熊猫分别对待每个用户。</p><figure class="je jf jg jh fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es ke"><img src="../Images/530084ff2c780142086cd82173b88501.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0yoHu2nt_RnTai-npkuUmw.png"/></div></div></figure><p id="442b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太完美了。查找id为2的会话。您能看出这是客户两个月没有活动的会话吗？现在，我可以合计每个用户和每个会话的非活动月数。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="47e2" class="jn jo hi jj b fi jp jq l jr js">report['inactive'] = (report['active'] == 0) * 1</span><span id="43d5" class="jn jo hi jj b fi kc jq l jr js">report['month_inactive'] = (report.sort_values(by=['month'], ascending=True)<br/>.groupby(['CustomerID','session_id'])['inactive'].cumsum())</span><span id="c75e" class="jn jo hi jj b fi kc jq l jr js">report[report['CustomerID'] == 12347.0]</span></pre><figure class="je jf jg jh fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kf"><img src="../Images/ca1ed307e2c21f8800b99eee4eb1ad7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wUd5T8duhBQi4lZALPXQ6g.png"/></div></div></figure><p id="1c15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看第四排。在month_inactive列中，我们得到客户不活动的正确月数。用你的眼睛检查一下。而且对整个表都是正确的)。</p><p id="797d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们来计算度量。Say两个月或更长时间处于流失状态的用户数量。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="e5c4" class="jn jo hi jj b fi jp jq l jr js">report['churn_2m'] = (report['month_inactive'] &gt;= 2) * 1</span><span id="05f1" class="jn jo hi jj b fi kc jq l jr js">report[report['CustomerID'] == 12347.0]</span></pre><figure class="je jf jg jh fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kg"><img src="../Images/a5e1a79d594ee1b4442a5f6ca39293f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9wLXzLlGwOM4si62y74I3A.png"/></div></div></figure><p id="d681" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看起来不错。现在groupby每月获取所有客户的信息。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="52b9" class="jn jo hi jj b fi jp jq l jr js">t = report.groupby('month')[['revenue','user','new','active','churn_2m']].agg('sum')</span><span id="05a2" class="jn jo hi jj b fi kc jq l jr js">t</span></pre><figure class="je jf jg jh fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kh"><img src="../Images/1d7004711a46edcc57339c23c8cfe993.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_XrUMg5D8GVjo8UjUhRiKw.png"/></div></div></figure><p id="fc67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你也可能想得到10%的分数.分母的选择取决于你制造客户的方法。在这里，我将只使用每个月的当前用户数。但它可能是上个月甚至第二个月的用户数，因为我们测量的是两个月的客户流失。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="8ea4" class="jn jo hi jj b fi jp jq l jr js">t['churn_2m%'] = t['churn_2m'] / t['user']</span><span id="327d" class="jn jo hi jj b fi kc jq l jr js">t</span></pre><figure class="je jf jg jh fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es ki"><img src="../Images/dcf1d301857037af3af1870e26a10553.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U5ZUWt3yT3gY75D5gfMVCQ.png"/></div></div></figure><p id="ff42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">多酷啊。)</p><p id="c4d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是Colab笔记本整个项目(销售+流失)<a class="ae jd" href="https://colab.research.google.com/drive/1TwivVdUbavTO2aIWBBDlFEUPvF74PwU-#scrollTo=2sC3zrxjRj8c" rel="noopener ugc nofollow" target="_blank">https://Colab . research . Google . com/drive/1 twivvdubavto 2 aiwbbdlfeupvf 74 pwu-# scroll to = 2s C3 zrxjrj 8 c</a></p><p id="0df5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您的阅读。也可以在https://www.glebmikhaylov.com/的<a class="ae jd" href="https://www.glebmikhaylov.com/" rel="noopener ugc nofollow" target="_blank">和我的YouTube频道</a><a class="ae jd" href="https://www.youtube.com/channel/UCLdAnxmoGVySnh691CwDz9Q" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/channel/UCLdAnxmoGVySnh691CwDz9Q</a>找到我。</p></div></div>    
</body>
</html>