<html>
<head>
<title>Trigger AWS Lambda Function to Store Audio from API in S3 Bucket</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">è§¦å‘AWS Lambdaå‡½æ•°ä»¥å°†æ¥è‡ªAPIçš„éŸ³é¢‘å­˜å‚¨åœ¨S3æ¡¶ä¸­</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/analytics-vidhya/trigger-aws-lambda-function-to-store-audio-from-api-in-s3-bucket-b2bc191f23ec?source=collection_archive---------9-----------------------#2020-07-02">https://medium.com/analytics-vidhya/trigger-aws-lambda-function-to-store-audio-from-api-in-s3-bucket-b2bc191f23ec?source=collection_archive---------9-----------------------#2020-07-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c0b1ed7fd19e2cfe539dbcaa1f7b545f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NDkk0VvLQ_ydzTCd"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">ç”±<a class="ae iu" href="https://unsplash.com/@alesnesetril?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Ales Nesetril </a>åœ¨<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>æ‹æ‘„çš„ç…§ç‰‡</figcaption></figure><p id="aae5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">è¿™æ˜¯ä¸€ä¸ªæ•™ç¨‹ï¼Œæˆ‘å°†å±•ç¤ºå½“æˆ‘ä»¬åœ¨S3æ¡¶ä¸­ä¸Šä¼ éŸ³é¢‘APIå¹¶å°†éŸ³é¢‘å­˜å‚¨å›S3æ¡¶æ—¶ï¼Œå¦‚ä½•è§¦å‘lambdaå‡½æ•°ã€‚</p><p id="de16" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">æˆ‘è·å–çš„éŸ³é¢‘æ¥è‡ªTwilio recordingï¼Œé€šè¿‡HTTP GETè°ƒç”¨Recordings APIèµ„æºã€‚</p><p id="9a3f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬å°†éŸ³é¢‘APIç»†èŠ‚å­˜å‚¨åœ¨ä¸€ä¸ªCSVæ–‡ä»¶ä¸­ã€‚æˆ‘ä½¿ç”¨æˆ‘çš„CSVæ–‡ä»¶<em class="jt">(åä¸ºcall _ record _ success _ details)</em>ä¸­çš„ä¸¤åˆ—æ¥å½¢æˆå®Œæ•´çš„APIï¼Œå¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥å°†å®Œæ•´çš„APIå­˜å‚¨åœ¨ä¸€åˆ—ä¸­ã€‚</p><p id="8ac8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">å…¶æ¬¡ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªS3æ¡¶<em class="jt">(åä¸ºaudioproduct123 ) </em>ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­å­˜å‚¨æ–‡ä»¶ï¼Œè®¾ç½®ä¸€ä¸ªäº‹ä»¶ï¼Œè¿™æ ·ä¸€æ—¦æˆ‘ä»¬ä¸Šä¼ CVSæ–‡ä»¶ï¼Œå®ƒå°±ä¼šä»æ–‡ä»¶ä¸­è·å–APIå¹¶è§¦å‘lambdaå‡½æ•°ã€‚</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div class="er es ju"><img src="../Images/afeca239fe5ee96d1b9d2c03c8f0766b.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*0ozb8bHM270jnm2iStEDwQ.png"/></div></figure><p id="89c3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ç„¶åï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªLambdaå‡½æ•°<em class="jt"> ( audioconvert-s3 ) </em>ï¼Œå®ƒå°†è¯»å–CSVæ–‡ä»¶ï¼Œä»APIè·å–è¯¦ç»†ä¿¡æ¯ï¼Œè½¬æ¢APIä¸­å­˜å‚¨çš„éŸ³é¢‘ï¼Œå¹¶å°†å…¶ä¸Šä¼ åˆ°s3æ¡¶ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªpythonåº“<em class="jt">è¯·æ±‚</em>å’Œ<em class="jt"> Scipyã€‚</em>æœ‰è¶£çš„æ˜¯lambdaå‡½æ•°ä¸­åŒ…å«Scipyåº“ï¼Œæˆ‘ä»¬åªéœ€ä»å±‚ä¸­æ·»åŠ ç›¸åŒçš„åº“å³å¯ã€‚</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jz"><img src="../Images/300649efe096c8cfa9efb43b6fc49f7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k0rIfkoE4GwUYEDZ3ng3UQ.png"/></div></div></figure><p id="52b7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">å¯¹äºè¯·æ±‚åº“ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨å‘½ä»¤â€” <code class="du ka kb kc kd b">pip install requests -t .</code>å°†å…¶å®‰è£…åœ¨æœ¬åœ°ç›®å½•ä¸­ï¼Œå¹¶ä¸ºlambda.pyåˆ›å»ºä¸€ä¸ªåä¸º<em class="jt">çš„æ–‡ä»¶ã€‚æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½æ‹‰ä¸Šæ‹‰é“¾ã€‚</em></p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ke"><img src="../Images/ca0399a31027cdcf458c08754808f88e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cEJiaBtVP4pX62wxLFDsCg.png"/></div></div></figure><p id="2aa8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">åœ¨AWS Lambdaæ§åˆ¶å°ä¸­ï¼Œåªéœ€ä¸Šä¼ zipæ–‡ä»¶ã€‚</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kf"><img src="../Images/2a4751697349b8dd6b290b53ce6538a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z19WxaqGAW4uPyxz7kntLg.png"/></div></div></figure><p id="a10b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ä¸€æ—¦å®ƒè¢«ä¸Šä¼ ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°ä»£ç éƒ¨åˆ†çœ‹åˆ°è¯·æ±‚åº“ä»¥åŠÎ». pyçš„<em class="jt">æ–‡ä»¶ã€‚</em></p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kg"><img src="../Images/f0c82d3c335da341020c8a348b971cf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5iqw7PD4RuDw7Mvf6EcicA.png"/></div></div></figure><p id="5888" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">åœ¨<em class="jt">ä¸­ä¸ºlambda.pyè¾“å…¥ä»£ç ã€‚</em></p><p id="7e24" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">a)å¯¼å…¥S3è¿æ¥ã€APIè°ƒç”¨å’Œè½¬æ¢éŸ³é¢‘æ‰€éœ€çš„æ‰€æœ‰åº“ã€‚</p><p id="e6d1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">b)è®¾ç½®ä¸S3é“²æ–—çš„è¿æ¥ã€‚</p><p id="372c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">c)è·å–ç‰¹å®šçš„å­˜å‚¨æ¡¶å¹¶è¯»å–CSVæ–‡ä»¶ã€‚</p><p id="8589" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">d)ä»CSVæ–‡ä»¶å½¢æˆé€‚å½“çš„APIã€‚</p><p id="6cf9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">e)è°ƒç”¨APIå¹¶å­˜å‚¨å“åº”ã€‚</p><p id="b020" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">f)å°†APIå“åº”è½¬æ¢æˆ. wavæ–‡ä»¶å¹¶ä¸Šä¼ åˆ°S3æ¡¶ã€‚</p><pre class="jv jw jx jy fd kh kd ki kj aw kk bi"><span id="553b" class="kl km hi kd b fi kn ko l kp kq">import requests<br/>import scipy<br/>import boto3<br/>from scipy.io.wavfile import read, write<br/>from io import BytesIO<br/>import os</span><span id="10f1" class="kl km hi kd b fi kr ko l kp kq">accsid=os.environ['accsid']<br/>authtoken=os.environ['authtoken']<br/>s3_client=boto3.client("s3")</span><span id="dffc" class="kl km hi kd b fi kr ko l kp kq">def call(event,context):<br/>    bucket_name=event["Records"][0]["s3"]["bucket"]["name"]<br/>    file_name=event["Records"][0]["s3"]["object"]["key"]<br/>    resp=s3_client.get_object(Bucket=bucket_name,Key=file_name)<br/>    data=resp['Body'].read().decode('utf-8')<br/>    customer=data.split("\n")<br/>    <br/>    for indx,cust in enumerate(customer):<br/>        cust_data=cust.split(',')<br/>        if indx&gt;0:<br/>            try:<br/>                accno=cust_data[3]<br/>                recno=cust_data[13] <br/>                url="https://api.twilio.com/2010-04-                 <br/>                            01/Accounts/{}/Recordings/{}.wav"<br/>                            .format(accno,recno)<br/>                response=requests.get(url,<br/>                            auth=requests.auth.HTTPBasicAuth(accsid,<br/>                            authtoken))<br/>                rate, data = read(BytesIO(response.content))         <br/>                write("/tmp/{}.wav".format(recno), rate, data)<br/>                s3_client.upload_file(Filename=  <br/>                             "/tmp/{}.wav".format(recno),Bucket=     <br/>                             'audioproduct123',Key=<br/>                             '{}.wav'.format(recno))<br/>                <br/>            except Exception as e:<br/>                print("end")</span></pre><p id="178a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ç°åœ¨ï¼Œå½“æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªç¼©å†™ä¸º<em class="jt">call _ record _ success _ details</em>çš„CSVæ–‡ä»¶æ—¶ï¼Œlambdaå‡½æ•°ä¼šè¢«è§¦å‘å¹¶è·Ÿè¸ªæ•´ä¸ªè¿‡ç¨‹ã€‚ç»“æœï¼Œæˆ‘ä»¬å¾—åˆ°äº†æœŸæœ›çš„è¾“å‡ºã€‚</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/3b3e0a519e7db212da6863e615d3ef7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*51XQ_qD79_ppYD3U3Lg6oA.png"/></div></div></figure></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><p id="2755" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¯·è€ƒè™‘ç»™ğŸ‘ğŸ¼æ¥æ¿€åŠ±æˆ‘ã€‚</p><p id="083f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">å¦‚æœä½ æƒ³çŸ¥é“æ›´å¤šå…³äºéŸ³é¢‘è½¬æ¢å’Œæ•°æ®åº“å­˜å‚¨çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ã€‚</p><div class="la lb ez fb lc ld"><a rel="noopener follow" target="_blank" href="/analytics-vidhya/extracting-audio-files-from-api-storing-it-on-a-nosql-database-789c12311a48"><div class="le ab dw"><div class="lf ab lg cl cj lh"><h2 class="bd hj fi z dy li ea eb lj ed ef hh bi translated">ä»APIä¸­æå–éŸ³é¢‘æ–‡ä»¶å¹¶å°†å…¶å­˜å‚¨åœ¨NoSQLæ•°æ®åº“ä¸­</h2><div class="lk l"><h3 class="bd b fi z dy li ea eb lj ed ef dx translated">å­˜å‚¨å’Œæå–éŸ³é¢‘æ–‡ä»¶çš„æœ€ç®€å•æ–¹æ³•(ã€‚wav/API)</h3></div><div class="ll l"><p class="bd b fp z dy li ea eb lj ed ef dx translated">medium.com</p></div></div><div class="lm l"><div class="ln l lo lp lq lm lr io ld"/></div></div></a></div><div class="la lb ez fb lc ld"><a rel="noopener follow" target="_blank" href="/analytics-vidhya/setup-and-crud-operations-in-mongodb-dd821c4621a"><div class="le ab dw"><div class="lf ab lg cl cj lh"><h2 class="bd hj fi z dy li ea eb lj ed ef hh bi translated">MongoDBä¸­çš„è®¾ç½®å’ŒCRUDæ“ä½œ</h2><div class="lk l"><h3 class="bd b fi z dy li ea eb lj ed ef dx translated">åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•åœ¨MongoDBäº‘æœåŠ¡ä¸­å»ºç«‹ä¸€ä¸ªå¸æˆ·ï¼Œå¹¶ä½¿ç”¨Pymongoè¿›è¡ŒCRUDæ“ä½œã€‚</h3></div><div class="ll l"><p class="bd b fp z dy li ea eb lj ed ef dx translated">medium.com</p></div></div><div class="lm l"><div class="ls l lo lp lq lm lr io ld"/></div></div></a></div><p id="2f92" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">å…¶ä»–åšå®¢-</p><div class="la lb ez fb lc ld"><a rel="noopener follow" target="_blank" href="/swlh/confusion-matrix-in-machine-learning-920eda3d2cb6"><div class="le ab dw"><div class="lf ab lg cl cj lh"><h2 class="bd hj fi z dy li ea eb lj ed ef hh bi translated">æœºå™¨å­¦ä¹ ä¸­çš„æ··æ·†çŸ©é˜µ</h2><div class="lk l"><h3 class="bd b fi z dy li ea eb lj ed ef dx translated">åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘å°†è¯•ç€è§£é‡Šæ··æ·†çŸ©é˜µçš„æ‰€æœ‰åŸºæœ¬æœ¯è¯­ä»¥åŠå¦‚ä½•è®¡ç®—å®ƒä»¬ï¼Œç”¨â€¦</h3></div><div class="ll l"><p class="bd b fp z dy li ea eb lj ed ef dx translated">medium.com</p></div></div><div class="lm l"><div class="lt l lo lp lq lm lr io ld"/></div></div></a></div><div class="la lb ez fb lc ld"><a rel="noopener follow" target="_blank" href="/@darpanlekharu4/what-it-takes-to-become-a-data-scientist-during-covid-19-pandemic-4ad5b9385c88"><div class="le ab dw"><div class="lf ab lg cl cj lh"><h2 class="bd hj fi z dy li ea eb lj ed ef hh bi translated">åœ¨æ–°å† è‚ºç‚Â·ç–«æƒ…æœŸé—´æˆä¸ºä¸€åæ•°æ®ç§‘å­¦å®¶éœ€è¦ä»€ä¹ˆ</h2><div class="lk l"><h3 class="bd b fi z dy li ea eb lj ed ef dx translated">ä¸Šå‘¨ï¼Œæˆ‘ä¸æˆ‘çš„æœ‹å‹è®¨è®ºï¼Œæˆ‘äº†è§£åˆ°ä»–å¸Œæœ›åœ¨æ•°æ®é¢†åŸŸå‘å±•è‡ªå·±çš„äº‹ä¸šâ€¦</h3></div><div class="ll l"><p class="bd b fp z dy li ea eb lj ed ef dx translated">medium.com</p></div></div><div class="lm l"><div class="lu l lo lp lq lm lr io ld"/></div></div></a></div></div></div>    
</body>
</html>