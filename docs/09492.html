<html>
<head>
<title>Can we detect cancerous skin moles based on picture only?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们能仅根据图片检测出癌变的皮肤痣吗？</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/can-we-detect-cancerous-skin-moles-based-on-picture-only-bd728467632?source=collection_archive---------5-----------------------#2020-09-08">https://medium.com/analytics-vidhya/can-we-detect-cancerous-skin-moles-based-on-picture-only-bd728467632?source=collection_archive---------5-----------------------#2020-09-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bcbc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我从生物医学课上拿到最后一个项目作业时，我是一名电子工程专业的大四学生。我们可以自由选择项目主题，只要它有可能给医学界带来好处。</p><p id="b3b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">自从上了图像处理课，我接触了一点图像处理，所以我想，“为什么我不做一些系统/程序，可以只根据图像来决定一些事情？”一旦程序算法完成，该项目将有可能进一步发展成为一个移动/网站应用程序，可以由非专业人士使用，无需任何特殊的技术或工具</p><p id="b7e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，我选择了<strong class="ih hj">早期皮肤癌检测</strong>作为我的项目。这个项目的目标是检测哪些痣是癌性的，哪些不是癌性的。</p><p id="9708" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为什么一定是皮肤癌？为什么不是脑癌？或者其他癌症？因为皮肤是我们无需任何特殊工具，如核磁共振成像、x 光或任何其他生物医学工具，就可以轻松观察的东西。我们可以只拍一张皮肤的照片，把图像放入我们的程序，瞧！我们有结果了！</p><h1 id="b2aa" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">但是，我是怎么开始的呢？</h1><p id="e4be" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated"><strong class="ih hj">首先</strong>，我需要知道癌性和非癌性皮肤痣的特征。我毫不费力地检索了皮肤癌数据集，因为这些数据遍布互联网。我从 ISIC 选择了数据集，并在这里下载了它<a class="ae kg" href="https://www.isic-archive.com/#!/topWithHeader/onlyHeaderTop/gallery" rel="noopener ugc nofollow" target="_blank"/></p><p id="f507" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们来看看图片！</p><p id="b21e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">良性(非癌)</strong></p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/cfaee8f8f285495f34a49e424653eaba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8WZETYUNTZRgirlEtTQzww.png"/></div></div></figure><p id="db1b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">恶性(癌变)</strong></p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kt"><img src="../Images/eb2ee68b1ebbe9949bdc7a7f8c8610ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W4ingFGnCfqla_4tXHtmcA.png"/></div></div></figure><p id="2c82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我第一次看到这些图片时，我感到非常困惑，因为癌性和非癌性痣之间没有太大的区别。所以，我开始做一些文献研究，我发现过去有一些关于检测皮肤癌的研究。</p><p id="4a7d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据过去的研究，有两种主要的方法来检测癌变皮肤。首先使用<strong class="ih hj">特征提取</strong>，其次使用<strong class="ih hj">卷积神经网络</strong>。卷积神经网络在图像分类中非常流行，因为它能够使用 2D 卷积层从输入数据中学习特征。卷积神经网络就像任何机器学习方法一样，我们可以只放一堆数据集，让系统通过更新每个神经元的权重等进行自我学习(我不会在这里解释机器学习如何工作的细节)</p><p id="94b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">卷积神经网络实际上很酷，我预测如果我们有一个大数据集，这种方法会有很好的性能。但我更感兴趣的是以更“人性化”的方式进行分析，此外，我想更深入地了解如何从大量数据中提取重要信息。因此，我选择了特征提取法</p><h1 id="49c0" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated"><strong class="ak">特征提取</strong></h1><p id="c87d" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">在每个数据分析过程中，首先应该想到的问题是</p><blockquote class="ku kv kw"><p id="e159" class="if ig kx ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">"我们需要从这些数据中提取什么样的信息？"</p></blockquote><p id="491c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图像分析也是如此，因为图像基本上是以二维形式的数据。所以我想到的第一个问题是</p><blockquote class="ku kv kw"><p id="e97a" class="if ig kx ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">"我需要提取什么样的特征？"</p></blockquote><p id="983c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从以往的研究来看，<strong class="ih hj"> <em class="kx">不对称、边界不规则</em>、<em class="kx">颜色</em>、<em class="kx">直径</em> </strong> <em class="kx"> </em>是被医生广泛用于分析癌性皮肤痣<em class="kx"> s </em>的<em class="kx">(Jain&amp;Pise，2015)。为了简单起见(是的，当时我的截止日期很紧)，我选择通过<strong class="ih hj">只提取不对称和边界不规则特征来分析癌变皮肤图像。</strong></em></p><p id="8e48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">挑战性的部分来了，将这些特征从图像转换成可读的格式。</p><p id="0b77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="kx">提取不对称特征</em> </strong></p><p id="27ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们如何知道一个物体是否对称？我们可以把它向一个方向折叠，看看一边是否与另一边 100%重叠</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="lb lc l"/></div></figure><p id="07d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，为了获得物体的对称值，我们可以将痣的图片一分为二，将分割后的两张痣的图片重叠，看它们是否 100%重叠</p><p id="8e5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是首先，我们需要把前景(鼹鼠)和背景分开。以下是我所做的分离前景:</p><ol class=""><li id="2b23" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated">将图像转换为灰度模式</li><li id="c4bf" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">应用中值滤波器滤除背景中的噪声</li></ol><p id="89a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是结果</p><div class="ki kj kk kl fd ab cb"><figure class="lr km ls lt lu lv lw paragraph-image"><img src="../Images/9f128d51869e4d0948f68d3996f25996.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/1*vqE-bqiEEmj0PNbsT9t5_w.jpeg"/></figure><figure class="lr km lx lt lu lv lw paragraph-image"><img src="../Images/2c0ad8804d488d7913dfdfbbff2dd6bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:344/format:webp/1*TTw62xQwH7K2oqgytjB-ag.png"/><figcaption class="ly lz et er es ma mb bd b be z dx mc di md me translated">前(左)后(右)</figcaption></figure></div><p id="e1a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们可以看到前景和背景之间的巨大差异。如果我们查看图像的直方图，图像的每个像素都有 0–255 之间的值(0 为黑色，255 为白色，否则为不同强度的灰色)。这种多样化的值会使前景与背景完全分离变得更加困难，所以我使用了<em class="kx"> Otsu 阈值法</em>将每个像素的值仅变成 0 或 1(这也被广泛称为二值化过程)。值高于 140 的像素变为 1，否则变为 0。</p><p id="bec4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们可以将前景完全分离成一个新的图像！</p><p id="3dae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以通过将图像(仅前景)分成两个新图像，将其重叠，并使用以下公式计算不对称百分比，来计算对象的不对称</p><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es mf"><img src="../Images/8f512dd44b5b548e4d98dee44ab9c409.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*-FKs8eHrMMwH_bP4SR4y2w.png"/></div></figure><p id="ed8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">δT 是非重叠区域的差值，T 是物体的总面积</p><p id="f767" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我用这个 Matlab 代码找到物体的质心，将其平移到中心，折叠，并计算物体的不对称程度</p><pre class="ki kj kk kl fd mg mh mi mj aw mk bi"><span id="0aab" class="ml je hi mh b fi mm mn l mo mp">%% Make the measurements<br/> props = regionprops(labeledImage, ‘Centroid’, ‘Orientation’);<br/> xCentroid = props.Centroid(1)<br/> yCentroid = props.Centroid(2)<br/> %% Find the half way point of the image.<br/> middlex = columns/2;<br/> middley = rows/2;</span><span id="94fd" class="ml je hi mh b fi mq mn l mo mp">%% Translate the image<br/> deltax = middlex — xCentroid;<br/> deltay = middley — yCentroid;<br/> binaryImage = imtranslate(binaryImage, [deltax, deltay]);</span><span id="c02e" class="ml je hi mh b fi mq mn l mo mp">%% Rotate the image<br/> angle = -props.Orientation<br/> rotatedImage = imrotate(binaryImage, angle, ‘crop’);</span><span id="dfb0" class="ml je hi mh b fi mq mn l mo mp">%% flip to check asymmetry<br/> flipped =fliplr(rotatedImage)<br/> <br/> %% Measuring assymmetry<br/> % get the total area<br/> props2 = regionprops(labeledImage, ‘Area’);<br/> % count non overlapped area<br/> nonOverlapped = xor(flipped, rotatedImage);</span></pre><p id="7d15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="kx">提取边界不规则度</em> </strong></p><p id="28bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在找到物体的质心并将其移动到图片的中心后，我使用了著名的 canny 边缘检测算法来找到痣的边缘。结果是这样的</p><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es mr"><img src="../Images/4708cf37a00fdb4f91f5122d00d300b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*Lyp8yrqIYxnH1tORt_Kkyg.png"/></div></figure><p id="5297" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">边缘不规则性分析由于其主观性而相当复杂。在本研究中，边缘不规则性的分析是通过计算每个边缘到“皮肤疾病”区域的质心的距离并在一维图中描绘出来进行的。如果图趋于平直或双曲线，没有许多局部最大值或最小值，则意味着边具有清晰和正常的边。通过计算图的导数，然后计算导数图中零交叉的数量，来确定局部最大值和最小值的数量。导数图中的零交叉表示局部最大值或最小值。边缘导数图中的过零值越多，图像的边缘越不规则。</p><p id="fc07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我用来计算边缘不规则程度的代码</p><pre class="ki kj kk kl fd mg mh mi mj aw mk bi"><span id="3131" class="ml je hi mh b fi mm mn l mo mp"><br/>%% filledimage to make border clearer<br/>filledimage = regionprops(labeledImage,'FilledImage')<br/>filledimage = filledimage.FilledImage;</span><span id="68b5" class="ml je hi mh b fi mq mn l mo mp">%% find centroid of the image<br/>edgeprops = regionprops(filledimage,'BoundingBox', 'Centroid');</span><span id="e490" class="ml je hi mh b fi mq mn l mo mp">%% Edge detection<br/>findedge = edge(filledimage,'canny');</span><span id="d42d" class="ml je hi mh b fi mq mn l mo mp">%% Convert centroid to integer<br/>boundingboxint = uint32(edgeprops.BoundingBox)<br/>centroidint =uint32(edgeprops.Centroid)</span><span id="7d67" class="ml je hi mh b fi mq mn l mo mp">%% Scan the edge of image and plot it into 1D array<br/>plotdist=[]<br/>for i= boundingboxint(2) : boundingboxint(4)<br/>    for j= boundingboxint(1) : boundingboxint(3)<br/>        if findedge(i,j) == 1<br/>            dist = sqrt(double(( ((i-centroidint(1))^2) + ((j-centroidint(2))^2) ) ))<br/>            plotdist = vertcat (plotdist, dist)<br/>        end<br/>    end<br/>end</span><span id="db73" class="ml je hi mh b fi mq mn l mo mp">%% Derivate the edge array <br/>firstorderdist = diff(plotdist);</span><span id="9079" class="ml je hi mh b fi mq mn l mo mp">%% Count the local maximum and minimum of the border by counting how many times the graph cross zero<br/>[r c] = size(firstorderdist)<br/>count=0;<br/>for i=1 :(r-1) <br/>    if ( firstorderdist(i)&gt;0 &amp; firstorderdist(i+1) &lt;0 ) | ( firstorderdist(i)&lt;0 &amp; firstorderdist(i+1) &gt;0 )<br/>        count= count+1;<br/>    end<br/>end<br/>borderarr=vertcat(borderarr, count);</span></pre><p id="d0b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是的，我们完成了特征提取，万岁！</p><h1 id="830a" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">分类</h1><p id="26a7" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">在选择分类方法之前，将不对称和不规则数放在一个表中，并将该表映射到一个图中，以便我可以识别其分布。从数据分布的结果来看，K-最近邻算法具有最优的分类超平面。</p><p id="a3f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为我的电脑处理海量数据的性能很差，只能处理 80 张<em class="kx">良性训练图像</em>，80 张<em class="kx">恶性训练图像</em>，20 张良性测试图像，20 张恶性测试图像。</p><p id="b8d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">结果</strong></p><p id="0d19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过特征提取和 k-NN 回归对皮肤癌的检测得到的准确度为<strong class="ih hj"> 75% </strong>，精确度为<strong class="ih hj"> 85% </strong>，特异性为<strong class="ih hj"> 72% </strong>。该精度值受到数据集质量的影响，其中所使用的数据集不具有相同的标准亮度水平，而用于从背景中分离前景的二进制化具有确切的参数。这可能导致分割和参数计算性能下降</p><p id="19e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">结论和进一步工作</strong></p><p id="9d79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总之，在检测癌变皮肤癌时，我们不能仅依靠图像，因为准确性仍然很低。</p><p id="e9a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，我们可以通过以下方式提高精度:</p><ol class=""><li id="e4e5" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated">添加更多特征(颜色和直径)</li><li id="6b32" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">添加更多培训数据</li><li id="1ae9" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">改进预处理算法，使图像更好地标准化</li></ol><p id="c0b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，就这样了。我个人很享受这个项目，因为它可以满足我对数据和图像分析的好奇心。我热爱学习，所以欢迎批评！</p><p id="3303" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你也可以通过我的电子邮件 teresiasavera@gmail.com 与我联系，以进一步了解代码，或者只是讨论一些与图像分析甚至机器学习相关的有趣话题！</p><p id="9b2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">干杯！</p></div></div>    
</body>
</html>