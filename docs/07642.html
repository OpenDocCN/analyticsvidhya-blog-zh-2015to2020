<html>
<head>
<title>Trigger AWS Lambda Function to Store Audio from API in S3 Bucket</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">触发AWS Lambda函数以将来自API的音频存储在S3桶中</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/trigger-aws-lambda-function-to-store-audio-from-api-in-s3-bucket-b2bc191f23ec?source=collection_archive---------9-----------------------#2020-07-02">https://medium.com/analytics-vidhya/trigger-aws-lambda-function-to-store-audio-from-api-in-s3-bucket-b2bc191f23ec?source=collection_archive---------9-----------------------#2020-07-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c0b1ed7fd19e2cfe539dbcaa1f7b545f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NDkk0VvLQ_ydzTCd"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">由<a class="ae iu" href="https://unsplash.com/@alesnesetril?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Ales Nesetril </a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="aae5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是一个教程，我将展示当我们在S3桶中上传音频API并将音频存储回S3桶时，如何触发lambda函数。</p><p id="de16" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我获取的音频来自Twilio recording，通过HTTP GET调用Recordings API资源。</p><p id="9a3f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我们将音频API细节存储在一个CSV文件中。我使用我的CSV文件<em class="jt">(名为call _ record _ success _ details)</em>中的两列来形成完整的API，如果你愿意，你可以将完整的API存储在一列中。</p><p id="8ac8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">其次，我们必须创建一个S3桶<em class="jt">(名为audioproduct123 ) </em>，我们将在其中存储文件，设置一个事件，这样一旦我们上传CVS文件，它就会从文件中获取API并触发lambda函数。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div class="er es ju"><img src="../Images/afeca239fe5ee96d1b9d2c03c8f0766b.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*0ozb8bHM270jnm2iStEDwQ.png"/></div></figure><p id="89c3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，我们必须创建一个Lambda函数<em class="jt"> ( audioconvert-s3 ) </em>，它将读取CSV文件，从API获取详细信息，转换API中存储的音频，并将其上传到s3桶。为此，我们需要两个python库<em class="jt">请求</em>和<em class="jt"> Scipy。</em>有趣的是lambda函数中包含Scipy库，我们只需从层中添加相同的库即可。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jz"><img src="../Images/300649efe096c8cfa9efb43b6fc49f7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k0rIfkoE4GwUYEDZ3ng3UQ.png"/></div></div></figure><p id="52b7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于请求库，我们必须使用命令— <code class="du ka kb kc kd b">pip install requests -t .</code>将其安装在本地目录中，并为lambda.py创建一个名为<em class="jt">的文件。把所有东西都拉上拉链。</em></p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ke"><img src="../Images/ca0399a31027cdcf458c08754808f88e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cEJiaBtVP4pX62wxLFDsCg.png"/></div></div></figure><p id="2aa8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在AWS Lambda控制台中，只需上传zip文件。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kf"><img src="../Images/2a4751697349b8dd6b290b53ce6538a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z19WxaqGAW4uPyxz7kntLg.png"/></div></div></figure><p id="a10b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦它被上传，我们可以在函数代码部分看到请求库以及λ. py的<em class="jt">文件。</em></p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kg"><img src="../Images/f0c82d3c335da341020c8a348b971cf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5iqw7PD4RuDw7Mvf6EcicA.png"/></div></div></figure><p id="5888" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<em class="jt">中为lambda.py输入代码。</em></p><p id="7e24" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">a)导入S3连接、API调用和转换音频所需的所有库。</p><p id="e6d1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">b)设置与S3铲斗的连接。</p><p id="372c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">c)获取特定的存储桶并读取CSV文件。</p><p id="8589" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">d)从CSV文件形成适当的API。</p><p id="6cf9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">e)调用API并存储响应。</p><p id="b020" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">f)将API响应转换成. wav文件并上传到S3桶。</p><pre class="jv jw jx jy fd kh kd ki kj aw kk bi"><span id="553b" class="kl km hi kd b fi kn ko l kp kq">import requests<br/>import scipy<br/>import boto3<br/>from scipy.io.wavfile import read, write<br/>from io import BytesIO<br/>import os</span><span id="10f1" class="kl km hi kd b fi kr ko l kp kq">accsid=os.environ['accsid']<br/>authtoken=os.environ['authtoken']<br/>s3_client=boto3.client("s3")</span><span id="dffc" class="kl km hi kd b fi kr ko l kp kq">def call(event,context):<br/>    bucket_name=event["Records"][0]["s3"]["bucket"]["name"]<br/>    file_name=event["Records"][0]["s3"]["object"]["key"]<br/>    resp=s3_client.get_object(Bucket=bucket_name,Key=file_name)<br/>    data=resp['Body'].read().decode('utf-8')<br/>    customer=data.split("\n")<br/>    <br/>    for indx,cust in enumerate(customer):<br/>        cust_data=cust.split(',')<br/>        if indx&gt;0:<br/>            try:<br/>                accno=cust_data[3]<br/>                recno=cust_data[13] <br/>                url="https://api.twilio.com/2010-04-                 <br/>                            01/Accounts/{}/Recordings/{}.wav"<br/>                            .format(accno,recno)<br/>                response=requests.get(url,<br/>                            auth=requests.auth.HTTPBasicAuth(accsid,<br/>                            authtoken))<br/>                rate, data = read(BytesIO(response.content))         <br/>                write("/tmp/{}.wav".format(recno), rate, data)<br/>                s3_client.upload_file(Filename=  <br/>                             "/tmp/{}.wav".format(recno),Bucket=     <br/>                             'audioproduct123',Key=<br/>                             '{}.wav'.format(recno))<br/>                <br/>            except Exception as e:<br/>                print("end")</span></pre><p id="178a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，当我们上传一个缩写为<em class="jt">call _ record _ success _ details</em>的CSV文件时，lambda函数会被触发并跟踪整个过程。结果，我们得到了期望的输出。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/3b3e0a519e7db212da6863e615d3ef7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*51XQ_qD79_ppYD3U3Lg6oA.png"/></div></div></figure></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><p id="2755" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果这篇文章对你有所帮助，请考虑给👏🏼来激励我。</p><p id="083f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你想知道更多关于音频转换和数据库存储的信息，请查看我的另一篇文章。</p><div class="la lb ez fb lc ld"><a rel="noopener follow" target="_blank" href="/analytics-vidhya/extracting-audio-files-from-api-storing-it-on-a-nosql-database-789c12311a48"><div class="le ab dw"><div class="lf ab lg cl cj lh"><h2 class="bd hj fi z dy li ea eb lj ed ef hh bi translated">从API中提取音频文件并将其存储在NoSQL数据库中</h2><div class="lk l"><h3 class="bd b fi z dy li ea eb lj ed ef dx translated">存储和提取音频文件的最简单方法(。wav/API)</h3></div><div class="ll l"><p class="bd b fp z dy li ea eb lj ed ef dx translated">medium.com</p></div></div><div class="lm l"><div class="ln l lo lp lq lm lr io ld"/></div></div></a></div><div class="la lb ez fb lc ld"><a rel="noopener follow" target="_blank" href="/analytics-vidhya/setup-and-crud-operations-in-mongodb-dd821c4621a"><div class="le ab dw"><div class="lf ab lg cl cj lh"><h2 class="bd hj fi z dy li ea eb lj ed ef hh bi translated">MongoDB中的设置和CRUD操作</h2><div class="lk l"><h3 class="bd b fi z dy li ea eb lj ed ef dx translated">在这篇文章中，我们将看到如何在MongoDB云服务中建立一个帐户，并使用Pymongo进行CRUD操作。</h3></div><div class="ll l"><p class="bd b fp z dy li ea eb lj ed ef dx translated">medium.com</p></div></div><div class="lm l"><div class="ls l lo lp lq lm lr io ld"/></div></div></a></div><p id="2f92" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">其他博客-</p><div class="la lb ez fb lc ld"><a rel="noopener follow" target="_blank" href="/swlh/confusion-matrix-in-machine-learning-920eda3d2cb6"><div class="le ab dw"><div class="lf ab lg cl cj lh"><h2 class="bd hj fi z dy li ea eb lj ed ef hh bi translated">机器学习中的混淆矩阵</h2><div class="lk l"><h3 class="bd b fi z dy li ea eb lj ed ef dx translated">在这篇博客中，我将试着解释混淆矩阵的所有基本术语以及如何计算它们，用…</h3></div><div class="ll l"><p class="bd b fp z dy li ea eb lj ed ef dx translated">medium.com</p></div></div><div class="lm l"><div class="lt l lo lp lq lm lr io ld"/></div></div></a></div><div class="la lb ez fb lc ld"><a rel="noopener follow" target="_blank" href="/@darpanlekharu4/what-it-takes-to-become-a-data-scientist-during-covid-19-pandemic-4ad5b9385c88"><div class="le ab dw"><div class="lf ab lg cl cj lh"><h2 class="bd hj fi z dy li ea eb lj ed ef hh bi translated">在新冠肺炎·疫情期间成为一名数据科学家需要什么</h2><div class="lk l"><h3 class="bd b fi z dy li ea eb lj ed ef dx translated">上周，我与我的朋友讨论，我了解到他希望在数据领域发展自己的事业…</h3></div><div class="ll l"><p class="bd b fp z dy li ea eb lj ed ef dx translated">medium.com</p></div></div><div class="lm l"><div class="lu l lo lp lq lm lr io ld"/></div></div></a></div></div></div>    
</body>
</html>