<html>
<head>
<title>Predicting the Stocks using Machine Learning and Deep Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用机器学习和深度学习预测股票</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/predicting-the-stocks-using-machine-learning-and-deep-learning-dba27a96fcdf?source=collection_archive---------11-----------------------#2019-11-04">https://medium.com/analytics-vidhya/predicting-the-stocks-using-machine-learning-and-deep-learning-dba27a96fcdf?source=collection_archive---------11-----------------------#2019-11-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ee2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">股票或股份是合作社所有权分成的部分。一只股票代表合作的部分所有权，将有数字所有权，而不是物理所有权。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/c76121b6bbf04853c9537d7baf1fccd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7lwf0GoPisVXmOKIQ0Emyg.jpeg"/></div></div></figure><p id="2bac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里我想分享一下我是如何使用机器学习和深度学习算法用于<a class="ae jp" href="https://www.kaggle.com/c/the-winton-stock-market-challenge/overview" rel="noopener ugc nofollow" target="_blank">温顿股市挑战</a>的。</p><p id="711e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">鉴于过去几天的历史，挑战在于预测一只股票的回报。老实说，我们只是预测未来的股票，所以根据给定的数据，我们试图预测股票是上涨还是下跌。可能有几个外部因素在实时中发挥作用，但我们试图使它尽可能接近实时。</p><h1 id="5f38" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">数据解释:</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ko"><img src="../Images/9c93a947736a3352ec0451fb840b46c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rh_dJOksVh3K4S3fEj3tmg.jpeg"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">给定数据的可视化表示</figcaption></figure><p id="750d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如何计算这些回报是由Winton定义的，不会在本次比赛中向我们透露。我们将拥有前2天(D-2，D-1)的股票价值和当天的120个收益，在当天的一分钟内，我们需要预测接下来的60个收益和D+1，D+2个收益。</p><p id="1b0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">股票市场回报是投资者从股票市场获得的回报。这种回报可以是通过交易获得的利润，也可以是公司不时给予股东的股息。在这场比赛中，有两种类型的回报是日内和每日回报。</p><h1 id="8fd6" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">什么是日内回报和日内回报？</h1><p id="e20f" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">日内回报是股票日总回报的两个组成部分之一。日内回报衡量股票在正常交易时间内产生的回报，基于其从交易日开盘到收盘的价格变化。日内回报率和<a class="ae jp" href="https://www.investopedia.com/terms/o/overnight-position.asp" rel="noopener ugc nofollow" target="_blank">隔夜回报率</a>共同构成了一只股票的日总回报率，该回报率基于股票从一个交易日收盘到下一个交易日收盘的价格变化。它也被称为白天返回。</p><h2 id="b172" class="ky jr hi bd js kz la lb jw lc ld le ka iq lf lg ke iu lh li ki iy lj lk km ll bi translated">度量:</h2><p id="1368" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">本次竞赛的参赛作品将根据预测股票价值和实际股票价值之间的加权平均绝对误差进行评判。</p><h2 id="da4f" class="ky jr hi bd js kz la lb jw lc ld le ka iq lf lg ke iu lh li ki iy lj lk km ll bi translated"><strong class="ak">提交文件格式:</strong></h2><p id="18af" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">提交文件应该包含两列:Id和预测。对于每个5天的窗口，我们需要预测62个回报。例如，如果第一个时间窗口，我们预测为1_1、1_2至1_62，其中1_1至1_60预测Ret_121至Ret_180，1_61预测Ret_PlusOne，1_62预测Ret_PlusTwo。</p><p id="95dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该文件应包含一个标题，并具有以下格式:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lm"><img src="../Images/c1e9ae12db8b7f7419ce6bd5ef067bd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:394/format:webp/1*NnbMqhbdSkQHhSuffmdkTg.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">提交文件格式</figcaption></figure><h2 id="63cd" class="ky jr hi bd js kz la lb jw lc ld le ka iq lf lg ke iu lh li ki iy lj lk km ll bi translated"><strong class="ak">理解数据</strong>给定<strong class="ak">和待预测:</strong></h2><p id="daad" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">正如我们所看到的，给定的数据是一个时间序列数据，给定的数据有许多空值，所以用特定列的平均值填充它们。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ln"><img src="../Images/74bf317b4f95df51d943221474bd8d52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1EWjrg6t9pxs2oK_OIuadw.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">历史输入和目标变量的可视化表示</figcaption></figure><p id="7fce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在特定行的训练数据中，我们在训练数据中有211个特征。</p><ul class=""><li id="31c6" class="lo lp hi ih b ii ij im in iq lq iu lr iy ls jc lt lu lv lw bi translated">25个与预测相关的不同特征，其细节在竞赛中没有提及，其中大部分是空值。</li><li id="8718" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">Ret_MinusTwo，Ret_MinusOne分别是从D-2日收盘到D-1日收盘的收益和从D-1日收盘到D日(约1/2日)日内收益开始点的收益。</li><li id="716f" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">Ret_2至Ret_120是第d天大约一分钟内的回报率。Ret_2是t=1至t=2之间的回报率。</li><li id="67d3" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">权重_日内是用于评估日内回报预测Ret 121至180的权重</li><li id="38ee" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">Weight_Daily是用于评估每日回报预测的权重(Ret_PlusOne和Ret_PlusTwo)。</li></ul><p id="caf5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">目标变量:</p><ul class=""><li id="8b9d" class="lo lp hi ih b ii ij im in iq lq iu lr iy ls jc lt lu lv lw bi translated">Ret_121至Ret_180是d日大约一分钟内的日内回报。这些是提交时需要预测为{ id } _ { 1–60 }的目标变量。</li><li id="16e6" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">Ret_PlusOne是从D日测量Ret_180时到D+1日交易结束时的回报率。(大约1天)。这是一个需要预测为{id}_61的目标变量。</li><li id="5215" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">Ret_PlusTwo是D+1日收盘到D+2日(即1日)收盘的收益这是一个你需要预测为{id}_62的目标变量。</li></ul><h2 id="dceb" class="ky jr hi bd js kz la lb jw lc ld le ka iq lf lg ke iu lh li ki iy lj lk km ll bi translated"><strong class="ak">探索性数据分析:</strong></h2><ol class=""><li id="4db7" class="lo lp hi ih b ii kt im ku iq mc iu md iy me jc mf lu lv lw bi translated">我检查了给定数据中的Nan值，特征1具有大部分的NaN值，在40，000个NaN值中有33，313个。</li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mg"><img src="../Images/a3fc79998dec62da97ae7d847f4cabc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*snPsv3UEqbb8wBoKAbLhJA.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">NaN值计数与211特性</figcaption></figure><p id="a2b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.大部分返回值在0.01到-0.01之间。我们可以在下面的图片中看到，这些图片是给定数据的前16个返回值的曲线图。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mh"><img src="../Images/a30285d9993f89c85aafe0465458cb0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TCEp7YzeXOwFcLJiQr3FuQ.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">前16个返回值为Ret_2至Ret_17的图</figcaption></figure><p id="227e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.我们在下图中绘制了傅立叶变换，我们可以看到只有在一些返回中有很少的峰值。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mi"><img src="../Images/f9fa346840e0ff1a48e9f307611f19a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z3-vSlKN-PYkitAID5-f1w.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">前9个返回值的傅立叶变换图</figcaption></figure><p id="3954" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.绘制日内回报和日回报的直方图。一个<strong class="ih hj">直方图</strong>在垂直轴上显示频率，水平轴是另一维度。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mj"><img src="../Images/8d06ae0a6e6985fd92a40a6469932fde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*YGX3ljOOOKbT1BrpT_7e9A.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">日收益率和日内收益率直方图</figcaption></figure><h2 id="be56" class="ky jr hi bd js kz la lb jw lc ld le ka iq lf lg ke iu lh li ki iy lj lk km ll bi translated">解决问题的机器学习算法:</h2><p id="fdfd" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">在这里我尝试了下面的ML算法:</p><ol class=""><li id="cc31" class="lo lp hi ih b ii ij im in iq lq iu lr iy ls jc mf lu lv lw bi translated"><strong class="ih hj"> XGBoost </strong>:用XGBoost MSE很小但是训练时间很大。所以对这个模型进行超调需要更多的计算。从下图中，我们可以直观地解释我们的预测值和实际值之间的差异。</li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mk"><img src="../Images/f0faa730440e6a868107ffd620e64e90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*cTTuPk1oC9Tr9_TG8fNZFQ.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">每日回报的预测值和实际值之间的关系图</figcaption></figure><p id="287f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.<strong class="ih hj">线性回归</strong>:这是最简单的算法，训练时间很短，MSE也很小，但没有XGboost大。从下图我们可以看出预测值和实际值的差异。</p><p id="1adc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">线性回归未能预测极端的变化。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ml"><img src="../Images/6604430682c4dbc4354fa1df878a5a62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*ExjH0jAaqgddzK2R8FIPsw.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">日内回报的预测值和实际值之间的关系图</figcaption></figure><p id="e8b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.<strong class="ih hj"> RBF核SVR : </strong>下面是图的RBF超调，其中C为10e2时MSE值较小，与上述模型相比，RBF核在超参数调优后表现不佳。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mm"><img src="../Images/833c22b30ef25328b85ce01c73c49af6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*9utAj6-E5iEYxltZTicHZw.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">c值和MSE误差之间的图</figcaption></figure><p id="ac95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.<strong class="ih hj">自变量:</strong>在下面用肘法超调n _估计量和小区内的MSE中，我们选择了最佳的n _估计量为50。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mn"><img src="../Images/a8b564a05879af924053b07f4fc95ac7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*sX5l-q0o6HTcSOqv2izbbg.png"/></div></figure><p id="9385" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于给定的数据是时间序列数据，我尝试了对上述模型进行傅立叶变换的特征工程，但性能指标没有改善，所以我转向了深度学习算法。</p><h2 id="3086" class="ky jr hi bd js kz la lb jw lc ld le ka iq lf lg ke iu lh li ki iy lj lk km ll bi translated">深度学习算法解决问题:</h2><p id="a06a" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">由于这是一个序列数据，RNN工作得更好，但最近在许多比赛中，LSTM的表现超过了许多RNN算法。</p><ol class=""><li id="8be0" class="lo lp hi ih b ii ij im in iq lq iu lr iy ls jc mf lu lv lw bi translated">带有遮罩层的LSTM:</li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mo"><img src="../Images/de79cbaaaf4209d23dc386a005cf1d36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kpWJdOq0kzR3MDbGapY0Gw.png"/></div></div></figure><p id="f679" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.LSTM有两个隐藏层:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mp"><img src="../Images/39b598314bdc4b2f5d01bcbfffce4380.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9v-bcVfWBOhzR3-aIGyDRg.png"/></div></div></figure><p id="9910" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.LSTM有4个隐藏层:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mq"><img src="../Images/805c9d3318e8f260b0885a2882c7ccb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D1I2pLY1u_4A4A5p0I0Y_g.png"/></div></div></figure><p id="eee6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.具有4个隐藏层和批量正常层的LSTM:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mr"><img src="../Images/62944d1821d722ebd659d159ae1f270b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kjmz_Tq1zltMJMQa4y601g.png"/></div></div></figure><h1 id="eda1" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">结论:</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/73d82f2c4f35c7dd1997251780f834d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xAPV5OFE-ZK-_8MQNxsEiQ.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">比较上述模型的均方误差</figcaption></figure><p id="3e06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在使用这一数据的852个团队中，只有370个(43%)的表现好于预测每只股票价格为0。</p><p id="7857" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于日收益率，XGboost的MSE较小，而LSTM的对于序列数据效果很好。但经过多次提交，LSTM与掩蔽层作为一个更好的分数比其余的模型。</p><p id="ebf6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码的完整链接可以在<a class="ae jp" href="https://github.com/3797kaushik/Winton-Stock-market-challenge" rel="noopener ugc nofollow" target="_blank">这里</a>找到，你可以在这里<a class="ae jp" href="https://www.kaggle.com/c/the-winton-stock-market-challenge/overview" rel="noopener ugc nofollow" target="_blank">访问Kaggle上的数据集。</a></p><h1 id="fd06" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">未来工作:</strong></h1><ol class=""><li id="436d" class="lo lp hi ih b ii kt im ku iq mc iu md iy me jc mf lu lv lw bi translated">对于XGBoost这样的机器学习模型，我们可以超调并减少MSE误差。</li><li id="c1b2" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc mf lu lv lw bi translated">我们可以在RBF内核中用更宽的范围超调gamma和C值。</li><li id="65ae" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc mf lu lv lw bi translated">我们可以尝试添加几个LSTM层和实验。</li><li id="d65f" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc mf lu lv lw bi translated">我们可以尝试预测会影响我们股票的各种股票，因此我们需要考虑其他股票并收集这些数据。</li></ol><h1 id="953a" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">来源:</h1><ol class=""><li id="4a65" class="lo lp hi ih b ii kt im ku iq mc iu md iy me jc mf lu lv lw bi translated"><a class="ae jp" href="https://en.wikipedia.org/wiki/Stock_market" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Stock_market</a></li><li id="9902" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc mf lu lv lw bi translated"><a class="ae jp" href="https://www.investopedia.com/terms/i/intraday-return.asp" rel="noopener ugc nofollow" target="_blank">https://www.investopedia.com/terms/i/intraday-return.asp</a></li><li id="4060" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc mf lu lv lw bi translated"><a class="ae jp" href="https://www.economywatch.com/stock-markets-in-world/returns.html" rel="noopener ugc nofollow" target="_blank">https://www . economy watch . com/stock-markets-in-world/returns . html</a></li></ol></div></div>    
</body>
</html>