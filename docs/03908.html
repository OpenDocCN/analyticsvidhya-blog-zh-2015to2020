<html>
<head>
<title>Anomaly detection by Z-Score and Modified Z-Score</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Z分数和修正Z分数的异常检测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/anomaly-detection-by-modified-z-score-f8ad6be62bac?source=collection_archive---------1-----------------------#2020-02-25">https://medium.com/analytics-vidhya/anomaly-detection-by-modified-z-score-f8ad6be62bac?source=collection_archive---------1-----------------------#2020-02-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9c90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd">这是关于如何使用Z分数和修改的Z分数作为异常检测的介绍。</em>T3】</strong></p><p id="c6d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先让我们简单介绍一下z-score，以及为什么我们实际上需要修改z-score。</p><p id="c18c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">z-score是对1D数据中的异常进行评分的常用方法。如果均值和标准差已知，那么对于每个数据点</p><p id="5630" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将z分数计算为:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/49c26d0a47b50dab1529e3f53b2bf6a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:402/format:webp/1*m41t-zC6FsmQ0vse6BJ4-w.png"/></div></figure><p id="751f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">z得分衡量一个点离平均值的距离，因为标准偏差的有符号倍数和z得分的大绝对值表明异常。</p><p id="e370" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们来看一个数据集，它显示了z分数的局限性以及修改后的z分数为什么有用。</p><p id="0047" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将看看从1930年到2018年(共21场比赛)每届世界杯最佳射手的进球数。原始数据来自这里:</p><div class="jm jn ez fb jo jp"><a href="https://en.wikipedia.org/wiki/FIFA_World_Cup_top_goalscorers" rel="noopener  ugc nofollow" target="_blank"><div class="jq ab dw"><div class="jr ab js cl cj jt"><h2 class="bd hj fi z dy ju ea eb jv ed ef hh bi translated">国际足联世界杯最佳射手</h2><div class="jw l"><h3 class="bd b fi z dy ju ea eb jv ed ef dx translated">在21届国际足联男足世界杯决赛中，已经有超过2000个进球，这还不算…</h3></div><div class="jx l"><p class="bd b fp z dy ju ea eb jv ed ef dx translated">en.wikipedia.org</p></div></div><div class="jy l"><div class="jz l ka kb kc jy kd jk jp"/></div></div></a></div><p id="23f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据被清理并保存为CSV格式。把它作为一个数据帧载入来看看。</p><div class="jm jn ez fb jo jp"><a href="https://drive.google.com/open?id=1x1yB17eNHEshqI58-t_o-hbjY1tD1nJ7" rel="noopener  ugc nofollow" target="_blank"><div class="jq ab dw"><div class="jr ab js cl cj jt"><h2 class="bd hj fi z dy ju ea eb jv ed ef hh bi translated">认识Google Drive -一个存放所有文件的地方</h2><div class="jw l"><h3 class="bd b fi z dy ju ea eb jv ed ef dx translated">Google Drive是一种免费的文件备份方式，可以从任何手机、平板电脑或电脑上轻松访问。开始…</h3></div><div class="jx l"><p class="bd b fp z dy ju ea eb jv ed ef dx translated">drive.google.com</p></div></div><div class="jy l"><div class="ke l ka kb kc jy kd jk jp"/></div></div></a></div><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kf"><img src="../Images/1bf15c8252457900afe1c223471e414e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KT0SrCmlsXLexDwwemn69g.png"/></div></div></figure><p id="85b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将从使用z分数来识别异常开始。由于我们对超级明星感兴趣，我们将有一个上限。我们选择𝑧 =+2。高于这个z值，任何玩家都会被贴上异常的标签。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kk"><img src="../Images/173fe6f84fa032d910d9119f89a1cd1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*l_ytI8gUktHiW4-xnhPWww.png"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kl"><img src="../Images/9d9a55a8da8314d3bf5d9865dce2743e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bGJMZBWtuRFKqWjwmpvszw.png"/></div></div><figcaption class="km kn et er es ko kp bd b be z dx translated">计算z分数并添加到数据框</figcaption></figure><p id="7063" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们定义一个绘图函数来显示结果:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kq"><img src="../Images/457bd3b903f03ef2a3d164e5faf53c36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CymBUprRVcVfYRq_eQM92w.png"/></div></div></figure><p id="b59e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只有一名球员被选中:朱思特·方丹。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kr"><img src="../Images/867c678aedc55edacd607bda2c5b0810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*suJYjAEMHvI74E-DtlO_HQ.png"/></div></div></figure><p id="6599" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">显然我们的分析有缺陷。通过观察该图，我们看到在21场比赛中的12场比赛中，最佳射手的进球数低于平均进球数(7.05)。</p><p id="272d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以问题来了，为什么会这样？</p><p id="09f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">答案是<strong class="ih hj">,均值和标准差本身容易受到异常的影响。凭借他的13个进球，令人惊叹的方丹将平均水平提高了如此之多，以至于大多数球员都低于平均水平。结果，他成了唯一的异类。</strong></p><p id="0a15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正因为如此，z分数有时可能不可靠，因为平均值和标准差本身对异常很敏感。</p><p id="34ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">改进的z分数</strong>通过使用<strong class="ih hj">中间值</strong>来解决这个问题:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ks"><img src="../Images/2771d312fd215ecd443b07556a6e442b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gs5vU3KnY0K0gwayfv825Q.png"/></div></div></figure><p id="3834" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> MAD </strong>代表距离中间值的<strong class="ih hj">m</strong>edian<strong class="ih hj">a</strong>b solute<strong class="ih hj">d</strong>偏差。</p><p id="1682" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，在修改的Z分数的情况下，修改的Z分数的大绝对值暗示异常。</p><p id="b323" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们用修改后的z分数重复这个分析，看看会发生什么。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kt"><img src="../Images/c30d7b341d3347758c78f70d9218de05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lkc98d_mhArxsf0e9LyeBQ.png"/></div></div></figure><p id="956a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，中值(6.0)低于平均值(7.05)，正如图中所预期的那样。</p><p id="3651" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们要做一个小小的修改，引入一个<strong class="ih hj">一致性</strong> <strong class="ih hj">修正k </strong>，允许我们使用MAD作为标准差的一致性估计。k的值取决于数据的基本分布。为简单起见，我们将使用<strong class="ih hj"> k=1.4826 </strong>。</p><p id="cb1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(参见:<a class="ae ku" href="https://en.wikipedia.org/wiki/Median_absolute_deviation" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Median_absolute_deviation</a>)</p><p id="e31e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此<strong class="ih hj">修改后的z值</strong>变为</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kv"><img src="../Images/0cbe23958a4d1e7f2b505c16d85e2220.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*Cp2RDkIeDwazrdjAExyX3w.png"/></div></figure><p id="f9a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们将在下面的函数中使用的表单。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kw"><img src="../Images/0d4f65d5e416e11d727e6e178c201a72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QV6TzwmeuuuD86SH3lex2w.png"/></div></div></figure><p id="f95e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像以前一样，计算所有玩家的修改后的z分数，然后绘制并列出结果。注意，阈值在<strong class="ih hj"> y=+2 </strong>保持不变。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kx"><img src="../Images/1e5dd736c2c901a5635d332e5bc7a2e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MG-0_wvOkjXRykq0F2Df3g.png"/></div></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ky"><img src="../Images/51fedcf25c6a312d69c46208480c2981.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jiu61m4uLRQACvMpYG3Jww.png"/></div></div></figure><p id="3353" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们发现了四个异常玩家。</p><p id="e837" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么MAD与之前计算的标准差相比如何呢？</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kz"><img src="../Images/2989c550a47f49dbc2e885c014d824e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nm_ia8oDz3-L_8HEbPGzjQ.png"/></div></div></figure><p id="d074" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">k∫MAD</strong>为<strong class="ih hj"> 1.48 </strong>，小于<strong class="ih hj">标准差(2.05) </strong>。我们看到，异常对标准偏差有较大的影响，标准偏差取决于与均值偏差的平方(MAD线性地取决于偏差)。</p><p id="1109" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文中使用的代码可以在github上找到:</p><div class="jm jn ez fb jo jp"><a href="https://github.com/jainyk/Anomaly-detection/tree/master/Zscore%20and%20modified%20zscore" rel="noopener  ugc nofollow" target="_blank"><div class="jq ab dw"><div class="jr ab js cl cj jt"><h2 class="bd hj fi z dy ju ea eb jv ed ef hh bi translated">杰尼克/异常检测</h2><div class="jx l"><p class="bd b fp z dy ju ea eb jv ed ef dx translated">github.com</p></div></div><div class="jy l"><div class="la l ka kb kc jy kd jk jp"/></div></div></a></div><p id="cc6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如有任何疑问，请在下方留言。欢迎任何进一步的建议。</p></div></div>    
</body>
</html>