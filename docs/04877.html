<html>
<head>
<title>Django with Nginx, Gunicorn</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django和Nginx，Gunicorn</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/dajngo-with-nginx-gunicorn-aaf8431dc9e0?source=collection_archive---------0-----------------------#2020-04-04">https://medium.com/analytics-vidhya/dajngo-with-nginx-gunicorn-aaf8431dc9e0?source=collection_archive---------0-----------------------#2020-04-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="b6a9" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">生产就绪解决方案。</h2></div><p id="a87d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae jt" href="http://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj"> <em class="ju"> Django </em> </strong> </a>是一个高效、通用、动态演进的web应用开发框架。如今，Django在设计web应用程序方面变得越来越强大。</p><p id="3a75" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在生产中运行Django的本地服务器并不是推荐的方式，因为它只是一个测试服务器，而不是一个生产就绪的服务器。因此，在产品中运行Django就是使用<strong class="iz hj"> Gunicorn </strong>运行，并使用<strong class="iz hj"> Nginx </strong>作为反向代理，从而为我们的应用程序提供更多安全性。</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es jv"><img src="../Images/b40eddf12ef9e1fedefa5b81391ce26d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rYdZRYct2FKHiGxlJIvORg.png"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx translated">请求流</figcaption></figure><p id="0b89" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这篇博文中，我将向您解释如何在<strong class="iz hj">生产</strong>环境中运行Django应用程序。所以让我们开始吧。</p><h1 id="8e8e" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated">先决条件:</h1><ol class=""><li id="7c69" class="ld le hi iz b ja lf jd lg jg lh jk li jo lj js lk ll lm ln bi translated">Amazon Ubntu(16.04) EC2实例启动并使用相关的密钥对运行(对它的ssh访问)。</li><li id="67a2" class="ld le hi iz b ja lo jd lp jg lq jk lr jo ls js lk ll lm ln bi translated">必须为此实例打开端口22、80、8000。</li></ol><h1 id="2ec5" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated">SSH &amp;更新ubuntu实例:</h1><p id="7791" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated">您需要ssh到您的EC2实例，所以确保您为您的实例打开了端口22，然后进行更新/升级。</p><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="f11a" class="mb km hi lx b fi mc md l me mf">ssh -i path-to-your-key.pem ubuntu@your-aws-instance-public-ip</span><span id="f063" class="mb km hi lx b fi mg md l me mf">sudo apt-get update &amp;&amp; sudo apt-get upgrade -y</span></pre><h1 id="faa1" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated">在AWS EC2 (ubuntu 16.04)上安装Python3.6.x:</h1><p id="72dc" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated">我们会从官方网站下载tar.xz文件，然后手动安装。在此之前，我们需要安装一些必需的依赖项。</p><ul class=""><li id="4782" class="ld le hi iz b ja jb jd je jg mh jk mi jo mj js mk ll lm ln bi translated">构建和安装依赖项</li></ul><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="1fac" class="mb km hi lx b fi mc md l me mf">sudo apt install build-essential checkinstall</span><span id="4f57" class="mb km hi lx b fi mg md l me mf">sudo apt install libreadline-gplv2-dev libncursesw5-dev libssl-dev libsqlite3-dev tk-dev libgdbm-dev libc6-dev libbz2-dev libffi-dev</span></pre><ul class=""><li id="9177" class="ld le hi iz b ja jb jd je jg mh jk mi jo mj js mk ll lm ln bi translated">下载并手动安装所需的Python版本</li></ul><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="99a1" class="mb km hi lx b fi mc md l me mf">cd /opt &amp;&amp; sudo wget <a class="ae jt" href="https://www.python.org/ftp/python/3.6.6/Python-3.6.6.tar.xz" rel="noopener ugc nofollow" target="_blank">https://www.python.org/ftp/python/3.6.6/Python-3.6.6.tar.xz</a></span><span id="0923" class="mb km hi lx b fi mg md l me mf">sudo tar -xvf Python-3.6.6.tar.xz</span><span id="f0e0" class="mb km hi lx b fi mg md l me mf">cd Python-3.6.6/</span><span id="8b3b" class="mb km hi lx b fi mg md l me mf">sudo ./configure</span><span id="c004" class="mb km hi lx b fi mg md l me mf">sudo make &amp;&amp; sudo make install</span><span id="120d" class="mb km hi lx b fi mg md l me mf">cd /home/ubuntu/</span></pre><ul class=""><li id="6bae" class="ld le hi iz b ja jb jd je jg mh jk mi jo mj js mk ll lm ln bi translated">检查Python版本</li></ul><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="27c6" class="mb km hi lx b fi mc md l me mf">python3 -V</span></pre><h1 id="d113" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated">创建示例Django应用程序:</h1><ul class=""><li id="6ef6" class="ld le hi iz b ja lf jd lg jg lh jk li jo lj js mk ll lm ln bi translated">为示例应用程序创建目录</li></ul><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="264b" class="mb km hi lx b fi mc md l me mf">mkdir hello_django &amp;&amp; cd hello_django</span></pre><ul class=""><li id="9b4b" class="ld le hi iz b ja jb jd je jg mh jk mi jo mj js mk ll lm ln bi translated">创建和激活虚拟环境</li></ul><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="db3a" class="mb km hi lx b fi mc md l me mf">python3.6 -m venv .</span><span id="9897" class="mb km hi lx b fi mg md l me mf">source bin/activate</span></pre><figure class="jw jx jy jz fd ka er es paragraph-image"><div class="er es ml"><img src="../Images/a4016e1d6e83430446c49a0f302437b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/0*m3LbUuNx1QGbE9Xu"/></div><figcaption class="kh ki et er es kj kk bd b be z dx translated">虚拟环境已激活</figcaption></figure><p id="cc14" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您的环境现在已经激活，您可以开始在其中安装Django了。</p><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="08a8" class="mb km hi lx b fi mc md l me mf">pip install Django==3.0</span></pre><p id="db34" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您的Django环境应该可以使用了。继续创建一个空的Django项目。</p><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="0e54" class="mb km hi lx b fi mc md l me mf">django-admin.py startproject hello</span></pre><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es mm"><img src="../Images/48f243ffe474fa72e1f27998e95d94fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UVBws9RaPA1Z1mY8"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx translated">创建空Django项目</figcaption></figure><ul class=""><li id="cb49" class="ld le hi iz b ja jb jd je jg mh jk mi jo mj js mk ll lm ln bi translated">测试样本应用</li></ul><p id="eeb6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以通过运行开发服务器来测试它。您可以忽略警告。</p><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="a928" class="mb km hi lx b fi mc md l me mf">cd hello/</span><span id="1c9e" class="mb km hi lx b fi mg md l me mf">python manage.py runserver 0.0.0.0:8000</span></pre><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es mn"><img src="../Images/de3beb223bd0e205468d1db01d176a6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yLMoR6zNmlumXJ7l"/></div></div></figure><p id="e21c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">转到您的浏览器并点击<strong class="iz hj"><em class="ju">&lt;ec2-instance-DNS:8000&gt;</em></strong>您将得到一个<strong class="iz hj">错误</strong>提示“DisallowedHost at /”要解决此错误，请按<strong class="iz hj"> crtl + c </strong>关闭开发服务器。</p><p id="664e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">进入<strong class="iz hj">允许_主机</strong>中的<strong class="iz hj"> hello/settings.py </strong>在列表中添加“<strong class="iz hj"> * </strong>”，如下图所示。</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div class="er es mo"><img src="../Images/36e2fd95aef31e8c92eeee8f8512f927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/0*-d0H3D-0sLuL3spu"/></div></figure><p id="4b4c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">再次运行您的服务器，您应该会看到Django power页面。</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es mn"><img src="../Images/3d4eaa05d79245f1862a479a15ddb8e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RnT6Mp6V7W-RZ5b0"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx translated">Django动力页面</figcaption></figure><h1 id="cef0" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated"><strong class="ak">恭喜！</strong></h1><p id="e44b" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated">您已经成功运行Django应用程序。现在是时候为生产做准备了。</p></div><div class="ab cl mp mq gp mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="hb hc hd he hf"><h1 id="3123" class="kl km hi bd kn ko mw kq kr ks mx ku kv io my ip kx ir mz is kz iu na iv lb lc bi translated">格尼科恩</h1><p id="2318" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated">在生产中，我们不会使用Django的单线程开发服务器，而是一个名为<a class="ae jt" href="https://gunicorn.org/" rel="noopener ugc nofollow" target="_blank"><strong class="iz hj"><em class="ju">guni corn</em></strong></a>的专用应用服务器。</p><ul class=""><li id="0016" class="ld le hi iz b ja jb jd je jg mh jk mi jo mj js mk ll lm ln bi translated">在应用程序的虚拟环境中安装gunicorn</li></ul><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="4bc1" class="mb km hi lx b fi mc md l me mf">pip install gunicorn</span></pre><ul class=""><li id="67fc" class="ld le hi iz b ja jb jd je jg mh jk mi jo mj js mk ll lm ln bi translated">使用Gunicorn服务器测试示例应用程序</li></ul><p id="c8fc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在您已经有了gunicorn，您可以通过运行以下命令来测试它是否可以服务于您的Django应用程序:</p><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="c91f" class="mb km hi lx b fi mc md l me mf">gunicorn hello.wsgi:application --bind 0.0.0.0:8000</span></pre><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es nb"><img src="../Images/90e4f9f49c7e52094b78067032a6a87e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2pB8QhCRwr0uePj6"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx translated">和古尼康一起经营姜戈</figcaption></figure><h2 id="ba06" class="mb km hi bd kn nc nd ne kr nf ng nh kv jg ni nj kx jk nk nl kz jo nm nn lb no bi translated">你现在应该可以从<8000>访问Gunicorn服务器了</8000></h2><p id="0bb2" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated"><strong class="iz hj"> Gunicorn </strong>已安装，并准备好为您的应用程序提供服务。让我们设置一些配置选项，使它更有用。</p><p id="cf89" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我喜欢设置一些参数，所以让我们把它们都放到一个小的BASH脚本中，我把它保存为<strong class="iz hj"> bin/gunicorn_start </strong></p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es np"><img src="../Images/d87c103e0a2b0a20b6bdd89b9f189332.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*usYLlUc577ma8XlE"/></div></div></figure><p id="8f96" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<strong class="iz hj"> bin/gunicorn_start </strong>文件中添加以下行。</p><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="ab12" class="mb km hi lx b fi mc md l me mf">#!/bin/bash</span><span id="32c6" class="mb km hi lx b fi mg md l me mf"># Name of the application<br/>NAME="hello_app"</span><span id="2c15" class="mb km hi lx b fi mg md l me mf"># Django project directory<br/>DJANGODIR=/home/ubuntu/hello_django/hello</span><span id="08a0" class="mb km hi lx b fi mg md l me mf"># we will communicte using this unix socket<br/>SOCKFILE=/home/ubuntu/hello_django/run/gunicorn.sock</span><span id="4aab" class="mb km hi lx b fi mg md l me mf"># the user to run as<br/>USER=ubuntu</span><span id="6b06" class="mb km hi lx b fi mg md l me mf"># the group to run as<br/>GROUP=ubuntu</span><span id="9503" class="mb km hi lx b fi mg md l me mf"># how many worker processes should Gunicorn spawn<br/>NUM_WORKERS=3</span><span id="0c75" class="mb km hi lx b fi mg md l me mf"># which settings file should Django use<br/>DJANGO_SETTINGS_MODULE=hello.settings</span><span id="8278" class="mb km hi lx b fi mg md l me mf"># WSGI module name<br/>DJANGO_WSGI_MODULE=hello.wsgi</span><span id="5885" class="mb km hi lx b fi mg md l me mf">echo "Starting $NAME as `whoami`"</span><span id="139d" class="mb km hi lx b fi mg md l me mf"># Activate the virtual environment<br/>cd $DJANGODIR</span><span id="ad1e" class="mb km hi lx b fi mg md l me mf">source ../bin/activate</span><span id="5baf" class="mb km hi lx b fi mg md l me mf">export DJANGO_SETTINGS_MODULE=$DJANGO_SETTINGS_MODULE</span><span id="ac60" class="mb km hi lx b fi mg md l me mf">export PYTHONPATH=$DJANGODIR:$PYTHONPATH</span><span id="0191" class="mb km hi lx b fi mg md l me mf"># Create the run directory if it doesn't exist<br/>RUNDIR=$(dirname $SOCKFILE)</span><span id="b922" class="mb km hi lx b fi mg md l me mf">test -d $RUNDIR || mkdir -p $RUNDIR</span><span id="27c3" class="mb km hi lx b fi mg md l me mf"># Start your Django Unicorn</span><span id="c174" class="mb km hi lx b fi mg md l me mf"># Programs meant to be run under supervisor should not daemonize themselves (do not use --daemon)</span><span id="b0ee" class="mb km hi lx b fi mg md l me mf">exec ../bin/gunicorn ${DJANGO_WSGI_MODULE}:application \<br/>--name $NAME \<br/>--workers $NUM_WORKERS \<br/>--user=$USER --group=$GROUP \<br/>--bind=unix:$SOCKFILE \<br/>--log-level=debug \<br/>--log-file=-</span></pre><ul class=""><li id="5d1c" class="ld le hi iz b ja jb jd je jg mh jk mi jo mj js mk ll lm ln bi translated">在gunicorn_start脚本上设置可执行位</li></ul><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="e88d" class="mb km hi lx b fi mc md l me mf">sudo chmod u+x bin/gunicorn_start</span></pre><ul class=""><li id="a8f8" class="ld le hi iz b ja jb jd je jg mh jk mi jo mj js mk ll lm ln bi translated">测试<strong class="iz hj"> gunicorn_start </strong>脚本</li></ul><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="b3b1" class="mb km hi lx b fi mc md l me mf">bin/gunicorn_start</span></pre><p id="75d1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您应该会看到类似如下的输出:</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div class="er es nq"><img src="../Images/3e456010a03d2219fe340368cb3a80e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/0*vCCOFtBmrSBe72Ru"/></div></figure><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es nr"><img src="../Images/4032a3de004f67f52149fec48611896d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*at8wz4_FsTyGcaWr"/></div></div></figure><p id="507b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我没有添加完整的截图，只是添加了一个重要的部分。</p><p id="7e99" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当您运行您的<strong class="iz hj"> gunicorn_start </strong>脚本时，它将在<strong class="iz hj">运行/目录</strong>中创建一个套接字。</p><p id="fc1f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您将无法在浏览器中看到任何内容，因为我们<strong class="iz hj">没有使用http端口</strong>，我们使用的是<strong class="iz hj">套接字</strong>，这是一种将Django作为生产服务器运行的更安全的方式。按下<strong class="iz hj"> ctrl + c </strong>打破gunicorn服务器。</p><p id="49d2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意在<strong class="iz hj"> gunicorn_start </strong>中设置的参数。如果你不关注这篇文章，你需要设置路径和文件名来匹配你的设置。</p><p id="36f0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">——NAME(NAME)参数指定您的应用程序将如何在程序中标识自己，如<strong class="iz hj"> <em class="ju"> top或ps </em> </strong>。</p><p id="5a25" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了使<strong class="iz hj"> — name </strong>参数生效，您需要安装一个名为<strong class="iz hj"><em class="ju">set Prog title</em></strong>的Python模块。</p><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="e580" class="mb km hi lx b fi mc md l me mf">pip install setproctitle</span></pre><p id="8a9f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，当您列出进程时，您应该可以看到哪个gunicorn属于哪个应用程序。<strong class="iz hj">别忘了再次启动你的gunicorn服务器</strong>。</p><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="61ac" class="mb km hi lx b fi mc md l me mf">ps aux</span></pre><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es ns"><img src="../Images/5ff0c4a32768309279c12f9a30338f82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JTc4ZEmh6vWq_jXh"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx translated">Gunicorn过程</figcaption></figure><p id="ccad" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你的<strong class="iz hj"> gunicorn_start </strong>脚本现在应该已经准备好并且可以工作了。</p><ul class=""><li id="83fc" class="ld le hi iz b ja jb jd je jg mh jk mi jo mj js mk ll lm ln bi translated">创建文件以存储日志消息:</li></ul><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="9216" class="mb km hi lx b fi mc md l me mf">Make sure you are at /home/ubuntu/hello_django/ path</span><span id="c872" class="mb km hi lx b fi mg md l me mf">mkdir logs</span></pre><p id="5f6d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将使用这个目录来存储我们的应用程序日志和Nginx日志，以便进行调试。</p><h1 id="946c" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated">恭喜你！</h1><p id="966a" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated">我们刚刚完成了本教程最令人兴奋的部分，所以你应该感到自豪。</p><p id="369f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来我们将设置NGINX，然后我们就完成了！我知道这需要一点时间，但是请相信我——一旦完成，你将会和我一样，在出版这篇教程后感到高兴。</p></div><div class="ab cl mp mq gp mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="hb hc hd he hf"><h1 id="6d5b" class="kl km hi bd kn ko mw kq kr ks mx ku kv io my ip kx ir mz is kz iu na iv lb lc bi translated">Nginx</h1><p id="36a0" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated">是时候将Nginx设置为应用程序及其静态文件的服务器了。</p><ul class=""><li id="e9f2" class="ld le hi iz b ja jb jd je jg mh jk mi jo mj js mk ll lm ln bi translated">安装并启动Nginx</li></ul><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="aaed" class="mb km hi lx b fi mc md l me mf">sudo apt-get install nginx</span><span id="7c4f" class="mb km hi lx b fi mg md l me mf">sudo service nginx start</span></pre><p id="fc94" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">每个Nginx虚拟服务器应该由/etc/nginx/sites-available目录中的一个文件来描述。您可以通过创建指向/etc/nginx/sites-enabled目录中的站点的符号链接来选择要启用的站点。</p><p id="4ade" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">默认情况下，只有一个名为<strong class="iz hj"> default </strong>的配置文件具有NGINX的基本设置。您可以修改它或创建一个新的。在我们的例子中，我将删除它:</p><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="3fa9" class="mb km hi lx b fi mc md l me mf">sudo rm -rf /etc/nginx/sites-available/default</span><span id="933b" class="mb km hi lx b fi mg md l me mf">sudo rm -rf /etc/nginx/sites-enabled/default</span></pre><ul class=""><li id="683b" class="ld le hi iz b ja jb jd je jg mh jk mi jo mj js mk ll lm ln bi translated">创建新的nginx服务器配置文件</li></ul><p id="8895" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">须藤纳米/etc/nginx/sites-available/hello</strong></p><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="234d" class="mb km hi lx b fi mc md l me mf">upstream hello_app_server {</span><span id="1d4e" class="mb km hi lx b fi mg md l me mf"># fail_timeout=0 means we always retry an upstream even if it failed</span><span id="4f8c" class="mb km hi lx b fi mg md l me mf"># to return a good HTTP response (in case the Unicorn master nukes a</span><span id="f137" class="mb km hi lx b fi mg md l me mf"># single worker for timing out).</span><span id="11fb" class="mb km hi lx b fi mg md l me mf">server unix:/home/ubuntu/hello_django/run/gunicorn.sock fail_timeout=0;</span><span id="5cba" class="mb km hi lx b fi mg md l me mf">}</span><span id="816d" class="mb km hi lx b fi mg md l me mf">server {</span><span id="cbb9" class="mb km hi lx b fi mg md l me mf">listen   80;</span><span id="df03" class="mb km hi lx b fi mg md l me mf">server_name example.com;</span><span id="92b6" class="mb km hi lx b fi mg md l me mf">client_max_body_size 4G;</span><span id="91d8" class="mb km hi lx b fi mg md l me mf">access_log /home/ubuntu/hello_django/logs/nginx-access.log;</span><span id="6ea1" class="mb km hi lx b fi mg md l me mf">error_log /home/ubuntu/hello_django/logs/nginx-error.log;</span><span id="4ae7" class="mb km hi lx b fi mg md l me mf">location /static/ {</span><span id="9ccd" class="mb km hi lx b fi mg md l me mf">alias   /home/ubuntu/hello_django/static/;</span><span id="b735" class="mb km hi lx b fi mg md l me mf">}</span><span id="fc03" class="mb km hi lx b fi mg md l me mf">location /media/ {</span><span id="884e" class="mb km hi lx b fi mg md l me mf">alias   /home/ubuntu/hello_django/media/;</span><span id="9c56" class="mb km hi lx b fi mg md l me mf">}</span><span id="7561" class="mb km hi lx b fi mg md l me mf">location / {</span><span id="a870" class="mb km hi lx b fi mg md l me mf"># an HTTP header important enough to have its own Wikipedia entry:</span><span id="ce79" class="mb km hi lx b fi mg md l me mf">#   http://en.wikipedia.org/wiki/X-Forwarded-For</span><span id="9a4b" class="mb km hi lx b fi mg md l me mf">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><span id="270d" class="mb km hi lx b fi mg md l me mf"># enable this if and only if you use HTTPS, this helps Rack</span><span id="56de" class="mb km hi lx b fi mg md l me mf"># set the proper protocol for doing redirects:</span><span id="12cb" class="mb km hi lx b fi mg md l me mf"># proxy_set_header X-Forwarded-Proto https;</span><span id="0366" class="mb km hi lx b fi mg md l me mf"># pass the Host: header from the client right along so redirects</span><span id="e7b1" class="mb km hi lx b fi mg md l me mf"># can be set properly within the Rack application</span><span id="c82f" class="mb km hi lx b fi mg md l me mf">proxy_set_header Host $http_host;</span><span id="ca43" class="mb km hi lx b fi mg md l me mf"># we don't want nginx trying to do something clever with</span><span id="76f9" class="mb km hi lx b fi mg md l me mf"># redirects, we set the Host: header above already.</span><span id="5b6a" class="mb km hi lx b fi mg md l me mf">proxy_redirect off;</span><span id="5059" class="mb km hi lx b fi mg md l me mf"># set "proxy_buffering off" *only* for Rainbows! when doing</span><span id="e805" class="mb km hi lx b fi mg md l me mf"># Comet/long-poll stuff.  It's also safe to set if you're</span><span id="2d48" class="mb km hi lx b fi mg md l me mf"># using only serving fast clients with Unicorn + nginx.</span><span id="e382" class="mb km hi lx b fi mg md l me mf"># Otherwise you _want_ nginx to buffer responses to slow</span><span id="b442" class="mb km hi lx b fi mg md l me mf"># clients, really.</span><span id="746b" class="mb km hi lx b fi mg md l me mf"># proxy_buffering off;</span><span id="03cd" class="mb km hi lx b fi mg md l me mf"># Try to serve static files from nginx, no point in making an</span><span id="87c3" class="mb km hi lx b fi mg md l me mf"># *application* server like Unicorn/Rainbows! serve static files.</span><span id="d749" class="mb km hi lx b fi mg md l me mf">if (!-f $request_filename) {</span><span id="f564" class="mb km hi lx b fi mg md l me mf">proxy_pass http://hello_app_server;</span><span id="012b" class="mb km hi lx b fi mg md l me mf">break;</span><span id="9c2b" class="mb km hi lx b fi mg md l me mf">}</span><span id="aa5a" class="mb km hi lx b fi mg md l me mf">}</span><span id="91a3" class="mb km hi lx b fi mg md l me mf"># Error pages</span><span id="ecd2" class="mb km hi lx b fi mg md l me mf">error_page 500 502 503 504 /500.html;</span><span id="c5c4" class="mb km hi lx b fi mg md l me mf">location = /500.html {</span><span id="b04d" class="mb km hi lx b fi mg md l me mf">root /home/ubuntu/hello_django/static/;</span><span id="1724" class="mb km hi lx b fi mg md l me mf">}</span><span id="90a5" class="mb km hi lx b fi mg md l me mf">}</span></pre><ul class=""><li id="0aed" class="ld le hi iz b ja jb jd je jg mh jk mi jo mj js mk ll lm ln bi translated">在启用站点的文件夹中创建符号链接</li></ul><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="3858" class="mb km hi lx b fi mc md l me mf">sudo ln -s /etc/nginx/sites-available/hello /etc/nginx/sites-enabled/hello</span></pre><ul class=""><li id="4979" class="ld le hi iz b ja jb jd je jg mh jk mi jo mj js mk ll lm ln bi translated">重启Nginx</li></ul><pre class="jw jx jy jz fd lw lx ly lz aw ma bi"><span id="35bd" class="mb km hi lx b fi mc md l me mf">sudo service nginx restart</span></pre><p id="1b7a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在你的nginx已经准备好服务请求，它将把请求转发给你的应用程序，但是对于这个<strong class="iz hj">，要确保你有一个运行</strong>的gunicorn服务器。</p><p id="3510" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">转到您的浏览器，键入<strong class="iz hj"><em class="ju">&lt;ec2-instance-DNS&gt;</em></strong>这将向nginx发送一个请求，然后它会将该请求转发到您运行gunicorn的服务器。</p><h1 id="00be" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated">恭喜你！</h1><p id="2e4a" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated">您已经使用<strong class="iz hj"> Nginx </strong>和<strong class="iz hj"> Gunicorn </strong>成功运行了您的<strong class="iz hj"> Django </strong>应用程序。</p><p id="0bf6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<a class="ae jt" rel="noopener" href="/@harshvijaythakkar/setting-up-django-with-nginx-gunicorn-and-docker-352f7656f869"> <strong class="iz hj"> <em class="ju">第二部分</em> </strong> </a>中，我解释了如何在<strong class="iz hj"> Docker </strong>容器中使用Nginx和Gunicorn运行Django应用程序。</p><p id="55ba" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">谢谢大家！</p></div></div>    
</body>
</html>