<html>
<head>
<title>Statistical Approach to Stock Price Prediction: Naive Forecast, Moving Average</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">股价预测的统计方法:简单预测、移动平均线</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/statistical-approach-to-stock-price-prediction-naive-forecast-moving-average-40f93e221e06?source=collection_archive---------9-----------------------#2020-05-10">https://medium.com/analytics-vidhya/statistical-approach-to-stock-price-prediction-naive-forecast-moving-average-40f93e221e06?source=collection_archive---------9-----------------------#2020-05-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f19e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们用一些基本的统计方法来预测股票价格。我们将首先学习这些方法的含义，然后快速实现代码。你会惊讶地发现这些简单的方法有很高的精确度！</p><p id="1a08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们在股价预测下的第二篇博客。我们本系列的第一篇博客提供了一个简单易懂的脸书预言家指南，这是一个预测时间序列的预训练模型。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/2365a3b8a8782f2c71b1345734402470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rz_QvtXeqqHm5SIa.jpeg"/></div></div></figure><h1 id="479f" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">天真的预测</strong></h1><p id="5326" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">朴素预测是预测股票价格的最基本方法。这种方法宣扬预测只不过是前一个时间戳的变量值。<br/>例如，在时间戳是一天的数据集中，明天的预测开盘股价就是今天的开盘价。虽然简单，但它产生了惊人的结果！自己试试！</p><p id="a601" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">天真预测如此有效的原因是因为像股票价格这样的变量高度依赖于它们过去的价值。因为股票价格不可能突然变化。前一天的值通常非常接近第二天的值。</p><p id="c66b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，这种方法没有被广泛使用的原因是，大多数时候，我们希望预测未来几天而不是某一天的股票价格。这种方法不能用于这种情况。</p><h1 id="7f46" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">实施天真预测</strong></h1><p id="acae" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">如上所述，天真预测只是指预测前一天的价值。下面是实现它的代码。</p><pre class="jf jg jh ji fd kt ku kv kw aw kx bi"><span id="8cba" class="ky jr hi ku b fi kz la l lb lc">def lag_features(df , N , col , col_index):<br/>"adds lag features of the given columnb for previous N days"<br/>series = df[col]<br/>for i in range(N):<br/>shifted_rows = np.zeros(len(df))<br/>shifted_rows[:] = np.nan<br/>array_index = i+1<br/>for j in range(len(df)-(i+1)):<br/>shifted_rows[array_index] = df.iloc[j,col_index]<br/>array_index = array_index + 1<br/>df[col+'_lag_'+str(i+1)] = shifted_rows<br/>return df</span></pre><p id="a48f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的代码片段向数据集中添加了一个“滞后要素”。滞后特征是前几天的值。例如，lag_1表示前一天的值。类似地，lag_2表示两天前股票的价值。诸如此类。在上面的代码中，N代表滞后特性的数量。对于简单预测方法，N=1。</p><pre class="jf jg jh ji fd kt ku kv kw aw kx bi"><span id="9427" class="ky jr hi ku b fi kz la l lb lc">stock_prices_w_lag = lag_features(stock_prices,1,'OPEN',0)</span></pre><p id="a4f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在应用该函数时，会创建一个名为“<col_name> _lag_1”的新列(其中col_name是您要预测的值:open、close等)。</col_name></p><p id="834e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看通过简单方法预测的值与实际值有多接近:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ld"><img src="../Images/c03d769db802a493e18816cdfe7fdb5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OrCyX_-0rKHKgXVN5qGWjg.png"/></div></div></figure><p id="91c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以通过这些流行的方法来量化精度:均方误差、平均绝对误差、平均绝对百分比误差。</p><pre class="jf jg jh ji fd kt ku kv kw aw kx bi"><span id="9428" class="ky jr hi ku b fi kz la l lb lc">#Naive forecast is OPEN_lag_1</span><span id="8e04" class="ky jr hi ku b fi le la l lb lc">print(mean_squared_error(np.array(stock_prices.iloc[1:, 0]) , np.array(stock_prices.iloc[1:,-1])))</span><span id="4f56" class="ky jr hi ku b fi le la l lb lc">print(mean_absolute_error(np.array(stock_prices.iloc[1:, 0]) , np.array(stock_prices.iloc[1:,-1])))</span><span id="c97c" class="ky jr hi ku b fi le la l lb lc">print(mean_absolute_percentage_error(np.array(stock_prices.iloc[1:, 0]) , np.array(stock_prices.iloc[1:,-1])))</span></pre><p id="852d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">计算指标时，记得删除数据帧的第一行。为什么？因为你不能用简单的预测来预测第一天的价值！</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lf"><img src="../Images/3e63876cfed0e6ca52e01fe88a2f30e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*xs7mc1KTJuhEmPMweUmcxw.png"/></div><figcaption class="lg lh et er es li lj bd b be z dx translated">天真预测的结果。</figcaption></figure><h1 id="4b5b" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">移动平均预测</strong></h1><p id="94d6" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">我们知道股票的未来价值取决于股票的过去价值。简单预测只考虑一个过去的值。如果我们可以使用一种不是一个，而是最后10、12、15或20个值的方法会怎么样！？<br/>均线预测才是出路！第二天的股票价格被预测为股票价格的N个过去值的平均值。</p><p id="d53c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">n是我们考虑的先前值的数量，更好的说法是移动窗口的大小。我们通过计算各种滞后特征(滞后_1、滞后_ 2…滞后_25等)来决定这个值。).然后，我们选择与实际值列高度相关(通常在99%以上)的滞后特性。</p><p id="4336" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lk">使用相同的方法，我们为数据集选择N=7。</em></p><h1 id="e67a" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">实施移动平均预测</strong></h1><p id="ab6b" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">求移动平均预测相当于求最后N个值的平均值。</p><pre class="jf jg jh ji fd kt ku kv kw aw kx bi"><span id="9523" class="ky jr hi ku b fi kz la l lb lc">def moving_avg_std(df ,col ,N ,col_index):<br/>moving_mean = df[col].rolling(window = N, min_periods=1).mean()<br/>moving_mean = np.concatenate((np.array([np.nan]), np.array(moving_mean[:-1])))<br/>df[col + '_mean'] = moving_mean</span></pre><p id="82f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码中，df[col]。rolling()从该列的第一个条目创建一个大小为N的窗口。该窗口返回时间戳t的<em class="lk"> t，t -1 …，<br/> t-(N-1) </em>行(如果N行不可能，则给出最大可能值)。这解决了我们创建窗口的问题。</p><p id="844a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是有一个问题！因为我们要预测时间戳‘t’处的值，所以我们需要<em class="lk"> t-1，t-2，..t-N </em>而不是<em class="lk"> t，t-2，…时间+1。</em>这意味着我们只需要将我们的值移动一行。为此，我们在开头附加NaN。这是合乎逻辑的，因为在t=0时，我们不能有任何移动平均预测，因为我们不知道t=-1时的值。</p><p id="e48a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看移动平均预测值与实际值有多接近:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ll"><img src="../Images/19559a8b6a9c30b132671270ff9e23cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vepk3qEBFx0TKDkPSGkIZQ.png"/></div></div></figure><p id="5844" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用之前讨论的指标评估上述预测:</p><pre class="jf jg jh ji fd kt ku kv kw aw kx bi"><span id="176f" class="ky jr hi ku b fi kz la l lb lc">#Moving Average Forecast is OPEN_mean</span><span id="a52c" class="ky jr hi ku b fi le la l lb lc">print(mean_squared_error(np.array(stock_prices.iloc[1:, 0]) , np.array(stock_prices.iloc[1:,-1])))</span><span id="fe9c" class="ky jr hi ku b fi le la l lb lc">print(mean_absolute_error(np.array(stock_prices.iloc[1:, 0]) , np.array(stock_prices.iloc[1:,-1])))</span><span id="c508" class="ky jr hi ku b fi le la l lb lc">print(mean_absolute_percentage_error(np.array(stock_prices.iloc[1:, 0]) , np.array(stock_prices.iloc[1:,-1])))</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lm"><img src="../Images/d3940c887a109706988d41bfba31ad5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:742/format:webp/1*Y46jN0Dq9Qnv0RE_BLGOQw.png"/></div><figcaption class="lg lh et er es li lj bd b be z dx translated">移动平均预测的结果。</figcaption></figure><h1 id="85f5" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">结论</h1><p id="bcf1" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">然而，简单，移动平均线和天真的预测给出了非常好的结果！出人意料的是，甚至比<a class="ae jd" rel="noopener" href="/analytics-vidhya/stock-price-prediction-facebook-prophet-34c385ff05a9?source=your_stories_page---------------------------">先知</a>还要厉害！</p><p id="de0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该博客由奈蒂克·汉德尔瓦尔和尼基塔·萨克塞纳撰写和编辑。你可以在这里查看我们的Github代码！:<a class="ae jd" href="https://github.com/nikita-0209/stock_price_detection/blob/master/Stock_Prediction%3ANaive%20Forecast%2C%20Moving%20Averages.ipynb" rel="noopener ugc nofollow" target="_blank">尼基塔</a>，<a class="ae jd" href="https://github.com/Naitik1502/Statistical-Approach-to-Stock-Price-Prediction-Naive-Forecast-Moving-Average/blob/master/Moving_Avg_Stock_Prices.ipynb" rel="noopener ugc nofollow" target="_blank">奈提克</a>。</p></div></div>    
</body>
</html>