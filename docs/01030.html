<html>
<head>
<title>Combining Scikit-Learn Pipelines with CatBoost and Dask (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Scikit-Learn管道与CatBoost和Dask结合起来(第2部分)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/combining-scikit-learn-pipelines-with-catboost-and-dask-part-2-9240242966a7?source=collection_archive---------4-----------------------#2019-09-26">https://medium.com/analytics-vidhya/combining-scikit-learn-pipelines-with-catboost-and-dask-part-2-9240242966a7?source=collection_archive---------4-----------------------#2019-09-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2d63c13d7b63daeb8dc608c3e36ba137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k4_8pgqLxZA0JG3v"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">约翰·贝克在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="974e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当我们在将Sklearn管道与Catboost和Dask相结合的迷雾中继续我们孤独的旅程时，当我们将Catboost模型集成到我上一篇文章的结果项目中时，我们开始看到管道尽头的亮光(绝对是双关语)。</p><p id="8cd6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我之前的<a class="ae iu" rel="noopener" href="/@kigelman.nir/combining-scikit-learn-pipelines-with-catboost-and-dask-part-1-c08d67b44815">帖子</a>中，我谈到了如何使用sklearn-pandas包和sklearn管道来维护整个管道中的数据帧结构。</p><div class="jt ju ez fb jv jw"><a rel="noopener follow" target="_blank" href="/@kigelman.nir/combining-scikit-learn-pipelines-with-catboost-and-dask-part-1-c08d67b44815"><div class="jx ab dw"><div class="jy ab jz cl cj ka"><h2 class="bd hj fi z dy kb ea eb kc ed ef hh bi translated">将Scikit-Learn管道与CatBoost和Dask结合起来(第1部分)</h2><div class="kd l"><h3 class="bd b fi z dy kb ea eb kc ed ef dx translated">我写这篇文章是为了帮助那些像我一样迷失在管道、CatBoost模型和Dask领域的人…</h3></div><div class="ke l"><p class="bd b fp z dy kb ea eb kc ed ef dx translated">medium.com</p></div></div><div class="kf l"><div class="kg l kh ki kj kf kk io jw"/></div></div></a></div><p id="6f99" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这篇文章中，我将谈论如何集成CatBoost模型，以及为什么这是一个问题。</p><h1 id="88b4" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">问题是</h1><p id="d1b5" class="pw-post-body-paragraph iv iw hi ix b iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo ln jq jr js hb bi translated">让我们从为什么我要写一篇关于使用Catboost模型的帖子开始…这肯定是一个简单的任务，就像我们从Sklearn了解并喜欢的其他模型一样。的确如此。</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div class="er es lo"><img src="../Images/16f56de638d7e7136518704b61072128.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*MGu5Yg7-Y-IZtqT6"/></div></figure><p id="e04d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当我们想要将Catboost模型合并到一个可以在运行时改变数据结构的动态管道中时，问题就出现了。<br/>为什么这是一个问题？因为我们使用Catboost来支持分类特征，并且如果我们希望Catboost发挥其魔力，我们需要让他知道我们的数据中有哪些分类特征，但是我们开始使用的特征不是Catboost模型将满足的特征。<br/>Catboost模型将满足我们在管道中的后续步骤将确定的一些随机特性集。</p><p id="16a2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了克服这个问题，我们需要以某种方式跟踪我们的分类特征，因此Catboost模型将知道剩余的分类特征是什么。</p><h1 id="fe5e" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">解决方案</h1><p id="16cd" class="pw-post-body-paragraph iv iw hi ix b iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo ln jq jr js hb bi translated">我发现最有效和最简单的解决方案是在每个分类特征后添加一个后缀，用一个常量字符串表示这是一个分类特征。<br/>然后，我们可以编写自己的简单定制Catboost，在运行时检索包含分类后缀的列名。</p><h1 id="4864" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">代码示例</h1><p id="4c3b" class="pw-post-body-paragraph iv iw hi ix b iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo ln jq jr js hb bi translated">继续我之前的<a class="ae iu" rel="noopener" href="/@kigelman.nir/combining-scikit-learn-pipelines-with-catboost-and-dask-part-1-c08d67b44815">帖子</a>中的例子。<br/>首先，我们需要定义分类后缀字符串。</p><figure class="lp lq lr ls fd ij"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="d349" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，我们需要将这个后缀添加到我们的分类特征中。</p><figure class="lp lq lr ls fd ij"><div class="bz dy l di"><div class="lt lu l"/></div></figure><figure class="lp lq lr ls fd ij"><div class="bz dy l di"><div class="lt lu l"/></div></figure><h2 id="c663" class="lv km hi bd kn lw lx ly kr lz ma mb kv jg mc md kz jk me mf ld jo mg mh lh mi bi translated">自定义Catboost分类器</h2><p id="18c5" class="pw-post-body-paragraph iv iw hi ix b iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo ln jq jr js hb bi translated">现在，我们创建自己的自定义Catboost分类器，并在运行时使用参数“cat_features”调用fit方法。</p><figure class="lp lq lr ls fd ij"><div class="bz dy l di"><div class="lt lu l"/></div></figure><h2 id="26d4" class="lv km hi bd kn lw lx ly kr lz ma mb kv jg mc md kz jk me mf ld jo mg mh lh mi bi translated">特征选择</h2><p id="2be7" class="pw-post-body-paragraph iv iw hi ix b iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo ln jq jr js hb bi translated">为了在我们的管道中加入一个特性选择步骤，我们需要确保特性选择转换方法将返回一个数据帧，这样带有分类后缀的列名将保持不变。</p><figure class="lp lq lr ls fd ij"><div class="bz dy l di"><div class="lt lu l"/></div></figure><h2 id="6306" class="lv km hi bd kn lw lx ly kr lz ma mb kv jg mc md kz jk me mf ld jo mg mh lh mi bi translated">把所有的放在一起</h2><p id="27cd" class="pw-post-body-paragraph iv iw hi ix b iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo ln jq jr js hb bi translated">最终，我们的管道应该是这样的:</p><figure class="lp lq lr ls fd ij"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="55ac" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">我的</strong> <a class="ae iu" href="https://github.com/kinir/catboost-with-pipelines/blob/master/sklearn-pandas-catboost.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj"> GitHub </strong> </a> <strong class="ix hj">上有更丰富的例子包括网格搜索过程的笔记本。</strong></p><div class="jt ju ez fb jv jw"><a href="https://github.com/kinir/catboost-with-pipelines" rel="noopener  ugc nofollow" target="_blank"><div class="jx ab dw"><div class="jy ab jz cl cj ka"><h2 class="bd hj fi z dy kb ea eb kc ed ef hh bi translated">kinir/catboost-带管道</h2><div class="kd l"><h3 class="bd b fi z dy kb ea eb kc ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ke l"><p class="bd b fp z dy kb ea eb kc ed ef dx translated">github.com</p></div></div><div class="kf l"><div class="mj l kh ki kj kf kk io jw"/></div></div></a></div><h1 id="f6c0" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">结论</h1><p id="c9a3" class="pw-post-body-paragraph iv iw hi ix b iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo ln jq jr js hb bi translated">在本文的第2部分中，我解释了如何将CatBoost模型与Sklearn管道集成，并且仍然能够使用其fit方法的“cat_features”参数。在本文的第3部分，我将解释如何将Dask集成到我们现有的代码中。</p><p id="aa12" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">未完待续…</p></div></div>    
</body>
</html>