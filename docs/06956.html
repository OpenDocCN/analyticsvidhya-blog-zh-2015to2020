<html>
<head>
<title>Predicting churn with PySpark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用PySpark预测客户流失</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/predicting-churn-with-pyspark-sparkify-capstone-project-5ad91781c491?source=collection_archive---------13-----------------------#2020-06-08">https://medium.com/analytics-vidhya/predicting-churn-with-pyspark-sparkify-capstone-project-5ad91781c491?source=collection_archive---------13-----------------------#2020-06-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="6e74" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">你想搅拌吗？</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/251014ebad4a19ab0fff86cc7bbfec43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HHlYjoiymJJEPUl7-NaW7A.png"/></div></div></figure><p id="2a03" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi kf translated">今天，我们将讨论<em class="ko">客户流失预测</em>，这是订阅服务最重要的话题之一。及早发现哪些用户最有可能取消订阅有助于主动采取行动，并确定改进点，如更好的目录或界面，甚至是新的推荐引擎。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es kp"><img src="../Images/cb0a8af55311211c03e4f0b762ff3219.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*393J30bvfwYyJi6Ndkm1Xw.jpeg"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated"><strong class="bd ku">来源</strong> : <a class="ae kv" href="https://towardsdatascience.com/machine-learning-powered-churn-analysis-for-modern-day-business-leaders-ad2177e1cb0d" rel="noopener" target="_blank">机器学习驱动的现代商业领袖流失分析</a></figcaption></figure><h1 id="f89f" class="kw kx hi bd ku ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">显示一些数字</h1><p id="62d9" class="pw-post-body-paragraph jj jk hi jl b jm ln ij jo jp lo im jr js lp ju jv jw lq jy jz ka lr kc kd ke hb bi translated">有很多关于获取新客户的成本与保留新客户的成本的信息。我非常怀疑这些重复数字的准确性，但它们似乎对一些企业有意义。<br/>有人估计，获得一个新客户的成本<a class="ae kv" href="https://www.outboundengine.com/blog/customer-retention-marketing-vs-customer-acquisition-marketing/#:~:text=Acquiring%20a%20new%20customer%20can,customer%20is%205%2D20%25." rel="noopener ugc nofollow" target="_blank"> <strong class="jl hj">是留住它的成本</strong> </a>的五倍。而客户留存率仅仅增加<strong class="jl hj"> 5% </strong>就能导致<strong class="jl hj">利润增长到5%-95% </strong>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es kp"><img src="../Images/8faee403c7ca9e8ef693e327b55903ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*JVIRmyZDHBzBO7ojJyWZmA.jpeg"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">来源:<a class="ae kv" href="https://d6v887nm5k51d.cloudfront.net/wp-content/uploads/2017/09/customer-service-big-deal.jpg" rel="noopener ugc nofollow" target="_blank">https://d6v 887 nm5 k51d . cloudfront . net/WP-content/uploads/2017/09/customer-service-big-deal . jpg</a></figcaption></figure><p id="37c8" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们继续吧。</p><h1 id="11d4" class="kw kx hi bd ku ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">背景</h1><p id="78fe" class="pw-post-body-paragraph jj jk hi jl b jm ln ij jo jp lo im jr js lp ju jv jw lq jy jz ka lr kc kd ke hb bi translated">提供的数据来自一个名为<strong class="jl hj"> <em class="ko"> Sparkify </em> </strong>的订阅服务。该数据由Udacity提供，作为研究数据科学家Nanodegree的可选项目。在它上面，有数以千计的用户操作，包括注册、降级、升级等等。用户可以随时播放歌曲、喜欢或不喜欢、创建播放列表、添加朋友，甚至看到广告。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ls"><img src="../Images/a94c5c4635d174450ec518b840447e28.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*Jn0xOrdTdJSORiFqDcvEQw.png"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">来源:Udacity视频</figcaption></figure><p id="8302" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">所有这些信息使我们能够跟踪用户一生中的消费情况，并发现取消或未取消的用户之间的模式。</p><h1 id="4b15" class="kw kx hi bd ku ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">数据</h1><p id="6396" class="pw-post-body-paragraph jj jk hi jl b jm ln ij jo jp lo im jr js lp ju jv jw lq jy jz ka lr kc kd ke hb bi translated">原始数据在大约<strong class="jl hj"> 12Gb </strong>中有大约<strong class="jl hj"> 26.259.199 </strong>个唯一事件，其中有<strong class="jl hj"> 22.278 </strong>个客户数据。</p><h2 id="3a96" class="lt kx hi bd ku lu lv lw lb lx ly lz lf js ma mb lh jw mc md lj ka me mf ll mg bi translated">特征</h2><ul class=""><li id="618e" class="mh mi hi jl b jm ln jp lo js mj jw mk ka ml ke mm mn mo mp bi translated"><strong class="jl hj">艺术家</strong>:艺术家姓名(如果事件是播放的歌曲)</li><li id="9b5c" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> auth </strong>:如果用户已经登录</li><li id="76e1" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">名字</strong>:用户的名字</li><li id="35d6" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">性别</strong>:用户的性别</li><li id="17a7" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> itemInSession </strong>:会话中事件的编号</li><li id="b099" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">姓氏</strong>:用户的姓氏</li><li id="03ca" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">长度</strong>:歌曲的长度(如果事件是一首播放的歌曲)</li><li id="3d61" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">等级</strong>:会员等级(0 —免费或1 —付费)</li><li id="01b9" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">位置</strong>:用户所在的州/城市</li><li id="58d8" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">方法</strong>:事件的HTTP方法(如GET监听，load，POST，to更新，在服务器上做一个改变。)</li><li id="a6e2" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">页面</strong>:页面名称(如主页、设置)</li><li id="cc87" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">注册</strong>:用户注册时的时间戳</li><li id="fa47" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> sessionId </strong>:会话Id(自登录后)</li><li id="8c6f" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">歌曲</strong>:歌曲名称(如果事件是播放的歌曲)</li><li id="1d02" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">状态</strong>:事件的HTTP状态码(如200成功，500错误)</li><li id="7d7b" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated">ts :事件的时间戳</li><li id="c7bf" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">用户代理</strong>:用户的浏览器</li><li id="db24" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> userId </strong>:服务上的用户Id</li></ul><h2 id="1cf6" class="lt kx hi bd ku lu lv lw lb lx ly lz lf js ma mb lh jw mc md lj ka me mf ll mg bi translated">事件摘要:</h2><pre class="iy iz ja jb fd mv mw mx my aw mz bi"><span id="07ce" class="lt kx hi mw b fi na nb l nc nd"># Spark Code<br/>_df = df.groupBy('page').count().orderBy('count', ascending = False)<br/>_df.show(50, truncate = False)</span><span id="1f07" class="lt kx hi mw b fi ne nb l nc nd"># Output<br/>+-------------------------+--------+<br/>|page                     |count   |<br/>+-------------------------+--------+<br/>|NextSong                 |20850272|<br/>|Home                     |1343102 |<br/>|Thumbs Up                |1151465 |<br/>|Add to Playlist          |597921  |<br/>|Roll Advert              |385212  |<br/>|Add Friend               |381664  |<br/>|Login                    |296350  |<br/>|Logout                   |296005  |<br/>|Thumbs Down              |239212  |<br/>|Downgrade                |184240  |<br/>|Help                     |155100  |<br/>|Settings                 |147074  |<br/>|About                    |92759   |<br/>|Upgrade                  |50507   |<br/>|Save Settings            |29516   |<br/>|Error                    |25962   |<br/>|Submit Upgrade           |15135   |<br/>|Submit Downgrade         |6494    |<br/>|Cancel                   |5003    |<br/>|Cancellation Confirmation|5003    |<br/>|Register                 |802     |<br/>|Submit Registration      |401     |<br/>+-------------------------+--------+</span></pre><h1 id="545a" class="kw kx hi bd ku ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">分析</h1><p id="46dc" class="pw-post-body-paragraph jj jk hi jl b jm ln ij jo jp lo im jr js lp ju jv jw lq jy jz ka lr kc kd ke hb bi translated">通过查看数据，我们得到<em class="ko">付费</em>用户的样本为<strong class="jl hj"> 5.030 </strong>(占总数的22.58%)和<em class="ko">免费</em>会员<strong class="jl hj"> 17.248 </strong>(占总数的77.42%)。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nf"><img src="../Images/d1d0ac5a15c60307abcb0fea9398e701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZRR2RspO9h_WAZxJ0EgaZg.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">按订阅类型划分的流失</figcaption></figure><p id="8721" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><em class="ko">付费</em>用户的流失率约为<strong class="jl hj"> 1.239 </strong> (24.63%)，而<em class="ko">免费</em>用户<em class="ko">的流失率约为<strong class="jl hj"> 3.764 </strong> (21.82%)。如果我们看百分比而不是绝对数字，两组的流失率几乎相同。按<em class="ko">性别</em>流失也是如此。</em></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ng"><img src="../Images/019b408b49be21b2d9e181c3556fe8c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UeMy8TiUGKPlWB_-EXdkRg.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">按性别划分的流失——男性或女性</figcaption></figure><p id="9af2" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">考虑到<em class="ko">降级事件</em>，意味着某付费用户并没有取消订阅，而是迁移到了免费计划。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nf"><img src="../Images/a0c99f777f8c0275751a67fbb9477ee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*guAkCuSgfqD_kcG1bInqww.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">未降级用户(0)与降级用户(1)之间的流失</figcaption></figure><p id="f919" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">从<strong class="jl hj"> 4.017 </strong>用户<em class="ko">降级</em>开始，围绕<strong class="jl hj"> 873 </strong> (21.73%)对未来产生了翻腾。考虑到从来没有降级过<strong class="jl hj"> 17.175 </strong>的用户，大概<strong class="jl hj"> 3.860 </strong> (22.47%)最后都搅黄了。同样，这两组非常相似。</p><h2 id="bbaa" class="lt kx hi bd ku lu lv lw lb lx ly lz lf js ma mb lh jw mc md lj ka me mf ll mg bi translated">数据清理</h2><p id="7989" class="pw-post-body-paragraph jj jk hi jl b jm ln ij jo jp lo im jr js lp ju jv jw lq jy jz ka lr kc kd ke hb bi translated">在数据中，大约778.479条记录没有用户标识，或者没有登录。此外，在这一步中，我已经为每个用户及其会话创建了时间窗口。<a class="ae kv" href="https://databricks.com/blog/2015/07/15/introducing-window-functions-in-spark-sql.html" rel="noopener ugc nofollow" target="_blank">窗口函数</a>是Pyspark上的一个特性，它简化了为某个标准选择一些行的任务。</p><p id="8998" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">通过使用这个，很容易计算出一个会话和另一个会话之间的时间间隔，甚至是每个会话中播放歌曲的总时间。实际上，其中许多可以通过现有的函数来实现，如group by。但是，对于窗口函数，我们只能有一个组函数，我们使用的参数创建了这些“逻辑时间窗口”。</p><p id="1bf2" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">像上一页/事件、经过的时间、第一个事件和最后一个事件等列也是在此时创建的。</p><ul class=""><li id="8256" class="mh mi hi jl b jm jn jp jq js nh jw ni ka nj ke mm mn mo mp bi translated"><strong class="jl hj">注意:</strong>对于这个项目，我发现有些小数据集的一些记录不在完整版本中。也许，我会在未来检查这一点，看看我们是否可以从小数据集获得更多的样本，或者这只是一个错误。</li></ul><h1 id="72d0" class="kw kx hi bd ku ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">特征工程</h1><p id="8c3e" class="pw-post-body-paragraph jj jk hi jl b jm ln ij jo jp lo im jr js lp ju jv jw lq jy jz ka lr kc kd ke hb bi translated">在这一部分中，我们将从现有特征中创建其他特征。例如，用户在页面<strong class="jl hj">提交降级</strong>上发生事件的次数成为降级次数。</p><p id="d8f5" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">有些特征被忽略了，比如名字和姓氏，因为从客户流失的角度来看，它们似乎是不相关的。其他的，比如位置和用户代理，很复杂，很难提取重要的信息。例如，在未来，随着更多的数据，我们可以发现，对于一些平台，一些用户正在经历的问题，但现在，我只是忽略他们。</p><p id="0d1a" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">调整时间窗</strong></p><p id="c12f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我尝试了几种方法，这些方法确实将行为(喜欢、不喜欢、广告等等)与时间度量联系起来，比如从注册开始的时间、所有会话时间的总和等等。最后，最成功的方法是考虑用户播放音乐和其他行为的时间。例如，为了考虑广告与时间的关系，我们将广告的观看次数除以以小时为单位的播放时间。所以，如果一个用户平均有<strong class="jl hj"> 10个广告</strong>和一个会话<strong class="jl hj"> 100小时</strong>听<strong class="jl hj">音乐</strong>，<strong class="jl hj"> session_avg_ads </strong>将是<strong class="jl hj"> 0.1 </strong>。通过这样做，我们可以对新老用户进行公平的比较。例如，一个老用户可能有<strong class="jl hj"> 100个广告</strong>和1000小时的音乐，这也给出了一个<strong class="jl hj"> session_avg_ads </strong>的<strong class="jl hj"> 0.1 </strong>。</p><p id="c045" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这个概念的另一个应用是在足球上。一场比赛进展顺利的一个很好的指标是平均比赛时间。足球的目的是玩它，在Sparkify，我相信是听音乐。</p><h2 id="f709" class="lt kx hi bd ku lu lv lw lb lx ly lz lf js ma mb lh jw mc md lj ka me mf ll mg bi translated">惯例:</h2><ul class=""><li id="432e" class="mh mi hi jl b jm ln jp lo js mj jw mk ka ml ke mm mn mo mp bi translated">对于涉及时间、持续时间的每个特征，除非特别说明(如天数),否则日期/时间被转换为小时。</li></ul><h2 id="86f3" class="lt kx hi bd ku lu lv lw lb lx ly lz lf js ma mb lh jw mc md lj ka me mf ll mg bi translated">最终特征</h2><ul class=""><li id="57ff" class="mh mi hi jl b jm ln jp lo js mj jw mk ka ml ke mm mn mo mp bi translated"><strong class="jl hj">男性</strong> : 1 —男性或0 —女性</li><li id="2648" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">付费</strong> : 1-付费订阅或0-免费订阅</li><li id="6208" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> avg_daily_actions </strong>:每天的平均动作(考虑可用期间的天数)</li><li id="ba5a" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> avg_session_duration: </strong>每个会话的平均持续时间(小时)</li><li id="0cd4" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> avg_playback_time </strong>:每次听音乐的平均时间</li><li id="cec9" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> n_actions </strong>:动作次数</li><li id="fc6d" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> n_added_to_playlist </strong>:添加到播放列表的歌曲数量</li><li id="0ffe" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> n_ads </strong>:观看的广告数量</li><li id="3122" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> n_days </strong>:观察窗的天数，</li><li id="4329" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">不喜欢的数量</strong>:不喜欢的数量</li><li id="254b" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">n _降级</strong>:降级次数</li><li id="2ffe" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> n_errors </strong>:经历的错误数</li><li id="2ad7" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> n_friends </strong>:添加的好友数量</li><li id="5f01" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> n_help </strong>:访问帮助页面的次数</li><li id="05af" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> n_home </strong>:访问主页的次数</li><li id="4e3b" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> n_likes </strong>:喜欢的歌曲数量</li><li id="1f4d" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> n_sess </strong>:会话数</li><li id="411e" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> n_settings </strong>:访问帮助页面的次数</li><li id="8cb4" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> n_songs </strong>:播放的歌曲数量</li><li id="4d0d" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> n_upgrades </strong>:升级次数</li><li id="3aac" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> n_ads_over_songs </strong>:观看的广告数量除以播放的歌曲数量</li><li id="e2bb" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> n_likes_over_songs </strong>:喜欢的歌曲数除以歌曲数</li><li id="5103" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">n _ unless _ over _ Songs</strong>:不喜欢的歌曲数除以歌曲数</li><li id="f456" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">n _ likes _ over _ unless</strong>:喜欢的歌曲数除以不喜欢的歌曲数</li><li id="e515" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">时间窗口</strong>:观察数据的时间(小时)</li></ul><p id="e9f9" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">以音乐收听小时数为单位按时间划分的功能(例如，这次，对于广告数量，我们将广告数量除以音乐收听时间):</p><ul class=""><li id="9b53" class="mh mi hi jl b jm jn jp jq js nh jw ni ka nj ke mm mn mo mp bi translated"><strong class="jl hj"> session_avg_actions </strong></li><li id="e8a5" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">session _ avg _ added _ playlist</strong></li><li id="8da6" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> session_avg_ads </strong></li><li id="0066" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">会话_平均_厌恶</strong></li><li id="f9fa" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">会话_平均_错误</strong></li><li id="535b" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> session_avg_friends </strong></li><li id="3886" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> session_avg_help </strong></li><li id="8c72" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> session_avg_home </strong></li><li id="ee5a" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> session_avg_likes </strong></li><li id="98dc" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> session_avg_settings </strong></li><li id="ecc8" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">会话_平均_歌曲</strong></li><li id="307c" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">session _ avg _ Time _ away</strong>:Time away是会话A中的最后一个事件与会话b中记录的第一个事件之间的间隔。</li><li id="5161" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">time _ window _ over _ playback _ time</strong>:观察时间段的总和除以听音乐的时间。</li></ul><h2 id="69f5" class="lt kx hi bd ku lu lv lw lb lx ly lz lf js ma mb lh jw mc md lj ka me mf ll mg bi translated">特征分数</h2><p id="d5a3" class="pw-post-body-paragraph jj jk hi jl b jm ln ij jo jp lo im jr js lp ju jv jw lq jy jz ka lr kc kd ke hb bi translated">作为<em class="ko">可解释性的简单方法</em></p><p id="3ecf" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在下一张图中，我们描述了这些特征如何帮助将用户分类为流失或不流失。左侧的绿色负柱有助于归类为非流失。另一方面，红色和积极的有助于定义未来的客户流失。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nk"><img src="../Images/5be871cd36e8fe56ee2be728676b61ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V3vglJtJKPOcm797GBrh_Q.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">每个功能如何帮助检测客户流失？</figcaption></figure><h2 id="6b9f" class="lt kx hi bd ku lu lv lw lb lx ly lz lf js ma mb lh jw mc md lj ka me mf ll mg bi translated">特征相关性</h2><p id="3481" class="pw-post-body-paragraph jj jk hi jl b jm ln ij jo jp lo im jr js lp ju jv jw lq jy jz ka lr kc kd ke hb bi translated">每个事件或特征的绝对频率(如果是二进制的)</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nl"><img src="../Images/8163d14aa61158c09df6c48254f586f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KaDm1K_9iG3peRxWmJ6knQ.png"/></div></div></figure><h2 id="f3ce" class="lt kx hi bd ku lu lv lw lb lx ly lz lf js ma mb lh jw mc md lj ka me mf ll mg bi translated">特征相关性</h2><p id="c5d0" class="pw-post-body-paragraph jj jk hi jl b jm ln ij jo jp lo im jr js lp ju jv jw lq jy jz ka lr kc kd ke hb bi translated">事件与播放时间</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nl"><img src="../Images/f4341c956c6ac4967b3ae77cd201e8ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gZ7oWk-7CjohST5p_McY8w.png"/></div></div></figure><p id="96b3" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">注意事项</strong>:</p><ul class=""><li id="27aa" class="mh mi hi jl b jm jn jp jq js nh jw ni ka nj ke mm mn mo mp bi translated">两个热图都是在剔除异常值后绘制的；</li><li id="76c9" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated">有趣的是，考虑到绝对值仍然受到许多虚拟相关性的污染，如会话数与歌曲数，第一个热图如何，以及考虑到平均值和与播放时间的关系，第二个热图如何更加清晰。</li></ul><h2 id="334a" class="lt kx hi bd ku lu lv lw lb lx ly lz lf js ma mb lh jw mc md lj ka me mf ll mg bi translated">离群点剔除</h2><p id="d97d" class="pw-post-body-paragraph jj jk hi jl b jm ln ij jo jp lo im jr js lp ju jv jw lq jy jz ka lr kc kd ke hb bi translated">在训练我们的模型之前，我们需要尽可能多地移除离群值。为此，我们将计算<a class="ae kv" href="https://www.kdnuggets.com/2017/02/removing-outliers-standard-deviation-python.html" rel="noopener ugc nofollow" target="_blank"> z值</a>，并移除大于或小于平均值<em class="ko">3倍标准差</em>的值。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nm"><img src="../Images/cec14356f9e36fb4d3a1301d25fa1bc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A23BrKXI9jOcuMxHt9HSJw.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated"><strong class="bd ku">来源</strong>:<a class="ae kv" href="https://byjus.com/maths/box-plot/" rel="noopener ugc nofollow" target="_blank">https://byjus.com/maths/box-plot/</a></figcaption></figure><p id="ce4b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">对于熊猫，我们可以轻松地使用<a class="ae kv" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.zscore.html" rel="noopener ugc nofollow" target="_blank"> zscore方法</a>。因为我们使用PySpark，所以我实现了一个简单的代码来计算这个。此外，这里我只计算一些列的z值，尤其是平均相关的列。这是因为在这一点上，他们可能是最需要调整的。绝对值将被归一化处理。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nn no l"/></div></figure><p id="9afd" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在这一步之后，我们删除了<strong class="jl hj"> 2.402 </strong>条记录，新的数据集大约有<strong class="jl hj"> 19.875 </strong>行。我们仍然以<strong class="jl hj"> 22.15% </strong>的流失样本，因为<strong class="jl hj"> 331个</strong>的流失用户数据点被剔除，而非流失用户的<strong class="jl hj"> 2.071个</strong>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es np"><img src="../Images/f024671a18f9acc3f88d77867a057a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*798mXNRmavxkKZvfr6A4kA.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">清理后的数据集</figcaption></figure><h1 id="e040" class="kw kx hi bd ku ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">问题和模型</h1><p id="669f" class="pw-post-body-paragraph jj jk hi jl b jm ln ij jo jp lo im jr js lp ju jv jw lq jy jz ka lr kc kd ke hb bi translated">我们的问题是一个<strong class="jl hj"> <em class="ko">二元分类</em> </strong> <em class="ko">，其中</em>的目标是预测用户是否会流失(<strong class="jl hj">取消= 1 </strong>)或不流失(<strong class="jl hj">取消= 0 </strong>)。</p><ul class=""><li id="bd80" class="mh mi hi jl b jm jn jp jq js nh jw ni ka nj ke mm mn mo mp bi translated">目前，我们不会担心降级事件，这也是一种流失，因为用户不会为我们的服务支付更多费用。</li></ul><p id="61cd" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">使用Pyspark和模块<a class="ae kv" href="http://spark.apache.org/mllib/" rel="noopener ugc nofollow" target="_blank"> MLlib </a>，我们将测试四个模型:<a class="ae kv" href="https://spark.apache.org/docs/latest/ml-classification-regression.html#logistic-regression" rel="noopener ugc nofollow" target="_blank">逻辑回归</a>、<a class="ae kv" href="https://spark.apache.org/docs/latest/ml-classification-regression.html#random-forest-classifier" rel="noopener ugc nofollow" target="_blank">随机森林</a>、<a class="ae kv" href="https://spark.apache.org/docs/latest/ml-classification-regression.html#gradient-boosted-tree-classifier" rel="noopener ugc nofollow" target="_blank">梯度推进</a>和<a class="ae kv" href="https://spark.apache.org/docs/latest/ml-classification-regression.html#decision-tree-classifier" rel="noopener ugc nofollow" target="_blank">决策树。</a></p><p id="8f17" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这些模型中的每一个都可以用于分类任务。其中一些，如决策树或随机森林，可能会受到过度拟合的影响，但也允许我们调整一些参数，如修剪，深度等，以避免这种情况。逻辑回归，我们可以简化为带有分类的逻辑回归，最终，更像是遭受离群值之类的问题。但同样，我们可以通过缩放值和限制迭代次数来尝试解决这个问题。</p><p id="363e" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">指标</strong></p><p id="9865" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这里的<strong class="jl hj">回忆</strong>至关重要，因为我们希望抓住未来的大部分动荡。因为在知道一个用户有很高的流失机会后，很多行为都不是很容易的，例如，我们可以通过发送通知来吸引更多的用户。因此，一些错误，如向一些不会流失的用户发送参与通知；这不是世界末日。不管怎样，努力总是有限的；例如，如果我们将尝试发送折扣优惠，如果我们发送给每个人并影响我们的收入，那就太糟糕了。为了实现<strong class="jl hj">真阳性</strong>和<strong class="jl hj">假阳性</strong>之间的平衡，我们来到了我们的下一个指标，即<strong class="jl hj"> F值</strong>。</p><p id="34c8" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们还会用到<strong class="jl hj"> AUC </strong>，意思是:<em class="ko">曲线下面积</em>。这个指标允许我们绘制出<em class="ko">真阳性</em> (TP)与<em class="ko">假阳性</em> (FP)的对比图。</p><h1 id="f4a3" class="kw kx hi bd ku ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">培训过程</h1><p id="7a8a" class="pw-post-body-paragraph jj jk hi jl b jm ln ij jo jp lo im jr js lp ju jv jw lq jy jz ka lr kc kd ke hb bi translated">为了允许每个模型之间的进一步比较，我们将把每个模型结果存储在一个单独的文件中。最后，我们将使用模型<em class="ko">指标</em>和所有使用的<em class="ko">超参数</em>创建一个简单的数据框。然后，我们将检查结果。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nn no l"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">这种方法简化了保存模型信息的步骤</figcaption></figure><h1 id="b874" class="kw kx hi bd ku ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">网格搜索训练</h1><p id="1425" class="pw-post-body-paragraph jj jk hi jl b jm ln ij jo jp lo im jr js lp ju jv jw lq jy jz ka lr kc kd ke hb bi translated">常规配置:</p><ul class=""><li id="5b08" class="mh mi hi jl b jm jn jp jq js nh jw ni ka nj ke mm mn mo mp bi translated"><strong class="jl hj"> 70% </strong>至<strong class="jl hj">训练</strong>和<strong class="jl hj"> 30% </strong>至<strong class="jl hj">测试</strong>；</li><li id="8c4b" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj"> 5倍</strong> —总之，需要对验证数据进行5次重新采样，并用这个新组来训练模型。计算所有折叠的平均值。这有助于选择一个过度拟合的模型作为最佳模型。</li><li id="04cf" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">binary classificationevaluator</strong>:该评估器帮助返回最佳分类模型。我使用的度量标准是<strong class="jl hj">面积低于中国。</strong></li><li id="02aa" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">标准缩放器</strong>:所有数字和连续特征将被缩放，以避免任何剩余异常值的影响。</li></ul><h2 id="2bd3" class="lt kx hi bd ku lu lv lw lb lx ly lz lf js ma mb lh jw mc md lj ka me mf ll mg bi translated">代码</h2><p id="140e" class="pw-post-body-paragraph jj jk hi jl b jm ln ij jo jp lo im jr js lp ju jv jw lq jy jz ka lr kc kd ke hb bi translated">我创建了一个简单的方法来构建一个pipeline对象，所有的步骤在所有的模型中都是通用的。然后，一个简单的方法为每个模型处理实例化当前模型的管道，定义一些方面，如数字特征和目标列。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nn no l"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">通用管道和每个模型的构建器</figcaption></figure><p id="6def" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">有了流水线，我们把二元特征(<strong class="jl hj">付</strong>和<strong class="jl hj">公</strong>)从连续特征中分离出来。因此，只缩放连续特征。最后，我们创建了一个名为<strong class="jl hj"> features </strong>的列，它有一个包含二进制特征和缩放的连续特征的向量。</p><p id="2119" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj"> create_grid_search </strong>方法，只取一个管道和网格值，使用<strong class="jl hj"> 5 </strong> <strong class="jl hj"> <em class="ko">折叠</em> </strong>和默认评估器，该评估器将通过<strong class="jl hj"> areaUnderROC </strong>给出最佳模型。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nn no l"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">估计器和网格搜索准备</figcaption></figure><ul class=""><li id="4a05" class="mh mi hi jl b jm jn jp jq js nh jw ni ka nj ke mm mn mo mp bi translated">注意:在我最初的测试中，我在训练所有组合时遇到了一些问题。最后，我更改了Spark的配置，并将数据缓存在内存中。之前，一些模型，比如GBT，在经过5-6个小时的训练后，我发现了一个内存堆积错误。通过增加限制和使用缓存，不会发生这种情况。</li></ul><h2 id="335c" class="lt kx hi bd ku lu lv lw lb lx ly lz lf js ma mb lh jw mc md lj ka me mf ll mg bi translated">逻辑回归</h2><p id="e2e4" class="pw-post-body-paragraph jj jk hi jl b jm ln ij jo jp lo im jr js lp ju jv jw lq jy jz ka lr kc kd ke hb bi translated">值得一提的一个参数是class_weights。这就是我们如何准备模型来处理不平衡的数据，就像我们的问题一样。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nn no l"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">训练数据集的类权重计算</figcaption></figure><p id="3806" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">使用的参数在下面的代码片段中。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nn no l"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">逻辑回归-网格参数</figcaption></figure><p id="174b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">逻辑回归模型需要大约<strong class="jl hj"> 20分钟</strong>来测试大约<strong class="jl hj"> 432个超参数</strong>配置。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nq"><img src="../Images/7b91a09a1cd47df6eb0cd96e1e9beea3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*ctoulrtme7lR9QVxW7NVxA.png"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">逻辑回归模型的培训</figcaption></figure><h2 id="99f1" class="lt kx hi bd ku lu lv lw lb lx ly lz lf js ma mb lh jw mc md lj ka me mf ll mg bi translated">决策树分类器</h2><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nn no l"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">决策树分类器—网格参数</figcaption></figure><p id="f125" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj"> <em class="ko">决策树</em> </strong>是最快的一种，只需要大约2分钟就可以测试大约40个模型组合。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nr"><img src="../Images/b31003d52bb95047026a6631f3a897f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*PSauP6FoxtlU51v1pHAkkQ.png"/></div></figure><h2 id="ab98" class="lt kx hi bd ku lu lv lw lb lx ly lz lf js ma mb lh jw mc md lj ka me mf ll mg bi translated">随机森林分类器</h2><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nn no l"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">随机森林分类器—网格参数</figcaption></figure><p id="3e3b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">随机森林模型大约需要<strong class="jl hj"> 41分钟</strong>来迭代200个模型变量。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nq"><img src="../Images/75c00238754d3e88fc6617355e8df8fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*lAw22Vl5xOaCed_fFCE6yg.png"/></div></figure><h2 id="f807" class="lt kx hi bd ku lu lv lw lb lx ly lz lf js ma mb lh jw mc md lj ka me mf ll mg bi translated">梯度推进分类器</h2><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nn no l"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">梯度推进分类器—网格参数</figcaption></figure><p id="87fe" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">GB是最慢的型号，训练大约<strong class="jl hj"> 200个</strong>组合需要3小时19分钟。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ns"><img src="../Images/13833f15bbbbdc0e2c1f4f35727ca86f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*tE-IsfKEFjRkTPaT9yce4g.png"/></div></figure><h1 id="99f5" class="kw kx hi bd ku ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">决赛成绩</h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nt"><img src="../Images/380ca4791d421ab792c29ba1fa16d9d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*argZEDVtFqkIVCZ34PPZKQ.jpeg"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated"><strong class="bd ku">来源</strong>:【http://www.quickmeme.com/p/3w3ldf】T4</figcaption></figure><p id="1760" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">最佳模型是<strong class="jl hj">逻辑回归</strong>🎉考虑到<strong class="jl hj">召回</strong>和<strong class="jl hj"> ROC </strong>和<strong class="jl hj">曲线评分</strong>。接下来，我们看到所有的结果和总结。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nu"><img src="../Images/5c5adde7054993e459bb65f0306a7032.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*KzzxSm6Sot8zF68NggCiBg.png"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">ROC汇总结果</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nv"><img src="../Images/8e7fff97c0f0228ac176a50e1ce6a90c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h4vMGq9WlXOzZVOUbMA-3A.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">每个模型的ROC</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nw"><img src="../Images/ec7608cd6d0d35fc6a8d178f35e213d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pd62UD2nOjUgjY3aPSmciA.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">每个模型的混淆矩阵</figcaption></figure><p id="34d3" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">所有最佳模型指标，<em class="ko">超参数</em>:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nx"><img src="../Images/a82f56af5d807197e0431d980a9de171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B_vf4BGFPi9SthTc-gvB8A.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">每个模型的网格搜索结果摘要</figcaption></figure><h2 id="1b1d" class="lt kx hi bd ku lu lv lw lb lx ly lz lf js ma mb lh jw mc md lj ka me mf ll mg bi translated">结束语</h2><p id="644d" class="pw-post-body-paragraph jj jk hi jl b jm ln ij jo jp lo im jr js lp ju jv jw lq jy jz ka lr kc kd ke hb bi translated">通俗地说，用我们最好的模型，我们成功地预测了100个<strong class="jl hj"><em class="ko"/></strong>中的<strong class="jl hj"> <em class="ko"> 80个。如果我们拿100个不会<em class="ko">流失</em>的用户，我们会错误地认为其中的<em class="ko">13</em>(12.93%)会流失。因为我们的假阳性仍然低于假阴性，而且我们的流失“捕捉能力”很好(80%)，所以这个模型是好的。</em></strong></p><p id="1db6" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">关于FP和FN与良好回忆的比率的陈述，更像是现实世界的愿景，考虑了实施某些行动的成本与浪费努力的风险，而不完全是统计上建立的概念。我们浪费的努力，仍然低于我们已经接受的将80%的准确率模型称为好的失误数。</p><p id="8d43" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><em class="ko">此外，这些假设基于我们的模型没有过度拟合，并且数据代表我们服务成员的数据库。</em></p><h1 id="10b0" class="kw kx hi bd ku ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">进一步的改进</h1><ul class=""><li id="954a" class="mh mi hi jl b jm ln jp lo js mj jw mk ka ml ke mm mn mo mp bi translated"><strong class="jl hj">改善用户生命周期功能</strong>:由于我们有几个用户，这将是更多的事件，这些功能可以让我们为老用户或非常新的用户删除许多数据点。也许，通过为非常新的、平均时间的或非常老的用户创建组，我们可以改进模型并处理更多的用户群。</li><li id="b2ce" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated">探索与多样性相关的流派、艺术家和特征:也许，通过检查歌曲并尝试分类，我们可以得出目录中缺少流派的结论。也许，这些信息不能在模型中使用，但可以在分析中探索。</li><li id="6036" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">深度学习技术</strong>:也许创造一个100%召回率的过度拟合黑盒？(开个玩笑)。一种真正的可能性是映射一些原始特征和特征工程特征不会得到的关系。</li><li id="a6b6" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated">特性<strong class="jl hj"> n_upgrades </strong>和<strong class="jl hj">n _ degrades</strong>可以用作二进制特性，如<strong class="jl hj">has _ degraded</strong>或<strong class="jl hj">has _ upgrades</strong>。但是，由于我们可以有一个长期的用户，他也可以升级和降级许多次。</li><li id="2f39" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">实际听音乐量</strong>:完成这个项目后，我才发现我错过了更精确计算用户是否真的听音乐的机会，直到最后。例如，如果音乐A有3分钟，并且下一首音乐之间的间隔低于3分钟，则用户可能跳过了该歌曲。在这里，我们有机会提高听音乐时间的精确度，以及跳过歌曲的数量，这些歌曲只播放了几秒钟。</li></ul><h1 id="fad3" class="kw kx hi bd ku ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">小纸条</h1><ul class=""><li id="8a46" class="mh mi hi jl b jm ln jp lo js mj jw mk ka ml ke mm mn mo mp bi translated">我不会深究，但是因为我想在任何机器上处理这些数据，所以我创建了一个脚本来读取成批的数据并删除未使用的列(名字、姓氏、位置、用户代理)。通过这样做，我为所有这2600万条记录创建了一个小得多的版本，只有<strong class="jl hj"> 2Gb </strong>。如果这个文件可能对你有用，你可以在这里 找到它<a class="ae kv" href="https://brunobitencourt.com/data/udacity/sparkify/sparkify_full_csv_data.csv" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="68db" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated">此外，通过这样做，我不需要在AWS上运行这个工作负载。你可以这样做的成本或如果你不熟悉的服务。我已经在我的16Gb内存的机器上成功地处理了完整的数据集。</li><li id="3179" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated">在<a class="ae kv" href="https://github.com/brunowdev/sparkify/blob/master/pyspark.sh" rel="noopener ugc nofollow" target="_blank"> <em class="ko"> pyspark.sh </em> </a>文件中，有一个配置允许在没有堆和内存错误的情况下运行所有的分析(可能这不是最佳配置，但确实有效)。而且，这种配置是针对独立模式的，通常只是您的<em class="ko">本地环境</em>。</li></ul><h1 id="626a" class="kw kx hi bd ku ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">结论</h1><p id="0a88" class="pw-post-body-paragraph jj jk hi jl b jm ln ij jo jp lo im jr js lp ju jv jw lq jy jz ka lr kc kd ke hb bi translated">我希望你喜欢这篇文章。所有的参考资料和链接都在正文或上面。如果你发现一个错误，有一个建议，或任何问题，请让我知道！</p><p id="343e" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">谢谢大家！😁</p><p id="991a" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">联系人</strong>:</p><ul class=""><li id="841d" class="mh mi hi jl b jm jn jp jq js nh jw ni ka nj ke mm mn mo mp bi translated"><strong class="jl hj">GitHub</strong>:<a class="ae kv" href="https://github.com/brunowdev" rel="noopener ugc nofollow" target="_blank">https://github.com/brunowdev</a></li><li id="c0d6" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><strong class="jl hj">领英</strong>:<a class="ae kv" href="https://www.linkedin.com/in/brunobluiz/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/brunobluiz/</a></li><li id="63ff" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated">邮件:obrunobitencourt@gmail.com</li></ul><h1 id="7073" class="kw kx hi bd ku ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">参考</h1><ul class=""><li id="867d" class="mh mi hi jl b jm ln jp lo js mj jw mk ka ml ke mm mn mo mp bi translated"><a class="ae kv" href="https://spark.apache.org/docs/latest/configuration.html#application-properties" rel="noopener ugc nofollow" target="_blank">阿帕奇火花配置</a></li><li id="f6a2" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><a class="ae kv" href="https://spark.apache.org/docs/latest/ml-classification-regression.html#classification" rel="noopener ugc nofollow" target="_blank"> MLlib —分类模型</a></li><li id="3f10" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><a class="ae kv" href="https://databricks.com/blog/2015/07/15/introducing-window-functions-in-spark-sql.html" rel="noopener ugc nofollow" target="_blank">窗口功能</a></li><li id="73a2" class="mh mi hi jl b jm mq jp mr js ms jw mt ka mu ke mm mn mo mp bi translated"><a class="ae kv" href="https://www.kdnuggets.com/2017/02/removing-outliers-standard-deviation-python.html" rel="noopener ugc nofollow" target="_blank">标准偏差—快速回顾</a></li></ul></div></div>    
</body>
</html>