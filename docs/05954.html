<html>
<head>
<title>5 challenges when using Plotly Dash for web apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Plotly Dash用于网络应用时的5大挑战</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/5-challenges-when-using-plotly-dash-for-interactive-web-apps-849f442582f7?source=collection_archive---------1-----------------------#2020-05-07">https://medium.com/analytics-vidhya/5-challenges-when-using-plotly-dash-for-interactive-web-apps-849f442582f7?source=collection_archive---------1-----------------------#2020-05-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8185d9db88a368d15872362400e2a5dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z8Y0kb-u3iwoEb4TCDAhnA.png"/></div></div></figure><p id="7ebd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我第一次真正遇到Dash是在最近。我与一家公司合作，在谷歌云中托管一个Dash应用程序。和Dash一起工作还可以，但是整体体验并不好。这是我遇到的一些小问题。</p><h2 id="1683" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">将信息保存在网页本身中</h2><p id="53c5" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">Dash应用应该是无状态的，这是有充分理由的。通常情况下，该应用程序将作为一个服务器后面的多个Python进程运行，以便同时服务于多个请求。对于任何简单的应用程序来说，使用无状态服务器是最好的起点，因为在这些进程之间共享内存中的状态只是自找麻烦。Dash通过将数据存储在网页本身的隐藏元素中解决了这个问题，因此一个简单的重新加载就清除了所有关于用户会话的<em class="ko">存储的</em>信息。客户端的Dash似乎使用了一个Redux存储，但是没有对它的访问。</p><p id="49b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你所做的只是显示一些图表，这没什么大不了的，但是这对于任何交互式应用程序来说都是一个真正的问题。</p><h2 id="5f8f" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated"><strong class="ak">创造交互性很有挑战性</strong></h2><p id="0796" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">Dash中创建交互性的主要机制是服务器回调。简而言之，浏览器调用服务器，对DOM的任何更新都被发送回客户端，这比在浏览器内部执行Javascript代码效率更低。最近<a class="ae kp" href="https://dash.plotly.com/clientside-callbacks" rel="noopener ugc nofollow" target="_blank">客户端回调</a>被添加到Dash中，但是我不知道它们是如何被触发的，除非(重新)加载web页面。当页面加载时，我使用客户端回调来运行Javascript代码。这无疑挽救了局面，但这种方法有其局限性。回调必须在服务器上的Python代码中定义，尽管它的执行与服务器无关:</p><pre class="kq kr ks kt fd ku kv kw kx aw ky bi"><span id="d1d7" class="jo jp hi kv b fi kz la l lb lc"># Python client-side callback definition<br/>app.clientside_callback(<br/>    ClientsideFunction(<br/>        namespace='clientside',<br/>        function_name='DoSomething'<br/>    ),<br/>    # the output field must match a property that is already defined<br/>    # Output('div-id', 'style'),<br/>    Output('div-id', 'style'),<br/>    [Input('MyButton', 'none')]<br/>)</span></pre><p id="56ae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面的代码声明了一个名为<code class="du ld le lf kv b">DoSomething</code>的函数将被<code class="du ld le lf kv b">MyButton</code>触发，并更新一个id为<code class="du ld le lf kv b">div-id</code>的<code class="du ld le lf kv b">div</code>的<code class="du ld le lf kv b">style</code>属性。</p><p id="6bf2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是客户端相应的Javascript代码:</p><pre class="kq kr ks kt fd ku kv kw kx aw ky bi"><span id="1506" class="jo jp hi kv b fi kz la l lb lc"># Javascript code<br/>(function(){<br/>  if(!window.dash_clientside) {window.dash_clientside = {};}<br/>  window.dash_clientside.clientside = {<br/>    <br/>      DoSomething: () =&gt; {<br/>        // ADD CODE HERE<br/>        return {display: 'none'}   <br/>      },<br/>  }<br/> })();</span></pre><p id="dea5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是元素的外观:</p><pre class="kq kr ks kt fd ku kv kw kx aw ky bi"><span id="2e1c" class="jo jp hi kv b fi kz la l lb lc"># Python code defining the page elements<br/>html.Div(className='style-me-with-css', id='DIV-ID', style={'display': 'none'}, children=[<br/>  // DO SOMETHING HERE<br/>])</span></pre><p id="2974" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，如果上面定义的<code class="du ld le lf kv b">Div</code>没有在Python回调中显式引用<code class="du ld le lf kv b">style</code>属性，Javascript代码将不会在浏览器中执行。迷茫？</p><p id="8230" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">结论:</strong>这是一个非常复杂的方案，试图实现一些应该相当简单的东西。</p><h2 id="d705" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">很难定制API</h2><p id="e724" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">在我的项目中，Dash应用程序被托管在一个API网关之后，该网关负责用户认证。在这里，我在试图让Dash使用网关时碰壁了。原因相当不幸。任何dash应用程序的根必须在末尾有正斜杠:<a class="ae kp" href="https://my" rel="noopener ugc nofollow" target="_blank">https://my</a>. dash server . com/app 1<strong class="is hj">/</strong></p><p id="808b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个网址<code class="du ld le lf kv b">htts://my.dashserver.com/app1</code>不行。</p><p id="cff5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我认为这是一个奇怪的选择，但嘿，嗬。然后我意识到我的网关不能处理以斜杠结尾的URL！</p><p id="f9ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">解决方案:</strong>黑掉底层Flask app添加一个首页路由<strong class="is hj">，末尾不带</strong>正斜杠。啊啊啊。</p><p id="0b19" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">是的，它最终确实工作得很好，但这并不容易！对我来说，主要的缺点是缺少扩展Dash API/功能的内置方法。你得黑掉Flask的应用。</p><h2 id="9842" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">破折号HTML中没有列表</h2><p id="f609" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">疯了！是的，没有简单的方法来定义一个列表。我是这样做的:</p><pre class="kq kr ks kt fd ku kv kw kx aw ky bi"><span id="cdfa" class="jo jp hi kv b fi kz la l lb lc"># Python server code<br/>html.Div([<br/># li 1<br/>  html.P([<br/>    html.B('1. '),<br/>    html.Span('Click here')<br/>  ]),</span><span id="62c9" class="jo jp hi kv b fi lg la l lb lc"># li 2<br/>  html.P([<br/>    html.B('2. '),<br/>    html.Span('Click here')<br/>  ]),<br/>...<br/>])</span></pre><p id="1bdc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">再说一次，它确实能完成任务，尤其是在与CSS结合使用的时候，但是看起来并不怎么样！</p><p id="77d2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ko">这让我想到了最后一点:</em>用破折号编写普通的HTML是不可能的。对于上述情况，一个简单的解决方法是使用一个Python组件，它可以呈现任何HTML。然后，我可以轻松地呈现文本、列表等。看上面的代码！用一点文本格式写一个简单的段落需要奉献精神！</p><p id="c77c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">更新【11/05/2020】:</strong>事实证明，使用<code class="du ld le lf kv b">Markdown</code>组件可以获得列表和原始HTML:</p><pre class="kq kr ks kt fd ku kv kw kx aw ky bi"><span id="9c49" class="jo jp hi kv b fi kz la l lb lc">dcc.Markdown('''<br/>* list item A<br/>* list item B<br/>* ...</span><span id="cb4c" class="jo jp hi kv b fi lg la l lb lc">&lt;ol&gt;<br/>  &lt;li&gt;item one&lt;/li&gt;<br/>  &lt;li&gt;item two&lt;/li&gt;<br/>  &lt;li&gt;...&lt;/li&gt;<br/>&lt;/ol&gt;<br/>''')</span></pre><p id="ea79" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ld le lf kv b">dcc.Markdown</code>接受一个名为<code class="du ld le lf kv b">dangerously_allow_html</code>的布尔标志，使得编写原始HTML成为可能。</p><p id="ad28" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我通过随机浏览最新的Dash文档发现了这一切。</p><h2 id="36af" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">哦，最后一件事</h2><p id="916b" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">那是我最喜欢的！<strong class="is hj">两个Python回调更新同一个元素是不可能的！我知道！这太有趣了。不允许您这样做:</strong></p><pre class="kq kr ks kt fd ku kv kw kx aw ky bi"><span id="c9e9" class="jo jp hi kv b fi kz la l lb lc"><a class="ae kp" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.callback([<strong class="kv hj">Output('target-div', 'children')</strong>],<br/>              [Input('upload-data', 'contents')])<br/>def callback1(contents, filename):<br/>    return PreventUpdate</span><span id="eca5" class="jo jp hi kv b fi lg la l lb lc"><a class="ae kp" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.callback([<strong class="kv hj">Output('target-div', 'children')</strong>],<br/>              [Input('upload-data-two', 'contents')])<br/>def callback1(contents, filename2):<br/>    return PreventUpdate</span></pre><p id="ba6b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我发现解决这个问题是2018年以来的一个功能请求:<a class="ae kp" href="https://community.plotly.com/t/why-can-an-output-only-have-a-single-callback-function/14691" rel="noopener ugc nofollow" target="_blank">https://community . plotly . com/t/why-can-a-output-only-have-a-single-callback-function/14691</a></p><p id="6a56" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，开发人员可能会尝试创建一个全能的回调函数，它接受所有可能的输入和输出，并基于一些复杂的逻辑发回“正确的”响应。</p><p id="fb04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该项目的一位同事确实提出了一个优雅的解决方案。因为对输入没有限制，所以可以向一些回调函数添加额外的输入，以便根据输入的组合触发不同的响应。上面的例子变成了这样:</p><pre class="kq kr ks kt fd ku kv kw kx aw ky bi"><span id="3e7d" class="jo jp hi kv b fi kz la l lb lc"><a class="ae kp" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.callback([Output('target-div', 'children')],<br/>              [Input('upload-data', 'contents'), <br/>               Input('upload-data-two', 'contents')])<br/>def callback1(contents, filename):<br/>    ctx = dash.callback_context<br/>    source = ctx.triggered[0]['prop_id'].split('.')[0]<br/>    if source == 'upload-data':<br/>        return 'happy days'<br/>    elif source == 'upload-data-two':<br/>        return 'this is another way of updating the same element'</span></pre><h1 id="296e" class="lh jp hi bd jq li lj lk ju ll lm ln jy lo lp lq kb lr ls lt ke lu lv lw kh lx bi translated">结论</h1><p id="597c" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">当您想要创建一个简单的仪表板并在您的笔记本电脑上托管它时，Dash确实工作正常。对于任何其他情况，你要么需要付钱让他们为你托管并利用他们的企业功能，要么就自己动手。</p><p id="fe5a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，不建议创建需要复杂UI的交互式应用程序。在我的下一个项目中，我想尝试一下散景。他们的文档看起来更有意义！</p><p id="6821" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ko">我叫尼克·瓦克莱夫，是</em><a class="ae kp" href="https://techccino.com/?utm_source=medium.com&amp;utm_medium=tech-blog&amp;utm_content=five-dash-challenges" rel="noopener ugc nofollow" target="_blank"><em class="ko">Techccino Ltd</em></a><em class="ko">|数据可视化和无服务器应用的创始人。如果你有兴趣构建自己的网络应用</em> <a class="ae kp" href="https://techccino.com/about" rel="noopener ugc nofollow" target="_blank"> <em class="ko">联系</em> </a> <em class="ko">。</em></p></div></div>    
</body>
</html>