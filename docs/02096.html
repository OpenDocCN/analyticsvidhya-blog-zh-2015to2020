<html>
<head>
<title>Many Ways of Reading Data Into R — 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将数据读入R-1的多种方式</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/many-ways-of-reading-data-into-r-1-52b02825cb27?source=collection_archive---------3-----------------------#2019-11-30">https://medium.com/analytics-vidhya/many-ways-of-reading-data-into-r-1-52b02825cb27?source=collection_archive---------3-----------------------#2019-11-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="770e" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">T <!-- -->本系列面向希望使用r快速了解数据科学的数据科学初学者，涵盖了构建数据科学项目所需的统计学和机器学习高级概念的所有基础知识。</p><p id="3c28" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">每当有人想在数据科学领域开始职业生涯时。我们有大量的在线资源。但大部分内容本质上都是零碎的。写这个系列是为了用r全面介绍统计学和机器学习中的所有重要课题。</p><p id="ffaa" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">本系列假设您了解R编程的基础知识，包括R数据结构、控制语句、循环和创建必要的R函数。如果你真的是R的新手，并且正在寻找R的基础知识，请仔细阅读我们讨论过R基础知识的以下系列—<a class="ae jh" href="https://medium.com/p/4273a71fb885/edit" rel="noopener">R基础知识— 1 </a></p><p id="13b8" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">这篇文章的内容是我在IIM-B时代得到的几本书的要点。</p><p id="0efb" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">人人为我——贾里德·p·兰德</p><p id="393f" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">实用数据科学与R — Nina Zumel和John Mount</p><p id="4cc1" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">文中讨论的所有代码块都以R markdown的形式出现在<a class="ae jh" href="https://github.com/viveksrinivasanss/Data_Science_Using_R" rel="noopener ugc nofollow" target="_blank"> <em class="hi"> Github链接</em> </a>中。</p></blockquote><figure class="jj jk jl jm fd jn er es paragraph-image"><div class="er es ji"><img src="../Images/fb5dbb8aa5aad0f35f9ba63c095c1c75.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*wh6qYAbqBdZl-CMGlNhE2Q.png"/></div></figure><p id="f21d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi jt translated">任何数据科学项目的第一步都是将数据加载到环境中。与R中的所有东西一样，有许多方法可以获取数据。本文主要关注将数据加载到R环境中的不同方式。以下是一些最常见的方法。</p><ul class=""><li id="6980" class="kc kd hi il b im in iq ir jq ke jr kf js kg jg kh ki kj kk bi translated">从CSV数据中读取</li><li id="d4cf" class="kc kd hi il b im kl iq km jq kn jr ko js kp jg kh ki kj kk bi translated">从数据库读取</li><li id="9813" class="kc kd hi il b im kl iq km jq kn jr ko js kp jg kh ki kj kk bi translated">r二进制文件</li><li id="332f" class="kc kd hi il b im kl iq km jq kn jr ko js kp jg kh ki kj kk bi translated">R中包含的数据</li><li id="b21b" class="kc kd hi il b im kl iq km jq kn jr ko js kp jg kh ki kj kk bi translated">来自其他统计工具的数据</li><li id="8f64" class="kc kd hi il b im kl iq km jq kn jr ko js kp jg kh ki kj kk bi translated">从网站提取数据</li><li id="807d" class="kc kd hi il b im kl iq km jq kn jr ko js kp jg kh ki kj kk bi translated">从S3自动气象站读取数据</li></ul><h2 id="4671" class="kq kr hi bd ks kt ku kv kw kx ky kz la jq lb lc ld jr le lf lg js lh li lj lk bi translated">从CSV数据中读取</h2><p id="5e51" class="pw-post-body-paragraph ii ij hi il b im ll io ip iq lm is it jq ln iw ix jr lo ja jb js lp je jf jg hb bi translated">从CSV文件中读取数据的最佳方式是使用<code class="du lq lr ls lt b">read.table.</code>。使用<code class="du lq lr ls lt b">read.csv</code>可能很有吸引力，但这比它的价值更麻烦，它所做的只是用一些预设的参数调用<code class="du lq lr ls lt b">read.table</code>。使用<code class="du lq lr ls lt b">read.table</code>的结果是一个<code class="du lq lr ls lt b">data.frame.</code></p><p id="7e5a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">任何CSV都可以，但是出于解释的目的，让我们在<a class="ae jh" href="http://www.jaredlander.com/data/Tomato%20First.csv" rel="noopener ugc nofollow" target="_blank">http://www.jaredlander.com/data/Tomato%20First.csv</a>使用一个极其简单的CSV。让我们使用<code class="du lq lr ls lt b">read.table.</code>将数据读入R</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="2d55" class="kq kr hi lt b fi ly lz l ma mb">url &lt;- "<a class="ae jh" href="http://www.jaredlander.com/data/Tomato%20First.csv" rel="noopener ugc nofollow" target="_blank">http://www.jaredlander.com/data/Tomato%20First.csv</a>"<br/>tomato &lt;- read.table(file = url, header = TRUE, sep = ",")<br/>head(tomato)</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mc"><img src="../Images/216c1c4029764a4942fa87a0a094940f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aFvRveZVrYooOkIu4MU4rQ.png"/></div></div></figure><p id="acd2" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">第二个参数<code class="du lq lr ls lt b">header</code>，表示数据的第一行包含列名。第三个参数给出了分隔数据单元格的分隔符。例如，改变这个<code class="du lq lr ls lt b">“ \t ” or “ ; ”</code>允许它读取其他类型的文件。</p><p id="e933" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">一个经常使用的未知参数是<code class="du lq lr ls lt b">stringAsFactors.</code>，将其设置为<code class="du lq lr ls lt b">False</code>(默认为<code class="du lq lr ls lt b">True</code>)可以防止<code class="du lq lr ls lt b">characters</code>列被转换为<code class="du lq lr ls lt b">factor</code>列。这节省了计算时间—如果是包含许多字符列的大型列数据，并且这些字符列包含许多唯一值，那么这种情况可能会非常严重。</p><p id="4ca6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated"><code class="du lq lr ls lt b"> read.table,</code>还有许多其他的参数，最有用的是<code class="du lq lr ls lt b">quote</code>和<code class="du lq lr ls lt b">colclasses</code>，分别指定用于封闭单元格的字符和每列的数据类型。</p><p id="3aac" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">有时CSV构建得很差，在调用中使用了信元分隔符。在这种情况下，应使用<code class="du lq lr ls lt b">read.csv2</code>或<code class="du lq lr ls lt b">read.delim2</code>代替<code class="du lq lr ls lt b">read.table</code>。r的内置<code class="du lq lr ls lt b">read.table</code>命令可以读取最分离的值格式。</p><p id="f0a6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">使用<code class="du lq lr ls lt b">read.table</code>将大文件读入内存可能会很慢，幸运的是，还有其他选择。读取大型CSV和其他文本文件的两个最突出的函数分别是Hadley Wickham的<code class="du lq lr ls lt b">readr </code>包中的<code class="du lq lr ls lt b">read_delim</code>和Matt Dowle的<code class="du lq lr ls lt b">data.table</code>包中的<code class="du lq lr ls lt b">fread </code>。两者都非常快，都不会自动将<code class="du lq lr ls lt b">character </code>数据转换为<code class="du lq lr ls lt b">factors </code>。</p><p id="854f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated"><code class="du lq lr ls lt b">readr </code>包提供了一系列读取文本文件的函数。最常用的是<code class="du lq lr ls lt b">read_delim </code>，用于读取分隔文件，如<code class="du lq lr ls lt b">CSVs</code>。它的第一个参数是要读取的文件的完整文件名或<code class="du lq lr ls lt b">URL </code>。默认情况下，<code class="du lq lr ls lt b">col_names </code>参数被设置为<code class="du lq lr ls lt b">TRUE </code>，以指定文件的第一行保存列名。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="f131" class="kq kr hi lt b fi ly lz l ma mb">library(readr)<br/>theUrl &lt;- “<a class="ae jh" href="http://www.jaredlander.com/data/TomatoFirst.csv" rel="noopener ugc nofollow" target="_blank">http://www.jaredlander.com/data/TomatoFirst.csv</a>"<br/>tomato2 &lt;-read_delim(file=theUrl, delim=’,’)</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mh"><img src="../Images/05d23f9e43b853b45abb3b36a3138e23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YXhDlUjz_42uwpQnQ9TrPw.png"/></div></div></figure><p id="9a3d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">当执行<code class="du lq lr ls lt b">read_delim </code>时，显示一条消息，显示列名和它们存储的数据类型。可以使用<code class="du lq lr ls lt b">head</code>显示数据。<code class="du lq lr ls lt b">read_delim</code>，以及<code class="du lq lr ls lt b">readr</code>中所有的数据读取函数，返回一个<code class="du lq lr ls lt b">tibble</code>，是<code class="du lq lr ls lt b">data.frame</code>的扩展。最明显的视觉变化是显示元数据，例如行数和列数以及每列的数据类型。<code class="du lq lr ls lt b">tibbles </code>还智能地只打印屏幕上能容纳的行数和列数。</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mi"><img src="../Images/28d5fb8b75d3c8933dd8e280872b6074.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zgDV7aXPx18nWysFMFKYBg.png"/></div></div></figure><p id="f6a1" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated"><code class="du lq lr ls lt b">readr </code>中有helper函数，是read_delim的包装器，预置了特定的分隔符，比如<code class="du lq lr ls lt b">read_csv </code>和<code class="du lq lr ls lt b">read_tsv</code>。</p><p id="c1dc" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">另一个快速读取大数据的选项是<code class="du lq lr ls lt b">data.table</code>包中的<code class="du lq lr ls lt b">fread </code>。第一个参数是要读取的文件的完整文件名或<code class="du lq lr ls lt b">URL </code>。<code class="du lq lr ls lt b">header </code>参数表示文件的第一行保存列名，而<code class="du lq lr ls lt b">sep </code>指定字段分隔符。该函数有一个默认设置为FALSE的<code class="du lq lr ls lt b">stringsAsFactors </code>参数。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="6f8b" class="kq kr hi lt b fi ly lz l ma mb">library(data.table)<br/>theUrl &lt;- "<a class="ae jh" href="http://www.jaredlander.com/data/TomatoFirst.csv" rel="noopener ugc nofollow" target="_blank">http://www.jaredlander.com/data/TomatoFirst.csv</a>"<br/>tomato3 &lt;-fread(input=theUrl, sep=',', header=TRUE)</span></pre><p id="ad1e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">这也比<code class="du lq lr ls lt b">read.table</code>快，并产生一个<code class="du lq lr ls lt b">data.table</code>对象，它是<code class="du lq lr ls lt b">data.frame</code>的扩展。这是另一个在<code class="du lq lr ls lt b">data.frame</code> s基础上改进的特殊对象。read_delim或<code class="du lq lr ls lt b">fread </code>都是快速、有能力的函数，因此决定使用哪个取决于<code class="du lq lr ls lt b">dplyr </code>或<code class="du lq lr ls lt b">data.table</code>是否更适合数据操作。</p><h2 id="2b14" class="kq kr hi bd ks kt ku kv kw kx ky kz la jq lb lc ld jr le lf lg js lh li lj lk bi translated">从Excel中读取</h2><p id="afed" class="pw-post-body-paragraph ii ij hi il b im ll io ip iq lm is it jq ln iw ix jr lo ja jb js lp je jf jg hb bi translated"><code class="du lq lr ls lt b">Excel </code>可能是世界上最流行的数据分析工具，虽然这有好处也有坏处，但这意味着<code class="du lq lr ls lt b">R</code>用户有时会被要求阅读<code class="du lq lr ls lt b">Excel </code>文件。幸运的是，对于任何需要使用Excel数据的人来说，Hadley Wickham的软件包<code class="du lq lr ls lt b">readxl</code>使得阅读<code class="du lq lr ls lt b">Excel </code>文件变得容易，包括<code class="du lq lr ls lt b">.xls </code>和<code class="du lq lr ls lt b">.xlsx</code>。</p><p id="01c4" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">主函数是<code class="du lq lr ls lt b">read_excel</code>，从单个Excel表中读取数据。与<code class="du lq lr ls lt b">read.table</code>、<code class="du lq lr ls lt b">read_delim </code>和<code class="du lq lr ls lt b">fread</code>不同，read_excel不能直接从互联网上读取数据，因此必须先下载文件。我们可以通过访问浏览器来做到这一点，或者我们可以留在R中使用<code class="du lq lr ls lt b">download.file</code>。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="53da" class="kq kr hi lt b fi ly lz l ma mb">download.file(url='<a class="ae jh" href="http://www.jaredlander.com/data/ExcelExample.xlsx',destfile='../data/ExcelExample.xlsx'" rel="noopener ugc nofollow" target="_blank">http://www.jaredlander.com/data/ExcelExample.xlsx',destfile='../data/ExcelExample.xlsx'</a>, method='libcurl')</span></pre><p id="e628" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">下载文件后，我们检查Excel文件中的工作表。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="302e" class="kq kr hi lt b fi ly lz l ma mb">library(readxl)<br/>excel_sheets(‘../data/ExcelExample.xlsx’)</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mj"><img src="../Images/c2a0967f01a5defb50316b1bba2a4823.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nNVAO7bAIgtwaiIqACH8kg.png"/></div></div></figure><p id="1c41" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">默认情况下,<code class="du lq lr ls lt b">read_excel </code>读取第一个工作表，在本例中是保存番茄数据的工作表。结果是一个<code class="du lq lr ls lt b">tibble </code>而不是传统的<code class="du lq lr ls lt b">data.frame</code>。通过提供作为<code class="du lq lr ls lt b">number </code>的纸张位置或作为<code class="du lq lr ls lt b">character</code>的纸张名称，可以指定要读取的纸张。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="f17c" class="kq kr hi lt b fi ly lz l ma mb">wineXL1 &lt;- read_excel('../data/ExcelExample.xlsx', sheet=2)<br/>head(wineXL1)</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mk"><img src="../Images/165118e34cdae6c4326679eed8af0597.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eit3WybeYHAzF-a_AT9zmQ.png"/></div></div></figure><p id="e362" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">因为wineXL1is是一个<code class="du lq lr ls lt b">tibble </code>，所以只打印适合屏幕的列(在本例中是页面)。这将根据终端设置的宽度而变化。</p><h2 id="f066" class="kq kr hi bd ks kt ku kv kw kx ky kz la jq lb lc ld jr le lf lg js lh li lj lk bi translated">从数据库中读取</h2><p id="4d34" class="pw-post-body-paragraph ii ij hi il b im ll io ip iq lm is it jq ln iw ix jr lo ja jb js lp je jf jg hb bi translated">可以说，数据库存储了世界上绝大多数的数据。无论是<code class="du lq lr ls lt b">Mircrosoft SQL Server</code>、<code class="du lq lr ls lt b">DB2</code>还是<code class="du lq lr ls lt b">Microsoft Access</code>中的大多数，都提供了一个<code class="du lq lr ls lt b">ODBC</code>连接。最流行的开源数据库有<code class="du lq lr ls lt b">RPostgreSQL </code>和<code class="du lq lr ls lt b">RMySQL</code>这样的包。没有特定包的其他数据库可以使用更通用的、名称更恰当的<code class="du lq lr ls lt b">RODBC </code>包。数据库连接可能很困难，所以编写了<code class="du lq lr ls lt b">DBI </code>包，以便在使用不同数据库时创建统一的体验。</p><p id="f386" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">设置一个<code class="du lq lr ls lt b">database </code>超出了本文的范围，所以我们使用一个简单的<code class="du lq lr ls lt b">SQLite </code>数据库，尽管这些步骤对于大多数数据库来说是相似的。首先，我们使用<code class="du lq lr ls lt b">download.file</code>下载数据库文件。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="f0ad" class="kq kr hi lt b fi ly lz l ma mb">download.file("<a class="ae jh" href="http://www.jaredlander.com/data/diamonds.db" rel="noopener ugc nofollow" target="_blank">http://www.jaredlander.com/data/diamonds.db</a>",destfile = "../data/diamonds.db", mode='wb')</span></pre><p id="a694" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">因为<code class="du lq lr ls lt b">SQLite </code>有自己的<code class="du lq lr ls lt b">R</code>包，<code class="du lq lr ls lt b">RSQLite</code>，我们使用它来连接我们的数据库，否则，我们将使用<code class="du lq lr ls lt b">RODBC</code>。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="1d83" class="kq kr hi lt b fi ly lz l ma mb">library(RSQLite)</span></pre><p id="12a2" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">为了连接到数据库，我们首先使用<code class="du lq lr ls lt b">dbDriver</code>指定驱动程序。该函数的主要参数是<code class="du lq lr ls lt b">driver</code>的类型，如<code class="du lq lr ls lt b">“SQLite”</code>或<code class="du lq lr ls lt b">“ODBC”</code>。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="7ed7" class="kq kr hi lt b fi ly lz l ma mb">drv &lt;- dbDriver('SQLite')<br/>class(drv)</span></pre><p id="100f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">然后，我们用<code class="du lq lr ls lt b">dbConnect</code>建立到特定数据库的连接。第一个论点是驱动力。最常见的第二个参数是用于<code class="du lq lr ls lt b">database</code>的<code class="du lq lr ls lt b">DSN3 </code>连接字符串，或者用于<code class="du lq lr ls lt b">SQLite </code>数据库的文件路径。附加参数通常是数据库<code class="du lq lr ls lt b">username</code>、<code class="du lq lr ls lt b">password</code>、<code class="du lq lr ls lt b">host </code>和<code class="du lq lr ls lt b">port</code>。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="b11a" class="kq kr hi lt b fi ly lz l ma mb">con &lt;- dbConnect(drv, '../data/diamonds.db')<br/>class(con)</span></pre><p id="c5e3" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">现在我们已经连接到了数据库，我们可以使用<code class="du lq lr ls lt b">DBI </code>包中的函数了解更多关于数据库的信息，比如表中的<code class="du lq lr ls lt b">table </code>名称和<code class="du lq lr ls lt b">fields </code>。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="14d2" class="kq kr hi lt b fi ly lz l ma mb">dbListTables(con)<br/>dbListFields(con, name='diamonds')</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mj"><img src="../Images/f5f10cd9b6305239300b35c2ec220f82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZBJr9bOB-ImqZjgPfBNqVQ.png"/></div></div></figure><p id="00d0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">此时，我们已经准备好使用<code class="du lq lr ls lt b">dbGetQuery</code>在数据库上运行查询。这可以是任意复杂度的任何有效的<code class="du lq lr ls lt b">SQL </code>查询。<code class="du lq lr ls lt b">dbGetQuery </code>返回一个普通的<code class="du lq lr ls lt b">data.frame</code>，就像其他的一样。好在<code class="du lq lr ls lt b">dbGetQuery </code>有<code class="du lq lr ls lt b">stringsAsFactors </code>的说法。同样，将此设置为<code class="du lq lr ls lt b">FALSE </code>通常是一个好主意，因为这将节省处理时间并保持字符数据为<code class="du lq lr ls lt b">character</code>。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="8298" class="kq kr hi lt b fi ly lz l ma mb">longQuery &lt;- "SELECT * FROM diamonds, DiamondColors WHERE diamonds.color = DiamondColors.Color"<br/>diamondsJoin &lt;-dbGetQuery(con, longQuery,stringsAsFactors=FALSE)<br/>head(diamondsJoin)</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es ml"><img src="../Images/46f63ff26d38aa6a22ca7e144afefc05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J7S6TIO5lo9mAgMgdju2jg.png"/></div></div></figure><p id="affe" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">从数据库读取的第一步是创建一个<code class="du lq lr ls lt b">DSN</code>。这与操作系统不同，但会产生该连接的字符串名称。</p><p id="0dca" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">虽然没有必要，但最好使用<code class="du lq lr ls lt b">dbDisconnect</code>关闭<code class="du lq lr ls lt b">ODBC </code>连接，尽管当R关闭或我们使用<code class="du lq lr ls lt b">dbConnect</code>打开另一个连接时，它会自动关闭。一次只能打开一个连接。</p><h2 id="0b81" class="kq kr hi bd ks kt ku kv kw kx ky kz la jq lb lc ld jr le lf lg js lh li lj lk bi translated">r二进制文件</h2><p id="96d8" class="pw-post-body-paragraph ii ij hi il b im ll io ip iq lm is it jq ln iw ix jr lo ja jb js lp je jf jg hb bi translated">当与其他R程序员一起工作时，传递数据或任何R对象(如变量和函数)的一个好方法是使用<code class="du lq lr ls lt b">RData</code>文件。这些二进制文件表示任何类型的R对象。它们可以存储单个或多个对象，并且可以在Windows、Mac或Linux之间顺利传递。</p><p id="7a55" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">首先，让我们创建一个RData文件，删除创建它的对象，然后将它读回r。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="97b6" class="kq kr hi lt b fi ly lz l ma mb">save(tomato, file= "data/tomato.rdata")<br/>rm(tomato)</span><span id="3a36" class="kq kr hi lt b fi mm lz l ma mb">#  Check if it still exist<br/>head(tomato)</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mn"><img src="../Images/4a0b81b6f8aa62823f0fc192270da625.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eb5KDdcJqgfPYfMZiUHKYA.png"/></div></div></figure><p id="c898" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">现在让我们从<code class="du lq lr ls lt b">RData</code>文件再次加载它。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="eefe" class="kq kr hi lt b fi ly lz l ma mb">load("data/tomato.rdata")</span><span id="f97e" class="kq kr hi lt b fi mm lz l ma mb"># Check if it exist now<br/>head(tomato)</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mc"><img src="../Images/216c1c4029764a4942fa87a0a094940f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aFvRveZVrYooOkIu4MU4rQ.png"/></div></div></figure><p id="9a0b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">现在让我们创建多个对象并将它们存储在单个<code class="du lq lr ls lt b">RData</code>文件中，移除它们，然后再次加载它们。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="bcd5" class="kq kr hi lt b fi ly lz l ma mb">n &lt;- 20<br/>r &lt;- 1:10<br/>w &lt;- data.frame(n,r)</span><span id="b2f7" class="kq kr hi lt b fi mm lz l ma mb"># lets check them out<br/>head(w)</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mo"><img src="../Images/72c7f3ff781ca3d311ed8d14f3183325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IG1JCpngXZ1BXo0L8bh2TQ.png"/></div></div></figure><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="812d" class="kq kr hi lt b fi ly lz l ma mb"># save them<br/>save(n,r,w, file="data/multiple.rdata")</span><span id="2d5a" class="kq kr hi lt b fi mm lz l ma mb"># delete them<br/>rm(n,r,w)</span><span id="b285" class="kq kr hi lt b fi mm lz l ma mb"># now load them back from rdata<br/>load("data/multiple.rdata")</span><span id="fb83" class="kq kr hi lt b fi mm lz l ma mb"># print out n and r<br/>n<br/>r</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mp"><img src="../Images/6105cb68fb9174cb295f234ec852e2dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U8SG7BgdfxqdBxQ-DgGzGg.png"/></div></div></figure><h2 id="5917" class="kq kr hi bd ks kt ku kv kw kx ky kz la jq lb lc ld jr le lf lg js lh li lj lk bi translated">R中包含的数据</h2><p id="2224" class="pw-post-body-paragraph ii ij hi il b im ll io ip iq lm is it jq ln iw ix jr lo ja jb js lp je jf jg hb bi translated">除了外部数据源之外，R和一些包都附带了数据，所以我们很容易就有数据可以使用。只要我们知道要做什么，访问这些数据就很简单。例如，<code class="du lq lr ls lt b">ggplot2</code>带有一个关于<code class="du lq lr ls lt b">diamonds</code>的数据集。可以使用如下数据函数加载</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="dd6d" class="kq kr hi lt b fi ly lz l ma mb">require(ggplot2)<br/>data(diamonds)<br/>head(diamonds)</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mq"><img src="../Images/e444a6900fcf377533a291c9680436a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oVQKxRywvxZGJv-m15lYSA.png"/></div></div></figure><p id="6d14" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">要查找可用数据的列表，只需在控制台中键入data()。R中可用的样本数据集如下。</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mr"><img src="../Images/a2eb9dfdaa0cafeb480e9f7e4a4f46b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BIUMU1qcL2YaTG5GrpajjQ.png"/></div></div></figure><h2 id="f035" class="kq kr hi bd ks kt ku kv kw kx ky kz la jq lb lc ld jr le lf lg js lh li lj lk bi translated">从网站提取数据</h2><p id="44c7" class="pw-post-body-paragraph ii ij hi il b im ll io ip iq lm is it jq ln iw ix jr lo ja jb js lp je jf jg hb bi translated">信息经常分散在<code class="du lq lr ls lt b">tables</code>、<code class="du lq lr ls lt b">divs</code>、<code class="du lq lr ls lt b">spans </code>或其他<code class="du lq lr ls lt b">HTML </code>元素中。作为一个例子，我们将一家受欢迎的纽约比萨饼店<code class="du lq lr ls lt b">Ribalta</code>的菜单和餐馆细节放入一个HTML文件中。地址和电话号码存储在有序列表中，区域标识符存储在spans中，商品和价格存储在表格中。</p><p id="5631" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">我们使用Hadley Wickham的<code class="du lq lr ls lt b">rvest </code>包将数据提取为可用的格式。可以使用<code class="du lq lr ls lt b">read_html</code>直接从URL或光盘读取文件。这创建了一个保存所有<code class="du lq lr ls lt b">HTML</code>的<code class="du lq lr ls lt b">xml_document </code>对象。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="4384" class="kq kr hi lt b fi ly lz l ma mb">library(rvest)<br/>ribalta &lt;- read_html('<a class="ae jh" href="http://www.jaredlander.com/data/ribalta.html'" rel="noopener ugc nofollow" target="_blank">http://www.jaredlander.com/data/ribalta.html'</a>)<br/>class(ribalta)<br/>ribalta</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mj"><img src="../Images/ecfd5d551754a85891c43f452dae2e75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HwODoQZEfcxT3UmZKUn8Hg.png"/></div></div></figure><p id="1549" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">通过研究<code class="du lq lr ls lt b">HTML </code>，我们看到地址存储在一个<code class="du lq lr ls lt b">span</code>中，这是一个有序列表的元素。首先，我们使用<code class="du lq lr ls lt b">html_nodes </code>来选择<code class="du lq lr ls lt b">ul </code>元素中的所有<code class="du lq lr ls lt b">span </code>元素。</p><p id="d606" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">遵循一个高度嵌套的<code class="du lq lr ls lt b">HTML </code>元素层次结构可能是麻烦和脆弱的，所以我们通过指定它的<code class="du lq lr ls lt b">class</code>来识别我们感兴趣的元素，在本例中是<code class="du lq lr ls lt b">’street’</code>。在<code class="du lq lr ls lt b">HTML</code>中，<code class="du lq lr ls lt b">class </code>用<code class="du lq lr ls lt b">period (.)</code>表示，<code class="du lq lr ls lt b">ID </code>用<code class="du lq lr ls lt b">hash (#)</code>表示。我们没有让html_nodes搜索一个<code class="du lq lr ls lt b">span</code>，而是让它搜索任何带有<code class="du lq lr ls lt b">class </code>‘street’的元素。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="cb19" class="kq kr hi lt b fi ly lz l ma mb">ribalta %&gt;% html_nodes('.street') %&gt;% html_text()</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es ms"><img src="../Images/bbeabf71ad2018c1a407e4d637fe76aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nw9tb7OhDF8aS_YvYQQi5A.png"/></div></div></figure><p id="ad86" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">在这个特定的文件中，很多信息存储在带有<code class="du lq lr ls lt b">class ’food-items’</code>的表中，所以我们指定html_nodes应该搜索所有带有类<code class="du lq lr ls lt b">’food-items’</code>的表。由于存在多个表，我们使用<code class="du lq lr ls lt b">magrittr </code>包中的<code class="du lq lr ls lt b">extract2 </code>函数指定第六个表。使用<code class="du lq lr ls lt b">html_table</code>最终提取数据并存储在<code class="du lq lr ls lt b">data.frame</code>中。在这种情况下，表没有标题，所以<code class="du lq lr ls lt b">data.frame</code>的列有通用名称。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="0f78" class="kq kr hi lt b fi ly lz l ma mb">ribalta %&gt;%<br/>  html_nodes('table.food-items') %&gt;%<br/>  magrittr::extract2(5) %&gt;%<br/>  html_table()</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mt"><img src="../Images/93fb395ddc2f917ae90518d4cfa7f122.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pgoy6_FNCPiTLOsHLyhVfw.png"/></div></div></figure><h2 id="b42a" class="kq kr hi bd ks kt ku kv kw kx ky kz la jq lb lc ld jr le lf lg js lh li lj lk bi translated">来自其他统计工具的数据</h2><p id="bc8b" class="pw-post-body-paragraph ii ij hi il b im ll io ip iq lm is it jq ln iw ix jr lo ja jb js lp je jf jg hb bi translated">在理想世界中，除了R之外，永远不需要其他工具，但在现实中，数据有时会被锁定在专有格式中，如SAS、SPSS或Octave中的格式。<code class="du lq lr ls lt b">foreign</code>包提供了许多类似于<code class="du lq lr ls lt b">read.table</code>的功能，可以从其他工具读入。</p><p id="dacc" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">下面给出了从常用统计工具中读取数据的部分函数列表。这些函数的参数通常类似于<code class="du lq lr ls lt b">read.table</code>。这些函数通常以<code class="du lq lr ls lt b">data.frame</code>的形式返回数据，但并不总是成功。</p><ul class=""><li id="0511" class="kc kd hi il b im in iq ir jq ke jr kf js kg jg kh ki kj kk bi translated">read.spss — SPSS</li><li id="f773" class="kc kd hi il b im kl iq km jq kn jr ko js kp jg kh ki kj kk bi translated">read.dta — Stata</li><li id="d5bb" class="kc kd hi il b im kl iq km jq kn jr ko js kp jg kh ki kj kk bi translated">read.ssd — SAS</li><li id="1e64" class="kc kd hi il b im kl iq km jq kn jr ko js kp jg kh ki kj kk bi translated">read.octave —八度</li><li id="daa2" class="kc kd hi il b im kl iq km jq kn jr ko js kp jg kh ki kj kk bi translated">read.mtp — Minitab</li><li id="734f" class="kc kd hi il b im kl iq km jq kn jr ko js kp jg kh ki kj kk bi translated">read.systat — Systat</li></ul><p id="802d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">虽然<code class="du lq lr ls lt b">read.ssd</code>可以读取SAS数据，但需要有效的SAS许可证。这可以通过使用<code class="du lq lr ls lt b">Revolution Analytics</code>中的<code class="du lq lr ls lt b">Revolution </code>及其<code class="du lq lr ls lt b">RevoScaleR</code>封装中的特殊<code class="du lq lr ls lt b">RxSasData</code>功能来回避。</p><h2 id="8eb8" class="kq kr hi bd ks kt ku kv kw kx ky kz la jq lb lc ld jr le lf lg js lh li lj lk bi translated">解读美国气象学会S3分会</h2><p id="2907" class="pw-post-body-paragraph ii ij hi il b im ll io ip iq lm is it jq ln iw ix jr lo ja jb js lp je jf jg hb bi translated">从<code class="du lq lr ls lt b">AWS S3</code>读取数据的一种常见方式是使用客户端包<code class="du lq lr ls lt b">aws.s3</code>。<code class="du lq lr ls lt b">aws.s3</code>是一个用于<code class="du lq lr ls lt b">AWS S3</code> REST API的简单客户端包。虽然其他包目前将R连接到了<code class="du lq lr ls lt b">S3</code>，但是它们做得不完全(仅将一些API端点映射到R ),并且大多数实现依赖于<code class="du lq lr ls lt b">AWS</code>命令行工具，用户可能没有在他们的系统上安装这些工具。</p><p id="366c" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">这个包裹还没有开始运送。要安装最新的开发版本，您可以从<code class="du lq lr ls lt b">cloudyr drat</code>库安装。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="ee39" class="kq kr hi lt b fi ly lz l ma mb"><em class="ik"># latest stable version</em><br/><strong class="lt hj">install.packages</strong>("aws.s3", repos = <strong class="lt hj">c</strong>("cloudyr" = "http://cloudyr.github.io/drat"))</span><span id="337c" class="kq kr hi lt b fi mm lz l ma mb"><em class="ik"># on windows you may need:</em><br/><strong class="lt hj">install.packages</strong>("aws.s3", repos = <strong class="lt hj">c</strong>("cloudyr" = "http://cloudyr.github.io/drat"), INSTALL_opts = "--no-multiarch")</span></pre><p id="9e5b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">一旦完成，你就可以使用<a class="ae jh" href="https://github.com/cloudyr/aws.s3#code-examples" rel="noopener ugc nofollow" target="_blank">示例</a>中描述的功能访问S3(假设你有正确的权限)。</p><blockquote class="if ig ih"><p id="9533" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">如果您没有访问密钥和秘密密钥，请点击<a class="ae jh" href="https://aws.amazon.com/blogs/security/wheres-my-secret-access-key/" rel="noopener ugc nofollow" target="_blank">链接</a>获取您的凭证。</p></blockquote><p id="02c7" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">例如，列出如下文件对我很有用:</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="54ca" class="kq kr hi lt b fi ly lz l ma mb">Sys.setenv("AWS_ACCESS_KEY_ID" = "XXXXXXXXX",<br/>           "AWS_SECRET_ACCESS_KEY" = "yyyyyyyy",<br/>           "AWS_DEFAULT_REGION" = "us-west-1")</span><span id="bbb4" class="kq kr hi lt b fi mm lz l ma mb">library("aws.s3")<br/>bucketlist()</span><span id="e91b" class="kq kr hi lt b fi mm lz l ma mb"># To get listing of all objects in a public bucket</span><span id="a7d9" class="kq kr hi lt b fi mm lz l ma mb">files &lt;- get_bucket(bucket = 'bucket name')</span></pre><p id="9dd6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">对地区规格可能有点挑剔。<code class="du lq lr ls lt b">bucketlist()</code>将从所有区域返回桶，但是所有其他函数都需要指定一个区域。如果没有明确指定，并且无法自动检测到正确的区域，则依赖默认的<code class="du lq lr ls lt b">"us-east-1"</code>。</p><p id="e757" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">从S3读取对象并将对象写入<code class="du lq lr ls lt b">S3</code>的一些常用函数如下。</p><pre class="jj jk jl jm fd lu lt lv lw aw lx bi"><span id="a5fb" class="kq kr hi lt b fi ly lz l ma mb"><em class="ik"># save an in-memory R object into S3</em><br/><strong class="lt hj">s3save</strong>(mtcars, bucket = "my_bucket", object = "mtcars.Rdata")</span><span id="1ba6" class="kq kr hi lt b fi mm lz l ma mb"><em class="ik"># `load()` R objects from the file</em><br/><strong class="lt hj">s3load</strong>("mtcars.Rdata", bucket = "my_bucket")</span><span id="97de" class="kq kr hi lt b fi mm lz l ma mb"><em class="ik"># get file as raw vector</em><br/><strong class="lt hj">get_object</strong>("mtcars.Rdata", bucket = "my_bucket")<br/><em class="ik"># alternative 'S3 URI' syntax:</em><br/><strong class="lt hj">get_object</strong>("s3://my_bucket/mtcars.Rdata")</span><span id="7446" class="kq kr hi lt b fi mm lz l ma mb"><em class="ik"># save file locally</em><br/><strong class="lt hj">save_object</strong>("mtcars.Rdata", file = "mtcars.Rdata", bucket = "my_bucket")</span><span id="62cd" class="kq kr hi lt b fi mm lz l ma mb"><em class="ik"># put local file into S3</em><br/><strong class="lt hj">put_object</strong>(file = "mtcars.Rdata", object = "mtcars2.Rdata", bucket = "my_bucket")</span></pre><p id="01d4" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated">读取数据是任何分析的第一步；所以这是任何数据分析项目中最重要的一步。在本文中，我们已经广泛地讨论了将数据读入R环境的一些最常见的方法。在我们的下一篇文章中，我们将看到如何使用r分析数据并生成高质量的支持图形。</p><p id="2923" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jq iv iw ix jr iz ja jb js jd je jf jg hb bi translated"><a class="ae jh" rel="noopener" href="/@viveksrinivasan/statistical-visualization-in-r-2-9e9070bcdecf"><em class="ik">R—2中的统计可视化</em> </a></p><blockquote class="if ig ih"><p id="a368" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">一定要通过评论和分享文章来分享你的想法和支持。</p></blockquote></div></div>    
</body>
</html>