<html>
<head>
<title>How to implement user authentication in Python Django?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 Python Django 中实现用户认证？</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-implement-user-authentication-in-python-django-cc909948075?source=collection_archive---------27-----------------------#2020-10-10">https://medium.com/analytics-vidhya/how-to-implement-user-authentication-in-python-django-cc909948075?source=collection_archive---------27-----------------------#2020-10-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8b93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">什么是认证？在许多网站上，我们需要某种认证方法。一些用户能够登录和注销的能力。在这篇博客中，我们将介绍一个应用程序，它允许我们使用 Django 的内置身份验证方法与这种身份验证方法进行交互。</p><p id="0960" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为 Django 在框架中内置了一大堆我们可以利用的认证特性，所以我们不需要重写所有的逻辑，比如如何让用户登录，以及代表用户意味着什么。姜戈为我们做了很多。</p><p id="b666" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们现在将创建一个应用程序来完成这项工作。</p><p id="224b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一步:创建一个可以在任何应用程序中维护用户的应用程序。例如，<strong class="ih hj">用户使用命令</strong></p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="5294" class="jm jn hi ji b fi jo jp l jq jr">python <a class="ae js" href="http://manage.py/" rel="noopener ugc nofollow" target="_blank">manage.py</a> startapp users</span></pre><p id="f049" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第二步:每当你创建一个新的应用程序时，进入<a class="ae js" href="http://settings.py/" rel="noopener ugc nofollow" target="_blank"> settings.py </a>，用新的应用程序名称更新已安装的应用程序。</p><p id="398d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jt"> settings.py </em></p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="3a46" class="jm jn hi ji b fi jo jp l jq jr">INSTALLED_APPS = [<br/>    <strong class="ji hj">'django.contrib.admin'</strong>,<br/>    <strong class="ji hj">'django.contrib.auth'</strong>,<br/>    <strong class="ji hj">'django.contrib.contenttypes'</strong>,<br/>    <strong class="ji hj">'django.contrib.sessions'</strong>,<br/>    <strong class="ji hj">'django.contrib.messages'</strong>,<br/>    <strong class="ji hj">'django.contrib.staticfiles'</strong>,<br/>    <strong class="ji hj">'users',</strong><br/>]</span></pre><p id="fd65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤 3:转到项目<a class="ae js" href="http://urls.py/" rel="noopener ugc nofollow" target="_blank"> urls.py </a>并为新的应用程序 URL 设置路径:</p><p id="98ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jt"> urls.py </em></p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="b365" class="jm jn hi ji b fi jo jp l jq jr">from django.contrib import admin<br/>from django.urls import path, include<br/>urlpatterns = [<br/>    path(<strong class="ji hj">'admin/'</strong>, admin.site.urls),<br/>    path(<strong class="ji hj">''</strong>,include(<strong class="ji hj">'user.urls'</strong>))<br/>]</span></pre><p id="891b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤 4:现在在用户应用程序中，所有与我的用户应用程序相关联的 URL。我需要导入路径，导入我的视图，然后定义一些 URL 模式。在这里，将 URL 设置为三个功能:索引、登录和注销。所以我们实际上有三条不同的路线。一个主要的索引路径将显示当前登录用户的信息。一个让某人登录的路径，一个显示他们可以输入用户名和密码登录的地方的表单。然后，一个路由允许用户也能够从该应用程序注销。</p><p id="a9c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">app- <em class="jt"> urls.py </em></p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="8ba9" class="jm jn hi ji b fi jo jp l jq jr">from django.urls import path<br/>from .import views</span><span id="11e9" class="jm jn hi ji b fi ju jp l jq jr">app_name=<strong class="ji hj">'users'</strong></span><span id="f424" class="jm jn hi ji b fi ju jp l jq jr">urlpatterns = [<br/>    path(<strong class="ji hj">'index'</strong>,views.index,name=<strong class="ji hj">"index"</strong>),<br/>    path(<strong class="ji hj">'user'</strong>,views.login_page,name=<strong class="ji hj">"login"</strong>),<br/>    path(<strong class="ji hj">'logout'</strong>,views.logout_page,name=<strong class="ji hj">"logout"</strong>),<br/>]</span></pre><p id="dbb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤 5:现在让我们在应用程序中创建模板。我将创建一个模板文件夹。我们将在其中创建一个基本布局。这将是这个应用程序的页面的一般结构。这里称之为<em class="jt">layout.html</em>:</p><p id="b501" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jt">layout.html</em></p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="1856" class="jm jn hi ji b fi jo jp l jq jr">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>    &lt;meta charset="UTF-8"&gt;<br/>    &lt;title&gt;Users&lt;/title&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>    {% block body %}<br/>    {% endblock %}</span><span id="ad8e" class="jm jn hi ji b fi ju jp l jq jr">&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="7f29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我有了这个 HTML 布局，我可以继续创建一个名为 login.html 的新文件，login.html 将在其中扩展 layout.html。在 body 块中，我可以用 HTML 格式显示。</p><p id="b473" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">login.html:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="b5b5" class="jm jn hi ji b fi jo jp l jq jr">{% extends "layout.html" %}</span><span id="e4d3" class="jm jn hi ji b fi ju jp l jq jr">{% block body %}<br/>{% if message %}<br/>    &lt;div&gt;{{message}}&lt;/div&gt;<br/>{% endif %}<br/>&lt;form action="{% url 'users:login' %}" method="post"&gt;<br/>    {% csrf_token %}<br/>    &lt;input type="text" name="username" placeholder="Username"&gt;<br/>    &lt;input type="password" name="password" placeholder="Password"&gt;<br/>    &lt;input type="submit" value="Log in"&gt;<br/>&lt;/form&gt;</span><span id="f786" class="jm jn hi ji b fi ju jp l jq jr">{% endblock %}</span></pre><p id="65e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，当我登录时，我正在提交一个表单。通常，当您这样做时，您希望通过 post 提交表单数据，尤其是在用户名和密码的情况下。因为如果你做这样的事情，你不希望用户名和密码作为 get 参数传入，因为它们会出现在 URL 中。</p><p id="6582" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第 6 步:现在让我们登录到管理员，并添加一些用户名和密码字段。这些用户可以有其他相关信息，如名字、姓氏、电子邮件。</p><figure class="jd je jf jg fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es jv"><img src="../Images/d69d8117c1b56dafc4072902fc8924f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5gJF1OmxEnqW55Ut_Bk0DQ.png"/></div></div></figure><p id="6285" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第 7 步:然后，让我们编写<a class="ae js" href="http://views.py/" rel="noopener ugc nofollow" target="_blank"> views.py </a>来完成认证。在 views.py 中，我们首先需要考虑如果有人试图访问这个页面但他们没有通过身份验证，会发生什么。我们如何发现这一点，在这种情况下我们该怎么做？好吧，比方说，如果没有<em class="jt">request . user . is _ authenticated，</em>作为请求的一部分传递给 Django 中每个用户的请求对象自动拥有一个与之相关联的用户属性。用户对象有一个<em class="jt"> is_authenticated </em>属性，告诉我们用户是否登录。如果他们没有登录，我们将继续，HTTP 响应将他们重定向到 log in 视图。为了实现这个功能，我需要从 django.http 导入 HttpResponseRedirect。同样，<em class="jt">从 django.urls </em>开始，<em class="jt">也导入反向</em>。因此，如果用户没有通过身份验证，那么我们将把他们重定向到 log in 视图，这是一种用户可以自己登录的形式。</p><p id="6a99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后在<em class="jt">登录</em>视图中，有两种方法可以调用登录视图功能。一种是通过 get 请求方法，这意味着只在表单中显示日志。一种是通过 post，也以日志的形式提交数据。因此，如果请求方法是 post，那么获取用户名，该用户名将包含在名为用户名的字段中的 post 数据中。让我获取密码，该密码将位于密码内 request.post 的一个字段中。</p><p id="3fa5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后使用 Django 内置的<em class="jt">身份验证</em>方法对用户进行身份验证。如果返回一个用户，继续使用 Django 的内置<em class="jt">登录</em>方法登录，否则返回到显示消息<em class="jt">无效凭证的登录页面。</em></p><p id="21e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在使用 Django 内置的 logout 函数编写 logout 视图。不要忘记从 django.contrib.auth 导入 authenticate、login 和 logout。</p><p id="15e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jt"> views.py </em></p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="5c1b" class="jm jn hi ji b fi jo jp l jq jr">from django.shortcuts import render<br/>from django.http import HttpResponseRedirect<br/>from django.urls import reverse<br/>from django.contrib.auth import authenticate,login,logout<br/><em class="jt"># Create your views here.</em></span><span id="9edf" class="jm jn hi ji b fi ju jp l jq jr">def index(request):<br/>    if not request.user.is_authenticated:<br/>        return HttpResponseRedirect(reverse(<strong class="ji hj">'login'</strong>))<br/>    return render(request, <strong class="ji hj">"user.html"</strong>)</span><span id="0b6c" class="jm jn hi ji b fi ju jp l jq jr">def login_page(request):<br/>    if request.method == <strong class="ji hj">"POST"</strong>:<br/>        username = request.POST[<strong class="ji hj">'username'</strong>]<br/>        password=request.POST[<strong class="ji hj">'password'</strong>]<br/>        user=authenticate(request,username=username,password=password)<br/>        if user is not None:<br/>            login(request,user)<br/>            return HttpResponseRedirect(reverse(<strong class="ji hj">"users:index"</strong>))<br/>        else:<br/>            return render(request,<strong class="ji hj">"userlogin.html"</strong>,{<br/>                <strong class="ji hj">"message"</strong>:<strong class="ji hj">"Invalid Credentials"</strong><br/><strong class="ji hj">            </strong>})<br/>    return render(request,<strong class="ji hj">"userlogin.html"</strong>)</span><span id="1c67" class="jm jn hi ji b fi ju jp l jq jr">def logout_page(request):<br/>    logout(request)<br/>    return render(request,<strong class="ji hj">'userlogin.html'</strong>,{<br/>        <strong class="ji hj">'message'</strong>:<strong class="ji hj">"Logged out"</strong><br/><strong class="ji hj">    </strong>})</span></pre><p id="45c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，如果用户通过了身份验证，他/她将转到 user.html，这里显示了一些用户信息。</p><p id="612f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jt">user.html</em></p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="b427" class="jm jn hi ji b fi jo jp l jq jr">{% extends "layout.html" %}</span><span id="7cc5" class="jm jn hi ji b fi ju jp l jq jr">{% block body %}<br/>&lt;h2&gt; Welcome {{request.user.firstname}}&lt;/h2&gt;<br/>&lt;ul&gt;<br/>    &lt;li&gt;Username: {{request.user.username}}&lt;/li&gt;<br/>    &lt;li&gt;Email:{{request.user.email}}&lt;/li&gt;<br/>&lt;/ul&gt;</span><span id="579f" class="jm jn hi ji b fi ju jp l jq jr">&lt;a href="{%url 'users:logout' %}"&gt;Log Out&lt;/a&gt;<br/>{% endblock %}</span></pre><p id="ee5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是 Django 内置的用户认证系统。一个允许我们非常快速地让用户能够从我们的 web 应用程序登录和注销的系统。Django 为开发者提供了许多有趣的特性，可以有效地使用。希望这对你有帮助。感谢阅读。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><p id="c0a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jt">原载于 2020 年 10 月 10 日</em><a class="ae js" href="https://www.numpyninja.com/post/how-to-implement-user-authentication-in-python-django" rel="noopener ugc nofollow" target="_blank"><em class="jt">https://www.numpyninja.com</em></a><em class="jt">。</em></p></div></div>    
</body>
</html>