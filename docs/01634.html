<html>
<head>
<title>Introduction to Data Wrangling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据争论简介</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/introduction-to-data-wrangling-88c1b5e747cb?source=collection_archive---------2-----------------------#2019-11-05">https://medium.com/analytics-vidhya/introduction-to-data-wrangling-88c1b5e747cb?source=collection_archive---------2-----------------------#2019-11-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/31381be9a660095e7345e906985c9b81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Tg_yMIZF9du52HuB"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">米卡·鲍梅斯特在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="fa3c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当我们执行<strong class="ix hj">数据争论</strong>时，我们将输入数据从原始状态转换成一种格式，在这种格式下我们可以对其进行有意义的分析。数据操作是指这一过程的另一种方式。没有固定的操作列表或顺序；唯一的目标是，数据后争论对我们来说比我们开始时更有用。</p><p id="aaef" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在实践中，数据争论过程涉及三个常见任务:</p><ul class=""><li id="0ec8" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">数据清理</li><li id="dcbe" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">数据转换</li><li id="220a" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">数据丰富</li></ul><p id="9f9f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本文节选自帕克特出版社出版的斯蒂芬妮·莫林所著的《熊猫数据分析》一书。这本书涵盖了数据分析师和科学家如何收集和分析数据的基本理解，机器学习(ML)算法来识别模式等等。在本文中，我们将学习数据争论的基础及其过程。</p><h1 id="b3fc" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">数据清理</h1><p id="e109" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">对我们的数据框架进行第一轮数据清理通常会给我们提供开始研究数据所需的最少数据。需要掌握的一些基本数据清理任务包括:</p><p id="ec58" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">重新命名</p><p id="67c2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">排序和重新排序</p><p id="6ba3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">数据类型转换</p><p id="a0c5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">重复数据删除</p><p id="af1d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">解决缺失或无效数据的问题</p><p id="5608" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">过滤到所需的数据子集</p><p id="1167" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">数据清理是数据争论的最佳起点，因为将数据存储为正确的数据类型和易于引用的名称将为探索和争论机会开辟许多途径，例如汇总统计、排序和过滤。</p><h1 id="490a" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">数据转换</h1><p id="ba03" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">通常，在一些初始的数据清理之后，我们将到达数据转换阶段，但是完全有可能我们的数据集在其当前形状下是不可用的，并且我们必须在尝试进行任何数据清理之前重新构造它。在<strong class="ix hj">数据转换</strong>中，我们专注于改变数据的结构，以便于我们的下游分析；这通常包括更改哪些数据沿着行，哪些数据沿着列。</p><p id="4146" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将发现的大多数数据要么是宽格式<strong class="ix hj">要么是长格式<strong class="ix hj"/>；每种格式都有其优点，知道我们需要哪种格式来进行分析是很重要的。通常，人们会以宽格式记录和呈现数据，但也有一些可视化要求数据采用长格式:</strong></p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es lk"><img src="../Images/c73ba70a7ef812aaaa1a95093b1d1bd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*L-g_jaUwqoNu1lrbbYBnUQ.jpeg"/></div></figure><p id="5fd4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">宽格式是分析和数据库设计的首选，而长格式被认为是糟糕的设计，因为每一列都应该是自己的数据类型，并且具有单一的含义。然而，在向关系数据库的表中添加新字段(或删除旧字段)的情况下，数据库的维护人员可能会决定使用长格式，而不是每次都要修改所有的表。这允许他们为数据库用户提供固定的模式，同时能够根据需要更新数据库中包含的数据。构建API时，如果需要灵活性，可以选择长格式。也许API会提供一种通用的响应格式(日期、字段名称和字段值),可以支持数据库中的各种表。这可能还与使响应更容易形成有关，这取决于数据如何存储在API使用的数据库中。因为我们会发现这两种格式的数据，所以了解如何使用这两种格式并从一种格式转换到另一种格式很重要。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="1a8f" class="lu ki hi lq b fi lv lw l lx ly">import matplotlib.pyplot as plt<br/>import pandas as pd<br/> <br/> wide_df = pd.read_csv(‘data/wide_data.csv’, parse_dates=[‘date’])<br/> long_df = pd.read_csv(‘data/long_data.csv’, usecols=[‘date’, ‘datatype’, ‘value’], parse_dates=[‘date’])<br/>[[‘date’, ‘datatype’, ‘value’]] # sort columns</span></pre><h1 id="10a8" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">宽数据格式</h1><p id="bace" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">对于宽格式数据，我们用它们自己的列来表示变量的度量，每一行表示这些变量的一个观察值。这使得我们可以很容易地跨观测值比较变量，获得汇总统计数据，执行操作，并呈现我们的数据；但是，有些可视化不支持这种数据格式，因为它们可能依赖长格式来拆分、调整和/或着色绘图内容。</p><p id="43a3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们来看看wide_df中宽格式数据的前六个观察值:</p><p id="6a9e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lz ma mb lq b">wide_df.head(6)</code></p><p id="1495" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">每列包含特定类别温度数据的前六个观测值(以摄氏度为单位)，即最高温度(TMAX)、最低温度(TMIN)和观测时的温度(TOBS)，频率为每日:</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/492fb6aa48e073894dc5bc466030fdb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*ywR8S6VaHWdaew97NjFnmQ.png"/></div></figure><p id="31ab" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当处理宽格式数据时，我们可以通过使用describe()方法轻松地获取该数据的汇总统计信息(保存为wide_df变量):</p><p id="673a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lz ma mb lq b">wide_df.describe(include=’all’)</code></p><p id="3925" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们几乎不需要做任何努力，就可以获得日期、最高温度、最低温度和观测时温度的汇总统计数据:</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es md"><img src="../Images/da0161c13f7395c5b35dca0d6e033e98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*V52NmvwPti0VUFTnMpYuHA.png"/></div></figure><p id="7de6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如我们之前所讨论的，上表中的汇总数据很容易获得，并且信息丰富。这种格式也可以很容易地用熊猫来绘制，只要我们准确地告诉它我们想要绘制的内容:</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="56c7" class="lu ki hi lq b fi lv lw l lx ly">wide_df.plot(kind='line', y=[‘TMAX’, ‘TMIN’, 'TOBS'], x='date', title='Temperature in NYC in October 2018', figsize=(15, 5)).set_ylabel(‘Temperature in Celsius’)</span><span id="3989" class="lu ki hi lq b fi me lw l lx ly">plt.show()</span></pre><p id="4056" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Pandas将每日最高温度、最低温度和观察时的温度绘制成单线图:</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es mf"><img src="../Images/3ebe5b07e6abbd1d91dd2137d9a435a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*jpV9ZX6BLNnqkU9AQNNLJQ.png"/></div></figure><p id="04ce" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">现在不要担心理解可视化代码；这里只是为了说明每种数据格式如何使某些任务变得更容易或更困难..</strong></p><h1 id="0613" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">长数据格式</h1><p id="d2b6" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">我们可以查看long_df中长格式数据的前六行，以了解宽格式和长格式数据之间的差异:</p><p id="457e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lz ma mb lq b">long_df.head(6)</code></p><p id="2d04" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于变量的每个观察值，长格式数据都有一行；这意味着，如果我们每天测量三个变量，我们每天记录三行观察值。长格式设置可以通过将变量列名转换为数据是变量名称的列，并将它们的值放在单独的值列中来实现:</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es mg"><img src="../Images/1c7beb413d8cf481192b4b3c74646213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*Od7xlsuBV9pYOB6ZBGtqXg.png"/></div></figure><p id="0cf3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意，在前面的表中，每个日期有三个条目，datatype列告诉我们value列中的数据是该行的什么。如果我们试图获得汇总统计数据，就像我们对宽格式(long_df，长格式数据)所做的那样，我们得不到有用的信息——知道所有最小值、最大值和其他温度观测值的平均值没有帮助:</p><p id="deea" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lz ma mb lq b">long_df.describe(include=’all’)</code></p><p id="6dad" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">value列向我们显示汇总统计数据，但这是汇总每日最高温度、最低温度和观察时的温度。最大值将是每日最高温度的最大值，最小值将是每日最低温度的最小值。这意味着这些汇总数据是无用的:</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es mh"><img src="../Images/623b2748bad6de23a9372fc5b98f3368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*pBZtic_ZeggmkPgMqfUZsA.png"/></div></figure><p id="9e8a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这种格式不太容易理解，当然也不应该是我们呈现数据的方式；然而，它使创建可视化变得容易，我们的绘图库可以根据变量的名称给线着色，根据某个变量的值确定点的大小，并为刻面执行分割。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="3f59" class="lu ki hi lq b fi lv lw l lx ly">import seaborn as sns<br/>sns.set(rc={‘figure.figsize’:(15, 5)}, style=’white’)<br/>ax = sns.lineplot(data=long_df, hue=’datatype’, y=’value’, x=’date’)</span><span id="6ae0" class="lu ki hi lq b fi me lw l lx ly">ax.set_ylabel(‘Temperature in Celsius’)<br/>ax.set_title(‘Temperature in NYC in October 2018’)<br/>plt.show()</span></pre><p id="be1d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Seaborn能够根据数据类型列进行子集划分，为我们提供每日最高温度、最低温度和观察时的温度的单独线条:</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es mi"><img src="../Images/d23e75cfb2c339dda88e8881945ad9f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*DytQsMHPLew8kRE_Hnhlgg.png"/></div></figure><p id="0315" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Seaborn让我们指定用于hue的列，它根据温度类型给线条着色。然而，我们并不局限于此；有了长数据，我们可以很容易地将我们的图分成小平面:</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="17ee" class="lu ki hi lq b fi lv lw l lx ly">sns.set(rc={‘figure.figsize’:(20, 10)}, style=’white’, font_scale=2)<br/>g = sns.FacetGrid(long_df, col=”datatype”, height=10)<br/>g = g.map(plt.plot, “date”, “value”)<br/>g.set_titles(size=25)<br/>g.set_xticklabels(rotation=45)<br/>plt.show()</span></pre><p id="e35c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Seaborn能够使用长格式数据为每个不同的数据类型创建子图:</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es mj"><img src="../Images/9e688aa53152682af7599d3e40f0d521.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*8nekDp80SI5nh416PbhzGA.png"/></div></figure><p id="5d8a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">虽然有可能使用支线剧情创造一个类似于上一部的<em class="mk">熊猫</em>和<em class="mk"> matplotlib </em>的剧情，但是更复杂的层面组合将会使使用<em class="mk"> seaborn </em>变得更加容易。</p><h1 id="3dc3" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">数据丰富</h1><p id="7ac5" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">当我们希望丰富数据时，我们可以将新数据与原始数据合并(通过添加新的行或列),或者使用原始数据创建新数据。以下是使用原始数据增强我们的数据的方法:</p><p id="622a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">添加新列</strong>:对现有列的数据使用函数来创建新值</p><p id="6a2a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">宁滨</strong>:将具有许多不同值的连续数据或离散数据转换成范围桶，这使得列是离散的，同时允许我们控制列中可能值的数量</p><p id="e5fd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">汇总</strong>:汇总数据并汇总</p><p id="f034" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">重采样</strong>:以特定间隔聚合时间序列数据</p><p id="0aa1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">总之，在本文中，我们学习了数据争论及其过程的基础知识。要了解更多数据争论的细节，请查阅帕克特出版社出版的《T2与熊猫的动手数据分析》一书。</p></div></div>    
</body>
</html>