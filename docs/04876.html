<html>
<head>
<title>The secret of Simulation — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模拟的秘密—第二部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/the-secret-of-simulation-part-2-d59c1c2ed44f?source=collection_archive---------24-----------------------#2020-04-03">https://medium.com/analytics-vidhya/the-secret-of-simulation-part-2-d59c1c2ed44f?source=collection_archive---------24-----------------------#2020-04-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/4cde5dc75ebed2b8d117b51ef944e999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*73wjrFd5wAkeoMCh"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">威廉·艾文在<a class="ae hv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class=""/><p id="4e92" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">随着系统的增长，模拟也在增长。人们正在进行不同类型的模拟，以了解系统在现实世界中是如何工作的。</p><p id="520b" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我的<a class="ae hv" rel="noopener" href="/@ritikjain51/secrets-of-simulation-2b314cd8c297">之前的博客</a>中，我对模拟做了一个简单的了解。以及基本模拟是如何工作的。我还讨论了我们所有的模拟模型。</p><p id="2d23" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这篇博客中，我将只讨论与基于时间的<strong class="ix hz">基于智能体的模拟</strong>。我们有几个系统可以及时进行评估。金融领域的银行系统、交易系统、股票交易系统或生物系统中的人类进化等等。时间是系统进化中的一个重要因素，因为随着时间的变化，环境也在变化，进化也在继续。</p><p id="b332" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于这个博客，我们正在考虑全球客户之间的交易系统。</p><p id="2931" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在深入使用案例之前，让我们先了解一下<em class="jt">什么是基于代理的模拟</em>及其变体。基于代理的模拟<em class="jt">是一种包括一些实体来处理操作的模拟。<em class="jt">例如</em>，如果一个人向另一个客户转账，有一个代理人(银行)将验证和核实交易，以便进一步处理。在这种情况下，一个实时代理处理所有请求。因此，如果我们为<em class="jt">转账系统</em>创建模拟，那么我们需要一个编程代理，它将作为一个真正的代理工作。这就是为什么我们需要<strong class="ix hz"><em class="jt"/></strong>基于智能体的模拟。</em></p><p id="3888" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有时，我们会有不止一个代理人参与互动，促成交易。这种类型的模拟称为<strong class="ix hz"> <em class="jt">基于多智能体的模拟</em>。</strong></p><p id="3965" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz"> <em class="jt">问:事务型系统是基于单智能体的模拟还是基于多智能体的模拟？</em>T29】</strong></p><p id="6697" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一些模拟是时间相关的。如果我们谈论的是我们上面讨论过的系统。它们是基于时间的系统。使用两种时间机制的模拟</p><ul class=""><li id="e3e1" class="ju jv hy ix b iy iz jc jd jg jw jk jx jo jy js jz ka kb kc bi translated">下一个事件时间推进</li><li id="3ce5" class="ju jv hy ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated">固定时间增量时间推进</li></ul><p id="63d2" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">下一个事件时间提前</strong>机制未来事件的发生时间基于一系列事件。</p><p id="11d1" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">固定时间增量时间推进</strong>机制时钟推进特定的时间单位(δt)进行增量。增量只会在固定时间后发生，任何事件都不会影响时间增量。</p><p id="9bc8" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz"> <em class="jt">问:哪种机制适用于我们的系统？</em> </strong></p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="32dc" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz"> <em class="jt">交易流水系统</em> </strong></p><figure class="kq kr ks kt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kp"><img src="../Images/7c6d9cbc87c5ec2a8f2ad3d1c14ea795.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IZ7CqBtNHimQnsL-3Q9Bow.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">交易流程系统</figcaption></figure><p id="e8b7" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如上图所示，交易流系统是一个基于多智能体的模拟<strong class="ix hz">。为了进行交易，我们有多个客户、商家和银行。</strong></p><p id="27e0" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">交易步骤</strong> <br/>为了使交易成功，业务流转了一些步骤</p><ol class=""><li id="23a0" class="ju jv hy ix b iy iz jc jd jg jw jk jx jo jy js ku ka kb kc bi translated">发送方将使用所有接收方的详细信息从其端发起交易。</li><li id="9d21" class="ju jv hy ix b iy kd jc ke jg kf jk kg jo kh js ku ka kb kc bi translated">交易详细信息转到汇款人的银行进行交易验证。</li><li id="3e38" class="ju jv hy ix b iy kd jc ke jg kf jk kg jo kh js ku ka kb kc bi translated">验证后，交易被转发到中央系统进行验证</li><li id="6b70" class="ju jv hy ix b iy kd jc ke jg kf jk kg jo kh js ku ka kb kc bi translated">收款人的银行接收经过验证的详细信息，以便进行银行级验证。</li><li id="5049" class="ju jv hy ix b iy kd jc ke jg kf jk kg jo kh js ku ka kb kc bi translated">在所有验证之后，交易被接收到接收方。</li></ol><p id="aa18" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了模拟交易，我们必须创建一个基础环境。</p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="1291" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz"> <em class="jt">仿真模型和结构</em> </strong></p><p id="108e" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">模拟模型文件结构包含参与者、参数、输出工具和初始化模拟。</p><pre class="kq kr ks kt fd kv kw kx ky aw kz bi"><span id="c48a" class="la lb hy kw b fi lc ld l le lf">Simulator<br/>|<br/>|----- Actor<br/>|       |<br/>|       |----- Bank<br/>|       |<br/>|       |----- Client<br/>|       |<br/>|       |----- Transaction<br/>|        <br/>|----- Parameter<br/>|       |<br/>|       |----- Configuration<br/>|<br/>|----- Output<br/>|       |<br/>|       |----- DBModel<br/>|       |----- CSVModel<br/>|<br/>|----- utils<br/>|       |<br/>|       |----- helperutils<br/>|<br/>|----- Simulation</span></pre><p id="76d3" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在模拟结构中，我们有类似于代理的Actor。它包含银行、客户和交易文件。在参数中，我们有所有的初始配置参数。</p><p id="feb5" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz"><em class="jt">config . py</em>T22】</strong></p><pre class="kq kr ks kt fd kv kw kx ky aw kz bi"><span id="9124" class="la lb hy kw b fi lc ld l le lf">nClients = 1000 # number of clients<br/>nBanks = 100 # number of banks<br/>nSteps = 60 # number of days</span></pre><p id="801b" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在配置文件中，我们正在初始化基本配置。</p><p id="3894" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由于我们计划模拟60天，因此我们将nSteps初始化为60。这里，nSteps的单位是天。</p><p id="ca32" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz"> <em class="jt"> Client.py </em> </strong></p><pre class="kq kr ks kt fd kv kw kx ky aw kz bi"><span id="5e5f" class="la lb hy kw b fi lc ld l le lf">class client(object):<br/>      def __init__(self, id, bank, amount, country):<br/>          self.id = id<br/>          self.bank_id = bank<br/>          self.amount = amount # Initial Amount<br/>          self.country = country<br/></span></pre><p id="280d" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在Actor中，我们有一个客户端类，我们在其中初始化客户端细节。并将数据存储到一个数据库中</p><figure class="kq kr ks kt fd hk er es paragraph-image"><div class="er es lg"><img src="../Images/809ac9dd9189b52d2173160db2e581e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*ydYXVo2vU0Jfan-lQBjgew.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">模拟客户数据</figcaption></figure><p id="75ec" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz"> <em class="jt"> Bank.py </em> </strong></p><pre class="kq kr ks kt fd kv kw kx ky aw kz bi"><span id="fd70" class="la lb hy kw b fi lc ld l le lf">class client(object):<br/>      def __init__(self, id, country):<br/>          self.id = id<br/>          self.country = country<br/>          self.n_customer = 0<br/>      <br/>      def inc_customer(self):<br/>          self.n_customer += 1</span></pre><p id="5b72" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在Actor中，我们有一个Bank类，其中存储了所有与银行相关的信息，如银行id、所在国家和银行拥有的客户总数。</p><figure class="kq kr ks kt fd hk er es paragraph-image"><div class="er es lh"><img src="../Images/92ec9c812ebf98e9c2f1e4c2ac8e1553.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*uz6iatK_CFTZSi8Gi_adtA.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">模拟银行数据</figcaption></figure><p id="72ba" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">T32】transaction . pyT34】</strong></p><pre class="kq kr ks kt fd kv kw kx ky aw kz bi"><span id="2491" class="la lb hy kw b fi lc ld l le lf">class Transaction(object):<br/>      def make_transaction(self, sender, receiver, amount):<br/>          self.sender = sender<br/>          self.receiver = receiver<br/>          self.amount = amount</span></pre><p id="caaa" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在Actor中，我们也有一个事务类，在那里我们存储所有发生的事务。在事务数据中，我们从发送方和接收方对象中提取数据。</p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="df5e" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在设置好所有的基础环境后，我们准备好与客户端进行交互以生成模拟。</p><p id="d08f" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了生成模拟，我们使用<strong class="ix hz">固定增量时间推进机制。在这个机制中，我们已经将天数设置为60。但是在每一个间隔中，我们应该做一些事务(事件)。对于事件，我们将使用一个随机函数来查找每个间隔中的事件数。</strong></p><p id="420f" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，在每个事件中，我们都使用概率方法来生成从发送者到接收者的可转移金额。</p><p id="1b83" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz"><em class="jt">simulation . py</em>T3】</strong></p><p id="a7c9" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在模拟中，我们使用随机过程来选择汇款人、收款人和转账金额。</p><pre class="kq kr ks kt fd kv kw kx ky aw kz bi"><span id="738d" class="la lb hy kw b fi lc ld l le lf">from Actor.client import Client<br/>from Actor.bank import Bank<br/>from Actor.transaction import Transaction<br/>from utils import helperutils<br/>from parameters import config</span><span id="8b94" class="la lb hy kw b fi li ld l le lf">class Simulation(object): <br/>       def __init__(self):<br/>           self.nSteps = config.nSteps<br/>           self.nClients = config.nClients<br/>           self.nBanks = config.nBanks</span><span id="abc7" class="la lb hy kw b fi li ld l le lf">       def init_client(self):<br/>           self.client_list = []<br/>           for id in zip(range(self.nClient), helperutils.generate_id()):</span><span id="f21e" class="la lb hy kw b fi li ld l le lf">bank_id = np.random.choice(self.bank_list).get_id()<br/>               self.client_list.append(Client(id, bank_id, helperutils.get_country())<br/>       <br/>        def init_bank(self):<br/>            self.bank_list = []<br/>            for id in zip(range(self.nClient), helperutils.generate_id()):<br/>             self.client_list.append(Bank(id,helperutils.get_country())</span><span id="f67d" class="la lb hy kw b fi li ld l le lf">        def init_transaction(self):<br/>            for step in range(config.nSteps):</span><span id="1a9e" class="la lb hy kw b fi li ld l le lf">                sender = np.random.choice(self.client_list)<br/>                receiver = np.random.choice(self.client_list)<br/>                Transaction(sender, receiver, helperutils.get_amount())</span></pre><p id="2ec9" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该函数将生成事务并将数据存储到数据库中。</p><figure class="kq kr ks kt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lj"><img src="../Images/55f1b0a137ad0d391a025530f4b71b24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WwF4mwd7Qbl7LdcEFVVNPA.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">模拟交易数据</figcaption></figure></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="6af4" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz"> <em class="jt">结论</em> </strong></p><p id="fb29" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这篇博客中，我提到了一些先进的模拟模型，如基于代理和多代理的模型。基于智能体的模型有助于用单智能体模拟系统。而基于多主体的模型有助于模拟所有复杂的系统，如银行系统等。我们也讨论了一些机制，在我们的模拟环境中加入时间因素。最后，我们借助python编程创建了一个仿真环境并生成了结果。</p></div></div>    
</body>
</html>