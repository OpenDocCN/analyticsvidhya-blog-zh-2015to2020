<html>
<head>
<title>Deploy a selenium based crawler to Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将基于selenium的爬虫部署到Docker</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploy-a-selenium-based-crawler-to-docker-fd26f53f52e7?source=collection_archive---------5-----------------------#2020-04-16">https://medium.com/analytics-vidhya/deploy-a-selenium-based-crawler-to-docker-fd26f53f52e7?source=collection_archive---------5-----------------------#2020-04-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6fb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">使用selenium grid设置docker compose运行爬虫的教程</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/859c6bb87e36cc6197b13d846dd7f36f.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*4phfEAnuajrz8lo9M1Q0ew.png"/></div></figure><p id="efd5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi jm translated">最近，我得到了一个爬虫项目。爬虫放在装有Windows 10 Professional的PC电脑上，爬虫基于selenium。</p><p id="1d01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然我有使用selenium的经验，但是我没有将它们打包成docker映像的经验。然而，我确实有包装我的刺痒爬虫到一个图像之前。我会在以后的帖子里分享。</p><p id="8712" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">构建一个基于selenium的crawler docker映像与打包一个Scrapy映像完全不同。</p><h1 id="b7eb" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">当前环境和操作</h1><p id="336d" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">爬虫放在Windows 10 Professional上，每周使用<strong class="ih hj"> <em class="jd">任务调度器</em> </strong>从<strong class="ih hj"> Steam </strong>抓取数据。目前的解决方案运行非常顺利，没有出现任何问题。然而，我们希望爬虫能在未来被非常快速和到处部署。因此，我的任务是将当前的爬虫变成docker映像。</p><h1 id="52fe" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">试错</h1><p id="9c04" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">我的第一个想法是构建一个python3映像，并将爬虫放入其中。然而，我面临一个问题。</p><blockquote class="ky kz la"><p id="6d10" class="if ig jd ih b ii ij ik il im in io ip lb ir is it lc iv iw ix ld iz ja jb jc hb bi translated">WebDriverException:消息:“chromedriver”可执行文件需要位于路径中。</p></blockquote><p id="b46b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我认为每个人都必须遇到这个问题，并可以很容易地解决它。</p><p id="b0ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我试图通过下载chromedriver并将其解压缩到镜像中来解决这个问题，但是失败了。</p><p id="a211" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，我想出了另一种方法。我构建了一个python-alpine图像，并将爬虫放入其中。然而，我仍然面临一些关于chromedriver和selenium的问题。</p><h1 id="9441" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">最终解决方案</h1><p id="d919" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">最后，我发现Selenium为Selenium网格服务器提供了一个Docker images，名为<a class="ae le" href="https://github.com/SeleniumHQ/docker-selenium" rel="noopener ugc nofollow" target="_blank"> Docker-selenium </a>。</p><p id="8335" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的例子中，我使用这个图像:<strong class="ih hj"><em class="jd">selenium/standalone-chrome</em></strong></p><p id="ecb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是我的爬虫Dockerfile文件</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="e770" class="lk jw hi lg b fi ll lm l ln lo">FROM python:3</span><span id="202a" class="lk jw hi lg b fi lp lm l ln lo">WORKDIR ./</span><span id="974c" class="lk jw hi lg b fi lp lm l ln lo">COPY requirements.txt ./<br/>RUN pip install -r requirements.txt</span><span id="48cb" class="lk jw hi lg b fi lp lm l ln lo">COPY /steam_parser/ ./</span></pre><p id="f2b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">呸。真的真的很短。</p><p id="aed6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为我需要同步运行两个映像，并且爬虫映像id依赖于selenium/standalone-chrome。因此，我需要一个docker-compose。</p><p id="cdcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是我的docker-compose.yml</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="7c57" class="lk jw hi lg b fi ll lm l ln lo">version: "3"<br/>services:</span><span id="7f60" class="lk jw hi lg b fi lp lm l ln lo">chromedriver:<br/>    image: selenium/standalone-chrome<br/>    ports: <br/>      - "4444:4444"</span><span id="9d65" class="lk jw hi lg b fi lp lm l ln lo">steam_parser:<br/>    build: .<br/>    command: python ***.py<br/>    volumes:<br/>      - /c/Users/***/Desktop/test:/data/.<br/>    links:<br/>      - chromedriver</span></pre><p id="a725" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我觉得如果有基本的docker知识就很好理解了。</p><p id="f54e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，docker的设置完成了。我们需要修改一些代码。巴拉圭</p><p id="40a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要导入selenium并连接到远程驱动程序。</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="a26c" class="lk jw hi lg b fi ll lm l ln lo">from selenium.webdriver.common.desired_capabilities import DesiredCapabilities</span><span id="b30f" class="lk jw hi lg b fi lp lm l ln lo">sleep(5)<br/>driver = webdriver.Remote(  command_executor='<a class="ae le" href="http://10.96.152.248:4444/wd/hub',#'http://192.168.1.100:4444/wd/hub/'" rel="noopener ugc nofollow" target="_blank">http://your_local_ip/wd/hub',</a><br/>   desired_capabilities=DesiredCapabilities.CHROME)</span></pre><p id="10bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在爬行之前，我让爬虫睡眠5秒钟，然后爬虫将使用<strong class="ih hj"> <em class="jd">独立浏览器</em> </strong>来爬行数据。</p><p id="01f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于您的操作系统，您需要使用<code class="du lq lr ls lg b">ifconfig</code>或<code class="du lq lr ls lg b">ipconfig</code>找到您的本地IP。</p><p id="a6c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们只是在命令下运行</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="ffdc" class="lk jw hi lg b fi ll lm l ln lo">docker-compose up --build --abort-on-container-exit</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es lt"><img src="../Images/e731890ac94603b9ddd5d3f484fb032d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8HIRfTBj0wjGSoaZAFHRgg.png"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">docker命令后的输出</figcaption></figure><p id="48ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以告诉那个<strong class="ih hj"> <em class="jd"> chromedriver </em> </strong>开始一个新的会话。</p><p id="8876" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以通过下面的url查看会话。</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="acf5" class="lk jw hi lg b fi ll lm l ln lo">http://your_local_ip/wd/hub/static/resource/hub.html</span></pre><p id="9916" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以打印某些输出来检查爬虫程序是否正确运行。</p><p id="4118" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对我来说，我打印1，2和日期来检查。</p><p id="6594" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是crawler爬完数据后的结果。容器会自动停止，因为我用了<code class="du lq lr ls lg b">--abort-on-container-exit</code>或者chromedriver容器会一直运行。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mc"><img src="../Images/cec7ae3470b8eeb1cb017ca53e294dab.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*buA8R71sTXfWUJELBKueDA.png"/></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">已完成爬网</figcaption></figure><p id="b851" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果已经将数据输出到，可以检查本地文件以查看结果。json或者其他。</p><h1 id="86e6" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">结论</h1><p id="73c2" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi jm translated">通过这个项目，对我来说是一个很好的学习机会。Docker是一个很好的工具，可以快速流畅地构建任何东西。我认为docker就像乐高积木，你可以放入任何你需要的或者你想建造的小而精致的杰作。</p><p id="2c82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">欢迎回复，如果你有任何问题或意见给我。谢谢你。</p><h1 id="4120" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">参考文献。</h1><div class="md me ez fb mf mg"><a href="https://github.com/SeleniumHQ/docker-selenium" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab dw"><div class="mi ab mj cl cj mk"><h2 class="bd hj fi z dy ml ea eb mm ed ef hh bi translated">硒HQ/docker-硒</h2><div class="mn l"><h3 class="bd b fi z dy ml ea eb mm ed ef dx translated">这个项目是由自愿贡献者促成的，他们投入了自己数千小时的时间，使…</h3></div><div class="mo l"><p class="bd b fp z dy ml ea eb mm ed ef dx translated">github.com</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu jk mg"/></div></div></a></div><div class="md me ez fb mf mg"><a href="https://selenium-python.readthedocs.io/getting-started.html#using-selenium-with-remote-webdriver" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab dw"><div class="mi ab mj cl cj mk"><h2 class="bd hj fi z dy ml ea eb mm ed ef hh bi translated">2.入门- Selenium Python绑定2文档</h2><div class="mn l"><h3 class="bd b fi z dy ml ea eb mm ed ef dx translated">如果您已经安装了Selenium Python绑定，您可以像这样从Python开始使用它。以上脚本可以是…</h3></div><div class="mo l"><p class="bd b fp z dy ml ea eb mm ed ef dx translated">selenium-python.readthedocs.io</p></div></div></div></a></div></div></div>    
</body>
</html>