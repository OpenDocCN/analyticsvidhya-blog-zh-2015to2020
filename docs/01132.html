<html>
<head>
<title>Preprocessing data for Predicting Online Shoppers Purchasing Intention</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测网上购物者购买意向的数据预处理</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/preprocessing-data-for-predicting-online-shoppers-purchasing-intention-ml-ba78186b7e85?source=collection_archive---------1-----------------------#2019-10-03">https://medium.com/analytics-vidhya/preprocessing-data-for-predicting-online-shoppers-purchasing-intention-ml-ba78186b7e85?source=collection_archive---------1-----------------------#2019-10-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="70c7" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">基于机器学习的收入预测数据预处理。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/4b4fccabb9cbac02240e37c9ae496066.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NfzKJv9fxDT1yHET"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae jn" href="https://unsplash.com/@rupixen?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">茹皮森</a>拍摄的照片</figcaption></figure><p id="63f7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一旦用户登录在线购物网站，知道这个人是否会购买具有巨大的经济价值。目前的许多研究都集中在这些购物网站的实时收入预测上。在本文中，我们将开始为这样一个网站建立一个收入预测器。我们将在这里详细说明数据预处理部分，您可以继续阅读本系列的<a class="ae jn" rel="noopener" href="/@isurudissanayake/ospi-mul-randomforests-156acdb73fd9">第二篇文章</a>，了解关于预测器模型的更多详细信息。</p><p id="cc86" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">该数据集可以在kaggle- <a class="ae jn" href="https://www.kaggle.com/roshansharma/online-shoppers-intention" rel="noopener ugc nofollow" target="_blank">网上购物者意向</a>上找到，还有对这些特征的详细描述。</p><blockquote class="kk kl km"><p id="df36" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated">数据集由属于12，330个会话的特征向量组成。数据集的形成使得每个会话在一年的时间内属于不同的用户，以避免任何倾向于特定的活动、特殊的日子、用户简档或时期。</p></blockquote><h2 id="5831" class="kr ks hi bd kt ku kv kw kx ky kz la lb jx lc ld le kb lf lg lh kf li lj lk ll bi translated">什么是预处理，为什么要做预处理？</h2><p id="2da2" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi translated">每个真实世界的数据集都包含不完整和不一致的数据点。他们还可能在某些行为或趋势上有所欠缺，并且很可能包含许多错误。将这些数据转换成预测器可以理解的格式，称为预处理。每个数据科学家都将大部分时间花在预处理操作上。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lr"><img src="../Images/a2d6439641fefaafdedc532f8333b68b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JddyiXoqG-5zdrECmjAeAQ.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">学分-谷歌</figcaption></figure><h2 id="d3ef" class="kr ks hi bd kt ku kv kw kx ky kz la lb jx lc ld le kb lf lg lh kf li lj lk ll bi translated">导入库和数据集。</h2><p id="84be" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi translated">预处理的第一步是导入库。我们使用<a class="ae jn" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> pandas </a>来导入、导出和维护数据帧，使用<a class="ae jn" href="https://numpy.org/" rel="noopener ugc nofollow" target="_blank"> numpy </a>对数据集进行矩阵操作。<a class="ae jn" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> Sklearn </a>用于数据分析和制作机器学习模型，如本文其余部分所述。Matplotlib用于在各种分析过程中绘制和可视化数据。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ls"><img src="../Images/0f34803205c36b00ce80e45c77f8d502.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lpZfrny88e7Um2q9h3XIrQ.png"/></div></div></figure><p id="e34d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后导入数据集，并将其分为X(输入要素)和y(标注)。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lt"><img src="../Images/a5e5ef2eb5ad6df642c2489534ec3079.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*88Jqs_DEUYhViCEOjE0SOA.png"/></div></div></figure><h2 id="f504" class="kr ks hi bd kt ku kv kw kx ky kz la lb jx lc ld le kb lf lg lh kf li lj lk ll bi translated">处理缺失的数据点</h2><p id="00f7" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi translated">数据集中可能存在随机缺失的数据点，如果处理不当，可能会在以后引发错误，或者导致不准确的推断。首先，我们找出是否有任何丢失的值。每个特征名称旁边的值显示了每列中缺失数据点的数量。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lu"><img src="../Images/3b6bfc41403fba6c4254a96bf6cf94c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iEfdFZDf33zgaqusNYpvTA.png"/></div></div></figure><p id="e182" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">有两种方法可以处理丢失的值。删除缺少数据点的整行，或者用平均值、中值、众数或相应列中最常出现的值来填充缺少的值。由于只有12330个数据点可供我们使用，我们使用sklearn的SimpleImputer函数用平均值(对于数字数据和最常见的分类数据)替换缺失值。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lv"><img src="../Images/bd6cd5c2ff4566df63b95020d30dabaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pcu5SIgd9GcWR6NgM1zixQ.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lw"><img src="../Images/e23482661b10eb5a5b57b11180c29b20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*al5Sn4BD-C8Svl65ENjWxw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">估算数据集-无缺失值</figcaption></figure><h2 id="e379" class="kr ks hi bd kt ku kv kw kx ky kz la lb jx lc ld le kb lf lg lh kf li lj lk ll bi translated">处理分类数据</h2><p id="3992" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi translated">数据集由10个数值属性和8个类别属性组成。</p><blockquote class="kk kl km"><p id="8293" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated">在统计学中，分类变量是一种变量，它可以取有限的、通常是固定数量的可能值中的一个，根据某些定性属性将每个个体或其他观察单位分配到特定的组或名义类别。</p></blockquote><p id="27aa" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">由于基于机器学习的预测器中的所有操作都是数学上的，很明显我们不能给出诸如月份的输入；“一月”、“二月”等。处理这些类型数据的最简单的方法是<a class="ae jn" rel="noopener" href="/@contactsunny/label-encoder-vs-one-hot-encoder-in-machine-learning-3fc273365621">标签编码</a>，其中特定属性中的每个类别都由一个唯一的数字编码；一月=0，二月=1等等。(查看我们的完整代码<a class="ae jn" href="https://github.com/Isuru-Dissanayake/OSPI-kaggle" rel="noopener ugc nofollow" target="_blank">这里</a>)</p><p id="40fe" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">虽然该方法产生可接受的结果，但是预测器模型也可能偏向于已经用数值较高的值编码的一些类别。(如；十二月=11，一月=0)。为了避免这种影响，我们对数据集使用了<a class="ae jn" rel="noopener" href="/@contactsunny/label-encoder-vs-one-hot-encoder-in-machine-learning-3fc273365621"> Onehot编码</a>。编码后，最初的18个输入特征增加到58个。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lx"><img src="../Images/771afd06cf9c2dfdb549b3124b786028.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X2lOp8-ltqNJEm1bnlHmwg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">分类数据一次性编码后的数据集的一部分</figcaption></figure><h2 id="1926" class="kr ks hi bd kt ku kv kw kx ky kz la lb jx lc ld le kb lf lg lh kf li lj lk ll bi translated">选择最佳功能</h2><p id="94ee" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi translated">由于我们有58个输入要素，我们需要选择对收入影响最大的要素，并删除那些对收入影响不大的要素。这一步对于加快训练速度和避免模型不必要的复杂化非常重要。有许多工具可以研究每个特性对收入的影响。我们使用了sklearn.ensemble的<a class="ae jn" href="https://scikit-learn.org/stable/modules/generated/sklearn.feature_selection.SelectKBest.html" rel="noopener ugc nofollow" target="_blank"> selectkbest </a>来找出得分最高的特征。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ly"><img src="../Images/ec8f7e180b15507949e0cf8dfbe29f26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aKIVscxm25k6rl8C-nsiTg.png"/></div></div></figure><p id="929c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们用于特征选择的另一个函数是Sklearn的<a class="ae jn" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.ExtraTreesClassifier.html" rel="noopener ugc nofollow" target="_blank">extractreesclassifier</a>。</p><blockquote class="kk kl km"><p id="54d4" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated">该类实现了一个元估计器，它在数据集的各个子样本上拟合多个随机决策树(也称为额外树),并使用平均来提高预测精度和控制过度拟合。</p></blockquote><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lz"><img src="../Images/0b187d52a4895a4397c31ac2f686d194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mzJxu6jPDlI7gollw-cKLw.png"/></div></div></figure><p id="20d4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为了可视化输入特性之间以及输入特性和收入之间的相关程度，我们使用了pandas的<a class="ae jn" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.corr.html" rel="noopener ugc nofollow" target="_blank"> corr </a>函数。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ma"><img src="../Images/3f4459d5a0a2921ab0ef98e4bbb5b294.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T7imopG8maSvejYf2yfvcw.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mb"><img src="../Images/4a43e13142563bcf0c73ac7194307d80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uN_xkwZDlumWu7CxWVKo2w.png"/></div></div></figure><p id="2c72" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">根据以上分析，我们从58个特性中选择了12个最佳特性。它们是“管理”、“管理_持续时间”、“信息”、“信息_持续时间”、“产品相关”、“产品相关_持续时间”、“反弹率”、“出口”、“页面值”、“月份11”、“流量_类型”和“访问者1”(月份11和访问者1是一个热编码的结果，对应于月份11月和访问者类型，返回的访问者)</p><h2 id="35bb" class="kr ks hi bd kt ku kv kw kx ky kz la lb jx lc ld le kb lf lg lh kf li lj lk ll bi translated">极端值</h2><blockquote class="kk kl km"><p id="08e8" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated">在统计学中，一个<strong class="jq hj">异常值</strong>是一个<strong class="jq hj">数据</strong>点，它与其他观察值有很大不同。<strong class="jq hj">异常值</strong>可能是由于测量中的可变性，也可能表明实验误差；后者有时被排除在<strong class="jq hj">数据集</strong>之外。</p></blockquote><p id="864a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在实现预测模型之前，我们需要调查数据集中的任何异常值。我们将数据绘制成散点图，我们发现了一些有趣的东西。</p><blockquote class="kk kl km"><p id="8374" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated">大部分数据点(客户)都处于异常值，也就是说，具有非常大的产品相关持续时间或信息相关持续时间，实际上是从网站上购买了一些东西。</p></blockquote><div class="iy iz ja jb fd ab cb"><figure class="mc jc md me mf mg mh paragraph-image"><img src="../Images/098ec88a23ec7406a64baecfba074dae.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*OI11nWIqAVP_k8_bHK6BDA.png"/></figure><figure class="mc jc mi me mf mg mh paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><img src="../Images/fca7b8cc3331284d0d295001768c85e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*mOllQlFW-RNUGEtWgGog1w.png"/></div></figure></div><p id="8138" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">因此，我们没有裁剪或删除异常数据点，而是为每个客户计算一个异常分数，并将该分数作为一个新特征引入预测模型。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mj"><img src="../Images/8b096ff4c9348c3fb4d67e7af7e0ee5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7dhLse8S9ZPytXDTHV1f-g.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mk"><img src="../Images/db62b694b24d1fcaf802b2509626a673.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Jv2EgkNfZOE76dsSa0GIw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">根据异常分数添加了两个新功能</figcaption></figure><h2 id="2d7f" class="kr ks hi bd kt ku kv kw kx ky kz la lb jx lc ld le kb lf lg lh kf li lj lk ll bi translated">训练、验证和测试集</h2><p id="b1ec" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi translated">我们分离了1850个数据点作为测试数据集。然后，我们使用sklearn的train-test-split功能随机分离一部分数据集作为val集，并继续进行预测模型。我们修改预测模型，直到我们获得满意的精度，同时使用val集来验证结果。然后，我们在测试数据集上使用相同的模型。</p><p id="1a2a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最终预测准确率在94%左右。你可以在本系列的第二篇文章中的这里阅读关于模型<a class="ae jn" rel="noopener" href="/@isurudissanayake/ospi-mul-randomforests-156acdb73fd9">的所有内容，或者在我们的Github仓库中的</a><a class="ae jn" href="https://github.com/Isuru-Dissanayake/OSPI-kaggle" rel="noopener ugc nofollow" target="_blank">代码</a>这里查看。</p><p id="652b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">干杯！</p></div></div>    
</body>
</html>