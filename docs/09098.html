<html>
<head>
<title>A simple way to build your own 3D map with Coloured LIDAR point clouds using xyzspaces</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨ xyzspaces ä½¿ç”¨å½©è‰²æ¿€å…‰é›·è¾¾ç‚¹äº‘æ„å»ºæ‚¨è‡ªå·±çš„ 3D åœ°å›¾çš„ç®€å•æ–¹æ³•</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/analytics-vidhya/a-simple-way-to-build-your-own-3d-map-with-coloured-lidar-point-clouds-using-xyzspaces-5b3ca6e43d48?source=collection_archive---------10-----------------------#2020-08-25">https://medium.com/analytics-vidhya/a-simple-way-to-build-your-own-3d-map-with-coloured-lidar-point-clouds-using-xyzspaces-5b3ca6e43d48?source=collection_archive---------10-----------------------#2020-08-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/738bc22783c23a81d9bdb75043db51b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pWA__4AFk1vWPPJxA7SSbw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd iu">æ—§é‡‘å±±é‡‘é—¨å¤§æ¡¥å½©è‰²æ¿€å…‰é›·è¾¾æ•°æ®</strong></figcaption></figure><p id="955e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">åœ¨åˆ†ææ¿€å…‰é›·è¾¾æ•°æ®æ—¶ï¼Œå¯è§†åŒ–æ¿€å…‰é›·è¾¾ç‚¹äº‘æ•°æ®æ˜¯ä¸€ä¸ªé‡è¦çš„éƒ¨åˆ†ã€‚ç”¨äºå¯¹æ¿€å…‰é›·è¾¾æ•°æ®ç‚¹è¿›è¡Œç€è‰²å’Œå¯è§†åŒ–çš„å¤§å¤šæ•°æ–¹æ³•éƒ½æ¶‰åŠè®¸å¤šæ­¥éª¤ï¼Œå¹¶ä¸”éœ€è¦ QGIS ç­‰å·¥å…·çš„çŸ¥è¯†ã€‚å› æ­¤ï¼Œä»Šå¤©æˆ‘ä»¬å°†çœ‹åˆ°ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥ä½¿ç”¨<a class="ae jt" href="https://github.com/heremaps/xyz-spaces-python" rel="noopener ugc nofollow" target="_blank"> xyzspaces </a>å¯¹æ¿€å…‰é›·è¾¾ç‚¹äº‘æ•°æ®è¿›è¡Œç€è‰²ï¼Œå¹¶ä½¿ç”¨<a class="ae jt" href="https://github.com/heremaps/harp.gl" rel="noopener ugc nofollow" target="_blank"> Harp.gl </a>ä»¥ç®€å•çš„æ–¹å¼å°†å…¶å¯è§†åŒ–ã€‚</p><p id="cdb5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">æˆ‘ä»¬å°†ä½¿ç”¨ Python ä½œä¸ºæœ¬æ•™ç¨‹çš„ç¼–ç è¯­è¨€ã€‚æˆ‘ä»¬å°†éœ€è¦ä¸€å¥— python åº“ï¼Œä¸‹é¢æ˜¯åŒ…çš„åˆ—è¡¨ï¼Œä½ å¯ä»¥ç”¨ pip å‘½ä»¤è½»æ¾å®‰è£…å®ƒä»¬ã€‚</p><ul class=""><li id="68c3" class="ju jv hi ix b iy iz jc jd jg jw jk jx jo jy js jz ka kb kc bi translated"><a class="ae jt" href="https://pypi.org/project/xyzspaces/" rel="noopener ugc nofollow" target="_blank"> xyzspaces </a></li><li id="4466" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><a class="ae jt" href="https://pypi.org/project/rasterio/" rel="noopener ugc nofollow" target="_blank">æ‹‰æ–¯ç‰¹é‡Œå¥¥</a></li><li id="b98b" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><a class="ae jt" href="https://pypi.org/project/pandas/" rel="noopener ugc nofollow" target="_blank">ç†ŠçŒ«</a></li><li id="ac1e" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><a class="ae jt" href="https://pypi.org/project/scipy/" rel="noopener ugc nofollow" target="_blank"> scipy </a></li><li id="772a" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><a class="ae jt" href="https://pypi.org/project/geojson/" rel="noopener ugc nofollow" target="_blank"> geojson </a></li></ul><p id="61b7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨å½©è‰²æ¿€å…‰é›·è¾¾ç‚¹æ„å»ºæ‚¨è‡ªå·±çš„ 3D åœ°å›¾ã€‚è®©æˆ‘ä»¬ä¸ºæ—§é‡‘å±±çš„<a class="ae jt" href="https://user-images.githubusercontent.com/30625612/91130314-14ccc300-e6c9-11ea-9d43-e2e655611aaf.jpeg" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">å†¬é’å…¬å›­</strong> </a> <strong class="ix hj">åšä¸€ä¸ªå§ã€‚</strong></p><p id="bc34" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ç°åœ¨è®©æˆ‘ä»¬è·å–ä¸€äº›æ•°æ®ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªå¥‡å¦™çš„èµ„æºï¼Œé‚£å°±æ˜¯ NOAA ç½‘ç«™ã€‚æˆ‘ä»¬éœ€è¦ NOAA ç½‘ç«™ä¸Šçš„ä¸¤ç§æ•°æ®ç±»å‹ï¼Œä¸€ç§æ˜¯é«˜ç¨‹æ•°æ®(æ¿€å…‰é›·è¾¾æ•°æ®)ï¼Œå¦ä¸€ç§æ˜¯å½±åƒæ•°æ®(é¢œè‰²æ•°æ®)ã€‚</p><h2 id="6d43" class="ki kj hi bd iu kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated"><a class="ae jt" href="https://coast.noaa.gov/dataviewer/#/lidar/search/-13627862.786520233,4542209.2338303095,-13627595.462196458,4542531.609236469" rel="noopener ugc nofollow" target="_blank">é«˜ç¨‹æ•°æ®æº</a></h2><p id="6300" class="pw-post-body-paragraph iv iw hi ix b iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">ä½¿ç”¨ä¸Šé¢çš„é“¾æ¥åˆ° NOAA æµ·æ‹”ç½‘ç«™ï¼Œé€‰æ‹©<strong class="ix hj"> 2010 ARRA æ¿€å…‰é›·è¾¾:é‡‘é—¨(CA) </strong>å¹¶å°†å…¶æ·»åŠ åˆ°è´­ç‰©è½¦ã€‚</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/a7b20eb0afe8910757d16decae3d6c74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bc3goqWxyncfKSN0_KIB0g.png"/></div></div></figure><h2 id="dc02" class="ki kj hi bd iu kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated"><a class="ae jt" href="https://coast.noaa.gov/dataviewer/#/imagery/search/-13627862.786520233,4542209.2338303095,-13627595.462196458,4542531.609236469" rel="noopener ugc nofollow" target="_blank">å½±åƒæ•°æ®æº</a></h2><p id="ce4a" class="pw-post-body-paragraph iv iw hi ix b iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">ä½¿ç”¨ä»¥ä¸Šé“¾æ¥è®¿é—® NOAA å›¾åƒç½‘ç«™ï¼Œé€‰æ‹©<strong class="ix hj"> 2016 NAIP 4 æ³¢æ®µ 8 ä½å›¾åƒ:åŠ å·æµ·å²¸</strong>å¹¶å°†å…¶æ·»åŠ åˆ°è´­ç‰©è½¦ä¸­ã€‚</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/8dc058581f06cf5a69bd3e4f93ebae13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VL4ru1HIa5sw2IK4fqYdew.png"/></div></div></figure><p id="ffb6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ç°åœ¨ï¼Œå•å‡»å³ä¸Šè§’çš„è´­ç‰©è½¦ï¼Œè¿™å°†æ˜¾ç¤ºæ‚¨å·²ç»æ·»åŠ åˆ°è´­ç‰©è½¦ä¸­çš„æ•°æ®ï¼Œç„¶åå•å‡»ä¸‹ä¸€æ­¥ã€‚</p><p id="939d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">æ¥ä¸‹æ¥ï¼Œåœ¨â€œProvision your dataâ€å±å¹•ä¸­ä¸ºæ¯ä¸ªæ•°æ®æ›´æ”¹ä¸€äº›è®¾ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå› ä¸ºè¿™å°†æœ‰åŠ©äºæˆ‘ä»¬ç¨åè½»æ¾å¯è§†åŒ–æ•°æ®ã€‚</p><div class="li lj lk ll fd ab cb"><figure class="lm ij ln lo lp lq lr paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/63172471cfd52c83c8233de6215cb4de.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*mYu8T5SFEhOL-uuydJRuVw.png"/></div></figure><figure class="lm ij ls lo lp lq lr paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/74945f56de46e2cd7cf04849b3fd0606.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*T2Vmyh1OuJlj9_EzkYcbfA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx lt di lu lv translated">æ¿€å…‰é›·è¾¾å’Œå½±åƒæ•°æ®çš„â€œè°ƒé…æ•°æ®â€è®¾ç½®</figcaption></figure></div><p id="c4aa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ä¹‹åï¼Œç‚¹å‡»â€œä¸‹ä¸€æ­¥â€,è¾“å…¥æ‚¨çš„ç”µå­é‚®ä»¶ ID å¹¶æäº¤è®¢å•ã€‚æ‚¨å°†æ”¶åˆ°æ¥è‡ª NOAA çš„ä¸¤å°ç”µå­é‚®ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¿€å…‰é›·è¾¾æ•°æ®å’Œå½±åƒæ–‡ä»¶çš„ä¸‹è½½é“¾æ¥ã€‚</p><p id="41cf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹ä¸€äº›ç¼–ç ï¼ï¼ï¼</p><p id="0985" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è§£å‹ç¼©ä» NOAA è·å¾—çš„æ¿€å…‰é›·è¾¾æ•°æ®å’Œå›¾åƒæ–‡ä»¶çš„ zip æ–‡ä»¶ã€‚</p><h2 id="76a7" class="ki kj hi bd iu kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">å¤„ç†å½±åƒæ•°æ®</h2><p id="c2fb" class="pw-post-body-paragraph iv iw hi ix b iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">å¯¹äºè§£å‹ç¼©æ–‡ä»¶å¤¹ä¸­çš„å½±åƒæ•°æ®ï¼Œæ‚¨ä¼šçœ‹åˆ°å¤šä¸ªæ–‡ä»¶ï¼Œä½†æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªæ–‡ä»¶ï¼Œå³ã€‚tiff æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†ä»ä¸­æå–é¢œè‰²æ•°æ®ï¼Œè¿™å®é™…ä¸Šæ˜¯ã€‚tiff æ–‡ä»¶ä»¥åŠä¸é¢œè‰²åƒç´ ç›¸å…³è”çš„çº¬åº¦å’Œç»åº¦ã€‚æˆ‘ä»¬å°†åœ¨è¿™é‡Œä½¿ç”¨ rasterio æ¥ç®€åŒ–äº‹æƒ…ã€‚</p><pre class="li lj lk ll fd lw lx ly lz aw ma bi"><span id="8809" class="ki kj hi lx b fi mb mc l md me">import rasterio as rio<br/>from affine import Affine</span><span id="82e3" class="ki kj hi lx b fi mf mc l md me">with rio.open('/Users/omestry/Downloads/Imagery_ISLAND_NEW/Job561243_2016_4BandImagery.tif') as imagery_data:<br/>    T0 = imagery_data.transform<br/>    T1 = T0 * Affine.translation(0.5, 0.5)<br/>    pixel2coord = lambda c, r: (c, r) * T1<br/>    width = imagery_data.width<br/>    height = imagery_data.height<br/>    generate_colour_data(width, height, imagery_data, pixel2coord)</span></pre><p id="436e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ä¸Šé¢çš„ä»£ç æå–äº†ã€‚tiff æ–‡ä»¶å¹¶å°†å…¶ä¼ é€’ç»™å‡½æ•°<strong class="ix hj"> generate_colour_data </strong>,è¯¥å‡½æ•°å°†ä»¥å¦‚ä¸‹æ ¼å¼å°†é¢œè‰²æ•°æ®å¡«å……åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­</p><p id="db1b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">[ç»åº¦ï¼Œçº¬åº¦ï¼Œçº¢è‰²ï¼Œç»¿è‰²ï¼Œè“è‰²ï¼Œé˜¿å°”æ³•]</p><p id="99b1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ä»¥ä¸‹æ˜¯ generate_colour_data å‡½æ•°çš„å®ç°</p><pre class="li lj lk ll fd lw lx ly lz aw ma bi"><span id="aba3" class="ki kj hi lx b fi mb mc l md me">colour_data = []</span><span id="414c" class="ki kj hi lx b fi mf mc l md me">def generate_colour_data(width, height, imagiry_data, pixel2coord):<br/>    for i in range(1, height):<br/>        for j in range(1, width):<br/>            colour_data.append(<br/>                [<br/>                    pixel2coord(j, i)[0],<br/>                    pixel2coord(j, i)[1],<br/>                    imagiry_data.read([1])[0][i - 1][j - 1],<br/>                    imagiry_data.read([2])[0][i - 1][j - 1],<br/>                    imagiry_data.read([3])[0][i - 1][j - 1],<br/>                    imagiry_data.read([4])[0][i - 1][j - 1],<br/>                ]<br/>            )</span></pre><p id="9875" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨<a class="ae jt" href="https://pypi.org/project/xyzspaces/" rel="noopener ugc nofollow" target="_blank"> xyzspaces </a>åŒ…å°†ç”Ÿæˆçš„é¢œè‰²æ•°æ®æ·»åŠ åˆ° DataHub ç©ºé—´ï¼Œè¿™æ ·æˆ‘ä»¬ä»¥åå°±å¯ä»¥åˆ©ç”¨ DataHub çš„æœç´¢åŠŸèƒ½ã€‚</p><p id="279c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">è¦ä½¿ç”¨ xyzspacesï¼Œæ‚¨éœ€è¦ä¸€ä¸ª DataHub ä»¤ç‰Œã€‚ä»¥ä¸‹æ˜¯å…³äºå¦‚ä½•ç”Ÿæˆæ•°æ®ä¸­å¿ƒä»¤ç‰Œçš„é“¾æ¥:-ã€https://www.here.xyz/api/getting-token/ T4ã€‘</p><p id="a6b8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ä¸€æ—¦ä½ æœ‰æ•°æ®ä¸­å¿ƒä»¤ç‰Œï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç©ºé—´ã€‚ä½¿ç”¨ä»¥ä¸‹ä»£ç åˆ›å»ºä¸€ä¸ªæ•°æ®ä¸­å¿ƒç©ºé—´</p><pre class="li lj lk ll fd lw lx ly lz aw ma bi"><span id="c37c" class="ki kj hi lx b fi mb mc l md me">import xyzspaces as xyz</span><span id="5de8" class="ki kj hi lx b fi mf mc l md me">xyz_token = "[YOUR-XYZ-TOKEN]"<br/>xyz = xyz.XYZ(credentials=xyz_token)</span><span id="2c15" class="ki kj hi lx b fi mf mc l md me">title = "LIDAR COLOR DATA"<br/>description = "LIDAR COLOR DATA"</span><span id="1b24" class="ki kj hi lx b fi mf mc l md me">space = xyz.spaces.new(title=title, description=description)</span></pre><p id="2c74" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ä¸€æ—¦æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª<strong class="ix hj">ç©ºé—´</strong>ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ä»¥ä¼˜åŒ–çš„æ–¹å¼å°†é¢œè‰²æ•°æ®ç¼–å†™ä¸º geojson ç‰¹æ€§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ python çš„å¤šå¤„ç†ç‰¹æ€§æ¥æ‰§è¡Œå¤šçº¿ç¨‹ã€‚</p><pre class="li lj lk ll fd lw lx ly lz aw ma bi"><span id="06ce" class="ki kj hi lx b fi mb mc l md me">import concurrent.futures<br/>import time<br/>from functools import partial<br/>from multiprocessing import Manager, Process</span><span id="7d56" class="ki kj hi lx b fi mf mc l md me">from geojson import Feature, Point<br/>from xyzspaces.utils import grouper</span><span id="ba22" class="ki kj hi lx b fi mf mc l md me">manager = Manager()</span><span id="4ecb" class="ki kj hi lx b fi mf mc l md me">def upload_features(features, space):<br/>    fc = []<br/>    try:<br/>        for data in features:<br/>            if data:<br/>                lat, lng = data[1], data[0]<br/>                f = Feature(<br/>                    geometry=Point((lng, lat)),<br/>                    properties={<br/>                        "R": float(data[2]),<br/>                        "G": float(data[3]),<br/>                        "B": float(data[4]),<br/>                    },<br/>                )<br/>                fc.append(f)<br/>        feature_collection = dict(type="FeatureCollection", features=fc)<br/>        space.add_features(features=feature_collection)<br/>        time.sleep(3)<br/>    except Exception as e:<br/>        print(e)</span><span id="5996" class="ki kj hi lx b fi mf mc l md me">features_size = 1000</span><span id="7820" class="ki kj hi lx b fi mf mc l md me">groups = grouper(features_size, colour_data)</span><span id="e3d4" class="ki kj hi lx b fi mf mc l md me">part_func = partial(upload_features, space=space)</span><span id="2829" class="ki kj hi lx b fi mf mc l md me">with concurrent.futures.ProcessPoolExecutor() as executor:<br/>    executor.map(part_func, groups, chunksize=3)</span></pre><p id="a42e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ç°åœ¨æˆ‘ä»¬çš„å›¾åƒæ•°æ®å·²ç»å‡†å¤‡å¥½äº†ï¼Œæˆ‘ä»¬å°†åœ¨åé¢çš„æ­¥éª¤ä¸­ä½¿ç”¨ç”Ÿæˆå™¨ç©ºé—´ã€‚</p><h2 id="a2f2" class="ki kj hi bd iu kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">å¤„ç†æ¿€å…‰é›·è¾¾æ•°æ®</h2><p id="603d" class="pw-post-body-paragraph iv iw hi ix b iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">å¯¹äºè§£å‹ç¼©æ–‡ä»¶å¤¹ä¸­çš„æ¿€å…‰é›·è¾¾æ•°æ®ï¼Œæ‚¨ä¼šçœ‹åˆ°å¤šä¸ªæ–‡ä»¶ï¼Œä½†æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªæ–‡ä»¶ï¼Œå³ã€‚txt æ–‡ä»¶ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ª CSV æ•°æ®æ–‡ä»¶ã€‚æˆ‘ä»¬éœ€è¦ä»æ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªç†ŠçŒ«æ•°æ®å¸§ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><pre class="li lj lk ll fd lw lx ly lz aw ma bi"><span id="e9a6" class="ki kj hi lx b fi mb mc l md me">import pandas as pd</span><span id="2292" class="ki kj hi lx b fi mf mc l md me">csv_data = pd.read_csv('/Users/omestry/Downloads/LIDAR_ISLAND_NEW/Job561242_ca2010_arra_goldengate_m5007_raw.txt')</span><span id="4f26" class="ki kj hi lx b fi mf mc l md me">csv_data[3] = -1<br/>csv_data[4] = -1</span><span id="e0d8" class="ki kj hi lx b fi mf mc l md me">xa = csv_data.to_numpy()</span></pre><p id="a5a6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">è¿™é‡Œï¼Œæˆ‘ä»¬è¿˜åœ¨ç”Ÿæˆçš„ DataFrame ä¸­æ·»åŠ äº†ä¸¤ä¸ªé¢å¤–çš„åˆ—ï¼Œå› ä¸ºæˆ‘ä»¬å°†ä½¿ç”¨ scipy çš„<a class="ae jt" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.distance.cdist.html" rel="noopener ugc nofollow" target="_blank"> cdist </a>å‡½æ•°ï¼Œè¯¥å‡½æ•°è¦æ±‚æ•°æ®è¡Œå…·æœ‰ç›¸åŒçš„å¤§å°ï¼Œç„¶åæˆ‘ä»¬å°†å®ƒè½¬æ¢ä¸º NumPy æ•°ç»„ã€‚</p><p id="15f8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ç°åœ¨æˆ‘ä»¬å®Œæˆäº†æ¿€å…‰é›·è¾¾æ•°æ®ï¼Œå®ƒå·²ç»å‡†å¤‡å¥½äº†ï¼ï¼ï¼</p><h2 id="524a" class="ki kj hi bd iu kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">ç”Ÿæˆåœ°å›¾æ•°æ®</h2><p id="bf34" class="pw-post-body-paragraph iv iw hi ix b iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">ç°åœ¨è®©æˆ‘ä»¬å®šä¹‰ä¸€äº›è·ç¦»å‡½æ•°ï¼Œæˆ‘ä»¬å°†æŠŠå®ƒä¼ é€’ç»™ scipy çš„<a class="ae jt" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.distance.cdist.html" rel="noopener ugc nofollow" target="_blank"> cdist </a>å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†ä½¿ç”¨å®ƒæ¥ç¡®å®šä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨<strong class="ix hj">å“ˆå¼—æ£®</strong>è·ç¦»ã€‚</p><pre class="li lj lk ll fd lw lx ly lz aw ma bi"><span id="cc67" class="ki kj hi lx b fi mb mc l md me">from math import radians, cos, sin, asin, sqrt<br/>from scipy.spatial.distance import cdist</span><span id="9f89" class="ki kj hi lx b fi mf mc l md me">def haversine(lon1, lat1, lon2, lat2):<br/>    """<br/>    Calculate the great circle distance between two points <br/>    on the earth (specified in decimal degrees)<br/>    """<br/>    # convert decimal degrees to radians <br/>    lon1, lat1, lon2, lat2 = map(radians, [lon1, lat1, lon2, lat2])</span><span id="6df0" class="ki kj hi lx b fi mf mc l md me">    # haversine formula <br/>    dlon = lon2 - lon1 <br/>    dlat = lat2 - lat1 <br/>    a = sin(dlat/2)**2 + cos(lat1) * cos(lat2) * sin(dlon/2)**2<br/>    c = 2 * asin(sqrt(a)) <br/>    r = 6371 # Radius of earth in kilometers. Use 3956 for miles<br/>    return c * r</span><span id="8e60" class="ki kj hi lx b fi mf mc l md me">def func(p1, p2):<br/>    return haversine(p1[0], p1[1], p2[0], p2[1])</span></pre><p id="b7b1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ç°åœ¨æˆ‘ä»¬å°†ç»“åˆæ¿€å…‰é›·è¾¾æ•°æ®å’Œé¢œè‰²æ•°æ®ã€‚ä¸ºäº†ç»“åˆæ¿€å…‰é›·è¾¾æ•°æ®å’Œé¢œè‰²æ•°æ®ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<strong class="ix hj">æœ€è¿‘é‚»æ–¹æ³•</strong>ã€‚å¯¹äºæ¯ä¸ªæ¿€å…‰é›·è¾¾æ•°æ®ç‚¹ï¼Œæˆ‘ä»¬å°†å°è¯•æ‰¾åˆ°æœ€æ¥è¿‘çš„é¢œè‰²æ•°æ®ç‚¹ï¼Œå¹¶å°†é¢œè‰²æ•°æ®ä¸è¯¥æ¿€å…‰é›·è¾¾æ•°æ®ç‚¹ç›¸å…³è”ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ DataHub space çš„<a class="ae jt" href="https://xyz.api.here.com/hub/static/swagger/#/Read%20Features/getFeaturesBySpatial" rel="noopener ugc nofollow" target="_blank">ç©ºé—´æœç´¢åŠŸèƒ½</a>ã€‚</p><p id="b88d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">å¯¹äºæ¯ä¸ªæ¿€å…‰é›·è¾¾ç‚¹ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªç‚¹è§†ä¸ºåœ†å¿ƒï¼ŒåŠå¾„ä¸º 3 ç±³(æˆ‘ä»¬éœ€è¦å°†åŠå¾„è®¾ç½®ä¸ºå°½å¯èƒ½å°ï¼Œä»¥å‡å°‘è¦æ¯”è¾ƒçš„è¦ç´ )ã€‚ä½¿ç”¨ä¸Šè¿°è€ƒè™‘å› ç´ ï¼ŒDataHub ç©ºé—´æœç´¢å°†ä»æ¿€å…‰é›·è¾¾ç‚¹åŠå¾„ 3 ç±³å†…çš„<strong class="ix hj">ç©ºé—´</strong>è¿”å›è‰²ç‚¹ã€‚å¦‚æœå­˜åœ¨å¤šä¸ªç‚¹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ scipy çš„<a class="ae jt" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.distance.cdist.html" rel="noopener ugc nofollow" target="_blank"> cdist </a>å‡½æ•°æ‰¾åˆ°æœ€è¿‘çš„ä¸€ä¸ªã€‚ä¸‹é¢æ˜¯ä½¿ç”¨ä¸Šè¿°ç®—æ³•ç”Ÿæˆæœ€ç»ˆæ•°æ®çš„ä»£ç ã€‚</p><pre class="li lj lk ll fd lw lx ly lz aw ma bi"><span id="d6e3" class="ki kj hi lx b fi mb mc l md me">import concurrent.futures<br/>import time<br/>from functools import partial<br/>from multiprocessing import Manager, Process</span><span id="37cd" class="ki kj hi lx b fi mf mc l md me">import numpy as np<br/>from geojson import Feature, Point<br/>from xyzspaces.utils import grouper</span><span id="2b1e" class="ki kj hi lx b fi mf mc l md me">manager = Manager()<br/>final_data = manager.list()</span><span id="54e3" class="ki kj hi lx b fi mf mc l md me">def gen_feature_color(features, space_color, func):<br/>    try:<br/>        for d in features:<br/>            fl = []<br/>            for f in space_color.spatial_search(lon=d[0], lat=d[1], radius=3):<br/>                fl.append(<br/>                    [<br/>                        f["geometry"]["coordinates"][0],<br/>                        f["geometry"]["coordinates"][1],<br/>                        f["properties"]["R"],<br/>                        f["properties"]["G"],<br/>                        f["properties"]["B"],<br/>                    ]<br/>                )<br/>            closest_index = cdist(<br/>                XA=np.array([d]), XB=np.array(fl), metric=func<br/>            ).argmin()<br/>            rgb = fl[closest_index]<br/>            final_data.append([d[0], d[1], d[2], rgb[2], rgb[3], rgb[4]])<br/>            print(len(final_data))<br/>    except Exception as e:<br/>        print(e)</span><span id="fd2f" class="ki kj hi lx b fi mf mc l md me">features_size = 1000</span><span id="45cb" class="ki kj hi lx b fi mf mc l md me">groups = grouper(features_size, xa)</span><span id="d810" class="ki kj hi lx b fi mf mc l md me">part_func = partial(gen_feature_color, space_color=space, func=func)</span><span id="a512" class="ki kj hi lx b fi mf mc l md me">with concurrent.futures.ProcessPoolExecutor(max_workers=60) as executor:<br/>    executor.map(part_func, groups, chunksize=3)</span></pre><p id="aa93" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ä¸Šè¿°ä»£ç å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´æ¥æ‰§è¡Œï¼Œå…·ä½“å–å†³äºæ‚¨çš„ç³»ç»Ÿï¼Œå› ä¸ºå®ƒä¼šä¸ºæ¯ä¸ªæ¿€å…‰é›·è¾¾æ•°æ®ç‚¹æŸ¥æ‰¾æœ€æ¥è¿‘çš„è‰²ç‚¹ï¼Œå¤§çº¦ä¸º 1ï¼Œ48ï¼Œ913ï¼Œå› æ­¤è¯·è€å¿ƒç­‰å¾…ğŸ˜‰å¹¶ä¸”åœ¨ä»£ç æ‰§è¡Œä¹‹å‰æ‹¥æœ‰ä¸€ä¸ªâ˜•ï¸ã€‚è¯¥ä»£ç å°†æ‰“å°å®ƒå·²ç»å¤„ç†çš„ç‚¹æ•°ã€‚ä¸€æ—¦æ‰§è¡Œå®Œæˆï¼Œæˆ‘ä»¬å°†å‡†å¤‡å¥½<strong class="ix hj"> final_data </strong>åˆ—è¡¨<strong class="ix hj"> </strong>ä¸­çš„æœ€ç»ˆæ•°æ®ã€‚ç°åœ¨æˆ‘ä»¬åªéœ€è¦ä¿å­˜å®ƒå¹¶å°†å…¶å¯è§†åŒ–ã€‚</p><p id="79fc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">æˆ‘ä»¬å°†æŠŠåˆ—è¡¨ä¿å­˜ä¸ºä¸€ä¸ª JSON æ•°ç»„ï¼Œå› æ­¤è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ pandas</p><pre class="li lj lk ll fd lw lx ly lz aw ma bi"><span id="5c30" class="ki kj hi lx b fi mb mc l md me">from pandas import DataFrame</span><span id="ca95" class="ki kj hi lx b fi mf mc l md me">df = DataFrame(list(final_data))</span><span id="7666" class="ki kj hi lx b fi mf mc l md me">df.to_json('FINAL_DATA.json', orient='values')</span></pre><p id="d2ed" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">æˆ‘ä»¬ç°åœ¨å®Œæˆäº†æ•°æ®å¤„ç†ï¼Œç°åœ¨æˆ‘ä»¬å°†è¿›å…¥æœ€åä¹Ÿæ˜¯æœ€æ¿€åŠ¨äººå¿ƒçš„éƒ¨åˆ†ï¼Œåœ¨åœ°å›¾ä¸Šå¯è§†åŒ–æ•°æ®ã€‚</p><h2 id="a9bd" class="ki kj hi bd iu kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">å¯è§†åŒ–æ•°æ®</h2><p id="14c3" class="pw-post-body-paragraph iv iw hi ix b iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">æˆ‘ä»¬å°†ä½¿ç”¨ Harp.gl æ¥å¯è§†åŒ–ç”Ÿæˆçš„æ•°æ®ï¼Œè¦ä½¿ç”¨<a class="ae jt" href="https://github.com/heremaps/harp.gl" rel="noopener ugc nofollow" target="_blank"> Harp.gl </a>æˆ‘ä»¬å°†éœ€è¦ä¸€ä¸ª HERE API-KEYï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹é“¾æ¥ä¸­çš„æ­¥éª¤ç”Ÿæˆå®ƒ:-<a class="ae jt" href="https://developer.here.com/tutorials/getting-here-credentials/" rel="noopener ugc nofollow" target="_blank">https://developer . HERE . com/tutorials/getting-HERE-credentials/</a></p><p id="2005" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ä»¥ä¸‹æ˜¯å¯ç”¨äºå¯è§†åŒ–ç”Ÿæˆçš„æ•°æ® 3D åœ°å›¾æ•°æ®çš„ä»£ç ï¼Œåªéœ€å°†[YOUR-API-KEY]æ›¿æ¢ä¸ºæ‚¨çš„ HERE API-KEY å’Œ FINAL_DATA.json çš„è·¯å¾„(å¦‚æœå®ƒä¸åœ¨ä¸ä»£ç ç›¸åŒçš„ä½ç½®),ç§ï¼ï¼ï¼</p><figure class="li lj lk ll fd ij"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="694b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">æœ€ç»ˆç»“æœä¼šæ˜¯è¿™æ ·çš„ğŸ¤©</p><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es mi"><img src="../Images/0c826a1b0e7af0ec1faa8b7fb54f93bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*RlIrYnx37DvDcSgqc1_V_g.gif"/></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd iu">æ—§é‡‘å±±éœåˆ©å…¬å›­</strong>æœ€ç»ˆæ•°æ®å¯è§†åŒ–</figcaption></figure><p id="a59c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">å…¨éƒ¨ä»£ç éƒ½å‘ˆç°åœ¨è¿™ä¸ª<a class="ae jt" href="https://github.com/omanges/Color-LIDAR" rel="noopener ugc nofollow" target="_blank">èµ„æºåº“</a></p><p id="7adc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae jt" href="https://github.com/heremaps/xyz-spaces-python" rel="noopener ugc nofollow" target="_blank"> xyzspaces </a>çš„ Github å­˜å‚¨åº“é“¾æ¥</p><p id="c1e7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶è”ç³»æˆ‘ğŸ˜‰</p><p id="52ff" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">äº«å—å¿«ä¹ç¼–ç ï¼ï¼ï¼</p><p id="e30e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">å¦‚æœæ‚¨è§‰å¾—è¿™å¾ˆæœ‰å¸®åŠ©ï¼Œè¯·ç‚¹èµå¹¶åˆ†äº«<a class="ae jt" href="https://twitter.com/omanges333" rel="noopener ugc nofollow" target="_blank"> @omanges333 </a>å’Œ</p></div></div>    
</body>
</html>