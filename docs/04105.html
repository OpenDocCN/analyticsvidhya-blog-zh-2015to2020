<html>
<head>
<title>Building a REST API using Python, FastAPI, and Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python、FastAPI和Heroku构建REST API</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/building-a-rest-api-using-python-fastapi-and-heroku-b7e9341f578?source=collection_archive---------3-----------------------#2020-03-05">https://medium.com/analytics-vidhya/building-a-rest-api-using-python-fastapi-and-heroku-b7e9341f578?source=collection_archive---------3-----------------------#2020-03-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1d9f63a1d0109ab759d37530a55a8b18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*du7p50wS_fIsaC_lR18qsg.png"/></div></div></figure><p id="3272" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，谁从来不需要在几天甚至几个小时内构建和休息API？我敢打赌，你这样做了，所以我有这个工作，创建一个地理定位API，作为一个微服务。</p><p id="a1ae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我最近一直在使用python，所以，第一个想法是使用flask来完成这项工作，但是我的老板要求我寻找新的方法，因为我已经有了使用Flask的经验。所以在我的研究中，我发现了一些选项，其中两个最高的是<a class="ae jo" href="https://www.djangoproject.com" rel="noopener ugc nofollow" target="_blank"> Django </a>和<a class="ae jo" href="https://fastapi.tiangolo.com" rel="noopener ugc nofollow" target="_blank"> FastAPI </a>。</p><p id="a18e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先决定测试Django，我之前见过的那个，是否符合我们的需求。它最终成为一个非常强大的框架，用来做很多不必要的事情，所以让我们看看FastAPI是如何为我工作的。</p><p id="7f00" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以，让我们开始学习如何安装它。在本文中，我将使用pipenv，但是您可以使用任何您喜欢的包管理器:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="cc19" class="jy jz hi ju b fi ka kb l kc kd">pipenv install fastapi<br/>pipenv install uvicorn</span></pre><p id="fcc8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用uvicorn作为ASGI服务器。</p><p id="3eca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，您已经安装了uvicorn和FastAPI，现在可以开始编码了。</p><p id="d099" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们创建架构:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="53d9" class="jy jz hi ju b fi ka kb l kc kd">├── main.py<br/>├── manager.py<br/>├── app          <br/>│   ├── router.py<br/>│   ├── configs.py         <br/>│   └── geolocation <br/>│       ├── services.py<br/>│       ├── controller.py<br/>│       ├── models.py<br/>│       └── routes.py<br/>└── pipfile</span></pre><p id="1492" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设每个文件夹都需要一个__init__。py文件被视为一个模块。</p><p id="0381" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，开始编码。main.py负责运行和设置您的服务器。</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="200f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将前缀设置为“v1”，因此我们可以有多个版本的API。</p><p id="9f8d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在设置manager.py:</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="6c52" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个文件只是我创建的一个有用的文件，用来帮助创建模块，要使用它，您应该运行以下命令:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="401c" class="jy jz hi ju b fi ka kb l kc kd">python manager.py module MODULE_NAME</span></pre><p id="7897" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在router.py文件中，您需要设置所有主路由，每个模块一条。我们使用API路由器，这样我们就可以将所有的路由集中在同一个地方。</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="d875" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，在地理位置文件夹中创建负责地理位置模块端点的文件routes.py。</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="7623" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">记住，这只是处理端点参数的一种方式，其他方式你可以在<a class="ae jo" href="https://fastapi.tiangolo.com/tutorial/body/" rel="noopener ugc nofollow" target="_blank">这里找到</a>。</p><p id="48d8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步是控制器，这里您需要接收响应体或参数，并对其进行组织以向服务提供数据:</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="aade" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，服务，负责所有的魔法，在这里你可以做所有的数据处理，请求，数据库管理，任何你需要的东西。我们将向IP提供商发出地理定位请求。</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="0066" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以看到，我们使用了一个名为configs.py的文件，在这个文件中，我们可以存储任何静态数据，例如API令牌。</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="a168" class="jy jz hi ju b fi ka kb l kc kd">API_TOKEN = "YOUR_API_TOKEN_HERE"</span></pre><p id="0fdb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，完成所有这些编码后，我们可以将这个项目构建到Heroku或任何云平台上。创建Heroku应用程序后，您需要使用Procfile进行部署。</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="fecf" class="jy jz hi ju b fi ka kb l kc kd">web: uvicorn main:app --host=0.0.0.0 --port=${PORT:-5000}</span></pre><p id="7c1d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Procfile应该如下所示。现在，在Heroku中寻找你的项目的URL:<a class="ae jo" href="https://hugosteixeira-services.herokuapp.com/v1/geolocation/" rel="noopener ugc nofollow" target="_blank">https://YOUR-PROJECT-NAME.herokuapp.com/v1/geolocation/</a></p><p id="1c29" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">结果是这样的:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="e44f" class="jy jz hi ju b fi ka kb l kc kd">{"lat":"-8.0539","long":"-34.8811"}</span></pre><p id="9a3f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，您可以改进此服务，保存创建数据库缓存的请求，您可以使用manager.py创建其他服务并将其添加到router.py</p></div></div>    
</body>
</html>