<html>
<head>
<title>Installing Tensorflow GPU on Anaconda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Anaconda上安装Tensorflow GPU</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/installing-tensorflow-gpu-on-anaconda-3f49c59c122b?source=collection_archive---------7-----------------------#2020-06-11">https://medium.com/analytics-vidhya/installing-tensorflow-gpu-on-anaconda-3f49c59c122b?source=collection_archive---------7-----------------------#2020-06-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ff69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，我试图用我的GPU来运行一个tensorflow代码，但每次它都会在CPU上运行。我更新了我的Nvidia驱动，CUDA工具包和我的tensorflow没有任何运气。</p><p id="fb42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">经过大量的网络搜索和尝试，我终于能够让代码运行在GPU上，而不是CPU上。我不得不从各种来源尝试许多不同的代码和技巧。我花了一个多月才得到正确的代码和流程。所以我想把这些都放在一个页面上，这样新来的人就不用费劲了。</p><p id="23da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我有一个Nvidia GeForce 940M显卡，我有Python 3.7版本和Anaconda 4.8.3。假设您已经拥有或知道如何安装Anaconda和Python，让我们开始安装Tensorflow-GPU。首先你需要检查你的显卡是否支持CUDA。这个可以上英伟达网站链接查:<a class="ae jd" href="https://developer.nvidia.com/cuda-gpus" rel="noopener ugc nofollow" target="_blank">https://developer.nvidia.com/cuda-gpus</a></p><p id="e5f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你的显卡不支持CUDA并行处理，安装tensorflow-GPU是没有意义的。你可以在Google Colab或Kaggle上工作。如果你的显卡与CUDA工具包兼容，那就先升级Nvidia驱动吧。这可以从Nvidia官方网站:<a class="ae jd" href="https://www.nvidia.com/en-in/drivers/nvidia-update/" rel="noopener ugc nofollow" target="_blank">https://www.nvidia.com/en-in/drivers/nvidia-update/</a></p><p id="b3f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有了最新的驱动程序后，安装Microsoft Visual Studio。MS Visual Studio是先决条件。你可以在这里下载最新版本:<a class="ae jd" href="https://visualstudio.microsoft.com/downloads/" rel="noopener ugc nofollow" target="_blank">https://visualstudio.microsoft.com/downloads/</a>。一定要下载社区版，对学生和个人都是免费的。安装时，您不必给出任何首选项，使用安装建议的默认选项。</p><p id="38d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新驱动程序后，从以下链接下载并安装CUDA工具包:<a class="ae jd" href="https://developer.nvidia.com/cuda-downloads?target_os=Windows&amp;target_arch=x86_64&amp;target_version=10" rel="noopener ugc nofollow" target="_blank">https://developer.nvidia.com/cuda-downloads?target _ OS = Windows&amp;target _ arch = x86 _ 64&amp;target _ version = 10</a></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/6ff325c5573a447b040d33d4bcc04b60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uts9sH9nLpta74Isk256mg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图一。CUDA工具包下载</figcaption></figure><p id="8830" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装完成后，重新启动计算机。这似乎是一个愚蠢的步骤，他们中的许多人都试图避免它(包括我)，但当文件被任何应用程序使用时，替换文件是不可能的。重启后，检查CUDA工具包是否安装正确。打开命令终端，输入以下命令:<code class="du ju jv jw jx b">nvcc --version</code></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jy"><img src="../Images/ecf14488a2f7432e58e54d44d452a27a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NgIwhkF-wyrJZGyXNwvrEw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图二。CUDA版本</figcaption></figure><p id="276d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意CUDA的发布版本(在红框中)。我们必须下载这个版本的cuDNN文件。要下载cuDNN，我们必须在Nvidia上注册并使用这些凭证登录。当你进入这个<a class="ae jd" href="https://developer.nvidia.com/rdp/cudnn-download" rel="noopener ugc nofollow" target="_blank">链接</a>，你会被要求登录或者注册。选择合适的。一旦完成，你会看到以下选项。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jz"><img src="../Images/7bbeb341cf561a49aa4b7b06ddc6d75e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*VkGSqQL7dSUbvMZXShcG-g.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图3。cuDNN下载选项</figcaption></figure><p id="1221" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">选择适合您的CUDA工具包版本的cuDNN版本(见图2)。请注意，CUDA 10.2有两个可用选项，我选择了v7.6.5，因为它比最近发布的v8.0.0更老，也更稳定。下载将是zip文件，其中包括3个文件夹，如图4所示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ka"><img src="../Images/a62acd427c63a5840255a2dd4a52e8b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MYbGAC8AL6pXzexD4uYh6w.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图4。cuDNN下载的文件</figcaption></figure><p id="81d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将这些文件解压缩到计算机中的任何位置。将所有文件和文件夹复制到CUDA安装文件夹中。默认情况下，这将是“C:\ Program Files \ NVIDIA GPU Computing Toolkit \ CUDA \ v 10.2”，除非在安装CUDA toolkit时对其进行了更改。系统将请求允许替换文件夹，因为名称相同，我们将继续替换。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kb"><img src="../Images/df59aae7053bfed38729f1d4b57ced26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*dm1QTo8_6sooZVthHYBbNw.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图5。cuDNN复制位置</figcaption></figure><p id="f152" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在在Windows搜索中搜索“环境变量”。打开“编辑系统环境变量”和“环境变量”。我们将得到如图6所示的窗口。现在选择“路径”在点击“编辑”按钮。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kc"><img src="../Images/d9b71d92f90efc487b59d04902af9264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e_aaRkD-FZV29jY7snFNZg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图6。环境变量</figcaption></figure><p id="92ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加3条新路径，如下面的图7所示，如果它们还不存在的话。点击“新建”并输入下面的路径。请注意，根据您安装CUDA和复制cuDNN文件夹的位置，这些路径可能会有所不同。为了确保安全，打开您复制cuDNN文件夹的文件夹，并确保下面的路径文件夹存在。</p><p id="ee64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">C:\Program Files\NVIDIA GPU计算工具包\CUDA\v10.2\bin</p><p id="a12a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">C:\Program Files\NVIDIA GPU计算工具包\CUDA\v10.2\libnvvp</p><p id="63a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">C:\Program Files\NVIDIA GPU计算工具包\CUDA\v10.2\extras\CUPTI\lib64</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kd"><img src="../Images/bb05a6feb3ace1720aa3243be45d20ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*XhgdbqNe5Nb9MfJeiRQn3A.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图7。CUDA环境路径</figcaption></figure><p id="098d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">重新启动你的计算机最后一次获得所有的驱动文件和cuDNN文件的权利，他们是需要的。</p><p id="c01f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在tensorflow的所有先决条件都已完成，我们可以开始实际安装tensorflow-gpu库了。我们将在Anaconda中安装tensorflow，从而打开“Anaconda提示”。在我们安装tensorflow-gpu之前，请确保您没有在Anaconda中安装tensorflow cpu。使用<code class="du ju jv jw jx b">pip list</code>或<code class="du ju jv jw jx b">conda list</code>获取已安装软件包的列表。为了确保安全，如果<code class="du ju jv jw jx b">pip uninstall tensorflow</code>已经在库中安装了tensorflow，请将其卸载。现在使用<code class="du ju jv jw jx b">pip install tensorflow-gpu </code>或<code class="du ju jv jw jx b">conda install -c anaconda tensorflow-gpu.</code>安装tensorflow-gpu</p><p id="dd95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装完成后，打开Jupyter笔记本，导入tensorflow。使用以下代码行检查GPU是否可用于tensorflow。</p><pre class="jf jg jh ji fd ke jx kf kg aw kh bi"><span id="8798" class="ki kj hi jx b fi kk kl l km kn">import tensorflow as tf<br/>from tensorflow.python.client import device_lib<br/>print(device_lib.list_local_devices())</span></pre><p id="b307" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这一行将打印出可供tensorflow使用的处理器列表。它将打印计算机的CPU和GPU，如图8所示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ko"><img src="../Images/d82d8b72f317a2acb46916eae872f1a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ii1XQb_QR2QdOqNQnmNe1Q.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图8。张量流设备库</figcaption></figure><p id="79af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您的GPU显示在列表中，恭喜您已经完成安装，并准备在您的GPU上训练tensorflow模型。请注意，tensorflow和Keras将始终使用GPU作为首选，如果您想在CPU上运行模型，可以使用下面的命令行切换到CPU。</p><pre class="jf jg jh ji fd ke jx kf kg aw kh bi"><span id="7df9" class="ki kj hi jx b fi kk kl l km kn">import os <br/>os.environ["CUDA_VISIBLE_DEVICES"]="-1"</span></pre><p id="e07a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在tensorflow将使用CPU而不是GPU。</p><p id="b589" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这对你有帮助。如果我错过了什么，请告诉我。</p><p id="1a61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">快乐训练。</p></div></div>    
</body>
</html>