<html>
<head>
<title>City Recommender System with Python [Part 3/3]: Deployment— Finding my Schitt’s Creek</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Python的城市推荐系统[第3/3部分]:部署——寻找我的Schitt's Creek</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/city-recommender-system-with-python-part-3-3-deployment-finding-my-schitts-creek-2019971e2c4d?source=collection_archive---------13-----------------------#2020-05-09">https://medium.com/analytics-vidhya/city-recommender-system-with-python-part-3-3-deployment-finding-my-schitts-creek-2019971e2c4d?source=collection_archive---------13-----------------------#2020-05-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="5344" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">记得我们的目标吗？我们正试图为美国的城市创建一个推荐系统！为什么？为了更好地通知人们他们应该考虑在哪个城市工作，或者出于任何原因搬到哪个城市！</p><p id="5495" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这一部分中，我解释了推荐系统如何基于在第一部分第一部分第一天收集的数据工作，这些数据后来被预处理、探索和建模——如在第二部分第三天T2中解释的那样——以创建最终数据文件第五天T4。然后我会展示一些结果，并解释你如何自己使用它！</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="5460" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">推荐系统——综述</h1><p id="525e" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">有两种主要的方法来构建推荐系统——向用户推荐相关项目的系统:</p><ol class=""><li id="2a1c" class="ko kp hi io b ip iq it iu ix kq jb kr jf ks jj kt ku kv kw bi translated"><strong class="io hj"> <em class="kx">协同过滤</em> </strong>:使用用户和项目之间记录的交互来产生推荐。这意味着用户的行为指示了相似用户的行为。例子:Siri喜欢橘子和苹果(双关语)；我们知道Alexa喜欢橙子；因此，我们会向Alexa推荐苹果。</li><li id="a2c3" class="ko kp hi io b ip ky it kz ix la jb lb jf lc jj kt ku kv kw bi translated"><strong class="io hj"> <em class="kx">基于内容的</em> </strong>:使用关于用户和/或项目的信息，根据这些项目之间的相似性产生推荐。例子:大牛喜欢AviciiAvicii的音乐和马丁·盖瑞斯的相似；因此，我会向丹尼尔推荐马丁·盖瑞斯。</li></ol><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es ld"><img src="../Images/e0728babff0b77039a08dabc3b78b296.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ycbaukbak4LrFAyaKQu30A.png"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx translated">主要推荐方法</figcaption></figure><p id="d1d0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您可能会问自己，能否混合使用这两种系统，以便利用用户和内容输入？绝对的！混合推荐系统是公司中最常用的，可以应用多种方法，包括深度学习、剩余学习、自动编码器和受限玻尔兹曼机器！如果你想了解更多关于推荐系统的知识，请查看我的课程。</p><p id="9430" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">有很多协同过滤推荐系统在城市中使用，我最喜欢的关于它的文章是<a class="ae jk" href="https://www.datarevenue.com/en-blog/building-a-city-recommender-for-nomads" rel="noopener ugc nofollow" target="_blank">这个</a>(超级简单！).因此，出于城市推荐的目的，我构建了一个基于内容的推荐系统。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="5013" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">寻找我的史考特:城市推荐系统</h1><p id="162d" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated"><strong class="io hj">要求:</strong></p><ul class=""><li id="93dc" class="ko kp hi io b ip iq it iu ix kq jb kr jf ks jj lt ku kv kw bi translated">sci kit-学习</li><li id="d71a" class="ko kp hi io b ip ky it kz ix la jb lb jf lc jj lt ku kv kw bi translated">熊猫</li></ul><p id="a4dc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">它是如何工作的？</p><p id="37c4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们的推荐系统通过计算用户输入的城市和数据帧中其余城市之间的余弦相似度来工作。用更数学的术语来说，余弦相似性是在用户向量(输入:A)和项目向量(B)之间测量的，项目向量(B)包含将为其构建向量并执行余弦相似性计算的所有项目的特征。</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es lu"><img src="../Images/df7b306d3e5ed17144d18583571729b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dR27sQPvWkJCkb4t.png"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx translated">余弦相似性公式(矢量、代数)</figcaption></figure><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es lv"><img src="../Images/6862e344da751c48a4a901453795593d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EpnLhgmWEg-KLVMTAPn8xw.png"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx translated">余弦相似可视化</figcaption></figure><p id="96e3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">余弦相似性值被计算并以降序排序，较大的值在统计上与用户输入的城市更相似。瞧啊。你有推荐系统！</p><p id="9974" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">推荐系统</strong></p><ol class=""><li id="be09" class="ko kp hi io b ip iq it iu ix kq jb kr jf ks jj kt ku kv kw bi translated">我们首先输入所需的库和数据:</li></ol><pre class="le lf lg lh fd lw lx ly lz aw ma bi"><span id="f277" class="mb jm hi lx b fi mc md l me mf">import pandas as pd<br/>from sklearn.metrics.pairwise import cosine_similarity</span><span id="8fa8" class="mb jm hi lx b fi mg md l me mf">norm_df = pd.read_csv('<a class="ae jk" href="https://s3.us-east-2.amazonaws.com/www.findingmyschittscreek.com/Data/normalized_df_sub.csv'" rel="noopener ugc nofollow" target="_blank">https://s3.us-east-2.amazonaws.com/www.findingmyschittscreek.com/Data/normalized_df_sub.csv'</a>, index_col=0)</span></pre><p id="6b51" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">2.然后，我们定义一个函数来计算数据帧中特定城市和其余城市之间的余弦相似性。</p><pre class="le lf lg lh fd lw lx ly lz aw ma bi"><span id="c30d" class="mb jm hi lx b fi mc md l me mf">def from_city_cosSim(data, name):</span><span id="30cc" class="mb jm hi lx b fi mg md l me mf">    try:<br/>        Xs = data[data.City == name].drop('City',1)<br/>        Col_A = data[data.City != name].City<br/>        Ys = data[data.City != name].drop('City',1)</span><span id="4b1f" class="mb jm hi lx b fi mg md l me mf">        cosSim = cosine_similarity(X=Xs,Y=Ys)<br/>        sim = list(cosSim[0])<br/>        cty = list(Col_A)<br/>        comb = {"City":cty,"Similarity":sim}<br/>        dfdf = pd.DataFrame(comb).reset_index()</span><span id="a6b3" class="mb jm hi lx b fi mg md l me mf">        # Adding a row with the Y City<br/>        currCity = {"City":name,"Similarity":1}<br/>        curr = pd.DataFrame(currCity, index=[0])</span><span id="0830" class="mb jm hi lx b fi mg md l me mf">        # Concatenate to finalize DF<br/>        dfdf = pd.concat([dfdf,curr], sort=False).reset_index(drop=True).drop('index',1)<br/>        return(dfdf)<br/>    except:<br/>        print("Wrong input: this entry will be ignored")</span><span id="3599" class="mb jm hi lx b fi mg md l me mf">#New York, NY as an example:</span><span id="8f5a" class="mb jm hi lx b fi mg md l me mf">from_city_cosSim(norm_df,"New York, NY")</span></pre><figure class="le lf lg lh fd li er es paragraph-image"><div class="er es mh"><img src="../Images/a8a8777de9ed967ce5223c7452298481.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*SKRGWyx0M0lbFHZb3C3mEg.png"/></div><figcaption class="lp lq et er es lr ls bd b be z dx translated">纽约州纽约市示例</figcaption></figure><p id="37f6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">3.然后，我们定义一个调用用户输入的函数，对每个输入的城市和数据帧中其余城市之间的余弦相似性值进行未加权平均，并返回一个数据帧，其中按降序排列了最佳推荐(默认设置为10个推荐)。</p><pre class="le lf lg lh fd lw lx ly lz aw ma bi"><span id="aa77" class="mb jm hi lx b fi mc md l me mf">def input_cities(numShow=10):<br/>    # create class that defines cities<br/>    class rated_city:<br/>        def __init__(self, city):<br/>            self.city = city<br/>    <br/>    #Loop to input cities based on the user<br/>    add_city = True<br/>    userInput = []<br/>    w = 0<br/>    while add_city == True:<br/>        city_name = input("City (Include state - Ex. New York, NY): ")<br/>        userInput.append(city_name)<br/>        simSim = from_city_cosSim(data=norm_df, name=city_name)<br/>        try:<br/>            cosSim = cosSim.merge(simSim, how='inner', on='City')<br/>        except:<br/>            cosSim = simSim<br/>        <br/>        city = rated_city(city_name)<br/>        cont = input("Do you want to include another city?")<br/>        add_city = cont.lower() in ['yes','true','of course','y','si','1']<br/>        w+=1<br/>    <br/>    simCols = cosSim.drop("City",1)<br/>    cits = cosSim.City<br/>        <br/>    for i, row in simCols.iterrows():<br/>        simCols.at[i,'SumVal'] = row.sum()/w<br/>    simi = simCols.SumVal<br/>    <br/>    out = {"City":cits,"Score":simi}<br/>    out = pd.DataFrame(out).set_index("City").drop(userInput)<br/>    out = out.sort_values('Score', ascending=False)<br/>    <br/>    return out.head(numShow)</span></pre><p id="74e6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">厉害！我们来试试吧！</p><p id="1b7b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">结果:</strong></p><p id="95d8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">一次输入多少个城市没有限制。我们包括超过300个城市(抱歉，如果你想要的没有包括在内！).所以你可以想象有大量的结果组合可以分析。在这里，我们只讨论一些常见的建议和一些我熟悉的建议。我会在最后留一个笔记本的链接，这样你就可以试用了！</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es lu"><img src="../Images/8277bb4fe3e015afddb79724d6a87db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*xZ178WkJiqfR1ym-nuOSRA.gif"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx translated"><strong class="bd jn">纽约州纽约市</strong></figcaption></figure><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es lu"><img src="../Images/e5a7632c631b7f9d4cc70194627497a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*eMv_WegwXa1WzO2UhtNIww.gif"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx translated"><strong class="bd jn">纽约州纽约市、伊利诺伊州芝加哥市和北卡罗来纳州达勒姆市</strong></figcaption></figure><p id="8d99" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">似乎工作得很好！让我们测试一下其他城市，看看天气参数是否被恰当地捕捉到。如果我们把佛罗里达州的迈阿密放在这里，你会期待什么？佛罗里达州的迈阿密和佐治亚州的亚特兰大怎么样？</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es lu"><img src="../Images/6b6595495fbdf031b6faf705b7e78a28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*mcVo8SeCpEyebvGvag2qwg.gif"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx translated"><strong class="bd jn">佛罗里达州迈阿密</strong></figcaption></figure><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es lu"><img src="../Images/d35105d942fd9692cddf3a1e5d5ad357.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ns_863Kp3exMhlItyCliZw.gif"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx translated"><strong class="bd jn">佛罗里达州迈阿密和佐治亚州亚特兰大</strong></figcaption></figure><p id="43db" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当你考虑包含的数据时，这些建议是有意义的，但在佛罗里达州迈阿密的情况下，我们预计会有更多的沿海城市。因此，一种改进可以包括一个关于城市是否是沿海的二元变量，或者一个湿度测量值，因为靠近海洋和湖泊的城市往往具有较高的湿度。</p><p id="36ce" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">非普通城市呢？推荐系统表现如何？我不是很熟悉美国的城市(因此，这个项目！！)，但我熟悉两个较小的大都市区:宾夕法尼亚州的兰卡斯特和北卡罗来纳州的达勒姆。</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es lu"><img src="../Images/61c817b77fc2c84a7df72ddf64b1d79b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*p-p0ORTP8eMTAODxgpM3Fg.gif"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx translated"><strong class="bd jn">北卡罗来纳州达勒姆</strong></figcaption></figure><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es lu"><img src="../Images/6870e56fdf8ba8fb7f4a0417dd27b778.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*VuAXixZlkbOTie-5SDBAmQ.gif"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx translated"><strong class="bd jn">宾夕法尼亚州兰卡斯特和北卡罗来纳州达勒姆</strong></figcaption></figure><p id="4d4e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">太好了！推荐系统似乎捕捉到了我们想要的大多数关系，最明显的是天气和社会文化。但是，还有很大的提升空间！不是一直都有吗？</p><h1 id="3854" class="jl jm hi bd jn jo mi jq jr js mj ju jv jw mk jy jz ka ml kc kd ke mm kg kh ki bi translated">后续步骤</h1><p id="e144" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">这个推荐系统表明，一个基于内容的推荐系统可以通过包含正确的措施而变得更加主观，但也受到您所包含的措施的限制！</p><p id="2272" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">基于内容的推荐系统的一个缺陷是，它们只推荐统计上相似的城市。这意味着用户可能喜欢的城市(项目)将不会被推荐，除非它们与用户输入的城市(项目)相似。马克可能喜欢看足球和篮球。假设Maria从不看足球，但喜欢篮球。虽然在协同过滤推荐系统中，可以向Maria推荐不同的运动，例如足球和曲棍球，但是在基于内容的推荐系统中情况并非如此，因为这些运动在统计上是不相似的(或者我们是这样假设的！).</p><p id="bf2a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">那么……有什么可以改进的呢？</p><ul class=""><li id="d0ab" class="ko kp hi io b ip iq it iu ix kq jb kr jf ks jj lt ku kv kw bi translated">将推荐系统转换成混合推荐系统</li><li id="fc1f" class="ko kp hi io b ip ky it kz ix la jb lb jf lc jj lt ku kv kw bi translated">将输入转换为已评级的城市，而不仅仅是城市，以便余弦相似性平均值可以根据您喜欢和不喜欢的城市进行加权。</li><li id="95c4" class="ko kp hi io b ip ky it kz ix la jb lb jf lc jj lt ku kv kw bi translated">包括更多变量，以更好地表示每个项目(例如，湿度或评论)</li></ul><h1 id="4661" class="jl jm hi bd jn jo mi jq jr js mj ju jv jw mk jy jz ka ml kc kd ke mm kg kh ki bi translated"><strong class="ak">使用</strong></h1><p id="22c7" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">通过<a class="ae jk" href="https://github.com/eliasmelul/finding_schitts/blob/master/Recommender_System_FMSC.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>访问笔记本</p><h1 id="0c2d" class="jl jm hi bd jn jo mi jq jr js mj ju jv jw mk jy jz ka ml kc kd ke mm kg kh ki bi translated">结束语</h1><p id="b9b0" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">希望你们都喜欢这个解释“寻找我的Schitt's Creek”项目的迷你系列！更多信息，请关注我的<a class="ae jk" href="https://www.linkedin.com/in/melulelias/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>(:干杯！</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mn"><img src="../Images/8b8de641738fc965e2b5deba5f3834b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*w4yA5mFAc9Kti6OO.jpg"/></div></div></figure></div></div>    
</body>
</html>