<html>
<head>
<title>How to access AWS S3 using Boto3 (Python SDK)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Boto3 (Python SDK)访问AWS S3</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-access-aws-s3-using-boto3-python-sdk-e5fbd3d276bd?source=collection_archive---------4-----------------------#2020-07-01">https://medium.com/analytics-vidhya/how-to-access-aws-s3-using-boto3-python-sdk-e5fbd3d276bd?source=collection_archive---------4-----------------------#2020-07-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a5d06554fd73a618e68dab9e5fef6c9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wECeMnlXFJTRAxXJIGiVoA.png"/></div></div></figure><p id="8eab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最近，亚马逊网络服务(AWS)在云计算领域变得相当流行。其中一个主要组件是S3，AWS的对象存储服务。</p><p id="94c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以通过不同语言的AWS控制台、AWS CLI和AWS SDKs访问S3。<a class="ae jo" href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html" rel="noopener ugc nofollow" target="_blank"> Boto3 </a>是用于AWS的Python SDK的名称。如果你正在使用S3和Python，那么你会知道boto3库有多酷。这让事情变得更容易处理。</p><h2 id="e6f0" class="jq jr hi bd js jt ju jv jw jx jy jz ka jb kb kc kd jf ke kf kg jj kh ki kj kk bi translated"><strong class="ak">先决条件</strong>:</h2><ol class=""><li id="befb" class="kl km hi is b it kn ix ko jb kp jf kq jj kr jn ks kt ku kv bi translated">Python 3+</li></ol><p id="d279" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.boto3模块(<em class="jp"> pip安装boto3 </em>得到它)。</p><p id="3887" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.一个AWS帐户，其AWS IAM用户具有<em class="jp">编程访问权限</em>。向该用户添加<em class="jp"> AmazonS3FullAccess </em>策略。这是为了简单起见，在prod中，您必须遵循最小特权原则。</p><p id="775b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.从AWS控制台下载访问密钥详细信息文件。在终端上创建一个新文件<code class="du kw kx ky kz b">~/.aws/credential</code>，并粘贴如下详细信息:</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es la"><img src="../Images/eebe62ec0fffe6818d335910995e56c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VUepzPMKoZbSJ819NzV0xA.png"/></div></div></figure><p id="cb36" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.从终端在<code class="du kw kx ky kz b">~/.aws/config</code>中设置默认区域。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div class="er es lf"><img src="../Images/fa21d5a4ffe68873f950d010c187c8f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*Gcb5m460s65m4IfBb3YsGw.png"/></div></figure><h2 id="315a" class="jq jr hi bd js jt ju jv jw jx jy jz ka jb kb kc kd jf ke kf kg jj kh ki kj kk bi translated"><strong class="ak">基本操作</strong>:</h2><p id="902b" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">既然准备好了，那就开始探索一些基本操作吧。<br/> <strong class="is hj">创建存储桶</strong></p><p id="8b7b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要记住的第一件重要事情是，bucket名称在整个AWS平台上必须是唯一的，因为bucket名称是符合DNS的。如果您试图使用另一个用户已经声明的名称，您的代码将会失败。您将看到以下错误，而不是成功:<code class="du kw kx ky kz b">botocore.errorfactory.BucketAlreadyExists</code>。</p><pre class="lb lc ld le fd lj kz lk ll aw lm bi"><span id="7e28" class="jq jr hi kz b fi ln lo l lp lq">import boto3<br/>s3_resource = boto3.resource(<strong class="kz hj">'s3'</strong>)<br/>s3_resource.create_bucket(Bucket=<strong class="kz hj">"first-aws-bucket-1"</strong>)</span></pre><p id="0d2b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">列出S3的所有时段</strong></p><p id="04d4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">列出所有在S3的桶。</p><pre class="lb lc ld le fd lj kz lk ll aw lm bi"><span id="75e0" class="jq jr hi kz b fi ln lo l lp lq">for bucket in s3_resource.buckets.all():<br/>    print(bucket.name)</span></pre><p id="73fe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输出:</p><figure class="lb lc ld le fd ij er es paragraph-image"><div class="er es lr"><img src="../Images/6a3a8a6da53c3f0e329bca314ae92fdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*XwZZYVcmIZ2xqus7P_Ky0Q.png"/></div></figure><p id="c5ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">上传对象</strong></p><p id="2f15" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从本地路径<em class="jp">/</em>Users/ankhipaul/Documents/snapshot上传一个文件<em class="jp"> Screen_Shot.png </em>到上面创建的S3桶<em class="jp"> first-aws-bucket-1 </em></p><pre class="lb lc ld le fd lj kz lk ll aw lm bi"><span id="793a" class="jq jr hi kz b fi ln lo l lp lq">s3_resource.Object(<strong class="kz hj">'first-aws-bucket-1'</strong>, <strong class="kz hj">'Screen_Shot.png'</strong>).\<br/>    upload_file(Filename=<strong class="kz hj">'/Users/ankhipaul/Documents/Screenshots/Screen_Shot.png'</strong>)</span></pre><p id="849b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输出:</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/cf14d6e1b075a609c508dfe8f4f7016e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cm3pMvEq6wdGP7dBYW_Ulw.png"/></div></div></figure><p id="2d28" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">从S3下载对象</strong></p><p id="dc32" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将名为<em class="jp">doc.pdf</em>的对象从桶<em class="jp"> pythonusecase </em>下载到本地系统。</p><pre class="lb lc ld le fd lj kz lk ll aw lm bi"><span id="54e1" class="jq jr hi kz b fi ln lo l lp lq">s3_resource.Object(<strong class="kz hj">'pythonusecase'</strong>, <strong class="kz hj">'doc.pdf'</strong>).download_file(<br/>    <strong class="kz hj">f'/Users/ankhipaul/Documents/doc.pdf'</strong>)</span></pre><p id="56be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">列出特定桶的所有对象</strong></p><p id="72cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">列出桶中的所有对象<em class="jp"> pythonusecase。</em>这还将列出所有文件夹以及该桶中各个文件夹的文件。</p><pre class="lb lc ld le fd lj kz lk ll aw lm bi"><span id="7fd6" class="jq jr hi kz b fi ln lo l lp lq">pythonusecase = s3_resource.Bucket(name = <strong class="kz hj">'pythonusecase'</strong>)<br/>for object in pythonusecase.objects.all():<br/>          print(object.key)</span></pre><p id="b3d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输出:</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/0b839a85a4ab532ba21763ddfea5f069.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vDlXrLbblJEZ0yrfqHPOwA.png"/></div></div></figure><p id="d401" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">复制一个对象</strong></p><p id="000f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将对象<em class="jp"> old_convertcsv.csv </em>复制到同一个桶中的新位置，并使用新名称<em class="jp"> new_convertcsv.csv </em>。因此，创建一个新的对象。</p><pre class="lb lc ld le fd lj kz lk ll aw lm bi"><span id="6201" class="jq jr hi kz b fi ln lo l lp lq">s3_resource.Object(<strong class="kz hj">"pythonusecase"</strong>, <strong class="kz hj">"new_convertcsv.csv"</strong>).copy_from(CopySource=<strong class="kz hj">"pythonusecase/old_convertcsv.csv"</strong>)</span></pre><p id="a98c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输出:</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/fd809450fbecc5f407f922d98da74428.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ccPHV3xKcz7qWHSw0gYPJQ.png"/></div></div></figure><p id="49ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">删除一个对象</strong></p><p id="d201" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从桶<em class="jp"> pythonusecase </em>中删除<em class="jp"> old_convertcsv.csv </em></p><pre class="lb lc ld le fd lj kz lk ll aw lm bi"><span id="3deb" class="jq jr hi kz b fi ln lo l lp lq">s3_resource.Object(<strong class="kz hj">"pythonusecase"</strong>, <strong class="kz hj">"old_convertcsv.csv"</strong>).delete()</span></pre><p id="63da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输出:</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/1c625b2a9e25f07e00bb4f18e3677da2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tMkp2cB9R7QqRuTS__13rA.png"/></div></div></figure><blockquote class="lw lx ly"><p id="47ce" class="iq ir jp is b it iu iv iw ix iy iz ja lz jc jd je ma jg jh ji mb jk jl jm jn hb bi translated">请记住，S3存储桶没有任何“移动”或“重命名”操作。我们所能做的就是创建、复制和删除。因为没有移动或重命名；复制+删除同样可以实现。</p></blockquote><p id="cb5e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">删除一个桶</strong></p><p id="45f6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要删除存储桶，我们必须首先确保存储桶中没有对象。首先，删除桶<em class="jp">的所有对象first-aws-bucket-1。</em>然后删除空桶。</p><pre class="lb lc ld le fd lj kz lk ll aw lm bi"><span id="bb57" class="jq jr hi kz b fi ln lo l lp lq">bucket = s3_resource.Bucket(<strong class="kz hj">'first-aws-bucket-1'</strong>)<br/>bucket.objects.all().delete()<br/>s3_resource.Bucket(<strong class="kz hj">"first-aws-bucket-1"</strong>).delete()</span></pre><p id="95fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输出:</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/0a80cde9339ab44f26f3f1dd81493a34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ho5DrYbzJYGULyhhEwn-cg.png"/></div></div><figcaption class="md me et er es mf mg bd b be z dx translated">删除后，S3中只存在一个存储桶</figcaption></figure><p id="4737" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">对象的加密</strong></p><p id="9e9e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">S3对象使用服务器端或客户端加密进行加密。我将使用<em class="jp">服务器端加密和亚马逊S3管理的密钥(SSE-S3)</em>；在这个亚马逊S3加密的对象使用AES-256算法之前，保存到磁盘和解密时，你下载的对象。</p><p id="0d40" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上传一张图片<em class="jp"> random_pic.jpg </em>到桶<em class="jp"> pythonusecase </em>使用AES-256加密。</p><pre class="lb lc ld le fd lj kz lk ll aw lm bi"><span id="442e" class="jq jr hi kz b fi ln lo l lp lq">s3_resource.Object(<strong class="kz hj">'pythonusecase'</strong>, <strong class="kz hj">'random_pic.jpg'</strong>).\<br/>    upload_file(Filename=<strong class="kz hj">'/Users/ankhipaul/Documents/random_pic.jpg'</strong>,ExtraArgs={<br/>                         <strong class="kz hj">'ServerSideEncryption'</strong>: <strong class="kz hj">'AES256'</strong>})</span></pre><p id="3269" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在AWS控制台上，我们可以看到加密为AES-256。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/acaa939ca27870d0d9460f7a6ef2f37e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dfAS6Ro0gx7-vte-X9b2uw.png"/></div></div></figure><p id="d255" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">版本控制</strong></p><p id="fdec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们都曾使用版本控制来防止意外删除或维护对象随时间变化的完整记录。当您请求一个版本化的对象时，Boto3将检索最新版本。</p><p id="5714" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们必须首先启用版本控制。<em class="jp">在AWS中，默认情况下，桶版本控制是禁用的</em>。一旦我们启用了版本控制，它可以被挂起，但不能被禁用。</p><pre class="lb lc ld le fd lj kz lk ll aw lm bi"><span id="146a" class="jq jr hi kz b fi ln lo l lp lq">s3_resource.BucketVersioning(<strong class="kz hj">"pythonusecase"</strong>).enable()</span></pre><p id="dc35" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输出:</p><figure class="lb lc ld le fd ij er es paragraph-image"><div class="er es mi"><img src="../Images/9af617ac77010d2886ddfca369ac6806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*Q5dNqsQJ9iOXqyBvZbBayA.png"/></div></figure><h2 id="362c" class="jq jr hi bd js jt ju jv jw jx jy jz ka jb kb kc kd jf ke kf kg jj kh ki kj kk bi translated">摘要</h2><p id="bcb8" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">至此，我们完成了！您现在应该对Boto3有了基本的了解。更多详情，请访问<a class="ae jo" href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/s3.html" rel="noopener ugc nofollow" target="_blank">https://boto 3 . Amazon AWS . com/v1/documentation/API/latest/reference/services/S3 . html</a></p><p id="aeab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完整的代码参考，请访问<a class="ae jo" href="https://github.com/ankhipaul/aws_demos" rel="noopener ugc nofollow" target="_blank"> github </a>。</p></div></div>    
</body>
</html>