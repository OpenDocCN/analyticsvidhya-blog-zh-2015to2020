<html>
<head>
<title>Show Off Your Machine Learning Project on Web Part 3: Deploy onto Heroku with Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Web上展示您的机器学习项目第3部分:使用Docker部署到Heroku上</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/show-off-your-machine-learning-project-on-web-part-3-deploy-onto-heroku-with-docker-b78fedb99ceb?source=collection_archive---------24-----------------------#2020-06-29">https://medium.com/analytics-vidhya/show-off-your-machine-learning-project-on-web-part-3-deploy-onto-heroku-with-docker-b78fedb99ceb?source=collection_archive---------24-----------------------#2020-06-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="d410" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">客户需要的是一个域名和一个浏览器。</h2></div><blockquote class="ix iy iz"><p id="0b56" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">点击进入<a class="ae jx" rel="noopener" href="/analytics-vidhya/show-off-your-machine-learning-project-on-web-part-1-streamlit-it-801bc0b6848f?source=friends_link&amp;sk=e64d0f6b0d101f8320465469d8812f35">第一部分</a>和<a class="ae jx" rel="noopener" href="/analytics-vidhya/show-off-your-machine-learning-project-on-web-part-2-dockerize-you-streamlit-app-fab385d79ef9?source=friends_link&amp;sk=80ea34c77c509739f16c17530536a1eb">第二部分</a>。<br/>点击<a class="ae jx" rel="noopener" href="/analytics-vidhya/show-off-your-machine-learning-project-on-web-part-3-deploy-onto-heroku-with-docker-b78fedb99ceb">此</a>通过付费墙。</p><p id="31d8" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><em class="hi">TL；DR:你可以在这里</em>  <em class="hi">得到范例项目</em> <a class="ae jx" href="https://github.com/Cuda-Chen/fish-yolo-grabcut" rel="noopener ugc nofollow" target="_blank"> <em class="hi">。</em></a></p></blockquote><figure class="jz ka kb kc fd kd er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es jy"><img src="../Images/55a9bca35e3c23830b290916992eae60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*U0tTG_nXq2fL-Zndi7UgIA.gif"/></div></div><figcaption class="kk kl et er es km kn bd b be z dx translated">我在Heroku上的应用程序演示。你可以在<a class="ae jx" href="https://fish-yolo-grabcut.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://fish-yolo-grabcut.herokuapp.com/</a>访问这个应用。</figcaption></figure><h1 id="7cd4" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">动机</h1><p id="ad04" class="pw-post-body-paragraph ja jb hi jd b je lg ij jg jh lh im jj li lj jm jn lk ll jq jr lm ln ju jv jw hb bi translated">在你创建了一个dockerized环境后，你认为你应该在云上部署你的应用程序，这样你就可以炫耀你的机器学习项目，web开发和DevOps技能。此外，其他人只需点击一下您提供的URL就可以访问您的项目，而无需了解如何设置环境。</p><h1 id="e5b6" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">本部分的目标</h1><p id="07a1" class="pw-post-body-paragraph ja jb hi jd b je lg ij jg jh lh im jj li lj jm jn lk ll jq jr lm ln ju jv jw hb bi translated">这一部分将教你如何把你Docker化的app部署到Heroku上，并告诉你用Docker部署时Heroku的一些专门设置。</p><h1 id="3b76" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">在部署到Heroku之前</h1><p id="74d1" class="pw-post-body-paragraph ja jb hi jd b je lg ij jg jh lh im jj li lj jm jn lk ll jq jr lm ln ju jv jw hb bi translated">Heroku为<a class="ae jx" href="https://devcenter.heroku.com/categories/deploying-with-docker" rel="noopener ugc nofollow" target="_blank">提供了三种方式</a>来部署你的dockerized app:</p><ol class=""><li id="e09f" class="lo lp hi jd b je jf jh ji li lq lk lr lm ls jw lt lu lv lw bi translated">容器注册和运行时(Docker部署)</li><li id="5e56" class="lo lp hi jd b je lx jh ly li lz lk ma lm mb jw lt lu lv lw bi translated">用heroku.yml构建Docker图像</li><li id="445f" class="lo lp hi jd b je lx jh ly li lz lk ma lm mb jw lt lu lv lw bi translated">使用Docker Compose进行本地开发</li></ol><p id="8d95" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">由于我的应用程序不需要Docker组件(只有一个streamlit服务)，所以没有必要使用Docker Compose。</p><p id="2fff" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">尽管大多数帖子使用方法#1，我还是会选择方法#2，原因有两个:</p><ol class=""><li id="00e1" class="lo lp hi jd b je jf jh ji li lq lk lr lm ls jw lt lu lv lw bi translated">帖子很少提到这种方法。</li><li id="0d12" class="lo lp hi jd b je lx jh ly li lz lk ma lm mb jw lt lu lv lw bi translated">我为Heroku部署编写了一个专门的docker文件。</li></ol><h1 id="ae64" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">我们需要的组件</h1><p id="4006" class="pw-post-body-paragraph ja jb hi jd b je lg ij jg jh lh im jj li lj jm jn lk ll jq jr lm ln ju jv jw hb bi translated">对于方法#2，我们至少需要两个文件:</p><ol class=""><li id="2258" class="lo lp hi jd b je jf jh ji li lq lk lr lm ls jw lt lu lv lw bi translated"><code class="du mc md me mf b">Dockerfile</code></li><li id="6c6c" class="lo lp hi jd b je lx jh ly li lz lk ma lm mb jw lt lu lv lw bi translated"><code class="du mc md me mf b">heroku.yml</code>:向Heroku表明你想要什么来构建和部署。</li></ol><p id="7bb1" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">在我的例子中，我需要三个文件，因为我喜欢模块化:</p><ol class=""><li id="499f" class="lo lp hi jd b je jf jh ji li lq lk lr lm ls jw lt lu lv lw bi translated"><code class="du mc md me mf b">Dockerfile</code></li><li id="1f5a" class="lo lp hi jd b je lx jh ly li lz lk ma lm mb jw lt lu lv lw bi translated"><code class="du mc md me mf b">heroku.yml</code></li><li id="e5c1" class="lo lp hi jd b je lx jh ly li lz lk ma lm mb jw lt lu lv lw bi translated">heroku_startup.sh</li></ol><h1 id="f658" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">Dockerfile文件</h1><p id="521b" class="pw-post-body-paragraph ja jb hi jd b je lg ij jg jh lh im jj li lj jm jn lk ll jq jr lm ln ju jv jw hb bi translated">就像第2部分一样，对Heroku部署做了一些修改:</p><figure class="jz ka kb kc fd kd"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="5d0d" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">您可以在第42行和第48行看到变化。原因是:</p><ol class=""><li id="970c" class="lo lp hi jd b je jf jh ji li lq lk lr lm ls jw lt lu lv lw bi translated">更改<code class="du mc md me mf b">heroku_startup.sh</code>的权限，否则在执行<code class="du mc md me mf b">heroku_startup.sh</code>时会收到<code class="du mc md me mf b">permission denied</code>错误。</li><li id="5525" class="lo lp hi jd b je lx jh ly li lz lk ma lm mb jw lt lu lv lw bi translated"><code class="du mc md me mf b">ENTRYPOINT "./heroku_startup.sh"</code>告诉码头工人启动集装箱时执行<code class="du mc md me mf b">heroku_startup.sh</code>。</li></ol><h1 id="c08b" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">Heroku.yml</h1><p id="a81f" class="pw-post-body-paragraph ja jb hi jd b je lg ij jg jh lh im jj li lj jm jn lk ll jq jr lm ln ju jv jw hb bi translated">Heroku需要<code class="du mc md me mf b">heroku.yml</code>来构建和部署Docker映像，所以我为自己创建了一个:</p><pre class="jz ka kb kc fd mi mf mj mk aw ml bi"><span id="87ec" class="mm kp hi mf b fi mn mo l mp mq">build:<br/>  docker:<br/>    web: heroku.Dockerfile<br/>run:<br/>  web: ./heroku_startup.sh</span></pre><p id="a539" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">显然，<code class="du mc md me mf b">build</code>和<code class="du mc md me mf b">run</code>部分分别指出了在Heroku上构建和运行阶段您想要做的事情。</p><h1 id="deca" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">heroku_startup.sh</h1><p id="ca71" class="pw-post-body-paragraph ja jb hi jd b je lg ij jg jh lh im jj li lj jm jn lk ll jq jr lm ln ju jv jw hb bi translated">这里提到的<a class="ae jx" href="https://devcenter.heroku.com/articles/container-registry-and-runtime#unsupported-dockerfile-commands" rel="noopener ugc nofollow" target="_blank">是</a>，Heroku使用一个<code class="du mc md me mf b">$PORT</code>环境变量进行端口暴露。所以<code class="du mc md me mf b">heroku_startup.sh</code>看起来会像这样:</p><pre class="jz ka kb kc fd mi mf mj mk aw ml bi"><span id="a3ce" class="mm kp hi mf b fi mn mo l mp mq">#!/bin/bash<br/><br/>echo PORT $PORT<br/>streamlit run --server.port $PORT app.py</span></pre><p id="6d91" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">您必须设置<code class="du mc md me mf b">$PORT</code>变量来简化它，否则您的应用程序将不会出现。</p><h1 id="bbcb" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">部署！</h1><p id="6886" class="pw-post-body-paragraph ja jb hi jd b je lg ij jg jh lh im jj li lj jm jn lk ll jq jr lm ln ju jv jw hb bi translated">这一步相当容易，你需要的是用Git 部署<a class="ae jx" href="https://devcenter.heroku.com/articles/git" rel="noopener ugc nofollow" target="_blank">。然后Heroku会用<code class="du mc md me mf b">Heroku.yml</code>而不是<code class="du mc md me mf b">Procfile</code>用Docker部署你的应用。</a></p><h1 id="a48e" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">概述</h1><p id="e406" class="pw-post-body-paragraph ja jb hi jd b je lg ij jg jh lh im jj li lj jm jn lk ll jq jr lm ln ju jv jw hb bi translated">这部分展示了如何将你的机器学习应用部署到Heroku上，并提到了Heroku上的一些特殊设置。</p><p id="9346" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated">希望这个系列可以帮助你把你的机器学习app和web、DevOps开发周期结合起来，让你赶上潮流，不被web开发公司嘲讽！</p></div><div class="ab cl mr ms gp mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hb hc hd he hf"><p id="2d49" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj li jl jm jn lk jp jq jr lm jt ju jv jw hb bi translated"><em class="jc">原载于2020年6月29日</em><a class="ae jx" href="https://cuda-chen.github.io/devops/2020/06/29/streamlit-docker-heroku-part-3.html" rel="noopener ugc nofollow" target="_blank"><em class="jc">https://cuda-Chen . github . io</em></a><em class="jc">。</em></p></div><div class="ab cl mr ms gp mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hb hc hd he hf"><blockquote class="ix iy iz"><p id="38a6" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">如果你有什么想法和问题要分享，请联系我<a class="ae jx" href="http://clh960524@gmail.com/" rel="noopener ugc nofollow" target="_blank"><strong class="jd hj">clh 960524【at】Gmail . com</strong></a>。另外，你可以查看我的<a class="ae jx" href="https://github.com/Cuda-Chen" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>的其他作品。如果你像我一样对机器学习、图像处理和并行计算充满热情，请随时<a class="ae jx" href="https://www.linkedin.com/in/lu-hsuan-chen-78071b171/" rel="noopener ugc nofollow" target="_blank">在LinkedIn </a>上添加我。</p></blockquote></div></div>    
</body>
</html>