<html>
<head>
<title>Creating an Album Photo Application Using Flutter, Java and AWS S3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Flutter、Java和AWS S3创建相册照片应用程序</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/creating-an-album-photo-application-using-flutter-java-and-aws-s3-1d421c432b0d?source=collection_archive---------10-----------------------#2020-03-28">https://medium.com/analytics-vidhya/creating-an-album-photo-application-using-flutter-java-and-aws-s3-1d421c432b0d?source=collection_archive---------10-----------------------#2020-03-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6f70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章是使用Spring Boot的Java的AWS S3的延续。要做到这一点，你需要先阅读它，如果你不想写Java代码，你可以从Github下载该项目，下载链接在本系列的第一篇文章中。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/ffd08dde78e1052031de6b044e83ea9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B-VDlv_lOH6dgfbzhujh_g.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">完成申请。</figcaption></figure><h2 id="ee52" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">应用程序可用性</h2><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kp"><img src="../Images/3836a07db60163ee761f8300660310c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*3YWeojIZvYkeetxfCD7mqQ.gif"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">相册页面。</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kp"><img src="../Images/5201f39bf5154bc978e1fc24f5090eed.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*fYCm9xApT6kVEY-rfurYKg.gif"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">插入相册页面。</figcaption></figure><p id="6b02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要完成此应用程序，您需要:</p><ol class=""><li id="c68f" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">颤振的初步知识。</li><li id="e58b" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">阅读<a class="ae jd" rel="noopener" href="/analytics-vidhya/aws-s3-with-java-using-spring-boot-7f6fcf734aec"> AWS S3与Java使用Spring Boot </a>和API运行。</li><li id="5b85" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">30分钟编码。</li></ol><p id="0d67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">本项目使用的技术</strong></p><ol class=""><li id="82ef" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">Slidy</li><li id="2951" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">mobx(1 . 1 . 1版)</li><li id="e87d" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">颤振模块(1.0.0版)</li><li id="3bb8" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">Json可序列化(3.3.0版)</li><li id="8dc2" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">颤振模型生成器(3.8.2版)</li><li id="1f64" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">图像裁剪器(1.2.1版)</li><li id="7fec" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">图像拾取器(v0.6.4)</li></ol><h2 id="0ab8" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">Slidy</h2><p id="fe59" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">对于这个项目，我们使用<a class="ae jd" href="https://pub.dev/packages/slidy" rel="noopener ugc nofollow" target="_blank"> Slidy </a>。</p><p id="a0e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Slidy 是一个Flutter的CLI，可以很容易地从它创建项目模式，并且它包含了许多实用的依赖。</p><h2 id="dc4c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">安装滑块</h2><p id="9ea9" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">要安装它，你可以按照pub上的项目页面上的教程，<a class="ae jd" href="https://pub.dev/packages/slidy" rel="noopener ugc nofollow" target="_blank">点击这里！</a></p><h2 id="8061" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">创建项目</h2><p id="957a" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">首先，启动在第一篇文章中创建的API。开始了？<strong class="ih hj">好吧！</strong></p><p id="4a60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们去看代码。我向您展示了当我使用Slidy，soo编写代码时我会做什么，在Flutter中创建一个干净的项目运行命令:</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="c016" class="ju jv hi lk b fi lo lp l lq lr">flutter create photos_app</span></pre><p id="427c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在你自己的IDE上打开项目，在我的例子中，我将使用IntelliJ IDEA。并运行命令:</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="f551" class="ju jv hi lk b fi lo lp l lq lr">slidy start -f</span></pre><p id="b1a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于提供商，选择默认值“颤振_模块化”:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ls"><img src="../Images/515e6cd5bb2e7b25ac31b5bc368076e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*tvB8yms8hvlTpzlFkEKNrg.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">提供商选择。</figcaption></figure><p id="9492" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">状态管理器，选择Mobx:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lt"><img src="../Images/02ba729c81edde0f8c5af358ec474ef0.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*AUTkfefZX0RWNNn4sS8nkQ.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">状态管理器选择。</figcaption></figure><p id="3537" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行:</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="e6e5" class="ju jv hi lk b fi lo lp l lq lr">flutter packages get</span></pre><p id="8522" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，Slidy正在为我们创建项目的基本结构，运行这个之后，你的项目是这样的:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lu"><img src="../Images/b7c2af3a687da042f425a617f60af264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fznpdu8Dke_IAiLokYv9PA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">Slidy CLI生成的项目模式。</figcaption></figure><p id="62aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你的控制器里有错误，对吗？这是因为Mobx需要<a class="ae jd" href="https://dart.dev/tools/build_runner" rel="noopener ugc nofollow" target="_blank"> flutter构建运行器</a>来为我们生成代码。</p><p id="32eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，Slidy为我们安装了它，现在我们需要在终端上调用命令:</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="bcf1" class="ju jv hi lk b fi lo lp l lq lr">flutter pub run build_runner watch</span></pre><p id="f6d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">等待构建运行程序完成您的操作并发出“哔”的一声，错误就被销毁了。</p><h2 id="73a1" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">安装依赖项</h2><p id="e603" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">运行这些命令:</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="8224" class="ju jv hi lk b fi lo lp l lq lr">slidy install json_serializable<br/>slidy install flutter_form_builder<br/>slidy install transparent_image<br/>slidy install image_picker</span></pre><p id="e553" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，运行:</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="a6c4" class="ju jv hi lk b fi lo lp l lq lr">flutter packages get</span></pre><p id="4fdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新依赖关系。</p><h2 id="a86f" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">对Slidy的理解</h2><p id="4895" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">如果你是一个谷歌爱好者，你可以规范一下这个项目的结构，它与Angular最相似，你有一个<em class="lv"> AppModule </em>，你有一个<em class="lv">控制器</em>和<em class="lv">视图/页面。</em></p><p id="e720" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Slidy上的Modules是一个具有提供单例和组织代码能力的类，例如，big AppModule是us应用程序上的主要模块，因为main方法调用它来启动playground。</p><p id="edbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Slidy正在考虑<strong class="ih hj"> Flutter Web，</strong>因为这种结构使用命名的路径，而不是传统的Flutter导航。</p><p id="bfc8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，按照这个结构，main调用AppModule，AppModule上的第一个路由(“/”)调用HomeModule，在HomeModule上，我们有一个页面，主页是从HomeModule上的路由“/”调用的。</p><p id="6025" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简单不？</p><h2 id="5f7c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">颤振知识库</h2><p id="89d8" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">是的，Slidy使用类似于<strong class="ih hj"> MVC </strong>(模型视图控制器)的结构工作，但是它有一个特殊性，即<strong class="ih hj">存储库</strong>层。</p><p id="fc96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Flutter中的仓库是一个类，我们可以在其中调用APIs存储，或者更简单的，数据库。</p><p id="1080" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个数据都是从存储库中操作的，控制器有一些业务逻辑来控制视图。</p><h2 id="9682" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">该项目</h2><p id="f8ba" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">这个项目很简单:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lw"><img src="../Images/80d790097f124d74bc24df61833e940b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZaglekURvOdNA_ZGGlUcwA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">arquiteture项目。</figcaption></figure><p id="9c67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好吧，跟我来创造基础生活。</p><p id="65bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们需要一个相册类，这是后端为我们表示相同的类。</p><p id="24f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们需要先创建AmazonImage类，因为相册中有它的列表。</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="acf3" class="ju jv hi lk b fi lo lp l lq lr">import 'package:json_annotation/json_annotation.dart';<br/><br/>part 'amazon_image_model.g.dart';<br/><br/>@JsonSerializable()<br/>class AmazonImageModel {<br/>  AmazonImageModel({<br/>    this.amazonUserImageId,<br/>    this.imageUrl<br/>  });<br/><br/>  String amazonUserImageId;<br/>  String imageUrl;<br/><br/>  factory AmazonImageModel.fromJson(Map&lt;String, dynamic&gt; json) =&gt; _$AmazonImageModelFromJson(json);<br/>  Map&lt;String, dynamic&gt; toJson() =&gt; _$AmazonImageModelToJson(this);<br/>}</span></pre><p id="5a17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们可以创建相册类。</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="ee87" class="ju jv hi lk b fi lo lp l lq lr">import 'package:json_annotation/json_annotation.dart';<br/>import 'package:photos_app/app/modules/shared/models/amazon/amazon_image_model.dart';<br/><br/>part 'album_model.g.dart';<br/><br/>@JsonSerializable()<br/>class AlbumModel {<br/>  AlbumModel({<br/>    this.albumId,<br/>    this.title,<br/>    this.images<br/>  });<br/><br/>  String albumId;<br/>  String title;<br/>  List&lt;AmazonImageModel&gt; images;<br/><br/>  factory AlbumModel.fromJson(Map&lt;String, dynamic&gt; json) =&gt; _$AlbumModelFromJson(json);<br/>  Map&lt;String, dynamic&gt; toJson() =&gt; _$AlbumModelToJson(this);<br/>}</span></pre><p id="1a9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们需要做存储库类，来调用后端，为此，我们需要配置API url。</p><p id="e173" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Slidy默认使用Dio进行请求，Dio有很多util配置给我们，比如API的基础url。</p><p id="41e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了给Dio提供基本的选项，我们需要在AppModule的绑定列表中编写一个Dio实例，其基本配置如下:</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="abb8" class="ju jv hi lk b fi lo lp l lq lr">import 'package:dio/dio.dart';<br/>import 'package:photos_app/app/app_controller.dart';<br/>import 'package:flutter_modular/flutter_modular.dart';<br/>import 'package:flutter/material.dart';<br/>import 'package:photos_app/app/app_widget.dart';<br/>import 'package:photos_app/app/modules/home/home_module.dart';<br/><br/>class AppModule extends MainModule {<br/>  @override<br/>  List&lt;Bind&gt; get binds =&gt; [<br/>        Bind((i) =&gt; AppController()),<br/>        Bind((i) =&gt; Dio(BaseOptions(<br/>          baseUrl: 'http://{api_url}:{api_port}'<br/>        )))<br/>      ];<br/><br/>  @override<br/>  List&lt;Router&gt; get routers =&gt; [<br/>        Router('/', module: HomeModule()),<br/>      ];<br/><br/>  @override<br/>  Widget get bootstrap =&gt; AppWidget();<br/><br/>  static Inject get <em class="lv">to </em>=&gt; Inject&lt;AppModule&gt;.of();<br/>}</span></pre><blockquote class="lx ly lz"><p id="1faf" class="if ig lv ih b ii ij ik il im in io ip ma ir is it mb iv iw ix mc iz ja jb jc hb bi translated"><strong class="ih hj">记住！颤振运行在你的仿真器/电话设备上，在设备上，URL是你的机器的精确IP，因为你的设备上的“本地主机”调用设备。所以，当你升级你的后台时，记得在你的本地网站上公开它。(一般是)</strong></p></blockquote><p id="c46f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的例子中，url是这样的:“base URL:' http://192 . 168 . 0 . 106:8080 '”</p><p id="dbe4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">酷，现在我们需要创建一个存储库来调用API。Slidy有一个为我们创建基本的命令:</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="f68c" class="ju jv hi lk b fi lo lp l lq lr">slidy generate repository modules/shared/repository/album</span></pre><blockquote class="lx ly lz"><p id="6330" class="if ig lv ih b ii ij ik il im in io ip ma ir is it mb iv iw ix mc iz ja jb jc hb bi translated">如果你在测试文件夹中发现错误，请删除所有错误，Slidy会自动为我们生成测试，这不是本教程的重点。</p></blockquote><p id="777e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Slidy在提供的路径上生成一个存储库，用下面的代码修改这个存储库:</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="5c21" class="ju jv hi lk b fi lo lp l lq lr">import 'dart:io';<br/>import 'package:path/path.dart';<br/><br/>import 'package:dio/dio.dart';<br/>import 'package:flutter_modular/flutter_modular.dart';<br/>import 'package:photos_app/app/modules/shared/models/album/album_model.dart';<br/>import 'package:photos_app/app/modules/shared/models/amazon/amazon_image_model.dart';<br/><br/>class AlbumRepository extends Disposable {<br/>  final Dio dio;<br/><br/>  AlbumRepository({<br/>    this.dio<br/>  });<br/><br/>  // FindAllAlbums on Maker Resource in the backend.<br/>  // This calls is one put because your filter, these request receive<br/>  // an Album.class on backend to do an filter. :)<br/>  Future&lt;List&lt;AlbumModel&gt;&gt; findAllAlbums(AlbumModel filter) async {<br/>    // Call the backend, this method are asyncronous, than, await.<br/>    // If any error throws an DioError. But these errors are responsibility of<br/>    // controller to manipulate the screen state.<br/>    Response&lt;List&gt; response = await dio.put('/album/search', data: filter);<br/><br/>    // Case success.<br/>    if (_successResponse(response)) {<br/>      return response.data.map&lt;AlbumModel&gt;((json) =&gt; AlbumModel.fromJson(json)).toList();<br/>    } else {<br/><br/>      // Case error, return null.<br/>      return null;<br/>    }<br/>  }<br/><br/>  // uploadImage send image to backend to send AWS S3.<br/>  // This method receive an List of Images, because the<br/>  // backend can receive an List of MultipartFile.<br/>  Future&lt;List&lt;AmazonImageModel&gt;&gt; uploadImages(List&lt;File&gt; images) async {<br/>    // Create the FormData from Dio.<br/>    var formData = FormData();<br/><br/>    // Populate the formData files with the field "images"<br/>    // Thats images for Dio is a MapEntry of String, MultipartFile,<br/>    // easl'y no? If you builded the backend, it receive an MultipartFile like Dio can send!<br/>    formData.files.addAll(images.map&lt;MapEntry&lt;String, MultipartFile&gt;&gt;((image) =&gt; _createMapEntryFromFile(image)));<br/><br/>    // Now, is easy. Call the API.<br/>    Response&lt;List&gt; response = await dio.post&lt;List&gt;(<br/>        '/amazon/images',<br/>        data: formData,<br/>        options: Options(<br/>          headers: {<br/>            'Content-Type': 'application/x-www-form-urlencoded'<br/>          }<br/>        )<br/>    );<br/><br/>    // Case success.<br/>    if (_successResponse(response)) {<br/>      return response.data.map&lt;AmazonImageModel&gt;((json) =&gt; AmazonImageModel.fromJson(json)).toList();<br/>    } else {<br/><br/>      // Case error, return null.<br/>      return null;<br/>    }<br/><br/>  }<br/><br/>  // Insert the Album.<br/>  Future&lt;AlbumModel&gt; insertAlbum(AlbumModel albumModel) async {<br/>      Response&lt;Map&gt; response = await dio.post('/album', data: albumModel);<br/><br/>      // Case success.<br/>      if (_successResponse(response)) {<br/>        return AlbumModel.fromJson(response.data);<br/>      } else {<br/><br/>        // Case error, return null.<br/>        return null;<br/>      }<br/>  }<br/><br/>  MapEntry&lt;String, MultipartFile&gt; _createMapEntryFromFile(File image) {<br/>    return MapEntry&lt;String, MultipartFile&gt;('images', MultipartFile<br/>            .<em class="lv">fromFileSync</em>(image.path, filename: basename(image.path)));<br/>  }<br/><br/>  @override<br/>  void dispose() { }<br/><br/>  bool _successResponse(Response response) =&gt; response.statusCode &gt;= 200 &amp;&amp; response.statusCode &lt; 300;<br/>}</span></pre><blockquote class="lx ly lz"><p id="f303" class="if ig lv ih b ii ij ik il im in io ip ma ir is it mb iv iw ix mc iz ja jb jc hb bi translated">我对代码进行了注释，解释我在方法上做了什么。</p></blockquote><p id="c5ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们需要创建屏幕。</p><p id="5dbe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，请运行以下命令:</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="ca6b" class="ju jv hi lk b fi lo lp l lq lr">slidy generate module modules/album -c</span></pre><p id="5d10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在模块内部，生成一个附加页面:</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="b8d5" class="ju jv hi lk b fi lo lp l lq lr">slidy generate page modules/album/album_form</span></pre><p id="50ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实际上，这是我的项目模式:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es md"><img src="../Images/dddd44373d044bc001b3adbb008ffc8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RVz9VI1eeBOKjvoJdtPsdg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">项目模式。</figcaption></figure><p id="3804" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以从源代码中删除HomeModule，并将AppModule的主要路由更改为调用AlbumModule。</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="799e" class="ju jv hi lk b fi lo lp l lq lr">import 'package:photos_app/app/modules/album/album_module.dart';<br/>import 'package:photos_app/app/modules/shared/repository/album_repository.dart';<br/>import 'package:dio/dio.dart';<br/>import 'package:photos_app/app/app_controller.dart';<br/>import 'package:flutter_modular/flutter_modular.dart';<br/>import 'package:flutter/material.dart';<br/>import 'package:photos_app/app/app_widget.dart';<br/><br/>class AppModule extends MainModule {<br/>  @override<br/>  List&lt;Bind&gt; get binds =&gt; [<br/>        // Inject to AlbumRepository the Dio instance.<br/>        Bind((i) =&gt; AlbumRepository(<br/>          dio: i.get()<br/>        )),<br/>        Bind((i) =&gt; AppController()),<br/>        Bind((i) =&gt; Dio(BaseOptions(baseUrl: 'http://192.168.0.106:8080')))<br/>      ];<br/><br/>  @override<br/>  List&lt;Router&gt; get routers =&gt; [<br/>        Router('/', module: AlbumModule()),<br/>      ];<br/><br/>  @override<br/>  Widget get bootstrap =&gt; AppWidget();<br/><br/>  static Inject get <em class="lv">to </em>=&gt; Inject&lt;AppModule&gt;.of();<br/>}</span></pre><h2 id="0544" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">从基本概念开始！</h2><p id="591c" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">为了建立这个页面，我们需要知道:“现在专辑信息在哪里？”在arquiteture项目之后，跟我来创建控制器，第一个控制器，AlbumController:</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="7ea4" class="ju jv hi lk b fi lo lp l lq lr">import 'package:flutter_modular/flutter_modular.dart';<br/>import 'package:mobx/mobx.dart';<br/>import 'package:photos_app/app/modules/shared/models/album/album_model.dart';<br/>import 'package:photos_app/app/modules/shared/repository/album_repository.dart';<br/><br/>part 'album_controller.g.dart';<br/><br/>class AlbumController = _AlbumBase with _$AlbumController;<br/><br/>abstract class _AlbumBase with Store {<br/><br/>  AlbumRepository _albumRepository = Modular.<em class="lv">get</em>();<br/><br/>  List&lt;AlbumModel&gt; albums = [];<br/><br/>  // Create an enumeraiton to easl'y manage the page state.<br/>  @observable<br/>  AlbumState albumState = AlbumState.LOADING;<br/><br/>  @action<br/>  fetchAlbums(AlbumModel filter) async {<br/>    albumState = AlbumState.LOADING;<br/><br/>    albums = [];<br/>    albums.addAll(await _albumRepository.findAllAlbums(filter));<br/><br/>    if (albums.length &gt; 0) {<br/>      albumState = AlbumState.IDLE;<br/>    } else {<br/>      albumState = AlbumState.NOITENS;<br/>    }<br/><br/>  }<br/><br/>}<br/><br/>enum AlbumState { IDLE, LOADING, NOITENS }</span></pre><p id="ed39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们为这个页面建立一个很酷的布局。</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="252f" class="ju jv hi lk b fi lo lp l lq lr">import 'package:flutter/material.dart';<br/>import 'package:flutter_form_builder/flutter_form_builder.dart';<br/>import 'package:flutter_mobx/flutter_mobx.dart';<br/>import 'package:flutter_modular/flutter_modular.dart';<br/>import 'package:photos_app/app/modules/album/album_controller.dart';<br/>import 'package:photos_app/app/modules/shared/models/album/album_model.dart';<br/>import 'package:photos_app/app/modules/shared/models/amazon/amazon_image_model.dart';<br/>import 'package:transparent_image/transparent_image.dart';<br/><br/>class AlbumPage extends StatefulWidget {<br/>  final String title;<br/><br/>  const AlbumPage({Key key, this.title = "Album"}) : super(key: key);<br/><br/>  @override<br/>  _AlbumPageState createState() =&gt; _AlbumPageState();<br/>}<br/><br/>class _AlbumPageState extends ModularState&lt;AlbumPage, AlbumController&gt; {<br/><br/>  final GlobalKey&lt;RefreshIndicatorState&gt; _refreshIndicatorKey = new GlobalKey&lt;RefreshIndicatorState&gt;();<br/>  final GlobalKey&lt;FormBuilderState&gt; _searchFormBuilderKey = new GlobalKey&lt;FormBuilderState&gt;();<br/><br/>  @override<br/>  void initState() {<br/>    super.initState();<br/><br/>    controller.fetchAlbums(AlbumModel());<br/>  }<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>      floatingActionButton: FloatingActionButton(<br/>        child: Icon(Icons.<em class="lv">add</em>),<br/>        onPressed: () async {<br/>          await Modular.<em class="lv">to</em>.pushNamed('/form');<br/>          controller.fetchAlbums(AlbumModel());<br/>        },<br/>      ),<br/>      body: SafeArea(<br/>        child: Column(<br/>          children: &lt;Widget&gt;[<br/>            Container(<br/>              padding: const EdgeInsets.all(16),<br/>              child: Column(<br/>                children: &lt;Widget&gt;[<br/>                  Text('Albums', style: TextStyle(fontWeight: FontWeight.<em class="lv">bold</em>, fontSize: 26),),<br/>                  SizedBox(height: 12,),<br/>                  FormBuilder(<br/>                    onChanged: (_) {<br/>                      controller.fetchAlbums(AlbumModel.fromJson(_searchFormBuilderKey.currentState.value));<br/>                    },<br/>                    key: _searchFormBuilderKey,<br/>                    initialValue: {<br/>                      'title': null<br/>                    },<br/>                    child: Column(<br/>                      children: &lt;Widget&gt;[<br/>                        FormBuilderTextField(<br/>                          attribute: 'title',<br/>                          maxLines: 1,<br/>                          decoration: InputDecoration(<br/>                            labelText: 'Search',<br/>                            border: OutlineInputBorder(<br/>                              borderRadius: BorderRadius.circular(40)<br/>                            )<br/>                          ),<br/>                        )<br/>                      ],<br/>                    ),<br/>                  )<br/>                ],<br/>              ),<br/>            ),<br/>            Expanded(<br/>              child: Padding(<br/>                padding: const EdgeInsets.all(16),<br/>                child: Observer(builder: (_) {<br/>                  if (controller.albumState == AlbumState.LOADING) {<br/>                    return Center(<br/>                      child: CircularProgressIndicator(),<br/>                    );<br/>                  } else if (controller.albumState == AlbumState.IDLE) {<br/>                    return RefreshIndicator(<br/>                      key: _refreshIndicatorKey,<br/>                      onRefresh: () async {<br/>                        _searchFormBuilderKey.currentState.reset();<br/>                        await controller.fetchAlbums(AlbumModel());<br/>                      },<br/>                      child: ListView.builder(<br/>                          itemCount: controller.albums.length, itemBuilder: (_, i) =&gt; _buildAlbumTile(controller.albums[i])),<br/>                    );<br/>                  } else {<br/>                    return Container();<br/>                  }<br/>                }),<br/>              ),<br/>            ),<br/>          ],<br/>        ),<br/>      ),<br/>    );<br/>  }<br/><br/>  Widget _buildAlbumTile(AlbumModel albumModel) {<br/>    return GestureDetector(<br/>      onTap: () {<br/>        Modular.<em class="lv">to</em>.pushNamed('/form', arguments: albumModel);<br/>      },<br/>      child: Card(<br/>        margin: EdgeInsets.only(bottom: 12),<br/>        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(40)),<br/>        child: Padding(<br/>          padding: const EdgeInsets.all(22.0),<br/>          child: Column(<br/>            children: &lt;Widget&gt;[<br/>              Text(<br/>                albumModel.title,<br/>                style: TextStyle(fontSize: 22, fontWeight: FontWeight.<em class="lv">bold</em>),<br/>              ),<br/>              SizedBox(<br/>                height: 12,<br/>              ),<br/>              Container(<br/>                height: 120,<br/>                child: ClipRRect(<br/>                  borderRadius: BorderRadius.circular(40),<br/>                  child: ListView.builder(<br/>                    scrollDirection: Axis.horizontal,<br/>                    itemCount: albumModel.images.length,<br/>                    itemBuilder: (_, i) =&gt; _buildImage(albumModel.images[i]),<br/>                  ),<br/>                ),<br/>              )<br/>            ],<br/>          ),<br/>        ),<br/>      ),<br/>    );<br/>  }<br/><br/>  Widget _buildImage(AmazonImageModel amazonImageModel) {<br/>    return ClipRRect(<br/>      child: FadeInImage.memoryNetwork(<br/>        placeholder: kTransparentImage,<br/>        image: amazonImageModel.imageUrl,<br/>        fit: BoxFit.cover,<br/>        width: 120,<br/>        height: 120,<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="d9f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简单的美妆页面！</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es me"><img src="../Images/209eca133e1a0f4efca74cdf1476fcfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*ym8CyTChK_EXXFtKQSXTTQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">AlgumPage小部件。</figcaption></figure><p id="131c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们创建AlbumFormController。</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="e96e" class="ju jv hi lk b fi lo lp l lq lr">import 'dart:io';<br/><br/>import 'package:flutter_modular/flutter_modular.dart';<br/>import 'package:mobx/mobx.dart';<br/>import 'package:photos_app/app/modules/shared/models/album/album_model.dart';<br/>import 'package:photos_app/app/modules/shared/repository/album_repository.dart';<br/><br/>part 'album_form_controller.g.dart';<br/><br/>class AlbumFormController = _AlbumFormBase with _$AlbumFormController;<br/><br/>abstract class _AlbumFormBase with Store {<br/><br/>  // Get Repository Instance<br/>  AlbumRepository _albumRepository = Modular.<em class="lv">get</em>();<br/><br/>  // Simple logic to check if is editing or is insert new Album.<br/>  AlbumModel savedAlbum;<br/>  setSavedAlbum(AlbumModel albumModel) =&gt; savedAlbum = albumModel;<br/><br/>  // State Management<br/>  @observable<br/>  AlbumFormState albumFormState = AlbumFormState.IDLE;<br/><br/>  // Save Album<br/>  @action<br/>  saveAlbum(Map&lt;String, dynamic&gt; form) async {<br/>    // Set state to Loading to disable form and save button.<br/>    albumFormState = AlbumFormState.LOADING;<br/><br/>    // Capture typed fields from form.<br/>    List images = form['images'] as List;<br/>    String title = form['title'] as String;<br/><br/>    // Get images to send to Amazon.<br/>    List&lt;File&gt; imageNotSaved = images.where((image) =&gt; image is File).whereType&lt;File&gt;().toList();<br/>    if (savedAlbum == null) {<br/><br/>      // New Album<br/>      AlbumModel albumModel = AlbumModel(<br/>        // First, upload images to Amazon.<br/>        images: await _albumRepository.uploadImages(imageNotSaved),<br/>        title: title<br/>      );<br/><br/>      // Save Album<br/>      await _albumRepository.insertAlbum(albumModel);<br/>      Modular.<em class="lv">to</em>.pop();<br/>      albumFormState = AlbumFormState.IDLE;<br/>    } else {<br/>      // <em class="lv">TODO: Update Album Here<br/>    </em>}<br/>    albumFormState = AlbumFormState.IDLE;<br/>  }<br/><br/>}<br/><br/>enum AlbumFormState { IDLE, LOADING }</span></pre><p id="1ede" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太棒了，现在，我们需要为图像创建一个CustomFormBuilderField。</p><p id="c4bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建一个名为ImageSourceSheet的小部件，如下所示:</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="479d" class="ju jv hi lk b fi lo lp l lq lr">import 'dart:io';<br/><br/>import 'package:flutter/material.dart';<br/>import 'package:image_picker/image_picker.dart';<br/><br/>class ImageSourceSheet extends StatelessWidget {<br/><br/>  final Function(File) onImageSelected;<br/><br/>  ImageSourceSheet({ @required this.onImageSelected });<br/><br/>  void imageSelected(File image) async {<br/>    if (image != null) {<br/>      onImageSelected(image);<br/>    }<br/>  }<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Container(<br/>      child: Wrap(<br/>        children: &lt;Widget&gt;[<br/>          ListTile(<br/>            leading: Icon(Icons.<em class="lv">camera_enhance</em>),<br/>            title: Text('Camera'),<br/>            onTap: () async {<br/>              File image = await ImagePicker.<em class="lv">pickImage</em>(source: ImageSource.camera);<br/>              imageSelected(image);<br/>            },<br/>          ),<br/>          ListTile(<br/>            leading: Icon(Icons.<em class="lv">image</em>),<br/>            title: Text('Gallery'),<br/>            onTap: () async {<br/>              File image = await ImagePicker.<em class="lv">pickImage</em>(source: ImageSource.gallery);<br/>              imageSelected(image);<br/>            },<br/>          )<br/>        ],<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="1392" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有了这个小部件，我们就有了这个很酷的“图像拾取器”:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mf"><img src="../Images/45a854cfe9c76d16b12897fc5c2525fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*h9Fy0DVH8_Xlsfov_apIcw.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">ImageSourceSheet小工具。</figcaption></figure><p id="b96b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，创建一个FormBuilderImageField，如下所示:</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="286e" class="ju jv hi lk b fi lo lp l lq lr">import 'package:flutter/material.dart';<br/>import 'package:flutter_form_builder/flutter_form_builder.dart';<br/>import 'package:photos_app/app/modules/album/album_form/image_source_sheet.dart';<br/><br/>class FormBuilderImageField extends StatefulWidget {<br/>  final String attribute;<br/>  final List&lt;FormFieldValidator&gt; validators;<br/>  final List initialValue;<br/>  final bool readOnly;<br/>  final String labelText;<br/>  final ValueTransformer valueTransformer;<br/>  final ValueChanged onChanged;<br/><br/>  final double imageWidth;<br/>  final double imageHeight;<br/>  final EdgeInsets imageMargin;<br/>  final FormFieldSetter onSaved;<br/><br/>  const FormBuilderImageField({<br/>    Key key,<br/>    @required this.attribute,<br/>    this.initialValue,<br/>    this.validators = const [],<br/>    this.valueTransformer,<br/>    this.labelText,<br/>    this.onChanged,<br/>    this.imageWidth = 130,<br/>    this.imageHeight = 130,<br/>    this.imageMargin,<br/>    this.readOnly = false,<br/>    this.onSaved<br/>  }) : super(key: key);<br/><br/>  @override<br/>  _FormBuilderImageFieldState createState() =&gt; _FormBuilderImageFieldState();<br/>}<br/><br/>class _FormBuilderImageFieldState extends State&lt;FormBuilderImageField&gt; {<br/>  bool _readOnly = false;<br/>  List _initialValue;<br/>  final GlobalKey&lt;FormFieldState&gt; _fieldKey = GlobalKey&lt;FormFieldState&gt;();<br/>  FormBuilderState _formState;<br/><br/>  @override<br/>  void initState() {<br/>    _formState = FormBuilder.<em class="lv">of</em>(context);<br/>    _formState?.registerFieldKey(widget.attribute, _fieldKey);<br/>    _initialValue = List.of(widget.initialValue ??<br/>        (_formState.initialValue.containsKey(widget.attribute)<br/>            ? _formState.initialValue[widget.attribute]<br/>            : []));<br/>    super.initState();<br/>  }<br/><br/>  @override<br/>  void dispose() {<br/>    _formState?.unregisterFieldKey(widget.attribute);<br/>    super.dispose();<br/>  }<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    _readOnly = (_formState?.readOnly == true) ? true : widget.readOnly;<br/><br/>    return FormField&lt;List&gt;(<br/>      key: _fieldKey,<br/>      enabled: !_readOnly,<br/>      initialValue: _initialValue,<br/>      validator: (val) {<br/>        for (int i = 0; i &lt; widget.validators.length; i++) {<br/>          if (widget.validators[i](val) != null)<br/>            return widget.validators[i](val);<br/>        }<br/>        return null;<br/>      },<br/>      onSaved: (val) {<br/>        var transformed;<br/>        if (widget.valueTransformer != null) {<br/>          transformed = widget.valueTransformer(val);<br/>          _formState?.setAttributeValue(widget.attribute, transformed);<br/>        } else<br/>          _formState?.setAttributeValue(widget.attribute, val);<br/>        if (widget.onSaved != null) {<br/>          widget.onSaved(transformed ?? val);<br/>        }<br/>      },<br/>      builder: (state) =&gt; Column(<br/>        crossAxisAlignment: CrossAxisAlignment.start,<br/>        children: &lt;Widget&gt;[<br/>          Text(<br/>            widget.labelText != null ? widget.labelText : 'Images',<br/>            style: TextStyle(<br/>              color: Theme.<em class="lv">of</em>(context).primaryColor<br/>            ),<br/>          ),<br/>          SizedBox(<br/>            height: 8,<br/>          ),<br/>          Container(<br/>            height: widget.imageHeight,<br/>            child: ListView(<br/>              scrollDirection: Axis.horizontal,<br/>              children: state.value.map&lt;Widget&gt;((item) {<br/>                return Container(<br/>                  width: widget.imageWidth,<br/>                  height: widget.imageHeight,<br/>                  margin: widget.imageMargin,<br/>                  child: GestureDetector(<br/>                    child: item is String ?<br/>                      Image.network(item, fit: BoxFit.cover) :<br/>                      Image.file(item, fit: BoxFit.cover),<br/>                    onLongPress: () {<br/>                      state.didChange(state.value..remove(item));<br/>                    },<br/>                  ),<br/>                );<br/>              }).toList()<br/>                ..add(<br/>                  GestureDetector(<br/>                    child: Container(<br/>                      width: widget.imageWidth,<br/>                      height: widget.imageHeight,<br/>                      child: Icon(<br/>                        Icons.<em class="lv">camera_enhance</em>,<br/>                        color: Theme.<em class="lv">of</em>(context).primaryColor,<br/>                      ),<br/>                      color: Theme.<em class="lv">of</em>(context).primaryColor.withAlpha(50),<br/>                    ),<br/>                    onTap: () {<br/>                      showModalBottomSheet(context: context, builder: (_) {<br/>                        return ImageSourceSheet(<br/>                          onImageSelected: (image) {<br/>                            state.didChange(state.value..add(image));<br/>                            Navigator.<em class="lv">of</em>(context).pop();<br/>                          },<br/>                        );<br/>                      });<br/>                    },<br/>                  )<br/>                )<br/>            ),<br/>          ),<br/>          state.hasError<br/>              ? Text(<br/>            state.errorText,<br/>            style: TextStyle(color: Colors.<em class="lv">red</em>, fontSize: 12),<br/>          ) : Container()<br/>        ],<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="88d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很好，就是这个组件:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mg"><img src="../Images/0abb01da48df49839bff97e015585485.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*rIByzmsOnbbp7lC3CoSoQg.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">FormBuilderImageField小部件。</figcaption></figure><p id="53e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，像这样创建您的相册表单页面:</p><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="cfa8" class="ju jv hi lk b fi lo lp l lq lr">import 'package:flutter/material.dart';<br/>import 'package:flutter_form_builder/flutter_form_builder.dart';<br/>import 'package:flutter_mobx/flutter_mobx.dart';<br/>import 'package:flutter_modular/flutter_modular.dart';<br/>import 'package:photos_app/app/modules/album/album_form/album_form_controller.dart';<br/>import 'package:photos_app/app/modules/album/album_form/form_builder_image_field.dart';<br/>import 'package:photos_app/app/modules/shared/models/album/album_model.dart';<br/><br/>class AlbumFormPage extends StatefulWidget {<br/>  final AlbumModel savedAlbum;<br/><br/>  const AlbumFormPage({Key key, this.savedAlbum}) : super(key: key);<br/><br/>  @override<br/>  _AlbumFormPageState createState() =&gt; _AlbumFormPageState();<br/>}<br/><br/>class _AlbumFormPageState extends ModularState&lt;AlbumFormPage, AlbumFormController&gt; {<br/>  AlbumModel _value;<br/>  Map&lt;String, dynamic&gt; _initialValue;<br/><br/>  final GlobalKey&lt;FormBuilderState&gt; _albumFormBuilderKey = new GlobalKey&lt;FormBuilderState&gt;();<br/><br/>  @override<br/>  void initState() {<br/>    _value = widget.savedAlbum;<br/>    controller.setSavedAlbum(_value);<br/><br/>    if (_value != null) {<br/>      _initialValue = {<br/>        'albumId': _value.albumId,<br/>        'images': _value.images.map&lt;String&gt;((image) =&gt; image.imageUrl).toList(),<br/>        'title': _value.title<br/>      };<br/>    } else {<br/>      _initialValue = {<br/>        'albumId': null,<br/>        'title': null,<br/>        'images': []<br/>      };<br/>    }<br/><br/>    super.initState();<br/>  }<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>      body: SafeArea(<br/>        child: Column(<br/>          children: &lt;Widget&gt;[<br/>            Row(<br/>              children: &lt;Widget&gt;[<br/>                IconButton(<br/>                  icon: Icon(Icons.<em class="lv">arrow_back</em>),<br/>                  onPressed: () {<br/>                    Modular.<em class="lv">to</em>.pop();<br/>                  },<br/>                ),<br/>                Padding(<br/>                  padding: const EdgeInsets.only(left: 26),<br/>                  child: Text(<br/>                    'New Album',<br/>                    style: TextStyle(fontWeight: FontWeight.<em class="lv">bold</em>, fontSize: 26),<br/>                  ),<br/>                ),<br/>                Expanded(<br/>                  child: Padding(<br/>                    padding: const EdgeInsets.only(right: 8.0),<br/>                    child: Observer(<br/>                      builder: (_) =&gt; Align(<br/>                        alignment: Alignment.<em class="lv">centerRight</em>,<br/>                        child: IconButton(<br/>                          icon: Icon(Icons.<em class="lv">save</em>),<br/>                          onPressed: controller.albumFormState == AlbumFormState.LOADING ? null : () {<br/>                            if (_albumFormBuilderKey.currentState.saveAndValidate()) {<br/>                              controller.saveAlbum(_albumFormBuilderKey.currentState.value);<br/>                            }<br/>                          },<br/>                        ),<br/>                      ),<br/>                    ),<br/>                  ),<br/>                )<br/>              ],<br/>            ),<br/>            Expanded(<br/>              child: ListView(<br/>                padding: const EdgeInsets.all(16),<br/>                children: &lt;Widget&gt;[<br/>                  Observer(<br/>                    builder: (_) =&gt; FormBuilder(<br/>                      readOnly: controller.albumFormState == AlbumFormState.LOADING,<br/>                      key: _albumFormBuilderKey,<br/>                      initialValue: _initialValue,<br/>                      child: Column(<br/>                        children: &lt;Widget&gt;[<br/>                          FormBuilderImageField(<br/>                            attribute: 'images',<br/>                            validators: [<br/>                              (images) {<br/>                                if (images is List) {<br/>                                  if (images.isEmpty) {<br/>                                    return 'Images are required.';<br/>                                  }<br/>                                }<br/>                                return null;<br/>                              }<br/>                            ],<br/>                          ),<br/>                          SizedBox(<br/>                            height: 20,<br/>                          ),<br/>                          FormBuilderTextField(<br/>                            maxLines: 1,<br/>                            attribute: 'title',<br/>                            decoration: InputDecoration(<br/>                                labelText: 'Title',<br/>                                border: OutlineInputBorder(<br/>                                    borderRadius: BorderRadius.circular(40)<br/>                                )<br/>                            ),<br/>                            validators: [<br/>                              FormBuilderValidators.<em class="lv">required</em>(),<br/>                              FormBuilderValidators.<em class="lv">maxLength</em>(64)<br/>                            ],<br/>                          ),<br/>                        ],<br/>                      ),<br/>                    ),<br/>                  )<br/>                ],<br/>              ),<br/>            )<br/>          ],<br/>        ),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="b9e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我写了控制器来解释这个屏幕的状态管理，但是很简单。</p><p id="0651" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我现在的项目模式:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mh"><img src="../Images/fb65db5927fd50af029d9583b695d7e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E_yS3d30G-ngtECC3NomHQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">项目模式。</figcaption></figure><p id="6d51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">酷！<br/>申请完成。</p><p id="d74b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是我有一个挑战给你。我没有在这个项目中实现用户更新你的相册的可能性，这是你的挑战。</p><p id="475b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你需要更换控制器，因为我做了一个错误的编辑行为。</p><p id="60ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">该项目的链接:</strong><a class="ae jd" href="https://github.com/gustavovitor/photo_app" rel="noopener ugc nofollow" target="_blank">https://github.com/gustavovitor/photo_app</a></p><p id="b53e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您对此有任何疑问，请在我的<a class="ae jd" href="https://www.linkedin.com/in/gustavo-m-369a3011b/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上发表评论或发送私信。</p><p id="8023" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您发起挑战，请在GitHub上发送:)</p></div></div>    
</body>
</html>