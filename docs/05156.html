<html>
<head>
<title>Time series analysis (ARIMA model) for the PM10 (air pollution) variable in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">中国PM10(空气污染)变量的时间序列分析(ARIMA模型)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/time-series-analysis-arima-model-for-the-pm10-air-pollution-variable-in-r-822f3a6291d2?source=collection_archive---------27-----------------------#2020-04-12">https://medium.com/analytics-vidhya/time-series-analysis-arima-model-for-the-pm10-air-pollution-variable-in-r-822f3a6291d2?source=collection_archive---------27-----------------------#2020-04-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="780f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">PM10是一种存在于大气污染中的可吸入微粒。它可以穿透我们的呼吸器官和血液流动，导致严重的疾病。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/506fcb8cb50008e96540994b5713cddd.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*c_66hSpPfYS2kpBoKTf22g.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">公共领域[<a class="ae jp" href="https://en.wikipedia.org/wiki/Time_series" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Time_series</a></figcaption></figure><p id="5a66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这项研究中，我们将对这个粒子进行时间序列分析。该数据集具有PM10 1997年全年的集中度。我真的不知道用于构建数据集的比例，也不知道收集数据的城市/位置。我刚刚找到了一个. xls文件，里面有我在大学时的数字，我决定与社区分享这些知识。</p><p id="6dd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个故事的数据和代码可以在:【https://github.com/nascimento1195/time-series-analysis-PM10<a class="ae jp" href="https://github.com/nascimento1195/time-series-analysis-PM10" rel="noopener ugc nofollow" target="_blank">找到。</a></p><p id="9c4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用以下步骤进行分析:</p><p id="f55d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1 —检查平稳性的级数性质；</p><p id="115d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2 —决定我们是使用加法模型还是乘法模型；</p><p id="38f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3 —调整模型；</p><p id="3a0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4-检查残差属性。</p><p id="7c14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一步是读取数据，为第一次可视化绘制数据，然后将其转换为时间序列对象。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="1870" class="jv jw hi jr b fi jx jy l jz ka"># Reading data<br/>library(readxl)<br/>dados&lt;-read_excel("basepoluicao.xls")<br/>attach(dados)</span><span id="d727" class="jv jw hi jr b fi kb jy l jz ka"># Plotting data<br/>library(ggplot2)<br/>theme_set=(theme_minimal())</span><span id="ccbb" class="jv jw hi jr b fi kb jy l jz ka">ggplot(data = dados, aes(x = DATA, y = PM10))+<br/>  geom_line(color = "#00AFBB", size = 1)</span><span id="5e01" class="jv jw hi jr b fi kb jy l jz ka"># Transforming data into a time series object<br/>POL&lt;-ts(PM10)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kc"><img src="../Images/c65c43bd15ebafee205c6c7d97bf2f4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*tUV9ncULRBkbq5I4D_9cEA.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">图1:系列的初始情节。</figcaption></figure><p id="5e62" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了用ARIMA(p，d，q)对序列建模，我们需要检查平稳性。这可以通过绘制自相关和部分自相关值或使用适当的统计测试来完成。我更喜欢用测试。通常，我会执行两次或更多次，以确定这个超级重要的特性。</p><p id="8e91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我将向你展示两个测试，扩大迪基-富勒测试和KPSS测试。在第一种假设中，替代假设代表序列的平稳性，而在另一种假设中，零假设是我们不想拒绝的假设。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="2e23" class="jv jw hi jr b fi jx jy l jz ka"># Augmented Dickey-Fuller Test for stationarity<br/>library(tseries)<br/>adf.test(POL)</span><span id="46d9" class="jv jw hi jr b fi kb jy l jz ka"># KPSS Test for stationarity<br/>kpss.test(POL)</span></pre><p id="9e3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">执行这两种测试后，扩展的Dickey-Fuller测试指向一个显著性水平为5%的平稳序列(p值&lt; 0.05), while the KPSS disagreeded with that decision (p-value &lt; 0.05)*.</p><p id="fa52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">*Remember the hypotheses are inverted from one test to another.</p><p id="fad9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">When I come across divergence between the tests, I prefer to apply the first difference of the series in order to get the stationarity factor confirmed. To do that, we reapply the tests in the differentiated series.</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="4e0d" class="jv jw hi jr b fi jx jy l jz ka">first_difference&lt;-diff(POL)</span><span id="34ef" class="jv jw hi jr b fi kb jy l jz ka">adf.test(first_difference)<br/>kpss.test(first_difference)</span></pre><p id="8fdf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Checking the results, it is possible to observe that now both point to a stationary series (this time the null hypothesis is not rejected for the KPSS Test).</p><p id="cd59" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">The next step is to decide if our series has a multiplicative or additive characteristic. One way to do this is grouping the series into minor groups of <br/>任何大小(此处的数字一般不会产生太大影响，我们将使用2个一组的方法)，计算该小组内的平均值和标准差，然后绘制计算平均值与计算标准差的图形。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="90eb" class="jv jw hi jr b fi jx jy l jz ka"># Calculating mean<br/>mean_vector&lt;-vector()<br/>j&lt;-1<br/>vet&lt;-POL<br/>for(i in 1:(length(first_difference)/2)){<br/>  mean_vector[i]&lt;-(vet[j]+vet[j+1])/2<br/>  j&lt;-j+2<br/>}</span><span id="5ecc" class="jv jw hi jr b fi kb jy l jz ka"># Calculating standard deviation<br/>std_deviation_vector &lt;- vector()<br/>z&lt;-1<br/>for(i in 1:(length(first_difference)/2)){<br/>  std_deviation_vector[i]&lt;-sd(c(vet[z],vet[z+1]))<br/>  z&lt;-z+2<br/>}</span><span id="72c1" class="jv jw hi jr b fi kb jy l jz ka">plot(mean_vector, std_deviation_vector)<br/>cor(mean_vector, std_deviation_vector)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kc"><img src="../Images/a039bb941135ffc7e42139ee1013b2e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*na1T0kdFcH9DP7YHLmhCiQ.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">图2:色散图。</figcaption></figure><p id="7772" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这两个向量之间的相关性约为0.3388。由于在生成的两个向量之间似乎没有很强的相关系数，我们可以调整ARIMA加法模型。如果此处的系数或图形表明了强相关性，我们将有证据表明该系列中存在乘法因子，并且有必要应用一些变换来去除该因子(对数函数使用效果良好)，以便我们可以调整ARIMA模型。</p><p id="6e06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们似乎准备调整我们的模型。对于如何调整ARIMA模型的参数，没有明确的规则。有一些技巧，如绘制自相关函数和偏相关函数。我更喜欢测试一些参数组合，并选择一个对它们都有意义的组合。如果有一个以上的系列满足这个条件，那么我们可以采用更简单的一个(较少的参数)或具有较小AIC的一个(较低的AIC值表示更好的拟合)。</p><p id="a809" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于我们将模拟系列的第一个差异，我们的中间参数‘d’(ARIMA(p，d，q))必须是1。这样，我们将只从0到2改变“p”和“q”。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="417d" class="jv jw hi jr b fi jx jy l jz ka"># ARIMA(0,1,1) <br/>model1&lt;-arima(POL, order = c(0,1,1)) <br/>t1&lt;-0.1645/0.0776<br/>dt(t1, length(POL)) <br/># Model is a candidate, since all parametes are significative (5% significance).</span><span id="14e7" class="jv jw hi jr b fi kb jy l jz ka"># ARIMA(0,1,2) <br/>model2&lt;-arima(POL, order = c(0,1,2))<br/>t1&lt;--0.2161/0.0588<br/>t2&lt;--0.5556/0.0615<br/>dt(t1, length(POL)) <br/>dt(t2, length(POL)) <br/># Model is a candidate, since all parametes are significative (5% significance).</span><span id="2df9" class="jv jw hi jr b fi kb jy l jz ka"># ARIMA(1,1,0) <br/>model3&lt;-arima(POL, order = c(1,1,0)) <br/>t1&lt;-0.0562/0.0523<br/>dt(t1, length(POL))<br/># Model is not a candidate, since at least one of the parametes are not <br/># significative (5% significance).</span><span id="9cc3" class="jv jw hi jr b fi kb jy l jz ka"># ARIMA(1,1,1) <br/>model4&lt;-arima(POL, order = c(1,1,1)) <br/>t1&lt;--0.4332/0.1264<br/>t2&lt;-0.6101/0.1062<br/>dt(t1, length(POL))<br/>dt(t2, length(POL)) <br/># Model is a candidate, since all parametes are significative (5% significance).</span><span id="8334" class="jv jw hi jr b fi kb jy l jz ka"># ARIMA(1,1,2) <br/>model5&lt;-arima(POL, order = c(1,1,2)) <br/>t1&lt;-0.4113/0.0692<br/>t2&lt;--0.4975/0.064<br/>t3&lt;--0.4334/0.0554<br/>dt(t1, length(POL))<br/>dt(t2, length(POL)) <br/>dt(t3, length(POL)) <br/># Model is a candidate, since all parametes are significative (5% significance).</span><span id="06fa" class="jv jw hi jr b fi kb jy l jz ka"># ARIMA(2,1,0)<br/>model6&lt;-arima(POL, order = c(2,1,0)) <br/>t1&lt;-0.0781/0.0486<br/>t2&lt;--0.3746/0.0485<br/>dt(t1, length(POL))<br/>dt(t2, length(POL))<br/># Model is not a candidate, since at least one of the parametes are not <br/># significative (5% significance).</span><span id="4a11" class="jv jw hi jr b fi kb jy l jz ka"># ARIMA(2,1,1)<br/>model7&lt;-arima(POL, order = c(2,1,1)) <br/>t1&lt;-0.8161/0.0528<br/>t2&lt;--0.2878/0.0516<br/>t3&lt;--0.94/0.0226<br/>dt(t1, length(POL))<br/>dt(t2, length(POL)) <br/>dt(t3, length(POL)) <br/># Model is a candidate, since all parametes are significative (5% significance).</span><span id="60a2" class="jv jw hi jr b fi kb jy l jz ka"># ARIMA(2,1,2)<br/>model8&lt;-arima(POL, order = c(2,1,2)) <br/>t1&lt;-0.4864/0.124<br/>t2&lt;--0.0743/0.0999<br/>t3&lt;--0.5645/0.1156<br/>t4&lt;--0.3643/0.1126<br/>dt(t1, length(POL))<br/>dt(t2, length(POL)) <br/>dt(t3, length(POL)) <br/>dt(t4, length(POL)) <br/># Model is not a candidate, since at least one of the parametes are not <br/># significative (5% significance).</span></pre><p id="791e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">无论何时运行命令来模拟系列(例如:model1</p><p id="c543" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里满足这个条件的模型是“模型1”、“模型2”、“模型4”、“模型5”、“模型7”。我们将对“模型5”进行残差分析，因为它是AIC值最小的模型。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kd"><img src="../Images/f095600ba00905d68e459416765a0798.png" data-original-src="https://miro.medium.com/v2/resize:fit:396/format:webp/1*BI83n8S_qBpzPuMpTnLYTg.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">图3: AIC价值观。</figcaption></figure><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="7a19" class="jv jw hi jr b fi jx jy l jz ka"># Let's check for normality and independency of the residuals.<br/>hist(model5$residuals)<br/>Box.test(model5$residuals, type=c("Box-Pierce"))</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kc"><img src="../Images/f9f51f544228632b298b67572a78223c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*vw_wHvzM6923n0CP-PmkWQ.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">图4:残差直方图。</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ke"><img src="../Images/d384a7f070ed9b8c27df2287e0af3cd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*iOEB1bdhfsftaS-PWQ2AoA.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">图5:残差独立性的盒-皮尔斯检验。</figcaption></figure><p id="861a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以观察到残差的直方图在0附近呈正态分布，Box-Pierce检验没有拒绝残差独立性的零假设。最后，我们实现了满足可信预测模型所需的主要统计特性的最终模型。</p></div></div>    
</body>
</html>