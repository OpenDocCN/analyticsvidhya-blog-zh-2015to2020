<html>
<head>
<title>How to create a Hadoop Cluster for free in AWS Cloud?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 AWS 云中免费创建一个 Hadoop 集群？</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-create-a-hadoop-cluster-for-free-in-aws-cloud-a95154980b11?source=collection_archive---------4-----------------------#2020-07-29">https://medium.com/analytics-vidhya/how-to-create-a-hadoop-cluster-for-free-in-aws-cloud-a95154980b11?source=collection_archive---------4-----------------------#2020-07-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="144f" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">可以在 AWS 免费练习 Hadoop，Spark，Hive。</h2></div><p id="2f35" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Hadoop 是一个在分布式环境中处理大数据的框架。<strong class="iz hj"> <em class="jt"> Hadoop 集群</em> </strong>是一组节点(比如虚拟机或容器)——一个主节点和剩余的工作节点——在它们之间分发数据并并行处理它们。</p><h1 id="8b29" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">为什么要在 AWS 中创建集群？为什么不在您的本地机器上？</h1><p id="8b91" class="pw-post-body-paragraph ix iy hi iz b ja km ij jc jd kn im jf jg ko ji jj jk kp jm jn jo kq jq jr js hb bi translated">所有大数据框架和工具，如<strong class="iz hj"> <em class="jt"> Hadoop、Spark 和 Hive </em> </strong>都需要集群来运行。像脸书这样的大数据企业公司将在其集群中拥有数千个节点，因为要处理的数据量非常庞大。但是像你我这样的个体无法承受这么多的节点。事实上，我们仅限于本地机器。</p><p id="1c73" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了学习和实践大数据工具，我们可以创建一个<strong class="iz hj"> <em class="jt">独立</em> </strong>集群(一个只有一个节点的集群，该节点同时充当主节点和工作节点)并在其上运行程序。但是，根据您正在处理的数据的大小，您的本地机器可能会变得相当慢。</p><p id="497b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，在本文中，我将介绍如何减轻本地机器的负担，并利用<strong class="iz hj"> <em class="jt"> AWS 自由层 EC2 实例</em> </strong> <strong class="iz hj"> <em class="jt">来创建一个 3 节点 Hadoop 集群</em> </strong>。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es kr"><img src="../Images/f9f6e84c9a03b914dd7ef1b0f3d85a09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*ltFO-r-03Ie5E1tsDCO_dQ.jpeg"/></div></figure><h1 id="f587" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">步骤 1:创建三个 AWS EC2 实例</h1><ul class=""><li id="b9df" class="kz la hi iz b ja km jd kn jg lb jk lc jo ld js le lf lg lh bi translated">创建 3 个 Amazon EC2 Ubuntu 实例。你可以在这里试用亚马逊免费等级<br/> <a class="ae li" href="https://aws.amazon.com/free/" rel="noopener ugc nofollow" target="_blank">一年。</a></li><li id="eea4" class="kz la hi iz b ja lj jd lk jg ll jk lm jo ln js le lf lg lh bi translated">当您在第 6 步创建实例时，确保您添加了一个类型为<strong class="iz hj"> <em class="jt">的规则:所有流量，来源:任何地方。</em> </strong>如果不这样做，您将无法在 web 界面中检查集群的状态。</li><li id="1f1e" class="kz la hi iz b ja lj jd lk jg ll jk lm jo ln js le lf lg lh bi translated">使用所需的安全组设置创建实例后，确保您可以访问机器。</li><li id="8d01" class="kz la hi iz b ja lj jd lk jg ll jk lm jo ln js le lf lg lh bi translated">如果使用 Linux 系统，使用<em class="jt">ssh–I PEM _ file path Ubuntu @ public _ IP</em>登录 EC2 实例。</li><li id="0cab" class="kz la hi iz b ja lj jd lk jg ll jk lm jo ln js le lf lg lh bi translated">如果您使用的是 Windows 系统，请按照此处的说明<a class="ae li" href="https://dzone.com/articles/how-set-multi-node-hadoop" rel="noopener ugc nofollow" target="_blank">使用 putty 访问 EC2。</a></li></ul><h1 id="afd3" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">步骤 2: Java 安装</h1><ul class=""><li id="9f17" class="kz la hi iz b ja km jd kn jg lb jk lc jo ld js le lf lg lh bi translated">使用以下命令安装 Java 并验证安装。</li></ul><pre class="ks kt ku kv fd lo lp lq lr aw ls bi"><span id="784c" class="lt jv hi lp b fi lu lv l lw lx">$ sudo apt update<br/>$ sudo apt-get install default-jre<br/>$ java -version</span></pre><ul class=""><li id="c12f" class="kz la hi iz b ja jb jd je jg ly jk lz jo ma js le lf lg lh bi translated">设置 JAVA_HOME 环境变量。如果需要详细步骤，请参考<a class="ae li" href="https://askubuntu.com/questions/175514/how-to-set-java-home-for-java" rel="noopener ugc nofollow" target="_blank">此</a>链接。使用“echo $JAVA_HOME”命令验证设置。</li></ul><h1 id="3b3e" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">步骤 3:设置无密码 SSH 登录</h1><p id="eabb" class="pw-post-body-paragraph ix iy hi iz b ja km ij jc jd kn im jf jg ko ji jj jk kp jm jn jo kq jq jr js hb bi translated">让我们为这 3 个节点命名，以避免混淆。</p><blockquote class="mb mc md"><p id="add5" class="ix iy jt iz b ja jb ij jc jd je im jf me jh ji jj mf jl jm jn mg jp jq jr js hb bi translated">节点 1:工人 1 <br/>节点 2:工人 2 <br/>节点 3:主机</p></blockquote><ul class=""><li id="93aa" class="kz la hi iz b ja jb jd je jg ly jk lz jo ma js le lf lg lh bi translated">通过在两个节点上执行以下命令，生成公钥和私钥(在 Master 和 Worker1 上)。</li></ul><pre class="ks kt ku kv fd lo lp lq lr aw ls bi"><span id="6354" class="lt jv hi lp b fi lu lv l lw lx">ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa</span></pre><ul class=""><li id="34d7" class="kz la hi iz b ja jb jd je jg ly jk lz jo ma js le lf lg lh bi translated">将 Worker1 的文件<strong class="iz hj"> <em class="jt"> id_rsa.pub </em> </strong>的内容追加到 Master 中的文件<strong class="iz hj"> authorized_keys </strong>中。</li><li id="0789" class="kz la hi iz b ja lj jd lk jg ll jk lm jo ln js le lf lg lh bi translated">然后，将 Master 的文件<strong class="iz hj"> <em class="jt"> id_rsa.pub </em> </strong>的内容追加到 Worker1 中的文件<strong class="iz hj"> authorized_keys </strong>中。</li><li id="b5a7" class="kz la hi iz b ja lj jd lk jg ll jk lm jo ln js le lf lg lh bi translated">在 Worker1 上，测试您可以使用 Master 实例的私有和公共 ip 登录 Master 和 Worker1，而无需密码。</li></ul><pre class="ks kt ku kv fd lo lp lq lr aw ls bi"><span id="1cd0" class="lt jv hi lp b fi lu lv l lw lx">ssh &lt;public-ip-of-master&gt;<br/>ssh &lt;private-ip-of-master&gt;<br/>ssh &lt;public-ip-of-worker1&gt;<br/>ssh &lt;private-ip-of-worker1&gt;</span></pre><ul class=""><li id="a981" class="kz la hi iz b ja jb jd je jg ly jk lz jo ma js le lf lg lh bi translated">然后在 Master 上，测试您可以使用 Master 实例的私有和公共 ip 在没有密码的情况下登录 Master 和 Worker1。</li></ul><pre class="ks kt ku kv fd lo lp lq lr aw ls bi"><span id="e76b" class="lt jv hi lp b fi lu lv l lw lx">ssh &lt;public-ip-of-worker1&gt;<br/>ssh &lt;private-ip-of-worker1&gt;<br/>ssh &lt;public-ip-of-master&gt;<br/>ssh &lt;private-ip-of-master&gt;</span></pre><ul class=""><li id="0856" class="kz la hi iz b ja jb jd je jg ly jk lz jo ma js le lf lg lh bi translated">完成上述步骤后，我们有了一个从主节点到 Worker1 的双向无密码 SSH 登录。</li><li id="deca" class="kz la hi iz b ja lj jd lk jg ll jk lm jo ln js le lf lg lh bi translated">请重复这些步骤，在主服务器和工作服务器 2 之间建立相同的连接。集群的拓扑应该如下所示。</li></ul><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="er es mh"><img src="../Images/2728ba62c55ade0f4d58a88874ca59df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*twmmJ-_tsZycg3NTk2kcsQ.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx translated">无密码 SSH 拓扑</figcaption></figure><h1 id="b627" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">步骤 4: Hadoop 安装和配置</h1><ul class=""><li id="2b6d" class="kz la hi iz b ja km jd kn jg lb jk lc jo ld js le lf lg lh bi translated"><strong class="iz hj">在所有 3 个节点上:</strong>从<a class="ae li" href="http://apache.mirrors.lucidnetworks.net/hadoop/common/hadoop- 3.1.2/hadoop-3.1.2.tar.gz\" rel="noopener ugc nofollow" target="_blank">这里</a>下载 Hadoop 并解压到相同的文件夹位置。</li></ul><pre class="ks kt ku kv fd lo lp lq lr aw ls bi"><span id="356e" class="lt jv hi lp b fi lu lv l lw lx">wget http://apache.mirrors.lucidnetworks.net/hadoop/common/hadoop-<br/>3.1.2/hadoop-3.1.2.tar.gz</span></pre><ul class=""><li id="b772" class="kz la hi iz b ja jb jd je jg ly jk lz jo ma js le lf lg lh bi translated"><strong class="iz hj">在所有 3 个节点上:</strong>在配置内的<em class="jt">“Hadoop installation folder/etc/Hadoop/core-site . XML”</em>文件中追加以下行。修改"<em class="jt"> core-site.xml" </em>文件中的主节点和工作节点，用你的主节点私有 ip 替换这个 ip。</li></ul><pre class="ks kt ku kv fd lo lp lq lr aw ls bi"><span id="589b" class="lt jv hi lp b fi lu lv l lw lx">&lt;property&gt;<br/>&lt;name&gt;fs.default.name&lt;/name&gt;<br/>&lt;value&gt;hdfs://192.168.0.1:54310&lt;/value&gt;<br/>&lt;/property&gt;</span></pre><ul class=""><li id="e2d4" class="kz la hi iz b ja jb jd je jg ly jk lz jo ma js le lf lg lh bi translated"><strong class="iz hj">仅在主节点上:</strong>清空文件<em class="jt">Hadoop installation folder/etc/Hadoop/slaves</em>的内容，添加所有 workers 和主节点的私有 ip。这一步给出了可以作为 Hadoop master 的工作者的所有机器的列表。<br/>注意:您必须添加所有 3 个节点的 IP(包括主节点)。</li><li id="0f47" class="kz la hi iz b ja lj jd lk jg ll jk lm jo ln js le lf lg lh bi translated"><strong class="iz hj">在所有 3 个节点上</strong>:记得在<em class="jt">Hadoop installation folder/etc/Hadoop/Hadoop-env . sh</em>中设置 JAVA_HOME</li><li id="d5ac" class="kz la hi iz b ja lj jd lk jg ll jk lm jo ln js le lf lg lh bi translated"><strong class="iz hj">仅在主节点上:</strong>在<em class="jt"> HadoopFolder/bin/ </em>文件夹中运行下面一行来格式化 HDFS 系统。</li></ul><pre class="ks kt ku kv fd lo lp lq lr aw ls bi"><span id="9f76" class="lt jv hi lp b fi lu lv l lw lx">./hadoop namenode -format</span></pre><ul class=""><li id="59e3" class="kz la hi iz b ja jb jd je jg ly jk lz jo ma js le lf lg lh bi translated"><strong class="iz hj">仅在主节点上:</strong>在<em class="jt"> HadoopFolder/sbin/ </em>文件夹中运行以下行来启动您的集群。这需要一段时间。</li></ul><pre class="ks kt ku kv fd lo lp lq lr aw ls bi"><span id="8cd0" class="lt jv hi lp b fi lu lv l lw lx">./start-dfs.sh</span></pre><ul class=""><li id="b572" class="kz la hi iz b ja jb jd je jg ly jk lz jo ma js le lf lg lh bi translated">通过在浏览器中输入“<em class="jt"> master_ public_ip:50070 </em>”来检查 Hadoop 集群的状态。如果你到达一个带有“<em class="jt"> Namenode 信息</em>的网页，你已经成功启动了 Hadoop。您应该列出了 3 个活动节点。</li><li id="5bf2" class="kz la hi iz b ja lj jd lk jg ll jk lm jo ln js le lf lg lh bi translated">如果您在设置 Hadoop 时出现错误，建议删除 master 和所有 workers 中<em class="jt"> /tmp </em>中<br/>所有与 Hadoop 相关的文件。然后格式化节点和<em class="jt"> start-dfs.sh </em>。</li></ul><h1 id="57ea" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">步骤 5: Spark 安装和配置</h1><p id="253a" class="pw-post-body-paragraph ix iy hi iz b ja km ij jc jd kn im jf jg ko ji jj jk kp jm jn jo kq jq jr js hb bi translated">在所有节点上从<a class="ae li" href="https://downloads.apache.org/spark/spark-3.0.0-preview2/spark-3.0.0-preview2-bin-hadoop3.2.tgz" rel="noopener ugc nofollow" target="_blank">这里</a>下载 Spark，并将其解压缩到相同的文件路径。</p><ul class=""><li id="ba41" class="kz la hi iz b ja jb jd je jg ly jk lz jo ma js le lf lg lh bi translated"><strong class="iz hj">仅在主节点:</strong>在<em class="jt">spark folder/conf/slaves.template .</em>中添加 worker 和 master 节点的私有 ip，然后将 slaves . template 重命名为/slaves 即可生效。</li><li id="9922" class="kz la hi iz b ja lj jd lk jg ll jk lm jo ln js le lf lg lh bi translated"><strong class="iz hj">仅在主节点上:</strong>在<em class="jt"> SparkFolder/sbin/ </em>文件夹中运行下面一行来启动 Spark master。</li></ul><pre class="ks kt ku kv fd lo lp lq lr aw ls bi"><span id="7ae7" class="lt jv hi lp b fi lu lv l lw lx">./start-all.sh</span></pre><ul class=""><li id="c0ff" class="kz la hi iz b ja jb jd je jg ly jk lz jo ma js le lf lg lh bi translated"><strong class="iz hj">仅在主节点:</strong>在浏览器中输入<em class="jt">“master _ public _ IP:8080”</em>检查 Spark 主节点的状态。如果你进入一个网页<em class="jt">【星火大师】</em>那么你的大师已经开始了。</li><li id="f9b6" class="kz la hi iz b ja lj jd lk jg ll jk lm jo ln js le lf lg lh bi translated">Spark Web Master UI 中应该列出了 3 个 workers。</li></ul></div><div class="ab cl mq mr gp ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="hb hc hd he hf"><h1 id="6fcc" class="ju jv hi bd jw jx mx jz ka kb my kd ke io mz ip kg ir na is ki iu nb iv kk kl bi translated">感谢阅读！</h1><p id="7bdf" class="pw-post-body-paragraph ix iy hi iz b ja km ij jc jd kn im jf jg ko ji jj jk kp jm jn jo kq jq jr js hb bi translated">如果你喜欢我的工作，想支持我…</p><ol class=""><li id="82b7" class="kz la hi iz b ja jb jd je jg ly jk lz jo ma js nc lf lg lh bi translated">支持我的最好方式就是在<a class="ae li" rel="noopener" href="/@vinodhini-sd">媒体</a>上关注我。</li><li id="2f20" class="kz la hi iz b ja lj jd lk jg ll jk lm jo ln js nc lf lg lh bi translated">我在 LinkedIn 上分享关于#dataengineering #ml #mlops 的技巧、诀窍和见解。</li><li id="5127" class="kz la hi iz b ja lj jd lk jg ll jk lm jo ln js nc lf lg lh bi translated">请随意鼓掌，这样我就知道这篇文章对你有多大帮助了。</li></ol></div></div>    
</body>
</html>