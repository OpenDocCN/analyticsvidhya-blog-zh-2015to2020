<html>
<head>
<title>Get Smartsheet Data as a Json -using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python以Json形式获取智能表数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/get-smartsheet-data-as-a-json-using-python-961779998db5?source=collection_archive---------4-----------------------#2020-01-20">https://medium.com/analytics-vidhya/get-smartsheet-data-as-a-json-using-python-961779998db5?source=collection_archive---------4-----------------------#2020-01-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="36b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们通过Smartsheet API集成以Json的形式从这个smartsheet中获取数据，</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/1829033f913ce799be58a0f7d7831b44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qLEk_s8YBmXKRU6AXL5sBQ.png"/></div></div></figure><p id="638f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">-首先，您需要点击右上角的smartsheet个人资料，然后选择“应用和集成”</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jp"><img src="../Images/2837b37dda9f59461b889eb5c2ccc2a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cFfje6ywL8_RQMPcVooLlA.png"/></div></div></figure><p id="5364" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">-弹出一个新窗口！点击左边的API访问，生成一个新的令牌！在你生成令牌后，你只会看到它一次，所以复制它并把它藏在某个安全的地方！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jq"><img src="../Images/17e8deeffd8e7b157b56670524c8575c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mV0DOXuV_s-J1Zl0v44BBw.png"/></div></div></figure><p id="4780" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">-转到smartsheet主页，右键单击所需的工作表，然后复制sheet_id</p><p id="327c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">-现在，我们有了Token和sheet_id，让我们开始编码:)</p><ol class=""><li id="5f81" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">将您的令牌和sheet_id存储到您的环境变量。bash_profile应该是这样的，这不是一个有效的令牌或sheet_id:)</li></ol><blockquote class="ka kb kc"><p id="95c9" class="if ig kd ih b ii ij ik il im in io ip ke ir is it kf iv iw ix kg iz ja jb jc hb bi translated">出口无记名= "无记名HH8384H8sdkjil09" <br/>出口单_ID = "3437432947347324 "</p></blockquote><p id="d964" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您不知道如何在环境变量中存储凭证，请查看我的另一篇关于将python变量存储到。bash_profile文件。<a class="ae kh" rel="noopener" href="/@somer_13379/how-to-use-python-environment-variables-and-keep-your-passwords-safe-f167b15712f7">https://medium . com/@ somer _ 13379/how-to-use-python-environment-variables-and-keep-your-passwords-safe-f167b 15712 f 7</a></p><p id="3597" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.导入所有需要的模块</p><pre class="je jf jg jh fd ki kj kk kl aw km bi"><span id="30a2" class="kn ko hi kj b fi kp kq l kr ks">import json<br/>import csv<br/>import requests<br/>import os</span></pre><p id="b69e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.创建一个函数，并开始访问存储在环境变量中的令牌和sheet_id</p><pre class="je jf jg jh fd ki kj kk kl aw km bi"><span id="c607" class="kn ko hi kj b fi kp kq l kr ks">def getSmartsheet():<br/>    <br/>    Bearer = (os.environ.get('BEARER'))<br/>    sheet_id = (os.environ.get('SHEET_ID'))</span></pre><p id="6d54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.为API创建头并调用承载变量，</p><pre class="je jf jg jh fd ki kj kk kl aw km bi"><span id="0a10" class="kn ko hi kj b fi kp kq l kr ks">headers = {<br/>    'Authorization': Bearer,<br/>    'Accept': 'text/csv',<br/>}</span></pre><p id="4f74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.发送API Request + sheet_ID和包含不记名令牌和我们期望的数据的头，在本例中是csv。</p><pre class="je jf jg jh fd ki kj kk kl aw km bi"><span id="c9cd" class="kn ko hi kj b fi kp kq l kr ks">response = requests.get('https://api.smartsheet.com/2.0/sheets/' + str(sheet_id), headers=headers)<br/>    return response.text<br/><br/>csvData = getSmartsheet()</span></pre><p id="58de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.创建一个新的数据集，并将csv作为Python字典读取</p><pre class="je jf jg jh fd ki kj kk kl aw km bi"><span id="4889" class="kn ko hi kj b fi kp kq l kr ks">data = []<br/>reader = csv.DictReader(csvData.split('\n'), delimiter=',')</span></pre><p id="601f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.创建一个新函数，并将字典数据追加到新数据集中</p><pre class="je jf jg jh fd ki kj kk kl aw km bi"><span id="0e6c" class="kn ko hi kj b fi kp kq l kr ks">def processingJson():<br/>     for rows in reader:<br/>        dictData= rows<br/>        data.append(dictData)</span></pre><p id="ae78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.最后进行JSON转储</p><pre class="je jf jg jh fd ki kj kk kl aw km bi"><span id="c077" class="kn ko hi kj b fi kp kq l kr ks">        jsonData = json.dumps(data, indent=4)<br/>        print(jsonData)<br/><br/>processingJson()</span></pre><p id="2ba8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8.完整代码！</p><pre class="je jf jg jh fd ki kj kk kl aw km bi"><span id="1499" class="kn ko hi kj b fi kp kq l kr ks">import json<br/>import csv<br/>import requests<br/>import os<br/><br/><br/>def getSmartsheet():<br/>    #Accessing the Credentials<br/>    Bearer = (os.environ.get('BEARER'))<br/>    sheet_id = (os.environ.get('SHEET_ID'))<br/><br/>    #Create Headers that contain Bearer Token<br/>    headers = {<br/>        'Authorization': Bearer,<br/>        'Accept': 'text/csv',<br/>    }<br/><br/>    # send the API request + token and Sheet_id<br/>    response = requests.get('https://api.smartsheet.com/2.0/sheets/' + str(sheet_id), headers=headers)<br/>    return response.text<br/><br/>csvData = getSmartsheet()<br/><br/><br/>#Create a new data set<br/>data = []<br/>#Reader te CSV as a python Dcit<br/>reader = csv.DictReader(csvData.split('\n'), delimiter=',')<br/><br/><br/>def processingJson():<br/>    #Append the Dict into the Data set<br/>     for rows in reader:<br/>        dictData= rows<br/>        data.append(dictData)<br/><br/>        #json Dump<br/>        jsonData = json.dumps(data, indent=4)<br/>        print(jsonData)<br/><br/>processingJson()</span></pre><p id="df27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">9.返回的Json</p><pre class="je jf jg jh fd ki kj kk kl aw km bi"><span id="8061" class="kn ko hi kj b fi kp kq l kr ks">[<br/>    {<br/>        "ID": "2278",<br/>        "Year": "2019",<br/>        "City": "Columbus",<br/>        "Third year": "OH",<br/>        "Country": "United States",<br/>        "Phone Number": "56734211"<br/>    }<br/>]<br/>[<br/>    {<br/>        "ID": "2278",<br/>        "Year": "2019",<br/>        "City": "Columbus",<br/>        "Third year": "OH",<br/>        "Country": "United States",<br/>        "Phone Number": "56734211"<br/>    },<br/>    {<br/>        "ID": "33",<br/>        "Year": "2018",<br/>        "City": "Minneapolis",<br/>        "Third year": "MN",<br/>        "Country": "United States",<br/>        "Phone Number": "56473821"<br/>    }<br/>]<br/>[<br/>    {<br/>        "ID": "2278",<br/>        "Year": "2019",<br/>        "City": "Columbus",<br/>        "Third year": "OH",<br/>        "Country": "United States",<br/>        "Phone Number": "56734211"<br/>    },<br/>    {<br/>        "ID": "33",<br/>        "Year": "2018",<br/>        "City": "Minneapolis",<br/>        "Third year": "MN",<br/>        "Country": "United States",<br/>        "Phone Number": "56473821"<br/>    },<br/>    {<br/>        "ID": "23",<br/>        "Year": "2017",<br/>        "City": "San Jose",<br/>        "Third year": "CA",<br/>        "Country": "United States",<br/>        "Phone Number": "23465787"<br/>    }<br/>]<br/>[<br/>    {<br/>        "ID": "2278",<br/>        "Year": "2019",<br/>        "City": "Columbus",<br/>        "Third year": "OH",<br/>        "Country": "United States",<br/>        "Phone Number": "56734211"<br/>    },<br/>    {<br/>        "ID": "33",<br/>        "Year": "2018",<br/>        "City": "Minneapolis",<br/>        "Third year": "MN",<br/>        "Country": "United States",<br/>        "Phone Number": "56473821"<br/>    },<br/>    {<br/>        "ID": "23",<br/>        "Year": "2017",<br/>        "City": "San Jose",<br/>        "Third year": "CA",<br/>        "Country": "United States",<br/>        "Phone Number": "23465787"<br/>    },<br/>    {<br/>        "ID": "45",<br/>        "Year": "2016",<br/>        "City": "Los Angles",<br/>        "Third year": "CA",<br/>        "Country": "United States",<br/>        "Phone Number": "98674324"<br/>    }<br/>]<br/>[<br/>    {<br/>        "ID": "2278",<br/>        "Year": "2019",<br/>        "City": "Columbus",<br/>        "Third year": "OH",<br/>        "Country": "United States",<br/>        "Phone Number": "56734211"<br/>    },<br/>    {<br/>        "ID": "33",<br/>        "Year": "2018",<br/>        "City": "Minneapolis",<br/>        "Third year": "MN",<br/>        "Country": "United States",<br/>        "Phone Number": "56473821"<br/>    },<br/>    {<br/>        "ID": "23",<br/>        "Year": "2017",<br/>        "City": "San Jose",<br/>        "Third year": "CA",<br/>        "Country": "United States",<br/>        "Phone Number": "23465787"<br/>    },<br/>    {<br/>        "ID": "45",<br/>        "Year": "2016",<br/>        "City": "Los Angles",<br/>        "Third year": "CA",<br/>        "Country": "United States",<br/>        "Phone Number": "98674324"<br/>    },<br/>    {<br/>        "ID": "26",<br/>        "Year": "2015",<br/>        "City": "New York",<br/>        "Third year": "NY",<br/>        "Country": "United States",<br/>        "Phone Number": "46576879"<br/>    }<br/>]<br/>[<br/>    {<br/>        "ID": "2278",<br/>        "Year": "2019",<br/>        "City": "Columbus",<br/>        "Third year": "OH",<br/>        "Country": "United States",<br/>        "Phone Number": "56734211"<br/>    },<br/>    {<br/>        "ID": "33",<br/>        "Year": "2018",<br/>        "City": "Minneapolis",<br/>        "Third year": "MN",<br/>        "Country": "United States",<br/>        "Phone Number": "56473821"<br/>    },<br/>    {<br/>        "ID": "23",<br/>        "Year": "2017",<br/>        "City": "San Jose",<br/>        "Third year": "CA",<br/>        "Country": "United States",<br/>        "Phone Number": "23465787"<br/>    },<br/>    {<br/>        "ID": "45",<br/>        "Year": "2016",<br/>        "City": "Los Angles",<br/>        "Third year": "CA",<br/>        "Country": "United States",<br/>        "Phone Number": "98674324"<br/>    },<br/>    {<br/>        "ID": "26",<br/>        "Year": "2015",<br/>        "City": "New York",<br/>        "Third year": "NY",<br/>        "Country": "United States",<br/>        "Phone Number": "46576879"<br/>    },<br/>    {<br/>        "ID": "27",<br/>        "Year": "2014",<br/>        "City": "Phoenix",<br/>        "Third year": "AZ",<br/>        "Country": "United States",<br/>        "Phone Number": "29385764"<br/>    }<br/>]<br/></span></pre><p id="58be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这对某人有所帮助:)</p></div></div>    
</body>
</html>