<html>
<head>
<title>Pagination, Batching &amp; Restricting result data with Google Cloud Storage python client library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Google云存储python客户端库对结果数据进行分页、批处理和限制</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/pagination-batching-restricting-result-data-with-google-cloud-storage-python-client-library-b87bc50393d?source=collection_archive---------8-----------------------#2019-09-25">https://medium.com/analytics-vidhya/pagination-batching-restricting-result-data-with-google-cloud-storage-python-client-library-b87bc50393d?source=collection_archive---------8-----------------------#2019-09-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9e7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章展示了使用云存储Python客户端库时的一些最佳实践。具体来说，我将讨论如何发送批处理API请求、限制结果数据以及如何对结果进行分页。</p><h1 id="9cb7" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">定量</h1><p id="c0a4" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">不要执行多种类似的API操作，只要适用，尝试批处理API调用，以减少您的客户端必须与云存储建立的HTTP连接的数量，从而减少操作开销并提高性能。</p><p id="5636" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，如果您需要从GCS存储桶中删除大量文件，这就是您逐个删除它们的方法。下面的代码演示了如何使用<strong class="ih hj">bucket . delete _ blob()</strong>方法来删除blob列表，然后使用<strong class="ih hj"> delete_blob() </strong>来删除每个单独的blob。</p><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="1467" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更好的选择是进行一次批处理API调用来删除它们，尽管单个请求中API调用的最大数量被限制为1000。下面的代码片段演示了批量删除操作，一次删除1000个对象，直到没有要删除的对象。</p><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="688a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当测试删除10，000个对象时，顺序删除需要大约3238秒(大约54分钟)，而批量删除只需要121秒(大约2分钟)。</p><h1 id="4cf7" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">页码</h1><p id="a7eb" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">使用<em class="kn">字段</em>参数<em class="kn"> </em>中的<strong class="ih hj">next page token</strong><em class="kn"/>对结果进行分页。当您想要显示有限数量的结果，并且想要分割返回的数据并在多个页面中显示时，这很有用。</p><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="kl km l"/></div></figure><h1 id="df66" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">部分响应</h1><p id="99bf" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">当您请求匹配前缀标准的blob列表时，默认情况下，服务器在处理请求后发送回blob的完整表示<a class="ae ko" href="https://cloud.google.com/storage/docs/json_api/v1/objects#resource-representations" rel="noopener ugc nofollow" target="_blank">。为了获得更好的性能，您可以要求服务器只发送您真正需要的字段，并得到一个<em class="kn">部分响应</em>。下面的代码使用<em class="kn">字段</em>参数只请求匹配对象的<em class="kn">名称</em>和<em class="kn">内容类型</em>。</a></p><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="kl km l"/></div></figure><h1 id="d150" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">补丁(部分更新)</h1><p id="ca65" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">修改资源时避免发送不必要的数据。要仅发送您正在更改的特定字段的更新数据，请使用<strong class="ih hj"> PATCH </strong>方法。如果您想清除先前设置的数据，使用<strong class="ih hj"> PUT </strong>。出于这个原因，使用补丁要安全得多。您只需为要更改的字段提供数据；您忽略的字段不会被清除。以下代码通过发送批处理补丁请求将<em class="kn">内容类型</em>元数据设置为<em class="kn"> image/png </em>。</p><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="kl km l"/></div></figure></div></div>    
</body>
</html>