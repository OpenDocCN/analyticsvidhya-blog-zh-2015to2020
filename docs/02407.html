<html>
<head>
<title>A comprehensive guide for profiling a deep learning model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深度学习模型剖析综合指南</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/a-comprehensive-guide-for-profiling-a-deep-learning-model-37543100c0aa?source=collection_archive---------6-----------------------#2019-12-15">https://medium.com/analytics-vidhya/a-comprehensive-guide-for-profiling-a-deep-learning-model-37543100c0aa?source=collection_archive---------6-----------------------#2019-12-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a34cb3ae4ee2eb7ff2f68ecf3cbcd0aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1rqpj6iCMlzKlWnU20stJg.jpeg"/></div></div></figure><p id="427a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们对深度学习模型的传统方法是提高模型的准确性。有很多创新在那里建立更好的深度学习模型，以提高许多创造性算法的准确性。但它只是专注于获得更好的准确性，直到2017年<strong class="is hj">黎明长凳</strong>竞赛由<strong class="is hj">斯坦福大学</strong>在<strong class="is hj"> NIPS </strong>会议上发布。这场比赛的主要焦点不仅仅是提高模型准确性，而是提高深度学习模型的<strong class="is hj">计算时间</strong>和<strong class="is hj">硬件成本</strong>，因为这些是构建深度学习模型的最关键资源。</p><p id="069e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，记住上面的内容，如果我们试图改进我们的模型<strong class="is hj">计算时间</strong>有许多技术可用。这种伟大的技术之一在这里解释<a class="ae jo" href="https://myrtle.ai/how-to-train-your-resnet/" rel="noopener ugc nofollow" target="_blank">。但是，在尝试改进我们的训练时间之前，我们需要知道我们的网络在训练期间花费了大部分时间。所以，我们可以专注于这一部分，尽量减少它。为此，我们需要分析我们的模型架构，以检查每一层花费的平均时间，以及在训练期间如何使用<strong class="is hj"> CPU </strong>和<strong class="is hj"> GPU </strong>。</a></p><p id="5ebe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我们将讨论在<strong class="is hj">张量板</strong>中使用python来实现上述目标。</p><p id="ec2d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，在这篇文章中，我们将学习如何使用适当的数据管道来优化使用CPU和GPU，最大限度地减少每历元时间，并在<strong class="is hj">张量板</strong>中将其可视化。</p><h1 id="3d4f" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">张量板</h1><p id="bbaa" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated"><strong class="is hj">张量板</strong>是用于可视化图形和其他工具的界面，用于理解、调试和优化模型。为了理解它是如何工作的，让我们深入研究一下。</p><p id="f1b2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，在深入研究<strong class="is hj">张量板</strong>之前，让我们创建自己的模型架构，在此基础上，我们将借助<strong class="is hj">张量板</strong>可视化其性能。</p><p id="0586" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，让我们借助张量流创建一个基于CNN 的模型架构:</p><p id="9435" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们导入所有重要的库:</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="94e8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，让我们为CIFAR10数据集创建密集网络体系结构:</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="4a73" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">既然我们的模型体系结构已经准备就绪，让我们预处理我们的CIFAR10数据集并编译我们的模型:</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="19da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们将为张量板回调创建一个目录，并定义我们的张量板回调。默认情况下，张量流将分析第二批。我们可以通过设置<code class="du ky kz la lb b">profile_batch</code>来修改它</p><p id="c71e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们运行5个时期的模型，我们将在张量板GUI中查看日志的结果。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="6aa5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在培训已经完成，让我们来看看结果:</p><p id="b74a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要在张量板中可视化日志，有两种方法:</p><ul class=""><li id="6154" class="lc ld hi is b it iu ix iy jb le jf lf jj lg jn lh li lj lk bi translated">我们可以在浏览器中直接看到结果。在这个过程中，不需要本地依赖。我们可以直接运行下面的代码片段，并在它生成的链接中可视化<strong class="is hj">张量板</strong>。</li></ul><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><ul class=""><li id="09f3" class="lc ld hi is b it iu ix iy jb le jf lf jj lg jn lh li lj lk bi translated">我们也可以在本地做同样的事情。首先，我们应该使用代码<code class="du ky kz la lb b">!zip -r /content/logs.zip /content/logs</code>压缩并下载日志文件。一旦它被下载解压缩。现在打开命令提示符，使用<code class="du ky kz la lb b">cd logs_directory</code>移动到日志目录。现在，如果我们键入这个命令<code class="du ky kz la lb b">tensorboard --logdir=logs </code>，我们可以在<a class="ae jo" href="http://SyatemName:6006" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">http://localhost:6006</strong></a>地址中看到张量板。</li></ul><p id="cf98" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">打开张量板GUI后，我们可以看到如下内容:</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/c4b2f51d6aa7a459ac6f41a825e9235d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2cRyyAXOM7fTPOk_P75a5g.png"/></div></div></figure><p id="bfc6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，如果我们单击“个人资料”选项卡，我们可以看到如下个人资料信息:</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/e2d8111f64f8218dd688b6824a21caeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OzXZONCxvh3vwhkp3TEG3g.png"/></div></div></figure><p id="7187" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，在profile选项卡中，我们可以看到模型生成的所有跟踪信息。基本上，这些事件是从3个不同的来源收集的:</p><ul class=""><li id="c1c8" class="lc ld hi is b it iu ix iy jb le jf lf jj lg jn lh li lj lk bi translated"><strong class="is hj"> CPU: </strong> CPU事件在名为<code class="du ky kz la lb b">/host:CPU</code>的事件组下。每个轨道代表CPU上的一个线程。例如输入流水线事件、GPU op调度事件、CPU op执行事件等。</li><li id="5def" class="lc ld hi is b it lm ix ln jb lo jf lp jj lq jn lh li lj lk bi translated"><strong class="is hj"> GPU: </strong> GPU事件在前缀为<code class="du ky kz la lb b">/device:GPU:</code>的事件组下。除了<code class="du ky kz la lb b">stream:all</code>，每个事件组代表GPU上的一个流。<code class="du ky kz la lb b">stream::all</code>在一个GPU上聚合所有事件。例如存储器复制事件、内核执行事件等。</li><li id="94ef" class="lc ld hi is b it lm ix ln jb lo jf lp jj lq jn lh li lj lk bi translated"><strong class="is hj">张量流运行时间:</strong>运行时间事件在前缀为<code class="du ky kz la lb b">/job:</code>的事件组下。运行时事件表示python程序调用的张量流ops。例如tf .函数执行事件等。</li></ul><p id="f6e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本节中，我们已经讨论了仅使用张量板进行分析。还有其他的侧写方式。我们可以手动分析并编写张量流代码。此外，我们可以使用CProfile进行分析。</p><h1 id="c9b3" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">参考:</strong></h1><ol class=""><li id="dab9" class="lc ld hi is b it kn ix ko jb lr jf ls jj lt jn lu li lj lk bi translated"><a class="ae jo" href="https://www.tensorflow.org/tensorboard/tensorboard_profiling_keras" rel="noopener ugc nofollow" target="_blank">https://www . tensor flow . org/tensor board/tensor board _ profiling _ keras</a></li></ol><p id="fb1a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.人工智能学校教程。</p></div></div>    
</body>
</html>