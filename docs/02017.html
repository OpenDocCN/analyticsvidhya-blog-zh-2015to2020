<html>
<head>
<title>Predicting Customer Churn</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测客户流失</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/predicting-customer-churn-58faa29bc836?source=collection_archive---------10-----------------------#2019-11-26">https://medium.com/analytics-vidhya/predicting-customer-churn-58faa29bc836?source=collection_archive---------10-----------------------#2019-11-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/dd52ff49952e486c03a66b87199dbf5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*I4QqaV-hjGaCFPz8"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae iu" href="https://unsplash.com/@neonbrand?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> NeONBRAND </a>拍摄的照片</figcaption></figure><p id="1074" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">基于订阅的商业模式的一个重要指标是客户流失率。这是指客户决定不再为企业的服务付费。了解这些客户离开你的服务的原因可以提供对企业运营的洞察力，也可以决定企业是否会失败。在Udacity的数据科学家nanodegree项目中，我有机会使用与一家名为Sparkify的虚构流媒体公司相关的数据，并尝试为他们的公司建立一个预测流失模型。</p><p id="ab85" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">商业问题</strong></p><p id="2549" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个项目的目标是使用Sparkify的网站流量来识别那些更有可能流失的用户。这是为了让Sparkify与客户进行沟通，帮助他们解决任何可能导致他们停止支付服务费用的问题。</p><p id="17bd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我将研究这些数据，以发现与用户的订阅年龄、操作系统和设备、性别以及应用程序的活跃程度相关的见解，并列举一些我认为对预测客户流失至关重要的功能。从那里，我的目标是创建这些特征的管道，以馈入监督学习提升树分类算法。这个算法吸引了我，因为它能够重新计算加权输入，这在处理不平衡数据时很有用。</p><p id="f27a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">经过进一步考虑，我觉得如果是这样的话，基础设施将不得不利用某种数据流工具，而不是在应用程序出现混乱迹象的每一时刻查询用户的历史记录。因此，客户流失预测将需要快速到达，以触发一个可以给几天时间进行适当干预的响应。</p><p id="f09d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">探索性数据分析</strong></p><p id="8aa2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这种情况下，我得到了一个相当大的12GB的客户数据集。在这里，用于分析和机器学习的标准工具将不适合计算机的内存，所以我被迫使用像Apache Spark这样的大数据工具。数据集有18个字段，包括订阅级别、userID、sessionID、性别、时间戳、歌曲作者等等。</p><p id="ba0d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我加载了数据框，然后检查了数据框的模式和形状。从下面的图片看，大约有53万个条目，共19列。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jt"><img src="../Images/3e661fa119359e4f66c7ae8eb85ce857.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*NVpGA0R0P83vZFvyBgT3OQ.png"/></div></figure><p id="dddd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">准备:有些记录没有空的userID或sessionID，所以我删除了它们</p><p id="035a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我将查看数据集中的一些分类变量:授权、性别、方法、订阅级别、交互中使用的方法、用户在哪个页面上、交互状态。可以看出，有大量的付费和免费用户对Sparkify的业务非常重要，因为他们分别通过付费订阅和广告收入提供收入。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jy"><img src="../Images/998d24078f170731868ea5c13ea9b654.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*7yuOCkAP_XJn8kP1GEjjpw.png"/></div></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jz"><img src="../Images/946a2a8ae58c7202145ec1a75a8f09a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:288/format:webp/1*DCfTp7hMBLIQ69LvfydmZQ.png"/></div></figure><p id="b315" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，让我们看看有多少用户产生了与没有产生。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es ka"><img src="../Images/c07b721467c05815a382a67c529b6d42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*pEvm3XR3su_iJlH2LJ8g4A.png"/></div></figure><p id="ca12" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，我认为按性别或订阅查看流失统计数据会很酷:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kb"><img src="../Images/be14c3f41368a7fc15f7936d39859286.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*1hqMdRnweTyVTq-V7j4-Eg.png"/></div></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kc"><img src="../Images/29f039723ea5b49cddf987666d97d882.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*77wi7zNQw4G5PBoViull8A.png"/></div></div></figure><p id="8380" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">基于一些基本的分析，免费用户似乎比付费用户略多，但是被取消的付费用户和被取消的免费用户差不多。男性似乎比女性更容易流失。</p><p id="dd1a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我想研究的另一个特征是，一个人的操作系统是否会影响他流失的可能性？</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/e47f3546f4ab0c78c8ea58c13a4d2fed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JeylriwYh2Q2q5fEMUCBLw.png"/></div></div></figure><p id="1f6f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">看起来一个人的操作系统确实很重要。iPad用户似乎最开心，没有人取消订阅，而iPhone、Windows 7和Linux用户更有可能取消订阅服务。接下来，我可以将每个操作系统分解成可读性更好的图表，并将每个操作系统的已取消用户与活动用户相关联，而不是与用户总数相关联。</p><p id="db6d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">特色工程</strong></p><p id="fd37" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">似乎有新的或修改的特征，我想添加到数据集，这可以被视为一个分类特征或数字特征。以下是几个例子:</p><ul class=""><li id="bea1" class="ke kf hi ix b iy iz jc jd jg kg jk kh jo ki js kj kk kl km bi translated">作为二进制变量的页面操作</li><li id="4d3e" class="ke kf hi ix b iy kn jc ko jg kp jk kq jo kr js kj kk kl km bi translated">时间特性:创建一个滚动窗口来捕捉用户与时间相关的行为</li><li id="3007" class="ke kf hi ix b iy kn jc ko jg kp jk kq jo kr js kj kk kl km bi translated">性别</li><li id="8314" class="ke kf hi ix b iy kn jc ko jg kp jk kq jo kr js kj kk kl km bi translated">用户注册后的天数</li></ul><p id="baa9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个特征工程之后，我们有能力检查每个页面的最近趋势。我的目标是滚动窗口，以允许预测客户流失的高精度。</p><p id="a365" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">建模与评估</strong></p><p id="df73" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里，我想创建一个概率分类事件，因为在这个问题中我们试图确定一个事件的可能性。这种情况下的数据存在一个问题，即流失事件与非流失事件之间的不平衡。为了解决这个问题，我将使用一个梯度增强分类器算法，比如GBTClassifier函数，它执行引导来重复选择数据的子集。这省去了很多试图欠采样或过采样数据的麻烦。</p><p id="240f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在建模之前，我创建了一个特征向量，将数据分为训练集和测试集，然后缩放数据以最小化离群值的影响。在这一部分中，我为缩放和分类操作部署了一个Spark管道。此外，由于数据的偏斜性质，准确性很可能会产生误导，因此我将使用不同于简单准确性的指标来判断我的模型，如召回率、接收器操作特性曲线和假阳性率等。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es ks"><img src="../Images/e4056c1e0c2643234fbcc56f50ca5c56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*nI4p5Q61G-sCmAct9jOqCg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">数据操作和初始化</figcaption></figure><p id="226a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过网格搜索和k-folds交叉验证，我们可以改进我们的模型来选择理想的超参数。我选择使用二元分类评估，因为我试图创建一个预测二元事件的模型。对于ParamGridBuilder()函数，我为一些参数创建了一个paramater网格来帮助决策树，例如maxDepth，它需要找到一个最佳深度点来提高准确性，同时避免过度拟合，maxBins在评估决策树时使用，maxIter基于我认为理解数据所需的适当迭代次数。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kt"><img src="../Images/f2be1d4ef750549990afdc921cff8564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*ke32EIniW9cKRVD0faWAdQ.png"/></div></figure><p id="b9d9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">回忆通常被称为真阳性率。例如，它是正确识别病人的比率，在这种情况下，它是正确识别将要流失的成员的比率。如果我们假设与客户的互动不是敌对的，那么未能识别真实肯定的人(即未能识别将要流失的人)将会使企业损失巨大的收入，而相反，错误地识别将要流失的人不会对企业造成太大的伤害。</p><p id="4947" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里的ROC曲线有助于我们查看我们在这种情况下的召回性能:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es ku"><img src="../Images/f636cdc72e34c203a649499d1f031d05.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/0*6LZSt-ZTajrebxTi"/></div></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kv"><img src="../Images/e998ddca3b5ae9c2e368e400973af4d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/0*n62bQJMHCcEACuMM.png"/></div></figure><p id="f680" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">总的来说，ROC曲线显示了我们的模型的有希望的结果，因为它显示真实的阳性率在1左右。然而，假阳性率似乎很高，但如果你能相信假阳性对业务没有那么有害，这个问题就不太令人担心了。只要假阳性率不太高，我们就可以接受这个比率。为了进一步分析，我在图表中添加了准确度、精确度和F1分数，如下所示:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es ku"><img src="../Images/d11153cb8e5b2fa6bb5a024e68ca9f58.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/0*Rcz-wiehbFGBk2h-"/></div></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kv"><img src="../Images/776d2e2b986742efe50eb15a9e936eee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/0*prFPsluPzw3iL2zo.png"/></div></figure><p id="3a79" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我在上图中添加了准确度、精确度、f1分数和召回率。精度衡量的是预测的阳性结果中真正阳性的比例。即使使用非常低的预测阈值(分别为0.2和0.5)，精度和总体准确度都接近1.0。所以，我不认为我们有很多假阳性，也不需要担心他们会继续下去。F1分数测量我们的精确度和召回率的调和平均值，同时也不考虑真正的否定，因此它可能是对模型性能的更准确的测量。F1分数在0.15阈值附近达到峰值，因此当用户有15%或更高的机会对业务产生最大影响时，干预可能是明智的。</p><p id="bf41" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有关这些指标的更多信息，我发现这个链接很有帮助:<a class="ae iu" href="https://blog.exsilio.com/all/accuracy-precision-recall-f1-score-interpretation-of-performance-measures/" rel="noopener ugc nofollow" target="_blank">https://blog . ex silio . com/all/accuracy-precision-recall-f1-score-interpretation-of-performance-measures/</a></p></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><h1 id="d127" class="ld le hi bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">后续步骤和改进</h1><p id="5f10" class="pw-post-body-paragraph iv iw hi ix b iy mb ja jb jc mc je jf jg md ji jj jk me jm jn jo mf jq jr js hb bi translated">我们已经创建了一个高度准确的模型，但其正面预测能力还有待提高。作为我们业务的第一个版本，这可能已经足够好了，但是我们可以采取什么步骤来增加更多的价值呢？</p><ul class=""><li id="0fa0" class="ke kf hi ix b iy iz jc jd jg kg jk kh jo ki js kj kk kl km bi translated">火花流—我们的业务需要快速响应，为此需要快速预测。将我们的模型整合到spark streaming应用程序中将允许几乎即时的预测(和干预)，而不是必须等待一整夜的批处理过程或类似过程。</li><li id="43f2" class="ke kf hi ix b iy kn jc ko jg kp jk kq jo kr js kj kk kl km bi translated">我想看看我的模型在欠采样或过采样的情况下会如何表现，以考虑到不平衡的数据。</li><li id="aa6c" class="ke kf hi ix b iy kn jc ko jg kp jk kq jo kr js kj kk kl km bi translated">额外的功能工程——注意到非iOS用户更容易流失了吗？我想看看这些统计数据，以及Sparkify的业务是否有任何潜在的网络效应。例如，Spotify的应用程序具有社交方面，所以我认为Sparkify也可能受益于或遭受网络效应。引入额外的数据有助于更准确地预测客户流失。</li><li id="db8e" class="ke kf hi ix b iy kn jc ko jg kp jk kq jo kr js kj kk kl km bi translated">我选择分析Sparkify的数据的一个重要原因是为了有机会在Apache Spark工作。然而，这个数据集是为我构建的，以达到一个比从真实世界的数据中创建我自己的数据集更容易的解决方案。通过创建自己的数据集来解决这个问题将是一次很好的学习经历。</li></ul><p id="1e8a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">总而言之，这个项目既有趣又有教育意义。使用Spark使我能够以分布式和可扩展的方式分析、转换和建模我们的数据集，同时还能够做出业务决策。然而，我需要意识到，对业务问题的仔细分析和理解比我使用的工具对成功更重要。</p></div></div>    
</body>
</html>