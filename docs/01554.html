<html>
<head>
<title>Google Optimize on the server side</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌在服务器端优化</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/google-optimize-on-the-server-side-using-nodejs-d9552388cea6?source=collection_archive---------2-----------------------#2019-10-31">https://medium.com/analytics-vidhya/google-optimize-on-the-server-side-using-nodejs-d9552388cea6?source=collection_archive---------2-----------------------#2019-10-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/0e2936af31bb8e9589a1369f16271689.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Rvl2d46YJCHIOok_"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">卢克·切瑟在<a class="ae hv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class=""/><p id="6954" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Google Optimize是Google推出的一款在线测试工具，可以插入你的网站，让你尝试不同的内容发布方式。它有助于三种类型的测试——A/B测试、多变量测试和重定向测试。优化通常用于转换率优化(CRO)。</p><p id="f71f" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这三者在客户端都非常有效，但是如果你想在服务器端运行你的实验，它并没有提供一个简单的方法。可用的文章很少，可以帮你度过。</p><p id="9436" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">先说手头的问题。您创建一个实验并提供变体。现在当网站加载谷歌优化代码。优化库在客户端运行它的算法，决定加载哪个变量。</p><p id="001e" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了开始使用它，你需要知道它是如何工作的。当你在optimize中创建一个实验时，你会得到一个实验ID，并把它保存在剪贴板中的某个地方。</p><blockquote class="jt ju jv"><p id="4082" class="iv iw jw ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated">附注:你不能直接在优化工具上设置百分比</p></blockquote><p id="8631" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你的网站是客户端渲染的，这种方法可以无缝工作。假设您想要运行服务器端实验来了解动态生成的定制内容的转换率。那么很难直接在优化工具上设置这些变量。这只能手动完成。因为设置变体文本很容易。但是在文本中添加自定义值(如用户名、id)是很繁琐的。在这里，将google优化代码移到后端是有意义的。显然google optimize并没有为你提供一个后端库来这样做。模仿整个优化库是没有意义的。因为你必须专注于构建你的产品，而不是构建一个产品来分析你的产品。我们能做什么？</p><p id="e071" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">解决或者是？</strong> <br/>为此有一个变通的办法。创建实验和变体的整个过程和以前一样。完成后，记下实验Id。</p><p id="e0ce" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">假设你有两个内容要交付给你的用户。那么您的实验将有两个变量，每个变量有50%作为度量标准。所以这里的问题是让客户端知道加载了什么变量。这可以通过在客户端可以访问的服务器端设置一个标志来实现。</p><figure class="kb kc kd ke fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ka"><img src="../Images/d3fa4ac8e48953757b93fb65db8f0104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lyR8f7a3hSFzKr2fr3FOqg.jpeg"/></div></div></figure><p id="3146" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦客户端知道加载了哪个变体，它所要做的就是通知google optimize。</p><p id="84be" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了通知“谷歌优化”加载的变量，您可以使用谷歌分析库。</p><p id="aba5" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是客户端代码的一个简单实现。</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="6efe" class="kk kl hy kg b fi km kn l ko kp">&lt;html&gt;<br/>&lt;head&gt;<br/>&lt;script&gt;<br/>  // 1. Load the analytics.js library.<br/>  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){<br/>  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),<br/>  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)<br/>  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');<br/><br/>  // 2. Create a tracker.<br/>  ga('create', 'UA-XXXXX-Y', 'auto');<br/><br/>  // 3. Set the experiment ID and variation ID.<br/>  ga('set', 'exp', '$experimentId.$variationId');<br/>  // 4. Send a pageview hit to Google Analytics.<br/>  ga('send', 'pageview');<br/>&lt;/script&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>&lt;!-- Content --&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="9f43" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你遵守上面的代码。您会注意到我们传递了实验Id和变量Id。</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="4411" class="kk kl hy kg b fi km kn l ko kp">ga('set', 'exp', '$experimentId.$variationId');</span></pre><p id="4b35" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">实验ID是您在创建实验时记下的Id。现在VariantId可以是(0，1，2，…。n)其中n是实验中变体的数量，0是原始变体。</p><p id="b60e" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您正在进行多变量测试，那么变量id需要用连字符'-'分隔。</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="0626" class="kk kl hy kg b fi km kn l ko kp">[variant for section 1]-[variant for section 2]-...-[variant for section N]</span></pre><p id="5078" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，给定一个关于颜色和字体部分的MVT实验(一个颜色部分有四个变量:0 =原始，1 =红色，2 =绿色，3 =蓝色，一个字体部分有三个变量:0 =原始，1 = 10pt，2 = 12pt):</p><ul class=""><li id="a1d8" class="kq kr hy ix b iy iz jc jd jg ks jk kt jo ku js kv kw kx ky bi translated">“0–0”表示原始颜色和字体</li><li id="a4d6" class="kq kr hy ix b iy kz jc la jg lb jk lc jo ld js kv kw kx ky bi translated">“1–0”表示红色和原始字体</li><li id="b781" class="kq kr hy ix b iy kz jc la jg lb jk lc jo ld js kv kw kx ky bi translated">“2–1”表示绿色和10pt字体</li></ul><p id="476c" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，以下代码选择0–0(原始颜色和字体)进行实验:</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="cd7e" class="kk kl hy kg b fi km kn l ko kp">ga('set', 'exp', '$experimentId.0-0');</span></pre><p id="af62" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">服务器端分发</strong></p><p id="addf" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们需要找到一种在您的服务器上分配流量的方法。你可以用你自己定制的算法来做。</p><p id="0b2e" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一种方法是随机分发内容。但是在任何给定的点上，你的渲染都不符合你在创建实验时设置的标准。假设您基于优先级提供了竞争者，那么您的样本集也将被不正确地分配。</p><p id="75c8" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">另一个好方法是平均分配流量，直到达到某个阈值。阈值代表最低的可交付结果。示例:您必须以7:2的比例分发内容，其中，向服务器发出的10个请求中，7个用户看到了<strong class="ix hz">内容1 </strong>，2个用户看到了<strong class="ix hz">内容2。</strong></p><p id="a15a" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">阈值为θ，此处为4，即(<strong class="ix hz">变量数)*(最低交付变量</strong>)。因为7:2是这个比例。其中2 &lt; 7。则2成为最低的传递变量，并且因为有2个变量(内容1和内容2)，所以θ = 4(即2*2)。</p><p id="76de" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们不断从收到的每个请求中扣除θ，直到θ变成0。到达服务器的请求被同等对待，并以替代内容进行响应。一旦θ(阈值)达到0。它(θ，此处为4)从每个变体可交付成果中扣除，因此它从7:2变为5:0。我们需要忽略这些零。再次重复相同的步骤，直到只剩下一个变量，它将作为新的θ结束。现在，接下来的5个请求将由内容1提供服务，因为没有其他竞争者。一旦该值变为0，比率就被重置回原始值(7:2 ),并重复该过程。与随机方法相比，这将给出更精确的度量。请在下面找到一个简单的实现。</p><figure class="kb kc kd ke fd hk"><div class="bz dy l di"><div class="le lf l"/></div></figure><blockquote class="jt ju jv"><p id="987f" class="iv iw jw ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated">一旦你选择了你的分配逻辑。在cookies中设置变量类型和实验id，以便您的客户端代码可以访问它。</p></blockquote><p id="8e84" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">结论</strong>:</p><p id="73ba" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是在服务器端使用谷歌优化的一个变通办法，可能有其他几种方法可以做到这一点。在大多数情况下，您可能不需要在服务器端运行这些实验。但是如果你需要运行它们，希望这有所帮助。</p><p id="5f94" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">欲了解更多信息，请访问:</p><p id="a22a" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae hv" href="https://developers.google.com/optimize/devguides/experiments" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/optimize/dev guides/experiments</a></p></div></div>    
</body>
</html>