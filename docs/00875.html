<html>
<head>
<title>Building Flask REST App with Flask-Restful</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Flask-Restful构建Flask REST应用程序</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/building-flask-rest-app-with-flask-restful-d22ba4c0e39f?source=collection_archive---------6-----------------------#2019-09-15">https://medium.com/analytics-vidhya/building-flask-rest-app-with-flask-restful-d22ba4c0e39f?source=collection_archive---------6-----------------------#2019-09-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7ea812fc6c4c40511581e3b2322d1403.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vzc4DgcqCpqa7uTIiU9XLA.png"/></div></div></figure><p id="6838" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">嗨，</em></p><p id="dc7a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">机器学习和人工智能正在彻底改变每个行业，如医疗保健、银行、保险，如何在现实世界中部署你的机器学习模型以获得预测非常重要。我记得当我对机器学习及其广泛的应用领域着迷的时候。我在开发高效的机器学习模型上付出了很多努力。</em></p><p id="29f9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">我想我已经进行了大量的功能工程，并与领域专家进行了交谈，以确保他们的洞察力被捕捉到。但是，当我想在现实世界中部署一个模型时，我遇到了一个问题，接下来该怎么办呢？。</em></p><p id="e0a4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我开始探索并完成了这个令人敬畏的教程，在这个教程中，我们将使用一个简单明了的框架Flask来部署机器学习模型。</p><p id="7667" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo"> ML型号在jupyter笔记本和上似乎不太好。py脚本，除非它们被实时部署。为了用机器学习的力量来改变人类，这个模型需要以一种大众可用的方式来部署，而不仅仅是领域专家。为了实现这一点，ML模型被封装在REST APIs中，其他应用程序可以使用这些API与模型进行通信。浏览整篇文章，查看一下吧。</em></p><blockquote class="jp"><p id="6a0c" class="jq jr hi bd js jt ju jv jw jx jy jn dx translated">我们开始吧！</p></blockquote><blockquote class="jz ka kb"><p id="bd20" class="iq ir jo is b it kc iv iw ix kd iz ja ke kf jd je kg kh jh ji ki kj jl jm jn hb bi translated"><strong class="is hj">部署机器学习模型的方法</strong></p></blockquote><p id="fa3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">经过大量的探索，这里有两种方法可以让我们在现实世界中部署机器学习模型。</p><ul class=""><li id="ecad" class="kk kl hi is b it iu ix iy jb km jf kn jj ko jn kp kq kr ks bi translated"><strong class="is hj">用全球开发者广泛使用的编程语言</strong>重新构建整个代码，然而这变得非常困难，因为用javascript这样的语言重写代码需要大量的精力和时间，效率很低。</li><li id="7c83" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated"><strong class="is hj">另一种方法是API方法，其中Web API</strong>使得跨语言应用程序很容易工作。如果前端开发人员需要使用您的机器学习模型来创建一个ML支持的web应用程序，他们只需要获得API的端点来获得预测。'</li></ul><blockquote class="jz ka kb"><p id="25e2" class="iq ir jo is b it iu iv iw ix iy iz ja ke jc jd je kg jg jh ji ki jk jl jm jn hb bi translated"><strong class="is hj"> API的介绍</strong></p></blockquote><p id="d877" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">基本上，API是两个软件之间的协议，即如果用户软件以预定义的格式提供输入，后者扩展其功能并向用户软件提供结果。</p><p id="16b2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如今，web已经成为API的中心。如果你在网上闲逛，那么肯定会用到API。在社交媒体上分享东西，在网上支付，通过社交手柄显示推文列表，所有这些服务都在背后使用API。</p><p id="9d66" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">大多数大型云提供商和专注于机器学习的小型公司都提供现成的API。它们迎合了那些没有ML专业知识，但希望在他们的过程或产品套件中实现ML的开发人员/企业的需求。</p><blockquote class="jz ka kb"><p id="c28e" class="iq ir jo is b it iu iv iw ix iy iz ja ke jc jd je kg jg jh ji ki jk jl jm jn hb bi translated"><strong class="is hj">与原料药相关的术语</strong></p></blockquote><ul class=""><li id="05e5" class="kk kl hi is b it iu ix iy jb km jf kn jj ko jn kp kq kr ks bi translated"><strong class="is hj">访问</strong>:用户或谁被允许请求数据或服务？</li><li id="3b6a" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated"><strong class="is hj">请求</strong>:请求的是实际的数据或服务</li><li id="c650" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated"><strong class="is hj">方法</strong>:即你可以问的问题，假设你有权限(它还定义了可用的响应类型)。</li><li id="ff8e" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated"><strong class="is hj">参数</strong>:您可以在问题或回答中包含的其他详细信息。</li><li id="8861" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated"><strong class="is hj">响应</strong>:作为您请求的结果的数据或服务。</li></ul><blockquote class="jp"><p id="0284" class="jq jr hi bd js jt ky kz la lb lc jn dx translated"><strong class="ak">没有更多的理论了，让我们开始研究Flask REST应用程序。</strong></p></blockquote><blockquote class="jz ka kb"><p id="e46d" class="iq ir jo is b it kc iv iw ix kd iz ja ke kf jd je kg kh jh ji ki kj jl jm jn hb bi translated"><strong class="is hj">先决条件和环境设置</strong></p></blockquote><p id="c7f1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">伙计们，我一直认为你们将能够创建机器学习模型，为它们提供培训，并在以后使用它们来预测python中的结果。这篇文章旨在提供关于将机器学习模型部署到小规模生产中的见解。</p><p id="783b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在库之后，我们需要启动我们的flask应用程序</p><ul class=""><li id="7733" class="kk kl hi is b it iu ix iy jb km jf kn jj ko jn kp kq kr ks bi translated">一个基于python的简单易用的web框架。这些是<a class="ae ld" href="http://flask.pocoo.org/docs/1.0/" rel="noopener ugc nofollow" target="_blank">文件</a>。</li><li id="50d8" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated"><a class="ae ld" href="https://docs.python.org/2/library/pickle.html" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> pickle </strong> </a>:原生python库，将python对象作为文件保存(序列化)和加载(反序列化)到磁盘上。</li><li id="8e3a" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated"><a class="ae ld" href="https://flask-cors.readthedocs.io/en/latest/api.html" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> flask_cors </strong> </a>:用于cors集管。</li><li id="4f28" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated"><a class="ae ld" href="https://github.com/flask-restful/flask-restful" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">Flask-RESTful</strong></a><strong class="is hj">:</strong>Flask-RESTful为创建一个伟大的REST API提供了构建块。</li><li id="67c2" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated">根据需要的其他学习图书馆，如numpy、pandas、sklearn等。</li></ul><p id="f839" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用pip工具安装上述软件包。</p><blockquote class="jz ka kb"><p id="8709" class="iq ir jo is b it iu iv iw ix iy iz ja ke jc jd je kg jg jh ji ki jk jl jm jn hb bi translated"><strong class="is hj">机器学习模型流程</strong></p></blockquote><figure class="lf lg lh li fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es le"><img src="../Images/674826be88bcd504a75e6266838fff74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_16pH_kngepp3IZJ41jNXg.png"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">来源:<a class="ae ld" rel="noopener" href="/@dvelsner/deploying-a-simple-machine-learning-model-in-a-modern-web-application-flask-angular-docker-a657db075280">https://medium . com/@ dvelsner/deploying-a-simple-machine-learning-model-in-a-modern-web-application-flask-angular-docker-a 657 db 075280</a></figcaption></figure><p id="1eaa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">谈论ML模型工作流程从模型的部署和创建开始。然而，我已经创建了机器学习模型，用于解决患有心脏病的患者的问题。使用的数据集可在<a class="ae ld" href="https://www.kaggle.com/ronitf/heart-disease-uci" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><p id="4a18" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">有兴趣了解这款机型的可以参考我的</em> <a class="ae ld" href="https://github.com/shashwatwork/Heart_Disease_prediction" rel="noopener ugc nofollow" target="_blank"> <em class="jo"> github库</em> </a> <em class="jo">。我不太关心模型的准确性，而且我专注于Flask APIs的部署。</em></p><blockquote class="jz ka kb"><p id="5593" class="iq ir jo is b it iu iv iw ix iy iz ja ke jc jd je kg jg jh ji ki jk jl jm jn hb bi translated"><strong class="is hj">保存机器学习模型序列化&amp;反序列化</strong></p></blockquote><p id="b79e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就计算机科学而言，nerds S <em class="jo">序列化是将数据结构或对象状态转换成可以存储(例如，存储在文件或内存缓冲区中，或通过网络连接传输)的格式，并在同一或另一个计算机环境中重新构建的过程。</em></p><p id="81e3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">主要是机器学习模型被串行化，然后再被去串行化，以便根据机器学习模型进行预测。一个名为pickle的模块帮助在python中执行序列化和反序列化。我们甚至提取了标准的scaler对象，它可用于将特征转换为平均值，并缩放为单位方差。坚持让你省时省事，即使最初的实现看起来很可笑。</p><p id="2616" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">及时缝针省九针！</p><p id="9866" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">用于序列化的Python代码:</em></p><figure class="lf lg lh li fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="04da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">用于反序列化的Python代码:</em></p><figure class="lf lg lh li fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><blockquote class="jz ka kb"><p id="8fdb" class="iq ir jo is b it iu iv iw ix iy iz ja ke jc jd je kg jg jh ji ki jk jl jm jn hb bi translated"><strong class="is hj">使用烧瓶构建REST API</strong></p></blockquote><ul class=""><li id="0bde" class="kk kl hi is b it iu ix iy jb km jf kn jj ko jn kp kq kr ks bi translated"><strong class="is hj"> <em class="jo">文件夹结构</em> </strong></li></ul><p id="49a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在构建任何Flask应用程序之前，遵循正确的文件夹结构是很重要的。因此，您的REST应用程序将能够快速获取所需的资源。下面是我遵循的文件夹结构</p><figure class="lf lg lh li fd ij er es paragraph-image"><div class="er es lp"><img src="../Images/8c5ca756f54544fd468896f639c83aea.png" data-original-src="https://miro.medium.com/v2/resize:fit:334/format:webp/1*xpWGgDd0tJ-DQ4Ew_0YaEg.png"/></div></figure><p id="1e47" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里我们有。html文件及其各自的CSS和javascript将被复制到xaamp目录下的文件夹<em class="jo"> htdocs/中。此外，我们还保留了模型并缩放了pickle文件。<em class="jo">有一点我想说清楚，这里我们使用xaamp(Apache webserver)来访问我们的REST API，并从app.py获得预测结果。</em></em></p><ul class=""><li id="68ae" class="kk kl hi is b it iu ix iy jb km jf kn jj ko jn kp kq kr ks bi translated"><strong class="is hj">烧瓶支架应用程序开发</strong></li></ul><p id="46d9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在构建REST应用程序时，应该记住以下术语。它在构造我们的包装器函数中起主要作用，<em class="jo"> Predictheart(Resource) </em>:</p><ul class=""><li id="5586" class="kk kl hi is b it iu ix iy jb km jf kn jj ko jn kp kq kr ks bi translated">获取<code class="du lq lr ls lt b">request</code>数据(要对其进行预测)</li><li id="3505" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated">加载我们的模型持久性文件</li><li id="30bb" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated"><code class="du lq lr ls lt b">jsonify</code>我们使用javascript进行预测，并用<code class="du lq lr ls lt b">status code: 200</code>发回响应</li></ul><pre class="lf lg lh li fd lu lt lv lw aw lx bi"><span id="9c16" class="ly lz hi lt b fi ma mb l mc md">from flask import Flask, request, render_template<br/>import pickle<br/>import numpy as np<br/>from flask_restful import Api,Resource<br/>from flask_cors import CORS<br/>import seaborn as se<br/>import pandas as pd</span><span id="83d8" class="ly lz hi lt b fi me mb l mc md">app = Flask(__name__)</span><span id="57fc" class="ly lz hi lt b fi me mb l mc md">CORS(app)</span><span id="4f3f" class="ly lz hi lt b fi me mb l mc md">API_NAME = Api(app)</span><span id="7e1a" class="ly lz hi lt b fi me mb l mc md">app.config['SECRET_KEY'] = 'disable the web security'</span><span id="1811" class="ly lz hi lt b fi me mb l mc md">app.config['CORS_HEADERS'] = 'Content-Type'</span><span id="1802" class="ly lz hi lt b fi me mb l mc md">class Predictheart(Resource):</span><span id="3329" class="ly lz hi lt b fi me mb l mc md">def get(self, vizdata):</span><span id="6609" class="ly lz hi lt b fi me mb l mc md">info = vizdata.split(",")</span><span id="f2b5" class="ly lz hi lt b fi me mb l mc md">age = int(info[0])</span><span id="784c" class="ly lz hi lt b fi me mb l mc md">sex = int(info[1])</span><span id="3f4d" class="ly lz hi lt b fi me mb l mc md">chest_pain_type = float(info[2])</span><span id="1585" class="ly lz hi lt b fi me mb l mc md">resting_blood_pressure = float(info[3])</span><span id="724d" class="ly lz hi lt b fi me mb l mc md">cholesterol = float(info[4])</span><span id="8cc7" class="ly lz hi lt b fi me mb l mc md">fasting_blood_sugar = float(info[5])</span><span id="fd1a" class="ly lz hi lt b fi me mb l mc md">rest_ecg = float(info[6])</span><span id="12de" class="ly lz hi lt b fi me mb l mc md">max_heart_rate_achieved = float(info[7])</span><span id="cd0c" class="ly lz hi lt b fi me mb l mc md">exercise_induced_angina = float(info[8])</span><span id="9574" class="ly lz hi lt b fi me mb l mc md">st_depression = float(info[9])</span><span id="9600" class="ly lz hi lt b fi me mb l mc md">st_slope = float(info[10])</span><span id="34f8" class="ly lz hi lt b fi me mb l mc md">num_major_vessels = float(info[11])</span><span id="4d54" class="ly lz hi lt b fi me mb l mc md">thalassemia = float(info[12])</span><span id="0c7e" class="ly lz hi lt b fi me mb l mc md">model = load_model()</span><span id="607c" class="ly lz hi lt b fi me mb l mc md">data = ([[age, sex, chest_pain_type, resting_blood_pressure,cholesterol,fasting_blood_sugar,rest_ecg,max_heart_rate_achieved,exercise_induced_angina,st_depression,st_slope, num_major_vessels,thalassemia]])</span><span id="0819" class="ly lz hi lt b fi me mb l mc md">col = ['age', 'sex', 'chest_pain_type', 'resting_blood_pressure','cholesterol','fasting_blood_sugar','rest_ecg','max_heart_rate_achieved','exercise_induced_angina','st_depression','st_slope', 'num_major_vessels','thalassemia']</span><span id="f351" class="ly lz hi lt b fi me mb l mc md">data = pd.DataFrame(data,columns = col)</span><span id="3f0b" class="ly lz hi lt b fi me mb l mc md">data = data_scaling(data)</span><span id="9472" class="ly lz hi lt b fi me mb l mc md">data = model.predict(data)</span><span id="0f71" class="ly lz hi lt b fi me mb l mc md">if data == 0:</span><span id="f84c" class="ly lz hi lt b fi me mb l mc md">result = "No"</span><span id="e2c3" class="ly lz hi lt b fi me mb l mc md">else:</span><span id="eb29" class="ly lz hi lt b fi me mb l mc md">result = "Yes"</span><span id="0101" class="ly lz hi lt b fi me mb l mc md"># return render_template('result.html', glycohemoglobin=abs(round(w_glyco)*10), glucose_serum=abs(round(w_gluco)*10), albumin_urine=abs(round(w_albumin)*10), pred=result)</span><span id="e0d4" class="ly lz hi lt b fi me mb l mc md">return {'isHeart': result}</span><span id="662f" class="ly lz hi lt b fi me mb l mc md">API_NAME.add_resource(Predictheart, '/heartpredict/viz/&lt;vizdata&gt;', methods=['POST', 'GET'])</span><span id="0ae5" class="ly lz hi lt b fi me mb l mc md">def load_model():</span><span id="a918" class="ly lz hi lt b fi me mb l mc md">"""This function load the pickled model as API for flask</span><span id="bce2" class="ly lz hi lt b fi me mb l mc md">:returns: loaded_model</span><span id="c1aa" class="ly lz hi lt b fi me mb l mc md">:rtype: float64</span><span id="0e6d" class="ly lz hi lt b fi me mb l mc md">method's invoked:  None"""</span><span id="ad5c" class="ly lz hi lt b fi me mb l mc md">loaded_model = pickle.load(open('rf_model.pkl', 'rb'))</span><span id="17ca" class="ly lz hi lt b fi me mb l mc md">return loaded_model<br/></span><span id="712b" class="ly lz hi lt b fi me mb l mc md">def data_scaling(df):</span><span id="3eaf" class="ly lz hi lt b fi me mb l mc md">cont_data = df.values</span><span id="eabf" class="ly lz hi lt b fi me mb l mc md">m = open('scaled_model.pkl', 'rb')</span><span id="f9e8" class="ly lz hi lt b fi me mb l mc md">model = pickle.load(m)</span><span id="8e72" class="ly lz hi lt b fi me mb l mc md">cont_data = model.transform(cont_data)</span><span id="6d72" class="ly lz hi lt b fi me mb l mc md">return cont_data</span><span id="4e90" class="ly lz hi lt b fi me mb l mc md">if __name__ == '__main__':</span><span id="dcb4" class="ly lz hi lt b fi me mb l mc md">app.run(host='localhost', port=5000, debug=True, threaded=True)</span></pre><p id="98a1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面的代码片段看起来很复杂，让我来给你解释一下。</p><ul class=""><li id="702c" class="kk kl hi is b it iu ix iy jb km jf kn jj ko jn kp kq kr ks bi translated">有两个辅助函数，即<em class="jo"> load_model()和data_scaling()。</em>这些函数用于加载持久化pickle文件，以进行标准缩放，并预测命中REST Apis的原始输入<em class="jo">。</em></li><li id="814f" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated">正如您在导入部分看到的，我们已经从<em class="jo"> flask_restful </em>库中获取了<em class="jo">资源</em>和<em class="jo"> Api </em>模块。Api主要用于创建一个对象来访问flask restful中可用的方法。资源构建在<a class="ae ld" href="http://flask.pocoo.org/docs/views/" rel="noopener ugc nofollow" target="_blank"> Flask pluggable views </a>之上，只需在资源上定义方法，就可以轻松访问多个HTTP方法。</li><li id="e803" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated">接下来，我们创建了一个python类<em class="jo"> Predictheart(Resources) </em>，它封装了方法<em class="jo"> get(self，vizdata)。</em>这个方法中传递的参数基本上包含了我们从REST APIs中获得的数据。<em class="jo"> Flask-RESTful理解视图方法的多种返回值</em>。与Flask类似，您可以返回任何iterable，它将被转换为响应，包括原始Flask响应对象。</li><li id="d347" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated"><em class="jo"> Api </em>对象上的<em class="jo">add _ resource()</em>方法。每个都将被路由到您的资源。您的端点将使用<em class="jo">/heart prediction/viz/&lt;viz data&gt;</em>创建。如果请求与应用程序的任何端点都不匹配，Flask-RESTful将返回404错误消息。</li><li id="dce0" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated">在add_resource()方法中，我们同时处理GET和POST请求。然而，我们使用本地主机在端口5000上运行这个应用程序，所以最终的端点看起来像这样。</li></ul><pre class="lf lg lh li fd lu lt lv lw aw lx bi"><span id="f909" class="ly lz hi lt b fi ma mb l mc md">127.0.0.1 “GET /heartpredict/viz/21,1,1,124,12,126,0,60,0,13,1,33,1 HTTP/1.1”</span></pre><ul class=""><li id="1309" class="kk kl hi is b it iu ix iy jb km jf kn jj ko jn kp kq kr ks bi translated">发出GET请求后得到的值将被推送到<em class="jo"> data_scaling() </em>函数，随后是<em class="jo"> load_model() </em>函数，该函数抛出将被jsonify以插入HTML页面的预测。</li><li id="9a25" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated">处理CORS请求并发送响应。</li></ul><p id="493a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">跨起点请求由flask CORS python包处理，默认情况下，该包在所有路线上为所有起点和方法启用CORS支持。它允许在每个资源级别上对所有CORS头进行参数化。</p><pre class="lf lg lh li fd lu lt lv lw aw lx bi"><span id="1d56" class="ly lz hi lt b fi ma mb l mc md">&lt;script&gt;</span><span id="8c03" class="ly lz hi lt b fi me mb l mc md">function validateForm()</span><span id="df10" class="ly lz hi lt b fi me mb l mc md">{</span><span id="260e" class="ly lz hi lt b fi me mb l mc md">var alu = document.forms["predictions"]["aul"].value;</span><span id="d1b8" class="ly lz hi lt b fi me mb l mc md">var ucl = document.forms["predictions"]["ucl"].value;</span><span id="73c2" class="ly lz hi lt b fi me mb l mc md">var acl = document.forms["predictions"]["acl"].value;</span><span id="d987" class="ly lz hi lt b fi me mb l mc md">var cl = document.forms["predictions"]["cl"].value;</span><span id="4209" class="ly lz hi lt b fi me mb l mc md">var grsl = document.forms["predictions"]["grsl"].value;</span><span id="13e3" class="ly lz hi lt b fi me mb l mc md">var irsl = document.forms["predictions"]["irsl"].value;</span><span id="99ed" class="ly lz hi lt b fi me mb l mc md">var ld = document.forms["predictions"]["ld"].value;</span><span id="255a" class="ly lz hi lt b fi me mb l mc md">var ol = document.forms["predictions"]["ol"].value;</span><span id="e797" class="ly lz hi lt b fi me mb l mc md">var rc = document.forms["predictions"]["rc"].value;</span><span id="2858" class="ly lz hi lt b fi me mb l mc md">var plc = document.forms["predictions"]["plc"].value;</span><span id="ef7b" class="ly lz hi lt b fi me mb l mc md">var glyl = document.forms["predictions"]["glyl"].value;</span><span id="77ff" class="ly lz hi lt b fi me mb l mc md">var uc = document.forms["predictions"]["uc"].value;</span><span id="cb4c" class="ly lz hi lt b fi me mb l mc md">var uf = document.forms["predictions"]["uf"].value;</span><span id="7fa6" class="ly lz hi lt b fi me mb l mc md">var col_val = [alu,ucl,acl,cl,grsl,irsl,ld,ol,rc,plc,glyl,uc,uf];</span><span id="61c2" class="ly lz hi lt b fi me mb l mc md">alert(col_val);</span><span id="b7b3" class="ly lz hi lt b fi me mb l mc md">console.log(col_val);</span><span id="3f36" class="ly lz hi lt b fi me mb l mc md">var data1;</span><span id="105f" class="ly lz hi lt b fi me mb l mc md">function createCORSRequest(method, url)</span><span id="7f1c" class="ly lz hi lt b fi me mb l mc md">{</span><span id="757a" class="ly lz hi lt b fi me mb l mc md">var xhr = new XMLHttpRequest();</span><span id="9d3c" class="ly lz hi lt b fi me mb l mc md">if ("withCredentials" in xhr)</span><span id="2e2f" class="ly lz hi lt b fi me mb l mc md">{</span><span id="042d" class="ly lz hi lt b fi me mb l mc md">xhr.open(method,url,true);</span><span id="55ec" class="ly lz hi lt b fi me mb l mc md">}</span><span id="133b" class="ly lz hi lt b fi me mb l mc md">else if (typeof XDomainRequest != "undefined")</span><span id="5732" class="ly lz hi lt b fi me mb l mc md">{</span><span id="55fb" class="ly lz hi lt b fi me mb l mc md">xhr = new XDomainRequest();</span><span id="8502" class="ly lz hi lt b fi me mb l mc md">xhr.open(method, url);</span><span id="40cd" class="ly lz hi lt b fi me mb l mc md">}</span><span id="433e" class="ly lz hi lt b fi me mb l mc md">else</span><span id="f544" class="ly lz hi lt b fi me mb l mc md">{</span><span id="d3e1" class="ly lz hi lt b fi me mb l mc md">xhr =null;</span><span id="0ff5" class="ly lz hi lt b fi me mb l mc md">}</span><span id="9a21" class="ly lz hi lt b fi me mb l mc md">return xhr;</span><span id="32cb" class="ly lz hi lt b fi me mb l mc md">}</span><span id="c1de" class="ly lz hi lt b fi me mb l mc md">function makeCorsRequest()</span><span id="246d" class="ly lz hi lt b fi me mb l mc md">{</span><span id="8225" class="ly lz hi lt b fi me mb l mc md">var url = 'http://localhost:5000/heartpredict/viz/'+col_val;</span><span id="5b85" class="ly lz hi lt b fi me mb l mc md">var xhr = createCORSRequest('GET', url);</span><span id="00fe" class="ly lz hi lt b fi me mb l mc md">if(!xhr)</span><span id="ddcf" class="ly lz hi lt b fi me mb l mc md">{</span><span id="585e" class="ly lz hi lt b fi me mb l mc md">return;</span><span id="afa3" class="ly lz hi lt b fi me mb l mc md">}</span><span id="a546" class="ly lz hi lt b fi me mb l mc md">xhr.onload = function()</span><span id="fc8c" class="ly lz hi lt b fi me mb l mc md">{</span><span id="0b49" class="ly lz hi lt b fi me mb l mc md">data1 = JSON.parse(xhr.responseText);</span><span id="8b01" class="ly lz hi lt b fi me mb l mc md">alert(data1);</span><span id="70e8" class="ly lz hi lt b fi me mb l mc md">load(data1);</span><span id="a632" class="ly lz hi lt b fi me mb l mc md">};</span><span id="0df3" class="ly lz hi lt b fi me mb l mc md">xhr.onerror = function()</span><span id="f5fe" class="ly lz hi lt b fi me mb l mc md">{</span><span id="253c" class="ly lz hi lt b fi me mb l mc md">};</span><span id="f2e9" class="ly lz hi lt b fi me mb l mc md">xhr.send();</span><span id="181a" class="ly lz hi lt b fi me mb l mc md">}</span><span id="c7c4" class="ly lz hi lt b fi me mb l mc md">makeCorsRequest();</span><span id="773f" class="ly lz hi lt b fi me mb l mc md">function load(data1)</span><span id="115b" class="ly lz hi lt b fi me mb l mc md">{</span><span id="26ef" class="ly lz hi lt b fi me mb l mc md">var tr = data1;</span><span id="c119" class="ly lz hi lt b fi me mb l mc md">var html = "&lt;h3&gt; "+tr['isHeart']+"&lt;/h3&gt;";</span><span id="e2e5" class="ly lz hi lt b fi me mb l mc md">$("#result_t2d").html("");</span><span id="18c6" class="ly lz hi lt b fi me mb l mc md">$('#result_t2d').append(html);</span><span id="6200" class="ly lz hi lt b fi me mb l mc md">console.log(tr['isHeart']);</span><span id="7ac1" class="ly lz hi lt b fi me mb l mc md">console.log(tr);</span><span id="f013" class="ly lz hi lt b fi me mb l mc md">}</span><span id="0ecf" class="ly lz hi lt b fi me mb l mc md">}</span><span id="ef73" class="ly lz hi lt b fi me mb l mc md">$("#contact-form").submit(function(e) {</span><span id="f242" class="ly lz hi lt b fi me mb l mc md">e.preventDefault();</span><span id="9d81" class="ly lz hi lt b fi me mb l mc md">});</span><span id="3ba2" class="ly lz hi lt b fi me mb l mc md">&lt;/script&gt;</span></pre><ul class=""><li id="c980" class="kk kl hi is b it iu ix iy jb km jf kn jj ko jn kp kq kr ks bi translated">在javascript上面，函数<em class="jo"> validateform() </em>用于从。html页面，并将其传递给javascript函数<em class="jo"> makeCorsRequest()。</em></li><li id="ab31" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated">在<em class="jo"> validateform </em>()和<em class="jo"> makeCorsRequest </em>()函数之间，我们有<em class="jo"> createCORSRequest </em>()用help GET方法和rest apis端点创建跨源请求。</li><li id="7426" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated">最后，我们使用JSON解析来解析来自flask python应用程序的响应，并将其扔给前端应用程序UI。</li></ul><blockquote class="jz ka kb"><p id="0aaa" class="iq ir jo is b it iu iv iw ix iy iz ja ke jc jd je kg jg jh ji ki jk jl jm jn hb bi translated"><strong class="is hj">烧瓶支架应用示例</strong></p></blockquote><p id="99e1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我已经创建了一个简单的单页面模板，可以用来通过HTML表单接收输入特性，并向API发出获取结果的请求。即使你不精通HTML-CSS-JavaScript，你也可以很容易地编辑这个模板。</p><figure class="lf lg lh li fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/da055c51e34897dd6f85909da350b0da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H2Q1Bo389ARv-OPt7Ixn2w.png"/></div></div></figure><p id="cc4f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">模板、Flask REST应用程序以及用于开发预测心脏病的机器学习模型的jupyter notebook可在</em> <a class="ae ld" href="https://github.com/shashwatwork/Heart_Disease_prediction" rel="noopener ugc nofollow" target="_blank"> <em class="jo"> Github存储库中获得。</em> </a></p><blockquote class="jz ka kb"><p id="310c" class="iq ir jo is b it iu iv iw ix iy iz ja ke jc jd je kg jg jh ji ki jk jl jm jn hb bi translated"><strong class="is hj">最终</strong></p></blockquote><p id="0860" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇博客促使您创建简单的flask rest API，这将有助于数据产品的原型化，使其成为功能完整、生产就绪的API还需要一些额外的东西，这不在这篇博客的范围之内。在创建API时，我考虑了以下几点</p><ul class=""><li id="4926" class="kk kl hi is b it iu ix iy jb km jf kn jj ko jn kp kq kr ks bi translated">分析您的机器学习工作流程，以创建干净、可用的API。会节省很多努力和时间。</li><li id="fc52" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated">利用管道和自定义估算器进行预处理或任何其他相关任务。此外，确保评估器以及训练代码应该与持久模型一起保存。</li><li id="c833" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated">使用flask的主要缺点是它不提供版本控制。机器学习模型的持续和跟踪在flask中似乎很复杂。<a class="ae ld" rel="noopener" href="/towards-data-science/how-to-version-control-your-machine-learning-task-cad74dce44c4">这里的</a>是有帮助的文章。</li></ul><blockquote class="jz ka kb"><p id="d7fc" class="iq ir jo is b it iu iv iw ix iy iz ja ke jc jd je kg jg jh ji ki jk jl jm jn hb bi translated"><strong class="is hj">参考文献</strong></p></blockquote><ul class=""><li id="ebda" class="kk kl hi is b it iu ix iy jb km jf kn jj ko jn kp kq kr ks bi translated"><a class="ae ld" href="https://flask-cors.readthedocs.io/en/latest/api.html" rel="noopener ugc nofollow" target="_blank">https://flask-cors.readthedocs.io/en/latest/api.html</a></li><li id="2f89" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated"><a class="ae ld" href="https://flask-restful.readthedocs.io/en/0.3.6/quickstart.html" rel="noopener ugc nofollow" target="_blank">https://flask-restful . readthedocs . io/en/0 . 3 . 6/quick start . html</a></li><li id="e3b3" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated"><a class="ae ld" rel="noopener" href="/analytics-vidhya/how-to-deploy-simple-machine-learning-models-for-free-56cdccc62b8d">https://medium . com/analytics-vid hya/how-to-deploy-simple-machine-learning-models-for-free-56 cdccc 62 b 8d</a></li><li id="b3f5" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated"><a class="ae ld" href="http://blog.luisrei.com/articles/flaskrest.html" rel="noopener ugc nofollow" target="_blank">http://blog.luisrei.com/articles/flaskrest.html</a></li><li id="d505" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated"><a class="ae ld" href="https://www.analyticsvidhya.com/blog/2017/09/machine-learning-models-as-apis-using-flask/" rel="noopener ugc nofollow" target="_blank">https://www . analyticsvidhya . com/blog/2017/09/machine-learning-models-as-APIs-using-flask/</a></li><li id="3259" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated"><a class="ae ld" rel="noopener" href="/@dvelsner/deploying-a-simple-machine-learning-model-in-a-modern-web-application-flask-angular-docker-a657db075280">https://medium . com/@ dvelsner/deploying-a-simple-machine-learning-model-in-a-modern-web-application-flask-angular-docker-a 657 db 075280</a></li><li id="839b" class="kk kl hi is b it kt ix ku jb kv jf kw jj kx jn kp kq kr ks bi translated"><a class="ae ld" href="https://www.w3schools.com/bootstrap/bootstrap_ver.asp" rel="noopener ugc nofollow" target="_blank">https://www.w3schools.com/bootstrap/bootstrap_ver.asp</a></li></ul><p id="a7f9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你喜欢这个帖子，请跟我来，只要你认为我值得，就按下那个按钮。如果你注意到思维方式、公式、动画或代码有任何错误，请告诉我。</p><p id="fd3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">干杯！</em></p></div></div>    
</body>
</html>