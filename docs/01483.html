<html>
<head>
<title>D3 + DS: Part 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">D3 + DS:第4部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/d3-ds-part-4-add657154679?source=collection_archive---------11-----------------------#2019-10-25">https://medium.com/analytics-vidhya/d3-ds-part-4-add657154679?source=collection_archive---------11-----------------------#2019-10-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="9dff" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">条形图和散点图</h2></div><blockquote class="ix iy iz"><p id="7714" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">我在这篇文章中提到的可视化可以在<a class="ae jx" href="http://ltjds.github.io/post/d3pds_1/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></blockquote><h1 id="5c8b" class="jy jz hi bd ka kb kc kd ke kf kg kh ki io kj ip kk ir kl is km iu kn iv ko kp bi translated">介绍</h1><p id="bcd1" class="pw-post-body-paragraph ja jb hi jd b je kq ij jg jh kr im jj ks kt jm jn ku kv jq jr kw kx ju jv jw hb bi translated">同样，这个中级系列的目的是记录我有效使用D3的过程中的关键点。对于每个帖子，我都会在我的<a class="ae jx" href="http://ltjds.github.io" rel="noopener ugc nofollow" target="_blank">博客</a>上有一个相应的帖子，展示一个可视化，在这里我将讨论制作可视化所涉及的一些主要概念。这些帖子不是为了教你如何使用D3 ，但是</p><blockquote class="ky"><p id="d846" class="kz la hi bd lb lc ld le lf lg lh jw dx translated">这个系列将帮助您更好地理解有时会被忽略的深奥的D3概念。</p></blockquote><p id="b996" class="pw-post-body-paragraph ja jb hi jd b je li ij jg jh lj im jj ks lk jm jn ku ll jq jr kw lm ju jv jw hb bi translated">我们将从非常简单的<em class="jc">开始(例如，一个柱状图和散点图)，最终我希望使用谷歌云应用引擎上的API来构建更复杂的D3 web应用。</em></p><figure class="lo lp lq lr fd ls er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es ln"><img src="../Images/0f0df2a9a6765977742ea3d45594eada.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*l5vtbT-kWgqLe71C.png"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx translated">所有的JavaScripts。</figcaption></figure><h1 id="5a02" class="jy jz hi bd ka kb kc kd ke kf kg kh ki io kj ip kk ir kl is km iu kn iv ko kp bi translated">约定</h1><p id="401b" class="pw-post-body-paragraph ja jb hi jd b je kq ij jg jh kr im jj ks kt jm jn ku kv jq jr kw kx ju jv jw hb bi translated">在用JavaScript编写了一些代码后，看了看其他人的代码(甚至除了斯考特·玛瑞的)，我发现我应该考虑改变我的变量约定。从现在开始，我采用了一些我认为很有效的方法:</p><p id="350a" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj ks jl jm jn ku jp jq jr kw jt ju jv jw hb bi translated">在HTML和CSS中:</p><ul class=""><li id="21a5" class="md me hi jd b je jf jh ji ks mf ku mg kw mh jw mi mj mk ml bi translated">任何不是特殊关键字的东西:带连字符的文本(例如，<code class="du mm mn mo mp b">my-new-id</code>)</li></ul><p id="d78e" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj ks jl jm jn ku jp jq jr kw jt ju jv jw hb bi translated">在Python中:</p><ul class=""><li id="58cf" class="md me hi jd b je jf jh ji ks mf ku mg kw mh jw mi mj mk ml bi translated">变量和函数:小写，带下划线(如<code class="du mm mn mo mp b">var_1</code>)</li><li id="1543" class="md me hi jd b je mq jh mr ks ms ku mt kw mu jw mi mj mk ml bi translated">类别:帕斯卡格，或大写的骆驼格(例如，<code class="du mm mn mo mp b">TextDecomposition</code>)</li></ul><p id="4953" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj ks jl jm jn ku jp jq jr kw jt ju jv jw hb bi translated">在JS中:</p><ul class=""><li id="6558" class="md me hi jd b je jf jh ji ks mf ku mg kw mh jw mi mj mk ml bi translated">变量:带下划线的小写字母(如<code class="du mm mn mo mp b">var_1</code>)</li><li id="622a" class="md me hi jd b je mq jh mr ks ms ku mt kw mu jw mi mj mk ml bi translated">功能和分类:骆驼案(如<code class="du mm mn mo mp b">sizeScale</code>)</li></ul><p id="cfa9" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj ks jl jm jn ku jp jq jr kw jt ju jv jw hb bi translated">这里(即在上面的JavaScript中)与标准只有微小的不同，但我认为这至少比将一种语言(即Python)的惯例完全强加于另一种语言要好。也许这会让我的代码更容易被别人接受。</p><h1 id="85dc" class="jy jz hi bd ka kb kc kd ke kf kg kh ki io kj ip kk ir kl is km iu kn iv ko kp bi translated">条形图</h1><figure class="lo lp lq lr fd ls er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mv"><img src="../Images/45832973f60084dd59cf90dfc3897fba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UKzo5FrykhL8oTfArCG3yw.png"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx translated">一个条形图，从D3s的角度来看。它不在乎。</figcaption></figure><p id="35e8" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj ks jl jm jn ku jp jq jr kw jt ju jv jw hb bi translated">在D3上构建柱状图的最大收获之一来自于我们在编写柱状图时对柱状图的思考方式。通常，当我们使用MS Excel、Matplotlib，甚至Plot.ly来构建一个条形图(如果矩形是垂直的，实际上称为“柱形图”)时，我们将所发生的事情概念化为类似这样的事情:<em class="jc">我需要给平台(例如plot.ly)一个</em> <strong class="jd hj"> <em class="jc"> n </em> </strong> <em class="jc">标签-值对的列表，平台将从</em></p><p id="1c0f" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj ks jl jm jn ku jp jq jr kw jt ju jv jw hb bi translated">然而，D3的情况并非如此。请记住，在一天结束时，在D3中，我们正在“绘制”一个SVG，而SVG没有轴的概念，也没有某种条形图框架/设计。所以，我们需要告诉它在哪里放置条形图的所有组件。你可以查看与博客上的图相对应的JavaScript代码<a class="ae jx" href="https://github.com/ltjds/blog/tree/master/static/js/d3pds" rel="noopener ugc nofollow" target="_blank">,看看不同的组件是如何绑定的，以及它们是如何绘制的。</a></p><h2 id="e7a9" class="mw jz hi bd ka mx my mz ke na nb nc ki ks nd ne kk ku nf ng km kw nh ni ko nj bi translated">几个问题</h2><ul class=""><li id="f3cb" class="md me hi jd b je kq jh kr ks nk ku nl kw nm jw mi mj mk ml bi translated">SVG中的<code class="du mm mn mo mp b">y</code>值对应于从上到下的位置<strong class="jd hj">。使用D3标度，您可以反转脚本对给定的<code class="du mm mn mo mp b">y</code>坐标的解释。</strong></li><li id="9a7c" class="md me hi jd b je mq jh mr ks ms ku mt kw mu jw mi mj mk ml bi translated">就我个人而言，我喜欢使用从上到下的坐标平面来设计我的条形图<em class="jc">的代码，简单地说，任何条形的矩形都位于<code class="du mm mn mo mp b">height — v</code>(即左上角)，其中<code class="du mm mn mo mp b">height</code>是绘图区域的高度，<code class="du mm mn mo mp b">v</code>是与条形相关联的值。查看下面的代码…</em></li></ul><pre class="lo lp lq lr fd nn mp no np aw nq bi"><span id="8ca0" class="mw jz hi mp b fi nr ns l nt nu">rect.enter()<br/>    .append("rect")<br/>    .attr("x", d =&gt; xScale(d[label_var]))<br/>    .attr("y", d =&gt; height - yScale(d[barheight_var])) // &lt;- HERE<br/>    .attr("width", xScale.bandwidth())<br/>    .attr("height", d =&gt; yScale(d[barheight_var]))<br/>    .attr("fill", function(d) {<br/>        // The next line is sloppy, until we learn color scales<br/>        return "rgb(0, 0, " + <br/>                   (200 - Math.round(d[barcolor_var])) + ")";<br/>    });</span></pre><ul class=""><li id="4254" class="md me hi jd b je jf jh ji ks mf ku mg kw mh jw mi mj mk ml bi translated">对于文本,( x，y)位置对应于文本的<a class="ae jx" href="http://facweb.cs.depaul.edu/sgrais/Type%20font_anatomy.htm" rel="noopener ugc nofollow" target="_blank">基线</a>处最左边的点。您可以使用<code class="du mm mn mo mp b">.style("text-anchor", "middle")</code>将<code class="du mm mn mo mp b">x</code>设置为中间。</li></ul><h1 id="a228" class="jy jz hi bd ka kb kc kd ke kf kg kh ki io kj ip kk ir kl is km iu kn iv ko kp bi translated">散点图</h1><p id="50b6" class="pw-post-body-paragraph ja jb hi jd b je kq ij jg jh kr im jj ks kt jm jn ku kv jq jr kw kx ju jv jw hb bi translated">一旦你能克服整个反向y轴的事情，理解一个简单的散点图的架构并不是那么糟糕。对我来说，最大的收获是避免点接触轴线。为此，我们为D3可视化创建了一个类似HTML的框架<a class="ae jx" href="https://bl.ocks.org/mbostock/3019563" rel="noopener ugc nofollow" target="_blank">,其余的维度将依赖于这个框架。</a></p><blockquote class="ix iy iz"><p id="c315" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">关于上面的“框架”链接，我在代码中做了一些修改，这样它就可以在版本5中正常工作了。试着挑出不同之处！</p></blockquote><p id="0de1" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj ks jl jm jn ku jp jq jr kw jt ju jv jw hb bi translated">另外注意，<strong class="jd hj"> <em class="jc">永远不要把圆的大小映射到半径</em> </strong>。我们应该始终将大小映射到<em class="jc">区域</em>。我们通过它覆盖的墨水量或面积来感知事物的“大”，如果我们使用半径(记住等式A = πr ),那么面积就会扭曲。也就是说，对应于值2、4、6和8的圆将被解释为大小为4、16、36和48的圆，这描绘了与现实<em class="jc">大不相同的</em>画面。</p><h1 id="e6b9" class="jy jz hi bd ka kb kc kd ke kf kg kh ki io kj ip kk ir kl is km iu kn iv ko kp bi translated">天平</h1><p id="24c1" class="pw-post-body-paragraph ja jb hi jd b je kq ij jg jh kr im jj ks kt jm jn ku kv jq jr kw kx ju jv jw hb bi translated">如果你还记得我关于绑定的讨论，你可能会意识到数据通常不会自己映射到像素，所以我们使用比例来做这件事。记住，D3可视化是D3数据绑定的可视化元素的集合。还要记住，可视化组件本身实际上是具有相应像素属性的SVG对象。每个可视元素背后的数据(例如，散点图中点的x、y和大小属性)需要被缩放，以便它们以像素形式被正确地表示。</p><figure class="lo lp lq lr fd ls er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es nv"><img src="../Images/2943f55d7b34491fbaaa3f58f03739eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SLhUdCjJ6IsY5-ADhJXCuw.png"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx translated">我描述D3音阶的初步尝试；还记得y '的自顶向下的SVG框架吗</figcaption></figure><p id="81ec" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj ks jl jm jn ku jp jq jr kw jt ju jv jw hb bi translated">D3的美妙之处在于，在扩展数据时，您只需提供</p><ol class=""><li id="4609" class="md me hi jd b je jf jh ji ks mf ku mg kw mh jw nw mj mk ml bi translated">标度(例如，线性、对数、颜色等。)</li><li id="1845" class="md me hi jd b je mq jh mr ks ms ku mt kw mu jw nw mj mk ml bi translated">一个域(进入的<em class="jc">数据</em>的最小值和最大值)</li><li id="aa6d" class="md me hi jd b je mq jh mr ks ms ku mt kw mu jw nw mj mk ml bi translated">一个范围(出现的<em class="jc">像素</em>的最小和最大值)</li></ol><blockquote class="ix iy iz"><p id="54c2" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">注意:对于这里的#3，<em class="hi">像素</em>也可以指<em class="hi">颜色</em>，就像我们使用色标一样。</p></blockquote><p id="7e32" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj ks jl jm jn ku jp jq jr kw jt ju jv jw hb bi translated">之后D3做剩下的！构建将输入转换为输出所需的等式是在幕后完成的。因此，假设您想要一个<em class="jc">线性</em>标度(即<code class="du mm mn mo mp b">.scaleLinear</code>，其中值之间的“距离”被同等地解释为数据中的内容)，您有<code class="du mm mn mo mp b">d = [10, 20, 30, 40]</code>的传入数据，但是您想要视觉元素的范围在5到20像素之间。D3做了数学计算，确定你想要的是一个<code class="du mm mn mo mp b">function</code>，它接受你的输入<code class="du mm mn mo mp b">d</code>，输出<code class="du mm mn mo mp b">1/2 * d</code>(这只是一个<em class="jc">线性</em>方程，<em class="jc"> y = 1/2x </em>)，其中输入是某个值单位，输出是像素。</p><p id="261f" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj ks jl jm jn ku jp jq jr kw jt ju jv jw hb bi translated">把音阶想象成一种转换功能，你就可以开始了。有各种各样的比例，但归根结底，它们是将数据映射到像素或颜色的函数。</p><p id="0bb2" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj ks jl jm jn ku jp jq jr kw jt ju jv jw hb bi translated">在上面的代码示例中，我忽略了<code class="du mm mn mo mp b">xScale</code>，但是应该说我使用了一个<em class="jc">序数</em> <code class="du mm mn mo mp b">scaleBand</code>，它接受一个<em class="jc">有序的</em>域(在这种情况下是文本标签)并将它们映射到它们的波段的对应点。</p><figure class="lo lp lq lr fd ls er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es nx"><img src="../Images/746e90e641f769fbd6b7f26338bf5ed5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ShUudWUwwoUv9eDR-yJ5xg.png"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx translated">乐队音阶！耶！</figcaption></figure><p id="060b" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj ks jl jm jn ku jp jq jr kw jt ju jv jw hb bi translated">既然你知道线性刻度和带状刻度是如何工作的，你可以很容易地为自己概念化如何思考<em class="jc">时间</em>刻度、<em class="jc">颜色</em>刻度、<em class="jc">对数</em>刻度等等。归根结底，这只是数据到像素(或颜色)的简单映射。</p><blockquote class="ix iy iz"><p id="9bba" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">(还有<em class="hi">名义</em>标度，其顺序无关紧要，但域也是项目列表而不是界限)。</p></blockquote><h1 id="8991" class="jy jz hi bd ka kb kc kd ke kf kg kh ki io kj ip kk ir kl is km iu kn iv ko kp bi translated">轴线</h1><p id="197d" class="pw-post-body-paragraph ja jb hi jd b je kq ij jg jh kr im jj ks kt jm jn ku kv jq jr kw kx ju jv jw hb bi translated">所以，请记住，在D3中，我们正在绘制SVG对象(线条、矩形、圆形等。).还记得D3没有一次呈现多个东西，但是它提供了浏览器这样做所需的脚本。这样，当我们在D3中设计轴时，我们实际上是在为一个脚本做准备，这个脚本将在浏览器打开页面时<em class="jc">生成</em>轴。在生成这些轴时，我们使用D3为SVG中的每个轴定义一个<code class="du mm mn mo mp b">&lt;g&gt;</code>(组)，并让D3告诉浏览器如何在给定数据绑定的情况下动态填充那个<code class="du mm mn mo mp b">&lt;g&gt;</code>标签。</p><p id="7337" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj ks jl jm jn ku jp jq jr kw jt ju jv jw hb bi translated">D3里只有<em class="jc">四个</em>异轴发电机:<code class="du mm mn mo mp b">d3.axisTop</code>、<code class="du mm mn mo mp b">d3.axisBottom</code>、<code class="du mm mn mo mp b">d3.axisLeft</code>、<code class="du mm mn mo mp b">d3.axisRight</code>。但是，这些实际上只定义了轴的外观(例如，对于<code class="du mm mn mo mp b">d3.axisBottom</code>，标签在轴的下面，默认情况下是水平的)。现在，事情是这样的，看起来很简单，不言自明，但我还是要说:</p><blockquote class="ky"><p id="0c99" class="kz la hi bd lb lc ld le lf lg lh jw dx translated">D3轴需要* <strong class="ak">数字* </strong>才能工作</p></blockquote><p id="d306" class="pw-post-body-paragraph ja jb hi jd b je li ij jg jh lj im jj ks lk jm jn ku ll jq jr kw lm ju jv jw hb bi translated">数字。不是日期、标签或百分比，而是ℝ的数字(实数)。如果是这样的话，我们是如何得到柱状图的x轴，或者散点图中的日期的呢？如上所述，我们使用<a class="ae jx" href="https://github.com/d3/d3-scale" rel="noopener ugc nofollow" target="_blank">标尺</a>来实现这一点。</p><p id="fbec" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj ks jl jm jn ku jp jq jr kw jt ju jv jw hb bi translated">最后要注意的是，记住最好在最后调用这些(轴和标题)<em class="jc">以便它们出现在顶部，因为SVG是按照代码指示的顺序绘制的。</em></p><h1 id="1e98" class="jy jz hi bd ka kb kc kd ke kf kg kh ki io kj ip kk ir kl is km iu kn iv ko kp bi translated">一般问题</h1><ul class=""><li id="787c" class="md me hi jd b je kq jh kr ks nk ku nl kw nm jw mi mj mk ml bi translated">如果您使用Pandas，<strong class="jd hj">在将数据发送到D3之前，请始终插入或删除您的NA值</strong>！否则事情看起来就不对了。</li><li id="44b9" class="md me hi jd b je mq jh mr ks ms ku mt kw mu jw mi mj mk ml bi translated">在JavaScript (ES6及更高版本)中，如果你要连接字符串和非字符串，记得在所有非字符串的两边加上括号，或者使用<code class="du mm mn mo mp b">${}</code>语法。那就是:</li></ul><pre class="lo lp lq lr fd nn mp no np aw nq bi"><span id="9a53" class="mw jz hi mp b fi nr ns l nt nu">// Version 1<br/>variableText = "blah blah" + (var1 + var2) + "other blah blah"</span><span id="6caa" class="mw jz hi mp b fi ny ns l nt nu">// Version 2<br/>variableText = `blah blah ${var}`<!-- --> </span></pre><p id="3633" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj ks jl jm jn ku jp jq jr kw jt ju jv jw hb bi translated">我发现自己在使用版本1时遗漏了括号，并且在试图弄清楚发生了什么时感到沮丧…</p><ul class=""><li id="9ecb" class="md me hi jd b je jf jh ji ks mf ku mg kw mh jw mi mj mk ml bi translated"><strong class="jd hj">保持更新函数的唯一性</strong>如果你要在同一个页面上进行多次更新(或多次绘图)，确保函数的命名不同。即使您正在导入多个。js脚本，浏览器的解释器将读取所有的<em class="jc"/>，并覆盖任何同名的内容。不考虑。js文件，保持更新函数的唯一性！</li><li id="3129" class="md me hi jd b je mq jh mr ks ms ku mt kw mu jw mi mj mk ml bi translated">如果你还不是前端开发人员，那就要擅长测量像素尺寸。一堆微调可能会是很好的训练。</li></ul><h1 id="29d5" class="jy jz hi bd ka kb kc kd ke kf kg kh ki io kj ip kk ir kl is km iu kn iv ko kp bi translated">最后一点</h1><p id="6faa" class="pw-post-body-paragraph ja jb hi jd b je kq ij jg jh kr im jj ks kt jm jn ku kv jq jr kw kx ju jv jw hb bi translated">哦伙计。迈克·博斯托克又成功了。</p><p id="4d28" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj ks jl jm jn ku jp jq jr kw jt ju jv jw hb bi translated">看看https://observablehq.com的<a class="ae jx" href="https://observablehq.com/" rel="noopener ugc nofollow" target="_blank"/>！基本上就是一个JavaScript和HTML的Jupyter笔记本！老实说，这个复活节彩蛋对我来说是最有用的东西之一，在我构建可视化的时候，它可以测试代码。</p><h1 id="9f44" class="jy jz hi bd ka kb kc kd ke kf kg kh ki io kj ip kk ir kl is km iu kn iv ko kp bi translated">下一步是什么？</h1><p id="5bc8" class="pw-post-body-paragraph ja jb hi jd b je kq ij jg jh kr im jj ks kt jm jn ku kv jq jr kw kx ju jv jw hb bi translated">互动宝贝！在下一篇文章中，我将会讲述一些使用D3交互性的要点。这只是一个很大的互动情节，但我也会确保融入一些有趣的数据科学概念。谁知道呢，也许我们甚至会在谷歌云上建立一个API！</p><p id="edb7" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj ks jl jm jn ku jp jq jr kw jt ju jv jw hb bi translated"><em class="jc">【众人呜啊呜啊……】</em></p></div></div>    
</body>
</html>