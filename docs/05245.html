<html>
<head>
<title>Breaking down confusions over Fast Fourier Transform (FFT)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">打破快速傅立叶变换(FFT)的混乱</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/breaking-down-confusions-over-fast-fourier-transform-fft-1561a029b1ab?source=collection_archive---------0-----------------------#2020-04-15">https://medium.com/analytics-vidhya/breaking-down-confusions-over-fast-fourier-transform-fft-1561a029b1ab?source=collection_archive---------0-----------------------#2020-04-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="405e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">毫无疑问，傅立叶变换是解决各种问题的最有价值的武器之一。FFT实际上是许多信号处理工程师的面包和黄油。同时，在数据科学领域也有FFT应用的例子。例如，具有密集间隔的时间序列数据(例如:您可能在处理每小时的销售数据，而不是每月的销售数据)表现出复杂的季节性。傅立叶变换是分析这类季节性的便利工具。不幸的是，对于没有经验的人来说，它有时会导致灾难性和令人沮丧的结论。</p><p id="8da2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在stack-exchange、Mathworks和其他论坛上浏览了数百个讨论和问答。我所了解到的是:打算使用傅立叶变换的人确实知道他们为什么要使用它。但普遍的困惑是:<strong class="ih hj">接下来是什么？</strong>如何对手里的序列进行“后处理”，获得有意义的准确洞察？具体来说，主要有以下几个问题:</p><ol class=""><li id="8d88" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">什么是单边带(SSB)？我们为什么关心？</li><li id="5b8b" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">我的FFT序列和物理频率有什么关系？这两者如何才能正确对齐？</li><li id="79e4" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">什么是FFT频段？它是如何设置FFT的分辨率的？</li><li id="bbd0" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">为什么会有归一化的因素？</li></ol><p id="f873" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">混淆的根源隐藏在建立傅立叶变换基础的数学基础之下。在这篇文章中，我将试着分析几种常见的混淆，这些混淆是在使用傅立叶变换时产生的。我会尽量少用数学来解释这个推理。希望这将有助于您使用这个神奇的工具，而不必费心去学习它背后的数学知识。</p><p id="1336" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了便于解释，我将使用快速傅立叶变换(FFT)的示例代码。FFT本质上是一种计算离散傅立叶变换(DFT)的超快速算法。示例代码是用MATLAB(或OCTAVE)编写的，对于试图理解傅立叶变换的人来说，这是一个非常著名的例子。类似的例子可以在<a class="ae jr" href="https://au.mathworks.com/help/matlab/ref/fft.html" rel="noopener ugc nofollow" target="_blank">这里的</a>中找到。</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="1ecb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在接下来的内容中，我们将从这段代码中提取部分内容并对其进行分析。首先，让我们设置一下背景。我们有一个可以在一秒钟内采集1000个样本的采样器。我们用采样器收集了500个时间点。</p><pre class="js jt ju jv fd jz ka kb kc aw kd bi"><span id="cb4f" class="ke kf hi ka b fi kg kh l ki kj">Fs = 1000;          %sampling rate<br/>T = 1/Fs;           %sampling interval<br/>L = 500;            %Number of time points<br/>t = 0:T:(L-1)*T;    %time vector</span></pre><p id="73ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，让我们创建一个具有3个频率和一个将被采样的DC分量(0 Hz分量)的信号。让我们添加一些噪音。如果需要，您可以绘制信号图进行初步目视检查。这是一个很好的实践。</p><pre class="js jt ju jv fd jz ka kb kc aw kd bi"><span id="ee7c" class="ke kf hi ka b fi kg kh l ki kj">% Define frequencies<br/>f1 = 20;<br/>f2 = 220;<br/>f3 = 138; <br/>% Create the signal<br/>x  = 5 + 12*sin(2*pi*f1*t-0.3) + 5*sin(2*pi*f2*t-0.5) + 4*sin(2*pi*f3*t - 1.5);<br/>x = awgn(x,5,'measured') %noise with 5 dB Signal to Noise ratio</span></pre><p id="cd73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们已经准备好执行FFT了。我们手中有一个真实世界的信号，它是被加性噪声破坏的正弦波的混合物。让我们采用FFT并绘制它。真扫兴。是的，FFT序列是复杂的序列。为什么？因为它们包含给定频率分量的幅度和相位信息，复数是描述它的最佳方式。那么让我们取这些序列的绝对值(幅度)。我们得到了什么？</p><figure class="js jt ju jv fd jw er es paragraph-image"><div class="er es kk"><img src="../Images/d10c4c68f014e4cb35d0757f3b7c689c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*ClmmViqRYAO0IdGRVQH4tw.jpeg"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">FFT序列的幅度FFT(x)</figcaption></figure><p id="5bd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这根本没有多大意义。首先，有7个峰值(包括零点的那个)。但是我们预期有4个峰值(3个用于频率f1、f2、f3，1个用于DC分量)。其次，振幅发生了什么变化？看起来太高了！山峰的位置也不对。很明显，要解决这个问题，我们还有很多工作要做。</p><p id="94e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们打破第一个困惑:为什么有比我们预期的更多的峰值？这就是单边带(SSB)频谱发挥作用的地方。如果你仔细观察，上面的图的一边是另一边的镜像，峰值在0处下降。这是因为，对于实信号，正负频率的系数变成复共轭。这意味着，我们不需要用频谱的两面来表示信号，单面就可以了。这被称为单边带(SSB)频谱。为了得到SSB频谱，我们需要将我们的时域信号转换成解析信号，即<em class="kr"> xₐ = x + iH(x) </em>。<em class="kr"> H(x) </em>就是众所周知的希尔伯特变换。但是，好消息是，我们不需要为此学习新的转换。事实证明，如果只取与正频率相关的频谱并乘以2，将得到SSB频谱，而无需对转换后的解析信号明确应用希尔伯特变换。这可以通过简单地编写两行附加代码来实现，如下面的代码片段所示:</p><pre class="js jt ju jv fd jz ka kb kc aw kd bi"><span id="67e2" class="ke kf hi ka b fi kg kh l ki kj">X = fft(x,N);<br/>SSB = X(1:L/2);<br/>SSB(2:end) = 2*SSB(2:end);</span></pre><p id="99ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，我们在乘以2时排除了第一个元素。这是因为，在MATLAB中，FFT函数返回一个向量，其中第一个元素是DC分量(与0频率相关联)。DC分量与0频率相关联，0频率既非正也非负。实际上，这个系数是真实的。</p><p id="afc8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们需要为FFT频谱固定一个合适的x轴。在我们的例子中，我们需要把物理频率放在x轴上，这样我们就知道我们在正确的频率上得到峰值。这是极其关键的一步。要做到这一点，我们需要了解FFT是如何创建“频段”的。对于<em class="kr"> N </em>点FFT，创建的箱的数量是<em class="kr"> N/2。</em></p><p id="c1e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">FFT只是离散傅立叶变换(DFT)的一种实现。为了离散连续的频率，频率轴被均匀地分割成有限数量的已知部分。箱可以被认为是频谱样本。在我们的例子中，采样频率<em class="kr"> Fs = 1000 </em>样本/秒。根据奈奎斯特定律，可以由其样本无混叠地表示的最高物理频率简单地是<em class="kr"> Fs/2 = 500 </em> Hz。因此，本质上，频谱被分割成<em class="kr"> (Fs/2)/(N/2) </em>或<em class="kr"> Fs/N </em>频段<em class="kr">的条带。</em>这个大。我们现在可以创建适当的频率轴，如下面的代码片段所示。</p><pre class="js jt ju jv fd jz ka kb kc aw kd bi"><span id="c65d" class="ke kf hi ka b fi kg kh l ki kj">f = (0:N/2-1)*(Fs/N);</span></pre><p id="f6de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，频段让我们了解FFT的基本频率分辨率。简而言之，在这种程度上，我们将能够分离频谱中两个位置相近的频率。在我们的例子中，我们的频率分辨率为<em class="kr"> Fs/N = 1000/1024 </em>或<em class="kr"> 0.9765 </em> Hz/bin。如果频率的分离度小于0.9765赫兹，我们就无法将频率分离为不同的峰值。</p><p id="8a4b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们快到了。我们提取了单边带光谱。我们还建立了光谱轴。现在，我们只想看看频谱，并拼出每个正弦波的幅度。在此之前，让我稍微重新表述一下DFT。还记得DFT的定义吗？</p><figure class="js jt ju jv fd jw er es paragraph-image"><div class="er es ks"><img src="../Images/fa23dd7173de8496051e9ab5890b8fbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/format:webp/1*PSTovcDBl4euk7q4ugKRoQ.png"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">DFT可以看作是一种相关性</figcaption></figure><p id="3419" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你仔细观察，你会注意到，计算DFT重新组装了很多相关性。没错。事实上，我认为这是一种非常直观的思考DFT工作原理的方式。因此，基本上对于每个仓，我们计算时域信号<em class="kr"> x </em>和与该仓相关的复正弦波之间的互相关。进一步的研究表明，我们通常在相关运算中看到的某些东西确实丢失了。<strong class="ih hj">一个归一化因子。</strong>具体而言，信号长度的归一化因子。这就是我们将要做的，我们将用信号长度归一化频谱。现在，让我们把所有这些理解放在一起，让我们看看会发生什么。</p><pre class="js jt ju jv fd jz ka kb kc aw kd bi"><span id="ca1a" class="ke kf hi ka b fi kg kh l ki kj">figure(4)<br/>plot(f,abs(SSB/L)) %Normalizing with signal length<br/>xlabel('f (in Hz)')<br/>ylabel('|X(f)|')<br/>title('Corrected Frequency Spectrum')</span></pre><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es kt"><img src="../Images/a6e991cd28863692abd2ba938023f6d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u9ZbW2BrhUVnAmzm7yYOTg.jpeg"/></div></div></figure><p id="c64d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">瞧啊。我们已经成功地从噪音深处恢复了我们的频率。建议大家玩玩附带的代码，看看在不同的信号长度，FFT点数，频率下会发生什么。我想提醒你，对于代码中给定的设置，如果你选择的频率高于<em class="kr"> Fs/2，就会发生混叠。由于混叠，高于<em class="kr"> Fs/2 </em>的</em>频率将作为低频成分出现在频谱中。这就是为什么建议在应用FFT之前进行低通滤波，尤其是在您不了解信号潜在频率成分的情况下。</p><p id="f48a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这个故事能让你对处理FFT运算有一些基本的了解。为了便于解释，许多数学观点被过分简化了，因为我试图迎合广大读者。下次见！</p></div></div>    
</body>
</html>