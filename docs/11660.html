<html>
<head>
<title>How to make a movie recommender: connecting services using Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何制作电影推荐器:使用Docker连接服务</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-make-a-movie-recommender-connecting-services-using-docker-f5216fa62f9a?source=collection_archive---------11-----------------------#2020-12-13">https://medium.com/analytics-vidhya/how-to-make-a-movie-recommender-connecting-services-using-docker-f5216fa62f9a?source=collection_archive---------11-----------------------#2020-12-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2d01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Docker是一个很好的工具，可以在保持整洁的同时进行部署和测试。这个项目的代码在这里是<a class="ae jd" href="https://github.com/jdortuzar5/movie-recommender" rel="noopener ugc nofollow" target="_blank">，本教程的代码在同一个存储库中。</a></p><h1 id="d9bf" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">你好码头工人</h1><p id="9578" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">那么Docker是什么？Docker本身是一个平台，但是我们关心Docker容器。所以Docker容器是一个轻量级的执行环境，用于在“密封的”环境中运行代码。这意味着，它是一台假计算机，存在于另一台运行代码的计算机中，而不必共享配置。</p><p id="8079" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这意味着我们可以像容器一样运行我们的后端、数据库、模型和前端，而不会有配置或依赖性的问题。因为每个服务都可以在独立的容器中运行。</p><p id="bfd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要在你的电脑上安装Docker，如果你使用的是Linux发行版，我建议你遵循这个教程。如果你用的是Windows，我会推荐这个<a class="ae jd" href="https://docs.docker.com/docker-for-windows/install-windows-home/" rel="noopener ugc nofollow" target="_blank">教程</a>，对于Mac，推荐这个<a class="ae jd" href="https://docs.docker.com/docker-for-mac/install/" rel="noopener ugc nofollow" target="_blank">教程</a></p><h1 id="9f19" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">如何为我们的服务制作Docker容器</h1><p id="eec8" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">要创建Docker容器，首先必须创建Docker映像，这是我们容器的配置。Docker的伟大之处在于，你可以使用其他人或公司创建的图像来简化事情。</p><p id="649f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从创建后端容器开始。在我们后端代码所在的文件夹中，我们必须创建一个名为<code class="du kh ki kj kk b">Dockerfile</code>的文件，这是图像的默认名称。该图像的代码如下:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="8439" class="kt jf hi kk b fi ku kv l kw kx">FROM tiangolo/uvicorn-gunicorn-fastapi:python3.7</span><span id="f139" class="kt jf hi kk b fi ky kv l kw kx">COPY . .</span><span id="4722" class="kt jf hi kk b fi ky kv l kw kx">RUN pip install -r requirements.txt</span><span id="fb9d" class="kt jf hi kk b fi ky kv l kw kx">EXPOSE 8000</span><span id="5483" class="kt jf hi kk b fi ky kv l kw kx">CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]</span></pre><p id="0d37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一行是<code class="du kh ki kj kk b">base image</code>，我们容器所基于的图像。在这种情况下，我们使用官方的FastAPI映像。然后我们将文件从后端目录复制到容器目录，这是两个文件我们的<code class="du kh ki kj kk b">[main.py](&lt;http://main.py&gt;)</code>和<code class="du kh ki kj kk b">requirements.txt</code>。现在我们使用<code class="du kh ki kj kk b">pip</code>在我们的容器中安装来自我们需求的依赖项。第四行将8000端口暴露给网络系统，这将允许我们的容器与系统的其余部分进行通信。最后，我们在后台运行代码。</p><p id="cf3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们必须创建我们的容器，在终端中我们的<code class="du kh ki kj kk b">Dockerfile</code>所在的文件夹内，运行以下命令:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="6f48" class="kt jf hi kk b fi ku kv l kw kx">docker build -t tutorial-backend .</span></pre><p id="f9f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(<code class="du kh ki kj kk b">tutorial-backend</code>是容器的名称，你可以放任何你想要的东西)</p><p id="752e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要运行容器，您可以使用以下命令:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="8b3c" class="kt jf hi kk b fi ku kv l kw kx">docker run tutorial-backend</span></pre><p id="17a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看我们的前端容器，因为它是一个苗条的应用程序，它不同于我们的后端，但在看完代码后，你会看到Docker是多么容易。</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="b311" class="kt jf hi kk b fi ku kv l kw kx">FROM node:12-alpine</span><span id="5c41" class="kt jf hi kk b fi ky kv l kw kx">WORKDIR /usr/src/app</span><span id="f97e" class="kt jf hi kk b fi ky kv l kw kx">COPY package*.json ./</span><span id="6456" class="kt jf hi kk b fi ky kv l kw kx">RUN npm install</span><span id="78c2" class="kt jf hi kk b fi ky kv l kw kx">COPY . .</span><span id="aae5" class="kt jf hi kk b fi ky kv l kw kx">EXPOSE 5000</span><span id="6849" class="kt jf hi kk b fi ky kv l kw kx">ENV HOST=0.0.0.0</span><span id="40e5" class="kt jf hi kk b fi ky kv l kw kx">RUN npm run build</span><span id="69b0" class="kt jf hi kk b fi ky kv l kw kx">CMD [ "npm", "start" ]</span></pre><h1 id="64c2" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">连通容器</h1><p id="9b2b" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我们不必担心在一台机器上配置我们所有的服务，但它们必须相互通信，这很好。就像编程中的几乎所有事情一样，有一个工具可以做到这一点，这个工具叫做<code class="du kh ki kj kk b">Docker compose</code>。如果你用的是Linux机器，你需要安装Docker compose(你可以用这个<a class="ae jd" href="https://www.digitalocean.com/community/tutorial_collections/how-to-install-docker-compose" rel="noopener ugc nofollow" target="_blank">教程</a>，其他人都已经安装好了。</p><p id="52f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Docker compose允许我们运行多个可以相互对话的容器。我们所要做的就是描述我们的容器，它们如何通信以及其他变量。首先必须创建一个名为<code class="du kh ki kj kk b">docker-compose.yml</code>的文件。下面是我们一起运行所有东西所需的所有代码:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="a8ac" class="kt jf hi kk b fi ku kv l kw kx">version: "3"</span><span id="4a2a" class="kt jf hi kk b fi ky kv l kw kx">services:<br/>  tensorflow-servings:<br/>    image: tensorflow/serving:latest<br/>    ports:<br/>      - 8501:8501<br/>    environment: <br/>      - MODEL_NAME=movie_model<br/>    volumes: <br/>      - ./ai-model/model:/models/movie_model<br/>    depends_on: [mongo]</span><span id="703d" class="kt jf hi kk b fi ky kv l kw kx">  mongo:<br/>    image: "mongo"<br/>    container_name: "movieDB"<br/>    environment: <br/>      - MONGO_INITDB_DATABASE=movieRecommenderDB<br/>    volumes:<br/>      - ./mongo-volume:/data/db<br/>    ports: <br/>      - 27017:27017<br/>  <br/>  backend:<br/>    build:<br/>      context: backend/<br/>      dockerfile: Dockerfile<br/>    image: movie-backend<br/>    ports:<br/>      - 8000:8000<br/>    depends_on: ["mongo"]<br/>    environment: <br/>      - MONGOHOST=mongo<br/>      - TF_SERVING_HOST=tensorflow-servings</span><span id="136c" class="kt jf hi kk b fi ky kv l kw kx">  frontend:<br/>    build:<br/>      context: frontend/<br/>      dockerfile: Dockerfile<br/>    image: movie-frontend<br/>    ports:<br/>      - 5000:5000<br/>    depends_on: ["backend"]</span></pre><p id="7a41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一行定义了Docker compose的版本，然后我们看看服务密钥里面有什么。第一个服务是<code class="du kh ki kj kk b">tensorflow-serving</code>服务，我们首先给我们的服务起一个名字，在这里是<code class="du kh ki kj kk b">tensorflow-serving</code>。在给出服务使用的图像之后，我们使用官方的Tensorflow服务图像。然后，在定义环境变量之后，我们公开端口。<code class="du kh ki kj kk b">volume</code>键用于定义共享文件夹，在这种情况下，我们希望共享我们的训练模型使用Tensorflow服务的文件夹。最后，<code class="du kh ki kj kk b">depend</code>的值告诉Docker在运行这个特定的容器之前组合所有需要运行的容器。</p><p id="3fac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，要运行所有东西，我们需要在<code class="du kh ki kj kk b">docker-compose.yml</code>所在的文件夹中使用下面的命令:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="bc7b" class="kt jf hi kk b fi ku kv l kw kx">docker-compose up</span></pre><p id="52d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，如果您打开网络浏览器并进入<code class="du kh ki kj kk b">[&lt;http://localhost:5000&gt;](&lt;http://localhost:5000&gt;)</code>，您将能够使用您的应用程序并享受观看电影的乐趣。</p></div></div>    
</body>
</html>