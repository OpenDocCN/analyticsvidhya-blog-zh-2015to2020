<html>
<head>
<title>How Multi-Armed-Bandits can help us in the fight for Covid-19 — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">多国武装匪徒如何帮助我们为新冠肺炎而战——第一部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-multi-armed-bandits-can-help-us-in-the-fight-for-covid-19-part-1-6dac796851b4?source=collection_archive---------15-----------------------#2020-03-25">https://medium.com/analytics-vidhya/how-multi-armed-bandits-can-help-us-in-the-fight-for-covid-19-part-1-6dac796851b4?source=collection_archive---------15-----------------------#2020-03-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5604" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我是一名AWS ML英雄，我在想强化学习和AWS如何帮助以更有效和高效的方式分发新冠肺炎测试包。为什么？识别尽可能多的感染者似乎是最大限度减少或阻止新冠肺炎病毒传播的关键之一。这似乎是韩国设法使曲线变平的原因之一。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/90ab34a9c49552c8cc701218a70c0cda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OfZhQS02MxMgyWxB3dxKTA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">来源:http://91-divoc.com/pages/covid-visualization/</figcaption></figure><p id="b0fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，让我们先定义一下什么是多臂匪徒。首先，这是一种强化学习方法。<strong class="ih hj">你反复面临在不同的选项、行动或武器中做出选择的问题。每次选择/决定后，你都会得到一定数量的奖励。每只手臂的奖励与未知的固定概率分布相关联。你的目标是在某个时间段或离散的时间步长内最大化预期总报酬。</strong></p><p id="7e97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一些多武装匪徒的例子:</p><ul class=""><li id="2819" class="jv jw hi ih b ii ij im in iq jx iu jy iy jz jc ka kb kc kd bi translated">一位医生在一系列重病患者的实验治疗中选择(摘自<em class="ju">强化学习:理查德·萨顿和安德鲁·巴尔托的介绍)</em></li><li id="feeb" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">广告系统选择在哪个网站上显示哪个广告</li><li id="b56c" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">选择在主页上显示哪些文章的推荐系统</li></ul><p id="b1ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">鉴于所有这些信息，我很肯定你已经开始在你的头脑中形成一个新冠肺炎MAB问题的定义。问题定义如下:</p><ul class=""><li id="a7f3" class="jv jw hi ih b ii ij im in iq jx iu jy iy jz jc ka kb kc kd bi translated">还有<em class="ju"> M </em>区域。例如，它类似于伦敦的行政区(卡姆登、伊斯灵顿、威斯敏斯特等)。</li><li id="1e26" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">我们假设，鉴于目前的封锁，人们不会在地区/行政区之间移动，或者只有很小一部分人必须移动。</li><li id="2693" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">在这些区域之间有一个中心工厂，持续生产Coviv-19测试套件。</li><li id="3d46" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">每当生产一种新的检测试剂盒时，必须选择将它运送到哪个地区/行政区。</li><li id="9e50" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated"><strong class="ih hj">因此，区域是MAB问题的双臂，目标是最大化真阳性的数量。</strong></li></ul><p id="79ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我知道这个问题不符合MABs的所有理论假设，但这篇博客的主要目的是激发新的想法！</p><p id="a1c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个问题定义的主要假设是，它假设每个区域/行政区都有真阳性的稳定概率分布。可能不是，但在后面的另一部分，我们将解决这个问题！</p><p id="892a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们尝试一个简单的MAB解决方案，<em class="ju">ε贪婪或E贪婪。</em>下面是伪代码(来源:<em class="ju">强化学习:理查德·萨顿和安德鲁·巴尔托的介绍)</em>:</p><pre class="je jf jg jh fd kj kk kl km aw kn bi"><span id="e293" class="ko kp hi kk b fi kq kr l ks kt">ε &lt;- user_input()  // In range (0.0, 1.0). User defines this.<br/>Initialize, for a = 1 to k:  // k is number of arms<br/>   Q(a) &lt;- 0  // estimated rewards per arm a<br/>   N(a) &lt;- 0  // number of times arm a is chosen</span><span id="81c1" class="ko kp hi kk b fi ku kr l ks kt">Loop forever:<br/>   random_number &lt;- random()  // random number in [0.0, 1)<br/>   if (random_number &lt; ε):  // exploration part<br/>      A &lt;- choose a random arm a<br/>   else:  // exploitation part<br/>      A &lt;- argmax Q(a)  // choose arm with highest Q(a) so far<br/>   <br/>   R &lt;- bandit(A)  // receive reward for chosen arm<br/>   N(A) &lt;- N(A) + 1<br/>   Q(A) &lt;- Q(A) + 1/N(A)[R - Q(A)]</span></pre><p id="eff7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们来实现一下<em class="ju">egredy</em>算法。</p><pre class="je jf jg jh fd kj kk kl km aw kn bi"><span id="b1e7" class="ko kp hi kk b fi kq kr l ks kt">import numpy as np</span><span id="13ee" class="ko kp hi kk b fi ku kr l ks kt">class EGreedy:<br/>    """<br/>    Implementation of EGreedy algorithm as described in Section 2 of book:<br/>    Reinforcement Learning: An Introduction (Version 2)<br/>    Richard S. Sutton and Andrew G. Barto<br/>    """<br/>    def __init__(self, k, epsilon=0.1):<br/>        """<br/>        Constructor of EGreedy<br/>        :param k: [int], number of arms. 0-based indexing.<br/>        :param epsilon: [float, default=0.1], epsilon value in range (0.0, 1.0) for exploration<br/>        """<br/>        self.k = k<br/>        self.epsilon = epsilon<br/>        self.rewards = np.asarray([0.0 for _ in range(k)])<br/>        self.steps = np.asarray([0 for _ in range(k)])</span><span id="8eba" class="ko kp hi kk b fi ku kr l ks kt">def reset(self):<br/>        self.rewards = np.asarray([0.0 for _ in range(self.k)])<br/>        self.steps = np.asarray([0 for _ in range(self.k)])</span><span id="022c" class="ko kp hi kk b fi ku kr l ks kt">def choose(self):<br/>        random_number = np.random.uniform(0.0, 1, 1)[0]</span><span id="c99c" class="ko kp hi kk b fi ku kr l ks kt">if random_number &lt; self.epsilon:<br/>            return np.random.choice(self.k, 1, replace=False)[0].item()<br/>        else:<br/>            return np.argmax(self.rewards, axis=0)</span><span id="4fdd" class="ko kp hi kk b fi ku kr l ks kt">def feedback(self, arm_id, reward):<br/>        self.steps[arm_id] += 1<br/>        self.rewards[arm_id] += (1 / self.steps[arm_id]) * (reward - self.rewards[arm_id])</span></pre><p id="f016" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们必须定义每个地区/行政区感染人数的平稳概率分布。这种分布我用贝塔分布，参数<em class="ju"> a/b </em>定义<em class="ju">感染者/未感染者</em>的比例。让我们假设有<em class="ju"> M=5 </em>个区域。</p><ul class=""><li id="7c5b" class="jv jw hi ih b ii ij im in iq jx iu jy iy jz jc ka kb kc kd bi translated">区域1有一个<em class="ju">β(a = 10，b=2) </em></li><li id="7dbc" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">区域2有一个<em class="ju">β(a = 4，b=2) </em></li><li id="51c2" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">区域3有一个<em class="ju">β(a = 2，b=2) </em></li><li id="e35a" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">区域4有一个<em class="ju">β(a = 2，b=4) </em></li><li id="dbfc" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">区域5有一个<em class="ju">β(a = 2，b=6) </em></li></ul><p id="d066" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从下面绘制的分布图中可以看出，1区发现感染者的概率最高。下一个是2区，以此类推。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kv"><img src="../Images/485301216cce5cb1dffb8d3abf8b0230.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*eex0mfKfCjOkvmUn0QMbzg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">区域1的感染概率分布</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/c1389d1c687a0d0898bb2d4865ceb315.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*-6fekQAxXcZqDErcDp_NAw.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">区域2的感染概率分布</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kx"><img src="../Images/f34618c66378ef9adc02d7e8e53282dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*kq9U9HfmiptGthVhowFSnw.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">区域3的感染概率分布</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ky"><img src="../Images/b8b38de511888a004985598f6a4c9d5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*6ZJKy2LmfsxeImwvsFxRag.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">区域4的感染概率分布</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kz"><img src="../Images/d6fe1eb4211b07e4f5de54f74e9eb075.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*zgQlvFltp0qrwSriix8_xw.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">区域5的感染概率分布</figcaption></figure><p id="e167" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来我们需要实现的是模拟部分。下面是伪代码:</p><pre class="je jf jg jh fd kj kk kl km aw kn bi"><span id="2dac" class="ko kp hi kk b fi kq kr l ks kt">egreedy = initialize_egreedy()<br/>for i=1 to num_test_kits:<br/>    area &lt;- egreedy.choose()  // choose an area to send this kit<br/>    beta_distro &lt;- find_distro(area)  // find distro of area<br/>    random &lt;- random()  // random number in [0.0, 1) uniform distro<br/>    if random &lt; beta_distro.draw():<br/>       reward = 1  // found an infected person using this kit<br/>    else:<br/>       reward = 0  // this kit was used on a non infected person</span><span id="e3ec" class="ko kp hi kk b fi ku kr l ks kt">    egreedy.feedback(area, reward)</span></pre><p id="257e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如你所看到的，每一个新创建的测试包都被送到一个地区，并在这个地区的一个人身上使用。然后，从该区域的Beta分布中抽取一个数字，以确定检测试剂盒是否用于受感染者。我们假设检测试剂盒是完美的(没有假阳性和假阴性)。</p><p id="fcf9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对5，000个测试套件运行模拟后的预期报酬率图表为:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es la"><img src="../Images/0f93399f7d91a45199e911b47e80a051.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*_IWxIIiYIJFlDxsoYseV0w.png"/></div></figure><p id="8a89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检测试剂盒在各地区的分布情况如下:</p><ul class=""><li id="d020" class="jv jw hi ih b ii ij im in iq jx iu jy iy jz jc ka kb kc kd bi translated">1区:4594</li><li id="d88f" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">面积2: 92</li><li id="f81e" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">面积3: 114</li><li id="832a" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">第4区:102</li><li id="a5b0" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">面积5: 98</li></ul><p id="3ffe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种简单的在线MAB算法将大多数测试包分发到了受感染人数最多的地区，但并没有将它们“公平”地分发到其他地区。但是，我们仍然有很大的进步！</p><p id="243f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">敬请期待！在下一部分中，我将向您展示如何在AWS上部署这个算法，以及如何以有序的方式改进测试包的分发。</p><p id="b353" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">PS: Github回购:<a class="ae jt" href="https://github.com/pm3310/mab-covid19" rel="noopener ugc nofollow" target="_blank">https://github.com/pm3310/mab-covid19</a></p></div></div>    
</body>
</html>