<html>
<head>
<title>M5 Forecasting-Accuracy: Time Series forecasting using Walmart sales data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">M5预测-准确性:使用沃尔玛销售数据的时间序列预测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/m5-forecasting-accuracy-time-series-forecasting-using-walmart-sales-data-374765d3f1f7?source=collection_archive---------8-----------------------#2020-07-16">https://medium.com/analytics-vidhya/m5-forecasting-accuracy-time-series-forecasting-using-walmart-sales-data-374765d3f1f7?source=collection_archive---------8-----------------------#2020-07-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/042deb93312b7cad6f161c7171a4519d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UlkYztpY1tsaWP0t"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://unsplash.com/@hansonluu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Hanson Lu </a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="f62b" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">竞争概述:</h1><p id="6333" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">本次比赛提供了沃尔玛的分层销售数据<a class="ae iu" href="https://www.kaggle.com/c/m5-forecasting-accuracy" rel="noopener ugc nofollow" target="_blank"> M5预测-准确性</a>。该竞赛的目标是预测加利福尼亚、得克萨斯和威斯康星三个州的10家不同商店未来28天的每种产品的销售额。</p><blockquote class="kr ks kt"><p id="648c" class="jt ju ku jv b jw kv jy jz ka kw kc kd kx ky kg kh kz la kk kl lb lc ko kp kq hb bi translated">这个博客的全部代码和我的python解决方案笔记本可以在这个<a class="ae iu" href="https://github.com/aakashveera/M5-Accuracy/blob/master/Notebook%20M5%20Accuracy.ipynb" rel="noopener ugc nofollow" target="_blank"> github链接</a>中找到。</p></blockquote><h1 id="7f34" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak">数据描述:</strong></h1><p id="4a73" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">该数据集包括美国三个州3个不同类别的3049种独特产品的销售历史，以及每种产品的价格和每天举行的活动的详细信息。它被分成三个CSV文件</p><ol class=""><li id="d93b" class="ld le hi jv b jw kv ka kw ke lf ki lg km lh kq li lj lk ll bi translated">Calendar.csv:它包含关于产品销售日期以及当天举行的活动和项目的信息。</li><li id="228f" class="ld le hi jv b jw lm ka ln ke lo ki lp km lq kq li lj lk ll bi translated">Sales_train_evaluation:它包含从第1天到第1941天每个商店中每个产品的历史每日单位销售额。</li><li id="d033" class="ld le hi jv b jw lm ka ln ke lo ki lp km lq kq li lj lk ll bi translated">Sell_prices:它包含每个商店每周的产品价格信息。</li></ol><h1 id="980c" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">探索性数据分析:</h1><blockquote class="kr ks kt"><p id="8304" class="jt ju ku jv b jw kv jy jz ka kw kc kd kx ky kg kh kz la kk kl lb lc ko kp kq hb bi translated">E <!-- --> DA，理解数据和创建健壮特征的最关键步骤。所以我们来探究一下数据。</p></blockquote><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="43c2" class="ma iw hi lw b fi mb mc l md me">#read and check the head of the dataframe<br/>data = pd.read_csv("sales_train_evaluation.csv")<br/>sell_prices = pd.read_csv("sell_prices.csv")<br/>calendar = pd.read_csv("calendar.csv")<br/>data.head()<br/>calendar.head()<br/>sell_prices.head()</span></pre><figure class="lr ls lt lu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/0577eb58e65ef82aba228dfb2ccfef1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ySUrDQpR5TtvcXj2YEaASg.jpeg"/></div></div></figure><figure class="lr ls lt lu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/82cf60178ed8c6525b9b8a75a1c91ed9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qpxIX9Hra1mVs5Af0YqT9g.jpeg"/></div></div></figure><figure class="lr ls lt lu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/10cf83b7e6071ac51463bcd1200edf77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LRSjDgDHtpjaO8MOC1fOSA.jpeg"/></div></div></figure><blockquote class="kr ks kt"><p id="1662" class="jt ju ku jv b jw kv jy jz ka kw kc kd kx ky kg kh kz la kk kl lb lc ko kp kq hb bi translated">有3049种独特的产品，分布在3个类别、10个部门(子类别)和10个商店，分别来自3个州，即加利福尼亚、德克萨斯和威斯康星。</p></blockquote><p id="5568" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">如数据描述中所述，给出了每个商店每种产品的每日销售详情。当地和全球事件的每一天都提供了详细的一天被提供。</p><p id="c377" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated"><strong class="jv hj"> <em class="ku"> SNAP </em> </strong>是我们进行的一项营养援助计划，通过该计划，低收入家庭可以在特定日期购买食物。这是一个二进制特征，表示快照在每个状态的特定日期是否保持。</p><p id="9eff" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">产品的价格不是恒定的，每周提供产品的价格。现在让我们使用<em class="ku"> matplotlib和seaborn可视化销售趋势。</em></p><p id="98a1" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated"><strong class="jv hj">产品类别销售</strong></p><figure class="lr ls lt lu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/c9a48d2578e425b4d810720a65c40b58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d3grSaBOCR8A2dXL2bO05w.jpeg"/></div></div></figure><p id="6168" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated"><strong class="jv hj">部门产品销售</strong></p><figure class="lr ls lt lu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/96ab139acd195453f85282ed873546d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CwXUL4_h-cpjapkvs4LIxg.jpeg"/></div></div></figure><p id="6e15" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated"><strong class="jv hj">陈述明智的产品销售</strong></p><figure class="lr ls lt lu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/2218f5f6d78b0d4f859afaba0d4ff63d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NKF0_sxirAMOys3vzUfLuw.jpeg"/></div></div></figure><p id="8b6f" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated"><strong class="jv hj">7天滚动平均的各州品类销售趋势</strong></p><figure class="lr ls lt lu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/f86e72c09796dff2edcb0ec034d136f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XuwMl8HOODggo-qEJMHZZw.jpeg"/></div></div></figure><p id="0dbf" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">1.产品主要在CA上销售，尤其是在商店CA_3上。<br/> 2。食品_4部门的产品比其他食品和其他类别的产品卖得多。<br/> 3。销售增长呈上升趋势，这促进了公司的收入。</p><blockquote class="kr ks kt"><p id="73d2" class="jt ju ku jv b jw kv jy jz ka kw kc kd kx ky kg kh kz la kk kl lb lc ko kp kq hb bi translated">在最后一张图中，滚动平均值为7，可以在每个州观察到每个类别独特的季节性上升趋势。所以为每一对做不同的模型会得到更好的分数</p></blockquote><h1 id="a40d" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">特征工程:滞后特征</h1><p id="8f13" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">创建时滞特征是将时间序列预测问题转化为监督学习问题的经典方法。</p><p id="9289" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">时滞特性是在第t-1天创建目标值，作为第t天的特性(即前一天的销售作为新特性)。因为目标是预测未来28天的销售，所以创建了28、29和30天的滞后特征。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="2c8c" class="ma iw hi lw b fi mb mc l md me">data['lag_t28'] = data.groupby(['id'])['demand'].transform(lambda x: x.shift(28))<br/>data['lag_t29'] = data.groupby(['id'])['demand'].transform(lambda x: x.shift(29))<br/>data['lag_t30'] = data.groupby(['id'])['demand'].transform(lambda x: x.shift(30))</span></pre><p id="7a7a" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">其他统计特征，如平均值、标准差、kurt、偏斜度也是根据不同滚动日的滞后数据计算的。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="1262" class="ma iw hi lw b fi mb mc l md me">data['rolling_mean_t7']   = data.groupby(['id'])['demand'].transform(lambda x: x.shift(28).rolling(7).mean())<br/>data['rolling_std_t7']    = data.groupby(['id'])['demand'].transform(lambda x: x.shift(28).rolling(7).std())<br/>data['rolling_mean_t30']  = data.groupby(['id'])['demand'].transform(lambda x: x.shift(28).rolling(30).mean())<br/>data['rolling_mean_t90']  = data.groupby(['id'])['demand'].transform(lambda x: x.shift(28).rolling(90).mean())<br/>data['rolling_mean_t180'] = data.groupby(['id'])['demand'].transform(lambda x: x.shift(28).rolling(180).mean())<br/>data['rolling_std_t30']   = data.groupby(['id'])['demand'].transform(lambda x: x.shift(28).rolling(30).std())<br/>data['rolling_skew_t30']  = data.groupby(['id'])['demand'].transform(lambda x: x.shift(28).rolling(30).skew())<br/>data['rolling_kurt_t30']  = data.groupby(['id'])['demand'].transform(lambda x: x.shift(28).rolling(30).kurt())</span></pre><p id="959f" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">作为另一个重要的特征，还创建了过去一天的销售价格的变化</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="e02b" class="ma iw hi lw b fi mb mc l md me">data['lag_price_t1'] = data.groupby(['id'])['sell_price'].transform(lambda x: x.shift(1))</span><span id="7e5d" class="ma iw hi lw b fi mm mc l md me">data['price_change_t1'] = (data['lag_price_t1'] - data['sell_price']) / (data['lag_price_t1'])</span><span id="e78a" class="ma iw hi lw b fi mm mc l md me">data['price_change_t365'] = (data['rolling_price_max_t365'] - data['sell_price']) / (data['rolling_price_max_t365'])</span><span id="ef39" class="ma iw hi lw b fi mm mc l md me">data.drop(['rolling_price_max_t365', 'lag_price_t1'], inplace = True, axis = 1)</span></pre><p id="b96d" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated"><strong class="jv hj">对分类列进行编码:</strong></p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="f7cb" class="ma iw hi lw b fi mb mc l md me">#missing values on events are filled as noevent and encoded using label Encoder</span><span id="6cc1" class="ma iw hi lw b fi mm mc l md me">from sklearn.preprocessing import LabelEncoder</span><span id="ac37" class="ma iw hi lw b fi mm mc l md me">nan_features = ['event_name_1', 'event_type_1', 'event_name_2', 'event_type_2']<br/>for feature in nan_features:<br/>    data[feature].fillna('noevent', inplace = True)</span><span id="4a6e" class="ma iw hi lw b fi mm mc l md me">cat = ['item_id', 'dept_id', 'cat_id', 'store_id', 'state_id', 'event_name_1', 'event_type_1', 'event_name_2', 'event_type_2']<br/>for feature in cat:<br/>    encoder = LabelEncoder()<br/>    data[feature] = encoder.fit_transform(data[feature])</span></pre><h1 id="a3d8" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">使用LightGBM建模:</h1><p id="55be" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">一旦EDA和特征工程结束，<strong class="jv hj"> LightGBM </strong>这是一种比xgboost快得多的流行梯度增强算法，用于预测未来28天的销售。</p><p id="580d" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">如EDA中所述，每个商店的每个部门都有独特的趋势，因此需要单独进行预测。</p><p id="ba41" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated"><strong class="jv hj">评估指标和结果:</strong></p><p id="5056" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">加权均方根误差用作比赛的评估指标，使用LightGBM在kaggle的私人排行榜上获得的wrmse为<strong class="jv hj"> 0.62128 </strong>。</p><h1 id="4995" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">链接:</h1><p id="c205" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">解决方案链接:博客和解决方案的完整代码可以在这个<a class="ae iu" href="https://github.com/aakashveera/M5-Accuracy/blob/master/Notebook%20M5%20Accuracy.ipynb" rel="noopener ugc nofollow" target="_blank"> github链接</a>中找到，它是本次比赛的<strong class="jv hj"> <em class="ku">银牌解决方案</em> </strong>。</p></div><div class="ab cl mn mo gp mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="hb hc hd he hf"><p id="cd1d" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">希望你喜欢这个博客，欢迎任何评论，谢谢！</p></div></div>    
</body>
</html>