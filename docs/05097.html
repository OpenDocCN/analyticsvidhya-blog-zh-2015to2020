<html>
<head>
<title>Getting data annotation format right for object detection tasks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为对象检测任务获取正确的数据注释格式</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/getting-data-annotation-format-right-for-object-detection-tasks-f41b07eebbf5?source=collection_archive---------4-----------------------#2020-04-11">https://medium.com/analytics-vidhya/getting-data-annotation-format-right-for-object-detection-tasks-f41b07eebbf5?source=collection_archive---------4-----------------------#2020-04-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7050a0edace509175847029f8f393aab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CZifoDLwkHO9dwmiKpOWsw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">在图像中标注板球以进行目标检测。图片取自<a class="ae iu" href="https://www.sikana.tv/en/sport/cricket#chapter-3_" rel="noopener ugc nofollow" target="_blank">https://www.sikana.tv/en/sport/cricket#chapter-3_</a></figcaption></figure><p id="dd8a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你正在寻找方法来注释你的图像，并把它们传递给你的物体检测算法，那么这里有一个简短的阅读，告诉你如何正确处理。<br/>我将用一个YoloV3注释格式作为例子来说明这个过程。我不会深入讨论Yolo如何工作的细节，但是你可以在这里<a class="ae iu" href="https://pjreddie.com/darknet/yolo/" rel="noopener ugc nofollow" target="_blank">阅读</a></p><p id="30f3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您想在YoloV3上训练自定义数据以检测图像中的对象，您需要首先注释(在感兴趣的对象周围标记或绘制边界框)您的自定义数据(图像)，然后将这些注释传递给模型以进行训练。</p><p id="41e5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注释的格式是</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="f46b" class="kc kd hi jy b fi ke kf l kg kh"><strong class="jy hj">&lt;class&gt; &lt;x&gt; &lt;y&gt; &lt;width&gt; &lt;height&gt; <br/>ex: 0 0.25 0.44 0.5 0.8<br/></strong>class is the object class, (x,y) are centre coordinates of the bounding box. width, height represent width and height of the bounding box</span></pre><p id="57fc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有很多工具可以让你注释图像并导出到正确的格式。我用过<a class="ae iu" href="https://rectlabel.com" rel="noopener ugc nofollow" target="_blank"> RectLabel </a>，<a class="ae iu" href="http://labelme.csail.mit.edu/Release3.0/" rel="noopener ugc nofollow" target="_blank"> LabelMe </a>，我个人选择的是<a class="ae iu" href="https://cloud.annotations.ai/login" rel="noopener ugc nofollow" target="_blank">云注释</a>(因为你可以如何将其与IBM cloud链接起来进行存储，并允许你的团队协作完成任务)。<a class="ae iu" rel="noopener" href="/analytics-vidhya/label-training-data-using-cloud-annotation-for-object-detection-7e8338573d35">这里</a>是我写的一篇关于如何使用云注释来注释你的图片的帖子。<br/>我还发现<a class="ae iu" href="https://lionbridge.ai/articles/image-annotation-tools-for-computer-vision/" rel="noopener ugc nofollow" target="_blank">这个</a>指南在从无数可用选项中选择工具时很有用。</p><p id="1a2e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这些工具中的大多数都允许您对图像进行注释，并直接以上面提到的YoloV3格式导出，但是有些工具以下面的格式导出XML文件，您必须将其转换为可接受的格式。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es ki"><img src="../Images/b97cfdb7ff0a59efa7c75adf710d6301.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*RnujXXDZ3TyP8C4M02zqpw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">需要解析以转换为Yolo格式的XML格式</figcaption></figure><p id="45ef" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我发现下面这段Python代码在解析XML文件和转换成YoloV3注释格式时很有用。Python有一个很酷的模块叫做<a class="ae iu" href="https://docs.python.org/3/library/xml.etree.elementtree.html" rel="noopener ugc nofollow" target="_blank"> xml.etree.ElementTree </a>来解析和创建xml内容。我们的目标是读取宽度、高度、xmin、xmax、ymin和ymax值，然后将它们转换为标准化的x、y、宽度和高度。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="aafe" class="kc kd hi jy b fi ke kf l kg kh"><strong class="jy hj">import xml.etree.ElementTree as ET<br/>from pathlib import Path</strong></span><span id="8171" class="kc kd hi jy b fi kj kf l kg kh">path = 'your/path/to/the/xmlFiles<br/>def parsethefile(listOfFiles):<br/>    for myFile in listOfFiles.iterdir():<br/>        filePath = myFile<br/>        <strong class="jy hj">parser = ET.XMLParser(encoding="utf-8")<br/>        targetTree = ET.parse(filePath, parser=parser)<br/>        rootTag = targetTree.getroot()</strong><br/>        width = int(rootTag.getchildren()[2][0].text)<br/>        height = int(rootTag.getchildren()[2][1].text)<br/>        xmin = int(rootTag.getchildren()[3][1][0].text)<br/>        xmax = int(rootTag.getchildren()[3][1][1].text)<br/>        ymin = int(rootTag.getchildren()[3][1][2].text)<br/>        ymax = int(rootTag.getchildren()[3][1][3].text)<br/>        category = 0 <br/># Replace this with the class label of your object</span><span id="b825" class="kc kd hi jy b fi kj kf l kg kh">parsethefile(Path(path))<br/>convertLabels(xmin, ymin, xmax, ymax, height, width, category)</span></pre><p id="56ee" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">转换为标准化值</strong> <br/>通常，标准化值是一个好主意，这样在网络上更容易，运行速度更快</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="41cc" class="kc kd hi jy b fi ke kf l kg kh">def convertLabels(x1, y1, x2, y2, height, width, cat):<br/>    def sorting(v1, v2):<br/>        if v1 &gt; v2:<br/>            vmax, vmin = v1, v2<br/>            return vmax, vmin<br/>        else:<br/>            vmax, vmin = v2, v1<br/>            return vmax, vmin<br/>    size = (height, width)<br/>    xmax, xmin = sorting(x1, x2)<br/>    ymax, ymin = sorting(y1, y2)<br/>    dw = 1. / size[1]<br/>    dh = 1. / size[0]<br/>    x = (xmin + xmax) / 2.0<br/>    y = (ymin + ymax) / 2.0<br/>    w = xmax - xmin<br/>    h = ymax - ymin<br/>    x = x * dw<br/>    w = w * dw<br/>    y = y * dh<br/>    h = h * dh<br/>    return cat, x, y, w, h</span><span id="3508" class="kc kd hi jy b fi kj kf l kg kh">This will return the required annotation format</span></pre><p id="24ca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我希望这有助于获得正确的图像注释，并训练您的对象检测算法。请留言，我会很乐意回复</p></div></div>    
</body>
</html>