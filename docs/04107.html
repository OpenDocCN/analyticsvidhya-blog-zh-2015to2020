<html>
<head>
<title>Apache Flink Series 6 —Reading the Log files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Apache Flink系列6—读取日志文件</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/apache-flink-series-6-reading-the-log-files-6e58ad7b542b?source=collection_archive---------5-----------------------#2020-03-05">https://medium.com/analytics-vidhya/apache-flink-series-6-reading-the-log-files-6e58ad7b542b?source=collection_archive---------5-----------------------#2020-03-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div class="er es hg"><img src="../Images/10e13ec967c87198da8962a0feef054c.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*sc91z9ed9b45oI8Gu0L_0Q.jpeg"/></div></figure><div class=""/><p id="544e" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在本帖中，我们将查看日志文件(TaskManager和JobManager的日志文件),并尝试了解Flink集群上发生了什么。</p><p id="5767" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">实际上这篇文章是关于创建样本Flink集群的第3步。然而，我只是认为阅读日志文件对理解任何工具/框架等的基础知识会有很大的帮助..因此我决定为此写一篇博文。</p><blockquote class="jk jl jm"><p id="2f48" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">你可以参考我之前关于<a class="ae jr" rel="noopener" href="/@mehmetozanguven/apache-flink-series-5-create-sample-apache-flink-cluster-on-local-machine-part-1-5af20c5a5c8f"> <strong class="io hq">创建样本Apache Flink集群Part-1 </strong> </a>的博客</p></blockquote><p id="cce2" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在之前的博客中，我们可以用一个JobManager和一个TaskManager运行简单的flink集群。</p><p id="03ae" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们重新处理一下，只有一个任务槽(在flink-conf.yaml文件中将numberOfTaskSlots设置为1):</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="914b" class="kb kc hp jx b fi kd ke l kf kg">taskmanager.numberOfTaskSlots: 1</span></pre><p id="f083" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在使用<code class="du kh ki kj jx b">$ pathToFlink/bin/start-cluster.sh`</code>运行您的集群</p><blockquote class="jk jl jm"><p id="ce4f" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated">注意:如果您以前运行过flink cluster，您可以从以前的设置中删除日志。否则，flink会将新创建的日志附加到现有的日志中</p></blockquote><h1 id="f14d" class="kk kc hp bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">作业管理器的日志文件</h1><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="e3fc" class="kb kc hp jx b fi kd ke l kf kg">2020-02-28 00:03:44,009 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -  Starting StandaloneSessionClusterEntrypoint (Version: 1.10.0, Rev:aa4eb8f, Date:07.02.2020 @ 19:18:19 CET)</span></pre><p id="b048" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因为我们正在创建独立集群，Flink也将为独立集群创建适当的类。如果您查看Flink源代码，您会看到<strong class="io hq"> ClusterEntrypoint是一个抽象类，有一个名为standalonessessionclusterentry point的类扩展了它。</strong></p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="e1ab" class="kb kc hp jx b fi kd ke l kf kg">(1)<br/>2020-02-28 00:03:44,009 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -  OS current user: mehmetozanguven</span><span id="f7f2" class="kb kc hp jx b fi lh ke l kf kg">(2)<br/>2020-02-28 00:03:44,010 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -  Current Hadoop/Kerberos user: &lt;no hadoop dependency found&gt;</span><span id="cdf1" class="kb kc hp jx b fi lh ke l kf kg">(3)<br/>2020-02-28 00:03:44,010 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -  JVM: OpenJDK 64-Bit Server VM - AdoptOpenJDK - 11/11.0.6+10</span><span id="9bb1" class="kb kc hp jx b fi lh ke l kf kg">(4)<br/>2020-02-28 00:03:44,010 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -  Maximum heap size: 1024 MiBytes</span><span id="f422" class="kb kc hp jx b fi lh ke l kf kg">(5)<br/>2020-02-28 00:03:44,010 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -  JAVA_HOME: /home/mehmetozanguven/JavaJDKS/jdk-11.0.6+10</span></pre><p id="242c" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">提供信息的日志(<em class="jn">环境，如代码修订、当前用户、Java版本和JVM参数)</em>，如上所述，将在方法中打印:</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="ce37" class="kb kc hp jx b fi kd ke l kf kg">org.apache.flink.runtime.util.EnvironmentInformation.logEnvironmentInfo(...)</span></pre><p id="5326" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">例如java_home组件是这样读的</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="7089" class="kb kc hp jx b fi kd ke l kf kg">logEnvironmentInfo(...) {<br/>    // ...<br/>    String javaHome = System.<em class="jn">getenv</em>("JAVA_HOME");<br/>    //...<br/>}</span></pre><p id="fc72" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">以及所有关于系统、环境等的信息..将打印在这里:</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="5b64" class="kb kc hp jx b fi kd ke l kf kg">logEnvironmentInfo(...){<br/>    log.info("--------------------------------------------------------------------------------");<br/>    log.info(" Starting " + componentName + " (Version: " + version + ", "<br/>      + "Rev:" + rev.commitId + ", " + "Date:" + rev.commitDate + ")");<br/>    log.info(" OS current user: " + System.<em class="jn">getProperty</em>("user.name"));<br/>    log.info(" Current Hadoop/Kerberos user: " + <em class="jn">getHadoopUser</em>());<br/>    log.info(" JVM: " + jvmVersion);<br/>    log.info(" Maximum heap size: " + maxHeapMegabytes + " MiBytes");<br/>    log.info(" JAVA_HOME: " + (javaHome == null ? "(not set)" : javaHome));<br/>}</span></pre><p id="c54e" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">之后，我们会在作业管理器的日志文件中看到这些日志:</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="a1da" class="kb kc hp jx b fi kd ke l kf kg">2020-02-28 00:03:44,010 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -  JVM Options:</span><span id="e8e4" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:44,010 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -     -Xms1024m</span><span id="df6a" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:44,010 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -     -Xmx1024m</span><span id="c72a" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:44,011 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -     -Dlog.file=/home/mehmetozanguven/Desktop/ApacheTools/flink-1.10.0/log/flink-mehmetozanguven-standalonesession-0-mehmetozanguven-ABRA-A5-V5.log</span><span id="09d6" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:44,011 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -     -Dlog4j.configuration=file:/home/mehmetozanguven/Desktop/ApacheTools/flink-1.10.0/conf/log4j.properties</span><span id="739d" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:44,011 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -     -Dlogback.configurationFile=file:/home/mehmetozanguven/Desktop/ApacheTools/flink-1.10.0/conf/logback.xml</span></pre><p id="dc14" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">除了Flink读取启动时传递的JVM选项，您可能认为“我们只是通过。sh文件谁传递了-Dlog.file/log4j等..?"</p><p id="662b" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这些系统属性由另一个。sh文件名为<code class="du kh ki kj jx b">config.sh</code></p><p id="fb43" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个文件查看flink-conf.yaml，如果它找到任何这些系统属性的键值参数，它将使用它，否则将使用默认值。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="1c6b" class="kb kc hp jx b fi kd ke l kf kg">2020-02-28 00:03:44,011 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -  Program Arguments:</span><span id="ef33" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:44,011 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -     --configDir</span><span id="89cd" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:44,011 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -     /home/mehmetozanguven/Desktop/ApacheTools/flink-1.10.0/conf</span><span id="8ede" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:44,011 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -     --executionMode<br/>2020-02-28 00:03:44,011 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -     cluster</span><span id="83be" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:44,011 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint         -  Classpath: /home/mehmetozanguven/Desktop/ApacheTools/flink-1.10.0/lib/flink-table_2.11-1.10.0.jar:/home/mehmetozanguven/Desktop/ApacheTools/flink-1.10.0/lib/flink-table-blink_2.11-1.10.0.jar:/home/mehmetozanguven/Desktop/ApacheTools/flink-1.10.0/lib/log4j-1.2.17.jar:/home/mehmetozanguven/Desktop/ApacheTools/flink-1.10.0/lib/slf4j-log4j12-1.7.15.jar:/home/mehmetozanguven/Desktop/ApacheTools/flink-1.10.0/lib/flink-dist_2.11-1.10.0.jar:::</span></pre><p id="117c" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Flink读取程序参数(命令行参数)并在找到时打印出来。然后Flink也会打印类路径来执行java类。这些信息也在environment information . logenvironmentinfo(…)方法中打印出来</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="608d" class="kb kc hp jx b fi kd ke l kf kg">if (commandLineArgs == null || commandLineArgs.length == 0) {<br/>   log.info(" Program Arguments: (none)");<br/>}<br/>else {<br/>   log.info(" Program Arguments:");<br/>   for (String s: commandLineArgs) {<br/>      log.info("    " + s);<br/>   }<br/>}<br/><br/>log.info(" Classpath: " + System.<em class="jn">getProperty</em>("java.class.path"));<br/><br/>log.info("--------------------------------------------------------------------------------");</span></pre><p id="3ca5" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如前所述，这些参数是由config.sh文件设置的</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="222d" class="kb kc hp jx b fi kd ke l kf kg">2020-02-28 00:03:44,029 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: jobmanager.rpc.address, localhost</span><span id="0912" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:44,029 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: jobmanager.rpc.port, 6123</span><span id="f808" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:44,029 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: jobmanager.heap.size, 1024m</span><span id="4e15" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:44,029 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: taskmanager.memory.process.size, 1568m</span><span id="f42f" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:44,029 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: taskmanager.numberOfTaskSlots, 1</span><span id="08b3" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:44,029 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: parallelism.default, 1</span><span id="18e2" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:44,030 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: jobmanager.execution.failover-strategy, region</span></pre><p id="c8a5" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Flink从conf/flink-conf.yaml中读取密钥并打印值。</p><p id="1748" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是一条重要的日志线，几乎位于底部:</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="99e2" class="kb kc hp jx b fi kd ke l kf kg">2020-02-28 00:03:46,412 INFO  org.apache.flink.runtime.resourcemanager.StandaloneResourceManager  - Registering TaskManager with ResourceID c1438b06b128b7faf16b60e06f404f05 (akka.tcp://flink@127.0.1.1:36981/user/taskmanager_0) at ResourceManager</span></pre><p id="85fd" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这一行基本上是说“id为<strong class="io hq">c 1438 b 06 b 128 b 7 faf 16 b 60 e 06 f 404 f 05</strong>的TaskManager将其自身注册到ResourceManager。”</p><p id="8ac5" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">此后，JobManager从ResourceManager请求一个任务槽来执行客户机的任务(实际上是流)。</p><h1 id="62ef" class="kk kc hp bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">TaskManager的日志文件</h1><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="0a6b" class="kb kc hp jx b fi kd ke l kf kg">2020-02-28 00:03:44,843 INFO  org.apache.flink.runtime.taskexecutor.TaskManagerRunner       -  Starting TaskManager (Version: 1.10.0, Rev:aa4eb8f, Date:07.02.2020 @ 19:18:19 CET)</span></pre><p id="7247" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">TaskManagerRunner是独立模式下TaskManager的入口点。这个类构造了相关的组件，如内存管理器、网络、I/O管理器等。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="499a" class="kb kc hp jx b fi kd ke l kf kg">2020-02-28 00:03:45,846 INFO  org.apache.flink.runtime.taskexecutor.TaskManagerRunner       - Starting TaskManager with ResourceID: c1438b06b128b7faf16b60e06f404f05</span></pre><p id="c19d" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">TaskManager id(称为ResourceId)在方法中生成:</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="bb8d" class="kb kc hp jx b fi kd ke l kf kg">public final class <br/>org.apache.flink.runtime.clusterframework.types.ResourceId ... {</span><span id="71b2" class="kb kc hp jx b fi lh ke l kf kg"><em class="jn">/**<br/> * Generate a random resource id.<br/> *<br/> * </em><strong class="jx hq"><em class="jn">@return </em></strong><em class="jn">A random resource id.<br/> */<br/></em>public static ResourceID generate() {<br/>   return new ResourceID(new AbstractID().toString());<br/>}<br/>}</span></pre><p id="dd46" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们看一下日志语句，其中TaskManager向资源管理器注册自己:</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="f538" class="kb kc hp jx b fi kd ke l kf kg">2020-02-28 00:03:46,176 INFO  org.apache.flink.runtime.taskexecutor.TaskExecutor            - Connecting to ResourceManager akka.tcp://flink@localhost:6123/user/resourcemanager(00000000000000000000000000000000).</span><span id="69a1" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:46,336 INFO  org.apache.flink.runtime.taskexecutor.TaskExecutor            - Resolved ResourceManager address, beginning registration</span><span id="9197" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:46,336 INFO  org.apache.flink.runtime.taskexecutor.TaskExecutor            - Registration at ResourceManager attempt 1 (timeout=100ms)</span><span id="4fb7" class="kb kc hp jx b fi lh ke l kf kg">2020-02-28 00:03:46,426 INFO  org.apache.flink.runtime.taskexecutor.TaskExecutor            - Successful registration at resource manager akka.tcp://flink@localhost:6123/user/resourcemanager under registration id b266a3eeb6c19ada5969142c1ffb2651.</span></pre><p id="3200" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">日志清楚地表明“发生了什么事”，我猜想。</p><p id="cab4" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是这篇文章的主题。希望我将继续第2部分，创建示例Apache Flink集群。</p><p id="3dbc" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后但同样重要的是，等待下一个帖子…</p></div></div>    
</body>
</html>