<html>
<head>
<title>calloc ( )- Dynamic memory allocation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">calloc ( )-动态内存分配</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/calloc-dynamic-memory-allocation-562ab4276367?source=collection_archive---------19-----------------------#2020-05-18">https://medium.com/analytics-vidhya/calloc-dynamic-memory-allocation-562ab4276367?source=collection_archive---------19-----------------------#2020-05-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3969" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上一篇文章中，我们简要讨论了malloc()并使用malloc()的概念解决了一个问题。如果你想研究它，那么这里是<a class="ae jd" rel="noopener" href="/@bindu.khadka.np/dynamic-memory-allocation-863d8e2e7e61"> <strong class="ih hj">链接</strong> </a>。为了更好地理解这个主题，我还写了一篇关于如何为C程序分配内存以及栈和堆的概念的文章，这里是关于这个主题的<a class="ae jd" rel="noopener" href="/@bindu.khadka.np/memory-allocation-in-c-f9bac69c70d4"> <strong class="ih hj">链接</strong> </a>。</p><p id="5812" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">读完这两篇文章后，你可能对calloc()有了一点了解。现在是时候深入这个话题了。</p><p id="d59a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">calloc()是另一个内存管理函数，用于动态分配多个内存块。它通常用于在运行时请求存储派生数据类型(如数组和结构)的内存空间。</p><p id="d0c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此函数的声明:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="5743" class="jn jo hi jj b fi jp jq l jr js">ptr = ( cast-type *) calloc (n, elem-size);</span></pre><p id="5f12" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它需要两个参数。第一个参数定义数组必须能够容纳的项数，第二个参数以字节为单位指定每个项的大小。</p><p id="cd33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">示例:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="28fd" class="jn jo hi jj b fi jp jq l jr js">ptr = (int * ) calloc (5, sizeof(int)</span></pre><p id="d5a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">成功执行该语句后，calloc()函数将分配5个块，每个块的大小为4个字节。所有字节都被初始化为零，并返回一个指向所分配区域的第一个字节的指针。如果没有足够的可用空间，则返回一个空指针。</p><p id="2a79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图可以很好地说明这一点:</p><figure class="je jf jg jh fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es jt"><img src="../Images/a46b1fa5b494bb4a57c9ffb67ed47b0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m8QRluxEpCZoNq21MBOj-A.png"/></div></div></figure><p id="c250" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，我们已经知道calloc()函数是如何工作的。现在让我们实现这个概念来解决一个问题:</p><p id="228b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">计算数组中所有存储元素总和的程序。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="f5fe" class="jn jo hi jj b fi jp jq l jr js">ptr=(int *) calloc (size,sizeof(int));</span></pre><p id="9289" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里<strong class="ih hj"> ptr </strong>是一个类型为<strong class="ih hj"> int </strong>的指针，而<strong class="ih hj"> size </strong>是一个类型为<strong class="ih hj"> int、</strong>的变量，在执行完这条语句后，你将赋予变量<strong class="ih hj"> size </strong>的值将是内存内部分配的总块数，每个块的大小将等于4个字节，因为<strong class="ih hj"> int </strong>的大小通常为4个字节。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="5f5d" class="jn jo hi jj b fi jp jq l jr js">if (ptr == NULL) {<br/>    printf("Error! memory not available.");<br/>    exit(0);<br/>}</span></pre><p id="c280" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果指针ptr指向NULL，该语句会显示一个错误，也就是说，如果内存中没有可供分配的空间，它只会显示一条错误消息。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="8b26" class="jn jo hi jj b fi jp jq l jr js">for (i = 0; i &lt; size; i++) {<br/>    printf("Element %d:", i + 1);<br/>    scanf("%d", ptr + i);<br/><br/>}</span></pre><p id="7a61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个语句只是读取输入的元素。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="388d" class="jn jo hi jj b fi jp jq l jr js">for (i = 0; i &lt; size; i++) {<br/>    sum = sum + *(ptr + i);<br/>}</span></pre><p id="73c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这段代码简单地将一个数组的所有元素相加。</p><p id="fe9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:<strong class="ih hj"> * </strong>符号用于访问指针指向的元素。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="6641" class="jn jo hi jj b fi jp jq l jr js">free(ptr);</span></pre><p id="49c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你使用calloc分配内存，并且你已经在你的程序中使用完了它，它必须使用函数<strong class="ih hj"> <em class="kb"> free() </em> </strong>返回给系统。</p><p id="78ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是整个程序的样子:</p><figure class="je jf jg jh fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kc"><img src="../Images/bb3556c125f699e1a8af4d8391f6fdbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aJ2X3IydhzaiFdmTs9w59w.png"/></div></div></figure><p id="ec0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出:</p><figure class="je jf jg jh fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kd"><img src="../Images/e026b239701ac1470e2c966c29480792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hHcQ8TllUhlsY_1b2Hioug.png"/></div></div></figure><p id="e88a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这都是关于calloc()的，在下一篇文章中我们将讨论realloc()。</p></div></div>    
</body>
</html>