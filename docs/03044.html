<html>
<head>
<title>Hidden Markov Models for Time Series in R studio [Stock Market Data]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R studio中时间序列的隐马尔可夫模型[股票市场数据]</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/hidden-markov-models-for-time-series-in-r-studio-5ae2b9fb0701?source=collection_archive---------3-----------------------#2020-01-14">https://medium.com/analytics-vidhya/hidden-markov-models-for-time-series-in-r-studio-5ae2b9fb0701?source=collection_archive---------3-----------------------#2020-01-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/11a2a9cc26bab57b706dec6f7fa48d12.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/0*EpRJtq6_fEay2dcH.jpg"/></div></figure><p id="c713" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这篇博客中，你可以期待得到一个关于隐马尔可夫模型及其在时间序列数据上的应用的直观想法。此外，我还提到了隐马尔可夫模型的R包和R代码，以供参考。</p><p id="5e9b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个工作是我在Praxis商学院(学生时代)期间做的。现在，让我们开始吧…</p><p id="e4fe" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">隐马尔可夫模型是由数学家L. E .鲍姆和他的同事开发的。隐马尔可夫模型是建模时间序列数据的普遍工具。它们被用于几乎所有当前的语音识别系统以及人工智能和模式识别的其他领域。</p><p id="2ab9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">隐马尔可夫模型是一种表示一系列观察值的概率分布的工具。它假设在时间<em class="jl"> t </em>的观察是由一些进程产生的，这些进程的状态对观察者是隐藏的。</p><p id="46bc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们举一个例子:</p><p id="7cf1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">假设有两个叫爱丽丝和鲍勃的朋友。所以鲍勃的情绪会随着天气的变化而变化，所以如果是晴天，那么鲍勃最开心，现在他在电话里告诉爱丽丝他很开心(<em class="jl">观察</em>)，所以她从这些信息中推断出是晴天(<em class="jl">隐藏状态</em>，如果是雨天(<em class="jl">隐藏状态</em>，那么鲍勃最暴躁(<em class="jl">观察</em>)。注意，这里Bob家的天气对Alice( <em class="jl">观察者</em>)来说是隐藏的，她所拥有的唯一信息来自Bob <em class="jl">(即开心或暴躁)</em>。假设我们观察到，如果是晴天，那么第二天是晴天的概率是0.8，第二天是雨天的概率是0.2。如果今天下雨，那么第二天下雨的概率是0.6，所以第二天是晴天的概率是0.4。这些概率称为转移概率。</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es jm"><img src="../Images/8e1d24307d2ee7bf03075ca13a6504b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*jZYSrOc0X9kwOx6_06m68Q.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">给定15天期间观察到的数据</figcaption></figure><p id="39ab" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在上面的数据集中，我们可以看到，在阳光明媚的日子里，快乐的概率是0.8，在阳光明媚的日子里，脾气暴躁的概率是0.2。同样，鲍勃在下雨天脾气暴躁的概率是0.6，在下雨天快乐的概率是0.4。这些概率被称为排放概率。</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es jv"><img src="../Images/7a8627a4cb05712738cf29e987875c4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wrFH8zZUT4m42M-uDuZXIw.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">显示转移概率和排放概率的图片</figcaption></figure><p id="c24f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们计算先验概率。P(S)=0.67，P(R)=0.33。</p><p id="9a2c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，让我们假设三天来鲍勃是快乐的，暴躁的，快乐的，那么这三天的天气是怎样的，换句话说，这三天的天气顺序是怎样的。我们知道每天我们有两个可能的场景(<em class="jl">晴天和雨天</em>)，所以三天，比如说周三、周四、周五，我们总共有8个可能的序列(2*2*2=8)。我们将选择其中的每一个，计算在给定的天气条件下(隐藏状态的<em class="jl">序列</em>)鲍勃开心、暴躁、开心的概率是多少，然后选择给我们最高概率的一个。这被称为最大后验估计。</p><p id="1622" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了简单起见(演示)，让我们用两天时间(<em class="jl">星期三，星期四</em>)。HMM模型将看起来像下面的图片。我们有先验概率P(S)=0.67，转移概率0.2，假设天气晴朗，鲍勃快乐的概率P(H|S)=0.8，假设天气下雨，鲍勃脾气暴躁的概率P(G|R)=0.2。注意这里观察到的顺序是快乐→暴躁，隐藏状态的四个可能顺序之一是晴天→雨天。观察序列的概率是所有这些概率的乘积，因为根据马尔可夫性质，在时间<em class="jl"> t </em>给出一个状态，在时间<em class="jl"> t </em>的观察独立于所有其他时间索引的状态和观察。</p><p id="de54" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">P( <em class="jl"> hidden_state_sequence(晴→雨)，observed_sequence(开心→暴躁))</em> =P( <em class="jl"> prior(晴)</em>)* Transition _ probability(<em class="jl">晴→雨</em> )*P(开心|晴)*P(暴躁|雨)= 0.67*0.2*0.8*0.6=0.064</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es ka"><img src="../Images/94fd21b63744f9b7cc1cf9a5f8bc7088.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*OiQEebCbiRqHiChy__pZ_w.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">对于隐藏状态序列(晴天→雨天)</figcaption></figure><p id="5e84" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果对所有4种可能的情况都这样计算，会发现对于隐藏态序列Sunny →Sunny，联合概率最大。所以，这个模型使得快乐→暴躁最有可能发生在阳光→阳光的序列上。</p><p id="14e8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用HMM可以解决3种类型的问题:</p><ol class=""><li id="f4c9" class="kb kc hi io b ip iq it iu ix kd jb ke jf kf jj kg kh ki kj bi translated"><strong class="io hj">评估</strong> →找出给定HMM模型的观察序列的概率。(<em class="jl">向前/向后算法</em>)</li><li id="63d2" class="kb kc hi io b ip kk it kl ix km jb kn jf ko jj kg kh ki kj bi translated"><strong class="io hj">解码</strong> →找到最有可能生成观察序列的隐藏状态序列。(<em class="jl">正如我们在上面的例子</em>中所做的)。(<em class="jl">维特比算法</em>)</li><li id="af61" class="kb kc hi io b ip kk it kl ix km jb kn jf ko jj kg kh ki kj bi translated"><strong class="io hj">学习</strong> →给定一个观察序列，生成一个隐马尔可夫模型。(<em class="jl">伯奇-韦尔奇估计</em>)</li></ol><p id="74e0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，让我们看看如何使用样本数据实现R中的隐马尔可夫模型。</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es kp"><img src="../Images/8dfe6d8c86f8e1607fb287acb4356fbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ofE8LtD86yvY9ZOa05bbQQ.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">数据和重要包</figcaption></figure><p id="4459" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在R studio(我的3.6版)中可以用包depmixS4实现HMM。我从一个博客中选取了一个示例，其中的数据代表了医生的处方值与时间的关系。</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es kq"><img src="../Images/1c3bb97ed0f1447a11eb4120093d4889.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*Io_tFqULvmLtBkjpaP0c2w.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">符合模型</figcaption></figure><p id="57da" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里我们学习隐马尔可夫模型的参数(转移概率和发射概率)。在上述模型中，将状态数初始化为2。</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es kr"><img src="../Images/be554a5826b38526cb2b41fb6f055cd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/1*7RQYKQ_8-Df2KL1ozbwhaA.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">转移概率代码</figcaption></figure><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es ks"><img src="../Images/358a60023d8aa8c1ace9297102d29c8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:528/format:webp/1*u-uRDhwHAkBtQldv1SlakA.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">转移矩阵和响应参数</figcaption></figure><p id="003e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在上图中，我们可以看到转移矩阵和每个状态的值。从响应参数中，我们可以看到两个隐藏状态，高和低。高(<em class="jl">114.73–27.23，114.73+27.23 </em>)低(<em class="jl">40.92–20.96，40.92+20.96 </em>)。让我们看看后验概率..</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es kt"><img src="../Images/1c1078acdb4a853dfdf1876a8a5e2a64.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*pauS9cuzXdVyg3lxWHq8Jg.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">每个状态的概率。</figcaption></figure><p id="d7ef" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以在图中看到数据中标注的隐藏状态。这就是我们数据中隐藏的序列。</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es ku"><img src="../Images/0d456a7e3451e2421586a915e6e63122.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*dtyJccda8eXzexPOdX6eWw.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">两种状态的概率图</figcaption></figure><p id="b5f2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">股市数据上的隐马尔可夫模型:</strong></p><p id="cc6d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">鉴于许多大公司的明显兴趣，股票市场预测一直是过去比较活跃的研究领域之一。历史上，各种机器学习算法已经被应用，并取得了不同程度的成功。然而，由于股票预测的非平稳性、季节性和不可预测性，它仍然受到严重的限制。仅从以前的股票数据预测预测是一项更具挑战性的任务，因为它忽略了几个无关紧要的因素。</p><p id="cf7a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">hmm能够从连续的观察数据中模拟隐藏状态转换。股票预测的问题也可以认为是遵循同样的模式。股票的价格取决于许多因素，这些因素通常对投资者来说是不可见的(隐藏变量)。潜在因素之间的转换根据公司政策和决策、财务状况和管理决策而变化，这些因素会影响股票的价格(观察数据)。因此，hmm是解决价格预测问题的天然选择。该数据集已经使用R中的<em class="jl"> quantmod </em>库从WWW上删除，包含与特定股票表现相关的信息。目标是使用该数据找到HMM模型的隐藏状态和参数。</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es kv"><img src="../Images/c0f1c95aac0ef41bf390230eda499b02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*sGPtlY3Wy77dCuhqj4B_SA.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">加载数据</figcaption></figure><p id="caf2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们提取与TWII相关的信息，数据集包含与给定一天的开盘价和收盘价、最高价和最低价以及股票交易量相关的信息。我们感兴趣的是用我们的HMM建模当天收盘价和开盘价之间的差值。我只收集了两年的数据。</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/091dd1d0699209f0ce53658990a19c4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:304/format:webp/1*ImRoLAUs6iU2lS6nelyLVw.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">TWII_train的前5行</figcaption></figure><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es ku"><img src="../Images/20d2b752cb20d2d0a88261dfdbf5e6d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*xrih9ODn53YcJxBdxZGVKw.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">截至2020年1月13日的库存量图表</figcaption></figure><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es kx"><img src="../Images/f6e891e3c37aa7e14a2c830ba7f21323.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*MqXIf9p9z-6W39L6m0YpUA.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">拟合HMM的代码</figcaption></figure><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es ky"><img src="../Images/5e5946f5c99d04a26b5134d45e53d396.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*92XD2ZcqR0t-3nlptuX-8g.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">转移矩阵和响应参数</figcaption></figure><p id="d4e2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在找到5个隐藏状态的HMM模型后，我们得到上面的转移矩阵。</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es kz"><img src="../Images/d90f1c71fa3b142e0934997e14013f61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*NbJr_Su-Yb0ArexYUie1uw.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">寻找后验概率的代码</figcaption></figure><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es la"><img src="../Images/e41884a67e166e35bf0892cd3fa2eaf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*C_laVylFEg0Mj7H9z6FK9w.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">前6次观察的预测</figcaption></figure><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es kt"><img src="../Images/4381e60f2b17258fca631a51f6a0ec79.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*qKy0ha3_Mq61imndwCpAVQ.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">观察和相应的状态</figcaption></figure><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/6cda14138f9f78b3f1577b231ccc705f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*ywTGkx_eAmitvcDmRjG0Rw.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">显示不同的状态</figcaption></figure><p id="943a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在上图中，我们可以看到我们的隐藏状态是如何映射到股票市场图的。这给了我们关于数据中隐藏状态的不同序列的想法，并且如果我们有足够的领域知识，可以从所获得的隐藏状态中推断出一些见解。</p><p id="d4e8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">结论:</strong></p><p id="62df" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们已经了解了什么是隐马尔可夫模型，并将其应用于不同的数据集，对隐马尔可夫模型有了直观的认识，并在股票市场数据上建立了HMM。</p><p id="b095" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在下一篇博客中，我将讲述连续时间隐马尔可夫模型和HMM中用于减少复杂计算任务的算法。将来会有更多的学习帖子，所以请关注我的媒体，保持关注！！</p><p id="4f60" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">其他资源和参考:</strong></p><ol class=""><li id="662d" class="kb kc hi io b ip iq it iu ix kd jb ke jf kf jj kg kh ki kj bi translated">【https://www.youtube.com/watch?v=kqSzLo9fenk】→必看，非常精彩的解说博客的大部分内容都是从这里摘来的。</li><li id="256e" class="kb kc hi io b ip kk it kl ix km jb kn jf ko jj kg kh ki kj bi translated"><a class="ae jk" href="https://rubikscode.net/2018/10/29/stock-price-prediction-using-hidden-markov-model/" rel="noopener ugc nofollow" target="_blank">https://rubiks code . net/2018/10/29/stock-price-prediction-using-hidden-Markov-model/</a>→博客。</li><li id="2f47" class="kb kc hi io b ip kk it kl ix km jb kn jf ko jj kg kh ki kj bi translated"><a class="ae jk" href="https://blog.revolutionanalytics.com/2014/03/r-and-hidden-markov-models.html" rel="noopener ugc nofollow" target="_blank">https://blog . revolution analytics . com/2014/03/r-and-hidden-Markov-models . html</a></li><li id="0d78" class="kb kc hi io b ip kk it kl ix km jb kn jf ko jj kg kh ki kj bi translated">http://mlg.eng.cam.ac.uk/zoubin/papers/ijprai.pdf→这是一篇非常值得一读的论文。</li><li id="1381" class="kb kc hi io b ip kk it kl ix km jb kn jf ko jj kg kh ki kj bi translated"><a class="ae jk" href="https://www.youtube.com/watch?v=j3r9a75zOvM" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=j3r9a75zOvM</a>→我在博客中引用了这段youtube视频。</li></ol></div></div>    
</body>
</html>