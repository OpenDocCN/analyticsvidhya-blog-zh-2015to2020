<html>
<head>
<title>Analyzing Geospatial Environmental Data using Plotly Express and GeoPandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Plotly Express和GeoPandas分析地理空间环境数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/analyzing-geospatial-enviromental-data-using-plotly-and-geopandas-c568eba96ac6?source=collection_archive---------6-----------------------#2020-06-06">https://medium.com/analytics-vidhya/analyzing-geospatial-enviromental-data-using-plotly-and-geopandas-c568eba96ac6?source=collection_archive---------6-----------------------#2020-06-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ee560855029a496ba4d18b5aebe10f39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rp91GgBPL85OiGsEk6z4gQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">伊恩在<a class="ae iu" href="https://unsplash.com/s/photos/geo-map?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="9409" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">介绍</h1><p id="cc18" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">在本文中，我将使用GeoPandas库中的内置方法分析python中的地理空间环境数据，并使用Plotly库绘制几个地理散点图、直方图、箱线图和条形图。</p><p id="ae37" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">GeoPandas库可以用来读取格式为<strong class="jv hj">的文件。shp </strong>或<strong class="jv hj">。geojson </strong></p><p id="df7b" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">我使用了geojson格式的<strong class="jv hj">欧洲空气质量</strong>数据，还使用了另一个包含欧洲所有国家地图的geojson文件。</p><p id="d86a" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">描述可以在<a class="ae iu" href="http://opendata.esri.es/datasets/datos-de-calidad-del-aire?geometry=146.718%2C88.176%2C11.718%2C90.000" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p><h1 id="b52a" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">索引</h1><ul class=""><li id="0c79" class="kw kx hi jv b jw jx ka kb ke ky ki kz km la kq lb lc ld le bi translated">获取数据</li><li id="b4a8" class="kw kx hi jv b jw lf ka lg ke lh ki li km lj kq lb lc ld le bi translated">导入必要的库来承担这个项目</li><li id="e05f" class="kw kx hi jv b jw lf ka lg ke lh ki li km lj kq lb lc ld le bi translated">利用<strong class="jv hj"> GeoPandas库</strong>的内置方法计算空气质量数据的基本统计量</li><li id="d1e1" class="kw kx hi jv b jw lf ka lg ke lh ki li km lj kq lb lc ld le bi translated">生成直方图并了解PM 2,5的分布</li><li id="7dc9" class="kw kx hi jv b jw lf ka lg ke lh ki li km lj kq lb lc ld le bi translated">创建盒状图以检测异常值</li><li id="aaff" class="kw kx hi jv b jw lf ka lg ke lh ki li km lj kq lb lc ld le bi translated">用相关图和散点图检验空气质量与海拔的关系</li><li id="26d5" class="kw kx hi jv b jw lf ka lg ke lh ki li km lj kq lb lc ld le bi translated">对数据的进一步检查</li><li id="84d9" class="kw kx hi jv b jw lf ka lg ke lh ki li km lj kq lb lc ld le bi translated">绘制地理散点图</li><li id="39ac" class="kw kx hi jv b jw lf ka lg ke lh ki li km lj kq lb lc ld le bi translated">将国家数据框与空气质量数据框合并</li><li id="af97" class="kw kx hi jv b jw lf ka lg ke lh ki li km lj kq lb lc ld le bi translated">所有国家PM 2,5水平合计平均值的柱状图</li><li id="ef59" class="kw kx hi jv b jw lf ka lg ke lh ki li km lj kq lb lc ld le bi translated">PM 2,5水平最大值记录的所有国家的柱状图</li><li id="dd2d" class="kw kx hi jv b jw lf ka lg ke lh ki li km lj kq lb lc ld le bi translated">标出污染程度高的国家</li></ul><h1 id="a313" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">获取数据</h1><p id="1be1" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">首先，我将使用Curl命令获取数据，并将其保存在一个名为data.geojson的文件中</p><p id="2027" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">下载数据的链接是<a class="ae iu" href="https://opendata.arcgis.com/datasets/784fc60a00fa41cb9babb52023cb2db3_0.geojson" rel="noopener ugc nofollow" target="_blank">这里</a></p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="ec60" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">我还使用了所有欧洲国家的geojson地图数据<a class="ae iu" href="https://geojson-maps.ash.ms/" rel="noopener ugc nofollow" target="_blank">这里</a></p><h1 id="0bcb" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">导入必要的库来承担这个项目</h1><p id="32bf" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们将使用名为Plotly express的新Plotly API。</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><h1 id="4236" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">使用内置方法GeoPandas数据框计算基本统计数据</h1><p id="b8c9" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated"><strong class="jv hj">让我们一起探索空气质量数据集</strong></p><p id="ba06" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">GeoPandas使我们能够通过它的<strong class="jv hj"> read_file </strong>命令读取任何geojson文件</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="0eca" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">没有列表示车站的国家，发现有必要将此数据框与包含所有欧洲国家位置的数据框连接起来。</p><p id="c590" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">每个GeoPandas数据框都有一个名为<strong class="jv hj"> geometry的列。</strong>我用CRS方法找到了这个几何列的属性。可以看出，该数据帧的EPSG是4326。EPSG 4326表示数据以<strong class="jv hj">经纬度</strong>的形式存在。</p><p id="6f7e" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><strong class="jv hj">在制作地质散射图之前，让我们探索一下其他地块的特征，以了解PM 2,5的分布</strong></p><h1 id="5e1f" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">生成直方图并了解PM 2,5的分布</h1><p id="cfe5" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">这里我用了Plotly express的<strong class="jv hj">直方图</strong>函数。</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/c9d3522967b0d6bbd2c0909f697428f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFtpLhiFpgucIuXCp1tiGw.png"/></div></div></figure><p id="d317" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><strong class="jv hj">有点偏右。</strong></p><h1 id="a0c4" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">创建盒状图以检测异常值</h1><p id="8ff0" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">这里我用了Plotly express的<strong class="jv hj">框</strong>功能。</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/47502e167af845ed26dec1a79c478f97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BzWRa5hHcwaoO2zR1qhISA.png"/></div></div></figure><p id="3342" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><strong class="jv hj">高于27的值被视为异常值。</strong></p><h1 id="e9a4" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">用相关图和散点图检验空气质量与海拔的关系</h1><p id="09d9" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated"><strong class="jv hj">让我们看看海拔和PM 2,5水平之间是否有很强的相关性。</strong></p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="12fa" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><strong class="jv hj">有一周负相关。</strong></p><p id="e714" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><strong class="jv hj">散点图也将证实这一点。</strong></p><p id="0367" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">下面是我用Plotly express的<strong class="jv hj">散点</strong>功能。</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/df312a97c5af437df424ebc6aef430b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8oe4Plk8TbR5B1WTlM6jsg.png"/></div></div></figure><p id="06c5" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">对于高海拔地区，空气质量比低海拔地区好得多，这是因为通常低海拔地区人口较多。</p><h1 id="21e8" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">对数据的进一步检查</h1><p id="a322" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">大多数车站在哪里？</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="0133" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">但是在城市地区，PM 2,5水平可能高达36！</p><h1 id="4ff1" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">绘制地理散点图</h1><p id="85b1" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">让我们绘制地理散射图。</p><p id="1b9f" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">我使用plotly express的<strong class="jv hj">散点_地图框</strong>功能绘制了欧洲所有站点的位置，气泡的大小表示PM 2,5的水平。我将不透明度设置为0.4。</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/96933455799f8a474a8229924c0fca6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K05Wes9edrZ_ESRh0oHdsA.png"/></div></div></figure><p id="ce72" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">通过选择mapbox_style到<strong class="jv hj">雄蕊-地形</strong>聚焦地形</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/14cc86023cd6ea1b9cbb7be9a148b43e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bQXfWuX3S0GEfifT5wQ0iQ.png"/></div></div></figure><p id="afaa" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><strong class="jv hj">在海拔较低的地区可以发现较大的气泡</strong></p><h1 id="ba50" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">将国家数据框与空气质量数据框合并</h1><p id="c19d" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">现在，我将阅读包含每个欧洲国家地理空间数据的geojson文件，并对其进行简要分析。</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="1823" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">此GeoPandas数据框中的几何列由一个多边形组成，而不是空气质量数据框中的点。</p><p id="cbb8" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">现在，我将把它与包含空气质量信息的GeoPandas数据帧合并，这样就可以得出每个站点对应的国家。</p><blockquote class="ls lt lu"><p id="9b49" class="jt ju lv jv b jw kr jy jz ka ks kc kd lw kt kg kh lx ku kk kl ly kv ko kp kq hb bi translated"><strong class="jv hj">注意</strong> -在合并任何两个地理熊猫数据框之前，确保它们具有相同的EPSG。为了那个用途<strong class="jv hj">。crs </strong>命令并查看EPSG值。如果它们不相同，则可以使用data_frame_1.to_crs(epsg= "第二个数据帧的epsg ")更改其中一个数据帧的EPSG，以匹配另一个数据帧的EPSG</p></blockquote><p id="0048" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">在本例中，两个数据帧的EPSG相同，因此需要进行任何更改。</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><h1 id="0a96" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">描述每个国家PM 2,5水平平均值的柱状图</h1><p id="c084" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">但我只会为那些至少有5个电视台的国家绘图。</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/cd842b90dd7014e9127a0c9ced1fa75d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vxrAXWsuzrP1KZuhf2Vnjg.png"/></div></div></figure><p id="1a44" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><strong class="jv hj">平均而言，空气质量最差的监测站位于波兰、意大利和斯洛伐克。</strong></p><h1 id="df47" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">描述每个国家登记的PM 2,5最大值的柱状图</h1><p id="0bcf" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">这里我包括了所有国家。</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/c4af954206b2937a75334537d3333ac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9zfNoC5Ewsd7dEPhpUrNmw.png"/></div></div></figure><p id="0e6d" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">一些空气质量最差的监测站位于波兰、捷克共和国和意大利。</p><h1 id="bf93" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">绘制污染程度高的国家</h1><p id="d92c" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我将首先绘制一张波兰地图，我将把参数<strong class="jv hj">“zoom”指定为6 </strong>，这样当地图生成时我们只能看到波兰，我还增加了参数<strong class="jv hj"> size_max </strong>以获得更好的对比度</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/c506049f50ddb294aea93abfd1f5e757.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Fzoi4uaV_tu-nw0V6W2bQ.png"/></div></div></figure><p id="d1de" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><strong class="jv hj">位于波兰南部的监测站似乎空气质量相对较低。</strong></p><p id="b868" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">我希望这篇文章能帮助你完成自己的任务，点击这里查看整个笔记本<a class="ae iu" href="https://github.com/rajatprasad1995/European_Air_quality/blob/master/Europe_Air_quality.ipynb" rel="noopener ugc nofollow" target="_blank">我会写更多关于这个话题的帖子:)</a></p></div></div>    
</body>
</html>