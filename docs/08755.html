<html>
<head>
<title>Automating the Building of Classification Dataset Pipeline</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自动构建分类数据集管道</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/automating-the-building-of-classification-dataset-pipeline-a82aebc14e93?source=collection_archive---------22-----------------------#2020-08-11">https://medium.com/analytics-vidhya/automating-the-building-of-classification-dataset-pipeline-a82aebc14e93?source=collection_archive---------22-----------------------#2020-08-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="aa40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">厌倦了浪费时间手动搜索和下载数据集？</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/843441f6c3023846af4749f8380b6a5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*gysUtnOj9R1vcXyZadRzJA.jpeg"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">照片由<a class="ae jp" href="https://www.pexels.com/photo/person-using-macbook-pro-while-seated-on-couch-3962297/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae jp" href="https://www.pexels.com/@fotios-photos?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Lisa Fotios </a>拍摄</figcaption></figure><p id="9491" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi jq translated"><span class="l jr js jt bm ju jv jw jx jy di"> W </span>安娜建立了自己的成像数据集，但由于时间有限或其他原因而无法完成？</p><p id="0403" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jz">数据采集</em> </strong>是<em class="jz">数据分析、机器学习和深度学习中的重要步骤之一。这是收集我们感兴趣的信息的过程，在我们的例子中，它是我们想要收集的任何类型的图像。没有数据，我们无法对问题建模并进行分析。</em></p><blockquote class="ka"><p id="7da8" class="kb kc hi bd kd ke kf kg kh ki kj jc dx translated">但是谁有时间从网上搜索和下载图片呢，至少软件工程师没有时间😎<br/>我们相信尽可能让事情变得更简单！</p></blockquote><p id="3b56" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">所以，我们现在就开始吧。</p><blockquote class="kp kq kr"><p id="a44a" class="if ig jz ih b ii ij ik il im in io ip ks ir is it kt iv iw ix ku iz ja jb jc hb bi translated">目标:</p></blockquote><ul class=""><li id="149a" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated">👉使用谷歌自定义搜索 API 自动下载图片</li><li id="7d16" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">👉可选:调整图像大小，压缩图像并给自己发送邮件。</li></ul><blockquote class="kp kq kr"><p id="1c94" class="if ig jz ih b ii ij ik il im in io ip ks ir is it kt iv iw ix ku iz ja jb jc hb bi translated">需要设置:</p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lj"><img src="../Images/2d9eb87d3c68c64c02061fca65946bf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*voiIlMmp0s_eqwy057BtIQ.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lk"><img src="../Images/fda88639b7d77b1990beeed61b81b937.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*E1PEv6imt4SgK7uGxFmEZg.png"/></div></figure><blockquote class="kp kq kr"><p id="5342" class="if ig jz ih b ii ij ik il im in io ip ks ir is it kt iv iw ix ku iz ja jb jc hb bi translated">编程:</p></blockquote><p id="506f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用“<a class="ae jp" href="https://developers.google.com/custom-search/v1/overview" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">自定义搜索 JSON API </strong> </a>”，所以首先让我们设置使用 API 所需的环境。</p><h1 id="92e8" class="ll lm hi bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">获取访问 API 的凭证所需的步骤:</h1><ul class=""><li id="ed70" class="kv kw hi ih b ii mj im mk iq ml iu mm iy mn jc la lb lc ld bi translated">首先，创建一个用于开发(或测试)的 Gmail 账户。</li><li id="b7eb" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">接下来，前往<a class="ae jp" href="https://console.developers.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌开发者控制台</a>，按照以下步骤创建新项目(如果你没有任何项目)，如果你已经有一些正在运行的项目，你可以跳过这一步。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es mo"><img src="../Images/da14bb0ceb517deca5613af5e05af583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*24Qem2uuOpweUdrJWglrIw.gif"/></div></div></figure><ul class=""><li id="78cf" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated">从<a class="ae jp" href="https://console.developers.google.com/apis/" rel="noopener ugc nofollow" target="_blank"> API explorer </a>中启用 API，并获取凭证作为访问 API 的 API 密钥。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es mo"><img src="../Images/31ed32f46d50d598cd43e771cbbad9ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Vrthj1ji0fREPt9Zn-zgzw.gif"/></div></div></figure><ul class=""><li id="2e10" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated">创建谷歌自定义搜索引擎<a class="ae jp" href="https://cse.google.com/cse/all" rel="noopener ugc nofollow" target="_blank">这里</a>将搜索并返回结果。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es mo"><img src="../Images/58fb055f98b083bc3a79f67403f38819.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*otUzA1mVABOePNHAPLefaw.gif"/></div></div></figure><h1 id="d149" class="ll lm hi bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">脚本的创建:</h1><p id="66fe" class="pw-post-body-paragraph if ig hi ih b ii mj ik il im mk io ip iq mt is it iu mu iw ix iy mv ja jb jc hb bi translated">现在，让我们看一个如何调用这个 API 的小例子:</p><p id="97cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有 API 调用都将对以下 url 发出 GET 请求:</p><pre class="je jf jg jh fd mw mx my mz aw na bi"><span id="3944" class="nb lm hi mx b fi nc nd l ne nf">https://www.googleapis.com/customsearch/v1?key={API}&amp;cx={CX}&amp;q={query}</span></pre><p id="3ddf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有其他参数都通过使用&amp;{parameter_name}={value}类似地附加到链接中。</p><p id="1d05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们创建一个函数来获取这个 API 的结果，并将其读入 JSON 格式。然后，按顺序命名文件，将其下载到适当的目录。</p><p id="c594" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们定义该函数采用的参数:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es ng"><img src="../Images/ca2fd67fb9ea61d3c3a30299a1351622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0yJ4vj7xBIuwamfaG7i8gQ.jpeg"/></div></div></figure><ul class=""><li id="8ef4" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated">注意:可以有一个额外的参数(counter ),为了方便起见，它只设置命名文件的开始索引(比如 counter = 0 意味着文件将被命名为 image0，image1…..)</li></ul><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="nh ni l"/></div></figure><ul class=""><li id="8092" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated">首先我们检查目录是否不存在，然后我们开始获取 API。</li><li id="38ac" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">第一个 for 循环从第 5 行开始，用于以名为 URL/links 的列表形式存储所有图像的链接。</li><li id="5a1d" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">我们在第 6 行创建 GET 请求，追加尽可能多的参数来过滤搜索。</li><li id="0393" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">然后，我们在第 7 行使用 json 加载返回结果的文本(字符串形式)。</li><li id="d4cb" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">现在，首先我们将从第 9-13 行一次获取 100 张图片的所有 url。</li></ul><p id="18f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(在一次操作中，Google 将其结果限制为最多 10 个，因此我请求 10 次以获得 100 张图片)。</p><ul class=""><li id="9e67" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated">然后，从存储在列表中的所有链接中下载这些图像将在第 23 行开始使用 urllib 中的 urlretrieve()函数。</li><li id="0e98" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">第 27 行的第二个循环使用了<a class="ae jp" href="https://github.com/tqdm/tqdm" rel="noopener ugc nofollow" target="_blank"> tqdm </a>，这只是下载过程中显示进度条的一种奇特方式。</li><li id="78d8" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">我们也在处理一些常见的错误，比如一些网站由于隐私问题不允许直接下载，所以我们需要在第 27 行创建我们自己的 POST 安全请求。</li><li id="bae0" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">在这种情况下，我们也以字节形式将它写入目录。</li><li id="f67e" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">现在，在下载完成后，从 39 到 49 的最后几行只是检查目录是否已经存在，然后它给用户选择是否通过删除旧图像再次下载。</li></ul><blockquote class="kp kq kr"><p id="0bd0" class="if ig jz ih b ii ij ik il im in io ip ks ir is it kt iv iw ix ku iz ja jb jc hb bi translated">输出:</p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es nj"><img src="../Images/ad2feecd9b1b45c184e28c8c1edbe8d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rRNDTjg-GxI3VEz3zlCcbg.jpeg"/></div></div></figure><p id="6d61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用于查询的下载图像的一些例子:“机器学习”:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es nk"><img src="../Images/10562b9e2b4d148f482a3328fb862b4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sARLdKSD-RYVJeshSuk2-Q.jpeg"/></div></div></figure><p id="1583" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用于查询的下载图像的一些例子:“神经网络”</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es nl"><img src="../Images/8a37141cbcd6dd02ed4ffc8a76988406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oUYHdC1X0w-vEZx4mQC0jg.jpeg"/></div></div></figure><blockquote class="kp kq kr"><p id="4e11" class="if ig jz ih b ii ij ik il im in io ip ks ir is it kt iv iw ix ku iz ja jb jc hb bi translated">总结:</p></blockquote><p id="8ec3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我相信这应该给了你一些开始建立你自己的数据集并与社区分享的机会👍</p><p id="caf4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想继续进行项目的可选目标—修改图像，可能转换为灰度(用于构建灰度图像数据集)，压缩图像，然后给自己(或任何人)发送一封包含数据集附件的邮件，然后查看下面参考资料部分中的完整代码。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es nm"><img src="../Images/a75f7bc2392a6719eb5af0d0606feefe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JLR2lKa-OUWoXhyJjUlIcg.jpeg"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es nn"><img src="../Images/4e941d2ea5b7be02d58681710027cedb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TGd2l7hEN2wjlq5Fyy_-UA.jpeg"/></div></div></figure><p id="9271" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一些令人兴奋的东西在下面的参考资料部分，一定要去看看。</p><p id="be39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jz">注意:所有的图片都是知识共享的，这些图片都有作者的署名，没有署名的都是我的。</em></p><h1 id="55a4" class="ll lm hi bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">资源:</h1><ul class=""><li id="2217" class="kv kw hi ih b ii mj im mk iq ml iu mm iy mn jc la lb lc ld bi translated">包含完整代码的<a class="ae jp" href="https://github.com/souravs17031999/Automate-images-download" rel="noopener ugc nofollow" target="_blank"> Github repo </a>包含项目的所有部分，以及在本地机器上开始的说明。</li><li id="a93d" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">这里有一个有趣的<a class="ae jp" href="https://developers.google.com/custom-search/v1/cse/list" rel="noopener ugc nofollow" target="_blank"> API explorer </a>，你可以用它来掌握定制搜索 API 的强大功能和更多的参数，根据你的需要过滤你的搜索。</li><li id="53f5" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">安装<a class="ae jp" href="https://pypi.org/project/requests/" rel="noopener ugc nofollow" target="_blank">请求</a>、<a class="ae jp" href="https://pypi.org/project/urllib3/" rel="noopener ugc nofollow" target="_blank"> urllib </a>。</li><li id="e154" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">💡继续构建一个 GUI 界面，它接受所需的参数，并在给定的输出目录下下载图像。</li><li id="5498" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">💡我们还可以使用<a class="ae jp" href="https://developers.google.com/youtube/v3/docs" rel="noopener ugc nofollow" target="_blank"> Youtube 数据 API V3 </a>构建视频数据集。但是让我们把它留到另一篇文章中🙂。</li></ul></div></div>    
</body>
</html>