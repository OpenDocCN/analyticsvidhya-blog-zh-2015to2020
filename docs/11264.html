<html>
<head>
<title>Pandas DataFrame to PostgreSQL using Python !! Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 将数据帧转换成 PostgreSQL！！第二部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/pandas-dataframe-to-postgresql-using-python-part-2-3ddb41f473bd?source=collection_archive---------7-----------------------#2020-11-26">https://medium.com/analytics-vidhya/pandas-dataframe-to-postgresql-using-python-part-2-3ddb41f473bd?source=collection_archive---------7-----------------------#2020-11-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="54a6" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated"><strong class="ak">使用 Python 在 PostgreSQL 数据库中创建表格</strong></h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/3a0d2b8d5e3d31e5f0b30c962f3fdea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35b7N35MRl-76Gx8kpkMTw.png"/></div></div></figure><h1 id="6875" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">先决条件</h1><p id="4602" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated"><strong class="kd hj">Python 3 . 8 . 3:</strong><a class="ae kx" href="https://www.anaconda.com/products/individual" rel="noopener ugc nofollow" target="_blank">Anaconda 下载链接</a></p><p id="0edc" class="pw-post-body-paragraph kb kc hi kd b ke ky ij kg kh kz im kj kk la km kn ko lb kq kr ks lc ku kv kw hb bi translated"><strong class="kd hj">PostgreSQL 13:</strong>T8<strong class="kd hj">T10】下载链接</strong></p><p id="aa75" class="pw-post-body-paragraph kb kc hi kd b ke ky ij kg kh kz im kj kk la km kn ko lb kq kr ks lc ku kv kw hb bi translated"><strong class="kd hj"> Psycopg2 : </strong>安装<strong class="kd hj"> Psycopg2 </strong>使用命令:<strong class="kd hj"> pip 安装 psycopg2 </strong></p><h1 id="3ecb" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">目标</h1><p id="bce3" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">本文的主要目标是逐步学习创建表的工作代码。</p><h2 id="cd60" class="ld jk hi bd jl le lf lg jp lh li lj jt kk lk ll jv ko lm ln jx ks lo lp jz lq bi translated">步骤 1:导入库</h2><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="e902" class="ld jk hi ls b fi lw lx l ly lz"><strong class="ls hj"># import sys to get more detailed Python exception info</strong><br/>import sys<br/><strong class="ls hj"># import the connect library for psycopg2</strong><br/>import psycopg2<br/><strong class="ls hj"># import the error handling libraries for psycopg2</strong><br/>from psycopg2 import OperationalError, errorcodes, errors</span></pre><p id="0d79" class="pw-post-body-paragraph kb kc hi kd b ke ky ij kg kh kz im kj kk la km kn ko lb kq kr ks lc ku kv kw hb bi translated"><strong class="kd hj">第二步:指定连接参数</strong></p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="89f2" class="ld jk hi ls b fi lw lx l ly lz"><strong class="ls hj"># Note: please change your database, username &amp; password as per your own values<br/></strong>conn_params_dic = {<br/>    "host"      : "localhost",<br/>    "database"  : "irisdb",<br/>    "user"      : "postgres",<br/>    "password"  : "Passw0rd"<br/>}</span></pre><p id="5da7" class="pw-post-body-paragraph kb kc hi kd b ke ky ij kg kh kz im kj kk la km kn ko lb kq kr ks lc ku kv kw hb bi translated">步骤 3:定义一个处理和解析 psycopg2 异常的函数</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="291b" class="ld jk hi ls b fi lw lx l ly lz"><strong class="ls hj">def show_psycopg2_exception(err):</strong><br/>    <strong class="ls hj"># get details about the exception</strong><br/>    err_type, err_obj, traceback = sys.exc_info()   <strong class="ls hj"> <br/>    # get the line number when exception occured</strong><br/>    line_n = traceback.tb_lineno    <br/>    <strong class="ls hj"># print the connect() error</strong><br/>    print ("\npsycopg2 ERROR:", err, "on line number:", line_n)<br/>    print ("psycopg2 traceback:", traceback, "-- type:", err_type) <br/>    <strong class="ls hj"># psycopg2 extensions.Diagnostics object attribute</strong><br/>    print ("\nextensions.Diagnostics:", err.diag)   <strong class="ls hj"> <br/>    # print the pgcode and pgerror exceptions</strong><br/>    print ("pgerror:", err.pgerror)<br/>    print ("pgcode:", err.pgcode, "\n")</span></pre><p id="134b" class="pw-post-body-paragraph kb kc hi kd b ke ky ij kg kh kz im kj kk la km kn ko lb kq kr ks lc ku kv kw hb bi translated"><strong class="kd hj">第四步:定义一个连接函数来连接 PostgreSQL 数据库服务器</strong></p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="d7a2" class="ld jk hi ls b fi lw lx l ly lz"><strong class="ls hj">def connect(conn_params_dic):</strong><br/>    conn = None<br/>    try:<br/>        print('Connecting to the PostgreSQL...........')<br/>        conn = psycopg2.connect(**conn_params_dic)<br/>        print("Connection successful..................")<br/>        <br/>    except OperationalError as err:<br/>        <strong class="ls hj"># passing exception to function</strong><br/>        show_psycopg2_exception(err)       <strong class="ls hj"> <br/>        # set the connection to 'None' in case of error</strong><br/>        conn = None<br/>    <br/>    return conn</span></pre><h2 id="814b" class="ld jk hi bd jl le lf lg jp lh li lj jt kk lk ll jv ko lm ln jx ks lo lp jz lq bi translated">第五步。准备或识别您的数据</h2><p id="d1d1" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">首先，准备或确定稍后要导入 PostgreSQL 数据库的 CSV 文件。例如，我从 GitHub 加载虹膜数据。</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="450b" class="ld jk hi ls b fi lw lx l ly lz">import pandas as pd<br/>irisData = pd.read_csv('<a class="ae kx" href="https://raw.githubusercontent.com/Muhd-Shahid/Learn-Python-Data-Access/main/iris.csv" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/Muhd-Shahid/Learn-Python-Data-Access/main/iris.csv</a><a class="ae kx" href="https://github.com/Muhd-Shahid/Write-Raw-File-into-Database-Server/raw/main/iris.csv',index_col=False" rel="noopener ugc nofollow" target="_blank">',index_col=False</a>)<br/>irisData.dtypes</span></pre><p id="976a" class="pw-post-body-paragraph kb kc hi kd b ke ky ij kg kh kz im kj kk la km kn ko lb kq kr ks lc ku kv kw hb bi translated">首先，我们将确保我们将创建的 PostgreSQL 表中的列和数据类型参数必须与 CSV 文件的列数和数据类型相匹配。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ma"><img src="../Images/845eac88ca6a18e0ad60839ba5692fa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:614/format:webp/1*TaJXFKI8y5WfKpzInN0mlQ.png"/></div></figure><h2 id="92be" class="ld jk hi bd jl le lf lg jp lh li lj jt kk lk ll jv ko lm ln jx ks lo lp jz lq bi translated">步骤 6:在 PostgreSQL 数据库中创建一个名为 iris 的表</h2><p id="5ad5" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">要创建 iris 表，请使用 pyscopg2 的游标的 execute()方法执行 CREATE TABLE 语句。</p><pre class="iy iz ja jb fd lr ls lt lu aw lv bi"><span id="98ab" class="ld jk hi ls b fi lw lx l ly lz">conn = connect(conn_params_dic)<br/>conn.autocommit = True</span><span id="3875" class="ld jk hi ls b fi mb lx l ly lz">if conn!=None:<br/>    <br/>    try:<br/>        cursor = conn.cursor();<br/>        # Dropping table iris if exists<br/>        cursor.execute("DROP TABLE IF EXISTS iris;")<br/>        <br/>        sql = '''CREATE TABLE iris(<br/>        sepal_length DECIMAL(2,1) NOT NULL, <br/>        sepal_width DECIMAL(2,1) NOT NULL, <br/>        petal_length DECIMAL(2,1) NOT NULL, <br/>        petal_width DECIMAL(2,1),<br/>        species CHAR(11)NOT NULL<br/>        )'''<br/>        <br/>        # Creating a table<br/>        cursor.execute(sql);<br/>        print("iris table is created successfully................")<br/>    <br/>        # Closing the cursor &amp; connection<br/>        cursor.close()<br/>        conn.close()<br/>        <br/>    except OperationalError as err:<br/>        # pass exception to function<br/>        show_psycopg2_exception(err)<br/>        # set the connection to 'None' in case of error<br/>        conn = None</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mc"><img src="../Images/e5a104e15b9000fc31b47d4f75cf61ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L00a9eEMQnNZBZ9zJHyr8g.png"/></div></div></figure><p id="81d4" class="pw-post-body-paragraph kb kc hi kd b ke ky ij kg kh kz im kj kk la km kn ko lb kq kr ks lc ku kv kw hb bi translated"><strong class="kd hj">结论:</strong>这就结束了我们的<strong class="kd hj">第二部分</strong>关于创建表的讨论。在本教程中，我们学习了如何使用 python 在 PostgreSQL 数据库中创建表。</p><p id="9dfe" class="pw-post-body-paragraph kb kc hi kd b ke ky ij kg kh kz im kj kk la km kn ko lb kq kr ks lc ku kv kw hb bi translated">本文的所有代码都可以在 GitHub  上的<a class="ae kx" href="https://github.com/Muhd-Shahid/Learn-Python-Data-Access/tree/main/PostgreSQL" rel="noopener ugc nofollow" target="_blank"> <strong class="kd hj"> Jupyter 笔记本中获得。</strong></a></p><blockquote class="md me mf"><p id="6b0e" class="kb kc mg kd b ke ky ij kg kh kz im kj mh la km kn mi lb kq kr mj lc ku kv kw hb bi translated"><strong class="kd hj"> <em class="hi">下一个</em> </strong> <a class="ae kx" href="https://shahid-dhn.medium.com/part-3-1-pandas-dataframe-to-postgresql-using-python-8a3e3da87ff1" rel="noopener"> <strong class="kd hj"> <em class="hi">第 3.1 部分</em> </strong> </a> <strong class="kd hj"> <em class="hi">:使用 Python </em> </strong>将数据批量插入 PostgreSQL 数据库</p><p id="a4a9" class="kb kc mg kd b ke ky ij kg kh kz im kj mh la km kn mi lb kq kr mj lc ku kv kw hb bi translated"><strong class="kd hj"> <em class="hi">上一篇</em> </strong> <a class="ae kx" href="https://shahid-dhn.medium.com/pandas-dataframe-to-postgresql-using-python-part-1-93f928f6fac7" rel="noopener"> <strong class="kd hj"> <em class="hi">第一部分</em> </strong> </a> <strong class="kd hj"> <em class="hi">:简介、连接&amp;数据库创建</em> </strong></p></blockquote><p id="00a7" class="pw-post-body-paragraph kb kc hi kd b ke ky ij kg kh kz im kj kk la km kn ko lb kq kr ks lc ku kv kw hb bi translated">保持积极的态度！！注意安全！！继续学习:))</p><p id="b6a6" class="pw-post-body-paragraph kb kc hi kd b ke ky ij kg kh kz im kj kk la km kn ko lb kq kr ks lc ku kv kw hb bi translated"><strong class="kd hj">感谢您的阅读！！</strong></p></div></div>    
</body>
</html>