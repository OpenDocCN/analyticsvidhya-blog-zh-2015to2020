# 什么是卡方检验，它是如何工作的？用 R 代码直观解释

> 原文：<https://medium.com/analytics-vidhya/what-is-the-chi-square-test-and-how-does-it-work-an-intuitive-explanation-with-r-code-f66aaa7597f3?source=collection_archive---------21----------------------->

# 概观

*   什么是卡方检验？它是如何工作的？
*   了解不同类型的卡方检验以及何时何地应该应用它们
*   在本文中，我们还将在 R 中实现卡方测试

# 介绍

> “科学的进步是通过提出和测试一个假设，而不是通过宣称问题无法解决来实现的”——尼克·马茨克

让我们从一个案例研究开始。我要你现在想一想你最喜欢的餐馆。假设您可以预测一周有五天会有一定数量的人来吃午饭。在周末，您观察到预期的客流量与实际客流量不同。

听起来像一个主要的统计问题？就是这个想法！

![](img/4331f0f99913c00c22e85256521b6eb3.png)

那么，您将如何检查观察到的和预期的客流量值之间的统计显著性呢？请记住，这是一个分类变量——“一周中的每一天”——有 5 个类别[星期一、星期二、星期三、星期四、星期五]。

**处理这个问题的最好方法之一是使用卡方检验。**

当我们处理连续变量时，我们总是可以选择 z 检验、t 检验或方差分析。但是当处理分类特征时，情况就变得棘手了(大多数数据科学家都会证明这一点！).我发现卡方检验对我自己的项目很有帮助。

因此，让我们深入这篇文章，了解卡方测试的所有内容，它是什么，它是如何工作的，以及我们如何在 r 中实现它。

*如果你是统计学和数据科学新手，我会推荐以下资源来全面了解这两大主题:*

# 目录

*   什么是分类变量？
*   什么是卡方检验，我们为什么要使用它？
*   卡方检验的假设
*   卡方检验的类型(用 R 实现)
*   卡方拟合优度检验
*   两个变量之间关联的卡方检验

# 什么是分类变量？

我确信你以前遇到过范畴变量，即使你可能没有直观地认识到它们。在数据科学领域，它们可能很难处理，所以我们先来定义它们。

> *分类变量属于那些可分为有限类别的变量的特定类别。这些类别通常是名称或标签。这些变量也被称为定性变量，因为它们描述了特定变量的质量或特征。*

例如，电影列表中的类别“电影类型”可以包含分类变量——“动作”、“幻想”、“喜剧”、“爱情片”等。

大致有两种类型的分类变量:

1.  **名义变量**:名义变量对其类别没有自然排序。他们有两个或更多的类别。比如婚姻状况(单身、已婚、离异)；性别(男、女、变性人)等。
2.  **顺序变量**:可以对类别进行排序的变量。例如，客户满意度(优秀、非常好、好、一般、差)等等

当我们想要分析的数据包含这种类型的变量时，我们转向用χ表示的卡方检验来检验我们的假设。

# 什么是卡方检验，我们为什么要使用它？

> *卡方检验是分类变量的统计显著性检验。*

我们用一个直观的例子来学习卡方的使用。

一位研究学者对一所著名大学统计系的学生排名与他们的 C.G.P.A(最终评估分数)之间的关系很感兴趣。

他从安置单元数据库(随机)获得过去五年的安置记录。他记录了被录取的学生中有多少属于以下类别——9-10、8-9、7-8、6-7 和 6 分以下。

![](img/b9fad54ff05b87d5322fbc1b6e38a0df.png)

*来源:Anibrain 媒体设计学院*

如果安置率和注册会计师协会之间没有关系，那么被安置的学生应该平均分布在不同的注册会计师协会类别中(即每个类别中应该有相似数量的被安置学生)。

然而，如果学生的总平均成绩超过 8 分更有可能被录取，那么与总平均成绩较低的学生相比，总平均成绩较高的学生会有大量被录取。在这种情况下，收集的数据将构成观察到的频率。

**所以问题是，这些频率是被偶然观察到的，还是遵循某种模式？**

这里进入卡方检验！**卡方检验通过将观察到的频率与我们期望完全随机获得的频率进行比较，帮助我们回答上述问题。**

> *假设检验中的卡方检验用于检验关于不同类别中观测值/频率分布的假设。*

*注意:如果你需要温习假设检验的概念，我强烈推荐阅读下面的文章:*

我们几乎已经到了卡方测试的实现阶段，但是在到达那里之前，我们还需要学习一件事情。

# 卡方检验的假设

就像任何其他统计检验一样，卡方检验也有一些自己的假设:

*   χ2 假设研究数据是通过随机选择获得的，即它们是从总体中随机选取的
*   这些类别是相互排斥的，即每个主题只适合一个类别。例如，在我们上面的例子中，星期一在你的餐馆吃午餐的人数不能填入星期二类别
*   数据应该是特定类别的频率或计数的形式，而不是百分比
*   数据不应该由成对的样本或组组成，或者我们可以说观察值应该是相互独立的
*   当超过 20%的预期频率具有小于 5 的值时，则不能使用卡方。要解决这个问题:要么只有在相关的情况下才合并类别，要么获取更多的数据

# 卡方检验的类型(通过手工计算和用 R 实现)

## 卡方拟合优度检验

这是非参数测试。我们通常使用它来发现给定事件的观察值与预期值之间的显著差异。在这种情况下，我们有一个独立变量的分类数据，我们希望检查数据的分布是否与预期分布相似或不同。

让我们考虑一下上面的例子，研究学者对一所著名大学统计系的学生安置和他们的总平均成绩之间的关系感兴趣。

在这种情况下，自变量是 C.G.P.A，类别为 9-10、8-9、7-8、6-7 和 6 以下。

这里的统计问题是:对于不同的 C.G.P.A .类别，观察到的被安置学生的频率是否是平均分布的(因此我们的理论频率分布包含每个 C.G.P.A .类别中相同数量的学生)。

我们将使用列联表来整理这些数据，列联表将包括观察值和期望值，如下所示:

构建列联表后，下一个任务是计算卡方统计值。卡方的公式如下:

![](img/3661ca2eb463f05b55c59ff24b5a69f7.png)

在哪里，

让我们看一下计算卡方值的逐步方法:

1.  **步骤 1** :从相关的观测频率中减去每个期望频率。例如，对于 C.G.P.A 类别 10–9，它将是“30–20 = 10”。对所有类别应用类似的操作
2.  **第二步**:对第一步得到的每个值进行平方，即(O-E)2。例如:对于 C.G.P.A 类别 10–9，在步骤 1 中获得的值是 10。平方后变成 100。对所有类别应用类似的操作
3.  **第三步**:将第二步得到的所有值除以相关的期望频率，即(O-E)2/E，例如:对于 C.G.P.A 类别 10–9，第二步得到的值是 100。将它除以相关的预期频率 20，它就变成了 5。对所有类别应用类似的操作
4.  **第四步**:将第三步得到的所有值相加，得到卡方值。在这种情况下，卡方值为 **32.5**
5.  **步骤 5** :一旦我们计算出卡方值，下一个任务就是将其与临界卡方值进行比较。我们可以在下面的卡方表中根据自由度(类别数— 1)和显著性水平找到这一点:

![](img/bfa666bc76a95f4100b5123d836fbe34.png)

在这种情况下，**自由度是 5–1 = 4。因此，在 5%显著性水平下的临界值是 9.49。**

我们得到的值 32.5 比临界值 9.49 大得多。**因此，我们可以说观察到的频率与预期的频率有很大不同。换句话说，C.G.P.A 与统计部门的职位安排数量有关。**

让我们通过在 r 中进行卡方检验来进一步巩固我们的理解。

## R 中的卡方拟合优度检验

让我们在 R. Time 中实现卡方拟合优度测试，启动 RStudio！

**问题陈述**

在深入研究 r 之前，我们先了解一下问题陈述。

一个组织声称不同部门员工的经验分布在以下几类:

*   11-20 年= 20%
*   21-40 岁= 17%
*   6-10 年= 41%和
*   最长 5 年= 22%

收集了 1470 名员工的随机样本。这个随机抽样是否提供了反对该组织声明的证据？

你可以在这里 下载数据 [**。**](https://s3-ap-south-1.amazonaws.com/av-blog-media/wp-content/uploads/2019/05/chi1.csv)

**设置假设**

*   **零假设:**不同部门员工经验的真实比例分布如下:11-20 年= 20%，21-40 年= 17%，6-10 年= 41%，5 年以下= 22%
*   **替代假设:**不同部门员工的经验分布与组织所陈述的不同

我们开始吧！

**第一步:**首先，导入数据

**步骤 2:** 在 R:

查看[要点](https://gist.github.com/Harshit1694/1b748db8ab0db977c7837172c5b91b8d)上的代码。

**输出:**

```
#Count of Rows and columns [1] 1470 2 #View top 10 rows of the dataset age.intervals Experience.intervals 1 41 - 50 6 - 10 Years 2 41 - 50 6 - 10 Years 3 31 - 40 6 - 10 Years 4 31 - 40 6 - 10 Years 5 18 - 30 6 - 10 Years 6 31 - 40 6 - 10 Years 7 51 - 60 11 - 20 Years 8 18 - 30 Upto 5 Years 9 31 - 40 6 - 10 Years 10 31 - 40 11 - 20 Years
```

**第三步:**创建预期频率的比例表:

查看[要点](https://gist.github.com/Harshit1694/104d0136ab31092aefd02e448395357b)上的代码。

**输出:**

```
11 - 20 Years 21 - 40 Years 6 - 10 Years Upto 5 Years 0.2312925 0.1408163 0.4129252 0.2149660
```

**第 4 步:**计算卡方值:

查看[要点](https://gist.github.com/Harshit1694/0089e1dd6bff513e1a078d7829a6dad1)上的代码。

**输出:**

```
Chi-square test for given probabilities data: table(data$Experience.intervals) X-squared = 14.762, df = 3, p-value = 0.002032
```

这里的 p 值小于 0.05。因此，我们将拒绝我们的零假设。因此，**不同部门员工的经验分布与组织所陈述的不同。**

## 关联性/独立性卡方检验

第二种卡方检验是**皮尔森的关联卡方检验。**当我们有两个独立变量的分类数据，并且我们想看看变量之间是否有任何关系时，使用该检验。

我们再举一个例子来理解这一点。一位老师想知道数学考试的结果是否与参加考试的人的性别有关的答案。或者换句话说，她想知道男性的通过率/失败率是否与女性不同。

所以，这里有两个分类变量:性别(男性和女性)和数学测试结果(通过或失败)。现在让我们看看列联表:

从上面的列联表中，我们可以看出，女生的通过率相对高于男生。然而，为了检验这种观察到的差异是否显著，我们将进行卡方检验。

计算卡方值的步骤如下:

**步骤 1:** 计算上述列联表的行和列合计:

**步骤 2:** 通过将行总和乘以列总和并除以总数来计算每个单元格的预期频率:

**预期频率=(行合计 x 列合计)/总计**

对于第一个单元格，预期的频率是(37*25)/50 = 18.5。现在，将它们写在观察到的频率下面的括号中:

![](img/d8ca2fb69c71967767f8866d71e8e650.png)

**第 3 步:**使用以下公式计算卡方值:

计算每个单元格的右侧部分。例如，对于第一个单元格，((17–18.5))/18.5 = 0.1216。

**步骤 4:** 然后，将每个单元格获得的所有值相加。在这种情况下，值为:

0.1216+0.1216+0.3461+0.3461 = 0.9354

**第五步:**计算自由度，即(行数-1)*(列数-1) = 1*1 = 1

下一个任务是将它与我们在上面看到的表中的临界卡方值进行比较。

卡方计算值为 **0.9354** ，小于临界值 **3.84** 。所以在这种情况下，我们无法拒绝零假设。这意味着这两个变量之间没有显著的联系，也就是说，男生和女生在数学考试中的通过率和不通过率在统计学上有相似的模式。

让我们通过在 r 中执行卡方检验来进一步巩固我们的理解。

**问题陈述:**R 中的独立性检验

**建立假设:**

组织的人力资源部门想要检查雇员的年龄和经验是否相互依赖。为此，我们随机抽取了 1470 名员工，记录了他们的年龄和经验。你可以在 这里下载数据 [**。**](https://s3-ap-south-1.amazonaws.com/av-blog-media/wp-content/uploads/2019/05/chi1.csv)

**零假设:**年龄和经验是两个自变量

备选假设:年龄和经验是两个因变量

我们开始吧！

**第一步:**首先，导入数据

**步骤 2:** 在 R:

**输出:**

查看[要点](https://gist.github.com/Harshit1694/1b748db8ab0db977c7837172c5b91b8d)上的代码。

```
#Count of Rows and columns [1] 1470 2 > #View top 10 rows of the dataset age.intervals Experience.intervals 1 41 - 50 6 - 10 Years 2 41 - 50 6 - 10 Years 3 31 - 40 6 - 10 Years 4 31 - 40 6 - 10 Years 5 18 - 30 6 - 10 Years 6 31 - 40 6 - 10 Years 7 51 - 60 11 - 20 Years 8 18 - 30 Upto 5 Years 9 31 - 40 6 - 10 Years 10 31 - 40 11 - 20 Years
```

**步骤 3:** 构建列联表，计算卡方值:

**输出:**

查看[要点](https://gist.github.com/Harshit1694/bf0cb0148c091ab189fc380a9eadd951)上的代码。

```
ct<-table(data$age.intervals,data$Experience.intervals) > ct 11 - 20 Years 21 - 40 Years 6 - 10 Years Upto 5 Years 18 - 30 22 0 172 192 31 - 40 190 20 308 101 41 - 50 85 112 110 15 51 - 60 43 75 17 8 > chisq.test(ct) Pearson's Chi-squared test data: ct X-squared = 679.97, df = 9, p-value < 2.2e-16
```

这里的 p 值小于 0.05。因此，我们将拒绝我们的零假设。我们可以得出结论，年龄和经验是两个因变量，即随着经验的增加，年龄也增加(反之亦然)。

# 结束注释

在本文中，我们学习了如何借助卡方检验来分析包含分类度量的数据之间的显著差异。我们加深了对卡方检验的使用、检验中涉及的假设以及如何手工和人工进行不同类型的卡方检验的了解。

如果你是统计学新手，想要了解基础知识，还想开始学习数据科学，我建议你参加[数据科学入门课程](https://courses.analyticsvidhya.com/courses/introduction-to-data-science-2?utm_source=blog&utm_medium=statistics-t-test-introduction-r-implementation?utm_source=blog&utm_medium=what-is-chi-square-test-how-it-works)。在深入研究数据科学技术之前，它为您提供了描述性和推断性统计的全面概述。

你觉得这篇文章有用吗？你能想到卡方检验的其他应用吗？请在下面的评论区告诉我，我们可以想出更多的主意！

*原载于 2019 年 11 月 27 日*[*https://www.analyticsvidhya.com*](https://www.analyticsvidhya.com/blog/2019/11/what-is-chi-square-test-how-it-works/)*。*