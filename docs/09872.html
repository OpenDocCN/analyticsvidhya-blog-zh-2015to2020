<html>
<head>
<title>Deploy a Flask app on an EC2 Instance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 EC2 实例上部署 Flask 应用程序</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploy-a-flask-app-on-an-ec2-instance-246fcb59b4dc?source=collection_archive---------15-----------------------#2020-09-23">https://medium.com/analytics-vidhya/deploy-a-flask-app-on-an-ec2-instance-246fcb59b4dc?source=collection_archive---------15-----------------------#2020-09-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/7de3970311d6e6e5dcafd3376967bc20.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*0G5zu7CnXdMT9pGbYUTQLQ.png"/></div></div></figure><div class=""/><h1 id="abde" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">设置 EC2 实例</h1><ol class=""><li id="16fd" class="jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">从 AWS 仪表板转到 EC2 并启动一个实例。</li><li id="c883" class="jo jp ht jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">选择您喜欢的亚马逊机器映像(AMI)。我的首选 AMI 是 Ubuntu 服务器。</li><li id="6d31" class="jo jp ht jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">继续选择一个实例类型。对于简单的项目，我通常使用 t2.micro，所以根据您的需求选择一个实例类型。</li><li id="aefe" class="jo jp ht jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">继续到“配置安全组”,不做任何修改。安全组是最重要的部分，因为如果没有正确配置传入和传出流量，您可能无法访问您的 web 应用程序。在类型中选择“所有流量”，并允许来源为“任何地方”。</li><li id="7cc2" class="jo jp ht jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">接下来，继续完成实例的启动。对于良好的安全措施，您希望有更好的入站和出站安全组规则，但由于本指南是出于教程的目的，所以我对安全规则很在行。</li><li id="ffd6" class="jo jp ht jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">在完成之前选择您的密钥对(如果您还没有密钥对，您可以选择创建一个)。</li></ol><p id="8c87" class="pw-post-body-paragraph kl km ht jq b jr kn ko kp jt kq kr ks jv kt ku kv jx kw kx ky jz kz la lb kb hb bi translated">祝贺您，您已经成功创建并启动了 EC2 实例！</p><p id="88a5" class="pw-post-body-paragraph kl km ht jq b jr kn ko kp jt kq kr ks jv kt ku kv jx kw kx ky jz kz la lb kb hb bi translated">通过单击它并选择顶部的“Connect ”,连接到正在运行的实例。将 ssh 命令复制到“Example”下，并粘贴到您的终端中。除非您位于与相同的目录中，否则 SSH 命令将不起作用。pem 文件。</p><p id="6298" class="pw-post-body-paragraph kl km ht jq b jr kn ko kp jt kq kr ks jv kt ku kv jx kw kx ky jz kz la lb kb hb bi translated">现在，您应该通过命令行/终端连接到您的实例。</p><h1 id="cd11" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">准备托管应用程序的实例</h1><p id="b35c" class="pw-post-body-paragraph kl km ht jq b jr js ko kp jt ju kr ks jv lc ku kv jx ld kx ky jz le la lb kb hb bi translated">最重要的是。我们需要安装 git，python 和 pip 来继续我们的项目。</p><h2 id="fad8" class="lf ir ht bd is lg lh li iw lj lk ll ja jv lm ln je jx lo lp ji jz lq lr jm ls bi translated">从更新包索引开始:</h2><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="1fef" class="lf ir ht ly b fi mc md l me mf">sudo apt update</span></pre><h2 id="90dc" class="lf ir ht bd is lg lh li iw lj lk ll ja jv lm ln je jx lo lp ji jz lq lr jm ls bi translated">安装 git:</h2><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="c327" class="lf ir ht ly b fi mc md l me mf">sudo apt install git</span></pre><h2 id="4e1e" class="lf ir ht bd is lg lh li iw lj lk ll ja jv lm ln je jx lo lp ji jz lq lr jm ls bi translated">安装 Python 3.8:</h2><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="3b9e" class="lf ir ht ly b fi mc md l me mf">sudo apt install python3.8</span></pre><h2 id="6f3a" class="lf ir ht bd is lg lh li iw lj lk ll ja jv lm ln je jx lo lp ji jz lq lr jm ls bi translated">检查安装的 Python 版本:</h2><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="7bfe" class="lf ir ht ly b fi mc md l me mf">python --version</span></pre><h2 id="c46e" class="lf ir ht bd is lg lh li iw lj lk ll ja jv lm ln je jx lo lp ji jz lq lr jm ls bi translated">安装 pip3:</h2><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="6bc9" class="lf ir ht ly b fi mc md l me mf">sudo apt-get install python3-pip3</span></pre><h2 id="64d0" class="lf ir ht bd is lg lh li iw lj lk ll ja jv lm ln je jx lo lp ji jz lq lr jm ls bi translated">在虚拟机/EC2 实例中克隆 Flask 应用程序的 GitHub repo:</h2><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="4cc0" class="lf ir ht ly b fi mc md l me mf">git clone [your repo link]</span></pre><h2 id="14d9" class="lf ir ht bd is lg lh li iw lj lk ll ja jv lm ln je jx lo lp ji jz lq lr jm ls bi translated">cd 到您的新目录:</h2><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="98b5" class="lf ir ht ly b fi mc md l me mf">cd [directory name]</span></pre><h2 id="3231" class="lf ir ht bd is lg lh li iw lj lk ll ja jv lm ln je jx lo lp ji jz lq lr jm ls bi translated">安装 requirements.txt 文件:</h2><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="d557" class="lf ir ht ly b fi mc md l me mf">pip3 install -r requirements.txt</span></pre><p id="8470" class="pw-post-body-paragraph kl km ht jq b jr kn ko kp jt kq kr ks jv kt ku kv jx kw kx ky jz kz la lb kb hb bi translated">更多关于 requirements.txt 文件<a class="ae mg" rel="noopener" href="/@boscacci/why-and-how-to-make-a-requirements-txt-f329c685181e">这里</a></p><p id="7ebc" class="pw-post-body-paragraph kl km ht jq b jr kn ko kp jt kq kr ks jv kt ku kv jx kw kx ky jz kz la lb kb hb bi translated">(只需在您的。txt 文件，如果您在安装依赖项时经常遇到错误)</p><p id="1761" class="pw-post-body-paragraph kl km ht jq b jr kn ko kp jt kq kr ks jv kt ku kv jx kw kx ky jz kz la lb kb hb bi translated">如果您没有创建 python 项目，也不用担心。使用 vim 创建一个简单的 python 文件:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="bf25" class="lf ir ht ly b fi mc md l me mf">mkdir proj</span><span id="080f" class="lf ir ht ly b fi mh md l me mf">cd proj</span><span id="e6d8" class="lf ir ht ly b fi mh md l me mf">touch app.py</span><span id="7dd0" class="lf ir ht ly b fi mh md l me mf">vi app.py</span></pre><p id="09df" class="pw-post-body-paragraph kl km ht jq b jr kn ko kp jt kq kr ks jv kt ku kv jx kw kx ky jz kz la lb kb hb bi translated">进入 Vim 后，点击“I”进入“插入模式”,然后粘贴以下内容:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="de29" class="lf ir ht ly b fi mc md l me mf">from flask import Flask</span><span id="0f17" class="lf ir ht ly b fi mh md l me mf">app = Flask(__name__)</span><span id="44f6" class="lf ir ht ly b fi mh md l me mf">@app.route('/')<br/>def index():<br/>    return "The App is running!"</span><span id="1603" class="lf ir ht ly b fi mh md l me mf">if __name__ == '__main__':<br/>    app.run(debug=True)</span></pre><p id="772e" class="pw-post-body-paragraph kl km ht jq b jr kn ko kp jt kq kr ks jv kt ku kv jx kw kx ky jz kz la lb kb hb bi translated">按 esc 键击":"然后按" x "和" enter "键。</p><h2 id="06be" class="lf ir ht bd is lg lh li iw lj lk ll ja jv lm ln je jx lo lp ji jz lq lr jm ls bi translated">我们将在虚拟环境中运行 Flask 应用程序，因此让我们安装 virtualenv:</h2><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="0a01" class="lf ir ht ly b fi mc md l me mf">sudo pip3 install virtualenvwrapper</span><span id="25a5" class="lf ir ht ly b fi mh md l me mf">sudo su apps</span><span id="6b52" class="lf ir ht ly b fi mh md l me mf">vi .bashrc</span></pre><h2 id="ac22" class="lf ir ht bd is lg lh li iw lj lk ll ja jv lm ln je jx lo lp ji jz lq lr jm ls bi translated">添加以下内容:</h2><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="ee44" class="lf ir ht ly b fi mc md l me mf">export WORKON_HOME=$HOME/.virtualenvs<br/>export VIRTUALENVWRAPPER_VIRTUALENV_ARGS='--no-site-packages'</span><span id="f88b" class="lf ir ht ly b fi mh md l me mf">source /usr/bin/virtualenvwrapper.sh</span></pre><h2 id="d022" class="lf ir ht bd is lg lh li iw lj lk ll ja jv lm ln je jx lo lp ji jz lq lr jm ls bi translated">创建虚拟环境:</h2><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="b3a5" class="lf ir ht ly b fi mc md l me mf">mkvirtualenv myapp</span></pre><h2 id="c240" class="lf ir ht bd is lg lh li iw lj lk ll ja jv lm ln je jx lo lp ji jz lq lr jm ls bi translated">在您的虚拟环境中安装 gunicorn:</h2><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="4a0f" class="lf ir ht ly b fi mc md l me mf">pip3 install gunicorn</span><span id="33dd" class="lf ir ht ly b fi mh md l me mf">exit</span></pre><h2 id="8ad6" class="lf ir ht bd is lg lh li iw lj lk ll ja jv lm ln je jx lo lp ji jz lq lr jm ls bi translated">接下来，我们需要在虚拟机上安装一个 web 服务器:</h2><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="5439" class="lf ir ht ly b fi mc md l me mf">sudo apt-get install nginx</span><span id="c898" class="lf ir ht ly b fi mh md l me mf">sudo vi /etc/nginx/nginx.conf</span></pre><p id="6077" class="pw-post-body-paragraph kl km ht jq b jr kn ko kp jt kq kr ks jv kt ku kv jx kw kx ky jz kz la lb kb hb bi translated">替换此行:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="eaf0" class="lf ir ht ly b fi mc md l me mf">user  nginx;</span></pre><p id="5a8c" class="pw-post-body-paragraph kl km ht jq b jr kn ko kp jt kq kr ks jv kt ku kv jx kw kx ky jz kz la lb kb hb bi translated">使用:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="999f" class="lf ir ht ly b fi mc md l me mf">user  apps;</span></pre><p id="8d22" class="pw-post-body-paragraph kl km ht jq b jr kn ko kp jt kq kr ks jv kt ku kv jx kw kx ky jz kz la lb kb hb bi translated">在 http 块中添加以下内容:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="bb52" class="lf ir ht ly b fi mc md l me mf">server_names_hash_bucket_size 128;</span></pre><h2 id="1a95" class="lf ir ht bd is lg lh li iw lj lk ll ja jv lm ln je jx lo lp ji jz lq lr jm ls bi translated">为我们的站点定义一个服务器块:</h2><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="f367" class="lf ir ht ly b fi mc md l me mf">sudo vi /etc/nginx/conf.d/virtual.conf`</span></pre><p id="6667" class="pw-post-body-paragraph kl km ht jq b jr kn ko kp jt kq kr ks jv kt ku kv jx kw kx ky jz kz la lb kb hb bi translated">将此粘贴到内部:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="7db0" class="lf ir ht ly b fi mc md l me mf">server {<br/>    listen       80;<br/>    server_name  your_public_dnsname_here;</span><span id="97e5" class="lf ir ht ly b fi mh md l me mf">location / {<br/>        proxy_pass http://127.0.0.1:8000;<br/>    }<br/>}</span></pre><h2 id="e013" class="lf ir ht bd is lg lh li iw lj lk ll ja jv lm ln je jx lo lp ji jz lq lr jm ls bi translated">启动服务器:</h2><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="b3b1" class="lf ir ht ly b fi mc md l me mf">sudo /etc/rc.d/init.d/nginx start</span></pre><h2 id="9e52" class="lf ir ht bd is lg lh li iw lj lk ll ja jv lm ln je jx lo lp ji jz lq lr jm ls bi translated">启动 Gunicorn 流程，为我们的 Flask 应用提供服务:</h2><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="ae21" class="lf ir ht ly b fi mc md l me mf">sudo su apps</span><span id="5519" class="lf ir ht ly b fi mh md l me mf">gunicorn app:app -b localhost:8000 &amp;</span></pre><p id="7767" class="pw-post-body-paragraph kl km ht jq b jr kn ko kp jt kq kr ks jv kt ku kv jx kw kx ky jz kz la lb kb hb bi translated">应用程序应该启动并运行。</p><p id="00da" class="pw-post-body-paragraph kl km ht jq b jr kn ko kp jt kq kr ks jv kt ku kv jx kw kx ky jz kz la lb kb hb bi translated">返回到浏览器上的 EC2 实例，复制 EC2 的公共 DNS(IPv4)地址，并将其粘贴到一个新选项卡中。如果成功，浏览器将显示消息“应用程序正在运行！”</p><p id="3081" class="pw-post-body-paragraph kl km ht jq b jr kn ko kp jt kq kr ks jv kt ku kv jx kw kx ky jz kz la lb kb hb bi translated"><em class="mi">恭喜</em>您已经在 EC2 实例上成功部署了您的 Flask 应用程序！</p></div></div>    
</body>
</html>