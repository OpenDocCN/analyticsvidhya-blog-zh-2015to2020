<html>
<head>
<title>Interesting 5 Functions and 5 Triggers With PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PostgreSQL 有趣的 5 个函数和 5 个触发器</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/interesting-5-functions-and-5-triggers-with-postgresql-52700d554192?source=collection_archive---------2-----------------------#2020-12-04">https://medium.com/analytics-vidhya/interesting-5-functions-and-5-triggers-with-postgresql-52700d554192?source=collection_archive---------2-----------------------#2020-12-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3bf0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将带你经历创建触发器和函数的过程。我准备了 5 个不同的有趣触发器的例子，可以让你理解触发器是如何工作的。触发器是一种特殊类型的存储过程，它根据特定表或视图上发生的事件(例如插入、更新、删除等)自动触发。</p><p id="f1b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我以前用 SQL 教授数据分析的文章中，你会发现我引用了一个 dvdrental 数据库。我将使用数据库中的两个表，客户表和租赁表:</p><p id="536e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">客户(<strong class="ih hj">客户标识</strong>，名字，姓氏，地址标识)</p><p id="f3e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">租赁(<strong class="ih hj">租赁标识</strong>，租赁日期，客户标识，库存标识)</p><p id="8b95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将在 dvdrental 数据库中创建一个预订表。此表将用于为客户预订 DVD。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/08e7b7f1f7f9daf55f63ed080a23cda9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v7skpdE3_cWIjsLbjHfWKA.png"/></div></div></figure><p id="f503" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将修改预订表并添加主键和外键。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jp"><img src="../Images/04f79c8aaacd186639b7646fdeb2f259.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HHzzjCdnYLgzh8C5nS8nsw.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jq"><img src="../Images/323240238ac8c73e19b55ec2ae675809.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8uY1MR4eHDqG4Hbna_EOJQ.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jr"><img src="../Images/a28da55c23baf5abf47448a3e7a7b707.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mHxjYKM1G6TecHShvI-ikA.png"/></div></div></figure><p id="2c7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦 DVD 可供租赁，租赁记录应该添加到租赁表中，预订记录应该从预订表中删除。</p><p id="c902" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我会在预订表中添加一条预订记录。id = 1 的客户将预订 inventory_id = 12 的 dvd。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es js"><img src="../Images/7aeb13a252af02e39440ae48240be913.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l3pZsDdRhYaElzfYHN8F-Q.png"/></div></div></figure><p id="d2ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我从预订表中选择，我将在预订表中找到一个新行。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jt"><img src="../Images/42b5adb9d842d789b33a071c84b11214.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2f_-PzdxCUZnFZTScsM5Nw.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ju"><img src="../Images/cb92c895436b8b369c4eeee6345624a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oV7K40g_AtWr8w_chv7udg.png"/></div></div></figure><p id="bb11" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我将带您创建 5 个触发器和 5 个将在这些触发器中执行的函数。</p><p id="9275" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">例 1 </strong>:我想创建一个触发器，一旦客户租了 DVD，它将删除客户的预订记录。在这种情况下，我将在<strong class="ih hj">租赁</strong>表<strong class="ih hj"> </strong>(关于租赁)上创建一个触发器，当在<strong class="ih hj">租赁</strong>表中插入一行时(插入后)将触发该触发器。触发器将执行<strong class="ih hj"> delete_reserve() </strong>函数<strong class="ih hj">。一旦客户租用了预订的 DVD，函数 delete_reserve() </strong>将负责删除预订记录(执行过程 delete_reserve())。</p><p id="9815" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将使用以下语法:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jv"><img src="../Images/f55fefa03eb0f008dc28533e05a26fa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VHrv4c-qznxZ3gnEknyUFw.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jw"><img src="../Images/2feae931802945987528bce2842080db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7i8UfCaD1iUuLg_CR_E_ow.png"/></div></div></figure><p id="45e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> delete_reserve </strong>()将在一个触发器内执行(返回触发器)。该功能将删除预订中的 customer_id 和 inventory_id 与插入到<strong class="ih hj">租赁</strong>表中的相同的预订行。新插入的行可以作为 new.customer_id 和 NEW.inventory_id 从(NEW)访问。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jx"><img src="../Images/f5ae85a3a7d2729e4e49a0ef7ea595e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0reV_ZB9kdV_ZLeVxDgPeg.png"/></div></div></figure><p id="41f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后的功能有:</p><p id="1050" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">返回 NULL，因为我想忽略结果，因为它是在 AFTER 事件上触发的触发器。</p><p id="afff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我现在将在租赁表中添加一行，customer_id = 1，inventory_id = 12。该操作应该导致触发"<strong class="ih hj"> delete_reservation </strong>"触发器，因为它被设置为在租赁表上发生<strong class="ih hj"> insert </strong>之后触发。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jy"><img src="../Images/77b67ce54b47001a3f73ee9d2b5f6dcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dS4xQt7yBkaydG4BCKXnIQ.png"/></div></div></figure><p id="1aba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果触发器工作正常，这一行应该被删除，我们应该发现表是空的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jt"><img src="../Images/42b5adb9d842d789b33a071c84b11214.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2f_-PzdxCUZnFZTScsM5Nw.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jz"><img src="../Images/b7f58ef6f967982ed3ad1135db210c67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GFGRC8zWLOEVY_vv9tz8IA.png"/></div></div></figure><p id="ad54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您在上面看到的，之前插入的预订行已经不存在了，因为客户已经在租赁 DVD 了。</p><p id="ee84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">示例 2 </strong>:我想使用一个触发器来防止客户预订超过 3 张 DVD。为此，我将在<strong class="ih hj">预订表</strong>(预订)<strong class="ih hj"> </strong>上创建一个触发器，该触发器将在<strong class="ih hj">预订表</strong>中插入一行之前被触发。触发器将执行<strong class="ih hj"> count_dvd() </strong>函数(执行程序 count_dvd()) <strong class="ih hj">。函数 count_dvd() </strong>将负责检查客户是否已经预订了 3 张 dvd。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ka"><img src="../Images/12071aa94495c571964bc2546867dc96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SueMTiAbuHKJ-YrGZUSH2g.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kb"><img src="../Images/dcdcdc0325e826651e31fa0cf23fa3a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XDqSPfXntPFBSogK1bStQQ.png"/></div></div></figure><p id="325e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将为 customer_id =1，<strong class="ih hj">插入四次</strong>预订记录。</p><p id="c7db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将在预订表中插入第一个行<strong class="ih hj">:</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kc"><img src="../Images/18aad8d48e93ffbae9b96573f6be0312.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tu66zMGjCGgnTqyVzNYdyw.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jw"><img src="../Images/70f08df6038ee7b5346267441ebc443b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OUARL5Cvz7IbmoWykFf4Wg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kd"><img src="../Images/0a3c39667db6c1a9b683a094e521fe41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q6dajJ8f0Vo8Z8vA6E7HVg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jx"><img src="../Images/13db9785f41469f5f1d51abd0c682968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6qR-UHQfLG8Nk0dOfFsmDg.png"/></div></div></figure><p id="768b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将在预订表中插入第二行<strong class="ih hj">:</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ke"><img src="../Images/07e7add8bf5495b2099da08425121094.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EQkEwGECVJbpPquYSmeEng.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kf"><img src="../Images/522f765013de06dd74dce253af72c623.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QRQiLjCz_5O0g8npFXl6ig.png"/></div></div></figure><p id="79fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将在预订表中插入第三行<strong class="ih hj">:</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kg"><img src="../Images/9e9a149b2fe70fd4e94619c0cdb0ba4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oDI1DjFKDqGhgWzwBNeQRg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kh"><img src="../Images/e6ff2feb551a35cd16b8db4836d80183.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CQ4kX6Srxubo1WhzpSx4AA.png"/></div></div></figure><p id="3f83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在尝试为 customer_id 1 插入第四个 DVD 预订时，触发器将引发错误“<strong class="ih hj"> <em class="ki">该客户已经预订了 3 个 DVD，这对于现在的</em> </strong>来说已经足够了”。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kj"><img src="../Images/9d2078f26b30871ffb4828e432539d88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LFfjfZAzS8_XDk68adIwQw.png"/></div></div></figure><p id="a7e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将引发以下错误:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kk"><img src="../Images/65d417be216440a4e8c9d30db28c0feb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*asaXAQKBa2Chfnb6WNi0LA.png"/></div></div></figure><p id="b591" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">示例 3 </strong>:如果客户在<strong class="ih hj">租赁</strong>表中有尚未归还的租金，我想创建一个触发器<strong class="ih hj">来防止删除</strong>任何客户的信息。为此，我将在<strong class="ih hj">客户表</strong>(客户上)<strong class="ih hj"> </strong>上创建一个<strong class="ih hj"> delete_customer </strong>触发器，该触发器将在之前被触发<strong class="ih hj">从<strong class="ih hj">客户</strong>表中删除一行(删除之前)。该触发器将执行<strong class="ih hj"> check_rental() </strong>函数(执行程序 check_rental()) <strong class="ih hj">。check_rental() </strong>将负责检查客户是否租借了尚未归还的 DVD。</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kl"><img src="../Images/1fb61ab16bdd40917e1e156fd905a80c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HRlhauCcjD0kdCZOf-Gy3Q.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es km"><img src="../Images/fb734d480322dbb341b481ff603f6af5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aP4kjy5lQB0rOCl3SDuvGg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kn"><img src="../Images/da297afdaabd37daeb3133dd71326ae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IZBL4wY5oYeSlOAb2inPrw.png"/></div></div></figure><p id="a10f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">试图从<strong class="ih hj">客户</strong>表中删除客户，将触发<strong class="ih hj"> delete_customer </strong>触发器。<strong class="ih hj">删除 _ 客户</strong>触发器将执行<strong class="ih hj">检查 _ 租赁</strong>()功能。<strong class="ih hj"> check_rental </strong>()函数将检查客户是否有 DVD 出租。如果顾客没有租借任何 DVD，他的信息将被删除，否则他的记录不会被删除。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kc"><img src="../Images/6c7216e3468bac1d1d6a39bbd9d2c2cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*edI15le4zCfUZVjtyy9igg.png"/></div></div></figure><p id="bc87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将引发以下错误:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ko"><img src="../Images/10e95ceabea33175c89caa16b764de16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*llH0VlPCvzGFsr04ZLNiiQ.png"/></div></div></figure><p id="0270" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">示例 4 </strong>:我想创建一个触发器来阻止<strong class="ih hj">预订</strong>表中的<strong class="ih hj">库存 id </strong>更新<strong class="ih hj">商店 id </strong> 2 的库存 id。我将在<strong class="ih hj">保留表</strong> (ON reservation) <strong class="ih hj"> </strong>上创建一个<strong class="ih hj"> check_update </strong>触发器，该触发器将在更新<strong class="ih hj"/>(更新前)之前<strong class="ih hj">被触发。如果 inventory_id 被更新，触发器将执行<strong class="ih hj"> check_inventory_update </strong>函数(当</strong> (OLD.inventoy_id 不同于 NEW.inventoy_id)时<strong class="ih hj">)。<strong class="ih hj">check _ inventory _ update()</strong>将负责不允许用 store_id 的 2 的 inventory_id 更新 inventory _ id。</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kp"><img src="../Images/807062cfbd9819adf107ab76fd55b5b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fY2cWlxgB7a5zXCI-SUxbA.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kq"><img src="../Images/6b71bc60ff87320471f22fe8eaeba3fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PT6NESqfKM5f6emu-Onq9w.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kr"><img src="../Images/8acda6e6c2b1755a9a2dd3bab7cecacd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uHTtDiP7iMxQNv0XWuQjTQ.png"/></div></div></figure><p id="2a48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是用属于 store_id 2 的 inventory_id 更新 inventory_id 的尝试。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kb"><img src="../Images/55aa6d499b3c1692359a4b2cf783f24c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LBbGfUr4vZhY81sk2GqqWA.png"/></div></div></figure><p id="9788" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将引发以下错误:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kg"><img src="../Images/91a74aae06fb118230c342a886af64e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WXoWefoQBch7GkqXzyrt1Q.png"/></div></div></figure><p id="dedf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">例 5: </strong>我想创建一个触发器，帮助我<strong class="ih hj">跟踪预订表上执行的所有操作</strong>。我想记录<strong class="ih hj">预订</strong>表上是否发生了<strong class="ih hj">插入、删除或更新</strong>的操作。我要做的第一步是创建一个表来记录操作，我将调用表<strong class="ih hj"> reservation_audit </strong>。我将存储操作的第一个字母(I 表示插入，U 表示更新，D 表示删除)、操作的时间戳和操作的值。</p><p id="19c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是<strong class="ih hj">预约 _ 审核</strong>的定义:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ks"><img src="../Images/061e111657a8380db2b5812d680b0fa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CO4R_fCBEhHh1VgPH4UuXA.png"/></div></div></figure><p id="e073" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将在<strong class="ih hj">预约表</strong>(预约)<strong class="ih hj"> </strong>上创建一个<strong class="ih hj">预约 _ 审计</strong>触发器，该触发器将在插入、更新或删除(插入或更新或删除后)后被触发<strong class="ih hj">。</strong></p><p id="8fb7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">触发器将调用<strong class="ih hj">process _ reservation _ audit</strong>函数。<strong class="ih hj">process _ reservation _ audit()</strong>将负责在<strong class="ih hj"> reservation_audit </strong>表中记录所执行的事务，无论是<strong class="ih hj">插入、更新还是删除。</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kt"><img src="../Images/4487c025ebfcc798beff748349129b23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b_fTPvrhXAZRgbI1jmSpxw.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ku"><img src="../Images/899252ebbeb2397868e20d19700e601a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lDmZDiC4bEO1gTNSnBb9qA.png"/></div></div></figure><p id="54c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将在<strong class="ih hj">预订</strong>表中插入一条记录:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ku"><img src="../Images/168787cd5a18087b3246e864efc83597.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5NIQA9CqlC6ksbO_006vQw.png"/></div></div></figure><p id="506c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将从 reservation 和 reservation_audit 表中进行选择。我们将在预订表中看到一条新记录。我们还将看到在 reservation_audit 表中添加了一条新记录，表明在 reservation 表中发生了一个 insert (I)操作。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kv"><img src="../Images/144a00d2071e47b105636e54555ffaae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rUEmb3lkMRI987Pl-S_ZAQ.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ka"><img src="../Images/ca69808c7a37a423eefd3cabc9da130c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kf-iHU1uQhDD05SZCdY0ow.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kw"><img src="../Images/f4759745637b1ccd2f15211eeaffb323.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9yYo6BwU1Z4l66pUzix_6w.png"/></div></div></figure><p id="13b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将从<strong class="ih hj">预订</strong>表中删除一条记录。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kx"><img src="../Images/b197bb0006e94478892fbf08ee76ec28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yKKI6gHk4fK1l0WGwYjohA.png"/></div></div></figure><p id="0547" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从预订表中删除一行。在 reservation_audit 表中添加一条新记录，指示在 reservation 表上发生了删除(D)操作。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ky"><img src="../Images/4d999b6805603b2dd52f0e4d1f86dcca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xuh-lPrprqk1OTbZzXTisg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kz"><img src="../Images/99529bd58467b68448823dc9233ec162.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DFBaT7ZuKdl0BPePrQ9AnA.png"/></div></div></figure><p id="06e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将更新<strong class="ih hj">预订</strong>表中的一条记录。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es la"><img src="../Images/411541a781b8dc0147e5ee285dea51e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hqUVtPUgv7n8PlRlQplSjA.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ky"><img src="../Images/4d999b6805603b2dd52f0e4d1f86dcca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xuh-lPrprqk1OTbZzXTisg.png"/></div></div></figure><p id="d68c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预订表中的一行被更新。在 reservation_audit 表中添加一条记录，指示在 reservation 表上发生了更新(U)操作。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lb"><img src="../Images/ee1f4ed10c252e2c84fc3e8cd61f499e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RzSST9SSeQ03AuMJ_og4wA.png"/></div></div></figure><p id="bfa2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望你对这篇文章感兴趣，并且我能够以一种好的和清晰的方式展示这个主题。</p></div></div>    
</body>
</html>