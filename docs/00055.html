<html>
<head>
<title>Machine Learning to Predict Taxi Fare — Part One : Exploratory Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测出租车费用的机器学习——第一部分:探索性分析</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/machine-learning-to-predict-taxi-fare-part-one-exploratory-analysis-6b7e6b1fbc78?source=collection_archive---------0-----------------------#2018-08-18">https://medium.com/analytics-vidhya/machine-learning-to-predict-taxi-fare-part-one-exploratory-analysis-6b7e6b1fbc78?source=collection_archive---------0-----------------------#2018-08-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="b595" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">数据清理、可视化、特征工程</h2></div><h2 id="1349" class="ix iy hi bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated"><strong class="ak">我正在学习Python进行数据分析，并希望将这些概念应用到真实的数据集上——瞧，我在</strong> <a class="ae jv" href="https://www.kaggle.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ak"> Kaggle </strong> </a> <strong class="ak">上发现了纽约出租车费用预测问题。</strong></h2><p id="c684" class="pw-post-body-paragraph jw jx hi jy b jz ka ij kb kc kd im ke ji kf kg kh jm ki kj kk jq kl km kn ko hb bi translated">在这个挑战中，我们在训练数据中获得了自2009年以来纽约5500万次出租车旅行的训练集，在测试数据中获得了9914条记录。该挑战的目标是在已知上下车地点、上车日期时间和乘客人数的情况下，预测出租车行程的费用。</p><p id="ca36" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">在任何分析项目中，80%的时间和精力都花在数据清理、探索性分析和衍生新功能上。在这篇文章中，我们旨在清理数据，可视化变量之间的关系，并找出更好地预测出租车费用的新功能。</p><p id="8d23" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated"><strong class="jy hj">数据</strong></p><p id="7242" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">关于这个问题的数据可以在<a class="ae jv" href="https://www.kaggle.com/c/new-york-city-taxi-fare-prediction/data" rel="noopener ugc nofollow" target="_blank">地图</a>上找到。出于此分析的目的，我只从训练数据的55M行中导入了6M行。数据中出现的字段如下:</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es ku"><img src="../Images/affd803645a7007dab696fc385690d17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*N8ieR6TxVNlDBoiw70QBrQ.png"/></div></figure><p id="59b9" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated"><strong class="jy hj">假设生成</strong></p><p id="5e00" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">解决任何分析问题的下一步是列出一组假设，在我们的情况下，这些假设是影响出租车旅行成本的因素。</p><ol class=""><li id="8dea" class="lc ld hi jy b jz kp kc kq ji le jm lf jq lg ko lh li lj lk bi translated"><strong class="jy hj">行程距离</strong>:行程距离越长，车费越高。</li><li id="87da" class="lc ld hi jy b jz ll kc lm ji ln jm lo jq lp ko lh li lj lk bi translated"><strong class="jy hj">出行时间</strong>:在交通高峰期，出租车费用可能会高一些。</li><li id="7ad7" class="lc ld hi jy b jz ll kc lm ji ln jm lo jq lp ko lh li lj lk bi translated"><strong class="jy hj">出行日期</strong>:工作日和周末的票价可能不同</li><li id="8731" class="lc ld hi jy b jz ll kc lm ji ln jm lo jq lp ko lh li lj lk bi translated">天气状况:如果下雪，出租车的数量可能会减少，因此车费也会提高。</li><li id="ac41" class="lc ld hi jy b jz ll kc lm ji ln jm lo jq lp ko lh li lj lk bi translated"><strong class="jy hj">是否是往返机场的旅程</strong>:往返机场的旅程一般都有固定的票价。</li><li id="788d" class="lc ld hi jy b jz ll kc lm ji ln jm lo jq lp ko lh li lj lk bi translated"><strong class="jy hj">接送邻居</strong>:根据邻居的类型，费用可能会有所不同。</li><li id="9000" class="lc ld hi jy b jz ll kc lm ji ln jm lo jq lp ko lh li lj lk bi translated">出租车的可用性:如果某个地方有很多出租车，价格可能会更低。</li></ol><h1 id="89d4" class="lq iy hi bd iz lr ls lt jd lu lv lw jh io lx ip jl ir ly is jp iu lz iv jt ma bi translated"><strong class="ak">数据清理和探索</strong></h1><p id="b822" class="pw-post-body-paragraph jw jx hi jy b jz ka ij kb kc kd im ke ji kf kg kh jm ki kj kk jq kl km kn ko hb bi translated">在本节中，我们将讨论用于清理数据和理解变量之间关系的各种步骤，并利用这种理解来创建更好的特性(参见:I<a class="ae jv" href="https://www.kaggle.com/aiswaryaramachandran/eda-and-feature-engineering" rel="noopener ugc nofollow" target="_blank">ntroductory Jupyter notebook</a></p><ol class=""><li id="a587" class="lc ld hi jy b jz kp kc kq ji le jm lf jq lg ko lh li lj lk bi translated"><strong class="jy hj">票价金额分配</strong></li></ol><p id="a56e" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">我们首先查看票价金额的分布，发现有262条票价为负的记录。因为旅行费用不可能是负数，所以我们从数据中删除了这样的实例。此外，票价服从长尾分布。为了更好地理解票价金额的分布，我们在移除负票价后进行对数变换，这使得分布接近正态分布</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mb"><img src="../Images/26b2b7d073d59c23c3c251a75a9f350a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rGiAYZJx1tGpudz3YeNUnQ.png"/></div></div></figure><p id="d8b1" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">2.<strong class="jy hj">地理特征分布</strong></p><p id="d61f" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">纬度和经度的范围分别在-90°至90°和-180°至180°之间。但是在训练数据集中，我们观察到纬度和经度在(-3488.079513，3344.459268)的范围内，这是不可能的。在进一步的探索中，我们还发现了一组114K的记录，这些记录在赤道上具有拾取和放下坐标。因为这些数据是纽约出租车的数据，所以我们从分析中删除了这些行。这种异常在试验数据中没有发现。</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mg"><img src="../Images/74aa212bcea526c11b4d7168d44d4808.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qj18HCmQAc4arFUSwATPdg.png"/></div></div><figcaption class="mh mi et er es mj mk bd b be z dx translated">纽约上下客点的分布</figcaption></figure><p id="2425" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">我们可以看到，JFK和拉瓜迪亚机场附近的皮卡密度很高。然后，我们查看了与火车数据中的所有行程相比，前往JFK的接送平均费用金额，并观察到机场行程的费用较高。基于这一观察，我们创建了一些功能来检查是否有人在纽约的三个机场(JFK机场、EWR机场或拉瓜迪亚机场)取货或卸货</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es ml"><img src="../Images/c9ef0841686f18311f2747e8d0c4c4bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*6xmDyFCEuoqPKNEimC6B0A.png"/></div><figcaption class="mh mi et er es mj mk bd b be z dx translated">JFK皮卡和所有皮卡的车费金额(对数标度)</figcaption></figure><p id="0aef" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">下一步是检查我们的假设，即纽约市分为5个区，即曼哈顿、皇后区、布鲁克林、史坦顿岛和布朗克斯区，每个接送点都被划分到这5个区中，是否特定区域的票价高于其他区域。是的，我们的假设是正确的——除了曼哈顿有最多的接送乘客，其他所有的社区，接送乘客的费用分布都有所不同。此外，与其他社区相比，皇后区的平均接送费用更高。</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mm"><img src="../Images/4bf82c775ffc3884f450a0737150a913.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sYWYtrNCQD5TB2Z5sBWibQ.png"/></div></div><figcaption class="mh mi et er es mj mk bd b be z dx translated">纽约不同街区的票价金额分布(对数标度)</figcaption></figure><p id="819b" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">3.<strong class="jy hj">行程距离分布</strong></p><p id="339a" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">使用接送坐标，我们根据<strong class="jy hj">哈弗森距离计算行程距离(英里)。</strong>出行距离就像票价服从长尾分布一样，我们采取对数变换使其接近正态分布</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es mn"><img src="../Images/4598f23e19598ab12bf35aa0d3ae90b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*Nj80X1MEImcx3zzCwO1hqA.png"/></div><figcaption class="mh mi et er es mj mk bd b be z dx translated">行程距离(英里)分布</figcaption></figure><p id="c911" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">我们的一个假设是，理想情况下，票价应该随着出行距离的增加而增加。出行距离和费用金额之间的散点图显示，尽管存在线性关系，但每英里费用(斜率)较低，并且有许多距离大于50英里的出行，但费用非常低。为了检查这种情况是否是因为机场旅行，我们去除了机场旅行并绘制了分布图。然后，我们观察到每英里的费用更高，并且观察到另一个行程距离&gt; 50英里的小集群。</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mo"><img src="../Images/c9e9f4817d5ab5052855ad1d925939e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jeqb6vyH52Pb32A4qM1P2w.png"/></div></div><figcaption class="mh mi et er es mj mk bd b be z dx translated">行程距离与票价金额</figcaption></figure><p id="4384" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">下一步是查看是否有观察到行程距离&gt; 50英里的特定区域。这表明，有很多来自曼哈顿下城的乘客。这就产生了一个新功能——pick up _ is _ lower _ Manhattan和dropoff_is_low_manhattan。</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mp"><img src="../Images/4e8dbe31c1377c13a5a04e6267fc5da7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RLVF1R0uIjOCjoAh5J-fDQ.png"/></div></div><figcaption class="mh mi et er es mj mk bd b be z dx translated">行程距离&gt; 50英里的接送(蓝点)和下车(绿点)</figcaption></figure><p id="3b68" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated"><strong class="jy hj"> 4。配送取货日期时间</strong></p><p id="b4a6" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">分析票价如何随时间变化的第一步是根据取件日期时间创建小时、星期几、日、月、年等特征。提取这些特征的代码如下</p><pre class="kv kw kx ky fd mq mr ms mt aw mu bi"><span id="00c9" class="ix iy hi mr b fi mv mw l mx my">train['pickup_datetime']=pd.to_datetime(train['pickup_datetime'],format='%Y-%m-<strong class="mr hj">%d</strong> %H:%M:%S UTC')<br/>train['pickup_date']= train['pickup_datetime'].dt.date<br/>train['pickup_day']=train['pickup_datetime'].apply(lambda x:x.day)<br/>train['pickup_hour']=train['pickup_datetime'].apply(lambda x:x.hour)<br/>train['pickup_day_of_week']=train['pickup_datetime'].apply(lambda x:calendar.day_name[x.weekday()])<br/>train['pickup_month']=train['pickup_datetime'].apply(lambda x:x.month)<br/>train['pickup_year']=train['pickup_datetime'].apply(lambda x:x.year)</span></pre><p id="748c" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">不出所料，多年来，平均出租车费一直在上涨。</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es mz"><img src="../Images/dde88dbf1693914153c471e832a65575.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*GRmuqSVURWuHJ2C4cgbf4Q.png"/></div><figcaption class="mh mi et er es mj mk bd b be z dx translated">历年票价金额分布</figcaption></figure><p id="8f2a" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">几个月来，尽管从7月到12月接客量有所减少，但平均票价在几个月内几乎保持不变</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es na"><img src="../Images/6ccaa7b2b7860bcf81d7809041637956.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZFZkqJ97roBw8sDDZ2YyVA.png"/></div></div><figcaption class="mh mi et er es mj mk bd b be z dx translated">跨月分布</figcaption></figure><p id="2d0f" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">我们观察到，尽管周六的接送人数较多，但平均车费金额较低。在周日和周一，虽然出行次数较少，但平均票价较高</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es nb"><img src="../Images/a8fd1028775c28b44a01deda18f03c55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xpRoZQs42I0j8NBklp4DcA.png"/></div></div><figcaption class="mh mi et er es mj mk bd b be z dx translated">一周中各天的分布</figcaption></figure><p id="d0e1" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">早上5点的平均票价最高，而早上5点的车次最少。这是因为，在早上5点，83%的行程是去机场。18和19小时的出行次数最多</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mm"><img src="../Images/72a7c8d096cab80a86a8d64b2e7d4b8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iOoiAXcLy2uNlSk80nXpyQ.png"/></div></div><figcaption class="mh mi et er es mj mk bd b be z dx translated">跨小时分布</figcaption></figure><p id="786b" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated"><strong class="jy hj">结尾注释</strong></p><p id="111e" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">基于使用这种探索性分析创建的特性，使用XGBoost的基线模型在公共排行榜上获得了3.03760的RMSE，位于前15个百分点。这个帖子的代码可以在<a class="ae jv" href="https://www.kaggle.com/aiswaryaramachandran/eda-and-feature-engineering" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="c557" class="pw-post-body-paragraph jw jx hi jy b jz kp ij kb kc kq im ke ji kr kg kh jm ks kj kk jq kt km kn ko hb bi translated">在本文的下一部分<a class="ae jv" rel="noopener" href="/analytics-vidhya/machine-learning-to-predict-taxi-fare-part-two-predictive-modelling-f80461a8072e"/>中，我们将看到如何使用通过探索性分析识别的特征来创建机器学习模型，并了解如何评估模型。我希望这篇文章对你有用，并帮助你建立信心来解决Kaggle上的这个挑战。一如既往，欢迎所有讨论和建议。</p></div></div>    
</body>
</html>