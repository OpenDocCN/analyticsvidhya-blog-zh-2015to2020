<html>
<head>
<title>How to auto rotate the image using Deep learning!!!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用深度学习自动旋转图像！！！</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-auto-rotate-the-image-using-deep-learning-c34b2e0e157d?source=collection_archive---------4-----------------------#2020-06-29">https://medium.com/analytics-vidhya/how-to-auto-rotate-the-image-using-deep-learning-c34b2e0e157d?source=collection_archive---------4-----------------------#2020-06-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="5eea" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">使用计算机视觉自动旋转图像以获得人类照片的正确角度的5个简单步骤</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ix"><img src="../Images/9f0bd347236475ebe321f751f682e661.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*UH4fu7vnJDRcEBRPzMi3nw.gif"/></div><figcaption class="jf jg et er es jh ji bd b be z dx translated">演示</figcaption></figure><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="jj jk l"/></div></figure><p id="1881" class="pw-post-body-paragraph jl jm hi jn b jo jp ij jq jr js im jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">上图显示了输入(左)和输出(右)。让我们看看如何在不手动旋转的情况下自动旋转图像。这些天来，计算机视觉已经在全世界范围内发展了这么多。我刚刚使用计算机视觉玩并实现了一个自动旋转图像的小技术。</p><p id="4481" class="pw-post-body-paragraph jl jm hi jn b jo jp ij jq jr js im jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated"><strong class="jn hj">自动旋转图像的步骤:</strong></p><ol class=""><li id="ce1f" class="kh ki hi jn b jo jp jr js ju kj jy kk kc kl kg km kn ko kp bi translated">读取输入图像。</li><li id="b612" class="kh ki hi jn b jo kq jr kr ju ks jy kt kc ku kg km kn ko kp bi translated">用Caffe模型检测人脸。</li><li id="4813" class="kh ki hi jn b jo kq jr kr ju ks jy kt kc ku kg km kn ko kp bi translated">如果没有检测到面部，则旋转图像。</li><li id="7a4f" class="kh ki hi jn b jo kq jr kr ju ks jy kt kc ku kg km kn ko kp bi translated">再次检测旋转图像的脸。</li><li id="4aa7" class="kh ki hi jn b jo kq jr kr ju ks jy kt kc ku kg km kn ko kp bi translated">将图像旋转三个角度，直到检测到人脸。</li></ol><p id="40bd" class="pw-post-body-paragraph jl jm hi jn b jo jp ij jq jr js im jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">在实现这项技术之前，我们将看看需要什么样的依赖库和模型。</p><ol class=""><li id="828b" class="kh ki hi jn b jo jp jr js ju kj jy kk kc kl kg km kn ko kp bi translated"><strong class="jn hj"> OpenCV </strong></li><li id="fea8" class="kh ki hi jn b jo kq jr kr ju ks jy kt kc ku kg km kn ko kp bi translated"><strong class="jn hj"> Numpy </strong></li><li id="6dfa" class="kh ki hi jn b jo kq jr kr ju ks jy kt kc ku kg km kn ko kp bi translated"><strong class="jn hj"> Caffe模型(深度学习)</strong></li></ol><p id="f613" class="pw-post-body-paragraph jl jm hi jn b jo jp ij jq jr js im jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated"><strong class="jn hj"> <em class="kv">第一步:- </em> </strong>导入以上所有需要的库。</p><pre class="iy iz ja jb fd kw kx ky kz aw la bi"><span id="89b6" class="lb lc hi kx b fi ld le l lf lg">import cv2<br/>import numpy as np</span></pre><p id="f18d" class="pw-post-body-paragraph jl jm hi jn b jo jp ij jq jr js im jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated"><strong class="jn hj"> <em class="kv">第二步:- </em> </strong>下载<a class="ae lh" href="https://github.com/balavenkatesh3322/Face_Recognition/tree/master/model" rel="noopener ugc nofollow" target="_blank"> Caffe模型和文件以及prototxt文件</a>。让我们看看为什么我们需要这两个文件，这是什么。</p><p id="6a46" class="pw-post-body-paragraph jl jm hi jn b jo jp ij jq jr js im jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated"><strong class="jn hj">什么是Caffe模型文件？</strong></p><p id="e5be" class="pw-post-body-paragraph jl jm hi jn b jo jp ij jq jr js im jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated">Caffe 是由Berkeley Vision and Learning Center(BVLC)开发的深度学习框架。它是用C++写的，有Python和Matlab绑定。在用我们的数据集训练模型之后，我们将在一个带有扩展名的文件中获得训练过的<strong class="jn hj">模型</strong>。</p><p id="6bd3" class="pw-post-body-paragraph jl jm hi jn b jo jp ij jq jr js im jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated"><strong class="jn hj">什么是deploy.prototxt文件？</strong></p><p id="7f24" class="pw-post-body-paragraph jl jm hi jn b jo jp ij jq jr js im jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated"><strong class="jn hj"> prototxt </strong>是一个文本<strong class="jn hj">文件</strong>，它保存了关于神经网络结构的信息:神经网络中的层列表。每层的参数，如名称、类型、输入尺寸和输出尺寸。各层之间的联系。那个prototxt文件只是用来部署模型，不能用来训练模型。</p><p id="e180" class="pw-post-body-paragraph jl jm hi jn b jo jp ij jq jr js im jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated"><strong class="jn hj"> <em class="kv">第三步:</em></strong>——这是使用OpenCV读取图像文件的主要方法。然后将图像传入detect_face方法(<em class="kv">步骤4 </em>)它会给出真(检测到)或假(未检测到)。如果它返回假，那么图像不是正确的角度，因此我们需要按照下面的角度逐步旋转图像的角度。</p><p id="d418" class="pw-post-body-paragraph jl jm hi jn b jo jp ij jq jr js im jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated"><strong class="jn hj">旋转角度- &gt; 90 - &gt; 180 - &gt; 270 </strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es li"><img src="../Images/ff9f4d00b77703480f5bec99cdce5f30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XSjDQoCWv6KItSiBKMyWLw.png"/></div></div><figcaption class="jf jg et er es jh ji bd b be z dx translated">旋转角度</figcaption></figure><pre class="iy iz ja jb fd kw kx ky kz aw la bi"><span id="7cee" class="lb lc hi kx b fi ld le l lf lg">def main(): <br/> frame = cv2.imread(‘6.jpg’)<br/> original_status = detect_face(frame)<br/> (h, w) = frame.shape[:2]<br/> # calculate the center of the image<br/> center = (w / 2, h / 2)<br/> scale = 1.0<br/> angle_90 = 90<br/> angle_180 = 180<br/> angle_270 = 270<br/> if original_status is None:<br/> status_90 = rotate_image(frame,center,scale,angle_90)<br/>   if status_90 is None:<br/>    status_180 = rotate_image(frame,center,scale,angle_180)<br/>      if status_180 is None:<br/>         status_270 = rotate_image(frame,center,scale, angle_270)</span></pre><p id="8e6b" class="pw-post-body-paragraph jl jm hi jn b jo jp ij jq jr js im jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated"><strong class="jn hj"> <em class="kv">第四步:- </em> </strong>下面是使用Caffe模型检测人脸的detect_face方法。我们可以使用OpenCV <a class="ae lh" href="https://docs.opencv.org/master/d2/d58/tutorial_table_of_content_dnn.html" rel="noopener ugc nofollow" target="_blank"> dnn模块</a>使用<strong class="jn hj"> readNetFromCaffe </strong>方法读取Caffe模型。然后将我们的图像转换成斑点，通过基于输出权重的神经网络，它将返回概率值。我使用0.7作为最小精度值。如果该值大于该值，我们可以检测人脸图像。Caffe模型是由直角人脸图像训练的，因此它将只检测人脸图像是否是正确的角度。</p><pre class="iy iz ja jb fd kw kx ky kz aw la bi"><span id="b0ed" class="lb lc hi kx b fi ld le l lf lg">def detect_face(frame):</span><span id="0d51" class="lb lc hi kx b fi ln le l lf lg">net = cv2.dnn.readNetFromCaffe(‘deploy.prototxt’,        ‘res10_300x300_ssd_iter_140000.caffemodel’)<br/> <br/>    (h, w) = frame.shape[:2]</span><span id="f1fd" class="lb lc hi kx b fi ln le l lf lg">blob = cv2.dnn.blobFromImage(cv2.resize(frame,(300,300)), 1.0,   (300,300), (104.0,177.0,123.0))</span><span id="2838" class="lb lc hi kx b fi ln le l lf lg">net.setInput(blob)</span><span id="eaf6" class="lb lc hi kx b fi ln le l lf lg">faces = net.forward()</span><span id="933e" class="lb lc hi kx b fi ln le l lf lg">for i in range(0, faces.shape[2]):<br/>     confidence = faces[0,0,i,2]<br/> <br/>    if confidence &lt; 0.7:<br/>      continue</span><span id="2fc3" class="lb lc hi kx b fi ln le l lf lg">box = faces[0,0,i,3:7] * np.array([w,h,w,h])<br/>  (startX, startY, endX, endY) = box.astype(‘int’)</span><span id="ed41" class="lb lc hi kx b fi ln le l lf lg">text = “face “ + “{:.2f}%”.format(confidence * 100)</span><span id="3de8" class="lb lc hi kx b fi ln le l lf lg">cv2.imwrite(‘test.jpg’,frame)<br/>    return True</span></pre><p id="9716" class="pw-post-body-paragraph jl jm hi jn b jo jp ij jq jr js im jt ju jv jw jx jy jz ka kb kc kd ke kf kg hb bi translated"><strong class="jn hj"> <em class="kv">第五步:- </em> </strong>让我们看看如何使用OpenCV旋转图像。</p><pre class="iy iz ja jb fd kw kx ky kz aw la bi"><span id="3443" class="lb lc hi kx b fi ld le l lf lg">def rotate_image(frame,center,scale,angle):<br/> (h, w) = frame.shape[:2]<br/> M = cv2.getRotationMatrix2D(center, angle, scale)<br/> frame = cv2.warpAffine(frame, M, (h, w))<br/> return detect_face(frame)</span></pre><h1 id="c9b6" class="lo lc hi bd lp lq lr ls lt lu lv lw lx io ly ip lz ir ma is mb iu mc iv md me bi translated">结论</h1><p id="6b1e" class="pw-post-body-paragraph jl jm hi jn b jo mf ij jq jr mg im jt ju mh jw jx jy mi ka kb kc mj ke kf kg hb bi translated">就是这样。你成功了！！最后，你可以看到正确的角度图像。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ix"><img src="../Images/b8a0fd40cbf2adb9df6b4484fa86bd1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*P9cdclMODqfe2XGfzgwpvw.gif"/></div></figure><blockquote class="mk"><p id="2145" class="ml mm hi bd mn mo mp mq mr ms mt kg dx translated">祝大家学习愉快！！如果您需要任何帮助或协助，请通过<a class="ae lh" href="https://www.linkedin.com/in/bala-venkatesh-67964247/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae lh" href="https://twitter.com/balavenkatesh22" rel="noopener ugc nofollow" target="_blank"> Twitter </a>与我联系。</p></blockquote></div></div>    
</body>
</html>