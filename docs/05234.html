<html>
<head>
<title>How to Deploy your Machine Learning model into Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将您的机器学习模型部署到云中</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/easy-and-quick-steps-to-deploy-your-first-ml-model-into-cloud-ce2418fcb960?source=collection_archive---------27-----------------------#2020-04-14">https://medium.com/analytics-vidhya/easy-and-quick-steps-to-deploy-your-first-ml-model-into-cloud-ce2418fcb960?source=collection_archive---------27-----------------------#2020-04-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="48f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我保证我会长话短说。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/50794a9e3456741b6f697518adf347b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fNVUnvZnQ42HL14zkFPwBA.jpeg"/></div></div></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="c401" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有3种类型的部署:</p><ol class=""><li id="60c2" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated">内部部署—您必须自行设置和配置您的应用程序、数据、运行时、中间件、操作系统和服务器。</li><li id="caae" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">IAAS —(基础设施即服务)在这里，您只需提供您的应用程序、数据、运行时和操作系统。其他细节如服务器、网络等由平台本身处理。例如:AWS、Azure、GCP等。</li><li id="3d3e" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">PAAS —(平台即服务)这里你只提供你的应用和数据。其他每一个重要的事情，比如上面提到的服务，都是由平台自己处理的。</li></ol><p id="f501" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天我们将只关注在Flask web框架的基础上，PAAS使用python作为后端，HTML使用jinja2作为前端。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="d503" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak">第一步</strong></h1><p id="c4ed" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">先做好你的机器学习模型。</p><p id="8250" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先在您的项目目录下创建一个<strong class="ih hj"> models.py </strong>文件。</p><pre class="je jf jg jh fd ln lo lp lq aw lr bi"><span id="f89d" class="ls kl hi lo b fi lt lu l lv lw">import numpy as np<br/>import matplotlib.pyplot as plt<br/>import pandas as pd<br/>import pickle </span><span id="4454" class="ls kl hi lo b fi lx lu l lv lw"><br/>dataset = pd.read_csv('dummy_data.csv') <br/>dataset['quality'].fillna(0, inplace=True) dataset['rating'].fillna(dataset['rating'].mean(),inplace=True) <br/>X = dataset.iloc[:, :3] #Converting words to integer values<br/>y = dataset.iloc[:, -1] </span><span id="3e92" class="ls kl hi lo b fi lx lu l lv lw">data. from sklearn.linear_model import LinearRegression<br/>regressor = LinearRegression() #Fitting model with training data<br/>regressor.fit(X, y)</span></pre><p id="2cfa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是我们如何创建一个简单的模型，根据产品的质量和等级来预测产品价格。</p><h1 id="672f" class="kk kl hi bd km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh bi translated">第二步</h1><p id="fc7e" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">我们不想通过我们的应用程序向外界公开我们的模型的定义。所以我们为我们的模型制作了一个pickle文件。Pickle文件基本上将我们的模型转录成字节。您将看到在您的工作目录中生成了一个model.pkl文件。</p><pre class="je jf jg jh fd ln lo lp lq aw lr bi"><span id="ab77" class="ls kl hi lo b fi lt lu l lv lw">pickle.dump(regressor, open('model.pkl','wb'))</span></pre><h1 id="0d59" class="kk kl hi bd km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh bi translated">第三步</h1><p id="54a7" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">现在我们将制作一个<strong class="ih hj"> app.py </strong>文件，它将成为我们应用程序的入口点。</p><pre class="je jf jg jh fd ln lo lp lq aw lr bi"><span id="d5e1" class="ls kl hi lo b fi lt lu l lv lw">import numpy as np<br/>from flask import Flask, request, jsonify, render_template<br/>import pickle </span><span id="1b13" class="ls kl hi lo b fi lx lu l lv lw">app = Flask(__name__)<br/>model = pickle.load(open('model.pkl', 'rb')) </span><span id="a8f6" class="ls kl hi lo b fi lx lu l lv lw">@app.route('/')<br/>def home():    <br/>   return render_template('page.html') </span><span id="4618" class="ls kl hi lo b fi lx lu l lv lw">@app.route('/predict',methods=['POST'])<br/>def predict():    <br/>   '''    <br/>    For rendering results on HTML GUI    <br/>   '''    <br/>   int_features = [int(x) for x in request.form.values()]<br/>   final_features=[np.array(int_features)]<br/>   prediction = model.predict(final_features)     <br/>   output = round(prediction[0], 2)<br/>   return render_template('page.html', prediction_text='Price of the<br/>                          Product should be $ {}'.format(output))<br/>if __name__ == "__main__":    <br/>   app.run(debug=True)</span></pre><h1 id="fd26" class="kk kl hi bd km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh bi translated">第四步</h1><p id="82fe" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">现在我们将制作一个名为<strong class="ih hj">page.html</strong>的模板文件，并把它放在项目文件夹下的<strong class="ih hj">模板</strong>文件夹中。</p><pre class="je jf jg jh fd ln lo lp lq aw lr bi"><span id="23c9" class="ls kl hi lo b fi lt lu l lv lw">&lt;!DOCTYPE html&gt;<br/>&lt;html &gt;<br/>&lt;!--From https://codepen.io/frytyler/pen/EGdtg--&gt;<br/>&lt;head&gt;  <br/>&lt;meta charset="UTF-8"&gt;  <br/>&lt;title&gt;ML API&lt;/title&gt;  <br/>&lt;link href='https://fonts.googleapis.com/css?family=Pacifico' rel='stylesheet' type='text/css'&gt;<br/>&lt;link href='https://fonts.googleapis.com/css?family=Arimo' rel='stylesheet' type='text/css'&gt;<br/>&lt;link href='https://fonts.googleapis.com/css?family=Hind:300' rel='stylesheet' type='text/css'&gt;<br/>&lt;link href='https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300' rel='stylesheet' type='text/css'&gt;  &lt;/head&gt; <br/>&lt;body&gt; <br/>&lt;div class="login"&gt; <br/>&lt;h1&gt;Predict Salary Analysis&lt;/h1&gt;      <br/>&lt;!-- Main Input For Receiving Query to our ML --&gt;    <br/>&lt;form action="{{ url_for('predict')}}"method="post"&gt;<br/>&lt;input type="text" name="rating" placeholder="Rating" required="required" /&gt;<br/>&lt;input type="text" name="quality" placeholder="Quality" required="required" /&gt;<br/>&lt;input type="text" name="demand_value" placeholder="Demand" required="required" /&gt;<br/>&lt;button type="submit" class="btn btn-primary btn-block btn-large"&gt;Price Predictor&lt;/button&gt;<br/>&lt;/form&gt;<br/>&lt;br&gt;   <br/>&lt;br&gt;   <br/>{{ prediction_text }}  <br/>&lt;/div&gt;  <br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><h1 id="de06" class="kk kl hi bd km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh bi translated">第五步</h1><p id="4555" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">配置文件</p><ol class=""><li id="1fa4" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated">首先，我们需要为我们在python文件中使用的导入语句提供一个<strong class="ih hj"> requirements.txt </strong>文件。</li></ol><p id="fff2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">文件格式示例</p><pre class="je jf jg jh fd ln lo lp lq aw lr bi"><span id="7fb2" class="ls kl hi lo b fi lt lu l lv lw">Flask==1.1.1 <br/>gunicorn==19.9.0<br/>itsdangerous==1.1.0 <br/>Jinja2==2.10.1 <br/>MarkupSafe==1.1.1 <br/>Werkzeug==0.15.5 <br/>numpy&gt;=1.9.2 <br/>scipy&gt;=0.15.1 <br/>scikit-learn&gt;=0.18 <br/>matplotlib&gt;=1.4.3 <br/>pandas&gt;=0.19</span></pre><p id="77ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.我们需要在我们的项目中添加一个<strong class="ih hj">过程文件</strong></p><pre class="je jf jg jh fd ln lo lp lq aw lr bi"><span id="bdf6" class="ls kl hi lo b fi lt lu l lv lw">web: gunicorn app:app</span></pre><p id="ac68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一个<strong class="ih hj">应用</strong>是应用入口点的文件名。</p><p id="049c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第二个<strong class="ih hj"> app </strong>是我们在创建Flask app时命名的应用名称。</p><p id="2e80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">示例:<strong class="ih hj"> app = Falsk(__name__) </strong></p><p id="5b83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将所有具有所需结构的文件上传到github存储库中。</p><h1 id="b300" class="kk kl hi bd km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh bi translated">第六步</h1><p id="cbd8" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">现在在Heroku创建一个帐户。登录后，您将进入类似如下的屏幕。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es md"><img src="../Images/87dbd44de6a701fe651d70025dd1c343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*scJNLAQNGk1UgKG5WSeLIw.png"/></div></div></figure><p id="44ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击<strong class="ih hj">新建。</strong></p><p id="5e22" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用小写字母填写您的应用程序名称。</p><p id="a3b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其他部分保持原样。</p><p id="c852" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将在此屏幕中到达。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es md"><img src="../Images/211ba028e144b4c636344a8841d788dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l0PYakxu3zb1e9XFZAyuMQ.png"/></div></div></figure><p id="8bd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">连接项目的Github存储库。</p><p id="f617" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在有两个选项自动部署和手动部署。</p><p id="741a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您选择<strong class="ih hj">自动部署</strong>，每次您在提到的分支中合并您的代码，Heroku将部署您的应用一次，在几分钟(5-10分钟)内，更改将反映在您的实时服务器中。</p><p id="aac1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您选择<strong class="ih hj">手动部署</strong>，那么在将您的代码合并到上述分支中之后，您必须通过单击<strong class="ih hj">部署分支</strong>按钮来手动将您的应用部署到云中。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es md"><img src="../Images/d9d1727c8ab5e3cb3fe8f1c7349a86a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z5b2aO8RjC_WvyFIbolGcQ.png"/></div></div></figure><p id="f054" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我建议您第一次选择手动部署并检查日志。</p><p id="a63c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成部署后，在构建应用程序包后，将为您的应用程序生成链接，以便在live server中运行。</p><p id="20f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是了。点击从部署日志生成的URL。</p><p id="478c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> HOLA！！！！！！！！！！！！！！！！！</strong></p><p id="263f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您的应用程序已经启动并正在运行。输入您选择的值，您的模型将准备好预测该值。</p><p id="7724" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> **注意</strong>:你不需要把你的models.py代码推送到Github里。每次更改模型时，生成models.pkl文件，并将更新后的文件推送到github中。</p></div></div>    
</body>
</html>