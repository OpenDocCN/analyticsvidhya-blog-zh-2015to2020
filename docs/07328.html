<html>
<head>
<title>Artificial Neural Networks, Part 5 — Implementing CNN using Tensorflow and Keras</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">人工神经网络，第5部分—使用Tensorflow和Keras实现CNN</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/artificial-neural-networks-part-5-implementing-cnn-using-tensorflow-and-keras-9f7c2b56ad86?source=collection_archive---------19-----------------------#2020-06-21">https://medium.com/analytics-vidhya/artificial-neural-networks-part-5-implementing-cnn-using-tensorflow-and-keras-9f7c2b56ad86?source=collection_archive---------19-----------------------#2020-06-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1fa63d928652996b8c6997f7f2ab7763.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bKFPsLSoQhf5wNyw"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">阿瑟尼·托古列夫在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="4652" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在早先的文章中，<a class="ae iu" rel="noopener" href="/analytics-vidhya/artificial-neural-networks-part-4-convolution-neural-networks-1ae8c2c751c7?source=your_stories_page---------------------------">人工神经网络，第4部分——卷积神经网络</a>，我们研究了CNN背后的理论。在本帖中，我们将使用Keras和Tensorflow进行实际实现。数据集取自Kaggle — <a class="ae iu" href="https://www.kaggle.com/paultimothymooney/chest-xray-pneumonia" rel="noopener ugc nofollow" target="_blank">胸部x光图像</a>。大约有5864个图像和2个类别(肺炎/正常)。</p><p id="1e0f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们直接进入实现。</p><p id="834f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第一步从导入所需的库开始</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jt"><img src="../Images/8a23be5dbb7f573cea62afd189929cce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*285Gr2AYw6d5RFqQ7ml9-A.png"/></div></div></figure><p id="7956" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">数据集中有三个文件夹:培训、测试和验证。对于此演示，我们将使用训练和测试数据集。让我们设置文件路径—</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jy"><img src="../Images/fd7a76b5362103b6903efde7f1391137.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*5yPu1_tiPlWf7b5JFSWOXQ.png"/></div></figure><p id="04bc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们看看我们正在处理的图像。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jz"><img src="../Images/70a58986fdc2c18410438fcb29c9c7e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*FV559jdXKR836hQ3yXKy-g.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">正常肺的图像</figcaption></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es ka"><img src="../Images/740aebcedaea1a717e32aa3675183d98.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*LbEzLEss4_r6ynw7XFzraQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">肺炎感染肺部</figcaption></figure><p id="c8e8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">图像是灰度的，因此当我们看形状时，色标上没有任何细节。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kb"><img src="../Images/11e246b1ebadecc6f50f1581994e7fb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*KAPSS7hLlSq8M1L2wesTSw.png"/></div></figure><p id="8790" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">假设训练和测试数据中的图像具有不同的比例，我们将找出平均尺寸并将图像整形为相同的尺寸。</p><p id="353e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下图显示了图像的不同维度。我们将重塑所有的图像大小为(1400，1400)。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kc"><img src="../Images/f1d02f42a6df06efa920e40c1f14c151.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*lmMH8nZhigZ3cRKrKPXgEQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">圆圈表示平均值将在该区域的某处。</figcaption></figure><p id="6bfa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如人们常说的，数据越多越好，在我们的武器库中有更多的图像来训练会更好。在现实世界中，获取更多图像数据会变得很困难，我们可以通过从现有图像创建转换后的图像数据来缓解这一问题。这可以使用ImageDataGenerator类来完成。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/70256c023a659f5bc759efa5dea037e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OsexwGEpCCpfuq4bb4h9Qw.png"/></div></div></figure><p id="ffaa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在上面的函数中，我们创建的图像是从现有数据集转换而来的图像。下面是一个如何进行转换的例子。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es ke"><img src="../Images/d6454e54d0509bc9980c0c2cecede0b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*TLbeivGkqbHH8XZaogTUjw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">原创</figcaption></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kf"><img src="../Images/8ac26659a73b5540fe064e3fb0a2fb15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/1*EI8Yuo8x4xKg5PymxjPe_Q.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">转换</figcaption></figure><p id="300e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们准备创建CNN来训练图像分类模型。在我们的CNN中，有5个卷积层，接着是3个致密层。我为什么要使用这种架构？因为它提高了验证的准确性，而且我正在尝试使用AlexNet架构。这是模型总结—</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kg"><img src="../Images/75025b88d1436878689505edf650a6f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*5oxeurASbc_gNGjCOqvloQ.png"/></div></figure><p id="2b89" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了训练模型，我们将利用flow_from_directory()方法来创建批量图像，这些图像将被提供给网络用于训练。这将有助于减少内存使用。但是，这将增加培训时间。我们还将使用<em class="kh">提前停止</em>，在验证准确性没有提高时打破训练周期。</p><p id="cb7d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Tensorflow库中提供了这些方法。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es ki"><img src="../Images/6a432c25e8ff2c04ebaeb9ac93a3a56e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*GidaaD6rX7FhQMEC1vKwCg.png"/></div></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kj"><img src="../Images/0cb9d8c87261d87ab019862cc2a4513f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*iECph6gf7jfYggvlEisSqA.png"/></div></figure><p id="0fb1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">继续用数据训练模型—</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kk"><img src="../Images/2a0228c8f63c47d50c0c188549fa04c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PYNsZ3AtfexT4fLV0ARS0w.png"/></div></div></figure><p id="3938" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">完成培训大约需要一个半小时。我们提供的时期数为10，但由于提前停止，训练在时期5停止，验证准确率为82.5%。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kl"><img src="../Images/12d936b8eb68697581da4fae2c4e1e72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*unKUuSKi5Kl-CSPtDH-rgg.png"/></div></figure><p id="4a8e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们根据我们的测试数据来预测—</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es km"><img src="../Images/225bc8efe7f046de31bc980f6c291f36.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*M7Sqx7-xcgQRInlMR_4tmQ.png"/></div></figure><p id="b541" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">保持阈值为0.5，当与实际值比较时，我们得到以下分类报告—</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kn"><img src="../Images/e7e2df06ab5b1f1580489cfde8c1c9f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*JxCwgx9ksSxRQXRjRVYJcQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd ko">‘正常’:0，‘肺炎’:1</strong></figcaption></figure><p id="e2a0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">看起来在所有有肺炎的图像中，我们的模型能够正确检测出91%。还不错！</p><p id="4476" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们肯定可以改进该模型，我希望获得任何反馈和改进建议。</p><p id="b28f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">完整代码可点击此处— <a class="ae iu" href="https://github.com/sachatur13/Code_Repo/blob/master/Pneumonia_prediction_CNN.ipynb" rel="noopener ugc nofollow" target="_blank"> <em class="kh">肺炎_预测_CNN </em> </a></p></div></div>    
</body>
</html>