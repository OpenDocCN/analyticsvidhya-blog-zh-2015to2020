<html>
<head>
<title>ACCESSING HADOOP FILESYSTEM API WITH PYSPARK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用PYSPARK访问HADOOP文件系统API</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/accessing-hadoop-filesystem-api-with-pyspark-29cff901de51?source=collection_archive---------5-----------------------#2020-04-04">https://medium.com/analytics-vidhya/accessing-hadoop-filesystem-api-with-pyspark-29cff901de51?source=collection_archive---------5-----------------------#2020-04-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ac6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我在《火花深潜》中的一个故事</p><div class="jd je ez fb jf jg"><a rel="noopener follow" target="_blank" href="/@somanathsankaran"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hj fi z dy jl ea eb jm ed ef hh bi translated">索玛纳特·桑卡兰培养基</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">阅读索马纳特·桑卡兰在媒介上的作品。对python和spark感兴趣的大数据开发者。每天，索马纳特…</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">medium.com</p></div></div><div class="jp l"><div class="jq l jr js jt jp ju jv jg"/></div></div></a></div><p id="7823" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Spark是一个并行处理框架，位于Hadoop文件系统之上。因此，很少有需要处理hadoop文件系统的常见用例。让我们详细看看下面的内容</p><ol class=""><li id="a9bc" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated">Hadoop文件系统API</li><li id="8cb1" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">用Pyspark访问Hadoop文件系统API</li><li id="df7a" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">Hadoop文件系统API的常见用例</li></ol><p id="8a26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Hadoop文件系统API: </strong></p><p id="330d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它是Java中的一个抽象类，可用于访问分布式文件系统。</p><div class="jd je ez fb jf jg"><a href="https://hadoop.apache.org/docs/r2.8.2/api/org/apache/hadoop/fs/FileSystem.html" rel="noopener  ugc nofollow" target="_blank"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hj fi z dy jl ea eb jm ed ef hh bi translated">文件系统(Apache Hadoop主2.8.2 API)</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">所有可能使用Hadoop分布式文件系统的用户代码都应该编写为使用文件系统对象…</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">hadoop.apache.org</p></div></div></div></a></div><p id="ce36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为它是一个抽象类，所以它有一个get方法，该方法需要文件系统的配置，并且它返回一个静态文件系统类，该类将用于访问hadoop文件系统，我们将使用它来做一些常见的操作，如ls、copyToLocalFile</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="bf5d" class="kt ku hi kp b fi kv kw l kx ky">public static <a class="ae kz" href="https://hadoop.apache.org/docs/r2.8.2/api/org/apache/hadoop/fs/FileSystem.html" rel="noopener ugc nofollow" target="_blank">FileSystem</a> get(<a class="ae kz" href="https://hadoop.apache.org/docs/r2.8.2/api/org/apache/hadoop/conf/Configuration.html" rel="noopener ugc nofollow" target="_blank">Configuration</a> conf)<br/>                      throws <a class="ae kz" href="http://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" rel="noopener ugc nofollow" target="_blank">IOException</a></span></pre><p id="4b2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">使用Pyspark访问Hadoop文件系统API</strong></p><p id="f3c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在pyspark中，不像在scala中，我们可以直接导入java类。</p><p id="ebb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在pyspark中，它在Py4j.java_gateway JVM视图下可用，在sc下可用。_jvm</p><p id="f136" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第一步:导入抽象类</strong></p><p id="8c23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以导入抽象类</p><figure class="kk kl km kn fd lb er es paragraph-image"><div class="er es la"><img src="../Images/68400ddb0db13998bebf9029a3b5dacc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*fnFjm4ulCnFacSpfeYvWqw.png"/></div></figure><p id="a890" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第二步:创建静态类</strong></p><p id="2a63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在传递hadoop conf之前，我们必须检查spark与hadoop uri的集成是否正确</p><figure class="kk kl km kn fd lb er es paragraph-image"><div class="er es ld"><img src="../Images/cee8490b4adb7affc6c80a01845642bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*a_3lAvxDsj__0zlsd9AUmw.png"/></div></figure><p id="91ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，在我的例子中，这不是指向hadoop文件系统。因此，我将把它设置为hadoop文件系统(这是可选的，因为在大多数生产系统中它将被设置)</p><figure class="kk kl km kn fd lb er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es le"><img src="../Images/fc11cc004ab21bbfcd9e05ceda8dd5b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rkO2yLGaoc5vN0htRJuPjQ.png"/></div></div></figure><p id="dedc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是通过传递这个hadoop conf对象来创建静态类</p><figure class="kk kl km kn fd lb er es paragraph-image"><div class="er es lj"><img src="../Images/dfba82dc4dd7a8ae03267edf4ff2840f.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*qiCimt_I_o1HGB0z_jleQw.png"/></div></figure><p id="7b45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">Hadoop文件系统API的常见用例</strong></p><p id="bcd0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看下面的用例</p><ol class=""><li id="b1d4" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated">制作目录</li><li id="b339" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">从本地复制文件</li><li id="97aa" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">列出hdfs目录</li></ol><p id="fbcd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.复制到本地</p><p id="6e01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">制作目录</p><p id="03ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以用mkdirs来制作dir</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="374c" class="kt ku hi kp b fi kv kw l kx ky">public boolean mkdirs(<a class="ae kz" href="https://hadoop.apache.org/docs/r2.8.2/api/org/apache/hadoop/fs/Path.html" rel="noopener ugc nofollow" target="_blank">Path</a> f)<br/>               throws <a class="ae kz" href="http://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" rel="noopener ugc nofollow" target="_blank">IOException</a><br/></span></pre><p id="d574" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们也将从同一个jvm中导入路径类</p><figure class="kk kl km kn fd lb er es paragraph-image"><div class="er es lk"><img src="../Images/05c067155f118909d6d370651abd6833.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*ixJ-xfavKzApxwZZhBz99w.png"/></div></figure><figure class="kk kl km kn fd lb er es paragraph-image"><div class="er es ll"><img src="../Images/f36ffba36b97232f9f00e1eaf38ce52c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*dB35buCvqLlJ9J68SP0acA.png"/></div></figure><p id="94f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并用hadoop fs -ls进行了验证</p><figure class="kk kl km kn fd lb er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es lm"><img src="../Images/234a19ada2a89ca6ff5d0531c0d46220.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kaOxMoCk5M9hNmnhb0eryw.png"/></div></div></figure><p id="c4c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">从本地复制文件</strong></p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="9349" class="kt ku hi kp b fi kv kw l kx ky">public void copyFromLocalFile(<a class="ae kz" href="https://hadoop.apache.org/docs/r2.8.2/api/org/apache/hadoop/fs/Path.html" rel="noopener ugc nofollow" target="_blank">Path</a> src,<br/>                     <a class="ae kz" href="https://hadoop.apache.org/docs/r2.8.2/api/org/apache/hadoop/fs/Path.html" rel="noopener ugc nofollow" target="_blank">Path</a> dst)<br/>                       throws <a class="ae kz" href="http://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" rel="noopener ugc nofollow" target="_blank">IOException</a><br/></span></pre><p id="9b8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为我们需要从本地文件复制，所以使用了:///文件</p><figure class="kk kl km kn fd lb er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es ln"><img src="../Images/43f82c90e53de436b7ccd70aef028d8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SRTBVEvarc34aVSwpBX-yA.png"/></div></div></figure><p id="e8d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查文件是否存在</p><figure class="kk kl km kn fd lb er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es lo"><img src="../Images/7d77c42ccaa89ace710ae254c4382a45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QU8BxJOcyGuemZSvgHss0A.png"/></div></div></figure><p id="1d4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">列出hdfs目录</strong></p><p id="b3a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以使用glob status来匹配所有带有glob模式的目录，如下所示。</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="bc66" class="kt ku hi kp b fi kv kw l kx ky">public <a class="ae kz" href="https://hadoop.apache.org/docs/r2.8.2/api/org/apache/hadoop/fs/FileStatus.html" rel="noopener ugc nofollow" target="_blank">FileStatus</a>[] globStatus(<a class="ae kz" href="https://hadoop.apache.org/docs/r2.8.2/api/org/apache/hadoop/fs/Path.html" rel="noopener ugc nofollow" target="_blank">Path</a> pathPattern)<br/>                        throws <a class="ae kz" href="http://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" rel="noopener ugc nofollow" target="_blank">IOException</a></span></pre><p id="5cdb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将返回一个java对象，我们可以使用列表理解来获取文件的属性</p><figure class="kk kl km kn fd lb er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es lp"><img src="../Images/f708e009967f00edf8895240577916ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EPpiNCz4YWuMXlCoC0mzRA.png"/></div></div></figure><p id="3cda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">复制到本地</strong></p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="1c78" class="kt ku hi kp b fi kv kw l kx ky">public void copyToLocalFile(<a class="ae kz" href="https://hadoop.apache.org/docs/r2.8.2/api/org/apache/hadoop/fs/Path.html" rel="noopener ugc nofollow" target="_blank">Path</a> src,<br/>                   <a class="ae kz" href="https://hadoop.apache.org/docs/r2.8.2/api/org/apache/hadoop/fs/Path.html" rel="noopener ugc nofollow" target="_blank">Path</a> dst)<br/>                     throws <a class="ae kz" href="http://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" rel="noopener ugc nofollow" target="_blank">IOException</a></span></pre><figure class="kk kl km kn fd lb er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es lq"><img src="../Images/1ede285c2852ac961148b173fa53ceab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9pQAeMmZOmt1FhvAwQH-Zg.png"/></div></div></figure><p id="e4f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查它是否被复制到本地</p><figure class="kk kl km kn fd lb er es paragraph-image"><div class="er es lr"><img src="../Images/46aeb8e3cfbc9abd93bbe388a1781bfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*YuhWpWojjJjjnK-DHutD1Q.png"/></div></figure><p id="1686" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天就到这里吧！！:)</p><p id="62bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Github链接:<a class="ae kz" href="https://github.com/SomanathSankaran/spark_medium/tree/master/spark_csv" rel="noopener ugc nofollow" target="_blank">https://github . com/SomanathSankaran/spark _ medium/tree/master/spark _ CSV</a></p><p id="7888" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ls">请把我在spark中必须涉及的话题发给我，并给我提供改进写作的建议:)</em> </strong></p><p id="505e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">学习并让别人学习！！</strong></p></div></div>    
</body>
</html>