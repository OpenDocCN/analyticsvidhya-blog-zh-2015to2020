<html>
<head>
<title>An Intro to Customizing Charts in Plotly Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Plotly Express中自定义图表的介绍</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/an-intro-to-customizing-charts-in-plotly-express-e3c473740f66?source=collection_archive---------4-----------------------#2020-07-22">https://medium.com/analytics-vidhya/an-intro-to-customizing-charts-in-plotly-express-e3c473740f66?source=collection_archive---------4-----------------------#2020-07-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2eb9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Plotly Express可能是我最喜欢的python中的数据viz工具，尤其是在学习了如何控制它以使它看起来更好之后。在这里，我将带你了解一些基础知识，帮助你掌握如何用Plotly Express制作漂亮的图表。</p><p id="6c67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们开始之前，我们必须有一些数据来玩！为此，我使用了Kaggle的视频游戏销售数据。我在这篇文章中放弃了所有的空值，但是请记住，在实践中通常应该避免这样做！</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="0940" class="jn jo hi jj b fi jp jq l jr js">import pandas as pd</span><span id="98d7" class="jn jo hi jj b fi jt jq l jr js">#Importing the initial dataframe<br/>df1 = pd.read_csv("data/vgsales.csv").dropna()<br/>df1.Year = df1.Year.astype("int")</span><span id="655f" class="jn jo hi jj b fi jt jq l jr js">#First Modified Dataframe<br/>df2 = df1.groupby("Genre").sum().drop(columns = ["Year", "Rank"]).sort_values(by = "Global_Sales").reset_index()</span><span id="92bc" class="jn jo hi jj b fi jt jq l jr js">#Second modified Dataframe<br/>top_genres = ["Platform", "Role-Playing", "Shooter", "Sports", "Action"]<br/>df3 = df1[df1.Genre.isin(top_genres)].groupby(["Genre", "Year"]).sum().drop(columns="Rank").reset_index()</span></pre><p id="263c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太好了！现在，开始有趣的部分。如果你还没有安装包，这里有关于如何安装当前版本<a class="ae jd" href="https://pypi.org/project/plotly/" rel="noopener ugc nofollow" target="_blank">的说明</a>。如果有，太好了！你只需要跑<code class="du ju jv jw jj b">import plotly.express as px</code>就可以跟着跑了！</p><p id="128b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在整篇文章中，我们将使用(可怕的)饼图、条形图和折线图。每个的代码如下:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="ff4f" class="jn jo hi jj b fi jp jq l jr js">#Percentage of how many games are in each category<br/>px.pie(df1, names = "Genre")</span><span id="8202" class="jn jo hi jj b fi jt jq l jr js">#Total lifetime global profit per genre<br/>px.bar(df2, x = "Genre", y = "Global_Sales") </span><span id="8a2f" class="jn jo hi jj b fi jt jq l jr js">#Global profit over time for top 5 genres <br/>px.line(df3, "Year", "Global_Sales"</span></pre><div class="je jf jg jh fd ab cb"><figure class="jx jy jz ka kb kc kd paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><img src="../Images/23e29b3d1c37a805a50b1c98292d7a4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:478/format:webp/1*7ZD2BD6T9yC922f4cr-bug.png"/></div></figure><figure class="jx jy kk ka kb kc kd paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><img src="../Images/9f482ebe6494a41c91d7849ad421b3fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*5xjU_vOunhL4ALaRxxz07Q.png"/></div></figure><figure class="jx jy kk ka kb kc kd paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><img src="../Images/15759068bc0ba457662ffdfb22492d1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*H-D72Yo9tZqPDI1xn53Acg.png"/></div></figure></div><p id="b357" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在…正如你在这里看到的，这些都很乏味，甚至无法阅读。此外，甚至没有任何标题和轴名称只是使用的变量！幸运的是，这两个问题都很容易解决！</p><figure class="je jf jg jh fd jy er es paragraph-image"><div class="er es kl"><img src="../Images/8bbac00cd4f7e8b34cfc8835c833b6bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*27lrT0sLcSSFHgBoLEIZAw.png"/></div></figure><p id="66d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，让我们给饼图添加一个标题，然后切换到一个不同的调色板，因为默认颜色对眼睛来说有点刺眼。我们只需要加一个<code class="du ju jv jw jj b">title</code>，挑一个<code class="du ju jv jw jj b">color_discrete_sequence</code>！Plotly中的谨慎颜色用于分类数据。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="7dc3" class="jn jo hi jj b fi jp jq l jr js">fig1 = px.pie(df1, names = "Genre", title = "Distribution of Video Game Genres", color_discrete_sequence=px.colors.qualitative.Set3)</span><span id="a20c" class="jn jo hi jj b fi jt jq l jr js">fig1.show()</span></pre><p id="294c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，让我们把全球销售图表做得更好。为此，我实际上想翻转图形，使条形水平，为此，我需要做的就是反转x和y变量，并添加<code class="du ju jv jw jj b">orientation = 'h'</code>！</p><figure class="je jf jg jh fd jy er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es km"><img src="../Images/7361232aaf3607d2f639f2cf9cc77d44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i1LPDTzFNv-zO4thnP_Wnw.png"/></div></div></figure><p id="c69d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">标题设置与之前的饼图相同，但是标签最初并不明显！<code class="du ju jv jw jj b">labels</code>接受一个dict对象，每个键对应于用于x和y的列名！最重要的是，我们将使用对应于<code class="du ju jv jw jj b">Global_Sales</code>的连续色标，为此我选择了<code class="du ju jv jw jj b">"darkmint"</code></p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="b84e" class="jn jo hi jj b fi jp jq l jr js">fig2 = px.bar(df2, y = "Genre", x = "Global_Sales", title = "Total Global Sales per Video Game Genre",<br/>       labels = {"Global_Sales": "Global Sales in Millions (USD)", "Genre": "Video Game Genre"},<br/>       orientation = 'h',color = "Global_Sales", color_continuous_scale = "darkmint")</span><span id="1bc1" class="jn jo hi jj b fi jt jq l jr js">fig2.show()</span></pre><p id="37ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不完美，但肯定更容易阅读！另外，谁不喜欢水平条形图呢？当然不是我！</p><p id="67d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，你跟上了吗？什么事？太棒了。然后我们将进入最后的图表！</p><p id="d0c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于这个，我决定我不想使用任何内置的调色板，所以我把它设置成完全不同的颜色。为此，我将使用<code class="du ju jv jw jj b">color_discrete_sequence</code>,并向它传递一个颜色值列表！您可以使用命名的CSS颜色、十六进制、HSV/HSVA、HSL/HSLA和RGB/RGBA颜色格式！(“A”代表Alpha，用于声明颜色的透明度，0代表完全透明，100代表完全纯色)</p><figure class="je jf jg jh fd jy er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es km"><img src="../Images/cf943ed5767b5a91efaa003738389b14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0PsTkcm6wQ1lVutk7gmS1A.png"/></div></div></figure><p id="0876" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，我决定将<code class="du ju jv jw jj b">template</code>设置为Plotly的内置主题之一。因为我们都知道黑色主题是最好的主题，我把它设置为<code class="du ju jv jw jj b">plotly_dark</code></p><p id="2472" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">别忘了设置<code class="du ju jv jw jj b">title</code>和<code class="du ju jv jw jj b">labels</code>属性！这一次，我将<code class="du ju jv jw jj b">Genre</code>和<code class="du ju jv jw jj b">Year</code>单独留下，因为我不想让它太罗嗦。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="e473" class="jn jo hi jj b fi jp jq l jr js">line_colors = ["#7CEA9C", '#50B2C0', "rgb(114, 78, 145)", "hsv(348, 66%, 90%)", "hsl(45, 93%, 58%)"]</span><span id="6c7f" class="jn jo hi jj b fi jt jq l jr js">fig3 = px.line(df3, "Year", "Global_Sales", height = 500, width = 800, color = "Genre", <br/>        title = "Global Profit for Top Video Game Genres Over Time",<br/>        labels = {"Global_Sales": "Global Sales in Millions (USD)"},<br/>        template = "plotly_dark",<br/>        color_discrete_sequence=line_colors)</span><span id="607d" class="jn jo hi jj b fi jt jq l jr js">fig3.show()</span></pre><p id="e1b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">自己定制主题怎么样？你可以修改标题、背景颜色等等。现在，让我们使用<code class="du ju jv jw jj b">plotly_dark</code>主题作为我们的主模板，并对它做一些小的修改。使用<code class="du ju jv jw jj b">fig.update_layout()</code>我们可以将字典传递给它，以方便地修改或添加不同的特性。</p><figure class="je jf jg jh fd jy er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es km"><img src="../Images/ab003dcef10934a7b77a7de0c236418e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gwOLx46otfRsLemWQUS85Q.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">一个又酷又新的修改图表！</figcaption></figure><p id="eb87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<code class="du ju jv jw jj b">title</code>属性，我们可以设置传递给它一个带有<code class="du ju jv jw jj b">{'x': 5}</code>的字典来使它居中！接下来，我们可以将<code class="du ju jv jw jj b">font</code>属性设置为<code class="du ju jv jw jj b">{'family': 'courier'}</code>，这是我最喜欢的web保存字体之一。对于背景颜色，我们可以只传递<code class="du ju jv jw jj b">plot_bgcolor = "#232624"</code>，不需要字典！</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="a114" class="jn jo hi jj b fi jp jq l jr js">line_colors = ["#7CEA9C", '#50B2C0', "rgb(114, 78, 145)", "hsv(348, 66%, 90%)", "hsl(45, 93%, 58%)"]</span><span id="f1f6" class="jn jo hi jj b fi jt jq l jr js">fig3 = px.line(df3, "Year", "Global_Sales", height = 500, width = 800, color = "Genre", <br/>        title = "Global Profit for Top Video Game Genres Over Time",<br/>        labels = {"Global_Sales": "Global Sales in Millions (USD)"},<br/>        template = "plotly_dark",<br/>        color_discrete_sequence=line_colors)</span><span id="7138" class="jn jo hi jj b fi jt jq l jr js">fig3.update_layout(plot_bgcolor = "#23262F",<br/>                  title = {'x':0.5}, <br/>                  font = {"family" : "courier"})</span><span id="38ac" class="jn jo hi jj b fi jt jq l jr js">fig3.show()</span></pre><p id="58d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">精彩！不过，如果你还没有注意到，悬停框看起来有点…暗淡，不符合我们的主题！别担心，这很容易解决！</p><figure class="je jf jg jh fd jy er es paragraph-image"><div class="er es kr"><img src="../Images/ad91963ab5fd6abf3300f6a1d4cb4294.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*cIK-BZdqIY1GaTRPAdkDVQ.png"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">默认的Plotly Express悬停框</figcaption></figure><p id="cc4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有了<code class="du ju jv jw jj b">update.traces()</code>，我们可以用<code class="du ju jv jw jj b">customdata</code>和<code class="du ju jv jw jj b">hovertemplate</code>让它看起来好看又整洁！</p><p id="36c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于<code class="du ju jv jw jj b">customdata</code>，我们需要导入NumPy并传递一个ndarray对象。在这种情况下，我们将从数据帧中添加每一列，并添加我们想要使用的额外数据。为此，我们将添加指定销售地点的销售信息。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="d185" class="jn jo hi jj b fi jp jq l jr js">import numpy as np</span><span id="0fef" class="jn jo hi jj b fi jt jq l jr js">fig3.update_traces(<br/>    customdata = np.stack((df3.NA_Sales, df3.EU_Sales, df3.JP_Sales, df3.Other_Sales), axis = -1))</span></pre><p id="9faf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将开始填写<code class="du ju jv jw jj b">hovertemplate</code>的信息。它接受一个字符串，一些格式可以使用d3-format的语法和一些小的HTML，您可以使用这个<code class="du ju jv jw jj b">%{variable}</code>格式的变量。我们可以从我们的图中传递像<code class="du ju jv jw jj b">x</code>和<code class="du ju jv jw jj b">y</code>这样的值，以及来自<code class="du ju jv jw jj b">customdata</code>的值！</p><figure class="je jf jg jh fd jy er es paragraph-image"><div class="er es ks"><img src="../Images/cca8bb5065f9850407f0085a61f79cd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*TyUQoTTsRme-XgJ5la5mbg.png"/></div></figure><p id="cb29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用<code class="du ju jv jw jj b">&lt;b&gt;</code>将第一行<strong class="ih hj">加粗</strong>，使用<code class="du ju jv jw jj b">&lt;i&gt;</code>将所有位置词变为斜体，使用<code class="du ju jv jw jj b">&lt;br&gt;</code>添加换行符，然后使用方便的<code class="du ju jv jw jj b">%{variable}</code>标记插入数据，首先引用x(年份)和y(全球销售额)。对于全球销售，我使用d3格式的语法在数字前添加一个<code class="du ju jv jw jj b">$</code>，并使用<code class="du ju jv jw jj b">.2f</code>将变量限制为只有2个小数点。总而言之，小菜一碟，虽然有点累眼睛。</p><p id="5600" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，有趣的是:让我们使用<code class="du ju jv jw jj b">hoverlabel</code>将字体变大一点，并将字体本身改为Courier，以匹配图表的其余部分！</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="c758" class="jn jo hi jj b fi jp jq l jr js">fig3.update_traces(<br/>    customdata = np.stack((df3.NA_Sales, df3.EU_Sales, df3.JP_Sales, df3.Other_Sales), axis = -1),<br/>    hovertemplate = """<br/>&lt;b&gt;Total Sales during %{x}:&lt;br&gt;&lt;/b&gt;<br/>%{y:$.2f}M &lt;i&gt;Global&lt;/i&gt;&lt;br&gt;<br/>%{customdata[0]:$.2f}M &lt;i&gt;North America&lt;/i&gt;&lt;br&gt;<br/>%{customdata[1]:$.2f}M &lt;i&gt;European&lt;/i&gt;&lt;br&gt;<br/>%{customdata[2]:$.2f}M &lt;i&gt;Japan&lt;/i&gt;&lt;br&gt;<br/>%{customdata[3]:$.2f}M &lt;i&gt;Other&lt;/i&gt;&lt;br&gt;""",<br/>    <br/>    hoverlabel = {"font_size" : 14, "font_family" : "Courier"}<br/>)</span><span id="f6e7" class="jn jo hi jj b fi jt jq l jr js">fig3.show()</span></pre><figure class="je jf jg jh fd jy er es paragraph-image"><div class="er es kt"><img src="../Images/49b3e944ed271e0ae275c3a2783aaa69.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*ZeVd_W2SsliSjjaWEa2s8Q.png"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">我们最后的悬浮箱！太棒了。</figcaption></figure><p id="f15a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">欢迎到文末，你成功了！既然你在这里，我会传递一些有用的资源！</p><p id="a6cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，Plotly文档是给定的，但是这里还有很多其他方便的资源！和往常一样，记得谷歌！</p><ul class=""><li id="6815" class="ku kv hi ih b ii ij im in iq kw iu kx iy ky jc kz la lb lc bi translated"><a class="ae jd" href="https://plotly.com/python/hover-text-and-formatting/#customizing-hover-text-with-a-hovertemplate" rel="noopener ugc nofollow" target="_blank">用</a> <code class="du ju jv jw jj b"><a class="ae jd" href="https://plotly.com/python/hover-text-and-formatting/#customizing-hover-text-with-a-hovertemplate" rel="noopener ugc nofollow" target="_blank">hovertemplate</a></code>自定义悬停文本</li><li id="fb9a" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><a class="ae jd" href="https://coolors.co/" rel="noopener ugc nofollow" target="_blank">使用coolors.co生成彩色托盘</a></li><li id="6625" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><a class="ae jd" href="https://www.quackit.com/css/color/charts/css_color_names_chart.cfm" rel="noopener ugc nofollow" target="_blank">所有命名的CSS颜色</a></li><li id="03ce" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><a class="ae jd" href="https://plotly.com/python/discrete-color/#color-sequences-in-plotly-express" rel="noopener ugc nofollow" target="_blank">定性的颜色</a> ( <a class="ae jd" href="https://plotly.com/python/discrete-color/#color-sequences-in-plotly-express" rel="noopener ugc nofollow" target="_blank">慎重的</a>)</li><li id="3fc8" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><a class="ae jd" href="https://plotly.com/python/builtin-colorscales/" rel="noopener ugc nofollow" target="_blank">连续的Plotly颜色</a></li></ul></div></div>    
</body>
</html>