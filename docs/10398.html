<html>
<head>
<title>Scanning for memory issues in your data pipelines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">扫描数据管道中的内存问题</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/scanning-for-memory-issues-in-your-data-pipelines-e6a9ea08b2ce?source=collection_archive---------13-----------------------#2020-10-17">https://medium.com/analytics-vidhya/scanning-for-memory-issues-in-your-data-pipelines-e6a9ea08b2ce?source=collection_archive---------13-----------------------#2020-10-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="61ac" class="io ip hi ik b fi iq ir l is it">$ pip install filprofiler</span><span id="0e9e" class="io ip hi ik b fi iu ir l is it">%load_ext filprofiler # use the python fil kernel</span><span id="7561" class="io ip hi ik b fi iu ir l is it">%%filprofile # run this in the cell you wish to evaluate</span></pre><figure class="if ig ih ii fd iw er es paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="er es iv"><img src="../Images/21298e8b750f63a77f086b987b887ac9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rU4AIeB4pU1zV9jI"/></div></div><figcaption class="jd je et er es jf jg bd b be z dx translated">泰勒·达维在<a class="ae jh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><blockquote class="ji"><p id="723f" class="jj jk hi bd jl jm jn jo jp jq jr js dx translated">“由此导致的突然系统故障、蓝屏和停机在当今时代越来越不可接受。”</p></blockquote><p id="a0eb" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp js hb bi translated">我花了一些时间了解python如何使用<a class="ae jh" href="https://pythonspeed.com/articles/function-calls-prevent-garbage-collection/" rel="noopener ugc nofollow" target="_blank">引用计数和垃圾收集系统</a>来处理其<a class="ae jh" href="https://docs.python.org/3/c-api/memory.html" rel="noopener ugc nofollow" target="_blank">内存管理</a>。数据科学可能会受到系统CPU和内存等因素的制约。努力跟上负载的CPU通常表现为系统“变慢”。然而，像泄漏和高内存使用峰值等内存问题。可能会产生灾难性的后果，通常会导致关机、蓝屏甚至数据丢失。</p><p id="f338" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd ke ks kg kh ki kt kk kl km ku ko kp js hb bi translated">我最近有一对旧的记忆棒，只有两个2gb的记忆棒出现故障，由此导致的突然系统故障、蓝屏和停机在这个时代越来越不可接受。</p><p id="7201" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd ke ks kg kh ki kt kk kl km ku ko kp js hb bi translated">在上下文中，我将在本文中介绍的工具可以用于许多目的:</p><ul class=""><li id="546b" class="kv kw hi jv b jw kq ka kr ke kx ki ky km kz js la lb lc ld bi translated">如果您发现加载大量数据很困难</li><li id="c877" class="kv kw hi jv b jw le ka lf ke lg ki lh km li js la lb lc ld bi translated">想看看你的代码的哪一部分使用了最多的内存吗</li><li id="f9d1" class="kv kw hi jv b jw le ka lf ke lg ki lh km li js la lb lc ld bi translated">想要以更小的ram成本进行操作等。</li></ul><p id="ee16" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd ke ks kg kh ki kt kk kl km ku ko kp js hb bi translated">那么Python <a class="ae jh" href="https://github.com/pythonspeed/filprofiler" rel="noopener ugc nofollow" target="_blank"> Filprofiler </a>就适合你。还有其他针对Python的内存分析器，但是用Filprofiler的创建者的话说</p><blockquote class="lj lk ll"><p id="2b74" class="jt ju lm jv b jw kq jy jz ka kr kc kd ln ks kg kh lo kt kk kl lp ku ko kp js hb bi translated">它们都不是为读入数据、处理数据并写出结果的批处理应用程序而设计的-it Amar Turner-Trauring</p></blockquote></div><div class="ab cl lq lr gp ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hb hc hd he hf"><p id="8cc5" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd ke ks kg kh ki kt kk kl km ku ko kp js hb bi translated">与服务器不同，在服务器中，数据泄漏更经常是内存问题的原因，数据管道是更临时的解决方案，因此内存峰值是更常见的问题。"<strong class="jv hj">这是Fil的主要目标:诊断内存使用的峰值."— Itamar，T.T. </strong></p><p id="1605" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd ke ks kg kh ki kt kk kl km ku ko kp js hb bi translated">现在就试一试，看看你的内存在哪里用得最多(目前只限于Linux和macOS):</p><h1 id="10fb" class="lx ip hi bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">安装和使用</h1><p id="6f99" class="pw-post-body-paragraph jt ju hi jv b jw mu jy jz ka mv kc kd ke mw kg kh ki mx kk kl km my ko kp js hb bi translated">使用以下内容安装软件包:</p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="e241" class="io ip hi ik b fi iq ir l is it"><strong class="ik hj">$</strong> pip install --upgrade pip<br/><strong class="ik hj">$</strong> pip install filprofiler</span></pre><p id="318f" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd ke ks kg kh ki kt kk kl km ku ko kp js hb bi translated">或康达:</p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="270f" class="io ip hi ik b fi iq ir l is it"><strong class="ik hj">$</strong> conda install -c conda-forge filprofiler</span></pre><h2 id="ed26" class="io ip hi bd ly mz na nb mc nc nd ne mg ke nf ng mk ki nh ni mo km nj nk ms nl bi translated">与脚本文件一起使用</h2><p id="ed65" class="pw-post-body-paragraph jt ju hi jv b jw mu jy jz ka mv kc kd ke mw kg kh ki mx kk kl km my ko kp js hb bi translated">如果您有一个包含代码的脚本:</p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="61ee" class="io ip hi ik b fi iq ir l is it">$ python yourscript.py --load-file=yourfile</span></pre><p id="4154" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd ke ks kg kh ki kt kk kl km ku ko kp js hb bi translated">只需将python改为“fil-profile run ”,如下所示:</p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="4af5" class="io ip hi ik b fi iq ir l is it">$ fil-profile run yourscript.py --load-file=yourfile</span></pre><h2 id="6781" class="io ip hi bd ly mz na nb mc nc nd ne mg ke nf ng mk ki nh ni mo km nj nk ms nl bi translated">与Jupyter笔记本配合使用</h2><p id="4c16" class="pw-post-body-paragraph jt ju hi jv b jw mu jy jz ka mv kc kd ke mw kg kh ki mx kk kl km my ko kp js hb bi translated">安装完成后，确保在笔记本上加载了备用内核“Python 3 with Fil”。你可以在笔记本右上角修改内核</p><figure class="if ig ih ii fd iw er es paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="er es nm"><img src="../Images/dbb1c0901ddfa95b5a446c1ce4d08ae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v1xr0O7B1F74mX47BQoOog.png"/></div></div><figcaption class="jd je et er es jf jg bd b be z dx translated">点击右上角的内核</figcaption></figure><figure class="if ig ih ii fd iw er es paragraph-image"><div class="er es nn"><img src="../Images/98f8f101ed1aadb50f0ce62215b89c8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*eE0BD4bRKxYZ1lTmuZqfyg.png"/></div><figcaption class="jd je et er es jf jg bd b be z dx translated">从下拉列表中选择备用内核</figcaption></figure><p id="ad2a" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd ke ks kg kh ki kt kk kl km ku ko kp js hb bi translated">一旦选择了内核，您就可以在笔记本的任何地方加载扩展:</p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="4e5f" class="io ip hi ik b fi iq ir l is it">%load_ext filprofiler</span></pre><p id="aa33" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd ke ks kg kh ki kt kk kl km ku ko kp js hb bi translated">您可以通过在单元格顶部添加“%%filprofile”魔术来运行任何特定单元格的配置文件</p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="eeab" class="io ip hi ik b fi iq ir l is it">%%filprofile</span></pre><p id="c9a4" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd ke ks kg kh ki kt kk kl km ku ko kp js hb bi translated">下面是我在推荐引擎上使用它为用户预测商品的一个例子:</p><figure class="if ig ih ii fd iw er es paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="er es no"><img src="../Images/a65da7a0507f54050d05f1642c184d96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lpeiwRqBJfvXQpTDoyjbtw.png"/></div></div></figure><p id="a7e6" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd ke ks kg kh ki kt kk kl km ku ko kp js hb bi translated">该配置文件显示内存使用情况的热图。可以单击每个单独的单元格，并且可以观察到内存分配起源的每个回溯。从上面可以看出，大部分内存使用发生在数据集的读取、构建和为惊喜库构建数据集，以及算法的拟合。</p><p id="0508" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd ke ks kg kh ki kt kk kl km ku ko kp js hb bi translated">创造者打算让它保持精简和易于使用。他想让它“正常工作”。Windows系统的使用正在进行中。</p></div><div class="ab cl lq lr gp ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hb hc hd he hf"><p id="a700" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd ke ks kg kh ki kt kk kl km ku ko kp js hb bi translated">感谢您的阅读！我希望这篇文章能帮助您更多地了解Python的内存管理系统，以及如何优化您的代码以最小化数据管道中的内存峰值。你可以在这篇<a class="ae jh" href="https://pythonspeed.com/articles/memory-profiler-data-scientists/" rel="noopener ugc nofollow" target="_blank">博客文章</a>中读到更多关于fil profiler的信息，这里有一个<a class="ae jh" href="https://pythonspeed.com/datascience/" rel="noopener ugc nofollow" target="_blank">为数据科学家减少内存使用的指南</a></p><h1 id="3056" class="lx ip hi bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">参考</h1><ol class=""><li id="b5a4" class="kv kw hi jv b jw mu ka mv ke np ki nq km nr js ns lb lc ld bi translated"><a class="ae jh" href="https://docs.python.org/3/c-api/memory.html" rel="noopener ugc nofollow" target="_blank">Python中的内存管理</a> —官方文档</li><li id="d9b6" class="kv kw hi jv b jw le ka lf ke lg ki lh km li js ns lb lc ld bi translated"><a class="ae jh" href="https://pythonspeed.com/articles/function-calls-prevent-garbage-collection/" rel="noopener ugc nofollow" target="_blank">执着于内存:Python函数调用如何增加你的内存使用量</a>——博客文章，Itamar，T.T</li><li id="f9a2" class="kv kw hi jv b jw le ka lf ke lg ki lh km li js ns lb lc ld bi translated"><a class="ae jh" href="https://github.com/pythonspeed/filprofiler" rel="noopener ugc nofollow" target="_blank"> Filprofiler </a> — GitHub</li><li id="f7cf" class="kv kw hi jv b jw le ka lf ke lg ki lh km li js ns lb lc ld bi translated"><a class="ae jh" href="https://pythonspeed.com/articles/memory-profiler-data-scientists/" rel="noopener ugc nofollow" target="_blank"> Fil:面向数据科学家的新Python内存分析器和</a>——博客帖子，Itamar，T.T</li><li id="2354" class="kv kw hi jv b jw le ka lf ke lg ki lh km li js ns lb lc ld bi translated"><a class="ae jh" href="https://pythonspeed.com/datascience/" rel="noopener ugc nofollow" target="_blank">数据科学家减少内存使用指南</a> —博客文章，Itamar，T.T</li></ol></div></div>    
</body>
</html>