<html>
<head>
<title>Face detection in Python by OpenCV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用OpenCV实现Python中的人脸检测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/face-detection-in-python-by-open-cv-4b40cc2101e2?source=collection_archive---------19-----------------------#2020-04-10">https://medium.com/analytics-vidhya/face-detection-in-python-by-open-cv-4b40cc2101e2?source=collection_archive---------19-----------------------#2020-04-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="18d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">你了解人脸检测吗？</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/3e53fb525485ece3aefb2c8b5283c8b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*52VqXh3rMFSs22kG-hPBwA.png"/></div></figure><p id="2b35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">人脸检测是一种在各种应用中使用的技术，用于识别数字图像、流式摄像机或网络摄像头中的人脸。</p><p id="ce97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Python编程语言创建之前，我们必须使用C++读取图像(打开cv图像库)进行人脸检测和其他图像处理，但使用Python语言，我们可以非常轻松地生成人脸检测应用程序。</p><p id="359a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们必须通过pip安装一些包:</p><p id="a0de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">pymongo:用于在python中使用mongo数据库。</p><p id="28b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">opencv-python:用于在python中使用图像处理。</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="9f6c" class="jq jr hi jm b fi js jt l ju jv"><strong class="jm hj">pip install pymongo </strong></span><span id="a3d0" class="jq jr hi jm b fi jw jt l ju jv"><strong class="jm hj">pip install opencv-python</strong></span></pre><p id="33c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们希望检测人脸并将日志写入数据库:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="6e0a" class="jq jr hi jm b fi js jt l ju jv"><strong class="jm hj">import cv2 </strong># for reading and scaling image</span><span id="8b78" class="jq jr hi jm b fi jw jt l ju jv"><strong class="jm hj">import datetime as dt</strong></span><span id="4aa1" class="jq jr hi jm b fi jw jt l ju jv"><strong class="jm hj">import pymongo</strong></span><span id="ff41" class="jq jr hi jm b fi jw jt l ju jv"><strong class="jm hj">from time import sleep</strong></span></pre><p id="e2a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为日志初始化数据库:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="0459" class="jq jr hi jm b fi js jt l ju jv"><strong class="jm hj">client = pymongo.MongoClient(“mongodb://localhost:27017/”)<br/>face_database= client[“face_detection”] # select database<br/>faces_collection = face_database[“faces”] # select collection</strong></span></pre><p id="2838" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">初始化cv2点文件:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="5f7f" class="jq jr hi jm b fi js jt l ju jv"><strong class="jm hj">cascPath = “data/haarcascades/haarcascade_frontalface_default.xml”</strong></span></pre><p id="b30a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">cv2中的点文件是xml点文件，用于检测任何东西，如人脸、汽车、颜色、微笑等。您可以从github中的<a class="ae jx" href="https://github.com/opencv/opencv/tree/master/data" rel="noopener ugc nofollow" target="_blank"> <em class="jy"> cv2数据文件夹下载数据点文件。</em> </a></p><p id="5bba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将xml点文件级联到cv2:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="4698" class="jq jr hi jm b fi js jt l ju jv"><strong class="jm hj">faceCascade = cv2.CascadeClassifier(cascPath)</strong></span></pre><p id="4dcf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开始实时录制网络摄像机:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="3a01" class="jq jr hi jm b fi js jt l ju jv"><strong class="jm hj">video_capture = cv2.VideoCapture(0)</strong></span></pre><p id="9b85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您必须从网络摄像头中一帧一帧地循环读取:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="10dc" class="jq jr hi jm b fi js jt l ju jv"><strong class="jm hj">while True:<br/>    # Capture frame-by-frame<br/>    ret, frame = video_capture.read()</strong></span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jz"><img src="../Images/5a152eddd65f25e7a7415cdfc52cb491.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*O0nvRfxbUSJYTEpNj6UWvQ.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">网络摄像头响应</figcaption></figure><p id="b797" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后将图像帧颜色从RGB转换为灰色:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="adb6" class="jq jr hi jm b fi js jt l ju jv"><strong class="jm hj">    gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)</strong></span></pre><p id="94e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你检测到灰度图像存在于级联点文件中:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="fe25" class="jq jr hi jm b fi js jt l ju jv"><strong class="jm hj">   faces = faceCascade.detectMultiScale(<br/>     gray,<br/>     scaleFactor=1.1, </strong># scale of check-in detection must &gt; 1<strong class="jm hj"><br/>     minNeighbors=5, </strong># minimum neighbor of each detected<strong class="jm hj"><br/>     minSize=(30, 30) </strong># minimum size of check rectangle<strong class="jm hj"><br/>    )</strong></span><span id="34df" class="jq jr hi jm b fi jw jt l ju jv"><strong class="jm hj">    print (“Found {0} faces!”.format(len(faces)))</strong></span></pre><p id="e68d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在是将面数插入数据库的时候了:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="b5da" class="jq jr hi jm b fi js jt l ju jv"><strong class="jm hj">    faceDict = { “time”: dt.datetime.now(), “faceCount”:len(faces) }<br/>    faces_collection.insert_one(faceDict)</strong></span></pre><p id="3ace" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为线程增加5秒睡眠时间(可选):</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="6cae" class="jq jr hi jm b fi js jt l ju jv"><strong class="jm hj">    sleep(5)</strong></span></pre><p id="c512" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在脸部周围创建一个矩形:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="b4dc" class="jq jr hi jm b fi js jt l ju jv"><strong class="jm hj">   for (x, y, w, h) in faces:<br/>      cv2.rectangle(image, (x, y), (x+w, y+h), (0, 255, 0), 2)</strong></span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ke"><img src="../Images/26286644d20cec194dc16523413611aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*_rHRUNOOKbMrJ4Bp0BYhXQ.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">在检测到图像中的女人后</figcaption></figure><p id="3a95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你的程序可以通过一帧网络视频流来检测帧中的人脸。</p><p id="74f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用它进行IOT，例如面部锁定、面部计数器进入您的商店等。</p><p id="aba1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此处提供原始Git:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="33ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">向我发送您的评论:)</p></div></div>    
</body>
</html>