<html>
<head>
<title>Market Basket Analysis on 3 million orders from Instacart using Spark.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Spark对Instacart的300万份订单进行购物篮分析。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/market-basket-analysis-on-3-million-orders-from-instacart-using-spark-24cc6469a92e?source=collection_archive---------2-----------------------#2020-02-29">https://medium.com/analytics-vidhya/market-basket-analysis-on-3-million-orders-from-instacart-using-spark-24cc6469a92e?source=collection_archive---------2-----------------------#2020-02-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e0ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">使用</em><strong class="ih hj"><em class="jd">FP-growth</em></strong><em class="jd">算法分析超市产品之间的关联</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/a24618d3535ad98f56ef4e8ffd78ec07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*h6zeUCw2DUYSPxYxz2pHag.png"/></div></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jq"><img src="../Images/5db8cc721feac8f04b0e20638ebee30f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*eyHUU0aKXJFRemOAW1rLTQ.png"/></div></figure><p id="535c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">世界各地的超市都在使用数据挖掘技术来分析用户的购买模式，以使他们的业务更有效率，从而增加他们的业务，同时满足客户的需求。其中一个应用是确定哪些商品是消费者倾向于一起购买的，并分析“如果-那么”模式，以了解消费者是否购买了A，哪些是B，以便向消费者推荐。这有助于他们将正确的产品放在正确的通道上，从而帮助消费者回忆起他们的需求。这有助于消费者根据自己的需求储备冰箱和家居用品，同时减少购买时间。</p><p id="710c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个项目中，我将使用来自Kaggle 的<strong class="ih hj"> Instacart的真实数据集，其中包含来自20万用户的300万份杂货订单的数据。对于每个用户，根据他们从Instacart购买的次数，大约有4到100个不同的订单。以下是数据集的链接:</strong></p><p id="d8e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jr" href="https://www.kaggle.com/c/instacart-market-basket-analysis/data" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/c/insta cart-market-basket-analysis/data</a></p><p id="5e00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将展示spark上的实现，因为它在<strong class="ih hj"> Databricks </strong>上运行非常快，因为它使用分布式进程内计算，即使在如此大的数据集上也只需很少的时间。幸运的是，我们在<strong class="ih hj"> spark </strong>上已经有了<strong class="ih hj"> FP(频繁模式挖掘)库</strong>，因此我将使用它来理解模式。我们开始吧。</p><p id="f589" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注</strong> : Databricks提供用户免费使用他们的社区平台。所以，请随意复制代码，看看模式挖掘的魔力。</p><p id="656d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从将所有文件导入spark数据框开始:</p><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="4dd1" class="jx jy hi jt b fi jz ka l kb kc"><em class="jd">#checking the files we have in the databricks file system</em><br/><br/>%fs ls /FileStore/tables</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kd"><img src="../Images/1687609a4415d25f0330f545d56e7cb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*fdI-jDeRbhzlBulQ5EJb_A.png"/></div></figure><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="ef13" class="jx jy hi jt b fi jz ka l kb kc"><em class="jd">#enabling arrow just for a backup if pandas is needed at any point of time</em><br/><strong class="jt hj">import</strong> <strong class="jt hj">numpy</strong> <strong class="jt hj">as</strong> <strong class="jt hj">np</strong><br/><strong class="jt hj">import</strong> <strong class="jt hj">pandas</strong> <strong class="jt hj">as</strong> <strong class="jt hj">pd</strong><br/></span><span id="baf1" class="jx jy hi jt b fi ke ka l kb kc"><em class="jd">#Importing all the available files into the spark dataframe</em><br/>aisles = spark.read.csv("/FileStore/tables/aisles.csv", header=<strong class="jt hj">True</strong>, inferSchema=<strong class="jt hj">True</strong>)<br/>departments = spark.read.csv("/FileStore/tables/departments.csv", header=<strong class="jt hj">True</strong>, inferSchema=<strong class="jt hj">True</strong>)<br/>order_products_prior = spark.read.csv("/FileStore/tables/order_products__prior.csv", header=<strong class="jt hj">True</strong>, inferSchema=<strong class="jt hj">True</strong>)<br/>order_products_train = spark.read.csv("/FileStore/tables/order_products__train.csv", header=<strong class="jt hj">True</strong>, inferSchema=<strong class="jt hj">True</strong>)<br/>orders = spark.read.csv("/FileStore/tables/orders.csv", header=<strong class="jt hj">True</strong>, inferSchema=<strong class="jt hj">True</strong>)<br/>products = spark.read.csv("/FileStore/tables/products.csv", header=<strong class="jt hj">True</strong>, inferSchema=<strong class="jt hj">True</strong>)<br/><br/><em class="jd"># Create Temporary Tables to work using sql like commands</em><br/>aisles.createOrReplaceTempView("aisles")<br/>departments.createOrReplaceTempView("departments")<br/>order_products_prior.createOrReplaceTempView("order_products_prior")<br/>order_products_train.createOrReplaceTempView("order_products_train")<br/>orders.createOrReplaceTempView("orders")<br/>products.createOrReplaceTempView("products")</span></pre><h1 id="d261" class="kf jy hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">以下是所有文件的数据字典:</h1><h1 id="1a50" class="kf jy hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">1)订单(340万行，20.6万用户):</h1><p id="1dad" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">order_id:订单标识符</p><p id="12da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">user_id:客户标识符</p><p id="24cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">eval_set:该订单属于哪个评估集(请参见下面描述的评估集)</p><p id="a71a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">order_number:该用户的订单序号(1 =第一个，n =第n个)</p><p id="0383" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">order_dow:下订单的那一天</p><p id="570f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">order_hour_of_day:一天中下订单的时间</p><p id="905f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">days_since_prior:自上次订单以来的天数，上限为30天(order_number的NAs = 1)</p><h1 id="2017" class="kf jy hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">2)产品(50k行):</h1><p id="068f" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">产品标识:产品标识符</p><p id="18ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">产品名称:产品的名称</p><p id="9324" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">aisle_id:外键</p><p id="4383" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">部门标识:外键</p><h1 id="4dd8" class="kf jy hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">3)过道(134排):</h1><p id="9eb7" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">过道标识:过道标识</p><p id="8d78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">过道:过道的名称</p><h1 id="5923" class="kf jy hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">4)部门(21行):</h1><p id="a68a" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">部门标识:部门标识</p><p id="d9a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">部门:部门的名称</p><h1 id="1826" class="kf jy hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">5)订单_产品_ _集(30m+行):</h1><p id="6226" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">order_id:外键</p><p id="6622" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">产品标识:外键</p><p id="e022" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">add_to_cart_order:每个产品添加到购物车的顺序</p><p id="2432" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">重新订购:如果该用户过去订购过该产品，则为1；否则为0，其中SET是以下四个评估集之一(订单中的eval_set):</p><p id="e697" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“之前”:用户最近订单之前的订单(约320万份订单)</p><p id="8df3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“培训”:提供给参与者的培训数据(约13.1万份订单)</p><p id="34ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“测试”:为机器学习竞赛保留的测试数据(约75k订单)</p><p id="a871" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们利用。在spark中展示函数，做一些基本的探索性数据分析，熟悉数据。</p><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="e5dd" class="jx jy hi jt b fi jz ka l kb kc"><em class="jd">#Top 5 orders in the orders dataframe</em><br/>orders.show(n=5)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lh"><img src="../Images/e95e03aaf082faa2da2e5e1c85ad0725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*F3I1vsoU1C4yErz3YrD_DQ.png"/></div></figure><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="4e5d" class="jx jy hi jt b fi jz ka l kb kc">products.show(n=5)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es li"><img src="../Images/ee73e5522b3f63af4ba21fa11c88b13e.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*f2iVpJxJp0C08HITQxp0Tw.png"/></div></figure><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="746f" class="jx jy hi jt b fi jz ka l kb kc">order_products_train.show(n=5)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lj"><img src="../Images/fce49b19660a46651c3d86d01ef94e49.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*nqw30vn4pdi8uIQHGHh0bw.png"/></div></figure><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="bec3" class="jx jy hi jt b fi jz ka l kb kc">order_products_prior.show(n=5)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lk"><img src="../Images/107ef2510ecc69cbb19b91cf50cfda9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*30p1Ib5zAX-ODgclBaHlXQ.png"/></div></figure><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="f519" class="jx jy hi jt b fi jz ka l kb kc">departments.show(n=5)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ll"><img src="../Images/a8b5857117396a5a1632951d0cce1852.png" data-original-src="https://miro.medium.com/v2/resize:fit:422/format:webp/1*fgadyfQOvkNETwUD1P3k2w.png"/></div></figure><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="4850" class="jx jy hi jt b fi jz ka l kb kc">aisles.show(n=5)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lm"><img src="../Images/35d1193918cd3709b47e146ef9056537.png" data-original-src="https://miro.medium.com/v2/resize:fit:474/format:webp/1*wKXYq5X2OB09x3_pa41ONg.png"/></div></figure><p id="7684" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们来看看订单总数在一周的不同日子里有什么不同。</p><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="adf4" class="jx jy hi jt b fi jz ka l kb kc">%sql<br/>select <br/>  count(order_id) <strong class="jt hj">as</strong> total_orders, <br/>  (case <br/>     when order_dow = '0' then 'Sunday'<br/>     when order_dow = '1' then 'Monday'<br/>     when order_dow = '2' then 'Tuesday'<br/>     when order_dow = '3' then 'Wednesday'<br/>     when order_dow = '4' then 'Thursday'<br/>     when order_dow = '5' then 'Friday'<br/>     when order_dow = '6' then 'Saturday'              <br/>   end) <strong class="jt hj">as</strong> day_of_week <br/>  <strong class="jt hj">from</strong> <strong class="jt hj">orders</strong>  <br/> group by order_dow <br/> order by total_orders desc</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ln"><img src="../Images/150160fc5cb8ead0824f68a4fc0ac169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*_oIKYiheEcFq0Po_5KezWQ.png"/></div></figure><p id="0fe7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Instacart的大部分订单都是在周日或者周一下的。似乎人们在周末娱乐结束后会想起他们的需求。玩笑归玩笑，让我们也看看一天中的时间分布，以分析大多数用户从Instacart下单的时间。</p><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="955b" class="jx jy hi jt b fi jz ka l kb kc">%sql<br/>select <br/>  count(order_id) <strong class="jt hj">as</strong> total_orders, <br/>  order_hour_of_day <strong class="jt hj">as</strong> hour <br/>  <strong class="jt hj">from</strong> <strong class="jt hj">orders</strong> <br/> group by order_hour_of_day <br/> order by order_hour_of_day</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lo"><img src="../Images/503019e42b22841383d87c6022fa3495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*qVxxUDv49GbRn3PvHwarjA.png"/></div></figure><p id="5269" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我们在上面的条形图中看到的，大多数订单都是在上午10点至下午4点之间下单的。这让我有点惊讶，因为我原本以为高峰会在办公时间之外。现在，让我们看看哪个部门在产品数量方面领先。</p><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="f5e7" class="jx jy hi jt b fi jz ka l kb kc">select countbydept.*<br/>  <strong class="jt hj">from</strong> (<br/>  -- <strong class="jt hj">from</strong> <strong class="jt hj">product</strong> table, let's count number of records per dept<br/>  -- <strong class="jt hj">and</strong> then sort it by count (highest to lowest) <br/>  select department_id, count(1) <strong class="jt hj">as</strong> counter<br/>    <strong class="jt hj">from</strong> <strong class="jt hj">products</strong><br/>   group by department_id<br/>   order by counter asc <br/>  ) <strong class="jt hj">as</strong> maxcount<br/>inner join (<br/>  -- let's repeat the exercise, but this time let's join<br/>  -- products <strong class="jt hj">and</strong> departments tables to get a full list of dept <strong class="jt hj">and</strong> <br/>  -- prod count<br/>  select<br/>    d.department_id,<br/>    d.department,<br/>    count(1) <strong class="jt hj">as</strong> products<br/>    <strong class="jt hj">from</strong> <strong class="jt hj">departments</strong> d<br/>      inner join products p<br/>         on p.department_id = d.department_id<br/>   group by d.department_id, d.department <br/>   order by products desc<br/>  ) countbydept <br/>  -- combine the two queries's results by matching the product count<br/>  on countbydept.products = maxcount.counter</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lp"><img src="../Images/c1de86b6569212bc9e79b1f7307b9263.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*-5-OJiWPavwoa5am96BRKw.png"/></div></figure><p id="163d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">个人护理部<strong class="ih hj">和食品部</strong>紧随其后的是<strong class="ih hj">食品部</strong>和<strong class="ih hj">冷冻部</strong>在产品数量上领先。现在，让我们想象一下，哪些产品是唯一订单数量最多的产品，这意味着获得最受欢迎的产品。</p><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="6532" class="jx jy hi jt b fi jz ka l kb kc">%sql<br/>select count(opp.order_id) <strong class="jt hj">as</strong> orders, p.product_name <strong class="jt hj">as</strong> popular_product<br/>  <strong class="jt hj">from</strong> <strong class="jt hj">order_products_prior</strong> opp, products p<br/> where p.product_id = opp.product_id <br/> group by popular_product <br/> order by orders desc <br/> limit 10</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lq"><img src="../Images/be2a30865d25debdfbc260f70ec1214c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*r6WMdsrZEDeLeIqRX-xQKw.png"/></div></figure><p id="92a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">香蕉、草莓和菠菜最受欢迎。事实上，大多数顶级产品看起来都是健康的。美国什么时候变得这么健康了？</p><p id="15b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们必须准备好我们的数据，它可以被输入到<strong class="ih hj">模式挖掘(FP增长)算法</strong>中。我们需要每一行都有一篮子一起订购的商品。让我们在输入算法之前创建一个篮子数据框架。</p><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="ac32" class="jx jy hi jt b fi jz ka l kb kc"><em class="jd"># Organize the data by shopping basket</em><br/><strong class="jt hj">from</strong> <strong class="jt hj">pyspark.sql.functions</strong> <strong class="jt hj">import</strong> collect_set, col, count<br/>rawData = spark.sql("select p.product_name, o.order_id from products p inner join order_products_train o where o.product_id = p.product_id")<br/>baskets = rawData.groupBy('order_id').agg(collect_set('product_name').alias('items'))<br/>baskets.createOrReplaceTempView('baskets')</span><span id="1ebf" class="jx jy hi jt b fi ke ka l kb kc">rawData.show(5)<br/>baskets.show(5)</span><span id="2522" class="jx jy hi jt b fi ke ka l kb kc">display(baskets)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lr"><img src="../Images/a34b2c9cc92285c592017ec4441e77b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hw24x-1-k7JHbd1S-sxBVA.png"/></div></div></figure><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="709f" class="jx jy hi jt b fi jz ka l kb kc">print((baskets.count(), len(baskets.columns)))</span><span id="3bd1" class="jx jy hi jt b fi ke ka l kb kc">(131209, 2)</span></pre><p id="d4ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们总共有大约1，31，209篮商品。现在让我们将这些数据输入spark中的FPGrowth算法。在此之前，让我们弄清楚一些术语-</p><h1 id="f253" class="kf jy hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">1)支持:</h1><p id="c400" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">这个度量提供了一个项目集在所有事务中出现频率的概念。直观地说，对于任何篮子A，support测量包含该篮子作为子集的事务的百分比。</p><h1 id="5abb" class="kf jy hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">2)自信:</h1><p id="ee78" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">这个度量定义了在购物车已经有先行词的情况下，在购物车上出现结果的可能性。直观地说，假设有一个篮子{a，b，c}有一个support 's '，那么如果我们进行分析({a}意味着{b，c})，置信度就是包含{b，c}的{a，b，c}的交易的百分比。</p><h1 id="2990" class="kf jy hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">3)电梯:</h1><p id="179f" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">在计算{Y}给定{X}出现的条件概率时，取消对结果的支持(频率)的控制。电梯是超市用来放置产品的最重要的参数。把它想象成{X}对我们的信心的<em class="jd">提升</em>,因为{Y}在车上。换句话说，提升是在知道{X}存在的情况下将{Y}放在购物车上的概率比在不知道{X}存在的情况下将{Y}放在购物车上的概率的增加。</p><p id="24f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参考理解这些术语:</p><p id="7e50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jr" href="https://towardsdatascience.com/association-rules-2-aa9a77241654" rel="noopener" target="_blank">https://towards data science . com/association-rules-2-aa9a 77241654</a></p><p id="d49b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们将最小支持度设置为0.001，这意味着对于我们的分析，我们将分析的任何篮子都应该至少出现0.001* 1，31，209 ( 131)次，以便在我们的频繁模式分析中加以考虑。</p><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="12be" class="jx jy hi jt b fi jz ka l kb kc">%scala<br/><strong class="jt hj">import</strong> <strong class="jt hj">org.apache.spark.ml.fpm.FPGrowth</strong><br/><br/>// Extract out the items <br/>val baskets_ds = spark.sql("select items from baskets").<strong class="jt hj">as</strong>[Array[String]].toDF("items")<br/><br/>// Use FPGrowth<br/>val fpgrowth = new FPGrowth().setItemsCol("items").setMinSupport(0.001).setMinConfidence(0)<br/>val model = fpgrowth.fit(baskets_ds)</span><span id="c367" class="jx jy hi jt b fi ke ka l kb kc">%scala<br/>// Display frequent itemsets<br/>val mostPopularItemInABasket = model.freqItemsets<br/>mostPopularItemInABasket.createOrReplaceTempView("mostPopularItemInABasket")</span></pre><p id="468c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们看看最常见的一篮子商品。</p><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="af9b" class="jx jy hi jt b fi jz ka l kb kc">%sql<br/>select items, freq <strong class="jt hj">from</strong> <strong class="jt hj">mostPopularItemInABasket</strong> where size(items) &gt; 2 order by freq desc limit 20</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ls"><img src="../Images/a0c288252b5cb50310c5330cad4b1d30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*Dh5YTKVgK5EVdmgIQwwvJA.png"/></div></figure><p id="9621" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们使用FP-growth算法的关联规则属性来分析if-then关联，并查看不同项目的置信度和提升值。<strong class="ih hj">对于有助于Instacart的规则，提升值应该是&gt; 1。</strong></p><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="744e" class="jx jy hi jt b fi jz ka l kb kc">%scala<br/>// Display generated association rules.<br/>val ifThen = model.associationRules<br/>ifThen.createOrReplaceTempView("ifThen")</span><span id="9871" class="jx jy hi jt b fi ke ka l kb kc">%sql<br/>select * <strong class="jt hj">from</strong> <strong class="jt hj">ifThen</strong> where lift &gt; 1 order by lift desc</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lt"><img src="../Images/2f62a37c8991d2e63e70a8d0071bbf0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RMrM0i4MRjT7ZCZPFUiyEA.png"/></div></div></figure><p id="dd6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上表中我们可以看到，lift值的递减规律，如果有人购买[“草莓大黄酸奶”]，他购买[“蓝莓酸奶”]的几率非常高</p><p id="5d67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">按照置信度的顺序显示会导致以下结果。</p><p id="cef9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:Lift量化了因前因而独一无二的关联的力量，而confidence仅仅是有前因时后果发生的概率。</p><pre class="jf jg jh ji fd js jt ju jv aw jw bi"><span id="bba4" class="jx jy hi jt b fi jz ka l kb kc">%sql<br/>select antecedent <strong class="jt hj">as</strong> `antecedent (<strong class="jt hj">if</strong>)`, consequent <strong class="jt hj">as</strong> `consequent (then)`, confidence <strong class="jt hj">from</strong> <strong class="jt hj">ifThen</strong> order by confidence desc limit 20</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lu"><img src="../Images/f119cb7c512066b6846797b3a0523b75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xbCgNFZ8DVPHNyBsiXPS_Q.png"/></div></div></figure><p id="911d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参考:<a class="ae jr" href="https://s3.us-east-2.amazonaws.com/databricks-dennylee/notebooks/Market+Basket+Analysis+using+Instacart+Online+Grocery+Dataset.html" rel="noopener ugc nofollow" target="_blank">https://S3 . us-east-2 . Amazon AWS . com/data bricks-Denny lee/notebooks/Market+Basket+Analysis+using+insta cart+Online+杂货+Dataset.html </a></p></div></div>    
</body>
</html>