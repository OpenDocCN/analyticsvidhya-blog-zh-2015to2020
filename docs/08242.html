<html>
<head>
<title>Build a simple autocomplete model with your own Google search history</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用你自己的谷歌搜索历史建立一个简单的自动完成模型</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/build-a-simple-autocomplete-model-with-your-own-google-search-history-ead26b3b6bd4?source=collection_archive---------6-----------------------#2020-07-22">https://medium.com/analytics-vidhya/build-a-simple-autocomplete-model-with-your-own-google-search-history-ead26b3b6bd4?source=collection_archive---------6-----------------------#2020-07-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/88f47d8e5783afc0ee31ab8a32093b8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*0UgE8WV-f9nJJcbFljm61g.png"/></div></figure><p id="2181" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里我们使用一个简单的<strong class="io hj"> <em class="jk">概率方法</em> </strong>用于自动完成模型。</p><p id="bbec" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，我们必须提取你的谷歌搜索历史。</p><p id="b72f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">去https://takeout.google.com/settings/takeout<a class="ae jl" href="https://takeout.google.com/settings/takeout" rel="noopener ugc nofollow" target="_blank"/></p><p id="8e3e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">单击取消全选。(我们不需要所有的数据，谷歌搜索查询就足够了)</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es jm"><img src="../Images/80b8803a033008270b6e20ff2ecad706.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K0akB5Um_hFweousO1gkog.png"/></div></div></figure><p id="f5f8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">找到“我的活动”部分并选择它。</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es jv"><img src="../Images/b43ec34ca3090d6decf2eddaafe46ab0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TPmMV9hgpeGmM6wzrZ6MSg.png"/></div></div></figure><p id="f1b2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，我们必须为谷歌搜索查询过滤我们的结果。为此，<strong class="io hj">点击“包括所有活动数据”</strong>并取消选择除“搜索”之外的所有选项。</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es jw"><img src="../Images/c98cb392b23fe664971d66c4add03bf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*G0bC972RmC6dciEk22rbuw.png"/></div></figure><p id="d84d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，您可以选择JSON作为输出格式。为此，<strong class="io hj">点击‘多种格式’</strong>并在下拉列表中选择JSON。</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es jx"><img src="../Images/739b87f7da36857f0fd3419d7e2bd54d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TPmyOpCPR6FAlSuQHb5wcw.png"/></div></div></figure><p id="e50c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">继续下一步，选择您喜欢的下载方法。几分钟后，你就可以下载名为<strong class="io hj">外卖&lt;一些数字&gt;的zip文件了。拉链</strong>。解压并找到<strong class="io hj"> MyActivity.json </strong>文件。这将是我们模型的输入文件。</p><p id="5729" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们对MyActivity.json文件进行一些预处理，并将搜索查询提取到myactivity.txt文件中。这个文本文件填充是我们模型的输入。</p><pre class="jn jo jp jq fd jy jz ka kb aw kc bi"><span id="7fe0" class="kd ke hi jz b fi kf kg l kh ki">import json<br/>import re<br/>data=[]</span><span id="2860" class="kd ke hi jz b fi kj kg l kh ki">processed=[]<br/>regex = re.compile('[^a-zA-Z ]')</span><span id="57ba" class="kd ke hi jz b fi kj kg l kh ki">with open('myActivity.json',encoding="utf8") as f:<br/>    data = json.load(f)</span><span id="69d6" class="kd ke hi jz b fi kj kg l kh ki">for i in range(len(data)):<br/>    search_query = data[i]['title']<br/>    if search_query.startswith('Visited'):<br/>        search_query = search_query[8:].lower()<br/>        search_query = regex.sub('', search_query)<br/>        if search_query.startswith('http'):<br/>            continue<br/>        processed.append(search_query)<br/>    elif search_query.startswith('Searched for'):<br/>        search_query = search_query[13:].lower()<br/>        search_query = regex.sub('', search_query)<br/>        if search_query.startswith('http'):<br/>            continue<br/>        processed.append(search_query)<br/>    else:<br/>        pass</span><span id="3636" class="kd ke hi jz b fi kj kg l kh ki">print(processed[:50])</span><span id="001f" class="kd ke hi jz b fi kj kg l kh ki">with open('myactivity.txt','w') as file:<br/>    file.write('\n'.join(processed))</span></pre><p id="04d1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在接下来的步骤中，我们将使用JavaScript(😋为什么不呢？).也许你能把这个模型和一个简单的带有文本建议的前端系统结合起来。</p><p id="4530" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">导入所需的包。为此，你可能需要下载npm包<a class="ae jl" href="https://www.npmjs.com/package/sentence-tokenization" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/sentence-tokenization</a></p><figure class="jn jo jp jq fd ij"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="372d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们必须逐行读取myactivity.txt文件，并对每个句子进行标记。标记化就是简单地将句子分割成单词，并将它们作为元素存储在类似数组的结构中。对于这个简单的模型，我只考虑了带有英文字母的单词。对于更高级的模型，您可以使用标点符号和表情符号作为标记。</p><figure class="jn jo jp jq fd ij"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="c4c8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在执行main()函数之前，我们需要模型的一些辅助函数。</p><p id="c2a2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们要建立一个小词汇量。在这个例子中，我们将使用在输入文件中至少出现两次的标记来构建词汇表。建立词汇后，将输入句子中的其他标记替换为<unk>标记。(这表示它是一个不在词汇表中的单词)</unk></p><figure class="jn jo jp jq fd ij"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="624d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在让我们深入研究模型的实际逻辑。</p><p id="83a2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="jk">该方法基于n元语言模型。n元语法是n个标记的相邻集合。为了简单起见，考虑n = 2。在这种情况下，n元模型将被称为二元模型。</em></strong></p><p id="2099" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">句子“这是一个简单的概率模型”的二元模型将是</p><pre class="jn jo jp jq fd jy jz ka kb aw kc bi"><span id="bb5f" class="kd ke hi jz b fi kf kg l kh ki">["this", "is"], ["is", "a"], ["a", "simple"], ["simple", "probabilistic"], ["probabilistic", "model"]</span></pre><p id="7cfc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对于n=3，三元模型将是</p><pre class="jn jo jp jq fd jy jz ka kb aw kc bi"><span id="1d9f" class="kd ke hi jz b fi kf kg l kh ki">["this", "is", "a"], ["is", "a", "simple"], ["a", "simple", "probabilistic"], ["simple", "probabilistic", "model"]</span></pre><p id="703a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">同样，我们必须计算每个n元语法在输入文本中出现的次数。为此，我们可以使用一个n大小的窗口来扫描令牌列表。在此之前，我们必须添加特殊的标记来表示句子的开始和结束。<s>和<e>。<s>在句首加n-1次，而<e>只加一次。</e></s></e></s></p><figure class="jn jo jp jq fd ij"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="5ee6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们有了二元模型和三元模型(即n元模型和n+1元模型)的计数。现在我们可以估计下一个单词的概率，给定前两个单词。</p><p id="ab33" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">假设前面两个词(令牌)是[“什么”，“是”]。那么，对于词汇中的每个单词<strong class="io hj"> <em class="jk"> w </em> </strong>，我们可以将概率计算为</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es km"><img src="../Images/c0754ec4830428e7265e76f4f1880cb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TOEo3GkFfqzBkAvP_x91Dg.png"/></div></div></figure><p id="d679" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">上述计数有可能为0。作为解决方案，我们可以将平滑常数<strong class="io hj"> <em class="jk"> k </em> </strong>添加到等式中。那么等式就变成了，</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es kn"><img src="../Images/42e92f7d1cd4e6d4c90d372ff9681c16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z_Zx886HzgamEnq1LPIdBw.png"/></div></div></figure><p id="3f02" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">同样，我们可以得到词汇表中每个单词的概率。</p><figure class="jn jo jp jq fd ij"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="11ad" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在计算每个单词的概率后，我们可以根据最大概率选择最佳建议。你也可以选择几个带有最大概率单词的建议。</p><figure class="jn jo jp jq fd ij"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="3d6d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以通过使用几个n-gram计数来进一步开发该模型。如果开始的话是“什么是a ”,我们可以使用几个模型并得到更多的建议。</p><ul class=""><li id="2b67" class="ko kp hi io b ip iq it iu ix kq jb kr jf ks jj kt ku kv kw bi translated">使用["a"]作为起始标记，并使用单字和双字计数</li><li id="0304" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated">使用["is "，" a"]作为起始标记，并使用二元模型和三元模型计数</li><li id="081e" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated">使用[“什么”、“是”、“a”]作为起始标记，并使用三元组和四元组计数。</li></ul><p id="9e91" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请注意，对于每种方法，我们总是必须使用n-gram计数和n+1-gram计数。</p><p id="9e3f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里我使用了5克的计数。</p><figure class="jn jo jp jq fd ij"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="7153" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">用这种方法，对于起始词“什么是a ”,我得到了下面的建议和各自的概率值。</p><p id="51ea" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">功能→ 0.020064602834036733 <br/>轻量级→ 0.008857318249583442 <br/>良好→0.009494937</p><p id="1656" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请注意，单词“good”出现了两次，因为3-gram和4-gram模型都预测了单词“good”。</p><p id="e7f8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">完整的源代码:</p><figure class="jn jo jp jq fd ij"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="e585" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如您所见，我们设法用概率方法构建了一个简单的自动完成模型。如果你对这种自然语言处理模型感兴趣，我非常鼓励你参加Coursera中deeplearning.ai的自然语言专业。你将能够通过机器学习和深度神经网络学习更高级的模型。</p><p id="2df7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">另一本有用的参考书籍<a class="ae jl" href="https://web.stanford.edu/~jurafsky/slp3/" rel="noopener ugc nofollow" target="_blank">https://web.stanford.edu/~jurafsky/slp3/</a></p><p id="44ee" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">祝你好运！！！</p></div></div>    
</body>
</html>