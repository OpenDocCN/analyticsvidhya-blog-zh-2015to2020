<html>
<head>
<title>Part 3: Dockerize your web app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第3部分:将您的web应用程序分类</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/part3-dockerize-your-web-app-cc1a6a998d5d?source=collection_archive---------21-----------------------#2020-03-28">https://medium.com/analytics-vidhya/part3-dockerize-your-web-app-cc1a6a998d5d?source=collection_archive---------21-----------------------#2020-03-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c139" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们将对python web应用程序进行dockerize的系列文章的第三部分。</p><p id="dfa7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你还没有看过这个系列的<a class="ae jd" rel="noopener" href="/@ayedaemon/python-web-apps-made-easy-python-cgi-5dd013964f2d"> Part1 </a>和<a class="ae jd" rel="noopener" href="/@ayedaemon/securing-web-apps-command-execution-firewall-38c65f696cd7"> Part2 </a>，我推荐你先看一下。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="e79f" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">Docker是什么？</h1><p id="e3a7" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">根据维基百科，</p><blockquote class="ko kp kq"><p id="c9b4" class="if ig kr ih b ii ij ik il im in io ip ks ir is it kt iv iw ix ku iz ja jb jc hb bi translated">Docker是一组平台即服务产品，使用操作系统级虚拟化来交付称为容器的软件包中的软件。容器是相互隔离的，捆绑了它们自己的软件、库和配置文件；他们可以通过明确定义的渠道相互交流。</p></blockquote><p id="257d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">阅读<a class="ae jd" href="https://opensource.com/resources/what-docker" rel="noopener ugc nofollow" target="_blank">这篇</a>解释docker的伟大文章。</p><h1 id="3fb8" class="jl jm hi bd jn jo kv jq jr js kw ju jv jw kx jy jz ka ky kc kd ke kz kg kh ki bi translated">虚拟化和容器化的区别？</h1><p id="6eb8" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">容器和虚拟机的目标相似:将应用程序及其依赖项隔离到一个自包含的单元中，该单元可以在任何地方运行。</p><p id="20b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，容器和虚拟机消除了对物理硬件的需求，允许在能耗和成本效益方面更有效地使用计算资源。</p><p id="704d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">容器和虚拟机之间的主要区别在于它们的架构方法。下面我们通过阅读<a class="ae jd" href="https://www.freecodecamp.org/news/a-beginner-friendly-introduction-to-containers-vms-and-docker-79a9e3e119b/" rel="noopener ugc nofollow" target="_blank">这个</a>和<a class="ae jd" href="https://jaxenter.com/containerization-vs-virtualization-docker-introduction-120562.html" rel="noopener ugc nofollow" target="_blank">这个</a>来仔细了解一下。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="f6a8" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated"><span class="l la lb lc bm ld le lf lg lh di"> G </span>开始设定</h1><p id="58df" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">在你创建docker镜像和容器之前，你需要一些包(或者软件)..</p><p id="751b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在您的终端中键入以下内容，检查您是否已经安装了这些软件。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="0ec0" class="lr jm hi ln b fi ls lt l lu lv">$ rpm -q docker-ce</span></pre><p id="0060" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你没有这个软件包，那么安装它。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="1e66" class="lr jm hi ln b fi ls lt l lu lv">$ yum install docker-ce -y</span></pre><p id="7837" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kr">(我已经配置了我的本地yum来获取这些包。如果你还没有这样做，那么就按照</em> <a class="ae jd" href="https://www.cyberciti.biz/faq/install-use-setup-docker-on-rhel7-centos7-linux/" rel="noopener ugc nofollow" target="_blank"> <em class="kr">这个</em> </a> <em class="kr">..)</em></p><figure class="li lj lk ll fd lx er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es lw"><img src="../Images/e8ab67748ca813284cc2f220979bcc1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wprFSkLhY2IbRVCbv_jaZA.png"/></div></div></figure><p id="8ff6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正确安装软件包后，用“<strong class="ih hj"> rpm -q docker-ce </strong>命令再次检查。</p><p id="5595" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在一切都已正确安装在您的系统上。你只需要启动docker服务(守护程序)就万事俱备了。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="fb76" class="lr jm hi ln b fi ls lt l lu lv">$ systemctl start docker-ce</span></pre><figure class="li lj lk ll fd lx er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es me"><img src="../Images/83a26ac58a6401b37da3ea7f43fe489e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HAaGGwqx7dlAtdKpFwr1GQ.png"/></div></div></figure><p id="ee95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们检查一下是否预装了任何映像或容器。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="d87f" class="lr jm hi ln b fi ls lt l lu lv">$ docker images<br/></span><span id="a5e6" class="lr jm hi ln b fi mf lt l lu lv">$ docker container ls -a<br/>or<br/>$ docker ps -a</span></pre><figure class="li lj lk ll fd lx er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mg"><img src="../Images/97e4260de442d13da26c09cbd1221cf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D2D7ZjHq2eyIRV-JXFO_zg.png"/></div></div></figure><p id="8264" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里什么都没有..所以将只需要从头开始…</p><p id="4e8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.第一步总是获得一个基础操作系统。(<em class="kr">我选centos:7 </em>)</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="d187" class="lr jm hi ln b fi ls lt l lu lv">$ docker pull centos:7</span></pre><figure class="li lj lk ll fd lx er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mh"><img src="../Images/298c5c8b45e1956308a720d2f9284db8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*RdSBl2K-65aaxSTMgof6PA.png"/></div></div></figure><p id="206e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的命令中，docker守护进程从在线docker hub注册表中搜索centos:7映像，并在我们的本地系统中提取它的副本。</p><p id="c09c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.将图像下载到您的系统后，您可以简单地运行它并创建该图像的容器。<br/>容器是图像的一个实例。就像类的对象一样。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="def1" class="lr jm hi ln b fi ls lt l lu lv">$ docker run -d -i -t — name demo centos:7<br/></span></pre><figure class="li lj lk ll fd lx er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mi"><img src="../Images/eb5e863a809a901d8b9a613a25b8c12f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m8D39i7UoknpL9c1Y7Tebg.png"/></div></div></figure><p id="db21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了更好地理解docker run命令的选项，请查看此<a class="ae jd" href="https://docs.docker.com/engine/reference/commandline/run/" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="4d99" class="lr jm hi ln b fi ls lt l lu lv"><em class="kr">Here, <br/></em><strong class="ln hj"><em class="kr">-d</em></strong><em class="kr"> indicates that the docker should start in a detached mode(i.e., start in background and we can later attach to it anytime we want).<br/></em><strong class="ln hj"><em class="kr">-i</em></strong><em class="kr"> indicates that the docker should start in interactive mode. This will keep the STDIN open even if not attached.</em></span><span id="2714" class="lr jm hi ln b fi mf lt l lu lv"><strong class="ln hj"><em class="kr">-t</em></strong><em class="kr"> indicates that a tty should be allocated to this container.<br/></em><strong class="ln hj"><em class="kr">--name</em></strong><em class="kr"> gives a name to our container. By default, docker container gets a cool dynamic name itself. (Give it a try, without — name option)</em></span></pre><p id="6d5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.现在，我们可以检查是否存在图像和容器。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="5416" class="lr jm hi ln b fi ls lt l lu lv">$ docker images</span><span id="7e11" class="lr jm hi ln b fi mf lt l lu lv">$ docker ps -a</span></pre><p id="9f8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.因为我们以分离模式启动了容器。让我们依恋它，这样我们就能在它上面工作。我们可以用集装箱的名称或集装箱的id来贴在上面。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="0ab1" class="lr jm hi ln b fi ls lt l lu lv">$ docker attach demo</span></pre><figure class="li lj lk ll fd lx er es paragraph-image"><div class="er es mj"><img src="../Images/bf471c1c1779a1ec0b41b0b201e44010.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*so4mbCIWCI9dsmPDwQAbnw.png"/></div></figure><p id="c744" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.在我们的shell附加到docker容器之后，我们可以看到out提示符的变化。让我们试试我们容器里的东西。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="34e4" class="lr jm hi ln b fi ls lt l lu lv">$ ps</span></pre><figure class="li lj lk ll fd lx er es paragraph-image"><div class="er es mk"><img src="../Images/7f8b8e65eb38e6980f5cf82360a3075b.png" data-original-src="https://miro.medium.com/v2/resize:fit:518/format:webp/1*LjHWIYnLivFeaPIDt_mx3A.png"/></div></figure><p id="cf33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kr">这将给出在我们的容器上运行的流程。这里需要注意的重要一点是，只有两个进程在运行..ps只是由我来执行，另一个进程是针对我当前连接的bash shell的。<br/>因此，该进程的进程id为1，因为该进程没有其他父进程。</em></p><p id="19bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以在这上面尝试一些其他基本的Linux命令，比如</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="800c" class="lr jm hi ln b fi ls lt l lu lv">ls /</span><span id="7874" class="lr jm hi ln b fi mf lt l lu lv">ls /proc</span><span id="15d1" class="lr jm hi ln b fi mf lt l lu lv">mkdir /new_dir</span><span id="c850" class="lr jm hi ln b fi mf lt l lu lv">cd /new_dir</span></pre><p id="a2d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基本的Linux命令在这里工作良好…</p><p id="9867" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.让我们回到主题。我们的容器中需要<strong class="ih hj"> httpd </strong>和<strong class="ih hj"> python36 </strong>包。下载吧！</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="da20" class="lr jm hi ln b fi ls lt l lu lv">$ yum install httpd python36 -y</span></pre><figure class="li lj lk ll fd lx er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es ml"><img src="../Images/74f6f3ecfa0a339d3a9a4eeb594e280d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WJ5rjJ72x2dxkBi8WWeUbQ.png"/></div></div></figure><p id="4c55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.下载完成后，将目录切换到<strong class="ih hj"> /var/www </strong>，在<strong class="ih hj"> html/ </strong>文件夹中创建您的HTML文件，在<strong class="ih hj"> cgi-bin/ </strong>文件夹中创建CGI文件。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="6e1f" class="lr jm hi ln b fi ls lt l lu lv">$ cd /var/www/<br/>$ vi html/index.html<br/>$ vi cgi-bin/index.py</span></pre><p id="8aa9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的看起来像这样…</p><figure class="li lj lk ll fd lx er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es ml"><img src="../Images/c94f37402cff3d9a2099bdd9d1a5684a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fXWCPtEqdRXGb5LeMpN3PA.png"/></div></div></figure><p id="c0ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.现在一切都完成了..让我们启动我们的web服务器…但是由于在这个容器中启动的第一个进程是<em class="kr"> bash </em>并且没有其他父进程，这意味着这里没有<em class="kr"> systemd </em>来启动我们的<em class="kr"> httpd </em>。</p><p id="7c6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以我们必须通过调用httpd可执行二进制文件来手动完成。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="e3f0" class="lr jm hi ln b fi ls lt l lu lv">$ /usr/sbin/httpd</span></pre><figure class="li lj lk ll fd lx er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mm"><img src="../Images/2dc8c1dc5634b1eb93ae6195af9e4b96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BQ41yFBzFkSAz66ccADxmw.png"/></div></div></figure><p id="ce7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kr">(记下给定的ip地址)</em></p><p id="814f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是时候查看我们的网页了…</p><p id="c856" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我从容器内部检查它(localhost)。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="47e2" class="lr jm hi ln b fi ls lt l lu lv">$ curl localhost </span></pre><figure class="li lj lk ll fd lx er es paragraph-image"><div class="er es mn"><img src="../Images/236469023c666493205bbe4361b16458.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*WXFoohPf5ihmam7gOu4Lzg.png"/></div></figure><p id="04c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将给我<em class="kr">index.html</em>页面的内容。如果你不知道旋度，去这里(<a class="ae jd" href="https://en.wikipedia.org/wiki/CURL" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/CURL</a>)。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="3f69" class="lr jm hi ln b fi ls lt l lu lv">$ curl localhost/cgi-bin/index.py</span></pre><figure class="li lj lk ll fd lx er es paragraph-image"><div class="er es mo"><img src="../Images/7a15d0e17f43b642c1ff321dccb94ce9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*R9sgEKfso3J1uJEV2iWr-Q.png"/></div></figure><p id="ce5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是给我一些<strong class="ih hj"> 500内部服务器错误。</strong></p><p id="9843" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是因为我们还没有让我们的CGI脚本执行，由于这个原因，我们的网络服务器不能正确处理，并抛出一个内部服务器错误。</p><p id="1825" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">CGI脚本中的内部服务器错误也可能由于其他原因而增加..比如没有给出HTTP响应的正确格式(没有在头和正文之间给出空行，或者由于不正确的头或者根本没有头)。</p><p id="8ab0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请确保在继续之前检查所有这些内容…</p><figure class="li lj lk ll fd lx er es paragraph-image"><div class="er es mp"><img src="../Images/b919369f4e9fc89df2b0a54b6e44ed26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*ptYTxs0rrHqvpUzdjIha0w.png"/></div></figure><p id="510d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在它运行良好..从我的主机操作系统检查的时间到了(rhel7)..</p><figure class="li lj lk ll fd lx er es paragraph-image"><div class="er es mq"><img src="../Images/6155f348f1af19dc2d5f498d2e4544bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*7XNYkmEfUX0VzA4Y2E3mNw.png"/></div></figure><p id="9264" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我也可以从这里访问网页..但是我无法从主机操作系统外部访问我的docker服务器。</p><figure class="li lj lk ll fd lx er es paragraph-image"><div class="er es mr"><img src="../Images/d6f02b8153952aa1964cbe9459885fff.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*ZPj7Q9mk49Cg-c2ZyAtuyQ.png"/></div></figure><p id="d358" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们将docker端口映射到rhel7端口，并使用rhel7访问docker服务，就可以解决这个问题。<br/>喜欢..</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="7a9d" class="lr jm hi ln b fi ls lt l lu lv">http://&lt;rhel7_ip&gt;:&lt;mapped_port&gt;/index.html</span></pre></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><p id="f7bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以上步骤已经让您了解了如何将应用程序托管到docker容器中。现在让我们使用Dockerfile文件将其自动化。</p><p id="f0f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.创建一个文件夹来保存所有必需的代码文件、图像和其他资产以及docker文件。<br/> <em class="kr">(我创建了一个文件夹punchingbag_cgi) </em></p><figure class="li lj lk ll fd lx er es paragraph-image"><div class="er es ms"><img src="../Images/97796ca42d26af6825738ccb22f8c6f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*217gca7hhNrDm8oHFp3aQg.png"/></div></figure><p id="619c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.像这样创建你的docker文件。</p><figure class="li lj lk ll fd lx er es paragraph-image"><div class="er es mt"><img src="../Images/db2efa42c78ec29b568c3e5730ec32c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*4l8i64Yi0dilV76a6LZrJQ.png"/></div></figure><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="8292" class="lr jm hi ln b fi ls lt l lu lv">FROM centos:7</span></pre><p id="6ece" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这告诉了用于容器的基本操作系统。如果您的系统本地没有这个文件，那么docker文件本身会在构建时下载它。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="1488" class="lr jm hi ln b fi ls lt l lu lv">RUN yum update -y &amp;&amp; yum install httpd python36 -y &amp;&amp; yum clean all -y</span></pre><p id="15b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将运行一个命令来更新系统并安装httpd和python36包。稍后，它为yum清除缓存。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="0024" class="lr jm hi ln b fi ls lt l lu lv">COPY ./cgi-bin/ /var/www/cgi-bin/<br/>COPY ./html/index.html /var/www/html/</span></pre><p id="683b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些将所需的文件从源文件(RHEL7)复制到容器中。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="665c" class="lr jm hi ln b fi ls lt l lu lv">RUN chmod -R +x /var/www/cgi-bin/</span></pre><p id="0d23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这通过向权限(+x)添加可执行位，递归地(-R)改变了cgi-bin/ directory中所有文件的模式。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="3eb0" class="lr jm hi ln b fi ls lt l lu lv">EXPOSE 80</span></pre><p id="038b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">显示将用于与主机操作系统进行映射的端口号。此端口由容器内的httpd服务器使用。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="2459" class="lr jm hi ln b fi ls lt l lu lv">CMD [“/usr/sbin/httpd”, “-D”, “FOREGROUND”]</span></pre><p id="470b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将调用httpd二进制文件来执行。如果你对前景感到困惑，那么阅读<a class="ae jd" href="https://serverfault.com/questions/614348/confused-about-dforeground-with-apache" rel="noopener ugc nofollow" target="_blank">这篇</a>来消除你的疑惑。<br/> <br/> <br/>我们的docker文件终于完成了…现在我们将使用它来构建我们的自定义图像..</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="6c5e" class="lr jm hi ln b fi ls lt l lu lv">$ docker build -t “mywebserver:v1” .</span></pre><figure class="li lj lk ll fd lx er es paragraph-image"><div class="er es mh"><img src="../Images/c4b96ce407559b80471ee3b0c863f601.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*FCzmv_1a3WimqwPKLbzFPQ.png"/></div></figure><p id="fa84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">构建自定义映像后，我们可以使用该映像启动我们的容器，映射端口，为其命名，并执行其他特定于容器的任务..</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="08f4" class="lr jm hi ln b fi ls lt l lu lv">$ docker run -d -p 8001:80 — name web01 mywebserver:v1<br/>$ docker run -d -p 8002:80 mywebserver:v1</span></pre><figure class="li lj lk ll fd lx er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es ml"><img src="../Images/9f4e7903fe177f3c14e253059a157437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iyJSZOM2g_vqeUKK4qDiDw.png"/></div></div></figure><p id="cd08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查看您系统中的容器列表..您应该有(至少)2个容器在运行。</p><p id="eda5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个具有动态酷名，另一个具有指定名称“web01”。</p><p id="c0b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，由于端口映射，现在web服务在主机之外也是可用的。</p><figure class="li lj lk ll fd lx er es paragraph-image"><div class="er es mu"><img src="../Images/65941735a86b5496005dab028f0b772c.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*JPwFdcgejmwH0hY_SdfqFQ.png"/></div></figure><p id="60bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，您有了dockerized web应用程序，可以移植到任何部署环境。</p></div></div>    
</body>
</html>