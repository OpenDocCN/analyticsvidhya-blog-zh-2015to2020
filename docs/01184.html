<html>
<head>
<title>Health Recommender System Using PySpark in an Hour</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一小时内使用PySpark的健康推荐系统</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/health-recommender-system-aceb558ed487?source=collection_archive---------3-----------------------#2019-10-07">https://medium.com/analytics-vidhya/health-recommender-system-aceb558ed487?source=collection_archive---------3-----------------------#2019-10-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/72526c8554ba0dcc2d274c1f173a71a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f3XcC8pFLAHlNMAHLw_01A.png"/></div></div></figure><p id="cee0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">机器学习使组织能够利用现有数据来开发具有商业价值的模型，并做出更好的决策。机器学习中使用的技术之一是推荐系统。推荐系统是利用大量数据来利用数据的潜在模式和关系的强大方法。推荐系统的常见用例包括基于用户和其他类似用户过去的兴趣和偏好来确定向用户显示哪些广告、产品、电影、工作和项目。</p><p id="24c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有几种类型的推荐系统，即:</p><ul class=""><li id="d4de" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">基于内容的遥感</li><li id="ad18" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">基于流行度的RS</li><li id="5366" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">基于粗糙集的关联规则挖掘</li><li id="fc6a" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">基于协同过滤的粗糙集</li><li id="ba0f" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">混合遥感</li></ul><h2 id="5c97" class="kc kd hi bd ke kf kg kh ki kj kk kl km jb kn ko kp jf kq kr ks jj kt ku kv kw bi translated">基于内容的遥感</h2><p id="66ff" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">基于内容的RS通过计算相似性分数，基于感兴趣项目与过去匹配用户简档的项目的相似性，基于感兴趣项目的相似性来进行推荐。这是通过为每个项目创建项目配置文件来实现的，最常见的是通过它们的属性。可以使用像欧几里德距离和余弦相似性这样的技术来确定相似性得分。</p><h2 id="bbc2" class="kc kd hi bd ke kf kg kh ki kj kk kl km jb kn ko kp jf kq kr ks jj kt ku kv kw bi translated">基于流行度的RS</h2><p id="633d" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">推荐系统最简单的入门方法之一，基于流行度的推荐系统根据每个项目的流行度进行推荐。因此，这意味着对所有用户的推荐是相同的。</p><h2 id="1126" class="kc kd hi bd ke kf kg kh ki kj kk kl km jb kn ko kp jf kq kr ks jj kt ku kv kw bi translated">基于粗糙集的关联规则挖掘</h2><p id="305d" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">这些RS分析数据，以得出关联规则，并据此提出他们的建议。</p><h2 id="f11a" class="kc kd hi bd ke kf kg kh ki kj kk kl km jb kn ko kp jf kq kr ks jj kt ku kv kw bi translated">基于协同过滤的粗糙集</h2><p id="da79" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">协同过滤通过检查用户与项目的交互来实现。这可以是用户喜欢/观看/购买/观看的电影、产品和歌曲等。关键是基于物品交互确定最像当前用户的用户，并对最相似用户感兴趣的那些东西进行推荐。用户及其交互存储在用户项目矩阵中。</p><p id="4e00" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用户项目矩阵是稀疏的，因为大多数用户不会与项目交互，矩阵中的值通常表示反馈值。这些反馈值可以被明确地确定(例如通过让用户对电影、歌曲等进行评级)。)或隐含地(例如，基于用户观看和/或购买的项目来确定推荐哪些产品)。</p><p id="994a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">两种类型的协同过滤是最近邻协同过滤和潜在因素协同过滤。最近邻协同过滤试图找到k个与当前用户最相似的用户，并通过预测用户喜欢推荐的可能性来进行推荐。推荐可以是基于项目的，也可以是基于用户的，在基于项目的推荐中，我们寻找k个最近的项目，在基于用户的推荐中，我们寻找k个最近的用户。</p><p id="9329" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">潜在因素协同过滤使用矩阵分解来分解用户项目矩阵，以创建两个较小的潜在因素矩阵。潜在因素的确定是通过ALS(交替最小二乘法)等优化技术实现的。</p><h2 id="0074" class="kc kd hi bd ke kf kg kh ki kj kk kl km jb kn ko kp jf kq kr ks jj kt ku kv kw bi translated">混合遥感</h2><p id="65eb" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">混合推荐系统结合了各种RS技术来提出它们的预测。</p><h1 id="4f0f" class="lc kd hi bd ke ld le lf ki lg lh li km lj lk ll kp lm ln lo ks lp lq lr kv ls bi translated">健康诊断推荐系统</h1><p id="e59c" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">正在开发的系统将通过RESTful API公开协作过滤RS。机器学习模型将利用潜在因素协同过滤，并使用PySpark使用ALS来实现。开发将包括多个步骤，即数据加载、特征工程、数据可视化、模型创建、模型测试和模型评估。</p><h2 id="d3af" class="kc kd hi bd ke kf kg kh ki kj kk kl km jb kn ko kp jf kq kr ks jj kt ku kv kw bi translated">数据加载</h2><p id="20e4" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">数据由三个文件组成:一个包含症状并存储它们的Id (syd)和名称(症状)。另一个包含诊断并存储它们的Id (did)和它们的名称(diagnose ),而第三个包含症状-诊断稀疏矩阵，该矩阵包含症状id (syd)、疾病id (did)和症状-疾病权重(wei)。这三个文件都是CSV格式的。</p><p id="f929" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，创建一个spark会话，然后加载每个文件中的数据。各种文件的前几个内容用下面的代码显示:</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/b5aabbcff672dc2c6ca708db7ce39bc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rheTLSq8L_rpMbhM3coenQ.png"/></div></div></figure><p id="0782" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这会产生以下输出:</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/6dc0020f7c8b75fcc6d2d706d06585bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o0rNq7ws-wZl4dz2OF2qig.png"/></div></div></figure><h2 id="61f2" class="kc kd hi bd ke kf kg kh ki kj kk kl km jb kn ko kp jf kq kr ks jj kt ku kv kw bi translated">特征工程</h2><p id="32ec" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">特征工程关注的是特征提取和特征简化。特征提取我们关心将非数字数据转换成连续值。从数据中，我们需要转换症状和疾病名称。</p><p id="9163" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们创建一个症状索引，对其进行编码并创建一个向量。疾病名称也是如此。这是通过如下方式实现的:</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/d1aa5bf2fdeff98ea0d328c30ddb6f5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1AAoIpR_m393dQ1SpwNRQw.png"/></div></div></figure><p id="b259" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">产生以下输出:</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ma"><img src="../Images/181d7f053c7789e8a15e61f282cbb28c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NorhO3iFbpM_n4FozEmcUQ.png"/></div></div></figure><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/1eebe0896fcf3ec7b3145b79c7b38cda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e6xDw67TBIHoriqlm-h2PQ.png"/></div></div></figure><p id="ae26" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">获得矢量后，通过缩放将它们标准化，并组合成如下所示的特征矢量:</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/6f1706f7486282f950d5076e360a0bf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C2TIUxFWUthBWN4UUPBQdw.png"/></div></div></figure><p id="0cab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这会产生以下输出:</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/28f55985a9836572d99c0408e4cd9dea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0BTs0hW5C6epjL1UX5MlGQ.png"/></div></div></figure><p id="5ed5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">聚类是按顺序应用的，导致添加了一个预测列，如下所示:</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/223aea9b0b0e82b0c9b16c17235c1d6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A40TOYcCObGpl8cWSeYmSw.png"/></div></div></figure><p id="7d0e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这会产生以下输出:</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/5f3d7d8f160609b092d36b33bef3c9dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kkfd-rSUuZTXmgraEmXSUA.png"/></div></div></figure><p id="c09b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，使用主成分分析(PCA)对特征进行特征约简，以使数据更容易可视化。</p><h2 id="b0fc" class="kc kd hi bd ke kf kg kh ki kj kk kl km jb kn ko kp jf kq kr ks jj kt ku kv kw bi translated">数据可视化</h2><p id="7770" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">然后可以将数据可视化为探索性数据分析(EDA)的一部分。特征约简使人们能够在2D上表示高度复杂的数据，这有助于确定数据中包含的模式和趋势。这可以通过如下方式实现:</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/45760bfc79f334cdf87a9b54a8122468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FevTbqreI5NzhAUTFWXIOw.png"/></div></div></figure><p id="4961" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它会产生以下输出:</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/912eae58303928f1db199b921908f49c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gkzOvaRO3iiI56_PeAj85Q.png"/></div></div></figure><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/428fa2748946d7379f6a3a578121a164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DaWupXC-l_J4q1-kpwR5ew.png"/></div></div></figure><p id="7f8f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可视化清楚地显示了不同的集群，这是在疾病的不同性质、受影响的生理系统和表现出的症状的情况下所期望的。</p><h2 id="af00" class="kc kd hi bd ke kf kg kh ki kj kk kl km jb kn ko kp jf kq kr ks jj kt ku kv kw bi translated">模型创建</h2><p id="cc90" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">对于模型创建，分类后添加的预测列被删除，数据集被拆分为定型数据集和测试数据集。利用ALS的推荐器用于创建模型，然后在训练数据集上训练该模型，如下所示:</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/c1c0a810fa203331692c991f1f471b59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ad293qzHZjWoA2twMAGdWg.png"/></div></div></figure><h2 id="f1ef" class="kc kd hi bd ke kf kg kh ki kj kk kl km jb kn ko kp jf kq kr ks jj kt ku kv kw bi translated">模型测试和评估</h2><p id="d5d7" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">使用测试数据对模型进行测试，并使用均方根误差(RMSE)对模型做出的预测进行评估，如下所示:</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/cc852b96b6c2e9dc6700d9b73a90f999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0VX3el1FVc3vKViWPbbFbg.png"/></div></div></figure><p id="2c92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">RMSE为0.81886，模型训练和测试的输出如下所示:</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/7931b02ea5044f07528a7fd0d63dadcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vS-v1SleckE06L2tFSat9w.png"/></div></div></figure><h2 id="24ab" class="kc kd hi bd ke kf kg kh ki kj kk kl km jb kn ko kp jf kq kr ks jj kt ku kv kw bi translated">获得建议</h2><p id="40ad" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">在这种情况下，建议将是给定症状的疾病诊断。健康护理人员可以使用这些建议缩小可能性，或者使用这些建议进一步通知决策制定。这是通过提供症状id和检查推荐的疾病来实现的。该模型的应用示例如下所示:</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/042709b29da34d6a358d526566e2e877.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hsm8mxE5z1AhYxYBOsbejg.png"/></div></div></figure><p id="9ea7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这会产生以下输出:</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/72526c8554ba0dcc2d274c1f173a71a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f3XcC8pFLAHlNMAHLw_01A.png"/></div></div></figure><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/5ae7021939c2f2b99e2afba47ad924bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dcKuZ-m93rnixN0pHnpM8A.png"/></div></div></figure><p id="0585" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步是创建一个RESTful API，通过API调用访问模型。</p><p id="9a66" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢您的参与，敬请关注。</p></div></div>    
</body>
</html>