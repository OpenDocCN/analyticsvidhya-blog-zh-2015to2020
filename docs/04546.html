<html>
<head>
<title>The Modern C++ Challenge on Mobile — The First Problem</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">移动设备上的现代C++挑战——第一个问题</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/the-modern-c-challenge-on-mobile-the-first-problem-993a49c9cb4d?source=collection_archive---------22-----------------------#2020-03-23">https://medium.com/analytics-vidhya/the-modern-c-challenge-on-mobile-the-first-problem-993a49c9cb4d?source=collection_archive---------22-----------------------#2020-03-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5e2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你好！我是Xavier Jouvenot，这是关于<a class="ae jd" href="https://amzn.to/2QdYmvA" rel="noopener ugc nofollow" target="_blank">现代C++挑战</a>的系列文章的第一部分。在这篇文章中，我将解释我如何在C++中解决第一个问题，以及我如何在一个Android项目中集成该解决方案。</p><p id="6d12" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一个问题的目标很简单。我们必须计算所有可被3或5整除的自然数的和，直到用户给定的某个极限，并且我们必须打印它。该解决方案将在C++中计算，获取用户输入和显示结果的界面将由Android Studio框架处理。</p><h1 id="5baf" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">C++解决方案</h1><p id="45dd" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">正如你可能已经在我之前关于用C++ 安装<a class="ae jd" href="https://10xlearner.com/2020/03/16/setting-up-android-studio-with-c-on-windows/" rel="noopener ugc nofollow" target="_blank"> Android Studio的博文中看到的。我们可以在Android Studio中使用C++17，所以这就是我要用的。😉</a></p><p id="478e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我开始Android开发之旅时，我已经将我的解决方案直接集成到Android Studio默认创建的文件<code class="du kh ki kj kk b">native-lib.cpp</code>中。这是这个函数的样子:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="54c3" class="kt jf hi kk b fi ku kv l kw kx">[[nodiscard]] constexpr auto sumOf3and5MultipleUpTo(const unsigned int limit) {<br/>  size_t sum = 0;<br/>  for(auto number = limit; number &gt;= 3; --number) {<br/>    if(number % 3 == 0 || number % 5 == 0) { sum += number; }<br/>  }<br/>  return sum;<br/>}</span></pre><p id="a3db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们仔细看看这个函数，以确保我们都了解它是如何工作的，以及为什么会这样。首先，让我们看看原型和它给我们的信息:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="0756" class="kt jf hi kk b fi ku kv l kw kx">[[nodiscard]] constexpr auto sumOf3and5MultipleUpTo(const unsigned int limit)</span></pre><p id="5e06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个函数是<a class="ae jd" href="https://en.cppreference.com/w/cpp/language/constexpr" rel="noopener ugc nofollow" target="_blank"> constexpr </a>，因为如果我们愿意，计算可以在编译时执行。返回类型由<a class="ae jd" href="https://en.cppreference.com/w/cpp/language/auto" rel="noopener ugc nofollow" target="_blank"> auto </a>关键字自动推导。它也作为属性<a class="ae jd" href="https://en.cppreference.com/w/cpp/language/attributes/nodiscard" rel="noopener ugc nofollow" target="_blank"> [[nodiscard]] </a>表示该函数的结果必须被程序使用。最后，我们有一个输入，它是一个正自然数，因为它的类型是<code class="du kh ki kj kk b">unsigned int</code>。</p><p id="0d8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该函数定义的一个限制是输入不应超过类型<code class="du kh ki kj kk b">unsigned int</code>的限制<code class="du kh ki kj kk b">4294967295</code>。这个限制可以通过使用<code class="du kh ki kj kk b">size_t</code>或大整数实现来克服，但是，我现在不知道如何将这些类型链接到Android框架。😝</p><p id="6aaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在原型之后，该函数为计算结果声明并初始化变量:</p><p id="1e98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个<code class="du kh ki kj kk b">size_t</code>变量，以确保我们可以存储尽可能多的数字，直到<code class="du kh ki kj kk b">18446744073709551615</code>。如果我们想得到更大的数字，我们必须使用大整数实现。</p><p id="f391" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们有结果的计算:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="e753" class="kt jf hi kk b fi ku kv l kw kx">for(auto number = limit; number &gt;= 3; --number) {<br/>  if(number % 3 == 0 || number % 5 == 0) {<br/>    sum += number;<br/>  }<br/>}</span></pre><p id="fc1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">循环从用户给定的极限下降到<code class="du kh ki kj kk b">3</code>。不需要检查到<code class="du kh ki kj kk b">0</code>，因为<code class="du kh ki kj kk b">1</code>和<code class="du kh ki kj kk b">2</code>都不能被<code class="du kh ki kj kk b">3</code>或<code class="du kh ki kj kk b">5</code>整除，即使<code class="du kh ki kj kk b">0</code>能被它们整除，把<code class="du kh ki kj kk b">0</code>加到一个和上也不会改变结果。</p><p id="fd4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用<code class="du kh ki kj kk b">number % 3 == 0</code>检查数字是否能被<code class="du kh ki kj kk b">3</code>整除，用<code class="du kh ki kj kk b">number % 5 == 0</code>检查数字是否能被<code class="du kh ki kj kk b">5</code>整除。如果其中一个检查为真，我们将该数字添加到当前计算机<code class="du kh ki kj kk b">sum</code>。</p><p id="214f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们返回结果:</p><p id="8d24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以下面是我对这个问题的解决方案，我们来看看Android Studio中的界面是怎么做的。</p><h1 id="6811" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">Android Studio上的用户界面</h1><p id="334a" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">由于这是这个应用程序目前解决的唯一问题，我们的应用程序上只有一个屏幕，所以我在Android Studio默认创建的文件<code class="du kh ki kj kk b">activity_main.xml</code>中直接指定了UI元素。</p><p id="e146" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">声明:由于我只是开始了我的Android Studio和移动开发之旅，我在这里和未来的帖子中所学到的东西对你来说可能是微不足道的。甚至可能有比我个人的解决方案更好的方法来完成同样的事情。如果你心中有任何这些方法，请在评论中告诉我，以便我可以提高自己。先谢谢你了🙂</p><p id="171d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了创建我们的UI，我们需要两种元素:<a class="ae jd" href="https://developer.android.com/reference/android/widget/TextView" rel="noopener ugc nofollow" target="_blank">文本视图</a>和<a class="ae jd" href="https://developer.android.com/reference/android/widget/EditText" rel="noopener ugc nofollow" target="_blank">编辑文本</a>。<code class="du kh ki kj kk b">EditText</code>将允许用户给我们输入，<code class="du kh ki kj kk b">TextView</code>将允许我们向用户显示结果。这些元素的xml如下所示:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="c782" class="kt jf hi kk b fi ku kv l kw kx">&lt;TextView android:id="@+id/result" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Result:" app:layout_constraintBottom_toBottomOf="parent" app:layout_constraintLeft_toLeftOf="parent" app:layout_constraintRight_toRightOf="parent" app:layout_constraintTop_toTopOf="parent" /&gt; &lt;EditText android:id="@+id/plain_text_input" android:layout_height="wrap_content" android:layout_width="match_parent" android:inputType="number" android:hint="Please enter a number." app:layout_constraintBottom_toBottomOf="parent" app:layout_constraintHorizontal_bias="0.498" app:layout_constraintLeft_toLeftOf="parent" app:layout_constraintRight_toRightOf="parent" app:layout_constraintTop_toTopOf="parent" app:layout_constraintVertical_bias="0.4" android:autofillHints="" /&gt;</span></pre><p id="9faa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们更深入地挖掘这些元素。</p><p id="65ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先是<code class="du kh ki kj kk b">EditText</code>。它有一个<code class="du kh ki kj kk b">android:id</code>属性，指定了一个id，当我们需要在<code class="du kh ki kj kk b">EditText</code>中获得用户输入时，这个id会很有用。属性<code class="du kh ki kj kk b">android:inputType</code>被设置为<code class="du kh ki kj kk b">number</code>，这迫使用户将数字输入到<code class="du kh ki kj kk b">EditText</code>中。最后，我想告诉你的最后一个属性是属性<code class="du kh ki kj kk b">android:hint</code>，当<code class="du kh ki kj kk b">EditText</code>为空时，它显示一个文本来给用户一个指令或消息</p><p id="1fbc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们来看看<code class="du kh ki kj kk b">TextEdit</code>。像<code class="du kh ki kj kk b">EditText</code>一样，它有一个<code class="du kh ki kj kk b">android:id</code>属性，指定一个id，当需要显示cpp算法找到的结果时，这个id会很有用。我们还有属性<code class="du kh ki kj kk b">android:text</code>，它是显示给用户的<code class="du kh ki kj kk b">TextView</code>的文本。这是我们将用C++中的计算结果来修改的属性。目前，它只显示“结果:”。</p><p id="7ddb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们不会关注其他元素，因为它们与这篇博文的目的无关，因为它们主要指定了元素的维度和位置。</p><h1 id="76d5" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">使用C++本机代码</h1><p id="4a46" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">为了链接和使用我们之前创建的C++函数，我们需要做几件事情。首先，我们需要在C++文件中声明我们希望程序的其余部分可以访问的内容。它看起来像下面的代码:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="7222" class="kt jf hi kk b fi ku kv l kw kx">extern "C" JNIEXPORT jstring JNICALL<br/>Java_com_example_themoderncppchallenge_MainActivity_Sum3And5Multiples(JNIEnv* env, jobject /* this */, const jint i) {<br/>  auto sum = sumOf3and5MultipleUpTo(i);<br/>  return env-&gt;NewStringUTF(std::to_string(sum).c_str());<br/>}</span></pre><p id="4268" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个代码示例定义了一个在Java中使用的函数<code class="du kh ki kj kk b">Sum3And5Multiples</code>。该函数接受一个<code class="du kh ki kj kk b">jint</code> in参数，该参数将是用户的输入，将该参数传递给out C++函数，并获得计算结果，然后将其作为字符串返回。下面是这个函数的原型在Java代码中的样子:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="c35e" class="kt jf hi kk b fi ku kv l kw kx">public native String Sum3And5Multiples(int i);</span></pre><p id="1e33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们看看在用<code class="du kh ki kj kk b">Edit Text</code>获得用户输入后，如何使用该函数在<code class="du kh ki kj kk b">Text View</code>中显示结果。因为我们的应用程序目前只解决了一个问题，所以这段代码直接写在<code class="du kh ki kj kk b">MainActivity.java</code>文件内的方法<code class="du kh ki kj kk b">MainActivity::onCreate</code>中。它看起来是这样的:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="4050" class="kt jf hi kk b fi ku kv l kw kx">EditText et = findViewById(R.id.plain_text_input);<br/>et.addTextChangedListener(new TextWatcher() {<br/>  @Override<br/>  public void beforeTextChanged(CharSequence s, int start, int count, int after) { }</span><span id="5e28" class="kt jf hi kk b fi ky kv l kw kx">  @Override<br/>  public void onTextChanged(CharSequence s, int start, int before, int count) {<br/>    int limit = 0;<br/>    if(count != 0) {<br/>      limit = Integer.parseInt(s.toString());<br/>    }<br/>    TextView tv = findViewById(R.id.result); tv.setText("Result: " + Sum3And5Multiples(limit));<br/>  }</span><span id="6b68" class="kt jf hi kk b fi ky kv l kw kx">  @Override<br/>  public void afterTextChanged(Editable s) { }<br/>});</span></pre><p id="13e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这段代码中，我们通过使用它的Id获得了<code class="du kh ki kj kk b">EditText</code>，并在它的文本上附加了一个监听器。</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="6232" class="kt jf hi kk b fi ku kv l kw kx">EditText et = findViewById(R.id.plain_text_input); et.addTextChangedListener(new TextWatcher() {</span></pre><p id="1a90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们指定当<code class="du kh ki kj kk b">EditText</code>内的文本改变时，当用户修改输入时，我们要做什么。我们首先检查是否有输入要获取，如果没有，我们计算<code class="du kh ki kj kk b">0</code>的总和作为输入。</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="909b" class="kt jf hi kk b fi ku kv l kw kx">int limit = 0;<br/>if(count != 0) {<br/>  limit = Integer.parseInt(s.toString());<br/>}</span></pre><p id="d6b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们有了用户的输入，我们就得到了<code class="du kh ki kj kk b">TextView</code>。最后，我们调用C++方法并显示其结果。</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="25b6" class="kt jf hi kk b fi ku kv l kw kx">TextView tv = findViewById(R.id.result);<br/>tv.setText("Result: " + Sum3And5Multiples(limit));</span></pre><p id="69e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">瞧，我们已经把一切都链接到一个程序中，解决了现代C++挑战的第一个问题<a class="ae jd" href="https://amzn.to/2QdYmvA" rel="noopener ugc nofollow" target="_blank">。我个人加了一些<code class="du kh ki kj kk b">TextView</code>给用户更多的信息。这是它的样子:</a></p><h1 id="1cb0" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">结论</h1><p id="674a" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">Android Studio中的第一个问题和第一个真正的程序对我来说是一次很好的学习经历。我真的学到了很多关于Android Studio的知识，以及原生C++程序的不同部分是如何工作的。</p><p id="230e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我知道我有很多东西要学，我很兴奋地学习它，就像我喜欢学习我在这篇文章中揭示的东西一样🙂请告诉我，如果你有任何建议或意见，对一些内容或对我提出的解决方案。</p><p id="9705" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢大家阅读这篇文章，直到我的下一篇文章，有一个精彩的一天😉</p><h1 id="3679" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">有趣的链接</h1><p id="899f" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">- <a class="ae jd" href="https://en.cppreference.com/w/cpp/language/constexpr" rel="noopener ugc nofollow" target="_blank"> constexpr文档</a></p><p id="1cd4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">- <a class="ae jd" href="https://developer.android.com/reference/android/widget/TextView" rel="noopener ugc nofollow" target="_blank">文本视图文档</a></p><p id="fb2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">- <a class="ae jd" href="https://developer.android.com/reference/android/widget/EditText" rel="noopener ugc nofollow" target="_blank">编辑文本文档</a></p><p id="6b1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">- <a class="ae jd" href="https://github.com/Xav83/TheModernCppChallenge_AndroidStudio/releases/tag/v0.0.1_FirstProblem" rel="noopener ugc nofollow" target="_blank"> GitHub完整解决方案</a></p></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><p id="2ba5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lg">原载于2020年3月23日http://10xlearner.com</em><a class="ae jd" href="https://10xlearner.com/2020/03/23/the-modern-c-challenge-on-mobile-the-first-problem/" rel="noopener ugc nofollow" target="_blank"><em class="lg"/></a><em class="lg">。</em></p></div></div>    
</body>
</html>