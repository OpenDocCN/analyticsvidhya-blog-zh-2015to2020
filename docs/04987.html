<html>
<head>
<title>ESP8266 — Python Connection in Arduino Based System</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ESP8266 —基于Arduino的系统中的Python连接</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/esp8266-python-connection-in-arduino-based-system-5d4a308bd79b?source=collection_archive---------8-----------------------#2020-04-07">https://medium.com/analytics-vidhya/esp8266-python-connection-in-arduino-based-system-5d4a308bd79b?source=collection_archive---------8-----------------------#2020-04-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9deb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的<a class="ae jd" rel="noopener" href="/@imlent/esp8266-arduino-connection-and-first-setup-be24171d8923"> <strong class="ih hj">上一篇文章</strong> </a>中，我解释了如何用<strong class="ih hj"> Arduino UNO </strong>连接和设置AT命令<strong class="ih hj"> ESP8266 </strong>。</p><p id="e075" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我正在给另一个烧结方案布线<strong class="ih hj"> ESP8266 </strong>到<strong class="ih hj"> Arduino。</strong>我们将自动设置我们的WiFi模块，这就是我们要改变接线方式的原因。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/e9d532b287b48e2cacdb589175b1cc76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ReGWYrU1yaxxMixPyImQA.png"/></div></div></figure><p id="b9f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将为新方案增加3个电阻。我们这样做是因为我们想稳定我们的电源系统和<strong class="ih hj"> RX </strong>接收器。这些电阻可以是1k<strong class="ih hj">ω</strong>(在方案中它们是220<strong class="ih hj">ω</strong>因为我找不到1ks)。此外，我们将<strong class="ih hj"> RX </strong>和<strong class="ih hj"> TX </strong>引脚从0–1个数字引脚改为2–3个数字引脚。这种改变使我们能够与Python联系起来。所有草图和Python脚本都可以在<a class="ae jd" href="https://github.com/alicamdal/ESP8266---Python-Connection" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">这里</strong> </a> <strong class="ih hj">找到。</strong></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jq"><img src="../Images/2635357e814abbfdf015354cd631b788.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N8r0XHMrdFRdFBCh4YDaMw.png"/></div></div></figure><p id="ff51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开始时，我们将把我们的库(软件串行)导入到我们的草图中。然后我们必须从这个库中创建一个实例。上面可以看到的是espSerial。然后，我们需要我们的WiFi的SSID和密码，由<strong class="ih hj"> ESP8266 </strong>用于连接到WiFi。此外，我们有两个不同的字符串变量。那么我们应该以9600波特率开始我们的串行通信。这是我们的观点，我们看到有一个函数叫做“<strong class="ih hj"> espSetup </strong>”。当我们给系统通电时，此功能会自动设置我们的<strong class="ih hj"> ESP8266 </strong>。</p><p id="e6b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将通过7个步骤完成我们的设置。第一步是重置<strong class="ih hj"> ESP8266。</strong>然后，我们将在步骤2中使用【T36 AT命令测试连接。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jr"><img src="../Images/4315a5ffa6cc06a2916df349a8d2460e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RIKFppPrX63bZiIn4W7aNw.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">设置过程的前两步。</figcaption></figure><p id="2229" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我们在截图中看到的，有一个名为“<strong class="ih hj">计数器</strong>的变量。有了这个变量，我们将能够多次发送我们的命令，并且我们将确定它们。此外，我们还有另一个名为“<strong class="ih hj"> getResponse </strong>”的函数。</p><p id="cdc5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，我们会延迟多次发送命令。对于“<strong class="ih hj"> AT </strong>命令，我们将发送它直到计数器达到10。但是计数器的条件是在命令响应为<strong class="ih hj"> OK </strong>时找到10个成功的<strong class="ih hj">。我们可以通过“<strong class="ih hj"> espSerial.find </strong>”函数在<strong class="ih hj"> espSerial </strong>通讯上找到我们要找的东西。</strong></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jq"><img src="../Images/2ee50b7b551b8cddb766b1627f2c420c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p-drsHksyJ9LzLBp-PrTzg.png"/></div></div></figure><p id="7283" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们用<strong class="ih hj"> espSerial </strong>发送一个命令时，这个命令应该有一个响应。使用“<strong class="ih hj"> getResponse </strong>”功能，我们将看到这些响应。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jq"><img src="../Images/dcf0ced1c76d711f02f5ed8bd82065ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sr_xgqgaw9bK6s9i1P8ebQ.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">第3步和第4步</figcaption></figure><p id="d1b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在接下来的两步中。我们将设置站模式和WiFi连接。这里有一点很重要。我们应该在开始时更改<strong class="ih hj"> SSID </strong>和<strong class="ih hj">密码</strong>的定义。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jw"><img src="../Images/e9f713492ef1785853ce71fe296f7fd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LnNFbd-DmA3biQU76mgyXg.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">第5步和第6步</figcaption></figure><p id="c0a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在第5步和第6步中，我们将找到我们设备的IP地址，并启用多个连接设置。有了多重连接设置，我们可以通过Python访问我们的设备。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jw"><img src="../Images/2f6a3c13b32664121b006c9cb9c9f123.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zlOWDAE-qvd-dP95po3r1w.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">第七步</figcaption></figure><p id="ccef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后但同样重要的是。在第7步中，我们设置设备的服务器设置及其端口。这一步结束后，我们完成了设置。如果您在执行这些步骤时遇到错误，请随时发表评论。否则，恭喜你有一个可以自动设置<strong class="ih hj"> ESP8266 </strong>的功能。</p><p id="9764" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们需要通过我们的系统和Python来获取消息。为此，我们必须准备Arduino的循环功能。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jw"><img src="../Images/336715657624189e8eadf08c16b19e7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MQoVp2975mpYkCnyAjpMiw.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">循环功能</figcaption></figure><p id="e6a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们知道这个函数永远有效。因此，我们需要为我们的消息定义一个变量。我们为他们准备了<strong class="ih hj"> msg </strong>。开始时，我们将"<strong class="ih hj"> fmsg </strong>"定义为一个全局变量，并通过它获得原始消息。然后我们要用"<strong class="ih hj"> getString </strong>函数。我创建了这个函数，因为如果您将原始消息打印到串行监视器，您会看到在您的串行监视器上有一些带有“<strong class="ih hj"> : </strong>”分隔符的垃圾数据。为了传递信息，我们必须除掉他们。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jw"><img src="../Images/cbadff58b19bab1727555d46e6f4365e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P_x7EIF7a6rg7S8XWBfVaw.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">getString函数</figcaption></figure><p id="8407" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">"<strong class="ih hj"> getString </strong>"函数接受1个参数，该参数是字符串"<strong class="ih hj"> flmsg </strong>"，该参数是我们的原始数据。正如我之前所说，在我们的原始数据中有一个分隔符。使用<strong class="ih hj"> for </strong>循环，我们将找到我们的分隔符，然后我们将得到我们真正的消息。我知道这个过程有一些内置函数。但是这些天我需要花些时间。</p><p id="dfe6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们Arduino端的最后一个功能。现在我们可以准备Python脚本了。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jw"><img src="../Images/bb493d05abc8acb7e5c0616aab30c53d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oT47HkSQapyfXwI-gYcUqA.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">Python连接脚本</figcaption></figure><p id="fbc7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我说“准备”，但它并不完全是准备。只有11排。首先我们需要"<strong class="ih hj"> socket </strong>库。这个模块为<strong class="ih hj"> Berkeley Socket API提供了一个接口。现在我们需要找到我们的IP和端口。如果您没有对设置进行任何更改，您可以使用显示的IP和端口设置进行连接。但是如果你改了，你可以用"<strong class="ih hj"> AT+CIFSR </strong>"命令找到它们。</strong></p><p id="1d6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj"> conn </strong>变量中，我们可以为“<strong class="ih hj"> socket </strong>”函数提供许多其他参数。但是<strong class="ih hj"> AF_INET </strong>地址族只需要一对IP和端口。这对我们来说足够了。</p><p id="742a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们用包含IP和端口的元组触发了“<strong class="ih hj"> connect </strong>函数。如果一切顺利，您将在Python空闲屏幕上看到“<strong class="ih hj">发送东西:</strong>”。您可以向<strong class="ih hj"> ESP8266 </strong>发送任何数据，除了“Q”和“Q”的单个字符。这些是我们退出的角色。</p><p id="ed3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，我准备了这个应用程序的一个例子，它在我的<a class="ae jd" href="https://github.com/alicamdal/ESP8266---Python-Connection" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> GitHub </strong> </a>中。可以在Python_Led_Connection文件夹下找到。在本例中，如果您在上键入<strong class="ih hj">，Arduino的内置led将会亮起。</strong></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jx"><img src="../Images/e171db6b077b41be379418076b8dc42a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GVL1kPqx4TWehNzBS_jbdA.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">一切正常</figcaption></figure><p id="5de5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">再见。</p></div></div>    
</body>
</html>