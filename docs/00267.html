<html>
<head>
<title>Anime recommendations by using Collaborative Filtering</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于协同过滤的动漫推荐</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/anime-recommendations-by-using-collaborative-filtering-e9b2220a0427?source=collection_archive---------1-----------------------#2019-02-09">https://medium.com/analytics-vidhya/anime-recommendations-by-using-collaborative-filtering-e9b2220a0427?source=collection_archive---------1-----------------------#2019-02-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="17d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这项研究旨在通过使用myanimelist用户评级向人们推荐动漫。推荐方法是频繁模式挖掘，使用的工具是Apache Spark。对于数据预处理，通过jupyter notebook使用Ptyhon-Pandas库。动漫不像电视剧或者电影那么受欢迎。所以，找到好的推荐就更难了。希望我的发现能帮助到某个人:)</p><h1 id="03cc" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">数据选择</h1><p id="7192" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">首先选择包含<a class="ae kg" href="https://myanimelist.net/" rel="noopener ugc nofollow" target="_blank"> myanimelist </a>用户分数的<a class="ae kg" href="https://www.kaggle.com/CooperUnion/anime-recommendations-database/version/1" rel="noopener ugc nofollow" target="_blank"> rating.csv </a>。这些列是:</p><p id="c932" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">user_id —不可识别的随机生成的用户id。</p><p id="1945" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">anime_id —用户已评级的动漫。</p><p id="a1ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">评级—用户指定的10分中的评级(如果用户观看了该视频但没有指定评级，则为1分)。</p><p id="45d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其次，选择anime.csv以从与rating.csv相同的来源获得类似电视、电影、OVA的动漫类型。最后，从<a class="ae kg" href="https://www.kaggle.com/azathoth42/myanimelist" rel="noopener ugc nofollow" target="_blank"> AnimeList.csv </a>中选择相关列。因为所有的数据都是从myanimelist中获取的，所以它们可以通过<em class="kh"> anime_id </em>属性相互连接。</p><h1 id="ddf8" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">数据预处理</h1><p id="6d5e" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">在这一部分，为规则挖掘算法准备数据。较低的评级和不重要的类型被丢弃，季节数据被合并。</p><h2 id="6e82" class="ki je hi bd jf kj kk kl jj km kn ko jn iq kp kq jr iu kr ks jv iy kt ku jz kv bi translated">A.扔掉</h2><p id="729a" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">首先，考虑较低的评分来做推荐是不合适的。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="ab fe cl lb"><img src="../Images/bca15e68150435e3d078d1e825888c5d.png" data-original-src="https://miro.medium.com/v2/format:webp/1*lRv-GnczrFfZw9of6-WGcA.png"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">图一。显示评分分布的直方图</figcaption></figure><p id="20b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了便于判断，绘制了上述直方图。如果用户不喜欢给一部动画评分，则使用“-1”值。但这并不意味着用户不喜欢它。因为如果人们太喜欢动漫，他们会给它打分。因此，考虑使用“-1”值。忽略“-1”，平均评级值为7.80。在这些过高的评分点中，0–5分可以忽略。总而言之，6-10分和-1分被视为不喜欢，0-5分被视为不喜欢。</p><h2 id="c39b" class="ki je hi bd jf kj kk kl jj km kn ko jn iq kp kq jr iu kr ks jv iy kt ku jz kv bi translated">B.类型过滤</h2><p id="9fea" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">一些类型的动画由几集组成，其中包括关于主要动画的故事。规则挖掘不能考虑它们。所以，OVA，ONA，音乐和特别的动漫必须放弃。类型数据和评级数据加入，除了电视或电影动画，所有数据被删除。也看到大部分掉的动漫都没有评级。因此，未分级的动画变得比以前更有价值。</p><h2 id="a761" class="ki je hi bd jf kj kk kl jj km kn ko jn iq kp kq jr iu kr ks jv iy kt ku jz kv bi translated">C.季节数据合并</h2><p id="484e" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">一部动漫每个不同的季节都有自己的anime_id。举个例子，美少女战士有五个季节和动漫id。</p><ul class=""><li id="3c88" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">美少女战士-530</li><li id="fcd2" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">美少女战士R -740</li><li id="b258" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">美少女战士S -532</li><li id="ca9a" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">美少女战士超级S -1239</li><li id="6f64" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">美少女战士水手之星-996</li></ul><p id="7b7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它们必须合并，否则，规则挖掘算法会互相推荐季节。在数据选择部分提到的<em class="kh">相关的</em>数据包括每个id的JSON。美少女战士R的一个简化例子是:</p><pre class="kw kx ky kz fd lw lx ly lz aw ma bi"><span id="8543" class="ki je hi lx b fi mb mc l md me">{'Prequel': [{'mal_id': 530, 'title': 'Bishoujo Senshi Sailor Moon'}],<br/>'Side story': [{'mal_id': 531, 'title': 'Bishoujo Senshi Sailor Moon R: The Movie'}],<br/>'Sequel': [{'mal_id': 532, 'title': 'Bishoujo Senshi Sailor Moon S'}],<br/>'Summary': [{'mal_id': 8756, ''title': 'Bishoujo Senshi Sailor Moon Memorial'}],<br/>'Alternative version': [{'mal_id': 14751, title': 'Bishoujo Senshi Sailor Moon Crystal'}]}</span></pre><p id="ded2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于JSON包含前传和续集的季节数据，可以用于合并。首先，通过Python的json库对json进行编辑，以获得可解析的JSON。通过使用“前传”功能，不仅电视连续剧，而且电影连续剧被合并。选择第一季或第一部电影来代表所有系列。写一个递归前传函数。这个函数通过递归使用前传数据给出第一项。</p><pre class="kw kx ky kz fd lw lx ly lz aw ma bi"><span id="32d4" class="ki je hi lx b fi mb mc l md me">def prequel(anime_id):<br/>    previous = None<br/>    try:<br/>        preJson = related[related["anime_id"] == anime_id].iloc[0]<br/>    except IndexError as e:<br/>        print("No related data")<br/>        return anime_id<br/>    data = preJson["related"].replace("\"", "")<br/>    data = data.replace("\'", "\"")<br/>    data = json.loads(data)<br/>    try:<br/>        previous = data["Prequel"][0]["mal_id"]<br/>    except KeyError as e:<br/>        print("No Prequel data")<br/>    if previous is not None:<br/>        return prequel(previous)<br/>    else:<br/>        return anime_id</span></pre><h1 id="95c5" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">方法</h1><p id="2145" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">在数据准备之后，使用PFP算法，该算法在Apache Spark MLlib中有一个实现<a class="ae kg" href="https://spark.apache.org/docs/latest/ml-frequent-pattern-mining.html#fp-growth" rel="noopener ugc nofollow" target="_blank">这里是</a>。让我们看看关联规则挖掘算法是如何工作的。</p><p id="a912" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">目标是生成以下格式的规则:</p><p id="c8e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果<strong class="ih hj"> <em class="kh">条件</em> </strong>则<strong class="ih hj"> <em class="kh">结论</em> </strong></p><p id="ea2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个项目中，规则是这样的:如果用户喜欢x动漫，那么就喜欢y动漫。规则是通过使用频繁模式生成的。换句话说，如果有很多人同时喜欢x和y，他们之间就会产生一个规则。</p><p id="fa63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有几个参数用于理解生成的规则的值。<em class="kh">支持度</em>定义为同时具备<em class="kh">条件和</em>结论的概率</p><p id="632c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kh">支持</em> = P( <em class="kh">条件，结论</em>)</p><p id="aae8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kh">置信度</em>是通过知道<em class="kh">条件</em>为真而得出<em class="kh">结论</em>的概率；</p><p id="f58f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kh">置信度</em> = P( <em class="kh">结论</em> | <em class="kh">条件</em>)</p><p id="c401" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kh">重要性</em>是<em class="kh">置信度</em>除以<em class="kh">结论概率</em>的比值:</p><p id="6e9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kh">重要性</em> = <em class="kh">置信度</em> / P( <em class="kh">结论</em>)</p><p id="5351" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最小支持度设置为0.1，最小置信度设置为0.4。所以，如果至少有10%的人喜欢x动漫，那么可以生成一个包含x的规则，在这些条件下，内存对于PFP算法来说就变得不足了。通过向spark提交命令行添加以下命令，可以为spark分配更多的内存:</p><pre class="kw kx ky kz fd lw lx ly lz aw ma bi"><span id="6bac" class="ki je hi lx b fi mb mc l md me"><em class="kh">— driver-memory 12g</em></span></pre><p id="acf9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在此步骤之后，生成5550条规则，然后计算<em class="kh">重要性</em>值以评估结果。</p><h1 id="0caa" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">结果</h1><p id="7cfe" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">规则按<em class="kh">重要性</em>值排序。这个指标有两个好处。第一个是检测动画之间的关系。当<em class="kh">重要性</em>过高，特别是大于5时，观察到动画之间已经有关联。例如，如果“漂白电影1”，则“漂白电影2”。在数据集上，他们没有任何前传-续集的关系，但他们都是基于漂白的故事。第二个好处是帮助理解哪个规则更有价值。死亡笔记是数据集上最受欢迎的动画，有0.53的频率。所以，死亡笔记的推荐太多了。经过<em class="kh">重要性</em>值排序后，热门动漫推荐已经走到了底部，不太热门的已经排到了顶部。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="er es mf"><img src="../Images/3fce57f2a6e3616bd660bb0965ca8b32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pT7Nm_q53-8eBrclQvH9Xw.jpeg"/></div></div><figcaption class="le lf et er es lg lh bd b be z dx translated">图二。埼玉看到了重要性的重要性</figcaption></figure><p id="925e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">忽略关于相关动漫的几条规则，大部分规则都是令人满意的。知名动漫有好的推荐，相似动漫也有按内容分类的规则。此外，myanimelist网站上还有用户推荐。对于热门动漫，很多人添加了推荐和规则结果与人类推荐并行。举个例子，对于剑艺在线，Log Horizon，Accel Word和Btooom！是用户的前三个推荐。这些建议的结果有规则和<em class="kh">重要性</em>值分别为2.18、2.11、2.07。</p><p id="b892" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一方面，这项研究也有一些不足之处。如果一个动漫的频率小于0.1，因为最小支持度，所以不生成规则。然后，数据集不会更新。所以，新动画没有规则。</p><h1 id="ce19" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">选择一个推荐</h1><p id="7229" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">我希望我能建立一个界面，但我的工作和硕士教育不允许我这样做。首先，打开你最喜欢的动画之一的“我的动画列表”页面。例如第一动漫，星际牛仔，你会在地址栏看到下面的文字:</p><pre class="kw kx ky kz fd lw lx ly lz aw ma bi"><span id="7c94" class="ki je hi lx b fi mb mc l md me"><a class="ae kg" href="https://myanimelist.net/anime/1/Cowboy_Bebop" rel="noopener ugc nofollow" target="_blank">https://myanimelist.net/anime/<strong class="lx hj">1</strong>/Cowboy_Bebop</a></span></pre><p id="ae67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">动漫/ </strong>后面的数字就是动漫id。在这里找到我的规则<a class="ae kg" href="https://drive.google.com/open?id=1ecYchVqFwJB99RSzxEZt3xvSBEkqQs5u" rel="noopener ugc nofollow" target="_blank">，按你的id过滤条件。从结论栏看你推荐的动漫id。最后，将推荐的id附加到https://myanimelist.net/anime/.上</a></p></div></div>    
</body>
</html>