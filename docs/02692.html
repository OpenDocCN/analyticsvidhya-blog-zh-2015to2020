<html>
<head>
<title>How To Create Your Own Custom Image Classifier And Deploy It To Production</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建您自己的自定义图像分类器并将其部署到生产中</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-create-your-own-custom-image-classifier-and-deploy-it-to-production-5506bb26a74b?source=collection_archive---------2-----------------------#2019-12-29">https://medium.com/analytics-vidhya/how-to-create-your-own-custom-image-classifier-and-deploy-it-to-production-5506bb26a74b?source=collection_archive---------2-----------------------#2019-12-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b2236c1afe23586b756f22996b97aea1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z3TacwxbCWG9oXjGh1_zPA.png"/></div></div></figure><p id="6027" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我们将制作自己的自定义图像分类器。我们将使用<a class="ae jo" href="https://docs.fast.ai/" rel="noopener ugc nofollow" target="_blank"> fast.ai </a>库来训练我们的深度学习模型。它是在PyTorch上构建的高级库，允许我们只使用几行代码来构建模型。</p><p id="c06a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将在<a class="ae jo" href="https://colab.research.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌实验室上训练我们的模型。</a></p><p id="2dac" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可以查一下<a class="ae jo" href="https://www.fast.ai/" rel="noopener ugc nofollow" target="_blank"> fast.ai </a>课程。真的很棒。</p><p id="8465" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">需要的步骤是:</strong></p><ol class=""><li id="7cfc" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">下载图像数据集</li><li id="9ee3" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">加载并查看您的数据</li><li id="63ea" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">创建和训练模型</li><li id="7f26" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">解释结果</li><li id="fb87" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">用它做一个小的网络应用</li></ol><h1 id="13f3" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">下载图像数据</h1><p id="6d62" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">FastAI库提供下载图像的功能，给定一个包含这些图像的URL的文件。</p><p id="494f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了获得网址，你必须先去<a class="ae jo" href="https://images.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌图片</a>，你需要搜索你选择的类别。确保广告拦截器被关闭，或者你可以尝试在隐姓埋名的模式。</p><p id="9003" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将选择我自己的类别，即书籍、手表、耳机和吉他。您可以搜索您的选择。所以你现在要做的就是，一个一个的搜索你的类别。搜索一个并向下滚动，直到加载了足够多的图像，然后从开发人员控制台执行以下javascript代码。</p><p id="6727" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击<em class="lg"> Ctrl+Shift+J </em>打开你的开发者控制台。</p><figure class="lh li lj lk fd ij"><div class="bz dy l di"><div class="ll lm l"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated"><a class="ae jo" href="https://gist.github.com/TheCaffeineDev/5e6d0ff9409344f88248bd8066226f68" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/TheCaffeineDev/5e 6 d0ff 9409344 f 88248 BD 8066226 f 68</a></figcaption></figure><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/69dbcfc32e5c446922ce7d4d7d121f66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IzGl-wCBx6lmFoBDFrKDoQ.png"/></div></div></figure><p id="21a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先复制这些行并粘贴到您的控制台中，然后按enter键。图像文件的链接将作为名为<em class="lg"> download </em>的文件下载。然后你需要把文件重命名为<em class="lg"> book.txt </em>或者根据自己的喜好命名。然后对更多的课程重复以上步骤。</p><h1 id="2b51" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">加载并查看您的数据</h1><p id="6c27" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">打开我的<a class="ae jo" href="https://colab.research.google.com/drive/1k7ZlyU1Ad84x_KxiJZj_hLKdpcU8gy8n" rel="noopener ugc nofollow" target="_blank">谷歌实验室</a>笔记本，我们进一步的步骤。打开笔记本后。运行前两个单元。</p><figure class="lh li lj lk fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es ls"><img src="../Images/37db8cbe8f70d96df0e8354541c9d0ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*6HdAhcopp46YHZ9M5t3ioA.png"/></div></figure><p id="47bf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">笔记本中的上述代码用于指定路径并创建相应的文件夹。</p><p id="1df0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在笔记本中执行完上面的后，需要在笔记本中运行下面的单元格，并上传相应的。txt文件。</p><pre class="lh li lj lk fd lt lu lv lw aw lx bi"><span id="4409" class="ly ke hi lu b fi lz ma l mb mc">from google.colab import files<br/>book = files.upload()</span></pre><p id="bf5e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你需要上传。txt文件也适用于其他类。</p><p id="c1d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在上传完所有文件后，需要逐个执行其他单元格。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/80f3406bfd707bfb197d1f6c8fd3114d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zchBjYPk5oNBjznCZ-KPTA.png"/></div></div></figure><p id="5825" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这段代码要做的是，它将读取文本文件中的URL，并将图像下载到Colab中。</p><p id="9cbf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下载完这些图片后，我们需要删除无法打开的图片。</p><figure class="lh li lj lk fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="1ccd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面的代码将为我们做这件事。这个<em class="lg"> verify_images </em>函数会查找图像，看看它是否有问题，然后<em class="lg"> delete =True </em>会帮你删除它。因此，这是清理数据的一个非常好且简单的方法。</p><figure class="lh li lj lk fd ij"><div class="bz dy l di"><div class="ll lm l"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated"><a class="ae jo" href="https://gist.github.com/TheCaffeineDev/66c2fdbb4669da4540fba144604884cc" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/TheCaffeineDev/66 C2 fdbb 4669 da 4540 FBA 144604884 cc</a></figcaption></figure><p id="31d4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">fast.ai库拥有名为<em class="lg"> databunch </em> es的特定数据对象。它有助于在适当的文件夹结构中读取我们的数据集，这有助于随机创建验证数据。你可以在他们的文件中读到更多关于https://docs.fast.ai/的内容。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es me"><img src="../Images/bb3f70332527646491054aaa5c220013.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*QYxY-wOMnYyPWXBq3MPY3Q.png"/></div></figure><p id="d146" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们有一大堆数据。所以你可以看看<code class="du mf mg mh lu b">data.classes</code>里面，你会看到这些是我们创建的文件夹。所以它知道类别(我们所说的类别是指所有可能的标签)是书、手表、耳机&amp;吉他。</p><p id="b4ed" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后你需要在笔记本中运行下面的一些代码。我对代码进行了注释，以便人们更容易了解和理解。</p><h1 id="884c" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">创建模型和初始培训</h1><p id="65d3" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">fastai库允许您用几行代码创建模型，并通过他们提供的<a class="ae jo" href="https://docs.fast.ai/vision.learner.html#create_cnn" rel="noopener ugc nofollow" target="_blank"><em class="lg">create _ l</em></a><em class="lg">carrier</em>方法训练CNN模型。</p><pre class="lh li lj lk fd lt lu lv lw aw lx bi"><span id="2830" class="ly ke hi lu b fi lz ma l mb mc">learn = cnn_learner(data, models.resnet34, metrics=error_rate)</span></pre><p id="e9b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个cnn_learner方法需要两个参数，数据和架构，它还支持许多其他参数。</p><p id="d4bf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建的模型使用<a class="ae jo" href="https://arxiv.org/pdf/1512.03385.pdf" rel="noopener ugc nofollow" target="_blank"> resnet34架构，</a>在<a class="ae jo" href="http://www.image-net.org/" rel="noopener ugc nofollow" target="_blank"> imagenet数据集</a>上预训练权重。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es mi"><img src="../Images/f7012d785ff2211d66db187c81b25082.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*rSlsYiarlstqqta0SvSz6g.png"/></div></figure><p id="8444" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">训练模型的是<em class="lg"> fit_one_cycle </em>方法<em class="lg"> </em>。它使用一种叫做<a class="ae jo" href="https://sgugger.github.io/the-1cycle-policy.html" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> 1周期策略</strong>，</a>的东西，这种策略基本上是随着时间的推移改变学习速率，以达到更好的结果。</p><p id="9fa8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后我们保存模型。训练模型不会超过5分钟。</p><h1 id="ea86" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">解释</h1><p id="61b3" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">最后，我们可以使用FastAIs<em class="lg">ClassificationInterpretation</em>类来解释我们的结果。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es mj"><img src="../Images/09f2ae6f4b3a1c01a4a2196d755d08d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*UA-U9I5KVK01JGSpZ49UBA.png"/></div></figure><p id="132c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在运行所有单元和训练模型之后。模型文件将被导出，您可以下载重量文件并将其用于推理和生产。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/a99e3e758f5a6ccdee60199d40bc28e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-yPGgpwPP39PdR2FhgFn5g.png"/></div></div></figure><p id="d76c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以通过进入侧边菜单并浏览文件夹来下载重量文件。点击下载后，它会在几分钟内下载。</p><h1 id="d15f" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">为我们的图像分类器制作一个小的网络应用程序</h1><p id="b9ab" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">首先克隆我的Github库</p><pre class="lh li lj lk fd lt lu lv lw aw lx bi"><span id="459b" class="ly ke hi lu b fi lz ma l mb mc">git clone <a class="ae jo" href="https://github.com/TheCaffeineDev/Custom-Image-Classifier" rel="noopener ugc nofollow" target="_blank">https://github.com/TheCaffeineDev/Custom-Image-Classifier</a></span></pre><p id="0439" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">克隆后，通过以下方式进入文件夹</p><pre class="lh li lj lk fd lt lu lv lw aw lx bi"><span id="12a3" class="ly ke hi lu b fi lz ma l mb mc">cd Custom-Image-Classifier</span></pre><p id="f2e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后通过以下方式安装所有依赖项</p><pre class="lh li lj lk fd lt lu lv lw aw lx bi"><span id="fd8c" class="ly ke hi lu b fi lz ma l mb mc">pip3 install -r requirements.txt</span></pre><p id="cd00" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">之后，里面会有一个名为models的文件夹，你需要把你的<em class="lg"> export.pkl </em>文件放在那里。这是文件夹的路径。</p><pre class="lh li lj lk fd lt lu lv lw aw lx bi"><span id="6480" class="ly ke hi lu b fi lz ma l mb mc">Custom-Image-Classifier/app/models/ </span></pre><p id="86f6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制文件后，您可以通过以下方式运行服务器</p><pre class="lh li lj lk fd lt lu lv lw aw lx bi"><span id="c481" class="ly ke hi lu b fi lz ma l mb mc"># In Custom-Image-Classifier folder run</span><span id="a3cb" class="ly ke hi lu b fi ml ma l mb mc">python3 app/server.py serve </span></pre><p id="3161" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">几秒钟后，它将在您的本地服务器上运行。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/21904cfa06a7a4f206117a5ff7188533.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d0u2uIT_1FBraGAb0kbuYA.png"/></div></div></figure><p id="6d7a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下是我的模型的一些推论结果</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es mn"><img src="../Images/2ccf01021fdc75412fcac23cae4a7370.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/1*b2xHtdW8-AjRv3s-nHlX7w.png"/></div></figure><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/5666ea5c99f04cf9017a58feb57cf228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zoDKLc2eSw_FDaUDAKhM_w.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx">-</figcaption></figure><p id="2a52" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你正确地遵循了上述步骤，你将能够很容易地创建你的图像分类模型。</p><p id="41ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本文涵盖的代码可以从<a class="ae jo" href="https://github.com/TheCaffeineDev/Custom-Image-Classifier" rel="noopener ugc nofollow" target="_blank"> Github资源库获得。</a></p><p id="2fbd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你有任何问题、建议或批评，可以通过<a class="ae jo" href="https://twitter.com/thecaffeinedev" rel="noopener ugc nofollow" target="_blank">推特</a>或我的<a class="ae jo" href="mailto:prabhat1015@gmail.com" rel="noopener ugc nofollow" target="_blank">邮件</a>联系我。请随时联系我。</p><h2 id="87a8" class="ly ke hi bd kf mp mq mr kj ms mt mu kn jb mv mw kr jf mx my kv jj mz na kz nb bi translated">参考资料:</h2><ol class=""><li id="c6e1" class="jp jq hi is b it lb ix lc jb nc jf nd jj ne jn ju jv jw jx bi translated"><a class="ae jo" href="https://course.fast.ai/" rel="noopener ugc nofollow" target="_blank">https://course.fast.ai/</a></li><li id="f73f" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><a class="ae jo" href="https://course.fast.ai/deployment_google_app_engine.html" rel="noopener ugc nofollow" target="_blank">https://course.fast.ai/deployment_google_app_engine.html</a></li></ol></div></div>    
</body>
</html>