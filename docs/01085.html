<html>
<head>
<title>Testing ML Code: How Scikit-learn Does It</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">测试ML代码:Scikit-learn是如何做到的</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/testing-ml-code-how-scikit-learn-does-it-97e45180e834?source=collection_archive---------1-----------------------#2019-09-30">https://medium.com/analytics-vidhya/testing-ml-code-how-scikit-learn-does-it-97e45180e834?source=collection_archive---------1-----------------------#2019-09-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6d9f32e3f34cb4decf7a559fd4163d90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3XfLd0bN-c6_RqsAQwKubg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Scikit-learn代码库中的时间旅行。</figcaption></figure><h1 id="188b" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated"><strong class="ak">事件</strong></h1><p id="2450" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">这一切开始于一天早上，一位数据科学家同事问我:<br/>“我有测试用的所有东西的静态版本。但是对于RandomForest分类器，不能保证当我通过静态训练集时，我会得到与静态预测表相同的预测。我确实在Numpy和除\_(ツ)_/之外的所有地方播下了随机种子……”</p><p id="1141" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">测试ML代码对于构建健壮的机器学习管道是必要的。但是，测试文献不像其他软件工程学科那样全面。对于ML代码来说，在编写集成测试时有相当多的不确定性。这些集成测试实际上构建了模型。然后，他们尝试根据预定义的输入和输出来验证他们的行为。在这篇博文中，我们将概述scikit-learn中的一些测试策略。开发人员/维护人员使用测试来简化他们的开发。此外，测试有助于消除向现有估计器添加新功能的风险。</p><p id="0708" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">是时候深入研究ML masters编写的处理这个问题的代码了。</p><h1 id="e036" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">在哪里可以找到作为测试模板的Scikit-learn测试</h1><p id="0fe8" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">我们从版本<strong class="ju hj"> scikit-learn 0.21.x </strong>开始我们的旅程:</p><p id="0453" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated"><a class="ae kv" href="https://github.com/scikit-learn/scikit-learn/blob/master/sklearn/ensemble/tests/test_forest.py" rel="noopener ugc nofollow" target="_blank">https://github . com/sci kit-learn/sci kit-learn/blob/master/sk learn/ensemble/tests/test _ forest . py</a>。</p><p id="ea22" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">该文件实现了一组测试，用于验证一组树集合模型的行为。这些开发人员根据“森林”命名约定对这些模型进行了分组。</p><p id="838a" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">我们首先注意到的是一系列全面的测试。这些测试针对基于森林的模型系列:</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/76b6c5587b08de443758a28c4d76c05f.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*QsuC0Gt5M5JKcfu06qKSfw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">test_forest.py文件中的部分测试列表</figcaption></figure><p id="ab70" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">接下来，我们注意到几乎每个“test_something”都有一个“check_something”函数。“test_something”函数使用pytest参数化测试功能。然后，它将测试输入传递给“check_something”。还要注意开发人员是如何添加“玩具”分类测试的。这允许他们调试与测试框架本身相关的问题。这消除了真正的图书馆问题的干扰。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/aab7bd56a60a139133c34ce08134dd2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/1*aI8uh7mt6HW5LDG0-eh9LA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">使用pytest参数化进行测试，检查单个案例。</figcaption></figure><h1 id="c4ce" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">参考数据集</h1><p id="98f1" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">ML开发人员在编写测试时主要关心的一个问题是“我应该为我的集成测试使用什么数据？”。我们正在看的scikit-learn测试是针对图书馆的。这可能与应用程序和ML产品不同。在产品中，目标数据集是不断波动的。然而，scikit-learn开发人员提供的策略可以走很长的路。在这个测试文件中，开发人员创建了5个不同的数据集作为参考:</p><ul class=""><li id="1ad3" class="lc ld hi ju b jv kq jz kr kd le kh lf kl lg kp lh li lj lk bi translated">用于测试管道、接口和功能签名的玩具样本。</li><li id="277a" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp lh li lj lk bi translated">用于测试特征重要性的500个合成样本数据集。</li><li id="eb3a" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp lh li lj lk bi translated">iris数据集和半真实世界数据集的波士顿数据集。</li><li id="91cf" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp lh li lj lk bi translated">一个较小的Hastie数据集，与T. Hastie、R. Tibshirani和J. Friedman编写的经典ML书中的一个具体示例相匹配。2”，施普林格，2009年</li></ul><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/3b52381f8f428283e483db996f3cfd49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jMQdVbPwRQEdZtdca9tTzg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">5个具有各种测试特征的静态数据集</figcaption></figure><h1 id="f537" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">测试指标的范围</h1><p id="ee84" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">接下来，我们测试森林分类器是否按预期工作。第一批测试之一是测试模型的准确性。在下图中，测试首先在完整的iris数据集上进行训练，然后在相同的完整数据集上进行评分。使用相同的数据进行训练和测试，该模型具有可预测的得分，如下所示。我认为一旦开发人员运行了这个测试，就会记录一个稳定的下限。然后，他们能够设置阈值(0.9和0.5)来检测测试中的分类器是否有问题。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es ls"><img src="../Images/a1cac74d23ac633c571973b7957b9641.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*uGyfcdT1CjHQDWR2ALXVXw.png"/></div></figure><h1 id="83b6" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">测试概率是否有意义</h1><p id="8efa" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">接下来是使用虹膜数据集的<strong class="ju hj">检查概率</strong>。这个函数在整个数据集上训练一个分类器。然后，它确保预测的概率总和接近1。它还通过将对数概率与它们的指数进行比较来检查对数概率。注意<strong class="ju hj"> assert_array_almost_equal的使用。</strong>如果两个对象的精度不相等，该函数将产生一个断言。这个函数允许开发人员调整他们测试的精度。这也允许在处理浮点数时有微小的差异。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/33f657088da73cdc6f8d54b085ea2c18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ic8ZmndSqrTYRgF1QRiLXQ.png"/></div></div></figure><h1 id="4944" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">使用合成数据集和噪声注入测试特定行为</h1><p id="6cd3" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">接下来我们看看如何测试一个特定的行为。在这种情况下，我们有特征重要性。这些额外的信息是树集合算法的副产品。开发人员使用自定义数据集，该数据集具有适当数量的信息特征。在下图中，他们确保合成数据集具有3个信息特征。他们确保它们也将成为前三个特性。然后，开发人员检查分类器是否报告了三个最重要的特征。它们还包括一个特定的预先计算的阈值。</p><p id="a71a" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">为了平衡这个测试，dev还在原始数据集中包含了一些“噪声”。devs通过包含样本权重来包含噪声。这具有打乱初始特征信息含量的效果。这种混排导致所有特征的重要性都不为零。这是为了确认当没有信息过多的特征时，分类器的行为符合预期。dev能够通过随机化样本权重在合成数据集中添加噪声。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/20ef7e98ae73cfe722b39bed0cac085b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*prdt4WpcyH9zE6tDXR7nsA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">使用带有自定义信息变量的合成数据集来测试特征重要性</figcaption></figure><h1 id="b3bf" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">测试API</h1><p id="6627" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">有一组测试与测试API本身相关。我们来看下面的<strong class="ju hj"> check_regressor_attributes。</strong>它确保回归变量在拟合后不会得到“classes_”和“n_classes_”属性。这些属性应该只出现在分类器中。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es lv"><img src="../Images/909373b43ad1c9da91f4560bce85600c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*pUFy2fUAP9AluiNS5lDjAQ.png"/></div></figure><p id="c2b7" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">其他此类测试包括:</p><ul class=""><li id="e6e7" class="lc ld hi ju b jv kq jz kr kd le kh lf kl lg kp lh li lj lk bi translated"><strong class="ju hj">检查_腌制</strong>检查可采摘性。</li><li id="d90e" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp lh li lj lk bi translated"><strong class="ju hj"> check_parallel </strong>分类检查并行计算。</li><li id="ba68" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp lh li lj lk bi translated"><strong class="ju hj"> check_gridsearch </strong>检查基树是否可以进行网格搜索。</li><li id="e378" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp lh li lj lk bi translated"><strong class="ju hj"> check_warm_start </strong>检查热启动增量拟合是否给出了正确大小的森林以及与正常拟合相同的结果。</li></ul><p id="7d1f" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">还包括特定于林/树的api测试，例如</p><ul class=""><li id="2f1b" class="lc ld hi ju b jv kq jz kr kd le kh lf kl lg kp lh li lj lk bi translated"><strong class="ju hj">检查_最小_样本_分割</strong></li><li id="9c0f" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp lh li lj lk bi translated"><strong class="ju hj">检查_最大_叶_节点_最大_深度</strong></li><li id="8d0b" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp lh li lj lk bi translated"><strong class="ju hj"> check_min_samples_leaf </strong></li></ul><h1 id="c760" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">结论</h1><p id="a3f4" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">这是开发人员添加到scikit-learn中的大量测试中的一小部分。由于其在行业中的重要性，scikit-learn库必须保持灵活性，以添加新的特性和评估程序。开发人员和维护人员使用这些测试来防止代码腐烂、僵化和脆弱。</p><p id="3d35" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">我们讨论了以下内容:</p><ul class=""><li id="d5bf" class="lc ld hi ju b jv kq jz kr kd le kh lf kl lg kp lh li lj lk bi translated"><strong class="ju hj">在哪里可以找到作为测试模板的Scikit-learn测试。</strong></li><li id="2519" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp lh li lj lk bi translated"><strong class="ju hj">如何制作静态参考数据集？</strong></li><li id="2df0" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp lh li lj lk bi translated"><strong class="ju hj">测试指标的范围。</strong></li><li id="0756" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp lh li lj lk bi translated">测试概率是否有意义。</li><li id="6ccc" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp lh li lj lk bi translated"><strong class="ju hj">使用合成数据集和噪声注入测试特定行为。</strong></li><li id="2474" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp lh li lj lk bi translated">开发人员如何测试分类器的公共API。</li></ul><p id="de39" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">那都是乡亲们！</p><p id="9d5a" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">我希望你喜欢这篇文章。它旨在帮助你提高你的机器学习项目测试技能。</p></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><blockquote class="md me mf"><p id="afea" class="js jt lq ju b jv kq jx jy jz kr kb kc mg ks kf kg mh kt kj kk mi ku kn ko kp hb bi translated">请注意，这篇文章中表达的观点是我个人的，不一定是我雇主的观点。</p></blockquote></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><blockquote class="md me mf"><p id="0bec" class="js jt lq ju b jv kq jx jy jz kr kb kc mg ks kf kg mh kt kj kk mi ku kn ko kp hb bi translated">我们在招人！如果您对此感兴趣，请查看Xandr数据科学平台工程的空缺职位:</p><p id="0ced" class="js jt lq ju b jv kq jx jy jz kr kb kc mg ks kf kg mh kt kj kk mi ku kn ko kp hb bi translated"><a class="ae kv" href="https://xandr.att.jobs/job/new-york/data-science-platform-engineer/25348/12859712" rel="noopener ugc nofollow" target="_blank">https://xandr . att . jobs/job/new-York/data-science-platform-engineer/25348/12859712</a></p></blockquote></div></div>    
</body>
</html>