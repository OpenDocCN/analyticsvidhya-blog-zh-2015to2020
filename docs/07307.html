<html>
<head>
<title>SQL Concepts for analytics role</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">分析角色的SQL概念</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/sql-concepts-for-analytics-role-92a5fe07cb64?source=collection_archive---------20-----------------------#2020-06-20">https://medium.com/analytics-vidhya/sql-concepts-for-analytics-role-92a5fe07cb64?source=collection_archive---------20-----------------------#2020-06-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/78b470b60e0f0dc0c877daadcc0ecd20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MZ2PpugLTjcVBCkBqxT22Q.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated"><strong class="bd hv">数据到洞察</strong></figcaption></figure><div class=""/><p id="0e51" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">想要进入分析角色的候选人经常会想，对于他们来说，什么样的sql概念才是真正重要的，才能让他们准备好从数据中提取有价值的见解。</p><p id="0dcb" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以下是我想分享的一些关键概念或疑问，它们将帮助您加快分析之旅。我们将使用Amazon Redshift SQL语法(根据您选择的数据库随意修改SQL)。</p><p id="e98d" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">业务场景:</strong></p><p id="00b9" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要求分析网站A/B测试的结果，管理层希望了解网站的哪个版本(A或B)运行良好。A/B测试的各种细节存储在一个名为test_results(假数据)的表中，该表的结构如下所示。</p><figure class="ju jv jw jx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es jt"><img src="../Images/282ffa4e404ae296f616a5cffd9b4a95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HxZ_8DWlTdSwXwVCcAX4XQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">表:测试结果</figcaption></figure><p id="9658" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">大多数分析性问题解决的第一步是了解我们正在处理哪种类型的数据，我们可以使用以下查询:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="5213" class="kd ke hy jz b fi kf kg l kh ki"><strong class="jz hz">Select</strong> * <br/><strong class="jz hz">from</strong> test_results <br/><strong class="jz hz">limit</strong> 2</span></pre><p id="968c" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上述查询将从表中获取所有列(*表示所有列)及其数据值，要显示的记录数将由limit函数后指定的数量来限制。如果只想获取几列，可以用逗号分隔列名，例如:Select CustomerID，DateofYear</p><p id="c57c" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们可以开始对数据进行切片和切块，以获得一些聚合度量，例如:在一年的特定时间段内，每个页面版本购买的产品数量。下面是一个查询，它将获得2020年1月期间每个页面版本类型购买的产品总数。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="a1dc" class="kd ke hy jz b fi kf kg l kh ki"><strong class="jz hz">Select</strong> Page_Version, sum(Product_Purchased) as num_products_purchased <br/><strong class="jz hz">from</strong> test_results <br/><strong class="jz hz">where</strong> DateOfYear &gt;= TO_DATE('20200101','YYYYMMDD')<br/>and DateOfYear &lt;= TO_DATE('20200131','YYYYMMDD')<br/><strong class="jz hz">Group By</strong> Page_Version</span></pre><p id="2c6b" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">比方说，如果我们想知道客户最后一次访问我们的网站是否成功购买，我们可以使用下面的sql代码。我们将在子查询中使用秩函数来实现这一点。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="16a2" class="kd ke hy jz b fi kf kg l kh ki">Select * from (<br/><strong class="jz hz">Select</strong> Distinct CustomerID, Page_Version, Engagement_Time, Product_Purchased, DateOfYear, <strong class="jz hz">rank() over (partition by CustomerID order by DateOfYear Desc)</strong> as rank<br/>from test_results<br/>)<br/>Where rank = 1</span></pre><p id="1949" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过使用rank函数，我们将根据客户的网站访问日期为他们的记录分配等级，并将结果放在一个子查询中，并为每个客户仅提取1条记录，这是他们的最新记录。现在，在许多现实世界的场景中，我们可能有相同客户的多个记录，为了处理这样的场景，您可能需要仔细阅读一下<strong class="ix hz"> row_number()、dense_rank() </strong>函数。此外，distinct不应该是必要的，但是distinct的目的是删除任何重复的记录。</p><p id="b6c7" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们想了解当客户访问网站时，他们的参与时间是增加还是减少，我们可以构建如下查询:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="ad56" class="kd ke hy jz b fi kf kg l kh ki">Select *, (Engagement_Time - prev_engagement_time) as diff_engagement<br/>from(<br/>Select CustomerID, Page_Version, Engagement_Time, Product_Purchased, DateOfYear, <strong class="jz hz">lag(Engagement_Time,1) over (partition by CustomerID order by DateOfYear)</strong> as prev_engagement_time<br/>from test_results)</span></pre><p id="0b9b" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用上面的查询，我们对客户的访问进行升序排序，并使用lag函数获得以前的参与时间，然后我们可以检查Engagement_Time和prev_engagement_time之间的差异，以获得增量或减量。也可查看<strong class="ix hz">引线功能。</strong></p><p id="a14b" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，假设我们有一个新的营销活动，我们需要获得每个客户的电子邮件ID，这些ID存储在不同的表(EmailIDInfo)中，有些客户可能没有电子邮件ID，而只是一个电话号码，该号码再次存储在不同的表(phoneinfo)中。我们将使用join构建一个查询来获取这些数据</p><p id="23e5" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">PhoneInfo包含列—客户ID、电话号码</p><p id="9a86" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">电子邮件信息包含列—客户ID、电子邮件ID</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="5a9a" class="kd ke hy jz b fi kf kg l kh ki">Select Distinct t1.CustomerID, t2.EmailID, t3.PhoneNumber<br/>from test_results t1<br/><strong class="jz hz">left join</strong> EmailIDInfo t2<br/>on t1.CustomerID = t2.CustomerID<br/><strong class="jz hz">left join</strong> PhoneNumber t3<br/>on t1.CustomerID = t3.CustomerID</span></pre><p id="096e" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用上述带左连接的查询，我们确保从test_results表中获取所有客户id，并从EmailIDInfo表中获取可用的电子邮件id，从PhoneNumber表中获取可用的电话号码。</p><p id="0a1d" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以上是一些基本到高级的功能，将有助于您的分析之旅。我建议使用其他聚合函数，如max、min、median、avg，join，如right join、full outer join，创建临时表，并在临时表和连接中插入数据记录。</p></div></div>    
</body>
</html>