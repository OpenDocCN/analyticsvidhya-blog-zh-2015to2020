<html>
<head>
<title>How to solve Instacart Market Basket Analysis Problem in Kaggle.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何解决 Kaggle 中的 Instacart 购物篮分析问题？</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-solve-instacart-market-basket-analysis-problem-in-kaggle-fd2cf7fa7055?source=collection_archive---------9-----------------------#2020-12-26">https://medium.com/analytics-vidhya/how-to-solve-instacart-market-basket-analysis-problem-in-kaggle-fd2cf7fa7055?source=collection_archive---------9-----------------------#2020-12-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/e6a8c32685f8b4c9646e652ee32167ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/0*xUuVvmr3MJIKW47l"/></div></figure><p id="c7ec" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个博客是关于如何解决 Kaggle 中的 instacart 问题。希望这篇博客能让你很好地理解如何解决推荐问题。</p><h1 id="f6f5" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated"><strong class="ak">什么是 Instacart，这个问题是关于什么的？</strong></h1><p id="f0d0" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">Instacart 是一家美国公司，在美国和加拿大经营杂货交付和提货服务。Instacart 中的消费者一次又一次地从他们那里订购大篮子大小的各种食物。他们比任何电子商务公司都更关注用户行为。一个数据科学家在 Instacart 的工作:<a class="ae kn" href="https://tech.instacart.com/data-science-at-instacart-dabbd2d3f279" rel="noopener ugc nofollow" target="_blank">https://tech . insta cart . com/data-science-at-insta cart-dab BD 2d 3 f 279</a></p><p id="36bc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">由于拥有巨大的用户行为数据密度，Instacart 致力于向客户推荐产品，正如上面的 URL 所提到的。这个问题的重点是改善推荐系统的用户更多的手经验，为用户建议或推荐类型的产品，以填补篮子，因此 Instacart 市场篮子分析。</p><p id="6dd8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">基于以前的订单，该模型必须预测用户最终会重新订购什么，并且更加精确地为用户提供 N 个最适用的建议。对于部署，Instacart 作为一家公司对每个模型进行 AB-Test，以获得更好的用户体验。</p><h1 id="427a" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated"><strong class="ak">让我们从更多的实现形式</strong>来看这个问题。</h1><p id="262c" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated"><strong class="io hj"> <em class="ko">数据来源:</em></strong><a class="ae kn" href="https://www.kaggle.com/c/instacart-market-basket-analysis/data" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/c/insta cart-market-basket-analysis/Data</a></p><p id="d190" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们拥有的数据集是 6 个相关的 csv 文件，可以使用主键轻松合并。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es kp"><img src="../Images/8eb81aebb4e9a243cd525ccf1ac4bdd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sZlbUjZiHo0qwjS6CUCdBQ.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">csv 文件之间的相关性。</figcaption></figure><p id="7cf7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">任何推荐问题面临的最大问题是，该问题往往是冷启动问题，但在这种情况下，由于相关文件，我们实际上可以获取每个用户和产品的行为，并使用该行为进行推荐。</p><p id="f4b9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果我们看一下图表，我们可以看到 orders.csv 包含用户的交易历史记录，而 oreders.csv 中的 eval set 列实际上引用了 order_products_prior.csv 文件和 order_products_train.csv 文件，并且 eval set 等于 test 的 orders.csv 文件中的所有数据是我们必须预测产品的数据。</p><p id="ed18" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是问题不是冷启动问题的主要原因，因为我们实际上可以通过相关性和行为来区分用户和产品。</p><h1 id="f45b" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated"><strong class="ak">如何处理问题和分析数据。</strong></h1><p id="649e" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">该问题的现有解决方案实际上主要更多地关注特征工程，然后实际上在其上构建简单的模型，这使得该问题更加有趣，因为在解决该问题时可以想到各种各样的特征。</p><p id="160f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="ko">配送数据:</em> </strong></p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/a3f67e9b7ce910a66f9a9af9a83c4942.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*mAysLXeyU9Hnv-cws7MxvA.png"/></div></figure><p id="e30c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">正如我们所看到的，大部分数据位于前一个区域，这就是为什么我们可以从中提取最大行为，并使用该行为在训练区域训练模型，然后预测测试区域。</p><p id="c5a7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，我们通过合并 order _ products _ previous . CSV 文件和 orders.csv 文件来制作数据，并对用户和产品进行分析。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es ld"><img src="../Images/923cb12082070769f0f942c51f5d95f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xZJVmIxEakZBAl1dMEWWXA.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">制作 prior _ orders 数据集。</figcaption></figure><p id="7209" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">值得一看的特色是:</strong></p><ol class=""><li id="06bb" class="le lf hi io b ip iq it iu ix lg jb lh jf li jj lj lk ll lm bi translated">订单编号</li><li id="804b" class="le lf hi io b ip ln it lo ix lp jb lq jf lr jj lj lk ll lm bi translated">订单 _ 道琼斯</li><li id="4e4d" class="le lf hi io b ip ln it lo ix lp jb lq jf lr jj lj lk ll lm bi translated">订单 _ 小时 _ 天</li><li id="4d05" class="le lf hi io b ip ln it lo ix lp jb lq jf lr jj lj lk ll lm bi translated">天数 _ 自 _ 先前 _ 订单</li><li id="eae7" class="le lf hi io b ip ln it lo ix lp jb lq jf lr jj lj lk ll lm bi translated">添加到购物车订单</li></ol><p id="06eb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="ko">对这些因素如何影响用户和产品的再订购进行单因素和多因素分析:</em> </strong></p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es ls"><img src="../Images/c8a1a62174c165a375ca61d2121ac86f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j9khzOMjxBpvmiRIfyrlLw.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">订单编号分配。</figcaption></figure><p id="3a5e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="ko">正如我们所看到的，大部分订单编号等于 1，即订单编号的行为出现正偏差</em></p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es lt"><img src="../Images/6f533f418933237eb793cdd20c24b35a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ow90jV1t5ayHxir_QTRDvg.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">Order_dow 分销。</figcaption></figure><p id="b1f8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="ko">从条形图中可以明显看出，第 0 天和第 1 天是订单最多的日子，这就引出了第 0 和第 1 天是否是周末的问题？-是的 0 和 1 是周末。</em></p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es lu"><img src="../Images/0af92621b884e9eda5c136859c864249.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MINa4bLXwpa87qBg4687gA.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">order _ hour _ day 配送。</figcaption></figure><p id="807f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="ko">一天中第 10 至 16 小时之间可以订购最多订单</em></p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es lv"><img src="../Images/36e1339471474cc52801c0974f96133d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SOY6q5FKnvQDOU1j4VP8nQ.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">一周中的某天与一天中的某小时的热图。</figcaption></figure><p id="a5d2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="ko">由于周六下午和周日上午的中间订单数量较多。</em></p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es lw"><img src="../Images/61f4f411b079d11f56e898b8eae48bc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZXCvvel4iNlcUgDEQ0D92g.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">days _ 自 _ prior _ orders 分发。</figcaption></figure><p id="576e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="ko">可见，30 天和 7 天的再订购率最高，意味着最多用户倾向于在 7 天或 30 天后再订购。</em></p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es ls"><img src="../Images/337460c0cbb126d26d7d40f83002b249.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AJfKEqRuFuGzQJjW_iozBA.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">添加到购物车分发</figcaption></figure><p id="64e9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="ko">可见，add_to_cart_order 的个数大多等于 1。</em></p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es lx"><img src="../Images/d642401dc55f2e4a99a5f5cfdcbd5797.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Nd5EKvr4gjLs2F7tC0PGg.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">一周中的某一天与一天中的某一小时，具有重新排序速率。</figcaption></figure><p id="1ad0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="ko">最大重组发生在周日早上，所有重组基本上都发生在凌晨。</em></p><h1 id="f4d1" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated"><strong class="ak">数据的特征工程:</strong></h1><p id="5887" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated"><strong class="io hj"> <em class="ko">所有特征列表:</em> </strong></p><pre class="kq kr ks kt fd ly lz ma mb aw mc bi"><span id="8bb7" class="md jl hi lz b fi me mf l mg mh">&lt;class 'pandas.core.frame.DataFrame'&gt;<br/>MultiIndex: 4833292 entries, (3, 248) to (206208, 49621)<br/>Data columns (total 47 columns):<br/> #   Column                       Dtype  <br/>---  ------                       -----  <br/> 0   up_unique_dow                int8   <br/> 1   up_unique_hod                int8   <br/> 2   up_unique_atc                int8   <br/> 3   up_unique_reordered          int8   <br/> 4   up_cumcount_on               int16  <br/> 5   up_cumcount_dow              int16  <br/> 6   up_cumcount_hod              int16  <br/> 7   up_cumcount_dsp              float16<br/> 8   up_cumcount_atc              int16  <br/> 9   up_orders_cumcount           int8   <br/> 10  up_orders_num                int8   <br/> 11  up_orders_since_previous     int8   <br/> 12  up_reordered                 int8   <br/> 13  up_order_ratio               float16<br/> 14  up_order_dow_score           float16<br/> 15  up_order_hour_of_day_score   float16<br/> 16  up_last_five                 float16<br/> 17  up_last_five_ratio           float16<br/> 18  max_orders                   int8   <br/> 19  total_items                  int16  <br/> 20  orders_ratio                 float16<br/> 21  unique_products              int16  <br/> 22  num_reorders                 int16  <br/> 23  reordered_mean               float16<br/> 24  reordered_std                float16<br/> 25  user_dow_mean                float16<br/> 26  user_dow_var                 float16<br/> 27  user_dow_std                 float16<br/> 28  user_hod_mean                float16<br/> 29  user_hod_var                 float16<br/> 30  user_hod_std                 float16<br/> 31  user_dsp_mean                float16<br/> 32  user_dsp_var                 float16<br/> 33  user_dsp_std                 float16<br/> 34  prod_sum_on                  int32  <br/> 35  prod_sum_dow                 int32  <br/> 36  prod_sum_hod                 int32  <br/> 37  prod_sum_dsp                 float32<br/> 38  prod_sum_atc                 int32  <br/> 39  prod_sum_reordered           int32  <br/> 40  prod_num                     int32  <br/> 41  prod_unique_users            int32  <br/> 42  prod_reorder_mean            float16<br/> 43  prod_order_hour_of_day_mean  float16<br/> 44  prod_order_hour_of_day_var   float16<br/> 45  prod_order_dow_mean          float16<br/> 46  prod_order_dow_var           float16<br/>dtypes: float16(23), float32(1), int16(7), int32(7), int8(9)<br/>memory usage: 507.1 MB</span></pre><p id="0c1b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个问题的核心问题是使特征更强，并赋予模型更多的可预测性。我的功能涵盖了用户单独的行为，产品单独，以及用户如何使用产品。</p><p id="cff3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">帮助构建这些功能的主要功能是熊猫图书馆中的“群比”功能，让我们看看如何:</p><p id="965e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="ko">针对用户:</em> </strong></p><p id="8c7e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">举一个例子，用户将获得任何用户已经完成的最大订单数量。</p><pre class="kq kr ks kt fd ly lz ma mb aw mc bi"><span id="6c71" class="md jl hi lz b fi me mf l mg mh">#max_orders:Max orders ordered by users<br/>max_orders = prior_orders.groupby(by='user_id'['order_number'].max().to_frame('max_orders')<br/>max_orders = max_orders.reset_index()<br/>max_orders</span></pre><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es mi"><img src="../Images/37c977627bef3bdea19ac224e138467b.png" data-original-src="https://miro.medium.com/v2/resize:fit:574/format:webp/1*-ViN_iYTIOfuhdd2Fr7rMw.png"/></div></figure><p id="f2f9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="ko">类似地，像这样为用户创建其他功能，我们实际上可以实验并提出许多不同类型的功能来代替。max()我们可以使用。应用()并创建我们自己的函数，并提出新的特性。</em></p><p id="4a85" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="ko">用于产品:</em> </strong></p><p id="a3fd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">举一个产品的例子，任何产品都会得到 prod _ reorder _ mean。</p><pre class="kq kr ks kt fd ly lz ma mb aw mc bi"><span id="1cc6" class="md jl hi lz b fi me mf l mg mh">#prod_reorder_mean : product reorder mean<br/>prod_reorder_mean = <br/>prior_orders.groupby(by="product_id)["reordered"].mean().to_frame("prod_reorder_mean").reset_index()<br/>prod_reorder_mean</span></pre><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es mj"><img src="../Images/aa52798f9aa5e56c4a3adb605380289e.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*JU0Yi5C8WYjMCe5rTWYW5Q.png"/></div></figure><p id="233e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">类似地，为产品创造其他功能，我们实际上可以试验并想出许多不同类型的功能来代替。mean()我们可以用。apply()并创建我们自己的函数，提出新的特性。</p><p id="cc0e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="ko">为用户-产品特性:</em> </strong></p><p id="0e5c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">举一个用户产品的例子，用户和产品的订单数量。</p><pre class="kq kr ks kt fd ly lz ma mb aw mc bi"><span id="bc5b" class="md jl hi lz b fi me mf l mg mh">#up_orders_num : Number of times user ordered the products<br/>up_orders_num = prior_orders.groupby(["user_id","product_id"])["order_id"].count().to_frame("up_orders_num").reset_index()<br/>up_orders_num</span></pre><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es mk"><img src="../Images/32a40657ba1999c4e6048ea3f104be11.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*QbHAA2qeHSSpR8yXX_N9og.png"/></div></div></figure><p id="3b4c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="ko">类似地，为用户产品创建其他功能，我们实际上可以试验并提出许多不同类型的功能来代替。我们可以使用 count()。apply()并创建我们自己的函数，提出新的特性。</em></p><p id="8404" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">就像这样，我们基本上制作了三个 pickle 文件，命名为“users.pickle”、“products.pickle”和“user_products.pickle ”,并将所有这些文件合并到一个数据集，我们可以称之为绝对数据集，我们必须从中创建 data_train 和 data_test，我们必须在此基础上进行建模并得出预测。</p><p id="08ad" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="ko">制作绝对数据:</em> </strong></p><pre class="kq kr ks kt fd ly lz ma mb aw mc bi"><span id="af86" class="md jl hi lz b fi me mf l mg mh">user = pickle.load(open("users.pickle" , 'rb'))<br/>products = pickle.load(open("products.pickle" , "rb"))<br/>user_products = pickle.load(open("user_product.pickle" , "rb"))</span><span id="2fbd" class="md jl hi lz b fi ml mf l mg mh">data = pd.merge(user_products , user , on="user_id" , how="left")<br/>data = pd.merge(data , products , on="product_id" , how="left")<br/></span><span id="9d91" class="md jl hi lz b fi ml mf l mg mh">#We want only the data with eval_set = "train" and "test"<br/>orders_filtered = orders_data[(orders_data.eval_set == "train") | (orders_data.eval_set == "test")]<br/>orders_filtered = orders_filtered[['user_id', 'eval_set', 'order_id']]</span><span id="f127" class="md jl hi lz b fi ml mf l mg mh">#Making the absolute data<br/>data = pd.merge(data , orders_filtered , on="user_id" , how="left")<br/>data.fillna(0,inplace = True)</span></pre><p id="3f0d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="ko">制作数据 _train: </em> </strong></p><pre class="kq kr ks kt fd ly lz ma mb aw mc bi"><span id="427e" class="md jl hi lz b fi me mf l mg mh">#Training Dataset<br/>data_train = data[data.eval_set == "train"]</span><span id="beeb" class="md jl hi lz b fi ml mf l mg mh">#Getting the information for the Trainig data from train data<br/>data_train = data_train.merge(or_prod_train[['product_id', 'order_id', 'reordered']], on=['product_id', 'order_id'], how='left')</span><span id="d87d" class="md jl hi lz b fi ml mf l mg mh">#filling the NAN values in the reordered<br/>data_train.reordered.fillna(0, inplace=True)</span><span id="ed21" class="md jl hi lz b fi ml mf l mg mh">#setting user_id and product_id as index.<br/>data_train = data_train.set_index(['user_id', 'product_id'])</span><span id="eeb5" class="md jl hi lz b fi ml mf l mg mh">#deleting eval_set, order_id as they are not needed for training.<br/>data_train.drop(['eval_set', 'order_id'], axis=1, inplace=True)</span></pre><p id="1ead" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">制作数据 _ 测试:</strong></p><pre class="kq kr ks kt fd ly lz ma mb aw mc bi"><span id="7dc6" class="md jl hi lz b fi me mf l mg mh">#Creating Test Dataset<br/>data_test = data[data.eval_set == "test"]</span><span id="852a" class="md jl hi lz b fi ml mf l mg mh">#setting user_id and product_id as index.<br/>data_test = data_test.set_index(['user_id', 'product_id'])</span><span id="fde7" class="md jl hi lz b fi ml mf l mg mh">#deleting eval_set, order_id as they are not needed for training.<br/>data_test.drop(['eval_set', 'order_id'], axis=1, inplace=True)</span></pre><p id="bcc4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"><em class="ko"/></strong></p><h1 id="7514" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated"><strong class="ak">造型:</strong></h1><p id="f327" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">如果我们看看这个问题的业务约束，即延迟约束、准确性约束。</p><p id="d247" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我用来选择最佳模型的指标是:</p><ul class=""><li id="1c0f" class="le lf hi io b ip iq it iu ix lg jb lh jf li jj mm lk ll lm bi translated">混淆矩阵</li><li id="694a" class="le lf hi io b ip ln it lo ix lp jb lq jf lr jj mm lk ll lm bi translated">AUC-ROC</li><li id="67c9" class="le lf hi io b ip ln it lo ix lp jb lq jf lr jj mm lk ll lm bi translated">AUC-PR</li><li id="4e75" class="le lf hi io b ip ln it lo ix lp jb lq jf lr jj mm lk ll lm bi translated">f1-分数</li></ul><p id="9e51" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="ko">查看指标:</em> </strong></p><p id="d543" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"/></p><p id="3396" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="ko"> AUC-ROC : </em> </strong>对于这个问题，这是一个很好的指标，可以确定模型对数据集的表现是否良好，以及是否应该考虑该模型。</p><p id="8bfb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"/></p><p id="bdce" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="ko"> F1 分数:</em> </strong>这是评估结果的主要指标，但就个人而言，这只是 F1 分数，而不是平均 F1 分数，因此对我来说，AUC-PR 是模型的更好的直觉。</p><p id="c76c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="ko">如何在这样的大数据上做建模？</em>T47】</strong></p><p id="8f2b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我面临的训练数据集的一个问题是管理训练的数据量。在像 XG-Boost 和 Random Forest 这样的模型上训练这样的大数据往往需要很长时间才能收敛，所以我建议使用那些有更多参数可以调整并且可能收敛更快的模型。</p><p id="025d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="ko">对我来说，这些模型是:</em></p><ol class=""><li id="ce84" class="le lf hi io b ip iq it iu ix lg jb lh jf li jj lj lk ll lm bi translated">轻梯度推进分类器。</li><li id="df32" class="le lf hi io b ip ln it lo ix lp jb lq jf lr jj lj lk ll lm bi translated">Catboost 分类器。</li></ol><p id="e2cc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="ko">取对数概率，然后最大化 F1 分数:</em> </strong></p><p id="5a8f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最大化 F1 分数的代码片段:</p><pre class="kq kr ks kt fd ly lz ma mb aw mc bi"><span id="36ac" class="md jl hi lz b fi me mf l mg mh">thresholds = clf.predict_proba(X_test)[:, 1]<br/>f1_scores = []<br/>values = np.arange(np.mean(thresholds)-(2*np.std(thresholds)) , np.mean(thresholds) +(2*np.std(thresholds))  , 0.02)</span><span id="af98" class="md jl hi lz b fi ml mf l mg mh">#Getting F1-Scores<br/>for value in tqdm(values):<br/>    y_pred = (clf.predict_proba(X_test)[:, 1] &gt;= value).astype('int')<br/>    f1_scores.append(metrics.f1_score(y_test , y_pred))</span><span id="1f68" class="md jl hi lz b fi ml mf l mg mh">#Plotting<br/>plt.figure(figsize=(10,10))<br/>sns.barplot(values , f1_scores , color = "red")<br/>plt.xlabel("thresholds")<br/>plt.ylabel("F1-score")<br/>plt.title("Thresholds vs F1-score")<br/>plt.grid(True)<br/>plt.xticks(rotation = 90)</span><span id="a474" class="md jl hi lz b fi ml mf l mg mh">plt.show()</span></pre><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es mn"><img src="../Images/9450500528db6931282c7f09c416c03e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*-5nL4sSwwGmRqb2mFGJ3rw.png"/></div></figure><p id="c6d5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="ko">用于光梯度增强分类器。</em></p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es mo"><img src="../Images/3dafa6c8153db5363b9ab7c25f712ad8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*MiVR5UsWn4zg0fJymdlGlA.png"/></div></figure><p id="92fc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="ko">用于 Catboost 分类器。</em></p><p id="f9fe" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我尝试的其他模型有 XG-Boost，随机森林分类器，MLP 分类器，Conv-1D 分层神经网络，密集层神经网络。</p><p id="535b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我选择的模型是<strong class="io hj"> Catboost 分类器</strong>，因为它给了我其他模型中最高的 Kaggle 分数。</p><h1 id="9179" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated"><strong class="ak">ka ggle-评分和提交:</strong></h1><blockquote class="mp mq mr"><p id="6db8" class="im in ko io b ip iq ir is it iu iv iw ms iy iz ja mt jc jd je mu jg jh ji jj hb bi translated"><em class="hi">所以，最后的 Kaggle 分数是</em> <strong class="io hj"> <em class="hi"> 0.37868 </em> </strong></p><p id="3a57" class="im in ko io b ip iq ir is it iu iv iw ms iy iz ja mt jc jd je mu jg jh ji jj hb bi translated"><em class="hi">公众评分为 0.37868 </em></p><p id="6595" class="im in ko io b ip iq ir is it iu iv iw ms iy iz ja mt jc jd je mu jg jh ji jj hb bi translated"><em class="hi">私人得分为</em> 0.37802</p></blockquote><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es mv"><img src="../Images/f1df5d4d078bad601b6d6b81051d5572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v5Tn0ztt1_Ld1Kwjm_IHNQ.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">Kaggle 提交</figcaption></figure><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es mw"><img src="../Images/1a03a0fde86b78d20922891345c8c08d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lf-koIhswk92ToTqbYgzfQ.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">卡格尔分数</figcaption></figure><p id="f909" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个分数让我进入了排行榜前 20%的前 500 名。</p><h1 id="9888" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">未来的工作</h1><p id="cbe1" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">实际上还有一个增加准确度分数的技巧，即通过建立两个模型，一个用于预测哪些产品将被重新订购，另一个用于预测哪些用户将重新订购，然后合并使用阈值和概率形成的两个数据集。我真的很想尝试这种方法，因为尝试这种方法的人实际上得到了 0.4 以上的分数。</p><p id="5e68" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">计算更多与用户和产品相关的特性，如用户购物车大小、用户的平均订单日等。</p><p id="96bf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">此外，我期待尝试 Apriori 算法，以获得更多的功能。</p><h1 id="c07b" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">参考</h1><ol class=""><li id="4269" class="le lf hi io b ip ki it kj ix mx jb my jf mz jj lj lk ll lm bi translated"><a class="ae kn" href="https://www.kaggle.com/errolpereira/xgboost-with-minimal-feature-engineering#Creating-user-product-features." rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/errolpereira/xgboost-with-minimal-feature-engineering # Creating-user-product-features。</a></li><li id="e5ef" class="le lf hi io b ip ln it lo ix lp jb lq jf lr jj lj lk ll lm bi translated"><a class="ae kn" href="https://www.kaggle.com/philippsp/exploratory-analysis-instacart" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/philippsp/explorative-analysis-insta cart</a></li><li id="3c8c" class="le lf hi io b ip ln it lo ix lp jb lq jf lr jj lj lk ll lm bi translated"><a class="ae kn" href="https://www.kaggle.com/nickycan/lb-0-3805009-python-edition" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/nickycan/lb-0-3805009-python-edition</a></li><li id="0c60" class="le lf hi io b ip ln it lo ix lp jb lq jf lr jj lj lk ll lm bi translated"><a class="ae kn" rel="noopener" href="/analytics-vidhya/instacart-market-basket-analysis-kaggle-competition-856ddd7b08e0">https://medium . com/analytics-vid hya/insta cart-market-basket-analysis-ka ggle-competition-856 DDD 7 b 08 e 0</a></li><li id="8a65" class="le lf hi io b ip ln it lo ix lp jb lq jf lr jj lj lk ll lm bi translated"><a class="ae kn" href="https://www.kaggle.com/c/instacart-market-basket-analysis/discussion/99252" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/c/insta cart-market-basket-analysis/discussion/99252</a></li><li id="a9c7" class="le lf hi io b ip ln it lo ix lp jb lq jf lr jj lj lk ll lm bi translated"><a class="ae kn" href="https://www.appliedaicourse.com/" rel="noopener ugc nofollow" target="_blank">https://www.appliedaicourse.com/</a></li></ol><p id="f0b4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="ko"> GitHub 链接针对此问题的所有 pynb</em></strong><em class="ko">:</em><a class="ae kn" href="https://github.com/Rag-hav385/Intacart-Market-Basket-Analysis" rel="noopener ugc nofollow" target="_blank">https://GitHub . com/Rag-hav 385/inta cart-Market-Basket-Analysis</a></p><p id="598a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="ko">我的领英</em></strong>:<a class="ae kn" href="https://www.linkedin.com/in/raghav-agarwal-127539170" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/raghav-agarwal-127539170</a></p></div></div>    
</body>
</html>