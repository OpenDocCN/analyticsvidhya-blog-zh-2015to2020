<html>
<head>
<title>Waiting For the Bathroom — a Linear Regression Story</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">等待浴室——一个线性回归的故事</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/waiting-for-the-bathroom-a-linear-regression-story-8b2b7c48bcc7?source=collection_archive---------23-----------------------#2020-05-20">https://medium.com/analytics-vidhya/waiting-for-the-bathroom-a-linear-regression-story-8b2b7c48bcc7?source=collection_archive---------23-----------------------#2020-05-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3e43b83b9546f2f9fb4b3a15cec34cee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mtSW_-LdPyUwiIIu"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">由<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae iu" href="https://unsplash.com/@sidekix?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Sidekix媒体</a>拍摄的照片</figcaption></figure><p id="cdf1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我最近完成了一个涉及多元线性回归预测房价的项目，你猜怎么着……人们真的不喜欢等厕所。</p><p id="286d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这似乎很明显，但是他们有多不喜欢等待呢？事实证明，他们可能愿意支付数万美元，以避免在接下来的13年里每天等待上厕所。</p><p id="b764" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将讲述一下我是如何得出上述结论的，即美国人在上厕所时是多么有耐心。</p><h1 id="9c73" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">开始线性回归</h1><p id="534b" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我使用Jupyter笔记本用Python编写了我的项目，并将我的数据存储在Pandas dataframe对象中。在清理我的数据并将其分成训练集和测试集之后，我开始制作一个线性回归模型。我选择使用<a class="ae iu" href="https://www.statsmodels.org/stable/index.html" rel="noopener ugc nofollow" target="_blank"> Statsmodels </a>，因为我喜欢它生成的汇总报告。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="2f90" class="lf ju hi lb b fi lg lh l li lj"># create a linear regression model for the training set<br/># statsmodels' function to create a linear regression model doesn't<br/># add a constant(y-intercept) by default so you will need to call<br/># sm.add_constant to add one</span><span id="01b5" class="lf ju hi lb b fi lk lh l li lj">import statsmodels.api as sm</span><span id="0e1d" class="lf ju hi lb b fi lk lh l li lj">X_train_int = sm.add_constant(X_train)<br/>model = sm.OLS(y_train, X_train_int).fit()<br/>display(model.summary())</span></pre><h1 id="246f" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">处理多重共线性</h1><p id="3e36" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我最终制作了几个模型，反复改进它们。在这个过程中，我发现我的数据集中有很多数据存在多重共线性问题。我通过给熊猫打电话发现了这个问题。DataFrame.corr()，它返回一个矩阵，显示所有特征之间的相关性，以及当我的一些与目标正相关的特征在线性回归模型中具有负系数时。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="48fb" class="lf ju hi lb b fi lg lh l li lj"># get a correlation matrix for my training set</span><span id="c8e6" class="lf ju hi lb b fi lk lh l li lj">X_train.corr()</span></pre><h1 id="2eeb" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">为什么多重共线性不好？</h1><p id="3628" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">当您的数据具有大量多重共线性时，您不能信任该模型。你甚至可以得到更好的R值或其他精确度，但是你不能相信自变量的系数或它们的p值。独立变量的微小变化可能会导致独立变量系数的巨大变化(在这种情况下，独立变量不是非常独立)，并且模型将无法对这些系数的p值进行可信的计算。</p><h1 id="5dbb" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">平均居中</h1><p id="cc7c" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我不想只删除具有高度多重共线性的特征，它们告诉我关于房子的特征:浴室、卧室、平方英尺、地板和建筑等级，我想尽可能多地保留它们。</p><p id="e54f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要素的平均中心化或标准化是减少多重共线性的简单方法。我的意思是使用来自<a class="ae iu" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.scale.html" rel="noopener ugc nofollow" target="_blank"> sklearn.preprocessing </a>的scale函数将所有受影响的特征居中。为了便于解释我的模型，我不想将数据换算成单位标准偏差，这是默认设置，所以我必须将with_std参数设置为False。通过只减去数据的平均值(平均值居中),我仍然能够解释这些特征，就好像我没有进行转换一样；通过将独立特征<em class="ll"> a </em>增加1个单位，目标的平均变化将是特征<em class="ll">a</em>的系数</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="1d1b" class="lf ju hi lb b fi lg lh l li lj">from sklearn.preprocessing import scale</span><span id="306b" class="lf ju hi lb b fi lk lh l li lj"># standardize the specified columns in the dataframe and give<br/># them updated column names</span><span id="168d" class="lf ju hi lb b fi lk lh l li lj">for col in cols_with_multicollinearity:<br/>    scaled_col_name = col + '_scaled'<br/>    X_train[scaled_col_name] = scale(X_train[col], with_std=False)</span></pre><p id="5829" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我很幸运，我的意思是居中消除了大多数多重共线性问题，但我仍然很难在我的模型中以直观的方式保留卧室数量和浴室数量的特征，浴室具有正系数，卧室具有负系数。多加一间卧室总不能把房子的价格降下来，所以一定是有别的原因。</p><h1 id="9435" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">添加交互式功能</h1><p id="2bfb" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">浴室和卧室功能的系数的混乱行为导致我尝试为浴室和卧室添加一个交互功能，瞧，我的模型变得更有意义了。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="0d18" class="lf ju hi lb b fi lg lh l li lj"># add a column to the dataframe for the interacting feature</span><span id="bcbf" class="lf ju hi lb b fi lk lh l li lj">X_train['bathrooms_scaled*bedrooms_scaled'] = X_train.bathrooms_scaled * X_train.bedrooms_scaled</span></pre><h1 id="ec76" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">解释系数</h1><p id="57e1" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">当我完成建模过程时，我得到了以下系数，所有系数的P值都足够低，足以使它们具有显著性:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="542a" class="lf ju hi lb b fi lg lh l li lj">bathrooms_scaled 36,470<br/>bedrooms_scaled -4,839<br/>bathrooms_scaled*bedrooms_scaled 11,030</span></pre><p id="b84c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我有了系数，它们是如何解释的呢？我有相互作用的项，这些项是以平均值为中心的。对于包含两个术语的交互功能，有两种情况需要解释，但我将重点关注添加浴室的情况。这可能意味着在现有的房子上增加一个浴室，或者你可以把它想象成两个几乎相同的房子，但其中一个有一个额外的卧室。</p><p id="6240" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我将分配系数，以便更容易地呈现公式。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="94c7" class="lf ju hi lb b fi lg lh l li lj">a = 36,470 # the coefficient of bathrooms_scaled<br/>b = -4,839 # the coefficient of bedrooms_scaled<br/>c = 11,030 # the coefficient of bathrooms_scaled*bedrooms_scaled<br/>d = number of bedrooms<br/>e = mean number of bedrooms in the dataset</span></pre><p id="29a0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">增加一个卧室会增加房子的平均价格，结果如下。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="8ce0" class="lf ju hi lb b fi lg lh l li lj">a + c * (d - e)</span></pre><p id="5ba6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因为这些特征是相互作用的，所以增加一间浴室的房子的平均价格的增加量将取决于房子有多少间卧室。例如:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="212f" class="lf ju hi lb b fi lg lh l li lj">d = 3 # number of bedrooms<br/>e = 3.373 # mean number of bedrooms</span><span id="7b44" class="lf ju hi lb b fi lk lh l li lj">36,470 + 11,030 * (3 - 3.373) = $32,355.81</span></pre><p id="ebf9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，对于一个三卧室的房子，模型预测人们将支付超过32，000美元来拥有同样的房子，但有一个额外的浴室。</p><h1 id="0b57" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">他们的时间值多少钱？</h1><p id="f841" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">以13年的房屋使用权中位数为例，购房者愿意每天支付约6.80美元，以避免等待上厕所。如果一天平均有20分钟等待上厕所，总计94，900分钟，购房者估计他们的厕所等待时间为每分钟0.34美元。</p><h1 id="f5ef" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">我应该只加浴室吗？</h1><p id="b0c6" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">回归到增加卫生间对房子的预测附加价值，能不能就这么增加一堆卫生间，让我的房子更值钱？不。线性回归模型是基于真实的房子，预测会打破你房子的陌生人。看看真实的房屋数据，一旦你的房子浴室和卧室的比例超过1:1，价格就会开始下降。如果你的每个卧室都有一个以上的浴室，这些浴室可能会被视为浪费空间和额外的维护成本。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/1d0c990e80544106ce27252e8c953879.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DL1jofUJHA1pWpHF-kTpGw.png"/></div></div></figure><h1 id="0f4c" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">我的项目</h1><p id="c996" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">感谢阅读这篇文章，你可以在github <a class="ae iu" href="https://github.com/merb92/multivariate-linear-regression----housing-prices" rel="noopener ugc nofollow" target="_blank">这里</a>查看我的整个项目和它的发现。</p></div><div class="ab cl ln lo gp lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hb hc hd he hf"><p id="d51f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">根据<a class="ae iu" href="https://www.nar.realtor/blogs/economists-outlook/how-long-do-homeowners-stay-in-their-homes" rel="noopener ugc nofollow" target="_blank">全国房地产经纪人协会</a>的数据，截至2018年，美国房屋所有权的中值期限</p></div></div>    
</body>
</html>