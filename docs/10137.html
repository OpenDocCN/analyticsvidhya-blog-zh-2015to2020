<html>
<head>
<title>Predicting future house prices using SARIMA</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SARIMA预测未来房价</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/predicting-future-house-prices-using-sarima-d972ea9c3cfa?source=collection_archive---------14-----------------------#2020-10-06">https://medium.com/analytics-vidhya/predicting-future-house-prices-using-sarima-d972ea9c3cfa?source=collection_archive---------14-----------------------#2020-10-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="c1f8" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">介绍</h1><p id="b80a" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">这个项目的目的是预测威尔士首都卡迪夫的排屋的未来价格。房屋销售数据被转换为时间序列，显示1995年至2020年的月平均销售价格，然后通过使用SARIMA模型将时间序列扩展到2025年，以预测房价。</p><p id="3383" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">本研究中使用的数据来自皇家土地登记处:<a class="ae kn" href="https://landregistry.data.gov.uk/app/ppd/" rel="noopener ugc nofollow" target="_blank">https://landregistry.data.gov.uk/app/ppd/</a></p><h1 id="af4d" class="im in hi bd io ip ko ir is it kp iv iw ix kq iz ja jb kr jd je jf ks jh ji jj bi translated">根据房屋销售列表创建时间序列</h1><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es kt"><img src="../Images/c8a1e242f81a9c7af0756a01d2c38be4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K-hPrPM-dhf6jVybfuQYbg.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">从1995年到2020年加的夫的所有排屋销售</figcaption></figure><p id="8e7e" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated"><strong class="jm hj">离群点剔除</strong></p><p id="a15b" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">由于房屋的价格差异很大，在加的夫有一些非常昂贵的露台房屋，我选择从数据中删除这些房屋，将超过中位数3个标准差的房屋销售归类为异常值，这些是“非常昂贵的房屋”。我没有使用完整数据集中的中位数来做这件事。不出所料，卡迪夫的房价在过去25年里大幅上涨。因此，为了说明这一点，我独立计算了每年的异常值。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lj"><img src="../Images/3c6eb7f17836a76a3045b123e091f5ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jHCJo7B9WXKE7_zoGB74xw.jpeg"/></div></div></figure><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lk"><img src="../Images/86e8da4bf9df1599f849d8a90a42f241.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6M-UHDkwXqEe9baD3SDOBg.png"/></div></div></figure><p id="8a1e" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated"><strong class="jm hj">重采样</strong></p><p id="7419" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">原始数据包含销售日期和销售价格。如果要将数据转换成时间序列，每天不可能有多个销售，因此我对数据进行了重新采样，创建了从1995年到2020年每个月的平均销售价格。现在我们有了一个时间序列！</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lj"><img src="../Images/7437daf5cc261aedc6a8078112499497.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bkof6upFA-z0I420CH8YPg.jpeg"/></div></div></figure><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ll"><img src="../Images/6aa635c93fda9a944b335cb93a060063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CUGvpyGKz2Vq8YEz-0rTpg.png"/></div></div></figure><h1 id="f3e2" class="im in hi bd io ip ko ir is it kp iv iw ix kq iz ja jb kr jd je jf ks jh ji jj bi translated">系统模型化</h1><p id="f109" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">为了使用SARIMA萨里玛方法，输入时间序列必须是平稳的，迪基-富勒检验可以告诉我们一个时间序列是否平稳。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lm"><img src="../Images/35bd37b00e21c6e0a813b83cf8b3818b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ljn8YMzeQFtK3H3MVd1SrQ.jpeg"/></div></div></figure><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ln"><img src="../Images/cb8c5ba9f420e8516c5b17177048d6b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LiqJUEb5iN6euAjt0drl_Q.png"/></div></div></figure><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es lo"><img src="../Images/4d9cc5bc8ad57959434f17b5c948e15f.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*KuCRaR6vkdPto-Gc31Ixqg.jpeg"/></div></figure><p id="ef92" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">一个平稳的时间序列有一个接近常数的平均值，显然这不是我的时间序列的情况。Dickey-Fuller检验的零假设是“时间序列是平稳的”。这里，我们不能在90%的置信水平上拒绝零假设，因为10%的临界值小于检验统计量，因此可以肯定地说我的时间序列是平稳的。我们可以用差分法使时间序列平稳，幸运的是这是ARIMA函数的一部分。</p><p id="cf9a" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">statsmodels库有一个特性叫做季节性分解。这可以将时间序列分解成几个部分。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lj"><img src="../Images/9f5a56e7500738c967aff200ce9a5cfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AFXnMRII89Vo093ttgRKSA.jpeg"/></div></div></figure><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lp"><img src="../Images/4d28b41c51600c697e2ccd9b74504d0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I68Fk9-1nU9Huvwp43pQlQ.png"/></div></div></figure><p id="6c10" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">这一趋势表明，1995-2005年间，房价的上涨速度比2005年以后要快得多，而2005年以后，房价的上涨速度有所放缓，在2009年(信贷紧缩)期间，房价甚至略有下降。从2013年开始，房价再次缓慢上涨。残差显示去除趋势和季节性的时间序列。看看剩余的图，很明显，从2004年开始，房价波动更加剧烈和不稳定。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lq"><img src="../Images/2d9d376d1848c4714b0f3fb8a4c6004d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hrri2m0ANGUYlfqcave4EQ.png"/></div></div></figure><p id="34b3" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">从上图中可以明显看出，数据中的季节性趋势每年都是一致的，8月份价格最高，11月份价格最低。谁想在圣诞节期间搬家？</p><p id="8e43" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated"><strong class="jm hj">季节性自回归综合移动平均线(SARIMA) </strong></p><p id="0425" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">SARIMA模型可用于拟合时间序列，然后用于预测该序列的未来值。模型必须参数化:(p，d，q)</p><p id="584d" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">p:模型中使用的滞后数</p><p id="c553" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">d:时间序列的每个观察值被差分的次数(这就是时间序列如何成为平稳的)</p><p id="108c" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">问:移动平均线窗口的大小</p><p id="b0ab" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">季节性因素还有另外3个参数，但是在这篇文章中我不会深入讨论。</p><p id="e12d" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">pmdarima库有一个名为auto_arima的有用函数，它执行网格搜索来为arima模型找到最佳参数(p，d，q)。每种参数组合都使用Akaike信息标准(AIC)进行评估。AIC的值是对模型正确的可能性的估计，AIC越低，模型越有可能真实地表示时间序列。AIC完全依赖于训练数据，而不受测试数据的任何影响，这使得它适合于评估预测模型。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lr"><img src="../Images/349117a858480d6e43d5bb30a48971ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0NKVeHfPjVtAhpnYl7uNrg.jpeg"/></div></div></figure><p id="b775" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">参数ARIMA参数(0，1，1)和季节性参数(0，1，1)输出最低的AIC值。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ls"><img src="../Images/a52465c1b90a633599c006aef72f98e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DmMEaldp1MUHsLhmZV0hwg.jpeg"/></div></div></figure><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ll"><img src="../Images/fe0e0b1faf5c79ce3017c9cf053ae3b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U7m74iQex1gzRASh_GUuqA.png"/></div></div></figure><p id="7680" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">SARIMA模型遵循测试数据的总体趋势，但是SARIMA没有对测试数据的波动进行建模。萨里玛模型中的波动是季节性周期。使用可以对模型进行更深入的分析。总结()。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lr"><img src="../Images/28d97607fd248be3964c2859e2ba513d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2sFbVq0tG47fTCLGYWxoXg.jpeg"/></div></div></figure><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lt"><img src="../Images/890baeeb7817be25616d0d9f37e93059.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FECT5acQxiMAN5j3Pn3S0w.jpeg"/></div></div></figure><p id="c9d8" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">RMS误差为8735，这意味着测试数据和SARIMA数据样本之间平均有8735的差异。不算太差！</p><p id="f067" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">可以使用核密度估计(KDE)图来查看误差的分布。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ls"><img src="../Images/bdbd5ae980b2694c5a05d05341e5de50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Iqsoi_lG2qVfyhbm8MDmlA.jpeg"/></div></div></figure><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lu"><img src="../Images/cea245c94f5c3414008bf137795d20c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Axy9pkd6AgNZq7sXW3GDsQ.png"/></div></div></figure><p id="5a21" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">平均值不在0以上居中。这意味着误差不符合正态分布，因此误差不是随机的……模型可以更好地参数化。</p><p id="2c63" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">经过对ARIMA参数的反复试验，我找到了(1，1，1)来改善模型对测试数据的拟合。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ll"><img src="../Images/e18ace7b55f33ddd76525c76181a7aab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G5x6URPcIY4_RoPHW_UEVQ.png"/></div></div></figure><p id="9b27" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">将模型(p)中的滞后数从0改变为1具有随着时间增加平均价格的效果，提供了对测试数据的更好拟合。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lv"><img src="../Images/386f0ac2f7fab181c56630d862140506.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lTbR0KjWXb0QJ3AB8H7Jww.jpeg"/></div></div></figure><p id="3d07" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">请注意，此SARIMA模型的AIC高于前一个模型，因此网格搜索没有将此模型作为最佳模型输出。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lw"><img src="../Images/6f7f0cd157401b214e9396251dfa7664.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6mVx2snHuIfiLWKcXXrw2Q.jpeg"/></div></div></figure><p id="6ccb" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">均方根误差降低了1000多倍！这证明一个人不应该把所有的信任都放在AIC价值上。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lu"><img src="../Images/82ca564f7905838f7520d2d2ada14d77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lt7z7ZM0bTAFtlZFF87u9g.png"/></div></div></figure><p id="44f0" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">平均值现在更接近于0，尽管它仍然稍微有点倾斜，线不是关于0对称的。总体而言，该模型过度预测了价格，这一点从x轴正侧的图形面积大于负侧的图形面积可以明显看出。</p><h1 id="e689" class="im in hi bd io ip ko ir is it kp iv iw ix kq iz ja jb kr jd je jf ks jh ji jj bi translated">预测未来</h1><p id="4584" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">为了预测未来的房价，我必须创建一个新的时间序列，一个延伸到未来5年的时间序列。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lx"><img src="../Images/dd8b713699215534ed77fb4c5aed302e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IudEJy24X1UIVflATpg_ng.jpeg"/></div></div></figure><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ly"><img src="../Images/0aad9a2b6c19e1c3abc40244cbe0640a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IwcvqY8a0AVkGY9kCoEISg.jpeg"/></div></div></figure><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ll"><img src="../Images/6a6fce4b42ba0dff7d86b2ba4539dda9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jsm4G-_oZ_Mo4feHIXZaUw.png"/></div></div></figure><p id="03ec" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">未来预测显示未来5年平均房价将会上涨。除了每年的季节性周期外，增长率是恒定的。现在手头有两个问题:我在预测未来的价格，我丢失了时间机器的钥匙。这意味着我没有测试数据，所以AIC是评估模型质量的合适方法。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lz"><img src="../Images/6be9ebb0e3682ee252b42c0c21045c21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bf9hv_1CUL5g5ddQVfavJg.jpeg"/></div></div></figure><p id="d473" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">与预测过去价格时的值4645相比，未来价格预测模型的结果AIC是5955。这不是我所期望的，因为未来的价格预测模型使用整个数据集，因此有更多的数据输入到模型中，而不是过去的价格预测模型，因为数据被拆分用于训练和测试，所以输入到模型中的数据较少。经过一些研究，我发现这是因为AIC假设数据的样本量是无限的，因此输入模型的数据量在确定AIC值时没有任何权重。</p><h1 id="a40a" class="im in hi bd io ip ko ir is it kp iv iw ix kq iz ja jb kr jd je jf ks jh ji jj bi translated">结论</h1><p id="74f4" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">如果你想在卡迪夫买一栋带露台的房子，那就尽快买一栋，它们只会越来越贵！并且不要忘记在季节周期的低谷期(11月)买入。</p><p id="d258" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">在本项目中，SARIMA产生的时间序列仅显示了平均房价随时间的变化所显示的一般趋势和季节周期，忽略了训练数据显示的波动。</p><p id="2e28" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">感谢您的阅读。</p><p id="5c9a" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">源代码可以在我的github上找到:<a class="ae kn" href="https://github.com/risdallseis/Cardiff_house_sales/blob/time_series_sarima/cardiff_monthly_time_series.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/risdallseis/Cardiff _ house _ sales/blob/time _ series _ sarima/Cardiff _ monthly _ time _ series . ipynb</a></p></div></div>    
</body>
</html>