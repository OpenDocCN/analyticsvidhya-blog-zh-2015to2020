<html>
<head>
<title>Beginner to Advance — Web Scraping Guide in Python: Build and Deploy a Python Web App using Flask and Postgres.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">初级到高级——Python中的Web抓取指南:使用Flask和Postgres构建和部署Python Web应用程序。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/beginner-to-advance-web-scraping-guide-in-python-build-and-deploy-a-python-web-app-using-flask-202ffdf8fd40?source=collection_archive---------7-----------------------#2020-06-23">https://medium.com/analytics-vidhya/beginner-to-advance-web-scraping-guide-in-python-build-and-deploy-a-python-web-app-using-flask-202ffdf8fd40?source=collection_archive---------7-----------------------#2020-06-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/d5cfb25c44060ef506a82af638ecdafe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l0FcmzZD7RPvKfpv"/></div></div></figure><div class=""/><p id="2f85" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在之前的教程中，我们创建了一个抓取项目来从AZLyrics下载歌词，它以JSON格式保存歌词。但我们也需要创建一个网站和API来更好地搜索我们的数据中的歌词。因此，为了创建基于Web的界面和RESTful API，我们将使用Flask和Postgresql并在Heroku上部署我们的界面。</p><h2 id="4532" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">为什么Flask是一个好的web框架选择？</h2><p id="7e49" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">Flask是一个快速、轻量级并且对初学者友好的用Python编写的web框架，它使用了T2的Werkzeug WSGI工具包和Jinja2模板引擎T3。在Flask中编写“Hello World”程序的起始代码非常简单。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="e303" class="jo jp ht ku b fi ky kz l la lb">from flask import Flask<br/>app = Flask(__name__)<br/>@app.route(‘/’)<br/>def hello_world():<br/>   return ‘Hello, World!’<br/>if __name__ == ‘__main__’:<br/>   app.run()</span></pre><h2 id="1a8b" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">一种数据库系统</h2><p id="df76" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">PostgreSQL是一个免费的开源关系数据库管理系统，强调可扩展性和SQL遵从性。它在Heroku中免费提供，最多10，000行，我们将在下一节中了解。</p><h1 id="67ed" class="lc jp ht bd jq ld le lf ju lg lh li jy lj lk ll kb lm ln lo ke lp lq lr kh ls bi translated">安装Flask和PostgreSQL</h1><p id="0a5c" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">使用PIP在python中安装flask简单明了。您只需要激活本地python环境(如果您正在使用),并使用pip命令来安装Flask</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="bf30" class="jo jp ht ku b fi ky kz l la lb">pip install flask</span></pre><p id="1d69" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在Flask中使用PostgreSQL可能有点复杂，但是如果出现错误，您可以查看大量的帮助和博客。我们将使用<a class="ae ko" href="https://stackabuse.com/using-sqlalchemy-with-flask-and-postgresql/" rel="noopener ugc nofollow" target="_blank"> <em class="lt"> Flask-SQLAlchemy </em> </a>扩展将我们的API连接到Postgres数据库。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="2356" class="jo jp ht ku b fi ky kz l la lb">pip install psycopg2-binary ,flask-sqlalchemy, Flask-Migrate<br/>sudo apt-get install postgresql postgresql-contrib</span></pre><p id="a68e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用Pgadmin4作为客户端，这是一个流行的、功能丰富的PostgreSQL开源管理和开发平台。<br/>为PostgreSQL创建超级用户。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="9598" class="jo jp ht ku b fi ky kz l la lb">sudo -u postgres createuser — superuser <strong class="ku hu"><em class="lt">name_of_user</em></strong></span></pre><p id="a340" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并使用创建的用户帐户创建数据库。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="af08" class="jo jp ht ku b fi ky kz l la lb">sudo -u <strong class="ku hu"><em class="lt">name_of_user</em></strong> createdb <strong class="ku hu"><em class="lt">lyrics</em></strong></span></pre><p id="30b4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在运行<strong class="is hu"> pgadmin4 </strong>，您将能够看到您的第一个数据库。</p><figure class="kp kq kr ks fd hk er es paragraph-image"><div class="er es lu"><img src="../Images/4d638f86207e2bf2eceb56de7e683827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/0*LHD4g_iafzKOwBWK"/></div></figure><p id="8250" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们将创建一个名为<strong class="is hu"> Web_App </strong>的新文件夹，我们将在其中创建我们的flask项目。我们还需要创建文件夹<strong class="is hu">静态</strong>和<strong class="is hu">模板</strong>，我们将在其中创建HTML和CSS文件。</p><p id="f961" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，在Web_App文件夹中创建文件<strong class="is hu"> app.py </strong>，并将以下代码放入其中。</p><figure class="kp kq kr ks fd hk"><div class="bz dy l di"><div class="lv lw l"/></div></figure><p id="9378" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是首先我们需要通过下面的命令在数据库中创建一个表。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="9cec" class="jo jp ht ku b fi ky kz l la lb">&gt;&gt; from app import db<br/>&gt;&gt; db.create_all()</span></pre><p id="c98d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以在<strong class="is hu"> pgadmin4 </strong>中通过名字Lyrics_dataset来查表。但是，在运行app.py文件之前，我们需要将收集到的数据提交到数据库中。我们还需要为我们的前端网站创建一个模板。</p><figure class="kp kq kr ks fd hk"><div class="bz dy l di"><div class="lv lw l"/></div></figure><p id="f979" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这段代码将从JSON导入数据到表<strong class="is hu">的歌词_数据集</strong>，可以从我们的网站访问。现在完成我们的后端，我们将创建一个前端访问我们的网站。</p><p id="980c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将通过Bootstrap使用免费模板<a class="ae ko" href="https://getbootstrap.com/docs/4.5/examples/blog/" rel="noopener ugc nofollow" target="_blank">博客</a>作为我们的父模板，并扩展所有网站作为子模板。您还需要将文件blog.css和bootstrap.css放在静态文件夹中，并在templates文件夹中创建所有HTML文件。</p><h2 id="2fdd" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">基础模板</h2><p id="70aa" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">这个模板，我们称之为template.html，定义了一个简单的HTML框架文档，你可以用它来创建一个简单的页面。用内容填充空白块是“子”模板的工作:</p><figure class="kp kq kr ks fd hk"><div class="bz dy l di"><div class="lv lw l"/></div></figure><p id="f567" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个例子中,{% block %}标签定义了子模板可以填充的四个块。block标签所做的只是告诉模板引擎，子模板可以覆盖模板的这些部分。</p><h2 id="fc9d" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">子模板</h2><p id="f705" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">扩展基本模板，我们还将创建替换块{% block repeated %}的其他页面:</p><figure class="kp kq kr ks fd hk er es paragraph-image"><div class="er es lx"><img src="../Images/aefc9cb6c7db4b0327bd9de615fcf9df.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/0*t6dpL0w2jINXPOIJ"/></div></figure><ul class=""><li id="904b" class="ly lz ht is b it iu ix iy jb ma jf mb jj mc jn md me mf mg bi translated">【main.html】—显示名称中带有搜索关键词的歌曲链接。</li><li id="a8cd" class="ly lz ht is b it mh ix mi jb mj jf mk jj ml jn md me mf mg bi translated"><a class="ae ko" href="https://gist.github.com/terminate9298/b8ed8ace918da054b5d72699935fb227" rel="noopener ugc nofollow" target="_blank">search.html</a>—显示歌词中带有搜索关键词的歌曲链接。</li><li id="d3d4" class="ly lz ht is b it mh ix mi jb mj jf mk jj ml jn md me mf mg bi translated"><a class="ae ko" href="https://gist.github.com/terminate9298/647ae490fa9d8636aa0e0a10fe5b1f69" rel="noopener ugc nofollow" target="_blank">singer.html</a>—按歌手显示歌曲链接。</li><li id="8edb" class="ly lz ht is b it mh ix mi jb mj jf mk jj ml jn md me mf mg bi translated"><a class="ae ko" href="https://gist.github.com/terminate9298/1cd69b90a26c2257a7cd85fb709dd835" rel="noopener ugc nofollow" target="_blank">lyrics.html</a>—按ID显示歌曲的歌词。</li><li id="5d41" class="ly lz ht is b it mh ix mi jb mj jf mk jj ml jn md me mf mg bi translated"><a class="ae ko" href="https://gist.github.com/terminate9298/fcc177e0b9a5be859586712bf8671676" rel="noopener ugc nofollow" target="_blank">index.html</a>—作为网站主页显示的索引页面。</li></ul><p id="a691" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您成功完成了这些步骤，现在就可以运行代码了。要运行Flask server，您现在可以通过键入以下命令来运行app.py:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="90b7" class="jo jp ht ku b fi ky kz l la lb">python app.py</span></pre><p id="68ee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要运行Postgre，您可以直接启动<strong class="is hu"> pgadmin4 </strong>，这将在您的系统上启动PostgreSQL服务器。</p><h1 id="facd" class="lc jp ht bd jq ld le lf ju lg lh li jy lj lk ll kb lm ln lo ke lp lq lr kh ls bi translated">查看我们的网站</h1><figure class="kp kq kr ks fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mm"><img src="../Images/9b8352746b7c054f5cffeb1ee6c8b51b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E6ayXkoPs28lX8M2"/></div></div></figure><p id="de7b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您能够使用浏览器在服务器上查看您的网站:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="7e4b" class="jo jp ht ku b fi ky kz l la lb"><a class="ae ko" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/</a></span></pre><p id="e16e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您还可以使用API获取歌曲的歌词，例如:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="bc88" class="jo jp ht ku b fi ky kz l la lb"><a class="ae ko" href="http://127.0.0.1:5000/api/lyrics/id/453" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:5000/api/lyrics/id/453</a></span></pre><blockquote class="mn mo mp"><p id="5924" class="iq ir lt is b it iu iv iw ix iy iz ja mq jc jd je mr jg jh ji ms jk jl jm jn hb bi translated"><strong class="is hu">你已经使用Flask和Postgres成功构建了一个Python Web App。</strong></p><p id="2550" class="iq ir lt is b it iu iv iw ix iy iz ja mq jc jd je mr jg jh ji ms jk jl jm jn hb bi translated">做得好…！！！</p></blockquote><h1 id="117f" class="lc jp ht bd jq ld le lf ju lg lh li jy lj lk ll kb lm ln lo ke lp lq lr kh ls bi translated">从这里继续前进。</h1><h2 id="e78d" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">教程1 —简介</h2><p id="8b07" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">在<a class="ae ko" rel="noopener" href="/@kaus.pathak_30409/beginner-to-advance-web-scraping-guide-in-python-799ffd367067">之前的教程</a>中，我们了解了网页抓取的基本概念，并创建了一个简单的函数，使用requests和BeautifulSoup从页面中提取歌词。</p><h2 id="cb34" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">教程2 —使用Python中的头池和代理循环请求。</h2><p id="c755" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">为了创建一个更大的项目，可以从互联网上删除成千上万的页面，你需要一个更清晰的工作环境，使用面向对象和继承的概念。你还需要有更详细的关于头部池和代理池的知识来保持对服务器的匿名，我们已经在本教程的第二部分<a class="ae ko" rel="noopener" href="/analytics-vidhya/beginner-to-advance-web-scraping-guide-in-python-ba24dca5dce0">中讨论过了。</a></p><h2 id="fa3f" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">教程3 —工作环境和异步I/O编程</h2><p id="cd3c" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">我们将进行异步I/O编程来提高你的报废速度，这将在本教程第三部分的<a class="ae ko" rel="noopener" href="/@kaus.pathak_30409/beginner-to-advance-web-scraping-guide-in-python-introduction-to-asynchronous-programming-24bce03dafa7?postPublishedType=initial">中介绍。</a></p><h2 id="2a4a" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">教程4 —自动化站点抓取</h2><p id="163d" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">有了之前教程中学习的所有概念，我们将在本教程第四部分的<a class="ae ko" rel="noopener" href="/@kaus.pathak_30409/beginner-to-advance-web-scraping-guide-in-python-automated-lyrics-scraper-809163f279a1">中创建实际的自动抓取器来下载并保存网页上的歌词。</a></p><h2 id="1ebf" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">教程5 — API访问</h2><p id="58be" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">为了方便地从互联网上访问歌词，我们将创建Flask API和前端来访问我们在本教程第五部分中废弃的歌词。</p><h2 id="7b31" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">教程6 —在Heroku上托管我们的Flask服务器</h2><p id="132d" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">为了方便访问歌词，我们将在本教程第六部分的Heroku上托管我们的Flask服务器。</p><figure class="kp kq kr ks fd hk er es paragraph-image"><div class="er es mt"><img src="../Images/1f56530db6ec628a86b625a753e3a90e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*dfjc4QahUIQE2U_9"/></div></figure><h1 id="15c8" class="lc jp ht bd jq ld le lf ju lg lh li jy lj lk ll kb lm ln lo ke lp lq lr kh ls bi translated">最后的话</h1><p id="b4a1" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">感谢你阅读这篇文章，我们希望听到你的反馈。请随意评论任何问题。</p><p id="3ac5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您喜欢，请为我们鼓掌:)。关注我们，获取我们的最新文章。</p></div></div>    
</body>
</html>