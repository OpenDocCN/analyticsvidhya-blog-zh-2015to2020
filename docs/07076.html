<html>
<head>
<title>Beginner to Advance — Web Scraping Guide in Python: Rotating Requests with pool of Headers and Proxies.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从初级到高级Python中的Web抓取指南:用头池和代理轮流请求。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/beginner-to-advance-web-scraping-guide-in-python-ba24dca5dce0?source=collection_archive---------2-----------------------#2020-06-13">https://medium.com/analytics-vidhya/beginner-to-advance-web-scraping-guide-in-python-ba24dca5dce0?source=collection_archive---------2-----------------------#2020-06-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/e4733ae1465514e2731787a9214ca345.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lNmGeqS7Rvo4xyb3"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">照片由<a class="ae hv" href="https://unsplash.com/@hiteshchoudhary?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">希特什·乔杜里</a>在<a class="ae hv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><div class=""/><p id="a6bd" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">web抓取工具面临的一个常见问题是在抓取时被网站屏蔽。服务器使用请求头和代理客户端识别用户，如果将客户端分类为Bot，代理客户端会阻止客户端。有许多方法可以防止阻塞，例如</p><ul class=""><li id="d34b" class="jt ju hy ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">轮换IP地址</li><li id="7528" class="jt ju hy ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">使用代理</li><li id="e4d0" class="jt ju hy ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">轮换和欺骗用户代理</li></ul><p id="1339" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将代理和轮换IP地址与轮换用户代理结合使用，可以帮助您让清除程序通过大多数防清除措施，并防止被检测为清除程序。<br/>抓取时轮换IP地址的概念很简单，你可以让网站看起来你不是一个“机器人”或一个访问网站的人，而是从多个位置访问网站的多个“真实”用户。</p><h1 id="031b" class="kh ki hy bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">教程2 —使用头池和代理轮流请求以保持匿名。</h1><h2 id="3a6b" class="lf ki hy bd kj lg lh li kn lj lk ll kr jg lm ln kv jk lo lp kz jo lq lr ld ls bi translated">第一眼</h2><p id="9282" class="pw-post-body-paragraph iv iw hy ix b iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">在<a class="ae hv" rel="noopener" href="/@kaus.pathak_30409/beginner-to-advance-web-scraping-guide-in-python-799ffd367067">之前的教程</a>中，我们学习了使用<code class="du ly lz ma mb b">requests.get</code>命令获取网页，并使用BeautifulSoup解析请求。现在为了轮换请求，我们需要在<code class="du ly lz ma mb b">Requests.get</code>中传递头和代理参数</p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="5221" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，用户代理是一个字符串，它告诉服务器你的浏览器和操作系统。Referrer告诉服务器Url被引用的位置。<br/>例如，如果您在搜索引擎上搜索页面，然后点击该网页的链接URL，推荐人将被设置为您的搜索引擎。<br/>您可以通过打开检查元素来检查您的标题详细信息。它在Firefox浏览器中看起来会像这样。</p><figure class="mc md me mf fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mi"><img src="../Images/19d0fb3e970d5e18b947c637148ae6f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qMcA6DtDiaLlHeynRRoLYw.png"/></div></div></figure><p id="5961" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里你可以看到Referer被设置为<code class="du ly lz ma mb b">https://duckduckgo.com</code>，User-Agent对于你的浏览器来说是唯一的，有很多其他的请求头。<br/>当参数代理被传递时，提供的代理将用于获取请求。在我们的项目中，我们将使用公共代理发送请求，但如果你打算放弃像谷歌或脸书这样的网站，我建议使用高级代理。现在，公共代理被定义为3类。</p><ol class=""><li id="bf57" class="jt ju hy ix b iy iz jc jd jg jv jk jw jo jx js mj jz ka kb bi translated"><strong class="ix hz">透明代理</strong>–透明代理是一种服务器，位于您的计算机和互联网之间，重定向您的请求和响应，而不修改它们。它在HTTP_X_FORWARDED_FOR标头中发送您的真实IP地址，这意味着网站不仅会确定您的远程_ADDR，还会检查特定的代理标头，这些标头仍会知道您的真实IP地址。HTTP_VIA头也被发送，表明您正在使用代理服务器。</li><li id="4df8" class="jt ju hy ix b iy kc jc kd jg ke jk kf jo kg js mj jz ka kb bi translated"><strong class="ix hz">匿名代理</strong>–匿名代理不会在HTTP_X_FORWARDED_FOR报头中发送您的真实IP地址，而是提交代理的IP地址，否则它将为空。HTTP_VIA报头是用透明代理发送的，这表明您正在使用代理服务器。匿名代理服务器不再告诉网站你的真实IP地址。这有助于保护你在互联网上的隐私。网站仍然可以看到你在使用代理服务器，但最终，只要代理服务器不透露你的真实IP地址，这并不重要。如果有人真的想限制页面访问，匿名代理服务器将被检测和阻止。</li><li id="7226" class="jt ju hy ix b iy kc jc kd jg ke jk kf jo kg js mj jz ka kb bi translated"><strong class="ix hz">精英代理</strong>–一个精英代理只发送远程_ADDR报头，其他报头为空。这会让你看起来像一个不使用代理的普通互联网用户。精英代理服务器是通过互联网上的任何限制和最大限度地保护您的隐私的理想选择。你看起来像一个居住在代理服务器所在国家的普通互联网用户。</li></ol><h2 id="c2ce" class="lf ki hy bd kj lg lh li kn lj lk ll kr jg lm ln kv jk lo lp kz jo lq lr ld ls bi translated">从互联网获取用户代理和代理的概念</h2><ol class=""><li id="408d" class="jt ju hy ix b iy lt jc lu jg mk jk ml jo mm js mj jz ka kb bi translated"><strong class="ix hz">用户代理</strong> —为了从互联网上收集用户代理，我们将使用<a class="ae hv" href="https://developers.whatismybrowser.com/" rel="noopener ugc nofollow" target="_blank">whatismybrowser.com/</a>，它收集了数百万个用户代理，并根据检测到的一些信息(操作系统、浏览器、硬件类型、浏览器类型等)对它们进行了分类。<br/>您可以手动选择几个用户代理，或者删除几百个用户代理来创建用户代理的投票，完整的代码如下所示。</li><li id="0884" class="jt ju hy ix b iy kc jc kd jg ke jk kf jo kg js mj jz ka kb bi translated"><strong class="ix hz">代理</strong>——有很多网站可以让你在报废时免费使用代理。其中一些是<a class="ae hv" href="http://pubproxy.com/" rel="noopener ugc nofollow" target="_blank">public proxy</a>、<a class="ae hv" href="https://www.proxyscrape.com/home" rel="noopener ugc nofollow" target="_blank"> ProxyScrape </a>、<a class="ae hv" href="https://free-proxy-list.net/" rel="noopener ugc nofollow" target="_blank"> free-proxy-list </a>。<br/>您需要创建功能来废弃这些网站，因为它们需要在整个程序中不断废弃。</li><li id="1964" class="jt ju hy ix b iy kc jc kd jg ke jk kf jo kg js mj jz ka kb bi translated"><strong class="ix hz">日志</strong> —为了维护自动化项目，我们需要在Python中设置日志功能，以便在运行脚本时检查进度和错误。如果你过去没有练习过日志，我鼓励你少练习日志。你可以看看<a class="ae hv" href="https://docs.python.org/2/howto/logging.html" rel="noopener ugc nofollow" target="_blank">官方文档</a>和<a class="ae hv" href="https://www.geeksforgeeks.org/logging-in-python/" rel="noopener ugc nofollow" target="_blank">极客论坛</a>来寻求一些支持。</li><li id="1f1e" class="jt ju hy ix b iy kc jc kd jg ke jk kf jo kg js mj jz ka kb bi translated"><strong class="ix hz"> Python OOP的概念</strong> —我们将使用<a class="ae hv" href="https://www.javatpoint.com/python-oops-concepts" rel="noopener ugc nofollow" target="_blank">面向对象编程</a>的概念，如继承，在我们的程序中创建类和对象。</li><li id="d87b" class="jt ju hy ix b iy kc jc kd jg ke jk kf jo kg js mj jz ka kb bi translated"><strong class="ix hz"> JSON概念— </strong>将输出数据保存在驱动器中。</li></ol><h2 id="ee6a" class="lf ki hy bd kj lg lh li kn lj lk ll kr jg lm ln kv jk lo lp kz jo lq lr ld ls bi translated">第一次看我们的工作目录</h2><figure class="mc md me mf fd hk er es paragraph-image"><div class="er es mn"><img src="../Images/de21141a9578ae9c20d24894b2048454.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*GzKqRUUE4NQNyIzmUT3oGQ.png"/></div></figure><ul class=""><li id="b9a4" class="jt ju hy ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">bin —编写代码类和函数。</li><li id="7679" class="jt ju hy ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">json_data —将已处理和未处理的数据存储到磁盘。</li><li id="3908" class="jt ju hy ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">log_data —检查脚本中的进度和错误。</li><li id="7fb4" class="jt ju hy ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">main.py —我们将在其中执行程序的主文件。</li></ul><p id="24a8" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们还需要创建脚本来将数据放入JSON中。您可以使用您的格式，但下面的代码运行并准备每个JSON供将来使用。</p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mg mh l"/></div></figure><h1 id="2ccb" class="kh ki hy bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">工作码</h1><p id="c8f3" class="pw-post-body-paragraph iv iw hy ix b iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">这些都将帮助你轻松地维护数据的其余部分。您可以从代码中提供的链接中删除用户代理，或者从这里下载删除的数据。</p><figure class="mc md me mf fd hk"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="5840" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你成功地在<em class="mo"> bin/proxies.py </em>中编译这个脚本，这将从互联网上保存代理的碎片，并以JSON格式保存。您可以在<em class="mo">log _ data/proxy . log<br/></em>程序中检查项目进度，使用free-proxy-list.com来废弃最新的代理，但是您可以使用pubproxy或proxyscrape来废弃最新的代理，但是<em class="mo"> get_free_p_l() </em>工作正常。</p></div><div class="ab cl mp mq gp mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="hb hc hd he hf"><blockquote class="mw mx my"><p id="9d17" class="iv iw mo ix b iy iz ja jb jc jd je jf mz jh ji jj na jl jm jn nb jp jq jr js hb bi translated"><strong class="ix hz">您已经成功创建了在报废时更改代理和头的类。做得好…！！！</strong></p></blockquote><h1 id="a229" class="kh ki hy bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">从这里继续前进。</h1><h2 id="53ed" class="lf ki hy bd kj lg lh li kn lj lk ll kr jg lm ln kv jk lo lp kz jo lq lr ld ls bi translated">教程1 —简介</h2><p id="7254" class="pw-post-body-paragraph iv iw hy ix b iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">在<a class="ae hv" rel="noopener" href="/@kaus.pathak_30409/beginner-to-advance-web-scraping-guide-in-python-799ffd367067">之前的教程</a>中，我们了解了网页抓取的基本概念，并创建了一个简单的函数，使用requests和BeautifulSoup从页面中提取歌词。</p><h2 id="94ac" class="lf ki hy bd kj lg lh li kn lj lk ll kr jg lm ln kv jk lo lp kz jo lq lr ld ls bi translated">教程2 —使用Python中的头池和代理循环请求。</h2><p id="6bbb" class="pw-post-body-paragraph iv iw hy ix b iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">为了创建一个更大的项目，可以从互联网上删除成千上万的页面，你需要一个更清晰的工作环境，使用面向对象和继承的概念。你还需要有更详细的关于头文件池和代理池的知识来保持对服务器的匿名，我们已经在本教程的第二部分介绍过了。</p><h2 id="b57c" class="lf ki hy bd kj lg lh li kn lj lk ll kr jg lm ln kv jk lo lp kz jo lq lr ld ls bi translated">教程3 —工作环境和异步I/O编程</h2><p id="7464" class="pw-post-body-paragraph iv iw hy ix b iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">我们将进行异步I/O编程来提高你的报废速度，这将在本教程第三部分中讨论。</p><h2 id="fb47" class="lf ki hy bd kj lg lh li kn lj lk ll kr jg lm ln kv jk lo lp kz jo lq lr ld ls bi translated">教程4 —自动化站点抓取</h2><p id="c3fa" class="pw-post-body-paragraph iv iw hy ix b iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">有了之前教程中学习的所有概念，我们将在本教程第四部分的<a class="ae hv" rel="noopener" href="/@kaus.pathak_30409/beginner-to-advance-web-scraping-guide-in-python-automated-lyrics-scraper-809163f279a1">中创建实际的自动抓取器来下载并保存网页上的歌词。</a></p><h2 id="43cd" class="lf ki hy bd kj lg lh li kn lj lk ll kr jg lm ln kv jk lo lp kz jo lq lr ld ls bi translated">教程5 — API访问</h2><p id="3d52" class="pw-post-body-paragraph iv iw hy ix b iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">为了方便地从网上访问歌词，我们将创建Flask API和前端来访问我们在本教程第五部分的<a class="ae hv" rel="noopener" href="/analytics-vidhya/beginner-to-advance-web-scraping-guide-in-python-build-and-deploy-a-python-web-app-using-flask-202ffdf8fd40">中废弃的歌词。</a></p><h2 id="11be" class="lf ki hy bd kj lg lh li kn lj lk ll kr jg lm ln kv jk lo lp kz jo lq lr ld ls bi translated">教程6 —在Heroku上托管我们的Flask服务器</h2><p id="a8da" class="pw-post-body-paragraph iv iw hy ix b iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">为了提供容易的歌词访问，我们将在本教程的第六部分通过Heroku托管我们的Flask服务器。</p><figure class="mc md me mf fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nc"><img src="../Images/e9cefb0f73f0343305bfae9dc848f153.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*378uvUh61PtXDtFj"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">皮特·佩德罗萨在<a class="ae hv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="b14e" class="kh ki hy bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">最后的话</h1><p id="2b8d" class="pw-post-body-paragraph iv iw hy ix b iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">感谢你阅读这篇文章，我们希望听到你的反馈。请随意评论任何问题。如果您喜欢，请为我们鼓掌:)。关注我们，获取我们的最新文章。</p></div></div>    
</body>
</html>