<html>
<head>
<title>PAIRWISE RANKING : EPL PREDICTION — Part2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">成对排序:EPL预测——第二部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/pairwise-ranking-epl-prediction-part2-756542b85c2b?source=collection_archive---------28-----------------------#2020-09-28">https://medium.com/analytics-vidhya/pairwise-ranking-epl-prediction-part2-756542b85c2b?source=collection_archive---------28-----------------------#2020-09-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="d719" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">概观</h1><p id="edd7" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">成对排名在搜索排名优化、产品比较等领域有多种应用。与传统的累积比较相比，我们可以说A比B/C/D好n%,等等..还通过相应的相关性对每个变量的影响进行优先排序。该方法背后的理论在本系列的上一篇文章中有详细介绍:<a class="ae kb" rel="noopener" href="/@davidacad10/pairwise-ranking-epl-prediction-3ce755575958">https://medium . com/@ David acad 10/pairwise-ranking-EPL-prediction-3ce 75575958</a></p><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es kc"><img src="../Images/7e1f0918fe574c4c5842ea9d2a5ece27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*joud8awCYR8jBVedFCRHXg.png"/></div></div><figcaption class="ko kp et er es kq kr bd b be z dx translated">图片作者:thinkersnewsng</figcaption></figure><p id="1ca7" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">假设，我们现在对如何在幕后应用成对排名有了一个简单的想法，我们将有一个有趣的应用，我们试图预测2020-21赛季结束时英超联赛的积分榜。我们用来给球队排名的参数将是最近5场比赛的结果。当应用于2019-20赛季的验证时，看到它与真正的积分榜有多接近是非常有趣的。</p><h1 id="a9e0" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">诉讼案件</h1><p id="38a0" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们用来给球队排名的参数是每支球队在过去5场比赛中的比分。胜一场奖励3，平一场，输0，就像在EPL一样。所以一个团队的最高分是15分，最低分是0分。我们的目标是在赛季结束时预测最终排名，在赛季开始时甚至没有一场比赛。[我们可以尝试更实时的比赛模型，通过比赛预测稍后:D]。</p><p id="0b23" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">正如在每个数据科学问题中一样，重要的部分是准备好数据。有相当多的好消息来源。我已经从football.com收集了2004年的比赛结果，并整理成一个文件。您可以在以下位置访问回购:</p><p id="339c" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated"><a class="ae kb" href="https://github.com/davidacad10/EPL_Analytics/tree/master/Pairwise_Ranking." rel="noopener ugc nofollow" target="_blank">https://github . com/David acad 10/EPL _分析/tree/master/Pairwise _排名。</a></p><p id="96cc" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">让我们加载数据并开始:</p><pre class="kd ke kf kg fd kx ky kz la aw lb bi"><span id="b7af" class="lc ig hi ky b fi ld le l lf lg">library(rio)<br/>library(dplyr)<br/>library(xgboost)<br/>library(knitr)</span><span id="3e4b" class="lc ig hi ky b fi lh le l lf lg">rm(list = ls())<br/>data=import("Pairwise_Ranking_Data.xlsx")<br/>data=data%&gt;%<br/>     mutate(Season_Start_Date=as.Date(Season_Start_Date)<br/>          ,Season_End_Date=as.Date(Season_End_Date)<br/>          ,Prev_SSD=as.Date(Prev_SSD)<br/>          ,Prev_SED1=as.Date(Prev_SED1))</span></pre><p id="7887" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">数据框具有来自2004赛季的H2H结果，评级如前所述。在赛季的第一周，H2H是上赛季的。因此，对于每个赛季N，排名将是球队在赛季N+1的最终排名。例如，在2018-19赛季结束时，切尔西队领先曼城队9分，领先利物浦队6分，但他们在接下来的2019-20赛季中获得了第三名。因此，对于团队Ti，在赛季N结束时所有团队T的H2H将是用于预测赛季N+1中排名的参数。</p><p id="d70b" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">让我们把数据分成训练和测试。在2012-13赛季之后，EPL发生了变化，所有的球队都变得非常有竞争力。所以我们可以选取2013-14赛季到2018-19赛季的训练数据。我们可以测试为2019-20赛季创建的模型，因为许多原因(新冠肺炎，利物浦夺冠等)，2019-20赛季本身可以被称为异常赛季。:D)。</p><pre class="kd ke kf kg fd kx ky kz la aw lb bi"><span id="6ad6" class="lc ig hi ky b fi ld le l lf lg">train=data%&gt;%filter(Prev_SSD&lt;=as.Date('2018-08-10'))%&gt;%<br/>      filter(Prev_SSD&gt;=as.Date('2013-08-01'))<br/> <br/>test1=data%&gt;%filter(Prev_SSD&gt;as.Date('2018-08-10'))</span><span id="ae1f" class="lc ig hi ky b fi lh le l lf lg">##Getting the previous records available for the promoted teams<br/>##And adding into the 17 other teams to have the whole 20 team ##records</span><span id="2276" class="lc ig hi ky b fi lh le l lf lg">promoted=c("Norwich","Sheffield United","Aston Villa")</span><span id="9b22" class="lc ig hi ky b fi lh le l lf lg">test2=data%&gt;%filter(Team1%in%promoted)%&gt;%<br/>   ungroup()%&gt;%<br/>   group_by(Team1)%&gt;%<br/>   arrange(desc(Season_Start_Date))%&gt;%<br/>   mutate(rpp=row_number())%&gt;%<br/>   filter(rpp==1)%&gt;%<br/>   select(-rpp)</span><span id="4dcc" class="lc ig hi ky b fi lh le l lf lg">test=bind_rows(test1,test2)<br/> <br/> <br/>train_data=train%&gt;%ungroup()%&gt;%select(Arsenal:Wolves)<br/>test_data=test%&gt;%ungroup()%&gt;%select(Arsenal:Wolves)<br/>target=as.numeric(as.character(train$Rank))</span><span id="b9f3" class="lc ig hi ky b fi lh le l lf lg">set.seed(1000)<br/>xgbTrain &lt;- xgb.DMatrix(as.matrix(train_data), label = train$Rank)<br/>xgbTest &lt;- xgb.DMatrix(as.matrix(test_data))</span><span id="3b87" class="lc ig hi ky b fi lh le l lf lg">##No extra parameter tuning being applied except ntress=5000 and<br/>#early stopping round as 20 <br/>params &lt;- list(booster = 'gbtree',<br/>                objective = 'rank:pairwise')<br/> <br/>##Metric used is NDCG as described in tutorial<br/>rankModel &lt;- xgb.train(params, xgbTrain, 5000, watchlist = list(tr = xgbTrain), eval_metric = 'ndcg',early_stopping_rounds = 20)</span><span id="f0aa" class="lc ig hi ky b fi lh le l lf lg">## Stopping. Best iteration:<br/>## [55] tr-ndcg:0.983104</span><span id="324f" class="lc ig hi ky b fi lh le l lf lg">##Predicting The Model on Test Data for 2019-20</span><span id="26ec" class="lc ig hi ky b fi lh le l lf lg">pred=(predict(rankModel, xgbTest,reshape = TRUE))<br/> <br/>test$Pred=pred<br/>test_pred=test%&gt;%<br/>   ungroup()%&gt;%<br/>   select(Team1,Prev_SSD1,Rank,Pred)%&gt;%<br/>   arrange(Pred)%&gt;%<br/>   mutate(Pred_Rank=row_number(),<br/>          Probability=1/(1+exp(Pred)))%&gt;%<br/>   select(Prev_SSD1,Team1,Rank,Pred_Rank,Pred,Probability)%&gt;%<br/>rename(Actual_Rank=Rank,Title_Probability=Probability,Season_Start=Prev_SSD1)</span><span id="38c5" class="lc ig hi ky b fi lh le l lf lg">##Print the prediction frame<br/>view(test_pred)</span></pre><p id="047f" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated"><strong class="jf hj">2019–20赛季预测</strong></p><figure class="kd ke kf kg fd kh"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="d652" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated"><em class="lk">瞧</em>。我们能够正确地获得冠军和亚军。请注意，在所有的训练数据中，利物浦排名第一，但只有曼城、切尔西和莱斯特。该模型能够通过观察利物浦在单挑中的进步来发现他们能够超越的模式。我们3点面对托特纳姆，他们获得了第六名(有趣的是吧！).尽管这是一个淡季，上赛季他们甚至进入了前4名和UCL决赛，但他们经历了有史以来最好的一个赛季。考虑到这个离群值，曼联和切尔西的下一个排名是正确的。</p><p id="3f6f" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">lambda rank方法为最高评级提供了比最低评级更多的普遍性。虽然，除了狼队(由于数据不多)，倒数5名中有4名处于降级战中，其中2名确实降级了。</p><p id="5ecf" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">现在我们已经看到了上赛季预测的准确性，让我们看看赛季末会是什么情况。</p><pre class="kd ke kf kg fd kx ky kz la aw lb bi"><span id="cf2c" class="lc ig hi ky b fi ld le l lf lg">##Load the 2020–21 prediction data<br/>newtest=import(“Pairwise_Ranking_Data_Pred_2020_data.xlsx”)<br/>rel=c(‘Norwich’,’Watford’,’Bournemouth’)</span><span id="a00a" class="lc ig hi ky b fi lh le l lf lg">newtest=newtest%&gt;%filter(!Team1%in%rel)<br/>newtest2=newtest%&gt;%select(-Team1)</span><span id="f927" class="lc ig hi ky b fi lh le l lf lg">newtest_xgb &lt;- xgb.DMatrix(as.matrix(newtest2))<br/>pred=(predict(rankModel, newtest_xgb,reshape = TRUE))</span><span id="0268" class="lc ig hi ky b fi lh le l lf lg">newtest$Pred=pred<br/>newtest_pred=newtest%&gt;%<br/>             ungroup()%&gt;%<br/>             select(Team1,Pred)%&gt;%<br/>             arrange(Pred)%&gt;%<br/> mutate(Prev_SSD1=as.character(‘2020–09–12’),Pred_Rank=row_number(),<br/> Probability=1/(1+exp(Pred)))%&gt;%<br/> select(Prev_SSD1,Team1,Pred_Rank,Pred,Probability)%&gt;%<br/> rename(Title_Probability=Probability,Season_Start=Prev_SSD1)</span><span id="55e1" class="lc ig hi ky b fi lh le l lf lg">##Print the 2020-21 season prediction<br/>view(newtest_pred)</span></pre><p id="8ffb" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated"><strong class="jf hj">2020–21赛季预测</strong></p><figure class="kd ke kf kg fd kh"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="a6cc" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">注意到这个预测没有利兹，因为他们是2002年后第一次在EPL。有19支球队参赛，切尔西有望夺冠，利物浦第二，曼联第三，曼城第四。随着切尔西的新签约，他们事实上可以瞄准它。虽然对于一个被足球困扰的人来说，很难接受曼城只获得第四名，而曼城或者利物浦没有赢得联赛冠军。但是数字不会说谎。祈祷:D</p><p id="fc2f" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">对于保级之战，预计将在富勒姆、西布朗、水晶宫和阿斯顿维拉之间展开。注意到这4人中有3人是在过去两个赛季中晋级的。</p><h1 id="61d3" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">结论</h1><p id="303e" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">该预测实际上可能存在一些偏差:</p><ul class=""><li id="217f" class="ll lm hi jf b jg ks jk kt jo ln js lo jw lp ka lq lr ls lt bi translated">考虑中的参数是最近两个赛季的有效对抗。这还没有考虑到转会对球队变化的影响</li><li id="9fe4" class="ll lm hi jf b jg lu jk lv jo lw js lx jw ly ka lq lr ls lt bi translated">更多的优先权被提供来正确地得到最高的等级超过最低的等级</li><li id="0464" class="ll lm hi jf b jg lu jk lv jo lw js lx jw ly ka lq lr ls lt bi translated">像利兹这样的新加入EPL的球队没有相关的数据，因为我们认为EPL是一对一的，所以不能加入</li></ul><p id="0185" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">既然我们已经完成了一个很酷的成对排序应用程序，我相信我们在应用程序方面也做得很好。事实上，除了xgboost之外，还有许多其他的包可供使用，如果您感兴趣的话，可以选择它们。如果你想集思广益，看看这篇文章</p><p id="75c7" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated"><a class="ae kb" rel="noopener" href="/@davidacad10/pairwise-ranking-epl-prediction-3ce755575958">https://medium . com/@ David acad 10/pairwise-ranking-EPL-prediction-3ce 755575958</a></p></div></div>    
</body>
</html>