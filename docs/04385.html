<html>
<head>
<title>REST API with Deno</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带Deno的REST API</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/rest-api-with-deno-1e23b5bad1bd?source=collection_archive---------12-----------------------#2020-03-17">https://medium.com/analytics-vidhya/rest-api-with-deno-1e23b5bad1bd?source=collection_archive---------12-----------------------#2020-03-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/610f056725b8be16c92b2ff71d3fa36a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QUK98koeh35lz7kz13RIgg.jpeg"/></div></div></figure><h1 id="d6d1" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">什么是Deno，它的主要特征是什么？</h1><p id="16ac" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated"><strong class="jq hj"> Deno </strong>是JavaScript和TypeScript的运行时，基于V8 JavaScript引擎和Rust编程语言。它是由Node的最初创建者<strong class="jq hj">瑞安·达尔</strong>创建的。js，并且专注于安全性和生产力。</p><p id="3f1e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">它由以下材料制成:</p><ul class=""><li id="7709" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">Rust (Deno的内核用Rust编写，Node的用C++)</li><li id="aa9e" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">Tokio(用Rust编写的事件循环)</li><li id="ced8" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">TypeScript (Deno支持JavaScript和现成的TypeScript)</li><li id="f39f" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">V8(谷歌在Chrome和Node等平台上使用的JavaScript运行时)</li></ul><p id="6333" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">尽管如此，Deno仍处于开发阶段，它有许多缺陷。但是我们可以使用Deno构建简单的REST API。Deno项目中也没有node_modules。</p><p id="3073" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在这里，我将向您展示如何使用Deno构建一个带有CRUD操作的简单REST API。我不打算使用任何数据库和所有存储在JSON文件中的数据。</p><p id="faf3" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">首先，我们需要在电脑上安装Deno。你可以根据你的操作系统参考<a class="ae lf" href="https://deno.land/" rel="noopener ugc nofollow" target="_blank">https://deno.land/</a>来实现。</p><p id="7a70" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在windows中打开power shell，复制并粘贴它</p><p id="2035" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><code class="du lg lh li lj b">iwr https://deno.land/x/install/install.ps1 -useb | iex</code></p><p id="e126" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">命令并按回车键(这将需要一些时间)</p><h1 id="2e64" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">文件夹和文件结构</h1><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es lk"><img src="../Images/724e33449f0d86b24bdd3a26d6054183.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*cu4zn25EsKtwHZeaAg8c_Q.png"/></div></figure><p id="0f39" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">由于Deno中没有node_modules，我们需要从互联网上导入库和依赖项。</p><p id="5b5b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">让我们构建我们的REST API(忽略截图中的红色下划线，我没有在vs代码中安装Deno扩展)</p><p id="178e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">首先，我们创建主文件(index.ts)</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/03583f4da28c850ff811fbea1595f417.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WSa4DZFYr7grCgnHjIfs1g.png"/></div></div></figure><pre class="ll lm ln lo fd lq lj lr ls aw lt bi"><span id="f0ef" class="lu ir hi lj b fi lv lw l lx ly">// oak is pretty much similar to express in nodejs<br/>import { Application } from “https://deno.land/x/oak/mod.ts";</span><span id="6d37" class="lu ir hi lj b fi lz lw l lx ly">// Import App host and Port from config file<br/>import { APP_HOST, APP_PORT } from “./config/config.ts”;</span><span id="52da" class="lu ir hi lj b fi lz lw l lx ly">// Import router from routes file<br/>import router from ‘./routes/routes.ts’;</span><span id="e708" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Create Application Like Express<br/></em>const app = new Application()</span><span id="b5cb" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Add Routes<br/></em>app.use(router.routes())<br/>app.use(router.allowedMethods())</span><span id="fbb3" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Display App running<br/></em>console.log(`App Started at Port ${APP_PORT}`)</span><span id="5029" class="lu ir hi lj b fi lz lw l lx ly">await app.listen(`${APP_HOST}:${APP_PORT}`)</span></pre><p id="9529" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj"> config/config.ts </strong>文件</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/5bd58d39a182911eb6debb50ad01e715.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LFqQb77zuWgNYCZZlhDmKg.png"/></div></div></figure><pre class="ll lm ln lo fd lq lj lr ls aw lt bi"><span id="2f8c" class="lu ir hi lj b fi lv lw l lx ly">const env = Deno.env();</span><span id="18e3" class="lu ir hi lj b fi lz lw l lx ly">export const APP_HOST = env.APP_HOST || "127.0.0.1";</span><span id="9a68" class="lu ir hi lj b fi lz lw l lx ly">export const APP_PORT = env.APP_PORT || 5000;</span><span id="16dc" class="lu ir hi lj b fi lz lw l lx ly">export const DB_PATH = env.DB_PATH || "./db/todos.json";</span></pre><p id="a2f9" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj"> models/todos.ts </strong>文件</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/daa441e50bf74505d39828ab2cb64d45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*oIJr7LoNVmPdSZQnQpEFRQ.png"/></div></figure><pre class="ll lm ln lo fd lq lj lr ls aw lt bi"><span id="c04e" class="lu ir hi lj b fi lv lw l lx ly">export default interface ToDos {</span><span id="c3e3" class="lu ir hi lj b fi lz lw l lx ly">   id: string;</span><span id="3c83" class="lu ir hi lj b fi lz lw l lx ly">   title: string;</span><span id="d5e2" class="lu ir hi lj b fi lz lw l lx ly">   description: string;</span><span id="d2cc" class="lu ir hi lj b fi lz lw l lx ly">}</span></pre><p id="4473" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj"> routes/routes.ts </strong>文件</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/5635c0fc2d6ff1ed283f22a0dd4658f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6gSnzA-6ldxqfuJ2miZY0g.png"/></div></div></figure><pre class="ll lm ln lo fd lq lj lr ls aw lt bi"><span id="97bb" class="lu ir hi lj b fi lv lw l lx ly">import { Router } from "https://deno.land/x/oak/mod.ts";</span><span id="9c46" class="lu ir hi lj b fi lz lw l lx ly">import getTodos from './todos/getTodos.ts';</span><span id="355a" class="lu ir hi lj b fi lz lw l lx ly">import getTodo from './todos/getTodo.ts';</span><span id="8b73" class="lu ir hi lj b fi lz lw l lx ly">import addTodo from './todos/addTodos.ts';</span><span id="9d77" class="lu ir hi lj b fi lz lw l lx ly">import deleteTodo from './todos/deleteTodo.ts';</span><span id="9654" class="lu ir hi lj b fi lz lw l lx ly">import editTodo from './todos/editTodo.ts';<br/></span><span id="8aec" class="lu ir hi lj b fi lz lw l lx ly">const router = new Router()</span><span id="b74c" class="lu ir hi lj b fi lz lw l lx ly">router.get('/todos', getTodos)<br/></span><span id="4f02" class="lu ir hi lj b fi lz lw l lx ly">router.get('/todo/:id', getTodo)</span><span id="3048" class="lu ir hi lj b fi lz lw l lx ly">router.post('/addTodo', addTodo)</span><span id="cbab" class="lu ir hi lj b fi lz lw l lx ly">router.put('/editTodo/:id', editTodo)</span><span id="3d76" class="lu ir hi lj b fi lz lw l lx ly">router.delete('/deleteTodo/:id', deleteTodo)</span><span id="618d" class="lu ir hi lj b fi lz lw l lx ly">export default router;</span></pre><p id="9935" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj"> db/todos.json </strong>文件</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/981c23ed69606a71b95710f910866105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lWnO6Oekv7aDqYa0co0BSA.png"/></div></div></figure><pre class="ll lm ln lo fd lq lj lr ls aw lt bi"><span id="2bdf" class="lu ir hi lj b fi lv lw l lx ly">[</span><span id="1184" class="lu ir hi lj b fi lz lw l lx ly">{</span><span id="07c7" class="lu ir hi lj b fi lz lw l lx ly">"id":"010fbf79-048e-4508-ac65-5c8b326aa026",</span><span id="1cd3" class="lu ir hi lj b fi lz lw l lx ly">"title":"Learn TypeScript",</span><span id="a7a4" class="lu ir hi lj b fi lz lw l lx ly">"description":"TypeScript is typed version of JavaScript"</span><span id="2bb8" class="lu ir hi lj b fi lz lw l lx ly">},</span><span id="18e8" class="lu ir hi lj b fi lz lw l lx ly">{</span><span id="f4a2" class="lu ir hi lj b fi lz lw l lx ly">"id":"38bd9aad-4047-47e1-b879-7a9ab77761c5",</span><span id="5c6b" class="lu ir hi lj b fi lz lw l lx ly">"title":"Learn React",</span><span id="a6bb" class="lu ir hi lj b fi lz lw l lx ly">"description":"React is a Front-End web Library"</span><span id="2fe5" class="lu ir hi lj b fi lz lw l lx ly">},</span><span id="ef57" class="lu ir hi lj b fi lz lw l lx ly">{</span><span id="21fa" class="lu ir hi lj b fi lz lw l lx ly">"id":"81ded252-661c-4fb1-a1e0-aad717b84891",</span><span id="10df" class="lu ir hi lj b fi lz lw l lx ly">"title":"Learn Deno",</span><span id="ba28" class="lu ir hi lj b fi lz lw l lx ly">"description":"Deno is the next version of nodejs"</span><span id="b9e0" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="810d" class="lu ir hi lj b fi lz lw l lx ly">]</span></pre><p id="3a85" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj"> db/db.ts </strong>(我们从todos.json文件中添加和获取数据的地方)文件</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/ca2b90225048a4789a5d7f3627d9cd03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pym3JbunOfWqKN9Wts5XLw.png"/></div></div></figure><pre class="ll lm ln lo fd lq lj lr ls aw lt bi"><span id="9a10" class="lu ir hi lj b fi lv lw l lx ly">import { DB_PATH } from '../config/config.ts';</span><span id="7e14" class="lu ir hi lj b fi lz lw l lx ly">import ToDos from '../models/todos.ts';</span><span id="2ff4" class="lu ir hi lj b fi lz lw l lx ly">export const getTodosFromJson: () =&gt; Promise&lt;ToDos[]&gt; = async () =&gt;{</span><span id="4046" class="lu ir hi lj b fi lz lw l lx ly">try {</span><span id="8bca" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Read Files In Deno<br/></em>const data: any = await Deno.readFile(DB_PATH);</span><span id="d138" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Decode Data From File<br/></em>const decode = new TextDecoder()</span><span id="4491" class="lu ir hi lj b fi lz lw l lx ly">const decodedData = decode.decode(data)</span><span id="0128" class="lu ir hi lj b fi lz lw l lx ly">return JSON.parse(decodedData)</span><span id="2efa" class="lu ir hi lj b fi lz lw l lx ly">} catch (err) {</span><span id="6ca2" class="lu ir hi lj b fi lz lw l lx ly">console.error(err.message);</span><span id="c2ab" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="7fff" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="66f0" class="lu ir hi lj b fi lz lw l lx ly">export const writeDataToJson: (<em class="ma">todos</em>: ToDos[]) =&gt; Promise&lt;void&gt; = async (<em class="ma">todos</em>: ToDos[]): Promise&lt;void&gt; =&gt; {</span><span id="54c8" class="lu ir hi lj b fi lz lw l lx ly">try {</span><span id="dd4f" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// encode Json</em></span><span id="9899" class="lu ir hi lj b fi lz lw l lx ly">const encode = new TextEncoder();</span><span id="bd96" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Write Files in Deno</em></span><span id="b4f8" class="lu ir hi lj b fi lz lw l lx ly">await Deno.writeFile(DB_PATH, encode.encode(JSON.stringify(<em class="ma">todos</em>)))</span><span id="9f49" class="lu ir hi lj b fi lz lw l lx ly">} catch (err) {</span><span id="617e" class="lu ir hi lj b fi lz lw l lx ly">console.error(err.message);</span><span id="27aa" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="a211" class="lu ir hi lj b fi lz lw l lx ly">}</span></pre><p id="ca4b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">routes/todos/gettodos . ts</strong>文件</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/ef94257b0d11a4c379928d8527019d31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TOQDMmslxCPC2VOZJ2liAw.png"/></div></div></figure><pre class="ll lm ln lo fd lq lj lr ls aw lt bi"><span id="70eb" class="lu ir hi lj b fi lv lw l lx ly">import { Response } from "https://deno.land/x/oak/mod.ts";</span><span id="c78c" class="lu ir hi lj b fi lz lw l lx ly">import ToDos from '../../models/todos.ts';</span><span id="96fe" class="lu ir hi lj b fi lz lw l lx ly">import id from '../../services/createIds.ts'</span><span id="ea43" class="lu ir hi lj b fi lz lw l lx ly">import { getTodosFromJson } from '../../db/db.ts';</span><span id="c043" class="lu ir hi lj b fi lz lw l lx ly">const getTodos = async ({ <em class="ma">response</em> }: { response: Response }) =&gt; {</span><span id="89cc" class="lu ir hi lj b fi lz lw l lx ly">try {</span><span id="7354" class="lu ir hi lj b fi lz lw l lx ly">const todos: ToDos[] = await getTodosFromJson()</span><span id="650b" class="lu ir hi lj b fi lz lw l lx ly">response.body = todos;</span><span id="7911" class="lu ir hi lj b fi lz lw l lx ly">} catch (err) {</span><span id="061f" class="lu ir hi lj b fi lz lw l lx ly">console.error(err.message);</span><span id="b4ab" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="b313" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="8c4b" class="lu ir hi lj b fi lz lw l lx ly">export default getTodos</span></pre><p id="bb83" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">routes/todos/gettodo . ts</strong>文件</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/c2e26924658e438d1664c24cae492375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ZQRvT2zuWwPiN5HcXq1JQ.png"/></div></div></figure><pre class="ll lm ln lo fd lq lj lr ls aw lt bi"><span id="bd4c" class="lu ir hi lj b fi lv lw l lx ly">import { Response } from "https://deno.land/x/oak/mod.ts";</span><span id="b4e8" class="lu ir hi lj b fi lz lw l lx ly">import { getTodosFromJson } from '../../db/db.ts';</span><span id="b0f5" class="lu ir hi lj b fi lz lw l lx ly">const getTodo = async ({ <em class="ma">params</em>, <em class="ma">response</em> }: { params: any, response: Response }) =&gt; {</span><span id="586e" class="lu ir hi lj b fi lz lw l lx ly">const id = params?.id</span><span id="acee" class="lu ir hi lj b fi lz lw l lx ly">if (!id) {</span><span id="75a7" class="lu ir hi lj b fi lz lw l lx ly">response.status = 400;</span><span id="5524" class="lu ir hi lj b fi lz lw l lx ly">response.body = { msg: 'Invalid Id' }</span><span id="8274" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="f4a1" class="lu ir hi lj b fi lz lw l lx ly">const todos = await getTodosFromJson()</span><span id="11ff" class="lu ir hi lj b fi lz lw l lx ly">const todo = todos.find(<em class="ma">todo</em> =&gt; <em class="ma">todo</em>.id === id)</span><span id="204a" class="lu ir hi lj b fi lz lw l lx ly">if (!todo) {</span><span id="7006" class="lu ir hi lj b fi lz lw l lx ly">response.status = 404;</span><span id="fe5c" class="lu ir hi lj b fi lz lw l lx ly">response.body = { msg: `No Todo Found on ${id}` }</span><span id="7614" class="lu ir hi lj b fi lz lw l lx ly">return;</span><span id="7d49" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="9283" class="lu ir hi lj b fi lz lw l lx ly">response.status = 200;</span><span id="1792" class="lu ir hi lj b fi lz lw l lx ly">response.body = todo;</span><span id="db4b" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="dcb2" class="lu ir hi lj b fi lz lw l lx ly">export default getTodo</span></pre><p id="514f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">routes/todos/addtodos . ts</strong>文件</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/e39c0c46b74bdc0972c716298f551c6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QvHRMp4VZdMshL-Rz4WDVQ.png"/></div></div></figure><pre class="ll lm ln lo fd lq lj lr ls aw lt bi"><span id="ad09" class="lu ir hi lj b fi lv lw l lx ly">import { Request, Response } from "https://deno.land/x/oak/mod.ts";</span><span id="bc14" class="lu ir hi lj b fi lz lw l lx ly">import { v4 as uuid } from "https://deno.land/std/uuid/mod.ts";</span><span id="9e5d" class="lu ir hi lj b fi lz lw l lx ly">import ToDos from '../../models/todos.ts';</span><span id="8a7f" class="lu ir hi lj b fi lz lw l lx ly">import { writeDataToJson, getTodosFromJson } from '../../db/db.ts';</span><span id="a39a" class="lu ir hi lj b fi lz lw l lx ly">const addTodo = async ({ <em class="ma">request</em>, <em class="ma">response</em> }: { request: Request, response: Response }) =&gt; {</span><span id="0bc9" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Check Request Has a body or not</em></span><span id="7896" class="lu ir hi lj b fi lz lw l lx ly">if (!request.hasBody) {</span><span id="7e98" class="lu ir hi lj b fi lz lw l lx ly">response.status = 400;</span><span id="cce2" class="lu ir hi lj b fi lz lw l lx ly">response.body = { msg: "Invalid data, Please Add Title and Description" };</span><span id="40cc" class="lu ir hi lj b fi lz lw l lx ly">return;</span><span id="b231" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="5f23" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Get Title and description from Request</em></span><span id="b307" class="lu ir hi lj b fi lz lw l lx ly">const {</span><span id="5c0b" class="lu ir hi lj b fi lz lw l lx ly">value: { title, description }</span><span id="4151" class="lu ir hi lj b fi lz lw l lx ly">} = await request.body();</span><span id="a848" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Check title and description is valid</em></span><span id="72e8" class="lu ir hi lj b fi lz lw l lx ly">if (!title || !description) {</span><span id="9746" class="lu ir hi lj b fi lz lw l lx ly">response.status = 422;</span><span id="0c20" class="lu ir hi lj b fi lz lw l lx ly">response.body = { msg: "Title and Description is required" };</span><span id="d974" class="lu ir hi lj b fi lz lw l lx ly">return;</span><span id="ef01" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="a8c3" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Create New Todo</em></span><span id="32b2" class="lu ir hi lj b fi lz lw l lx ly">const newTodo: ToDos = { id: uuid.generate(), title, description }</span><span id="3c5a" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Get All Todos</em></span><span id="3918" class="lu ir hi lj b fi lz lw l lx ly">let allTodos: ToDos[] = await getTodosFromJson()</span><span id="3906" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Add New Todo to allTodos Array</em></span><span id="e55d" class="lu ir hi lj b fi lz lw l lx ly">allTodos = [newTodo, ...allTodos]</span><span id="baa7" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Save Data In ToDos.json File</em></span><span id="8a1c" class="lu ir hi lj b fi lz lw l lx ly">await writeDataToJson(allTodos)</span><span id="2d2b" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Response To the Client</em></span><span id="24b2" class="lu ir hi lj b fi lz lw l lx ly">response.body = { msg: "New Todo Created", newTodo };</span><span id="9203" class="lu ir hi lj b fi lz lw l lx ly">};</span><span id="fc2d" class="lu ir hi lj b fi lz lw l lx ly">export default addTodo</span></pre><p id="abf4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">routes/todos/edit todo . ts</strong>文件</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/e2af7d9a61cf9cf641e2de304168b72b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jnj1NP9D4sQ_KADcG6ihOg.png"/></div></div></figure><pre class="ll lm ln lo fd lq lj lr ls aw lt bi"><span id="f750" class="lu ir hi lj b fi lv lw l lx ly">import { Response, Request } from "https://deno.land/x/oak/mod.ts";</span><span id="c934" class="lu ir hi lj b fi lz lw l lx ly">import { getTodosFromJson, writeDataToJson } from '../../db/db.ts';</span><span id="d656" class="lu ir hi lj b fi lz lw l lx ly">import ToDos from '../../models/todos.ts';</span><span id="00c4" class="lu ir hi lj b fi lz lw l lx ly">const editTodo = async ({ <em class="ma">params</em>, <em class="ma">request</em>, <em class="ma">response</em> }: { params: any, request: Request, response: Response }): Promise&lt;void&gt; =&gt; {</span><span id="741f" class="lu ir hi lj b fi lz lw l lx ly">try {</span><span id="96eb" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Save todo id to a variable</em></span><span id="7dac" class="lu ir hi lj b fi lz lw l lx ly">const id = params.id;</span><span id="1de4" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Check Request Has a body or not</em></span><span id="7a69" class="lu ir hi lj b fi lz lw l lx ly">if (!request.hasBody) {</span><span id="9ee0" class="lu ir hi lj b fi lz lw l lx ly">response.status = 400;</span><span id="9963" class="lu ir hi lj b fi lz lw l lx ly">response.body = { msg: "Invalid data, Please Add Title and Description" };</span><span id="e584" class="lu ir hi lj b fi lz lw l lx ly">return;</span><span id="3f1b" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="265c" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Get Title and description from Request</em></span><span id="031e" class="lu ir hi lj b fi lz lw l lx ly">const {</span><span id="70d2" class="lu ir hi lj b fi lz lw l lx ly">value: { title, description }</span><span id="6932" class="lu ir hi lj b fi lz lw l lx ly">} = await request.body();</span><span id="b3f0" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Check title and description is valid</em></span><span id="12d9" class="lu ir hi lj b fi lz lw l lx ly">if (!title || !description) {</span><span id="3107" class="lu ir hi lj b fi lz lw l lx ly">response.status = 422;</span><span id="37a0" class="lu ir hi lj b fi lz lw l lx ly">response.body = { msg: "Title and Description is required" };</span><span id="501a" class="lu ir hi lj b fi lz lw l lx ly">return;</span><span id="7db1" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="ae7d" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Get All Todos From Json File And Save it in to a Variable</em></span><span id="b67a" class="lu ir hi lj b fi lz lw l lx ly">let allTodos: ToDos[] = await getTodosFromJson();</span><span id="3668" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Check if todo is here in that Id sent by client</em></span><span id="4eda" class="lu ir hi lj b fi lz lw l lx ly">const todo: ToDos | undefined = allTodos.find((<em class="ma">todo</em>: ToDos) =&gt; <em class="ma">todo</em>.id === id)</span><span id="89a0" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// check todo is undefined, if so then response 404</em></span><span id="153f" class="lu ir hi lj b fi lz lw l lx ly">if (!todo) {</span><span id="3b35" class="lu ir hi lj b fi lz lw l lx ly">response.status = 404;</span><span id="a1aa" class="lu ir hi lj b fi lz lw l lx ly">response.body = { msg: `No Todo Found on this ${id} id` }</span><span id="0b89" class="lu ir hi lj b fi lz lw l lx ly">return;</span><span id="2a6d" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="7457" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">//    Add New Title And Description to Old One</em></span><span id="2673" class="lu ir hi lj b fi lz lw l lx ly">todo.title = title;</span><span id="b2bf" class="lu ir hi lj b fi lz lw l lx ly">todo.description = description;</span><span id="675e" class="lu ir hi lj b fi lz lw l lx ly">await writeDataToJson(allTodos)</span><span id="e0f6" class="lu ir hi lj b fi lz lw l lx ly">response.status = 200;</span><span id="0d8a" class="lu ir hi lj b fi lz lw l lx ly">response.body = { msg: "Todo has been Edited", todo }</span><span id="9136" class="lu ir hi lj b fi lz lw l lx ly">} catch (err) {</span><span id="e091" class="lu ir hi lj b fi lz lw l lx ly">console.error(err.message);</span><span id="26df" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="a626" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="4c73" class="lu ir hi lj b fi lz lw l lx ly">export default editTodo;</span></pre><p id="c4f6" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">routes/todos/delete todo . ts</strong>文件</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/e2af7d9a61cf9cf641e2de304168b72b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jnj1NP9D4sQ_KADcG6ihOg.png"/></div></div></figure><pre class="ll lm ln lo fd lq lj lr ls aw lt bi"><span id="eb44" class="lu ir hi lj b fi lv lw l lx ly">import { Response } from "https://deno.land/x/oak/mod.ts";</span><span id="cfab" class="lu ir hi lj b fi lz lw l lx ly">import { getTodosFromJson, writeDataToJson } from '../../db/db.ts';</span><span id="40b9" class="lu ir hi lj b fi lz lw l lx ly">import ToDos from '../../models/todos.ts';</span><span id="44c9" class="lu ir hi lj b fi lz lw l lx ly">const deleteTodo = async ({ <em class="ma">params</em>, <em class="ma">response</em> }: { params: any, response: Response }): Promise&lt;void&gt; =&gt; {</span><span id="011a" class="lu ir hi lj b fi lz lw l lx ly">try {</span><span id="6cc4" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Save todo id to a variable</em></span><span id="4607" class="lu ir hi lj b fi lz lw l lx ly">const id = params.id;</span><span id="7846" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Get All Todos From Json File And Save it in to a Variable</em></span><span id="07c5" class="lu ir hi lj b fi lz lw l lx ly">let allTodos = await getTodosFromJson();</span><span id="9be2" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// Check if todo is here in that Id sent by client</em></span><span id="8d6b" class="lu ir hi lj b fi lz lw l lx ly">const index = allTodos.findIndex((<em class="ma">todo</em>: ToDos) =&gt; <em class="ma">todo</em>.id === id)</span><span id="6fa6" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// if todo is here index &gt; 0</em></span><span id="efac" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// if todo is not here index = -1</em></span><span id="96a6" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// check index &lt; 0, if so then response 404</em></span><span id="0e93" class="lu ir hi lj b fi lz lw l lx ly">if (index &lt; 0) {</span><span id="600b" class="lu ir hi lj b fi lz lw l lx ly">response.status = 404;</span><span id="cbe6" class="lu ir hi lj b fi lz lw l lx ly">response.body = { msg: `No Todo Found on this ${id} id` }</span><span id="045b" class="lu ir hi lj b fi lz lw l lx ly">return;</span><span id="f21d" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="a11d" class="lu ir hi lj b fi lz lw l lx ly"><em class="ma">// if index &gt; 0 then filter the array and delete todo and save</em></span><span id="5147" class="lu ir hi lj b fi lz lw l lx ly">allTodos = allTodos.filter((<em class="ma">todo</em>: ToDos) =&gt; <em class="ma">todo</em>.id !== id)</span><span id="6615" class="lu ir hi lj b fi lz lw l lx ly">await writeDataToJson(allTodos)</span><span id="475c" class="lu ir hi lj b fi lz lw l lx ly">response.status = 200;</span><span id="1abc" class="lu ir hi lj b fi lz lw l lx ly">response.body = { msg: "Todo has been Deleted" }</span><span id="f7f8" class="lu ir hi lj b fi lz lw l lx ly">} catch (err) {</span><span id="fc73" class="lu ir hi lj b fi lz lw l lx ly">console.error(err.message);</span><span id="29b1" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="bf98" class="lu ir hi lj b fi lz lw l lx ly">}</span><span id="31b0" class="lu ir hi lj b fi lz lw l lx ly">export default deleteTodo;</span></pre><p id="7486" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在我们简单的REST API完成了。要运行server，我们需要做的就是打开项目文件夹中的cmd或终端并运行</p><h1 id="15ea" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated"><strong class="ak">deno run-allow-all index . ts</strong></h1><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/6cc08aed8f0c30abdb4a1b1297dffeb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*QRs9Cvsr1e1NlkvKidgU0w.png"/></div></div></figure><p id="3b86" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">yot会得到这样的消息。现在，您可以使用postman这样的工具来测试您的REST API。</p><p id="d704" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">Github回购:-<a class="ae lf" href="https://github.com/Hasi6/REST-API-Using-Deno" rel="noopener ugc nofollow" target="_blank">https://github.com/Hasi6/REST-API-Using-Deno</a></p><p id="e5fd" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这就是快乐编码。谢谢你。</p></div></div>    
</body>
</html>