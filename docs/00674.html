<html>
<head>
<title>GBM V/S Logistic (Banking Case Study)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GBM V/S物流(银行案例研究)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/gbm-v-s-logistic-banking-case-study-8d0d15ee5611?source=collection_archive---------6-----------------------#2019-08-25">https://medium.com/analytics-vidhya/gbm-v-s-logistic-banking-case-study-8d0d15ee5611?source=collection_archive---------6-----------------------#2019-08-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="efbd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">机器学习是这个城市的新流行语。每个行业都希望使用机器学习技术，因为它们能够提高准确性，从而增加收入。然而，在金融和医疗保健等行业，除了准确性，推理也起着至关重要的作用，这些技术的使用是一个大问题。下面是一个案例研究，展示了如果在这些行业中使用机器学习技术会发生什么。我希望通过这个博客，我能够帮助在这些行业工作的人回答高级管理层提出的一些问题。</p><p id="e434" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Rocket Singh先生在ABC银行工作。他的经理要求他建立一个模型来预测拥有信用卡的ABC银行的客户是否会拖欠他们的下一次付款</p><p id="d403" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Rocket Singh先生建立了一个传统的逻辑回归模型和一个挑战者机器学习模型(梯度推进机器)。他带着两个结果去见了他的经理。</p><p id="f90b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Rocket Singh先生:- 我已经建立了一个逻辑回归模型以及梯度推进机器模型。Logistic的AUC(曲线下面积)为76%,而GBM为80%。</p><p id="2ed3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">经理:- </strong>听起来很有趣！！你能告诉我什么是GBM，它是如何工作的吗？？</p><p id="a124" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">Rocket Singh先生:- </strong> GBM是一种集成技术，其中按顺序构建多棵树，并且每棵树都试图纠正前一棵树所犯的错误</p><p id="95a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">经理:- 那么你在模型中造了多少棵树？？</p><p id="673b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Rocket Singh先生:-  100棵树，每棵树的最大深度为2。这些树中的每一个都建立在70%的数据上，其中每次数据是随机选择的，并且对于每一个树，80%的特征是随机选择的</p><p id="ca94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">经理:- 你能给我看一下这些树吗，我想了解每棵树中的变量以及它们是如何相互作用的</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/9893269fbbe42259fc54c551fe6bb173.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2MBZtr5tIknBUvAPbtj1WA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><strong class="bd jt">树1 </strong></figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ju"><img src="../Images/bc344d111649b715cfc1953d3c6a382c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zK7aOPTpANJDAXC2wJlu_g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><strong class="bd jt">树100 </strong></figcaption></figure><p id="4476" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Rocket Singh先生:- 树1 &amp;树100如上图所示。像这样我们可以想象100棵树中的每一棵树。所有这些树都可以写成基本的if-else语句，更像是一种基于规则的方法，而不是一个黑盒</p><p id="0353" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">经理:- 好的。GBM模型和Logistic回归模型中的前几个变量是什么？？我想了解这两个模型中的顶级变量是如何变化的</p><p id="a010" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Rocket Singh先生:- 这是GBM模型&amp;逻辑回归模型的前10个变量的列表。对于逻辑回归来说，变量是基于Wald卡方选择的，而对于GBM模型来说，变量是基于信息增益选择的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jv"><img src="../Images/ae6b40792edc0d10591512e00978fc7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*wt_5eEH-DpXMtVKM9qfbHg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><strong class="bd jt">十大变量-GBM模型</strong></figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jw"><img src="../Images/b3a1f8d2fceaaf02adb49f3a1063d07a.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/1*ndU1i0HnkIvSF1z-SLXuPw.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><strong class="bd jt">十大变量-逻辑回归</strong></figcaption></figure><p id="0c31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">经理:- 在这两个模型中，前10个变量的列表或多或少看起来是相同的，PAY_0将成为最重要的变量。那你怎么会得到4%的额外增量呢</p><p id="4ec7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">Rocket Singh先生:- </strong>这是AUC之间没有太大差异的主要原因。话虽如此，4%的增量提升是因为GBM模型能够捕捉变量之间的轻微非线性和相互作用</p><p id="2eef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">经理:-</strong>GBM模型对顶级变量有什么反应，有可能了解哪些变量是相互影响的吗</p><p id="d286" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">Rocket Singh先生:- </strong>我们可以使用部分相关图来了解模型对于顶部变量的表现</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jx"><img src="../Images/131138a1e87a11f572c7265f05692783.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*v_kuPZwbdfVBN1n7xGcrVQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><strong class="bd jt">GBM中前3个变量的部分相关图</strong></figcaption></figure><p id="58dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，X轴上的值表示在0和1之间归一化的变量的实际值，Y轴上的值显示变量对类别概率的相对logit贡献。</p><p id="213f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，Y轴上的负值表示变量导致概率趋向于0，而正值则使概率趋向于1。</p><p id="c57d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上面的图中可以看出，PAY_0显示出下降趋势，但在0.2之后变平，而PAY_3以变平的趋势开始，然后在0.2之后显示出上升趋势，在0.6之后再次变平</p><p id="5d43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">逻辑回归不能捕捉这种趋势，因为它强加了一个线性趋势。<strong class="ih hj">顶部变量也或多或少显示出线性趋势，因此AUC </strong>之间没有太大差异。另一方面，如果顶部变量具有高度非线性的趋势，则AUC值之间的差异将非常大</p><p id="72e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">经理:- 这些变量的趋势与业务非常一致，但我惊讶地看到这些极端的扁平化性质。我们能理解哪些是相互作用的变量对吗</p><p id="93c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Rocket Singh先生:- 是的，我们可以。弗里德曼和波佩斯库的H统计帮助我们理解变量之间相互作用的强度。下表显示了最重要的一对变量(每对2个)及其相互作用强度。相互作用强度的值范围从0到1，其中0表示没有相互作用，而1表示最大相互作用</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jy"><img src="../Images/337f5bd7830c4376c976424003abe7d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*Noc5IY6FOzT2RXYaVs-LuA.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><strong class="bd jt">弗里德曼和波佩斯库的H统计</strong></figcaption></figure><p id="6a3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">经理:-</strong>BILL _ AMT和PAY_AMT的交互有道理但是性别的交互&amp;婚姻很奇怪。你能深入研究一下这些数字，让我知道为什么会这样吗</p><p id="43c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">火箭辛格先生:- 好的，我会在明天之前做好，然后告诉你。</p><p id="17a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">经理:-Rocket Singh先生，这种模式在客户层面上表现如何？我的意思是，看看你给我看的所有东西，我想如果顾客A的年龄是25岁，顾客B的年龄也是25岁，那么他们两个的结果可能会不同，如果我错了，请纠正我</p><p id="2bcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">Rocket Singh先生:- </strong>是的先生你是对的。为了在客户层面理解这个模型，我们可以利用本地的可解释技术，比如莱姆&amp; SHAP。</p><p id="2317" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">LIME代表<strong class="ih hj">本地可解释的模型不可知解释</strong></p><p id="87d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它在本地工作，它会告诉你如何计算每个客户的概率得分。</p><p id="fc71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它是这样工作的</p><p id="e590" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.)选择你希望解释其输出的某个点x，并获得模型的预测ŷ.</p><p id="c622" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.)通过置换点X来采样新点。让我们称这些点为X’。计算排列和原始观察值之间的距离。</p><p id="b773" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.)用你的黑箱模型评估这些点。称这些预测为Y’。</p><p id="99a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.2)从置换数据中挑选出最能描述复杂模型结果的m个特征。</p><p id="4f29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.)用m个特征和相似性得分作为权重，将简单的可解释模型拟合到置换数据。</p><p id="dc2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.)简单模型的特征权重解释了复杂模型的局部行为。</p><p id="d4ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">石灰的输出看起来像这样</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jz"><img src="../Images/83328ef8fa93a5277c5c6e891485b903.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o13-iCfjVJ7bb5Mk4wXk8g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><strong class="bd jt">石灰输出</strong></figcaption></figure><p id="ca0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，我从数据中抽取了1个客户。对他来说，PAY_0 &amp; PAY_2倾向于0类，而BILL_AMT2 &amp; PAY_AMT5倾向于1类，这是导致他获得概率值0.21(这是他在GBM模型中拖欠下一次付款的概率)的前4个特征。对于该客户，这4项功能的实际价值在上面的行中有所表示，同时也以表格形式给出，并对0级和1级进行了颜色编码</p><p id="f18f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">类似地，我们可以使用LIME了解数据集中的任何客户，为了衡量这些解释的可靠性，我们可以使用拟合本地可解释模型后得到的R-sqaure。该实例的R平方值为71%，因此这些结果是可靠的。</p><p id="6eeb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，石灰也有一些缺点</p><p id="8e53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">石灰的缺点</p><p id="408f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.)依赖于新点的随机采样，所以可能不稳定</p><p id="577f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.)线性模型的拟合可能不准确，但是我们可以检查R的平方值，以知道是否是这种情况</p><p id="f91a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了更加确定对模型的理解，我们可以把SHAP和石灰结合起来使用。</p><p id="7b2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SHAP代表<strong class="ih hj">沙普利加法解释</strong></p><p id="3fb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一种来自联盟博弈论的方法，它告诉我们如何在玩家之间公平地分配“支出”。</p><p id="4b2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于机器学习，我们可以将模型的特征视为“<em class="ka">玩家</em>”，将模型的预测视为“<em class="ka">支出</em>”。</p><p id="32a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它基于以下3个公理:-</p><ol class=""><li id="7b53" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated"><strong class="ih hj">缺失:- </strong>如果一个特征从不增加任何边际价值，它们的权重应该是0</li><li id="f95c" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated"><strong class="ih hj">局部精度:- </strong>当对特定输入x近似原始模型f时，局部精度要求解释模型至少与简化输入x’(对应于原始输入x)的f的输出相匹配。</li><li id="907f" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated"><strong class="ih hj">一致性:- </strong>它指出，如果一个模型发生变化，使得某个简化输入的贡献增加或保持不变，而不考虑其他输入，则该输入的贡献不应减少。</li></ol><p id="167f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它有助于您了解每个特征在获得概率分数中的作用</p><p id="8b95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SHAP的输出看起来像这样</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kp"><img src="../Images/94c413ff2c9f716090cea1156c03c445.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lptLaasTlMQ6zzJ7KZ-duQ.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kq"><img src="../Images/5e372ebd267d75516e37a34946b38b07.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*ytYGBh6YzxWC0lW0Ab2-OQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><strong class="bd jt"> SHAP值(表格形式)</strong></figcaption></figure><p id="2fe6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的图中:-</p><p id="75da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.)基值是对训练数据集进行预测的平均值</p><p id="c0aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.)输出值是该实例的所有变量的SHAP值与基本值的总和。这与GBM模型为该实例做出的预测(对数优势)相同。<strong class="ih hj"> SHAP确保输出值与模型预测相同，而LIME无法确保这一点，因此更加可靠</strong></p><p id="fcea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.)上图中变量的值是该实例的实际值</p><p id="1f4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于上述客户，BILL_AMT1和PAY_2倾向于等级1，而PAY_0和PAY_3倾向于等级0</p><p id="b551" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">经理:- </strong>有意思！！请与我分享这些结果，我会彻底调查并与利益相关者讨论。一旦模型最终确定，我们可以讨论该模型的部署，以及验证团队应该如何监控它的进展</p><p id="bdcc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Rocket Singh先生:- 当然，先生，我会把结果寄给你，如果有任何疑问，你可以给我回复。你也可以使用下面的链接找到代码和工作细节</p><div class="kr ks ez fb kt ku"><a href="https://github.com/statsguysam/Model-Interpretability/blob/master/Compare%20Linear%20%26%20GBM%20model/Linear_GBM.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">statsguysam/模型-可解释性</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">github.com</p></div></div><div class="ld l"><div class="le l lf lg lh ld li jn ku"/></div></div></a></div></div></div>    
</body>
</html>