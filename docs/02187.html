<html>
<head>
<title>Spline Regression in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R中的样条回归</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/spline-regression-in-r-960ca82aa62c?source=collection_archive---------0-----------------------#2019-12-05">https://medium.com/analytics-vidhya/spline-regression-in-r-960ca82aa62c?source=collection_archive---------0-----------------------#2019-12-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/53f82313b722277b7335f428fb624e4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*YJ_nFKSr1taciql8DXiNLg.png"/></div></figure><p id="26f9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当回归这个词出现时，我们只能回忆起线性回归和逻辑回归。这两种回归是最流行的模型，尽管在不同的情况下有不同类型的回归模型是有用的和有用的。</p><p id="3d5f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">今天让我们讨论使用r的样条回归。在进一步回归之前，你应该对样条有基本的了解。</p><p id="0c6f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">样条是由多项式分段定义的特殊函数。术语“样条”用来指在需要数据插值和/或平滑的应用中使用的一大类函数。数据可以是一维的，也可以是多维的。</p><p id="37e0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">样条回归是<strong class="io hj">非参数回归技术</strong>的一种。在这种技术中，数据集被分成间隔或点的仓，我们称之为结。这个箱子也有单独的配件。我们将通过一个简单的例子来理解使用r实现样条回归。</p><p id="03e2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我创建了一个虚拟数据，如下所示:</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es jk"><img src="../Images/ae672507921e4bf3a817784603240c9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:272/format:webp/1*Zp2naB_hxbu5qTDUAExGZw.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">数据可视化</figcaption></figure><p id="50af" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们将我们的数据绘制成，如下图所示:</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es jt"><img src="../Images/eb4cf84fb87c4b4b3da7089c7f62016e.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*YwcKBEDw_axjz2iMYH7-sw.png"/></div></figure><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es ju"><img src="../Images/014bb94bb9f38fb18132ccb3ab77bba5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DV2A2IoJhwjNffAJknOdEw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">天数与销售图</figcaption></figure><p id="e353" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我们将对我们的数据进行简单的线性回归，看看它是如何工作的。直线的方程式是:</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es jz"><img src="../Images/07236f82b1180cbd8f86789079b3d677.png" data-original-src="https://miro.medium.com/v2/resize:fit:330/format:webp/1*7z1OX_AWBmyeAV2QL14qkA.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">直线方程</figcaption></figure><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es ka"><img src="../Images/4ef7751e3170efcc1911218afc8abca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*0_J-fzTMS_qYwNU8U74q_A.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">拟合简单线性模型</figcaption></figure><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kb"><img src="../Images/6293cb4764c7d4b7176a6fdd20d305d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*sT2vOspB1xtkN_-3JFr14w.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">简单线性模型综述</figcaption></figure><p id="7a75" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们用回归线来拟合我们的模型:</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kc"><img src="../Images/dbe35923233cfa18d8e943c90a4f4f96.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*ehFK7MB1aBzGnA_468C10g.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">绘图回归线</figcaption></figure><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kd"><img src="../Images/8adc791cc29a196cd7210a1956c97a94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jejM4t627TgzQhGmpd6QIw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">回归线</figcaption></figure><p id="4fbe" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以看到，我们的模型非常适合我们的数据，而且R平方和调整后的R平方值非常差。</p><p id="e5f2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在让我们尝试2次多项式回归，并分析模型的性能。所以，直线方程变成了:</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es ke"><img src="../Images/05323217df21191965064d1af8a8788f.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/1*IxJJcpF6baBH_0sfodDIPg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">直线方程</figcaption></figure><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kf"><img src="../Images/dfa74aad46cf15159b8d3ad3515c476c.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*JWaU38uZz0G5h4ewBT_TSQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">二次多项式回归</figcaption></figure><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kg"><img src="../Images/c5178fe0bc97f1ba6f69d2a0534f2b0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*0RPwUmc3hkThU_VY0lV6_g.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">多项式回归综述</figcaption></figure><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kh"><img src="../Images/e6f8e1d3c60c31585376835f6f284d68.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*wlLk_spRb4BB1s8lhO8yZQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">绘图回归线</figcaption></figure><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es ki"><img src="../Images/d58d10adc6ef047d3661b0f239383354.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d_-L_bapqrpLIBMHn6lF5g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">回归线</figcaption></figure><p id="0c56" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以看到，这不是一个坏的适合，但也不是一个伟大的。多项式回归也有各种缺点，容易过度拟合。随着功能数量的增加，这可能会导致复杂性的增加。</p><p id="b379" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">多项式回归的缺点可以通过使用样条回归来克服。多项式回归仅捕获非线性关系中的一定量的曲率。另一种通常更好的非线性关系建模方法是使用样条。</p><p id="2bec" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">样条曲线提供了一种在固定点(称为结)之间平滑插值的方法。在结之间计算多项式回归。换句话说，样条是一系列串在一起的多项式段，在节点处连接。</p><p id="32f9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在样条回归的情况下，我们将数据集分成多个箱。对于我们的情况，让我们将数据集分成两个箱。所以，我们假设在第90天左右。一个在第90天出现的峰值的左侧，另一个在其右侧。现在让我们相应地绘图。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kj"><img src="../Images/efde94cc5fe371315c4465d0b2fe6a0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7rNpjhgWOj1OBo6YJLo4oQ.png"/></div></div></figure><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kk"><img src="../Images/32ae0aa23fa6b028440c4b9f438ad137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ag0nRb-YfWqyW7UHp9V7Mg.png"/></div></div></figure><p id="fab8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们需要将上述两幅图像合并成一个方程，并使用阶跃函数执行样条回归或分段回归。让我们看看它是怎么做的。为此，我们首先需要创建一个新的分类变量，如果Day &gt; 90，则1否则为0。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kl"><img src="../Images/de0d2c1b108e3380525cac98ab7022ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*IZrnfdQ7VriMUqJYIK0kxg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">创建分类变量</figcaption></figure><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es km"><img src="../Images/12b3530f09a5d3dfe4840b7037b83b82.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*4WpVoBBdtqjunnXn77PIeQ.png"/></div></figure><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kn"><img src="../Images/9be889f385b96d8c3e9abc0e00ff64d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*YNZG4EN5iHMlkjdahWASEw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">操作后的数据</figcaption></figure><p id="f2f8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们根据这些数据来拟合这个模型。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es ko"><img src="../Images/6da44c6e4aca4dbe80a4ff9f25bfaae0.png" data-original-src="https://miro.medium.com/v2/resize:fit:718/format:webp/1*qVFN4HTfaZ7B5M6Nmmuymg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">拟合线性模型</figcaption></figure><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kp"><img src="../Images/7cf55096edb67df40a722ad9a5070458.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*pPI5KMNtl1MGAbxjh8bFbg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">摘要</figcaption></figure><p id="a796" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以看到，R平方和调整后的R平方值增加了很多。现在让我们看看我们的回归线是如何拟合的。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kq"><img src="../Images/bdb1b0dc66519d3e46ce72c39e822656.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*AlXwN0rPqcx3e4zuBwG0IQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">情节线索</figcaption></figure><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kr"><img src="../Images/3ad32a4de654cb55f8bdbdca08d71bbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6-pjh9Xe3fcAwcX-kkX5Gg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">回归线</figcaption></figure><p id="4a8f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，让我们介绍R中的<strong class="io hj"> spline </strong>包，它包括用于在回归模型中创建b样条项的函数<strong class="io hj"> bs </strong>。我将介绍一个使用<strong class="io hj"> Ecdat </strong>包和<strong class="io hj">服装</strong>数据集的新例子。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es ks"><img src="../Images/475c39e0fd22fa1b619f4478e9b8b17b.png" data-original-src="https://miro.medium.com/v2/resize:fit:280/format:webp/1*JJPE3-R7V7WVGKaoT50WyQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">加载库</figcaption></figure><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kt"><img src="../Images/97271fc5ac0a807d2c8497f4f719597c.png" data-original-src="https://miro.medium.com/v2/resize:fit:262/format:webp/1*sLEA80w44OZTR40rEkHUDw.png"/></div></figure><p id="49ab" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在让我们来拟合我们的模型。我们必须标明结的数量和位置。最常用下降值在第25、50和75百分位。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es ku"><img src="../Images/8cadddecfe67b724fc5727b7d61b3aad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*yxmvyjfRoouEZmoG8goqyA.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">拟合模型</figcaption></figure><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kv"><img src="../Images/418173d2ae85c07e5ca7db0d49139150.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*8Pr6EDphJSYNnokDDX0vRg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">模型摘要</figcaption></figure><p id="44df" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们已经使用lm()函数建立了简单的线性模型。然而，我们还使用了bs()函数，它允许我们创建样条回归模型。</p><p id="1424" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">记住，R中默认的样条模型是一个三次多项式。这是因为肉眼很难发现结处的不连续性。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/b4ec19bc174022766bfd3b6ef725db5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*5LmScu13GaWbWmeat-YJfw.png"/></div></figure><p id="abd3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们现在准备绘制我们的模型。下面的代码绘制了模型，包括回归线(红色)、置信区间(绿色)以及每个结的位置(蓝色)。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kx"><img src="../Images/e80fe7843f11fd1c389493ba7537a766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*oDvQSFYUmb-fchAqguEfYQ.png"/></div></figure><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es ky"><img src="../Images/2630d677d4c362833c42e446fc8276c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*s-06oawCgZigmYR1oDzW3g.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">回归样条图</figcaption></figure><h1 id="a2af" class="kz la hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">如何选择结的数量和位置？</strong></h1><p id="706d" class="pw-post-body-paragraph im in hi io b ip lx ir is it ly iv iw ix lz iz ja jb ma jd je jf mb jh ji jj hb bi translated">当我们拟合样条曲线时，我们应该在哪里放置节点？回归<br/>样条在包含大量节点的区域中最为灵活，因为在<br/>这些区域中，多项式系数可能会快速变化。</p><p id="8440" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，一种选择是在我们认为函数变化最快的地方放置更多的结，而在看起来更稳定的地方放置更少的结。<br/>虽然这个选项可以很好地工作，但实际上以统一的方式放置结是很常见的。</p><p id="0c10" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">一种方法是指定所需的自由度，然后让软件在数据的统一分位数上自动放置相应数量的结。</p><h1 id="9473" class="kz la hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">我们的样条曲线应该包含多少个自由度？</strong></h1><p id="a59a" class="pw-post-body-paragraph im in hi io b ip lx ir is it ly iv iw ix lz iz ja jb ma jd je jf mb jh ji jj hb bi translated">一种选择是尝试不同数量的结，看看哪种结能产生最好看的曲线。更客观的方法是使用交叉验证。</p><p id="4268" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用这种方法，我们删除一部分数据(比如10 %)，用一定数量的节点拟合剩余数据，然后使用样条对保留的部分进行预测。</p><p id="ad95" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们重复这个过程多次，直到每个观察值都被忽略一次，然后计算总的交叉验证RSS(残差平方和)。对于不同的节数K，可以重复这个过程。然后选择给出最小RSS的K值。</p><p id="25a0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，我想结束这篇文章。在这篇博客中，我们能够理解样条回归及其工作原理。样条回归还有很多要研究的，如光滑样条、三次样条等。让我们在我的下一篇博客中看到这些。</p><p id="68cb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">希望你们能够理解并抓住样条回归的思想。</p></div></div>    
</body>
</html>