<html>
<head>
<title>Outlier Treatment with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python处理异常值</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/outlier-treatment-9bbe87384d02?source=collection_archive---------0-----------------------#2019-09-16">https://medium.com/analytics-vidhya/outlier-treatment-9bbe87384d02?source=collection_archive---------0-----------------------#2019-09-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/5c75252eb8c7ea5d7e6606fbc7b9e64c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yNMXw2Rv2tgJp2qm"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">杰西卡·鲁斯切洛在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h2 id="8f58" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak">1——什么是离群值？</strong></h2><p id="54df" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">离群值是数据集中远离所有其他观察值的数据点。</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/28a0ade9b5012cd3c6a665c9725a21ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*cRKgIYxvTxbLVizP7P4tSg.png"/></div></div></figure><p id="588a" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">位于数据集总体分布之外的数据点</p><p id="6f43" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">许多人对极端值和异常值感到困惑。</p><h2 id="0c6b" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak"> 2 —什么是极值？</strong></h2><p id="fb0a" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">一个极值只是一个最小值或一个最大值，它不需要与数据相差太多。</p><h2 id="054c" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak"> 3 —极值&amp;异常值之间的差异是什么？</strong></h2><p id="306b" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">极值只是一个最小值或最大值，它不需要与数据有很大的不同&amp;远离其他点的点称为离群点。</p><p id="3712" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">例如:-员工的年龄</p><p id="29de" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">年龄= 21、23、24、25、26、28、30、45岁</p><p id="7217" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">在哪里</p><p id="e190" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">极值=30</p><p id="7060" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">异常值=45</p><h2 id="779d" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak"> 4 —数据集中存在离群值的原因是什么？</strong></h2><p id="07ca" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">4.1-数据的可变性</p><p id="f6fa" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">4.2 -实验测量误差</p><h2 id="c962" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak"> 5 —我们如何识别异常值？</strong></h2><p id="b351" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">5.1-使用箱线图</p><p id="a98c" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">5.2-使用散点图</p><p id="fd8d" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">5.3-使用Z分数</p><h2 id="81b3" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak"> 6 —异常值处理有两种方法</strong></h2><ol class=""><li id="0ef8" class="ky kz hi jv b jw jx ka kb jg la jk lb jo lc kn ld le lf lg bi translated"><strong class="jv hj">四分位距(IQR)法</strong></li><li id="9f44" class="ky kz hi jv b jw lh ka li jg lj jk lk jo ll kn ld le lf lg bi translated"><strong class="jv hj"> Z评分法</strong></li></ol><p id="06fb" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated"><strong class="jv hj"> 6.1 — IQR法</strong></p><p id="72ee" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">使用IQR，我们可以找到离群值。</p><p id="582f" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated"><strong class="jv hj"> 6.1.1 —识别异常值的标准是什么？</strong></p><p id="5f27" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">数据点落在高于第三四分位数(Q3)和低于第一四分位数(Q1)的四分位数范围的1.5倍之外</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es lm"><img src="../Images/eee9cdc95c7dc62143fddec242032715.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*SNZCse_n6-hau15Gn01RLA.png"/></div></figure><p id="dc0e" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated"><strong class="jv hj"> 6.2.2 —使用IQR去除异常值</strong></p><p id="dace" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">第一步:——收集并读取数据</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es ln"><img src="../Images/220050e5910fd7d8d346cd81da7e3aa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*wAuJdAqRSsuEFtsPErATbg.png"/></div></figure><p id="4dc3" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated"><strong class="jv hj">步骤2: </strong> —检查数据的形状</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es lo"><img src="../Images/8a2a636bf5cdef0051b673f2681a51d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*Ft5r_s63B3susM3LyBdHHA.png"/></div></figure><p id="039f" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated"><strong class="jv hj">第三步:——</strong>检查异常值</p><pre class="kp kq kr ks fd lp lq lr ls aw lt bi"><span id="845d" class="iv iw hi lq b fi lu lv l lw lx">import seaborn as sns</span><span id="b61f" class="iv iw hi lq b fi ly lv l lw lx">sns.boxplot(data=df,x=df[‘hp’])</span></pre><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/892aae91b272313bf07cce46ec90ae90.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*3orPqFOasztVmiFWPOGZng.png"/></div></div></figure><p id="fe99" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated"><strong class="jv hj">第四步:—实施</strong></p><pre class="kp kq kr ks fd lp lq lr ls aw lt bi"><span id="3aaf" class="iv iw hi lq b fi lu lv l lw lx">Q1=df[‘hp’].quantile(0.25)</span><span id="18f7" class="iv iw hi lq b fi ly lv l lw lx">Q3=df[‘hp’].quantile(0.75)</span><span id="2b36" class="iv iw hi lq b fi ly lv l lw lx">IQR=Q3-Q1</span><span id="4c39" class="iv iw hi lq b fi ly lv l lw lx">print(Q1)</span><span id="7654" class="iv iw hi lq b fi ly lv l lw lx">print(Q3)</span><span id="fb22" class="iv iw hi lq b fi ly lv l lw lx">print(IQR)</span><span id="f0d9" class="iv iw hi lq b fi ly lv l lw lx">Lower_Whisker = Q1–1.5*IQR</span><span id="3da9" class="iv iw hi lq b fi ly lv l lw lx">Upper_Whisker = Q3+1.5*IQR</span><span id="8dd3" class="iv iw hi lq b fi ly lv l lw lx">print(Lower_Whisker, Upper_Whisker)</span><span id="500a" class="iv iw hi lq b fi ly lv l lw lx"><strong class="lq hj">Output: -</strong> 96.5<br/>          180.0<br/>          83.5<br/>          -28.75 305.25</span></pre><p id="a286" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated"><strong class="jv hj">第五步:—异常值处理</strong></p><p id="c5d2" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">应用条件移除异常值:</p><pre class="kp kq kr ks fd lp lq lr ls aw lt bi"><span id="dc25" class="iv iw hi lq b fi lu lv l lw lx">df = df[df[‘hp’]&lt; Upper_Whisker]</span></pre><p id="1eb5" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">异常值将是低于下须或高于上须的任何点</p><p id="60f1" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated"><strong class="jv hj">步骤6: — </strong>检查数据的形状</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/5abcbd105f4a4c3e054e854cb6a9f9f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*R9dhru9AhM2s0UnuLXQSPA.png"/></div></figure><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es mb"><img src="../Images/cd1c7cd5fe23ba8077a37d23be0a3e03.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*7yqUCv1Sk51cMvFgw3xmWQ.png"/></div></figure><h2 id="4a11" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak"> 6.2 — Z评分法</strong></h2><p id="3c92" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">使用Z分数，我们可以发现异常值</p><p id="1e52" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated"><strong class="jv hj">6 . 2 . 1-识别异常值的标准是什么？</strong></p><p id="9b29" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">超出3个标准偏差的数据点。我们可以使用z值，如果z值超出2个标准差。</p><p id="3a4a" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated"><strong class="jv hj"> 6.2.2 —以下是移除异常值的步骤</strong></p><p id="a22f" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated"><strong class="jv hj">步骤1:——</strong>收集数据并读取文件</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/8f2b303267ed3a2a8249066a004b9600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*0Gh-d6x3k14VnAgOSgXZyQ.png"/></div></figure><p id="bd23" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated"><strong class="jv hj">步骤2: </strong> —检查数据的形状</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/4a41ba46e69154bc96704ee3dab15b3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*nO1zl21vF4r6k3tYAmEaiw.png"/></div></figure><p id="0763" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated"><strong class="jv hj">第三步:</strong> —获取Z得分表。</p><pre class="kp kq kr ks fd lp lq lr ls aw lt bi"><span id="1e79" class="iv iw hi lq b fi lu lv l lw lx">from scipy import stats</span><span id="1196" class="iv iw hi lq b fi ly lv l lw lx">z=np.abs(stats.zscore(df.hp))</span><span id="9f96" class="iv iw hi lq b fi ly lv l lw lx">print(z)</span></pre><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es md"><img src="../Images/bb3f0dbce165e0560fd8093a0caa6756.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*ozIy2n1REfUSG1VQL2GimQ.png"/></div></figure><p id="61bf" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated"><strong class="jv hj">第四步:- </strong></p><p id="6979" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">我们找到数据集中每个数据点的z得分，如果z得分大于3，则我们可以将该点归类为异常值。任何超出3个标准差的点都是异常值。</p><pre class="kp kq kr ks fd lp lq lr ls aw lt bi"><span id="b851" class="iv iw hi lq b fi lu lv l lw lx">threshold=3</span><span id="8168" class="iv iw hi lq b fi ly lv l lw lx">print(np.where(z&gt;3))</span></pre><p id="51de" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated"><strong class="jv hj">输出:- </strong></p><pre class="kp kq kr ks fd lp lq lr ls aw lt bi"><span id="71b7" class="iv iw hi lq b fi lu lv l lw lx">(array([  8,  13,  95, 116], dtype=int64),)</span></pre><p id="4d7a" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated"><strong class="jv hj">第五步:- </strong></p><pre class="kp kq kr ks fd lp lq lr ls aw lt bi"><span id="a381" class="iv iw hi lq b fi lu lv l lw lx">df1=df[(z&lt; 3)]</span><span id="5571" class="iv iw hi lq b fi ly lv l lw lx">print(df1)</span></pre><p id="777f" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated"><strong class="jv hj">第六步:</strong> —检查数据形状</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/0080c52b3bd5ba2370b351614df73805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*QIOefPQZB9k0JvFWPcWACQ.png"/></div></figure><p id="fdc1" class="pw-post-body-paragraph jt ju hi jv b jw kt jy jz ka ku kc kd jg kv kf kg jk kw ki kj jo kx kl km kn hb bi translated">上述步骤将从数据集中移除异常值。</p></div></div>    
</body>
</html>