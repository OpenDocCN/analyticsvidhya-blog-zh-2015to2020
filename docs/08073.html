<html>
<head>
<title>Top 5% Housing Price Prediction — Beginner’s Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">前5%房价预测—初学者指南</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/top-5-housing-price-prediction-beginners-guide-dea7538dd992?source=collection_archive---------19-----------------------#2020-07-16">https://medium.com/analytics-vidhya/top-5-housing-price-prediction-beginners-guide-dea7538dd992?source=collection_archive---------19-----------------------#2020-07-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="0aba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本演练中使用的数据集是由Dean De Cock编译的用于数据科学教育的<a class="ae jd" href="http://www.amstat.org/publications/jse/v19n3/decock.pdf" rel="noopener ugc nofollow" target="_blank"> Ames Housing数据集</a>，并被选择用于<a class="ae jd" href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques/" rel="noopener ugc nofollow" target="_blank"> Kaggle的房价:高级回归技术竞赛</a>。我参加了这个比赛，决定给数据科学新生做一篇文章。本指南将分为4个步骤:</p><ol class=""><li id="02c1" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">探测</li><li id="9d28" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">清洁</li><li id="48f7" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">特征工程</li><li id="428f" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">建模和预测</li></ol><h1 id="a612" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">探测</h1><p id="bd1a" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">第一步是看看我们的特点，并对影响房价的因素做一些预测。更抽象地思考，房子的位置、面积、质量、新旧程度、豪华程度与基于个人经验的价格有很高的相关性。如果我们的预测得到证实，我们可以在以后的特征工程中使用它们。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es kv"><img src="../Images/479dc0e933c41630d09eb994f0e7e5d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*oIN67DQm4uGps-6AWVANHw.png"/></div></figure><p id="ed2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面我们可以看到我们的特征与我们的目标变量的绝对皮尔逊相关性。我们对影响房价的因素的猜测是正确的，让我们在以后的特征工程中记住这一点。请记住查看绝对相关性，因为有些要素可能具有很强的负相关性。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es ld"><img src="../Images/e88694caf636c262f9fe3b29fbc317a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:430/format:webp/1*QVA0o5hu8485s7ERzhga2w.png"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">销售价格与功能的相关性</figcaption></figure><p id="1e2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">既然我们已经有了重要变量的概念，让我们从目标变量的单变量分析开始，因为它是最重要的。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es li"><img src="../Images/a12b15f543ec693fb9890b339ad4d28f.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*ZTPWdkKU32RUOg13p-dmdg.png"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">销售价格直方图</figcaption></figure><p id="3585" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该分布呈尖峰状(峰度)，正偏态(偏斜度)，明显偏离正态分布。下面你可以看到销售价格的值，如果你不知道这些值是什么意思，<a class="ae jd" href="https://codeburst.io/2-important-statistics-terms-you-need-to-know-in-data-science-skewness-and-kurtosis-388fef94eeaa" rel="noopener" target="_blank">看看这篇文章</a>。</p><pre class="kw kx ky kz fd lj lk ll lm aw ln bi"><span id="0515" class="lo jt hi lk b fi lp lq l lr ls">Skewness: 1.882876<br/>Kurtosis: 6.536282</span></pre><p id="942b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种分布也存在于其他特征中，例如GrLivArea。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es lt"><img src="../Images/ef3f86213666d7577976108528dca185.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*FcRwLRvIHqmRSe_BsYU4zw.png"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">GrLivArea直方图</figcaption></figure><p id="6d56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们继续选择一个对<a class="ae jd" href="https://statisticsbyjim.com/regression/heteroscedasticity-regression/" rel="noopener ugc nofollow" target="_blank">异方差</a>(特性值中误差项的不等方差)敏感的模型，这将需要通过Box-Cox等变换或应用对数来解决。</p><p id="2d41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们分析了我们的目标变量，但是我们的特征与它有什么关系呢？这被称为双变量分析。下面我们可以看到SalePrice与TotalBsmtSF的散点图。似乎他们的关系是线性的(略呈指数关系？)我们可以开始看到一些异常值，如图表最右侧的房子，它有一个超过6000平方英尺的巨大地下室，但销售价格低，不跟随趋势。这个异常值可能是农村地区的一栋房子，这解释了价格和面积的差异。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es lu"><img src="../Images/6f3b465850a9e15edc5a8deb598d94be.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*Hnm2B7t1qW28ZDuCuoa9RA.png"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">销售价格x总BsmtSF散点图</figcaption></figure><p id="82c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同上。我们可以看到同样的离群值，居住面积超过5000平方英尺！我们将不得不删除它们，否则我们的模型将被离群值训练，我们的预测将会恶化。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es lv"><img src="../Images/d3041910012f0a19a0d25af00b92f292.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*e6ilXDoygnV1A1QiIJVxzA.png"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">SalePrice x GrLivArea散点图</figcaption></figure><p id="c851" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于我的异常值移除，我手动检查了这些特征，并为它们中的每一个绘制了方框图和散点图，并分析了异常值，以查看它们是否真的应该被移除。</p><h1 id="e9dc" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">清洁</h1><p id="1716" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">首先要做的是确保您的要素具有正确的数据类型。在这个数据集中，我们有许多列，如YrSold、MoSold和YrBuilt，它们被视为数字，但它们应该被视为分类变量。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es lw"><img src="../Images/6cf65bc799307887131a50f05e4d7ce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*9fPCkmnI99zSJDVy1qwA1w.png"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">修复列数据类型</figcaption></figure><p id="a1bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将一年视为一个分类变量似乎有些奇怪。但是，我们无法对这些数字进行合理的数学运算。这样想想，2000年是1000年的两倍吗？它不是，我们不能这样推理，所以它应该是绝对的。</p><p id="b9a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将删除丢失值百分比很高的所有列。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es lx"><img src="../Images/a119d0e25f748146c24118dc33fd80f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xmi3lyeG3YxJYPtvNLmTag.png"/></div></div><figcaption class="le lf et er es lg lh bd b be z dx translated">每列缺失值的百分比</figcaption></figure><p id="ae3f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">剩余的列仍然有缺失值，我们必须对它们进行估算。我喜欢分别对待数字和分类特征，所以我将从数字特征开始。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es mc"><img src="../Images/957163aaa66d92445f89f36a4afbcea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/1*_qFs5DQXeoCWFh2-5hmDgA.png"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">缺少数字列</figcaption></figure><p id="4db7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于数字列，我用0填充了大部分缺失的值，因为这意味着该特征不存在于观测中。如果GarageCars或TotalBsmtSF缺失，则该房屋没有车库或地下室。我不同地估算的唯一一列是LotFrontage，因为这可以由分区法确定，所以我用邻居的中间值来估算。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es md"><img src="../Images/03ac012b190f4d911e60ad1b9eb677d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*InXdV4PWKt1SRUsRNe_j5A.png"/></div></div><figcaption class="le lf et er es lg lh bd b be z dx translated">数字列的插补</figcaption></figure><p id="9b3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将对分类列重复相同的过程。我用“无”替换了大部分缺失值，因为这意味着观察值不呈现特征，剩余的值用它们各自的模式进行估算。对于输入MSZoning列，该模式取自同一MSSubClass的观测值，该观测值确定了所售房屋的类型。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es me"><img src="../Images/9e01764442cf19cca0efcab01ae150d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I02WjO8xw8QW7aSzXDTTJg.png"/></div></div><figcaption class="le lf et er es lg lh bd b be z dx translated">分类列的插补</figcaption></figure><p id="cf6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的最后一步将是通过使我们的数据更像高斯来修复偏斜，并删除方差非常低的特征，因为它们对机器学习模型没有信息。</p><ul class=""><li id="c1a8" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc mf jk jl jm bi translated">还有更复杂的方法来使我们的特征更正常，例如使用Box-Cox或Yeo-Johnson变换，但我将只使用简单的log(x + 1)变换。我添加这个常量是因为我们的一些特性比如TotalBsmtSF可以是0，而log(0)是不可能的。</li><li id="80fc" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc mf jk jl jm bi translated">低方差特征是无意义的，因为我们的模型会过度拟合具有不同值的观察值。如果该列中的主要值超过99.5%，则该值将被删除。</li></ul><p id="2051" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下图中，我们可以直观地看到对数变换后我们的数据更接近高斯分布(正态分布)。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es mg"><img src="../Images/54df749d6f1c5e243b517ffbeab665fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*uiGkwEWPFAC_XCQN20EFlQ.png"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">对数变换后的GrLivArea</figcaption></figure><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es mh"><img src="../Images/3c6d3d9a858e1ab07607a09e157bd8e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*dsbHO_Z82PMqUj5CDtvdiA.png"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">对数变换后的销售价格</figcaption></figure><h1 id="8157" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">特征工程</h1><p id="1fbd" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">这就是创造力发挥作用的地方。还记得我在探索部分提到的定义房子价格的抽象属性吗？我们将使用这些属性来帮助我们思考，并从现有的属性中创建更多的功能。这可以提高你的分数这么多，有比赛已经赢得了令人印象深刻的功能工程，而不是使用先进的模型。下面你可以看到一些新的数字特征，如YearsSinceBuilt和TotalOccupiedArea，它们指的是我们之前讨论过的新度和大小。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="87ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还可以从分类列中创建特征！我们的一些分类列是有序的，这意味着它们有一个自然的排序，我们可以使用它来创建新的特性。每个值都被一个代表其“等级”的整数所取代。</p><pre class="kw kx ky kz fd lj lk ll lm aw ln bi"><span id="5d6e" class="lo jt hi lk b fi lp lq l lr ls">map1 = {'Ex': 5, 'Gd': 4, 'TA': 3, 'Fa': 2, 'Po': 1, 'None': 0}</span><span id="2d7c" class="lo jt hi lk b fi mk lq l lr ls">train_test_features["TotalGarageQual"] = train_test_features["GarageQual"].replace(map1) * train_test_features["GarageCond"].replace(map1)<br/>train_test_features["TotalExteriorQual"] = train_test_features["ExterQual"].replace(map1) * train_test_features["ExterCond"].replace(map1)</span></pre><p id="44d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想知道为什么我没有对列本身应用这种编码，这是因为每种类型之间的距离对查看者的判断很敏感，并且不一定相等，所以我决定让它们保持原样，稍后进行热编码。我仍然将它们映射成这些新特性，因为它们为我们的模型提供了信息，并且这种权衡与实际编码序数列不同。</p><h1 id="3647" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">建模</h1><p id="dc39" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">好玩的部分来了，机器学习！我决定使用sklearn库中的VotingRegressor，它基本上结合了多个回归变量，并对预测进行平均，以生成最终的预测。我使用了哪些基础模型？</p><ul class=""><li id="09cb" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc mf jk jl jm bi translated">套索</li><li id="154d" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc mf jk jl jm bi translated">山脉</li><li id="e93b" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc mf jk jl jm bi translated">弹性网</li><li id="c5de" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc mf jk jl jm bi translated">梯度推进回归器</li></ul><p id="4263" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的数据有很多线性关系，所以我使用了Lasso、Ridge和ElasticNet，它们是线性回归的常用回归变量。它们基本上实现了常见的最小二乘线性回归，但是对于具有高值的系数有一个惩罚。Lasso回归甚至可以将一些系数设置为0，并删除不重要的变量</p><p id="c414" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GradientBoostingRegressor是唯一的一个例外，因为它不一定用于线性回归，但我添加了它来平衡线性回归模型假设的偏差。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es ml"><img src="../Images/b0cb841d382a9a46eecf97e2e83d325c.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*4jchQXUdcoLMsE-c5Aj70w.png"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">预测代码</figcaption></figure><p id="6d3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以超调参数，为模型找到更好的系数，但我决定让它简单，让它保持原样。此外，请记住将预测转换回来，因为我们的模型将输出它们，就好像它们也经过了对数变换一样。在NumPy中，您可以使用exmp1函数来实现这一点。</p><h1 id="74ee" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">结果</h1><pre class="kw kx ky kz fd lj lk ll lm aw ln bi"><span id="5772" class="lo jt hi lk b fi lp lq l lr ls">np.sqrt(-cross_val_score(pipe, X_train, y_train, scoring='neg_mean_squared_error')).mean()</span></pre><p id="5852" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在训练数据上对我们的模型进行交叉验证后，最终得分为0.1002929，在Kaggle上，官方得分为0.12070，在我写这篇文章时，这是本次比赛得分最高的5%。</p><p id="056f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这对您的数据科学之旅有所帮助和启发，如果您想要我的Jupyter笔记本，我很乐意将它送给您。</p></div></div>    
</body>
</html>