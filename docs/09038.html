<html>
<head>
<title>How To Create Your Own Hive SerDe — Hive Custom Data Serialize-Deserialize Mechanism</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建自己的Hive SerDe — Hive自定义数据序列化-反序列化机制</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-create-your-own-hive-serde-871fe675635?source=collection_archive---------12-----------------------#2020-08-23">https://medium.com/analytics-vidhya/how-to-create-your-own-hive-serde-871fe675635?source=collection_archive---------12-----------------------#2020-08-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4025" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我之前的博客文章<a class="ae jd" rel="noopener" href="/@galeguy02/limitation-of-hive-data-validation-1eec015e5ca6">中提到的，<strong class="ih hj"> SerDe </strong> <strong class="ih hj">是hive用来</strong> <strong class="ih hj">反序列化</strong>(从表的hdfs位置读取数据，然后将其转换为java对象)和<strong class="ih hj">序列化数据</strong>(使用ObjectInspector将表示每个数据记录的Java Objec <strong class="ih hj"> t </strong>转换为可写格式，该格式可以写入hdfs位置)。</a></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/3288daebe6904ab889cf2d813e97254d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*F2Z4hrNfl6ikUpkcpfq0yg.jpeg"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">一张图展示了hive如何使用SerDe读写记录。引用自<a class="ae jd" href="http://www.dummies.com/programming/big-data/hadoop/defining-table-record-formats-in-hive/" rel="noopener ugc nofollow" target="_blank"><em class="jq">http://www . dummies . com/programming/big-data/Hadoop/defining-table-record-formats-in-hive/</em></a></figcaption></figure></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><h1 id="01f4" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">SerDe的类型</h1><p id="00e8" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">默认情况下，hive使用一个名为LazySimpleSerDe的SerDe:</p><pre class="jf jg jh ji fd lb lc ld le aw lf bi"><span id="5686" class="lg jz hi lc b fi lh li l lj lk"> <strong class="lc hj">org.apache.hadoop.hive.serde2.LazySimpleSerDe </strong></span></pre><p id="2bc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您在表格创建过程中指定了一个"<strong class="ih hj">文本文件"</strong>格式作为"<strong class="ih hj">存储为"</strong>属性的一部分时。然而，还有其他类型SerDe，包括OpenCSV SerDe。</p><pre class="jf jg jh ji fd lb lc ld le aw lf bi"><span id="927d" class="lg jz hi lc b fi lh li l lj lk"><strong class="lc hj">org.apache.hadoop.<em class="ll">hive</em>.serde2.OpenCSVSerde</strong></span></pre><p id="363a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种情况下，当您必须将表格存储为csv格式时，可以使用它。如果您使用cloudera，它会附带一些名为JSONSerDe的自定义SerDe。</p><pre class="jf jg jh ji fd lb lc ld le aw lf bi"><span id="444a" class="lg jz hi lc b fi lh li l lj lk"><strong class="lc hj">com.cloudera.hive.serde.JSONSerDe</strong></span></pre><p id="b8db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它们能够使用JSON格式读写您的数据。</p><p id="ee9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，如果您能够创建自己的SerDe，您将获得更大的灵活性。当您想将它用于特殊的用例时，这可以被证明是有用的。</p><blockquote class="lm"><p id="2bfb" class="ln lo hi bd lp lq lr ls lt lu lv jc dx translated">所以这篇文章的目的是帮助你开发你自己的定制服务器。</p></blockquote></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><h1 id="4e74" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">如何实现自定义SerDe</h1><p id="0837" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">为了创建一个自定义的SerDe，你必须首先实例化一个实现SerDe接口的类。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="153b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后实例化如下所示的变量:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="9b97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您在这里看到的，每个变量都有自己的用途:</p><ol class=""><li id="0086" class="ly lz hi ih b ii ij im in iq ma iu mb iy mc jc md me mf mg bi translated"><strong class="ih hj"> separatorChar: </strong>代表字段分隔符的变量。当您在Hive表位置存储一个文本文件时，Hive需要知道应该使用哪个字段分隔符来正确地分隔字段。如果未设置此参数，默认分隔符将设置为tab。</li><li id="f4ec" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated"><strong class="ih hj">row TypeInfo:</strong>It<strong class="ih hj"/>存储一个<strong class="ih hj"> </strong>类型为StructTypeInfo <strong class="ih hj"> </strong>的对象，其中<strong class="ih hj"> </strong>包含每个字段的信息，包括名称和类型(type info)。</li><li id="071f" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated"><strong class="ih hj"> rowOI: </strong>它存储ObjectInspector类型的对象，该对象用作表示每一行的占位符。</li><li id="eb39" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated"><strong class="ih hj"> colNames: </strong>它存储一个列名列表。</li><li id="dcf4" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated"><strong class="ih hj"> row: </strong>它存储一个java对象的列表，该列表包含一行中每个字段的值。</li></ol><p id="473d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SerDe接口还要求你实现一些必要的方法，如下所示，以确保它在执行时能够正常工作。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lw lx l"/></div></figure></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><h1 id="b1fe" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">SerDe要求的方法</h1><p id="e487" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">您可以看到，为了让您的自定义SerDe类工作，您必须首先实现一些必需的方法。让我们一个一个地过一遍。</p><p id="c6c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">初始化</strong></p><p id="be00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该方法用于实例化所有重要的属性，例如列名列表、列类型列表和ObjectInspector对象，该对象是用于存储行和列信息的占位符。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="b0a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">解串</strong></p><p id="81fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">需要将一个<strong class="ih hj">可写的</strong>字节数组格式转换成一个java对象。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="af89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> parseField </strong></p><p id="eed2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">这个方法在这里是最重要的，因为Hive使用它来获取和验证每个数据字段中的数据类型。</strong>因此，这个方法让您能够自定义自己的数据验证规则。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="4429" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">连载</strong></p><p id="7bc6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个方法对于将java对象转换为可写字节数组格式很重要。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="ac3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> getObjectInspector </strong></p><p id="e6ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">顾名思义，该方法用于获取表示每个数据记录的ObjectInspector对象。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="a5f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以在下面找到完整的代码。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="ea52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，您必须将java类编译成jar文件，然后在创建表时将其附加到hive查询中。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lw lx l"/></div></figure><h1 id="bb20" class="jy jz hi bd ka kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv bi translated">结论</h1><p id="b15c" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">所以这就是你实现你自己的SerDe所需要的。希望这篇文章能帮助你创建你自己的自定义SerDe，并在你需要的时候做一些数据验证。您可以使用它做任何事情，包括实现json文件读写机制，正如您在互联网上的其他文章中看到的那样。</p></div></div>    
</body>
</html>