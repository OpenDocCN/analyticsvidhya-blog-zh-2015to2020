<html>
<head>
<title>Unsupervised Learning and Convolutional Autoencoder for Image Anomaly Detection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于图像异常检测的无监督学习和卷积自动编码器</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/unsupervised-learning-and-convolutional-autoencoder-for-image-anomaly-detection-b783706eb59e?source=collection_archive---------4-----------------------#2020-01-28">https://medium.com/analytics-vidhya/unsupervised-learning-and-convolutional-autoencoder-for-image-anomaly-detection-b783706eb59e?source=collection_archive---------4-----------------------#2020-01-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7eeb9f36dfa35622f38bc0f467908dbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1pjIONX0hIIz4pO9P6-onA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd iu">图一。来自MNIST的18幅图像作为正常数据，来自时尚-MNIST的2幅图像作为异常数据。</strong></figcaption></figure><p id="1507" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">图像异常检测</strong>出现在现实生活应用的许多场景中，例如，检查医学图像中的异常情况或识别装配线上的产品缺陷。在这篇文章中，我们设置了自己的案例来探索<strong class="ix hj">在无监督学习范式下使用卷积自动编码器进行图像异常检测的过程。</strong>下面简单介绍一下数据、任务、解决方案和评估标准。</p><ul class=""><li id="7e95" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">来自<a class="ae kc" href="https://keras.io/datasets/#mnist-database-of-handwritten-digits" rel="noopener ugc nofollow" target="_blank">MNIST手写数字数据集</a>的图像被认为是正常数据，来自<a class="ae kc" href="https://keras.io/datasets/#fashion-mnist-database-of-fashion-articles" rel="noopener ugc nofollow" target="_blank">时尚-MNIST时尚产品数据集</a>的图像被认为是异常数据。(图1)</li><li id="713d" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated">任务是开发一个异常检测系统，该系统仅由正常数据训练，但将用于在测试期间识别正常数据和异常数据。</li><li id="5676" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated">我们解决方案的核心是一个<a class="ae kc" href="https://blog.keras.io/building-autoencoders-in-keras.html" rel="noopener ugc nofollow" target="_blank">自动编码器</a>，它基本上是一个编码器-解码器系统，将输入重构为输出。我们的目标是训练一个卷积自动编码器，使其能够以较小的重建误差从正常数据重建图像，但以较大的重建误差从异常数据重建图像(图2)。我们的解决方案基于重建误差的阈值来决定图像是来自正常数据还是来自异常数据。</li><li id="0264" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated">该任务的评估标准是在测试数据集中分别识别正常数据和异常数据的准确性。</li></ul><div class="kj kk kl km fd ab cb"><figure class="kn ij ko kp kq kr ks paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/3933a98689dc80c135d96e068cf8cbb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*P7aFcjaMGLwzTvjW3sD-5Q.jpeg"/></div></figure><figure class="kn ij ko kp kq kr ks paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/fb8039bf3a654bd088abc99202209cf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*-bHmKt4JPKIAmmyO47OYnQ.jpeg"/></div><figcaption class="iq ir et er es is it bd b be z dx kt di ku kv translated"><strong class="bd iu">图二。自动编码器重建误差较小的正常数据(</strong> <a class="ae kc" href="https://blog.keras.io/building-autoencoders-in-keras.html" rel="noopener ugc nofollow" target="_blank"> <strong class="bd iu">左</strong> </a> <strong class="bd iu">)和误差较大的异常数据(右)。</strong></figcaption></figure></div><p id="d997" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这篇文章的其余部分组织如下。首先，我们将解释整个数据集和训练/验证/测试数据集的组织。接下来，我们将简要介绍自动编码器的概念以及将其应用于异常检测的想法。最后，我们将介绍我们解决方案的完整流程，然后评估结果。</p><h1 id="a6ff" class="kw kx hi bd iu ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">1.MNIST和时尚-MNIST</h1><p id="4211" class="pw-post-body-paragraph iv iw hi ix b iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">我们认为来自MNIST手写数字数据集(图3中的左边部分)的图像将是正常数据，来自时尚-MNIST时尚产品数据集(图3中的右边部分)的图像将是异常数据。这两个数据集都被包含在深度学习库<a class="ae kc" href="https://keras.io/datasets/" rel="noopener ugc nofollow" target="_blank"> Keras </a>中。</p><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/d0dc7aefda75821b882d94f5210abc9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SEgos6UHjeRSqmBvDGUSVA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd iu">图三。MNIST和时尚-MNIST。</strong></figcaption></figure><p id="f4c8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">表1显示了用于培训、验证和测试的数据。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="lz ma l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="ak">表1。训练/验证/测试数据集。</strong></figcaption></figure><ul class=""><li id="c399" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated"><strong class="ix hj">训练数据集</strong> : 54000幅28x28的MNIST图像用于训练卷积自动编码器；</li><li id="261a" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated"><strong class="ix hj">验证数据集</strong> : 6000幅28×28的MNIST图像用于两个目的:1 .验证验证数据集的平均损失<em class="ki">是否在训练数据集</em>的平均损失<em class="ki">的邻域内，以查看卷积自动编码器是否过拟合；2.开发用于分离正常数据和异常数据的重建误差阈值；</em></li><li id="7da6" class="jt ju hi ix b iy kd jc ke jg kf jk kg jo kh js jy jz ka kb bi translated"><strong class="ix hj">测试数据集</strong> : 500张28x28的MNIST图像和500张28x28的时尚MNIST图像用于最终检查。</li></ul><h1 id="db58" class="kw kx hi bd iu ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">2.什么是自动编码器，如何训练自动编码器学习MNIST</h1><p id="2415" class="pw-post-body-paragraph iv iw hi ix b iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">一个<strong class="ix hj">自动编码器</strong>基本上是一个编码器-解码器系统，它将输入重构为输出。这通过两个子系统实现:<strong class="ix hj">编码器</strong>接收输入(例如，图像、一段音频/声音、文本等。)并将其映射到内部表示(例如，代码、嵌入或特征向量)，而解码器<strong class="ix hj">获取内部表示并将其映射回原始输入。图4显示了自动编码器的架构。典型地，编码器和解码器被实现为深度神经网络。</strong></p><figure class="kj kk kl km fd ij er es paragraph-image"><div class="er es mb"><img src="../Images/7398c629abef6ad63b05a87eb6991f79.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/format:webp/1*UXJc3rWGKGPuZSs_KcIltw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd iu">图4。一个自动编码器的架构[</strong><a class="ae kc" href="https://en.wikipedia.org/wiki/Autoencoder#Basic_Architecture" rel="noopener ugc nofollow" target="_blank"><strong class="bd iu">ref</strong></a><strong class="bd iu">]。</strong></figcaption></figure><p id="feb9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有趣的是，从一开始，自动编码器的目标就是在无监督学习下学习给定数据集的表示。然而，它可以用于许多不同的场景，例如，特征提取、降维、噪声消除或数据生成。</p><p id="10c2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们的情况下，我们采用卷积自动编码器来学习MINST的表示，并希望它在测试期间可以从MNIST重建图像比从时尚MNIST重建图像更好，因为前一种情况是从已知表示，而后一种情况是从未知表示。遵循Keras 的博客<a class="ae kc" href="https://blog.keras.io/building-autoencoders-in-keras.html" rel="noopener ugc nofollow" target="_blank">中的想法，我们的自动编码器学习MNIST的代码如图5所示。</a></p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="lz ma l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="ak">图五。Keras实现的自动编码器。</strong></figcaption></figure><p id="e74f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">训练数据集和验证数据集的二进制交叉熵的损失历史如图6所示。</p><figure class="kj kk kl km fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/bb92512e327dd86b5714ec0ecf091077.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*s2U1M9kfskO1PwTtv8H8_w.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd iu">图六。培训损失和验证损失。</strong></figcaption></figure><h1 id="5096" class="kw kx hi bd iu ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">3.如何定义重建误差的度量和阈值</h1><p id="7506" class="pw-post-body-paragraph iv iw hi ix b iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">在自动编码器完成学习过程之后，建立异常检测机制有两个主要步骤:(1)定义原始图像和重建图像之间的重建误差的度量，以及(2)确定重建误差的阈值，以便分离正常数据和异常数据。</p><figure class="kj kk kl km fd ij er es paragraph-image"><div class="er es md"><img src="../Images/10055817381e36bd44a55df87200bf65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*fl5JodQOvtH2CBJAPofBew.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd iu">图7。重建误差的概念。</strong></figcaption></figure><p id="6177" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里，我们将交叉熵视为原始图像和重建图像之间的重建误差，并将重建误差平均值的3个标准差视为阈值。注意交叉熵的实现似乎很棘手。详情请参考<a class="ae kc" href="https://stackoverflow.com/questions/49473587/why-is-my-implementations-of-the-log-loss-or-cross-entropy-not-producing-the-s" rel="noopener ugc nofollow" target="_blank">此处</a>和<a class="ae kc" href="https://stackoverflow.com/questions/47377222/what-is-the-problem-with-my-implementation-of-the-cross-entropy-function" rel="noopener ugc nofollow" target="_blank">此处</a>。将正态分布和异常检测联系起来的思想可以在<a class="ae kc" href="https://anomaly.io/anomaly-detection-normal-distribution/index.html" rel="noopener ugc nofollow" target="_blank">这里</a>中找到。</p><blockquote class="me mf mg"><p id="f2ee" class="iv iw ki ix b iy iz ja jb jc jd je jf mh jh ji jj mi jl jm jn mj jp jq jr js hb bi translated">注:<strong class="ix hj">均方误差</strong>或<strong class="ix hj">结构相似性指数(SSIM) </strong>也可用作重建误差。查看[ <a class="ae kc" href="https://www.pyimagesearch.com/2014/09/15/python-compare-two-images/" rel="noopener ugc nofollow" target="_blank">此处</a>和[ <a class="ae kc" href="https://towardsdatascience.com/image-classification-using-ssim-34e549ec6e12" rel="noopener" target="_blank">此处</a>了解更多详情。但是，如果自动编码器针对交叉熵进行了优化，则最好使用交叉熵作为重构误差。</p></blockquote><h1 id="a956" class="kw kx hi bd iu ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">4.评估测试数据集</h1><p id="ac5d" class="pw-post-body-paragraph iv iw hi ix b iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">500幅MNIST图像和500幅时尚MNIST图像被用于评估我们的异常检测过程。</p><p id="471c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">步骤1 </strong>:将所有图像传入自动编码器，得到其对应的重建图像；(图8显示了一些图像对作为示例。)</p><p id="8cd4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第二步</strong>:计算每对图像的交叉熵重建误差；(图9以绿色示出了MNIST图像的重建误差，以蓝色示出了时尚MNIST图像的重建误差。)</p><p id="6750" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第三步:</strong>以重建误差均值的3个标准差为阈值，识别正常数据和异常数据；(图9用红色显示了阈值线。)</p><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/7ded186cbf9a04b904b1bc8943b8a9c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*POCkhDbUagouM7pbcXRQuw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd iu">图8。来自测试数据集的一些原始图像(第1/3行)和重建图像(第2/4行)。</strong></figcaption></figure><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/5ca5cba2996153906641d02379b85e72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9fBqSy_F6vuOF0E_UXhRHQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd iu">图九。MNIST图像和时尚MNIST图像的交叉熵。</strong></figcaption></figure><p id="9aed" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">图9显示识别正常数据和异常数据的准确率为99.80%。</p><h1 id="c08e" class="kw kx hi bd iu ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">5.结论</h1><p id="d853" class="pw-post-body-paragraph iv iw hi ix b iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">这篇文章描述了在无监督学习的范例下使用卷积自动编码器进行图像异常检测的过程。然而，根据我的经验，许多现实生活中的图像应用，例如检查医学图像或产品缺陷，都是通过监督学习来实现的，例如图像分类、对象检测或图像分割，因为它可以提供更多关于异常状况的信息，例如异常状况的类型和位置(潜在的大小和数量)。另一方面，监督学习需要在所有图像上进行标记，这不仅是劳动密集型的，而且可能有噪声。因此，在一些异常检测问题中，无监督学习可能是一种合理的方法或伴侣。</p><p id="3472" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢阅读。如果您有任何问题或意见，请随时留言。</p></div></div>    
</body>
</html>