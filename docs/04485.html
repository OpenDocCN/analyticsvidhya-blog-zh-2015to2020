<html>
<head>
<title>Finding Second Hand Car Deals with Python and Matplotlib</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python和Matplotlib寻找二手车交易</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/finding-second-hand-car-deals-with-python-and-matplotlib-a0d6c1d15744?source=collection_archive---------16-----------------------#2020-03-21">https://medium.com/analytics-vidhya/finding-second-hand-car-deals-with-python-and-matplotlib-a0d6c1d15744?source=collection_archive---------16-----------------------#2020-03-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="24a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在全球疫情，人们被敦促呆在室内，在经济下滑得比WhatsApp视频电话还厉害的情况下，我产生了购买自己第一辆新车(但不是“新新车”)的冲动。</p><p id="7e94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在花了几周时间翻遍二手市场的页面，考虑了价格、年份、里程、品牌、型号和我的预期之后，我得出结论，试图找到一笔好交易糟透了。你开始考虑一些事情<em class="jd">“一辆福特嘉年华会很好，我的预算是100，000美元，但是这个价格的里程数比我想支付的要高得多，所以可能会多花一点或者获得更高的里程数，但是今年呢……”</em>如此多的因素，在结果页面中挖掘，切换设置，试图比较如此多的不同因素，令人疲惫不堪。</p><p id="ec6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有一次，我在看菲亚特500，我看到了一辆里程数不错、年份也不错的车，但根据我脑子里所有的参考资料，我认为它定价过高。这是一个令人心痒痒的想法，“如果我能把所有的菲亚特500，采取各种不同的年份，价格和里程的组合，并绘制一个图表，看看这一特定的叠加在一起”。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/dfe93e1e5eda614acde6413e92cc366f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mh3rvo_C-dD-b-lCCxZTmw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">先睹为快的“最终”结果</figcaption></figure><h2 id="aa54" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">抓取数据</h2><p id="32c8" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">我浏览最多的平台是Gumtree.co.za、Facebook Marketplace、Cars.co.za和Autotrader.co.za，这四个平台是我在Gumtree上花费时间最多的(各网站之间也有很多重叠)。对于第一次迭代，我去了一个特定的搜索，如大众Polo Vivo，并抓取了如下所示的URL，并将价格、年份、里程字段分成变量，以便我可以在以后调整我的搜索。</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="3965" class="ju jv hi kv b fi kz la l lb lc"><a class="ae ld" href="https://www.gumtree.co.za/s-cars-bakkies/western-cape/volkswagen~polo-vivo/page-2/v1c9077l3100001a2mamop2?cy=2014,2021&amp;pr=70000,200000&amp;km=,100000" rel="noopener ugc nofollow" target="_blank">https://www.gumtree.co.za/s-cars-bakkies/western-cape/volkswagen~polo-vivo/page-2/v1c9077l3100001a2mamop2?cy=2014,2021&amp;pr=70000,200000&amp;km=,100000</a></span></pre><p id="e071" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您会注意到有一个唯一的标识符“v1c9077l3100001a2mamop2”，它与每个搜索相关，所以我不能只更改“/volkswagen~polo-vivo/”部分来更改搜索结果。另一件要注意的事情是，唯一标识符的最后一位是页码的副本，我花了一段时间才弄明白。</p><p id="f911" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我弄清楚了URL公式，我就使用Requests包来发出HTTP请求，使用BeautifulSoup包来解析HTML，提取特定的数据并将其添加到CSV文件中，如下所示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es le"><img src="../Images/bb0149bf549a97fe0fced776306ff79d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PBmP_D04DXT_5iBBTkcK6w.png"/></div></div></figure><p id="3b2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于我感兴趣的每辆车，我都是手动完成的。</p><h2 id="875f" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">绘制第一张图表</h2><p id="1a4b" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">所以第一张图看起来像这样，非常基本，我想左下象限的东西会更好。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lf"><img src="../Images/b8ca9162e023b3377aa5d38d72bb7ebd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3BWHF21qHgw-ibzIfB1DxQ.png"/></div></div></figure><p id="eca0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我做的下一件事是根据车型年对分数进行颜色编码，因为这是要考虑的三大因素之一，一辆30岁的低里程的廉价车不一定是件好事。</p><p id="3e72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以在下图中，新的车颜色较浅(黄色)，旧的车颜色较深(深蓝色)。这给了我们一个更好的想法，所以如果我们在左下象限20000/190000处看，有一个相当亮的绿点，这可能是一个很好的交易。实际上，那是哪辆车🤔…</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lg"><img src="../Images/209db873081040a6051e02be98466034.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hd0V9A8lZR59vWD1qWiVww.png"/></div></div></figure><h2 id="0273" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">获取标签</h2><p id="1601" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">因此，绘制完所有内容后，下一步是能够识别各个点。所以在这里我使用了Mplcursors包来允许悬停在特定的点上并提取它们的数据。(注意:这里有很多从Stack Overflow复制粘贴的内容，我不是数据科学家，但我对Pandas和Matplotlib有基本的了解，而且几乎必须搜索所有内容)。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lh"><img src="../Images/4230b76e88ed3c0b9ce5765cc32cd437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S4jksdgQcHgjc-ZcvbZDUQ.png"/></div></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es li"><img src="../Images/0e76cc3f126fc291a956d20dfca72595.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qeqMarT-Xh4mhI-ohbq02w.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">放大左下象限</figcaption></figure><p id="be27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很好，现在我们有了显示相关信息的标签。您还可以看到，我添加了一个唯一的ID，它对应于CSV中的行，所以如果我可以从那里获取URL，以便稍后检查汽车。</p><h2 id="e910" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">比较价格和年份</h2><p id="170a" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">因此，尽管彩色点有助于识别一年中更好/更差的交易，但这在很大程度上取决于你区分颜色深浅的能力。</p><p id="ac7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以我想我们来创造一个分值，那就是里程/年。首先，我们需要将这些值归一化到0到1之间，然后我们将归一化里程除以归一化年份，得到一个分值，并将其绘制在y轴上。不幸的是，我不是数学家或数据科学家，我不确定最佳公式或权重是什么，但这只是为了好玩，所以让我们继续。</p><p id="ccf0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们可以看到分数/价格图，分数越低越好。现在，颜色代表里程数(浅=高，深=低)，因此，我们再次根据预算，查看左下象限或右下象限。这里的颜色不是任何有用的指标，较深的颜色意味着较低的里程数，但取决于它在y轴上的位置，代表一年中的权衡。在右下角，你有很多低分，这是最近的2018-2020款，里程数低，但当然，你要为它们付出更多。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lj"><img src="../Images/5e7e660859bbd3fd739dd60f703d86a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EgofQtiFQpWynj3sNSVOxA.png"/></div></div></figure><h2 id="1c49" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">趋势线/多元拟合曲线🤔 🤷‍♂</h2><p id="26bc" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">因此，看着这些数据，回到最初让我陷入这个兔子洞的想法，我想让我们添加一条趋势线，线以上的任何东西都被高估了，线以下的任何东西都是公平/好交易</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es le"><img src="../Images/9b6431c9dafc2e2adf9dac22ccd19ae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IQrcR8dFg4YFkxyF0wnEGw.png"/></div></div></figure><p id="679d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">酷，这里我们有一个趋势线，一个点在线下越远，交易就越好，看起来很简单。虽然数据看起来有点像曲线，但我们需要一条平均所有因素的曲线。所以我不知道这在数学上是如何工作的，我只是在网上抓取了一些代码并让它工作。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lk"><img src="../Images/4b6d537b8c4fb0ac2f8db22b9a76abc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3zvkdFe9xAZMqODaTHezlA.png"/></div></div></figure><p id="0a8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很好，现在我们有了一条曲线，它更好地代表了一辆车的价值。左下角象限的两个异常值看起来是很好的交易。同样在这之后，我去掉了趋势线，因为它看起来并不重要。</p><h2 id="b065" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">刮掉一切</h2><p id="eae6" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">此时我想，数据越多=越好。因此，我修改了我的原始抓取脚本，以获取每个品牌和型号以及每个唯一标识符，并只抓取所有数据(仍在价格/年份/里程的特定参数内)。所以现在我拥有所有10万公里以下的车辆，在7万-20万兰特之间，以及比2012年更新的车辆。这就是它的样子。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ll"><img src="../Images/ab6f80019b22440b250d2517ed541bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-LSrA66IihJrwNk8JwF3lw.png"/></div></div></figure><p id="7a5d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尽管信息丰富，但将每辆车与其他车进行比较并没有多大帮助。一些汽车的质量要差得多，你需要精心挑选一组价格相近的汽车来进行公平的比较。在上面的例子中，底部区域填充了雷诺Kwids、达特桑Gos、铃木Celerios和一些起亚Picantos。</p><h2 id="f5d0" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">添加功能</h2><p id="c12c" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">从这里我开始添加功能，所以你可以指定具体的品牌和型号。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lm"><img src="../Images/24f53aded70a3fc910826b22c11e8a36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ntgUSqm4okkM2nom7OTjIg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">单一品牌过滤</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ln"><img src="../Images/6d095b818fc676ae75ed3eb68651d38c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ed_W1mBVfc6WgIMahO33A.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">过滤多个制造商</figcaption></figure><p id="3abb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">按品牌进行过滤是非常通用的，按一个或多个相似类别的车型进行过滤更有意义，例如福特嘉年华和现代I20</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lo"><img src="../Images/0ffcb01b978fed9e50b20d9e04c0ab31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y46Bxsp5R1jUuxEOszyMVQ.png"/></div></div></figure><p id="6d8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我添加了一些功能，通过命令行标志来选择品牌和型号，这使得比较结果更加容易。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lp"><img src="../Images/75e0413e75f0746d0df1e46b6b5f0631.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*06CVcGzkfPdx7dv7b1WjgA.png"/></div></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lq"><img src="../Images/edbc4e5c01937bb96185b696c6af4a8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nY2X3hTt7YpAiVcALD7Z3w.png"/></div></div></figure><h2 id="0367" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">结论</h2><p id="2e8d" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">这是我的“最终”结果，当我来到这里的时候，我已经决定了我想要的车，由于下面的原因，我相当有信心我得到了一笔好交易。除了数据之外，还有很多因素影响买车，但是在做出买车这样的重大决定时，拥有这样的信息并且易于理解是非常有益的。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lr"><img src="../Images/db2d3349b110c951833f06a718379353.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yxixGrhWWLKMgHagbIZ8tQ.png"/></div></div></figure><p id="dd6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢阅读！</p></div></div>    
</body>
</html>