<html>
<head>
<title>Implementing Chargrid: Towards Understanding 2D Documents.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实施Chargrid:理解2D文件。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/implementing-chargrid-towards-understanding-2d-documents-c7189d89a0?source=collection_archive---------6-----------------------#2020-08-20">https://medium.com/analytics-vidhya/implementing-chargrid-towards-understanding-2d-documents-c7189d89a0?source=collection_archive---------6-----------------------#2020-08-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="61b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Chargrid — OCR(第一部分)</p><p id="140b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">理解2D文档</strong> —即获取2D结构化文档的语义。文本信息通常通过具有2D布局文档来表示。它们的内容和布局(位置、大小等)决定了文档的语义。为了获得文档的语义，有一种叫做“Chargrid”的新方法。</p><h2 id="349c" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated"><strong class="ak">查格里德:</strong></h2><p id="b846" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">所提出的名为chargrid的方法没有在1D文本中使用序列化文档，而是通过将文档表示为稀疏的2D字符网格来保存文档的空间结构。</p><p id="8dc0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">chargrid可由字符框构成，即，每个包围给定文档页面上某处的单个字符的边界框。</p><p id="0086" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了实现chargrid，我们需要从文档的图像中提取信息，如每个字符的坐标(位置信息)，文本信息等，这将在名为“<a class="ae kd" href="https://pypi.org/project/pytesseract/" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">pytesserac</strong></a>的OCR工具的帮助下完成。<strong class="ih hj"> Python-tesseract是Python的光学字符识别(OCR)工具。也就是说，它将识别并“读取”嵌入图像中的文本。</strong></p><h2 id="5e87" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">实施Chargrid:</h2><p id="4eb5" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">这里，文档的chargrid表示背后的思想是获取每个字符并用特定的整数索引替换它的边界框像素。例如，我们可以将字母表(或任何感兴趣的字符)映射到非零索引{a，b，c，…} → {1，2，3，…}。</p><p id="316c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">换句话说，对于任何位置的每个字符，该字符所覆盖的区域将被某个常量值填充。</p><p id="9af8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">优势—</p><p id="6c00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a)我们直接通过单个标量值对字符进行编码，而不是通过灰度像素的粒度集合</p><p id="51f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b)因为属于给定字符的像素组现在都被映射到相同的常数值，所以我们可以显著地对chargrid表示进行下采样，而不会丢失任何信息。</p><p id="bc07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以看下面的截图了解更多—</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es ke"><img src="../Images/6f209d5296c407a2e23223727b403629.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*9Bx_ZIgIP7sXC3-X6AEQ7g.png"/></div><figcaption class="km kn et er es ko kp bd b be z dx translated">每个字符上的边界框—宇宙魔方。</figcaption></figure><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es kq"><img src="../Images/0362ec701403b9395433e177408bbdb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*UVGUmw2WXxfG1H8IbARNcQ.png"/></div><figcaption class="km kn et er es ko kp bd b be z dx translated">文档图像的chargrid表示。</figcaption></figure><p id="461e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">我们开始吧— </strong></p><p id="7fc2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先你需要安装<strong class="ih hj"> pytesseract、openCv和pdf2image </strong>，然后导入这些库</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es kr"><img src="../Images/662d700e22d47412bc29161e888e772c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8G3025C9XAFzBQT_n8W76g.png"/></div></div><figcaption class="km kn et er es ko kp bd b be z dx translated">导入库。</figcaption></figure><p id="360c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> pdf2image </strong> —一个将pdf转换为PIL图像的python模块。</p><p id="80e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用pdf2image将您的pdf文档转换成如下图像—</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es kw"><img src="../Images/06d92be40db13a6eec9759e210b722b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ptLijP1SUnLx4JV_kHVH9w.png"/></div></div><figcaption class="km kn et er es ko kp bd b be z dx translated">将图像保存在您想要的路径“保存路径”</figcaption></figure><p id="4365" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了避免你的立方体输出精度下降的所有方式，你需要确保图像被适当地<strong class="ih hj"> </strong> <a class="ae kd" href="https://github.com/tesseract-ocr/tesseract/wiki/ImproveQuality#image-processing" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">预处理</strong> </a> <strong class="ih hj">。</strong></p><p id="b623" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">这包括重缩放、二值化、去噪、去歪斜等。</strong></p><p id="e9ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要为OCR预处理图像，请使用以下任何python函数或遵循<a class="ae kd" href="https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_table_of_contents_imgproc/py_table_of_contents_imgproc.html" rel="noopener ugc nofollow" target="_blank"> OpenCV文档</a>。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es kx"><img src="../Images/4a9597a83dab229f6ab95b5d33969b73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*298o4UOlW9lO37SxzMD5Rg.png"/></div></div><figcaption class="km kn et er es ko kp bd b be z dx translated">将图像转换为灰度并去除噪点。</figcaption></figure><p id="db9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预处理图像后，使用pytesseract从保存的图像中提取文本，如下所示</p><p id="6a22" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意—输出是数据帧</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es ky"><img src="../Images/0adf6f2fac21cfa3349dd972881ed19e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*18VioFfrCevk6jWyiE01pA.png"/></div></div></figure><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es kz"><img src="../Images/c6d1b5f1bdeaec81351640b1366c1ac1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E8y1aZ3IC30Iplc-P3ihnw.png"/></div></div></figure><p id="c8cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以你有了page_num，block_num，par_num，line_num，word_num和每个单词的坐标以及它们的置信度得分。</p><p id="236b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图像的形状—</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es la"><img src="../Images/0e922d1edc604934c05ac1c014906708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WF7tJUDkiAtW-_YdU8wVXQ.png"/></div></div></figure><p id="ac47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在定义一个函数来构建这个图像的chargrid将dataframe作为参数传递，并逐个字符地分割以获得每个字符的坐标。并返回chargrid数据帧(chargrid_pd)。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es lb"><img src="../Images/b2bbf93462da7e375825136e4f68580e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mRveDNF35QIsNhqD3Y6G5g.png"/></div></div></figure><p id="cc95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个chargrid_pd包含列are——它给出了每个字符的位置信息及其相应的置信度得分。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es lc"><img src="../Images/400abf1a798a321d4d3d8ab5efed0ad9.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*O45uojOEdEpWyfSGIqvEmQ.png"/></div></figure><p id="fbe9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意—为了在每个字符上有边界框的图像，您可以编写这样的代码—使用imread()函数读取图像，然后调用image _ to _ boxes()pytesserac函数，这样您就有了框，然后绘制矩形。最后使用cv2.imwrite()函数保存图像。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es ld"><img src="../Images/5db5c9415b5a96798f40900df6bc886a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*exXI0Rzjq9MvG9H1fS_WbA.png"/></div></div></figure><p id="5c65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出将会是—</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es le"><img src="../Images/07110ccaf06f07b81d0f80a6c79afa59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*VfHqRmT0HwKRlH77h-F_jA.png"/></div><figcaption class="km kn et er es ko kp bd b be z dx translated">字符周围的边框。</figcaption></figure><p id="f0e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我做了一个函数来获取chargrid_pd的numpy数组—</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es lf"><img src="../Images/a68fcd7336c88deb8e864783c20a2cff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uVlCC-rj-213i8TVifQMxw.png"/></div></div></figure><p id="2b2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">调用这些函数，并将chargrid_np文件以‘png’格式保存在所需的路径中。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es lg"><img src="../Images/6f5aeeac2dcbe4770b81997971d46d2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IO79SSSH8xs6eOGH5MRObg.png"/></div></div><figcaption class="km kn et er es ko kp bd b be z dx translated">outdir_png_chargrid应该是您想要的路径。</figcaption></figure><p id="dce4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">保存的文件将是—</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es lh"><img src="../Images/63b313ece221af88d1e2fadacb432384.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*aY7nzFQLQghzLml7-vXT8w.png"/></div><figcaption class="km kn et er es ko kp bd b be z dx translated">去掉图像。</figcaption></figure><p id="f556" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是你如何制作文档图像的chargrid。在第2部分中，我们将着眼于神经网络结构。</p><p id="00fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在关注的研究论文，这里是<a class="ae kd" href="https://arxiv.org/abs/1809.08799" rel="noopener ugc nofollow" target="_blank">链接</a>。为了更好地理解，必须阅读它。</p><p id="efe1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢大家！</p></div></div>    
</body>
</html>