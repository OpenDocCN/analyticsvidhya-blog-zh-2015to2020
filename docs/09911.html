<html>
<head>
<title>Building a Movie Recommendation Engine in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 构建电影推荐引擎</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/building-a-movie-recommendation-engine-in-python-53fb47547ace?source=collection_archive---------4-----------------------#2020-09-26">https://medium.com/analytics-vidhya/building-a-movie-recommendation-engine-in-python-53fb47547ace?source=collection_archive---------4-----------------------#2020-09-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9e63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用 Python 和 SentenceBERT 在几分钟内构建您自己的电影推荐器。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/98b94c9fceb39f77431f66d3161427d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*nNnbemcCtKHJD-zIMeSolQ.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">罗曼·马顿在<a class="ae jp" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="add5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在浏览网飞或 Prime Video 的时候，你一定遇到过一个根据你的观看历史或你所在地区当前的流行趋势向你推荐电影和电视节目的栏目。想知道这是怎么做到的吗？使用电影推荐引擎。</p><p id="8381" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将向你展示如何从头开始构建你自己的电影推荐器。将会有一些理论来帮助你理解正在做的事情和大量的实践工作。所以让我们开始吧！</p><p id="a69d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通常，电影推荐器是以下类型之一:</p><ol class=""><li id="57f5" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">基于推荐—基于用户所在地区最受欢迎的视频的简单系统。是的，你猜对了 YouTube 趋势页面。</li><li id="222b" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">基于内容—根据电影情节、类型、演员、语言等标准查找相似的电影。</li><li id="9e26" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">协作过滤—基于用户的观看历史/模式。例如，网飞使用了基于内容和协同过滤的组合。</li></ol><p id="b3ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们开始推荐吧！这将是一个基于内容的一个特定的电影，将建议基于给定电影的概述类似的电影。</p><h2 id="f4fa" class="ke kf hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated">资料组</h2><p id="7bea" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">我们将在 Kaggle 上使用<a class="ae jp" href="https://www.kaggle.com/rounakbanik/the-movies-dataset" rel="noopener ugc nofollow" target="_blank">‘电影数据集’</a>。没有必要下载整个数据集；只需下载“movies_metadata.csv”文件。该文件包含超过 45k+电影的一系列信息，例如电影名称、分级、类型、概述、演员等等。我们使用以下代码加载文件:</p><pre class="je jf jg jh fd le lf lg lh aw li bi"><span id="14ee" class="ke kf hi lf b fi lj lk l ll lm">import pandas as pd<br/>movies = pd.read_csv("movies_metadata.csv", usecols = [5,9,20])<br/>movies_head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ln"><img src="../Images/c30f5b652d200a4ae9382c456461493d.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*iu-PVLer-PkZBtgkHVxoIA.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">图 1:电影数据集前 5 部电影</figcaption></figure><p id="b738" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们继续构建推荐器之前，让我们对数据集进行一些清理。有些电影没有概述(图 2)。我们还通过给电影分配索引来对数据集中的电影进行编号。下面代码中的 for 循环基本上是为数据集中的每部电影分配一个数字(从 0 到电影数)。我们还将定义两个助手函数来检索电影的名称及其在数据集中的相关索引。这些功能将在稍后推荐电影时被推荐者使用。</p><pre class="je jf jg jh fd le lf lg lh aw li bi"><span id="2794" class="ke kf hi lf b fi lj lk l ll lm">def get_title(index):<br/>    return movies[movies.index == index]["title"].values[0]</span><span id="a1fc" class="ke kf hi lf b fi lo lk l ll lm">def get_index(title):<br/>    return movies[movies.title == title]["index"].values[0]</span><span id="5978" class="ke kf hi lf b fi lo lk l ll lm">movies['index'] = [i for i in range(0, len(movies))]</span><span id="7a9e" class="ke kf hi lf b fi lo lk l ll lm">movies = movies.dropna()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lp"><img src="../Images/e1de914b15ccf878877978b4dd8cc554.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*5GwJ2BFW1hadL1e2-MH04g.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">图 2: NaN/Null 值</figcaption></figure><h2 id="f9fa" class="ke kf hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated"><strong class="ak">推荐引擎</strong></h2><p id="be54" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">现在我们已经准备好了数据集，让我们开始构建模型。但是在编码之前，让我们先了解一下我们要怎么做。我们将利用句子嵌入来完成这项任务。句子嵌入帮助我们将一个或多个句子(在我们的例子中是电影概述)及其语义信息表示为向量。简单地说，这些向量代表了电影总览的含义、上下文和其他微妙的细微差别。</p><p id="3e8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用广受好评的句子伯特模型来获得我们的句子嵌入。为了对这个模型有一个基本的了解，请参考这篇<a class="ae jp" href="https://www.analyticsvidhya.com/blog/2020/08/top-4-sentence-embedding-techniques-using-python/" rel="noopener ugc nofollow" target="_blank">文章</a>和这篇<a class="ae jp" href="https://arxiv.org/abs/1908.10084" rel="noopener ugc nofollow" target="_blank">研究论文</a>以获得更深入的了解。</p><p id="e23b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，现在回到编码上来！我们现在加载句子-伯特模型。SentenceTransformer()中的参数是预训练模型的名称。预训练模型的完整列表可以在<a class="ae jp" href="https://github.com/UKPLab/sentence-transformers/blob/master/docs/pretrained-models/sts-models.md" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="820b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:下载和安装过程可能需要一段时间。</p><pre class="je jf jg jh fd le lf lg lh aw li bi"><span id="4ab6" class="ke kf hi lf b fi lj lk l ll lm">!pip install sentence-transformers<br/>from sentence_transformers import SentenceTransformer<br/>bert = SentenceTransformer('bert-base-nli-mean-tokens')</span></pre><p id="e7e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们使用这个模型来获取我们的数据集中的电影向量。</p><pre class="je jf jg jh fd le lf lg lh aw li bi"><span id="1dc6" class="ke kf hi lf b fi lj lk l ll lm">sentence_embeddings = bert.encode(movies['overview'].tolist())</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lq"><img src="../Images/0f7d0b840b401d000b11e62d4ab9adb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*Bxf3mtGIY3xl37u8LWj4lQ.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">图 3:电影概述的嵌入</figcaption></figure><p id="f94b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们有了向量，我们需要计算它们之间的相似性。我们如何做到这一点？简单，用余弦相似度。使用余弦相似性，我们可以得到两个向量之间的相似性得分。分数为 0 表示没有相似性，而分数为 1 表示完全相似。使用下面的代码，我们计算数据集中每部电影之间的相似性得分。</p><pre class="je jf jg jh fd le lf lg lh aw li bi"><span id="06bd" class="ke kf hi lf b fi lj lk l ll lm">similarity = cosine_similarity(sentence_embeddings)</span></pre><p id="ca32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">相似性变量是 2D 阵列。每一行对应于一部电影，并且包含该电影与数据集中所有其他电影的相似性。</p><p id="0829" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">瞧，就是这样。恭喜你，你的推荐人已经准备好了！让我们用行动来检验一下。</p><pre class="je jf jg jh fd le lf lg lh aw li bi"><span id="7dcc" class="ke kf hi lf b fi lj lk l ll lm">notOver = True<br/>while(notOver):<br/>    user_movie = input("Enter the movie for which you want recommendations: ")</span><span id="fa7a" class="ke kf hi lf b fi lo lk l ll lm"># Generate Recommendations<br/>    recommendations = sorted(list(enumerate(similarity[get_index(user_movie)])), key = lambda x:x[1], reverse = True)<br/>    print("The top 3 recommendations for" + " " + user_movie + " " + "are: ")<br/>    print(get_title(recommendations[1][0]), get_title(recommendations[2][0]), get_title(recommendations[3][0]), sep = "\n")<br/>    decision = input("Press 1 to enter another movie, 0 to exit")<br/>    if(int(decision) == 0):<br/>        print("Bye")<br/>        notOver = False</span></pre><p id="7528" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的代码在数据集中找到了与我们输入的电影最相似的 3 部电影。</p><p id="f81a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:您输入的电影必须存在于数据集中。让我们看看《玩具总动员》有什么推荐。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lr"><img src="../Images/1d7c4f486ee0cb0c5b14e772f53ce720.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*qfhu1zR8585aM-meSfehIA.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">图 4:类似于《玩具总动员》的电影</figcaption></figure><p id="57b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于我们的模型，这里的推荐看起来相当不错！《烛光秀》和《白雪公主》都是儿童电影。第二个建议是一部喜剧，也是《玩具总动员》的一部分。去给其他电影一个尝试，你会惊讶地发现这个模型推荐得有多好！</p><p id="d48f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在这还不是结束。你可以构建更加复杂的推荐器，考虑其他指标，如电影演员、语言、时长、类型甚至你过去的观看历史。</p><p id="6e6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢阅读这篇文章，如果你需要任何帮助，请随意使用我的<a class="ae jp" href="https://github.com/anshbordia/movie-recommender-bert" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>中的代码。干杯！</p></div></div>    
</body>
</html>