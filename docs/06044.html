<html>
<head>
<title>How to make client android application with Flask server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Flask server制作客户端android应用</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-make-client-android-application-with-flask-for-server-side-8b1d5c55446e?source=collection_archive---------1-----------------------#2020-05-10">https://medium.com/analytics-vidhya/how-to-make-client-android-application-with-flask-for-server-side-8b1d5c55446e?source=collection_archive---------1-----------------------#2020-05-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="0fe7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将了解如何连接android studio和flask server。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/2e1d5e9f83127eec7264c385b840f182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g00Vue0oei7m9XbAHR4NYg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">荣誉属于我</figcaption></figure><p id="d9b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们都知道，与PC相比，移动设备并不强大，我们可以用智能手机做很多事情，但由于资源有限，我们大多数人认为这是一个弱点。</p><p id="05bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，从上一段我们可以得出结论，对于机器学习等很多事情，移动设备并不是最佳选择。当我们说机器学习时，我们还必须提到深度学习，因为这最后一个包括在内，为了记录，深度神经网络需要大量的样本来训练，所以我们另一方面需要大量的资源。</p><p id="0840" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天，我们将学习如何将一个用java编写的简单的android客户端应用程序连接到python flask server，阅读完本文后，您将能够部署您的机器学习模型。您将需要Android studio，HTTP请求和响应在Android中使用<a class="ae jt" href="https://square.github.io/okhttp/" rel="noopener ugc nofollow" target="_blank"> OkHttp </a>和Pycharm IDE进行python编码。</p><p id="90a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本教程将向您展示如何发送一个简单的文本，其中Android应用程序只是制作一个HTTP POST消息来发送它，另一方面，flask应用程序将返回一个简单的消息来确认连接成功。</p><p id="8211" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GitHub上有这个项目的实现:<a class="ae jt" href="https://github.com/dombroks/Android_client-Flask_server/" rel="noopener ugc nofollow" target="_blank">点击这里</a>。</p><p id="b746" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">说够了，让我们开始吧…</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kb"><img src="../Images/a00f100dcd40a2cbfaba59a007d54d73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N4a0py813N5deD1o"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">来自unsplash的Hal Gatewood</figcaption></figure><h1 id="ac6f" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">构建Android应用程序的布局</h1><p id="3f75" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">我们的应用程序设计简单，但这不会妨碍您在未来改进它。所以我决定在主界面上做一个按钮，当你点击这个按钮后，它将测试android应用程序和flask应用程序之间的连接，flask应用程序返回的消息将显示为Toast通知。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="ccfd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以看到我们只使用了一个ID = connect的按钮。</p><p id="9882" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">构建好app用户界面(UI)后，下一步就是实现postRequest <code class="du lh li lj lk b">()</code>方法，负责消息发送。</p><p id="12be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，要做到这一点，我们必须经历一个小过程…</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ll"><img src="../Images/1eb476e0010a334c2d83eacb381c818d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*PBftIsvvZZBZNw-V.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">由<a class="lm ln ge" href="https://medium.com/u/a4963fa09f17?source=post_page-----8b1d5c55446e--------------------------------" rel="noopener" target="_blank">西尔万·索雷尔</a></figcaption></figure><p id="5b03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，在使用OkHttp之前，项目必须支持使用它。您可以通过在build.gradle(应用程序模块)的dependencies部分添加一行来实现这一点，这一行是:</p><pre class="je jf jg jh fd lo lk lp lq aw lr bi"><span id="9dcc" class="ls kd hi lk b fi lt lu l lv lw">implementation 'com.squareup.okhttp3:okhttp:4.5.0'</span></pre><p id="28db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其次，您必须在您的应用程序中激活明文流量的使用，在中，您可以通过在清单文件的应用程序部分插入以下行来实现:</p><pre class="je jf jg jh fd lo lk lp lq aw lr bi"><span id="a0c7" class="ls kd hi lk b fi lt lu l lv lw">android:usesCleartextTraffic="true"</span></pre><p id="7982" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它会是这样的:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lx"><img src="../Images/081fe34cdb796f087985224493e068c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*ep1PqFJFW9nv8ZqUaK1W6w.png"/></div></figure><p id="b336" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是我们不要忘记在清单文件中添加下一个权限:</p><pre class="je jf jg jh fd lo lk lp lq aw lr bi"><span id="8673" class="ls kd hi lk b fi lt lu l lv lw">&lt;uses-permission android:name="android.permission.INTERNET" /&gt;</span></pre><p id="e6a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">没有它，您的应用程序将崩溃。</p><h1 id="10a3" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">编写Android应用程序的java代码</h1><p id="6827" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">现在，我们将转向java代码。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="9590" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你开始阅读代码时，你会注意到我们使用IP@ 10.0.2.2，这只是android模拟器的默认本地地址，5000是我们将与之一起使用的端口号。你会听到一些像mediaType和requestBody这样的词，mediaType只是输入我们要发送的数据，如文本或图像等，requestBody是保存我们消息的对象。这些是代码中的一些方法，你必须理解它们:</p><ol class=""><li id="f63c" class="ly lz hi ih b ii ij im in iq ma iu mb iy mc jc md me mf mg bi translated"><code class="du lh li lj lk b">onFailure()</code>:当请求由于取消、连接问题或超时而无法执行时调用。</li><li id="ad51" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated"><code class="du lh li lj lk b">onResponse()</code>:远程服务器成功返回HTTP响应时调用。</li></ol><p id="9f57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">剩下的代码很容易理解，但是如果你遇到了一些问题，你可以从这里的<a class="ae jt" href="https://square.github.io/okhttp/" rel="noopener ugc nofollow" target="_blank">回到OkHttp文档。</a></p><p id="a0ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以测试应用程序，但它会显示一条错误消息，因为服务器已关闭。当我们提到服务器时，让我们继续使用Flask构建Python HTTP服务器。</p><h1 id="877d" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">使用Flask构建服务器端</h1><p id="e784" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated"><strong class="ih hj"> Flask </strong>是一个用<a class="ae jt" href="https://en.wikipedia.org/wiki/Python_(programming_language)" rel="noopener ugc nofollow" target="_blank"> Python </a>编写的微型<a class="ae jt" href="https://en.wikipedia.org/wiki/Web_framework" rel="noopener ugc nofollow" target="_blank"> web框架</a>。它被归类为<a class="ae jt" href="https://en.wikipedia.org/wiki/Microframework" rel="noopener ugc nofollow" target="_blank">微框架</a>，因为它不需要特殊的工具或库。它没有数据库抽象层、表单验证或任何其他组件，而现有的第三方库提供了通用功能。然而，Flask支持可以添加应用程序特性的扩展，就好像它们是在Flask本身中实现的一样。<a class="ae jt" href="https://en.wikipedia.org/wiki/Flask_(web_framework)" rel="noopener ugc nofollow" target="_blank"> <em class="mm">来自维基百科，免费百科</em> </a> <em class="mm">。</em></p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="b92e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上图中，你可以看到我们创建了一个flask应用程序作为<code class="du lh li lj lk b">Flask()</code>类的实例，<code class="du lh li lj lk b">app.route()</code>装饰函数将一个URL与一个回调函数相关联。<code class="du lh li lj lk b">/</code>表示服务器的主页，因为Android应用程序的请求将被发送到那里。</p><p id="5f33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lh li lj lk b">handle_request()</code>方法负责返回确认客户端和服务器之间连接的消息。</p><p id="456f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lh li lj lk b">run()</code>方法使用<code class="du lh li lj lk b">host</code>参数来指定IP地址。当<code class="du lh li lj lk b">host</code>设置为<code class="du lh li lj lk b">“0.0.0.0”</code>时，这意味着使用当前的IPv4地址。当然还有，<code class="du lh li lj lk b">5000</code>作为端口号。</p><p id="7785" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lh li lj lk b">debug</code>参数用于允许服务器在代码改变时自动重启，否则你必须手动重启以应用新的改变。</p><h1 id="3fca" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">最后一步:测试</h1><p id="e8d9" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">你需要一个互联网连接。</p><p id="9d1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您将能够测试您的应用程序，您必须运行android应用程序和python代码，单击连接按钮，然后您会看到它将返回“成功连接”。</p><h1 id="5e5c" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">摘要</h1><p id="1e74" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">在这篇文章中，您了解了如何使用python flask server构建一个客户端android应用程序。你可以阅读一篇文章来学习如何保存你的机器学习模型以便稍后部署它，你只需点击这里，如果你想联系我，这是我的<a class="ae jt" href="https://www.linkedin.com/in/younes-belouche-641bb3197/" rel="noopener ugc nofollow" target="_blank"> <em class="mm"> LinkedIn </em> </a>帐户，我希望你喜欢，不要忘了打拍手鼓励我:)</p></div></div>    
</body>
</html>