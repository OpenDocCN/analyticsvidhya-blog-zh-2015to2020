<html>
<head>
<title>How to detect tweet sentiment with Amazon Comprehend in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在R中用Amazon understand检测tweet情绪</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-detect-tweet-sentiment-with-amazon-comprehend-in-r-526a3d496e0d?source=collection_archive---------7-----------------------#2019-11-16">https://medium.com/analytics-vidhya/how-to-detect-tweet-sentiment-with-amazon-comprehend-in-r-526a3d496e0d?source=collection_archive---------7-----------------------#2019-11-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="b33c" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">目录</h1><ol class=""><li id="e9fa" class="jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated"><em class="jv">简介</em></li><li id="2d23" class="jd je hi jf b jg jw ji jx jk jy jm jz jo ka jq jr js jt ju bi translated"><em class="jv">抓取twitter并在R中使用亚马逊理解</em></li><li id="dfd2" class="jd je hi jf b jg jw ji jx jk jy jm jz jo ka jq jr js jt ju bi translated"><em class="jv">情绪分析</em></li><li id="63b7" class="jd je hi jf b jg jw ji jx jk jy jm jz jo ka jq jr js jt ju bi translated"><em class="jv">结论</em></li></ol><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kb"><img src="../Images/c48a5f3dc27ed4522b3d9681eb4e32e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gIf7j8i3GZ4F6e6q"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated"><a class="ae kr" href="https://unsplash.com/@lidyanada?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Lidya Nada </a>在<a class="ae kr" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="da67" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">介绍</h1><p id="d695" class="pw-post-body-paragraph ks kt hi jf b jg jh ku kv ji jj kw kx jk ky kz la jm lb lc ld jo le lf lg jq hb bi translated">这篇文章是作为一个大学项目的一部分而写的，因为这是我第一篇关于媒体的文章，所以如果能得到各种反馈，我将不胜荣幸。我还想强调一个事实，你将要阅读的内容是相当技术性的，重点不是分析本身，而是你如何建立一个框架来轻松地进行情绪分析。说了这么多，让我们想出一个可以应用这个框架的用例。</p><p id="f80b" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">假设你是英国一家著名足球俱乐部的老板，你想了解球迷对俱乐部经理的看法。你如何在你自己的<strong class="jf hj">上以一种既省时又划算的方式完成这件事？通过一些基本的编码技巧和一个只有5美元的Amazon Web Services帐户，您可以很好地了解fan对经理表现的满意度趋势。</strong></p><p id="cc67" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">事不宜迟，让我们开始推特情绪分析吧！我这篇文章的代码可以在这里找到:<a class="ae kr" href="https://github.com/geroldcsendes/tweet_sentiment" rel="noopener ugc nofollow" target="_blank"> github </a>。</p><h1 id="d622" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated"><em class="lm">抓取Twitter并在R中使用Amazon understand</em></h1><p id="7992" class="pw-post-body-paragraph ks kt hi jf b jg jh ku kv ji jj kw kx jk ky kz la jm lb lc ld jo le lf lg jq hb bi translated">为了使用Twitter的API来抓取推文，你需要有一个Twitter帐户，并在这里创建一个Twitter应用程序<a class="ae kr" href="https://developer.twitter.com/en/apps" rel="noopener ugc nofollow" target="_blank"/>。我花了大约40分钟设置应用程序，因为有一堆表格要填写，但我最终只在几分钟内收到了我的应用程序的许可。顺便说一下，这篇文章很好地总结了如何做到这一点。</p><p id="b63e" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">一旦您完成了这些，您应该会在您的开发人员仪表板上看到类似的内容(为了安全起见，我只是模糊了我的密钥和令牌:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ln"><img src="../Images/c7c09bd55c1f24e05da2981223b7fa45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yimq7XhD3oY7vGX_Pau29Q.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">Twitter开发者仪表板</figcaption></figure><p id="319a" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">你可以用来使用Twitter的API的R包之一是<strong class="jf hj"> rtweet </strong>。您可以使用您的凭证在rtweet中创建令牌，代码如下:</p><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="lo lp l"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">在rtweet中创建一个令牌:<a class="ae kr" href="https://gist.github.com/geroldcsendes/8de3658fd95a19a9bf726b2d606e1d6f" rel="noopener ugc nofollow" target="_blank">链接</a></figcaption></figure><p id="fc90" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">好了，现在我们可以用r与Twitter交流了。下一步是设置访问Amazon understand。你显然需要一个AWS账户，所以如果你还没有，是时候创建一个了。不会超过10分钟。一旦你有了一个帐户，Amazon的身份和访问管理(IAM)控制台上必须生成一个访问密钥，用于与API的安全通信。在仪表板上，您可能会看到非常相似的内容。创建一个访问键，并将其保存到R项目的位置。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lq"><img src="../Images/310a95779514b843d6da02699a3ebdb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QupROHw_ICdiis9Jga4eBA.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">亚马逊IAM仪表板</figcaption></figure><p id="b293" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">r用领悟的包是<strong class="jf hj"> aws .领悟</strong>。为了能够从R中使用understand，我们需要提供AWS . understand的访问密钥。如果你想更详细地了解它是如何工作的，请查看<a class="ae kr" href="https://github.com/cloudyr/aws.signature/" rel="noopener ugc nofollow" target="_blank">github页面。</a></p><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="lo lp l"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">设置领悟:<a class="ae kr" href="https://gist.github.com/geroldcsendes/ce4a1ef0beb27fde45042a1c667b272c" rel="noopener ugc nofollow" target="_blank">链接</a></figcaption></figure><p id="4025" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">好了，我们已经设置了在足球推特上进行情感分析所需的一切。我们开始工作吧！</p></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><h1 id="3b29" class="if ig hi bd ih ii ly ik il im lz io ip iq ma is it iu mb iw ix iy mc ja jb jc bi translated">情感分析</h1><p id="e1c6" class="pw-post-body-paragraph ks kt hi jf b jg jh ku kv ji jj kw kx jk ky kz la jm lb lc ld jo le lf lg jq hb bi translated">对于我的情感分析，我将只分析英语的推文，尽管在撰写本文时Amazon understand支持5种其他语言。我想在国家层面上进一步限制推文的地理位置，因为我认为球迷对居住在祖国的俱乐部有更大的影响力。原来，尽管Twitter API提供了一些地理数据，但这些数据填充得很差。因此，我决定保留所有的英文微博。</p><p id="6dae" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">你应该注意到Twitter对请求tweets有一些限制。目前，支持的推文历史是7天，所以如果他想分析特定未来事件的推文或当意外发生时快速行动，他应该提前计划。Twitter也限制了你可以提出的请求，但我没有找到任何关于这方面的信息。我所知道的是，我能够在30分钟内发出36000个请求，所以twitter看起来并不太受限制。</p><p id="6066" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">作为我的分析对象，我选择了曼城主教练佩普瓜迪奥拉。曼城1比3输给利物浦，确保利物浦在英超联赛中领先8分。我想知道足球迷们对这次失败的反应。这个游戏是在做这个分析之前5天，所以我是准时的。</p><h2 id="3259" class="md ig hi bd ih me mf mg il mh mi mj ip jk mk ml it jm mm mn ix jo mo mp jb mq bi translated">获取和清理推文</h2><p id="504d" class="pw-post-body-paragraph ks kt hi jf b jg jh ku kv ji jj kw kx jk ky kz la jm lb lc ld jo le lf lg jq hb bi translated">要从Twitter API获取tweet，只需使用rtweet的<em class="jv"> search_tweets() </em>函数。您将看到twitter在一个包含90列的数据框架中提供数据，您还可以获得更多数据。查看rtweets <a class="ae kr" href="https://rtweet.info/index.html" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多可能性。</p><p id="5e68" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">文本栏包含来自用户的推文。推文通常包含URL和表情符号，我认为通过删除它们，我们可以帮助亚马逊理解并更好地猜测推文的情感。顺便说一下，仅仅通过分析表情符号可能比通过文本更容易发现情绪。我没有发现任何信息表明understand是否可以使用表情符号进行情感检测。只对表情符号进行情感分析，并将其结果与理解进行比较，这可能真的很令人兴奋。</p><p id="b543" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">因此，让我们在当前的分析中去掉这些表情符号。我得出的结论是，R的base enc2native函数最适合将带有表情符号的推文转换为UTF编码标准，而不会丢失任何其他信息。我把这个代码片段和最相关的步骤放在一起，但是你可以在我的github上找到完整的代码。</p><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="b478" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">实际上，rtweet有一个名为<em class="jv"> plain_tweets() </em>的函数，它应该应用与我相同的清理技术，但我发现它的性能比我的方法差。</p><p id="afe0" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">我们现在已经完成了数据清理，但是在开始向Amazon发送情感请求之前，最好先做一个成本估算。亚马逊理解是合理定价，但我们不想最终支付超过我们的预算，由于一些错误。为此，我创建了一个估算作业成本的函数。</p><p id="4ee7" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">亚马逊每100个字符收费0.0001美元，每个请求最低收费0.0003美元(这意味着你为100和300个字符的推文支付相同的费用)。我的数据集包含17，997个观察值，整个数据集估计需要5.2美元。</p><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="6182" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">值得一提的是，尽管Amazon intensive似乎不是一个昂贵的解决方案，但它仍然没有为推特情绪检测提供最佳价格。当删除表情符号和网址时，推文包含的字符比300个少得多。为了说明这一点，我为我的数据集添加了一个字符分布图。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mr"><img src="../Images/bb084140022dbb7a0dc751567fd5f403.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e4_NLftvHJA0vaIrZ4a3uA.png"/></div></div></figure><p id="c70b" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">平均推文长度为157个字符，只有0.3%的推文超过300个字符，但大约24%的推文超过250个字符。我们可能会担心这个数量的字符是否足以表达感情。为了让你知道157个字符有多少，我加了一条这么长的推文:</p><p id="c273" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated"><a class="ae kr" href="http://twitter.com/VeskoTrajkovic" rel="noopener ugc nofollow" target="_blank"> "@ </a> &lt;迷离_用户&gt;是一个非常好的经理，毫无疑问，但他总是有最好的团队任他调遣。克洛普让一般的球队变成了优秀的球队。”</p><p id="9987" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">我们不一定需要更长的推文来检测情绪，甚至可能像“布·瓜迪奥拉”或“GTF·瓜迪奥拉”这样的短推文倾向于消极或积极，而长推文则是中性的。无论如何，我不是自然语言处理的专家，只是想给我的分析提供一些背景。</p><blockquote class="ms mt mu"><p id="84f4" class="ks kt jv jf b jg lh ku kv ji li kw kx mv lj kz la mw lk lc ld mx ll lf lg jq hb bi translated">因此，尽管从《理解》杂志上获取更短文本的观点可能在经济上不划算，但它应该还是可行的。</p></blockquote><h2 id="2710" class="md ig hi bd ih me mf mg il mh mi mj ip jk mk ml it jm mm mn ix jo mo mp jb mq bi translated">检测情绪</h2><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="a69c" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">当使用Amazon understand时，我们得到的结果是4种情绪的概率得分，最有可能的情绪将在“情绪”栏中标出。考虑到这一点，我们可以定义一个函数来提取tweet列，将其发送到Amazon，并将返回的数据帧横向合并到“base”中。</p><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="db86" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">就是这样！我们现在有了一个包含推文和他们观点的数据框架。是时候看看人们在输掉大赛后对佩普瓜迪奥拉的看法了。</p><p id="0c10" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">首先，我想看看我的数据集的日期范围。原来，推文落在2019年12月11日和2019年15月11日(写这篇文章的时间)之间。这是相当不幸的，因为我希望在比赛当天(10.11)发推文，因为我期待球迷在最激烈的时候会更加严厉，然后逐渐变得更加理解。在进行分析之后，我才意识到，可以为Twitter API传递一个‘until’参数，该API返回给定日期之前的推文。你可以在这里找到更多关于这个<a class="ae kr" href="https://developer.twitter.com/en/docs/tweets/search/api-reference/get-search-tweets" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="70ac" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">无论如何，正如我已经表达过的，这篇文章的目的只是展示一个框架，并不一定要进行无错误的分析。记住这一点，让我们来看看推特情绪的相对频率。如你所见，57%的人持中立态度，23%的人持积极态度，18%的人持消极态度。带有复杂情绪的推文可以忽略。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mr"><img src="../Images/67deff49526f861b22e216b3bb9f1caf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a2R1P41pwcLjl96dkFrEhw.png"/></div></div></figure><p id="6cdb" class="pw-post-body-paragraph ks kt hi jf b jg lh ku kv ji li kw kx jk lj kz la jm lk lc ld jo ll lf lg jq hb bi translated">如前所述，在比赛结束后，看看推特情绪如何演变可能是有意义的。如果我们看看下面的图表，我们可以看到中性情绪减少的模式，这是由于积极情绪增加，而消极情绪保持不变。所以可能正如我所怀疑的，球迷在输掉一场重要比赛后变得越来越理解，这就是为什么积极的推文相对于消极的有所增加。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mr"><img src="../Images/3902144845ae2e0b80c9a569b0d92fca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*maAkB-xO-vpL6wulmqfVlg.png"/></div></div></figure><h1 id="fb80" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">结论</h1><p id="eaa6" class="pw-post-body-paragraph ks kt hi jf b jg jh ku kv ji jj kw kx jk ky kz la jm lb lc ld jo le lf lg jq hb bi translated">在本文中，我演示了如何在R中使用Amazon的understand来检测tweet情绪。建立这个框架非常容易，你可以通过应用同样的方法来分析人们对特定事件的看法。我认为这是一种省时省钱的快速情绪分析方法。问题是Amazon understand是否能很好地满足我们的需求。在不久的将来，我计划将亚马逊理解情绪预测与表情符号进行比较，看看它们之间的关系，然后最好就此写一篇文章。</p></div></div>    
</body>
</html>