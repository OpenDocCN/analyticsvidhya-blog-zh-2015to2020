<html>
<head>
<title>Kerberos and Hadoop</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kerberos和Hadoop</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/kerberos-and-hadoop-c8bdd7f1c7f3?source=collection_archive---------5-----------------------#2019-12-17">https://medium.com/analytics-vidhya/kerberos-and-hadoop-c8bdd7f1c7f3?source=collection_archive---------5-----------------------#2019-12-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2861f3fe03ca0c9db4f9689f0151dc27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lst-paO3P-lakO0T9hSUFg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">使用Kerberos的Hadoop集群身份验证</figcaption></figure><p id="755a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">每当您在企业集群中的Hadoop环境或数据湖中工作时，您一定会遇到以下错误::<em class="js">org . Apache . Hadoop . security . accesscontrolexception:需要身份验证或org . Apache . Hadoop . IPC . remote exception(javax . security . sasl . saxlexception):GSS启动失败</em></p><p id="1a27" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">该错误可能有多种原因，但其中一个主要原因是您没有有效的Kerberos票证。在本文中，我们将讨论什么是Kerberos，为什么需要它，以及如何在Hadoop集群中使用它。</p><p id="dc15" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">什么是Kerberos？</strong></p><p id="ddf1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Kerberos是麻省理工学院开发的一种网络认证机制/协议。它基于标签系统工作，该系统允许用户/服务/流程与分布式系统或集群中的其他用户/服务/流程进行身份通信。使用有效的Kerberos票证和主体，用户甚至Hadoop服务都可以对自己进行身份验证。票证有一个有限的生命周期，比如说10个小时后它将过期并需要更新。</p><p id="5f41" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">KDC(密钥分发中心)存储和控制主体(用户/服务的身份)和领域(认证管理域)。Principal的典型约定是:user@realm。KDC的主要组成部分有:</p><ul class=""><li id="c0ed" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">Kerberos认证服务—认证用户/服务</li><li id="9cc1" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">票证授予系统—验证和授予票证</li></ul><p id="d5b7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">为什么是Kerberos？</strong></p><p id="f544" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了对用户和服务进行身份验证，Hadoop集群将通过检查用户的身份证明(即本例中的Kerberos票证)来验证该用户是否就是他/她所说的那个人。Kerberos只对用户进行身份验证，而不授权用户使用HDFS/集群服务。</p><p id="042b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">【Kerberos如何？</p><p id="2ac0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在使用HDFS或任何Hadoop服务之前，您应该有一个有效的Kerberos票证。使用<em class="js"> klist </em>命令查看您是否有有效票证:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="31bc" class="kq kr hi km b fi ks kt l ku kv">$ klist<br/>No credentials cache found (ticket cache FILE:/tmp/krb5cc_5000</span><span id="62c0" class="kq kr hi km b fi kw kt l ku kv">$klist<br/> Ticket cache: FILE:/tmp/krb5cc_1234<br/> Default principal: s_user@WORLD.ENTERPRISE</span><span id="bb46" class="kq kr hi km b fi kw kt l ku kv"> Valid starting Expires Service principal<br/> 12/13/19 08:53:39 12/13/19 18:53:39  krbtgt/WORLD.ENTERPRISE@WORLD.ENTERPRISE<br/>  renew until 12/14/19 08:53:39</span></pre><p id="6dee" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">klist显示了您的Kerberos票证的有效性，以及票证缓存和主体的过期时间。</p><p id="c34d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你没有票或者票过期了，你可以使用<em class="js"> kinit </em>命令得到它。Kinit将获取并缓存该主体的票。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="3d8f" class="kq kr hi km b fi ks kt l ku kv">$ kinit username@Principal</span></pre><p id="c0cb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">该命令将询问特定用户名和主体的密码。你可以使用一个二进制加密文件作为你的密码，而不是用户每次手动输入密码或程序更新票证。确保使用正确的措施保护Keytabs，因为它允许用户在不知道密码的情况下获得票证。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="1a90" class="kq kr hi km b fi ks kt l ku kv">$ kinit -kt user.keytab username@Principal</span></pre><p id="b43f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">当您注销系统或切换到其他用户，并希望通过删除凭证缓存来销毁您的活动Kerberos票证时，请使用<em class="js"> kdestoy </em>。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="e731" class="kq kr hi km b fi ks kt l ku kv">$ kdestroy</span></pre><p id="d215" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了获得已安装的Kerberos库的详细信息，可以使用krb5-config命令。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="f664" class="kq kr hi km b fi ks kt l ku kv">$ krb5-config --all<br/> Version: Kerberos 5 release 1.15.1<br/> Vendor: Massachusetts Institute of Technology<br/> Prefix: /usr<br/> Exec_prefix: /usr</span></pre><p id="e2d0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这就是Kerberos如何为分布式系统中的用户和服务提供强大的身份验证框架。Kerberos不提供授权。Hadoop授权一般由基于租户的ACL和用户+用户组模型(类似于Unix文件系统)来维护。为了更加安全，静态数据在HDFS被加密，而动态数据在T2被加密。</p></div></div>    
</body>
</html>