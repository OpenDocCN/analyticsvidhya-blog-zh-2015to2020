<html>
<head>
<title>Building and Managing Apache Kylin Cubes on Docker Like a Pro!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">像专家一样在Docker上构建和管理Apache Kylin多维数据集！</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/building-and-managing-apache-kylin-cubes-on-docker-like-a-pro-22fc236c335e?source=collection_archive---------12-----------------------#2020-08-04">https://medium.com/analytics-vidhya/building-and-managing-apache-kylin-cubes-on-docker-like-a-pro-22fc236c335e?source=collection_archive---------12-----------------------#2020-08-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2527" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">再见！</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/e0c10542de637b1e6b60d58f28d6e7fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z3wxd3bqg2VSAE-y0JpcSA.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">演职员表:<a class="ae ju" href="https://kylin.apache.org/" rel="noopener ugc nofollow" target="_blank">阿帕奇麒麟</a>和<a class="ae ju" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank">码头工人</a></figcaption></figure><p id="e53a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Apache Kylin是一个开源的大数据分析数据仓库，由易贝公司在2015年捐赠给Apache软件基金会。</p><p id="b9bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">多亏了Docker，在服务器上部署Kylin是小菜一碟。如果你熟悉docker，你就会知道它是如何工作的。如果你不是，那么现在是你开始的时候了。</p><p id="f7f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个故事是关于我们如何使用docker在Apache Kylin上构建MOLAP多维数据集，然后管理它。</p><blockquote class="jv"><p id="2fff" class="jw jx hi bd jy jz ka kb kc kd ke jc dx translated">我们开始吧！</p></blockquote><blockquote class="kf kg kh"><p id="25cd" class="if ig jd ih b ii ki ik il im kj io ip kk kl is it km kn iw ix ko kp ja jb jc hb bi translated">但是为什么是docker呢？</p></blockquote><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kq"><img src="../Images/15d28c7d307d5a0c378cff462c1f46d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*3HsHvOpNX1hnrrDqyP2rEQ.jpeg"/></div></figure><p id="817d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Docker是一个软件平台，它简化了分布式应用程序的生命周期，包括构建、部署和管理阶段。这是通过虚拟化安装docker的主机/服务器的操作系统来实现的。</p><p id="45f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设有一个hive服务已经在一个服务器上运行，现在我们想部署一些其他服务，比如Kylin，它将hive服务作为同一服务器上的依赖项。我们尝试安装的版本可能与已经安装的配置单元版本不兼容。在其他系统/虚拟机上设置Kylin所需的依赖关系可能会非常昂贵，因为它需要一组新的硬件资源。</p><p id="5e81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来看看docker是如何提供一个经济高效的解决方案的。</p><p id="d28d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装docker的系统称为主机。主机操作系统的内核在每个应用程序之间共享。每个应用程序都有自己的逻辑/虚拟空间，这些空间继承自主机，但与其他应用程序隔离。这些逻辑空间被称为容器。现在，每个容器都可以拥有自己的一组应用程序所需的库。因此，每个应用程序都可以在同一台主机上满足自己的一组依赖关系或要求，前提是它们具有相同的底层操作系统要求。</p></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><p id="d8a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们使用这个概念从Apache Kylin在其GitHub存储库上给出的模板中为Kylin创建容器:</p><div class="ky kz ez fb la lb"><a href="https://github.com/apache/kylin/tree/master/docker" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab dw"><div class="ld ab le cl cj lf"><h2 class="bd hj fi z dy lg ea eb lh ed ef hh bi translated">阿帕奇/麒麟</h2><div class="li l"><h3 class="bd b fi z dy lg ea eb lh ed ef dx translated">为了让用户方便地试用Kylin，并方便开发人员在修改后进行验证和调试…</h3></div><div class="lj l"><p class="bd b fp z dy lg ea eb lh ed ef dx translated">github.com</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp jo lb"/></div></div></a></div><p id="fd3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用户可以简单地使用被推送到<a class="ae ju" href="https://hub.docker.com/r/apachekylin/apache-kylin-standalone" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj"><em class="jd">docker hub</em></strong></a><em class="jd"/>上的预构建映像，或者通过改变所提供的docker文件的内容来改变配置。</p><p id="ff6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">要简单地提取预构建的映像，运行</em>:</p><pre class="jf jg jh ji fd lq lr ls lt aw lu bi"><span id="76b1" class="lv lw hi lr b fi lx ly l lz ma"><strong class="lr hj">docker pull apachekylin/apache-kylin-standalone</strong></span></pre><p id="3e16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd">或……</em></strong></p><p id="5866" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以根据需要定制docker文件和/或修改<em class="jd"> conf </em>文件夹的内容，然后运行:</p><pre class="jf jg jh ji fd lq lr ls lt aw lu bi"><span id="495e" class="lv lw hi lr b fi lx ly l lz ma"><strong class="lr hj">./build_image.sh</strong></span></pre><h1 id="7bc5" class="mb lw hi bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated"><strong class="ak">在我们产卵容器之前，一个重要的注意事项</strong>:</h1><p id="c6a0" class="pw-post-body-paragraph if ig hi ih b ii my ik il im mz io ip iq na is it iu nb iw ix iy nc ja jb jc hb bi translated">Docker默认不附带持久存储。这意味着当容器停止时，容器上的数据会丢失。我们可能希望在生成另一个容器后继续我们的工作。所以我们想到的下一个问题是…</p><blockquote class="kf kg kh"><p id="efb9" class="if ig jd ih b ii ij ik il im in io ip kk ir is it km iv iw ix ko iz ja jb jc hb bi translated"><strong class="ih hj">我们如何在Kylin容器上持久存储数据？</strong></p></blockquote><p id="7bdf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们首先确定我们想要持久存储的数据。我们正在处理的数据将在Hadoop文件系统上。如果容器突然停止，我们就必须将全部数据重新加载到文件系统中。因此，将容器的HDFS(Hadoop文件系统)与主机绑定是一个好主意。此外，其他要备份的关键组件是Hbase、Zookeeper和Hive。</p><p id="432d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">HDFS、Hbase、Zookeeper将位于集装箱上的<strong class="ih hj">/数据</strong>。我们需要为这个位置创建一个绑定。</p><p id="49b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用“<strong class="ih hj"><em class="jd">/home/$ USER/docker _ volumes/kylin _ bind/</em></strong><em class="jd">”</em>作为我们的主机挂载位置。</p><pre class="jf jg jh ji fd lq lr ls lt aw lu bi"><span id="287f" class="lv lw hi lr b fi lx ly l lz ma"><strong class="lr hj">mkdir -p /<em class="jd">home/$USER/docker_volumes/kylin_bind/</em></strong></span></pre><p id="bb20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">装订是通过使用docker卷完成的。我们可以按如下方式创建一个卷:</p><pre class="jf jg jh ji fd lq lr ls lt aw lu bi"><span id="f9d4" class="lv lw hi lr b fi lx ly l lz ma"><strong class="lr hj">docker volume create --driver local \<br/>--opt type=none \<br/>--opt device=/home/$USER/docker_volumes/kylin_bind/ \<br/>--opt o=bind \<br/>kylin_data_volume</strong></span></pre><p id="8908" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在可以为Kylin生成第一个容器。</p><pre class="jf jg jh ji fd lq lr ls lt aw lu bi"><span id="7333" class="lv lw hi lr b fi lx ly l lz ma"><strong class="lr hj">docker run -d \<br/>-m 8G \<br/>-v kylin_data_volume:/data \<br/>-p 7070:7070 \<br/>-p 8088:8088 \<br/>-p 50070:50070 \<br/>-p 8032:8032 \<br/>-p 8042:8042 \<br/>-p 16010:16010 \<br/>apache-kylin-standalone</strong></span></pre><p id="8fe8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">瞧啊。我们已经产生了我们的容器。给它一两分钟的时间来启动所有它被编程启动的服务。</p><p id="f483" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经在分离模式下启动了容器(docker运行命令中的<strong class="ih hj"> -d </strong>)。运行以下命令，列出生成的容器，并记下容器id。</p><pre class="jf jg jh ji fd lq lr ls lt aw lu bi"><span id="390b" class="lv lw hi lr b fi lx ly l lz ma"><strong class="lr hj">docker ps</strong></span></pre><p id="916f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要将我们自己附加到容器的终端，运行:</p><pre class="jf jg jh ji fd lq lr ls lt aw lu bi"><span id="dd96" class="lv lw hi lr b fi lx ly l lz ma">docker exec -it <strong class="lr hj"><em class="jd">container_id</em></strong> bash</span></pre><p id="2fd3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将进入集装箱。请注意终端中的提示变化。</p><p id="a4dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行以下命令验证是否所有服务都已启动。</p><pre class="jf jg jh ji fd lq lr ls lt aw lu bi"><span id="7315" class="lv lw hi lr b fi lx ly l lz ma"><strong class="lr hj">jps</strong></span></pre><p id="1b24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从主机上，我们可以分别访问<strong class="ih hj"> localhost:8088 </strong>和<strong class="ih hj"> localhost:7070、</strong>MapRed应用页面和Kylin Home UI。</p><p id="6004" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">剩下的工作就是将数据加载到HDFS上，并将其作为源添加到Kylin中，创建一个模型，为该模型设计一个立方体，然后最终构建它。</p><p id="3e49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查站！我们故事的第一部分到此结束。下半场见！:)</p><h1 id="27ac" class="mb lw hi bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">构建立方体！</h1><p id="af7e" class="pw-post-body-paragraph if ig hi ih b ii my ik il im mz io ip iq na is it iu nb iw ix iy nc ja jb jc hb bi translated">既然Kylin已经在docker容器上设置好了，我们就可以开始构建立方体了。首先，我们需要有蜂箱表。一旦我们有了这些，我们就可以从“<strong class="ih hj">数据源</strong>”选项卡中选择这些表。选择的表必须与目标图表/KPI一致。我们需要为目标结果准备一个模型。这可以是“<strong class="ih hj">星形</strong>或“<strong class="ih hj">雪花形</strong>”模型。必须仔细选择尺寸和度量。</p><p id="30a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在将使用创建的模型来构建一个立方体。我们需要从可用列表中选择维度。选择每一个作为"<strong class="ih hj">正常的</strong>或"<strong class="ih hj">派生的</strong>尺寸。选择度量之后，我们可以选择立方体构建引擎。可以是<strong class="ih hj"> Hadoop </strong> base，也可以是<strong class="ih hj"> Spark </strong> base。给出了添加附加属性的选项。一旦我们完成了这个，我们就可以很好地构建设计好的立方体。如果事实表是基于日期字段进行分区的，那么我们需要选择构建的时间间隔。</p><p id="d3f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以在“<strong class="ih hj"> Monitor </strong>”选项卡上检查构建进度。一旦构建完成，我们就可以使用这个立方体进行快速查询。构建的立方体存储为<strong class="ih hj"> Hbase </strong>段。我们现在可以将这个Kylin实例作为数据源添加到任何BI工具/可视化工具中，以创建图表/KPI。</p></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><blockquote class="kf kg kh"><p id="40c3" class="if ig jd ih b ii ij ik il im in io ip kk ir is it km iv iw ix ko iz ja jb jc hb bi translated">到目前为止，我们已经能够生成一个Kylin容器，并且希望您已经对您构建的立方体片段进行了一些分析。我们的下一个挑战来了，<strong class="ih hj">迁移</strong>。</p><p id="75e7" class="if ig jd ih b ii ij ik il im in io ip kk ir is it km iv iw ix ko iz ja jb jc hb bi translated"><strong class="ih hj">我们为什么以及如何迁移到其他主机？</strong></p></blockquote><p id="928d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将Kylin迁移到另一个主机可能有许多原因。现有服务器/虚拟机上的资源可能不足。我们不想在新机器上重复设置立方体的工作。</p><p id="4273" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要迁移到新主机，映像模板必须相同。我们需要像前面一样在<strong class="ih hj">新主机</strong>上运行以下命令。</p><pre class="jf jg jh ji fd lq lr ls lt aw lu bi"><span id="469c" class="lv lw hi lr b fi lx ly l lz ma"><strong class="lr hj">./build_image.sh</strong></span></pre><p id="81e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们有一个配置单元表作为我们的多维数据集的数据源，我们希望备份它。在<strong class="ih hj">旧容器</strong>的运行主机中，运行并输入密码:</p><pre class="jf jg jh ji fd lq lr ls lt aw lu bi"><span id="dd57" class="lv lw hi lr b fi lx ly l lz ma"><strong class="lr hj">mysqldump -u <em class="jd">username</em> --password --databases hive &gt; hive_dump.sql</strong></span></pre><p id="ffec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要将这个文件从当前运行的容器复制到新的主机上。使用rsync或scp命令。</p><p id="3657" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在复制之前停止正在运行的服务通常是一个好主意，因为这可以确保进程/文件上没有锁。在<strong class="ih hj">旧容器上运行以下命令:</strong></p><pre class="jf jg jh ji fd lq lr ls lt aw lu bi"><span id="0610" class="lv lw hi lr b fi lx ly l lz ma"><strong class="lr hj"><em class="jd">stop-hbase.sh<br/>$HADOOP_HOME/sbin/stop-hdfs.sh<br/>$HADOOP_HOME/sbin/stop-yarn.sh<br/>service mysqld service stop<br/>## And any other service that you might want to stop. :)</em></strong></span></pre><p id="ba54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如前所述，在新主机上创建一个卷。</p><pre class="jf jg jh ji fd lq lr ls lt aw lu bi"><span id="e561" class="lv lw hi lr b fi lx ly l lz ma"><strong class="lr hj">docker volume create --driver local \<br/>--opt type=none \<br/>--opt device=/home/$USER/docker_volumes/kylin_bind/ \<br/>--opt o=bind \<br/>kylin_data_volume</strong></span></pre><p id="0895" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在卷已经准备好了，我们可以在新主机上运行新容器了。</p><pre class="jf jg jh ji fd lq lr ls lt aw lu bi"><span id="608a" class="lv lw hi lr b fi lx ly l lz ma"><strong class="lr hj">docker run -d \<br/>-m 8G \<br/>-v kylin_data_volume:/data \<br/>-p 7070:7070 \<br/>-p 8088:8088 \<br/>-p 50070:50070 \<br/>-p 8032:8032 \<br/>-p 8042:8042 \<br/>-p 16010:16010 \<br/>apache-kylin-standalone</strong></span></pre><p id="e488" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要恢复蜂巢的桌子。为此，请运行:</p><pre class="jf jg jh ji fd lq lr ls lt aw lu bi"><span id="5f3d" class="lv lw hi lr b fi lx ly l lz ma"><strong class="lr hj">mysql -u <em class="jd">username </em>-p</strong></span></pre><p id="d06d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在mysql shell中，为配置单元创建一个数据库。</p><pre class="jf jg jh ji fd lq lr ls lt aw lu bi"><span id="a460" class="lv lw hi lr b fi lx ly l lz ma"><strong class="lr hj">create database if not exists hive;</strong></span></pre><p id="be82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在从mysql shell中出来，我们将把<strong class="ih hj"><em class="jd">hive _ dump . SQL</em></strong>加载到这个数据库中。</p><pre class="jf jg jh ji fd lq lr ls lt aw lu bi"><span id="021a" class="lv lw hi lr b fi lx ly l lz ma"><strong class="lr hj">mysql -u root -p hive &lt; hive_dump.sql</strong></span></pre><p id="a9df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">访问本地主机:8088和本地主机:7070进行验证。</p><p id="dd38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样！我们已经将我们的容器迁移到新机器上。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es nd"><img src="../Images/012aedc3e330fbcb53c034312b61b999.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*oLdGbY0qbjO_7hWSRRNa5g.png"/></div></figure></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><p id="1d78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在已经到了故事的结尾。我们现在能够像专业人士一样在docker上构建和管理立方体。</p><p id="a77f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您的阅读！随意评论。:)</p><p id="2ecc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">再见！</p></div></div>    
</body>
</html>