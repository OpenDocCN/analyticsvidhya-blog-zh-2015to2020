<html>
<head>
<title>Walkthrough of data wrangling project with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python的数据争论项目演练</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/data-wrangling-project-with-python-eee40b460fed?source=collection_archive---------4-----------------------#2020-12-27">https://medium.com/analytics-vidhya/data-wrangling-project-with-python-eee40b460fed?source=collection_archive---------4-----------------------#2020-12-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2cac12d0c0ab364896b53b3122f1c849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K_l9eVeIuegp0M1ptvDY8A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">在<a class="ae iu" href="https://unsplash.com/s/photos/data-wrangling?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae iu" href="https://unsplash.com/@_imkiran?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Sai Kiran Anagani </a>拍摄的照片</figcaption></figure><p id="a285" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">项目目标:</strong></p><ol class=""><li id="b21d" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">将JSON文件转换成数据帧，以便于浏览和分析。</li><li id="e6f0" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">自动化数据争论步骤，以便它们可以应用于多个数据集。</li><li id="8fbc" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">开发查询方法，以帮助生成团队或球员的汇总数据。</li><li id="733f" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">采用面向对象编程来帮助管理代码。</li></ol><p id="80f9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我在这个项目中使用了python。这些代码可以在下面的GitHub库中找到。</p><p id="0d33" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://github.com/MuhammadMarufSazed/Data_wrangling_soccer_with_Python" rel="noopener ugc nofollow" target="_blank">https://github . com/muhammadmarfsazed/Data _ wrangling _ soccer _ with _ Python</a></p><p id="723d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">数据集概述:</strong>足球比赛时空数据集(<a class="ae iu" href="https://springernature.figshare.com/articles/dataset/Metadata_record_for_A_public_data_set_of_spatio-temporal_match_events_in_soccer_competitions/9711164" rel="noopener ugc nofollow" target="_blank">https://springer nature . fig share . com/articles/dataset/Metadata _ record _ for _ A _ public _ data _ set _ of _ spatial-temporal _ match _ events _ in _ soccer _ competitions/9711164</a>)是一个数据集，其中包含了几个代表欧洲足球比赛的JSON文件。数据集包括与不同事件、犯规、进球、传球、助攻等相关的信息。在这些比赛的足球比赛中。为了演示数据争论的步骤，我使用了包含西班牙联赛事件数据的数据集(文件名events_Spain.json)。</p><p id="8dd5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感兴趣的读者也可以通过这篇论文(下面的链接)来了解方法和分析。我要感谢作者卢卡·帕帕拉多、保罗·钦蒂亚、阿莱西奥·罗西、伊曼纽·马苏科、保罗·费拉吉纳、迪诺·佩德雷斯基、福斯卡·吉安诺蒂的精彩论文和公开提供的数据集。</p><p id="fc6f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">论文:<a class="ae iu" href="https://www.nature.com/articles/s41597-019-0247-7" rel="noopener ugc nofollow" target="_blank">https://www.nature.com/articles/s41597-019-0247-7</a></p><p id="66df" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">给定datatset的结构:</strong>JSON文件在python中存储为列表。该列表包含代表单个事件的628659个词典。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="b61f" class="kq kr hi km b fi ks kt l ku kv">with open("events/events_Spain.json") as f:<br/>    data_spain = json.load(f)</span></pre><figure class="kh ki kj kk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kw"><img src="../Images/96c073c6cd74dbb6e1f6b6107e43f4bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jFESfnpJ8aySquLCZkSySQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">一个长度为628659的python列表，表示在联盟的所有比赛中发生的事件(每个事件都是字典格式的)。</figcaption></figure><figure class="kh ki kj kk fd ij er es paragraph-image"><div class="er es kx"><img src="../Images/3adbf52a9f50e9caaa980fc31752f657.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*VSNt22JRZ_3uhJnHj5ZNuQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">字典表示单一事件，即决斗，子事件名称将其标识为对地攻击决斗。标签id表明这是一次对左的攻击(id: 503)，决斗获胜(id: 703)，并且是准确的(id: 1801)。</figcaption></figure><figure class="kh ki kj kk fd ij er es paragraph-image"><div class="er es ky"><img src="../Images/d2f209d12ff5f00481a345f50e465a77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*dbvBea_OvohrkzxeNJePOQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">python字典格式的事件示例。字典表示单个事件，这是一个传递，子事件名称将其标识为一个交叉。标签id表明它是左脚的(id: 401)，高交叉的(id: 801)，并且是准确的(id: 1801)。</figcaption></figure><p id="504e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">每个事件字典都包含几个关于事件的信息。事件名称标识了事件的性质:是通过还是犯规还是其他。通过指定过程的性质，subEventName的范围进一步缩小。在这个例子中，它是一个十字。标签代表关于事件的评论。在这种情况下，标签意味着这是一个左脚准确的高传。对于其他事件，例如犯规，我们有一组完全不同的标签(不一定长度为3)，这些标签的id值不同。</p><p id="3f91" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">数据争论——第一步:</strong>因为这些字典都有相同的一组键:eventId、subEventName、tags等。，我们将把这多个字典组合成一个字典。</p><figure class="kh ki kj kk fd ij er es paragraph-image"><div class="er es kz"><img src="../Images/daffb45895f2a8110407309e9d0f72e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*-UlKrwxphgInvzkN3j684w.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">第一步:我们想把所有的字典合并成一个字典。结果字典的每个键都有一个长度为628659的列表，这是data_spain列表中事件号的长度。</figcaption></figure><p id="ff69" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将这些字典合并成一个字典的目的是为了方便我们将其转换成熊猫数据框架。在这个阶段，除了对应于标签的列表之外，所有其他列表都包含每个事件的一个元素。</p><p id="6b41" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">数据争论——第二步:</strong>我们将字典转换成熊猫数据框架。然而，产生的数据格式不允许我们那么容易地利用tags列中的信息。所以，我们进行第三步。</p><figure class="kh ki kj kk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es la"><img src="../Images/fe55990f730f05240b40128ee14aef2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*os3IX8Vb6BHsGA-4hszhVA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">第二步:将组合词典转换成熊猫数据帧。正如我们所看到的，tags列中的元素有多个字典，表示与特定事件相关联的标记。而且这些字典的篇幅和值都不一样。数据帧的形状:(628659，12)</figcaption></figure><p id="a9d3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">数据争论——第三步:</strong>然后为每个标签名称添加列，以确保我们能够使用标签中可用的有用信息。为了实现这些步骤，我开发了一个事件类(python类),以便于管理代码并将其用于其他比赛的数据集。</p><figure class="kh ki kj kk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/f315f690777af6be6cb34c0ab91998da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1LHhXCoVN75t2TNS70DsFw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">第三步:组合不同事件中所有可能的标记名，并将其转换成列。这些列的值为0或1，其中1表示标签与事件相关联，0表示不相关联。因此，如果对于一个特定的事件，“传球”，目标列的值为1，这将意味着射门导致进球。这个数据帧与我们从上一步得到的数据帧结合在一起。数据框架的形状:(628659，72)</figcaption></figure><p id="93e2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个阶段，我们有一个形状的数据框架(628659，72)。现在我们有了一个数据框架，可以用一种更简单的方式提取数据。</p><p id="255c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">使用查询方法探索数据框架:</strong>我假设在这一点上，很多好奇心将围绕所有比赛的球队级别或球员级别的数据。为此，我们必须对多个列进行大量的过滤和聚合(求和/计数)。也可能是在对某一组事件进行过滤后，我们可能有兴趣检查团队或球员在其他事件或子事件中的表现。为了使整个过程更容易，我在events类中开发了一些“查询”方法，可以用来方便快捷地获得这些结果。我们可以沿着不同的标签集搜索不同的事件和子事件。所有这些查询将产生对应于特定查询的数据帧。然后，我们可以将这些不同的数据帧组合成一个大的数据帧，其中包含我们在团队级别或球员级别感兴趣的信息。然而，如果我们不想处理汇总数据，比如说我们想分析与莱昂内尔·梅西相关的事件序列，我们当然可以通过使用第三步后获得的数据框架来完成。</p><p id="14c9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">结论:</strong>每个数据集都包含丰富的信息集，可用于机器学习、聚类分析、数据探索和可视化以及统计建模。数据争论是处理这类数据集的重要一步。查询方法允许用户根据需要查询不同的信息。采用面向对象的编程方法有助于更好地管理代码。</p></div><div class="ab cl lc ld gp le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hb hc hd he hf"><p id="1223" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">附录:</strong></p><p id="f75a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">查询方法演示:</strong></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="9d82" class="kq kr hi km b fi ks kt l ku kv">spain_object = event(data_spain, )</span></pre><blockquote class="lj lk ll"><p id="14d2" class="iv iw lm ix b iy iz ja jb jc jd je jf ln jh ji jj lo jl jm jn lp jp jq jr js hb bi translated">#将给定的字典列表转换为数据帧</p><p id="0e5e" class="iv iw lm ix b iy iz ja jb jc jd je jf ln jh ji jj lo jl jm jn lp jp jq jr js hb bi translated">spain_object = events(data_spain，'西班牙'，tags_name，events _ label)<br/>Spain _ object . process(teams _ df，players_df)</p></blockquote><p id="77fc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">问题:</strong>不同球队射门得分多少？</p><blockquote class="lj lk ll"><p id="06dd" class="iv iw lm ix b iy iz ja jb jc jd je jf ln jh ji jj lo jl jm jn lp jp jq jr js hb bi translated">#查询</p><p id="bac8" class="iv iw lm ix b iy iz ja jb jc jd je jf ln jh ji jj lo jl jm jn lp jp jq jr js hb bi translated">by = ' team '<br/>tags =[' Goal ']；events =[' Shot ']<br/>Spain _ object . query _ event sub _ tag(tags，events = events，subevents = None，by = by，output = True，combine = False)</p></blockquote><p id="68c9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">问题:</strong>不同球队分别从传球和任意球产生了多少次助攻？</p><blockquote class="lj lk ll"><p id="3ad2" class="iv iw lm ix b iy iz ja jb jc jd je jf ln jh ji jj lo jl jm jn lp jp jq jr js hb bi translated">#查询</p><p id="55ec" class="iv iw lm ix b iy iz ja jb jc jd je jf ln jh ji jj lo jl jm jn lp jp jq jr js hb bi translated">by = 'team' <br/> tags = ['assist '，]；events = ['Pass '，'任意球']<br/>Spain _ object . query _ event sub _ tag(tags，events = events，subevents = None，by = by，output = True，<strong class="ix hj"> combine = False </strong>)</p></blockquote><p id="e5ec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">#设置combine = False将为不同的事件产生不同的数据帧。</p><figure class="kh ki kj kk fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/50936090ecfb9574fa1e628fe44cec95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*rC1hKkVGkO1KukXwBR-W8A.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">整个赛季不同球队的传球和任意球助攻数的总和</figcaption></figure><p id="7cd8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">问题:</strong>不同球队的传球和任意球总共助攻了多少次？</p><blockquote class="lj lk ll"><p id="da29" class="iv iw lm ix b iy iz ja jb jc jd je jf ln jh ji jj lo jl jm jn lp jp jq jr js hb bi translated">#查询</p><p id="975d" class="iv iw lm ix b iy iz ja jb jc jd je jf ln jh ji jj lo jl jm jn lp jp jq jr js hb bi translated">by = 'team' <br/> tags = ['assist '，]；events = ['Pass '，'任意球']<br/>Spain _ object . query _ event sub _ tag(tags，events = events，subevents = None，by = by，output = True，<strong class="ix hj"> combine = True </strong>)</p><p id="4aa8" class="iv iw lm ix b iy iz ja jb jc jd je jf ln jh ji jj lo jl jm jn lp jp jq jr js hb bi translated">#设置combine = true将产生一个数据帧，该数据帧添加了传球和任意球的各个数据帧。</p></blockquote><figure class="kh ki kj kk fd ij er es paragraph-image"><div class="er es lr"><img src="../Images/1d4d87704acc8e5018905755c78924bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:478/format:webp/1*OcGRW6sSdU0C4R6ZQ-g4ew.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">整个赛季不同球队传球和任意球的总助攻数</figcaption></figure><p id="9429" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">任务:</strong>生成单个数据帧，其中包含不同事件、子事件和标签的团队聚合信息。</p><blockquote class="lj lk ll"><p id="4dde" class="iv iw lm ix b iy iz ja jb jc jd je jf ln jh ji jj lo jl jm jn lp jp jq jr js hb bi translated">#多重查询<br/> by = 'team' <br/> tags = ['Goal '，' assist '，' keyPass '，' opportunity '，' counter _ attack ']；events = ['Pass '，' Shot '，' Free Kick ']<br/>Spain _ object . query _ events sub _ tag(tags，events = events，subevents = None，by = by，output = False，combine = True)# 1st query<br/>tags =[' lost '，' won '，' sliding _ tangle ']；events =[' Duel ']<br/>Spain _ object . query _ event sub _ tag(tags，events = events，subevents = None，by = by，output = False，combine = False)<br/>tags =[' accurate ']；subevents =[' Corner ']<br/>Spain _ object . query _ event sub _ tag(tags，events = None，subevents = subevents，by = by，output = False，combine = False) #第二次查询<br/>Spain _ object . query _ eventsub([' Air duel '，' Cross '，' Free Kick']，output = False，level = 'subevent') #第三次查询</p><p id="5ef8" class="iv iw lm ix b iy iz ja jb jc jd je jf ln jh ji jj lo jl jm jn lp jp jq jr js hb bi translated">#从上一步生成的列表中创建一个组合数据帧<br/>Spain _ team _ data = Spain _ object . concat _ df()</p></blockquote><figure class="kh ki kj kk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/d8d863b8bb790b1bcfcfe62276689b5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TprHJ8ot5uy3cCUNFE-gwA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">组合来自不同查询的数据帧。</figcaption></figure></div></div>    
</body>
</html>