<html>
<head>
<title>Predicting Airbnb Prices in Los Angeles</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测洛杉矶 Airbnb 的价格</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/predicting-airbnb-prices-in-los-angeles-14758afc47e?source=collection_archive---------11-----------------------#2020-12-30">https://medium.com/analytics-vidhya/predicting-airbnb-prices-in-los-angeles-14758afc47e?source=collection_archive---------11-----------------------#2020-12-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="2a2d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">端到端的机器学习项目，以及我遇到的一些问题的解释和解决方案。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/1fb170f57c1d257d2d7e2ce3493cb780.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cLPjuy9c1yut0OUhB6CotA.png"/></div></div></figure><h1 id="4601" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">关于项目</h1><p id="1f8b" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">在这个项目中，我将指导你在洛杉矶 Airbnb 的数据集上处理一个端到端的机器学习问题。数据集是从 Airbnb 内部获取的(<a class="ae kr" href="http://insideairbnb.com/get-the-data.html" rel="noopener ugc nofollow" target="_blank">链接</a>)。</p><p id="7f71" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">价格将是我的目标向量</strong>，因为我将预测 Airbnb 在洛杉矶的夜间价格，考虑几个独立变量，如邻居、卧室数量、保证金等。</p><p id="d8e4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是一个<strong class="ig hi">监督学习回归</strong>问题，因为我们有一个标签，它是连续的。</p><p id="12c8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">考虑到数据集中离群值的数量，我将使用<strong class="ig hi">平均绝对误差作为评估指标</strong>。与均方误差不同，平均绝对误差度量对异常值不敏感。</p><h1 id="6ac5" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">项目的布局</h1><p id="7d8e" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">该项目按以下步骤进行:</p><ol class=""><li id="c317" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">探索性数据分析</li><li id="6b93" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">准备数据</li><li id="4281" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">分割数据集</li><li id="97a3" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">基线模型</li><li id="5f00" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">转换管道</li><li id="e38e" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">入围的有前途的模型</li><li id="ee74" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">微调潜在模型</li><li id="4a63" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">排列重要性</li><li id="7cc4" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">使用图来解释最终模型的预测</li></ol><h1 id="4330" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">探索性数据分析</h1><p id="8a50" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">使用 pandas 加载数据集后，最好花些时间浏览数据集，寻找缺失值，并研究每个属性及其特征。数据集的形状为(35757，106)。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es lg"><img src="../Images/4f461beeaca27b9eeb484f04422ac037.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/0*woRQ4QME8_Qk4i4a"/></div></figure><p id="4ea6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在研究这些数据时，我发现了一组独特的独立变量，有些变量的空值比例很高。然后，我能够删除许多似乎没有增加任何价值的变量。</p><p id="f011" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有相当多的变量需要进一步研究，以便更好地理解它们的目的。在这个过程中，我删除了另一组属性，这些属性或者是它们之间高度相关的，或者是基数很高的。我最终保留了一些高基数变量，如描述、便利设施、属性类型和邻域，这些变量似乎包含有用的信息，我可以在特性工程期间提取这些信息。</p><p id="fde2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我当时很好奇，想看看直方图和散点图，因为它们非常有助于获得洞察力。因为我有一个很长的变量列表要查看，所以我把它们分成了两个散点图。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/0f485cd0a1ba5d980ccfa15f9df10f1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3_lJDi-VCQfz1wEqwmvZOQ.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated"><em class="ll">价格、浴室、卧室、床、住宿、客人包括在内</em></figcaption></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/46eae5a8b9be4fe4807d9da28ef90943.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qvlsmCx8ovaVAyUgyn9vUA.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated"><em class="ll">价格、经度、纬度、保证金、清洁费、额外人员</em></figcaption></figure><h2 id="fd19" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">观察结果:</h2><ol class=""><li id="435b" class="ks kt hh ig b ih km il kn ip ma it mb ix mc jb kx ky kz la bi translated">数据集有很多异常值</li><li id="2200" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">我们的目标变量是高度倾斜的</li><li id="b392" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">经度和纬度是唯一没有偏斜的变量</li><li id="040a" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">浴室、卧室、住宿、包括的客人、保证金、清洁费与我们的目标向量价格高度相关；离群值很难看出。</li></ol><h2 id="0d40" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">准备数据</h2><p id="fe8d" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">我将数据准备分为以下几个步骤:</p><ol class=""><li id="7b3d" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">修复高基数特性</li><li id="2180" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">修复或移除异常值</li><li id="41a0" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">特征选择</li><li id="6cb2" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">特征工程</li></ol><h2 id="b46e" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">修复高基数特性</h2><p id="dbd1" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">为了修复对我们的模型来说太有价值而不能删除的高基数属性，我将所有权重不高的值放在“Other”下，这大大减少了唯一值的数量。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es md"><img src="../Images/885397d54d699537cba0c2c6a4207b12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gbpw2dg8IVlWCla-Kwbj6w.png"/></div></div></figure><h2 id="7a4b" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">修复或移除异常值</h2><p id="8be2" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">很难相信有人会花 25000 美元在 Airbnb 上租一晚。这些异常值可能是由许多可能的原因造成的。我只考虑了每晚不到 1000 美元的酒店。下图显示了过滤异常值前后的箱线图之间的比较。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es me"><img src="../Images/cbd7463d03041a95e7b0c0fffe69a0dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IMQ1mzxnbZyCKqXL85ha7A.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es me"><img src="../Images/f4b10a169a3db3d5fd90f3278e49bb72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_6YQIIxuYbf3bgUWxzl1eQ.png"/></div></div></figure><p id="09f6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这使得价格的偏斜度从 13.4 下降到 2.87。还是挺高的！当我们训练模型时，可以使用日志来处理它。如果您采用目标变量的对数来拟合模型，请始终记住在预测之前使用指数来反转对数。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/96a6ac293acb2c0fddde693ced444a92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ookBu_41wVpMg4WBjnr9TQ.png"/></div></div></figure><h2 id="b5d2" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">特征选择</h2><p id="356d" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">查看代表相关矩阵的热图，我删除了高度相关的列。彼此高度相关的列是重复的，不会给模型预测增加额外的值。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/9b0f671efa63d1e72a16ad3046ae02ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L5myuiKUyY2uoXO2vyMYeg.png"/></div></div></figure><h1 id="26db" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">特征工程</h1><p id="5445" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">邮政编码是一个名义分类特征，它可以是计数/=或频率编码。经过一些清理后，我使用 map 函数计算编码后的邮政编码。</p><p id="9d6c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">计数编码是基于用它们的计数替换类别。这种方法对异常值很敏感，但是因为我们使用的是邮政编码，所以不会影响我们。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mf"><img src="../Images/b0fe9e24eb568598ed60a34f9e73d2d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Odj3eb2lACtznnn9"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mg"><img src="../Images/3d506b5919fd2777b824b5e48d7141ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TqzQ6c85Ww7SonP8"/></div></div></figure><p id="fbc2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">便利设施有很多信息，如果我们能够从文本列中提取信息，这些信息可以帮助我们预测我们的目标变量。自然语言处理(NLP)似乎是唯一的答案。我能够使用 NLP 从便利设施中提取有价值的信息，这有助于显著减少评估错误。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/058559b35f3861928deaa7671d382b18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Sv74anqeF46UoCc3"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mh"><img src="../Images/e7a88b5f8b989b1e6206ac10eb302318.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R57ZI8JOt_K-Y1yA"/></div></div></figure><p id="2d3e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">它生成了一个稀疏矩阵形式的文档术语矩阵，然后我将它转换成一个 NumPy 数组，以便能够生成一个数据框。然后，我能够将这个新数据框与我们的原始数据框合并。</p><h1 id="5dfd" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">分割数据集</h1><p id="9dd4" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">前面看了相关矩阵，我们知道在预测洛杉矶 Airbnb 的夜间价格时，卧室的数量高度相关。我们希望分割数据，以确保测试集能够代表整个数据集中多个卧室的不同类别。</p><p id="0648" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该物业的大多数卧室数量在 1-3 间之间，但有些物业的卧室数量远远超过 3 间。在数据集中拥有来自每个地层的足够数量的实例非常重要，否则对地层重要性的估计可能会有偏差。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/e725ec9a92122441fe97b7e3a35b2f36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iAdt3twHZhAZTswY"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/9ffb056a74ce2a5f913a11202d7c7227.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N4XTyZZTQ1VjcrK4"/></div></div></figure><p id="c505" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我创建了一个新的列，我把它分成了多个箱，确保它没有太多的层，并且每个层都足够大。有了新列之后，我们就可以使用 Scikit-Learn 中的 StratifiedShuffleSplit 类进行分层采样了。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mi"><img src="../Images/041266f08242d7b5763b086d6834a303.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ehV1Fn7aG8la1413"/></div></div></figure><p id="2f6d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我没有将训练测试进一步分成训练和验证集。相反，我使用了 scikit-learn 的 cross_val_score 来查看模型如何适合训练集。</p><h1 id="2280" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">基线模型</h1><p id="3385" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">使用平均绝对误差，我们模型的基线是 93.50。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mj"><img src="../Images/f5ffa930d0086af2ed51062f26cbaa31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mP4KzarVfAqU6w6h"/></div></div></figure><h1 id="7c23" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">转换管道</h1><p id="6159" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">我在管道中使用的变压器列表:</p><ol class=""><li id="385a" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated"><code class="du mk ml mm mn b">Simple Imputer</code>以<code class="du mk ml mm mn b">median</code>为战略<code class="du mk ml mm mn b">numerical attributes</code></li><li id="6603" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><code class="du mk ml mm mn b">Simple Imputer</code>以<code class="du mk ml mm mn b">most_frequent</code>为<code class="du mk ml mm mn b">categorical attributes</code>的策略</li><li id="6a23" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">分类编码器库中的顺序编码器</li><li id="84ba" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">标准定标器作为线性模型和支持向量机更好地处理定标数据</li></ol><p id="4a2d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我制作了两条独立的管道；一个用于数字属性，另一个用于分类属性。我使用 scikit-learn 中的 ColumnTransformer 类将它们放在一起。</p><p id="a6e2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我只使用了一个顺序编码器来编码我们所有的分类属性，因为我最终选择了一个集合树模型作为我的最终选择。一个热门的编码器和我们的树模型不一定能很好地配合。如果你想深入了解这个问题，我推荐你阅读这篇文章(<a class="ae kr" href="https://towardsdatascience.com/one-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769" rel="noopener" target="_blank">链接</a>)。</p><p id="4171" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我在分类管道中传递简单输入时遇到了一个问题，因为它会将一个 NumPy 数组作为输入传递给一个顺序编码器；这让顺序编码器很不高兴。然后，我必须制作一个自定义的转换器来估算分类空值，并将数据帧传递给顺序编码器。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mo"><img src="../Images/26362a9e38c0cdaf3f7571e6d4210491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vom6qirmEyFcnkeh"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mp"><img src="../Images/88faa56ead64f95ab346e67b3c07836e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tB7Bbb-MTjoRkZGM"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mq"><img src="../Images/96fcba5ec8d47c01f83503a20a618c2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k2RbhAo3e96gqnyp"/></div></div></figure><h1 id="c090" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">入围的有前途的模型</h1><p id="a786" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">我的前进方法是训练来自不同类别(例如，线性、集成、支持向量机等)的多个模型。)使用标准参数。然后使用交叉验证分数，根据模型的性能对其进行筛选。</p><p id="2ab7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我还用三种不同的模型(线性回归器、<br/>梯度推进回归器、支持向量机回归器)训练了一个投票回归器。它表现很好，但无法击败梯度回归。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mr"><img src="../Images/95e4284e9b5e02207ff1a4939c4817bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/0*GRdaVYnOslac76qr"/></div></figure><p id="0c25" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">毫无疑问，梯度推进回归器是我们表现最好的通用模型。随机森林是列表中唯一一个似乎严重过度拟合的模型。</p><h1 id="0f7d" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">微调潜在模型</h1><p id="80f5" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">梯度增强是一种广义模型，它在方差和偏差上是平衡的，并且不需要任何超调。虽然，随机森林是过度拟合，并有很高的方差，也许超调模型将有助于我们与过度拟合。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ms"><img src="../Images/e677b3a2c38586da21375e49d505edc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OqTehJ66LG1-6F-q"/></div></div></figure><p id="bc43" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">经过超调后，这个模型仍然有点过度拟合，但它已经比以前好得多，可以被认为是我们的最终选择。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mt"><img src="../Images/46a30d1a00bf4ace03493adab23c0736.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/0*Jh600iEO3VX2ise2"/></div></figure><p id="699f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不要只看 10 个交叉验证折叠的平均准确性，让我们绘制每个模型的所有 10 个分数，以及一个突出显示上下四分位数的方框图，以及显示分数范围的“胡须”。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/d2728e17b1e05b5bd9fcf175cb1e040f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4qmOagX1z4omWzLl"/></div></div></figure><p id="6ae3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在随机森林回归器和梯度推进回归器之间很难做出选择。这次我将选择随机森林回归，因为它的平均绝对误差为 2 美元。我们可以用梯度推进回归器，这取决于我们要做什么；误差更小或差异更小。</p><h1 id="cfaa" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">评估测试集</h1><p id="1ca3" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">我使用一个微调的随机森林回归器来训练测试模型，它在测试集上的表现甚至更好。考虑到我们基线模型的 93.5 分，我们在测试中获得了一个很好的分数，可以进一步提高。</p><p id="3a53" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我还可以在 description 列中使用 NLP，这可能会使 MAE 进一步下降。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mu"><img src="../Images/80ef4ffe0d446bd3dad83ad948b977ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/0*XMvAod_zi2jduTc2"/></div></figure><h1 id="8a34" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">排列重要性</h1><p id="2c44" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">我面临一些提取排列重要性的挑战。我们使用置换类生成的特征重要性均值或特征重要性标准差采用 NumPy 数组的格式。只有当我们可以生成一个列的列表并将其压缩到特性重要性(type:numpy.array)时，这些数字才有意义，或者可以用它制作一个数据框。</p><p id="a38c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是一个问题，因为 X_train _ transformed(transformed X _ train)也是一个 NumPy 数组，这使得我无法从转换后的 X _ train 中提取列。通过进一步研究这个问题，我找到了解决办法。问题出在简单的 input 上，因为它生成 NumPy 数组类型的输出。相反，我使用了我之前制作的类别管道来适应和转换 X_train。因为我使用了类别编码器库，所以我能够生成一个数据帧作为输出，这解决了我们的问题。</p><p id="10f6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意:</p><p id="ec71" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">scikit-learn 预处理库有类别编码器，生成一个 NumPy 数组；这解决不了我们的问题。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mv"><img src="../Images/d63f7e574b5773907d91d8ac52cf5740.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/0*WMnhbJCHX8MJpgqi"/></div></figure><h1 id="1a06" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">使用图来解释最终模型的预测</h1><p id="c218" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">当我们不使用线性最大似然模型时，SHAP 图和部分相关图就派上了用场，因此我们几乎不可能绘制模型的预测图。</p><h1 id="b80a" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">SHAP(沙普利附加解释)</h1><p id="214a" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">SHAP 框架已被证明是机器学习模型解释领域的一个重要进步。它结合了几种现有的方法来创建一个直观的，理论上合理的方法来解释任何模型的预测。</p><p id="0c52" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">SHAP 通过对每个预测和特征提出相同的问题来建立模型解释:“当特征 j 从模型中移除时，预测 I 如何变化？”所谓的<em class="mw"> SHAP 值</em>就是答案。它们量化了特征对预测影响的大小和方向(积极或消极)。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mx"><img src="../Images/e9580e2e05f8e64f9ac18feb693599a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VfV74ZB-SGXsCnzV"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es my"><img src="../Images/68c88eadaa5903e8c73755d1730db023.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IexXp_-zKh7L0Ruo"/></div></div></figure><p id="baa0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">邮政编码、邻里关系以及房东是否是超级房东是影响 Airbnb 价格的三个最重要的变量。</p><h1 id="7daf" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">部分相关图</h1><p id="f4a6" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">部分相关性图(短 PDP 或 PD 图)显示了一个或两个特征对机器学习模型的预测结果的边际效应。部分相关性图可以显示目标和特征之间的关系是线性的、单调的还是更复杂的。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/6092d6e309742593d835e107a867934e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lNTSqrOm6gMvPOFW"/></div></div></figure><p id="397b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个图告诉我们押金作为预测 Airbnb 夜间价格的一个特征的重要性。随着保证金的增加，每晚的价格也会增加，直到保证金达到 100 英镑。将押金提高到 100 英镑以上不再影响 Airbnb 的每晚价格。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mz"><img src="../Images/e9b16273eb8ba489f86629da8182fcc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NIpFq_AFF7mJyOvO"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es na"><img src="../Images/129f50515cb456922cf4c3745884dbf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FmCtBTUho34gl3Nb"/></div></div></figure><p id="22bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">感谢阅读，并随时检查代码和 web 应用程序。</p><p id="7976" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">代码:<a class="ae kr" href="https://github.com/navroz-lamba/Prediciting-Airbnb-prices-in-LA" rel="noopener ugc nofollow" target="_blank">https://github . com/nav roz-Lamba/predi sting-Airbnb-prices-in-LA</a></p><p id="34f1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">网页 App:【https://airbnb-la.herokuapp.com/ T4】</p></div></div>    
</body>
</html>