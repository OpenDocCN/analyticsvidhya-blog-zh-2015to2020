<html>
<head>
<title>How To: Manipulate DataFrames in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何:在Pandas中操作数据框</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-manipulate-dataframes-in-pandas-31375623d859?source=collection_archive---------26-----------------------#2020-01-02">https://medium.com/analytics-vidhya/how-to-manipulate-dataframes-in-pandas-31375623d859?source=collection_archive---------26-----------------------#2020-01-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c63c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">这是2017年跑卫系列的第2部分，共3部分。点击</em> <a class="ae je" rel="noopener" href="/analytics-vidhya/how-to-querying-the-internet-for-data-part-1-5385f3961b52"> <em class="jd">此处</em> </a> <em class="jd">查看part 1。</em></p><p id="bc21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了能够从数据源中学习新的东西，您需要确保数据是干净的并且易于处理。这是数据科学工作中最重要的(也是很多人最不喜欢的)一步。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">实时观察数据科学家清理数据</figcaption></figure><p id="977f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你还记得最后的How To，我们正在尝试看看2017年的跑卫到底有多好，因为我们被告知选秀班是联盟中最好的。现在，让我们清理数据，以便我们可以看到它是否是真的！</p><blockquote class="jq jr js"><p id="d0cd" class="if ig jd ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">在这个How To中，我们将再次使用我们2017年的跑锋数据，看看这种类型的跑锋是否真的主宰了NFL。我们将从收集更多的数据开始，清理数据使其可用，然后开始分析数据。</p></blockquote></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="b165" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">创建我们的“干净数据”</h1><p id="9710" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">到<a class="ae je" rel="noopener" href="/analytics-vidhya/how-to-querying-the-internet-for-data-part-1-5385f3961b52">最后一篇</a>结束时，你应该已经能够在Pandas中创建一个数据帧，存储2017年起草的跑卫。乍一看，数据似乎很好处理，但结果是，我们应该做一点预处理，使其更容易处理。</p><h2 id="2bca" class="lg ke hi bd kf lh li lj kj lk ll lm kn iq ln lo kr iu lp lq kv iy lr ls kz lt bi translated">清理数据</h2><p id="e662" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">看一下数据，我们可以看到一些球员的名字旁边有一个+。这表明该球员是否参加了职业杯赛，但出于我们的目的，我们可以从名字中去掉它(另外，职业杯赛并不总是衡量一个跑锋有多好的好方法)。另一个需要注意的是，有些整数带有*。这告诉我们球员是否是补偿性选择，但我们只关心球员，而不是他们为什么/如何被选中。</p><p id="2282" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了清理数据的这些部分，我们必须遍历DataFrame的行并清理每个条目。有许多方法可以遍历数据帧，每种方法都有其优点，但是为了简单起见，我们将使用iterrows方法。</p><blockquote class="jq jr js"><p id="56a7" class="if ig jd ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">你可以在一篇关于数据科学的<a class="ae je" href="https://towardsdatascience.com/different-ways-to-iterate-over-rows-in-a-pandas-dataframe-performance-comparison-dc0d5dcef8fe" rel="noopener" target="_blank">好文章</a>中查看迭代方法的出色性能差异</p></blockquote><p id="32ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们在DataFrame上调用<code class="du lu lv lw lx b">.iterrows()</code>时，它会生成一对(index，Series ),我们可以遍历它们。Pandas中的系列类似于列表(它是NumPy数组的包装)。在我们的例子中，序列是每一行，我们可以使用列名访问该行的不同列。</p><p id="d0ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于iterrows需要注意的一点是，返回的行是原始行的副本。这意味着如果修改它，原始数据帧不会改变。因为我们实际上需要改变我们的数据帧，我们可以使用<code class="du lu lv lw lx b">.loc</code>，这是一种通过(row，col)对定位值的方法。然后，一旦我们得到了实际值，我们就可以改变它。我们将使用它将带a+的玩家姓名更改为不带，带*的回合数也是如此。</p><p id="59a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们来看看这一切是如何运作的。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ly jl l"/></div></figure><h2 id="9e3f" class="lg ke hi bd kf lh li lj kj lk ll lm kn iq ln lo kr iu lp lq kv iy lr ls kz lt bi translated">添加名称列</h2><p id="c2ef" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">我们要对数据帧做的最后一件事是将名称分成两列:第一列和最后一列。这是为了当我们在数据帧中寻找球员时，我们可以通过他们的姓氏来访问他们(我们将使用的其他数据集没有球员的名字)。</p><p id="5c74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要做到这一点，首先看一看跑锋的名字。除了T. J .洛根，他的名字中有两个空格。我们将不得不改变他的名字，以符合其他人的格式，但不要害怕！我们已经看到了<code class="du lu lv lw lx b">.loc</code>是如何工作的，所以我们可以在这里再次使用它。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ly jl l"/></div></figure><p id="d5f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将使用<code class="du lu lv lw lx b">str.split()</code>来拆分名和姓。当您在DataFrame的列上调用此函数时，它将按照给定的分隔符拆分字符串。如果我们将它的<code class="du lu lv lw lx b">expand</code>参数设置为<code class="du lu lv lw lx b">True</code>，它会自动将拆分后的字符串转换为DataFrame的列。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="er es lz"><img src="../Images/907ce845a3c4135a4dbfeef926a3bddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-mKnktGOep3MFtKNgrWa2g.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">这正是我们想要的！</figcaption></figure><p id="c926" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以在我们的<code class="du lu lv lw lx b">rb_df</code>中将这两列设置为两个新列。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ly jl l"/></div></figure><h2 id="f43c" class="lg ke hi bd kf lh li lj kj lk ll lm kn iq ln lo kr iu lp lq kv iy lr ls kz lt bi translated">收集2018年和2019年的统计数据</h2><p id="bd0d" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">我们已经从2017年开始跑回来，但我们需要一些统计数据来看看他们做得如何。对我们来说幸运的是，足球局外人在一些漂亮的表格中有他们的数据供我们使用。下面是他们的<a class="ae je" href="https://www.footballoutsiders.com/stats/rb/2018" rel="noopener ugc nofollow" target="_blank"> 2018 </a>和<a class="ae je" href="https://www.footballoutsiders.com/stats/rb/2019" rel="noopener ugc nofollow" target="_blank"> 2019 </a>数据。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="er es mg"><img src="../Images/ce121b09c346fd7eb5637e3fa8de68b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*02fQdf0X2GoHCXvworG7KQ.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">我们将使用的一些2018年数据集。亲自查看页面，了解不同的栏目告诉我们关于跑锋的信息！</figcaption></figure><p id="c139" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一部分将是我们在上一节中已经学到的内容。我们将使用请求来获取2018年和2019年网页的这些表格，并将它们存储为数据帧。我已经提供了这样做的代码，但它将非常类似于我们如何获得初始数据。</p><blockquote class="jq jr js"><p id="ef36" class="if ig jd ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">注意:我还查看了2017年的网页，由于表格的格式，它给创建可用的数据框架带来了很多挑战(列有错误的数据类型，不必要的行等。).虽然可行，但我们可以只坚持2018年和2019年，这是绰绰有余的数据。如果你想探索2017年的数据，看看跑卫在选秀结束后的表现，那就去吧！</p></blockquote><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ly jl l"/></div></figure><p id="17f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于这些数据框架，我们要做两件事:改变一些列的类型，并添加一些新的列。</p><h2 id="5a64" class="lg ke hi bd kf lh li lj kj lk ll lm kn iq ln lo kr iu lp lq kv iy lr ls kz lt bi translated">固定列类型</h2><p id="4d14" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">在查看数据时，您应该注意到一点，即大多数值都是数字；然而，有三个栏目不是:DVOA，美国之音，和Suc率。这些列中的百分号表示该列的数据类型是字符串。我们可以很容易地证实这一点。</p><pre class="jf jg jh ji fd mh lx mi mj aw mk bi"><span id="1f26" class="lg ke hi lx b fi ml mm l mn mo">rb2018_df['DVOA'].dtype # dtype('O')<br/>rb2018_df['VOA'].dtype # dtype('O')<br/>rb2018_df['Suc  Rate'].dtype # dtype('O')</span></pre><p id="1d45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Pandas中,<code class="du lu lv lw lx b">dtype('O')</code>表示对象，在本例中是一个字符串。我们需要它是一个float或int，这样我们就可以用它来可视化图形。</p><p id="898c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们可以使用列并应用<code class="du lu lv lw lx b">str.replace('%', '')</code>来去掉百分号。然后，一旦只剩下浮点值，我们可以使用<code class="du lu lv lw lx b">.astype(float)</code>将整个列从字符串列转换为浮点列。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ly jl l"/></div></figure><h2 id="5dfb" class="lg ke hi bd kf lh li lj kj lk ll lm kn iq ln lo kr iu lp lq kv iy lr ls kz lt bi translated">向我们的数据框架添加列</h2><p id="bfbf" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">先来说明一个跑锋是否属于2017年选秀班。为此，我们将查看跑锋的姓氏是否在我们的<code class="du lu lv lw lx b">rb_df</code>的<code class="du lu lv lw lx b">last</code>列中。我们可以通过访问这个列作为一个系列:<code class="du lu lv lw lx b">rb_df['last']</code>，然后用<code class="du lu lv lw lx b">.tolist()</code>把它转换成一个列表。</p><p id="aead" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步:回到iterrows！我们将检查2018年(和2019年)统计数据帧的每一行，并检查球员的姓氏是否在我们的列表中。Pandas允许从列表中添加一列，所以我们可以在列表中跟踪它。如果球员在2017名单中，我们可以追加<code class="du lu lv lw lx b">True</code>，否则追加<code class="du lu lv lw lx b">False</code>。最后，只需通过命名并将其设置到列表中来创建一个新列。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ly jl l"/></div></figure><p id="0389" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来我们要添加的两列是每次尝试的码数(YPA)和每次尝试的有效码数(EYPA)。这两个值是基于我们的数据框架中已经有的两个值:YPA =码数/行程和EYPA =码数/行程。这是熊猫处理得非常好的事情。</p><p id="8c1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为我们希望对列的每一行都执行相同的操作，所以我们可以简单地对列执行操作，Pandas将逐个条目地执行它。它看起来像这样:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ly jl l"/></div></figure><p id="5976" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就这么简单！至此，我们完成了所有的数据帧操作！</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="er es mp"><img src="../Images/c535ab48b5d0f619ebc0e45c95f2bee1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z0g7TwRTE-wYvAvA5K9ODw.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">2018年统计最终数据框架的前五个条目</figcaption></figure><p id="1c84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们能够学习如何在Pandas中编辑数据，通过迭代数据帧，使用<code class="du lu lv lw lx b">.loc</code>和列操作。现在我们的数据已经为最后一步做好了准备:分析。</p><p id="ef53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本系列的<a class="ae je" rel="noopener" href="/@amanjaiman/how-to-visualize-your-data-in-python-a1dc46ad1f8d">最终教程中，我们将学习如何可视化我们的数据，以便我们可以通过视觉得出结论，而不是筛选我们已经拥有的众多列数据。这是能够确定2017年的running back课程到底有多好的最后一步。</a></p><p id="d298" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">本教程的完整代码如下:</em></p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ly jl l"/></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="1dbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">一如既往，我很想听听你对这篇文章的看法！将任何问题或意见发送至</em><a class="ae je" href="mailto:amanjaiman@outlook.com" rel="noopener ugc nofollow" target="_blank"><em class="jd"/></a><em class="jd">。</em></p></div></div>    
</body>
</html>