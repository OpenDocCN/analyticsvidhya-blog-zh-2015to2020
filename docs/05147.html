<html>
<head>
<title>Python Decorators</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python装饰者</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/python-decorators-bd8cd698fb96?source=collection_archive---------18-----------------------#2020-04-12">https://medium.com/analytics-vidhya/python-decorators-bd8cd698fb96?source=collection_archive---------18-----------------------#2020-04-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f81f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将学习和理解什么是Python装饰器。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/b0b39c6404d53d0a0fba0e781dd0eb6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dJl76hCxhYkAe_soBPAZAQ.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">照片由<a class="ae jt" href="https://unsplash.com/@sunil07?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Sunil Rana </a>在<a class="ae jt" href="https://unsplash.com/s/photos/birds-nepal?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="f34d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的草稿已经写了至少8个月了，现在要完成了。🌅</p><p id="70b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在使用Django代码库时，会遇到装饰器的多种用法，尤其是在用户授权部分。对装饰者如何使用我在代码库中看到和使用的模式有一些实际的理解。因此，深入探究装饰者到底是什么。</p><p id="677f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">装饰器是修改其他函数功能的函数。它们有助于使我们的代码更短(干)。</p><p id="f41f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在深入装饰者之前，让我们更清楚地了解一下‘作为一等公民的Python中的函数’的概念。在编程语言设计中，“一等公民”意味着能够成为</p><ul class=""><li id="9fe7" class="jv jw hi ih b ii ij im in iq jx iu jy iy jz jc ka kb kc kd bi translated"><strong class="ih hj">赋给一个变量</strong></li><li id="f87a" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated"><strong class="ih hj">作为论据通过</strong></li><li id="603b" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated"><strong class="ih hj">从函数返回</strong></li></ul><p id="4279" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们通过一个例子来看看这些行为:</p><p id="dc34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 0。python中的函数可以赋给一个变量:</strong></p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="8d92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">新手me会好奇地看着赋值，心想为什么在方法名<code class="du kl km kn ko b">square</code>后面没有<code class="du kl km kn ko b">()</code>。嗯，那是因为我们没有执行<code class="du kl km kn ko b">square</code>方法。相反，我们将该方法的引用传递给一个名为<code class="du kl km kn ko b">get_square</code>的新变量。因此，我们现在可以用新变量<code class="du kl km kn ko b">get_square</code>调用方法<code class="du kl km kn ko b">square</code>。</p><ol class=""><li id="238d" class="jv jw hi ih b ii ij im in iq jx iu jy iy jz jc kp kb kc kd bi translated"><strong class="ih hj">python中的函数可以作为参数传递</strong></li></ol><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="a2d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我们将函数<code class="du kl km kn ko b">square</code>的引用作为参数传递给函数<code class="du kl km kn ko b">cube</code>，执行<code class="du kl km kn ko b">square</code>函数，并将它返回的值再次乘以<code class="du kl km kn ko b">number_to_cube</code>以获得一个数的立方！漂亮。🙂</p><p id="dc0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。python中的函数可以返回另一个函数</strong></p><p id="6bfb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们后退一步，看看我们可以将一个函数定义为另一个函数。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="c494" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们在函数<code class="du kl km kn ko b">double_func</code>中定义了一个函数<code class="du kl km kn ko b">multiply_by_two</code>。我们在<code class="du kl km kn ko b">double_func</code>函数中调用了<code class="du kl km kn ko b">multiply_by_two</code>函数，并返回了它的值。所以我们可以在一个函数中定义另一个函数。</p><p id="ee3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你已经注意到，函数<code class="du kl km kn ko b">multiply_by_two</code>使用传递给<code class="du kl km kn ko b">double_func</code>函数的<code class="du kl km kn ko b">number</code>参数。这是因为嵌套函数可以访问封闭函数的变量范围。</p><p id="5e77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们看看我们也可以返回一个函数。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="d5f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们看到<code class="du kl km kn ko b">double_func</code>函数被赋给了一个变量<code class="du kl km kn ko b">doubled</code>。我们可以通过使用<code class="du kl km kn ko b">()</code>调用<code class="du kl km kn ko b">doubled</code>，因为<code class="du kl km kn ko b">double_func</code>的返回值是一个函数！如果你注意到了，我们使用了一等公民的第一份财产；函数可以赋给一个变量。</p><p id="f3a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你写到文章的中间了。恭喜你。👏</p><p id="f4ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，既然我们已经有了理解装饰者所需的必要知识，让我们开始深入研究吧！</p><p id="e450" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">让我们创建一个简单的装饰器:</strong></p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="b968" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，我们将函数<code class="du kl km kn ko b">say_bye</code>作为参数传递给函数<code class="du kl km kn ko b">lowercase_decorator</code>，函数<code class="du kl km kn ko b">lowercase_decorator</code>内部有一个函数<code class="du kl km kn ko b">wrapper</code>。<code class="du kl km kn ko b">wrapper</code>函数执行<code class="du kl km kn ko b">say_bye</code>函数并返回其小写返回值。</p><p id="dc8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这有点太难写了，所以Python提供了简洁的修饰器。</p><p id="062a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以通过在<code class="du kl km kn ko b">say_bye</code>函数上使用<code class="du kl km kn ko b">@lowercase_decorator</code>来实现上述功能，就像这样:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="3c69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看，我们只需要在我们想要使用装饰器的函数上使用<code class="du kl km kn ko b">@&lt;name-of-the-decorator&gt;</code>。</p><p id="6a41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们也可以对一个函数应用多个装饰器。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="d7f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看，我们有两个装饰器:第一个用破折号替换空格，另一个将字符串转换成小写。在这里，decorator的顺序并不重要，因为我们可以改变顺序，但仍然可以得到想要的结果。然而，情况可能并不总是如此。</p><p id="1bca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，如果我们有一个decorator拆分字符串，而不是用破折号替换空格，那么我们需要第一个decorator是小写字符串，第二个decorator是拆分字符串。这是因为拆分字符串会返回一个不能小写的<code class="du kl km kn ko b">list</code>数据类型。让我们花3/4的文章呼吸🍃</p><p id="16dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">在这里，我们将学习如何将参数传递给装饰者:</strong></p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="21df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里参数被传递给装饰器内部的包装函数。这是在执行期间完成的。</p><p id="6500" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">让我们用</strong> <code class="du kl km kn ko b"><strong class="ih hj">*args</strong></code> <strong class="ih hj">和</strong> <code class="du kl km kn ko b"><strong class="ih hj">**kwargs</strong></code> <strong class="ih hj"> : </strong>来定义一个更通用的装饰器</p><p id="cd99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们回忆一下什么是<code class="du kl km kn ko b">*args</code>和<code class="du kl km kn ko b">**kwargs</code>。<code class="du kl km kn ko b">*args</code>代表可变数量的参数，<code class="du kl km kn ko b">**kwargs</code>代表可变数量的关键字参数。关键字arguments有一个语法<code class="du kl km kn ko b">key=val</code>，args只有一个简单的变量名，如<code class="du kl km kn ko b">var</code>。当我们不知道将传递给函数的参数数量时，它特别有用。因此是通用的。🙂</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="414c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如所料，这里的行为类似于前面将参数传递给装饰器内部的包装器的例子，但是这里我们可以灵活地发送任意数量的参数，包括无参数。</p><p id="63fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们探索一下，如果我们需要向装饰者本身发送参数会怎么样！</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="e03d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗯，这里也没什么。我们需要一个额外的装饰器，它接受装饰器参数，其余两个内部函数的结构与前一个相同。</p><p id="2a91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，现在我们看到这么多嵌套函数。如果我们想调试它们呢？让我们看看函数<code class="du kl km kn ko b">places_to_travel</code>的元数据是什么。</p><pre class="je jf jg jh fd kq ko kr ks aw kt bi"><span id="e3be" class="ku kv hi ko b fi kw kx l ky kz">print(places_to_travel.__name__) # prints 'wrapper'<br/>print(places_to_travel.__doc__) # prints 'This is a wrapper function'</span></pre><p id="2e9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗯（表示踌躇等）..，这在调试时并没有真正的帮助，因为我们想要看到装饰器正在操作哪个实际的函数。幸运的是，我们已经有了一个库<code class="du kl km kn ko b">functools</code>，我们可以在包装函数上装饰它，传递它正在包装的函数的参数，就像这样:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es la"><img src="../Images/f44e6b3af90fee60aa9b52128a16befb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9OR2GPrnQe-CoNnTxK3rBQ.png"/></div></div></figure><p id="ad32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们这样做了</p><pre class="je jf jg jh fd kq ko kr ks aw kt bi"><span id="dc3f" class="ku kv hi ko b fi kw kx l ky kz">print(places_to_travel.__name__) # prints 'place_to_travel'<br/>print(places_to_travel.__doc__) # prints 'This lists some of the country on my travel-list.'</span></pre><p id="ec57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据需要！</p><p id="71c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们回顾一下什么是室内设计师。装饰者修改它所装饰的函数的功能。这是可能的，因为python中的函数是“一等公民”。</p><p id="4e6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">祝贺完成！你成功了💪。我希望这对理解和实现python decorators有所帮助。</p><p id="5bdd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的下一篇文章很可能是关于Java注释的。到时候见。</p><p id="b30f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您的阅读。</p><p id="2943" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你喜欢，👏非常感谢。</p><p id="7ed0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考</strong>:</p><ul class=""><li id="49c2" class="jv jw hi ih b ii ij im in iq jx iu jy iy jz jc ka kb kc kd bi translated">数据营</li></ul></div></div>    
</body>
</html>