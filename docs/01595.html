<html>
<head>
<title>Building a RESTful web API with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python构建RESTful web API</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/building-a-restful-web-api-with-python-e843563d6f97?source=collection_archive---------9-----------------------#2019-11-02">https://medium.com/analytics-vidhya/building-a-restful-web-api-with-python-e843563d6f97?source=collection_archive---------9-----------------------#2019-11-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/fe621eb79adb1bdd1094758a04b42e5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*anxkklhBPTUY8KJc.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片来源:<a class="ae iu" href="https://www.google.com/url?sa=i&amp;source=images&amp;cd=&amp;ved=2ahUKEwju_sG1-crlAhWO3OAKHWoHAcMQjRx6BAgBEAQ&amp;url=http%3A%2F%2Fwww.softwaresamurai.org%2F2017%2F12%2F03%2Fusing-restful-api-javascript%2F&amp;psig=AOvVaw1Iem32pc4P8KQUoKpRIicg&amp;ust=1572764191509797" rel="noopener ugc nofollow" target="_blank">https://www.google.com/url?sa=i&amp;Source = images&amp;CD =&amp;ved = 2 ahukewju _ sG1-crlahwo 3 akhwohacmqjrx 6 bagbeaq&amp;URL = http % 3A % 2F % 2 fwww . software samurai . org % 2f 2017% 2 F12 % 2f 03% 2 fusing-restful-API-JavaScript % 2F&amp;psig = aovvaw1 iem 32 PC 4 p 8 kquokpriicg&amp;</a></figcaption></figure><p id="4cc2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，目标是构建一个遵循RESTful原则的web API或服务。但是在设计阶段之前，我们先来解释一些概念。</p><p id="e222" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">什么是API？</strong></p><p id="bb33" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一个<a class="ae iu" href="https://en.wikipedia.org/wiki/Application_programming_interface" rel="noopener ugc nofollow" target="_blank"> API </a>是一个计算机程序的一部分，被设计成由另一个计算机程序使用或操纵。由于用户界面是为人类与计算机程序交互而存在的，因此API是为计算机程序与其他计算机程序交互而存在的。</p><p id="4013" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">什么是WEB API？</strong></p><p id="d27a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">web API或服务通过互联网提供由其他程序操作的功能或数据。直觉上，我们已经可以假设除了web API之外还有其他类型的API。像电子表格这样的桌面应用程序使用不需要网络服务的VBA API。web服务是一个API(包装在HTTP中),但是API不一定是web服务。最近，设计web服务或API的标准架构已经转向REST(<strong class="ix hj">RE</strong>presentational<strong class="ix hj">S</strong>state<strong class="ix hj">T</strong>transfer)。</p><p id="37fe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">什么是休息？</strong></p><p id="eb77" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">REST架构最初被设计成适合万维网使用的HTTP(<strong class="ix hj">H</strong>yper<strong class="ix hj">T</strong>ext<strong class="ix hj">T</strong>transfer<strong class="ix hj">P</strong>rotocol)。REST基于HTTP协议定义的四种方法:<strong class="ix hj"> POST </strong>、<strong class="ix hj"> GET </strong>、<strong class="ix hj"> PUT </strong>和<strong class="ix hj"> DELETE </strong>对应于对数据库中的数据执行的四种传统操作:<strong class="ix hj"> CREATE </strong>、<strong class="ix hj"> READ </strong>、<strong class="ix hj"> UPDATE </strong>和<strong class="ix hj"> DELETE </strong>。在本文中，我们将只插入数据库，从数据库中读取和更新数据库。这意味着我们将分别只关心POST、GET和PUT请求。REST设计原则有六大特点:</p><ul class=""><li id="3f5c" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">客户机-服务器:这意味着客户机和服务器之间的区别应该很清楚。</li><li id="70dc" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><strong class="ix hj">无状态:</strong>不允许服务器将一个请求中提供的信息用于另一个请求。这意味着客户端应该对发送到服务器的每个请求进行身份验证。</li><li id="58b5" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><strong class="ix hj">统一接口:</strong>客户端和服务器之间的通信方式必须统一。这意味着应用程序中的每个实体都需要唯一标识。本文中的web API将使用URL来惟一地标识我们的资源。此外，要交换的数据的格式必须在客户机和服务器之间达成一致。将用<a class="ae iu" href="https://en.wikipedia.org/wiki/JSON" rel="noopener ugc nofollow" target="_blank">JSON(<strong class="ix hj">J</strong>ava<strong class="ix hj">S</strong>script<strong class="ix hj">O</strong>object<strong class="ix hj">N</strong>rotation)</a>格式来表示资源。需要在资源表示中清楚地指定不同资源之间的关系，以便客户端可以利用它们来发现新资源。</li><li id="9677" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><strong class="ix hj">可缓存:</strong>出于性能原因，服务器、客户端或中间系统应该能够缓存数据。服务器必须向客户端或中间系统指示和提供请求是否可以缓存以及如何缓存的指令。</li><li id="8d89" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><strong class="ix hj">分层系统:</strong>客户端不需要直接连接到服务器，而是可以通过中间系统连接，中间系统将请求中继到服务器。</li><li id="a797" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><strong class="ix hj">按需编码:</strong>这表示服务器可以提供客户端可以在其上下文中执行的代码。这个属性是唯一可选的，而且不实用，因为在执行代码方面有各种各样具有不同能力的客户端。</li></ul><p id="2b32" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文结束时，我们将构建一个web服务或API，它在从数据库提取数据和向数据库推送数据时遵循RESTful原则。</p><p id="0b20" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">让我们为我们的项目</strong>创建一个虚拟环境</p><p id="ba40" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">虚拟环境是一种工具，它通过为我们的依赖项创建一个隔离的Python虚拟环境来帮助保持项目依赖项的分离。我的假设是，我们的操作系统上已经安装了Python，我们选择的操作系统是Windows。在继续之前，让我们创建一个项目文件夹，我们可以在其中保存我们将使用的所有文件。</p><ul class=""><li id="ba52" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated"><strong class="ix hj">注意:</strong>如果我们从另一个操作系统工作，只有少数命令会改变，但这是相同的过程，所以我们可以谷歌(如果必要的话)跟随。</li></ul><p id="a3cb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这样，让我们在项目文件夹中打开一个终端会话，并运行以下命令(不带路径):</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="a968" class="kq kr hi km b fi ks kt l ku kv">C:\Users\aobisesan\Desktop\web api&gt;python -m venv myenv</span></pre><p id="7baa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面的命令创建了一个虚拟环境。myenv 是虚拟环境的名称，我们也可以使用相同的名称或选择不同的名称。接下来，我们需要激活虚拟环境，为此我们运行以下命令(不带路径):</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="4f95" class="kq kr hi km b fi ks kt l ku kv">C:\Users\aobisesan\Desktop\web api&gt;myenv\Scripts\activate</span></pre><p id="fa51" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将激活您的虚拟环境，很明显，虚拟环境的名称显示在文件夹路径前的括号中，如下所示:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="642f" class="kq kr hi km b fi ks kt l ku kv">(myenv) C:\Users\aobisesan\Desktop\web api&gt;</span></pre><p id="733d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，让我们安装两个包，它们不是Python自带的，但是我们的项目需要它们。要安装这两个包，我们需要运行以下命令(不带路径):</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="794f" class="kq kr hi km b fi ks kt l ku kv">(myenv) C:\Users\aobisesan\Desktop\web api&gt; pip install pandas &amp;&amp; pip install flask</span></pre><p id="2651" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上述命令安装<a class="ae iu" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">熊猫</a>和<a class="ae iu" href="https://palletsprojects.com/p/flask/" rel="noopener ugc nofollow" target="_blank">烧瓶</a>。</p><ul class=""><li id="2ef5" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated"><a class="ae iu" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> Pandas </a>是一个数据结构和数据分析工具。这将用于在<a class="ae iu" href="https://pandas.pydata.org/pandas-docs/stable/reference/frame.html" rel="noopener ugc nofollow" target="_blank">数据框架</a>中查看我们数据库表的内容。</li><li id="96d6" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">Flask是一个易于扩展的微型web框架。这将用于我们的API开发。</li></ul><p id="baf8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，让我们在项目文件夹中创建一个脚本来查看我们将使用的两个表，并将脚本命名为<strong class="ix hj"> view_db.py </strong>(此外，我们可以选择我们想要的任何名称)。</p><ul class=""><li id="8a71" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated"><strong class="ix hj">注意:</strong>为了在不需要编码的情况下跟进，我们可以从我的GitHub库中<a class="ae iu" href="https://github.com/Ayoyiinka/web-api.git" rel="noopener ugc nofollow" target="_blank">克隆</a>。</li></ul><p id="c178" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">我们数据库的概述</strong></p><p id="c7d8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用的数据库是<a class="ae iu" href="https://www.sqlite.org/index.html" rel="noopener ugc nofollow" target="_blank"> SQLite </a>，这是一个轻量级数据库引擎，可以由Python库(标准库自带)处理。要用的数据库来源是<a class="ae iu" href="https://www.sqlitetutorial.net/" rel="noopener ugc nofollow" target="_blank"> SQLite教程</a>。我们可以将数据库下载到我们的项目文件夹中。这是下面数据库图的<a class="ae iu" href="https://www.sqlitetutorial.net/wp-content/uploads/2018/03/sqlite-sample-database-diagram-color.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">截图</strong> </a>:</p><figure class="kh ki kj kk fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/085ce543df3e040f60cde67086de3ccd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*74XH2QOSLdThbM3be35bdw.png"/></div></figure><p id="5792" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个数据库中，我们可以看到这么多的表，但是我们的API将只使用两个表:<strong class="ix hj">艺术家</strong>和<strong class="ix hj">专辑</strong>。<strong class="ix hj">艺术家</strong>和<strong class="ix hj">专辑</strong>有一对多的关系，意味着一个艺术家可以有几个专辑，反之亦然。现在，让我们用Python来看看这两个表的内容。</p><p id="d1b5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> view_db.py </strong></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="3efc" class="kq kr hi km b fi ks kt l ku kv">import sqlite3<br/>import pandas as pd</span><span id="9b89" class="kq kr hi km b fi kx kt l ku kv">#creating a connection object that represents the database<br/>conn = sqlite3.connect(‘chinook.db’)</span><span id="7f12" class="kq kr hi km b fi kx kt l ku kv">cur = conn.cursor()</span><span id="a6f8" class="kq kr hi km b fi kx kt l ku kv">#getting the column information for the artists and albums table e.g column name and data type<br/>artists_col_infos = []<br/>for col_info in cur.execute(“PRAGMA TABLE_INFO(artists)”):<br/>    artists_col_infos.append(col_info)</span><span id="1150" class="kq kr hi km b fi kx kt l ku kv">albums_col_infos = []<br/>for col_info in cur.execute(“PRAGMA TABLE_INFO(albums)”):<br/>    albums_col_infos.append(col_info)</span><span id="4dcc" class="kq kr hi km b fi kx kt l ku kv">#querying the tables — artists and albums<br/>artists_data = cur.execute(“SELECT * FROM artists”).fetchall()<br/>albums_data = cur.execute(“SELECT * FROM albums”).fetchall()</span><span id="6eca" class="kq kr hi km b fi kx kt l ku kv">conn.close()</span><span id="13b4" class="kq kr hi km b fi kx kt l ku kv">#saving the dataframe (a representation of the database table)<br/>artists_dataframe = pd.DataFrame(artists_data, columns=[col_name[1] for col_name in artists_col_infos])</span><span id="a9dd" class="kq kr hi km b fi kx kt l ku kv">albums_dataframe = pd.DataFrame(albums_data, columns=[col_name[1] for col_name in albums_col_infos])</span><span id="cd0b" class="kq kr hi km b fi kx kt l ku kv">print(‘See below the datatype of each column in the artists table’)<br/>print(artists_col_infos)<br/>print()<br/>print(‘See below the datatype of each column in the artists table’)<br/>print(albums_col_infos)<br/>print()</span><span id="51eb" class="kq kr hi km b fi kx kt l ku kv">print(“A VIEW OF THE FIRST 5 ROWS AND LAST 5 ROWS OF THE ARTISTS TABLE”)<br/>print(artists_dataframe.head()),<br/>print(artists_dataframe.tail())<br/>print()<br/>print(“\n\nA VIEW OF THE FIRST 5 ROWS AND LAST 5 ROWS OF THE ALBUMS TABLE”)<br/>print(albums_dataframe.head())<br/>print(albums_dataframe.tail())</span></pre><p id="9846" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">基本上，代码所做的是首先获取每一列的信息(例如，数据类型)并将其保存在两个不同的变量中。然后，查询两个数据库表，并将结果保存到另外两个变量中。接下来，它使用具有两个数据库表查询的两个变量创建两个数据帧。最后，它输出到屏幕上；每一列的信息和数据帧。下面的输出还包含执行代码的命令。</p><p id="97b3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> <em class="ky">输出</em> </strong></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="0f54" class="kq kr hi km b fi ks kt l ku kv">(myenv) C:\Users\aobisesan\Desktop\web api&gt;python view_db.py</span></pre><figure class="kh ki kj kk fd ij er es paragraph-image"><div class="er es kz"><img src="../Images/0aa5116e4adc4e200a62d46b9a6dbb3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*mhqZyFSPof2QR3Ssk-HUUA.png"/></div></figure><p id="a8a8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> <em class="ky">输出汇总</em> </strong></p><p id="fbdd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的<strong class="ix hj">艺人</strong>表有两列(<strong class="ix hj">艺人Id </strong>和<strong class="ix hj">名字</strong>)275行，而我们的<strong class="ix hj">专辑</strong>表有三列(<strong class="ix hj">专辑Id </strong>、<strong class="ix hj">标题</strong>和<strong class="ix hj">艺人id</strong>)347行。<strong class="ix hj">专辑</strong>表中的<strong class="ix hj">艺人Id </strong>是来自<strong class="ix hj">艺人</strong>表的<a class="ae iu" href="https://en.wikipedia.org/wiki/Foreign_key" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">外键</strong> </a>，这有助于将<strong class="ix hj">专辑</strong>映射到<strong class="ix hj">艺人</strong>。另外，<strong class="ix hj"> ArtistId </strong>和<strong class="ix hj"> AlbumId </strong>列只接受整数，而<strong class="ix hj"> Name </strong>和<strong class="ix hj"> Title </strong>只接受最多120和160个字符的文本。现在我们知道了表中包含的内容，我们可以开始处理数据，所以是时候开始设计我们的web服务了</p><p id="43ab" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">设计阶段</strong></p><figure class="kh ki kj kk fd ij er es paragraph-image"><div class="er es la"><img src="../Images/dda63788f6744483e599f58ef36105d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:558/format:webp/1*8oMRhWBGV43MUQMqezjxZA.png"/></div></figure><p id="2cce" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们项目的最终结构如上图所示。我们已经有了<strong class="ix hj"> view_db.py </strong>、<strong class="ix hj"> myenv </strong>和<strong class="ix hj"> chinook.db </strong>。</p><ul class=""><li id="43f3" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated"><strong class="ix hj">注意:</strong>我们采用这种结构是为了让我们的程序易于维护，选择不一定是最好的，它是相对的。</li></ul><p id="0826" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了快速取胜，让我们在终端上运行以下命令:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="aeab" class="kq kr hi km b fi ks kt l ku kv">(myenv) C:\Users\aobisesan\Desktop\web api&gt;pip freeze &gt; requirements.txt</span></pre><p id="fc54" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该命令创建一个<strong class="ix hj"> requirements.txt </strong>文件，该文件包含这个项目的所有已安装的依赖项和已安装的版本。该文件用于确保如果项目需要移动到新机器上，在新机器上安装<strong class="ix hj">pip install–r requirements . txt</strong>，所有的包/依赖项(具有相同的版本)都会安装到新机器上。所以，打开来检查一下，我们应该有的是下图中的东西(如果我们一直在努力跟随的话)；</p><figure class="kh ki kj kk fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/1bbc7784d4ee1c3e4853a07088001f32.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*n24AgDFTv6t8jTZ5uS6GPA.png"/></div></figure><p id="d992" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">其他文件的高级视图</strong></p><ul class=""><li id="ef26" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated"><strong class="ix hj"> api.py: </strong>这是我们需要运行来启动api的模块。</li><li id="467b" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">这是项目文件夹的子目录。</li><li id="a3c5" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><strong class="ix hj"> __init__。py:</strong>Python中的一个文件夹，包含一个<strong class="ix hj"> __init__。py </strong>文件被认为是一个包，这个<strong class="ix hj"> __init__。导入包时，py </strong>自动运行。因此，<strong class="ix hj"> art_alb </strong>是这个项目中的包。__init__。py模块将用于创建我们的web API的实例。</li><li id="4f94" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><strong class="ix hj"> albums.py: </strong>它定义了访问<strong class="ix hj"> albums </strong>表的路径/资源，并实现了POST和PUT方法来分别插入和更新albums表中的值，并最终以JSON格式返回数据。</li><li id="93a3" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><strong class="ix hj"> artists_albums.py: </strong>它定义了访问<strong class="ix hj"> artists </strong>和<strong class="ix hj"> albums </strong>表的路径/资源，并实现了查询数据库的GET方法。然后，它以JSON格式返回数据。返回的数据包含<strong class="ix hj"> ArtistID </strong>、<strong class="ix hj"> Name </strong>(艺术家的)和<strong class="ix hj"> Albums </strong>(映射到特定艺术家的所有专辑的列表)。</li><li id="2120" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><strong class="ix hj"> artists.py: </strong>定义了访问<strong class="ix hj"> artists </strong>表的路径，实现了POST和PUT方法，分别插入和更新artists表，并以JSON格式返回数据。<br/> <strong class="ix hj">注:</strong> POST方法追加到集合的末尾。也就是说，每次我们实现POST方法时，新数据都成为集合中的最后一个。</li><li id="e81a" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><strong class="ix hj"> errors.py: </strong>它定义了错误处理程序，以便以json格式返回错误，从而遵守资源表示。</li></ul><p id="124d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意:在继续之前，我假设我们有一点使用Flask框架的经验。</p><p id="7caf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> __init__。py </strong></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="79ff" class="kq kr hi km b fi ks kt l ku kv">from flask import Flask<br/>app = Flask(__name__)</span><span id="3930" class="kq kr hi km b fi kx kt l ku kv">def dict_factory(cursor, row):<br/>    d = {}<br/>    for idx, col in enumerate(cursor.description):<br/>        d[col[0]] = row[idx]<br/>    return d</span><span id="b16e" class="kq kr hi km b fi kx kt l ku kv">from art_alb import albums, artists_albums, artists, errors</span></pre><p id="7c33" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，在所有必要的导入之后，我们创建了应用程序的一个实例。然后我们定义了<strong class="ix hj"> dict_factory </strong>函数，该函数用于从我们的数据库返回基于名称的列的值。也就是说，它将数据库中的项目作为字典而不是列表返回。我们更喜欢返回字典，因为当我们将它们输出到JSON时，这样会更好。另外，可以注意到我们在文件的底部而不是顶部(像往常一样)导入了我们的模块(我们的其他资源)。这样做是为了避免我们在Python中所说的循环依赖错误。为了理解什么是循环依赖错误，你可以<a class="ae iu" href="https://blog.miguelgrinberg.com/post/flask-webcast-3-circular-dependencies" rel="noopener ugc nofollow" target="_blank">看看Miguel Grinberg的视频</a>。</p><p id="f519" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> artists_albums.py </strong></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="fcec" class="kq kr hi km b fi ks kt l ku kv">from flask import jsonify, request, abort<br/>from art_alb import app, dict_factory<br/>import sqlite3</span><span id="52cb" class="kq kr hi km b fi kx kt l ku kv">@app.route(‘/api/v1/chinook/artistsalbums’, methods=[‘GET’])<br/>def get_artists_with_their_albums():<br/>    conn = sqlite3.connect(‘chinook.db’)<br/>    conn.row_factory = dict_factory<br/>    cur = conn.cursor()<br/>    artists_dict = cur.execute(‘SELECT * FROM artists;’).fetchall()<br/>    albums_dict = cur.execute(‘SELECT * FROM albums;’).fetchall()<br/>    conn.close()<br/>    for artist in artists_dict:<br/>        artist[‘AlbumTitle’] = []<br/>        for album in albums_dict:<br/>            if artist[‘ArtistId’] == album[‘ArtistId’]:<br/>                artist[‘AlbumTitle’].append(album[‘Title’])<br/>    query_parameters = request.args<br/>    id_ = query_parameters.get(‘ArtistId’)<br/>    name = query_parameters.get(‘Name’)<br/>    if id_ and name:<br/>        if int(id_) &lt;= 0:<br/>            abort(400)<br/>        artists = []<br/>        for artist in artists_dict:<br/>            if artist[‘Name’] == name:<br/>                artist_id = artist[‘ArtistId’]<br/>                artists.append(artist)<br/>                break<br/>        if len(artists) == 0:<br/>            abort(404)<br/>        if int(id_) == artist_id:<br/>            return jsonify(artists)<br/>        else:<br/>            abort(400)<br/>    elif id_:<br/>        if int(id_) &lt;= 0:<br/>            abort(400)<br/>        artists = []<br/>        if int(id_) &gt; len(artists_dict):<br/>            abort(404)<br/>        artists.append(artists_dict[int(id_) — 1])<br/>        return jsonify(artists)<br/>    elif name:<br/>        artists = []<br/>        for artist in artists_dict:<br/>            if artist[‘Name’] == name:<br/>                artist_id = artist[‘ArtistId’]<br/>                artists.append(artist)<br/>                break<br/>        if len(artists) == 0:<br/>            abort(404)<br/>        return jsonify(artists)</span><span id="980d" class="kq kr hi km b fi kx kt l ku kv">    return jsonify(artists_dict)</span></pre><p id="bdeb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我们导入该资源所需的所有包和模块。然后，我们通过使用Python中一个名为<a class="ae iu" href="https://wiki.python.org/moin/PythonDecorators" rel="noopener ugc nofollow" target="_blank"> Decorators </a>的概念来创建资源本身，Flask使用这个概念来定义路由。</p><ul class=""><li id="b066" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated"><strong class="ix hj">注意</strong>:路线的定义是基于选择，但我们应该始终确保我们定义了清晰的路线。</li></ul><p id="2118" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">装饰者向现有对象添加新功能，而不修改其结构。因此，装饰器下定义的函数是一个视图函数，它包含为响应发送给应用程序的请求而编写的代码。该函数查询两个表，返回字典列表。每个字典代表一个列名和每行上的值的键值对。接下来，我们在每个<strong class="ix hj">艺术家</strong>字典中创建一个新的关键字<strong class="ix hj"> AlbumTitle </strong>，其值是映射到该艺术家的专辑列表。然后，我们创建一个过滤器，可以从使用<strong class="ix hj"> ArtistId </strong>或<strong class="ix hj">名称</strong>进行过滤的查询参数中获得。最后，我们检查了一些条件，以确保发送到服务器的请求是有效的(符合REST的统一接口特征)。对于无效请求，已经映射了要返回的正确错误。如果是一个有效的请求，它要么返回所有艺术家，要么返回一个艺术家(如果有查询参数的话)。</p><p id="08db" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> errors.py </strong></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="3c30" class="kq kr hi km b fi ks kt l ku kv">from flask import jsonify, abort, make_response<br/>from art_alb import app</span><span id="1622" class="kq kr hi km b fi kx kt l ku kv">@app.errorhandler(404)<br/>def not_found(error):<br/>    return make_response(jsonify({‘error’: ‘Not Found’}), 404)</span><span id="1b7a" class="kq kr hi km b fi kx kt l ku kv">@app.errorhandler(400)<br/>def not_found(error):<br/>    return make_response(jsonify({‘error’: ‘Bad Request’}), 400)</span><span id="fb9f" class="kq kr hi km b fi kx kt l ku kv">@app.errorhandler(500)<br/>def internal_Server_error(error):<br/>    return make_response(jsonify({‘error’: ‘Internal Server Error’}), 500)</span></pre><p id="ec96" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意，这里的装饰者与资源的装饰者不同，它们是<strong class="ix hj">错误处理程序</strong>。也就是说，我们可以编写当应用程序在特定的<strong class="ix hj"> HTTP状态代码</strong>上失败时要实现的逻辑。在这个应用程序中，我们正在处理的错误的<strong class="ix hj"> HTTP状态代码</strong>是<strong class="ix hj"> 400 </strong>、<strong class="ix hj"> 404 </strong>和<strong class="ix hj"> 500 </strong>。这些错误处理程序中的逻辑只是确保错误以JSON格式(而不是HTML)返回，从而遵守REST原则的统一接口特征。</p><ul class=""><li id="14ee" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated"><strong class="ix hj">注:</strong>我们从GitHub克隆或者下载的时候可以查看剩下的文件(但这里不会查看内容)。但是我们将运行它们，以查看它们在上面的高级视图中定义的功能。</li></ul><p id="fd27" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们的网络服务运行起来</p><p id="dd56" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将使用<a class="ae iu" href="https://curl.haxx.se/" rel="noopener ugc nofollow" target="_blank"> curl </a>(而不是web浏览器)来测试我们的web服务，因为web浏览器无法轻松生成所有类型的HTTP请求。</p><ul class=""><li id="0be2" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated"><strong class="ix hj">注</strong> : <a class="ae iu" href="https://curl.haxx.se/" rel="noopener ugc nofollow" target="_blank"> curl </a>用于命令行或脚本中传输数据。如果没有，现在安装<a class="ae iu" href="https://curl.haxx.se/" rel="noopener ugc nofollow" target="_blank">卷曲</a>。通过运行以下命令启动web服务(从控制台窗口):</li></ul><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="fad7" class="kq kr hi km b fi ks kt l ku kv">(myenv) C:\Users\aobisesan\Desktop\web api&gt;python api.py</span></pre><p id="0a94" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后打开一个新的终端并运行以下命令:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="3f83" class="kq kr hi km b fi ks kt l ku kv">$ curl -i http://localhost:5000/api/v1/chinook/artistsalbums</span></pre><p id="34d3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因为我们的数据大约有275行，所以返回的数据在控制台窗口上看起来可能很笨拙。所以，让我们在任何浏览器中打开<a class="ae iu" href="https://jsonformatter.curiousconcept.com/" rel="noopener ugc nofollow" target="_blank"> JSON格式化器&amp;验证器</a>。接下来，我们从控制台窗口和浏览器的网页上复制返回的数据，将复制的数据粘贴到JSON Data/URL文本框中，最后单击process按钮。处理后的数据显示在格式化的JSON数据文本框中。因为我们有大约275行数据，所以不能在一个视图中捕获所有的输出。因此，我截取了顶部和底部的截图，显示在下面，让我们看看它是什么样子的:</p><p id="74a3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ky">前两个(艺人ID 1和2) </em></p><figure class="kh ki kj kk fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/75bcfeba1e2a683233e53434a32b7884.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*r9nUQ3gtsUYO7-_DXr-80w.png"/></div></figure><p id="9ead" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ky">最后两个(艺人ID 274和375) </em></p><figure class="kh ki kj kk fd ij er es paragraph-image"><div class="er es ld"><img src="../Images/b68e3c59696f33c0694c012934380822.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*JL1EIUEvfJ_15995kQk1Yw.png"/></div></figure><p id="90ca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以上对应于我们使用DataFrame查看的数据。接下来，让我们通过运行以下命令使用<strong class="ix hj"> ArtistId </strong>进行过滤:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="c92e" class="kq kr hi km b fi ks kt l ku kv">$ curl -i <a class="ae iu" href="http://localhost:5000/api/v1/chinook/artistsalbums?ArtistId=275" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/api/v1/chinook/artistsalbums?ArtistId=27</a>5</span></pre><p id="c05c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ky">输出</em></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="3ba2" class="kq kr hi km b fi ks kt l ku kv">% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br/>Dload  Upload   Total   Spent    Left  Speed<br/>100   118  100   118    0     0    517      0 --:--:-- --:--:-- --:--:--   515HTTP/1.0 200 OK<br/>Content-Type: application/json<br/>Content-Length: 118<br/>Server: Werkzeug/0.16.0 Python/3.7.3<br/>Date: Sun, 27 Oct 2019 01:49:38 GMT</span><span id="11fd" class="kq kr hi km b fi kx kt l ku kv">[{"AlbumTitle":["Koyaanisqatsi (Soundtrack from the Motion Picture)"],"ArtistId":275,"Name":"Philip Glass Ensemble"}]</span></pre><p id="cd60" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该命令成功地为我们获取了具有<strong class="ix hj"> ArtistId </strong>的<strong class="ix hj"> 275 </strong>的艺术家。接下来，让我们使用名称进行查询，并确认资源是否如预期的那样工作，让我们在最后的结果中使用艺术家的名称(菲利普·格拉斯合奏)进行查询。为此，让我们运行以下命令。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="594c" class="kq kr hi km b fi ks kt l ku kv">$ curl -i http://localhost:5000/api/v1/chinook/artistsalbums?Name=Philip%20Glass%20Ensemble</span></pre><p id="4b3c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ky">输出</em></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="b043" class="kq kr hi km b fi ks kt l ku kv">% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br/>Dload  Upload   Total   Spent    Left  Speed<br/>100   118  100   118    0     0    519      0 --:--:-- --:--:-- --:--:--   517HTTP/1.0 200 OK<br/>Content-Type: application/json<br/>Content-Length: 118<br/>Server: Werkzeug/0.16.0 Python/3.7.3<br/>Date: Sun, 27 Oct 2019 01:57:54 GMT</span><span id="4005" class="kq kr hi km b fi kx kt l ku kv">[{"AlbumTitle":["Koyaanisqatsi (Soundtrack from the Motion Picture)"],"ArtistId":275,"Name":"Philip Glass Ensemble"}]</span></pre><p id="6c88" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">注意:</strong>我们添加了<strong class="ix hj"> %20 </strong>来编码名称之间的空格，因为URL之间不应该有空格。我们也可以用<strong class="ix hj"> + </strong>来代替<strong class="ix hj"> %20 </strong>。</p><p id="dc41" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">返回值和上面的一样。</p><p id="1ce8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，让我们使用一个在我们的数据库中不存在的<strong class="ix hj"> ArtistId </strong>来查询一个艺术家，看看会发生什么。因此，让我们运行以下命令:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="bd99" class="kq kr hi km b fi ks kt l ku kv">$ curl -i http://localhost:5000/api/v1/chinook/artistsalbums?ArtistId=1000</span></pre><p id="84af" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ky">输出</em></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="1a14" class="kq kr hi km b fi ks kt l ku kv">% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br/>Dload  Upload   Total   Spent    Left  Speed<br/>100    22  100    22    0     0     97      0 --:--:-- --:--:-- --:--:--    96HTTP/1.0 404 NOT FOUND<br/>Content-Type: application/json<br/>Content-Length: 22<br/>Server: Werkzeug/0.16.0 Python/3.7.3<br/>Date: Sun, 27 Oct 2019 02:02:11 GMT</span><span id="173a" class="kq kr hi km b fi kx kt l ku kv">{"error":"Not Found"}</span></pre><p id="0822" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">不出所料，<strong class="ix hj">未找到</strong>是返回值，因为<strong class="ix hj"> ArtistId </strong>不存在。我们可以继续利用这一资源(如果我们愿意的话)。转到包含资源的<strong class="ix hj"> artists.py </strong>，该资源使我们能够在<strong class="ix hj"> artists </strong>表中插入新艺术家并更新现有艺术家。从POST方法开始，让我们将两位新艺术家插入到数据库中。首先，<strong class="ix hj"> J科尔</strong>接下来，<strong class="ix hj">奈拉马利</strong>。为此，让我们运行以下命令:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="b00d" class="kq kr hi km b fi ks kt l ku kv">$ curl -i -H "Content-Type: application/json" -X POST -d '{"Name": "J Cole"}' <a class="ae iu" href="http://localhost:5000/api/v1/chinook/artist" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/api/v1/chinook/artis</a>t</span></pre><p id="b428" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi">— — — — — — — — — — — — — — — — — — — — — — — — — —</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="64e1" class="kq kr hi km b fi ks kt l ku kv">$ curl -i -H "Content-Type: application/json" -X POST -d '{"Name": "Naira Marley"}' http://localhost:5000/api/v1/chinook/artist</span></pre><p id="cfcc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这两个命令都以JSON格式返回我们的<strong class="ix hj"> artists </strong>表中的全部内容(以及新内容)。然而，由于我们的数据库中有大约275行，并且为了可见性，我们也可以像以前一样使用<a class="ae iu" href="https://jsonformatter.curiousconcept.com/" rel="noopener ugc nofollow" target="_blank"> JSON格式化程序&amp;验证程序</a>进行检查。但是，让我们运行以下命令来查询我们的数据库，以确认这两个新艺术家已经被添加:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="0b02" class="kq kr hi km b fi ks kt l ku kv">$ curl -i http://localhost:5000/api/v1/chinook/artistsalbums?Name=J%20Cole</span></pre><p id="fa06" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ky">输出</em></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="3e77" class="kq kr hi km b fi ks kt l ku kv">% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br/>Dload  Upload   Total   Spent    Left  Speed<br/>100    51  100    51    0     0    225      0 --:--:-- --:--:-- --:--:--   225HTTP/1.0 200 OK<br/>Content-Type: application/json<br/>Content-Length: 51<br/>Server: Werkzeug/0.16.0 Python/3.7.3<br/>Date: Sun, 27 Oct 2019 02:25:52 GMT</span><span id="284a" class="kq kr hi km b fi kx kt l ku kv">[{"AlbumTitle":[],"ArtistId":276,"Name":"J Cole"}]</span></pre><p id="6b29" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi">— — — — — — — — — — — — — — — — — — — — — — — — — —</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="8850" class="kq kr hi km b fi ks kt l ku kv">$ curl -i http://localhost:5000/api/v1/chinook/artistsalbums?Name=Naira+Marley</span></pre><p id="c683" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ky">输出</em></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="e5ea" class="kq kr hi km b fi ks kt l ku kv">% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br/>Dload  Upload   Total   Spent    Left  Speed<br/>100    57  100    57    0     0    262      0 --:--:-- --:--:-- --:--:--   263HTTP/1.0 200 OK<br/>Content-Type: application/json<br/>Content-Length: 57<br/>Server: Werkzeug/0.16.0 Python/3.7.3<br/>Date: Sun, 27 Oct 2019 02:26:13 GMT</span><span id="6040" class="kq kr hi km b fi kx kt l ku kv">[{"AlbumTitle":[],"ArtistId":277,"Name":"Naira Marley"}]</span></pre><p id="90d6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如输出所示，找到了两位艺术家。接下来，让我们通过实现PUT方法来更新我们的<strong class="ix hj">艺术家</strong>数据库。所以，我们来换一下，<strong class="ix hj"> J科尔</strong>到<strong class="ix hj">坎耶西</strong>和<strong class="ix hj">奈拉马利</strong>到<strong class="ix hj">兹拉坦</strong>。这将有助于我们展示我们可以使用<strong class="ix hj"> ArtistId </strong>或<strong class="ix hj">名称</strong>或两者(这意味着<strong class="ix hj"> ArtistId </strong>必须与<strong class="ix hj">名称</strong>匹配)来确定要更新的行。为此，请运行以下命令:</p><p id="c18d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">注:</strong>奈拉马利的<strong class="ix hj">艺人Id </strong>为<strong class="ix hj"> 277 </strong>。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="796a" class="kq kr hi km b fi ks kt l ku kv">$ curl -i -H "Content-Type: application/json" -X PUT -d '{"Name": "J Cole", “new_name”: “Kanye West”}' http://localhost:5000/api/v1/chinook/artist</span></pre><p id="970b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi">— — — — — — — — — — — — — — — — — — — — — — — — — —</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="8ae6" class="kq kr hi km b fi ks kt l ku kv">$ curl -i -H "Content-Type: application/json" -X PUT -d '{"ArtistId": 277, "new_name": "Zlatan"}' http://localhost:5000/api/v1/chinook/artist</span></pre><p id="e98d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这两个命令都以JSON格式返回我们的<strong class="ix hj">艺术家</strong>数据库中的全部内容。为了确认我们的更新已经发生，让我们查询<strong class="ix hj"> Kanye West </strong>和<strong class="ix hj"> Zlatan </strong>。为此，请运行以下命令:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="cc20" class="kq kr hi km b fi ks kt l ku kv">$ curl -i http://localhost:5000/api/v1/chinook/artistsalbums?Name=Kanye+West</span></pre><p id="7551" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ky">输出</em></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="b799" class="kq kr hi km b fi ks kt l ku kv">% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br/>Dload  Upload   Total   Spent    Left  Speed<br/>100    55  100    55    0     0    254      0 --:--:-- --:--:-- --:--:--   254HTTP/1.0 200 OK<br/>Content-Type: application/json<br/>Content-Length: 55<br/>Server: Werkzeug/0.16.0 Python/3.7.3<br/>Date: Sun, 27 Oct 2019 02:37:25 GMT</span><span id="da1e" class="kq kr hi km b fi kx kt l ku kv">[{"AlbumTitle":[],"ArtistId":276,"Name":"Kanye West"}]</span></pre><p id="62fa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi">— — — — — — — — — — — — — — — — — — — — — — — — — —</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="7fb7" class="kq kr hi km b fi ks kt l ku kv">$ curl -i http://localhost:5000/api/v1/chinook/artistsalbums?Name=Zlatan</span></pre><p id="1e9c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ky">输出</em></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="aa2e" class="kq kr hi km b fi ks kt l ku kv">% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br/>Dload  Upload   Total   Spent    Left  Speed<br/>100    51  100    51    0     0    225      0 --:--:-- --:--:-- --:--:--   226HTTP/1.0 200 OK<br/>Content-Type: application/json<br/>Content-Length: 51<br/>Server: Werkzeug/0.16.0 Python/3.7.3<br/>Date: Sun, 27 Oct 2019 02:37:56 GMT</span><span id="59e9" class="kq kr hi km b fi kx kt l ku kv">[{"AlbumTitle":[],"ArtistId":277,"Name":"Zlatan"}]</span></pre><p id="fbc3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">输出显示<strong class="ix hj"> Kanye West </strong>和<strong class="ix hj"> Zlatan </strong>现在存在于我们的数据库中，他们还没有任何专辑映射到他们。我们再确认一下<strong class="ix hj"> J科尔</strong>和<strong class="ix hj">奈拉马利</strong>不存在了。为此，让我们运行以下命令来查询它们:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="fb91" class="kq kr hi km b fi ks kt l ku kv">$ curl -i http://localhost:5000/api/v1/chinook/artistsalbums?Name=J+Cole</span></pre><p id="a5f4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ky">输出</em></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="2433" class="kq kr hi km b fi ks kt l ku kv">% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br/>Dload  Upload   Total   Spent    Left  Speed<br/>100    22  100    22    0     0    101      0 --:--:-- --:--:-- --:--:--   101HTTP/1.0 404 NOT FOUND<br/>Content-Type: application/json<br/>Content-Length: 22<br/>Server: Werkzeug/0.16.0 Python/3.7.3<br/>Date: Sun, 27 Oct 2019 02:39:38 GMT</span><span id="500a" class="kq kr hi km b fi kx kt l ku kv">{"error":"Not Found"}</span></pre><p id="d138" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi">— — — — — — — — — — — — — — — — — — — — — — — — —</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="ed7c" class="kq kr hi km b fi ks kt l ku kv">$ curl -i http://localhost:5000/api/v1/chinook/artistsalbums?Name=Naira+Marley</span></pre><p id="ceb2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ky">输出</em></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="d514" class="kq kr hi km b fi ks kt l ku kv">% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br/>Dload  Upload   Total   Spent    Left  Speed<br/>100    22  100    22    0     0    101      0 --:--:-- --:--:-- --:--:--   101HTTP/1.0 404 NOT FOUND<br/>Content-Type: application/json<br/>Content-Length: 22<br/>Server: Werkzeug/0.16.0 Python/3.7.3<br/>Date: Sun, 27 Oct 2019 02:40:25 GMT</span><span id="2ef4" class="kq kr hi km b fi kx kt l ku kv">{"error":"Not Found"}</span></pre><p id="6008" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">输出显示<strong class="ix hj">未找到</strong>意味着它们不像预期的那样再次存在。同样，让我们确认当我们尝试更新我们的数据库并且客户端发送的请求包含<strong class="ix hj"> ArtistId </strong>和<strong class="ix hj"> Name </strong>(它们不匹配)时会发生什么。使用<strong class="ix hj"> Zlatan </strong>作为用例，<strong class="ix hj"> Zlatan </strong>有一个<strong class="ix hj"> ArtistId </strong>的<strong class="ix hj"> 277 </strong>。因此，我们将在请求中使用<strong class="ix hj"> 266 </strong>的一个<strong class="ix hj"> ArtistId </strong>。因此，让我们尝试将<strong class="ix hj"> Zlatan </strong>改为<strong class="ix hj"> Kcee </strong>。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="f1f6" class="kq kr hi km b fi ks kt l ku kv">$ curl -i -H "Content-Type: application/json" -X PUT -d '{"ArtistId": 276, "Name": "Zlatan",  "new_name": "Kcee"}' http://localhost:5000/api/v1/chinook/artist</span></pre><p id="d47b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ky">输出</em></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="2646" class="kq kr hi km b fi ks kt l ku kv">% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br/>Dload  Upload   Total   Spent    Left  Speed<br/>100    82  100    24  100    58    108    262 --:--:-- --:--:-- --:--:--   371HTTP/1.0 400 BAD REQUEST<br/>Content-Type: application/json<br/>Content-Length: 24<br/>Server: Werkzeug/0.16.0 Python/3.7.3<br/>Date: Sun, 27 Oct 2019 02:47:10 GMT</span><span id="1130" class="kq kr hi km b fi kx kt l ku kv">{"error":"Bad Request"}</span></pre><p id="7ede" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">是的，<strong class="ix hj"> Kcee </strong>是一个<strong class="ix hj">错误请求</strong>，因为<strong class="ix hj"> ArtistId </strong>和<strong class="ix hj">名称</strong>不匹配，我希望这是有意义的，因为<strong class="ix hj"> ArtistId </strong>对于我们的<strong class="ix hj">艺术家</strong>表中的每个艺术家都是唯一的。我们可以用这个资源做更多的尝试，但是为了节省时间，让我们转到<strong class="ix hj"> albums.py </strong>。这与<strong class="ix hj"> artists.py </strong>非常相似，因此我们不会在这方面纠缠不清，我只是展示一下，一旦我们创建了一个相册，它就会自动映射到我们的艺术家。接下来，<strong class="ix hj">兹拉坦</strong>将被分配一个标题为<strong class="ix hj"> Jogor </strong>的专辑(因为我们知道<strong class="ix hj">兹拉坦</strong>有一个<strong class="ix hj"> 277 </strong>的<strong class="ix hj"> ArtistId </strong>，而<strong class="ix hj"> ArtistId </strong>是创建专辑所需的一部分)。因此，让我们运行下面的命令:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="735c" class="kq kr hi km b fi ks kt l ku kv">$ curl -i -H "Content-Type: application/json" -X POST -d '{"Title": "Jogor", "ArtistId": "277"}' http://localhost:5000/api/v1/chinook/album</span></pre><p id="bfc1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这会以JSON格式返回相册数据库的内容(包含新相册)。此外，应该运行下面的命令来显示这个相册实际上已经被映射到了<strong class="ix hj"> Zlatan </strong>。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="3d9a" class="kq kr hi km b fi ks kt l ku kv">$ curl -i http://localhost:5000/api/v1/chinook/artistsalbums?Name=Zlatan</span></pre><p id="ab1c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ky">输出</em></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="aea3" class="kq kr hi km b fi ks kt l ku kv">% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br/>Dload  Upload   Total   Spent    Left  Speed<br/>100    58  100    58    0     0    255      0 --:--:-- --:--:-- --:--:--   255HTTP/1.0 200 OK<br/>Content-Type: application/json<br/>Content-Length: 58<br/>Server: Werkzeug/0.16.0 Python/3.7.3<br/>Date: Sun, 27 Oct 2019 03:01:19 GMT</span><span id="2cd0" class="kq kr hi km b fi kx kt l ku kv">[{"AlbumTitle":["Jogor"],"ArtistId":277,"Name":"Zlatan"}]</span></pre><p id="8889" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">太好了，</strong>映射已经正确完成。</p><p id="0df9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">相信我，该资源提供了比我展示的更多的功能，所以如果我们自己尝试更多的东西会更好。这就把我们带到了终点。</p><p id="3fae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢您的阅读。但在离开之前，我对项目如何扩展有一些想法(如果感兴趣)。</p><p id="ef47" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">扩展项目的想法</strong></p><ul class=""><li id="c81e" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">为资源实现<strong class="ix hj"> DELETE </strong>方法。</li><li id="94f8" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">通过向服务器发送每个请求的<strong class="ix hj">认证</strong>来保护web服务。</li><li id="2994" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">当我们向<strong class="ix hj"> albums.py、</strong>中的资源发送请求时，我们可以使用艺术家的<strong class="ix hj">路径(URL) </strong>，而不是返回数据中的<strong class="ix hj"> ArtistId </strong>。</li><li id="359a" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">从数据库添加更多表格。</li></ul></div></div>    
</body>
</html>