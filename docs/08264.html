<html>
<head>
<title>Using YOLOv4 on NVIDIA DeepStream 5.0</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在NVIDIA DeepStream 5.0上使用YOLOv4</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/using-yolov4-on-nvidia-deepstream-5-0-89d8c1e6fd1d?source=collection_archive---------2-----------------------#2020-07-23">https://medium.com/analytics-vidhya/using-yolov4-on-nvidia-deepstream-5-0-89d8c1e6fd1d?source=collection_archive---------2-----------------------#2020-07-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/67b73afe09808fb82ee56a750d5a4da7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3_lOlbY2LYIYo91a1Pyc2g.jpeg"/></div></div></figure><p id="c2d4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本文将指导您在NVIDIA DeepStream 5.0上安装和使用Yolo-v4。如果你是NVIDIA DeepStream 5.0的新手，请关注我之前的文章<a class="ae jo" rel="noopener" href="/analytics-vidhya/getting-started-with-nvidia-deepstream-5-0-8a05d061c4ee"> <strong class="is hj">链接</strong> </a> <strong class="is hj">。</strong></p><p id="6e0b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我想你已经知道YOLOv4了。它声称拥有最先进的精度，同时保持高处理帧率。它在Tesla V100上以大约65 FPS的推理速度对MS COCO实现了43.5% AP (65.7% AP₅₀)的准确度。你可以在这个<a class="ae jo" href="https://github.com/AlexeyAB/darknet/" rel="noopener ugc nofollow" target="_blank">链接</a>上找到关于YOLOv4的更多信息。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jp"><img src="../Images/d16585c62dd0c58398f9b9755c831fc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YCNaiWBMdm-c7cQYi65zUQ.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated"><a class="ae jo" href="https://github.com/AlexeyAB/darknet" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="ea80" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在介绍已经结束，让我们直接进入安装。</p><h2 id="d96e" class="jy jz hi bd ka kb kc kd ke kf kg kh ki jb kj kk kl jf km kn ko jj kp kq kr ks bi translated">先决条件</h2><ul class=""><li id="697f" class="kt ku hi is b it kv ix kw jb kx jf ky jj kz jn la lb lc ld bi translated"><em class="le">硬件平台(Jetson或GPU) </em></li><li id="11fc" class="kt ku hi is b it lf ix lg jb lh jf li jj lj jn la lb lc ld bi translated"><em class="le">深流5.0版</em></li><li id="e975" class="kt ku hi is b it lf ix lg jb lh jf li jj lj jn la lb lc ld bi translated"><em class="le">腾索特版7.0.0.11</em></li><li id="cb1e" class="kt ku hi is b it lf ix lg jb lh jf li jj lj jn la lb lc ld bi translated"><em class="le"> NVIDIA GPU驱动版本(仅对GPU有效)440.33.01 </em></li><li id="4b64" class="kt ku hi is b it lf ix lg jb lh jf li jj lj jn la lb lc ld bi translated"><em class="le"> OS Ubuntu 18.04 </em></li><li id="a988" class="kt ku hi is b it lf ix lg jb lh jf li jj lj jn la lb lc ld bi translated"><em class="le"> CUDA 10.2 </em></li><li id="1941" class="kt ku hi is b it lf ix lg jb lh jf li jj lj jn la lb lc ld bi translated"><em class="le"> Pytorch 1.4.0 </em></li></ul><p id="9b60" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">目前DeepStream 5.0不支持YOLOv4。但是他们给出了使用YOLOv4的步骤。感谢NVIDIA官方和社区。</p><p id="edaf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="le"> Pytorch或DarkNet→ONNX→tensort→deep stream</em></strong></p><h2 id="e3a3" class="jy jz hi bd ka kb kc kd ke kf kg kh ki jb kj kk kl jf km kn ko jj kp kq kr ks bi translated">暗网到ONNX</h2><pre class="jq jr js jt fd lk ll lm ln aw lo bi"><span id="fe96" class="jy jz hi ll b fi lp lq l lr ls">git clone <a class="ae jo" href="https://github.com/Tianxiaomo/pytorch-YOLOv4.git" rel="noopener ugc nofollow" target="_blank">https://github.com/Tianxiaomo/pytorch-YOLOv4.git</a><br/>cd pytorch-YOLOv4<br/>pip install onnxruntime<br/></span></pre><p id="5397" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在此  <strong class="is hj">下载预训练的YOLOv4权重和cfg文件<a class="ae jo" href="https://github.com/AlexeyAB/darknet#pre-trained-models" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">。</strong>如果你想把Pytorch转换成ONNX，按照</a><a class="ae jo" href="https://github.com/Tianxiaomo/pytorch-YOLOv4" rel="noopener ugc nofollow" target="_blank">库</a>中的步骤操作。</strong></p><pre class="jq jr js jt fd lk ll lm ln aw lo bi"><span id="4698" class="jy jz hi ll b fi lp lq l lr ls">python demo_darknet2onnx.py yolov4.cfg yolov4.weights ./data/giraffe.jpg 1</span></pre><h2 id="f3ef" class="jy jz hi bd ka kb kc kd ke kf kg kh ki jb kj kk kl jf km kn ko jj kp kq kr ks bi translated">ONNX到TensorRT</h2><p id="b1d2" class="pw-post-body-paragraph iq ir hi is b it kv iv iw ix kw iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">在运行以下命令之前，请更改您的配置的参数。</p><pre class="jq jr js jt fd lk ll lm ln aw lo bi"><span id="7e56" class="jy jz hi ll b fi lp lq l lr ls">trtexec --onnx=&lt;onnx_file&gt; --explicitBatch --saveEngine=&lt;tensorRT_engine_file&gt; --workspace=&lt;size_in_megabytes&gt; --fp16</span></pre><p id="f088" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">示例:</p><pre class="jq jr js jt fd lk ll lm ln aw lo bi"><span id="a415" class="jy jz hi ll b fi lp lq l lr ls">trtexec --onnx=yolov4_1_3_608_608.onnx --explicitBatch --saveEngine=yolov4_1_3_608_608_fp16.engine --workspace=4096 --fp16</span></pre><p id="ee37" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您得到trtexec命令没有发现问题。尝试给出明确的路径<em class="le">/usr/src/tensorrt/bin/trtexec</em></p><h2 id="d7fb" class="jy jz hi bd ka kb kc kd ke kf kg kh ki jb kj kk kl jf km kn ko jj kp kq kr ks bi translated">重建</h2><ul class=""><li id="ae87" class="kt ku hi is b it kv ix kw jb kx jf ky jj kz jn la lb lc ld bi translated">将以下C++函数添加到<code class="du lw lx ly ll b"><strong class="is hj">objectDetector_Yolo/nvdsinfer_custom_impl_Yolo/nvdsparsebbox_Yolo.cpp</strong></code>中，并重新构建<code class="du lw lx ly ll b"><strong class="is hj">libnvdsinfer_custom_impl_Yolo.so</strong></code></li></ul><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="lz ma l"/></div></figure><pre class="jq jr js jt fd lk ll lm ln aw lo bi"><span id="58ad" class="jy jz hi ll b fi lp lq l lr ls">cd /opt/nvidia/deepstream/deepstream-5.0/sources/objectDetector_Yolo/nvdsinfer_custom_impl_Yolo</span><span id="592f" class="jy jz hi ll b fi mb lq l lr ls">make clean<br/>make</span></pre><p id="c02e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下是YOLOv4配置文件，供您参考</p><ul class=""><li id="93d9" class="kt ku hi is b it iu ix iy jb mc jf md jj me jn la lb lc ld bi translated">config _ infer _ primary _ yolov 4 . txt</li><li id="16d4" class="kt ku hi is b it lf ix lg jb lh jf li jj lj jn la lb lc ld bi translated">deepstream _ app _ config _ yolov 4 . txt</li></ul><div class="mf mg ez fb mh mi"><a href="https://github.com/karthickai/YOLOV4_DeepStream_5.0" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab dw"><div class="mk ab ml cl cj mm"><h2 class="bd hj fi z dy mn ea eb mo ed ef hh bi translated">karthickai/yolov 4 _ deep stream _ 5.0</h2><div class="mp l"><h3 class="bd b fi z dy mn ea eb mo ed ef dx translated">NVIDIA DeepStream 5.0中的yolov 4(DarkNet或py torch-&gt; ONNX-&gt; TensorRT-&gt; DeepStream)GitHub是超过50…</h3></div><div class="mq l"><p class="bd b fp z dy mn ea eb mo ed ef dx translated">github.com</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw io mi"/></div></div></a></div><h2 id="cc92" class="jy jz hi bd ka kb kc kd ke kf kg kh ki jb kj kk kl jf km kn ko jj kp kq kr ks bi translated">运行应用程序</h2><pre class="jq jr js jt fd lk ll lm ln aw lo bi"><span id="3fad" class="jy jz hi ll b fi lp lq l lr ls">deepstream-app -c ./deepstream_app_config_yoloV4.txt</span></pre><h2 id="8863" class="jy jz hi bd ka kb kc kd ke kf kg kh ki jb kj kk kl jf km kn ko jj kp kq kr ks bi translated">输出</h2><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es mx"><img src="../Images/214d9e5f0633f4fd7757bb2ce3cc1414.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*EztBGan62Ft1qSqdBAK_Sg.gif"/></div></figure><h2 id="b92b" class="jy jz hi bd ka kb kc kd ke kf kg kh ki jb kj kk kl jf km kn ko jj kp kq kr ks bi translated">参考</h2><p id="cfdb" class="pw-post-body-paragraph iq ir hi is b it kv iv iw ix kw iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">[1]<a class="ae jo" href="https://github.com/AlexeyAB/darknet" rel="noopener ugc nofollow" target="_blank">https://github.com/AlexeyAB/darknet</a></p><p id="392f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">[2]<a class="ae jo" href="https://github.com/Tianxiaomo/pytorch-YOLOv4.git" rel="noopener ugc nofollow" target="_blank">https://github.com/Tianxiaomo/pytorch-YOLOv4</a></p><p id="7540" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢阅读。</p><p id="c0ca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你有任何建议/问题，请在评论区告诉我们！</p></div></div>    
</body>
</html>