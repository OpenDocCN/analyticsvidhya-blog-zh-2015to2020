<html>
<head>
<title>How to Plot a Map in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Python绘制地图</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-plot-a-map-in-python-d78f17c0b4a4?source=collection_archive---------4-----------------------#2019-12-17">https://medium.com/analytics-vidhya/how-to-plot-a-map-in-python-d78f17c0b4a4?source=collection_archive---------4-----------------------#2019-12-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="093e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">使用Geopandas和Geoplot</h1><p id="1469" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在我以前的工作中，我必须经常制作地图。从来没有一种特别简单的方法可以做到这一点，所以我决定测试一下我的Python技能来创建一个地图。一路上我遇到了不少的减速带，但最终还是制作出了我想要的地图。我相信随着更多的练习，用Python绘图会变得非常容易。我最初偶然发现Geopandas和Geoplot用于制图，我在这里使用它们，但是还有其他Python库可以生成更好的地图，比如follow。</p><h1 id="9335" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated"><strong class="ak">决定映射什么</strong></h1><p id="7d91" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">首先，你必须决定你想要绘制什么样的地图，以及这些信息在哪个地理层次上。我对将数据科学应用于环境问题和可持续发展很感兴趣，所以我决定看看美国国家海洋和大气管理局(NOAA)的一些县级数据。我特意选择查看每个县每月的最高温度。</p><p id="f924" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">其次，你需要收集你的数据。从<a class="ae kg" href="https://www.ncdc.noaa.gov/monitoring-references/maps/us-climate-divisions.php#grdd" rel="noopener ugc nofollow" target="_blank"> NOAA气候部门数据网站</a>，我可以通过点击“nClimDiv”数据集链接来获取我需要的数据。将这些数据解压到一个本地文件夹后，我就可以继续了。</p><p id="93d0" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">第三，您需要收集适当的Shapefile来绘制数据。如果你不知道什么是Shapefile，<a class="ae kg" href="http://desktop.arcgis.com/en/arcmap/10.3/manage-data/shapefiles/what-is-a-shapefile.htm" rel="noopener ugc nofollow" target="_blank">这个链接</a>将有助于解释他们的目的。我能够从<a class="ae kg" href="https://catalog.data.gov/dataset/tiger-line-shapefile-2017-nation-u-s-current-county-and-equivalent-national-shapefile" rel="noopener ugc nofollow" target="_blank">美国人口普查老虎/线形状文件数据库</a>中检索出美国县级形状文件。下载适当的数据集，并将其存储在与要绘制的数据相同的本地文件夹中。</p><h1 id="11f2" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated"><strong class="ak">地图准备工作</strong></h1><p id="7802" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hj">形状文件</strong></p><p id="65a4" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">如上所述，我使用了python库Geopandas和Geoplot。此外，我发现我还需要安装笛卡尔库。为了安装这些库，我必须从我的终端运行以下bash命令:</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="a83a" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">现在，您将能够像导入任何其他python库一样导入这些库(例如，“import pandas as pd”)。要加载Shapefile，您可以使用以下Geopandas (gpd)方法:</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="f18f" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">数据文件</p><p id="4ab2" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">为了加载县一级的数据，我还有几个问题要解决。该文件来自NOAA的固定宽度文件格式。有关固定宽度文件格式的更多信息，请查看以下<a class="ae kg" href="http://www.softinterface.com/Convert-XLS/Features/Fixed-Width-Text-File-Definition.htm" rel="noopener ugc nofollow" target="_blank">网站</a>。我按照以下步骤将数据转换成可行的格式:</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="da8d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">此外，还涉及到相当多的数据清理，但我将给您一个简短的概述。我想过滤Shapefile，使其仅包含美国本土，因此我需要过滤出以下州代码:</p><ul class=""><li id="a5cb" class="ko kp hi jf b jg kb jk kc jo kq js kr jw ks ka kt ku kv kw bi translated">02:阿拉斯加</li><li id="a315" class="ko kp hi jf b jg kx jk ky jo kz js la jw lb ka kt ku kv kw bi translated">15:夏威夷</li><li id="e6b9" class="ko kp hi jf b jg kx jk ky jo kz js la jw lb ka kt ku kv kw bi translated">60:美属萨摩亚</li><li id="0bfe" class="ko kp hi jf b jg kx jk ky jo kz js la jw lb ka kt ku kv kw bi translated">66:关岛</li><li id="5575" class="ko kp hi jf b jg kx jk ky jo kz js la jw lb ka kt ku kv kw bi translated">69:马里亚纳群岛</li><li id="19f8" class="ko kp hi jf b jg kx jk ky jo kz js la jw lb ka kt ku kv kw bi translated">72:波多黎各</li><li id="9b9e" class="ko kp hi jf b jg kx jk ky jo kz js la jw lb ka kt ku kv kw bi translated">78:维尔京群岛</li></ul><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="7ff9" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">让我们先来看看Shapefile:</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lc"><img src="../Images/4f4bd0b5d446971420a094be090013b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xMIjfGaiUmAgfbyg"/></div></div></figure><p id="088b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">你可以看到美国所有相邻的县。</p><p id="c6b9" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">合并Shapefile和数据集</p><p id="9b8d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">Shapefile和数据集需要有一个共同的列，以便匹配要映射的数据。我决定用<a class="ae kg" href="https://www.nrcs.usda.gov/wps/portal/nrcs/detail/national/home/?cid=nrcs143_013697" rel="noopener ugc nofollow" target="_blank"> FIPS代码</a>来匹配。要在Shapefile中创建FIPS代码:</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="1b08" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在县数据中创建FIPS代码(注意:为了简单起见，我只过滤了2018年的数据):</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="c3e2" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">最后，要合并Shapefile和Dataset:</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="d53a" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">最后，我们将数据映射到Shapefile。我使用geoplot.choropleth方法来绘制最高温度数据。红色越深，某个县的最高温度就越高。该地图是为2018年8月创建的。</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lc"><img src="../Images/330e0e575d7e335fd326db65daf98ad5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Bo0_oZaTLESPRC2s"/></div></div></figure><p id="de05" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">你可以看到我们能够在美国的县地图上绘制数据！希望这个演示有帮助！</p><p id="b930" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">不幸的是，你可以看到有丢失的数据。此外，我可以生成一个图例，但它会显示为地图本身大小的两倍，所以我决定删除它。</p></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><p id="e075" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">【http://github.com】最初发表于<a class="ae kg" href="https://gist.github.com/6d44cea0036a54e26e1de09a0064c512" rel="noopener ugc nofollow" target="_blank"><em class="lq"/></a><em class="lq">。</em></p></div></div>    
</body>
</html>