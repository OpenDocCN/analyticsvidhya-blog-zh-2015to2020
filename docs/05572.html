<html>
<head>
<title>Outliers in data and ways to detect them.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据中的异常值及其检测方法。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/outliers-in-data-and-ways-to-detect-them-1c3a5f2c6b1e?source=collection_archive---------0-----------------------#2020-04-26">https://medium.com/analytics-vidhya/outliers-in-data-and-ways-to-detect-them-1c3a5f2c6b1e?source=collection_archive---------0-----------------------#2020-04-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6a01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">什么是离群值？</strong></p><p id="6637" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">说白了，离群值可以被称为一系列数据中的异类。异常值可能与我们样本中存在的大多数数据点不同寻常且极其不同。它可能是非常大的观察值，也可能是非常小的观察值。由于异常值的极端性质，在计算数据的统计时，异常值可能会产生有偏差的结果，从而影响进一步的统计/ML模型。</p><p id="ac39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检测和处理异常值是数据清理最重要的阶段之一。</p><p id="e53b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，让我们考虑下表中的这些值。由于这个表非常小，看一眼它就能让我们知道10000是一个异常值。然而，在现实生活中，要处理的数据将非常大，在真实场景中一眼就能发现异常值并不是一件容易的事情。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/8eb4c4ac3f449f0ba6ea0f7b761dfbf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:322/format:webp/1*d6Xlx8T_UHt-dT2AZUF4RA.png"/></div></figure><p id="f032" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述观察值的平均值为1307，高于表中的大多数值。我们都知道平均值是算术平均值，通常代表数据的中心。在这里，1307远不是整个数据的中心。罪魁祸首是一个极端的观测值10000。因此，10000可以被定义为异常值，它扭曲了数据的实际结构。</p><p id="49ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">离群值可以是单变量也可以是多变量</strong>。</p><p id="629f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">单变量异常值</strong>通常指变量上的极值点。例如:上述示例中的10000。</p><p id="ed38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将重点了解几种检测单变量异常值的方法。</p><p id="3057" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">多元异常值</strong>通常是两个或更多变量的异常数据点的组合。散点图主要用于多变量设置，表明响应变量与一个或多个预测变量之间的关系。有时，异常值可能落在响应变量(x轴)和预测变量(y轴)的预期范围内，但仍可能是异常值，因为它不符合模型，即它不符合模型的回归线。与单变量异常值相反，多变量不一定是极端数据点。</p><p id="9320" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">既然我们现在知道什么是异常值，我们将通过各种方法来识别它们。</strong></p><p id="23ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.检测异常值的最简单方法是绘制特征或数据点。可视化是推断整体数据和异常值的最好和最简单的方法之一。散点图和箱线图是检测异常值的最佳可视化工具。</p><p id="09aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">散点图</strong>-散点图可用于明确检测数据集或特定要素何时包含异常值。</p><p id="2650" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下图中，我使用了一个名为“房价预测”的数据集作为例子。数据集的来源是Kaggle。</p><p id="63a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从图中可以清楚地看到，因变量“销售价格”更多地集中在0–55000(约为特征地块面积)的范围内，超过150000的点显然是异常值，因为这些点会导致与数据整体结构不相称的统计数据。</p><p id="4a06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们可以为我们怀疑可能包含异常值的数据集的所有要素绘制散点图。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jl"><img src="../Images/88b32c22eba191e34c283c1432057cd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LLbk6YEi1UqKX_S2c7X8xA.png"/></div></div></figure><p id="7ac8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">箱线图:</strong>箱线图是另一个非常简单的可视化工具，它使用四分位数间距(IQR)技术的概念来检测异常值。</p><p id="ad61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下图中，少数异常值用红圈突出显示。</p><p id="e29e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我们绘制了基于年份的销售价格与批量配置的关系。</p><p id="8b43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图中的异常值示例:“corner LotConfig”在2007年有一个Saleprice大于700000的异常值。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jq"><img src="../Images/f472b9925b56373ddaa2d3c4bca0f40a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YJU_-Uyv8VEmdxHdUQfgDA.png"/></div></div></figure><p id="5aad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">直方图</strong>也可以用来识别异常值。然而，在直方图中，离群值的存在可以通过孤立的条来检测。</p><p id="e671" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们以最初的八个数为例，我们可以清楚地看到异常值10000远离孤立的右柱，其余七个数据点一起朝向左柱。</p><p id="256b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">直方图通常用于单变量设置，在这种设置中，我们绘制单个变量(在我们的例子中为数字)的数据分布图，并识别数据分布之外的异常值(10000 ),如下所示。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jr"><img src="../Images/a31ead74986878055a3446b325eb57f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xHwyLeDm00G5dFrNrxZtaQ.png"/></div></div></figure><p id="f7d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2&gt; <strong class="ih hj">四分位距(IQR)技术:</strong>该方法可以通过计算边界来找出作为异常值的数据点的最大值和最小值。</p><p id="d4aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">IQR位于数据集的中间，是第一个四分位数和第三个四分位数之间的值，可计算如下:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es js"><img src="../Images/61c865e58296dc3cb7e4e14888863e8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*POlPLSEAURkzrWleDsoH2A.png"/></div></figure><p id="1fac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们都知道什么是中位数，它可以被称为数据集频率分布的中点或观察值的中点。</p><p id="a5b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据集的下半部分是所有低于中值的值的集合。数据集的上半部分是当数据以降序排序时高于中值的所有值的集合。</p><p id="6d34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由Q1表示的第一个四分位数是数据集下半部分的中位数。也称为第25百分位，它表示数据集中约25%的值低于Q1，约75%的值高于Q1。</p><p id="6506" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">类似地，用Q3表示的第三个四分位数是数据集上半部分的中值。也称为第75百分位，它表示数据集中约75%的数字位于Q3以下，约25%位于Q3以上。</p><p id="6f0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用箱线图可以很容易地看到这一点:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jt"><img src="../Images/f8e324a1b40f6f455ff357dc26007653.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tox2ydDKC1xsEw2psVmCgg.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">箱线图:Q1-第一个四分位数，Q3-第三个四分位数</figcaption></figure><p id="a26b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将在下面的步骤中讨论如何使用python计算相应的四分位数。</p><p id="40dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Python中，我们可以使用以下步骤来实现IQR，并最终检测异常值:</p><p id="cdd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">现在假设，我想找出数据集“df”中的变量Y是否有异常值。</strong></p><p id="bab1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们导入重要的python库，如pandas、numPy、sklearn、scipy等。</p><p id="4f74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤2: </strong>导入具有以下值的数据集‘df ’:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jr"><img src="../Images/20ccf67bb0f26199cd50a2adf2d7b74c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t1oQPC1vPAeY6BEIF2E9hw.png"/></div></div></figure><p id="25d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第三步:<em class="jy">计算变量y的第一个和第三个四分位数</em> </strong></p><p id="4397" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一个四分位数= <strong class="ih hj"> Q1_Y = df['Y']。分位数(0.25) </strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jz"><img src="../Images/e64eac1c04ca078b71847a0a8efb0f90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*Hm8YcEpI9StkgbT7J-FwGw.png"/></div></figure><p id="95d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤4 <em class="jy">:计算四分位距(IQR): </em> </strong></p><p id="1c49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> IQR_Y = Q3_Y — Q_Y </strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ka"><img src="../Images/ed35c3fb3e35f9e65ac1659634b1bef4.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*8uCrUtjYplDfinmqLaDU3Q.png"/></div></figure><p id="aa57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第5步:</strong>下面的代码将给出在“Y”变量上有异常值的记录。</p><p id="4474" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">df[NP . logical _ or(df[' Y ']&lt;(Q1 _ Y—1.5 * IQR _ Y)，df[' Y ']&gt;(Q3 _ Y+1.5 * IQR _ Y))]</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es kb"><img src="../Images/7cfc994de16410fbcc31d0a15a99d44e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dmfUijl8i9gCS4kcvXRvPQ.png"/></div></div></figure><p id="7d7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"># Q1 _ Y-1.5 * IQR _ Y = 700-(1.5 * 798)= 700–1197 =-497-这是检测具有最小值的异常值的下限。</p><p id="1e3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"># Q3 _ Y+1.5 * IQR _ Y = 1498+(1.5 * 798)= 1498+1197 = 2695-这是检测具有最大值的异常值的上限。</p><p id="f815" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">正如我们在上面的截图中看到的，下面的方框图也显示了这一点:</strong></p><p id="2f2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下限-497以下，我们有两个最小值异常值-599和-978。</p><p id="3ee0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并且我们在上边界2695上方有三个最大值异常值20000、34000和55000。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jt"><img src="../Images/4fcf8aa0baf803c930de171b6678e0b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x7Pbv0CaefKX4KUMV1fJtw.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">检测数据集“df”异常值的箱线图</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es kc"><img src="../Images/909c62846364ab44ea9b6d90f9b2a16e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NQIlInFPSIVlZ-_SEHDecA.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">使用直方图将其可视化。孤立条表示我们的数据集“df”包含异常值。</figcaption></figure><p id="7b9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，如果没有检测到分别低于和高于下限和上限的这些异常值，可能会对总体数据的统计推断给出不成比例的结果，从而损害预测模型的准确性。</p><p id="6bb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jy">然而，有许多方法可以处理异常值，其中之一是数据封顶，其中低于下限的异常值可以用第一个四分位数— Q1值代替，高于上限的异常值可以用第三个四分位数— Q3值代替。</em></p><p id="519e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有多种统计测试可以用来检测异常值，其中之一就是假设检验。</p><p id="b712" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设检验通常用于从进行检验的随机样本中得出关于整个总体的结论。</p><p id="b42d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设检验围绕以下两个关于总体的互斥陈述，以确定哪个陈述最能得到样本数据的支持:</p><p id="0635" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">零假设。例如，变量没有异常值。</p><p id="dc1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">o替代假设。例如，变量有异常值。</p><p id="5c1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的三个统计测试使用假设检验的概念来识别异常值。</p><p id="6adf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">格拉布斯试验</p><p id="1ecc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">卡方检验。</p><p id="536f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">o <strong class="ih hj">迪克森的Q测试。</strong></p><p id="c9ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Grubbs检验和Dixon的Q检验中，假设我们将要发现异常值的数据是正态分布的。</p><p id="151f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">鉴于卡方检验可用于卡方分布。</p><p id="e2d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Dixon的Q检验通常应用于包含很少观察值的数据集或样本，因此很少用于数据科学。</p><p id="64b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以上三种测试都使用以下无效假设和替代假设来检测异常值<strong class="ih hj">。</strong></p><p id="a4de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">H0:没有异常值。</p><p id="1997" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">H1:至少有一个例外。</p><p id="c136" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">异常值检测根据P值和显著性水平得出结论。</p><p id="130c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">显著性水平为0.05，如果p值</p></div></div>    
</body>
</html>