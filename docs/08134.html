<html>
<head>
<title>Testing a Difference in Population Proportions in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Python中测试人口比例的差异</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/testing-a-difference-in-population-proportions-in-python-89d57a06254?source=collection_archive---------2-----------------------#2020-07-19">https://medium.com/analytics-vidhya/testing-a-difference-in-population-proportions-in-python-89d57a06254?source=collection_archive---------2-----------------------#2020-07-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d1d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://en.wikipedia.org/wiki/Statistical_hypothesis_testing" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">统计检验</strong> </a>两组人口比例是否有显著差异。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/0b5ca6ac483b05cf4cccd146fa75f422.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YlJPlMTo2nbmDYsT"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">由<a class="ae jd" href="https://unsplash.com/@smirik?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">叶夫根尼·斯米尔诺夫</a>在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="97a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们得到了检验假设的数据。这里考虑的数据是著名的<a class="ae jd" href="https://www.kaggle.com/c/titanic/data" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Titanic数据集</strong> </a>，可以在<a class="ae jd" href="https://www.kaggle.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Kaggle </strong> </a> <strong class="ih hj">上找到。</strong></p><p id="f021" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导入库:</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="0d95" class="jz ka hi jv b fi kb kc l kd ke">import numpy as np<br/>import pandas as pd<br/>import scipy.stats.distributions as dist</span></pre><p id="4e81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">感兴趣的参数</strong></p><p id="918f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们读取数据，并从数据集中只选择两个相关的列。列<strong class="ih hj">‘幸存’</strong>(1如果个体在泰坦尼克号灾难中幸存，否则为0)和变量<strong class="ih hj">‘性别’</strong>(表示个体的性别)。我们将感兴趣的参数设置为基于性别的泰坦尼克号灾难幸存者的比例差异。感兴趣的参数的公式为:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kf"><img src="../Images/37f0c5e9abb9bad43f0d283fa287c5cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eSXqFFiXQgQOaG6gRPcROQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated"><strong class="bd kg">感兴趣的参数</strong></figcaption></figure><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="b876" class="jz ka hi jv b fi kb kc l kd ke">data = pd.read_csv('train.csv')<br/>data['Survived'] = data['Survived'].map({1:'Survived',0:'Not Survived'}) #Encode the values<br/>data = data.dropna() #Drop the nan values</span><span id="9728" class="jz ka hi jv b fi kh kc l kd ke">contingency_table = pd.crosstab(data.Survived,data.Sex) #Contingency Table<br/>contingency_table</span></pre><p id="5059" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ki"><img src="../Images/f513243b31fb03e0639006e51215afbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*HvH3_RDdAE5GYQX3GIXwNA.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">数据的列联表</figcaption></figure><p id="32d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上表称为<a class="ae jd" href="https://en.wikipedia.org/wiki/Contingency_table" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">列联表</strong> </a>，为我们提供了每个类别的计数的交叉表视图。让我们将上述数字转换成比例，以便有个概念！</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="3b4c" class="jz ka hi jv b fi kb kc l kd ke">pd.crosstab(data.Survived,data.Sex).apply(lambda r:r/r.sum(),axis=0)</span></pre><p id="c702" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kj"><img src="../Images/07f62e97df62d46e691d9df8cebd10a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*13aAmugaAyhm3xwAyHlSug.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">列联表(比例)</figcaption></figure><p id="8b51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以很好地判断(非正式地)幸存的女性和幸存的男性的比例有显著的差异。让我们用统计数据证明这一点！</p><p id="5450" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">假设</strong></p><p id="5e22" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们测试的假设是上述比例差是否为零或不等于零<strong class="ih hj">(需要进行一个</strong> <a class="ae jd" href="https://www.khanacademy.org/math/statistics-probability/significance-tests-one-sample/more-significance-testing-videos/v/one-tailed-and-two-tailed-tests" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">双尾</strong> </a> <strong class="ih hj">测试)</strong>。数学上，我们将其表示为:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kk"><img src="../Images/45e0277d855bf2b577652aa5e7c5cf25.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*isX80R6ZkHkvLEBxn_lbDQ.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated"><strong class="bd kg">假设(空与备选项)</strong></figcaption></figure><p id="d81a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">设置</strong> <a class="ae jd" href="https://en.wikipedia.org/wiki/Statistical_significance" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">显著性等级</strong> </a></p><p id="ed67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们预设显著性水平为<strong class="ih hj"> 0.10 </strong>(双尾检验的标准)</p><p id="7388" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">假设</strong></p><ol class=""><li id="eb2e" class="kl km hi ih b ii ij im in iq kn iu ko iy kp jc kq kr ks kt bi translated">独立随机样本假设。</li><li id="e9ba" class="kl km hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated">样本的最佳大小(确保相对于总比例，每类至少有10个数据点)</li></ol><p id="d88c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们必须确保样本量足够大，即每个类别中至少有10名幸存者和10名伤员<strong class="ih hj"> </strong>。从数学角度来说，</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kf"><img src="../Images/727955ee2ea7e2c0f52e8fd20dede964.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f0CKlz9hH_SMF_-PCFwQSw.png"/></div></div></figure><p id="8a55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它的对应代码:</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="5196" class="jz ka hi jv b fi kb kc l kd ke">total_proportion_survived = (data.Survived == "Survived").mean()</span><span id="5b07" class="jz ka hi jv b fi kh kc l kd ke">num_female = data[data.Sex=="female"].shape[0]<br/>num_male = data[data.Sex=="male"].shape[0]</span><span id="36b7" class="jz ka hi jv b fi kh kc l kd ke">assert num_female*total_proportion_survived&gt;10, "Assumptions not met"<br/>assert num_male*total_proportion_survived&gt;10, "Assumptions not met"<br/>assert num_female*(1-total_proportion_survived)&gt;10, "Assumptions not met"<br/>assert num_male*(1-total_proportion_survived)&gt;10, "Assumptions not met"</span></pre><p id="0ef6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://www.khanacademy.org/math/ap-statistics/two-sample-inference/two-sample-z-interval-proportions/v/confidence-intervals-for-the-difference-between-two-proportions" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">人口比例标准误差</strong> </a></p><p id="b391" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总体差异的样本标准误差为(代码如下):</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kz"><img src="../Images/f962cd38ae323892306c1a11bee5cc95.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*empoB8NA6OFK9gQNcIwYSA.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">人口比例差异的标准误差。</figcaption></figure><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="f894" class="jz ka hi jv b fi kb kc l kd ke">#This table helps us to calculate the SE.<br/>prop = data.groupby("Sex")["Survived"].agg([lambda z: np.mean(z=="Survived"), "size"])<br/>prop.columns = ['proportions_survived','total_counts']<br/>prop.head()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es la"><img src="../Images/e59ddb262af2d7b0cec102748ee995ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*IUM3KBTGvnjBvtBca4zREA.png"/></div></figure><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="a709" class="jz ka hi jv b fi kb kc l kd ke">#Calculating standard error<br/> <br/>variance = total_proportion_survived * (1 - total_proportion_survived)<br/>standard_error = np.sqrt(variance * (1 / prop.total_counts.female + 1 / prop.total_counts.male))<br/>print("Sample Standard Error",standard_error)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lb"><img src="../Images/bf661064c0a73bb458eb8e5100ae7141.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*QfICOfkQszalhJsvFWA3gw.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">计算样本标准误差</figcaption></figure><p id="3d23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">获取</strong> <a class="ae jd" href="https://en.wikipedia.org/wiki/Test_statistic" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">检验统计</strong> </a></p><p id="f43d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们检查了<strong class="ih hj">假设</strong>成立之后，就该计算这个假设检验的检验统计量了。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lc"><img src="../Images/145ad6e93830dc6baa89f138405ccff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hUyq5hxCGjiTJJa9FfNBAg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">检验统计量</figcaption></figure><p id="160e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">假设估计值是0 </strong>(零假设)，我们有幸存的男性和女性的比例来得到最佳估计值(差值)。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="12f2" class="jz ka hi jv b fi kb kc l kd ke"># Calculate the test statistic <br/>best_estimate = (prop.proportions_survived.female - prop.proportions_survived.male)<br/>print("The best estimate is",best_estimate)<br/>hypothesized_estimate = 0<br/>test_stat = (best_estimate-hypothesized_estimate) / standard_error<br/>print("Computed Test Statistic is",test_stat)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ld"><img src="../Images/6cc6f7617506eecd6fadea5aa66a38bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*WdYl8UE0jTBFsljy-EO90w.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">最佳估计和测试统计计算</figcaption></figure><p id="8674" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这意味着我们的样本比例差异估计值比我们的假设估计值高出<strong class="ih hj"> ~16.2个标准误差</strong>！</p><p id="305b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们需要将其转换为p值，并根据显著性水平(由我们设定)测试我们的假设。</p><p id="abf2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://www.khanacademy.org/math/statistics-probability/significance-tests-one-sample/idea-of-significance-tests/v/p-values-and-significance-tests?modal=1" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> P值计算</strong> </a></p><p id="4626" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们得到基于标准正态分布(零均值和单位标准差)计算的p值，通常称为<a class="ae jd" href="https://www.khanacademy.org/math/statistics-probability/significance-tests-one-sample/more-significance-testing-videos/v/z-statistics-vs-t-statistics" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> z检验</strong> </a>。我们从<strong class="ih hj">和</strong>两个分布的尾部得到p值(取决于替代假设)。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="c783" class="jz ka hi jv b fi kb kc l kd ke"># Calculate the  p-value<br/>pvalue = 2*dist.norm.cdf(-np.abs(test_stat)) # Multiplied by two indicates a two tailed testing.<br/>print("Computed P-value is", pvalue)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es le"><img src="../Images/8e5a0a228636bb82e1eb5183174b1d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*I8Vo1ppIPW9Kw8CGaTF7rA.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">标准正态分布的p值</figcaption></figure><p id="aa78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">推论</strong></p><p id="1935" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以清楚地看到，p值远小于0.10的显著性水平。因此，我们可以安全地拒绝零假设，支持替代假设。<strong class="ih hj">我们推断幸存雌性和幸存雄性的比例差异很大，当然不等于零</strong>(雌性可能更容易接近救生艇)<strong class="ih hj">。</strong></p><p id="a902" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考文献</strong></p><ol class=""><li id="d69c" class="kl km hi ih b ii ij im in iq kn iu ko iy kp jc kq kr ks kt bi translated"><a class="ae jd" href="https://www.khanacademy.org/math/statistics-probability/significance-tests-confidence-intervals-two-samples" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">汗学院比例假设检验</strong> </a></li><li id="b985" class="kl km hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated"><a class="ae jd" href="https://en.wikipedia.org/wiki/Statistical_hypothesis_testing" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">统计假设检验Wiki </strong> </a></li></ol><p id="9770" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.<a class="ae jd" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.norm.html" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">z检验的P值计算(Python) </strong> </a></p></div></div>    
</body>
</html>