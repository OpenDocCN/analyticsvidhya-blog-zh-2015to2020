<html>
<head>
<title>Inject — Dependency injection library for Swift with support for Singletons</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">inject—Swift的依赖注入库，支持单例</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/inject-dependency-injection-library-for-swift-with-support-for-singletons-492a78022144?source=collection_archive---------27-----------------------#2020-05-23">https://medium.com/analytics-vidhya/inject-dependency-injection-library-for-swift-with-support-for-singletons-492a78022144?source=collection_archive---------27-----------------------#2020-05-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/5e2987622cb3fcf465c2610ab6126e97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UZMWmEeJOC8nakVu1UQIyA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Swift的“注入”示例</figcaption></figure><p id="7a11" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">大家好，受到最近一篇</strong> <a class="ae js" href="https://link.medium.com/ZT3o3zkPD6" rel="noopener"> <strong class="iw hj">文章</strong> </a> <strong class="iw hj">的启发，我在ASP.NET上做了一些关于依赖注入的练习，不过我想创建一个小库来缓解Swift(包括iOS、macOS等)的依赖注入。</strong></p><h1 id="4b9d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">这个想法</h1><p id="2a61" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">首先，这是一个如何在C#上的<strong class="iw hj">ASP.NET</strong>内核上实现的示例:</p><div class="kw kx ky kz fd ab cb"><figure class="la ij lb lc ld le lf paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/1b99c33ddde7c10e54e4e741f4fcfac2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*0iEW8fx1P0FmRD2u_Co3_Q.png"/></div></figure><figure class="la ij lg lc ld le lf paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/5309c827aeb6c74a93eed17bc57d87ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*HdqiXon1RH6OuwGp950NgQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx lh di li lj translated">ASP上的依赖注入。网</figcaption></figure></div><p id="59fb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">很简单，对吧？你只需添加你想要注入的类型，然后创建一个接受该类型的构造函数，你就拥有了它。</p><p id="32b9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有一些方法和选项可以做到这一点，包括添加单件，但这是想法。</p><h1 id="4206" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">在Swift-Inject上实施</h1><p id="c1ae" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">如前所述，要在Swift上实施，首先要存储您的依赖关系。我在内部使用了一个字典，其中的键是一个类型，值是一个函数，用来构建想要的值。这都是在“依赖解析器”中完成的；我们需要首先在应用程序中实例化该类型的静态值:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/1f9eca692eeee84a853aea44835a0eff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vb7DekZtz8PPDlaRWbrY1A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">依赖注入解析器</figcaption></figure><p id="cf86" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">那么你的应用程序需要做的第一件事就是添加依赖关系。在这种情况下，我们使用一个协议和一个实现该协议的值:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/5eb23c6e56f6d9ed45325963247e2491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SEuxitY-ZxT2wGURYD1qEQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">添加依赖项—注入</figcaption></figure><p id="3e39" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这就是我们如何在代码中注入依赖关系。首先，您需要向它传递一个依赖解析器，这样它就可以在内部查找如何构建所需的类型。</p><p id="b044" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要使用注入值，您只需像使用任何其他属性一样使用该属性，您还可以更改它的值，以便它使用一个特定的值来代替注入值。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/2d082e4ebbc9f5b922714814b58f5149.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y_JnoFqeoixplXe87j1STg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">注入init以及如何使用它</figcaption></figure><p id="624c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在实践中，您可能想避免一直传递解析器，所以您可以在本地创建这个扩展:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/14698553d077cd07604489272eb829f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tnmZvXSI0gYRzAcPjFqhTw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">用于注入的有用扩展</figcaption></figure><h1 id="28b2" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用</h1><p id="f77e" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">这是一个使用注入值的类的完整示例。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/8c2a9414003aea1f8466b59e138ad640.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5bFUIh2tCS4VlCbcAI_Fcg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">注射用法的完整示例</figcaption></figure><p id="4d18" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是使用Inject的推荐方式。您创建自己的属性，然后创建一个接受可选依赖项的构造函数，最后将它赋给自己的属性。通过这样做，如果您传递nil，它将使用注入的值，但是如果您传递一个有效值，它将使用该值。</p><p id="6840" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">正如你已经看到的，这个库也支持<strong class="iw hj">单例</strong>，用法是一样的，但是内部行为有点不同，对于单例，我们保存了一个惰性变量，它的值将在你的应用中使用。</p><h1 id="a407" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">更大的</h1><p id="d5ed" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated"><strong class="iw hj">您现在可以通过导入swift包来使用这个库:</strong><a class="ae js" href="https://github.com/illescasDaniel/Inject-Swift.git" rel="noopener ugc nofollow" target="_blank"><strong class="iw hj">https://github.com/illescasDaniel/Inject-Swift.git</strong></a></p><p id="980c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了获得更多信息和示例，我创建了一个示例项目:</p><div class="lt lu ez fb lv lw"><a href="https://github.com/illescasDaniel/Inject-Swift-example" rel="noopener  ugc nofollow" target="_blank"><div class="lx ab dw"><div class="ly ab lz cl cj ma"><h2 class="bd hj fi z dy mb ea eb mc ed ef hh bi translated">illes cas Daniel/Inject-Swift-example</h2><div class="md l"><h3 class="bd b fi z dy mb ea eb mc ed ef dx translated">注入Swift示例。通过在GitHub上创建一个帐户，为illescasDaniel/Inject-Swift-example开发做出贡献。</h3></div><div class="me l"><p class="bd b fp z dy mb ea eb mc ed ef dx translated">github.com</p></div></div><div class="mf l"><div class="mg l mh mi mj mf mk io lw"/></div></div></a></div><p id="8ae0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是官方的注入回购:</p><div class="lt lu ez fb lv lw"><a href="https://github.com/illescasDaniel/Inject-Swift" rel="noopener  ugc nofollow" target="_blank"><div class="lx ab dw"><div class="ly ab lz cl cj ma"><h2 class="bd hj fi z dy mb ea eb mc ed ef hh bi translated">illescasDaniel/Inject-Swift</h2><div class="md l"><h3 class="bd b fi z dy mb ea eb mc ed ef dx translated">swift的简单依赖注入，兼容结构和类。定义您的协议定义一个类(或…</h3></div><div class="me l"><p class="bd b fp z dy mb ea eb mc ed ef dx translated">github.com</p></div></div><div class="mf l"><div class="ml l mh mi mj mf mk io lw"/></div></div></a></div><p id="5ed5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">感谢阅读这篇文章！</p></div></div>    
</body>
</html>