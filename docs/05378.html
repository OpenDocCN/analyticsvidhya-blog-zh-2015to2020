<html>
<head>
<title>How to Build an Automated Data Pipeline for free using AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用AWS免费构建自动化数据管道</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-build-an-automated-data-pipeline-for-free-using-aws-8976350f006b?source=collection_archive---------14-----------------------#2020-04-19">https://medium.com/analytics-vidhya/how-to-build-an-automated-data-pipeline-for-free-using-aws-8976350f006b?source=collection_archive---------14-----------------------#2020-04-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3e77d6299dd7f5530ec681ee47107983.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pDcQpVMDvPuZ7lsY"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">昆腾·德格拉夫在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="d74d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">数据管道只不过是数据从一个系统流向另一个系统。作为一名数据工程师，我们经常需要构建或维护传统上称为ETL管道的数据管道。</p><p id="e923" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我将展示ETL过程，以及如何使用AWS无服务器服务(如Lambda)和存储服务(如S3)来实现自动化。</p><p id="ae91" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我是一个初学者，想利用这次全球疫情期间在家的时间从头开始创建一个数据管道。</p><p id="d89c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将使用来自外部API的Covid19数据集(您需要有API主机和密钥)</p><p id="1864" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://covid-19-coronavirus-statistics.p.rapidapi.com/v1/stats" rel="noopener ugc nofollow" target="_blank">T5】https://新冠肺炎-冠状病毒-statistics . p . rapidapi . com/v1/stats</a></p><p id="93d9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由于数据很少，AWS中的大多数服务都是免费的。本文的主要目的是通过调用一个外部API来提取数据，将原始的JSON响应存储到一个S3桶中，并将提炼后的数据转换和存储到S3中。我们还将安排流水线，使其完全自动化。</p><p id="ff05" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">注意</strong>:我们需要一个<strong class="ix hj"> AWS </strong>账户(需要一张信用卡)和一点python知识。</p><p id="8167" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在弄脏我们的手之前，让我们看看我们的架构。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jt"><img src="../Images/1f44b923748a1cb97e32de58dcc89d5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OritoX-mlbb5PUjqqUw0Zg.png"/></div></div></figure><p id="6b4d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是我们的数据管道，它使用AWS Lambda Python函数从API提取数据，并将其存储到S3原始文件夹中。然后，我们使用另一个Lambda函数从原始文件夹中读取信息，并将其转换为更有组织性的CSV格式，然后存储到S3 rfnd文件夹中。然后，我们利用AWS Quicksight快速创建一个可视化仪表板。</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><p id="a76a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">创建Lambda函数的步骤:</strong></p><p id="ecce" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">转到AWS控制台，键入AWS Lambda。点击<strong class="ix hj">创建功能</strong></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kf"><img src="../Images/da2da5bf21475f85c62f502b329b4749.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EAMXy0_PcfQLK5fJ"/></div></div></figure><p id="f1e6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以从头开始选择一项功能，或者使用现有蓝图，或者从无服务器应用存储库中浏览。我们将从头开始创建一个函数。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kg"><img src="../Images/e9114a0780747a48a39a441789895663.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hvFaqTNnkU0RuyW_"/></div></div></figure><p id="24f3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因为我们正在创建一个python函数，所以我们将选择python3.6作为环境。给一个函数名。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kh"><img src="../Images/a84fc4bf6c63af4c991a430ae833fb3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aZsrKaR7Egw2DZg1"/></div></div></figure><p id="3a91" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">说到角色，我们可以创建一个具有基本lambda权限的新角色，它创建所有日志并上传到Amazon CloudWatch日志。我们还可以创建新的自定义角色或从现有角色中选择。对于这个项目，我们将创建一个具有基本lambda权限和s3读写权限的新角色，因为我们的lambda函数将在s3中读写对象。<em class="ki">(花了大约4-5个小时才发现我们需要s3权限来访问我们的s3存储桶:p) </em></p><p id="4d14" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，如果您无法从lambda function创建角色，请转到IAM，创建一个具有<a class="ae iu" href="https://console.aws.amazon.com/iam/home?#/policies/arn%3Aaws%3Aiam%3A%3Aaws%3Apolicy%2Fservice-role%2FAWSLambdaBasicExecutionRole" rel="noopener ugc nofollow" target="_blank">awslambdabasiceexecutionrole</a>和<a class="ae iu" href="https://console.aws.amazon.com/iam/home?#/policies/arn%3Aaws%3Aiam%3A%3Aaws%3Apolicy%2FAmazonS3FullAccess" rel="noopener ugc nofollow" target="_blank"> AmazonS3FullAccess </a>权限的新角色。</p><p id="3fa8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，从选项中选择“使用现有角色”并选择您刚刚创建的角色。</p><p id="59bd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建一个函数后，你可以内联编辑代码或者压缩整个包并上传到这里。因为我们使用python中的requests模块来发送HTTP请求，所以我们将使用“pip install requests -t”下载文件夹中的“requests”模块。我们所有的包和lambda函数必须在我们的根文件夹中，所以复制所有的内容并粘贴到我们的根文件夹中，然后删除那个文件夹。</p><p id="9bf5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">新的文件夹结构如下所示。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kj"><img src="../Images/9da7bdca7203d4dde836affc705a2423.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PBhr9U1Fxp9_PWP7ZFKBXQ.jpeg"/></div></div></figure><p id="ce42" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在粘贴你的python代码，它将HTTP请求发送到lambda_function.py中的外部API。</p><p id="0e8f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过点击“<strong class="ix hj">选择一个测试事件</strong>和“<strong class="ix hj">配置测试事件</strong>，创建一个测试功能。可以只给“test”:“test”JSON。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kk"><img src="../Images/fa9bd0ae639d4905c5fcc56c1eabeb90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-3xCnaLD4w-H7lfL"/></div></div></figure><p id="f606" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">注:</strong></p><ul class=""><li id="ef46" class="kl km hi ix b iy iz jc jd jg kn jk ko jo kp js kq kr ks kt bi translated">上传zip文件夹时最常见的错误是代码有缩进问题。您可以重新键入所有内容，或者再次使用制表符来更正缩进。</li><li id="1431" class="kl km hi ix b iy ku jc kv jg kw jk kx jo ky js kq kr ks kt bi translated">每次你修改代码时，确保通过ctrl+s保存你的代码，同时保存你的lambda函数。</li></ul><p id="1534" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果一切正常，您可以看到200响应，您的响应JSON将存储在s3 bucket raw文件夹中。</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><p id="6b1b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">创建另一个Lambda函数以转换并存储为CSV: </strong></p><p id="ba0d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">按照上述步骤创建另一个Lambda函数，该函数以CSV格式读取数据并将其存储到rfnd文件夹中。完成这项工作的代码如下。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><p id="0eda" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">使用AWS CloudWatch事件和Lambda触发器实现管道自动化。</strong></p><p id="7753" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，如果希望lambda函数定期执行，可以使用AWS CloudWatch事件来调度cron作业。单击触发器并选择AWS CloudWatch事件。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/54c81725d320137d6ecfd139d8cab22d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IqIeSuPjjxVtN6e-"/></div></div></figure><p id="d568" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建新规则。给出规则名称和规则描述。选择计划表达式作为规则类型</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/475fe753f497210f6488720054c87307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bI0wEb02Zz88Jjs8"/></div></div></figure><p id="cbd7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我安排我的lambda在每天下午07:00运行"<strong class="ix hj"> cron(0 19 1/1 *？*) </strong>”。您可以使用<a class="ae iu" href="http://www.cronmaker.com/?1" rel="noopener ugc nofollow" target="_blank"> Cron Maker </a>来生成您的表达式并添加触发器。</p><p id="34fa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下一部分是每当这个lambda函数执行并将原始信息存储到raw文件夹时，我希望我的第二个lambda函数触发。</p><p id="1f05" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">添加触发器并选择S3服务，并提供存储桶信息以及前缀和后缀参数。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ld"><img src="../Images/147d52709c707b4d3f6efe118358e533.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vbM1qUVGGUz654WT"/></div></div></figure></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><p id="7952" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">使用AWS Quicksight进行可视化:</strong></p><p id="e7e6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您的rfnd文件夹中已经有了CSV文件，是时候使用Quicksight可视化数据了。转到Quicksight并单击new analysis。添加新数据集。选择您的数据源，在本例中是s3。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es le"><img src="../Images/cf7133e303e2b7941ecb9425dce33a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KDxBA6Ho3OQeLVJc"/></div></div></figure><p id="c12d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">输入数据源的名称，并上传包含S3存储桶位置和文件格式信息的清单文件。</p><p id="cdec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">选择地理空间视觉类型，并将城市的地理空间字段和确认(总和)作为您的大小。</p><p id="d034" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最终的可视化看起来像这样</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lf"><img src="../Images/efa3b74bfa5a79ed9e1dd6ae9b3d656f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IYyIOuNC-2_4rSoL"/></div></div></figure><p id="01ac" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> <em class="ki">恭喜</em> </strong>，您已经使用AWS免费层免费创建了自己的自动化数据管道。</p><blockquote class="lg lh li"><p id="3b46" class="iv iw ki ix b iy iz ja jb jc jd je jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">我知道你可能会很高兴与你的朋友分享你的想象，但不幸的是，<strong class="ix hj"> <em class="hi"> Quicksight </em> </strong>不会让你这么做。Quicksight没有任何免费层，因此不要共享或添加任何人到此控制面板，因为Quicksight定价模式是基于“每个用户”的</p></blockquote><p id="3028" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">注</strong>:</p><p id="a627" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是我第一次使用AWS和无服务器模型从头开始创建数据管道。在这方面我学到了很多东西。请让我知道你对这个或任何其他更好的方法的想法。</p></div></div>    
</body>
</html>