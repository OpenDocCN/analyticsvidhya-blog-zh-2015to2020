<html>
<head>
<title>How feature engineering trumps algorithms</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">特征工程如何胜过算法</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-feature-engineering-trumps-algorithms-ef9eae6d95be?source=collection_archive---------12-----------------------#2020-03-14">https://medium.com/analytics-vidhya/how-feature-engineering-trumps-algorithms-ef9eae6d95be?source=collection_archive---------12-----------------------#2020-03-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b2d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">我将在这里实际证明，无论选择何种用于预测的ML/DL算法，特征工程如果做得正确，都可以获得更好的准确性</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/2955dbe31f94e2cb7d05abd40b288b44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NtgPxwwxGn5Xu4e56owK7Q.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">决策树。<a class="ae ju" href="https://www.tidio.com/blog/flowchart-and-decision-tree-examples/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><h1 id="044f" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">数据集描述和方法</strong></h1><p id="e837" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">我将使用一栋商业建筑的用电数据，其中包含一栋建筑从2017年4月到2018年4月的数据。该建筑包含3个仪表(主仪表和2个副仪表)。因此，每个算法有3个目标。此外，我们将使用特殊类型的RMSE度量来评估每个算法的结果。</p><blockquote class="ky kz la"><p id="c428" class="if ig jd ih b ii ij ik il im in io ip lb ir is it lc iv iw ix ld iz ja jb jc hb bi translated">在这篇文章中，我将尝试展示不同的功能集与3种不同的算法(如XGBoost、LightGBM和GRU)在这个数据集上的表现。</p></blockquote><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="3ed3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装必要的库后，我们将加载训练集(2017年4月-12月)和测试集(2018年1月-4月)。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="le lf l"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">加载数据集，并绘制2017年4月1日一整天的数据</figcaption></figure><p id="62fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以从上面的图中看到，数据不是静态的，所有3米的使用都有突然的峰值和下降。因此，我选择使用ML/DL方法而不是统计模型进行预测。</p><p id="3720" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在将开始为前面提到的每种方法生成特征。</p><h1 id="f13d" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">XGBoost的特性工程#1</h1><p id="b763" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">正如我们从上面的数据图中看到的，从早上6点到下午6点有一个突然的消费高峰。我们可以围绕这一点建立一个类似“工作时间”的功能，这样我们的算法就可以理解在这个时期发生了一些特殊的事情。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lg"><img src="../Images/046c391726b7893e0124029876532f94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*aeyhbehyS5m8s-mO3EXBjw.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">2017年4月2日的功耗</figcaption></figure><p id="19f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，我们可以看到，与工作日相比，周末(周日)的电力消耗相对较低，这是因为这是一座商业建筑。因此，我们也将为天构建特性。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lg"><img src="../Images/4b154bc1c09657d46c56e5caa71627f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*oYi8Nc7E0T-8PhUajPRHUA.png"/></div></figure><p id="be26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是给定训练期的<strong class="ih hj">完整趋势</strong>。我们可以看到，一年中存在某种季节性，如六月至八月期间和十一月至一月期间的功耗较高，而主电表读数中剩余月份的功耗较低。</p><p id="ed67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们可以构建两个更多的功能，如“季节”和“月份”。</p><p id="4752" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在是我们构建上述特征并使用XGBoost回归器训练模型的时候了。</p><p id="625e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">注意:我已经调好了XGBoost的超级参数，为了代码清晰和切中要点，这里不再赘述。</em></p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="3d67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上面的图中我们可以看到，我们的预测非常好，能够捕捉数据中的波峰和波谷。</p><p id="2d3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在将应用回归量来预测2个子米。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="37dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上面的图中我们可以看出，至少在训练集上，我们能够以良好的精度预测亚米的值。</p><p id="3072" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如前所述，我们将使用<strong class="ih hj">加权RMSE </strong>来评估所有3米的测试结果。此指标对较近的预测月份给予较高的权重，而对较远的未来预测数据给予较低的权重。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lh"><img src="../Images/1ba59eb6d3c3da867ef6dcfe1608d342.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*qbsZ1WIsokF05zKQhnL9aw.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">加权RMSE</figcaption></figure><p id="2a01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中A、B和C分别表示主计量表、子计量表1和子计量表2，</p><ul class=""><li id="5c22" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">t是特定建筑物的测试集中时间戳的总数，</li><li id="559c" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">t是进行预测的时间戳，</li><li id="c9e9" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">k = (ln 2) / 100</li><li id="285c" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">d(t)是时间戳t所在的一天的值</li><li id="b6b2" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">m(it)是仪表I在时间步长t的实际值</li><li id="5869" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">Caret(m(it))是在时间步长t时仪表I的预测值</li><li id="cad9" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">Bar(m(i))是仪表I的平均值—该值用于归一化</li></ul><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="67c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd">我们用XGBoost对测试集的加权RMSE是26.33 </em> </strong></p></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><h1 id="299c" class="jv jw hi bd jx jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko mh kq kr ks bi translated">LightGBM的特征工程#2</h1><p id="c58c" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">现在，我们将探索如果我们使用不同的特征集和不同的算法，我们的结果会是什么。</p><p id="2411" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将构建一些新的功能，如每一行的一刻钟(0-3)，一天中的一小时(0-23)，一个月中的一天，一周中的一天，月初和月末指示器。此外，我们将根据层次结构汇总上述每个特性的目标值。这将给出每个数据点的汇总目标值。</p><p id="da45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">《出埃及记》<strong class="ih hj">2017年4月1日23:00 </strong>的building _ number _ day ofweek _ hour of day _ quartereofhour _ mean将通过对building_number=1、dayofweek=5、hourofday=23、quartereofhour=0的所有目标值取平均值而得出</p><p id="5472" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我们将看到循环特性的使用。使用正弦和余弦变换将一天中的小时转换为循环特征。这样做是因为它可以保存信息，例如23小时和0小时彼此靠近且不远。</p><blockquote class="ky kz la"><p id="b5fd" class="if ig jd ih b ii ij ik il im in io ip lb ir is it lc iv iw ix ld iz ja jb jc hb bi translated">类似地，我们还会将一刻钟、星期几和月几转换为循环特征。</p></blockquote><p id="c56d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">注意:我已经调好了LightGBM的超参数，为了代码清晰和切中要点，这里不再赘述。每个仪表的每个回归器将使用相同的参数。</em></p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="le lf l"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">基于LighGBM的模型代码</figcaption></figure><p id="f4f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd">我们使用LightGBM对测试集的加权RMSE是32.31 </em> </strong></p></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><h1 id="d7ab" class="jv jw hi bd jx jy md ka kb kc me ke kf kg mf ki kj kk mg km kn ko mh kq kr ks bi translated">与GRU合作的特色工程#3</h1><p id="f719" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">在这最后一部分，我将用GRU(门控递归单元)进行实验，这是一种特殊类型的递归神经网络，它解决了标准RNN的消失梯度问题。GRUs使用遗忘门和重置门来记住过去的序列。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mi"><img src="../Images/ed9042f6f32902014c81eb5d570ced0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*5q3Ons4lDfYaqy14jEyfIA.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">这里使用的人工神经网络架构</figcaption></figure><p id="3196" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将添加一个采用二进制值的公司特性。对于工作时间(上午8点到下午8点)，该值将设置为1，对于休息时间，该值将设置为0。此外，我们将构建一个热编码形式的星期几功能。</p><p id="16fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我尝试了GRU模型的不同配置，我两种都尝试过，为每栋建筑的每一米训练单独的模型，还有一个通用的建筑特定模型。我发现，通用的建筑智能模型比针对每一个仪表的单独模型更好地预测了所有三个仪表的读数。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="le lf l"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">基于GRU模型的代码</figcaption></figure><p id="eb93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd">我们用GRU为测试集的加权RMSE是29.93 </em> </strong></p></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><p id="919b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这总结了我对不同类型的ML/DL模型使用的不同特征集的实验结果。我们可以清楚地看到，具有XGBoost的特征工程集#1给出了3个集中的最佳预测。集合#2包含更多样的特征集合，但是不知何故它不能给出最低的误差。</p><blockquote class="mj"><p id="4899" class="mk ml hi bd mm mn mo mp mq mr ms jc dx translated">有时，我们需要构建更简单的特征，但可以尽可能多地解释数据中的差异，这有助于模型更有效地学习。</p></blockquote><p id="4adf" class="pw-post-body-paragraph if ig hi ih b ii mt ik il im mu io ip iq mv is it iu mw iw ix iy mx ja jb jc hb bi translated">一些特性可能有数学上的意义，就像在集合#2中看到的(循环和聚集特性)，但是可能没有你期望的那么强大。</p><blockquote class="mj"><p id="9d0a" class="mk ml hi bd mm mn mo mp mq mr ms jc dx translated">这是一个反复试验的游戏，用不同的ML/DL技术尝试不同的特性组合。然后满足于给你最好的准确性或最低的误差。</p></blockquote><p id="611b" class="pw-post-body-paragraph if ig hi ih b ii mt ik il im mu io ip iq mv is it iu mw iw ix iy mx ja jb jc hb bi translated"><em class="jd">我希望你喜欢这个帖子和有趣的收获。上述解决方案可能并不完美，但总有改进的空间。像你一样，我也是数据科学的学习者和实践者，我总是乐于接受反馈，所以请随意在下面发表评论，我将尝试相应地改进方法。</em></p><p id="e579" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">免责声明:第2节和第3节中的代码和想法是从我参加的黑客马拉松的参与者那里得到的灵感，我是前3名获奖者之一。</em></p></div></div>    
</body>
</html>