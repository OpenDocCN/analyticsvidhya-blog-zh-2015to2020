<html>
<head>
<title>Finding the middle ground for our next vacation with Django and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为我们和Django和Python的下一个假期寻找中间地带</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/finding-the-middle-ground-for-our-next-vacation-with-django-and-python-36158b469471?source=collection_archive---------15-----------------------#2020-04-17">https://medium.com/analytics-vidhya/finding-the-middle-ground-for-our-next-vacation-with-django-and-python-36158b469471?source=collection_archive---------15-----------------------#2020-04-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="066a" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">将朋友的想法付诸实践:</h2><div class=""/><figure class="ev ex ip iq ir is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es io"><img src="../Images/aca97695627d2afe22026860d2c2b5a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wR52vd2G2mqfFORH"/></div></div></figure><p id="32d3" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">今天早上开始像世界上任何其他的新冠肺炎隔离。我刚刚遛完我的狗托比，开始喝我的咖啡，我运行我的早晨查询来刷新我每天为工作做的报告。在我的标准晨会后，我看着窗外，回想起简单的外出似乎并不危险的时候。就在那时，我接到了我朋友博伊德的电话，要求办理标准入住手续。你知道，大学毕业后，我所有的朋友都搬到了全国各地。我在南卡罗来纳州的斯帕坦堡有一个，在俄亥俄州的辛辛那提有一个，在南卡罗来纳州的查尔斯顿有两个，其他的分布在纽约、旧金山、波士顿。我问博伊德“当科罗娜完成它的使命时，你有什么计划？”“我们应该聚在一起，”他说。但是在哪里？去查尔斯顿旅行似乎很简单，因为博伊德和另一个大学室友住在那里，但对除了他们以外的所有人来说，那是一次很远的旅行。"为什么我们不在每个人的中间弄个小木屋什么的，这样才公平"博伊德告诉我。多好的主意啊。让我们找到我们所有人之间的中间地带，在那里找一个Airbnb</p><p id="01b1" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">我们简单讨论了如何用数学方法确定不同点之间的质心。下班后，我告诉Boyd——我将尝试用Python来做这件事，让事情变得简单。因此产生了我的家酿黑客马拉松…下班后几个小时，我已经建立了一个功能性的web应用程序，看起来像这样:</p><figure class="jy jz ka kb fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es jx"><img src="../Images/8709676271b7f75956bc04ab34a3aa50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*S4SpFRqkwP6pwL1QYaE3Hw.gif"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">这是我的网站的演示，名为(暂定)FindMid！</figcaption></figure></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><p id="c310" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">我利用了许多开源库和非常有用的googlemaps api来实现上述结果。让所有的部分一起工作是一个有趣的挑战，但最终我对结果非常满意。是的，在你批评我糟糕的UX之前，让我说，我不是UX设计师。我是一名数据科学家和狂热的python程序员，有一点Django的经验。如果我有我自己的方式，我会把这个传给有更好的HTML，CSS和JS技能的人。</p><p id="15ab" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">让我们从库开始:</p><pre class="jy jz ka kb fd kn ko kp kq aw kr bi"><span id="2b97" class="ks kt hi ko b fi ku kv l kw kx">from uszipcode import SearchEngine<br/>import wikipedia<br/>import gmplot</span><span id="ffce" class="ks kt hi ko b fi ky kv l kw kx">import numpy as np<br/>import matplotlib.pyplot as plt<br/>import datetime<br/>import os</span></pre><p id="3fd2" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hs">美国邮政编码</strong>:【https://github.com/seanpianka/zipcodes T2】</p><p id="efc4" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><em class="la">“zipcodes是Python 3和Python 2.7的一个包，支持查找和过滤美国的zip code数据。”</em></p><p id="64cb" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">我使用<strong class="jb hs"> uszipcode </strong>下拉我的各个分散点的经度/纬度。通过传递城市和州名，我可以获取搜索引擎生成的邮政编码，并下拉相应的经度和纬度数据。</p><p id="3bac" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hs">维基百科</strong>:<a class="ae kz" href="https://github.com/goldsmith/Wikipedia" rel="noopener ugc nofollow" target="_blank">https://github.com/goldsmith/Wikipedia</a></p><p id="9523" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><em class="la">“Wikipedia是一个Python库，可以轻松访问和解析Wikipedia中的数据。</em></p><p id="19c2" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">搜索维基百科，获取文章摘要，从页面获取链接和图片等数据，等等。维基百科包装了<a class="ae kz" href="https://www.mediawiki.org/wiki/API" rel="noopener ugc nofollow" target="_blank"><em class="la">MediaWiki API</em></a><em class="la">这样你就可以专注于使用维基百科的数据，而不是获取它。”</em></p><p id="c43c" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">我对维基百科api的利用可能不会立即被认出，但我用它来抓取每个中点城镇的快速摘要。当生成一个城镇时，我将城市/州数据传递给维基百科搜索，为网站生成一个一句话的摘要。</p><p id="add0" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hs">GM plot:</strong><a class="ae kz" href="https://github.com/vgm64/gmplot" rel="noopener ugc nofollow" target="_blank">https://github.com/vgm64/gmplot</a></p><p id="f6de" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><em class="la">“在谷歌地图上绘制数据，简单易行。一个类似matplotlib的界面来生成HTML和javascript，以便在Google Maps上呈现您想要的所有数据。有几种绘图方法可以轻松创建探索性地图视图。这里有一个速成班:“</em></p><p id="0d6a" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">Gmplot完成了大部分繁重的工作，根据我在matplotlib中的经验，它简化了创建和绘制各种线和点的工作。</p><p id="2ada" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">我通过为我的中心点建立逻辑来开始我的开发过程。我用了一个简单的质心公式。</p><figure class="jy jz ka kb fd is er es paragraph-image"><div class="er es lb"><img src="../Images/ed060f24771591f701cf5d4dc9bf6eb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/0*CZF8LtLMNelGBtvW"/></div></figure><p id="9729" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">为了节省时间，我选择了一些简单的东西，这似乎能完成任务。我开始为我的lat填充一些随机数，然后尝试到质心的平均距离，以了解结果。之后，我把它插入到我的django webapp的后端(我不会涉及启动django webapp的基础知识，但我很乐意指出一些好的资源)</p><pre class="jy jz ka kb fd kn ko kp kq aw kr bi"><span id="91ed" class="ks kt hi ko b fi ku kv l kw kx">points =[]<br/>search = SearchEngine()<br/>cities = request.POST.getlist('feedurl[]')<br/>states = request.POST.getlist('feedurl[1]')<br/><br/>for i in range(len(cities)):<br/>   result = search.by_city_and_state(cities[i],states[i])<br/>   points.append([result[0].lat,result[0].lng])</span><span id="2e4c" class="ks kt hi ko b fi ky kv l kw kx">final_x = sum([x[0] for x in points])/ len(points)<br/>final_y = sum([y[1] for y in points])/ len(points)</span></pre><p id="105b" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">通过利用该请求。我将检索两个填充的城市和州的列表，我可以使用它们通过uszipcode SearchEngine()函数进行搜索。这个搜索的结果将包含lat/long和各种其他数据点，这些数据点可能会有所帮助，但我没有在这个项目中使用。列表如下所示:</p><pre class="jy jz ka kb fd kn ko kp kq aw kr bi"><span id="c157" class="ks kt hi ko b fi ku kv l kw kx">[[lat1,long1],[lat2,long2],[lat3,long3],...]</span></pre><p id="9b32" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">有了这个列表，我可以确定我们的质心。<strong class="jb hs">太好了！<em class="la"> </em> </strong> <em class="la">但是现在呢……</em></p><pre class="jy jz ka kb fd kn ko kp kq aw kr bi"><span id="32b6" class="ks kt hi ko b fi ku kv l kw kx">result = search.by_coordinates(final_x,final_y)</span></pre><p id="f137" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">让我们再次将这些新的数据点插入SearchEngine()函数，并找出我们的最终结果。在上面的演示中——那是北卡罗来纳州的琼斯维尔。我从没去过琼斯维尔，但我去过北卡罗来纳州，那里很美。也许我们最终会去那里？谁知道呢。现在我们有了一个城市和一个州，我可以从维基百科上获得一些信息..</p><pre class="jy jz ka kb fd kn ko kp kq aw kr bi"><span id="c282" class="ks kt hi ko b fi ku kv l kw kx">wikipedia.summary(result[0].city+', '+result[0].state, sentences=1)</span></pre><p id="9f25" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">我们从这个API调用中得到的结果给出了网页中点公告下的简短广告。使用上面相同的变量，对Airbnb url进行了简单的调整，将日期和城市/州名更改为上面的变量，然后将其传递回django模板。<em class="la">瞧，</em>问题中点的Airbnb数据。</p><p id="d868" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">完成这些后，让我们在谷歌地图上绘制我们的点。重要提示，Google需要一个API密钥来正确使用gmaps。您确实需要注册一张信用卡，但是您的API调用对于您的第一个100，000个静态地图调用是免费的。对于我的朋友来说，这是一个有趣的小项目，没有问题，但扩大到商业化这将是一个考虑因素。</p><pre class="jy jz ka kb fd kn ko kp kq aw kr bi"><span id="227c" class="ks kt hi ko b fi ku kv l kw kx">gmap = gmplot.GoogleMapPlotter(final_x,<br/>                               final_y, zoom =5, apikey=**yourkey**)</span><span id="5c54" class="ks kt hi ko b fi ky kv l kw kx">gmap.scatter([x[0] for x in points], [y[1] for y in points], size = 10000, color = 'red', marker=False)<br/>gmap.scatter([final_x],[final_y], size = 10000, color = 'blue', marker=False)</span></pre><p id="bd68" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">我们用两个纬度/经度点实例化了以质心为中心的地图，我发现缩放5适合美国地图，但这取决于您的使用情况。这也是您提供API密钥的地方。</p><p id="ea42" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">随着gmap的实例化，我开始绘制我们的起点/终点。像以前一样，我使用列表理解来传递来自列表的纬度/经度，以生成我们的原点，然后我将我们的质心纬度/经度作为单项列表传递(散点函数需要一个iterable)。</p><pre class="jy jz ka kb fd kn ko kp kq aw kr bi"><span id="77dc" class="ks kt hi ko b fi ku kv l kw kx">gmap.plot([x[0] for x in points], [y[1] for y in points])<br/>gmap.draw('findmid/media/map.html')</span></pre><p id="f60f" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">现在我们画出每个起点和终点之间的线。Gmplot在制作这些线条方面做得很好，它超级简单，你可以定制一个合适的数量。最后一步…我们创建我们的html文件。</p></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><p id="db6b" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">所有的部分都在这里，让我们把它们放在一个前端框架上。下面是Django调用来填充页面的HTML模板。因为在我们向前端发送数据之前，所有的变量都是空的，所以我可以将它们直接标记到HTML中，几乎没有影响。airbnb链接是个例外，我把它放在一个简单的if语句后面。</p><pre class="jy jz ka kb fd kn ko kp kq aw kr bi"><span id="6388" class="ks kt hi ko b fi ku kv l kw kx">&lt;style&gt;<br/>   .feed {padding: 5px 0}<br/>&lt;/style&gt;<br/>&lt;!-- onsubmit="return validate(this)" --&gt;<br/>&lt;form method="post"&gt;<br/>    {% csrf_token %}<br/>&lt;table&gt;<br/>&lt;tr&gt;<br/>    &lt;td valign=top&gt;<br/>        &lt;div id="newlink"&gt;<br/>            &lt;div class="feed"&gt;<br/>               &lt;input type="text" name="feedurl[]" size="50"&gt;<br/>               &lt;input type="text" name="feedurl[1]" size="2"&gt;<br/>            &lt;/div&gt;<br/>            &lt;div class="feed"&gt;<br/>               &lt;input type="text" name="feedurl[]" size="50"&gt;<br/>               &lt;input type="text" name="feedurl[1]" size="2"&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    &lt;/td&gt;<br/>&lt;/tr&gt;</span><span id="48d6" class="ks kt hi ko b fi ky kv l kw kx">&lt;/table&gt;<br/>    &lt;p&gt;<br/>        &lt;br&gt;<br/>        &lt;input type="submit" name="submit1"&gt;<br/>    &lt;/p&gt;<br/>&lt;p id="addnew"&gt;<br/>    &lt;a href="javascript:add_feed()"&gt;Add New &lt;/a&gt;<br/>&lt;/p&gt;<br/>&lt;/form&gt;<br/>&lt;h1&gt;<br/>{{ midpoint }}<br/>&lt;/h1&gt;</span><span id="4cdd" class="ks kt hi ko b fi ky kv l kw kx">{{ wiki }}<br/>&lt;br&gt;<br/>{% if  airbnb  != '' %}<br/>&lt;a href  = "{{ airbnb }}"&gt; See options for stays in the are&lt;/a&gt;<br/>{% endif %}<br/>&lt;br&gt;<br/>&lt;hr&gt;<br/>{{ map | safe}}</span><span id="6c36" class="ks kt hi ko b fi ky kv l kw kx">&lt;!-- Template. This whole data will be added directly to working form above --&gt;<br/>&lt;div id="newlinktpl" style="display:none"&gt;<br/>    &lt;div class="feed"&gt;<br/>     &lt;input type="text" name="feedurl[]" value=""  size="50"&gt;<br/>     &lt;input type="text" name="feedurl[1]" size="2"&gt;<br/>    &lt;/div&gt;<br/>&lt;/div&gt;</span><span id="ebc9" class="ks kt hi ko b fi ky kv l kw kx">&lt;script type="text/javascript"&gt;<br/>function validate(frm)<br/>{<br/>    var ele = frm.elements['feedurl[]'];<br/>    if (! ele.length)<br/>    {<br/>        alert(ele.value);<br/>    }<br/>    for(var i=0; i&lt;ele.length; i++)<br/>    {<br/>        alert(ele[i].value);<br/>    }<br/>    return true;<br/>}<br/>function add_feed()<br/>{<br/>    var div1 = document.createElement('div');<br/>    // Get template data<br/>    div1.innerHTML = document.getElementById('newlinktpl').innerHTML;<br/>    // append to our form, so that template data<br/>    //become part of form<br/>    document.getElementById('newlink').appendChild(div1);<br/>}<br/>&lt;/script&gt;</span></pre><p id="1775" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">就这样，我启动了Django服务器，它开始工作了！</p><p id="9cfb" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">汪汪，好棒的一骑。我试图在同一天完成这一切，所以它仍然新鲜，黑客马拉松的背景似乎不公平，两天后回来。我会尽快动笔，这样我就可以开始这个项目疯狂的原型制作了。我从这个项目和其他类似的项目中获得了很多乐趣，这是一个磨练一些技能和学习新技能的好机会。我今天使用的很多工具都是我从未见过的；GMAP、维基、USZIP对我来说都是新的图书馆。它告诉你只要有点毅力和创造力就能做什么。感谢阅读<em class="la">(抱歉任何糟糕的语法)</em>，我将在接下来的几天里把代码上传到我的公共github:【https://github.com/tbacas<a class="ae kz" href="https://github.com/tbacas" rel="noopener ugc nofollow" target="_blank"/></p><p id="173a" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">TRB</p></div></div>    
</body>
</html>