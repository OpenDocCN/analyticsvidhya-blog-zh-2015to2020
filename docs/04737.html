<html>
<head>
<title>Configure Cassandra With Django</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用姜戈配置卡珊德拉</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/configure-cassandra-with-django-1b7f5d084c6e?source=collection_archive---------13-----------------------#2020-03-30">https://medium.com/analytics-vidhya/configure-cassandra-with-django-1b7f5d084c6e?source=collection_archive---------13-----------------------#2020-03-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d99e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Cassandra 是一个开源的分布式数据库管理系统。它是为处理商用硬件或云基础设施上的大量数据而开发的。Cassandra提供无单点故障的高可用性。</p><p id="4235" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Cassandra通过在不停机或不中断应用程序的情况下添加新机器来支持线性可伸缩性，还增加了Cassandra的读写吞吐量。</p><p id="f36f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">集群中的每个Cassandra节点将具有相同的角色。数据分布在整个群集中，这意味着每个节点保存不同的数据。Cassandra支持复制和多数据中心复制，用于冗余、故障转移和灾难恢复。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/b1be5885234f4e24a6a5d7b01f1fa87b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*9cYThS_p99DRDDovkcxkmQ.png"/></div></figure><p id="11f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您计划设计一个基于单片架构(垂直扩展)的应用程序，并且仍然决定使用数据库。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jm"><img src="../Images/486bd7e20108d438b35db97ced297552.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yYKwVI81AiZA78NJySgRYQ.png"/></div></div></figure><p id="2c94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗯，这取决于你，但在我看来，卡珊德拉将是一个不错的选择。</p><p id="3160" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://db-engines.com/en/system/Cassandra%3bMongoDB%3bPostgreSQL" rel="noopener ugc nofollow" target="_blank">卡珊德拉vs MongoDB vs PostgreSQL </a></p></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><h1 id="7f27" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated"><strong class="ak">安装卡珊德拉(Ubuntu 18.04) </strong></h1><p id="ff53" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">因为Cassandra是用java实现的，所以我们需要安装一些依赖项。</p><p id="c1bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤1: <em class="lb">这个命令提供了所使用的apt库的抽象。</em>T9】</strong></p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="0d45" class="lh jz hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> sudo apt-get install software-properties-common</span></pre><p id="3460" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤2: <em class="lb">使用此命令添加个人程序包档案(PPA)以安装oracle JRE程序包。</em>T13】</strong></p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="448d" class="lh jz hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> sudo apt-add-repository ppa:webupd8team/java</span></pre><p id="7cd0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第三步:<em class="lb">从repo下载更新。</em> </strong></p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="898c" class="lh jz hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> sudo apt-get update</span></pre><p id="754b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第四步:<em class="lb">安装java。</em> </strong></p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="05a6" class="lh jz hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> sudo apt install oracle-java8-installer</span></pre><p id="ecb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">卡住了！</p><p id="4572" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第五步:</strong> <strong class="ih hj"> <em class="lb">(可选)</em> </strong></p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="424d" class="lh jz hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> sudo apt install -y openjdk-8-jre</span></pre><p id="1bf9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后😎我们安装所有的依赖项，让我们安装Cassandra。</p><p id="2301" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第一步:<em class="lb">添加一个cassandra repo。</em> </strong></p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="eb9e" class="lh jz hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> echo "deb http://www.apache.org/dist/cassandra/debian 311x main" |         sudo tee -a /etc/apt/sources.list.d/cassandra.sources.list</span></pre><p id="9cf6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤2: <em class="lb">添加Cassandra repo的公钥，这样就不会遇到GPG错误。</em> </strong></p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="333d" class="lh jz hi ld b fi li lj l lk ll"><strong class="ld hj">$ </strong>wget https://www.apache.org/dist/cassandra/KEYS | sudo apt-key add -</span></pre><p id="0ac1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你遇到GPG错误。</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="1de7" class="lh jz hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> gpg - keyserver pgp.mit.edu - recv-keys 749D6EEC0353B12C<br/><strong class="ld hj">$</strong> gpg --export --armor 749D6EEC0353B12C | sudo apt-key add -<br/><strong class="ld hj">$</strong> gpg --keyserver pgp.mit.edu --recv-keys A278B781FE4B2BDA<br/><strong class="ld hj">$</strong> gpg --export --armor A278B781FE4B2BDA | sudo apt-key add -</span></pre><p id="b742" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第三步:<em class="lb">安装带网络时间协议(ntp)的Cassandra</em></strong></p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="7755" class="lh jz hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> sudo apt-get install cassandra ntp</span></pre><p id="22da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要检查安装是否成功，我们可以检查服务的状态。为此，请运行以下命令:</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="7944" class="lh jz hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> sudo systemctl status cassandra</span></pre><p id="23a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果系统启动时尚未启用该服务，您可以使用下面的命令来启用它</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="32c8" class="lh jz hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> sudo systemctl enable cassandra</span></pre><p id="3244" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并启动卡珊德拉服务。</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="26d6" class="lh jz hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> sudo systemctl start cassandra</span></pre><p id="5a36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们要在单个节点上运行Cassandra，Cassandra的默认配置是有效的。另一方面，如果Cassandra将在一个集群中使用或者由几个节点同时使用，那么对配置文件进行一些修改是很方便的。Cassandra配置文件名为<strong class="ih hj"> cassandra.yaml </strong>，位于<strong class="ih hj"> /etc/cassandra/ </strong>。我们可以用我们最喜欢的文本编辑器打开它，并修改一些选项:</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="34e9" class="lh jz hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> sudo nano /etc/cassandra/cassandra.yaml</span></pre><p id="9281" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们必须更改集群的名称。查找<strong class="ih hj"> cluster_name </strong>参数，并指定您想要的名称:</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="9185" class="lh jz hi ld b fi li lj l lk ll">cluster_name: [cluster_name]</span></pre><p id="8934" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，改变数据存储端口是一个好主意。为此，查找<strong class="ih hj"> storage_port </strong>参数并分配一个。请记住，它必须是<a class="ae jd" href="https://www.hostinger.com/tutorials/how-to-configure-firewall-on-ubuntu-using-ufw/" rel="noopener ugc nofollow" target="_blank">防火墙</a>中的可用端口，这样一切才能正常工作:</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="1064" class="lh jz hi ld b fi li lj l lk ll">storage_port :[port]</span></pre><p id="cacb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们查找<strong class="ih hj"> seed_provider </strong>参数，在seeds部分，我们添加组成集群的节点的IP地址，用逗号分隔。</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="58f0" class="lh jz hi ld b fi li lj l lk ll">Seeds: [node_ip],[node_ip]...[node_ip]</span></pre><p id="d8cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成后，保存文件并重新加载Cassandra。</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="edbc" class="lh jz hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> sudo systemctl reload cassandra</span></pre><blockquote class="lm ln lo"><p id="dbc2" class="if ig lb ih b ii ij ik il im in io ip lp ir is it lq iv iw ix lr iz ja jb jc hb bi translated">cqlsh(Cassandra查询语言shell)的默认用户名和密码是“Cassandra”</p></blockquote><p id="15b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用以下命令提示cqlsh</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="8dd2" class="lh jz hi ld b fi li lj l lk ll">$ cqlsh -u cassandra -p cassandra<br/>$ cassandra@cqlsh&gt;</span></pre><p id="7f11" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们创建一个密钥空间(数据库)。</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="d580" class="lh jz hi ld b fi li lj l lk ll">cassandra@cqlsh&gt; CREATE KEYSPACE db WITH replication = {'class':'SimpleStrategy', 'replication_factor' : 3};</span></pre><h1 id="8527" class="jy jz hi bd ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr lw kt ku kv bi translated">创建Django项目</h1><p id="b6a1" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">我希望你对python和django有一点熟悉，所以这里我就不赘述了。我假设您已经创建了一个virtualenv并运行django-admin命令来启动一个项目。</p><p id="1223" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">需要安装一个包来开始与Apache Cassandra和Django框架的工作！</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="a2f8" class="lh jz hi ld b fi li lj l lk ll"><strong class="ld hj">$</strong> pip install django-cassandra-engine</span></pre><p id="19d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在去你的设置文件用下面的json替换数据库。</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="0303" class="lh jz hi ld b fi li lj l lk ll">DATABASES = {<br/>    'default': {<br/>        'ENGINE': 'django_cassandra_engine',<br/>        'NAME': 'db',<br/>        'TEST_NAME': 'test_db',<br/>        'HOST': '127.0.0.1',<br/>        'OPTIONS': {<br/>            'replication': {<br/>                'strategy_class': 'SimpleStrategy',<br/>                'replication_factor': 3<br/>                }<br/>        }<br/>    }<br/>}</span></pre><p id="a99d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您更改了cassandra.yaml文件，请用您的IP替换HOST。</p><p id="6e37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加您的模型并运行迁移。</p><p id="2386" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢😎</p></div></div>    
</body>
</html>