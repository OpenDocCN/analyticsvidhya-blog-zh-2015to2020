<html>
<head>
<title>Adding Mongo DB to a simple Web Application created with Node</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Mongo DB添加到用Node创建的简单Web应用程序中</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/adding-mongo-db-to-a-simple-web-application-created-with-node-b50d1d41f854?source=collection_archive---------27-----------------------#2020-05-02">https://medium.com/analytics-vidhya/adding-mongo-db-to-a-simple-web-application-created-with-node-b50d1d41f854?source=collection_archive---------27-----------------------#2020-05-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es im"><img src="../Images/d522c57e8d778b2d64505b47862fe517.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUAwKwhk244iEOKVFS2FQw.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">摘自<a class="ae jc" href="https://www.mongodb.com/brand-resources" rel="noopener ugc nofollow" target="_blank">此处</a></figcaption></figure><p id="d679" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在本文中，我们将把数据库添加到我们简单的publisher创建的<a class="ae jc" rel="noopener" href="/@maheshsai252/a-simple-online-publisher-using-node-js-81de6d8f40ee">这里</a>。</p><p id="a849" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">将对我们的publisher web应用程序进行以下修改:</p><ol class=""><li id="da87" class="kb kc hi jf b jg jh jk jl jo kd js ke jw kf ka kg kh ki kj bi translated">我们需要在数据库中存储从用户收到的信息。</li><li id="1527" class="kb kc hi jf b jg kk jk kl jo km js kn jw ko ka kg kh ki kj bi translated">我们需要向用户显示信息。</li></ol><h2 id="3a96" class="kp kq hi bd kr ks kt ku kv kw kx ky kz jo la lb lc js ld le lf jw lg lh li lj bi translated">为什么是Mongo DB？</h2><p id="f811" class="pw-post-body-paragraph jd je hi jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated"><a class="ae jc" href="https://www.mongodb.com" rel="noopener ugc nofollow" target="_blank"> Mongo DB </a>是NoSQL的数据库。现实世界的数据并不总是以表格的形式出现。所以，我们没有sql数据库。</p><p id="dc88" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Mongo DB使用JSON文档来存储数据。它还支持正则表达式。</p><p id="9ff7" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们将在我们的网站中使用<a class="ae jc" href="https://www.npmjs.com/package/mongoose" rel="noopener ugc nofollow" target="_blank">猫鼬</a>。Mongoose是一个工具，使我们的工作与Mongo数据库容易。</p><h1 id="c62c" class="lp kq hi bd kr lq lr ls kv lt lu lv kz lw lx ly lc lz ma mb lf mc md me li mf bi translated">安装和导入猫鼬</h1><p id="4824" class="pw-post-body-paragraph jd je hi jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">使用以下命令安装</p><pre class="in io ip iq fd mg mh mi mj aw mk bi"><span id="06d6" class="kp kq hi mh b fi ml mm l mn mo">npm i mongoose</span></pre><p id="dff5" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在app.js中导入</p><pre class="in io ip iq fd mg mh mi mj aw mk bi"><span id="d376" class="kp kq hi mh b fi ml mm l mn mo">const mongoose = require("mongoose");</span></pre><h1 id="3eb8" class="lp kq hi bd kr lq lr ls kv lt lu lv kz lw lx ly lc lz ma mb lf mc md me li mf bi translated">连接到数据库</h1><p id="38b0" class="pw-post-body-paragraph jd je hi jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">我们正在创建一个博客数据库并连接到它。</p><p id="fa52" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">将此内容包含在app.js中</p><pre class="in io ip iq fd mg mh mi mj aw mk bi"><span id="ce60" class="kp kq hi mh b fi ml mm l mn mo">mongoose.connect("mongodb://localhost:27017/blogDB", {useNewUrlParser: true, useUnifiedTopology: true});</span></pre><h1 id="e260" class="lp kq hi bd kr lq lr ls kv lt lu lv kz lw lx ly lc lz ma mb lf mc md me li mf bi translated">在app.js中修改回调</h1><p id="7246" class="pw-post-body-paragraph jd je hi jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">我们将把blogDataBase添加到上一篇文章中创建的publisher中，而不改变其功能。</p><p id="72fa" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">回想一下我们用来存储内容的posts数组。</p><pre class="in io ip iq fd mg mh mi mj aw mk bi"><span id="6401" class="kp kq hi mh b fi ml mm l mn mo">let posts=[]<br/>let post = {<br/>    title : req.body.title,<br/>    postc : req.body.post<br/>  };<br/> posts.push(post);</span></pre><p id="f9b6" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在我们将在我们的blogDataBase中创建posts集合。</p><p id="7ce2" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">首先，我们需要为posts集合创建模式</p><pre class="in io ip iq fd mg mh mi mj aw mk bi"><span id="5d19" class="kp kq hi mh b fi ml mm l mn mo">const postSchema = {</span><span id="2f3d" class="kp kq hi mh b fi mp mm l mn mo">title: String,</span><span id="13d0" class="kp kq hi mh b fi mp mm l mn mo">content: String</span><span id="d32d" class="kp kq hi mh b fi mp mm l mn mo">};</span></pre><p id="abaa" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在创建一个收藏</p><pre class="in io ip iq fd mg mh mi mj aw mk bi"><span id="e413" class="kp kq hi mh b fi ml mm l mn mo">const Posts = mongoose.model("Posts", postSchema);</span></pre><p id="174f" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们创造了收藏。当用户写文章时，我们会将文档添加到我们的集合中。修改“/撰写”路由的回调。</p><pre class="in io ip iq fd mg mh mi mj aw mk bi"><span id="58d7" class="kp kq hi mh b fi ml mm l mn mo">app.post("/compose",function(req,res){<br/>  <br/>  const post = new Posts ({</span><span id="f2a1" class="kp kq hi mh b fi mp mm l mn mo">  title: req.body.title,</span><span id="d085" class="kp kq hi mh b fi mp mm l mn mo">  content: req.body.post</span><span id="b9a1" class="kp kq hi mh b fi mp mm l mn mo">   });<br/> post.save();<br/> res.redirect("/");</span><span id="5a0e" class="kp kq hi mh b fi mp mm l mn mo">});</span></pre><p id="7eb1" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">“post”是保存在post集合中的文档。</p><p id="3b12" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">完成向数据库添加用户输入。现在，我们从主页和帖子页的数据库中检索数据。</p><p id="97fa" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">主页回调修改如下</p><pre class="in io ip iq fd mg mh mi mj aw mk bi"><span id="7c2e" class="kp kq hi mh b fi ml mm l mn mo">app.get("/",function(req,res)<br/>{<br/>  Post.find({}, function(err, posts){<br/>   console.log(posts);<br/>   res.render("home", {</span><span id="2be9" class="kp kq hi mh b fi mp mm l mn mo">startingContent: homeStartingContent,</span><span id="bf64" class="kp kq hi mh b fi mp mm l mn mo">posts: posts</span><span id="54c4" class="kp kq hi mh b fi mp mm l mn mo">});<br/>});<br/>}<br/>);</span></pre><p id="2de3" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Post.find( <condition>，function(err，<result> ){…})是在集合中查找文档的语法。</result></condition></p><p id="78c6" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">与此类似，findOne函数可以根据条件从集合中检索文档。我们将使用这个内部post回调。</p><pre class="in io ip iq fd mg mh mi mj aw mk bi"><span id="ce4e" class="kp kq hi mh b fi ml mm l mn mo">app.get("/posts/:postname",function(req,res){<br/> <br/> Post.findOne({title: req.params.postname}, function(err, post){<br/>    if(!err)<br/>    {<br/>      res.render("post", {</span><span id="92da" class="kp kq hi mh b fi mp mm l mn mo">title: post.title,</span><span id="f26b" class="kp kq hi mh b fi mp mm l mn mo">content: post.content</span><span id="0858" class="kp kq hi mh b fi mp mm l mn mo">});</span><span id="5af0" class="kp kq hi mh b fi mp mm l mn mo">}<br/>    else<br/>    {<br/>      console.log(err);<br/>    }</span><span id="66ad" class="kp kq hi mh b fi mp mm l mn mo">});<br/>});</span></pre><p id="8746" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">就是这样！！！</p><h1 id="17ce" class="lp kq hi bd kr lq lr ls kv lt lu lv kz lw lx ly lc lz ma mb lf mc md me li mf bi translated">警告</h1><p id="bb92" class="pw-post-body-paragraph jd je hi jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">在mac中使用“mongod”命令启动mongoDB时可能会出现错误。</p><p id="6a98" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">请尝试以下命令</p><pre class="in io ip iq fd mg mh mi mj aw mk bi"><span id="40e0" class="kp kq hi mh b fi ml mm l mn mo">sudo mongod --dbpath /System/Volumes/Data/data/db</span></pre><h1 id="01a6" class="lp kq hi bd kr lq lr ls kv lt lu lv kz lw lx ly lc lz ma mb lf mc md me li mf bi translated">结论</h1><p id="ff24" class="pw-post-body-paragraph jd je hi jf b jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">无需修改ejs文件的任何代码，我们已经将数据库添加到我们在此创建的publisher网站。</p><p id="f0cd" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">完整的代码可以在<a class="ae jc" href="https://github.com/maheshsai252/publisher" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div></div>    
</body>
</html>