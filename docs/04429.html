<html>
<head>
<title>Simple Facial Recognition Lock in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的简单面部识别锁</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/simple-facial-recognition-lock-in-python-fc3bdb65f9e2?source=collection_archive---------5-----------------------#2020-03-19">https://medium.com/analytics-vidhya/simple-facial-recognition-lock-in-python-fc3bdb65f9e2?source=collection_archive---------5-----------------------#2020-03-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/568e2020b8b37791becea17dd29d7f3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*A-O32ETtjRVhs203USyVsw.png"/></div></figure><p id="834b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">互联网上有成千上万的文章教人们如何编写面部识别程序，但如果你对进一步开发人工智能或只是面部识别不感兴趣，你可以用这些技能和知识做什么？在本文中，我将向您展示如何简单地使用面部识别作为工具来解锁python程序中的一些特殊功能，让我们开始吧！</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h1 id="eaa2" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">第一个脚本:用你的脸扫描图像</h1><p id="0a6a" class="pw-post-body-paragraph im in hi io b ip kp ir is it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj hb bi translated">要使面部识别锁工作，我们需要两个程序，主程序和面部编码程序。我们需要一个充满我们面部数据的文件，就像这样:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="9c61" class="ld js hi kz b fi le lf l lg lh">[-0.0862740874, 0.0845895484, 0.00457824348, -0.0318371728, -0.100712053, -0.0418178774, -0.0960027054, -0.133479297, 0.154759556, -0.10576304, 0.227993041, -0.0542645939, -0.201107845, -0.0896851793, -0.051155258, 0.185108796, -0.189338654, -0.0807494298, -0.023903545, -0.00611156411, 0.0360367298, -0.000108173699, 0.0220226366, 0.10286174, -0.0518482327, -0.361791611, -0.102660321, -0.130110055, -0.0168904345, -0.0592981838, -0.105417296, 0.0476256534, -0.134715512, -0.06483794, 0.0398214161, 0.0726992786, -0.0366758741, -0.0319151953, 0.214342266, -0.0181660987, -0.194284335, 0.00949012395, 0.0287496075, 0.224820495, 0.161936209, 0.0535234362, 0.0294731073, -0.155835524, 0.111303784, -0.142807156, 0.0162547529, 0.167122349, 0.0853853449, 0.0324059725, -0.0510545149, -0.120040506, 0.0221806802, 0.091224499, -0.140660241, 0.00179720065, 0.0806006864, -0.147366777, -0.0763955563, -0.0365661718, 0.307173997, 0.109180234, -0.119325541, -0.189195797, 0.102084883, -0.173305988, -0.108043648, 0.0138288997, -0.142863572, -0.180734307, -0.292608291, 0.00601311959, 0.375898182, 0.0840220973, -0.206772164, 0.0971529856, -0.12172585, -0.043821238, 0.119383149, 0.179529011, -0.0306802131, 0.0182257965, -0.0724082515, -0.0192991868, 0.223633379, -0.0940892547, 0.0138434339, 0.211511686, -0.000297587365, 0.12877129, 0.0305812079, -0.0346990041, -0.0490746126, 0.0227140095, -0.0909718052, -0.00931461621, 0.0639288872, -0.0302120745, 0.0152705275, 0.0721999854, -0.215995222, 0.106535025, -0.00207017828, 0.0114724403, 0.0923817977, -0.0237524286, -0.119121008, -0.119517364, 0.189791232, -0.237717852, 0.21647267, 0.161980346, 0.11064291, 0.147651345, 0.136242002, 0.10126932, -0.0106870839, -0.0220588408, -0.227553442, 0.0265891906, 0.154135481, -0.0370164737, 0.0795107111, -0.0148447473]</span></pre><p id="8484" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这篇文章中，我会用更简单的方法，用你的照片代替摄像机。</p><p id="73e0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对于今天的脚本，我使用的是https://github.com/ageitgey/face_recognition的人脸识别模块，你可以访问网站并获得更多信息。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="51a6" class="ld js hi kz b fi le lf l lg lh">import face_recognition as fr<br/>import os<br/>import pickle</span></pre><p id="a2d3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在编写脚本之前，我们需要创建一些文件夹来存储我们的pickle文件和我们想要扫描的图像。在我的情况下，我的文件夹是</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div class="er es lj"><img src="../Images/03bf50885c240410eb9c6393b460922a.png" data-original-src="https://miro.medium.com/v2/resize:fit:136/format:webp/1*0qFwpc9XSyu5OCN15esipA.png"/></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">人脸数据库</figcaption></figure><p id="c89d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，在脚本开始时，我们需要指定文件夹路径:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="d575" class="ld js hi kz b fi le lf l lg lh">db_path = "C:\\Users\\your\\path\\face_db\\"</span></pre><p id="09a8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要扫描face_db文件夹中的那些图像，我们需要用os.listdir()将每个图像名称放入一个列表中:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="ae82" class="ld js hi kz b fi le lf l lg lh">faces = os.listdir(db_path)</span></pre><p id="70d4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，我们需要一个列表来存储我们的编码:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="f4ee" class="ld js hi kz b fi le lf l lg lh">known_face_encodings = []</span></pre><p id="f8c4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要开始扫描，我们可以为面孔列表中的每个面孔创建一个for循环:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="6d1a" class="ld js hi kz b fi le lf l lg lh">for face in faces:</span></pre><p id="4cf5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下一步，我们需要加载图像并用face _ recognition . load _ image _ file()和face_recognition.face_encoding()对其进行编码，然后将其添加到“know_face_encoding”列表中:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="1cd9" class="ld js hi kz b fi le lf l lg lh">    im = fr.load_image_file(db_path + face)<br/>    <strong class="kz hj">#encode the first face in the image</strong><br/>    encoding = fr.face_encodings(im)[0]<br/>    known_face_encodings.append(encoding)</span></pre><p id="8965" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">扫描完所有的面后，我们需要创建一个pickle文件:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="ecba" class="ld js hi kz b fi le lf l lg lh">file = open('encode.pickle','wb')<br/><strong class="kz hj">#you can add a path in front of the file name,it is not necessary, but the pickle file will be the location of your script</strong></span></pre><p id="3bb1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后将我们的数据转储到pickle文件中并关闭它:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="b8b0" class="ld js hi kz b fi le lf l lg lh"><strong class="kz hj">#dump encoding in pickle file</strong><br/>pickle.dump(known_face_encodings,file)<br/>file.close()</span></pre><p id="7af3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是第一个脚本的结尾，您应该得到这样一个pickle文件:</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div class="er es lo"><img src="../Images/8d0bec05f761ed0fa6fbcdbe17ebcd0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:246/format:webp/1*ZXw16xGwywuw7VFGa5CePg.png"/></div></figure><p id="bc1b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">完整脚本:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="e0f5" class="ld js hi kz b fi le lf l lg lh">import face_recognition as fr<br/>import os<br/>import pickle</span><span id="ac63" class="ld js hi kz b fi lp lf l lg lh">db_path = "C:\\Users\\your\\path\\face_db\\"<br/>faces = os.listdir(db_path)<br/>known_face_encodings = []<br/>n = 1</span><span id="6773" class="ld js hi kz b fi lp lf l lg lh">for face in faces:<br/>    im = fr.load_image_file(db_path + face)<br/>    #encode the first face in the image<br/>    encoding = fr.face_encodings(im)[0]<br/>    known_face_encodings.append(encoding)<br/>    print("%1d of %2d is done"%(n,len(faces)))<br/>    n+=1       <br/>#create a pickle file<br/>file = open(path+'encode.pickle','wb')</span><span id="bdae" class="ld js hi kz b fi lp lf l lg lh">#dump encoding in pickle file<br/>pickle.dump(known_face_encodings,file)<br/>file.close()</span></pre><h1 id="eacc" class="jr js hi bd jt ju lq jw jx jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko bi translated">演示:</h1><figure class="ku kv kw kx fd ij"><div class="bz dy l di"><div class="lv lw l"/></div></figure></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h1 id="9b83" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">第二个脚本:面部识别锁</h1><p id="9cb7" class="pw-post-body-paragraph im in hi io b ip kp ir is it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj hb bi translated">对于我们的主程序，面部识别锁，我们需要访问我们计算机的摄像头，所以我将使用Opencv。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="b7ce" class="ld js hi kz b fi le lf l lg lh">import face_recognition as fr<br/>import pickle<br/>import cv2<br/>import os</span></pre><p id="52cc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要从相机中获取帧，我们只需使用cv2。视频捕获():</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="30df" class="ld js hi kz b fi le lf l lg lh">video_capture = cv2.VideoCapture(0)<br/><strong class="kz hj">#if you got two cameras you could use cv2.VideoCapture(1) instead of cv2.VideoCapture(0) to switch between cameras</strong></span></pre><p id="8486" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了使程序工作，我们需要分配一些布尔和列表:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="8c8c" class="ld js hi kz b fi le lf l lg lh">face_is_match = False<strong class="kz hj">#this is not necessary</strong><br/>face_encodings = []</span></pre><p id="5924" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了获取我们之前脚本中的面部数据，我们需要使用以下命令打开pickle文件:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="b37c" class="ld js hi kz b fi le lf l lg lh">known_face_encodings = pickle.load(open('encod.pickle','rb'))</span></pre><p id="43d7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在所有事情都设置好之后，我们需要使用face_recognition模块通过face _ recognition . face _ locations()定位视频捕获的每一帧中的人脸，通过face _ recognition . face _ encodings()对其进行编码，并通过face_recognition.compare_faces()将其与我们的数据进行比较:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="1a46" class="ld js hi kz b fi le lf l lg lh">while True:<br/>        ret, frame = video_capture.read()<br/>        face_locations = fr.face_locations(frame, model="hog")<strong class="kz hj">#can use 'cnn' instead of 'hog'</strong><br/>        face_encodings = fr.face_encodings(frame, face_locations)<br/>        face_names = []<br/>        name = "Unknown"</span><span id="6357" class="ld js hi kz b fi lp lf l lg lh">        for face_encoding in face_encodings:<br/>                matches = fr.compare_faces(known_face_encodings, face_encoding, 0.4)</span></pre><p id="3996" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对于那些不太了解神经网络或人工智能的人来说，<strong class="io hj"> hog被称为有向梯度直方图，cnn被称为卷积神经网络</strong>，你可以从【https://en.wikipedia.org/wiki/Convolutional_neural_network】的<a class="ae li" href="https://en.wikipedia.org/wiki/Convolutional_neural_network" rel="noopener ugc nofollow" target="_blank">和</a><a class="ae li" href="https://en.wikipedia.org/wiki/Histogram_of_oriented_gradients" rel="noopener ugc nofollow" target="_blank">的https://en . Wikipedia . org/wiki/Histogram _ of _ Oriented _ gradients</a>中了解其中两个。在我们的脚本中，它们之间的主要区别是输出数据的速度和准确性，<strong class="io hj">“hog”使用较少的GPU功率，输出精度较低的数据，处理速度较快，但我们需要输入大量的训练数据，这是我们的图像</strong>，而<strong class="io hj">“CNN”使用较多的GPU功率，精度较高，处理速度较慢，但我们可以输入相对较少的训练数据，</strong>您可以根据您的计算机性能在它们之间进行选择。</p><p id="b09c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，在比较之后，如果我们找到与我们的面部匹配的第一个数据，我们可以启动特殊功能，在我的情况下，它是“print ('welcome ')”和“face_is_match =True”:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="338e" class="ld js hi kz b fi le lf l lg lh">if True in matches:<br/>                        first_known_face = matches.index(True)<br/>                        print("Welcome")<br/>                        face_is_match = True<br/>                else:<br/>                        print("Access Denied")</span></pre><p id="9593" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">面部识别锁定脚本到此结束</p><p id="849b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">完整脚本:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="2601" class="ld js hi kz b fi le lf l lg lh">import face_recognition as fr<br/>import pickle<br/>import cv2<br/>import os</span><span id="2f2d" class="ld js hi kz b fi lp lf l lg lh">video_capture = cv2.VideoCapture(0)<br/>face_is_match = False<br/>face_encodings = []<br/>known_face_encodings = pickle.load(open('encode.pickle','rb'))<br/>      <br/>while True:<br/>        ret, frame = video_capture.read()<br/>        face_locations = fr.face_locations(frame, model="hog")<br/>        face_encodings = fr.face_encodings(frame, face_locations)<br/>               <br/>        face_names = []<br/>        name = "Unknown"</span><span id="34fd" class="ld js hi kz b fi lp lf l lg lh">for face_encoding in face_encodings:<br/>                matches = fr.compare_faces(known_face_encodings, face_encoding, 0.4)<br/>            <br/>                #find first match<br/>                if True in matches:<br/>                        first_known_face = matches.index(True)<br/>                        print("Welcome")<br/>                        face_is_match = True<br/>                <br/>                else:<br/>                        print("Access Denied")</span></pre><h1 id="bac3" class="jr js hi bd jt ju lq jw jx jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko bi translated">演示:</h1><figure class="ku kv kw kx fd ij"><div class="bz dy l di"><div class="lv lw l"/></div></figure><p id="605f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">希望你喜欢这个教程！</p></div></div>    
</body>
</html>