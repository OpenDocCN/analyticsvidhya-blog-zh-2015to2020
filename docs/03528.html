<html>
<head>
<title>Build Flipkart Price Tracker using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python构建Flipkart价格跟踪器</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/build-flipkart-price-tracker-using-python-b2271aa41987?source=collection_archive---------7-----------------------#2020-02-06">https://medium.com/analytics-vidhya/build-flipkart-price-tracker-using-python-b2271aa41987?source=collection_archive---------7-----------------------#2020-02-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/510a9cf2fbe12f48abb2beef3a3ca035.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*JMLaDI6ib0UR6g2Hb2TRDA.png"/></div></figure><p id="fd17" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你和我一样穷，买不起他们真实价格的新iPhone。你是做什么的？你等着价格下跌。(说实话，还是比不上降价的iPhone，但如果价格下降，我们会假设我会买😅)毫无疑问，你可以使用成千上万现有的价格下降聚合器中的一个，但是自己建立一个会有多酷呢？让我们开始吧。</p><p id="54a4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，让我们导入我们将需要的包。</p><p id="aa55" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请求:将用于获取网页的HTML代码<br/> smtplib:将用于发送电子邮件<br/> BeautifulSoup:将用于解析网站<br/>时间:持续检查价格下降</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="d798" class="jt ju hi jp b fi jv jw l jx jy">import requests <br/>import smtplib <br/>from bs4 import BeautifulSoup <br/>import time </span></pre><p id="e58b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们已经进口了包装，是时候得到我们想要不断检查价格的产品了。</p><p id="1cec" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这个例子中，我将使用iPhone 11。你可以选择使用任何其他产品。打开产品页面后，复制网址并将其存储在一个变量中，如下所示。</p><figure class="jk jl jm jn fd ij er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es jz"><img src="../Images/8575f8c783bf55ef34f5f85505f48940.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rP81SHKlmPTxsIbeX6OIqg.jpeg"/></div></div></figure><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="6e35" class="jt ju hi jp b fi jv jw l jx jy">URL = '<a class="ae ke" href="https://www.flipkart.com/apple-iphone-11-black-64-gb/p/itm0f37c2240b217?pid=MOBFKCTSVZAXUHGR&amp;lid=LSTMOBFKCTSVZAXUHGREPBFGI'" rel="noopener ugc nofollow" target="_blank">https://www.flipkart.com/apple-iphone-11-black-64-gb/p/itm0f37c2240b217?pid=MOBFKCTSVZAXUHGR&amp;lid=LSTMOBFKCTSVZAXUHGREPBFGI'</a></span></pre><p id="7022" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我们要为HTTP请求中的头定义用户代理。用户代理是一种识别操作系统和发出请求的代理的浏览器的方法。</p><p id="b622" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果你想知道你的用户代理是什么，只需谷歌“我的用户代理”</p><figure class="jk jl jm jn fd ij er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es kf"><img src="../Images/db37ec368bc0617c3287a3c17d08a1a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M4NlnITfIviw6MLlYDaMpQ.jpeg"/></div></div></figure><p id="c89f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在复制用户代理并添加一个字典，如下所示:</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="55bd" class="jt ju hi jp b fi jv jw l jx jy">headers = { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36' }</span></pre><p id="b22d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将首先获取带有提供的URL和标题的网页，并将其存储在一个变量中。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="a05f" class="jt ju hi jp b fi jv jw l jx jy">page = requests.get(URL, headers=headers)</span></pre><p id="7a00" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，我们将使用beautiful soup解析提取并存储在变量“page”中的HTML。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="9282" class="jt ju hi jp b fi jv jw l jx jy">soup = BeautifulSoup(page.content, 'html.parser')</span></pre><p id="a89d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们试着得到产品的名称。用<em class="kg"> Ctrl + Shift + I </em>打开Inspect元素，指向产品名称，您会看到它被封装在一个<em class="kg"> &lt; span/ &gt; </em>标签中，标签上有一个类名<em class="kg"> _35KyD6 </em>。</p><figure class="jk jl jm jn fd ij er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es kh"><img src="../Images/ab3729d904a98794a6a5ca247dd09380.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OR8sT65lOWg5scG4QoZ-tw.jpeg"/></div></div></figure><p id="6981" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">代码看起来会像这样，</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="447a" class="jt ju hi jp b fi jv jw l jx jy">title = soup.find("span", {"class": "_35KyD6"}).get_text()</span></pre><p id="bc21" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以遵循类似的路径来提取价格。</p><figure class="jk jl jm jn fd ij er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es kh"><img src="../Images/9fd3a0492491e0a2ce3ab03955ba374e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8UqCiy5iIQv6oLQ8zp_0dg.jpeg"/></div></div></figure><p id="2c07" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Replace用于删除价格中的逗号。我们使用<em class="kg">【1:】</em>得到没有'₹'符号的价格。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="5fe7" class="jt ju hi jp b fi jv jw l jx jy">price = float(soup.find("div", {"class": "_1vC4OE _3qQ9m1"}).get_text()[1:].replace(',',''))</span></pre><p id="9aa1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">假设我们希望在价格低于55，000时发送电子邮件。现在，让我们将上面写的所有内容包含到check_price()函数中，该函数将检查Flipkart上产品的价格。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="2ead" class="jt ju hi jp b fi jv jw l jx jy">def check_price():<br/>    page = requests.get(URL, headers=headers)<br/>    soup = BeautifulSoup(page.content, 'html.parser')<br/>    <br/>    title = soup.find("span", {"class": "_35KyD6"}).get_text()<br/>    price = float(soup.find("div", {"class": "_1vC4OE _3qQ9m1"}).get_text()[1:].replace(',',''))<br/>    <br/>    print(price)<br/>                        <br/>    if( price &lt; 55000.0 ): <br/>        sendmail()</span></pre><p id="b296" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">是时候定义设置<em class="kg"> sendmail() </em>函数了，该函数将负责在价格下跌时发送电子邮件。</p><p id="3702" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，我们将使用主机名和端口号定义一个SMTP客户端会话。由于我们将使用Gmail发送电子邮件，主机名将为<em class="kg">smtp.gmail.com</em>，端口号为<em class="kg"> 587 </em>。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="f89a" class="jt ju hi jp b fi jv jw l jx jy">server = smtplib.SMTP('smtp.gmail.com', 587)</span></pre><p id="5efa" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后我们将发送一个ehlo()请求。黄玉荣基本上是指由哪些服务器来识别客户端。请求之后，我们将在TLS中启动一个SMTP连接，并重新发送ehlo()。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="ee09" class="jt ju hi jp b fi jv jw l jx jy">server.ehlo() <br/>server.starttls() <br/>server.ehlo()</span></pre><p id="cf26" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，你必须获得Gmail的应用程序密码，才能真正发送电子邮件。为此，请前往<a class="ae ke" href="https://myaccount.google.com/security" rel="noopener ugc nofollow" target="_blank">https://myaccount.google.com/security</a>，然后点击应用程序密码</p><figure class="jk jl jm jn fd ij er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es ki"><img src="../Images/3c304f46d38a39bce8ac852fd7bdf152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9CXtixaGSVjb6fu7Dla-Ng.jpeg"/></div></div></figure><p id="4327" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后选取“邮件”和您所在的设备，然后生成密码。</p><figure class="jk jl jm jn fd ij er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es kj"><img src="../Images/ebe1f824d078df30b3c18a437c25f7b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ikLC22yq2oDPTuH7Cbl51A.png"/></div></div></figure><p id="b0a2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">之后，保存密码和您的电子邮件，如下面的代码所述。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="d71a" class="jt ju hi jp b fi jv jw l jx jy">server.login('your_email@gmail.com', 'your_app_password')</span></pre><p id="2370" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，让我们定义电子邮件的各个方面，如发送电子邮件前的主题和邮件正文。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="cc64" class="jt ju hi jp b fi jv jw l jx jy">subject = 'Hey! Price fell down'<br/>body = 'Check the link ' + URL<br/>msg = f"Subject: {subject}\n\n{body}"</span><span id="9d47" class="jt ju hi jp b fi kk jw l jx jy">server.sendmail('sender_email@gmail.com', 'receiver_email@gmail.com', msg)</span></pre><p id="bbeb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，让我们将上面写的所有内容附到我们的sendmail()函数中，该函数将允许在价格下跌时自动发送电子邮件。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="9902" class="jt ju hi jp b fi jv jw l jx jy">def sendmail():<br/>    '''Function called when the email needs to be sent '''</span><span id="1813" class="jt ju hi jp b fi kk jw l jx jy">    server = smtplib.SMTP('smtp.gmail.com', 587) <br/>    server.ehlo()<br/>    server.starttls() <br/>    server.ehlo()<br/>    <br/>    server.login('xyz@example.com', 'myAppPassword') <br/>    <br/>    subject = 'Hey! Price fell down' <br/>    body = 'Check the link ' + URL <br/>    <br/>    msg = f"Subject: {subject}\n\n{body}" <br/>    <br/>    server.sendmail('sender_email@gmail.com', 'receiver_email@gmail.com', msg)<br/>    <br/>    print('Email Sent')<br/>    <br/>    server.quit() </span></pre><p id="abcc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">完成了。除了…每小时自动检查价格(60*60秒)。为此，我们将借助睡眠功能。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="79c7" class="jt ju hi jp b fi jv jw l jx jy">while(True):<br/>    check_price()<br/>    time.sleep(60*60)</span></pre><p id="1a31" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您可以在Github上用整个python文件检查项目。</p><div class="kl km ez fb kn ko"><a href="https://github.com/mukundmadhav/flipkart-price-tracker" rel="noopener  ugc nofollow" target="_blank"><div class="kp ab dw"><div class="kq ab kr cl cj ks"><h2 class="bd hj fi z dy kt ea eb ku ed ef hh bi translated">mukundmadhav/flipkart-价格跟踪系统</h2><div class="kv l"><h3 class="bd b fi z dy kt ea eb ku ed ef dx translated">用Python写的Flipkart价格跟踪器。通过创建一个……</h3></div><div class="kw l"><p class="bd b fp z dy kt ea eb ku ed ef dx translated">github.com</p></div></div><div class="kx l"><div class="ky l kz la lb kx lc ik ko"/></div></div></a></div><h1 id="656e" class="ld ju hi bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">下一步是什么？</h1><p id="c668" class="pw-post-body-paragraph im in hi io b ip ma ir is it mb iv iw ix mc iz ja jb md jd je jf me jh ji jj hb bi translated">您可以使用相同的自动保存这些数据到一个数据库，并使您自己的价格跟踪网站或出口到一个产品列表的CSV文件。</p></div></div>    
</body>
</html>