<html>
<head>
<title>XML Parsing with Pyspark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Pyspark解析XML</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/xml-parsing-with-pyspark-4a16fbd53ddb?source=collection_archive---------1-----------------------#2020-03-21">https://medium.com/analytics-vidhya/xml-parsing-with-pyspark-4a16fbd53ddb?source=collection_archive---------1-----------------------#2020-03-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="df83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我在《火花深潜》中的一个故事</p><p id="59f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" rel="noopener" href="/@somanathsankaran">https://medium.com/@somanathsankaran</a></p><p id="2494" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Spark是近来事实上的数据处理框架，xml是用于数据的格式之一。</p><p id="38c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看下面。</p><ol class=""><li id="dcbc" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">正在读取XML文件</li><li id="fe95" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">这是如何工作的</li><li id="8772" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">使用XSD验证架构</li></ol><p id="8850" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">读取XML文件</strong></p><p id="68e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了读取xml数据，我们可以利用data bricks(<a class="ae jd" href="https://github.com/databricks/spark-xml" rel="noopener ugc nofollow" target="_blank"><em class="js">spark _ xml</em></a>)中spark的XML包，如下所示</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es jt"><img src="../Images/e27d3b939eba219961ce5327d7ce3111.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*cqPmthicyGLfR15jfRvb-Q.png"/></div></figure><p id="f8f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我有下面的模式2 xml</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es kb"><img src="../Images/8787135485ee69ccdb002c2fd857f604.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*jSy-jmB1tfT5TZywP1j0rw.png"/></div></div></figure><p id="b2aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过提供xml的根标签，我们可以用spark读取xml数据</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es kg"><img src="../Images/76d711fe101569d4d9aa712782b2b4a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*S997kT9QN-mX23EbEDjSJg.png"/></div></figure><p id="f974" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以使用spark.read读取xml数据，方法是提供xml的目录和xml的行标签，这是我们数据的根，如上所示</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es kh"><img src="../Images/c51810c401fefc50e403a6684720a9dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bz9ges9eOKxW4FQh81cgNg.png"/></div></div></figure><p id="a534" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以从上面的图片可以清楚地看到，xml已经被成功解析了</p><p id="ea8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">这是如何工作的</strong></p><p id="dd47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这使用stax XML解析器来解析XML。由于我们没有提供任何schemafile(XSD文件), spark将推断schema，如果某个特定的标签不在xml中，它将被填充为null</p><p id="1974" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，为了说明这一点，我特意删除了其中一个行标签</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es ki"><img src="../Images/6585429f4d0eb7ad9b2bc28c5f95fe91.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*3hAZKSeYgyHShsafmCJO1w.png"/></div></div></figure><p id="e48d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">使用XSD验证模式</strong></p><p id="b674" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">XSD是xml的模式文件，通常由源应用程序提供，它将是消费应用程序验证xml的真实来源。所以在spark中，我们也可以使用</p><p id="2391" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kj kk kl km b"><strong class="ih hj">rowValidationXSDPath after adding the xsd file using </strong><a class="ae jd" href="https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.SparkContext@addFile(path:String):Unit" rel="noopener ugc nofollow" target="_blank">SparkContext.addFile</a> as the local xsd file will not available in all executors</code></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es kn"><img src="../Images/32a453a05f12eb556f31c6bfd27d7be1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DCTnCNG5RDl625uTk2-nbA.png"/></div></div></figure><p id="17fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我刚刚显示了模式，如果我们看到损坏的记录字段被添加，因为我们有损坏的xml</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es ko"><img src="../Images/182b4fa1fa98ecd0a85bc5f24008e9cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xn59ZKuPcuaQ95UhMWK4dg.png"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es kp"><img src="../Images/abfe069be247605a9a805df04823c58c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*M0wRHLGMHR8uvyrgt59CMw.png"/></div></figure><p id="74a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">结论:</strong></p><p id="2d57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"/></p><p id="6add" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天就到这里吧！！:)</p><p id="6cc6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Github链接:<a class="ae jd" href="https://github.com/SomanathSankaran/spark_medium/tree/master/spark_xml" rel="noopener ugc nofollow" target="_blank">https://github . com/SomanathSankaran/spark _ medium/tree/master/spark _ XML</a></p><p id="e7c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="js">请给我发spark中我必须涉及的话题，并给我提供改进写作的建议:)</em> </strong></p><p id="5d08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">学习，也让别人学习！！</strong></p></div></div>    
</body>
</html>