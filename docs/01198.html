<html>
<head>
<title>Recommendation system using fastai</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用fastai的推荐系统</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/collaborative-filtering-a-sincere-perspicacity-ad034113878b?source=collection_archive---------3-----------------------#2019-10-08">https://medium.com/analytics-vidhya/collaborative-filtering-a-sincere-perspicacity-ad034113878b?source=collection_archive---------3-----------------------#2019-10-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="6be3" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">当我第一次读到协同过滤时，我发现它要严格得多。所以，我花了很多天才带着些许满足感理解了这个概念。从那以后，我将尽我所能用最简单的方式来烹饪这个概念。我将解释关于fastai库的协同过滤。所以，忍耐一下，让我们开始吧。</h2></div><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es iy"><img src="../Images/6ec269e9008685681ba907a26b22d646.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8IgqRnvwpO6U5T_LhVxxtA.jpeg"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">图片由<a class="ae jo" href="https://pixabay.com/photos/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1149416" rel="noopener ugc nofollow" target="_blank">免费提供-照片</a>来自<a class="ae jo" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1149416" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></figcaption></figure><p id="7abd" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><strong class="jr hj"> ❓什么是协同过滤</strong></p><p id="d51f" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">协同过滤知识用于制定推荐系统。大多数主要的IT公司都在使用这项技术来吸引用户，了解用户，这样他们就可以根据他们的兴趣向他们推荐东西。现在，如果我们看一下我们得到的用于分析的数据，它通常是下面的格式。</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es kl"><img src="../Images/6cd95261b206c941e40335639a2a1a68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CzJEhlI_Rk4DbtWvIrORpQ.png"/></div></div></figure><ul class=""><li id="644a" class="km kn hi jr b js jt jv jw jy ko kc kp kg kq kk kr ks kt ku bi translated">通常，我们以第一种格式存储数据。如果你把它保存为一个矩阵，每个客户和产品的组合都是这个矩阵中的一个单独的单元，那么它将会是巨大的。</li><li id="cba1" class="km kn hi jr b js kv jv kw jy kx kc ky kg kz kk kr ks kt ku bi translated">所以要么你倾向于像左图那样存储，要么你可以用某种独特的稀疏矩阵格式保存为矩阵。</li></ul><p id="fb9c" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">为了获得实际的见解，我使用了fastai提供的学术数据集，即GroupLens创建的MovieLens。</p><p id="c500" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><strong class="jr hj"> ❓什么是冷启动问题</strong></p><p id="cdf3" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">冷启动问题主要由以下原因引起:</p><ul class=""><li id="4023" class="km kn hi jr b js jt jv jw jy ko kc kp kg kq kk kr ks kt ku bi translated">当新用户来到网站时，由于缺少关于用户的元数据，向用户推荐电影变得具有挑战性。</li><li id="ea28" class="km kn hi jr b js kv jv kw jy kx kc ky kg kz kk kr ks kt ku bi translated">当一部新电影到来时，我们没有关于这部电影的任何信息，除非并且直到一些用户对这部电影进行评级。</li></ul><p id="8a4e" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我们可以通过询问用户一些问题来收集关于他们的元数据，从而解决冷启动问题。</p><h1 id="2656" class="la lb hi bd lc ld le lf lg lh li lj lk io ll ip lm ir ln is lo iu lp iv lq lr bi translated">在幕后</h1><p id="2690" class="pw-post-body-paragraph jp jq hi jr b js ls ij ju jv lt im jx jy lu ka kb kc lv ke kf kg lw ki kj kk hb bi translated">在协同过滤问题中，我们首先对每个用户和每部电影随机加权。</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es lx"><img src="../Images/63dccada1c162d21356b0865d9fadc32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e737ymDfvJ74YP_rCWwI6w.png"/></div></div></figure><ul class=""><li id="cb85" class="km kn hi jr b js jt jv jw jy ko kc kp kg kq kk kr ks kt ku bi translated">每个移动和每个用户的随机权重如上所示。我们可以为每个电影和用户选择任意数量的权重，但是用户和电影的数量应该相同。</li><li id="8857" class="km kn hi jr b js kv jv kw jy kx kc ky kg kz kk kr ks kt ku bi translated">任何用户对任何电影的评级是通过分别对电影和用户的相应权重的点积的和来获得的。神经网络的一个基本出发点是，你对两个矩阵进行矩阵乘法，这就是你的第一层，这也是我们所做的。</li><li id="a52e" class="km kn hi jr b js kv jv kw jy kx kc ky kg kz kk kr ks kt ku bi translated">所以我们想出了一些方法，来说明我们可以相乘的两个矩阵是什么。显然，你需要一个用户的向量(一个所有用户的矩阵)和一个电影的向量(一个所有电影的矩阵)并将它们相乘，你会得到一些数字。所以它们还没有任何意义。它们只是随机数。</li><li id="cb1f" class="km kn hi jr b js kv jv kw jy kx kc ky kg kz kk kr ks kt ku bi translated">宣布评级后，我们计算实际评级和预测评级之间的RMSE损失。然后，神经网络的正常行为开始，权重被调整以减少损失。</li><li id="99e3" class="km kn hi jr b js kv jv kw jy kx kc ky kg kz kk kr ks kt ku bi translated">这就是为特定用户和特定电影设置权重的方式。</li><li id="5d84" class="km kn hi jr b js kv jv kw jy kx kc ky kg kz kk kr ks kt ku bi translated">现在，我们已经为这种情况定义了最无聊的神经网络，它有一个线性层和一个非线性层(你马上就会知道)。但这就是你解决问题所需要的。🆓</li><li id="76eb" class="km kn hi jr b js kv jv kw jy kx kc ky kg kz kk kr ks kt ku bi translated">上面的唯一缺点是它不是稀疏存储。但是，我们会尽快调查。</li></ul><h1 id="f8d1" class="la lb hi bd lc ld le lf lg lh li lj lk io ll ip lm ir ln is lo iu lp iv lq lr bi translated">一些实用的东西</h1><p id="6edc" class="pw-post-body-paragraph jp jq hi jr b js ls ij ju jv lt im jx jy lu ka kb kc lv ke kf kg lw ki kj kk hb bi translated">现在，我将使用fastai库编写代码。我们会在了解更多的同时一点一点的理解代码。</p><p id="a887" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">Fastai创建了一个电影评论的样本数据集，我将使用它。</p><pre class="iz ja jb jc fd ly lz ma mb aw mc bi"><span id="9752" class="md lb hi lz b fi me mf l mg mh">from fastai import *<br/>from fastai.collab import *</span><span id="dcb1" class="md lb hi lz b fi mi mf l mg mh">path = untar_data(URLs.ML_SAMPLE); path</span><span id="e7b9" class="md lb hi lz b fi mi mf l mg mh">= PosixPath('/root/.fastai/data/movie_lens_sample')</span><span id="3f75" class="md lb hi lz b fi mi mf l mg mh">ratings = pd.read_csv(path/'ratings.csv')<br/>ratings.head()</span></pre><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es mj"><img src="../Images/9db686b7af71a579d995c7aa7691abde.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*uzzmm4DhNaJ5n5Xjxz2KTQ.png"/></div></div></figure><p id="1910" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">像往常一样，现在我们将创建数据束。我会CollabDataBunch，主要在fastai中定义，用于协同过滤。</p><pre class="iz ja jb jc fd ly lz ma mb aw mc bi"><span id="4b41" class="md lb hi lz b fi me mf l mg mh">data = CollabDataBunch.from_df(ratings, seed=42)</span></pre><p id="cf5b" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">定义了数据束之后，我们需要定义学习者。像CollabDataBunch，我们CollabLearner。</p><pre class="iz ja jb jc fd ly lz ma mb aw mc bi"><span id="594d" class="md lb hi lz b fi me mf l mg mh">y_range = [0,5.2]</span><span id="1a66" class="md lb hi lz b fi mi mf l mg mh">learn = collab_learner(data, n_factors=50, y_range=y_range)</span></pre><ul class=""><li id="0038" class="km kn hi jr b js jt jv jw jy ko kc kp kg kq kk kr ks kt ku bi translated">collab_learner用于创建一个学习者，以便对数据进行协同过滤。</li><li id="0296" class="km kn hi jr b js kv jv kw jy kx kc ky kg kz kk kr ks kt ku bi translated">y_range被定义为限制范围之间的结果。在内部，collab_learner使用非线性sigmoid函数作为最后一层。从统计学上讲，sigmoid函数在我们定义的范围内渐近。因此，我们定义了上述范围，以便我们可以获得大于0且小于5.2的用户评分。现在，添加乙状结肠是没有必要的。我们的模型可以学习预测评级和分级其权重，但是，我们希望我们的模型花大部分时间来学习我们想要的范围内的东西。因此，我们的模型将以这样的方式设置其权重/参数，使得结果(即评级)位于0到5.5之间。</li></ul><figure class="iz ja jb jc fd jd er es paragraph-image"><div class="er es mk"><img src="../Images/75ae3975c049822ceb524323b5967554.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*jVgoziu__sw9ABYaDnUDlQ.png"/></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">乙状结肠()</figcaption></figure><ul class=""><li id="8210" class="km kn hi jr b js jt jv jw jy ko kc kp kg kq kk kr ks kt ku bi translated">n _ factors——我们稍后会了解它，但现在你可能认为它等于我们为上面的用户和电影定义的随机权重数。稍后在神经网络中的那些权重被认为是不同的特征/因素，例如电影是否有特定的女演员/男演员，或者用户是否喜欢任何特定男演员/女演员的电影，并且电影有它，这有助于神经网络更好地了解电影和用户。</li></ul><pre class="iz ja jb jc fd ly lz ma mb aw mc bi"><span id="a8da" class="md lb hi lz b fi me mf l mg mh">learn.fit_one_cycle(3, 5e-3)</span></pre><figure class="iz ja jb jc fd jd er es paragraph-image"><div class="er es ml"><img src="../Images/81c0f9f69a570c79bdba8688f811bc5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*uJFvTKDQpgmK-iHz6ev45A.png"/></div></figure><p id="d5a5" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">这就是我们如何使用fastai进行协同过滤。现在，我们将挖掘出这些概念，并找出上述可怕代码背后的一切。😆</p><h1 id="43de" class="la lb hi bd lc ld le lf lg lh li lj lk io ll ip lm ir ln is lo iu lp iv lq lr bi translated">collab _ learner里面有什么</h1><p id="ce04" class="pw-post-body-paragraph jp jq hi jr b js ls ij ju jv lt im jx jy lu ka kb kc lv ke kf kg lw ki kj kk hb bi translated">如果您将看到collab_learner的fastai代码，它将创建两种类型的模型，如下图中突出显示的。</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es mm"><img src="../Images/ec219e427e4532e3cb99387d3b892d76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3bpupGEGxjnW7dr1Lt1srQ.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">collab_learner()</figcaption></figure><p id="dedd" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">让我们来看看上面强调的一个模型。</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es mn"><img src="../Images/a2380d6061f4fe55549e7cd2c590383a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1QN9RYcgIEtFrpAo2SzFxA.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">嵌入点偏差()</figcaption></figure><figure class="iz ja jb jc fd jd er es paragraph-image"><div class="er es mo"><img src="../Images/42a5693ddfa73fcdab235d93a65fced3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*WpBG0qkg-ImzF-HRgQgP9Q.png"/></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">嵌入()</figcaption></figure><ul class=""><li id="7411" class="km kn hi jr b js jt jv jw jy ko kc kp kg kq kk kr ks kt ku bi translated">我们正在为我们如上所述初始化的随机权重/参数创建嵌入矩阵。现在，我们为什么要创建嵌入矩阵，它的用途是什么，我们将在下面讨论，但现在，让我们清楚地知道，我们正在创建类似嵌入的东西，用于存储为电影和用户定义的权重。如果你看到上面创建嵌入矩阵的代码，我们只调用PyTorch嵌入。</li><li id="ad49" class="km kn hi jr b js kv jv kw jy kx kc ky kg kz kk kr ks kt ku bi translated">如果你了解PyTorch nn的基础知识。模块，那么您可能知道forward是在dunder init函数之后自动调用的。而forward函数内部的内容我们已经很熟悉了。</li><li id="2e07" class="km kn hi jr b js kv jv kw jy kx kc ky kg kz kk kr ks kt ku bi translated">我们正在增加随机电影和用户权重。那我们就是在给它加上偏见。然后我们比较是否定义了y_range，然后我们应用sigmoid函数，否则我们返回值。</li></ul><h2 id="7352" class="md lb hi bd lc mp mq mr lg ms mt mu lk jy mv mw lm kc mx my lo kg mz na lq nb bi translated">❓什么是嵌入</h2><p id="cdb6" class="pw-post-body-paragraph jp jq hi jr b js ls ij ju jv lt im jx jy lu ka kb kc lv ke kf kg lw ki kj kk hb bi translated">嵌入只是一个数组查找。我们可以从嵌入矩阵中提取一个向量。这是一个重量矩阵，你基本上可以从中查找，并从中抓取一个项目。顾名思义，它嵌入了信息，并让用户广泛地查看它。它是一个热编码矩阵乘以另一个矩阵的收缩。当我们说我们有用于用户和电影的嵌入矩阵时，我们指的是下面的。</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div class="er es nc"><img src="../Images/0b21b175d6adbaf3380385040e166005.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*W-F9PKTOGqlzspxElxEGkA.png"/></div></figure><ul class=""><li id="535a" class="km kn hi jr b js jt jv jw jy ko kc kp kg kq kk kr ks kt ku bi translated">黄色的向量是id为0.82的用户的嵌入矩阵。红色的向量是id为1.26的用户的嵌入矩阵。</li></ul><figure class="iz ja jb jc fd jd er es paragraph-image"><div class="er es nd"><img src="../Images/f30c025f8740ec4977f7f35fb1e6091a.png" data-original-src="https://miro.medium.com/v2/resize:fit:526/format:webp/1*yKE8o7y9XmbLvKbTqzqj4A.png"/></div></figure><ul class=""><li id="1286" class="km kn hi jr b js jt jv jw jy ko kc kp kg kq kk kr ks kt ku bi translated">与上面类似，黄色的vector是id为2.39的电影的嵌入矩阵。红色的向量是id为1.13的电影的嵌入矩阵。</li></ul><p id="e6b7" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">现在，问题出现了<strong class="jr hj"> ❔为什么我们使用嵌入</strong></p><p id="038d" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">如前所述，嵌入是某事物的独热编码版本和输入权重的乘积。如果它是用户嵌入矩阵，那么它是独热编码用户矩阵和如上定义的用户输入权重的乘积。如果它是用于电影的，那么它是独热编码电影矩阵和用于电影的输入权重的乘积，如上所述。所以，让我们用图表来理解它。</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es ne"><img src="../Images/371e09b3959fef55f15267bcef339937.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DE4Ec7hkiCO9LGfWWVZe1Q.png"/></div></div></figure><ul class=""><li id="3b64" class="km kn hi jr b js jt jv jw jy ko kc kp kg kq kk kr ks kt ku bi translated">现在，如果你理解了上面的操作，那么我们基本上是用输入用户激活乘以一个热编码的用户矩阵。</li><li id="ca96" class="km kn hi jr b js kv jv kw jy kx kc ky kg kz kk kr ks kt ku bi translated">现在，对于每个输入的独热编码用户向量，用户输入权重中的向量对应于相同的位置。对于具有输入id 1的用户，用户权重矩阵中的向量也在相同的索引处。</li><li id="016e" class="km kn hi jr b js kv jv kw jy kx kc ky kg kz kk kr ks kt ku bi translated">因此，我们可以做数组查找来节省内存，并且运算会更快，而不是像上面显示的那样再做一次矩阵乘法。</li><li id="5f53" class="km kn hi jr b js kv jv kw jy kx kc ky kg kz kk kr ks kt ku bi translated">这就是为什么我们定义和使用嵌入——一种数组查找。</li></ul><figure class="iz ja jb jc fd jd er es paragraph-image"><div class="er es nf"><img src="../Images/9b33873e3392ff1831d0e284d15359d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*4Ov10wCEAKJ5pztlB7D77A.png"/></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">用户嵌入</figcaption></figure><p id="58cb" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><strong class="jr hj"> ❓What是潜在的特征</strong></p><p id="d392" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">在为用户和矩阵定义的权重背后有命令性的语义。我们可以认为权重代表与用户或电影相关的一些特征。现在，我不是说重量定义了令人兴奋的东西，但是我们可以这样想。如果在通过梯度下降优化权重之后，如果我们得到用户的特定权重高，并且电影中的相应权重也高，那么我们可以将喜欢用户与喜欢特定女演员(如朴雅卡·乔普拉)联系起来，并且电影中有女主角。或者我们可以推断它是动画电影并且用户喜欢动画电影。我仍然对神经网络内部发生的事情持怀疑态度，但这种梯度下降可能得出一个好答案的唯一方式是，如果它找出电影品味的各个方面以及电影的相应特征。那些出现的潜在特征被称为<strong class="jr hj">潜在因素或潜在特征</strong>。它们是这些一直存在的隐藏的东西，一旦我们训练了这个神经网络，它们就会突然出现，或者我们突然试图将这些点连接起来。</p><p id="ecb4" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">现在，如果你记得你可能必须学习的主要神经网络，我们总是添加一个除矩阵乘法之外的术语，那就是所谓的<strong class="jr hj">偏差</strong>。现在，我们也将在上面的例子中加入偏差。参考上面的EmbeddingDotBias()，可以看到我们为用户和电影都声明了偏差。你可能会认为添加偏见是一件普通的琐事，但在这里它可能意味着别的东西。让我们明白这种偏见意味着什么。</p><h2 id="1046" class="md lb hi bd lc mp mq mr lg ms mt mu lk jy mv mw lm kc mx my lo kg mz na lq nb bi translated">❓偏见是怎么定义的</h2><p id="fe1d" class="pw-post-body-paragraph jp jq hi jr b js ls ij ju jv lt im jx jy lu ka kb kc lv ke kf kg lw ki kj kk hb bi translated">考虑以下两种情况:</p><ul class=""><li id="fc62" class="km kn hi jr b js jt jv jw jy ko kc kp kg kq kk kr ks kt ku bi translated">如果我们能想到一个特定的用户，他通常对电影评价很高，即使这部电影很差并且它的评价很低。</li><li id="ed48" class="km kn hi jr b js kv jv kw jy kx kc ky kg kz kk kr ks kt ku bi translated">或者，如果我们可以想到一部有威尔·史密斯的电影，每个人都喜欢他和他的电影，所以我们对威尔·史密斯电影的权重定义很高，但接下来有一部有威尔·史密斯的电影，但这部电影不是很棒。</li></ul><p id="2da2" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">现在，在上述两种情况下，我们不能改变一些特定的穷人和反对情况的一般权重，然后我们为用户和电影定义偏差。因此，对于威尔·史密斯的那部差电影的偏差将是低的，并且类似地，对于通常评价电影高但是电影总体上差的用户的偏差将具有小的偏差。偏差通常被添加到相乘后的矩阵中。我们可以用这些偏见来解释结果。</p></div><div class="ab cl ng nh gp ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="hb hc hd he hf"><p id="5335" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">之前，我使用了fastai提供的电影评论样本数据集。现在，让我们尝试使用来自http://files.grouplens.org/datasets/movielens/ml-100k.zip<a class="ae jo" href="http://files.grouplens.org/datasets/movielens/ml-100k.zip" rel="noopener ugc nofollow" target="_blank">的完整Movielens 100k数据集。</a></p><p id="bab9" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">如果你用的是google collab，那就把zip文件上传到目录下。我们主要需要<code class="du nn no np lz b">u.data</code>和<code class="du nn no np lz b">u.item</code>。</p><pre class="iz ja jb jc fd ly lz ma mb aw mc bi"><span id="73c3" class="md lb hi lz b fi me mf l mg mh">ratings = pd.read_csv('/content/u.data', delimiter='\t', header=None, names=['userId','movieId','rating','timestamp'])</span><span id="7b3e" class="md lb hi lz b fi mi mf l mg mh">ratings.head()</span></pre><figure class="iz ja jb jc fd jd er es paragraph-image"><div class="er es nq"><img src="../Images/ee6a0dfb3c72d7abd21ece361a4ff774.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*AOCQS81xGkM5o9PxbO3fTw.png"/></div></figure><pre class="iz ja jb jc fd ly lz ma mb aw mc bi"><span id="1a64" class="md lb hi lz b fi me mf l mg mh">movies = pd.read_csv('/content/u.item',  <strong class="lz hj">delimiter</strong>='|', <strong class="lz hj">encoding</strong>='latin-1', <strong class="lz hj">header</strong>=None, <strong class="lz hj">names</strong>=['userId', 'movieId', 'date', 'N', 'url', *[f'g{i}' for i in range(19)]])</span><span id="9aa4" class="md lb hi lz b fi mi mf l mg mh">movies.head()</span></pre><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es nr"><img src="../Images/068e9ab6b966a5c10a71f691b2e6a3c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nM9hzN2vL3OetliX05qq8A.png"/></div></div></figure><p id="f71f" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">让我们合并电影标题和分级表，如下所示。</p><pre class="iz ja jb jc fd ly lz ma mb aw mc bi"><span id="ae5e" class="md lb hi lz b fi me mf l mg mh">rating_movie = ratings.merge(movies[['movieId', title]])<br/>rating_movie.head()</span></pre><figure class="iz ja jb jc fd jd er es paragraph-image"><div class="er es ns"><img src="../Images/644e3a2f16450a1e82f40c1a586915e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*RSaalkeS9uNgRlHTMeRtjg.png"/></div></figure><p id="1e6c" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">默认情况下，CollabDataBunch假设您的第一列是用户，第二列是项目，第三列是评级。但是现在我们要使用标题列作为项目，所以我们必须告诉它项目列的名称是什么(<code class="du nn no np lz b">item_name=title</code>)。</p><pre class="iz ja jb jc fd ly lz ma mb aw mc bi"><span id="6894" class="md lb hi lz b fi me mf l mg mh">data = CollabDataBunch.from_df(rating_movie, seed=42, valid_pct=0.1, item_name=title)</span><span id="0fc3" class="md lb hi lz b fi mi mf l mg mh">data.show_batch()</span></pre><figure class="iz ja jb jc fd jd er es paragraph-image"><div class="er es nt"><img src="../Images/a0bf333d5c64ac3ca6a05e9ca7bfe3f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/format:webp/1*qFzEKUa9E_VIYzfcXenOkg.png"/></div></figure><pre class="iz ja jb jc fd ly lz ma mb aw mc bi"><span id="ae46" class="md lb hi lz b fi me mf l mg mh">learn = collab_learner(data, n_factors=40, y_range=y_range, wd=1e-1)<br/>learn.fit_one_cycle(6, 5e-3)</span><span id="837d" class="md lb hi lz b fi mi mf l mg mh">learn.save('movie-reviews')</span></pre><h1 id="372e" class="la lb hi bd lc ld le lf lg lh li lj lk io ll ip lm ir ln is lo iu lp iv lq lr bi translated">解释偏差</h1><p id="a1e4" class="pw-post-body-paragraph jp jq hi jr b js ls ij ju jv lt im jx jy lu ka kb kc lv ke kf kg lw ki kj kk hb bi translated">现在，为用户帐户定义的偏见如果用户喜欢动漫电影，并且有很多动漫电影，我们就会有电影偏见，对电影的偏见会告诉我们哪部电影最好，以及为什么与其他电影相比，人们会评价或喜欢这部电影。</p><pre class="iz ja jb jc fd ly lz ma mb aw mc bi"><span id="87b8" class="md lb hi lz b fi me mf l mg mh"><strong class="lz hj">g</strong> = rating_movie.groupby(title)['rating'].count()<br/><strong class="lz hj">top_movies</strong> = g.sort_values(ascending=False).index.values[:1000]<br/><strong class="lz hj">top_movies</strong>[:10]</span><span id="1eee" class="md lb hi lz b fi mi mf l mg mh"><strong class="lz hj">movie_bias</strong> = learn.bias(top_movies, is_item=True)<br/><strong class="lz hj">ratings</strong> = [(b, i) for i,b in zip(top_movies,movie_bias)]</span><span id="0a59" class="md lb hi lz b fi mi mf l mg mh">sorted(ratings)[:15]</span></pre><p id="6b76" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">所以<code class="du nn no np lz b">is_item=True</code>，你可以通过<code class="du nn no np lz b">True</code>说我想要项目(电影)的偏见，或者通过<code class="du nn no np lz b">False</code>说我想要用户。</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div class="er es nu"><img src="../Images/b2b1476ec64def2cf72b47137217c548.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*-jFqHqBOhKzFKUexvFjdEA.png"/></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">偏见越少的电影评级越低</figcaption></figure><figure class="iz ja jb jc fd jd er es paragraph-image"><div class="er es nv"><img src="../Images/e501ef91dd2558761a2e17649dbf1dc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*zZa3q4CBdXvOWJbG7r7hTg.png"/></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">有更多偏见的电影会得到更多评价</figcaption></figure><p id="d057" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">所以，这就是你如何使用fastai中定义的协同过滤技术向用户推荐比其他电影更受欢迎的电影。</p></div></div>    
</body>
</html>