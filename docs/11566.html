<html>
<head>
<title>Thompson Sampling for Multi-Armed Bandit Problem</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">多臂土匪问题的Thompson抽样</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/thompson-sampling-for-multi-armed-bandit-problem-68e4d367a21e?source=collection_archive---------7-----------------------#2020-12-09">https://medium.com/analytics-vidhya/thompson-sampling-for-multi-armed-bandit-problem-68e4d367a21e?source=collection_archive---------7-----------------------#2020-12-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/1bf85fff74fbcf7bdcbf9a3fd709c343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uuMR7oJy6-4-_piSG-f8sA.png"/></div></div></figure><div class=""/><p id="3085" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我们将了解汤普森采样，它的算法和实现。还会有一些关于汤普森采样算法中使用的贝塔分布的讨论。</p><h2 id="d7b5" class="jp jq ht bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">坚果壳中的多臂土匪问题</h2><p id="55a1" class="pw-post-body-paragraph iq ir ht is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">多臂土匪问题是强化学习中的一个经典问题，其中一个赌徒走进赌场，在多个单臂吃角子老虎机上赌博。他最初尝试探索机器以找到最佳奖励给予机器，并且在一些初始回合之后，他利用给予最大奖励的机器。</p><figure class="kq kr ks kt fd hk er es paragraph-image"><div class="er es kp"><img src="../Images/9cd38346048f625dc34711363998d621.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*W0cEzdrL9-E1fljc8y7Lrg.jpeg"/></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">来源:<a class="ae ky" href="https://www.123rf.com/photo_99072826_stock-vector-slot-machine-one-armed-bandit-game-device-roulette-gambling-video-games-vector-illustration-.html" rel="noopener ugc nofollow" target="_blank">https://www . 123 RF . com/photo _ 99072826 _股票-矢量-老虎机-独臂-土匪-游戏装置-轮盘赌-赌博-视频-游戏-矢量-插图-。html </a></figcaption></figure><h2 id="1cd9" class="jp jq ht bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">汤普森取样</h2><p id="d281" class="pw-post-body-paragraph iq ir ht is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">Thompson采样是一种随机化算法，最有效地用于解决这个经典的多臂土匪问题。它通过在其他机器中选择具有最佳采样均值(从beta分布生成)的机器来实现探索。随着赌博回合数的增加，贝塔分布越来越集中在经验平均值周围。</p><p id="7147" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你不太明白，那么只要记住，基本的想法是根据机器成为最佳奖励机器的概率来选择机器。</p><p id="2288" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你已经知道Beta发行版，你可以跳过这一部分。</p></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><h2 id="e1b3" class="jp jq ht bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">贝塔分布</h2><p id="d980" class="pw-post-body-paragraph iq ir ht is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">贝塔分布是根据θ<strong class="is hu">θ </strong>的<br/>定义的连续分布，θ是两个参数<strong class="is hu"> a </strong>和<strong class="is hu"> b </strong>的函数。</p><p id="0658" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数学上，<br/> <strong class="is hu"> P(θ | a，b) = (θ ^(a -1)) *((1 — θ)^(b-1)) / B( a，b ) </strong></p><p id="e4d6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里，<strong class="is hu"> B(a，b) </strong>是归一化常数，它是<strong class="is hu"> a </strong>和<strong class="is hu"> b </strong>的β函数<br/>。这个分母不是变量<strong class="is hu"> θ </strong>的函数。它只是确保概率分布整合为1。</p><p id="8032" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以，我们可以说<strong class="is hu"> P(θ | a，b)</strong><strong class="is hu">∝θ^(a-1)*(1-θ)^(b-1)</strong>其中<strong class="is hu">θ</strong><strong class="is hu">∈【0，1】</strong>。</p><h2 id="c09d" class="jp jq ht bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">贝塔分布如何随参数a和b变化？</h2><p id="5a41" class="pw-post-body-paragraph iq ir ht is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated"><strong class="is hu">情况1 </strong>:当<em class="jo"> a = 0.5 </em>和<em class="jo"> b = 0.5 </em>时</p><p id="256f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo"> P(θ | a，b) = (θ ^(a -1)) *((1 — θ)^(b-1)) / B( a，b ) <br/> </em> = &gt; P(θ | 0.5，0.5)<strong class="is hu">∞</strong>θ^(0.5–1)*(1-θ)<br/>=&gt;p(θ| 0.5，0.5)<strong class="is hu">∧</strong>θ^(-0.5)*(1-θ)^(-0.5)<br/>=<br/></p><figure class="kq kr ks kt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lg"><img src="../Images/069b97fc5f63f7bbaa57552e494d65dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vljnfXlaTkYGq9ltgmtC6A.jpeg"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">a = 0.5，b = 0.5</figcaption></figure><p id="5159" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以清楚地看到，对于θ = 0或1，贝塔分布趋向于∞(无穷大)。</p><p id="337b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">情况二</strong>:当<em class="jo"> a = 0.5 </em>和<em class="jo"> b = 1 </em>时</p><p id="8685" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo"> P(θ | a，b) = (θ ^(a -1)) *((1 — θ)^(b-1)) / B( a，b ) <br/> </em> = &gt; P(θ | 0.5，1)<strong class="is hu">∧</strong>θ^(0.5–1)*(1-θ)^(1–1)<br/>=&gt;p(θ| 0.5，1)<strong class="is hu">∧</strong>θ^(-0.5)* 1<br/>=<br/></p><figure class="kq kr ks kt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lh"><img src="../Images/1da25b690264f478bc3f6a558a8a4dfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gARxf0m4vQwXeZyehf_6Ww.jpeg"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">a = 0.5，b = 1</figcaption></figure><p id="0a81" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以清楚地看到，如果θ = 0，β分布趋于∞(无穷大),如果θ= 1，β分布与常数1成比例</p><p id="d6bc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">情况二</strong>:当<em class="jo"> a = 1 </em>且<em class="jo"> b = 1 </em>时</p><p id="e57a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo"> P(θ | a，b) = (θ ^(a -1)) *((1 — θ)^(b-1)) / B( a，b ) <br/> </em> = &gt; P(θ | 1，1)<strong class="is hu">∞</strong>θ^(1–1)*(1-θ)<br/>=&gt;p(θ| 1，1)<strong class="is hu">∞</strong>1 * 1<br/>=&gt;p(θ| 1，</p><figure class="kq kr ks kt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es li"><img src="../Images/7d847e0dfe87755d4edbba67773cd005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O-pomB32XGTZ8WZEHEOT1Q.jpeg"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">a = 1，b = 1</figcaption></figure><p id="42ca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以清楚地看到，对于任何θ值，贝塔分布与常数1成正比。</p><p id="880e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">情况4 </strong>:当<em class="jo"> a &gt; 1 </em>、<em class="jo"> b &gt; 1且a = b </em>时</p><p id="dcf3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo"> P(θ | a，b) = (θ ^(a -1)) *((1 — θ)^(b-1)) / B( a，b ) <br/> </em>分布有最大值0.5。即使我们进一步增加a和b甚至<br/>，分布也更加指向0.5。</p><figure class="kq kr ks kt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lj"><img src="../Images/b207d4a8f368f8b06bbfa716a5a8afe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1n-DK19wuL_ajYL6kbWNEw.jpeg"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">a = 3，b = 3</figcaption></figure><p id="edf1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">情况5 </strong>:当<em class="jo"> a &gt; 1 </em>、<em class="jo"> b &gt; 1和a！= b </em></p><p id="01c9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo"> P(θ | a，b) = (θ ^(a -1)) *((1 — θ)^(b-1)) / B( a，b ) <br/> </em>我们不必同时增加a和b .如果我们计算<br/> Beta分布的均值那么θ的期望值</p><p id="5897" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">e[θ]= a/(a+b)</p><p id="68c3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以，如果我们增加b，那么分布会向左移动。如果我们增加a，那么分布将向右移动。</p><figure class="kq kr ks kt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lk"><img src="../Images/9a7489fc6823aa5d300599ae8fa27e59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*en3ahkR8OESRxcew_XOn5Q.jpeg"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">a = 2，b = 3</figcaption></figure><figure class="kq kr ks kt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ll"><img src="../Images/3fd3ca499aafc664da285af82816123b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7-W-mYEYn8lV6M8rtgg3yQ.jpeg"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">a = 3，b = 2</figcaption></figure></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><h2 id="1468" class="jp jq ht bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">汤普森采样算法</h2><p id="9beb" class="pw-post-body-paragraph iq ir ht is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">步骤1:在每一轮n，考虑每台机器m的两个数字<br/>→nᵢ(n)——机器m到第n轮得到奖励1的次数<br/>→nᵢ⁰(n)——机器m到第n轮得到奖励0的次数</p><p id="77f6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第二步:对于每台机器m，我们从下面的分布中随机抽取:<br/> θᵢ(n) = β( Nᵢ (n) + 1，Nᵢ⁰(n) + 1)</p><p id="43d7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">步骤3:选择θᵢ(n).最高的机器</p></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><h2 id="9c31" class="jp jq ht bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">求解多臂土匪问题的Thompson采样算法实现</h2><p id="637a" class="pw-post-body-paragraph iq ir ht is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">假设一个娱乐场有5台吃角子老虎机，一个赌徒带着100个硬币来赌博并从机器中获得最大回报。</p><p id="dd15" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我使用了这个<a class="ae ky" href="https://drive.google.com/file/d/1fScH4hOaVBFmPAanGWQV87XFi1W0CruJ" rel="noopener ugc nofollow" target="_blank"> MultiArmedBandit.csv </a>数据集和以下代码:</p><figure class="kq kr ks kt fd hk"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="b128" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我得到了以下的视觉化图像:</p><figure class="kq kr ks kt fd hk er es paragraph-image"><div class="er es lo"><img src="../Images/753d68419c13d68888b2bea635c72712.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*rbcai2CYRkUMfxLUpLWxCw.jpeg"/></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">机器5给出更高的回报</figcaption></figure><p id="db57" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可以清楚地看到，如果游戏者将他的钱赌在机器5上，那么他将获得最大回报。</p></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><h2 id="236f" class="jp jq ht bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">它到底是怎么发生的？</h2><p id="38f2" class="pw-post-body-paragraph iq ir ht is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">让我们一步步了解。在此之前，我希望你在另一个<a class="ae ky" href="https://drive.google.com/file/d/1ADKfE1sulbIc0Y46CoiJOJvs8SSMr2ix/" rel="noopener ugc nofollow" target="_blank">选项卡</a>中打开算法步骤。</p><ol class=""><li id="9e0f" class="lp lq ht is b it iu ix iy jb lr jf ls jj lt jn lu lv lw lx bi translated"><strong class="is hu"> <em class="jo"> __init__ </em>方法:<br/> </strong>在这个方法中我们已经完成了算法的步骤1，并定义了某些属性。<br/> <em class="jo">自我。__N </em> →总回合数<br/> <em class="jo">自身。__m </em> →机器总数<br/> <em class="jo">自身。_ _ machine _ selected</em>→100台机器列表，每轮选择一台<br/> <em class="jo"> self。__number_of_rewards_0 </em> →机器m获得奖励1的次数到回合n. <br/> <em class="jo"> self。__number_of_rewards_1 → </em>机器m获得奖励1的次数，直到回合n。</li><li id="41af" class="lp lq ht is b it ly ix lz jb ma jf mb jj mc jn lu lv lw lx bi translated"><strong class="is hu"><em class="jo">implement _ Thompson _ sampling</em>方法</strong> : <br/>在这个方法中，我们实现了步骤2和步骤3的结合。</li></ol><figure class="kq kr ks kt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es md"><img src="../Images/50f6745d214e0e3b4678205f16cf06ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5lGRnmsPgzEtpjMiKAaJjQ.jpeg"/></div></div></figure><p id="caaf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在第21行，β的值将在0和1之间生成。这是第二步。</p><p id="ff36" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在第22行，我们选择了beta值最高的机器，即步骤3。</p></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><p id="7322" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">汤普森采样就是这样实现的。可以有多种方法来实现。如果你用另一种方法解决，请随意分享。</p></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><p id="306d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">参考文献:</em></p><ol class=""><li id="1b64" class="lp lq ht is b it iu ix iy jb lr jf ls jj lt jn lu lv lw lx bi translated"><a class="ae ky" href="https://www.udemy.com/course/machinelearning/learn/lecture/19875776#questions" rel="noopener ugc nofollow" target="_blank">https://www . udemy . com/course/machine learning/learn/lecture/19875776 #问题</a></li><li id="5fba" class="lp lq ht is b it ly ix lz jb ma jf mb jj mc jn lu lv lw lx bi translated"><a class="ae ky" href="http://eurekastatistics.com/beta-distribution-pdf-grapher/" rel="noopener ugc nofollow" target="_blank">http://eurekastatistics.com/beta-distribution-pdf-grapher/</a></li><li id="fc72" class="lp lq ht is b it ly ix lz jb ma jf mb jj mc jn lu lv lw lx bi translated"><a class="ae ky" href="https://web.stanford.edu/~bvr/pubs/TS_Tutorial.pdf" rel="noopener ugc nofollow" target="_blank">https://web.stanford.edu/~bvr/pubs/TS_Tutorial.pdf</a></li><li id="3eec" class="lp lq ht is b it ly ix lz jb ma jf mb jj mc jn lu lv lw lx bi translated"><a class="ae ky" href="https://www.youtube.com/watch?v=v1uUgTcInQk" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=v1uUgTcInQk</a></li></ol></div></div>    
</body>
</html>