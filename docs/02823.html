<html>
<head>
<title>Advanced Python Logging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">高级Python日志记录</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/advance-python-logging-571912d3275f?source=collection_archive---------8-----------------------#2020-01-03">https://medium.com/analytics-vidhya/advance-python-logging-571912d3275f?source=collection_archive---------8-----------------------#2020-01-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/232351918f4adbdc5494860c5d460f37.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*iduCUtONBI7vgFEJb1lJPw.png"/></div></figure><p id="bea8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">既然你在这里，我希望你已经知道什么是日志记录和它的优势。就像我常说的理解比执行更重要。</p><p id="c204" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">日志对于每个开发人员来说都是非常有用的工具。它帮助我们理解应用程序中请求的时间表。它还通过理解事件前的请求状态来帮助我们调试问题。</p><p id="097f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">它还可以帮助分析应用程序，并带来一些关于它的见解，如记录平台(ios、android或web)将帮助我们了解我们的大部分流量来自哪个平台，这将使我们了解我们应该更加关注哪个平台。</p><p id="9e82" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Python有一个内置的日志模块，叫做<strong class="io hj">日志</strong></p><p id="a45d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们已经知道，当我们记录事件时，可能会有一些对应用程序至关重要的事件，这些事件不会损害系统，但基本上是警告，如API的响应时间，或者是不太重要但记录了一些信息的事件。</p><p id="9c89" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">类似地，python日志模块定义了不同的严重性级别</p><ul class=""><li id="0eed" class="jk jl hi io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated"><strong class="io hj">T3】调试T5】</strong></li><li id="2e08" class="jk jl hi io b ip ju it jv ix jw jb jx jf jy jj jp jq jr js bi translated"><strong class="io hj"> <em class="jt">信息</em> </strong></li><li id="00a3" class="jk jl hi io b ip ju it jv ix jw jb jx jf jy jj jp jq jr js bi translated"><strong class="io hj"> <em class="jt">警告</em> </strong></li><li id="4990" class="jk jl hi io b ip ju it jv ix jw jb jx jf jy jj jp jq jr js bi translated"><strong class="io hj"> <em class="jt">错误</em> </strong></li><li id="cd24" class="jk jl hi io b ip ju it jv ix jw jb jx jf jy jj jp jq jr js bi translated"><strong class="io hj"> <em class="jt">批判</em> </strong></li></ul><p id="a2c2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们需要记住的一件重要事情是，上述级别是按递增顺序排列的。</p><p id="7492" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，在理解它是什么之前，让我们执行它们，看看它是如何工作的</p><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es jz"><img src="../Images/bfdb67203e118227285cee90cfa25c7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nestq24NgQhjc_fZounRCg.png"/></div></div></figure><p id="efc9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如您所见，前两个级别无法记录消息，因为默认情况下<strong class="io hj">的严重性级别设置为警告。</strong></p><p id="cbb4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您猜对了，只有当严重级别达到记录器的默认严重级别时，才会记录该消息。</p><p id="3a25" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">例如，假设日志记录器的严重级别设置为debug(是的，我们可以设置日志记录级别),所有处于debug级别或更高级别的消息都将被记录</p><p id="8ec4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">但是等待写入控制台在现实应用程序中没有意义，所以让我们将它记录到一个文件中。</p><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es ki"><img src="../Images/3c69e65cee1cd025477f58fdcff32441.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qQe-KX7260qfBAblB3wAAQ.png"/></div></div></figure><p id="62ae" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在第2行，您可以看到我们正在将日志记录设置为一个文件，并将默认的严重级别设置为debug。因为第一个日志消息级别是info，所以它不会被写入文件，但是在下一个日志消息中，因为严重性级别符合默认级别，所以它将首先创建日志文件并将日志消息附加到该文件中。</p><p id="5ab9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请务必在新启动的Python解释器中尝试上述方法，不要只是从第一个示例的会话继续，因为对<strong class="io hj"> basicConfig() </strong>的调用应该在任何其他调用之前。因为它的目的是在一个会话中只配置一次，如果我们使用任何其他方法，如info()、debug()或任何其他日志记录方法，它们将在内部配置日志记录并设置默认值。</p><p id="5370" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">但是仅仅记录日志并不能帮助我们调试，我们还应该知道事件是什么时候记录的，所以让我们记录事件的时间以及下面的消息。</p><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es kj"><img src="../Images/e97072ad2c66645b55fc8766a6c61464.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PPBaYiKw93X-HJGMN6i_Ig.png"/></div></div></figure><p id="3ed5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">由于世界是动态的，我们应该记录动态日志消息，在上面的消息中，您可以看到我们使用python格式记录了动态时间戳。</p><p id="817e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">但是你不认为我们必须在每个日志事件中记录时间戳，并且每次在应用程序中计算时间是一种开销吗？不用担心，python日志模块会通过提供一个选项来设置日志事件格式，我们可以自由选择事件的输出格式。为简单起见，我将继续将事件记录到控制台，这样您也可以看到输出。</p><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es kk"><img src="../Images/1ebc0a4464d465bbde28dffc2b8c5f5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q4UT3py4V0Kkpn3lM95BwA.png"/></div></div></figure><p id="969a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">记录模块有4个组件:</p><ul class=""><li id="de4c" class="jk jl hi io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated"><strong class="io hj">记录器</strong>公开应用程序代码直接使用的接口。</li><li id="b12b" class="jk jl hi io b ip ju it jv ix jw jb jx jf jy jj jp jq jr js bi translated"><strong class="io hj">处理程序</strong>将日志记录(由记录器创建)发送到适当的目的地。</li><li id="d694" class="jk jl hi io b ip ju it jv ix jw jb jx jf jy jj jp jq jr js bi translated"><strong class="io hj">过滤器</strong>用于根据某些条件过滤出某些特定的日志记录。</li><li id="4da2" class="jk jl hi io b ip ju it jv ix jw jb jx jf jy jj jp jq jr js bi translated"><strong class="io hj">格式化程序</strong>指定日志记录在最终输出中的布局。</li></ul><p id="7746" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在实际的应用程序中，你会有多个模块，你不能一直登录到同一个文件，因为很难理解事件来自哪个模块。因此，对于不同的模块或特性，总是推荐使用不同的记录器。</p><p id="5a37" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以，这就是伐木者出现的原因。日志记录是通过调用Logger类实例上的方法来执行的，这些方法被称为loggers。每个记录器都有一个名称、日志级别、处理程序、格式化程序和过滤器。</p><p id="baf0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以当我们使用日志记录来记录时(参见第一个例子),它使用了<strong class="io hj">根</strong>日志记录器。</p><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="f7ab" class="kq kr hi km b fi ks kt l ku kv">WARNING:root:This is a log event</span></pre><p id="57e3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里<strong class="io hj"> root是记录器名称</strong></p><p id="abfc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们创建一个自定义记录器。</p><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es kw"><img src="../Images/a964bedd7674050e6a409146f5f7cc2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wHWUB4YMQqSdShHAZy4npg.png"/></div></div></figure><p id="e327" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">步骤1 </strong>:创建一个记录器实例，您可以使用自定义名称，也可以使用当前模块层次结构作为您的记录器名称。</p><p id="f786" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">步骤2 </strong>:设置记录器级别</p><p id="8964" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">步骤3 </strong>:使用<code class="du kx ky kz km b"><a class="ae la" href="https://docs.python.org/3/library/logging.handlers.html#logging.StreamHandler" rel="noopener ugc nofollow" target="_blank">StreamHandler</a></code>或<code class="du kx ky kz km b"><a class="ae la" href="https://docs.python.org/3/library/logging.handlers.html#logging.FileHandler" rel="noopener ugc nofollow" target="_blank">FileHandler</a></code>创建一个处理程序(也可以有其他类型的处理程序)</p><p id="32a1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">第4步</strong>:创建一个格式化程序，使用日志事件所需的输出格式</p><p id="e865" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">步骤5 </strong>:将格式化程序设置为已创建的处理程序以及处理程序日志级别</p><p id="faa8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">第6步</strong>:由于处理程序是用格式化程序创建的，下一步是将处理程序添加到创建的记录器中(注:你也可以将多个处理程序添加到一个记录器中，也就是说，如果你创建了一个文件处理程序和一个流处理程序，事件将在两个地方都被记录)</p><p id="488d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果我们有几个记录器，以上述方式配置记录器会很好，但如果数量增加，跟踪记录器、它们的级别、处理程序和格式化程序将非常困难。</p><p id="e546" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以，使用<code class="du kx ky kz km b">dictConfig()</code>有一个更好的方法。你必须定义你的记录器，它使用的处理程序和定义在字典格式中的格式化程序，该格式遵循<strong class="io hj">配置字典模式</strong>。让我们看一个例子</p><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="4fa2" class="kq kr hi km b fi ks kt l ku kv">{<br/>"version": 1,<br/>"formatters": {<br/>  "simple":{<br/>    "format": '%(asctime)s - %(name)s - %(levelname)s - %(message)s'<br/>  }<br/>},<br/>"handlers":{<br/>  "console":{<br/>    "class": 'logging.FileHandler',<br/>    "level": 'DEBUG',<br/>    "formatter": 'simple',<br/>    "filename": 'simple.log',<br/>   }<br/>},<br/>"loggers":{<br/>  "sampleLogger":{<br/>    "level": 'DEBUG',<br/>    "handlers": ['console'],<br/>    "propagate": False,<br/>  }<br/>},<br/>"root":{<br/>  "level": 'DEBUG',<br/>  "handlers": ['console'],<br/>}<br/>}</span></pre><p id="a50d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">以上是用于配置的格式</p><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es lb"><img src="../Images/7b2429eb25603fd9bc91863879ce2b69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*55i57HlGXV8hCH2OUjBJFg.png"/></div></div></figure><p id="e19f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">通过这种方式，您可以使用定义的处理程序、格式化程序和日志级别一次创建多个日志程序，并且如果我们将其存储在配置文件中，我们还可以参考哪些日志程序可用于何种级别、处理程序和格式化程序。</p><p id="13e7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> logger.exception(): </strong></p><p id="bd77" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">记录器有一个名为exception的方法，它主要记录异常跟踪和日志消息，这有助于更好地理解异常。</p><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es lc"><img src="../Images/b2b8ff4b76c3a2d1b2b1ea78893180bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i05oAq9t9z8Mws-JRQ3sdg.png"/></div></div></figure><p id="1d6e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我希望我们涵盖了从python日志记录的基础到高级主题的所有内容。感谢阅读。</p><h2 id="9435" class="kq kr hi bd ld le lf lg lh li lj lk ll ix lm ln lo jb lp lq lr jf ls lt lu lv bi translated"><strong class="ak">附言:如果你有任何疑问，请在</strong><a class="ae la" href="https://www.linkedin.com/in/shanmukh-dundigalla-4910b5129/" rel="noopener ugc nofollow" target="_blank"><strong class="ak">Linkedin</strong></a><strong class="ak">上给我留言或在</strong>下方留言</h2></div></div>    
</body>
</html>