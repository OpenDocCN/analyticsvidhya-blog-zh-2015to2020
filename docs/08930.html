<html>
<head>
<title>How to Build a Real-Time Chat web app using Node + Reactjs + Socket.io having E2E Encryption</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用具有E2E加密的Node + Reactjs + Socket.io构建一个实时聊天web应用程序</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-build-a-real-time-chat-web-app-using-node-reactjs-socket-io-having-e2e-encryption-18fbbde8a190?source=collection_archive---------3-----------------------#2020-08-19">https://medium.com/analytics-vidhya/how-to-build-a-real-time-chat-web-app-using-node-reactjs-socket-io-having-e2e-encryption-18fbbde8a190?source=collection_archive---------3-----------------------#2020-08-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/857bf9b73e142cdabfc737c9f86a0383.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*aWEZWRuPEkirkXZUGJKeig.gif"/></div></figure><p id="dbd8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">链接链接</strong> : <a class="ae jk" href="https://bit.ly/30sqUpJ" rel="noopener ugc nofollow" target="_blank">这是我们要打造的聊天应用✌ </a>的例子。</p><p id="127b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> Github链接</strong>:后端— <a class="ae jk" href="https://github.com/RishabhVerma098/chatappBackend" rel="noopener ugc nofollow" target="_blank">链接，</a>前端<a class="ae jk" href="https://github.com/RishabhVerma098/chatapp" rel="noopener ugc nofollow" target="_blank"> —链接</a>。</p><p id="a4b4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以你可能想知道WhatsApp，telegram类型的应用程序是如何说他们的用户数据在整个网络上被“加密”的。</p><p id="04ce" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这意味着存储在他们数据库中的所有信息都是加密的，所以即使一些“第三方”试图在他们到达目的地的途中“窃听”信息，被截获的信息也将是加密的形式。</p><blockquote class="jl jm jn"><p id="7dfc" class="im in jo io b ip iq ir is it iu iv iw jp iy iz ja jq jc jd je jr jg jh ji jj hb bi translated">在本文中，我将向您展示如何构建一个简单的E2E(它不会像Whatsapp使用的那样安全，但总比什么都没有好)。</p><p id="9019" class="im in jo io b ip iq ir is it iu iv iw jp iy iz ja jq jc jd je jr jg jh ji jj hb bi translated">我们将使用一个单独的密钥来加密和解密我们的消息，从而拥有对称的加密架构。</p><p id="69bf" class="im in jo io b ip iq ir is it iu iv iw jp iy iz ja jq jc jd je jr jg jh ji jj hb bi translated"><strong class="io hj">注意</strong>，Whatsapp使用<em class="hi"> Diffie-Helman </em>技术来实现非对称加密，这是可以用来制作最安全聊天应用的技术之一，如果你想了解更多，请参考这个<a class="ae jk" href="https://youtu.be/JnZQMUL8GcQ" rel="noopener ugc nofollow" target="_blank">链接</a>。</p></blockquote></div><div class="ab cl js jt gp ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hb hc hd he hf"><h1 id="a240" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated"><strong class="ak">工作</strong></h1><figure class="ky kz la lb fd ij er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es kx"><img src="../Images/db693203957d42396d8a95ba9dfa1d4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mTb16xc2-jlu3z83MjXCUA.png"/></div></div></figure><p id="9af2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如上图所示，我们将创建一个存储在前端的密钥(<em class="jo">)现在，我把它存储在前端文件中，但是为了生产，你必须把它保存在。部署了前端的服务器的ENV变量</em>。</p><p id="c24a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">每当用户发送信息，我们必须使用<a class="ae jk" href="https://www.npmjs.com/package/aes256" rel="noopener ugc nofollow" target="_blank"> aes256 </a> npm包用你的密钥加密。在收到加密的消息后，我们将重复这个过程，但这一次将使用相同的密钥解密。</p><h1 id="cfbe" class="jz ka hi bd kb kc lg ke kf kg lh ki kj kk li km kn ko lj kq kr ks lk ku kv kw bi translated">密码</h1><h2 id="bd1e" class="ll ka hi bd kb lm ln lo kf lp lq lr kj ix ls lt kn jb lu lv kr jf lw lx kv ly bi translated">后端(Node、Express、Socket.io)</h2><p id="9f13" class="pw-post-body-paragraph im in hi io b ip lz ir is it ma iv iw ix mb iz ja jb mc jd je jf md jh ji jj hb bi translated"><em class="jo">文件夹结构</em></p><pre class="ky kz la lb fd me mf mg mh aw mi bi"><span id="2246" class="ll ka hi mf b fi mj mk l ml mm">Backend<br/> |- dummyuser.js<br/> |- server.js<br/> |- package.json</span></pre><p id="0486" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="jo">依赖安装</em></p><pre class="ky kz la lb fd me mf mg mh aw mi bi"><span id="ce86" class="ll ka hi mf b fi mj mk l ml mm">npm i socket.io express dotenv cors colors</span><span id="d1b3" class="ll ka hi mf b fi mn mk l ml mm">npm i nodemon -d</span></pre><p id="6586" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">转到dummyuser.js </strong></p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><ul class=""><li id="0ddf" class="mq mr hi io b ip iq it iu ix ms jb mt jf mu jj mv mw mx my bi translated">这里我们创建了三个函数来照顾用户。<strong class="io hj"> userjoin() </strong> <strong class="io hj">函数</strong>将<strong class="io hj">添加</strong>一个用户到空数组users中。</li><li id="c2d4" class="mq mr hi io b ip mz it na ix nb jb nc jf nd jj mv mw mx my bi translated">用户对象由3个键组成——id、用户名和房间名，房间名基本上就像一个“WhatsApp组”,它会告诉用户属于这个特定的房间。</li><li id="a892" class="mq mr hi io b ip mz it na ix nb jb nc jf nd jj mv mw mx my bi translated"><strong class="io hj"> getcurrentuser() </strong>，将获取特定用户的id并返回其用户对象。</li><li id="975b" class="mq mr hi io b ip mz it na ix nb jb nc jf nd jj mv mw mx my bi translated">每当用户离开聊天(<strong class="io hj"> <em class="jo">断开</em> </strong>)时，我们将调用<strong class="io hj"> userLeave() </strong>，它接受一个用户id，并将<strong class="io hj">从用户数组中删除</strong>该用户对象</li></ul><h2 id="57c4" class="ll ka hi bd kb lm ln lo kf lp lq lr kj ix ls lt kn jb lu lv kr jf lw lx kv ly bi translated">转到server.js</h2><p id="e610" class="pw-post-body-paragraph im in hi io b ip lz ir is it ma iv iw ix mb iz ja jb mc jd je jf md jh ji jj hb bi translated"><em class="jo">导入包和初始设置</em></p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="8b07" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里我们只是从<strong class="io hj"> dummyuser.js导入模块、函数、</strong>监听端口<strong class="io hj"> 8000 </strong>和<strong class="io hj">初始化套接字</strong>。</p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="ee16" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在初始化socket之后，与sockets相关的所有东西都会进入io.on(connection，()= &gt;“所有东西都会到这里”)这个回调。</p><p id="2f7e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里我们有两个函数，socket . on("<strong class="io hj"><em class="jo">join room</em></strong>")，socket.on("chat ")。<strong class="io hj"> <em class="jo">加入房间</em> </strong>功能只会在新用户加入房间时运行。这里，我们将<strong class="io hj">向他/她发送</strong>欢迎消息，<strong class="io hj">向所有用户(除了他/她)广播</strong>消息(<em class="jo">用户已经加入</em>)。</p><p id="9e3f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">socket.on(" <em class="jo"> chat </em>")会处理来回消息发送部分。</p><p id="8abe" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">此外，每当用户<strong class="io hj"><em class="jo"/></strong>断开连接时，我们将向房间中的所有人发送“<em class="jo">用户已离开聊天</em>”消息。</p></div><div class="ab cl js jt gp ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hb hc hd he hf"><h2 id="8e95" class="ll ka hi bd kb lm ln lo kf lp lq lr kj ix ls lt kn jb lu lv kr jf lw lx kv ly bi translated">前端(React、Redux、Socket.io-client、aes256)</h2><p id="b9f9" class="pw-post-body-paragraph im in hi io b ip lz ir is it ma iv iw ix mb iz ja jb mc jd je jf md jh ji jj hb bi translated"><em class="jo">文件夹结构</em></p><figure class="ky kz la lb fd ij er es paragraph-image"><div class="er es ne"><img src="../Images/c9a184cd625951d66467ada399b4efbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:518/format:webp/1*yO4qzfV82fEbWU1TDk44DA.png"/></div></figure><p id="6314" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="jo">要安装的依赖项</em></p><pre class="ky kz la lb fd me mf mg mh aw mi bi"><span id="9f12" class="ll ka hi mf b fi mj mk l ml mm">npm i node-sass react-lottie react-redux react-router-dom redux</span></pre><h2 id="340a" class="ll ka hi bd kb lm ln lo kf lp lq lr kj ix ls lt kn jb lu lv kr jf lw lx kv ly bi translated">初始设置</h2><p id="7482" class="pw-post-body-paragraph im in hi io b ip lz ir is it ma iv iw ix mb iz ja jb mc jd je jf md jh ji jj hb bi translated"><strong class="io hj"> index.js </strong></p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="d023" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里我们添加redux并从<em class="jo">导入减速器。/存储/减速器/索引</em></p><p id="6f68" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">/商店/行动/索引. js </strong></p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="1678" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">/store/reduce/index . js</strong></p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="811c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">/store/reduce/process . js</strong></p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="93c1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在上面的文件中，我们将redux添加到React应用程序中，并创建一个名为<strong class="io hj">'<em class="jo">' process</em></strong><em class="jo">'</em>的操作，该操作将负责向'<strong class="io hj"> <em class="jo"> aes.js </em> </strong>'(负责加密和解密)发送消息(包括传入和传出消息)，并从'<strong class="io hj"> <em class="jo"> aes.js </em> </strong>'获取数据，然后返回到我们的组件。</p><h1 id="700c" class="jz ka hi bd kb kc lg ke kf kg lh ki kj kk li km kn ko lj kq kr ks lk ku kv kw bi translated"><strong class="ak">转到App.js </strong></h1><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="7e9d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里我们添加了路线和导入组件，</p><p id="d1e8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="jo"> Routes </em>，on-base URL我们正在渲染负责获取用户名和房间名的home组件。在路径"<em class="jo">/chat/room name/username</em>"上，我们正在呈现一个组件AppMain，它返回两个div，一个是chatbox，另一个告诉我们加密的传入消息和解密的消息的显示过程。</p><p id="e7a9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="jo">为App.js和globals.scss </em> </strong>添加所需的样式</p><p id="101b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"><em class="jo">app . scss</em>T79】</strong></p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="7571" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="jo"> _globals.scss </em></strong></p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><h1 id="70af" class="jz ka hi bd kb kc lg ke kf kg lh ki kj kk li km kn ko lj kq kr ks lk ku kv kw bi translated">转到/home/home.js</h1><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="c5af" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里，我们从用户(用户和房间名称)获取输入，并调用socket.emit(" <em class="jo"> joinRoom </em>")，传递用户名和房间名称，这将在我们的后端激活"<em class="jo"> joinRoom </em>"，这将把用户添加到房间，并发出/广播消息，如上文在我们的后端部分所讨论的。</p><p id="1dbd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="jo">给home.js添加样式，</em> </strong></p><p id="ecd0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">T13】home . scssT15】</strong></p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="6ed9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">转到/chat/chat.js </strong></p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="00c8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里，我们从用户处获取输入，并将数据传递给process action，该action将数据传递给<strong class="io hj"> <em class="jo"> aes </em> </strong>函数进行加密，然后将其发送给socket . on(“chat”)，每当接收到消息时，我们都会将其再次传递给<strong class="io hj"> <em class="jo"> aes </em> </strong>函数，但这次是用于解密。</p><p id="af38" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="jo">为聊天应用样式</em> </strong></p><h2 id="d984" class="ll ka hi bd kb lm ln lo kf lp lq lr kj ix ls lt kn jb lu lv kr jf lw lx kv ly bi translated">聊天. scss</h2><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><h1 id="9db6" class="jz ka hi bd kb kc lg ke kf kg lh ki kj kk li km kn ko lj kq kr ks lk ku kv kw bi translated">转到aes.js</h1><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="d77c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里我们导入了<strong class="io hj"> aes256 </strong>并编写了一个函数，在这个函数中我们解密传入的消息(除了欢迎消息)并加密传出的消息。</p><h1 id="1193" class="jz ka hi bd kb kc lg ke kf kg lh ki kj kk li km kn ko lj kq kr ks lk ku kv kw bi translated">转到process.js(可选组件)</h1><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="76a2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这只是一个组件(右栏),我们在其中显示传入的加密内容</p><p id="52a2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">消息并使用我们的密钥解密它。</p><p id="62a6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="jo">添加样式到process.js </em> </strong></p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="499e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">基本上，process.js负责显示传入的加密和解密消息。</p><p id="a541" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">就是这样！，我们终于做了一个实时聊天的E2E app。现在，只需在终端中写入npm start来启动react应用程序，然后转到localhost:3000，写入用户名和房间名，同时打开另一个选项卡，然后转到locah host:3000，写入您的姓名和您之前在第一个选项卡中写入的相同房间名。</p></div></div>    
</body>
</html>