<html>
<head>
<title>Dealing With Missing Values in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Python 中处理缺失值</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/data-cleaning-dealing-with-missing-values-in-python-f0bc95edf1c3?source=collection_archive---------9-----------------------#2020-09-20">https://medium.com/analytics-vidhya/data-cleaning-dealing-with-missing-values-in-python-f0bc95edf1c3?source=collection_archive---------9-----------------------#2020-09-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3fee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你好，我希望你今天过得愉快。众所周知，数据科学和 ML 的大部分时间都花在预处理上。预处理的一个重要部分是处理缺失值。在这篇博客中，我分享了一些我用来处理缺失值的技巧和诀窍。</p><h2 id="35c9" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">数据和包</h2><p id="b841" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">我将使用<a class="ae kd" href="http://import numpy as np # linear algebra import pandas as pd # data processing, CSV file I/O (e.g. pd.read_csv)   import os for dirname, _, filenames in os.walk('/kaggle/input'):     for filename in filenames:         print(os.path.join(dirname, filename))  import matplotlib.pyplot as plt import seaborn as sns  sns.set_style('white') plt.rcParams[&quot;patch.force_edgecolor&quot;] = True   from plotly.offline import iplot, init_notebook_mode import cufflinks as cf import plotly.graph_objs as go # import chart_studio.plotly as py  init_notebook_mode(connected=True) cf.go_offline(connected=True)  # Set global theme cf.set_config_file(world_readable=True, theme='pearl')" rel="noopener ugc nofollow" target="_blank">巴西天气数据</a>进行演示。数据在 Kaggle 中提供。你可以在我的<a class="ae kd" href="https://www.kaggle.com/nibukdk93/weather-data-analysis" rel="noopener ugc nofollow" target="_blank"> kaggle </a>或<a class="ae kd" href="https://github.com/nibukdk/Weather-Data-Brazil/blob/master/weather%20data%20analysis.ipynb" rel="noopener ugc nofollow" target="_blank"> github </a>仓库中找到完整的笔记本，里面有从预处理到勘探分析的细节。在这篇博客中，我只是使用了部分缺失值。</p><p id="affc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用过基本的 python 库进行数据分析，比如 Pandas、Numpy、Matplotlib、Seaborn。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="de22" class="jd je hi kj b fi kn ko l kp kq">import numpy as np <br/>import pandas as pd <br/>import matplotlib.pyplot as plt<br/>import seaborn as sns</span><span id="ccf6" class="jd je hi kj b fi kr ko l kp kq">sns.set_style('white')</span><span id="8e37" class="jd je hi kj b fi kr ko l kp kq"># gives border to histograms<br/>splt.rcParams["patch.force_edgecolor"] = True</span></pre><p id="af55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我会试着解释代码和逻辑，让文章尽可能的简短，请耐心等待。</p><h2 id="8bb3" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">导入数据和采样</h2><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="5cf2" class="jd je hi kj b fi kn ko l kp kq">df_original = pd.read_csv(“/kaggle/input/hourly-weather-surface-brazil-southeast-region/sudeste.csv”)</span></pre><p id="9237" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据非常庞大，计算成本很高。所以，我将用样本来代替。的确，数据越多越好，如果你有人口，那么就不要使用样本，但我们现在忽略它。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="501a" class="jd je hi kj b fi kn ko l kp kq">sample_df = df_original.sample(300000,random_state=101)</span></pre><h2 id="fded" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">关于某些列的信息</h2><p id="61c2" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">以下是数据集中列的一些信息。</p><p id="ece5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.瞬时空气温度(摄氏度)= temp <br/> 2。最高气温(摄氏度)= tmin <br/> 3。最低气温(摄氏度)= tmax <br/> 4。空气相对湿度(%) =hmdy <br/> 5。最大相对空气湿度(%) =hmax <br/> 6。最小相对空气湿度(%) = hmin <br/> 7。瞬时露点(摄氏度)= dewp <br/> 8。最大露点(摄氏度)=dmax <br/> 9。最低露点温度(摄氏度)= dmin <br/> 10。瞬时空气大气压力(毫巴)=stp <br/> 11。最大大气压力(毫巴)= smax <br/> 12。最小大气压力(毫巴)= smin <br/> 13。瞬时风速(米每秒)= wdsp <br/> 14。风向(半径度)= wdct <br/> 15。阵风强度(米每秒)=阵风<br/> 16。太阳辐射= gbrd <br/> 17。降水量(毫米)= prcp <br/> 18。仰角= elvt <br/> 19。观察日期时间= mdct <br/> 20。观察日期=日期<br/> 21。该位置的站号(INMET 号)= inme <br/> 22。年份(2000–2016):年<br/> 23。月份(0–12):月 24 日。当日(0–31):25 日。小时:小时</p><p id="80de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ks">列表中没有提到所有的列</em></p><p id="a2c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们检查数据框架以了解数据。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="d461" class="jd je hi kj b fi kn ko l kp kq">print(sample_df.iloc[:,:10].head(1))<br/>print(“==”*20)<br/>print(sample_df.iloc[:,10:20].head(1))<br/>print(“==”*20)</span><span id="7037" class="jd je hi kj b fi kr ko l kp kq">print(sample_df.iloc[:,20:].head(1))</span></pre><p id="01d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我只是打印一行 10 列一次，而不是所有避免截断。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="7ec0" class="jd je hi kj b fi kn ko l kp kq"><br/>wsid        wsnm  elvt        lat        lon  inme        city prov  \<br/>444352   307  SÃO MATEUS  29.0 -18.676198 -39.864051  A616  São Mateus   ES   <br/><br/>                       mdct        date  <br/>444352  2009-09-10 16:00:00  2009-09-10  <br/>========================================<br/>          yr  mo  da  hr  prcp     stp    smax    smin      gbrd  temp<br/>444352  2009   9  10  16   NaN  1017.7  1018.4  1017.7  2526.037  27.5<br/>========================================<br/>        dewp  tmax  dmax  tmin  dmin  hmdy  hmax  hmin  wdsp  wdct  gust<br/>444352  18.6  28.4  19.6  26.9  18.0  58.0  63.0  55.0   4.6  92.0   7.7</span></pre><p id="2493" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看包含空值的列。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="25c9" class="jd je hi kj b fi kn ko l kp kq">null_cols = sample_df.loc[:,sample_df.isnull().sum()&gt;0].columns</span><span id="125a" class="jd je hi kj b fi kr ko l kp kq">not_null_cols= sample_df.loc[:,sample_df.notnull().sum()==300000].columns</span><span id="0056" class="jd je hi kj b fi kr ko l kp kq">null_df= sample_df[null_cols]</span><span id="93b1" class="jd je hi kj b fi kr ko l kp kq">not_null_df= sample_df[not_null_cols]<br/></span></pre><p id="3c76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">空列包括</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="ae5d" class="jd je hi kj b fi kn ko l kp kq">['prcp', 'gbrd', 'temp', 'dewp', 'tmax', 'dmax', 'tmin', 'dmin',<br/>       'hmax', 'hmin', 'wdsp', 'gust']</span></pre><h1 id="bba0" class="kt je hi bd jf ku kv kw jj kx ky kz jn la lb lc jq ld le lf jt lg lh li jw lj bi translated">探索、关系与缺失的价值</h1><p id="827a" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">数据集很大，有很多列，因此，可视化、拖放和填充值不会被视为某种顺序，而是随着我们的前进而逐渐接近。</p><h2 id="f751" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">要降低的字符串值</h2><p id="e3f5" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">只是为了确保在后面的关系学习中避免任何混淆，让我们将带有字符串值的列转换为小写。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="d753" class="jd je hi kj b fi kn ko l kp kq"># To find all columns with str data types</span><span id="5236" class="jd je hi kj b fi kr ko l kp kq">sample_df.loc[:,sample_df.dtypes ==”object”].columns</span></pre><p id="89a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的例子中，只有 Prov 和 City 两列。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="1a73" class="jd je hi kj b fi kn ko l kp kq">sample_df.prov = sample_df.prov.str.lower()<br/>sample_df.city = sample_df.city.str.lower()</span></pre><h1 id="10c4" class="kt je hi bd jf ku kv kw jj kx ky kz jn la lb lc jq ld le lf jt lg lh li jw lj bi translated">研究相关性并填充缺失值</h1><p id="fe26" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">让我们检查列之间的相关性，并尝试填充缺失的值。要做到这一点，让我们首先编写一个给出自定义热图的函数(受 Dataquest.io 中数据科学课程的启发)。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="5cab" class="jd je hi kj b fi kn ko l kp kq">def customized_heatmap(df):<br/>    corr_df = df.corr()</span><span id="f580" class="jd je hi kj b fi kr ko l kp kq"># Get only half portion of corr_df to avoid df, so create mask    <br/>    mask = np.triu(np.ones_like(corr_df), k=1)<br/>    <br/>     <br/>    # plot a heatmap of the values<br/>    plt.figure(figsize=(20,14))<br/>    ax = sns.heatmap(corr_df, vmin=-1, vmax=1, cbar=False,<br/>                     cmap='coolwarm', mask=mask, annot=True)<br/>    <br/>    # format the text in the plot to make it easier to read<br/>    for text in ax.texts:<br/>        t = float(text.get_text())<br/>        if -0.25 &lt; t &lt; 0.25:<br/>            text.set_text('')<br/>        else:<br/>            text.set_text(round(t, 2))<br/>        text.set_fontsize('x-large')<br/>    plt.xticks( size='x-large')<br/>    plt.yticks(rotation=0, size='x-large')<br/>    #Save fig uncomment first<br/>#     plt.savefig("Heatmap DF")<br/>    plt.show()</span></pre><p id="104f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此自定义热图的一些功能:</p><ol class=""><li id="bce4" class="lk ll hi ih b ii ij im in iq lm iu ln iy lo jc lp lq lr ls bi translated">为了避免重复，它将只显示半个数据帧</li><li id="cfbe" class="lk ll hi ih b ii lt im lu iq lv iu lw iy lx jc lp lq lr ls bi translated">它为更大的字体格式化了文本。</li><li id="0250" class="lk ll hi ih b ii lt im lu iq lv iu lw iy lx jc lp lq lr ls bi translated">对于选择高于 0.25 或低于-0.25 的数据，只显示较高的相关性。您可以使用自己的产品系列。</li></ol><p id="2591" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ks"> Correlation 简短说明:Pearson correlation 中最常用的形式，它计算连续值之间的相关性(转到此</em> <a class="ae kd" href="https://www.statisticssolutions.com/correlation-pearson-kendall-spearman/" rel="noopener ugc nofollow" target="_blank"> <em class="ks">链接</em> </a> <em class="ks">以便更好地理解)，但无法正确关联分类值。因此，有一个名为</em><a class="ae kd" href="http://shakedzy.xyz/dython/getting_started/examples/" rel="noopener ugc nofollow" target="_blank"><em class="ks">dython</em></a><em class="ks">的库可以帮助计算混合数据类型的相关性。</em></p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="5276" class="jd je hi kj b fi kn ko l kp kq">from dython.nominal import associations</span><span id="682b" class="jd je hi kj b fi kr ko l kp kq">df_4_corr = sample_df.copy()</span><span id="62b9" class="jd je hi kj b fi kr ko l kp kq"># df_4_corr.drop(['EMPLOYEE_NUMBER',"EMPLOYEE_COUNT"], inplace=True, axis=1)</span><span id="93f2" class="jd je hi kj b fi kr ko l kp kq">assoc = associations(df_4_corr,plot=False,bias_correction=False)<br/>corr_df = assoc['corr']</span></pre><p id="c229" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">阅读 dython 文档了解更多信息。但是在使用数据帧提取相关矩阵之前，先复制一份数据帧，因为它会填充缺省值。</p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="b7ea" class="jd je hi kj b fi kn ko l kp kq">customized_heatmap(corr_df)</span></pre><figure class="ke kf kg kh fd mg er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es mf"><img src="../Images/fa5ba01c15677fe77d1bc2677b2501a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mVLXAsv6GF_WtckuzAUNKQ.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">关联热图</figcaption></figure></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><p id="e9d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仔细看，hmax、hminx 和 hmdy 为 1 等列之间存在相关性。这是因为这些列是湿度子集。如果我们以后要使用数据进行预测，重要的是不要使用这样的列。我会以工程为特色，并创建新列，例如这三列的平均值。但是现在我们不要这样做。</p><p id="b80c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回想一下空列。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="5b74" class="jd je hi kj b fi kn ko l kp kq">['prcp', 'gbrd', 'temp', 'dewp', 'tmax', 'dmax', 'tmin', 'dmin',<br/>       'hmax', 'hmin', 'wdsp', 'gust']</span></pre><figure class="ke kf kg kh fd mg er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es mr"><img src="../Images/de3f95d0841189af11d20c9baa60632b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ADBlZ0PtH0W6-oiyzOdZeQ.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">零百分比</figcaption></figure><p id="4caa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如您所见,“降水”列的空百分比非常高。在数据中,“Prcp”是一个目标列，但在这里我们将删除它，因为填充 85%的缺失数据会产生一个有偏差的数据。</p><p id="8ffe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们检查上面热图中的“gbrd”相关性。Gbrd 即 Sloar 辐射似乎与温度、湿度和风的子集高度相关。</p><p id="f2ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从热图来看,“风速”和“阵风”与温度和太阳辐射高度相关。让我们用温度栏来填充风速和阵风栏，因为太阳辐射有很多缺失值。</p><h1 id="7d76" class="kt je hi bd jf ku kv kw jj kx ky kz jn la lb lc jq ld le lf jt lg lh li jw lj bi translated">缺失值可视化热图</h1><p id="20e6" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">让我们根据相关性制作空值热图</p><p id="3a2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">风速和阵风</strong></p><p id="7c64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们通过根据温度和阵风列排序来检查空值，看看有多少相邻行是空的。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="d1cc" class="jd je hi kj b fi kn ko l kp kq">#Plot by sorting the values by gust<br/>sorted_df_by_temp=sample_df[[‘gust’,’wdsp’,”temp”]].sort_values([‘temp’] )</span><span id="cad2" class="jd je hi kj b fi kr ko l kp kq">sorted_df_by_gust=sample_df[[‘gust’,’wdsp’,”temp”]].sort_values([‘gust’] )</span></pre><p id="991c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在空值热图中绘制它们。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="6a2d" class="jd je hi kj b fi kn ko l kp kq">plt.figure(figsize=(10,5))<br/>sns.heatmap(sorted_df_by_gust.isnull(),cmap=’coolwarm’, cbar=False, yticklabels=False);</span></pre><figure class="ke kf kg kh fd mg er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es ms"><img src="../Images/ea71a67ca6f9dfa08a80164120cb6365.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lr-IKkQfpwAx4PGbLmgTVA.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">空值热图|按阵风排序</figcaption></figure><p id="cc3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">至少有两件事需要注意。</p><ol class=""><li id="33e2" class="lk ll hi ih b ii ij im in iq lm iu ln iy lo jc lp lq lr ls bi translated">阵风有一些部分的相邻值随着风速的变化而变得不为零。</li><li id="fe96" class="lk ll hi ih b ii lt im lu iq lv iu lw iy lx jc lp lq lr ls bi translated">部分相邻行的阵风和风速栏为空。</li></ol><p id="a427" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">策略:</p><p id="c591" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用<strong class="ih hj">阵风</strong>填充<strong class="ih hj">风速</strong>:</p><ol class=""><li id="2ea7" class="lk ll hi ih b ii ij im in iq lm iu ln iy lo jc lp lq lr ls bi translated">在阵风不为零的地方提取风速和阵风列。</li><li id="906f" class="lk ll hi ih b ii lt im lu iq lv iu lw iy lx jc lp lq lr ls bi translated">使用 value_counts()将阵风分成几个更小的箱，并通过阵风柱的箱范围计算风速柱的平均值。例如，0 公里/小时-50 公里/小时、50 公里/小时-100 公里/小时之间阵风的平均风速等。要考虑的事情是确保这些箱中的行数大致相等。</li><li id="ba05" class="lk ll hi ih b ii lt im lu iq lv iu lw iy lx jc lp lq lr ls bi translated">在阵风栏的箱中搜索风速栏中的缺失值，并用该箱的平均值填充空值(如果存在)。</li></ol><p id="8df2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用<strong class="ih hj">温度</strong>填写<strong class="ih hj">阵风</strong>和<strong class="ih hj">风速</strong>栏；</p><p id="8843" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您在热图中看到的，在前面的步骤之后，很大一部分空值仍然是空的，因为我们只使用了 gust 列为非空的提取行。因此，现在我们将使用相同的策略填充两列，但是使用与上面相同的策略使用温度列。</p><p id="85c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们在编码中应用上述逻辑。</p><ol class=""><li id="d876" class="lk ll hi ih b ii ij im in iq lm iu ln iy lo jc lp lq lr ls bi translated"><strong class="ih hj">创建蒙版。</strong></li></ol><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="2067" class="jd je hi kj b fi kn ko l kp kq">mask_gust_wdsp = sample_df['gust'].notnull() &amp; sample_df['wdsp'].isnull()</span></pre><p id="ec43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。</strong>T10】宁滨</p><p id="069b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据上述在 3 个箱中划分的掩码提取数据。我使用了 3 个箱子，但是可以自由地进行更多的实验来获得相同的行数。</p><figure class="ke kf kg kh fd mg er es paragraph-image"><div class="er es mt"><img src="../Images/d4ddc82bb68430356bd92ff822e723c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*ZRmcn4ylwMG7m0rUbYGqsg.png"/></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">创建媒体夹</figcaption></figure><p id="5ed5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">小括号表示包含，方括号表示排除。</p><p id="9ed6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.<strong class="ih hj">根据阵风范围计算平均风速。</strong></p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="138a" class="jd je hi kj b fi kn ko l kp kq"># Create three mean <br/>first_range_mean_wdsp_by_gust= sample_df[sample_df['gust']&lt;7.5]['wdsp'].mean()</span><span id="6965" class="jd je hi kj b fi kr ko l kp kq">second_range_mean_wdsp_by_gust=sample_df[((sample_df['gust']&gt;=7.5) &amp;(sample_df['gust']&lt;15.0))]['wdsp'].mean()</span><span id="5336" class="jd je hi kj b fi kr ko l kp kq">third_range_mean_wdsp_by_gust=sample_df[sample_df['gust']&gt;=15.0]['wdsp'].mean()</span></pre><p id="bbff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们有了平均值，我们必须按范围填充空值。让我们创建将执行此任务的函数。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="8305" class="jd je hi kj b fi kn ko l kp kq">def fill_wdsp_by_gust(col): <br/>    <br/>    <br/>#Initialize relevant cols<br/>    gust = col[0]<br/>    wdsp = col[1]<br/>    <br/>    # If the value is nan<br/>    #Assign by ranges declared above<br/>    import math<br/>    if (math.isnan(wdsp)):<br/>        # Make sure gust in not nan<br/>        if math.isnan(gust):<br/>            pass<br/>        elif (gust&lt;7.5):<br/>            return first_range_mean_wdsp_by_gust<br/>        elif (gust&gt;=7.5 ) and (gust&lt;15.0):<br/>            return second_range_mean_wdsp_by_gust<br/>        elif (gust&gt;=15.0):<br/>            return third_range_mean_wdsp_by_gust<br/>          #if not nan return as it is<br/>    else:<br/>        return wdsp</span></pre><p id="f027" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我来定义这个函数的文档字符串</p><p id="96cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“你好，我是<strong class="ih hj"> fill_wdsp_by_gust </strong>函数。我从阵风和风速栏中各取两个值，是的，它们是相邻的值。</p><p id="5aa4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我将使用 math.nan 检查风速是否为零。如果是，我将检查阵风值的范围。之后，根据正确的箱将平均值分配给空值。</p><p id="c607" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这样应用我:df[['wdsp '，'阵风']]。应用(fill_wdsp_by_gust，轴=1)。是的，列的顺序很重要。"</p><p id="7142" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.<strong class="ih hj">应用上述功能</strong></p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="8cbf" class="jd je hi kj b fi kn ko l kp kq">sample_df['wdsp'] = sample_df[['gust','wdsp']].apply(fill_wdsp_by_gust,axis=1)</span></pre><p id="d6e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您的工作是使用相同的逻辑，按温度列填充风速和阵风列中剩余的缺失值。我在我的笔记本中做得更深入，在我的<a class="ae kd" href="https://www.kaggle.com/nibukdk93/weather-data-analysis#Missing-Values" rel="noopener ugc nofollow" target="_blank">笔记本</a>中定义上下文来填充一个函数中几列的缺失值。</p><h2 id="7881" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated"><strong class="ak">删除缺失值:</strong></h2><p id="7c44" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">如果您不确定如何填充这些值，或者如果 null 值的部分非常高，就像我们的 Prcp 列一样，明智的做法是删除整个列。</p><p id="c3b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果空值的数量不像我们的 null_pct 少于 5%的列那样多，可以用平均值来填充缺失的值，或者你可以应用前面提到的策略。以防万一，你不确定你能像下面这样删除空行。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="20f0" class="jd je hi kj b fi kn ko l kp kq"><br/>sample_df.dropna(subset=['hmax','hmin'],inplace=True)</span></pre><p id="1d9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在分类值的情况下，使用 mode 通常是一种常用的方法。我们可以用级数找到模式。<a class="ae kd" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.mode.html" rel="noopener ugc nofollow" target="_blank">方式()</a>方法。举个例子，</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="a5a6" class="jd je hi kj b fi kn ko l kp kq">sample_df['city'].mode()</span></pre><p id="6c6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有一种更高级的技术，通过使用 ML 算法预测来填充缺失值，如果你有兴趣知道，请在评论区告诉我。如果你想要其他关于可视化、分析和其他方面的技巧和诀窍，请告诉我。我会尽我所能分享我的知识，并得到您的反馈。</p><p id="6570" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ks">我们都是学生，进步需要创建、编辑、更新、删除和反馈的连续循环。</em>T3】</strong></p></div></div>    
</body>
</html>