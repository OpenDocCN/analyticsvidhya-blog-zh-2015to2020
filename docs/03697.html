<html>
<head>
<title>Part 2:Deploy Flask App+Anaconda+Gunicorn+Nginx on Ubuntu</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第2部分:在Ubuntu上部署Flask App+Anaconda+guni corn+Nginx</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/part-2-deploy-flask-app-anaconda-gunicorn-nginx-on-ubuntu-b12fc4199c59?source=collection_archive---------9-----------------------#2020-02-14">https://medium.com/analytics-vidhya/part-2-deploy-flask-app-anaconda-gunicorn-nginx-on-ubuntu-b12fc4199c59?source=collection_archive---------9-----------------------#2020-02-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e9b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在之前的<a class="ae jd" rel="noopener" href="/@sarang0909.bds/part-1-deploy-flask-app-anaconda-gunicorn-nginx-on-ubuntu-4524014451b">文章</a>中，我们已经设置了web应用程序和应用服务器。现在，让我们看看如何设置Web服务器。</p><p id="d68b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在设置nginx之前，我们需要设置gunicorn，以便它可以由systemd启动。这是nginx所必需的。</p><ol class=""><li id="5774" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">Gunicorn by systemd</li></ol><pre class="jn jo jp jq fd jr js jt ju aw jv bi"><span id="c92e" class="jw jx hi js b fi jy jz l ka kb">sudo vi /etc/systemd/system/myapp.service</span></pre><p id="09d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">向其中添加以下行:</p><pre class="jn jo jp jq fd jr js jt ju aw jv bi"><span id="97bb" class="jw jx hi js b fi jy jz l ka kb">[Unit]<br/>Description=Gunicorn instance to serve My flask app<br/>After=network.target<br/>[Service]<br/>User=ubuntu<br/>Group=www-data<br/>WorkingDirectory=/home/ubuntu/my_code<br/>Environment="PATH=/home/ubuntu/anaconda3/bin"<br/>ExecStart=/home/ubuntu/anaconda3/envs/myapp/bin/gunicorn --workers 3 --bind unix:myapp.sock -m 007 <strong class="js hj">connector:app</strong><br/>[Install]<br/>WantedBy=multi-user.target</span></pre><p id="9e14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要启用链接:</p><pre class="jn jo jp jq fd jr js jt ju aw jv bi"><span id="9e45" class="jw jx hi js b fi jy jz l ka kb">sudo systemctl start myapp<br/>sudo systemctl enable myapp<br/>sudo systemctl status myapp</span></pre><p id="c12d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.Nginx设置</p><pre class="jn jo jp jq fd jr js jt ju aw jv bi"><span id="df24" class="jw jx hi js b fi jy jz l ka kb">sudo apt-get install nginx<br/>sudo usermod ubuntu -g www-data</span></pre><p id="bedd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建nginx配置文件:</p><pre class="jn jo jp jq fd jr js jt ju aw jv bi"><span id="ca9c" class="jw jx hi js b fi jy jz l ka kb">sudo vi /etc/nginx/sites-available/myapp</span><span id="6be9" class="jw jx hi js b fi kc jz l ka kb">server {<br/> listen 80;<br/> server_name x.x.x.x;<br/>location / {<br/> include proxy_params;<br/> proxy_pass <a class="ae jd" href="http://unix:/home/ubuntu/kyc_validation/kycapp.sock" rel="noopener ugc nofollow" target="_blank">http://unix:</a>/home/ubuntu/my_code<a class="ae jd" href="http://unix:/home/ubuntu/kyc_validation/kycapp.sock" rel="noopener ugc nofollow" target="_blank">/myapp.sock</a>;<br/> }<br/>}</span></pre><p id="6f33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，创建符号链接</p><pre class="jn jo jp jq fd jr js jt ju aw jv bi"><span id="d61e" class="jw jx hi js b fi jy jz l ka kb">sudo ln -s /etc/nginx/sites-available/myapp /etc/nginx/sites-enabled</span></pre><p id="3e93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">测试应用:</p><pre class="jn jo jp jq fd jr js jt ju aw jv bi"><span id="2b53" class="jw jx hi js b fi jy jz l ka kb">sudo systemctl start nginx</span></pre><p id="80a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应用程序将运行在<a class="ae jd" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000 </a></p><p id="0537" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.监控和日志</p><p id="9ed0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要启用您的应用程序日志，请将以下代码添加到flask应用程序代码中:</p><pre class="jn jo jp jq fd jr js jt ju aw jv bi"><span id="665f" class="jw jx hi js b fi jy jz l ka kb">import logging</span><span id="9783" class="jw jx hi js b fi kc jz l ka kb">logging.basicConfig(filename=APP_ROOT+'/'+'execution_log.log', filemode='a+', format=' [%(filename)s:%(lineno)s:%(funcName)s()]- %(asctime)s - %(levelname)s - %(message)s', level=logging.INFO)<br/> <br/>gunicorn_logger = logging.getLogger('gunicorn.error')<br/>app.logger.handlers = gunicorn_logger.handlers<br/>app.logger.setLevel(gunicorn_logger.level)</span></pre><p id="02bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">启动和停止服务器的命令:</p><pre class="jn jo jp jq fd jr js jt ju aw jv bi"><span id="bc85" class="jw jx hi js b fi jy jz l ka kb">Gunicorn:<br/>ps -ef|grep gunicorn    <br/>sudo systemctl enable myapp<br/>sudo systemctl status myapp<br/>sudo systemctl start myapp<br/>sudo systemctl stop myapp</span><span id="6381" class="jw jx hi js b fi kc jz l ka kb">Nginx:<br/>ps -ef | grep nginx<br/>sudo systemctl status nginx.service<br/>sudo systemctl start nginx <br/>sudo systemctl stop nginx <br/>sudo systemctl restart nginx</span><span id="cc6b" class="jw jx hi js b fi kc jz l ka kb">sudo less /var/log/nginx/error.log: checks the Nginx error logs.<br/>sudo less /var/log/nginx/access.log: checks the Nginx access logs.<br/>sudo journalctl -u nginx: checks the Nginx process logs.<br/>sudo journalctl -u myapp: checks your Flask app’s Gunicorn logs.</span></pre><p id="fbaf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你喜欢这篇文章或有任何建议/意见，请在下面分享！</p><p id="af45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://www.linkedin.com/in/sarang-mete-6797065a/" rel="noopener ugc nofollow" target="_blank">领英</a></p></div></div>    
</body>
</html>