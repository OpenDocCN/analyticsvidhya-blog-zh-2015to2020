<html>
<head>
<title>Python Webservice API Server deployment using Ubuntu</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Ubuntu部署Python Webservice API服务器</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/python-webservice-api-server-deployment-using-ubuntu-201d48f477d9?source=collection_archive---------0-----------------------#2020-02-13">https://medium.com/analytics-vidhya/python-webservice-api-server-deployment-using-ubuntu-201d48f477d9?source=collection_archive---------0-----------------------#2020-02-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="b667" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">使用Nginx和Gunicorn在Ubuntu中实现Python Flask Restful API</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ix"><img src="../Images/5eca76a7a1faaac84afc4a9daf736ef4.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/0*ZEmm3KAygeuJlEnE.png"/></div></figure><p id="07fe" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">*更新:本教程使用的文件可以在这里免费下载:<a class="ae kb" href="https://www.piecex.com/source-code/Tutorial-Resources-Python-Webservice-API-Server-deployment-using-Ubuntu-1998" rel="noopener ugc nofollow" target="_blank">https://www . piecex . com/source-code/Tutorial-Resources-Python-web service-API-Server-deployment-using-Ubuntu-1998</a></p><p id="41c2" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在这里，我将一步步介绍如何使用Nginx和Gunicorn Python将Flask REST API部署到Ubuntu服务器中。</p><p id="f069" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">因此，让我们从基础开始，对于那些可能不熟悉Flask的人来说，Flask是一个Python web框架，可以替代Django项目的整体结构和依赖关系。它采用小型核心和易于扩展的理念构建。使用flask，您可以立即创建web服务或Restful APIs。</p><p id="1dc0" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果我们想在我们的服务器中实现Flask API，我们需要完成一些任务和安装。</p><p id="d1e1" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">*对于本教程，我们假设您具备连接服务器和Python编程方面的知识…</p><p id="e75f" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">请注意，您还可以使用Supervisor作为客户机/服务器系统来监视和控制UNIX上的许多进程。</p><p id="bf05" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">此外，我们将在HTTP协议中实现它。在服务器上安装SSL证书超出了本教程的范围。</p><p id="385d" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这里我们将使用下面的架构，因为(在我看来)对于初学者来说更容易理解。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es kc"><img src="../Images/a579c267b0b9eddca8791b547b2c7340.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/0*WYtoJlpsznVdn8aX"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es kd"><img src="../Images/0eb784795ce6b88f162a6ee7aa159bae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/0*xZ4lXWn_YAGm5j_r.png"/></div></figure><p id="64c0" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">服务器将通过服务执行命令，使用带有Gunicorn的WSGI调用Nginx。Flask将作为web服务框架，用Python代码实现。</p><h1 id="295d" class="ke kf hi bd kg kh ki kj kk kl km kn ko io kp ip kq ir kr is ks iu kt iv ku kv bi translated">步骤1 —安装</h1><p id="b87d" class="pw-post-body-paragraph jf jg hi jh b ji kw ij jk jl kx im jn jo ky jq jr js kz ju jv jw la jy jz ka hb bi translated">通过命令连接到服务器后，我们将首先更新然后安装python和nginx的包。</p><pre class="iy iz ja jb fd lb lc ld le aw lf bi"><span id="2938" class="lg kf hi lc b fi lh li l lj lk">$ sudo apt-get update</span></pre><p id="71a5" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">$ sudo apt-get install python3-pip python3-dev nginx</code></p><p id="f148" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">安装python和nginx之后，我们将继续安装virtualenv来创建虚拟环境。</p><p id="a5b5" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">$ sudo pip3 install virtualenv</code></p><h1 id="faff" class="ke kf hi bd kg kh ki kj kk kl km kn ko io kp ip kq ir kr is ks iu kt iv ku kv bi translated">步骤2 —创建虚拟环境</h1><p id="1ea1" class="pw-post-body-paragraph jf jg hi jh b ji kw ij jk jl kx im jn jo ky jq jr js kz ju jv jw la jy jz ka hb bi translated">创建一个新文件夹，并将文件夹刻录成光盘。在本教程中，我们的文件夹将被命名为“myflaskproject”。</p><p id="3f81" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">例如:</p><pre class="iy iz ja jb fd lb lc ld le aw lf bi"><span id="e298" class="lg kf hi lc b fi lh li l lj lk">mkdir myflaskproject</span><span id="30b5" class="lg kf hi lc b fi lo li l lj lk">cd myflaskproject</span></pre><p id="cb3e" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">创建一个名为“myfirstflask”类型的新虚拟环境</p><p id="2b4b" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">$ virtualenv myfirstflask</code></p><p id="0b7f" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在，要使用虚拟环境，我们需要激活它。我们将通过使用源虚拟化名称/bin/activate来实现</p><p id="c7b7" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">$ source myfirstflask/bin/activate</code></p><h1 id="23be" class="ke kf hi bd kg kh ki kj kk kl km kn ko io kp ip kq ir kr is ks iu kt iv ku kv bi translated">步骤3 —安装烧瓶和Gunicorn</h1><p id="59f3" class="pw-post-body-paragraph jf jg hi jh b ji kw ij jk jl kx im jn jo ky jq jr js kz ju jv jw la jy jz ka hb bi translated">Gunicorn是一个用于UNIX的Python WSGI HTTP服务器，它广泛兼容许多web框架，占用服务器资源少，速度快。</p><p id="091b" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">所以首先我们需要在服务器上安装Gunicorn:</p><p id="c8bc" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">$ sudo apt install gunicorn</code></p><p id="a0aa" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">激活虚拟环境时，使用pip(即使我们在虚拟环境中使用python3，我们也使用pip)来安装flask和gunicorn</p><p id="4d1c" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">$ pip install gunicorn flask</code></p><h1 id="f211" class="ke kf hi bd kg kh ki kj kk kl km kn ko io kp ip kq ir kr is ks iu kt iv ku kv bi translated">步骤4 —托管演示文件</h1><p id="6217" class="pw-post-body-paragraph jf jg hi jh b ji kw ij jk jl kx im jn jo ky jq jr js kz ju jv jw la jy jz ka hb bi translated">对于本教程，我们将创建一个hello word API来测试服务器配置和托管。</p><p id="7d5b" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在我们的项目myflaskproject的文件夹中创建一个新的模拟文件(helloworld.py)。这个文件做得非常简单，只是一个带有hello world消息的JSON。</p><p id="cc9d" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj"> helloworld.py: </strong></p><pre class="iy iz ja jb fd lb lc ld le aw lf bi"><span id="7952" class="lg kf hi lc b fi lh li l lj lk">from flask import Flask, jsonify, request</span><span id="be2a" class="lg kf hi lc b fi lo li l lj lk">app = Flask(__name__)</span><span id="b4fe" class="lg kf hi lc b fi lo li l lj lk">@app.route('/', methods=['GET'])</span><span id="6f22" class="lg kf hi lc b fi lo li l lj lk">def helloWorld():<br/>   if request.method == 'GET':<br/>      return jsonify({"PieceX tutorial": "HELLO WORLD"})</span><span id="390b" class="lg kf hi lc b fi lo li l lj lk">if __name__ == "__main__":<br/>   app.run(host='0.0.0.0')</span></pre><p id="e7f8" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">默认端口是5000，因此我们需要在服务器中打开该端口。如果您有防火墙或安全组(AWS ),您需要添加入站规则以允许端口5000</p><p id="52f2" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在服务器端:</p><p id="3f4c" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">(myfirstflask) $ sudo ufw allow 5000</code></p><p id="5169" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在让我们测试配置</p><p id="536f" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">(myfirstflask) $ python helloworld.py</code></p><p id="5b8c" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">打开浏览器，键入服务器的域名或端口后面的IP:5000</p><p id="2881" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">举个例子，</p><p id="9bd2" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><a class="ae kb" href="http://domainorip:5000/" rel="noopener ugc nofollow" target="_blank"> http://domainOrIP:5000 </a></p><p id="041f" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">您必须能够看到您的“hello world”应用程序。</p><p id="2229" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj"> WSGI </strong></p><p id="5e04" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">为了告诉Gunicorn如何与应用程序交互，我们需要一个入口点或wsgi。</p><p id="ace3" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在项目文件夹中创建一个名为wsgi.py的新文件</p><p id="0d9c" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">(myfirstflask) $ sudo nano wsgi.py</code></p><p id="904f" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">文件的代码:</p><p id="a6c1" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">wsgi.py:</p><pre class="iy iz ja jb fd lb lc ld le aw lf bi"><span id="418d" class="lg kf hi lc b fi lh li l lj lk">from helloworld import app</span><span id="4481" class="lg kf hi lc b fi lo li l lj lk">if __name__ == "__main__":</span><span id="4547" class="lg kf hi lc b fi lo li l lj lk">   app.run()</span></pre><p id="d1d0" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在这里，我们将通过导入并运行应用程序来调用我们的应用程序helloworld.py。</p><p id="9b3b" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在让我们用Gunicorn绑定wsgi文件</p><p id="f8c8" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">(myfirstflask) $ gunicorn --bind 0.0.0.0:5000 wsgi:app</code></p><p id="023a" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在端口5000浏览您的域/服务器IP:</p><p id="e179" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><a class="ae kb" href="http://domainorip:5000/" rel="noopener ugc nofollow" target="_blank"> http://domainOrIP:5000 </a></p><p id="7b5f" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">您应该能够看到和以前一样的输入。</p><p id="7ca7" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在我们需要中断托管。输入CTRL-C结束托管。中断托管后，我们还将停用虚拟环境，以继续Nginx配置和服务。</p><p id="f283" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">(myfirstflask) $ deactivate</code></p><p id="f1ce" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj"> Docker示例* </strong></p><p id="8af8" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><em class="lp">(*本节假设你已经安装了docker，并且具备一些Docker的基础知识。了解更多docker:</em><a class="ae kb" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"><em class="lp">https://www.docker.com/</em></a><em class="lp">)</em></p><p id="0bdd" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">为了使事情更简单，这里是前面步骤的docker文件。可以在这里下载:<a class="ae kb" href="https://www.piecex.com/source-code/Tutorial-Resources-Python-Webservice-API-Server-deployment-using-Ubuntu-1998" rel="noopener ugc nofollow" target="_blank">https://www . piecex . com/source-code/Tutorial-Resources-Python-web service-API-Server-deployment-using-Ubuntu-1998</a></p><p id="36ec" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">或者可以将其添加到保存Python文件的文件夹中。</p><p id="7c45" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">关于docker文件的简要说明:</p><blockquote class="lq lr ls"><p id="3ef8" class="jf jg lp jh b ji jj ij jk jl jm im jn lt jp jq jr lu jt ju jv lv jx jy jz ka hb bi translated">我们将使用来自docker hub(<a class="ae kb" href="https://hub.docker.com/_/nginx?tab=tags" rel="noopener ugc nofollow" target="_blank"><em class="hi">【https://hub.docker.com/_/nginx?tab=tags</em></a><em class="hi">)和Debian frontend的最新版本作为基础nginx。</em></p><p id="b5af" class="jf jg lp jh b ji jj ij jk jl jm im jn lt jp jq jr lu jt ju jv lv jx jy jz ka hb bi translated"><em class="hi">如果你用“ubuntu”做基础，这个dockerfile也可以。例如:</em></p><p id="5339" class="jf jg lp jh b ji jj ij jk jl jm im jn lt jp jq jr lu jt ju jv lv jx jy jz ka hb bi translated">来自ubuntu:最新</p><p id="d7a3" class="jf jg lp jh b ji jj ij jk jl jm im jn lt jp jq jr lu jt ju jv lv jx jy jz ka hb bi translated"><em class="hi">首先，我们更新，然后安装python3 pip，nginx(不需要，因为它来自基础映像，但我只是保留它，以防你想使用另一个基础映像)和gunicorn。</em></p><p id="f3d5" class="jf jg lp jh b ji jj ij jk jl jm im jn lt jp jq jr lu jt ju jv lv jx jy jz ka hb bi translated"><em class="hi">然后将文件夹中的文件作为名为“myflaskproject”的文件夹添加到容器中，并将其作为工作目录(当前路径)。</em></p><p id="a3fc" class="jf jg lp jh b ji jj ij jk jl jm im jn lt jp jq jr lu jt ju jv lv jx jy jz ka hb bi translated"><em class="hi">使用pip3将flask和gunicorn安装到python中。</em></p><p id="86cd" class="jf jg lp jh b ji jj ij jk jl jm im jn lt jp jq jr lu jt ju jv lv jx jy jz ka hb bi translated"><em class="hi">最后，使用gunicorn </em>将应用程序绑定到端口80</p></blockquote><p id="d589" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在是docker文件的代码。添加一个名为“Dockerfile”的文件，并插入以下内容:</p><pre class="iy iz ja jb fd lb lc ld le aw lf bi"><span id="fd2a" class="lg kf hi lc b fi lh li l lj lk">#We will use nginx latest as base, you can also use FROM ubuntu:latest instead</span><span id="3b7c" class="lg kf hi lc b fi lo li l lj lk">#FROM ubuntu:latest<br/>FROM nginx:latest<br/>ENV DEBIAN_FRONTEND noninteractive</span><span id="85bf" class="lg kf hi lc b fi lo li l lj lk">RUN apt-get update -q &amp;&amp; apt-get install -qqy \<br/>nano python3-pip python3-dev nginx gunicorn systemd</span><span id="c15d" class="lg kf hi lc b fi lo li l lj lk">ADD . /myflaskproject<br/>WORKDIR /myflaskproject</span><span id="2f97" class="lg kf hi lc b fi lo li l lj lk">RUN pip3 install gunicorn flask</span><span id="ab57" class="lg kf hi lc b fi lo li l lj lk">CMD gunicorn — bind 0.0.0.0:80 wsgi:app</span></pre><p id="e4eb" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果您下载了资源，那么您只需要进入终端，将文件夹“教程资源”光盘化</p><p id="2569" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">构建Dockerfile文件:</p><pre class="iy iz ja jb fd lb lc ld le aw lf bi"><span id="2d8e" class="lg kf hi lc b fi lh li l lj lk">docker build — tag flask_tutorial:1.0 .</span></pre><p id="31dc" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">然后运行容器，例如:</p><pre class="iy iz ja jb fd lb lc ld le aw lf bi"><span id="f3c8" class="lg kf hi lc b fi lh li l lj lk">docker run --publish 81:80 --detach --name flask_container flask_tutorial:1.0</span></pre><p id="e319" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这将把服务发布到您的本地主机端口81(确保您的端口81可用，或者在上面的docker命令中更改它)。</p><p id="23e2" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">进入你的浏览器，进入<a class="ae kb" href="http://localhost:81/" rel="noopener ugc nofollow" target="_blank"> http://localhost:81/ </a></p><p id="d3fe" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">它应该显示:{"PieceX教程":" HELLO WORLD"}</p><h1 id="e772" class="ke kf hi bd kg kh ki kj kk kl km kn ko io kp ip kq ir kr is ks iu kt iv ku kv bi translated">步骤5 —创建服务</h1><p id="b71e" class="pw-post-body-paragraph jf jg hi jh b ji kw ij jk jl kx im jn jo ky jq jr js kz ju jv jw la jy jz ka hb bi translated">为了运行应用程序，我们需要一个服务。请注意，最好使用supervisor来完成这项任务。对于本教程，我们将使用一个普通的服务来保持应用程序的活动。</p><p id="4ddb" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">当服务器重新启动时，它会自动启动Gunicorn和我们的应用程序/网站。</p><p id="1b30" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在ubuntu中，服务位于文件夹:/etc/systemd/system/</p><p id="a34b" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">首先，我们将测试服务中的逻辑，以验证一切正常:</p><p id="346e" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">类型:</p><p id="0d07" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">$ /home/ubuntu/myflaskproject/myfirstflask/bin/gunicorn --workers 3 --bind unix:flaskproject.sock -m 007 wsgi:app</code></p><p id="4a1d" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">它应该在端口80中托管您的应用程序，所以如果您进入浏览器并键入您的IP或域，它应该会返回我们的Hello World消息。</p><p id="ff9b" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">所以我们将创建一个新的。</p><p id="6443" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">$ sudo nano /etc/systemd/system/flaskproject.service</code></p><p id="ece0" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们的文件将如下所示:</p><pre class="iy iz ja jb fd lb lc ld le aw lf bi"><span id="3391" class="lg kf hi lc b fi lh li l lj lk">[Unit]</span><span id="7519" class="lg kf hi lc b fi lo li l lj lk">Description= This is a Gunicorn instance from PieceX tutorial for our hello world application</span><span id="432d" class="lg kf hi lc b fi lo li l lj lk">After=network.target</span><span id="144a" class="lg kf hi lc b fi lo li l lj lk">[Service]</span><span id="67c8" class="lg kf hi lc b fi lo li l lj lk">User=ubuntu</span><span id="d924" class="lg kf hi lc b fi lo li l lj lk">Group=www-data</span><span id="ae10" class="lg kf hi lc b fi lo li l lj lk">WorkingDirectory=/home/ubuntu/myflaskproject</span><span id="2b09" class="lg kf hi lc b fi lo li l lj lk">Environment="PATH=/home/ubuntu/myflaskproject/myfirstflask/bin"</span><span id="59ff" class="lg kf hi lc b fi lo li l lj lk">ExecStart=/home/ubuntu/myflaskproject/myfirstflask/bin/gunicorn -workers 3 - bind unix:flaskproject.sock -m 007 wsgi:app</span><span id="707c" class="lg kf hi lc b fi lo li l lj lk">[Install]</span><span id="5669" class="lg kf hi lc b fi lo li l lj lk">WantedBy=multi-user.target</span></pre><p id="dd90" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">[Unit]部分是元数据和依赖项，可以添加描述来轻松识别我们服务的功能。=network.target之后的命令将告诉我们的服务在到达网络目标之后启动它。</p><p id="6041" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在[Service]部分，我们指定将执行我们的服务的用户(它应该有足够的权限来执行)。我们将使用默认的托管组www-data，因为默认情况下它已经拥有所需的权限。</p><p id="0b48" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">WorkingDirectory是我们的应用程序所在的路径(比如apache /var/www/html)</p><p id="ba87" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Environment="PATH=我们将使用虚拟环境的路径。</p><p id="3c1e" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">最后，我们分配服务的执行</p><p id="87d5" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">[Install]部分将告诉您在引导时何时启动服务。</p><p id="8330" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">WantedBy =多用户.目标</p><p id="73e2" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">保存文件后，我们可以启动并启用服务。</p><p id="395d" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果文件中出现错误，您需要重新加载服务:sudo systemctl daemon-reload</p><p id="0592" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">$ sudo systemctl start flaskproject</code></p><p id="5e98" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">$ sudo systemctl enable flaskproject</code></p><h1 id="d595" class="ke kf hi bd kg kh ki kj kk kl km kn ko io kp ip kq ir kr is ks iu kt iv ku kv bi translated">第6步— Nginx</h1><p id="158f" class="pw-post-body-paragraph jf jg hi jh b ji kw ij jk jl kx im jn jo ky jq jr js kz ju jv jw la jy jz ka hb bi translated">Nginx是一个web服务器，就像apache一样，它也作为一个反向代理来处理Python WSGI的请求和响应。建议您使用Nginx for Python，而不是Apache。</p><p id="1d85" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">首先，我们需要为服务器创建配置文件，以使用我们刚刚在服务中创建的套接字。</p><p id="7b71" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">$ sudo nano /etc/nginx/sites-available/flaskproject</code></p><p id="dff4" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">添加以下内容:</p><blockquote class="lq lr ls"><p id="3e5f" class="jf jg lp jh b ji jj ij jk jl jm im jn lt jp jq jr lu jt ju jv lv jx jy jz ka hb bi translated">服务器{</p><p id="15db" class="jf jg lp jh b ji jj ij jk jl jm im jn lt jp jq jr lu jt ju jv lv jx jy jz ka hb bi translated">听80；</p><p id="6bb6" class="jf jg lp jh b ji jj ij jk jl jm im jn lt jp jq jr lu jt ju jv lv jx jy jz ka hb bi translated">server_name本地主机；<br/>位置/ {</p><p id="bf29" class="jf jg lp jh b ji jj ij jk jl jm im jn lt jp jq jr lu jt ju jv lv jx jy jz ka hb bi translated">包含proxy _ params</p><p id="29ea" class="jf jg lp jh b ji jj ij jk jl jm im jn lt jp jq jr lu jt ju jv lv jx jy jz ka hb bi translated">proxy _ pass<a class="ae kb" href="http://unix/home/ubuntu/myflaskproject/flaskproject.sock;" rel="noopener ugc nofollow" target="_blank">http://UNIX:/home/Ubuntu/myflaskproject/flask project . sock；</a></p><p id="95ff" class="jf jg lp jh b ji jj ij jk jl jm im jn lt jp jq jr lu jt ju jv lv jx jy jz ka hb bi">}</p><p id="823e" class="jf jg lp jh b ji jj ij jk jl jm im jn lt jp jq jr lu jt ju jv lv jx jy jz ka hb bi">}</p></blockquote><p id="d487" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这将使服务器通过使用我们项目的socket的proxy_pass监听端口80。</p><p id="a5be" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">然后，我们需要将我们的文件添加到启用站点列表中。</p><p id="795a" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">$ sudo ln -s /etc/nginx/sites-available/flaskproject /etc/nginx/sites-enabled</code></p><p id="455d" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">用欢迎页面删除默认的Nginx站点</p><p id="a4ff" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">$ rm /etc/nginx/sites-enabled/default</code></p><p id="0772" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">检查错误</p><p id="ed1c" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">$ sudo nginx -t</code></p><p id="f677" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">您应该会收到如下消息:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es kc"><img src="../Images/79d76011ec70528f49978c4f8f242e7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/0*4Lrn4tleMB9sCdCw"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es lw"><img src="../Images/5163d16ba84d2b7a6cc991915ab20124.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SSdVelrLA-lgNSK7.png"/></div></div></figure><p id="ec22" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">重启服务器</p><p id="f8ff" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">$ sudo systemctl restart nginx</code></p><p id="854c" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">因为我们不需要打开端口5000，所以我们将删除对端口5000的访问</p><p id="6b25" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">$ sudo ufw delete allow 5000</code></p><p id="a3a4" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du ll lm ln lc b">$ sudo ufw allow 'Nginx Full'</code></p><p id="db5c" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">就是这样！通过浏览您的域/服务器IP，您应该能够看到您的rest API:</p><p id="a88d" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><a class="ae kb" href="http://domainorip/" rel="noopener ugc nofollow" target="_blank"> http://domainOrIP </a></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es kc"><img src="../Images/6318df550e5edd472fde856f503e0b1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/0*yZau17SOnI3m_OVA"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es mb"><img src="../Images/bfd99cdb66fae6899a45110d79ab1eb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ASH3NgBWMOTkNUYR.png"/></div></div></figure><p id="466d" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">以下是一些可能对您有帮助的链接:</p><ul class=""><li id="0ae3" class="mc md hi jh b ji jj jl jm jo me js mf jw mg ka mh mi mj mk bi translated">https://www.nginx.com/</li><li id="7ee5" class="mc md hi jh b ji ml jl mm jo mn js mo jw mp ka mh mi mj mk bi translated">烧瓶:<a class="ae kb" href="http://flask.palletsprojects.com/en/1.1.x/" rel="noopener ugc nofollow" target="_blank">http://flask.palletsprojects.com/en/1.1.x/</a></li><li id="653c" class="mc md hi jh b ji ml jl mm jo mn js mo jw mp ka mh mi mj mk bi translated">https://gunicorn.org/</li><li id="41de" class="mc md hi jh b ji ml jl mm jo mn js mo jw mp ka mh mi mj mk bi translated">https://virtualenv.pypa.io/en/latest/</li></ul><p id="85ee" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在你已经有了关于部署Restful API的重要信息，我将推荐一个出售或购买你的源代码的网站:<a class="ae kb" href="https://piecex.page.link/mdm" rel="noopener ugc nofollow" target="_blank">www.piecex.com，</a>这是一个人工智能驱动的源代码市场，非常酷，来看看吧。</p><blockquote class="lq lr ls"><p id="a2b6" class="jf jg lp jh b ji jj ij jk jl jm im jn lt jp jq jr lu jt ju jv lv jx jy jz ka hb bi translated">最初发布于:<a class="ae kb" href="https://www.piecex.com/articles/Python-Webservice-API-Server-deployment-using-Ubuntu-282" rel="noopener ugc nofollow" target="_blank">https://www . piecex . com/articles/Python-web service-API-Server-deployment-using-Ubuntu-282</a></p></blockquote></div></div>    
</body>
</html>