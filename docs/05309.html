<html>
<head>
<title>Code your first telegram bot with pyTelegramBotAPI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用pyTelegramBotAPI编写你的第一个电报机器人</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/code-your-first-telegram-bot-with-pytelegrambotapi-1e6108cfa3b7?source=collection_archive---------4-----------------------#2020-04-17">https://medium.com/analytics-vidhya/code-your-first-telegram-bot-with-pytelegrambotapi-1e6108cfa3b7?source=collection_archive---------4-----------------------#2020-04-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="35a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">在线部署电报机器人的最快方法！</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/8acdb5c0dd09f3914ad9d794bfeddc9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EDJ9xoErBbZqK2tExVoJfA.png"/></div></div></figure><p id="41e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我第一次对如何创建自己的电报机器人感到好奇时，我在互联网上寻找最简单的方法。我偶然遇到的每一个优步似乎都以自己独特而乏味的方式做这件事，这对新手来说似乎令人生畏。</p><p id="41f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不要担心，在做了一些研究后，我现在介绍一种方法，让你的电报机器人在大约一个小时内启动并运行。(如果您已经熟悉编程概念，例如Python/Git/Heroku，速度会更快)</p><p id="20f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于本教程，我们需要(假设您已经在本地安装了git和python):</p><ul class=""><li id="efb5" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">赫罗库</li><li id="7a1f" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">计算机编程语言</li><li id="bd77" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">电报帐户</li></ul><p id="c6c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，你需要建立一个<a class="ae ke" href="https://www.heroku.com" rel="noopener ugc nofollow" target="_blank"> Heroku </a>账户，如果你还没有的话。<br/>注册后，继续创建新的应用程序。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kf"><img src="../Images/96d023e7839df732e9fdfacf06a65c62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CVScA2VOjCfLYYVjEbZTUQ.png"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">此时不要添加管道，只需填写前两个并单击create app。</figcaption></figure><p id="8e01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建应用程序后，我们将过渡到telegram。您需要在BotFather下创建一个bot，如下所示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kk"><img src="../Images/a7a4ea4dd807f169a1dfbf6b6f6db3fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nq6v__afZ2BzX_vrtgycUg.png"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">/newbot</figcaption></figure><p id="8ed6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">相应地填写所有信息，如果bot创建成功，您应该会看到如下内容:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kk"><img src="../Images/2aa046187047a9ffc668db6901066cf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ayCh-EBDNvhsXDpTaTjyxQ.png"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">您将很快需要从BotFather获得的API令牌</figcaption></figure><p id="2aa6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，打开终端/cmd并运行以下命令</p><p id="12f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kl km kn ko b">virtualenv botenv <br/>source botenv/bin/activate</code></p><p id="7bef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这样做的目的是创建一个虚拟环境，将随后使用pip3安装的依赖项与其他python项目分开。</p><p id="fa92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kl km kn ko b">pip3 install pyTelegramBotAPI Flask</code></p><p id="f6d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面这段代码安装了我们的电报机器人运行所需的所有依赖项。</p><p id="2f39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，在同一个目录下创建一个bot.py文件，并将以下代码粘贴到该文件中:</p><pre class="jf jg jh ji fd kp ko kq kr aw ks bi"><span id="b0a0" class="kt ku hi ko b fi kv kw l kx ky">import telebot<br/>import os<br/>from flask import Flask,request </span><span id="d9fe" class="kt ku hi ko b fi kz kw l kx ky">TOKEN = "Insert API Token from BotFather here"<br/>bot = telebot.TeleBot(token=TOKEN)<br/>server = Flask(__name__)</span></pre><p id="d0e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将导入我们之前用pip3安装的所有依赖项。我们还需要用BotFather提供的令牌替换令牌变量。请注意，令牌应该封装在左引号和右引号中。</p><p id="c251" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们可以将下面的代码粘贴到文件中，以定义我们的机器人的行为(即:如果我们发送'/help '，机器人将回复' Help message ')。更多信息请看一下<a class="ae ke" href="https://gist.github.com/alages97/af3308d291551d7443e8b39dce787076" rel="noopener ugc nofollow" target="_blank"> API </a>！</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="la lb l"/></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">请注意，第9–11行的函数基本上是让机器人模仿用户发送给它的任何东西，使用这个函数来实现您想要的输出！</figcaption></figure><p id="dcc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了设置webhook，bot.py文件的最后一部分由以下代码行组成。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="la lb l"/></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">将url的第一部分替换为您之前创建的Heroku应用程序的名称。在我的例子中，URL将是“https://bot-template-alages 1 . heroku app . com”</figcaption></figure><p id="434f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，为了将我们的代码安装到Heroku的服务器上，它需要一个名为Procfile的文件，该文件指定了应用程序在启动时执行的命令。</p><p id="f6ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在与bot.py <strong class="ih hj">相同的目录中创建‘Procfile’(注意，proc file没有文件扩展名)</strong></p><p id="5f1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为我们的python代码位于bot.py中，所以我们将以下代码复制到Procfile中:</p><pre class="jf jg jh ji fd kp ko kq kr aw ks bi"><span id="0d44" class="kt ku hi ko b fi kv kw l kx ky">web: python3 bot.py</span></pre><p id="e429" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们需要一个requirements.txt文件来让Heroku知道我们在项目中安装了哪些依赖项。在与bot.py和Procfile相同的目录中创建requirements.txt文件，并在terminal/cmd上运行以下命令</p><pre class="jf jg jh ji fd kp ko kq kr aw ks bi"><span id="dd8e" class="kt ku hi ko b fi kv kw l kx ky">pip3 freeze &gt; requirements.txt</span></pre><p id="9b76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您成功地完成了这一步，requirements.txt现在应该包含我们的bot正常运行所需的所有依赖项。</p><p id="6741" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回到你的浏览器，你现在应该在https://dashboard.heroku.com/apps/<a class="ae ke" href="https://dashboard.heroku.com/apps/bot-template-alages" rel="noopener ugc nofollow" target="_blank">&lt;</a>app _ name&gt;上。导航到页面的部署部分，您应该看到以下内容:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lc"><img src="../Images/730efa95f2638c20d7e4a9b32f6de014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GsfmQ9RXoPyRDdSfhQe7dA.png"/></div></div></figure><p id="0c76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于这个项目，我们将使用Heroku CLI将我们的bot部署到服务器，所以继续下载并安装Heroku CLI。之后，在您的cmd/终端上，键入上面的命令(heroku登录)。通过身份验证后，请执行以下操作:</p><pre class="jf jg jh ji fd kp ko kq kr aw ks bi"><span id="5c42" class="kt ku hi ko b fi kv kw l kx ky">git init<br/>heroku git:remote -a &lt;app_name&gt;<br/>git add .<br/>git commit -am "make it better"<br/>git push heroku master</span></pre><p id="066e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果到目前为止您已经正确执行了上述所有步骤，您应该会看到以下内容:</p><pre class="jf jg jh ji fd kp ko kq kr aw ks bi"><span id="e619" class="kt ku hi ko b fi kv kw l kx ky"><a class="ae ke" href="https://bot-template-alages.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://&lt;app_name&gt;.herokuapp.com/</a> deployed to Heroku</span></pre><p id="6127" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样！您已经成功地将您的机器人部署到Heroku。现在你可以去给你的机器人发电报了，看看它会有什么反应！</p><div class="ld le ez fb lf lg"><a href="https://github.com/alages97/telebot_template" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab dw"><div class="li ab lj cl cj lk"><h2 class="bd hj fi z dy ll ea eb lm ed ef hh bi translated">alages97/telebot_template</h2><div class="ln l"><h3 class="bd b fi z dy ll ea eb lm ed ef dx translated">电报机器人模板，在Heroku上运行。为alages97/telebot_template开发做出贡献，创建一个…</h3></div><div class="lo l"><p class="bd b fp z dy ll ea eb lm ed ef dx translated">github.com</p></div></div><div class="lp l"><div class="lq l lr ls lt lp lu jo lg"/></div></div></a></div></div><div class="ab cl lv lw gp lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="hb hc hd he hf"><p id="6cea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你喜欢我与你分享的内容，表现出一些爱，并留下一些评论/掌声。也接受关于接下来分享什么的建议！</p></div></div>    
</body>
</html>