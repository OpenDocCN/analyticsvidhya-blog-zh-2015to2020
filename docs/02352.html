<html>
<head>
<title>Web Scraping — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">网页抓取—第2部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/web-scraping-part-2-2ccdd145e8cb?source=collection_archive---------7-----------------------#2019-12-12">https://medium.com/analytics-vidhya/web-scraping-part-2-2ccdd145e8cb?source=collection_archive---------7-----------------------#2019-12-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="72f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用R同时抓取多个网页</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/bbd04194c4c18ec91c52e173d44e5a15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*71aEa9bEMYFFvRg5gAfPeQ.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">来源:Pixabay</figcaption></figure><p id="8b92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个简短的教程将介绍如何同时抓取网页上的多个页面。本教程假设您可以使用google chrome css选择器小工具。如果没有，请看第一部分<a class="ae jt" rel="noopener" href="/datadriveninvestor/web-scraping-crytocurrencies-with-r-a7ff07f135db">这里</a>。</p><p id="9a2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于一些网页包含大量数据(或文本)，例如评论部分，评论通常会溢出到下一页。它也可以用于排序，无论是哪种情况，单独抓取每一页都非常困难。为此，我想到了创建一个可以轻松抓取多个页面的功能。</p><p id="80dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将尝试刮一个艺术家(特拉维斯格林)的歌词，因为艺术家通常有相当多的歌曲在他们的投资组合，这将是极其艰巨的任务，试图刮个别网页。因此，让我们找出如何使刮这些页面变得容易。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="ea8f" class="kg kh hi kc b fi ki kj l kk kl">#Lets load in the required packages<br/>library(rvest)<br/>library(tidyverse)<br/>library(stringr)</span></pre><p id="ef68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们尝试使用rvest读取url，并获取包含歌曲列表的css标签。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es km"><img src="../Images/f40030e83266fea5cc8815d7264149ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U3oz0e2g7qhmvWvdianylg.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Songlyrics.com/Travis·格林</figcaption></figure><p id="0439" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们使用包含歌词的选择器小工具来定位歌曲列表的css标签。</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="746a" class="kg kh hi kc b fi ki kj l kk kl">#load in the url and <br/>#First we extract the central page url<br/>page_url &lt;- read_html("<a class="ae jt" href="http://www.songlyrics.com/travis-greene-lyrics/" rel="noopener ugc nofollow" target="_blank">http://www.songlyrics.com/travis-greene-lyrics/</a>") %&gt;% #Read the central url page containing lyrics list</span><span id="bbf5" class="kg kh hi kc b fi kn kj l kk kl">html_nodes("#colone-container .tracklist a") %&gt;% #Get the css tag for the listed songs</span><span id="9583" class="kg kh hi kc b fi kn kj l kk kl">  html_attr("href")  #Extract the url of each page from the css tag</span><span id="4c2c" class="kg kh hi kc b fi kn kj l kk kl">page_url</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es km"><img src="../Images/bad00317700a446bfc6113b471b68697.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nwFtD6dKTLurWI2x9PZ6Iw.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">歌词Url</figcaption></figure><p id="ec86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上图显示了上述代码的结果。我们拥有的是中央页面上列出的所有歌曲的url(链接)。</p><p id="f421" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们提取所有歌词的歌词名称(或歌词标题)</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="aa77" class="kg kh hi kc b fi ki kj l kk kl">page_title &lt;- read_html("<a class="ae jt" href="http://www.songlyrics.com/travis-greene-lyrics/" rel="noopener ugc nofollow" target="_blank">http://www.songlyrics.com/travis-greene-lyrics/</a>") %&gt;% <br/>  html_nodes("#colone-container .tracklist a") %&gt;% <br/>  html_text()</span><span id="d81e" class="kg kh hi kc b fi kn kj l kk kl">page_title</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es km"><img src="../Images/60f7da5099a88712f52c771b0b641b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vDqIY_61ELOhF95LjcaIPQ.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">歌词名称</figcaption></figure><p id="3751" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">获得歌词名称后，接下来我们创建一个函数来读取各个URL，然后在各个页面中加载歌词css选择器。别担心，我尽可能地简化了步骤。</p><ol class=""><li id="86e1" class="ko kp hi ih b ii ij im in iq kq iu kr iy ks jc kt ku kv kw bi translated">从上面获得的歌词url中找到<strong class="ih hj"> <em class="kx">歌词</em> </strong>的css标签，只需点击其中一个歌词即可获得css标签。</li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es km"><img src="../Images/0798918057ac5627d570e95be0b36923.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IrWMzebSxO4eUbbU35PZnQ.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">歌词css选择器</figcaption></figure><p id="d292" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在可以看到#songLyricsDiv是包含歌词的css标签。</p><p id="971d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.现在让我们创建一个函数，它将进入页面，然后读取页面的css标签(在这个例子中是歌词)。</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="9456" class="kg kh hi kc b fi ki kj l kk kl">read_lyrics &lt;- function(url) {<br/>  tibble(<br/>    lyrics = <br/>      url %&gt;%<br/>      read_html() %&gt;% <br/>      html_nodes("#songLyricsDiv") %&gt;%<br/>      html_text() <br/>  )<br/>}</span></pre><p id="c6d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">记住以上是一个函数，我们必须应用它。要应用:</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="d826" class="kg kh hi kc b fi ki kj l kk kl">page_url[1:9] %&gt;% #We select just nine urls already obtained as trial <br/>  set_names(1:9) %&gt;%  #A column that indicates the postion of each url <br/>  map_dfr(read_lyrics, .id = "Title")  %&gt;% <br/>  bind_cols(title = page_title[1:9]) #Bind the title of the first nine songs</span></pre><p id="4e69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上面的第三行代码开始，我们使用前面定义的函数，然后使用tidyverse管道将每个URL传递给该函数。</p><p id="66cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">发生的情况是，对于页面url中的每个单独的歌词，我们定义的函数进入传递给它的url，然后获取函数中定义的css标签，并返回抓取的歌词。它迭代地做这件事。</p><p id="e75f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在最后一行代码中发生的是，因为我们已经获得了存储在<strong class="ih hj"> <em class="kx"> page_title，</em> </strong>中的歌曲的标题，我们提取前九首歌曲，然后与提取的歌词进行列绑定，因为我们也只处理前九个URL。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es km"><img src="../Images/0944b5dc2b0ac70884e4476c2d8bd3e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dd_7nQTkCbCLUblBM0ADGA.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">歌词和标题</figcaption></figure><p id="4802" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的图像应该是你的结果。</p><h2 id="24a1" class="kg kh hi bd ky kz la lb lc ld le lf lg iq lh li lj iu lk ll lm iy ln lo lp lq bi translated">结论</h2><p id="1d54" class="pw-post-body-paragraph if ig hi ih b ii lr ik il im ls io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">我们已经简要地探讨了如何抓取多个页面，当然，不同的网站可能需要您稍微调整一下上面的代码，但它确实可以完成工作。在这里找到本教程<a class="ae jt" href="https://github.com/simmieyungie/Webscraping-/blob/master/Scraping%20Multiple%20pages.R" rel="noopener ugc nofollow" target="_blank">的完整脚本。</a></p></div></div>    
</body>
</html>