<html>
<head>
<title>Graphing data from Airtable</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Airtable绘制数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/graphing-data-from-airtable-67d4ebf13f39?source=collection_archive---------11-----------------------#2019-09-25">https://medium.com/analytics-vidhya/graphing-data-from-airtable-67d4ebf13f39?source=collection_archive---------11-----------------------#2019-09-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/27f18382048e56cae4074b29515cd98b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y-K4bpH1IXEua6hcshfESw.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="71c1" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated">本指南将带您了解如何使用python从Jupyter笔记本连接到Airtable底座，获取数据并绘制数据。</h2></div><h1 id="409b" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">介绍</h1><p id="e6e8" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">Airtable是一个非常棒的工具，可以集中数据并运行多个不同的业务部门。然而，有时我们可能有太多的表格数据，很难真正掌握每周的发展情况。</p><p id="c6cc" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">‌It有可能(在pro计划中)使用Airtable的代码块构建图表。另一个选择是导出到excel。但要真正增强你的分析能力，这项工作应该尽可能自动化。因此，本指南将向您展示如何从Jupyter笔记本中获取Airtable数据，操作和可视化这些数据，所有这些都是用Python编写的。</p><p id="0968" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">这篇文章是为你写的，如果:</p><ul class=""><li id="4015" class="lb lc ht kc b kd kw kg kx kj ld kn le kr lf kv lg lh li lj bi translated">您已经在使用Airtable进行一些特定的知识管理，例如销售CRM，但对内置的数据可视化功能感到失望。</li><li id="9f23" class="lb lc ht kc b kd lk kg ll kj lm kn ln kr lo kv lg lh li lj bi translated">如果您认为您的团队可以从一个更加自动化的流程中受益，该流程用于跟踪影响决策的指标。</li></ul><h1 id="476f" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">入门指南</h1><p id="0d2e" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">Airtable Python使用<a class="ae lp" href="http://docs.python-requests.org/" rel="noopener ugc nofollow" target="_blank">请求</a>，您可以通过运行以下命令来安装:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="69ef" class="lz jj ht lv b fi ma mb l mc md">conda install -c anaconda requests -y</span></pre><p id="f8d4" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">请注意，如果您还没有为您的帐户生成API密钥，您将需要<a class="ae lp" href="https://airtable.com/account" rel="noopener ugc nofollow" target="_blank">。你可以在你的Airtable </a><a class="ae lp" href="https://airtable.com/account" rel="noopener ugc nofollow" target="_blank">账户设置</a>中进行。</p><p id="cbeb" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">将API键放在正在运行的代码中是一种不好的做法。相反，我们可以在我们的<code class="du me mf mg lv b">~/.bash_profile</code>中设置一个全局变量。将您的API密钥复制到剪贴板。在首选编辑器中打开bash概要文件，并输入以下内容:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="032e" class="lz jj ht lv b fi ma mb l mc md">export 'AIRTABLE_API_KEY' = "API_KEY"</span></pre><p id="3e7c" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">用刚才复制的字符串替换“API_KEY”。</p><p id="e57e" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">从命令行运行:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="b5f7" class="lz jj ht lv b fi ma mb l mc md">source ~/.bash_profile</span></pre><p id="07da" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">Airtable的REST API接口可以在这里找到:<a class="ae lp" href="https://airtable.com/api" rel="noopener ugc nofollow" target="_blank">https://airtable.com/api</a>。我们现在准备开始使用Airtable Python。</p><h1 id="4e73" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">在Jupyterlab</h1><h2 id="68bc" class="lz jj ht bd jk mh mi mj jo mk ml mm js kj mn mo ju kn mp mq jw kr mr ms jy mt bi translated">获取我们的数据</h2><p id="0d04" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">出于本指南的目的，我们将使用Airtable的一个示例模板——<a class="ae lp" href="https://airtable.com/templates/sales-and-customers/expuCeCuZwIAc89uI/sales-pipeline" rel="noopener ugc nofollow" target="_blank">销售渠道</a>基础。让我们获取数据:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="75e9" class="lz jj ht lv b fi ma mb l mc md">from airtable import airtable</span><span id="103a" class="lz jj ht lv b fi mu mb l mc md">at = airtable.Airtable('BASE_ID', 'AIRTABLE_API_KEY')<br/></span><span id="a1d2" class="lz jj ht lv b fi mu mb l mc md">response1 = at.get('Sales Deals')</span><span id="5d65" class="lz jj ht lv b fi mu mb l mc md">response2 = at.get('Sales Reps')</span></pre><p id="9c60" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">其中‘air table _ API _ KEY’是我们刚刚在bash配置文件中设置的全局变量，而‘BASE _ ID’是我们正在使用的特定库的ID。Airtable的REST API接口可以在这里找到:<a class="ae lp" href="https://airtable.com/api" rel="noopener ugc nofollow" target="_blank">https://airtable.com/api</a>，在这里你可以访问你所有的Airtable基础列表。每个Airtable库都将提供自己的API来创建、读取、更新和销毁记录。</p><p id="834f" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">我们在<em class="mv">销售渠道</em>数据库中引入了两个不同的响应，分别对应于两个表格。</p><h2 id="667f" class="lz jj ht bd jk mh mi mj jo mk ml mm js kj mn mo ju kn mp mq jw kr mr ms jy mt bi translated">将响应转换成熊猫数据帧</h2><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="3767" class="lz jj ht lv b fi ma mb l mc md">import pandas as pd</span><span id="1a30" class="lz jj ht lv b fi mu mb l mc md">sales = pd.DataFrame(response1, columns=response.keys())</span><span id="775e" class="lz jj ht lv b fi mu mb l mc md">reps = pd.DataFrame(response2, columns=response.keys())</span><span id="772a" class="lz jj ht lv b fi mu mb l mc md">sales = pd.concat([sales.drop(['records'], axis=1), sales['records'].apply(pd.Series)], axis=1)</span><span id="fa94" class="lz jj ht lv b fi mu mb l mc md">sales = pd.concat([salesdf.drop(['fields'], axis=1), sales['fields'].apply(pd.Series)], axis=1).fillna('')</span><span id="86e0" class="lz jj ht lv b fi mu mb l mc md">reps = pd.concat([reps.drop(['records'], axis=1), reps['records'].apply(pd.Series)], axis=1)</span><span id="56ed" class="lz jj ht lv b fi mu mb l mc md">reps = pd.concat([reps.drop(['fields'], axis=1), reps['fields'].apply(pd.Series)], axis=1).fillna('')</span></pre><p id="65ea" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">上面我们已经将我们的响应分配给变量，并将它们读入各自的数据帧。来自Airtable的响应以有序字典的形式出现，我们已经在上面解析过了。</p><h2 id="cea9" class="lz jj ht bd jk mh mi mj jo mk ml mm js kj mn mo ju kn mp mq jw kr mr ms jy mt bi translated">可视化我们的数据</h2><p id="3970" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">现在是时候开始从我们的数据中获得洞察力了，但首先:</p><p id="2318" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated"><strong class="kc hu">定义您的业务问题</strong></p><p id="1503" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">你想回答什么商业问题？我们已经为我们的销售渠道样本数据列出了一些示例问题。</p><ol class=""><li id="098b" class="lb lc ht kc b kd kw kg kx kj ld kn le kr lf kv mw lh li lj bi translated">我们达成交易的价值是什么？谁获得了最多的收入？</li><li id="bbd3" class="lb lc ht kc b kd lk kg ll kj lm kn ln kr lo kv mw lh li lj bi translated">正在进行的其他交易处于什么阶段？这些交易的加权价值是多少？</li><li id="9803" class="lb lc ht kc b kd lk kg ll kj lm kn ln kr lo kv mw lh li lj bi translated">我们每月的实际收入是多少？我们的预测目标是什么？</li><li id="9ec8" class="lb lc ht kc b kd lk kg ll kj lm kn ln kr lo kv mw lh li lj bi translated">我们的销售代表表现如何？他们达到配额了吗？</li></ol><h2 id="cf55" class="lz jj ht bd jk mh mi mj jo mk ml mm js kj mn mo ju kn mp mq jw kr mr ms jy mt bi translated">安装所需的软件包</h2><p id="b8db" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">在Kyso，我们与<a class="ae lp" href="https://plot.ly/python/" rel="noopener ugc nofollow" target="_blank">合作很多。为了在jupyterlab中使用，我们需要安装JupyterLab和ipywidgets包:</a></p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="3630" class="lz jj ht lv b fi ma mb l mc md">conda install -c conda-forge jupyterlab-plotly-extension -y</span></pre><p id="3d15" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">Plotly有一个名为<em class="mv">袖扣</em>的熊猫包装器(数据操作库)，目前与plotly的最新版本存在兼容性问题。目前解决这个问题的方法是降级plotly并使用以下命令安装袖扣。一旦你看到用袖扣生成图形是多么容易，你就会明白为什么我们要经历这种麻烦。</p><p id="5bd7" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">从2019年9月起，这将帮助您启动并运行:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="0fae" class="lz jj ht lv b fi ma mb l mc md">conda install -c conda-forge plotly=2.7.0 -y</span><span id="1f3a" class="lz jj ht lv b fi mu mb l mc md">conda install -c conda-forge cufflinks-py -y</span></pre><p id="dedf" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">现在我们可以回答上面的问题了:</p><h2 id="41f9" class="lz jj ht bd jk mh mi mj jo mk ml mm js kj mn mo ju kn mp mq jw kr mr ms jy mt bi translated">1.按合同规模和销售代表列出的已完成交易</h2><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="d043" class="lz jj ht lv b fi ma mb l mc md">sales[sales['Sales Stage']=='Closed-Won'][['Signed Contract Value', 'Sales Rep']].set_index(</span><span id="c4c8" class="lz jj ht lv b fi mu mb l mc md">'Sales Rep').iplot(kind='bar', color = 'rgba(50, 171, 96, 1.0)', showgrid=False,</span><span id="30a6" class="lz jj ht lv b fi mu mb l mc md">title='Closed Deals', yTitle='Signed Contract Value')</span></pre><figure class="lq lr ls lt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mx"><img src="../Images/4eb293db7dde407cf912cc9893b15667.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FLqisOJ5XgZLEB4h"/></div></div></figure><h2 id="a5e2" class="lz jj ht bd jk mh mi mj jo mk ml mm js kj mn mo ju kn mp mq jw kr mr ms jy mt bi translated">2.按阶段和销售代表列出的交易估价</h2><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="5bc0" class="lz jj ht lv b fi ma mb l mc md">pd.DataFrame(sales[sales['Sales Stage']!='Closed-Won'][['Name', 'Sales Stage', 'Weighted Value', 'Sales Rep']].set_index('Sales Stage').groupby(</span><span id="012e" class="lz jj ht lv b fi mu mb l mc md">['Sales Stage', 'Sales Rep'])['Weighted Value'].sum().unstack(level=0)).iplot(kind='bar', mode='group', barmode='stack',</span><span id="4592" class="lz jj ht lv b fi mu mb l mc md">showgrid=False, title='Deal Valuation by Stage',</span><span id="7b1a" class="lz jj ht lv b fi mu mb l mc md">yTitle='Weighted Value (Forecasted Value * Probability of Closing)')</span></pre><figure class="lq lr ls lt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mx"><img src="../Images/a6f1bb258a049af2d89adc658dcab5e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*60hZV60Mjlju4wYo"/></div></div></figure><h2 id="32ef" class="lz jj ht bd jk mh mi mj jo mk ml mm js kj mn mo ju kn mp mq jw kr mr ms jy mt bi translated">3.实际收入和预测交易估值</h2><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="a363" class="lz jj ht lv b fi ma mb l mc md">sales['Last Contact'] = pd.to_datetime(sales['Last Contact'])</span><span id="a809" class="lz jj ht lv b fi mu mb l mc md">sales[['Last Contact', 'Forecast Value', 'Signed Contract Value']].sort_values(by='Last Contact').set_index('Last Contact').iplot(kind='scatter', mode='markers',</span><span id="19d0" class="lz jj ht lv b fi mu mb l mc md">showgrid=True, title='Actual Revenue and Forecasted Deals- January 2017',</span><span id="c6b5" class="lz jj ht lv b fi mu mb l mc md">yTitle='Signed Conntract Value')</span></pre><figure class="lq lr ls lt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mx"><img src="../Images/984cdaa69aa770874eeb99bd97abdb84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BgL91rPKyeGdRx2m"/></div></div></figure><h2 id="24ea" class="lz jj ht bd jk mh mi mj jo mk ml mm js kj mn mo ju kn mp mq jw kr mr ms jy mt bi translated">4.我们销售代表的成功率</h2><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="c6fb" class="lz jj ht lv b fi ma mb l mc md">fig = reps[['Name', 'Quota', 'Closed Amount', '% of Quota']].set_index('Name').iplot(kind='bar', mode='group', secondary_y=['% of Quota'],</span><span id="091f" class="lz jj ht lv b fi mu mb l mc md">showgrid=False, title = 'Sales Rep Quota Statuses', asFigure=True)</span><span id="07ad" class="lz jj ht lv b fi mu mb l mc md">fig['layout']['yaxis1'].update(title='Quota &amp; Closed Amounts')</span><span id="a05c" class="lz jj ht lv b fi mu mb l mc md">fig['layout']['yaxis2'].update(ticksuffix="%")</span><span id="9dd7" class="lz jj ht lv b fi mu mb l mc md">fig['layout']['yaxis1'].update(ticksuffix="$")</span><span id="64ff" class="lz jj ht lv b fi mu mb l mc md">fig['data'][0].marker.update(opacity=1)</span><span id="8b47" class="lz jj ht lv b fi mu mb l mc md">fig['data'][1].marker.update(opacity=1)</span><span id="71d7" class="lz jj ht lv b fi mu mb l mc md">fig['data'][2].marker.update(opacity=0.5)</span><span id="1a49" class="lz jj ht lv b fi mu mb l mc md">fig.iplot()</span></pre><figure class="lq lr ls lt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mx"><img src="../Images/f2c8e85abf65098b6d47dd74a5658f5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-lJ2u-NQ-yt1-vHp"/></div></div></figure><h1 id="5cdd" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">结论</h1><p id="986c" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">现在你知道了。易于构建的数据仪表盘现在触手可及！请注意，您可以在Github <a class="ae lp" href="http://github.com/KyleOS/airtable.py" rel="noopener ugc nofollow" target="_blank">上查看该指南，这里有一个示例笔记本和python代码，可以快速设置。要真正自动化这个工作流，您可以派生存储库&amp;编辑笔记本(即插入您自己的Airtable API密钥、您的基本名称和表名称)。</a></p><p id="6f4f" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">按照本指南中的<a class="ae lp" href="https://docs.kyso.io/posting-to-kyso/connect-a-github-repo-to-kyso" rel="noopener ugc nofollow" target="_blank">将您的存储库</a>同步到您的Kyso帐户。</p><p id="49a4" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">现在，每次您提交新的任务时，比如每周运行笔记本，这些变化都会反映在Kyso帖子上，您的团队可以在那里学习和协作。记住——只有当你真正使用所获得的洞察力时，数据对你才有用！</p></div></div>    
</body>
</html>