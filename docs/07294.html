<html>
<head>
<title>Hide Your Secret Keys With Conda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用康达隐藏你的秘密钥匙</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/hide-your-secret-keys-with-conda-1d22e42b82ed?source=collection_archive---------7-----------------------#2020-06-20">https://medium.com/analytics-vidhya/hide-your-secret-keys-with-conda-1d22e42b82ed?source=collection_archive---------7-----------------------#2020-06-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="f294" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">辅导的</h2><div class=""/><div class=""><h2 id="2719" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">使用conda &amp; Windows在虚拟环境中隐藏密钥、id和其他敏感信息的数据科学家指南。</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/b9d73a0f7abadfae937cc332a65f7b7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fOEWUsrai8jxP0Wg"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated"><a class="ae jw" href="https://unsplash.com/@jdphotomatography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杰森·D</a>在<a class="ae jw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="bc31" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">我开始了一个专注于新冠肺炎数据的新数据项目。获取数据并存储它涉及到相当多的API键&amp; IDs。作为一名深思熟虑的数据科学家，当我开始我的项目时，我创建了一个新的虚拟环境，就像我们都做的那样，对吗？无论如何——我将利用AWS和Google的API，并决定我需要隐藏我的秘密密钥，因为这个项目将被发布到公共回购中。在那一点上，我意识到我以前没有这样做过——在上传我的代码之前，我会简单地删除或者用‘YOUR _ SECRET _ KEY _ HERE’交换密钥。不够好(见下文)。在这里，我们将介绍如何在anaconda虚拟环境中隐藏您的密钥，使用Windows的环境变量。</p><h2 id="3e3e" class="kt ku hi bd kv kw kx ky kz la lb lc ld kg le lf lg kk lh li lj ko lk ll lm ho bi translated">什么是密钥？</h2><p id="d589" class="pw-post-body-paragraph jx jy hi jz b ka ln is kc kd lo iv kf kg lp ki kj kk lq km kn ko lr kq kr ks hb bi translated">当我说“密钥”时，我指的是任何类型的服务帐户密钥、秘密访问密钥、访问id、API密钥…凭证，用于授权访问受限服务或区域，在本例中为API。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ls"><img src="../Images/32d2d987c2fbe7511b459087656d82da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xCW21Ge7btBqRwKJ"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">照片由<a class="ae jw" href="https://unsplash.com/@wildbook?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">德米特里·德米德科</a>在<a class="ae jw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h2 id="42b7" class="kt ku hi bd kv kw kx ky kz la lb lc ld kg le lf lg kk lh li lj ko lk ll lm ho bi translated">为什么我们要隐藏它们？</h2><p id="55c7" class="pw-post-body-paragraph jx jy hi jz b ka ln is kc kd lo iv kf kg lp ki kj kk lq km kn ko lr kq kr ks hb bi translated">嗯——不隐藏密钥可能会导致一些相当昂贵的问题，例如2300美元的比特币采矿AWS账单，或者像Adobe <a class="ae jw" href="https://www.zdnet.com/article/adobe-accidentally-releases-private-pgp-key/" rel="noopener ugc nofollow" target="_blank">偶然在他们的安全博客上发布密钥</a>或优步试图<a class="ae jw" href="https://www.informationsecuritybuzz.com/expert-comments/uber-hack/" rel="noopener ugc nofollow" target="_blank">通过使用他们从GitHub获得的密钥之一来掩盖数据泄露</a>这样的尴尬时刻。看起来很多这样的密匙可以在像GitHub这样共享代码的回购网站上找到。坏演员是<a class="ae jw" href="https://www.cryptoglobe.com/latest/2020/05/hacker-steals-1200-worth-of-eth-using-github-bots/" rel="noopener ugc nofollow" target="_blank">使用机器人抓取GitHub </a>这些类型的密钥。不要试图记住代码中所有使用过该键的地方，最好从一开始就隐藏该键。</p><blockquote class="lt lu lv"><p id="e9ed" class="jx jy lw jz b ka kb is kc kd ke iv kf lx kh ki kj ly kl km kn lz kp kq kr ks hb bi translated">开发人员偶然地，而且经常是不知不觉地，在GitHub上一直共享凭证，从而暴露了他们的身份。虽然传统的安全控制对组织的安全仍然至关重要，但是如果能够访问私人信息的个人在一个可以被他人获取和滥用的地方暴露他们的帐户凭据，这是不好的。——Jeremiah Grossman，SentinalOne的顾问</p></blockquote></div><div class="ab cl ma mb gp mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="hb hc hd he hf"><p id="6d07" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">我发现有相当多的参考资料解释了如何向环境变量添加项目。对我来说，我见过的最常见的Windows选项不是很有条理，因为你想隐藏的所有项目都在一个地方。如果您有多个项目，这些项目可能会失去控制，并且随着环境变量列表的不断增长，对它们进行唯一命名可能会变得很麻烦。</p><p id="2aec" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">注意:</strong>如果你使用的是AWS这样的云平台，最好让你的程序承担一个“角色”，因为这个角色将获得临时安全凭证，而不需要使用访问id或密钥。这是AWS用户的最佳实践，你可以在这里了解更多<a class="ae jw" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html" rel="noopener ugc nofollow" target="_blank">。如果该选项不可用，则流程如下。</a></p><p id="2197" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">还有其他创建虚拟环境的包，如pipenv和virutalenv，但我们将通过一种方法来使用conda和Windows添加/隐藏这些键。你可以点击查看conda <a class="ae jw" href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html" rel="noopener ugc nofollow" target="_blank">文档。</a></p></div><div class="ab cl ma mb gp mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="hb hc hd he hf"><p id="bd41" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">在这些步骤中，我们将创建一个新的虚拟环境—如果您已经有了一个环境，请跳至步骤2。如果你不使用虚拟环境，你可能想！<a class="ae jw" href="https://www.datacamp.com/community/tutorials/virtual-environment-in-python" rel="noopener ugc nofollow" target="_blank">了解它们是什么</a>，为什么要使用它们，以及如何创建它们。</p><p id="6de0" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">下面是虚构的项目详情:</strong> <br/>要创建的新环境:<em class="lw"> my_new_env <br/> </em>批处理文件名:<strong class="jz hs"/><em class="lw">envv-AWS creds . bat</em><strong class="jz hs"><br/>My ACCESS _ KEY _ ID</strong>:' KLSNVEKWHLDYSK '<br/><strong class="jz hs">My SECRET _ ACCESS _ KEY</strong>= ' skdkjsnal 4489 kdsjl 49</p><p id="ed5a" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">首先，对于一个新项目，我们需要创建我们的新环境。——打开命令提示符并输入。</p><pre class="jh ji jj jk fd mh mi mj mk aw ml bi"><span id="da0f" class="kt ku hi mi b fi mm mn l mo mp">conda create -n my_new_env</span></pre><p id="38a9" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">提示| </strong>你可以在这里安装你需要的包，比如python &amp;的特定版本，使用<code class="du mq mr ms mi b">conda create -n myenv python=3.7</code></p><p id="50f5" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> 2|进入您新创建的环境</strong></p><pre class="jh ji jj jk fd mh mi mj mk aw ml bi"><span id="2be0" class="kt ku hi mi b fi mm mn l mo mp">conda activate my_new_env</span></pre><p id="9ba3" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> 3|定位并输入您的新虚拟环境的目录</strong> <br/> <code class="du mq mr ms mi b">%CONDA_PREFIX%</code>将显示您的新虚拟环境的位置。</p><pre class="jh ji jj jk fd mh mi mj mk aw ml bi"><span id="7278" class="kt ku hi mi b fi mm mn l mo mp">cd %CONDA_PREFIX%</span></pre><p id="8086" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">提示| </strong>您可以使用<code class="du mq mr ms mi b">cd %CONDA_PREFIX%</code>命令或者导航到您的Anaconda文件夹并导航到您的环境的存储位置。通常在<code class="du mq mr ms mi b">Anaconda\envs\</code> <br/>下，现在让我们创建两个新目录，并在新目录下创建两个新文件。</p><pre class="jh ji jj jk fd mh mi mj mk aw ml bi"><span id="56e4" class="kt ku hi mi b fi mm mn l mo mp">mkdir .\etc\conda\activate.d<br/>mkdir .\etc\conda\deactivate.d<br/>type NUL &gt; .\etc\conda\activate.d\envv-awscreds.bat<br/>type NUL &gt; .\etc\conda\deactivate.d\envv-awscreds.bat</span></pre><p id="7f4d" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">第1 &amp; 2行创建我们的新目录，第3 &amp; 4行创建空的批处理文件，供conda在启动虚拟环境时运行。</p><p id="3f1e" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">提示| </strong>你可以随意命名这些批处理文件为<code class="du mq mr ms mi b">envv-awscreds.bat</code>。</p><p id="5a02" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> 4|导航至两个新创建的文件并编辑<br/> </strong>您可以使用记事本编辑这些文件。</p><p id="1239" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">编辑<code class="du mq mr ms mi b"> \etc\conda\activate.d\envv-awscreds.bat</code>文件</p><pre class="jh ji jj jk fd mh mi mj mk aw ml bi"><span id="c0fc" class="kt ku hi mi b fi mm mn l mo mp">set ACCESS_KEY_ID=KLSNVEKWHLDYSK<br/>set SECRET_ACCESS_KEY=skdKJSNAL4489kdsjl49nkLKJJL</span></pre><p id="5fc4" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">注意| 我的键周围没有引号，赋值语句中也没有空格。</p><p id="62dd" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">编辑<code class="du mq mr ms mi b"> \etc\conda\deactivate.d\envv-awscreds.bat</code>文件</p><pre class="jh ji jj jk fd mh mi mj mk aw ml bi"><span id="030d" class="kt ku hi mi b fi mm mn l mo mp">set ACCESS_KEY_ID = <br/>set SECRET_ACCESS_KEY = </span></pre><p id="3113" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">很好——现在当我们运行activate my_new_env时，环境变量<em class="lw"> ACCESS_KEY_ID </em>和<em class="lw"> SECRET_ACCESS_KEY </em>将被设置为我们在文件中输入的变量。当我们停用环境时，变量将被删除。</p><p id="b4ff" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">停用环境，以便我们可以加载它，并仔细检查它的工作。</p><pre class="jh ji jj jk fd mh mi mj mk aw ml bi"><span id="7382" class="kt ku hi mi b fi mm mn l mo mp">conda deactivate</span></pre><p id="2200" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> 5|仔细检查分配是否有效<br/> </strong>从命令提示符启动您的虚拟环境</p><pre class="jh ji jj jk fd mh mi mj mk aw ml bi"><span id="740d" class="kt ku hi mi b fi mm mn l mo mp">conda activate my_new_env</span></pre><p id="0812" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">输出:</p><pre class="jh ji jj jk fd mh mi mj mk aw ml bi"><span id="af32" class="kt ku hi mi b fi mm mn l mo mp">C:\&gt;set ACCESS_KEY_ID=KLSNVEKWHLDYSK<br/>C:\&gt;set SECRET_ACCESS_KEY=skdKJSNAL4489kdsjl49nkLKJJL<br/>(my_new_env) C:\&gt;</span></pre><p id="5554" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">不错！我们看到它将我们的变量加载到环境中。让我们仔细检查一下是否可以用python来抓取它们。</p><p id="13a1" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> 6|将密钥加载到python脚本中</strong> <br/>要加载密钥，您需要使用<strong class="jz hs"> os </strong>模块</p><p id="0db9" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">启动python</p><pre class="jh ji jj jk fd mh mi mj mk aw ml bi"><span id="1e7e" class="kt ku hi mi b fi mm mn l mo mp">(my_new_env) C:\&gt; python</span></pre><p id="c2db" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">导入操作系统模块，检索密钥并赋值给变量</p><pre class="jh ji jj jk fd mh mi mj mk aw ml bi"><span id="5dd8" class="kt ku hi mi b fi mm mn l mo mp">&gt;&gt;&gt; import os<br/>&gt;&gt;&gt; ACCESS_KEY_ID = os.environ.get('ACCESS_KEY_ID')<br/>&gt;&gt;&gt; ACCESS_KEY_ID</span></pre><p id="ead7" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">输出:</p><pre class="jh ji jj jk fd mh mi mj mk aw ml bi"><span id="e0b7" class="kt ku hi mi b fi mm mn l mo mp">'KLSNVEKWHLDYSK'<br/>&gt;&gt;&gt;</span></pre><p id="3ae4" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">呜哇！现在，您可以在jupyter笔记本或python文件中使用<code class="du mq mr ms mi b">ACCESS_KEY_ID</code>,而不是使用实际的密钥进行认证。没有未知的比特币给你挖矿！您仍然需要确保带有您的密钥的脚本文件不会被您的回购程序使用。跟踪一个批处理脚本要比扫描项目文件寻找任何键容易得多。</p><p id="7d76" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">如果你认为你可能说漏了嘴，或者你在一个团队工作，想要再次确认没有机密的密钥、密码等。在你的回购中，有<a class="ae jw" href="https://geekflare.com/github-credentials-scanner/" rel="noopener ugc nofollow" target="_blank">种解决方案可以帮你走出</a>。</p></div></div>    
</body>
</html>