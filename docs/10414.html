<html>
<head>
<title>How to use pivot_table() in Pandas with examples</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在熊猫中使用 pivot_table()并举例说明</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/pandas-pivot-table-with-examples-c174501fa9a1?source=collection_archive---------0-----------------------#2020-10-18">https://medium.com/analytics-vidhya/pandas-pivot-table-with-examples-c174501fa9a1?source=collection_archive---------0-----------------------#2020-10-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="df70" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">你所需要知道的关于 pivot_table()在熊猫中的例子</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/08a950a602e9e544898fe749052578b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1NskH0319Ka4o-pNxdaJsw.png"/></div></div></figure><p id="cf71" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在本文中，我们将通过示例学习如何在 Pandas 中使用 pivot_table()。根据熊猫官方文件。</p><h1 id="ce80" class="kf kg hi bd kh ki kj kk kl km kn ko kp io kq ip kr ir ks is kt iu ku iv kv kw bi translated"><a class="ae kx" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.pivot_table.html" rel="noopener ugc nofollow" target="_blank">透视表</a>:</h1><p id="cdc9" class="pw-post-body-paragraph jj jk hi jl b jm ky ij jo jp kz im jr js la ju jv jw lb jy jz ka lc kc kd ke hb bi translated">”创建电子表格样式的数据透视表作为数据框架”。</p><p id="b143" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">数据透视表中的级别将存储在结果数据帧的索引和列上的多索引对象(分层索引)中。</p><p id="06c1" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">它以表格形式比较输入要素/数据列。让我们来看一些例子，以便更好地理解。还有其他方法可以获得类似的结果，比如我下一篇文章中讨论的 Pandas Crosstab，但是现在，我们将使用 Kaggle 中的 Cars 数据集。</p><h1 id="74ed" class="kf kg hi bd kh ki kj kk kl km kn ko kp io kq ip kr ir ks is kt iu ku iv kv kw bi translated">导入熊猫并加载数据</h1></div><div class="ab cl ld le gp lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hb hc hd he hf"><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="418b" class="lp kg hi ll b fi lq lr l ls lt">import pandas as pd<br/>import numpy as np<br/>data = pd.read_csv('USA_cars_datasets.csv')</span></pre><p id="78ff" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如果你想跟进，请点击这里从<a class="ae kx" href="https://www.kaggle.com/doaaalsenani/usa-cers-dataset" rel="noopener ugc nofollow" target="_blank">下载数据集。</a></p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="958d" class="lp kg hi ll b fi lq lr l ls lt">data.head()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lu"><img src="../Images/9c470870345035d768e1356380278dff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZbJQmgpWgE08QY52ExmpDA.png"/></div></div></figure><p id="9d1e" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">让我们只获取对我们有意义的几列，因为目的不是完全理解数据集。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="e0d5" class="lp kg hi ll b fi lq lr l ls lt">data.columns</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lv"><img src="../Images/9fcf4ef8b63b7324d4f6a78308dca873.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4N71GCJdUMdMXqmEQp5vJQ.png"/></div></div></figure><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="6fe4" class="lp kg hi ll b fi lq lr l ls lt">cols=['price', 'brand', 'model', 'year', 'title_status','mileage', 'color','state', 'country']</span><span id="4eeb" class="lp kg hi ll b fi lw lr l ls lt">data = data[cols]<br/>data.head()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lx"><img src="../Images/c910e8101109bece12cbabeeb0920958.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*rXe5eXymka063Uf7Yypjbw.png"/></div></figure><p id="ffc3" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">数据集和索引是创建简单数据透视表所必需的。让我们用品牌作为我们的指标。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="7ca7" class="lp kg hi ll b fi lq lr l ls lt">pd.pivot_table(data, index='brand')</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ly"><img src="../Images/ffe4122f38c42a4b85f1197a22d14a52.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*E0ZXyRd4CmW2v1sxfqCl3g.png"/></div></figure><p id="3d88" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">用这一行代码，它计算了所有数字列的平均值。它在计算一年的平均值，这没有任何意义，让我们暂时忽略它。</p><p id="90d7" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们也可以通过在 aggfunc 中显式指定 mean 函数来获得相同的结果。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="1d1b" class="lp kg hi ll b fi lq lr l ls lt">pd.pivot_table(data, index='brand',aggfunc='mean').head(10)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lz"><img src="../Images/1e02a70a45af6a90100b55120e8b7955.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*h6JObJAf5y-UXuotAqnAIA.png"/></div></figure><p id="afd4" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们可以将其他内置函数传递给 aggfunc 或自定义函数，让我们试试我们的自定义函数。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="0516" class="lp kg hi ll b fi lq lr l ls lt">def average_cars(price):<br/>    return np.mean(price)</span><span id="924b" class="lp kg hi ll b fi lw lr l ls lt">pd.pivot_table(data, index='brand', values='price', aggfunc=[sum,average_cars]).head(10)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ma"><img src="../Images/ebe50854cbbc2b1bdf79dff9a649deb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/1*3j1DZjSA2s6rUAva07gAnw.png"/></div></figure><p id="d9a9" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们只是返回平均值，但这里的想法是，你可以传递任何函数，返回一个基于你的自定义逻辑的聚合结果。</p><p id="3e4c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们可以通过一个列表在多个列上创建一个索引。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="117c" class="lp kg hi ll b fi lq lr l ls lt">pd.pivot_table(data, index=['brand', 'color'], values='price', aggfunc='sum').head(10)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mb"><img src="../Images/a7c4dfeaed52fd6f7e4608fb7a9c7fc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:444/format:webp/1*r-rIrTx9aBXRiPLVsl79IA.png"/></div></figure><p id="bb8f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">让我们来验证一下我们的结果</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="d035" class="lp kg hi ll b fi lq lr l ls lt">data[(data['brand']=='acura') ]</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mc"><img src="../Images/2c560d752bf3a2784edc596bb704804a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*HlJIcSxsyr2XiAf1dss0tg.png"/></div></figure><p id="39e3" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">仅仅通过改变顺序，我们得到不同的统计数据。我们可以有一个想法，我们可以实现数据透视表。</p><p id="5497" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如果我们想看总数。让我们按差额来做。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="5716" class="lp kg hi ll b fi lq lr l ls lt">pd.pivot_table(data,<br/>               index=['year','brand'],<br/>               values=['price'],<br/>               aggfunc='sum',<br/>               fill_value=0,<br/>               margins=True,<br/>               margins_name='Total')</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es md"><img src="../Images/dc06e4a6cd34918a0e3078d86959c434.png" data-original-src="https://miro.medium.com/v2/resize:fit:482/format:webp/1*q-WA1a_BWQ3buFdf6mfIrg.png"/></div></figure><p id="5654" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们可以向 aggfunc 传递一个列表，其中包含一个函数列表，这些函数将应用于值中的列。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="75ca" class="lp kg hi ll b fi lq lr l ls lt">pd.pivot_table(data, index=['year','brand'],<br/>               values=['price'],<br/>               aggfunc=[np.sum,np.mean],<br/>               fill_value=0,<br/>               margins=True,<br/>               margins_name='Total')</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es me"><img src="../Images/745c2c778e35b4852580225a3ec85dd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*7XY4i-YdCjIskUtb4RJZ_A.png"/></div></figure><p id="48b0" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们还可以向 aggfunc 传递一个字典来对值执行不同的函数。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="947a" class="lp kg hi ll b fi lq lr l ls lt">pd.pivot_table(data, <br/>               index=['brand', 'color','year'], <br/>               values=['price','mileage'], <br/>               aggfunc={'price':np.sum,'mileage':np.mean}).head(10)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mf"><img src="../Images/704fb014cedee665aff6b4d738b73c9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:636/format:webp/1*WvayQigyMVMUJO-6Y7bhEg.png"/></div></figure><h1 id="d643" class="kf kg hi bd kh ki kj kk kl km kn ko kp io kq ip kr ir ks is kt iu ku iv kv kw bi translated">高级过滤</h1><p id="9316" class="pw-post-body-paragraph jj jk hi jl b jm ky ij jo jp kz im jr js la ju jv jw lb jy jz ka lc kc kd ke hb bi translated">我们还可以在 values 中的特定列上传递要执行的函数列表。我们可以在一个数据框中获得上面显示的聚合数据，并执行 pandas 数据框操作来简化过滤。确保移除。head(10)在最后获得全部数据。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="3472" class="lp kg hi ll b fi lq lr l ls lt">p_table = pd.pivot_table(data, <br/>               index=['brand', 'color','year'], <br/>               values=['price','mileage'], <br/>               aggfunc={'price':[np.sum,np.mean],'mileage':np.mean})</span></pre><p id="0dce" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">现在我们可以在数据帧上执行标准的熊猫过滤操作</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="3020" class="lp kg hi ll b fi lq lr l ls lt">p_table.query('color=="black"')</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mg"><img src="../Images/95e826fac55318127bccd272c3beeaf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*xghWJuPso_wPMBpQyxrHZA.png"/></div></figure><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="de1f" class="lp kg hi ll b fi lq lr l ls lt">p_table.query('year &gt; 2009')</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mh"><img src="../Images/9342ead08966d5c629ff97a098ad8985.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*j9QffJFAkuHG0Vn2nFknCw.png"/></div></figure><p id="d09e" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">记住品牌、颜色和年份是多重指数的一部分</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="a5d0" class="lp kg hi ll b fi lq lr l ls lt">p_table.index</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mi"><img src="../Images/ad867cad97ef9779be057c47527717a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*uzAWKOfJsAgpn9PDWV-dnw.png"/></div></figure><p id="eb9e" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如果索引值是像洲名的国家名称这样的大字符串，例如<strong class="jl hj">‘美利坚合众国’</strong>，那么我们可以像这样应用包含操作。这里我们有一个品牌在<strong class="jl hj">级别 0 </strong>颜色在<strong class="jl hj">级别 1 </strong>和年份在<strong class="jl hj">级别 2 </strong></p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="6e43" class="lp kg hi ll b fi lq lr l ls lt">p_table[p_table.index.get_level_values(0).str.contains('audi')]</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mj"><img src="../Images/74c9b5f3084643bb5d123139f1b6a6e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*iyB-SQO3PDglXquD5-NqKg.png"/></div></figure><p id="6685" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这里<strong class="jl hj"> get_level_values(level) </strong>将级别作为输入和返回列表或数组，然后在将其转换为字符串后，我们可以应用简单的包含在我们的美国示例中，我们将编写类似这样的内容<strong class="jl hj">p _ table . index . get_level_values(0). str . contains(' Audi ')</strong>只需在 get _ level _ values()中放置适当的级别</p><p id="9772" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如果我们想基于列进行选择</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="94f8" class="lp kg hi ll b fi lq lr l ls lt">p_table[p_table[('mileage', 'mean')]&gt;170000]</span></pre><p id="37ff" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">或者简单地通过。点符号</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="0b7f" class="lp kg hi ll b fi lq lr l ls lt">p_table[p_table.mileage.values&gt;170000]</span></pre><p id="71ce" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">两者返回相同的结果</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mk"><img src="../Images/2c043e4f5dfa7f41eed7d166b27db446.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*cBjJCnqG80t18iQ7decF8A.png"/></div></figure><h1 id="7557" class="kf kg hi bd kh ki kj kk kl km kn ko kp io kq ip kr ir ks is kt iu ku iv kv kw bi translated">结论:</h1><p id="6ddd" class="pw-post-body-paragraph jj jk hi jl b jm ky ij jo jp kz im jr js la ju jv jw lb jy jz ka lc kc kd ke hb bi translated">在本文中，我试图解释 pivot_table 的用法，以及我们如何使用它通过简单的操作进行高级过滤来聚合数据。如果我们必须对数据集执行高级分析，首先尝试将数据集分成更小的单元，在另一个数据集中获取这些单元，然后对其应用过滤。另一个有用的方法是熊猫交叉表，我将在另一篇文章中解释。完整的笔记本可以在<a class="ae kx" href="https://github.com/muhammad055/DSArticles/blob/master/Pandas/Pandas%20crosstab%20and%20Pivot%20table.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p></div></div>    
</body>
</html>