<html>
<head>
<title>How to create your air pollution alert</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建你的空气污染警报</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-create-your-air-pollution-alert-fe8ecb6b0cd6?source=collection_archive---------14-----------------------#2020-03-11">https://medium.com/analytics-vidhya/how-to-create-your-air-pollution-alert-fe8ecb6b0cd6?source=collection_archive---------14-----------------------#2020-03-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/997543787f158b6ddb1fbe2564e7009b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FpBHBC6-pAefzeqC6T9srw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">马特·阿特兹在<a class="ae iu" href="https://unsplash.com/s/photos/polution?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="cd14" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">大家好，如今污染是一个热门话题。我住在马德里，空气污染是世界城市的大问题之一。为此，我决定创建自己的空气污染警报，我使用我的<a class="ae iu" href="https://grafana.com/" rel="noopener ugc nofollow" target="_blank"> Grafana </a>服务器(托管在我的<strong class="ix hj"> raspberry pi </strong>中)来创建警报，使用<em class="jt"> Python脚本</em>来获取污染数据。</p><p id="b43f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">空气污染是每个试图解决它的人都头疼的问题。在我现在所在的城市马德里，政府正试图通过限制车辆在市中心的使用来控制这个问题。但在我看来，这还不够。我不确定在最短的时间内解决这个问题的最佳选择是什么。我认为为了达到更好的结果，人们需要被意识到。</p><p id="8814" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我的小小贡献，除了不使用汽车，除非绝对必要，是创造一个小的<em class="jt"> Python脚本</em>来检测高水平的污染。</p><p id="814d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，您需要在<a class="ae iu" href="https://www.airvisual.com/" rel="noopener ugc nofollow" target="_blank"> AirVisual </a>中创建一个新帐户，以获得您的<strong class="ix hj"> API密钥</strong>，这是必要的，因为这项服务将为我们提供污染水平。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="e30e" class="kd ke hi jz b fi kf kg l kh ki">API_KEY = 'YOUR_AIRVISUAL_API_KEY'</span></pre><p id="f9a5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下一步非常简单，您只需要对API执行一个请求。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="c282" class="kd ke hi jz b fi kf kg l kh ki">import requests</span><span id="ea43" class="kd ke hi jz b fi kj kg l kh ki">URL = 'http://api.airvisual.com/v2/city?city=<strong class="jz hj">Madrid</strong>&amp;state=<strong class="jz hj">Madrid</strong>&amp;country=<strong class="jz hj">Spain</strong>&amp;key={}'.format(API_KEY)</span><span id="cf3c" class="kd ke hi jz b fi kj kg l kh ki">response = requests.get(URL)</span></pre><p id="9b96" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我使用<code class="du kk kl km jz b">/city</code>端点来获取特定城市的信息。如果你需要关于那个端点或其他端点的更多细节，请看官方的API文档。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/8fec147a3edf2127bd8788ebfd095c9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m8qFCsnViW3ofH2kea0r-g.png"/></div></div></figure><p id="c47a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">太好了，现在我感兴趣的值是<code class="du kk kl km jz b">aqius</code></p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="05f4" class="kd ke hi jz b fi kf kg l kh ki">aqius = response.json()['data']['current']['pollution']['<strong class="jz hj">aqius</strong>']</span></pre><p id="da0f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">基于美国环保局的AQI值是一个标准的<a class="ae iu" href="https://airnow.gov/index.cfm?action=aqibasics.aqi" rel="noopener ugc nofollow" target="_blank">空气质量值</a>，在下面的表格中你可以看到不同的等级。用这个API你可以得到其他空气质量标准值，比如AQI CN。选择你想要的。在这篇文章中，我与美国环保署合作。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/ed5b66c5ada3113dc058ee65b840faa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M6ueW6gUJbLOGTwtIf_SWw.png"/></div></div></figure><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="fddc" class="kd ke hi jz b fi kf kg l kh ki">import requests</span><span id="6dd7" class="kd ke hi jz b fi kj kg l kh ki">API_KEY = 'YOUR_AIRVISUAL_API_KEY'<br/>city = 'Madrid'<br/>state = 'Madrid'<br/>country = 'Spain'<br/>URL = 'http://api.airvisual.com/v2/city?city={}&amp;state={}&amp;country={}&amp;key={}'.format(city, state, country, API_KEY)</span><span id="ca1f" class="kd ke hi jz b fi kj kg l kh ki">def get_aqius(response):<br/>    return response['data']['current']['pollution']['aqius']</span><span id="a8f5" class="kd ke hi jz b fi kj kg l kh ki">aqius_level = get_aqius(requests.get(URL).json())</span></pre><p id="52fe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过这个<code class="du kk kl km jz b">aqius_level</code>，我们将发送到我们的Grafana服务器并配置我们的警报。很抱歉省略了其余的步骤，但是Grafana有太多的表单，无法向服务器发送信息。我更愿意把这一部分留给以后的另一篇文章。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kp"><img src="../Images/e8f9be8a13bc9c5df965fe9ada611426.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*9dXY3eW-bfFOg0dORZ62EQ.png"/></div></figure><p id="1156" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为什么是格拉夫纳？我喜欢它，因为它功能多样，适合各种需求。但是在您的脚本中，您可以发送任何您想要的警报。</p><p id="9843" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，这是我的仪表配置。我为每个不同的级别设置了阈值</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kq"><img src="../Images/730297c0e852e5dd32e7c1cf9ce215d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*etDILyCW-BLymD7Hzj6wjQ.png"/></div></figure><p id="790b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我用一个图表来定义我的污染警报。当污染在100以上时，服务会向我的<strong class="ix hj"> Slack </strong>发送消息。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/3d5ec973c4d2e289d3d553524ef3298b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qDJc_YC0aWswnKJYM_FHDQ.png"/></div></div></figure><p id="b443" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是来自<strong class="ix hj"> Slack </strong>的一个示例消息。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es ks"><img src="../Images/489f97e579fb93dac292a92f73c09393.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*YXfLDQze3GVy0Yi1ezMaaw.png"/></div></figure><p id="92e8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">仅此而已。我邀请你用另一种服务创建你自己的提醒，例如电子邮件。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="4d53" class="kd ke hi jz b fi kf kg l kh ki">import smtplib, ssl</span><span id="eb11" class="kd ke hi jz b fi kj kg l kh ki">def send_email(message):<br/>    context = ssl.create_default_context()<br/>    with smtplib.SMTP_SSL(smtp_server, port, context=context) as server:<br/>        server.login(sender_email, password)<br/>        server.sendmail(sender_email, receiver_email, message)</span></pre><p id="aecf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我经常使用Grafana板，将来我会创建更多关于不同信息来源的帖子，放在你们不同的板上。</p><p id="11ec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢阅读，回头见。</p></div></div>    
</body>
</html>