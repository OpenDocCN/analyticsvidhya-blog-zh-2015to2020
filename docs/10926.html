<html>
<head>
<title>How to create a confusion matrix with the test result in your training model using matplotlib</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 matplotlib 在您的训练模型中使用测试结果创建混淆矩阵</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-create-a-confusion-matrix-with-the-test-result-in-your-training-model-802b1315d8ee?source=collection_archive---------4-----------------------#2020-11-09">https://medium.com/analytics-vidhya/how-to-create-a-confusion-matrix-with-the-test-result-in-your-training-model-802b1315d8ee?source=collection_archive---------4-----------------------#2020-11-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/0aab36deb45da87d243355658160799f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eg-HeEAMk8mtmblkHymRpQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">混淆矩阵(图片，作者 GIF)<a class="ae iu" href="https://github.com/oleksandr-g-rock/How_to_create_confusion_matrix/blob/main/1_eg-HeEAMk8mtmblkHymRpQ.png" rel="noopener ugc nofollow" target="_blank">https://github . com/oleks andr-g-rock/How _ to _ create _ confusion _ matrix/blob/main/1 _ eg-hee amk 8 mtmblkhymrpq . png</a></figcaption></figure><h1 id="ba1f" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">简短摘要:</h1><p id="193a" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">这篇文章与我的上一篇文章几乎相同，但变化不大:</p><div class="kr ks ez fb kt ku"><a href="https://oleksandrg.medium.com/image-classifications-flowers-recognition-58a5b0b1154f" rel="noopener follow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">图像分类:花卉识别</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">如何创建图像分类:5 类花卉识别？最初需要:</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">oleksandrg.medium.com</p></div></div><div class="ld l"><div class="le l lf lg lh ld li io ku"/></div></div></a></div><p id="0522" class="pw-post-body-paragraph jt ju hi jv b jw lj jy jz ka lk kc kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">如果你只想看看笔记本或者只是运行代码，请点击<a class="ae iu" href="https://github.com/oleksandr-g-rock/How_to_create_confusion_matrix/blob/main/How_to_create_a_confusion_matrix.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a></p><h1 id="02a5" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">所以，我们开始吧:)</h1><p id="df70" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">所以我只是解释如何创建一个混淆矩阵，如果你做一个图像分类模型。</p><p id="e57e" class="pw-post-body-paragraph jt ju hi jv b jw lj jy jz ka lk kc kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">首先，我们需要在数据集中创建 3 个文件夹(testing、train、val ),如屏幕截图所示:</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div class="er es lo"><img src="../Images/6693e37227579c7348c0f8eb11ae21f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*833WRD2MhREFOPxPEkkzRQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">(图片，作者 GIF)<a class="ae iu" href="https://github.com/oleksandr-g-rock/How_to_create_confusion_matrix/blob/main/1_833WRD2MhREFOPxPEkkzRQ.png" rel="noopener ugc nofollow" target="_blank">https://github . com/oleks andr-g-rock/How _ to _ create _ confusion _ matrix/blob/main/1 _ 833 wrd 2 mhrefopxpekkzrq . png</a></figcaption></figure><p id="697a" class="pw-post-body-paragraph jt ju hi jv b jw lj jy jz ka lk kc kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">每个文件夹中图像文件的大致数量:<br/>测试— 5% <br/>训练— 15% <br/> val — 80%</p><p id="24c1" class="pw-post-body-paragraph jt ju hi jv b jw lj jy jz ka lk kc kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">因此，文件夹“train”将用于训练模型，文件夹“val”将用于显示每个时期的结果。和“测试”文件夹将只用于新图像中的测试模型。</p><p id="9be6" class="pw-post-body-paragraph jt ju hi jv b jw lj jy jz ka lk kc kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">所以首先，我们需要定义文件夹</p><pre class="lp lq lr ls fd lt lu lv lw aw lx bi"><span id="61b5" class="ly iw hi lu b fi lz ma l mb mc"># folders with train dir &amp; val dir</span><span id="7749" class="ly iw hi lu b fi md ma l mb mc">train_dir = '/content/flowers/train/'</span><span id="d78c" class="ly iw hi lu b fi md ma l mb mc">test_dir = '/content/flowers/val/'</span><span id="216e" class="ly iw hi lu b fi md ma l mb mc">testing_dir = '/content/flowers/testing/'</span><span id="d9fb" class="ly iw hi lu b fi md ma l mb mc">input_shape = (image_size, image_size, 3)</span></pre><p id="1a65" class="pw-post-body-paragraph jt ju hi jv b jw lj jy jz ka lk kc kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">在下一步中，我们需要添加图像数据生成器，以便使用 shuffle 参数 FALSE 进行测试</p><pre class="lp lq lr ls fd lt lu lv lw aw lx bi"><span id="a75b" class="ly iw hi lu b fi lz ma l mb mc">testing_datagen = ImageDataGenerator(rescale=1. / 255)</span><span id="e4b1" class="ly iw hi lu b fi md ma l mb mc">testing_generator = testing_datagen.flow_from_directory(</span><span id="8568" class="ly iw hi lu b fi md ma l mb mc">testing_dir,</span><span id="0022" class="ly iw hi lu b fi md ma l mb mc">target_size=(image_size, image_size),</span><span id="d701" class="ly iw hi lu b fi md ma l mb mc">batch_size=batch_size,</span><span id="fbca" class="ly iw hi lu b fi md ma l mb mc"><strong class="lu hj">shuffle=False,</strong></span><span id="b6bf" class="ly iw hi lu b fi md ma l mb mc">class_mode='categorical')</span></pre><p id="aff4" class="pw-post-body-paragraph jt ju hi jv b jw lj jy jz ka lk kc kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">训练完模型后，我们应该运行下一个代码来检查测试数据的结果</p><pre class="lp lq lr ls fd lt lu lv lw aw lx bi"><span id="6ca0" class="ly iw hi lu b fi lz ma l mb mc">test_score = model.evaluate_generator(testing_generator, batch_size)</span><span id="538f" class="ly iw hi lu b fi md ma l mb mc">print("[INFO] accuracy: {:.2f}%".format(test_score[1] * 100))</span><span id="91a2" class="ly iw hi lu b fi md ma l mb mc">print("[INFO] Loss: ",test_score[0])</span></pre><p id="0a29" class="pw-post-body-paragraph jt ju hi jv b jw lj jy jz ka lk kc kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">我们应该有这样的结果:</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/3152dc092af6b5741cf53d1cac6b6a82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F5yFq8j7eaLwQNXdUPsY_w.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">(图片，作者 GIF)<a class="ae iu" href="https://github.com/oleksandr-g-rock/How_to_create_confusion_matrix/blob/main/1_F5yFq8j7eaLwQNXdUPsY_w.png" rel="noopener ugc nofollow" target="_blank">https://github . com/oleks andr-g-rock/How _ to _ create _ confusion _ matrix/blob/main/1 _ f 5 yfq 8j 7 ealwqnxdupsy _ w . png</a></figcaption></figure><p id="e4ea" class="pw-post-body-paragraph jt ju hi jv b jw lj jy jz ka lk kc kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">并运行代码来显示您的训练模型中测试结果的混淆矩阵</p><pre class="lp lq lr ls fd lt lu lv lw aw lx bi"><span id="0913" class="ly iw hi lu b fi lz ma l mb mc">#Plot the confusion matrix. Set Normalize = True/False</span><span id="0b1e" class="ly iw hi lu b fi md ma l mb mc">def plot_confusion_matrix(cm, classes, normalize=True, title='Confusion matrix', cmap=plt.cm.Blues):<br/>    """<br/>    This function prints and plots the confusion matrix.<br/>    Normalization can be applied by setting `normalize=True`.<br/>    """<br/>    plt.figure(figsize=(20,20))</span><span id="5bcd" class="ly iw hi lu b fi md ma l mb mc">plt.imshow(cm, interpolation='nearest', cmap=cmap)<br/>    plt.title(title)<br/>    plt.colorbar()</span><span id="7689" class="ly iw hi lu b fi md ma l mb mc">tick_marks = np.arange(len(classes))<br/>    plt.xticks(tick_marks, classes, rotation=45)<br/>    plt.yticks(tick_marks, classes)</span><span id="dff0" class="ly iw hi lu b fi md ma l mb mc">if normalize:<br/>        cm = cm.astype('float') / cm.sum(axis=1)[:, np.newaxis]<br/>        cm = np.around(cm, decimals=2)<br/>        cm[np.isnan(cm)] = 0.0<br/>        print("Normalized confusion matrix")<br/>    else:<br/>        print('Confusion matrix, without normalization')<br/>    thresh = cm.max() / 2.<br/>    for i, j in itertools.product(range(cm.shape[0]), range(cm.shape[1])):<br/>        plt.text(j, i, cm[i, j],<br/>                 horizontalalignment="center",<br/>                 color="white" if cm[i, j] &gt; thresh else "black")<br/>    plt.tight_layout()<br/>    plt.ylabel('True label')<br/>    plt.xlabel('Predicted label')</span><span id="46c5" class="ly iw hi lu b fi md ma l mb mc">#Print the Target names<br/>from sklearn.metrics import classification_report, confusion_matrix<br/>import itertools <br/>#shuffle=False</span><span id="3f07" class="ly iw hi lu b fi md ma l mb mc">target_names = []<br/>for key in train_generator.class_indices:<br/>    target_names.append(key)</span><span id="bd71" class="ly iw hi lu b fi md ma l mb mc"># print(target_names)</span><span id="0570" class="ly iw hi lu b fi md ma l mb mc">#Confution Matrix</span><span id="878b" class="ly iw hi lu b fi md ma l mb mc">Y_pred = model.predict_generator(testing_generator)<br/>y_pred = np.argmax(Y_pred, axis=1)<br/>print('Confusion Matrix')<br/>cm = confusion_matrix(testing_generator.classes, y_pred)<br/>plot_confusion_matrix(cm, target_names, title='Confusion Matrix')</span><span id="cb24" class="ly iw hi lu b fi md ma l mb mc">#Print Classification Report<br/>print('Classification Report')<br/>print(classification_report(testing_generator.classes, y_pred, target_names=target_names))</span></pre><p id="66fa" class="pw-post-body-paragraph jt ju hi jv b jw lj jy jz ka lk kc kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">我们应该有这样的结果:</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/0716dbb0601b7f0396953e1deb8168a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0KCwX9fDz9qC-Zo4K5KTNQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">混淆矩阵(图片，作者 GIF)<a class="ae iu" href="https://github.com/oleksandr-g-rock/How_to_create_confusion_matrix/blob/main/1_0KCwX9fDz9qC-Zo4K5KTNQ.png" rel="noopener ugc nofollow" target="_blank">https://github . com/oleks andr-g-rock/How _ to _ create _ confusion _ matrix/blob/main/1 _ 0kcwx 9 fdz 9 QC-zo4k 5k tnq . png</a></figcaption></figure><h1 id="3be0" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">结果:</h1><p id="e24b" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们通过 matplotlib 创建了混淆矩阵。<br/>如果您只想查看笔记本或运行代码，请点击<a class="ae iu" href="https://github.com/oleksandr-g-rock/How_to_create_confusion_matrix" rel="noopener ugc nofollow" target="_blank">此处</a></p><figure class="lp lq lr ls fd ij"><div class="bz dy l di"><div class="mg mh l"/></div></figure></div></div>    
</body>
</html>