<html>
<head>
<title>Part One: Create a schema and tables within a PostgreSQL database to support data collection from a REST API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第一部分:在PostgreSQL数据库中创建模式和表，以支持从REST API收集数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/part-one-create-a-schema-and-tables-within-a-postgresql-database-to-support-data-collection-from-5c25a7db1ad4?source=collection_archive---------7-----------------------#2020-01-30">https://medium.com/analytics-vidhya/part-one-create-a-schema-and-tables-within-a-postgresql-database-to-support-data-collection-from-5c25a7db1ad4?source=collection_archive---------7-----------------------#2020-01-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/cfc68e4ab734afd30f8b5781946a63a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GbK-OjUvPf5B11t9"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">伊尔泽·卢塞罗在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="a26d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">注意:在继续之前，我建议浏览一下如何使用Amazon RDS创建PostgreSQL数据库的教程。我在这里写了一个</em><a class="ae iu" rel="noopener" href="/@bickell.taylor/creating-and-connecting-a-postgresql-database-with-amazons-relational-database-service-rds-dcc9db0cd37f"><em class="jt"/></a><em class="jt">，它旨在与这两个系列无缝集成。</em></p><p id="6e30" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">出于演示目的，我选择使用Cryptowatch REST API。但是，如果您已经选择了另一个REST API，并且知道将从其中收集哪些数据，那么您很可能已经准备好为PostgreSQL数据库创建模式和表了。至此，请随意跳过我讨论Cryptowatch API的第一部分。</em></p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="2948" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated">创建Cryptowatch帐户和有关Cryptowatch REST API的信息</h2><p id="55fc" class="pw-post-body-paragraph iv iw hi ix b iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo la jq jr js hb bi translated">如果您对从多个加密货币交易所收集数据感兴趣，Cryptowatch API是一个很好的起点。为什么？目前，通过帐户可以免费获得Cryptowatch API的初始访问权限。此外，使用一个API跨多个交换收集数据有助于实现一致的格式。</p><p id="76b4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要创建Cryptowatch帐户，请点击此处的<a class="ae iu" href="https://cryptowat.ch/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="0513" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">一旦你创建了一个账户，你如何获得一个公开的API密匙？</strong></p><ol class=""><li id="08e0" class="lb lc hi ix b iy iz jc jd jg ld jk le jo lf js lg lh li lj bi translated">确保您已登录您的帐户并登录到<a class="ae iu" href="https://cryptowat.ch/" rel="noopener ugc nofollow" target="_blank"> Cryptowatch网站</a>的主页。</li><li id="91b7" class="lb lc hi ix b iy lk jc ll jg lm jk ln jo lo js lg lh li lj bi translated">单击位于主页右上角的“我的帐户”。</li><li id="5830" class="lb lc hi ix b iy lk jc ll jg lm jk ln jo lo js lg lh li lj bi translated">在下拉菜单中选择“API访问”。</li><li id="a8e1" class="lb lc hi ix b iy lk jc ll jg lm jk ln jo lo js lg lh li lj bi translated">要获取公钥，请向下滚动API访问页面，直到看到“生成密钥”点按“生成密钥”一旦您这样做了，您现在应该在您的“API密钥”中看到一个“公钥”</li></ol><p id="2ecb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您按照本教程进行操作，那么最好继续复制公钥，并将其粘贴到一个安全、可访问的位置，以便以后访问。</p><p id="2d32" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">交易所和交易对</strong></p><p id="facd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我从Cryptowatch API中选择了三个交易所和交易对来收集数据。这些可以根据你自己的目标轻松调整。</p><p id="c198" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">交易所</em> <strong class="ix hj"> </strong> <em class="jt">(支持的交易所可以在</em> <a class="ae iu" href="https://docs.cryptowat.ch/rest-api/#supported-exchanges" rel="noopener ugc nofollow" target="_blank"> <em class="jt">这里找到</em> </a> <em class="jt">)。)</em></p><ol class=""><li id="8549" class="lb lc hi ix b iy iz jc jd jg ld jk le jo lf js lg lh li lj bi translated">Bitfinex</li><li id="a261" class="lb lc hi ix b iy lk jc ll jg lm jk ln jo lo js lg lh li lj bi translated">比特币基地专业</li><li id="138a" class="lb lc hi ix b iy lk jc ll jg lm jk ln jo lo js lg lh li lj bi translated">HitBTC</li></ol><p id="6106" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">交易对</em></p><ol class=""><li id="bb31" class="lb lc hi ix b iy iz jc jd jg ld jk le jo lf js lg lh li lj bi translated">BCH-BTC</li><li id="ccc8" class="lb lc hi ix b iy lk jc ll jg lm jk ln jo lo js lg lh li lj bi translated">BTC联邦理工学院</li><li id="8940" class="lb lc hi ix b iy lk jc ll jg lm jk ln jo lo js lg lh li lj bi translated">LTC-BTC</li></ol><p id="4a19" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">API返回的数据是什么样子的？</strong></p><p id="7e84" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由Cryptowatch API返回的数据的格式将告知如何在数据库模式中构造表。在这次演练中，我对收集OHLC数据很感兴趣。正如我们从正下方的图像中看到的，返回的每个烛台由收盘时间(整数值)、开盘时间(浮点值)、高(浮点值)、低(浮点值)、收盘时间(浮点值)和基础成交量(浮点值)组成。</p><figure class="lq lr ls lt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/1b91ef4c75b606a352071ad0caa31d0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Scfq9oZPHqFXdKXbiUtnvg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Cryptowatch API返回的OHLC数据示例</figcaption></figure><p id="2699" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Cryptowatch提供了不同时间段收集烛台的选项，1分钟，5分钟和1小时。</p><p id="dd62" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从最近的时间戳开始，API大约回溯到:</p><ul class=""><li id="6e15" class="lb lc hi ix b iy iz jc jd jg ld jk le jo lf js lu lh li lj bi translated">12小时1分钟烛台</li><li id="78f8" class="lb lc hi ix b iy lk jc ll jg lm jk ln jo lo js lu lh li lj bi translated">5分钟烛台3天</li><li id="9fe5" class="lb lc hi ix b iy lk jc ll jg lm jk ln jo lo js lu lh li lj bi translated">1小时烛台3周</li></ul></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="693c" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated">在PostgreSQL数据库中创建模式和表。</h2><p id="cacb" class="pw-post-body-paragraph iv iw hi ix b iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo la jq jr js hb bi translated">首先，打开pgAdmin并确保您在所需的服务器和数据库中。</p><p id="c9c7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> <em class="jt">模式</em> </strong></p><p id="6377" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">模式的主要目的是创建一组逻辑对象(即表)并为数据提供结构。</p><h2 id="857c" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated">步骤1-要创建模式，右键单击“模式”点击“创建”，然后点击“模式…”</h2><figure class="lq lr ls lt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/37cf64504ec4d2234c80cea2dd09911e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fNCVkpABlJ2SEl7DpOY47g.png"/></div></div></figure><h2 id="d456" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated">步骤2-为模式命名，然后保存。</h2><figure class="lq lr ls lt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/29d636d2792a925f1525a84b51656278.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dwtGWfOG_EPwr6xGCaSX-w.png"/></div></div></figure><h2 id="58a4" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated">步骤3-通过查看左侧的侧栏，验证模式已经创建。就这样，您现在有了一个模式。</h2><figure class="lq lr ls lt fd ij er es paragraph-image"><div class="er es lw"><img src="../Images/cd4db580eb9227f7cbc274451dfe4e02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*c70yvpXHcFE3_NJyWGhRQg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">我们在数据库中看到名为“example1”的新模式。</figcaption></figure><p id="0d7e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> <em class="jt">表</em> </strong></p><p id="46fb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意:可以直接在pgAdmin中创建表，但是，我使用python和SQL代码来代替。为了方便和简化，我还建议使用Google Colab中的Jupyter笔记本或python笔记本来运行下面的代码。</p><h2 id="9595" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated">步骤1-在您的笔记本中，确保导入了以下包和库。</h2><pre class="lq lr ls lt fd lx ly lz ma aw mb bi"><span id="96ca" class="kb kc hi ly b fi mc md l me mf">import pandas as pd<br/>import requests<br/>import psycopg2 as ps</span></pre><h2 id="0411" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated">步骤2-创建一个列表，其中包含您正在收集数据的交易所/交易对的表名。</h2><pre class="lq lr ls lt fd lx ly lz ma aw mb bi"><span id="6547" class="kb kc hi ly b fi mc md l me mf"># Lists of the table names for each exchange and trading pair.</span><span id="6af7" class="kb kc hi ly b fi mg md l me mf">bitfinex_table_names = ["bitfinex_bch_btc", "bitfinex_eth_btc", "bitfinex_ltc_btc"]</span><span id="77b7" class="kb kc hi ly b fi mg md l me mf">coinbase_pro_table_names = ["coinbase_pro_bch_btc", "coinbase_pro_eth_btc", "coinbase_pro_ltc_btc"]</span><span id="b331" class="kb kc hi ly b fi mg md l me mf">hitbtc_table_names = ["hitbtc_bch_btc", "hitbtc_eth_btc", "hitbtc_ltc_btc"] </span><span id="ef56" class="kb kc hi ly b fi mg md l me mf"># Consolidate each of the separate table name lists above into one list.</span><span id="5972" class="kb kc hi ly b fi mg md l me mf">table_list = bitfinex_table_names + coinbase_pro_table_names + hitbtc_table_names</span></pre><h2 id="9cea" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated">步骤3-定义用于连接数据库和API的凭证。</h2><pre class="lq lr ls lt fd lx ly lz ma aw mb bi"><span id="ab01" class="kb kc hi ly b fi mc md l me mf">credentials = {"POSTGRES_ADDRESS" : "FILL THIS IN",<br/>               "POSTGRES_PORT" : "FILL THIS IN",<br/>               "POSTGRES_USERNAME" : "FILL THIS IN",<br/>               "POSTGRES_PASSWORD" : "FILL THIS IN",<br/>               "POSTGRES_DBNAME" : "FILL THIS IN",<br/>               "API_KEY" : "FILL THIS IN"}</span><span id="8be9" class="kb kc hi ly b fi mg md l me mf"># This is a more defined idea of what your credentials should look like.</span><span id="22f6" class="kb kc hi ly b fi mg md l me mf">credentials = {"POSTGRES_ADDRESS" : "example.xxxxxxxxxxxx.us-east-1.rds.amazonaws.com",<br/>               "POSTGRES_PORT" : "5432", <br/>               "POSTGRES_USERNAME" : "test123",<br/>               "POSTGRES_PASSWORD" : "xxxxxxxxx",<br/>               "POSTGRES_DBNAME" : "example",<br/>               "API_KEY" : "xxxxxxxxxxxxxxxxxxxx"}</span></pre><h2 id="f2f3" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated">4.建立与数据库的连接，并创建与数据格式一致的表结构。(注意:请注意我是如何明确遵循Cryptowatch API中OHLC数据的格式来通知我的表的结构的。)</h2><pre class="lq lr ls lt fd lx ly lz ma aw mb bi"><span id="93b6" class="kb kc hi ly b fi mc md l me mf"># Create a connection to the database.</span><span id="21ac" class="kb kc hi ly b fi mg md l me mf">conn = ps.connect(host=credentials['POSTGRES_ADDRESS'],</span><span id="df0a" class="kb kc hi ly b fi mg md l me mf">port=credentials['POSTGRES_PORT'],</span><span id="513e" class="kb kc hi ly b fi mg md l me mf">user=credentials['POSTGRES_USERNAME'],</span><span id="3508" class="kb kc hi ly b fi mg md l me mf">password=credentials['POSTGRES_PASSWORD'],</span><span id="33cc" class="kb kc hi ly b fi mg md l me mf">database=credentials['POSTGRES_DBNAME'])</span><span id="0609" class="kb kc hi ly b fi mg md l me mf"># Create a cursor.</span><span id="de1d" class="kb kc hi ly b fi mg md l me mf">cur = conn.cursor()</span><span id="dcb7" class="kb kc hi ly b fi mg md l me mf"># Loop through table_list.</span><span id="0195" class="kb kc hi ly b fi mg md l me mf">for table_name in table_list:</span><span id="c573" class="kb kc hi ly b fi mg md l me mf"># example1 is the name of the schema.</span><span id="5ebb" class="kb kc hi ly b fi mg md l me mf">cur.execute('''</span><span id="1261" class="kb kc hi ly b fi mg md l me mf">CREATE TABLE example1.{table_name}</span><span id="b678" class="kb kc hi ly b fi mg md l me mf">(</span><span id="61a3" class="kb kc hi ly b fi mg md l me mf">closing_time integer,</span><span id="7d61" class="kb kc hi ly b fi mg md l me mf">open float,</span><span id="d4b5" class="kb kc hi ly b fi mg md l me mf">high float,</span><span id="fe96" class="kb kc hi ly b fi mg md l me mf">low float,</span><span id="5b50" class="kb kc hi ly b fi mg md l me mf">close float,</span><span id="d000" class="kb kc hi ly b fi mg md l me mf">base_volume float</span><span id="d15e" class="kb kc hi ly b fi mg md l me mf">);'''.format(table_name=table_name))</span><span id="e0cc" class="kb kc hi ly b fi mg md l me mf"># Commit and close.</span><span id="4999" class="kb kc hi ly b fi mg md l me mf">conn.commit()</span><span id="f79d" class="kb kc hi ly b fi mg md l me mf">print("Tables created successfully!")</span><span id="7274" class="kb kc hi ly b fi mg md l me mf">conn.close()</span></pre><p id="798f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">运行上面的代码后，在pgAdmin中检查是否已经创建了表。成功！🙌</p><figure class="lq lr ls lt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/0b4923591edf427640fff8e89025e06a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v2je4e8K4uTiq-x_JFPUwA.png"/></div></div></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="d350" class="mi kc hi bd kd mj mk ml kh mm mn mo kl mp mq mr ko ms mt mu kr mv mw mx ku my bi translated">主要成就👏</h1><p id="4e2e" class="pw-post-body-paragraph iv iw hi ix b iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo la jq jr js hb bi translated"><strong class="ix hj"> </strong>创建一个Cryptowatch账号，获得一个公共API密钥。</p><p id="4d6e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> </strong>使用pgAdmin创建一个模式。</p><p id="0242" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> </strong>使用python和SQL代码在数据库模式中创建表。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="485f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我很乐意连接！找到我最好的地方是在LinkedIn上。:)</p></div></div>    
</body>
</html>