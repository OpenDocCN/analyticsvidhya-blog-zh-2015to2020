<html>
<head>
<title>How to use AWS: SNS and SQS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用AWS: SNS和SQS</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-use-aws-sns-and-sqs-528c485db051?source=collection_archive---------3-----------------------#2020-07-03">https://medium.com/analytics-vidhya/how-to-use-aws-sns-and-sqs-528c485db051?source=collection_archive---------3-----------------------#2020-07-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div class="er es hg"><img src="../Images/03865d588cb8f98e78aae40f65256038.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*h4jr5oAXlDgezTlVKUYM3Q.jpeg"/></div></figure><div class=""/><p id="3fa5" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你好，你好，我的工程师同事们！</p><p id="5974" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最近，我不得不在我们构建的两个服务之间建立通信，这是一项有趣的任务。有许多消息服务选项，但我们最终使用了AWS: SNS和SQS。</p><p id="7a31" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，我会给你一个简短的背景介绍，告诉你为什么使用信息服务。然后我会用Python演示一个例子，关于如何建立一个简单的SNS主题，发布一条消息，建立一个SQS队列，订阅SNS主题和阅读一条被SQS队列消费的消息…所以不多…</p><p id="7e22" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">不要害怕！这听起来很复杂，但使用Boto3和Moto让它变得超级简单。</p><p id="8125" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果你是一个听觉学习者，那么你可以跟随这个YouTube视频:<a class="ae jk" href="https://youtu.be/E2-nbtdKZ-4" rel="noopener ugc nofollow" target="_blank">https://youtu.be/E2-nbtdKZ-4</a></p><h1 id="d275" class="jl jm hp bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">背景</h1><p id="3909" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">首先，让我们看看为什么您会使用消息服务:</p><figure class="kp kq kr ks fd hk er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es ko"><img src="../Images/e5173bcbe84ecbbb91978ea918e3bad1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JZCko3jqbt5pG0q0GXbycg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">使用消息服务进行通信的微服务</figcaption></figure><p id="f0bf" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当您拥有微服务基础架构时，其中一些服务可能需要相互通信。您可能有一些在一个服务中生成的数据，需要在另一个服务中进一步处理；但是您需要保持对数据的跟踪，并确保数据在被处理之前是安全的。</p><p id="e95b" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这就是消息服务的用武之地。</p><h2 id="dac5" class="lb jm hp bd jn lc ld le jr lf lg lh jv ix li lj jz jb lk ll kd jf lm ln kh lo bi translated">沟通</h2><p id="2dee" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">使用消息服务为服务之间的通信提供了一致的结构。这种结构可以在您的基础设施中采用，以实现简单、可管理的消息传递。</p><h2 id="0ba8" class="lb jm hp bd jn lc ld le jr lf lg lh jv ix li lj jz jb lk ll kd jf lm ln kh lo bi translated">排队</h2><p id="d0b1" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">对于某些服务，您可能会生成几个需要由另一个服务使用的消息。在这种情况下，您可能希望建立一个队列。</p><h2 id="00f3" class="lb jm hp bd jn lc ld le jr lf lg lh jv ix li lj jz jb lk ll kd jf lm ln kh lo bi translated">并行处理</h2><p id="21ff" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">对于大型数据流，消息服务可以扩展。只要你的数据没有耦合，就可以并行处理。</p><h2 id="55c1" class="lb jm hp bd jn lc ld le jr lf lg lh jv ix li lj jz jb lk ll kd jf lm ln kh lo bi translated">裁员</h2><p id="fc7b" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">像所有好的系统一样，我们可能需要一些冗余。您可以通过重试、死信队列或提交偏移(如果您使用的是Kafka)来设置您的消息服务。同时保持消息的安全，直到它被消费掉…你不会希望一个新用户注册你的网站失败，因为一个消息没有被处理。</p><h1 id="a53c" class="jl jm hp bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">AWS: SNS和SQS</h1><p id="a05f" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">那么区别在哪里呢？</p><h2 id="2a66" class="lb jm hp bd jn lc ld le jr lf lg lh jv ix li lj jz jb lk ll kd jf lm ln kh lo bi translated">社交网站（Social Network Site的缩写）</h2><figure class="kp kq kr ks fd hk er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es lp"><img src="../Images/ff0647aaf41e123e210dcecdda229750.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7hSE3AE-Hq0PrLMb8DHJTw.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">SNS结构</figcaption></figure><p id="83d0" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">SNS代表简单通知服务。这是典型的发布者/订阅者一对多服务。消息被发布到一个主题，然后订阅这些主题的消费者会收到相同的消息。把它想象成一份报纸被送到几个不同的家庭。</p><h2 id="148a" class="lb jm hp bd jn lc ld le jr lf lg lh jv ix li lj jz jb lk ll kd jf lm ln kh lo bi translated">SQS</h2><figure class="kp kq kr ks fd hk er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es lq"><img src="../Images/191f7915250d3bcdcf89fa2448a21fe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4qcqI1MUyW72aWXHgr6Bhg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">SQS结构</figcaption></figure><p id="35a7" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">SQS代表简单排队服务。您设置了一个队列，并向其中添加消息。然后，您的一个服务从队列中读取并处理下一条消息。消息仅由一个源读取和处理。把它想象成收到一封私人信件。</p><h2 id="36a0" class="lb jm hp bd jn lc ld le jr lf lg lh jv ix li lj jz jb lk ll kd jf lm ln kh lo bi translated">设置SQS队列以订阅SNS主题</h2><figure class="kp kq kr ks fd hk er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es lr"><img src="../Images/1f0a46460738abd69f6c73e30e44cb56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kQyAAQCIhkJ65XE0F_k-GA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">SQS排队订阅SNS话题</figcaption></figure><p id="ae97" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您也可以设置队列来订阅SNS主题，在下面的示例中，我们将介绍如何做到这一点。</p><h1 id="6176" class="jl jm hp bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">有趣的事情来了！</h1><h2 id="cd5b" class="lb jm hp bd jn lc ld le jr lf lg lh jv ix li lj jz jb lk ll kd jf lm ln kh lo bi translated">依赖关系:</h2><ul class=""><li id="a670" class="ls lt hp io b ip kj it kk ix lu jb lv jf lw jj lx ly lz ma bi translated">Boto3</li><li id="4075" class="ls lt hp io b ip mb it mc ix md jb me jf mf jj lx ly lz ma bi translated">摩托</li><li id="5a2e" class="ls lt hp io b ip mb it mc ix md jb me jf mf jj lx ly lz ma bi translated">Pytest</li></ul><h2 id="4ab3" class="lb jm hp bd jn lc ld le jr lf lg lh jv ix li lj jz jb lk ll kd jf lm ln kh lo bi translated">创建接收消息并将其发布到SNS的功能:</h2><pre class="kp kq kr ks fd mg mh mi mj aw mk bi"><span id="a2e8" class="lb jm hp mh b fi ml mm l mn mo">"""aws_service_handler.py"""</span><span id="b54f" class="lb jm hp mh b fi mp mm l mn mo">import os<br/><br/>import boto3<br/><br/><br/>def publish_message_to_sns(message: str):<br/>    topic_arn = os.environ["sns_topic_arn"]<br/><br/>    sns_client = boto3.client(<br/>        "sns",<br/>        region_name="eu-west-1",<br/>    )<br/><br/>    message_id = sns_client.publish(<br/>        TopicArn=topic_arn,<br/>        Message=message,<br/>    )<br/><br/>    return message_id</span></pre><p id="2bc6" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了发布到SNS主题，你需要该主题的亚马逊资源名称(ARN)。在上面，我们从一个名为<code class="du mq mr ms mh b">sns_topic_arn</code>的环境变量中获取，然后使用Boto3设置<code class="du mq mr ms mh b">sns_client</code>并从客户端设置<code class="du mq mr ms mh b">publish</code>消息。AWS将返回一个<code class="du mq mr ms mh b">MessageId</code>，您可以从该函数返回。</p><h2 id="88cb" class="lb jm hp bd jn lc ld le jr lf lg lh jv ix li lj jz jb lk ll kd jf lm ln kh lo bi translated">测试测试测试</h2><p id="0b6f" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">现在让我们编写测试！我坚信博客不仅仅是向你展示“展示代码”。作为软件工程师，我们需要了解这样一种心态，有时我们在测试上花费的时间要比编写实现的时间多。</p><p id="18c5" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以让我们测试上面的代码:</p><pre class="kp kq kr ks fd mg mh mi mj aw mk bi"><span id="a35e" class="lb jm hp mh b fi ml mm l mn mo">"""test_aws_service_handler.py"""</span><span id="2e3d" class="lb jm hp mh b fi mp mm l mn mo">import os<br/><br/>import boto3<br/>from moto import mock_sns</span><span id="1980" class="lb jm hp mh b fi mp mm l mn mo">from aws_service_handler import publish_message_to_sns</span><span id="9fed" class="lb jm hp mh b fi mp mm l mn mo">@mock_sns<br/>def test_publish_message_to_sns():<br/>    sns_resource = boto3.resource(<br/>        "sns",<br/>        region_name="eu-west-1"<br/>    )</span><span id="8920" class="lb jm hp mh b fi mp mm l mn mo">    topic = sns_resource.create_topic(<br/>        Name="test-topic"<br/>    )<br/><br/>    os.environ["sns_topic_arn"] = topic.arn<br/>    test_message = "test_message"<br/>    message_id = publish_message_to_sns(test_message)<br/><br/>    assert message_id["ResponseMetadata"]["HTTPStatusCode"] == 200</span></pre><p id="f907" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">实现Moto的方法是使用decorators来包装您的测试，并在内存中构建AWS基础设施，Boto3将使用这种方法。在上面的测试中，我们使用<code class="du mq mr ms mh b">mock_sns</code>来创建一个SNS资源，并创建一个主题来发布我们的消息，使用我们之前构建的函数。</p><p id="c327" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><code class="du mq mr ms mh b">MessageId</code>响应看起来会像这样:</p><pre class="kp kq kr ks fd mg mh mi mj aw mk bi"><span id="161b" class="lb jm hp mh b fi ml mm l mn mo">{<br/>  "MessageId": "7c446cbb-fb6a-4c03-bc0b-ded3641d5579",<br/>  "ResponseMetadata": {<br/>    "RequestId": "f187a3c1-376f-11df-8963-01868b7c937a",<br/>    "HTTPStatusCode": 200,<br/>    "HTTPHeaders": {<br/>      "server": "amazon.com"<br/>    },<br/>    "RetryAttempts": 0<br/>  }<br/>}</span></pre><p id="e291" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，我们可以断言我们得到了一个200状态码(快乐路径:)响应。</p><h1 id="7a4a" class="jl jm hp bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">更多有趣的东西！</h1><h2 id="2a3d" class="lb jm hp bd jn lc ld le jr lf lg lh jv ix li lj jz jb lk ll kd jf lm ln kh lo bi translated">设置一个从SQS队列中读取消息的函数:</h2><pre class="kp kq kr ks fd mg mh mi mj aw mk bi"><span id="44fa" class="lb jm hp mh b fi ml mm l mn mo">"""aws_service_handler.py"""</span><span id="87f3" class="lb jm hp mh b fi mp mm l mn mo">import os<br/><br/>import boto3</span><span id="8743" class="lb jm hp mh b fi mp mm l mn mo">def read_from_sqs_queue():<br/>    queue_url = os.environ["sqs_queue_url"]<br/>    sqs_client = boto3.client(<br/>        "sqs",<br/>        region_name="eu-west-1",<br/>    )<br/><br/>    messages = sqs_client.receive_message(<br/>        QueueUrl=queue_url,<br/>        MaxNumberOfMessages=1,<br/>    )<br/><br/>    return messages</span></pre><p id="e727" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">类似于SNS，在这种情况下，我们将需要一个<code class="du mq mr ms mh b">QueueUrl</code>，它指向我们的<code class="du mq mr ms mh b">sqs_client</code>将从其接收消息的队列。我们只想一次读取一条消息，所以我们将<code class="du mq mr ms mh b">MaxNumberOfMessages</code>设置为1，并返回我们的消息。</p><h2 id="98d2" class="lb jm hp bd jn lc ld le jr lf lg lh jv ix li lj jz jb lk ll kd jf lm ln kh lo bi translated">测试测试测试…再来！</h2><p id="f331" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">这个测试会稍微复杂一点。</p><p id="0874" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">像上次测试一样，我们将创建一个SNS主题，但我们也将创建一个订阅该主题的SQS队列。所以我们需要Moto的<code class="du mq mr ms mh b">mock_sns</code>和<code class="du mq mr ms mh b">mock_sqs</code>装饰师。</p><pre class="kp kq kr ks fd mg mh mi mj aw mk bi"><span id="ca1d" class="lb jm hp mh b fi ml mm l mn mo">"""test_aws_service_handler.py"""</span><span id="f31a" class="lb jm hp mh b fi mp mm l mn mo">import json<br/>import os<br/><br/>import boto3<br/>from moto import mock_sns, mock_sqs</span><span id="8f68" class="lb jm hp mh b fi mp mm l mn mo">from aws_service_handler import read_from_sqs_queue<br/></span><span id="bb9e" class="lb jm hp mh b fi mp mm l mn mo">@mock_sns<br/>@mock_sqs<br/>def test_read_from_sqs_queue():<br/>    sns_resource = boto3.resource(<br/>        "sns",<br/>        region_name="eu-west-1"<br/>    )<br/>    topic = sns_resource.create_topic(<br/>        Name="test-topic"<br/>    )<br/><br/>    sqs_resource = boto3.resource(<br/>        "sqs",<br/>        region_name="eu-west-1",<br/>    )<br/><br/>    queue = sqs_resource.create_queue(<br/>        QueueName="test-queue",<br/>    )<br/>    os.environ["sqs_queue_url"] = queue.url<br/>    os.environ["sns_topic_arn"] = topic.arn<br/><br/>    topic.subscribe(<br/>        Protocol="sqs",<br/>        Endpoint=queue.attributes["QueueArn"],<br/>    )<br/><br/>    test_message = "test_message"<br/>    message_id = publish_message_to_sns(test_message)<br/><br/>    messages = read_from_sqs_queue()<br/>    message_body = json.loads(messages["Messages"][0]["Body"])<br/><br/>    assert message_body["MessageId"] == message_id["MessageId"]<br/>    assert message_body["Message"] == test_message</span></pre><p id="3b47" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">创建SNS资源和SNS主题后，我们创建一个SQS资源和SQS队列。然后，我们设置函数中需要的环境变量，并让sqs订阅SNS主题，使用“SQS”协议并将<code class="du mq mr ms mh b">Endpoint</code>设置为<code class="du mq mr ms mh b">QueueArn</code>。然后像第一个测试一样，我们创建一个<code class="du mq mr ms mh b">test_message</code>并将消息发布到SNS。</p><p id="1363" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，我们使用自己创建的函数从队列中读取消息。</p><p id="2f42" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">AWS返回的<code class="du mq mr ms mh b">Messages</code>对象看起来会(真的很乱！)类似于:</p><pre class="kp kq kr ks fd mg mh mi mj aw mk bi"><span id="6300" class="lb jm hp mh b fi ml mm l mn mo">{<br/>  'Messages': [<br/>    {<br/>      'MessageId': 'b5f1b55e-00b1-3430-fbd8-1c5873369f9d',<br/>      'ReceiptHandle': 'wlmpcuuuusmottnwqvbanonfztvgntpsulcrjmyyjxeinlmrkrsaxxnvdhenqfhcbmymmuiepcexwiwfgwbthqhgrkktankjacedfydhkhtekyqmgfclbvecdcuqazvclefxynbnbaockuoksbdmfugqnpwwzjwqqzvofjkavpjtdtydbvlujgkmz',<br/>      'MD5OfBody': '4bf2e25ee48ea07fe629c59c056501eb',<br/>      'Body': '{\n  "Message": "test_message",\n  "MessageId": "2ec54c59-e7ed-450b-9de8-1b94980e9d71",\n  "Signature": "EXAMPLElDMXvB8r9R83tGoNn0ecwd5UjllzsvSvbItzfaMpN2nk5HVSw7XnOn/49IkxDKz8YrlH2qJXj2iZB0Zo2O71c4qQk1fMUDi3LGpij7RCW7AW9vYYsSqIKRnFS94ilu7NFhUzLiieYr4BKHpdTmdD6c0esKEYBpabxDSc=",\n  "SignatureVersion": "1",\n  "SigningCertURL": "<a class="ae jk" href="https://sns.us-east-1.amazonaws.com/SimpleNotificationService-f3ecfb7224c7233fe7bb5f59f96de52f.pem" rel="noopener ugc nofollow" target="_blank">https://sns.us-east-1.amazonaws.com/SimpleNotificationService-f3ecfb7224c7233fe7bb5f59f96de52f.pem</a>",\n  "Subject": "my subject",\n  "Timestamp": "2020-06-28T01:07:17.218Z",\n  "TopicArn": "arn:aws:sns:eu-west-1:123456789012:test-topic",\n  "Type": "Notification",\n  "UnsubscribeURL": "<a class="ae jk" href="https://sns.us-east-1.amazonaws.com/?Action=Unsubscribe&amp;SubscriptionArn=arn:aws:sns:us-east-1:123456789012:some-topic:2bcfbf39-05c3-41de-beaa-fcfcc21c8f55" rel="noopener ugc nofollow" target="_blank">https://sns.us-east-1.amazonaws.com/?Action=Unsubscribe&amp;SubscriptionArn=arn:aws:sns:us-east-1:123456789012:some-topic:2bcfbf39-05c3-41de-beaa-fcfcc21c8f55</a>"\n}',<br/>      'Attributes': {<br/>        'SenderId': 'AIDAIT2UOQQY3AUEKVGXU',<br/>        'SentTimestamp': '1593306437219',<br/>        'ApproximateReceiveCount': '1',<br/>        'ApproximateFirstReceiveTimestamp': '1593306437233'<br/>      }<br/>    }<br/>  ],<br/>  'ResponseMetadata': {<br/>    'RequestId': 'CXIXFV0VWIW73I4K5FDTO64LOOWDQNHSI5BNHZQSLWKT8IG2J4YK',<br/>    'HTTPStatusCode': 200,<br/>    'HTTPHeaders': {<br/>      'server': 'amazon.com',<br/>      'x-amzn-requestid': 'CXIXFV0VWIW73I4K5FDTO64LOOWDQNHSI5BNHZQSLWKT8IG2J4YK',<br/>      'x-amz-crc32': '3042017029'<br/>    },<br/>    'RetryAttempts': 0<br/>  }<br/>}</span></pre><p id="eed3" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里我们真正想测试的有两件事:</p><ol class=""><li id="a993" class="ls lt hp io b ip iq it iu ix mt jb mu jf mv jj mw ly lz ma bi translated"><code class="du mq mr ms mh b">MessageId</code>是我们从SNS收到的发布消息的同一个ID。</li><li id="25bb" class="ls lt hp io b ip mb it mc ix md jb me jf mf jj mw ly lz ma bi translated"><code class="du mq mr ms mh b">Body</code>中的<code class="du mq mr ms mh b">Message</code>本身就是我们发布给SNS的同一个消息。</li></ol><p id="a760" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在上面的<code class="du mq mr ms mh b">Messages</code>对象中，你可以在<code class="du mq mr ms mh b">Body</code>中看到我们的test_message已经被读取！所以剩下唯一要做的事情就是加载JSON字符串并根据这两个标准进行断言！</p><p id="9766" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">就这么简单！</p><p id="8419" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们已经成功创建了一个SNS主题，创建了一个SQS队列，订阅了该主题，发布了该主题的消息，并从我们的SQS队列中读取了该消息。</p><p id="d06e" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">可爱的朱布里！</p><p id="018c" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我希望这有一些用处。如果你有任何问题，请让我知道。下次再见！</p><blockquote class="mx my mz"><p id="610e" class="im in na io b ip iq ir is it iu iv iw nb iy iz ja nc jc jd je nd jg jh ji jj hb bi translated">文档:</p></blockquote><div class="hh hi ez fb hj ne"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sns.html" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab dw"><div class="ng ab nh cl cj ni"><h2 class="bd hq fi z dy nj ea eb nk ed ef ho bi translated">SNS - Boto3文档1.14.12文档</h2><div class="nl l"><h3 class="bd b fi z dy nj ea eb nk ed ef dx translated">一个代表Amazon简单通知服务(SNS)的底层客户端:这些是可用的方法:检查一个…</h3></div><div class="nm l"><p class="bd b fp z dy nj ea eb nk ed ef dx translated">boto3.amazonaws.com</p></div></div></div></a></div><div class="hh hi ez fb hj ne"><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sqs.html" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab dw"><div class="ng ab nh cl cj ni"><h2 class="bd hq fi z dy nj ea eb nk ed ef ho bi translated">SQS - Boto3文档1.14.12文档</h2><div class="nl l"><h3 class="bd b fi z dy nj ea eb nk ed ef dx translated">代表亚马逊简单队列服务(SQS)的低级客户端:以下是可用的方法:添加权限…</h3></div><div class="nm l"><p class="bd b fp z dy nj ea eb nk ed ef dx translated">boto3.amazonaws.com</p></div></div></div></a></div><div class="hh hi ez fb hj ne"><a href="http://docs.getmoto.org/en/latest/index.html" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab dw"><div class="ng ab nh cl cj ni"><h2 class="bd hq fi z dy nj ea eb nk ed ef ho bi translated">Moto:模拟AWS服务- Moto 1.3.15.dev文档</h2><div class="nl l"><h3 class="bd b fi z dy nj ea eb nk ed ef dx translated">一个允许您轻松模拟基于AWS基础设施的测试的库。如果您以前从未使用过，您应该…</h3></div><div class="nm l"><p class="bd b fp z dy nj ea eb nk ed ef dx translated">docs.getmoto.org</p></div></div></div></a></div></div></div>    
</body>
</html>