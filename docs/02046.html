<html>
<head>
<title>Making Sense of Stream Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">理解流数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/making-sense-of-stream-data-b74c1252a8f5?source=collection_archive---------9-----------------------#2019-11-27">https://medium.com/analytics-vidhya/making-sense-of-stream-data-b74c1252a8f5?source=collection_archive---------9-----------------------#2019-11-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3e8a8fb9d61c60738f16d474802f3e99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*twyCFLpb2mkWOZR4IUoBKA.jpeg"/></div></div></figure><p id="f4d9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您是否曾经想过，在与Kafka合作时，如何向利益相关者展示您的项目，实时突出显示重要的过程和结果，而无需编写任何前端工具？</p><p id="5e4f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇博文中，我将一步一步地指导你如何让<a class="ae jo" href="https://kafka.apache.org/" rel="noopener ugc nofollow" target="_blank"> Kafka </a>在本地运行，将数据卸载到数据存储中，并利用<a class="ae jo" href="https://www.metabase.com/" rel="noopener ugc nofollow" target="_blank"> Metabase </a>等工具通过图表和仪表盘来洞察你的数据。</p><p id="aca1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您有AWS帐户，您也可以利用那里的服务。但是在这篇文章中，我将向你展示如何在你的本地机器上运行所有的东西。</p><h1 id="bb79" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">阿帕奇卡夫卡</h1><p id="ec6d" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">Kafka是一个为高吞吐量而设计的分布式、可靠和可扩展的消息传递系统。如果你是卡夫卡的新手，我推荐你看一下<a class="ae jo" href="https://docs.confluent.io/current/kafka/introduction.html" rel="noopener ugc nofollow" target="_blank">卡夫卡简介</a>。Kafka允许多个客户端同时连接，以大规模生产或消费数据。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/7a6e9654ca1ca73513f252ab7cdafac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QsF1S98vcdVkfpTzONdSAg.png"/></div></div></figure><h2 id="6971" class="kx jq hi bd jr ky kz la jv lb lc ld jz jb le lf kd jf lg lh kh jj li lj kl lk bi translated">在本地运行Kafka</h2><p id="da32" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">您可以使用<a class="ae jo" href="https://www.confluent.io/download/plans/" rel="noopener ugc nofollow" target="_blank">汇合平台</a>在本地运行Kafka。下载tar文件后，您可以解压缩它，并遵循以下命令:</p><pre class="kt ku kv kw fd ll lm ln lo aw lp bi"><span id="3518" class="kx jq hi lm b fi lq lr l ls lt">&gt; cd confluent-5.2.1/bin<br/>&gt; ./confluent start<br/>This CLI is intended for development only, not for production<br/>https://docs.confluent.io/current/cli/index.html<br/>​<br/>Starting zookeeper<br/>zookeeper is [UP]<br/>Starting kafka<br/>kafka is [UP]<br/>Starting schema-registry<br/>schema-registry is [UP]<br/>Starting kafka-rest<br/>kafka-rest is [UP]<br/>Starting connect<br/>connect is [UP]<br/>Starting ksql-server<br/>ksql-server is [UP]<br/>Starting control-center<br/>control-center is [UP]</span></pre><p id="3d8a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦所有服务都在运行，您将有一个代理在端口9092上运行。</p><h1 id="d021" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">应用</h1><p id="4836" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">对于这个演示，我将创建一个虚拟管道，它从KML文件中读取历史Google时间轴数据，并将其输出到一个名为<code class="du lu lv lw lm b">google_history_trip</code>的Kafka主题。你可以在这里下载你自己的谷歌时间轴数据。我使用的数据来自我去克罗地亚旅行时的个人时间表。我使用Kafka connect将这些数据转储到SQL，并使用Metabase查询存储在SQL server上的数据。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/c1ca7bde79a5d015892faece59ecf3f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J-cLi0UEtFeQqav64IQOIg.png"/></div></div></figure><h2 id="f52c" class="kx jq hi bd jr ky kz la jv lb lc ld jz jb le lf kd jf lg lh kh jj li lj kl lk bi translated">Kafka应用</h2><p id="b9a2" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">在这个虚拟的Kafka应用程序中，你可以在这里找到代码<a class="ae jo" href="https://github.com/AnkushKhanna/kafka-google-timeline" rel="noopener ugc nofollow" target="_blank"/>，我正在从我的谷歌时间线下载的谷歌KML文件中读取数据。我解析文件，并使用下面的Avro模式将数据推送到Kafka。</p><pre class="kt ku kv kw fd ll lm ln lo aw lp bi"><span id="6298" class="kx jq hi lm b fi lq lr l ls lt">{<br/>   "type": "record",<br/>       "name":"GoogleHistoryValue",<br/>       "namespace": "example.googlehistory",<br/>       "fields":[<br/>         {<br/>           "name":"user_id",<br/>           "type":"string"<br/>         },<br/>         {<br/>           "name": "start_time",<br/>           "type": {<br/>             "type": "long",<br/>             "logicalType": "timestamp-millis"<br/>           }<br/>         },<br/>         {<br/>           "name": "end_time",<br/>           "type": {<br/>             "type": "long",<br/>             "logicalType": "timestamp-millis"<br/>           }<br/>          },<br/>          {<br/>            "name":"name",<br/>            "type":"string"<br/>          },<br/>          {<br/>            "name":"latitude",<br/>            "type":"double"<br/>          },<br/>          {<br/>            "name":"longitude",<br/>            "type":"double"<br/>          }<br/>       ]<br/>}</span></pre><h1 id="fcc2" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">SQL Server</h1><h2 id="9e45" class="kx jq hi bd jr ky kz la jv lb lc ld jz jb le lf kd jf lg lh kh jj li lj kl lk bi translated">正在创建数据库</h2><p id="1337" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">下面我将在本地启动一个MySQL服务器并创建一个数据库<code class="du lu lv lw lm b">kafka_offload</code>，我将用它将数据卸载到SQL。</p><pre class="kt ku kv kw fd ll lm ln lo aw lp bi"><span id="784a" class="kx jq hi lm b fi lq lr l ls lt">&gt; mysql.server start<br/>Starting MySQL</span><span id="e16a" class="kx jq hi lm b fi ly lr l ls lt">.. SUCCESS!</span><span id="e0de" class="kx jq hi lm b fi ly lr l ls lt">~ mysql -u root -p</span><span id="7204" class="kx jq hi lm b fi ly lr l ls lt">Enter password: *********<br/>Welcome to the MySQL monitor.  Commands end with ; or \g.<br/>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><span id="deb1" class="kx jq hi lm b fi ly lr l ls lt">mysql&gt; CREATE DATABASE kafka_offload;<br/>Query OK, 1 row affected (0.00 sec)</span><span id="9250" class="kx jq hi lm b fi ly lr l ls lt">mysql&gt; use kafka_offload;<br/>Database changed</span><span id="faf6" class="kx jq hi lm b fi ly lr l ls lt">mysql&gt; show tables;<br/>Empty set (0.00 sec)<br/>mysql&gt;</span></pre><h1 id="9236" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">卡夫卡连接</h1><p id="b35f" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">Kafka connect允许我们从Kafka提取数据或向Kafka推送数据。有很多Kafka接口可供选择，你可以在https://www.confluent.io/hub/<a class="ae jo" href="https://www.confluent.io/hub/" rel="noopener ugc nofollow" target="_blank">找到。</a></p><p id="d143" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将使用<code class="du lu lv lw lm b">io.confluent.connect.jdbc.JdbcSinkConnector</code>将数据从Kafka主题卸载到MySQL服务器。我们可以通过发布以下查询来轻松使用它:</p><pre class="kt ku kv kw fd ll lm ln lo aw lp bi"><span id="c955" class="kx jq hi lm b fi lq lr l ls lt">curl -X POST <a class="ae jo" href="http://localhost:8083/connectors" rel="noopener ugc nofollow" target="_blank">http://localhost:8083/connectors</a> -H "Content-Type: application/json" -d '<br/>{<br/>"name": "google_history_trip_connector",<br/>  "config": {<br/>  "connector.class": "io.confluent.connect.jdbc.JdbcSinkConnector",<br/>  "tasks.max": "1",<br/>  "topics": "google_history_trip",<br/>  "connection.url": "jdbc:mysql://localhost/kafka_offload",<br/>  "auto.create": "true",<br/>  "connection.user": "root",<br/>  "connection.password": "*******",<br/>  "key.converter": "io.confluent.connect.avro.AvroConverter",</span><span id="1e78" class="kx jq hi lm b fi ly lr l ls lt">  "value.converter":"io.confluent.connect.avro.AvroConverter",<br/>  "value.converter.schema.registry.url": "<a class="ae jo" href="http://localhost:8001" rel="noopener ugc nofollow" target="_blank">http://localhost:8081</a>",</span><span id="2798" class="kx jq hi lm b fi ly lr l ls lt">  "key.converter.schema.registry.url": "<a class="ae jo" href="http://localhost:8001" rel="noopener ugc nofollow" target="_blank">http://localhost:8081</a>",<br/>  "key.converter.schemas.enable":"true",<br/>  "value.converter.schemas.enable":"true",<br/>    "internal.key.converter":"org.apache.kafka.connect.json.JsonConverte r",   <br/>     "internal.value.converter":"org.apache.kafka.connect.json.JsonConverter",<br/>  "internal.key.converter.schemas.enable":"false",<br/>  "internal.value.converter.schemas.enable":"false"<br/>  }<br/>}'</span></pre><p id="0c71" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不要忘记更改<code class="du lu lv lw lm b">connection.password</code>字段。</p><p id="a29f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这应该会启动一个Kafka连接，将数据卸载到数据库。您可以使用<code class="du lu lv lw lm b"><a class="ae jo" href="http://localhost:8083/connectors/google_history_topic/status" rel="noopener ugc nofollow" target="_blank">http://localhost:8083/connectors/google_history_topic/status</a></code>来检查连接器的状态</p><h1 id="35f4" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">元数据库</h1><h2 id="21c2" class="kx jq hi bd jr ky kz la jv lb lc ld jz jb le lf kd jf lg lh kh jj li lj kl lk bi translated">设置</h2><ul class=""><li id="de49" class="lz ma hi is b it kn ix ko jb mb jf mc jj md jn me mf mg mh bi translated">您可以通过docker启动元数据库，也可以从<a class="ae jo" href="https://www.metabase.com/start/" rel="noopener ugc nofollow" target="_blank">这里</a>下载元数据库。</li></ul><pre class="kt ku kv kw fd ll lm ln lo aw lp bi"><span id="3b04" class="kx jq hi lm b fi lq lr l ls lt">&gt; docker run -d -p 3000:3000 — name metabase metabase/metabase</span></pre><ul class=""><li id="3d5c" class="lz ma hi is b it iu ix iy jb mi jf mj jj mk jn me mf mg mh bi translated">一旦元数据库启动，您应该会在http://localhost:3000看到以下屏幕</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/3b3b35053ade4b91e73ce792fac59327.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jB4LuFtcXwLF2WHgqUdGBw.png"/></div></div></figure><ul class=""><li id="81d6" class="lz ma hi is b it iu ix iy jb mi jf mj jj mk jn me mf mg mh bi translated">完成注册后，您可以连接到数据库</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/b85778872b62ff1be811d6b7d8617249.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4hHVn7AWIA7hxq052YVnjg.png"/></div></div></figure><ul class=""><li id="c409" class="lz ma hi is b it iu ix iy jb mi jf mj jj mk jn me mf mg mh bi translated">您现在应该会看到如下欢迎屏幕</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/ff1b70ae0822226118902d464db61fb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*voEtav7xSJm4WTBmLQWFQA.png"/></div></div></figure><ul class=""><li id="ab88" class="lz ma hi is b it iu ix iy jb mi jf mj jj mk jn me mf mg mh bi translated">您可以通过导航到Kafka Data您的主题名称来检查您的数据</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/b5d4e0c22b24ad159c90cba37de12465.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F3hAg0afLuE7MS8Ah5Zfhg.png"/></div></div></figure><h2 id="c1f7" class="kx jq hi bd jr ky kz la jv lb lc ld jz jb le lf kd jf lg lh kh jj li lj kl lk bi translated">查询数据</h2><p id="db07" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">您可以使用笔记本功能来回答一些问题</p><ul class=""><li id="8c59" class="lz ma hi is b it iu ix iy jb mi jf mj jj mk jn me mf mg mh bi translated">让我们看看总数</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/3d43bedcc31f08d0a8ac3bea2809d68e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JRMYCgZcDuDMU4BjaAsvUQ.png"/></div></div></figure><ul class=""><li id="2869" class="lz ma hi is b it iu ix iy jb mi jf mj jj mk jn me mf mg mh bi translated">让我们检查活动名称或类型为<code class="du lu lv lw lm b">Walking</code>的行数</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/ac24be71340e3e847f8dcbde787d698c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y8uA_iNVOCDekm1e_HteHA.png"/></div></div></figure><ul class=""><li id="0aa1" class="lz ma hi is b it iu ix iy jb mi jf mj jj mk jn me mf mg mh bi translated">让我们按纬度经度分组，并在地图上画出来(选择没有宁滨)</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/4573262cfa06c7a02611bc6be4add97b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JQha_gUbaWAY7Lvo1vb7nQ.png"/></div></div></figure><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/4f2ee4d66db8fcbf0c0ffebaaf47cfb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tZSjMjIoCv2ZtmVYcg3xaQ.png"/></div></div></figure><ul class=""><li id="6e8c" class="lz ma hi is b it iu ix iy jb mi jf mj jj mk jn me mf mg mh bi translated">让我们对活动类型<code class="du lu lv lw lm b">Driving</code>进行同样的检查，显示我从斯普利特开车到杜布罗夫尼克</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mr"><img src="../Images/95ffa155f23833957c08f1f8eaae9684.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q4gP7Wzy8mwIUzICzVjjfA.png"/></div></div></figure><h2 id="1fc4" class="kx jq hi bd jr ky kz la jv lb lc ld jz jb le lf kd jf lg lh kh jj li lj kl lk bi translated">SQL查询</h2><p id="4eac" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">您还可以在元数据库中使用SQL查询</p><ul class=""><li id="91e6" class="lz ma hi is b it iu ix iy jb mi jf mj jj mk jn me mf mg mh bi translated">让我们计算一下我在每个地点花了多少时间</li></ul><pre class="kt ku kv kw fd ll lm ln lo aw lp bi"><span id="180d" class="kx jq hi lm b fi lq lr l ls lt">SELECT latitude, longitude, name, TIMESTAMPDIFF(minute, start_time, end_time) as duration FROM google_history_trip</span></pre><ul class=""><li id="b696" class="lz ma hi is b it iu ix iy jb mi jf mj jj mk jn me mf mg mh bi translated">大家算算我在哪里待了一个多小时</li></ul><pre class="kt ku kv kw fd ll lm ln lo aw lp bi"><span id="e48a" class="kx jq hi lm b fi lq lr l ls lt">SELECT latitude, longitude, name, TIMESTAMPDIFF(minute, start_time, end_time)  as duration<br/>FROM google_history_trip<br/>WHERE (start_time &gt;= timestamp('2019-09-21T00:00:00.000Z')<br/>   AND start_time &lt; timestamp('2019-09-22T00:00:00.000Z'))<br/>HAVING duration &gt; 60</span></pre><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/9f1b8d2d91729eff0ce9e7610ad01d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H53_MQ6o83_omsjFfshSaw.png"/></div></div></figure><p id="8e54" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您还可以将元数据库的仪表板功能用于变量。</p><p id="7255" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用Kafka connect的快速卸载功能，我们可以几乎实时地与主题生成的数据进行交互。</p><h1 id="9a30" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="7da7" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">在我们的Kafka主题中，我们已经看到了一种快速分析数据的方法，通过将数据导出到本地运行的MySQL，并使用Metabase来可视化数据。这使我们能够以一种良好的、交互式的方式来验证我们的方法，这种方式可以与业务或产品所有者共享。</p><p id="0c41" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该解决方案目前使用MySQL，这对于大型数据集来说可能并不理想。因此，这种快速方法对于生产来说并不理想。在我的下一篇博文中，我将解释我们如何将大型数据集从Kafka卸载到AWS S3，并使用AWS Glue和QuickSight对我们的数据进行交互式查询。</p></div></div>    
</body>
</html>