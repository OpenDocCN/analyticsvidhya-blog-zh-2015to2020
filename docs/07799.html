<html>
<head>
<title>AI in Practice: Identify defective components with AutoML in the Google Cloud Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">人工智能实践:用谷歌云平台中的AutoML识别有缺陷的组件</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/ai-in-practice-identify-defective-components-with-automl-in-gcp-d984f92d3dcf?source=collection_archive---------7-----------------------#2020-07-08">https://medium.com/analytics-vidhya/ai-in-practice-identify-defective-components-with-automl-in-gcp-d984f92d3dcf?source=collection_archive---------7-----------------------#2020-07-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3b51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">直到最近，人工智能(AI)的使用只有通过巨大的努力和构建自己的神经网络才有可能。今天，通过云计算服务进入人工智能世界的壁垒已经大大降低。因此，人们可以立即使用当前的人工智能技术来实现组件质量控制的(部分)自动化，而不必在人工智能研究上投入大量资金。</p><p id="92d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们展示了如何在谷歌云平台(GCP)上示例性地实现这样一个人工智能系统。为此，我们使用AutoML训练一个模型，并使用云函数和App Engine将它集成到一个过程中，在该过程中可以进行质量控制中的手动校正。</p><p id="1634" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个项目的代码在库<a class="ae jd" href="https://github.com/naxty/gcp-automated-quality-inspection" rel="noopener ugc nofollow" target="_blank">GCP-自动质量检查</a>中。</p><h1 id="5d15" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">人工智能系统的体系结构</h1><p id="7bf8" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">下图显示了GCP的一个架构示例，用于组件质量控制的逐步自动化。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es kh"><img src="../Images/7ff27bd13c55d104cf6a141ce4780175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*cMglSsV6TuPM4JuPj4sptQ.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">人工智能系统在GCP的典型应用</figcaption></figure><p id="2ff6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了训练合适的模型，我们使用机器学习服务AutoML。这项服务在自定义数据集上训练最先进的人工智能模型进行图像分类。此外，该模型可以通过服务作为REST-endpoint直接部署。</p><p id="bbce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了模型的集成，我们使用Google云存储(GCS)来上传图片。上传触发了一个云函数，该云函数调用模型的REST-endpoint并对图像进行分类。然后，我们通过由发布/订阅主题触发的第二个云函数来处理预测结果。</p><p id="d095" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第二个云函数实现了根据分类和相关置信度对图像进行分类的处理逻辑。置信度低于选定阈值的预测称为“不确定的”。这些预测必须由有经验的工人进行后处理。为此，我们编写了一个web应用程序，供工作人员用来检查不确定的预测。</p><p id="851f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下文中，我们描述AI系统的主要组件的安装和部署:</p><ol class=""><li id="2c64" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ky kz la lb bi translated">AutoML的准备、培训和服务</li><li id="d58b" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">模型与云函数的集成</li><li id="06b6" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">部署应用程序，使用App Engine进行手动后处理</li></ol><p id="dd95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="lh">要求遵循本教程</em> </strong></p><p id="027b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要执行这些步骤，需要能够访问GCP。我们建议创建一个新项目，并在本地开发环境中设置Google Cloud SDK 。下载<a class="ae jd" href="https://github.com/naxty/gcp-automated-quality-inspection" rel="noopener ugc nofollow" target="_blank">GCP-自动化质量检验库</a>的完整代码，建立python 3.7环境，通过<em class="lh">pip install-r requirements . txt</em>安装需求。</p><h1 id="fe70" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">1.AutoML的准备、培训和服务</h1><p id="1ec6" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我们使用Kaggle的<a class="ae jd" href="https://www.kaggle.com/ravirajsinh45/real-life-industrial-dataset-of-casting-product" rel="noopener ugc nofollow" target="_blank">铸件产品数据进行质量检测</a>数据集。该数据集包含用于生产潜水泵的制造产品的不同图像。</p><p id="7cd9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们将数据上传到一个GCS桶中。由于AutoML目前仅在<em class="lh">美国中心1 </em>区域可用，我们必须使用以下命令在该区域内创建bucket。可以在GCP控制台中直接找到<em class="lh">GCP _项目_ID </em>。</p><pre class="ki kj kk kl fd li lj lk ll aw lm bi"><span id="5149" class="ln jf hi lj b fi lo lp l lq lr">export GCP_REGION="US-CENTRAL1"<br/>export GCP_PROJECT_ID="&lt;fill-with-your-project-id&gt;"<br/>export TRAINING_DATA_BUCKET="${GCP_PROJECT_ID}""-product-quality"<br/>gsutil mb -l $GCP_REGION gs://"${TRAINING_DATA_BUCKET}"</span></pre><p id="7dba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们<a class="ae jd" href="https://www.kaggle.com/ravirajsinh45/real-life-industrial-dataset-of-casting-product/download" rel="noopener ugc nofollow" target="_blank">从Kaggle </a>下载数据，并将它们解压缩到<em class="lh"> data </em>目录中。</p><pre class="ki kj kk kl fd li lj lk ll aw lm bi"><span id="20a0" class="ln jf hi lj b fi lo lp l lq lr">data<br/>└── casting_data<br/>    ├── test<br/>    │   ├── def_front<br/>    │   │   ├── ....<br/>    │   │   └── new__0_9334.jpeg<br/>    │   └── ok_front<br/>    │       ├── ....<br/>    │       └── cast_ok_0_9996.jpeg<br/>    └── train<br/>        ├── def_front<br/>        │   ├── ...<br/>        │   └── cast_def_0_9997.jpeg<br/>        └── ok_front<br/>            ├── ...<br/>            └── cast_ok_0_9998.jpeg</span></pre><p id="6265" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们上传数据:<code class="du ls lt lu lj b">gsutil -m cp -r data/ gs://${TRAINING_DATA_BUCKET}</code></p><p id="1e1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上传之后，我们创建一个CSV文件，其中包含关于数据的必要元信息，以便开始使用AutoML进行训练。该文件由三列组成:</p><ul class=""><li id="1ae5" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc lv kz la lb bi translated">集合:这是一个具有固定值的可选字段，用于决定哪个样本属于哪个集合。固定值为训练、验证和测试。如果我们不分配这个字段，AutoML会把数据集分成8:1:1。如果我们分配这个字段，就必须使用所有这些值。</li><li id="cba0" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc lv kz la lb bi translated">图像路径:图像在GCP的路径。</li><li id="8ebf" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc lv kz la lb bi translated">标签:样本的标签。</li></ul><p id="585d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们编写了一个脚本<a class="ae jd" href="https://github.com/naxty/gcp-automated-quality-inspection/blob/master/automl/prepare.py" rel="noopener ugc nofollow" target="_blank"> prepare.py </a>来基于指定桶中的blobs生成这个CSV文件。您可以通过执行<code class="du ls lt lu lj b">python automl/prepare.py</code>来创建这个文件，并使用<code class="du ls lt lu lj b">gsutil cp preparation.csv gs://"${TRAINING_DATA_BUCKET}"</code>将它上传到GCS。</p><p id="6b24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在可以在AutoML中创建数据集了。为此，在控制台中选择<em class="lh">单标签分类</em>，然后选择上传的CSV文件。它执行将数据导入AutoML。这个过程大约需要20分钟。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es lw"><img src="../Images/3fbb6aafb1c0f2cb7031e51afa4c7e99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vWXv9_OHq8lBOcSBh_lsYQ.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">在AutoML UI中选择上传的preparation.csv</figcaption></figure><p id="9ff7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导入后，可以在AutoML中检查数据。这个特性对于有选择地检查数据质量特别有用。现在可以开始训练了。</p><p id="349b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的例子中，我们选择“云托管”选项，在培训结束后在GCP快速部署模型。训练期间的计算能力以“节点小时”指定。在它的后面，有一个使用NVIDIA Tesla V100显卡的计算实例。每个节点小时按每小时3.15美元收费。我们选择最少八个节点小时，开始训练。</p><p id="4eae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">训练之后，可以在AutoML中对模型进行第一次评估。在这里，您可以计算和显示各种质量标准，如召回，精度和混淆矩阵。此外，有几种可能性可以交互地显示模型及其预测。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es mb"><img src="../Images/a51430a79b259780b214803c029d75ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U-cvc5BneVzIgXCnK6ivMg.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">通过AutoML UI对模型结果进行交互式分析</figcaption></figure><p id="58e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了完成AutoML部分，我们将训练好的模型部署为服务端点。</p><h1 id="4b35" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">2.模型与云函数的集成</h1><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es mc"><img src="../Images/b8f1fbabc20e13845b8ba9c0d13cce24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*EITPOn2zFlNF-lnCLrGo4w.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">云功能集成的架构</figcaption></figure><p id="c233" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">AutoML模型通过两个云函数<em class="lh">预测</em>和<em class="lh">移动</em>整合。每次上传图像时，会自动执行<em class="lh">预测</em>功能。它下载图像并将其发送到模型端点。然后将结果写入发布/订阅主题，触发<em class="lh">移动</em>功能。它实现了根据分类结果对图像进行分类的逻辑。</p><h2 id="0fe7" class="ln jf hi bd jg md me mf jk mg mh mi jo iq mj mk js iu ml mm jw iy mn mo ka mp bi translated">预言；预测；预告</h2><p id="7e36" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">首先，我们创建<em class="lh"> INBOUND_BUCKET </em>和<em class="lh"> PREDICTION_TOPIC </em>:</p><pre class="ki kj kk kl fd li lj lk ll aw lm bi"><span id="115f" class="ln jf hi lj b fi lo lp l lq lr">export INBOUND_BUCKET="product-quality-inbound"<br/>export PREDICTION_TOPIC="automl_predictions"<br/>gsutil mb -l $GCP_REGION gs://"${INBOUND_BUCKET}"<br/>gcloud pubsub topics create "${PREDICTION_TOPIC}"</span></pre><p id="e7e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">函数的代码在<a class="ae jd" href="https://github.com/naxty/gcp-automated-quality-inspection/blob/master/cloud_functions/predict/main.py" rel="noopener ugc nofollow" target="_blank">cloud _ functions/predict/main . py</a>中。</p><p id="7314" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在运行时，要分类的图像从桶中下载并发送到AutoML服务端点。协议缓冲格式的响应被解串，然后以如下形式的消息写入<em class="lh">预测_主题</em>。</p><pre class="ki kj kk kl fd li lj lk ll aw lm bi"><span id="c1c0" class="ln jf hi lj b fi lo lp l lq lr">msg = {<br/>    "bucket_name": data["bucket"],<br/>    "image_name": data["name"],<br/>    "prediction_label": result.get("display_name"),<br/>    "prediction_score": result.get("classification").get("score"),<br/>}</span></pre><p id="2ae0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们通过Google Cloud SDK部署云功能。因此我们需要计算出训练模型的<em class="lh"> MODEL_ID </em>，它可以通过AutoML接口提取。此外，指定了具有相应桶<em class="lh">的触发事件<code class="du ls lt lu lj b">google.storage.object.finalize</code>和入站桶</em>。</p><pre class="ki kj kk kl fd li lj lk ll aw lm bi"><span id="1654" class="ln jf hi lj b fi lo lp l lq lr">export MODEL_ID="ICN690530685638672384"<br/>export PREDICT_CLOUD_FUNCTION_PATH="cloud_functions/predict"<br/>export PREDICT_CF_NAME="predict_image"<br/>gcloud functions deploy "$PREDICT_CF_NAME" \<br/> --source "$PREDICT_CLOUD_FUNCTION_PATH" \<br/> --runtime python37 \<br/> --trigger-resource "$INBOUND_BUCKET" \<br/> --trigger-event google.storage.object.finalize \<br/> --set-env-vars model_id="$MODEL_ID",topic_id="$PREDICTION_TOPIC"</span></pre><h2 id="7224" class="ln jf hi bd jg md me mf jk mg mh mi jo iq mj mk js iu ml mm jw iy mn mo ka mp bi translated">移动的</h2><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es mq"><img src="../Images/41396e1dea0c463d51c0fd6964b25990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*asIrcU3OJWl61t-_JlQMYQ.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">移动函数的处理逻辑将预测分数与阈值进行比较，以决定将图像移动到哪里。</figcaption></figure><p id="cd6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">移动函数处理来自<em class="lh">预测_主题</em>的消息。消息一到，这就触发了移动云功能。该函数在<a class="ae jd" href="https://github.com/naxty/gcp-automated-quality-inspection/blob/master/cloud_functions/move/main.py" rel="noopener ugc nofollow" target="_blank">cloud _ functions/move/main . py</a>中实现，根据置信度、标签和阈值处理结果。根据这三个值，服务将相关图像从<em class="lh">入站存储桶</em>移动到<em class="lh">预测存储桶</em>的特定目录:</p><ul class=""><li id="ec2a" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc lv kz la lb bi translated">好的:没有检测错误的图像</li><li id="0fa1" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc lv kz la lb bi translated">缺陷:检测到错误的图像</li><li id="a42d" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc lv kz la lb bi translated">不清楚:不确定的图像。在这种情况下，置信水平低于期望的阈值。</li></ul><p id="c16d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在部署之前，我们创建预测桶:</p><pre class="ki kj kk kl fd li lj lk ll aw lm bi"><span id="2de8" class="ln jf hi lj b fi lo lp l lq lr">export PREDICTION_BUCKET="product-quality-prediction" <br/>gsutil mb -l $GCP_REGION gs://"${PREDICTION_BUCKET}"</span></pre><p id="1be9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们使用Google Cloud SDK和相关的环境变量部署云功能。</p><pre class="ki kj kk kl fd li lj lk ll aw lm bi"><span id="51e8" class="ln jf hi lj b fi lo lp l lq lr">export PREDICTION_THRESHOLD="0.8"<br/>export MOVE_CLOUD_FUNCTION_PATH="cloud_functions/move"<br/>export MOVE_CF_NAME="move_image"<br/>gcloud functions deploy "$MOVE_CF_NAME" \<br/> --source "$MOVE_CLOUD_FUNCTION_PATH" \<br/> --runtime python37 \<br/> --trigger-topic "$PREDICTION_TOPIC" \<br/> --set-env-vars prediction_bucket="$PREDICTION_BUCKET",prediction_threshold="$PREDICTION_THRESHOLD"</span></pre><h1 id="771e" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">3.部署应用程序，使用App Engine进行手动后处理</h1><p id="8278" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">使用一个简单的web应用程序，我们在浏览器中显示来自不明目录的图像。通过该应用程序，有经验的工人详细检查产品图像并手动分类。我们使用FastAPI和React来实现web应用程序。应用程序的代码在<a class="ae jd" href="https://github.com/naxty/gcp-automated-quality-inspection/tree/master/app_engine" rel="noopener ugc nofollow" target="_blank"> app_engine </a>文件夹中。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es mr"><img src="../Images/813f74490d9ba2b8384654319bbe0c53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*RZAOygSU7G_9RgBeEhhCjQ.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">手动后处理应用程序的架构使用云存储和带有FastAPI和React的App Engine</figcaption></figure><h2 id="d948" class="ln jf hi bd jg md me mf jk mg mh mi jo iq mj mk js iu ml mm jw iy mn mo ka mp bi translated">许可的准备</h2><p id="c327" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在部署应用程序之前，我们需要设置不同的权限，以便从应用程序引擎访问Google云存储。默认情况下，App Engine的API激活会创建服务帐户<code class="du ls lt lu lj b">${PROJECT_ID}@appspot.gserviceaccount.com</code>。通过IAM控制台，我们为这个服务帐户创建一个密钥。我们将这个密钥作为<em class="lh">app_engine _ service _ account . JSON</em>存储在app _ engine目录中。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es ms"><img src="../Images/1dfdb137bf3eacefe1ebdbb2471e8a05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HCs5q5QXsH1zEIzktWoiyQ.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">IAM控制台—为服务帐户创建密钥</figcaption></figure><p id="3f16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应用程序启动后，<a class="ae jd" href="https://github.com/naxty/gcp-automated-quality-inspection/blob/21585922f9fc8c15669ebd2928043d9302842333/app_engine/main.py#L17" rel="noopener ugc nofollow" target="_blank">它加载密钥以获得必要的权限</a>。需要注意的是，这个密钥既不能共享也不能版本化。</p><p id="665e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应用程序创建预先设计好的URL来从Web前端加载它们。因此，服务帐户需要<em class="lh">角色服务帐户令牌创建者</em>。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es mt"><img src="../Images/11fd4b62d4ae4ca6e6e5493df98ddb3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8OjPIMc16KGF_y9dGaXBTw.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">IAM将“角色服务帐户令牌创建者”分配给应用程序引擎服务帐户。</figcaption></figure><p id="0240" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，服务帐户需要访问<em class="lh">预测_存储桶</em>。在GCP控制台中，我们导航到存储浏览器，并为服务帐户分配角色<code class="du ls lt lu lj b">Storage Object Viewer</code>和<code class="du ls lt lu lj b">Storage Legacy Bucket Writer</code>。</p><h1 id="574f" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">在App Engine上部署应用程序</h1><p id="019c" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">首先，确保<em class="lh">app_engine _ service _ accout . JSON</em>在app _ engine目录中。其次，<em class="lh"> PREDICTION_BUCKET </em>必须作为<a class="ae jd" href="https://github.com/naxty/gcp-automated-quality-inspection/blob/master/app_engine/app.yaml#L7" rel="noopener ugc nofollow" target="_blank"> app.yaml </a>中的环境变量进行适配。</p><p id="58ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们用<code class="du ls lt lu lj b">gcloud app deploy app_engine/app.yaml</code>部署应用程序。部署完成后，我们可以使用命令<code class="du ls lt lu lj b">gcloud app browse</code>直接从CLI打开应用程序。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es mu"><img src="../Images/2830e8e762b214ee73c101baec3dd0d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L_50HOOZEjA4cmkSVFYMhQ.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">应用程序的演示视图</figcaption></figure><p id="e3ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应用程序从<em class="lh">预测_存储桶</em>中的<em class="lh">不清楚的</em>目录中读取。为了测试它，我们可以上传一张图片到这个目录。在图像被手动分类后，后端将图像存储在带有标签前缀的<em class="lh">human _ decide</em>目录中。</p><h1 id="f090" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">这个AI系统的运行成本有多高？</h1><p id="f927" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">一个重要的问题是运营这样一个云应用的成本。这里我们区分一次性成本、固定成本和动态成本:</p><ul class=""><li id="7a73" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc lv kz la lb bi translated">一次性:模特培训等费用</li><li id="0114" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc lv kz la lb bi translated">固定:为确保应用程序永久可用而产生的成本。例如模型的服务端点和带有App Engine的web应用程序</li><li id="904a" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc lv kz la lb bi translated">动态:根据使用和利用率而变化的成本，例如GCS中的存储空间和云功能的计算时间</li></ul><p id="793d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果没有具体的用例，总是很难建立精确的成本计算。除了调用次数，解决方案的环境也起着重要的作用。</p><p id="3f2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，为了给出成本的更具体的初始概念，我们做出以下假设:</p><ul class=""><li id="187e" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc lv kz la lb bi translated">每天1，000张1兆字节的图像</li><li id="5854" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc lv kz la lb bi translated">5 %的图像被归类为不安全</li><li id="62b6" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc lv kz la lb bi translated">该应用程序30天每天24小时运行</li></ul><p id="81a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">成本分摊到AutoML、App Engine、云存储和云功能的使用中。我们不考虑网络流量、GCP免费层，而是粗略估计每月成本:</p><ul class=""><li id="507f" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc lv kz la lb bi translated">模型开发(一次性):3.15美元* 8节点小时= 25.2美元</li><li id="cfb7" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc lv kz la lb bi translated">模型部署(固定):1.25美元* 24小时* 30天= 900美元</li><li id="8388" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc lv kz la lb bi translated">应用托管(固定):0.05美元* 24小时* 30天= 36美元</li><li id="bb3f" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc lv kz la lb bi translated">GCS —存储和读/写操作(动态):&lt; 1.5美元</li><li id="8557" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc lv kz la lb bi translated">云函数(动态):&lt; 1美元</li></ul><p id="55bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从计算中可以清楚地看出，模型部署导致了最高的成本。如果需要，可以进一步降低这些成本，例如，通过模型的边缘部署，或者通过不全天候运行模型，而仅在工作时间选择性地运行模型。</p><h1 id="dd24" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">结论</h1><p id="34c5" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在本文中，我们展示了如何通过几个步骤在Google云平台上实现一个用于半自动质量控制的初始AI系统。</p><p id="3a1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过使用云计算服务，数据驱动的产品可以快速原型化。应用引擎和云功能等服务使开发人员能够更专注于实际的价值创造，而不是应用程序的运营操作。</p><p id="7018" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尤其是在图像识别方面，一个足够好的AI模型在今天可以不用繁琐的努力就能开发出来。这项技术降低了数据驱动产品验证的门槛。由于云开发的技术进步，人工智能项目可以在快速实验模式下进行。</p><p id="34ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我和我的同事Marcel Mikl一起写了这篇文章。非常感谢富有成效的合作。我们在一家名为<a class="ae jd" href="https://www.codecentric.de/" rel="noopener ugc nofollow" target="_blank"> codecentric </a>的公司工作，该公司帮助企业进行数字化转型。</p><p id="b64b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你有兴趣做项目或交流数据驱动产品或人工智能，请随时给我们写电子邮件至<a class="ae jd" href="mailto:ki@codecentic.de" rel="noopener ugc nofollow" target="_blank"> ki@codecentic.de </a>。</p><p id="cce4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">_____</p><p id="6a68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您有任何反馈或问题，请随时通过LinkedIn <a class="ae jd" href="https://www.linkedin.com/in/nico-axtmann-731532107/" rel="noopener ugc nofollow" target="_blank"> Nico Axtmann </a>联系我。</p><p id="e574" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">______</p><p id="4496" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">加入<a class="ae jd" href="http://bit.ly/2Pg6z4v" rel="noopener ugc nofollow" target="_blank">生产中的机器学习</a> LinkedIn群组，学习如何将你的模型投入生产。随时加我LinkedIn。我随时欢迎讨论机器学习话题，并为您的数据科学项目业务实施提供建议！</p></div></div>    
</body>
</html>