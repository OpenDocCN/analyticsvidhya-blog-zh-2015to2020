<html>
<head>
<title>Understanding CallBacks using Python Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python理解回调第1部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/understanding-callbacks-a22e8957a73b?source=collection_archive---------1-----------------------#2020-04-19">https://medium.com/analytics-vidhya/understanding-callbacks-a22e8957a73b?source=collection_archive---------1-----------------------#2020-04-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1ec38f03d8b646f444ae054a25d52c59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HGLg5iakV401GDidgzP4YQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://inspireski.com/" rel="noopener ugc nofollow" target="_blank">https://inspireski.com/</a></figcaption></figure><p id="992b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，回调是作为参数发送给另一个函数的函数。让我们直接进入代码来理解这个概念:</p><p id="ba0b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以在<a class="ae iu" href="https://github.com/eranandagarwal/callbacks" rel="noopener ugc nofollow" target="_blank"> Github </a>中找到代码</p><p id="c0f8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们从上面<a class="ae iu" href="https://github.com/eranandagarwal/callbacks" rel="noopener ugc nofollow" target="_blank"> github </a>的simple_example.py开始。我将从下面复制一些片段来解释这个概念。</p><p id="09d2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们有一个在0–4上迭代的函数，将变量“res”中的平方或每个数字相加。它很慢，因为我们在每次迭代中引入了1秒的睡眠。请注意我们在“cb”中采用的参数，我们稍后会理解它是一个可以传递的回调。现在我们可以称这个函数为</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jt"><img src="../Images/65c95a138db52860d1f1a68a8f635256.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*edx6WWP2Rs_YbqW7ersRoQ.png"/></div></figure><p id="066f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> slow_calculation() </strong>，没有任何参数，您应该会看到输出为30。</p><p id="093f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们已经设置了基本函数，让我们来讨论我们想要赋予这个函数的许多特性。假设我们想打印“耶！！在每次迭代中都会进行一次计算。</p><p id="ef40" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以在上面的函数中引入一个打印语句，或者我们可以在上面的函数中使用回调函数“cb”。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jy"><img src="../Images/fad26e90c2c213d029fa9dc0cc04e21e.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*fACVh_kptQ7M0-VlboXyWg.png"/></div></figure><p id="75b2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们可以调用<strong class="ix hj">慢_计算(print_a_statement) </strong>。注意，我们将print_a_statement传递给slow_calculation，而不是调用它。因此，我们在print_a_statement中不使用括号。另外需要注意的是，我们在函数中传递了*args和**kwargs。这是为了确保没有或可以传递任何数量的参数。</p><p id="0ddd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，由于cb不是None，它被调用，返回print_a_statement，输出是</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jz"><img src="../Images/ec790af5d0e298311ece357308296847.png" data-original-src="https://miro.medium.com/v2/resize:fit:454/format:webp/1*HFJdob5hTM3-sgbRRxoH0Q.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">输出</figcaption></figure><p id="a3bd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们希望将迭代编号与上面的打印语句一起打印出来。为此，我们需要将回调函数修改为:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es ka"><img src="../Images/9e3bbde33f1356c6d70da015e8515c13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*Hu-I_3jZwNqeptFa5SZBCA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">接受一个参数的回调</figcaption></figure><p id="9e0a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们的基函数可以调用:<strong class="ix hj">slow _ calculation(print _ with _ param)。</strong></p><p id="878f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">而回调本身带一个参数，这个参数是调用<strong class="ix hj"> cb(i)的基函数中的迭代次数。因此现在我们将得到输出:</strong></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kb"><img src="../Images/f05821fd5283589bae6ba436422823d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*gfR5dwykEHFCqbtOaBC7yA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">带有迭代号的输出</figcaption></figure><p id="1ca5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这些是我们可以在基本函数之外进行的调整。您会注意到，对于我们正在进行的任何定制，我们都没有更改基本函数slow_calculation。让我们提出更多要求。</p><p id="6f1c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面解释的代码来自<a class="ae iu" href="https://github.com/eranandagarwal/callbacks" rel="noopener ugc nofollow" target="_blank"> Github </a>中包含的more_callback.py文件</p><p id="ef70" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们灵活地将感叹句改为“耶！!"。如果我们要写“<strong class="ix hj">牛逼怎么办！！只需完成0次迭代</strong>即可，以此类推。这里我们可以使用闭包的概念。简单地说，闭包是一个函数记住其他函数的输入的能力。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kc"><img src="../Images/7e0c61188e3ee956480c98b8f6b14082.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZyiN8_pNDowUZSAaVFqySg.png"/></div></div></figure><p id="a21c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里show_progress_as_function接受一个感叹号参数，内部函数有一个迭代参数。返回的函数打印了感叹号和迭代。</p><p id="8c93" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以称我们的基本函数为:</p><p id="2355" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">慢_计算(show_progress_as_function("牛逼！!"))</strong></p><p id="bf96" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意，这可以分两步完成:</p><ol class=""><li id="7c87" class="kd ke hi ix b iy iz jc jd jg kf jk kg jo kh js ki kj kk kl bi translated">f1 =<strong class="ix hj">show _ progress _ as _ function("牛逼！!")</strong></li><li id="1a02" class="kd ke hi ix b iy km jc kn jg ko jk kp jo kq js ki kj kk kl bi translated">慢速计算(f1)</li></ol><p id="bc79" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">输出为:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kr"><img src="../Images/633b2d9069f4b7058b63add515d95833.png" data-original-src="https://miro.medium.com/v2/resize:fit:574/format:webp/1*mQfdejdpGBscVCV5cPZkEg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">用牛逼输出！！感叹</figcaption></figure><p id="e694" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将2参数函数改为1参数函数在python中很常见，就像我们上面所做的那样，为此我们有了python库。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es ks"><img src="../Images/685fbadcd30c015cf760c7bfc55bdc3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*5tevE01_PAN6xRle6iwVzg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">双参数函数</figcaption></figure><p id="b56c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面的函数接受2个参数，但是在functool模块的部分功能的帮助下，我们可以将其更改为1个参数的函数，如下所示</p><p id="a036" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">从functool导入部分</strong></p><p id="3009" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">f1 = partial (show_progress，“牛逼！!")</p><p id="2d4c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在f1是一个接受1个参数的函数，其中show_progress中的感叹号参数很牛逼！！</p><p id="716c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，现在我们可以把基函数称为:</p><p id="135b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">slow _ calculation(partial(show _ progress，'这太棒了！!'))</strong></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/8408bda31a97dc5303f2a2083eaf56f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*gte4H-tJVwDEQNOgctEstw.png"/></div></div></figure><p id="b000" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此我们可以看到，拥有回调是一种修改行为和从修改需求的基本功能中提取独立性的非常圆滑的方式。</p><p id="6e3d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">编辑:回调的高级步骤很少，比如让一个类作为回调而不是函数。我在这个博客的第二部分<a class="ae iu" rel="noopener" href="/@anandagarwal_13834/understanding-callbacks-using-python-part-2-e71c17fed7e2">这里</a>讨论了这个问题。</p><p id="5ea9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请阅读第2部分，了解更多关于回调的信息</p><p id="5840" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">鸣谢:这篇博客不能不感谢杰瑞米·霍华德对回拨的精彩解释。他是Fastai深度学习库的创建者。</p></div></div>    
</body>
</html>