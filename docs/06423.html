<html>
<head>
<title>Finding Nearest pair of Latitude and Longitude match using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python查找最近的经纬度匹配对</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/finding-nearest-pair-of-latitude-and-longitude-match-using-python-ce50d62af546?source=collection_archive---------0-----------------------#2020-05-22">https://medium.com/analytics-vidhya/finding-nearest-pair-of-latitude-and-longitude-match-using-python-ce50d62af546?source=collection_archive---------0-----------------------#2020-05-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="99b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用哈弗辛距离方程，这里是一个python代码，找到最近的位置匹配的基础上的距离为任何给定的2 CSV文件，其中有纬度和经度</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/82151c12d0d8d06b53f1579228e56600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1-6IllQ5kqR5SY82otGCZQ.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">安德鲁·斯图茨曼在Unsplash 上的照片</figcaption></figure><p id="67a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">业务需求</strong></p><p id="ea4f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如今，深入研究用户统计数据变得越来越普遍。尤其是在以客户为中心的公司和像优步、OYO、GRAB、SWIGGY这样的独角兽，在这些公司中App在理解用户行为方面起着至关重要的作用。年龄、性别、位置、平均购物篮大小、活跃时间段、生命周期价值被认为是业务的关键驱动因素。</p><p id="28e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">最近出现的重要性(距离)</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ju"><img src="../Images/4968ba4f52c143476e4af5d54d1a7fde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XAyjKAG07OQ6J7qf41yYWg.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">会员到酒店的距离(Socar的UI/UX设计师Sai Kiran Gottala)</figcaption></figure><p id="5d41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像优步这样的公司，总是找到用户和优步汽车之间的有效距离，并引导他们的司机开车到高需求(激增)地区。同样，像SWIGGY这样的食品配送公司计算用户和酒店位置之间的距离，以维持他们的准时配送体验，并相应地指导乘客。</p><p id="acb1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本教程中，我们在马来西亚的酒店(餐馆)位置和会员之间执行<strong class="ih hj">哈弗线距离公式分析</strong>。数据集由两个独立的文件组成。第一个是酒店位置，第二个是会员。我们<strong class="ih hj">想要确定哪个酒店离第二个数据集中的任何给定成员</strong>最近</p><p id="fb62" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jv">(不强制理解后面的数学方程，我们在这里是为了理解在Python上复制公式的过程)</em></p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="c82f" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated"><strong class="ak">维基百科上有什么关于哈弗线距离的内容</strong></h1><p id="6c7a" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">给定经度和纬度，哈弗辛公式确定了球体上两点之间的<strong class="ih hj">大圆距离。</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lg"><img src="../Images/d9513b4266e1033729aec5cad7eee1db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mEgcWsABlJwu2Ai-o9EPyw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">来源:<a class="ae jt" href="https://en.wikipedia.org/wiki/Haversine_formula" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Haversine_formula</a></figcaption></figure><p id="9e03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不需要担心这一点，因为我们只需要使用一段代码来复制python中的相同公式。只要记住地球的无线电距离是6371公里</p><p id="6be4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">从Python中的ula复制哈弗辛距离:</strong></p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="21ac" class="lm ke hi li b fi ln lo l lp lq">from math import radians, cos, sin, asin, sqrt<br/>def dist(lat1, long1, lat2, long2):<br/>    """<br/>Replicating the same formula as mentioned in Wiki<br/>    """<br/>    # convert decimal degrees to radians <br/>    lat1, long1, lat2, long2 = map(radians, [lat1, long1, lat2, long2])<br/>    # haversine formula <br/>    dlon = long2 - long1 <br/>    dlat = lat2 - lat1 <br/>    a = sin(dlat/2)**2 + cos(lat1) * cos(lat2) * sin(dlon/2)**2<br/>    c = 2 * asin(sqrt(a)) <br/>    # Radius of earth in kilometers is 6371<br/>    km = 6371* c<br/>    return km</span></pre><p id="69be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样！！</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="5c3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">现在该打开木星笔记本了</strong></p><blockquote class="lr ls lt"><p id="2e89" class="if ig jv ih b ii ij ik il im in io ip lu ir is it lv iv iw ix lw iz ja jb jc hb bi translated"><strong class="ih hj">A部分—为CSV中的每个成员查找最近的酒店名称</strong></p></blockquote><p id="a2e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从CSV文件中读取数据</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="8427" class="lm ke hi li b fi ln lo l lp lq">hotels = pd.read_csv(“data/hotels.csv”)<br/>hotels.head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lx"><img src="../Images/6916d49d46e1437a4daa08f912f67f8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*oZkdVMXP1yXV2Wcki_OUFw.png"/></div></figure><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="e3d8" class="lm ke hi li b fi ln lo l lp lq">members = pd.read_csv(“data/members.csv”)<br/>members.head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ly"><img src="../Images/1c33f6261eb1a2ad922d5a68608e1492.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*oeX-R8zl_q8K9L3zvdW77Q.png"/></div></figure><p id="13e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更改列名，以减少代码中需要输入的字母数量</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="8373" class="lm ke hi li b fi ln lo l lp lq"># Renaming the column names <br/>members=members.rename(columns = {'latitude':'lat','longitude':'lon'})</span><span id="a094" class="lm ke hi li b fi lz lo l lp lq">hotels=hotels.rename(columns = {'latitude':'lat','longitude':'lon'})</span><span id="47b9" class="lm ke hi li b fi lz lo l lp lq"># To make sure that there are no null values and All are either integers/ Float values </span><span id="105f" class="lm ke hi li b fi lz lo l lp lq">members.info() <br/>print('\n XXXXXXXXXXXXXXXXXXXXXXX\n')<br/>hotels.info()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ma"><img src="../Images/3fea5bff98388ef324d65f170fa9a458.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*4CZj0U3dCjbxnT5UIr_qTw.png"/></div></figure><p id="8345" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">使用哈弗辛方程，我们可以找到会员位置与酒店数据框中所有坐标之间的“距离”。</strong></p><p id="e204" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们把这些值传递给我们的<strong class="ih hj">哈弗辛方程</strong>，来计算距离</p><p id="205a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jv">(只是复制粘贴上面的等式)</em></p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="432c" class="lm ke hi li b fi ln lo l lp lq">from math import radians, cos, sin, asin, sqrt<br/>def dist(lat1, long1, lat2, long2):<br/>    """<br/>    Calculate the great circle distance between two points <br/>    on the earth (specified in decimal degrees)<br/>    """<br/>    # convert decimal degrees to radians <br/>    lat1, long1, lat2, long2 = map(radians, [lat1, long1, lat2, long2])<br/>    # haversine formula <br/>    dlon = long2 - long1 <br/>    dlat = lat2 - lat1 <br/>    a = sin(dlat/2)**2 + cos(lat1) * cos(lat2) * sin(dlon/2)**2<br/>    c = 2 * asin(sqrt(a)) <br/>    # Radius of earth in kilometers is 6371<br/>    km = 6371* c<br/>    return km</span></pre><p id="bcef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以上计算了到所有酒店的距离。使用<code class="du mb mc md li b"><strong class="ih hj">idxmin</strong></code>您可以找到最近的酒店名称，</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="b3e3" class="lm ke hi li b fi ln lo l lp lq">def find_nearest(lat, long):<br/>    distances = hotels.apply(<br/>        lambda row: dist(lat, long, row['lat'], row['lon']), <br/>        axis=1)<br/>    return hotels.loc[distances.idxmin(), 'name']</span></pre><p id="1e69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们有了最接近的酒店名称，现在只需使用，</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="f33d" class="lm ke hi li b fi ln lo l lp lq">members['name'] = members.apply(<br/>    lambda row: find_nearest(row['lat'], row['lon']), <br/>    axis=1)</span><span id="4377" class="lm ke hi li b fi lz lo l lp lq"># To check the data frame if it has a new column of hotel name (for each and every member's location in the list)</span><span id="e33e" class="lm ke hi li b fi lz lo l lp lq">members.head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es me"><img src="../Images/5a836c7234b267dbadf59672ea0284fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*-irNIWkZB7MObTIG1s9rIQ.png"/></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><blockquote class="lr ls lt"><p id="7111" class="if ig jv ih b ii ij ik il im in io ip lu ir is it lv iv iw ix lw iz ja jb jc hb bi translated"><strong class="ih hj">B部分—查找会员所在地到最近酒店的“距离”</strong></p></blockquote><p id="ff26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">获取单个表中的所有数据，对于上面的数据集，合并酒店名称的纬度和经度</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="87cf" class="lm ke hi li b fi ln lo l lp lq">members = pd.merge(members,hotels[['name','lat','lon']],on='name', how='left')</span><span id="8172" class="lm ke hi li b fi lz lo l lp lq"># Rename the new columns as both the columns has same name, and python gets confused </span><span id="3a67" class="lm ke hi li b fi lz lo l lp lq">members=members.rename(columns = {'lat_x':'m_lat','lon_x':'m_lon','lat_y':'h_lat','lon_y':'h_lon'})</span><span id="d552" class="lm ke hi li b fi lz lo l lp lq">members.head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mf"><img src="../Images/4f2fbef743cf69ecbb48e6b63ba74223.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*nDdDG-vgJ3lK_Q4o0Uc6Fw.png"/></div></figure><p id="d013" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">再次找出两对纵坐标之间的距离，让我们再次使用<strong class="ih hj">哈弗森距离</strong>公式(在最新的表上)</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="4c43" class="lm ke hi li b fi ln lo l lp lq">from math import radians, cos, sin, asin, sqrt<br/>def haversine(lon1, lat1, lon2, lat2):<br/>    """<br/>    Calculate the great circle distance between two points <br/>    on the earth (specified in decimal degrees)<br/>    """<br/>    # convert decimal degrees to radians <br/>    lon1, lat1, lon2, lat2 = map(radians, [lon1, lat1, lon2, lat2])<br/>    # haversine formula <br/>    dlon = lon2 - lon1 <br/>    dlat = lat2 - lat1 <br/>    a = sin(dlat/2)**2 + cos(lat1) * cos(lat2) * sin(dlon/2)**2<br/>    c = 2 * asin(sqrt(a)) <br/>    # Radius of earth in kilometers is 6371<br/>    km = 6371* c<br/>    return km</span><span id="d8d9" class="lm ke hi li b fi lz lo l lp lq"># Creating a new column to generate the output by passing lat long information to Haversine Equation</span><span id="b87a" class="lm ke hi li b fi lz lo l lp lq">members['distance'] = [haversine(members.m_lon[i],members.m_lat[i],members.h_lon[i],members.h_lat[i]) for i in range(len(members))]<br/>members['distance'] = members['distance'].round(decimals=3)</span><span id="780c" class="lm ke hi li b fi lz lo l lp lq"># Printing the data table <br/>members.head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mg"><img src="../Images/dc643dbe4606022e374914f7a63d80a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A2lDYlOTmTQ6ejpxDo3duA.png"/></div></div></figure><p id="d858" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在上一栏中得到的<strong class="ih hj">距离</strong>是酒店和会员所在地之间的距离，单位为“千米”</p><p id="2d29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">将您的结果打印到您的CSV文件中</strong></p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="7519" class="lm ke hi li b fi ln lo l lp lq">members.to_csv("output.csv", sep='\t', encoding='utf-8'</span></pre></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><blockquote class="lr ls lt"><p id="46a1" class="if ig jv ih b ii ij ik il im in io ip lu ir is it lv iv iw ix lw iz ja jb jc hb bi translated"><strong class="ih hj">C部分——在地图上绘制结果</strong></p></blockquote><p id="c388" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请将您的output.csv分成两个文件，一个给会员(Id，Lat，Long)，另一个给酒店(name，Lat，Long)</p><p id="f3e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请点击:<a class="ae jt" href="https://www.google.com/maps/about/mymaps/" rel="noopener ugc nofollow" target="_blank">https://www.google.com/maps/about/mymaps/</a>并创建新地图</p><p id="68b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后导入两个Members.csv和Hotel.csv。我的地图会帮你规划坐标</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mh"><img src="../Images/039c09f722a4cd22e40f6c1984fd4ce6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CGGgROnNG0_lc-XjuqTyGQ.png"/></div></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="9c00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">结论:</strong>利用距离信息你可以</p><ol class=""><li id="3e91" class="mi mj hi ih b ii ij im in iq mk iu ml iy mm jc mn mo mp mq bi translated">定义和利用新的扩张机会</li><li id="9d01" class="mi mj hi ih b ii mr im ms iq mt iu mu iy mv jc mn mo mp mq bi translated">管理您的地面车队并降低运营成本</li><li id="f894" class="mi mj hi ih b ii mr im ms iq mt iu mu iy mv jc mn mo mp mq bi translated">根据运营效率管理您的SLA，并在CX方面保持较高的NPS分数。</li></ol></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="4d47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，非常感谢您抽出宝贵的时间阅读本文，我希望您喜欢在您的数据集上复制相同的内容。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="0d4a" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">参考</h1><p id="9354" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated"><a class="ae jt" href="https://en.wikipedia.org/wiki/Haversine_formula" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Haversine_formula</a></p></div></div>    
</body>
</html>