<html>
<head>
<title>Delving into Python Decorators: Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深入研究Python Decorators:第2部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/delving-into-python-decorators-part-2-1936b25baf9d?source=collection_archive---------21-----------------------#2020-07-23">https://medium.com/analytics-vidhya/delving-into-python-decorators-part-2-1936b25baf9d?source=collection_archive---------21-----------------------#2020-07-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/4a4b188e13ee7d9349998cbf0853229c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/0*sp6pRaQXERGNVhq1"/></div></figure><p id="00d4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是关于Python中装饰者的四部分系列的第二部分。该系列的第一部分可以在这里找到<a class="ae jk" rel="noopener" href="/@ashwin.nair1700/delving-into-python-decorators-part-1-a95b57d3a7bc"/>。</p><p id="1d74" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在本系列的第一部分中，我们介绍了装饰者的基础知识，它们是什么，如何使用它们，以及为什么应该使用它们。Python中有很多decorators的实际应用。有些是:</p><ul class=""><li id="cbeb" class="jl jm hi io b ip iq it iu ix jn jb jo jf jp jj jq jr js jt bi translated">日志函数，用于调试函数。</li><li id="cfd3" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">速率限制函数，可用于降低检查某个资源自上次访问以来是否已被更改的函数的速度。</li><li id="ad2a" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">计时函数，可以用来检查一个函数执行需要多长时间。</li><li id="dd9f" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">登录功能；这主要用于web应用程序，如Flask和Django，以确保有登录的用户。</li><li id="1687" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">插件注册，可以用来注册，添加新插件，编辑现有插件，使用插件。</li></ul><p id="31be" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">本周，我们将讨论其中之一:对数函数。</p><p id="12a5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">日志记录有助于更好地理解代码是如何执行的，它通常是调试错误的基本方法。</p><blockquote class="jz ka kb"><p id="1c51" class="im in kc io b ip iq ir is it iu iv iw kd iy iz ja ke jc jd je kf jg jh ji jj hb bi translated"><em class="hi">调试[ </em> <a class="ae jk" href="https://en.wikipedia.org/wiki/Debugging" rel="noopener ugc nofollow" target="_blank"> <em class="hi"> 1 </em> </a> <em class="hi"> ]指的是发现并解决计算机程序内的错误。</em></p></blockquote><p id="38bd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">装饰者可以对此有所帮助；您可以创建一个logger函数，然后将它用作您想要记录的任何函数的装饰器。</p><p id="75d0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">见下文:</p><figure class="kg kh ki kj fd ij"><div class="bz dy l di"><div class="kk kl l"/></div><figcaption class="km kn et er es ko kp bd b be z dx translated">my_logger函数，一个简单的函数，用来记录函数被调用和执行的时间。</figcaption></figure><p id="1aca" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们详细回顾一下这段代码。</p><p id="00b0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="kc">第一步:定义my_logger函数。</em></p><p id="0fe5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们定义了my_logger函数，唯一的参数是<code class="du kq kr ks kt b">function</code>，修饰后的函数将作为输入传递。</p><p id="61c2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="kc">第二步:“函数被调用”输出。</em></p><p id="f30c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们现在有了一个简单的打印语句，它使用了<code class="du kq kr ks kt b">.format()</code>方法和<code class="du kq kr ks kt b">__name__</code>方法来很好地输出函数名。<code class="du kq kr ks kt b">__name__</code>方法是<strong class="io hj"> Dunder </strong>方法[ <a class="ae jk" href="https://www.geeksforgeeks.org/dunder-magic-methods-python/" rel="noopener ugc nofollow" target="_blank"> 2 </a> ]的一个例子。邓德代表分数下的<em class="kc">d</em>double<em class="kc">。这些方法用于运算符重载，这意味着为Python中的运算符提供扩展功能。</em></p><p id="687f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="kc">第三步:定义内部函数。</em></p><p id="08e3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里，我们定义了内部函数，我们称之为包装器。包装器以<code class="du kq kr ks kt b">*args</code>和<code class="du kq kr ks kt b">**kwargs</code> [ <a class="ae jk" href="https://book.pythontips.com/en/latest/args_and_kwargs.html" rel="noopener ugc nofollow" target="_blank"> 3 </a>为参数。这是一个Python特性，它接受修饰函数的所有位置和关键字参数，并将它们存储为变量。*args和**kwargs传递尽可能多的参数，即使您并不真正知道需要传递多少个参数。</p><p id="5528" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="kc">第四步:执行修饰函数。</em></p><p id="165a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在第4步中，我们执行函数并将函数的结果存储为<code class="du kq kr ks kt b">funcRes</code>变量。</p><blockquote class="jz ka kb"><p id="0555" class="im in kc io b ip iq ir is it iu iv iw kd iy iz ja ke jc jd je kf jg jh ji jj hb bi translated"><em class="hi">记得在</em> <a class="ae jk" rel="noopener" href="/@ashwin.nair1700/delving-into-python-decorators-part-1-a95b57d3a7bc"> <em class="hi">这一系列的第一部分</em> </a> <em class="hi">中，Python中的函数有</em><strong class="io hj"><em class="hi"/></strong><em class="hi"/><a class="ae jk" href="https://www.geeksforgeeks.org/first-class-functions-python/" rel="noopener ugc nofollow" target="_blank"><em class="hi">4</em></a><em class="hi">。这意味着它们可以在其他函数中用作参数。</em></p></blockquote><p id="31d0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="kc">第五步:函数输出。</em></p><p id="83d3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我们用另一个print语句返回函数的输出。我们还显示了函数名，以准确显示正在显示的函数输出。</p><p id="dd3a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">第六步:返回报表。</p><p id="d9ee" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">底部的两个return语句是拼图的最后一块。<code class="du kq kr ks kt b">return funcRes</code>作为<code class="du kq kr ks kt b">wrapper</code>功能的输出，<code class="du kq kr ks kt b">return wrapper</code>作为<code class="du kq kr ks kt b">logging</code>功能的输出。</p><p id="9fe3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们已经组装好了日志记录函数，是时候测试它了。我写了一个简单的脚本来测试它:</p><figure class="kg kh ki kj fd ij"><div class="bz dy l di"><div class="kk kl l"/></div><figcaption class="km kn et er es ko kp bd b be z dx translated">add函数用于测试my_logger函数。</figcaption></figure><p id="3d98" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">输出:</p><figure class="kg kh ki kj fd ij"><div class="bz dy l di"><div class="kk kl l"/></div><figcaption class="km kn et er es ko kp bd b be z dx translated">成功！my_logger decorator记录函数何时被调用，何时被执行。</figcaption></figure><p id="577e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">有用！您已经成功地编写了一个日志记录函数，它会告诉您调用了什么函数，以及输出是什么！现在，如果我们更进一步，增加计时功能来计算修饰函数执行的时间，会怎么样呢？这其实很简单。然而，为了使输出更具视觉吸引力，让我们使用python的<code class="du kq kr ks kt b">colorama</code> [ <a class="ae jk" href="https://pypi.org/project/colorama/" rel="noopener ugc nofollow" target="_blank"> 5 </a> ]模块。您需要使用pip来安装它:</p><p id="5fb8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><code class="du kq kr ks kt b">~ pip install colorama</code></p><p id="20af" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Colorama允许您自定义终端输出的颜色。我们可以利用这一点使我们的日志输出从函数输出中脱颖而出，或者只是使您的输出更有吸引力。</p><figure class="kg kh ki kj fd ij"><div class="bz dy l di"><div class="kk kl l"/></div><figcaption class="km kn et er es ko kp bd b be z dx translated">my_logger函数的更新版本，现在完成了终端内的颜色和计时。</figcaption></figure><p id="efe6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这就是完成的<code class="du kq kr ks kt b">my_logger</code>功能。让我们像以前一样分解它:</p><p id="944d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="kc">第一步:导入报表。</em></p><p id="4f19" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们有之前和pip一起安装的<code class="du kq kr ks kt b">colorama</code>模块，我们从其中导入了<code class="du kq kr ks kt b">Fore</code>和<code class="du kq kr ks kt b">Style</code>函数。<code class="du kq kr ks kt b">Fore</code>和<code class="du kq kr ks kt b">Style</code>是<code class="du kq kr ks kt b">colorama</code>提供的两个格式化常量。<code class="du kq kr ks kt b">Fore</code>可让您选择想要使用的颜色，而<code class="du kq kr ks kt b">Style</code>可帮助您选择风格。除了<code class="du kq kr ks kt b">colorama</code>，我们还有<code class="du kq kr ks kt b">time</code>模块，这是Python中包含的一个基本模块。</p><p id="86f6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="kc">第二步:perfCounter()，start_time变量。</em></p><p id="afbb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们之前导入了<code class="du kq kr ks kt b">time</code> [ <a class="ae jk" href="https://docs.python.org/3/library/time.html" rel="noopener ugc nofollow" target="_blank"> 6 </a>模块，这是Python标准库中的一个模块。它有一个函数叫做<code class="du kq kr ks kt b">perfCounter()</code> [ <a class="ae jk" href="https://www.geeksforgeeks.org/time-perf_counter-function-in-python/" rel="noopener ugc nofollow" target="_blank"> 7 </a> ]，是“性能计数器”的简称。在这里，我们将它用作一种秒表，每当函数执行时开始计时，每当函数执行完毕时停止计时。这里，我们使用<code class="du kq kr ks kt b">start_time</code>变量来标记函数何时开始运行。</p><p id="b5af" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="kc">第三步:Fore和Style。</em></p><p id="5bdf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们使用colorama定制终端输出颜色。通过在打印语句的开头使用<code class="du kq kr ks kt b">Fore.GREEN</code>，我们可以将打印语句的内容变成绿色。使用<code class="du kq kr ks kt b">Style.RESET_ALL</code>功能，我们结束colorama更改，确保其他打印语句不会受到此语句中颜色设置的影响。</p><p id="d63c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="kc">第四步:end_time变量。</em></p><p id="f909" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们再次利用来自<code class="du kq kr ks kt b">time</code>模块的<code class="du kq kr ks kt b">perfCounter()</code>函数，现在我们将<code class="du kq kr ks kt b">end_time</code>设为变量，它标记函数停止运行的时间。</p><p id="3328" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="kc">第五步:time_taken变量。</em></p><p id="bab7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我们引入<code class="du kq kr ks kt b">time_taken</code>变量，它是<code class="du kq kr ks kt b">end_time</code>减去<code class="du kq kr ks kt b">start_time</code>。这是functiprint(user_input)在上执行所用的时间。</p><p id="4a4a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="kc">第六步:定时输出。</em></p><p id="701a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在第6步中，我们看到一个用红色格式化的打印语句，以区别于其他日志记录语句(用绿色完成)和修饰函数的输出。我们使用<code class="du kq kr ks kt b">.4f</code> [ <a class="ae jk" href="https://shocksolution.com/2011/11/03/python-string-format-examples/" rel="noopener ugc nofollow" target="_blank"> 8 </a> ]格式说明符来指定打印输出时要显示多少个小数位。</p><p id="ce99" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们已经创建了函数，让我们测试一下。我们可以使用之前使用过的相同的<code class="du kq kr ks kt b">add()</code>函数来测试第一个<code class="du kq kr ks kt b">my_logger()</code>函数。</p><p id="8cf2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">输出:</p><figure class="kg kh ki kj fd ij er es paragraph-image"><div class="er es ku"><img src="../Images/e245d8df77165011d8e1e0332cda7eb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/0*Gw8kBcirpjMhFY6l"/></div><figcaption class="km kn et er es ko kp bd b be z dx translated">最终产品；视觉吸引力和实用性。</figcaption></figure><p id="4d30" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们已经创建了一个主日志记录函数，它有很好的输出，并记录了修饰函数执行的时间。当然，这是可以改进的。</p><p id="a22b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">总之，我们构建了一个主要的日志记录函数，记录调用了什么以及执行修饰函数花费了多长时间。我们还看了Python的标准库模块之一time模块和colorama使用pip安装的外部模块。这个简单的程序很大程度上是可扩展的；想怎么改进就怎么改进吧！</p><p id="8937" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">感谢阅读这篇文章。如果你觉得它有帮助，考虑给它鼓掌！如果你想在我发表更多文章时得到通知，请关注我。</p><p id="7db7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在下一篇文章中，我们将使用decorators来尝试限制(或减慢)您的代码。留意它！</p><ol class=""><li id="6fcd" class="jl jm hi io b ip iq it iu ix jn jb jo jf jp jj kv jr js jt bi translated"><a class="ae jk" href="https://en.wikipedia.org/wiki/Debugging" rel="noopener ugc nofollow" target="_blank">调试定义</a></li><li id="8ab1" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj kv jr js jt bi translated"><a class="ae jk" href="https://www.geeksforgeeks.org/dunder-magic-methods-python/" rel="noopener ugc nofollow" target="_blank">极客为极客:邓德方法</a></li><li id="aa6e" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj kv jr js jt bi translated"><a class="ae jk" href="https://book.pythontips.com/en/latest/args_and_kwargs.html" rel="noopener ugc nofollow" target="_blank"> Python提示:*args和**kwargs </a></li><li id="1c6e" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj kv jr js jt bi translated"><a class="ae jk" href="https://www.geeksforgeeks.org/first-class-functions-python/" rel="noopener ugc nofollow" target="_blank">极客对极客:第一类对象</a></li><li id="f918" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj kv jr js jt bi translated"><a class="ae jk" href="https://pypi.org/project/colorama/" rel="noopener ugc nofollow" target="_blank"> PyPi Colorama </a></li><li id="4312" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj kv jr js jt bi translated"><a class="ae jk" href="https://docs.python.org/3/library/time.html" rel="noopener ugc nofollow" target="_blank"> Python文档:时间模块</a></li><li id="a849" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj kv jr js jt bi translated"><a class="ae jk" href="https://www.geeksforgeeks.org/time-perf_counter-function-in-python/" rel="noopener ugc nofollow" target="_blank">极客对极客:perfCounter() </a></li><li id="2395" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj kv jr js jt bi translated"><a class="ae jk" href="https://shocksolution.com/2011/11/03/python-string-format-examples/" rel="noopener ugc nofollow" target="_blank">震撼解决方案:Python字符串格式化</a></li></ol></div></div>    
</body>
</html>