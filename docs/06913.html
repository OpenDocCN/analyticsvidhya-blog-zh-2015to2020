<html>
<head>
<title>Stock price prediction using LSTM (Long Short-Term Memory)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于LSTM(长短期记忆)的股价预测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/stock-price-prediction-using-lstm-long-short-term-memory-e8c125a853e4?source=collection_archive---------7-----------------------#2020-06-07">https://medium.com/analytics-vidhya/stock-price-prediction-using-lstm-long-short-term-memory-e8c125a853e4?source=collection_archive---------7-----------------------#2020-06-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8029" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将展示如何编写python代码，使用长短期记忆(LSTM)的机器学习技术来预测股票价格。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/f07be503f5f8eccdf362d8d2903ce32a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*opzxrBna63YDbd8_pM5trw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><a class="ae jt" href="https://www.google.com/url?sa=i&amp;url=https%3A%2F%2Fsundeeppothula1993.github.io%2FARTML%2F%2Fblog%2FAdaptive-Online-Learning-for-Stock-Price-Prediction%2F&amp;psig=AOvVaw3WQrHZLfZvMloxgwBWlUrc&amp;ust=1590901075825000&amp;source=images&amp;cd=vfe&amp;ved=0CA0QjhxqFwoTCODigMPm2ukCFQAAAAAdAAAAABAJ" rel="noopener ugc nofollow" target="_blank">用于股票价格预测的自适应在线学习</a></figcaption></figure><h1 id="3d15" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">算法选择</h1><p id="d368" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">LSTM无法处理任何一个数据点。它需要一系列数据进行处理，并能够存储历史信息。LSTM是一种基于时间序列数据进行预测和处理的合适算法。最好在回归问题上多下功夫。</p><p id="65b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">股票市场有大量随交易日变化的历史数据，这些数据是时间序列数据，但是当数据集有大量数据时，LSTM模型可以更准确地预测短期内的股票价格。</p><h1 id="42aa" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">数据集</h1><p id="abf7" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated"><a class="ae jt" href="https://finance.yahoo.com/quote/AAPL/" rel="noopener ugc nofollow" target="_blank">苹果公司的历史股价数据集来自雅虎</a>！金融网页。其中包含从2009年1月1日到2020年4月20日的股票价格，用逗号分隔。csv)格式，在特定股票中也有不同类型的价格。通过获得一个数据集，然后得出最终确定的特征和行为的股票价格。获得了七个特征。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kx"><img src="../Images/cf2a1a53283577ef074f588a6f5efa72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*N-diVnKJsoA2rr1c7jPR6Q.png"/></div></figure><h1 id="8a7b" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">每个属性的描述</h1><p id="3e71" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">描述下面给出的数据集的属性。属性值是浮点型的，除了日期和体积。</p><p id="e4d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ky">日期</em> : </strong> —股票的交易日。</p><p id="a89b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ky">开盘价</em> : </strong> —该股票的开盘价，是指特定交易日的最开始价格，但与贵金属的当日收盘价不同。</p><p id="b4ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ky">高点</em> : </strong> —这是股票在特定交易日的最高价格。</p><p id="d54a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ky">低点</em> : </strong> —这是交易日的最低股价。</p><p id="7e0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ky">收盘</em> : </strong> —这是股票在特定交易日的收盘价。</p><p id="4470" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ky">调整收盘:</em> </strong> —这是股票的期末或收盘价格，该价格已发生变化，包含当天交易时间内发生的任何公司行为和分配。</p><p id="72ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ky">成交量</em> : </strong> —这是某一天交易的股票数量。</p><h1 id="31fd" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">数据预处理</h1><p id="cc03" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">第一阶段，我们需要导入所有必要的库。使用python中的panda库读取收集的数据集，并显示记录以理解数据集进行预处理。此时，我们能够识别数据集的行为和特征。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kz"><img src="../Images/4ea2d8e818fa8233ba8f97d819fcfd3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VTt_30yVirG0z6eUXiWR3w.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">导入库</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es la"><img src="../Images/bb76daf3ff03adbcc9150cc0ec45086c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*ONNSSnLEd7cfTuDwhYE49Q.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">数据集的前五行</figcaption></figure><p id="b527" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将给定数据可视化为股价涨跌行为的绘图格式。除了只显示该交易日股票收盘价的变化。其他属性是股票价格，即使收盘价决定交易日的交易价格。Matplotlib是python中用于绘制任何类型的图形的极好的库。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lb"><img src="../Images/3599b94bde10eab5646e49f95be4d81f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_dWwhfSbc_odnFUW4Osm5A.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">数据集的可视化</figcaption></figure><h1 id="e5ae" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">正常化</h1><p id="e06d" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">特征缩放和标准化数据是降低错误率和提高模型精度的最佳方式。给定的数据集中有各种类型的数据。在这里，我把所有选定的功能放在同一个比例。所以，没有一个特征是支配其他的。在代码下面，快照用于缩放数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lc"><img src="../Images/ba5507a6e857072347006aff03ba1ada.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TDttJCg03Z3YuWd2uB0V2Q.png"/></div></div></figure><p id="e457" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将数据缩放成表格形式。根据这种格式，我们可以很容易地识别特定汇率的交易率。功能缩放范围应介于0和1之间。</p><h1 id="9980" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">特征分布可视化。</h1><p id="c5ab" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">下图展示了特征分布的可视化。通过此图，可以更好地了解判定分数的特征和系数。热点图是由过度索引功能创建的。在这里，我们能够看到数据集的给定特征之间的相互关系，例如<strong class="ih hj">打开</strong>、<strong class="ih hj">高</strong>、<strong class="ih hj">低</strong>、<strong class="ih hj">关闭</strong>和<strong class="ih hj">调整关闭。</strong>当我们在热图中的<strong class="ih hj">处看到体积</strong>点时，这是另一个特征，但没有显示其他特征之间的任何相关性。因此，在预测时应将其排除在外。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ld"><img src="../Images/9ba5c15ab9cbed8c3378d5379e2ae682.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DOyvbXIfidJidCe2kcvaOw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">特征分布的可视化</figcaption></figure><p id="2891" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">提取必要的特征，然后将数据集分成训练和测试两部分。我们从不把测试数据用于训练。下图显示了用于训练的分割数据的代码快照。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es le"><img src="../Images/da11ad12f33fc5215e9c32fc1bb95f57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xlcp37PyMzW7HcmDSUJHfA.png"/></div></div></figure><p id="81cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我提取了给定缩放数据框的“收盘”价格。我已经分离了80%的数据用于模型训练，20%的数据用于测试。2843个样本中有2275个样本用于训练，其余用于测试和验证。</p><h1 id="ed2b" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">算法的实现</h1><p id="42bb" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">一旦完成预处理阶段，让我们继续进行LSTM算法的实现。在继续之前，创建一个包含股票过去六天收盘价的训练数据集，然后预测股票在第六十一天的收盘价。将训练数据集分成两部分<em class="ky"> Xtrain </em>和<em class="ky"> Ytrain </em>。这里，<em class="ky"> Xtrain </em>数据集是独立数据集，<em class="ky"> Ytrain </em>数据集是非独立数据集。</p><p id="902f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将Xtrain和Ytrain数据集转换为<strong class="ih hj"> NumPy </strong>数组，因为它将用于训练LSTM模型。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lf"><img src="../Images/389c980346a847f4584c91fd960af7cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ywbq_GnOCVF9YyqVtKKSGA.png"/></div></div></figure><p id="dc7d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">LSTM模型有一个三维数据集[样本数量，时间步长，特征]。因此，我们需要将数据从二维重塑为三维。(NumPy数组有二维数据)。在代码下面，snapshot展示了一个关于重塑数据集的清晰思路。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lg"><img src="../Images/767ff4e76d1022383ce5cde84030c194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*q54Vr8QIh60TbSInm7QU0Q.png"/></div></figure><p id="b122" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建LSTM模型，该模型具有包含五十个神经元的两个LSTM层，还具有两个密集层，一个层包含二十五个神经元，另一个层包含一个神经元。为了创建一个模型，将DNN上的Keras库(深度神经网络)创建的LSTM模型顺序输入。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lh"><img src="../Images/8a6097625e99057013590021bb8139d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2441pA1B31a9L7jW8AQvCQ.png"/></div></div></figure><p id="8636" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">编译LSTM模型使用MSE(均方误差)作为损失函数，优化器作为“adam”。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es li"><img src="../Images/83a7ec7183d0578596e9dec54c4b2b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TPZBL1rN3W_DBv0zidagvA.png"/></div></div></figure><p id="3fc0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以便通过使用所创建的训练数据集来训练LSTM模型。在这里，用批量大小来拟合训练模型，批量大小是表示单个批次的训练示例的数量，历元是另一个参数，这意味着训练模型中的迭代次数，如果历元值增加，那么您将获得模型输出的更高精度。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lj"><img src="../Images/c4c55df7e2f3ac995698dc3dd65f01af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DWMbvoKHxOCda6xZbJ0xjg.png"/></div></div></figure><h1 id="2780" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">测试</h1><p id="70d4" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">在这个测试阶段，测试创建的模型。在这里，我们将获得苹果公司第二天的股票收盘价，即2020年4月21日。(训练数据集值包含2009年1月1日到2020年4月20日之间的数据)。</p><p id="2067" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们必须创建一个空数组列表，并将过去60天的收盘价数据分配给它。将数组列表转换成<strong class="ih hj"> NumPy </strong>并再次整形数据。它将是模型的输入数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lk"><img src="../Images/a71bc775fb53fd7d00e330f2d24e066d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0NKv-hsRfoQQeB3c72PDVg.png"/></div></div></figure><p id="493d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">直接从雅虎财务页面获得股票在特定交易日的实际价格。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ll"><img src="../Images/3cc5b270914fb2ca8dcc583537689899.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*biDmrYXQfyvKPeO4Aw2Vwg.png"/></div></div></figure><h1 id="42b4" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">结果和讨论</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/d8d4d48de79046e2b4b1872be79de737.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CZFBgoxizwYCZpSfslgx0g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">预测股票价格与交易日</figcaption></figure><p id="b1eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上图显示的是对交易日股票价格的预测结果。在这里，验证和预测是一样的。得到训练模型的误差率被指定为均方根误差(RSME)为6.65%。它评估预测的准确性。</p><h1 id="9182" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">结论</h1><p id="9171" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">我们应该遵循以下策略来提高长短期记忆(LSTM)算法中模型的准确性。</p><ul class=""><li id="c04c" class="ln lo hi ih b ii ij im in iq lp iu lq iy lr jc ls lt lu lv bi translated">为训练和测试分配更多的时间序列数据(80%和20%)。这是获得更高精度结果的一个非常重要的策略。</li><li id="cb47" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">特征缩放和标准化数据，以将独立特征表示在固定范围内。在这里，我把所有的特征放在同一个尺度上。</li><li id="8911" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">在训练之前从给定的数据集中识别最重要的特征。这会增加模型的准确性。</li></ul><p id="3d7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望每个人都清楚地了解使用机器学习预测股票价格。在这里，我与你分享我的gits <a class="ae jt" href="https://github.com/SThenuja/ML" rel="noopener ugc nofollow" target="_blank">库</a>。</p></div></div>    
</body>
</html>