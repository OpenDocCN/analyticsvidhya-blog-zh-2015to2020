<html>
<head>
<title>Restoring Millions of Objects and Terabytes of Data from S3 Glacier using S3 Inventory and S3 Batch Operations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用S3库存和S3批处理操作从S3冰川恢复数百万个对象和万亿字节的数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/restoring-millions-of-objects-and-terabytes-of-data-from-s3-glacier-using-s3-inventory-and-s3-e966091e594d?source=collection_archive---------7-----------------------#2020-07-11">https://medium.com/analytics-vidhya/restoring-millions-of-objects-and-terabytes-of-data-from-s3-glacier-using-s3-inventory-and-s3-e966091e594d?source=collection_archive---------7-----------------------#2020-07-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d1b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从S3冰川和深层档案中恢复数据</p><p id="0c2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">亚马逊简单存储服务(亚马逊S3)是一种对象存储服务，提供行业领先的可扩展性、数据可用性、安全性和性能。S3提供多种经济高效的存储类别，以相应的速率支持不同的数据访问级别。</p><p id="595b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了节约成本，我们通常使用S3生命周期策略，随着时间的推移自动将对象从一个存储类别转移到另一个存储类别。我们可以使用S3冰川和深层档案来归档我们的对象，这些对象一年可能需要一次或两次。S3冰川是亚马逊S3的一个特殊存储类，提供极其廉价的存储。</p><p id="14f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的项目中，需要从冰川存储中检索一年前的数据。我们已经配置了生命周期策略，将数据转换为Glacier存储类别以进行数据归档。我们必须恢复的数据量大约为<strong class="ih hj"> 4.5TB </strong>，并且有<strong class="ih hj">35亿多个对象</strong>。恢复如此大量的数据对我们来说是一项挑战。</p><p id="97d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们花了大量时间寻找恢复如此大量数据的方法，最终我们找到了使用S3库存和S3批处理操作的解决方案。</p><p id="808d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要从S3冰川恢复数据，您应该有一个要恢复的对象列表，然后您可以针对每个对象启动恢复请求。我们使用S3选择来获取我们要恢复的对象列表，然后使用S3批处理操作来启动这些对象的恢复请求。</p><p id="4c58" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的S3文件夹结构</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="d1e6" class="jm jn hi ji b fi jo jp l jq jr">(S3 Bucket)<br/>     S3_folder/another_s3_folder/date=YYYYMMDD/some_folder/objects<br/>     S3_folder/another_s3_folder/date=YYYYMMDD/some_folder/objects<br/>     S3_folder/another_s3_folder/date=YYYYMMDD/some_folder/objects</span></pre><h1 id="cf1c" class="js jn hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated"><strong class="ak">配置S3库存</strong></h1><p id="bc01" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">我们必须在一个存储桶中配置S3库存，在这个存储桶中有我们的冰川对象，也就是我们的源存储桶。</p><ol class=""><li id="7236" class="ku kv hi ih b ii ij im in iq kw iu kx iy ky jc kz la lb lc bi translated">我们需要创建一个新的S3存储桶来存储库存输出，这将是我们的目标存储桶。新的S3存储区应该位于同一区域</li><li id="4cc6" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">转至源S3时段，单击管理，然后单击库存</li></ol><figure class="jd je jf jg fd lj er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es li"><img src="../Images/10be9144eabe1a5cb044000b4ff6bfeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*H1dUSPhLxS8JN8RY"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx translated">来源S3时段</figcaption></figure><p id="7c8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.点击添加新按钮</p><ul class=""><li id="f683" class="ku kv hi ih b ii ij im in iq kw iu kx iy ky jc lu la lb lc bi translated">输入库存名称</li><li id="00e4" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc lu la lb lc bi translated">在过滤器添加前缀，如果你想为任何特定的s3文件夹记录。您也可以在过滤器中使用部分文件夹名称。在我的例子中，我使用了s3文件夹/另一个S3文件夹/dt=YYYYMM。这将匹配给定前缀下的所有对象</li><li id="0630" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc lu la lb lc bi translated">对于目标存储桶，选择您在步骤1中创建的新s3存储桶</li><li id="3e11" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc lu la lb lc bi translated">您还可以选择为目标存储桶指定前缀</li><li id="f953" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc lu la lb lc bi translated">对于频率，选择您想要的频率</li></ul><blockquote class="lv lw lx"><p id="51d8" class="if ig ly ih b ii ij ik il im in io ip lz ir is it ma iv iw ix mb iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong> —在设置库存时保持加密为无，因为在S3批处理操作中不允许加密对象。我们将使用清单输出中的manifest.json文件作为批处理操作作业的输入</p></blockquote><p id="43d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将其余内容保留为默认值，然后单击save。保存库存后，它将在目标存储桶中创建一个S3存储桶策略。第一份报告可能需要48小时才能送达您的目的地。</p><p id="bbc0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.发布清单列表时，清单文件会发布到目标存储桶中的以下位置</p><ul class=""><li id="e910" class="ku kv hi ih b ii ij im in iq kw iu kx iy ky jc lu la lb lc bi translated">目的地前缀/源桶/配置ID/YYYY-MM-DDTHH-MMZ/manifest . JSON</li><li id="a442" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc lu la lb lc bi translated">目的地前缀/源桶/配置ID/YYYY-MM-DDTHH-MMZ/清单.校验和</li></ul><p id="8d61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ly">恭喜恭喜！您已成功配置S3库存。</em>T3】</strong></p><h1 id="e89b" class="js jn hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated"><strong class="ak">配置S3批量操作</strong></h1><ol class=""><li id="30c1" class="ku kv hi ih b ii kp im kq iq mc iu md iy me jc kz la lb lc bi translated">在亚马逊S3控制台的导航窗格中选择批处理操作</li></ol><figure class="jd je jf jg fd lj er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es mf"><img src="../Images/234051b68d1e2e1969c5768642b5429e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WBWfvr4ViyaSy-YX"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx translated">S3控制台批量操作</figcaption></figure><p id="de0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.点击创建工单</p><ul class=""><li id="bf17" class="ku kv hi ih b ii ij im in iq kw iu kx iy ky jc lu la lb lc bi translated">选择您要创建工作的地区</li><li id="46ca" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc lu la lb lc bi translated">在Manifest下，输入作为S3库存的一部分接收的manifest.json文件的路径(路径:—destination-prefix/source-bucket/config-ID/YYYY-MM-DDTHH-MMZ/Manifest . JSON)</li></ul><figure class="jd je jf jg fd lj er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es mg"><img src="../Images/b5bc2500924754d8ff2276270be62750.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XMX9skUj713L8d3aVZP3aQ.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx translated">S3批处理操作manifeat.json文件</figcaption></figure><ul class=""><li id="83f7" class="ku kv hi ih b ii ij im in iq kw iu kx iy ky jc lu la lb lc bi translated">单击下一步，并在操作下选择恢复。输入您希望对象的临时副本保持可用的天数，选择您的检索层，然后单击“next”</li></ul><figure class="jd je jf jg fd lj er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es mh"><img src="../Images/dd2e7484c3059be1d40bd6ee148198a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bjKCeTR8ZewOAO-3"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx translated">S3批处理操作还原作业</figcaption></figure><ul class=""><li id="0452" class="ku kv hi ih b ii ij im in iq kw iu kx iy ky jc lu la lb lc bi translated">单击下一步，并在完成报告下选择您要获取作业报告的路径。在我的例子中，我只选择了一个库存时段。当您恢复如此大量的数据时，完成报告非常有用。它将为启动恢复请求的所有对象项生成一个CSV文件</li></ul><figure class="jd je jf jg fd lj er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es mi"><img src="../Images/eea76ba55f1b8a6f3f1bd163a74dcca3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XgJFIM44bcnifcvx"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx translated">S3批处理作业完成报告</figcaption></figure><ul class=""><li id="fb10" class="ku kv hi ih b ii ij im in iq kw iu kx iy ky jc lu la lb lc bi translated">您应该有一个IAM角色，该角色可以由S3批处理操作承担。选择您的IAM角色，然后单击下一步</li></ul><figure class="jd je jf jg fd lj er es paragraph-image"><div class="er es mj"><img src="../Images/ba36b3ddd18cf95ce3e0fa8ebba04b1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*u6pMnJH3aiszSO8sNpV7rQ.png"/></div><figcaption class="lq lr et er es ls lt bd b be z dx translated">IAM角色S3批处理作业</figcaption></figure><ul class=""><li id="24eb" class="ku kv hi ih b ii ij im in iq kw iu kx iy ky jc lu la lb lc bi translated">检查您的配置，然后单击创建作业</li></ul><p id="4b80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦您创建了一个作业，它将处于准备状态，此时它将识别您的manifest.json文件中的对象数量，一旦它准备就绪，您将能够看到它。</p><p id="5ec7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此后，作业状态将变为等待您的确认，这基本上意味着您必须查看作业详细信息，并确认您想要在批处理操作可以开始处理它之前运行它。检查您的配置并运行作业。要运行作业，您必须选择作业，然后选择确认并运行。在您确认之前，作业不会运行。</p><p id="5c36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ly">恭喜恭喜！</em> </strong>您已经成功配置了S3选择和S3批处理操作，以启动从S3冰川恢复您的对象。</p><p id="df9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ly">谢谢！</em>T13】</strong></p><h1 id="f1a7" class="js jn hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">参考</h1><ul class=""><li id="9cb1" class="ku kv hi ih b ii kp im kq iq mc iu md iy me jc lu la lb lc bi translated"><a class="ae mk" href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/configure-inventory.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/Amazon S3/latest/user-guide/configure-inventory . html</a></li><li id="1989" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc lu la lb lc bi translated"><a class="ae mk" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/storage-inventory.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/Amazon S3/latest/dev/storage-inventory . html</a></li><li id="7339" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc lu la lb lc bi translated"><a class="ae mk" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/batch-ops-basics.html#specify-batchjob-manifest" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/Amazon S3/latest/dev/batch-ops-basics . html # specify-batch job-manifest</a></li><li id="4f65" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc lu la lb lc bi translated"><a class="ae mk" href="https://aws.amazon.com/premiumsupport/knowledge-center/s3-batch-operation-initiate-restore/" rel="noopener ugc nofollow" target="_blank">https://AWS . Amazon . com/premium support/knowledge-center/S3-batch-operation-initiate-restore/</a></li><li id="369e" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc lu la lb lc bi translated"><a class="ae mk" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/batch-ops-create-job.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/Amazon S3/latest/dev/batch-ops-create-job . html</a></li><li id="5d14" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc lu la lb lc bi translated"><a class="ae mk" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/batch-ops-initiate-restore-object.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/Amazon S3/latest/dev/batch-ops-initiate-restore-object . html</a></li></ul></div></div>    
</body>
</html>