<html>
<head>
<title>Part1: Python Web Apps made easy — Python-CGI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第1部分:让Python Web应用变得简单——Python-CGI</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/python-web-apps-made-easy-python-cgi-5dd013964f2d?source=collection_archive---------14-----------------------#2020-03-26">https://medium.com/analytics-vidhya/python-web-apps-made-easy-python-cgi-5dd013964f2d?source=collection_archive---------14-----------------------#2020-03-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="71a8" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">Python是什么？</h1><p id="013c" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">根据维基百科，</p><blockquote class="kb kc kd"><p id="33a7" class="jd je ke jf b jg kf ji jj jk kg jm jn kh ki jq jr kj kk ju jv kl km jy jz ka hb bi translated">" Python是一种解释型高级通用编程语言."</p></blockquote><p id="ad9e" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated"><strong class="jf hj">解释性语言..？</strong></p><p id="de46" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">那些在执行前<strong class="jf hj">没有</strong>转换成机器(或计算机可读)代码，但<em class="ke">在运行时</em>被转换的语言。因此转换只在运行时逐行进行。</p><p id="04f0" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated"><strong class="jf hj">高水平..？</strong></p><p id="440b" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">对计算机细节进行高度抽象的语言。如需进一步阅读，请点击此处-&gt;(<a class="ae kn" href="https://en.wikipedia.org/wiki/High-level_programming_language" rel="noopener ugc nofollow" target="_blank">https://en . Wikipedia . org/wiki/High-level _ programming _ language</a>)。</p><p id="22dc" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated"><strong class="jf hj">一般用途..？</strong></p><p id="70fd" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">通用语言是一种计算机语言，可广泛应用于各种应用领域，但缺乏特定领域的专门功能。</p><p id="48a5" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated"><strong class="jf hj">什么是Python-CGI？</strong></p><p id="0782" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">就去这里-&gt;(<a class="ae kn" href="https://docs.python.org/3.6/library/cgi.html?highlight=cgi#module-cgi" rel="noopener ugc nofollow" target="_blank">https://docs.python.org/3.6/library/cgi.html</a>)</p><p id="630b" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">而这里-&gt; <a class="ae kn" href="https://www.thoughtco.com/what-is-python-2813564" rel="noopener ugc nofollow" target="_blank">为什么是python？</a></p></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><p id="81d8" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">让我们现在跳到有趣的东西..弄脏我们的手！</p><p id="4a5f" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">第一步…设置好所有需要的东西。</p><ol class=""><li id="2186" class="kv kw hi jf b jg kf jk kg jo kx js ky jw kz ka la lb lc ld bi translated">Python3(我用的是python 3.6.3)</li><li id="20a6" class="kv kw hi jf b jg le jk lf jo lg js lh jw li ka la lb lc ld bi translated">RHEL7/ CentOS7(或任何其他操作系统，如果你知道你在做什么的话)</li><li id="5c13" class="kv kw hi jf b jg le jk lf jo lg js lh jw li ka la lb lc ld bi translated">web服务器(我使用的是httpd 2.4)</li></ol><p id="c514" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">一旦你设置好所有需要的东西……在你的终端上输入这个启动你的网络服务器。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="144f" class="ls ig hi lo b fi lt lu l lv lw">$ sudo systemctl start httpd</span></pre><p id="e7f7" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">现在你的web服务器已经启动并运行了…不信？你自己检查一下。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="7ecb" class="ls ig hi lo b fi lt lu l lv lw">$ sudo systemctl status httpd</span></pre><p id="d306" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated"><em class="ke">现在让我们跳到编码部分……</em></p><p id="74bf" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">首先让我们试着构建一个简单的静态HTML站点。</p><ol class=""><li id="0426" class="kv kw hi jf b jg kf jk kg jo kx js ky jw kz ka la lb lc ld bi translated">请转到/var/www/html/</li><li id="3b1d" class="kv kw hi jf b jg le jk lf jo lg js lh jw li ka la lb lc ld bi translated">创建一个HTML文件。</li><li id="d473" class="kv kw hi jf b jg le jk lf jo lg js lh jw li ka la lb lc ld bi translated">把下面的代码粘贴进去。</li></ol><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="08a9" class="ls ig hi lo b fi lt lu l lv lw">&lt;html&gt;<br/>&lt;head&gt; <br/>&lt;title&gt; punchingbag &lt;/title&gt; <br/>&lt;/head&gt; <br/>&lt;body&gt; <br/>This is My Web Page.  &lt;!-- this is comment --&gt;<br/>&lt;/body&gt; <br/>&lt;/html&gt;</span></pre><p id="db8a" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">4.在浏览器上查看网页。→ (http:// <ip_of_linux_machine> /index.html)</ip_of_linux_machine></p><p id="9c51" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">5.(*可选)如果您没有看到任何页面，请尝试为您的工作环境停止防火墙和SELinux策略(在RHEL7/CentOS7上)。这两个为我们的系统提供了额外的安全性，通过禁用它们，我们的系统变得容易受到攻击。</p><p id="b38c" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">要停止防火墙，请键入-&gt;</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="80bd" class="ls ig hi lo b fi lt lu l lv lw">$ sudo systemctl stop firewalld</span></pre><p id="31f8" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">要停止selinux，请键入-&gt;</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="74a3" class="ls ig hi lo b fi lt lu l lv lw">$ sudo setenforce 0</span></pre></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><p id="6e21" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">现在我们已经托管了你的第一个静态网站。现在是CGI脚本的时候了。</p><ol class=""><li id="cb1a" class="kv kw hi jf b jg kf jk kg jo kx js ky jw kz ka la lb lc ld bi translated">请访问/var/www/cgi-bin/</li><li id="d923" class="kv kw hi jf b jg le jk lf jo lg js lh jw li ka la lb lc ld bi translated">创建一个python文件。</li><li id="92c7" class="kv kw hi jf b jg le jk lf jo lg js lh jw li ka la lb lc ld bi translated">复制代码。</li></ol><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="aa8b" class="ls ig hi lo b fi lt lu l lv lw">#!/bin/python36<br/>print(“hello”)</span></pre><p id="8cfe" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">如果你不知道这里的第一行，读读这个。</p><p id="e6be" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">4.现在改变文件的模式，给你的文件添加可执行位权限。(简单来说就是给文件可执行权限)。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="38a3" class="ls ig hi lo b fi lt lu l lv lw">$ sudo chmod +x filename.py</span></pre><p id="3a7b" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">5.在终端中运行代码。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="94b8" class="ls ig hi lo b fi lt lu l lv lw">$ ./filename.py</span></pre><p id="831f" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">6.现在，为了让这段代码在浏览器上运行，你需要像转换一个HTTP响应一样转换这个输出。(否则，您会得到一个内部服务器错误)</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="e674" class="ls ig hi lo b fi lt lu l lv lw"> &lt;status-line&gt;<br/> &lt;general-headers&gt;<br/> &lt;response-headers&gt;<br/> &lt;entity-headers&gt;<br/> &lt;empty-line&gt;<br/> [&lt;message-body&gt;]<br/> [&lt;message-trailers&gt;]</span></pre><p id="28e7" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">7.至少我们需要在代码中添加实体头，其余的将由web服务器和客户端浏览器处理。</p><p id="3428" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">为此，请更改代码。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="04a5" class="ls ig hi lo b fi lt lu l lv lw">#!/bin/python36</span><span id="9c49" class="ls ig hi lo b fi lx lu l lv lw">print(“content-type: text/html”) #This is a entity header<br/>print() # This is empty line<br/>print(“hello”) # This is message body</span></pre><p id="b468" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">8.按照步骤5在终端中运行代码。您应该得到如下所示的输出。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="cd1b" class="ls ig hi lo b fi lt lu l lv lw">content-type: text/html</span><span id="4757" class="ls ig hi lo b fi lx lu l lv lw">hello</span></pre><p id="7485" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">现在，这看起来像是一个HTTP响应，可以被web浏览器正确理解。</p><p id="579f" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">9.该浏览这个了→( http://<ip_of_linux_machine>/CGI-bin/filename . py)</ip_of_linux_machine></p><p id="49eb" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">10.现在，通过对字符串应用一些html标签来处理消息正文。</p></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><p id="523c" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">现在，让我们来做一个Web应用程序，它可以输入一个IP地址，并从我们的系统中显示该IP的ping状态。</p><p id="280c" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">我的看起来像这样…</p><figure class="lj lk ll lm fd lz er es paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="er es ly"><img src="../Images/281c4529e1a9e5675b06feeb54b8e8d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3nDlLgaBX8WIGzZAHZXd3A.png"/></div></div></figure><p id="4f11" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">[代码]</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="769d" class="ls ig hi lo b fi lt lu l lv lw">#!/bin/python36</span><span id="3a2f" class="ls ig hi lo b fi lx lu l lv lw">## HEADERS<br/>print(“content-type: text/html”)<br/>print()</span><span id="8c8b" class="ls ig hi lo b fi lx lu l lv lw">## HTML<br/>html = '''&lt;html&gt;&lt;head&gt;&lt;title&gt; punchingBag &lt;/title&gt;&lt;/head&gt;&lt;body&gt; {body} &lt;/body&gt;&lt;/html&gt;'''<br/>body = '''&lt;h1&gt; This is Punching bag &lt;/h1&gt;&lt;br&gt;&lt;hr&gt;&lt;br&gt;&lt;center&gt; {form} &lt;/center&gt;&lt;div&gt; {output} &lt;/div&gt;'''</span><span id="39e3" class="ls ig hi lo b fi lx lu l lv lw">form = '''<br/> &lt;form&gt;<br/> Input IP to check: &lt;input type=”text” name=”target_ip” &gt; &lt;/input&gt;<br/> &lt;input type=”submit” value=”CHECK!” &gt; &lt;/input&gt;<br/> &lt;/form&gt;<br/> &lt;br&gt;<br/> '''</span><span id="ebd5" class="ls ig hi lo b fi lx lu l lv lw">output = '''<br/> &lt;hr&gt;&lt;br&gt;<br/> Status for [{target_ip}]: &lt;br&gt;&lt;br&gt;<br/> {cmd_status}<br/> &lt;hr&gt;&lt;br&gt;<br/> '''</span><span id="b666" class="ls ig hi lo b fi lx lu l lv lw">## LOGIC CODE<br/>import subprocess as sb<br/>import cgi</span><span id="fc06" class="ls ig hi lo b fi lx lu l lv lw">data = cgi.FieldStorage() # read the field Storage or mini field storage for the cgi script</span><span id="b891" class="ls ig hi lo b fi lx lu l lv lw">if data.getvalue("target_ip"):<br/> data_target_ip = data.getvalue("target_ip")<br/>else:<br/> data_target_ip = "8.8.8.8" # default set to google DNS 8.8.8.8</span><span id="72b6" class="ls ig hi lo b fi lx lu l lv lw">cmd_status = sb.getoutput("sudo ping -c 3 "+data_target_ip)<br/>cmd_status = cmd_status.replace("\n","&lt;br&gt;")</span><span id="921b" class="ls ig hi lo b fi lx lu l lv lw">## PRINT HTML<br/>print(html.format(<br/>         body=body.format(<br/>             form=form,<br/>             output = output.format(<br/>                 target_ip=data_target_ip, cmd_status=cmd_status) ))</span></pre><p id="49dd" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">如果你不知道python中的子进程库，那么阅读<a class="ae kn" href="https://docs.python.org/3/library/subprocess.html" rel="noopener ugc nofollow" target="_blank">这个</a>。(<em class="ke">如果看起来要读很多，只需搜索subprocess.getoutput() </em>)。</p><p id="f7a9" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">您需要在/etc/sudoers文件中添加一行，因为您正在使用<em class="ke">sudo</em>ping目标ip。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="a11a" class="ls ig hi lo b fi lt lu l lv lw">apache ALL=(ALL) NOPASSWD: ALL</span></pre><p id="cef8" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated"><a class="ae kn" href="https://linux.die.net/man/5/sudoers" rel="noopener ugc nofollow" target="_blank">(默认sudo安全策略模块</a>)</p><p id="a178" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">这个web应用程序仍然存在很多问题，不适合在现实世界中部署。</p><p id="a329" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">你可以从<a class="ae kn" href="https://www.hacksplaining.com/" rel="noopener ugc nofollow" target="_blank">这里</a>继续了解不同的web应用漏洞。</p></div></div>    
</body>
</html>