<html>
<head>
<title>Deploying ML model to GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将ML模型部署到GCP</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploying-ml-model-to-gcp-a3bc52c75e6a?source=collection_archive---------11-----------------------#2019-12-15">https://medium.com/analytics-vidhya/deploying-ml-model-to-gcp-a3bc52c75e6a?source=collection_archive---------11-----------------------#2019-12-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ec70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">传统的ml模型部署是使用Flask完成的，但谷歌的AI平台使它更加容易。</p><h1 id="e535" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">创建云项目</h1><p id="e48e" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">首先，在Google云平台上创建项目并启用计费。如果您不熟悉谷歌云平台，请点击以下两个链接，否则请跳到下一部分</p><p id="0cc6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kg" href="https://cloud.google.com/resource-manager/docs/creating-managing-projects" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/resource-manager/docs/creating-managing-projects</a></p><p id="a1a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">https://cloud.google.com/billing/docs/how-to/modify-project<a class="ae kg" href="https://cloud.google.com/billing/docs/how-to/modify-project" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><h1 id="10ed" class="jd je hi bd jf jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka bi translated">设置人工智能平台</h1><p id="7547" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">接下来，在您的项目中，转到——产品——人工智能平台——模型。在这里，我们将部署我们的模型</p><p id="15cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">选择创建模型-为模型命名，并选择您选择的区域</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es kt"><img src="../Images/6960ffa672a3995ddb5536eab8e1ee65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oOg5FVD1DVd3w-DqRGiNCg.png"/></div></div></figure><p id="0bae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">选择运行时间等的默认值和最新值。每个模型都需要存储在云桶中。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lf"><img src="../Images/12273c89c7af777a0aac50ab656b559a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YihiEacK51xgPslHHoG2PA.png"/></div></div></figure><p id="b937" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，创建新的铲斗，为了最大限度地降低成本，我使用单一位置、标准和有限控制。选择一个名字。此名称是调用预测API所必需的</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lg"><img src="../Images/98b4db681a0b8e7de9a5f093676256bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MQkk04yyhCduZXnQgBd7xA.png"/></div></div></figure><p id="6fa5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">去你的桶—【https://console.cloud.google.com/storage】T4上传model.pkl或者model.joblib文件(Google API只找这两个名字，其他名字无效)</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lh"><img src="../Images/5d3e3aaf709e7c366f58fe1023f3dc2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EkypJEVjyBt41kMo9yI8zQ.png"/></div></div></figure><h1 id="c6f9" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">测试您的模型</h1><p id="ab8b" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">点击您的模型，使用“测试和使用”下的样本json结构</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es li"><img src="../Images/fef9482439bfbc32e76f952fc4046c37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qoMhGNI08JRHHpvhgVSVJA.png"/></div></div></figure></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><h1 id="3b02" class="jd je hi bd jf jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka bi translated">创建访问凭据</h1><p id="801c" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">差不多完成了，创建访问凭证以使用预测API。这里，我已经创建了凭证文件，还有其他可能的方法。</p><p id="9e56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到<a class="ae kg" href="https://console.cloud.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com/apis/credentials</a>，创建一个新的服务帐户密钥，并将密钥保存为json文件</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lj"><img src="../Images/d08f1bd32b881bba6959d4d070af6f3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3EgAmgDbK_HhvtnqJ4QZig.png"/></div></div></figure></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><h1 id="6c46" class="jd je hi bd jf jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka bi translated">使用云模型进行预测</h1><p id="d5d5" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">我正在使用谷歌客户端python apis访问部署在GCP的模型，并获得无服务器的预测结果—<a class="ae kg" href="https://gist.github.com/anmolmore/e8aac6967cc66190a4d1991ac914a8de" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/anmolmore/e 8 AAC 6967 cc 66190 a4 d 1991 AC 914 A8 de</a></p><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="f147" class="lp je hi ll b fi lq lr l ls lt">import googleapiclient.discovery</span><span id="ae29" class="lp je hi ll b fi lu lr l ls lt">project = ‘iris-dataset-project’<br/>model = ‘iris_classification_model’</span><span id="8f2a" class="lp je hi ll b fi lu lr l ls lt">os.environ[‘GOOGLE_APPLICATION_CREDENTIALS’] = ‘iris-dataset-project-65397816041d.json’<br/>service = googleapiclient.discovery.build(‘ml’, ‘v1’)<br/>name = ‘projects/{}/models/{}’.format(project, model)</span><span id="3899" class="lp je hi ll b fi lu lr l ls lt">data = [[7.7, 2.6, 6.9, 2.3]] <br/>response = service.projects().predict(<br/> name=name,<br/> body={‘instances’: data}<br/>).execute()</span><span id="006c" class="lp je hi ll b fi lu lr l ls lt">if ‘error’ in response:<br/> raise RuntimeError(response[‘error’])</span><span id="7d5a" class="lp je hi ll b fi lu lr l ls lt">print(int(response[‘predictions’][0]))</span></pre></div></div>    
</body>
</html>