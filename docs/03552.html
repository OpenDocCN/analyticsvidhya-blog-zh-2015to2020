<html>
<head>
<title>Quick and simple text classification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快速简单的文本分类</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/quick-and-simple-text-classification-aeaf9f301068?source=collection_archive---------6-----------------------#2020-02-07">https://medium.com/analytics-vidhya/quick-and-simple-text-classification-aeaf9f301068?source=collection_archive---------6-----------------------#2020-02-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="66a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">TL；DR:我向你展示如何在5分钟内编写文本分类程序。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/f67bacddecb2b67c7f0f766303c27acb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*goGVUPOX9kyJCfftX4GqmA.png"/></div></div></figure><p id="1e39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">文本分类很难。有很多方法可以做到这一点。</p><p id="a514" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但有时我们需要尽可能快地把事情做完。</p><p id="01a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">数据集</strong></p><p id="3962" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将处理这个新闻数据集:https://archive.ics.uci.edu/ml/datasets/News+Aggregator#<a class="ae jp" href="https://archive.ics.uci.edu/ml/datasets/News+Aggregator#" rel="noopener ugc nofollow" target="_blank"/></p><p id="9134" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据分为4类—商业、技术、娱乐和健康。</p><p id="4320" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们开始吧。</p><p id="9fbc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们需要导入库。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="589d" class="jv jw hi jr b fi jx jy l jz ka">import pandas as pd<br/>import numpy as np<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>%matplotlib inline<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.linear_model import LogisticRegression<br/>from sklearn.feature_extraction.text import TfidfVectorizer, CountVectorizer<br/>from sklearn.metrics import accuracy_score, confusion_matrix<br/>from sklearn.pipeline import Pipeline<br/>import nltk<br/>from nltk.corpus import stopwords<br/>stop_words = set(stopwords.words(‘english’))<br/>from nltk.stem import SnowballStemmer<br/>from nltk.tokenize import wordpunct_tokenize, word_tokenize<br/>import string</span></pre><p id="d2fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和读取数据集</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="35a2" class="jv jw hi jr b fi jx jy l jz ka">data = pd.read_csv(‘data/newsCorpora.csv’, header=None, sep=’\t’)<br/>data.head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kb"><img src="../Images/44f58df27c115158702aac812edda64b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BMoqSMZB14U0V9QxTv4jdg.png"/></div></div></figure><p id="6156" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了方便起见，我们设置了列名:</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="a4a5" class="jv jw hi jr b fi jx jy l jz ka">data.columns = [‘id’, ‘title’, ‘url’, ‘publisher’, ‘category’, ‘story’, ‘hostname’, ‘timestamp’]</span></pre><p id="a046" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，我们准备检查数据了。</p><p id="2457" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将根据新闻标题来预测类别。这就是为什么我们需要观察领域<em class="kc">类别</em>。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="04be" class="jv jw hi jr b fi jx jy l jz ka">data[‘category’].value_counts()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kb"><img src="../Images/8bd9ac0611acf3f04907669e8b1ad96b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GL2SdJDlPLCg27oYT8BvHA.png"/></div></div></figure><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="23b8" class="jv jw hi jr b fi jx jy l jz ka">fig, ax = plt.subplots(figsize=(8, 4))<br/>plt.hist(data[‘category’])<br/>plt.title(‘Count of each category’)<br/>plt.xlabel(‘Category’)<br/>plt.ylabel(‘Count’)<br/>plt.show()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kb"><img src="../Images/02282f0ac1c512ccc56197be308ed77f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nNrT2TYfomfecq64XGmY3g.png"/></div></div></figure><p id="b685" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们看到有一点阶级不平衡，但现在，这不是问题。</p><p id="4c87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个机器学习模型都不接受原始文本。所以我们要把文本转换成向量。</p><p id="2c9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。一袋文字</strong></p><p id="30c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">单词包是将文本表示为单词包(集合)而不考虑顺序的模型。在这个模型中，文档中每个单词的频率ф是机器学习模型的一个特征。另一种方法是使用tf-idf(术语频率-逆文档频率)技术对单词相对重要性进行评分。</p><p id="0e42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">TF被定义为单词在文档中出现的次数与文档中单词总数的比率。</p><p id="5a50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">IDF定义为文档数与文档数之比的对数，包含单词。</p><p id="bee6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更多详情请见<a class="ae jp" href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Tf–idf</a></p><p id="990f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，将相同的单词用不同的后缀表示成一种形式也是一种很好的做法。例如，假设我们有单词<em class="kc"> tree </em>和<em class="kc"> trees，</em>，我们希望这些单词表示相同的<em class="kc">。</em></p><p id="4e6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们将使用词干。这是一个切断后缀的过程。</p><p id="48a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Nltk图书馆有我们所需要的一切。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="5eed" class="jv jw hi jr b fi jx jy l jz ka">stemmer = SnowballStemmer(language=’english’)</span></pre><p id="e216" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，有些词几乎可以出现在每个文档中。因此，它们不会帮助我们按类别区分文档。这些词被称为停用词。在大多数情况下，我们在<em class="kc"> nltk </em>中有一组这样的单词。但是有时候，加入我们自己的也是好的。出于我们的目的，我们不会那样做。</p><p id="923a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，我们将从文本中删除标点符号。</p><p id="9de7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们来定义一下clean函数。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="c05f" class="jv jw hi jr b fi jx jy l jz ka">def clean_text(text):<br/> text = str(text).lower()<br/> tokens = [stemmer.stem(word) for word in wordpunct_tokenize(text) if word not in list(stop_words) + list(string.punctuation)]<br/> text = “ “.join(tokens)<br/> return text</span></pre><p id="2088" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看结果:</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="5a6e" class="jv jw hi jr b fi jx jy l jz ka">data[‘title’].iloc[0]</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kd"><img src="../Images/a9a19de39cc673bebca0ca93082759a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BMzxvowHyE5Y6iQ6KcBeuQ.png"/></div></div></figure><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="eedc" class="jv jw hi jr b fi jx jy l jz ka">clean_text(data[‘title’].iloc[0])</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kd"><img src="../Images/73a7ea53baae6e1a1e3e20053aed51c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B08UvYC2EVHb8OP08NdKvQ.png"/></div></div></figure><p id="1dba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将函数应用于所有数据集</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="e31b" class="jv jw hi jr b fi jx jy l jz ka">data[‘clean_title’] = data[‘title’].apply(clean_text)</span></pre><p id="0d99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们需要将数据分为训练数据集和测试数据集:</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="cb25" class="jv jw hi jr b fi jx jy l jz ka">X_train, X_test, y_train, y_test = train_test_split(data[‘clean_title’], data[‘category’], test_size=0.33, random_state=42)</span></pre><p id="b59c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">定义矢量器</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="db96" class="jv jw hi jr b fi jx jy l jz ka">vectorizer = TfidfVectorizer(ngram_range=(1,2))</span></pre><p id="8116" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们需要让它适合我们的训练数据，然后继续测试数据。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="5f0a" class="jv jw hi jr b fi jx jy l jz ka">vector_train = vectorizer.fit_transform(X_train)</span><span id="1cea" class="jv jw hi jr b fi ke jy l jz ka">vector_test = vectorizer.transform(X_test)</span></pre><p id="839e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们准备创建一个模型。在本教程中，我们将使用逻辑回归。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="7ca5" class="jv jw hi jr b fi jx jy l jz ka">model = LogisticRegression()<br/>model.fit(vector_train, y_train)</span></pre><p id="b530" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了了解它是如何工作的，我们使用准确性指标:</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="0164" class="jv jw hi jr b fi jx jy l jz ka">accuracy_score(y_test, model.predict(vector_test))</span><span id="49eb" class="jv jw hi jr b fi ke jy l jz ka">0.9444759288086715</span></pre><p id="fe2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为基线，还不错。</p><p id="b2b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，由于我们有两个以上的类，我们需要了解模型在所有类上的表现。为此，我们使用混淆矩阵。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="c06e" class="jv jw hi jr b fi jx jy l jz ka">conf_matrix = confusion_matrix(y_test, model.predict(vector_test))</span></pre><p id="deff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并展示出来</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="6fc5" class="jv jw hi jr b fi jx jy l jz ka">fig, ax = plt.subplots(figsize=(8, 6))<br/>df_cm = pd.DataFrame(conf_matrix, index=model.classes_, columns=model.classes_)<br/>sns.heatmap(df_cm,annot=True, fmt=”d”, ax=ax)<br/>plt.ylabel(‘True label’)<br/>plt.xlabel(‘Predicted label’)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kf"><img src="../Images/5a4ab7ec2a737bd3387a393019eb7786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uGarGBZsp5BuWqShN2oIWA.png"/></div></div></figure><p id="88da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我们所见，在大多数情况下，它表现良好。</p><p id="a234" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为最后一步，我们可以在管道中结合向量化和训练模型。在sklearn中，我们为此提供了类管道。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="2fd7" class="jv jw hi jr b fi jx jy l jz ka">pipeline = Pipeline(steps=[(‘vectorizer’, TfidfVectorizer(ngram_range=(1,2))), (‘clf’, LogisticRegression())])</span></pre><p id="1498" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了训练，我们只是适应它。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="8423" class="jv jw hi jr b fi jx jy l jz ka">pipeline.fit(X_train, y_train)</span></pre><p id="bbd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看看结果</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="e354" class="jv jw hi jr b fi jx jy l jz ka">accuracy_score(y_test, pipeline.predict(X_test))</span><span id="b7de" class="jv jw hi jr b fi ke jy l jz ka">0.9444759288086715</span></pre><p id="dad1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成了。现在，我们有了一个有效的文本分类模型。</p></div></div>    
</body>
</html>