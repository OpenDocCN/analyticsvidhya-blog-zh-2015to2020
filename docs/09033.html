<html>
<head>
<title>Obtaining sports data from an API using Python requests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python请求从API获取体育数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/obtaining-sports-data-from-an-api-using-python-requests-7cd6ec89c821?source=collection_archive---------7-----------------------#2020-08-23">https://medium.com/analytics-vidhya/obtaining-sports-data-from-an-api-using-python-requests-7cd6ec89c821?source=collection_archive---------7-----------------------#2020-08-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/063b5677380ab4108a319e2836d5c728.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JwR-rjpsbJo1Cysi"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">埃米利奥·加西亚在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="cd82" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">作为一名数据科学家，通过API获取数据的能力是一项关键技能。在这篇文章中，我提供了一个关于从<a class="ae iu" href="https://www.api-football.com/" rel="noopener ugc nofollow" target="_blank"> API-FOOTBALL </a>获取足球数据的简短教程，这是一个由<a class="ae iu" href="https://rapidapi.com/" rel="noopener ugc nofollow" target="_blank"> RapidAPI </a> marketplace托管的RESTful API。本教程遵循我在熨斗学校数据科学训练营期间完成的第四个项目中使用的一般方法，在该项目中，我探索了几种使用游戏中的统计数据来确定英格兰超级联赛比赛结果的ML算法。我不会在这篇文章中讨论项目的发现，但是可以在这里查看资源库<a class="ae iu" href="https://github.com/douglaspsteen/Predict_EPL_Matches" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="41e1" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">第一步:创建一个RapidAPI帐户并订阅API-FOOTBALL</h1><p id="2e52" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">一旦您创建了一个帐户并订阅，您将能够访问您的API密钥，您将需要它来调用API。</p><h1 id="0296" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">步骤2:导入在Python中工作所需的包</h1><p id="f8d3" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">对于本教程，我们需要导入<strong class="ix hj">请求</strong>、<strong class="ix hj"> json </strong>和<strong class="ix hj"> pandas </strong>库。</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="1069" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://requests.readthedocs.io/en/master/" rel="noopener ugc nofollow" target="_blank"> Requests </a>是一个帮助用Python发出http请求的库。JSON是一个便于使用JSON数据的模块(从我们的API调用返回的数据将在Json中)。当然,<a class="ae iu" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">熊猫</a>将帮助我们展示和操作数据。</p><h1 id="e2d4" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">步骤3:将您的API密钥存储在一个私有文件夹中</h1><p id="2d0b" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">请记住，您永远不要硬编码您的API键/令牌，因为如果您在GitHub或其他地方公开您的项目，任何人都可以看到和使用它们。</p><p id="ea6d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是我存储/使用API密钥和令牌的首选方法:我选择将我的个人API密钥存储在一个名为'的文件夹中。我的c盘上的个人用户文件夹中的“秘密”。如果采用这种方式，该文件夹的文件路径将如下所示:</p><p id="642d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">"/Users/{您的用户名}/。秘密/" </strong></p><p id="adc5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用您最喜欢的文本编辑器，您可以创建一个. json文件(我将我的文件命名为“api_football.json”)，其中包含一个字典，该字典具有一个表示api键的键-值对:</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="0b9e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">那里！现在，您的API密钥将位于以下文件路径中:</p><p id="5a4e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">"/Users/{您的用户名}/。secret/api_football.json" </strong></p><p id="60c7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">并且您实际的API键不需要出现在项目代码中的任何地方！如果您正在访问的特定API需要更多的键/令牌，您可以简单地在JSON文件的字典中添加更多的键值对！</p><h1 id="a004" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">步骤4:从本地文件夹中检索您的API密钥</h1><p id="6612" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">为了更简单，让我们定义一个可以在python中使用的快捷函数:</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="8ed1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个函数将简单地返回包含我们的API键的JSON文件的内容。</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="0ad4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们已经将密钥保存在变量<strong class="ix hj"> api_key </strong>中了！</p><h1 id="a28e" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">步骤5:确定您需要哪个端点URL，并发出一个“GET”请求</h1><p id="b67d" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">弄清楚使用哪个端点意味着您首先需要弄清楚您希望看到哪种数据。对于大多数API来说，这意味着您必须回顾API文档本身。</p><p id="ece1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，假设我想返回英超联赛的所有赛季。API-Football的文档说正确的端点URL是:</p><p id="5559" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://api-football-v1.p.rapidapi.com/v2/leagues/seasonsAvailable/%7Bleague_id%7D" rel="noopener ugc nofollow" target="_blank">https://API-football-v1 . p . rapidapi . com/v2/league s/seasons available/{ league _ id }</a></p><p id="5250" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以，现在我们只需要英超联赛的‘League _ id’。深入挖掘一下文档，看起来我们可以使用“524”作为英超联赛的“联赛id”。</p><p id="5ccc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们可以发出“GET”请求了。使用请求模块，可以按如下方式完成:</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="00cb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要检查我们的请求是否成功，我们可以执行以下操作:</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="0c83" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果一切顺利，对上述代码行的响应应该是“True”。</p><p id="c0fd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要检查响应中的原始数据，只需使用:</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="fc9b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是输出结果:</p><p id="d381" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">{“api”:{“results”:10,”leagues”:[{“league_id”:701,”name”:”Premier League”,”type”:”League”,”country”:”England”,”country_code”:”GB”,”season”:2010,”season_start”:”2010–08–14",”season_end”:”2011–05–17",”logo”:”https:\/\/media.api-football.com\/leagues\/56.png”,”flag”:”https:\/\/media.api-football.com\/flags\/gb.svg”,”standings”:1,”is_current”:0,”coverage”:{“standings”:true,”fixtures”:{“events”:true,”lineups”:true,”statistics”:false,”players_statistics”:false},”players”:true,”topScorers”:true,”predictions”:true,”odds”:false}},{“league_id”:700,”name”:”Premier League”,”type”:”League”,”country”:”England”,”country_code”:”GB”,”season”:2011,”season_start”:”2011–08–13",”season_end”:”2012–05–13",”logo”:”https:\/\/media.api-football.com\/leagues\/56.png”,”flag”:”https:\/\/media.api-football.com\/flags\/gb.svg”,”standings”:1,”is_current”:0,”coverage”:{“standings”:true,”fixtures”:{“events”:true,”lineups”:true,”statistics”:false,”players_statistics”:false},”players”:true,”topScorers”:true,”predictions”:true,”odds”:false}},{“league_id”:699,”name”:”Premier League”,”type”:”League”,”country”:”England”,”country_code”:”GB”,”season”:2012,”season_start”:”2012–08–18",”season_end”:”2013–05–19",”logo”:”https:\/\/media.api-football.com\/leagues\/56.png”,”flag”:”https:\/\/media.api-football.com\/flags\/gb.svg”,”standings”:1,”is_current”:0,”coverage”:{“standings”:true,”fixtures”:{“events”:true,”lineups”:true,”statistics”:false,”players_statistics”:false},”players”:true,”topScorers”:true,”predictions”:true,”odds”:false}},{“league_id”:698,”name”:”Premier League”,”type”:”League”,”country”:”England”,”country_code”:”GB”,”season”:2013,”season_start”:”2013–08–17",”season_end”:”2014–05–11",”logo”:”https:\/\/media.api-football.com\/leagues\/56.png”,”flag”:”https:\/\/media.api-football.com\/flags\/gb.svg”,”standings”:1,”is_current”:0,”coverage”:{“standings”:true,”fixtures”:{“events”:true,”lineups”:true,”statistics”:false,”players_statistics”:false},”players”:true,”topScorers”:true,”predictions”:true,”odds”:false}},{“league_id”:697,”name”:”Premier League”,”type”:”League”,”country”:”England”,”country_code”:”GB”,”season”:2014,”season_start”:”2014–08–16",”season_end”:”2015–05–24",”logo”:”https:\/\/media.api-football.com\/leagues\/56.png”,”flag”:”https:\/\/media.api-football.com\/flags\/gb.svg”,”standings”:1,”is_current”:0,”coverage”:{“standings”:true,”fixtures”:{“events”:true,”lineups”:true,”statistics”:false,”players_statistics”:false},”players”:true,”topScorers”:true,”predictions”:true,”odds”:false}},{“league_id”:696,”name”:”Premier League”,”type”:”League”,”country”:”England”,”country_code”:”GB”,”season”:2015,”season_start”:”2015–08–08",”season_end”:”2016–05–17",”logo”:”https:\/\/media.api-football.com\/leagues\/56.png”,”flag”:”https:\/\/media.api-football.com\/flags\/gb.svg”,”standings”:1,”is_current”:0,”coverage”:{“standings”:true,”fixtures”:{“events”:true,”lineups”:true,”statistics”:false,”players_statistics”:false},”players”:true,”topScorers”:true,”predictions”:true,”odds”:false}},{“league_id”:56,”name”:”Premier League”,”type”:”League”,”country”:”England”,”country_code”:”GB”,”season”:2016,”season_start”:”2016–08–13",”season_end”:”2017–05–21",”logo”:”https:\/\/media.api-football.com\/leagues\/56.png”,”flag”:”https:\/\/media.api-football.com\/flags\/gb.svg”,”standings”:1,”is_current”:0,”coverage”:{“standings”:true,”fixtures”:{“events”:true,”lineups”:true,”statistics”:true,”players_statistics”:false},”players”:true,”topScorers”:true,”predictions”:true,”odds”:false}},{“league_id”:37,”name”:”Premier League”,”type”:”League”,”country”:”England”,”country_code”:”GB”,”season”:2017,”season_start”:”2017–08–11",”season_end”:”2018–05–13",”logo”:”https:\/\/media.api-football.com\/leagues\/37.png”,”flag”:”https:\/\/media.api-football.com\/flags\/gb.svg”,”standings”:1,”is_current”:0,”coverage”:{“standings”:true,”fixtures”:{“events”:true,”lineups”:true,”statistics”:true,”players_statistics”:true},”players”:true,”topScorers”:true,”predictions”:true,”odds”:false}},{“league_id”:2,”name”:”Premier League”,”type”:”League”,”country”:”England”,”country_code”:”GB”,”season”:2018,”season_start”:”2018–08–10",”season_end”:”2019–05–12",”logo”:”https:\/\/media.api-football.com\/leagues\/2.png”,”flag”:”https:\/\/media.api-football.com\/flags\/gb.svg”,”standings”:1,”is_current”:0,”coverage”:{“standings”:true,”fixtures”:{“events”:true,”lineups”:true,”statistics”:true,”players_statistics”:true},”players”:true,”topScorers”:true,”predictions”:true,”odds”:false}},{“league_id”:524,”name”:”Premier League”,”type”:”League”,”country”:”England”,”country_code”:”GB”,”season”:2019,”season_start”:”2019–08–09",”season_end”:”2020–05–17",”logo”:”https:\/\/media.api-football.com\/leagues\/2.png”,”flag”:”https:\/\/media.api-football.com\/flags\/gb.svg”,”standings”:1,”is_current”:1,”coverage”:{“standings”:true,”fixtures”:{“events”:true,”lineups”:true,”statistics”:true,”players_statistics”:true},”players”:true,”topScorers”:true,”predictions”:true,”odds”:true}}]}}</strong></p><p id="7556" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个混乱的JSON响应包含了我们需要的数据，但是它不是我们想要使用的格式。</p><h1 id="9575" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">步骤6:将JSON数据转换成pandas数据帧</h1><p id="b250" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">为了将我们的数据转换成dataframe，我们首先需要深入研究一下JSON响应的架构。我使用下面的代码分几个步骤来完成这个任务。</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="cdc0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">字典键(['api']) </strong></p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="4a29" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> dict_keys(['结果'，'联赛']) </strong></p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/48bb2a47ea1873f5dd97eb5f06fbe72e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4kFYas2pr-bjusnt.png"/></div></div></figure><p id="3367" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就是这样！我们已经成功地从一个API中检索到数据，并将其打包成一个熊猫数据帧。现在，您可以将这些数据导出到一个. csv文件中，继续在笔记本中使用这些数据，或者进行更多的API调用来获得更多有趣的数据！</p></div></div>    
</body>
</html>