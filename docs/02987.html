<html>
<head>
<title>Horizontal Parallelism with Pyspark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pyspark的水平平行度</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/horizontal-parallelism-with-pyspark-d05390aa1df5?source=collection_archive---------2-----------------------#2020-01-11">https://medium.com/analytics-vidhya/horizontal-parallelism-with-pyspark-d05390aa1df5?source=collection_archive---------2-----------------------#2020-01-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="be47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我的星火深潜系列中的一个系列。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/6902fb381720dcf833c54359a95f532e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*avrRF1ZAHIgNOMyK"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae jt" href="https://unsplash.com/@artisanalphoto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">手工摄影</a>拍摄</figcaption></figure><div class="ju jv ez fb jw jx"><a rel="noopener follow" target="_blank" href="/@somanathsankaran"><div class="jy ab dw"><div class="jz ab ka cl cj kb"><h2 class="bd hj fi z dy kc ea eb kd ed ef hh bi translated">索玛纳特·桑卡兰培养基</h2><div class="ke l"><h3 class="bd b fi z dy kc ea eb kd ed ef dx translated">阅读索马纳特·桑卡兰在媒介上的作品。对python和spark感兴趣的大数据开发者。每天，索马纳特…</h3></div><div class="kf l"><p class="bd b fp z dy kc ea eb kd ed ef dx translated">medium.com</p></div></div><div class="kg l"><div class="kh l ki kj kk kg kl jn jx"/></div></div></a></div><p id="210b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Spark是一个分布式并行计算框架，但仍然有一些功能可以用python多处理模块并行化。</p><p id="a077" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们详细看看下面的步骤。</p><ol class=""><li id="c12d" class="km kn hi ih b ii ij im in iq ko iu kp iy kq jc kr ks kt ku bi translated">Pyspark函数的顺序执行</li><li id="b44f" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">线程池的水平并行性</li><li id="8921" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">它是如何工作的</li><li id="cce7" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">利用水平并行的用例</li></ol><p id="ab4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">py spark功能的顺序执行</strong></p><p id="36b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有很多函数会导致闲置的执行器。例如</p><p id="646e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们考虑一个简单的函数，它在一个列级别上接受dups计数</p><p id="3265" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们会有一个样本泰坦尼克号数据集</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es la"><img src="../Images/62689b5141858aeed37b6e244e32ac05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PkmEy13Xf8v6LogmoQ2lXA.png"/></div></div></figure><p id="e9b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些函数获取列，并将获得每一列的重复计数，并将存储在全局列表opt中。我已经加了时间去找时间</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lb"><img src="../Images/434eeeb56cb6ca1cedfd35a3c3e4d3a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zUVuPt0uKdhYB0wkcOPrAA.png"/></div></div></figure><p id="6e29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们调用函数</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lc"><img src="../Images/87196cd4ef01f4023abc4fbab1f0b693.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*aK5oU7zLN8p3cV0xZac6Fg.png"/></div></figure><p id="414f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们看到上面的结果，我们可以看到col将被依次调用，尽管我们有更多的executor内存和内核。</p><p id="1caf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ld">注意:由于数据集很小，我们看不到更大的时间差</em></p><p id="ef3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">线程池的水平平行度</strong></p><p id="7f12" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了克服这个问题，我们将使用python多重处理并执行相同的函数</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es le"><img src="../Images/41db7053ab01bc6d8d777b9c879f7235.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ST14mWXGRdXwqZaAYDlblQ.png"/></div></div></figure><p id="d659" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们已经使用了python multi processing中的线程池，进程数=2，通过查看时间的最后两位数，我们可以看到该函数在2列中成对执行。</p><p id="a273" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ld">注意:小差异我怀疑可能是由于打印功能的副作用</em></p><p id="263d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">工作原理:</strong></p><p id="e581" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只要我们调用该函数，多个任务将同时从pyspark-driver并行提交给spark executor，只要我们有足够的内核，spark executor将并行执行这些任务</p><p id="425c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意，只有当我们需要执行器内核来执行并行任务时，这才会起作用</strong></p><p id="5261" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，如果我们有100个执行核心(执行核心数=50，核心数=2将等于50*2)，并且我们有50个分区，如果我们有2个进程的线程池，使用这种方法将会减少大约1/2的时间。但是另一方面，如果我们指定3个线程池，我们将具有相同的性能，因为我们将只有100个执行器，所以同时只有2个任务可以运行，即使3个任务已经从驱动程序提交到执行器，也只有2个进程将运行，并且第三个任务将仅在两个任务完成时由执行器选择。</p><p id="f9a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，在上面的函数中，大多数执行器都是空闲的，因为我们只处理一列。</p><p id="c0c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了提高性能，我们可以增加进程数=驱动程序上的内核数，因为这些任务的提交将从驱动程序机器中进行，如下所示</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lf"><img src="../Images/86f7d69844fc8b1815987948e62648d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1L5IKv3Rd4dlS-GtQ7A2PQ.png"/></div></div></figure><p id="a831" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到墙壁时间略微减少到3.35秒</p><p id="6f2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于这些线程不做任何繁重的计算任务，我们可以进一步增加进程</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lg"><img src="../Images/ed63e2944752d735ae68ac0309c55da9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S5V0D4WR4syqV9XueriFrg.png"/></div></div></figure><p id="a8cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以进一步看到墙壁时间减少到2.85秒</p><p id="8dd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，这取决于两个因素</p><ol class=""><li id="9898" class="km kn hi ih b ii ij im in iq ko iu kp iy kq jc kr ks kt ku bi translated">驱动程序计算机上可用的线程数</li><li id="ebbd" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">可用的执行者和核心数量</li></ol><p id="8ae3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">利用水平并行的用例</strong></p><p id="ac37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以在下面的用例中使用它</p><ol class=""><li id="e046" class="km kn hi ih b ii ij im in iq ko iu kp iy kq jc kr ks kt ku bi translated">在列级处理的完全独立的函数</li><li id="d81c" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">将数据写入diff分区</li></ol><p id="f419" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天就到这里吧！！:)</p><p id="e254" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ld">注意:还有其他多处理模块，如池、进程等，也可以通过python </em> </strong>进行并行化试验</p><p id="9d1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Github链接:<a class="ae jt" href="https://github.com/SomanathSankaran/spark_medium/tree/master/spark_csv" rel="noopener ugc nofollow" target="_blank">https://github . com/SomanathSankaran/spark _ medium/tree/master/spark _ CSV</a></p><p id="5679" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ld">请给我发spark中我必须涉及的话题，并给我改进写作的建议:)</em> </strong></p><p id="768a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">学习并让别人学习！！</strong></p></div></div>    
</body>
</html>