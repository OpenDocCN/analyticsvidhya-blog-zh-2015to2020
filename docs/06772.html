<html>
<head>
<title>How to login to websites requiring OTP(e-mail), using python.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用python登录需要OTP(电子邮件)的网站？</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-login-to-websites-requiring-otp-using-python-6e5339a5c740?source=collection_archive---------2-----------------------#2020-06-02">https://medium.com/analytics-vidhya/how-to-login-to-websites-requiring-otp-using-python-6e5339a5c740?source=collection_archive---------2-----------------------#2020-06-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1230" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用python抓取电子邮件获取登录所需的一次性密码。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/716405f9857a44a45bec560945402033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KzS11rGwIO88MH2ngzh4IA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">需要OTP的登录页面的屏幕截图</figcaption></figure><p id="94b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想在登录后访问需要OTP的网站，如上图所示，这篇文章将非常有用。</p><h2 id="c606" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated"><strong class="ak">一些假设/要求</strong></h2><ol class=""><li id="43d0" class="ko kp hi ih b ii kq im kr iq ks iu kt iy ku jc kv kw kx ky bi translated">使用Gmail</li><li id="0325" class="ko kp hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">可以通过电子邮件获得动态口令</li><li id="d578" class="ko kp hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">谷歌浏览器成为浏览器的选择</li><li id="0d49" class="ko kp hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">计算机编程语言</li></ol><h2 id="91c3" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">入门指南</h2><p id="aba4" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">第一步是访问登录页面。为此，我使用了python的Selenium包。如果您还没有selenium，可以按照以下网址上的说明进行安装:</p><div class="lh li ez fb lj lk"><a href="https://pypi.org/project/selenium/" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab dw"><div class="lm ab ln cl cj lo"><h2 class="bd hj fi z dy lp ea eb lq ed ef hh bi translated">硒</h2><div class="lr l"><h3 class="bd b fi z dy lp ea eb lq ed ef dx translated">Selenium WebDriver的Python语言绑定。selenium包用于从…自动化web浏览器交互</h3></div><div class="ls l"><p class="bd b fp z dy lp ea eb lq ed ef dx translated">pypi.org</p></div></div><div class="lt l"><div class="lu l lv lw lx lt ly jn lk"/></div></div></a></div><p id="e92e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，要实现这一点，您需要下载chromedriver(检查您的chrome版本并下载相关版本):</p><div class="lh li ez fb lj lk"><a href="https://chromedriver.chromium.org/downloads" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab dw"><div class="lm ab ln cl cj lo"><h2 class="bd hj fi z dy lp ea eb lq ed ef hh bi translated">下载-Chrome driver-Chrome的WebDriver</h2><div class="lr l"><h3 class="bd b fi z dy lp ea eb lq ed ef dx translated">Chrome的网络驱动</h3></div><div class="ls l"><p class="bd b fp z dy lp ea eb lq ed ef dx translated">Chromechromedriver.chromium.org的web驱动程序</p></div></div></div></a></div><p id="7b83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">至此，让我们开始深入研究实现。首先从selenium导入webdriver，然后添加chromedriver的位置和登录页面的url。</p><pre class="je jf jg jh fd lz ma mb mc aw md bi"><span id="3a29" class="jt ju hi ma b fi me mf l mg mh">import time<br/>from selenium import webdriver</span><span id="e8ba" class="jt ju hi ma b fi mi mf l mg mh">browser = webdriver.Chrome(<br/>    "filepath of your chrome driver")<br/>browser.get('login page url')</span></pre><h2 id="e3e1" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">常规登录</h2><p id="d0e2" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">下一步是输入网站的用户名和密码。我用了。find_element_by_xpath查找用户名和密码表单。然后，使用。send_keys填写登录凭证，然后点击登录按钮。要获取元素的XPath，可以右键单击想要访问的元素的位置，然后单击inspect on chrome。然后右键单击html代码并选择copy XPath。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mj"><img src="../Images/e69e245922e1c790fb214dad88cbdad3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eDJqg6pDeShThXlGKqlWbQ.png"/></div></div></figure><pre class="je jf jg jh fd lz ma mb mc aw md bi"><span id="19a6" class="jt ju hi ma b fi me mf l mg mh">username_elem = browser.find_element_by_xpath('xpath of username form')<br/>username_elem.send_keys(username)</span><span id="1329" class="jt ju hi ma b fi mi mf l mg mh">password_elem = browser.find_element_by_xpath('xpath of password form')<br/>password_elem.send_keys(password)</span><span id="5f9d" class="jt ju hi ma b fi mi mf l mg mh">login_elem = browser.find_element_by_xpath('xpath of login button')<br/>login_elem.click()</span></pre><p id="f122" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，您将看到第二个登录页面，该页面需要OTP。对于这个例子，我将假设OTP发送到您的电子邮件。</p><h2 id="ec7f" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">从电子邮件中获取动态口令</h2><p id="c72b" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">这是一个棘手的问题。对于这一部分，我在实现部分遇到了相当多的问题。在谈论一些潜在的问题之前，我将首先解释代码。此外，本部分主要参考和改编自:</p><div class="lh li ez fb lj lk"><a href="https://www.thepythoncode.com/article/reading-emails-in-python" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab dw"><div class="lm ab ln cl cj lo"><h2 class="bd hj fi z dy lp ea eb lq ed ef hh bi translated">如何用Python - Python代码阅读电子邮件</h2><div class="lr l"><h3 class="bd b fi z dy lp ea eb lq ed ef dx translated">Abdou Rockikz 7分钟读取更新2020年5月Python标准库能够创建一个应用程序…</h3></div><div class="ls l"><p class="bd b fp z dy lp ea eb lq ed ef dx translated">www.thepythoncode.com</p></div></div><div class="lt l"><div class="mk l lv lw lx lt ly jn lk"/></div></div></a></div><p id="5e7d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了使下面的工作，假设最新的电子邮件包含OTP。大部分代码可以从上面的链接中得到更好的解释。然而，您必须做的主要修改是从第45行开始的。变量body中的电子邮件内容是一个字符串。为了简单起见，我使用了一种字符串分割方法来定位OTP，在将它附加到一个列表之前，在OTP之前和之后分割字符串。最后退单。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><h2 id="564d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">现在，在网站上填写动态口令…</h2><p id="9e9b" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">从初始登录部分继续，登录后，我们将调用time.sleep来等待OTP发送到我们的电子邮件。有了上面的函数，我们只需调用它就可以得到OTP。接下来，我们将OTP拆分并类型转换成单独的字符串，以便以后调用它们。</p><p id="f69b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用for循环，我们可以访问OTP元素，并通过编辑XPaths和单独发送OTP来填充它们。最后点击提交按钮。</p><pre class="je jf jg jh fd lz ma mb mc aw md bi"><span id="f35e" class="jt ju hi ma b fi me mf l mg mh"># wait for OTP<br/>time.sleep(10)<br/><br/># get OTP<br/>otp = get_otp()<br/>otp_split = [str(i) for i in str(otp[0])]<br/><br/># fills in 4 pin OTP code<br/>for i in range(4):<br/>    otp_elem = browser.find_element_by_xpath('//*[@id="loginForm"]/div[1]/div/div[1]/input' + str([i + 1]))<br/>    otp_elem.send_keys(otp_split[i])<br/><br/>otp_login_elem = browser.find_element_by_xpath('XPath of submit button')<br/>otp_login_elem.click()</span></pre><p id="bbda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有……就这些了！</p><h2 id="1309" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">需要一些gmail设置</h2><p id="590e" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">你可能面临的一个问题是访问你的电子邮件。为此，您必须更改gmail的设置；</p><ol class=""><li id="5f6c" class="ko kp hi ih b ii ij im in iq mn iu mo iy mp jc kv kw kx ky bi translated">启用IMAP访问(Gmail &gt;设置&gt;转发和POP/IMAP &gt;单击启用IMAP)</li><li id="75b5" class="ko kp hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">启用不太安全的应用程序访问(<a class="ae mq" href="https://support.google.com/accounts/answer/6010255" rel="noopener ugc nofollow" target="_blank">https://support.google.com/accounts/answer/6010255</a>)</li></ol></div><div class="ab cl mr ms gp mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hb hc hd he hf"><h2 id="6dac" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">评论</h2><p id="2347" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">就这些，希望这有帮助！当我在一个个人项目中从一个需要OTP的网站上收集一些数据时，我没有找到很多关于这个主题的文章。所以我想我会写点东西来帮忙！</p><p id="a4ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我的第一篇中型文章…我相对来说是编程新手。这大部分是基于反复试验、阅读指南和许多stackoverflow文章。我知道这可能不是实现OTP登录的最佳方式，但它很简单，对我很有效！</p></div></div>    
</body>
</html>