<html>
<head>
<title>Azure Synapse Analytics SQL on demand NYC data set demo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">azure Synapse Analytics SQL on demand纽约数据集演示</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/azure-synapse-analytics-sql-on-demand-nyc-data-set-demo-adaf07e326f8?source=collection_archive---------17-----------------------#2020-10-10">https://medium.com/analytics-vidhya/azure-synapse-analytics-sql-on-demand-nyc-data-set-demo-adaf07e326f8?source=collection_archive---------17-----------------------#2020-10-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="9e1e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">加载开源的纽约出租车数据集并进行查询处理</h1><h1 id="1e59" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">保存数据的PySpark代码</h1><ul class=""><li id="238a" class="jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">需要将开放数据集中的数据复制到本地synapse默认存储中</li><li id="9472" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">读取黄色出租车数据</li><li id="ee28" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">以pyspark为语言创建一个笔记本</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="1104" class="kj ig hi kf b fi kk kl l km kn">blob_account_name = "azureopendatastorage"<br/>blob_container_name = "nyctlc"<br/>blob_relative_path = "yellow"<br/>blob_sas_token = r""<br/><br/># Allow Spark to read from Blob remotely<br/>wasbs_path = 'wasbs://%s@%s.blob.core.windows.net/%s' % (blob_container_name, blob_account_name, blob_relative_path)<br/>spark.conf.set('fs.azure.sas.%s.%s.blob.core.windows.net' % (blob_container_name, blob_account_name),blob_sas_token)<br/><br/># Spark read parquet, note that it won't load any data yet by now<br/>yellowdf = spark.read.parquet(wasbs_path)</span></pre><ul class=""><li id="0c7f" class="jd je hi jf b jg ko ji kp jk kq jm kr jo ks jq jr js jt ju bi translated">显示和验证数据集</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="325e" class="kj ig hi kf b fi kk kl l km kn">display(yellowdf)</span></pre><ul class=""><li id="9332" class="jd je hi jf b jg ko ji kp jk kq jm kr jo ks jq jr js jt ju bi translated">读取绿色出租车详细信息并显示</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="170c" class="kj ig hi kf b fi kk kl l km kn">blob_account_name = "azureopendatastorage"<br/>blob_container_name = "nyctlc"<br/>blob_relative_path = "green"<br/>blob_sas_token = r""<br/><br/># Allow Spark to read from Blob remotely<br/>wasbs_path = 'wasbs://%s@%s.blob.core.windows.net/%s' % (blob_container_name, blob_account_name, blob_relative_path)<br/>spark.conf.set('fs.azure.sas.%s.%s.blob.core.windows.net' % (blob_container_name, blob_account_name),blob_sas_token)<br/><br/># Spark read parquet, note that it won't load any data yet by now<br/>greendf = spark.read.parquet(wasbs_path)</span></pre><ul class=""><li id="be0a" class="jd je hi jf b jg ko ji kp jk kq jm kr jo ks jq jr js jt ju bi translated">显示和验证数据集</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="372a" class="kj ig hi kf b fi kk kl l km kn">display(greendf)</span></pre><ul class=""><li id="df1c" class="jd je hi jf b jg ko ji kp jk kq jm kr jo ks jq jr js jt ju bi translated">导入pyspark必需的库</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="79ec" class="kj ig hi kf b fi kk kl l km kn">import org.apache.spark.sql</span></pre><ul class=""><li id="d622" class="jd je hi jf b jg ko ji kp jk kq jm kr jo ks jq jr js jt ju bi translated">是时候写黄色数据集了</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="d9f4" class="kj ig hi kf b fi kk kl l km kn">yellowdf.write.mode('overwrite').parquet("/nyctaxiyellow")</span></pre><ul class=""><li id="e57e" class="jd je hi jf b jg ko ji kp jk kq jm kr jo ks jq jr js jt ju bi translated">将绿色数据集写入本地存储的时间到了</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="6b4c" class="kj ig hi kf b fi kk kl l km kn">greendf.write.mode('overwrite').parquet("/nyctaxigreen")</span></pre><ul class=""><li id="4fa0" class="jd je hi jf b jg ko ji kp jk kq jm kr jo ks jq jr js jt ju bi translated">现在数据已经加载完毕，让我们使用sql按需编写查询</li><li id="6a72" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">转到开发并打开新的查询窗口</li><li id="a678" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">首先加载数据</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="ecd5" class="kj ig hi kf b fi kk kl l km kn">SELECT<br/>    TOP 100 *<br/>FROM<br/>    OPENROWSET(<br/>        BULK     'https://storageacctname.blob.core.windows.net/synapseroot/nyctaxiyellow/*',<br/>        FORMAT = 'parquet'<br/>    ) AS [result];</span></pre><figure class="ka kb kc kd fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es kt"><img src="../Images/48bc9f76b24266a8052adc6758a1c00f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DEdrfuCR4uN7KC_7o8Okcw.jpeg"/></div></div></figure><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="7737" class="kj ig hi kf b fi kk kl l km kn">SELECT<br/>    TOP 100 *<br/>FROM<br/>    OPENROWSET(<br/>        BULK     'https://storageacctname.blob.core.windows.net/synapseroot/nyctaxigreen/*',<br/>        FORMAT = 'parquet'<br/>    ) AS [result];</span></pre><figure class="ka kb kc kd fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es lb"><img src="../Images/6bf364db1bdf6e47fcbe87ce820da124.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sNkErCsXcNS3D5QSQ3JU-w.jpeg"/></div></div></figure><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="732c" class="kj ig hi kf b fi kk kl l km kn">SELECT<br/>    count(*)<br/>FROM<br/>    OPENROWSET(<br/>        BULK     'https://storageacctname.blob.core.windows.net/synapseroot/nyctaxiyellow/*',<br/>        FORMAT = 'parquet'<br/>    ) AS [result];</span></pre><figure class="ka kb kc kd fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es lc"><img src="../Images/baed4206f7c2ab3d4c9364fcb49dbd61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ciMuc2wTuNZ9QBN74yqfgQ.jpeg"/></div></div></figure><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="6476" class="kj ig hi kf b fi kk kl l km kn">SELECT<br/>    count(*)<br/>FROM<br/>    OPENROWSET(<br/>        BULK     'https://storageacctname.blob.core.windows.net/synapseroot/nyctaxigreen/*',<br/>        FORMAT = 'parquet'<br/>    ) AS [result];</span></pre><figure class="ka kb kc kd fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es ld"><img src="../Images/5a8c7c46d841f55bbe29226d0c2ba427.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PzWz1zMwSl_CG8E8Dmpe2A.jpeg"/></div></div></figure><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="ffa1" class="kj ig hi kf b fi kk kl l km kn">SELECT<br/>    PuYear, PuMonth, sum(FareAmount) as FareAmount, sum(TotalAmount) as TotalAmount<br/>FROM<br/>    OPENROWSET(<br/>        BULK     'https://storageacctname.blob.core.windows.net/synapseroot/nyctaxiyellow/*',<br/>        FORMAT = 'parquet'<br/>    ) AS [result] <br/>    Group by PuYear, PuMonth<br/>    Order by PuYear, PuMonth;</span></pre><figure class="ka kb kc kd fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es le"><img src="../Images/c6f2df3dc97ec584923376561acfaa24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BZmrxwUcNt57F0voMfXNOQ.jpeg"/></div></div></figure><p id="5a09" class="pw-post-body-paragraph lf lg hi jf b jg ko lh li ji kp lj lk jk ll lm ln jm lo lp lq jo lr ls lt jq hb bi translated">原故事来自:<a class="ae lu" href="https://github.com/balakreshnan/synapseAnalytics/blob/master/sqlondemandnyc.md" rel="noopener ugc nofollow" target="_blank">https://github . com/balakreshnan/synapse analytics/blob/master/sqlondemandnyc . MD</a></p></div></div>    
</body>
</html>