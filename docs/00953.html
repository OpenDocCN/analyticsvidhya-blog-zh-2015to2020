<html>
<head>
<title>Face Recognition using fastai — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用fastai的人脸识别—第2部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/face-recognition-using-fastai-part-2-44360f6471fb?source=collection_archive---------5-----------------------#2019-09-21">https://medium.com/analytics-vidhya/face-recognition-using-fastai-part-2-44360f6471fb?source=collection_archive---------5-----------------------#2019-09-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f2fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天，我们将了解如何下载任何图像来创建数据集并对其进行分析。我们将研究人类不同的情感。此外，我们将涵盖图像分类结果不佳背后的关键理论方面。我建议用户阅读本系列的第一部分来了解下面使用的方法。</p><h1 id="85d9" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">收集每类图像的URL</h1><p id="2b0c" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">打开谷歌图片，运行下面的脚本，为不同类型的图片分类。取适量的图像。我将在谷歌上拍摄各种不同的人类表情，比如恐惧、悲伤、快乐、惊讶、厌恶和愤怒。剧本如下—</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="6f40" class="kq jf hi km b fi kr ks l kt ku">urls = Array.from(document.querySelectorAll('.rg_di .rg_meta')).map(el=&gt;JSON.parse(el.textContent).ou);</span><span id="40d6" class="kq jf hi km b fi kv ks l kt ku">window.open('data:text/csv;charset=utf-8,' + escape(urls.join('\n')));</span></pre><p id="96b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将下载的文件夹重命名为图像类型。</p><p id="26a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像下面一样导入fastai库。Fastai.vision用于分类目的。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="02f1" class="kq jf hi km b fi kr ks l kt ku">from fastai.vision import *</span></pre><p id="660e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于我使用的是google colab，所以我会将文件上传到colab目录下的相应文件夹中。</p><ul class=""><li id="1eaf" class="kw kx hi ih b ii ij im in iq ky iu kz iy la jc lb lc ld le bi translated">文件夹:anger，文件名:urls_anger.txt</li><li id="498b" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">文件夹:快乐，文件名:urls_happy.txt</li></ul><p id="6439" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从一种类型的文件夹开始。首先，我们将处理惊喜情绪(你们肯定会从fastai的简单性中得到这种情绪)。我们将使用震惊情绪进行预处理。运行下面的代码。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="c63e" class="kq jf hi km b fi kr ks l kt ku">folder = 'surprise'<br/>file = 'urls_surprise.csv'</span></pre><p id="ee3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，由于我们已经初始化了文件夹名和文件名，我们需要在目录中创建文件夹。您可以使用<strong class="ih hj"> pwd </strong>命令获得您的根目录的路径。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="35be" class="kq jf hi km b fi kr ks l kt ku">path = Path('/data/expressions')<br/>dest = path/folder<br/>dest.mkdir(parents=True, exist_ok=True)</span><span id="11bd" class="kq jf hi km b fi kv ks l kt ku">path.ls()<br/> <br/> = [PosixPath('/content/data/expressions/surprise')]</span></pre><p id="afdf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在处理实际路径时，Path对象比字符串更容易处理。</p><p id="b2c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你专门使用google colab笔记本，那么创建的文件夹将如下所示。</p><figure class="kh ki kj kk fd ll er es paragraph-image"><div class="er es lk"><img src="../Images/a369662b897c459256111d93e196bf93.png" data-original-src="https://miro.medium.com/v2/resize:fit:556/format:webp/1*DR2NAUNHEXLO8xqQOxYl4g.png"/></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">上传表达式文件夹中的文件</figcaption></figure><p id="fd90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建文件夹后，包含图像URL的文本文件出现在expressions文件夹中，现在我们需要使用文本文件下载图像。我们将使用fastai提供的方法，<em class="ls">下载_图片。</em></p><p id="50aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">❓什么是<a class="ae jd" href="https://docs.fast.ai/vision.data.html#download_images" rel="noopener ugc nofollow" target="_blank"> download_images </a> <br/>下载文本文件中列出的图片URL到path dest，最多max_pics</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="6599" class="kq jf hi km b fi kr ks l kt ku">download_images<!-- -->(<strong class="km hj">urls</strong>:<!-- -->StrList<!-- -->, <strong class="km hj">dest</strong>:<!-- -->PathOrStr<!-- -->, <strong class="km hj">max_pics</strong>:<!-- -->int<!-- -->=<strong class="km hj"><em class="ls">1000</em></strong>, <strong class="km hj">max_workers</strong>:<!-- -->int<!-- -->=<strong class="km hj"><em class="ls">8</em></strong>, <strong class="km hj">timeout</strong>=<strong class="km hj"><em class="ls">4</em></strong>)</span><span id="282b" class="kq jf hi km b fi kv ks l kt ku">download_images(path/file, dest, max_pics=200)</span></pre><p id="a80a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在对其他类型的人类表情重复同样的过程。对于每一种情绪，按照下面的步骤循环。</p><blockquote class="lt lu lv"><p id="1455" class="if ig ls ih b ii ij ik il im in io ip lw ir is it lx iv iw ix ly iz ja jb jc hb bi translated">folder = ' anger '<br/>file = ' URLs _ anger '</p></blockquote><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="d9de" class="kq jf hi km b fi kr ks l kt ku">dest = path/folder<br/>dest.mkdir(parents=True, exist_ok=True)</span><span id="a8af" class="kq jf hi km b fi kv ks l kt ku">download_images(path/file, dest, max_pics=200)</span></pre><blockquote class="lt lu lv"><p id="4d85" class="if ig ls ih b ii ij ik il im in io ip lw ir is it lx iv iw ix ly iz ja jb jc hb bi translated">folder = ' sad '<br/>file = ' URLs _ sad '</p></blockquote><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="abd0" class="kq jf hi km b fi kr ks l kt ku">dest = path/folder<br/>dest.mkdir(parents=True, exist_ok=True)</span><span id="0625" class="kq jf hi km b fi kv ks l kt ku">download_images(path/file, dest, max_pics=200)</span></pre><blockquote class="lt lu lv"><p id="606d" class="if ig ls ih b ii ij ik il im in io ip lw ir is it lx iv iw ix ly iz ja jb jc hb bi translated">folder = ' happy '<br/>file = ' URLs _ happy '</p></blockquote><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="074d" class="kq jf hi km b fi kr ks l kt ku">dest = path/folder<br/>dest.mkdir(parents=True, exist_ok=True)</span><span id="78eb" class="kq jf hi km b fi kv ks l kt ku">download_images(path/file, dest, max_pics=200)<br/>If you face issue downloading, use max_workers=0 in the download_images()</span></pre><p id="6c97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">过程如下。</p><p id="6720" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这之后，我们在各自的文件夹中有许多下载的图像。可以走了，❕</p><p id="fc86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们声明一个包含所有表达式的类变量。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="7d35" class="kq jf hi km b fi kr ks l kt ku">classes = [ 'fear', 'sad', 'happy', 'surprise', 'disgust', 'anger']</span></pre><h1 id="a317" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">验证图像</h1><p id="173d" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在进一步创建图像数据组之前，请确保下载的所有图像都是图像，而不是损坏的图像文件，该文件不再是图像。用fastai也很容易。只需使用<em class="ls">验证_图像。</em></p><p id="b5e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">❓什么是<a class="ae jd" href="https://docs.fast.ai/vision.data.html#verify_images" rel="noopener ugc nofollow" target="_blank"> verify_images </a> <br/>它会尝试这个文件夹中的每张图片是否都能打开。如果您提到delete=true，它将删除损坏的图像。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="01e5" class="kq jf hi km b fi kr ks l kt ku">verify_images<!-- -->(<strong class="km hj">path</strong>:<!-- -->PathOrStr<!-- -->, <strong class="km hj">delete</strong>:<!-- -->bool<!-- -->=<strong class="km hj"><em class="ls">True</em></strong>, <strong class="km hj">max_workers</strong>:<!-- -->int<!-- -->=<strong class="km hj"><em class="ls">4</em></strong>, <strong class="km hj">max_size</strong>:<!-- -->int<!-- -->=<strong class="km hj"><em class="ls">None</em></strong>, <strong class="km hj">recurse</strong>:<!-- -->bool<!-- -->=<strong class="km hj"><em class="ls">False</em></strong>, <strong class="km hj">dest</strong>:<!-- -->PathOrStr<!-- -->=<strong class="km hj"><em class="ls">'.'</em></strong>, <strong class="km hj">n_channels</strong>:<!-- -->int<!-- -->=<strong class="km hj"><em class="ls">3</em></strong>, <strong class="km hj">interp</strong>=<strong class="km hj"><em class="ls">2</em></strong>, <strong class="km hj">ext</strong>:<!-- -->str<!-- -->=<strong class="km hj"><em class="ls">None</em></strong>, <strong class="km hj">img_format</strong>:<!-- -->str<!-- -->=<strong class="km hj"><em class="ls">None</em></strong>, <strong class="km hj">resume</strong>:<!-- -->bool<!-- -->=<strong class="km hj"><em class="ls">None</em></strong>, <strong class="km hj">**</strong><strong class="km hj">kwargs</strong>)</span><span id="088b" class="kq jf hi km b fi kv ks l kt ku">for c in classes:<br/>    print(c)<br/>    verify_images(path/c, delete=True, max_size=500)</span></pre><h1 id="c93a" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">创建ImageDataBunch</h1><p id="ec36" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">目前，我们没有验证数据集。我们有一个文件夹，里面有所有不同类型的图片。在这种情况下，在创建数据束时，我们可以指示数据束为我们创建一个验证数据集，它可能是原始数据的10%、20%甚至30%。验证数据集对于了解我们的模型执行情况至关重要。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="2738" class="kq jf hi km b fi kr ks l kt ku">np.random.seed(42)<br/>data = ImageDataBunch.from_folder(path, train=".", valid_pct=0.2,<br/>        ds_tfms=get_transforms(), size=224, num_workers=4).normalize(imagenet_stats)</span></pre><p id="e4ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">valid_pct —用于创建验证数据集<br/> train= " . "—告知当前文件夹中存在训练数据集；否则，它将寻找火车文件夹。np.random.seeds(42) —它确保我们每次运行命令时都获得相同的验证数据集。</p><p id="5144" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在已经有了一个数据束，这样你就可以看到里面的<code class="du lz ma mb km b">data.classes</code>，你会看到这些是我们创建的文件夹。所以它知道这些类别(我们所说的类别是指所有可能的标签)是恐惧、悲伤、快乐、惊讶、厌恶和愤怒。</p><figure class="kh ki kj kk fd ll er es paragraph-image"><div class="er es mc"><img src="../Images/723b5401d24acbd610953360772e06a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*cGkVMS6o3x60ciq8wuXiAA.png"/></div></figure><figure class="kh ki kj kk fd ll er es paragraph-image"><div class="er es md"><img src="../Images/16e0ea473e2a5a9c0be008ecbdc30b01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*62LMeZXJSopebHthw6Repg.png"/></div></figure><p id="37c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们可以使用show_batch方法检查数据集。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="81fb" class="kq jf hi km b fi kr ks l kt ku">data.show_batch(rows=5, figsize=(7,8))</span></pre><figure class="kh ki kj kk fd ll er es paragraph-image"><div class="er es me"><img src="../Images/f335698e8c67728d5f40facec23d956b.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*AOxfhAvKwZMIR1qcCOMpUQ.png"/></div></figure><h1 id="6084" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">火车模型</h1><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="0bb5" class="kq jf hi km b fi kr ks l kt ku">learn = cnn_learner(data, models.resnet34, metrics=error_rate)</span><span id="0296" class="kq jf hi km b fi kv ks l kt ku">learn.fit_one_cycle(4)</span></pre><figure class="kh ki kj kk fd ll er es paragraph-image"><div class="er es mf"><img src="../Images/bbed2e020084944a71b2f96b54524bd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*mHCORM0PXSKbYE7a0UEPXg.png"/></div></figure><p id="02ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们保存结果。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="60ee" class="kq jf hi km b fi kr ks l kt ku">learn.save('stage-1')</span></pre><h1 id="a4fd" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">解冻和学习</h1><p id="6b1e" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">让我们看看解冻模型并用不同的学习率重新训练模型是否会提高我们的错误率，即是否会降低错误率。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="8d94" class="kq jf hi km b fi kr ks l kt ku">learn.unfreeze()<br/>learn.lr_find()<br/>learn.recorder.plot()</span></pre><figure class="kh ki kj kk fd ll er es paragraph-image"><div class="er es mg"><img src="../Images/9122dbe168fd7b29325c337021b98aff.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*F7SDkgUKcndc0JKLjM1DzA.png"/></div></figure><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="4dc0" class="kq jf hi km b fi kr ks l kt ku">learn.fit_one_cycle(2, max_lr=slice(1e-5,1e-3))</span></pre><figure class="kh ki kj kk fd ll er es paragraph-image"><div class="er es mh"><img src="../Images/6111f4508958d149ecd68564be5cdc65.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*DWQBIcywQZ4UUHtOQ2GZ-A.png"/></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">这次差错率少了。</figcaption></figure><p id="e9f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">坚持上面定义的学习速度。我们一会儿会了解它们。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="200e" class="kq jf hi km b fi kr ks l kt ku">learn.save(‘stage-2’)</span></pre><h1 id="c034" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">结论</h1><p id="3bbe" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">现在，满怀信心地预测你朋友的任何表情。上传根目录中的图像。下面使用的root_path变量告诉我图片的路径。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="07a8" class="kq jf hi km b fi kr ks l kt ku">img = open_image(root_path/'image.jpeg')<br/><em class="ls">(image.jpg is any random image.)</em></span><span id="fa12" class="kq jf hi km b fi kv ks l kt ku">img.show(figsize=(2, 1))<br/>learn.predict(img)</span></pre><p id="36a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://docs.fast.ai/vision.image.html#open_image" rel="noopener ugc nofollow" target="_blank"> open_image </a> —将打开图像<br/> <a class="ae jd" href="https://docs.fast.ai/vision.image.html#Image.show" rel="noopener ugc nofollow" target="_blank"> Image.show </a> —将以所需尺寸显示图像<br/> <a class="ae jd" href="https://docs.fast.ai/vision.learner.html#Learner.predict" rel="noopener ugc nofollow" target="_blank"> learn.predict </a> —返回<code class="du lz ma mb km b">item</code>的预测类、标签和概率。</p><figure class="kh ki kj kk fd ll er es paragraph-image"><div class="er es mi"><img src="../Images/eff716f89245e9b669155bea19b1f524.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*6NwLYmaFdUkG1KuWUEe1qg.png"/></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">被厌恶的可能性很高</figcaption></figure><h1 id="1e0f" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">解释</h1><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="d62e" class="kq jf hi km b fi kr ks l kt ku">learn.load('stage-2');<br/>interp = ClassificationInterpretation.from_learner(learn)</span><span id="d3c7" class="kq jf hi km b fi kv ks l kt ku">interp.plot_confusion_matrix()</span></pre><figure class="kh ki kj kk fd ll er es paragraph-image"><div class="er es mj"><img src="../Images/ca949e40451ec152fbb14b650b5b3db9.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/1*M0zsX2hi9ydG36hl7eTtng.png"/></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">我们的模型在判断情绪时也是如此混乱😆</figcaption></figure><p id="dffe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查看我的<a class="ae jd" rel="noopener" href="/@PJrohan/image-classification-using-fastai-5ff5b374d414"> <em class="ls">上一篇</em> </a>寻找更多解读方法。</p><h1 id="0283" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">可能出错的事情</h1><p id="7b0e" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">首要的是要有一个唯一的精确的数据集。如果你的数据集没有噪音，你可能会做得更好。也许谷歌图片搜索并不能一直给你准确的图片。因此，要获得良好的结果，拥有一个差异化的数据集至关重要。除此之外，让我们看看可能影响模型性能的各种其他因素。</p><p id="2ad7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该问题可能是由于以下原因造成的:</p><ul class=""><li id="0449" class="kw kx hi ih b ii ij im in iq ky iu kz iy la jc lb lc ld le bi translated">你的学习率太高或太低</li><li id="5fcf" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">您的时代数太高或太低</li></ul><h2 id="bdf5" class="kq jf hi bd jg mk ml mm jk mn mo mp jo iq mq mr js iu ms mt jw iy mu mv ka mw bi translated">学习率(LR)太高</h2><p id="8800" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">如果你的学习率比默认的1e-3要高，那么你很可能会损失很多。</p><figure class="kh ki kj kk fd ll er es paragraph-image"><div class="er es mx"><img src="../Images/1d003bd2e997741942caccbf0e23ba70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*qpYZnrCfIvrXHM80oVCtDA.png"/></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">高损耗</figcaption></figure><p id="446c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，你可能需要降低学习速度。</p><h2 id="41aa" class="kq jf hi bd jg mk ml mm jk mn mo mp jo iq mq mr js iu ms mt jw iy mu mv ka mw bi translated">学习率(LR)太低</h2><p id="89ac" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">如果你的学习率很浅，那么你的错误率会提高的很慢。否则你的损失会慢慢减少。如果出现这种情况，那么很有可能你需要提高学习率。</p><p id="9acc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以记录您的验证和培训损失，如下所示:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="e4fe" class="kq jf hi km b fi kr ks l kt ku">learn = cnn_learner(data, models.resnet34, metrics=error_rate)<br/>learn.fit_one_cycle(3, max_lr=1e-10)</span><span id="c031" class="kq jf hi km b fi kv ks l kt ku">learn.recorder.plot_losses()</span></pre><figure class="kh ki kj kk fd ll er es paragraph-image"><div class="er es my"><img src="../Images/1e44f2edec0c988a19d08c1d1581edd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*qWFf7wh2Pextkfhof7cmmg.png"/></div></figure><p id="9021" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你的学习率很低，还有一件事会发生，那就是你的培训损失会高于你的验证损失。你永远不会想要一个训练损失高于验证损失的模型。这总是意味着你没有足够的拟合，这意味着要么你的学习率太低，要么你的纪元数量太少。所以如果你有一个那样的模型，多训练一些或者用更高的学习率来训练。</p><figure class="kh ki kj kk fd ll er es paragraph-image"><div class="er es mz"><img src="../Images/be871da522fd2b45fe5e50293f777a92.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*xib1tXh6oMRirtAE8ZuiNw.png"/></div></figure><h2 id="6106" class="kq jf hi bd jg mk ml mm jk mn mo mp jo iq mq mr js iu ms mt jw iy mu mv ka mw bi translated">太少的时代</h2><p id="817c" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">如果我们只训练一个时期呢？我们的错误率当然比随机好，5%。但是看看这个，训练损失和验证损失的区别，﹣，训练损失比验证损失高得多。因此，太少的时代和较低的学习率看起来非常相似。所以你可以试着运行更多的纪元，如果要花很长时间，你可以尝试更高的学习速率。如果你尝试更高的学习率，损失达到100，000，000，000，000，然后把它放回到原来的位置，再尝试几个纪元。这就是平衡。99%的时间里你只关心这个。</p><figure class="kh ki kj kk fd ll er es paragraph-image"><div class="er es na"><img src="../Images/6fcd9fe238d8eeac6f96a46319089ca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*-MSrWZayxEiu2o74cDl5iw.png"/></div></figure><h2 id="69fc" class="kq jf hi bd jg mk ml mm jk mn mo mp jo iq mq mr js iu ms mt jw iy mu mv ka mw bi translated">太多的时代</h2><p id="9e36" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">太多的时代会产生所谓的“过度适应”如果你训练的时间太长，我们就会了解它，它会学习识别你特定的情绪图像，而不是一般的情绪。尽管你可能听说过在深度学习中过度拟合具有挑战性，但这不是真的，所以唯一告诉你你过度拟合的是错误率提高了一段时间，然后又开始变得更差。</p><p id="0201" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">🚄任何被正确训练的模型的训练损失总是低于验证损失。这并不是过度适应的迹象。</p><p id="c754" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi nb translated"><span class="l nc nd ne bm nf ng nh ni nj di"> T </span>仅此而已。现在你有了人类情感分类器。尽情享受吧！！</p><h1 id="2c42" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">参考资料:</h1><ul class=""><li id="5aca" class="kw kx hi ih b ii kc im kd iq nk iu nl iy nm jc lb lc ld le bi translated">Fast.ai</li></ul></div></div>    
</body>
</html>