<html>
<head>
<title>Spark Testing Base : ScalaTest + ScalaCheck</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">火花测试基地:ScalaTest + ScalaCheck</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/spark-testing-base-scalatest-scalacheck-808009688245?source=collection_archive---------0-----------------------#2019-09-22">https://medium.com/analytics-vidhya/spark-testing-base-scalatest-scalacheck-808009688245?source=collection_archive---------0-----------------------#2019-09-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/e16db24156d7ff7ec0e9f0e63ea61b91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*FfVFJc13BHc4qqPJkdLC2w.png"/></div></figure></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><p id="2d5d" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><a class="ae jr" href="https://spark.apache.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="iv hj"> Apache Spark </strong> </a>是一个用于分析和大数据处理的大规模分布式计算框架。</p><p id="1677" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">分布式计算程序很难在本地或用较小的数据集进行测试。用<a class="ae jr" href="https://github.com/holdenk" rel="noopener ugc nofollow" target="_blank"><strong class="iv hj">Holden Karau</strong></a><strong class="iv hj">:</strong><a class="ae jr" href="https://github.com/holdenk/spark-testing-base" rel="noopener ugc nofollow" target="_blank"><strong class="iv hj">Spark测试库</strong> </a>提供的几个基类，测试Spark代码变得很容易</p></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><h1 id="06cc" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">火花试验基地</h1><p id="d5d6" class="pw-post-body-paragraph it iu hi iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq hb bi translated">该库使用基于属性的测试原理来产生火花RDD、数据帧和数据集以及其他公共基类中的模糊性。</p><p id="2f4c" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">方便的基类:</p><ul class=""><li id="a8f5" class="kv kw hi iv b iw ix ja jb je kx ji ky jm kz jq la lb lc ld bi translated"><strong class="iv hj"><em class="le">SharedSparkContext:</em></strong>为每个测试用例提供一个SparkContext</li><li id="bf93" class="kv kw hi iv b iw lf ja lg je lh ji li jm lj jq la lb lc ld bi translated"><strong class="iv hj"><em class="le">rdd comparisons:</em></strong>基类提供函数来比较RDD</li><li id="087a" class="kv kw hi iv b iw lf ja lg je lh ji li jm lj jq la lb lc ld bi translated"><strong class="iv hj"><em class="le">RDDGenerator:</em></strong>为RDD对象的生成器</li><li id="a414" class="kv kw hi iv b iw lf ja lg je lh ji li jm lj jq la lb lc ld bi translated"><strong class="iv hj"><em class="le">data frame Generator:</em></strong>data frame对象的生成器</li><li id="93d0" class="kv kw hi iv b iw lf ja lg je lh ji li jm lj jq la lb lc ld bi translated"><strong class="iv hj"> <em class="le">数据集生成器:</em> </strong>数据集对象的生成器</li></ul></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><p id="5686" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">数据帧/数据集是Apache Spark中最常用的，以提高效率和Spark SQL用例。编写生成任意数据帧的测试用例对于测试极端条件是非常有用的。</p><p id="5f9c" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">我们可以看到一个定制生成器的例子，模拟我们输入数据的性质。</p><p id="4aaa" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">假设我们有一个有四列的表，</p><ul class=""><li id="4cbd" class="kv kw hi iv b iw ix ja jb je kx ji ky jm kz jq la lb lc ld bi translated">名称:字符串(字母数字)</li><li id="a32d" class="kv kw hi iv b iw lf ja lg je lh ji li jm lj jq la lb lc ld bi translated">金额:Double(范围从0到100000)</li><li id="98dd" class="kv kw hi iv b iw lf ja lg je lh ji li jm lj jq la lb lc ld bi translated">描述:字符串(大写字母)</li><li id="7ccd" class="kv kw hi iv b iw lf ja lg je lh ji li jm lj jq la lb lc ld bi translated">标志:字符串(“Y”或“N”)</li></ul><p id="373b" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">现在，使用<strong class="iv hj"> Spark-Testing-Base : </strong>生成符合上述标准的数据帧非常简单</p><p id="d02c" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">让我们为我们的表定义一个模式(StructType):</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="73f9" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">现在，我们将为每个列定义生成器，这些生成器是自定义的，可以是基于我们领域的任何内容</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div><figcaption class="lq lr et er es ls lt bd b be z dx translated">new Column()是一个util类，用于定义稍后在DataFrameGenerators上使用的CustomGenerator</figcaption></figure><p id="c700" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">一旦我们为每个列创建了模式和定制生成器，我们将定义DataFrameGenerator来创建具有定义标准的数据</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="d08c" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">上述方法产生了一个任意的数据帧，该数据帧具有数据中定义的模糊性。现在，用上面的数据框架测试代码非常简单。</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="5a4e" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">使用<em class="le"> forAll() </em>我们可以触发之前创建的data frame generator(<strong class="iv hj"><em class="le">sampledata . generator</em></strong>)并且ScalaCheck提供了DataFrame size、minSuccessful等许多选项。</p><p id="f5b7" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><em class="le">参考</em> : <a class="ae jr" rel="noopener" href="/@subashprabakar/property-based-testing-scalatest-scalacheck-52261a2b5c2c">基于属性的测试</a>了解<a class="ae jr" href="https://www.scalacheck.org/" rel="noopener ugc nofollow" target="_blank"> ScalaCheck </a>的使用方法</p></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><p id="af9c" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">生成的样本数据帧如下:</p><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es lu"><img src="../Images/ac9b84b4b1da4a8b2e303eaa703426aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MmDFL9yvbBsSXMYY5fsgBQ.png"/></div></div></figure><p id="5190" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">现在使用上面的生成器——我们可以生成数据帧，它可以在我们的测试用例中进一步用来验证我们的代码。</p><p id="6a86" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Spark测试库提供了一些更强大的基类，非常有助于快速高效地编写测试代码。</p></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><p id="5bab" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hj">参考:</strong></p><p id="b074" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><em class="le">完整代码:</em></p><div class="lz ma ez fb mb mc"><a href="https://github.com/subashprabanantham/hakuna-matata/tree/master/spark-testing-base" rel="noopener  ugc nofollow" target="_blank"><div class="md ab dw"><div class="me ab mf cl cj mg"><h2 class="bd hj fi z dy mh ea eb mi ed ef hh bi translated">subashprabanantham/hakuna-matata</h2><div class="mj l"><h3 class="bd b fi z dy mh ea eb mi ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mk l"><p class="bd b fp z dy mh ea eb mi ed ef dx translated">github.com</p></div></div></div></a></div><p id="58fb" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><em class="le">火花测试基地:</em></p><div class="lz ma ez fb mb mc"><a href="https://github.com/holdenk/spark-testing-base" rel="noopener  ugc nofollow" target="_blank"><div class="md ab dw"><div class="me ab mf cl cj mg"><h2 class="bd hj fi z dy mh ea eb mi ed ef hh bi translated">霍尔登克/火花测试基地</h2><div class="mj l"><h3 class="bd b fi z dy mh ea eb mi ed ef dx translated">用Spark编写测试时使用的基类。您已经在Spark中编写了一个很棒的程序，现在是时候编写了…</h3></div><div class="mk l"><p class="bd b fp z dy mh ea eb mi ed ef dx translated">github.com</p></div></div><div class="ml l"><div class="mm l mn mo mp ml mq ik mc"/></div></div></a></div></div></div>    
</body>
</html>