<html>
<head>
<title>Building an awesome RESTful APIs with Coldfusion</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Coldfusion构建出色的RESTful APIs</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/building-an-awesome-restful-apis-with-coldfusion-86422f6b2b6f?source=collection_archive---------1-----------------------#2020-01-15">https://medium.com/analytics-vidhya/building-an-awesome-restful-apis-with-coldfusion-86422f6b2b6f?source=collection_archive---------1-----------------------#2020-01-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="f369" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">一个超级简单有趣的构建微服务的方法！</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/93bcf1d7141f2f5a38d5e727a8968764.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OFCG0dBMmv0rc-o2Z1VAig.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">马丁·施瑞德在<a class="ae jn" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="447f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">ColdFusion是制作web应用程序和REST APIs的优秀编程语言。ColdFusion应用程序服务器为我们提供了易于使用的web界面，可以手动或编程方式注册REST服务。</p><p id="8f44" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在本文中，我将使用Jason Steinshouer编写的<a class="ae jn" href="https://github.com/jsteinshouer/cf-jwt-simple" rel="noopener ugc nofollow" target="_blank"> CF-JWT-Simple </a>构建一个简单的ColdFusion REST API和JWT认证。</p><h2 id="20c3" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated"><strong class="ak">工具&amp;所需应用</strong></h2><ul class=""><li id="8b07" class="lf lg hi jq b jr lh ju li jx lj kb lk kf ll kj lm ln lo lp bi translated">ColdFusion 2018应用服务器</li><li id="4489" class="lf lg hi jq b jr lq ju lr jx ls kb lt kf lu kj lm ln lo lp bi translated">邮递员</li><li id="e02d" class="lf lg hi jq b jr lq ju lr jx ls kb lt kf lu kj lm ln lo lp bi translated">你最喜欢的IDE</li></ul><h2 id="a5b4" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated"><strong class="ak"> <em class="lv">让我们开始吧……</em></strong></h2><p id="9887" class="pw-post-body-paragraph jo jp hi jq b jr lh ij jt ju li im jw jx lw jz ka kb lx kd ke kf ly kh ki kj hb bi translated">我们将首先在您的coldfusion wwwroot文件夹中创建一个新的项目文件夹。我将这个项目命名为<strong class="jq hj"> <em class="lz"> restdemo </em> </strong>。让我们在根文件夹中创建另一个文件夹，并将其命名为<strong class="jq hj"> <em class="lz"> restapi </em> </strong>，所有restapi都将驻留在这里。请参见下面的项目结构。</p><p id="f2f2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">项目结构</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ma"><img src="../Images/a2e98ebf62472a2ffb005b9302050fa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:456/format:webp/1*kii75VIB-p5vynaKYrVxsg.jpeg"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">项目结构</figcaption></figure><p id="e3ac" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在让我们浏览每个文件和文件夹，并详细讨论其内容。</p><p id="4bb7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> application.cfc </strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mb"><img src="../Images/bfb301818ffb6759495feb5a8d692842.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OeXytK1cXnGBSf3UNKsWYQ.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">应用程序. cfc</figcaption></figure><p id="f125" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">上面第4行的代码片段声明项目名称为<strong class="jq hj"> <em class="lz"> cfrestdemo </em> </strong>，后面是第5行&amp; 6行<strong class="jq hj"> <em class="lz"> restsettings </em> </strong>配置。</p><p id="156a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"><em class="lz">on application start</em></strong>方法在第9行声明了一个应用程序变量<strong class="jq hj"> <em class="lz"> jwtkey </em> </strong>，在第10行声明了<strong class="jq hj"><em class="lz">restInitApplication</em></strong>方法，这有助于我们注册/重新注册REST服务。我们还可以指定一个替代字符串，它可以在调用REST服务时用作应用程序名称。所以，这里我给它起了个名字叫<strong class="jq hj"> <em class="lz">控制器</em> </strong>。</p><p id="7d04" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这种方法在开发环境和生产环境中都很方便，在生产环境中，我们无法访问ColdFusion Administrator。</p><p id="7a77" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> <em class="lz"> onRequestStart </em> </strong>方法什么都不做，除非它遇到URL变量<strong class="jq hj"> <em class="lz"> reload </em> </strong>的值为<em class="lz"> "r3l0ad" </em>。这将触发ApplicationStart  方法上的<strong class="jq hj">，该方法注册/重新注册我们的REST服务并显示一个<em class="lz"> alertbox </em>和一条消息<em class="lz">“应用程序已刷新”</em>。</strong></p><blockquote class="mc md me"><p id="1ff5" class="jo jp lz jq b jr js ij jt ju jv im jw mf jy jz ka mg kc kd ke mh kg kh ki kj hb bi translated"><strong class="jq hj">注意:</strong>为了简洁起见，我排除了其他application.cfc方法。</p></blockquote><p id="fb8e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> index.cfm </strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/fcbb4f7df39472a8abc5b52edef21f9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RreUA1UBPCgDEjzccsXGCQ.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">index.cfm</figcaption></figure><p id="8e96" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">上面的文件没做什么，只是显示了REST API路径和应用程序根路径。这个文件的唯一目的是调用<em class="lz"> application.cfc </em>，当我们在浏览器中运行<em class="lz"> index.cfm </em>时会自动调用。</p><p id="bd9b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">index.html</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mj"><img src="../Images/9fd7fdbd759da944bef0f3c03c016475.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7qUDWxZBq74l6l9yHm1bfg.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">index.html</figcaption></figure><p id="1d86" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在spa时代，没有必要创造任何<em class="lz">。cfm </em>文件。所有的UI屏幕和逻辑都可以使用任何这样的前端框架来构建，所以我们仍然可以通过使用上面的技巧来调用我们的<em class="lz"> index.cfm </em>文件。</p><p id="d407" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> controller.cfc </strong></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="ad0c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"><em class="lz">controller . CFC</em></strong>是REST API，因为它被标记为<em class="lz"> rest="true" </em>，它的别名是<em class="lz"> APIroutes </em>。所以REST API路径会是<a class="ae jn" href="http://{server_name}/rest/controller/APIroutes/" rel="noopener ugc nofollow" target="_blank"><em class="lz">http://{服务器名}/REST/controller/API routes/</em></a></p><p id="e809" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">该组件还导入了<strong class="jq hj"> <em class="lz"> user.cfc </em> </strong>，其中包含了访问用户相关数据的方法。</p><p id="a86c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> <em class="lz">验证</em> </strong>方法用于验证JWT令牌，它在所有安全API中调用，用户必须登录才能访问任何服务器资源。该方法在http headers参数中查找授权密钥，以验证其有效性。</p><p id="3688" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> <em class="lz">登录</em> </strong>方法是一个不安全的API，它方便用户使用POST动词使用他们的登录凭据登录到他们的帐户。</p><p id="9b27" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> <em class="lz"> getuser </em> </strong>方法是一个安全的API，它获取用户的详细信息，其id使用GET动词在API路径中传递。</p><p id="9820" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> user.cfc </strong></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="5c5a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> <em class="lz"> user.cfc </em> </strong>是一个简单的coldfusion组件，可以访问数据库等服务器资源。</p><p id="c033" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> <em class="lz"> loginUser </em> </strong>方法根据数据库验证用户凭证，并生成<em class="lz"> JWT令牌</em>，返回给客户端。客户端在本地存储这个JWT令牌(在一个cookie或本地存储中)，并通过任何安全API调用将其作为一个<em class="lz">授权</em>头参数发送。</p><p id="7c9e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> <em class="lz"> userDetails </em> </strong>方法返回其id作为参数传递的任何用户的用户详细信息。</p><p id="60a2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> jwt.cfc </strong></p><p id="440e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> <em class="lz"> jwt.cfc </em> </strong>是CFML组件的<a class="ae jn" href="https://github.com/jsteinshouer/cf-jwt-simple/blob/master/jwt.cfc" rel="noopener ugc nofollow" target="_blank">库</a>，用于编码和解码<a class="ae jn" href="http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html" rel="noopener ugc nofollow" target="_blank"> JSON Web Tokens (JWT) </a>。</p></div><div class="ab cl mm mn gp mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="hb hc hd he hf"><h1 id="6e6c" class="mt kl hi bd km mu mv mw kq mx my mz ku io na ip kx ir nb is la iu nc iv ld nd bi translated">是时候看看我们的代码了</h1><p id="2e5b" class="pw-post-body-paragraph jo jp hi jq b jr lh ij jt ju li im jw jx lw jz ka kb lx kd ke kf ly kh ki kj hb bi translated">我们将从在web浏览器中执行<a class="ae jn" href="http://localhost:{your" rel="noopener ugc nofollow" target="_blank"><em class="lz">http://localhost:</em></a><em class="lz">8501/rest demo/index . html</em>开始。这将在内部触发<em class="lz"> index.cfm </em>，它将自动调用<em class="lz"> application.cfc </em>。因此，这将在ColdFusion Administrator中注册我们的REST服务。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ne"><img src="../Images/31cb2ee0b4771347c3f0abb96617645a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ML5Ta2YdT3HBbBwLbtGgFg.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">在浏览器中运行index.html会注册REST APIs</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nf"><img src="../Images/8a00655075d1d453b00c5e8454fda52c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*giibJblLSuAy1XiKb30yaQ.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">REST API在ColdFusion管理器中注册成功</figcaption></figure><h2 id="940a" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">用Postman测试REST API</h2><p id="1d55" class="pw-post-body-paragraph jo jp hi jq b jr lh ij jt ju li im jw jx lw jz ka kb lx kd ke kf ly kh ki kj hb bi translated"><a class="ae jn" href="http://localhost:8501/rest/controller/APIroutes/login" rel="noopener ugc nofollow" target="_blank"><em class="lz">http://localhost:8501/rest/controller/API routes/log in</em></a>可以在没有<em class="lz"> authorization </em>头的情况下调用，因为它是一个非安全API，调用它是为了让用户使用其登录凭证登录。</p><p id="2c98" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这个API使用POST方法，由于我们并不真正根据任何数据库来验证用户凭证，所以我们在请求体中发送一个虚拟的原始JSON对象。</p><p id="dcc6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果用户登录成功，该API将返回一条<em class="lz">“登录成功”</em>消息和一个JWT令牌，或者如果登录不成功，它将返回一条<em class="lz">“不正确的登录凭证”</em>消息。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ng"><img src="../Images/93886edc24e38afec546b62e350067dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BcLnOaEN80E8oq0sfOX1IA.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">用邮递员发送邮寄请求</figcaption></figure><p id="8be8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><a class="ae jn" href="http://localhost:8501/rest/controller/APIroutes/user/1" rel="noopener ugc nofollow" target="_blank"><em class="lz">http://localhost:8501/rest/controller/API routes/user/1</em></a><em class="lz">2</em>必须用授权头调用，因为是安全API。这里<em class="lz">userid</em>‘12’只是一个伪id，但它是一个强制参数。</p><p id="6413" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="lz">授权</em>头参数值必须是JWT令牌，在成功登录后，由<a class="ae jn" href="http://localhost:8501/rest/controller/APIroutes/login" rel="noopener ugc nofollow" target="_blank"><em class="lz">http://localhost:8501/rest/controller/API routes/log in</em></a><em class="lz"/>API返回。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ng"><img src="../Images/591cef06f8a5c65b5e6aba2d0574acd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X7Fwnc3CX3CJ6wcy7_vKNA.jpeg"/></div></div></figure></div><div class="ab cl mm mn gp mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="hb hc hd he hf"><h1 id="eac2" class="mt kl hi bd km mu mv mw kq mx my mz ku io na ip kx ir nb is la iu nc iv ld nd bi translated">结论</h1><p id="2991" class="pw-post-body-paragraph jo jp hi jq b jr lh ij jt ju li im jw jx lw jz ka kb lx kd ke kf ly kh ki kj hb bi translated">正如你所看到的，就像NodeJS一样，ColdFusion是另一个非常容易创建微服务的好选择。在上面的文章中，为了使这篇文章简洁明了，我只演示了两个API。</p><p id="ee35" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你可以看我的<a class="ae jn" href="https://www.youtube.com/watch?v=4GkXanOqH88" rel="noopener ugc nofollow" target="_blank"> YouTube教程</a>，我在里面详细解释了所有的CRUD操作。</p><p id="d9a9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我希望你会喜欢读我的文章，请告诉我你的想法。</p></div></div>    
</body>
</html>