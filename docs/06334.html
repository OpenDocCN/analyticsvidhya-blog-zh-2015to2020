<html>
<head>
<title>Visualizing Convolution Neural Network [The Hidden Truth]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可视化卷积神经网络[隐藏的真相]</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/visualizing-convolution-neural-network-the-hidden-truth-c825d69f1832?source=collection_archive---------20-----------------------#2020-05-18">https://medium.com/analytics-vidhya/visualizing-convolution-neural-network-the-hidden-truth-c825d69f1832?source=collection_archive---------20-----------------------#2020-05-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="106b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对计算机视觉、深度学习感兴趣的人，这可能很有见地</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/08e3f3fb9c88c8de83fa237a2ab262e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y9_2Ts0U3adbQFyT.jpg"/></div></div></figure><p id="3c0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在人们为计算机视觉任务建立各种复杂的神经网络，其中一个主要任务就是图像分类。但是如果你知道如何编码，制作一个模型是简单的，但是最终，你永远不知道网络里面有什么。这就像一个<strong class="ih hj">黑盒</strong>，你像<strong class="ih hj">魔术</strong>一样向其中输入并获得输出。当你实际传递一个特定的输入时，了解网络内部的实际情况是很重要的,<strong class="ih hj">网络如何做出反应并产生有利的结果。</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jp"><img src="../Images/b54cd901790f692a69f3ba0a38fd7d48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1W3rl03-3dy6KqLD"/></div></div></figure><p id="5c2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个博客将指导你使用最流行的机器学习库<a class="ae jq" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Tensorflow </strong> </a> <strong class="ih hj">来可视化你自己创建的模型。</strong>本教程分为两部分:</p><p id="2027" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 1。建立并训练一个模型</strong></p><p id="58cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。在内部可视化模型</strong></p><h1 id="f864" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">建立和训练模型</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kp"><img src="../Images/b3db0ae943516cc1015584fa6d89ec22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/0*SGHYhJLkr1tTiWXL"/></div></figure><p id="16d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤1:下载并处理数据</p><p id="3fe4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于这个例子，我们将使用世界闻名的数字的<a class="ae jq" href="https://www.tensorflow.org/datasets/catalog/mnist" rel="noopener ugc nofollow" target="_blank"> MNIST数据集</a>，也称为修改后的国家标准与技术研究所数据集，使它简单而简短。</p><p id="3154" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">导入重要库</strong></p><pre class="je jf jg jh fd kq kr ks kt aw ku bi"><span id="931f" class="kv js hi kr b fi kw kx l ky kz">import tensorflow as tf<br/>import matplotlib.pyplot as plt<br/>import random<br/>import numpy as np</span></pre><p id="8e1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用于构建网络和数据集的Tensorflow</p><p id="3fd6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用于绘制图形和可视化的Matplotlib</p><p id="c179" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Random用于生成随机数</p><p id="2f17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">下载数据</strong></p><pre class="je jf jg jh fd kq kr ks kt aw ku bi"><span id="7bbe" class="kv js hi kr b fi kw kx l ky kz">mnist_data = tf.keras.datasets.mnist</span><span id="891f" class="kv js hi kr b fi la kx l ky kz">(train_images,train_labels),(test_images,test_labels) = mnist_data.load_data()</span><span id="0ffc" class="kv js hi kr b fi la kx l ky kz">print("No of training exapmles "+str(train_images.shape[0]))<br/>print("No of Test exapmles "+str(test_images.shape[0]))<br/>print("Shape of Each Image "+str(train_images[0].shape))</span><span id="538d" class="kv js hi kr b fi la kx l ky kz">'''<br/>No of training exapmles 60000</span><span id="0c56" class="kv js hi kr b fi la kx l ky kz">No of Test exapmles 10000</span><span id="52e6" class="kv js hi kr b fi la kx l ky kz">Shape of Each Image (28, 28)<br/></span></pre><p id="e88f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查看图像</p><pre class="je jf jg jh fd kq kr ks kt aw ku bi"><span id="7ef6" class="kv js hi kr b fi kw kx l ky kz">def disp():<br/>    id = random.randint(0,train_images.shape[0])<br/>    img = train_images[id]<br/>    l = train_labels[id]<br/>    plt.imshow(img)<br/>    print("This is image of Number "+str(l))<br/>disp()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lb"><img src="../Images/0e3c62e68da0ddf88a8740f89a1932ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:312/format:webp/1*z9OV9Wki0nYDKbjKHd1jXQ.png"/></div><figcaption class="lc ld et er es le lf bd b be z dx translated">这是一个数字为0的图像</figcaption></figure><p id="972f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个图像是28×28像素图像的2d阵列</p><p id="408e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">对输入数据进行预处理</strong></p><pre class="je jf jg jh fd kq kr ks kt aw ku bi"><span id="9503" class="kv js hi kr b fi kw kx l ky kz">train_images=train_images.reshape(train_images.shape[0],28,28,1)/255test_images = test_images.reshape(test_images.shape[0],28,28,1)/255</span></pre><p id="7c7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这样做是因为TensorFlow中的Conv2D层接受图像的(高度，重量，1)形状，而不是(高度，宽度)</p><pre class="je jf jg jh fd kq kr ks kt aw ku bi"><span id="6f6e" class="kv js hi kr b fi kw kx l ky kz">print("Shape of Each Image "+str(train_images[0].shape))</span><span id="7a54" class="kv js hi kr b fi la kx l ky kz">'''<br/>Shape of Each Image (28, 28, 1)<br/>'''</span></pre><p id="2ec3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们已经成功地改变了形状，并为向模型中发送输入做好了准备。相信我，这是机器学习中最关键的一步，总是验证输入的形状，并检查它是否与模型的输入形状相匹配，否则无论你做了什么，你做了多复杂，如果形状不对，一切都会崩溃</p><p id="431e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第二步。制作模型</strong></p><pre class="je jf jg jh fd kq kr ks kt aw ku bi"><span id="c98d" class="kv js hi kr b fi kw kx l ky kz">model = tf.keras.models.Sequential()</span><span id="278c" class="kv js hi kr b fi la kx l ky kz">model.add(tf.keras.layers.Conv2D(filters=32,kernel_size=(3,3),activation='relu',input_shape=(28,28,1)))</span><span id="a9cd" class="kv js hi kr b fi la kx l ky kz">model.add(tf.keras.layers.MaxPool2D((2,2)))</span><span id="6b1d" class="kv js hi kr b fi la kx l ky kz">model.add(tf.keras.layers.Dropout(0.3))</span><span id="b6a6" class="kv js hi kr b fi la kx l ky kz">model.add(tf.keras.layers.Conv2D(filters=64,kernel_size=(3,3),activation='relu',input_shape=(28,28,1)))</span><span id="cf20" class="kv js hi kr b fi la kx l ky kz">model.add(tf.keras.layers.MaxPool2D((2,2)))</span><span id="a75c" class="kv js hi kr b fi la kx l ky kz">model.add(tf.keras.layers.Dropout(0.3))</span><span id="c160" class="kv js hi kr b fi la kx l ky kz">model.add(tf.keras.layers.Conv2D(filters=128,kernel_size=(3,3),activation='relu',input_shape=(28,28,1)))</span><span id="f410" class="kv js hi kr b fi la kx l ky kz">model.add(tf.keras.layers.MaxPool2D((2,2)))</span><span id="5789" class="kv js hi kr b fi la kx l ky kz">model.add(tf.keras.layers.Dropout(0.3))</span><span id="598f" class="kv js hi kr b fi la kx l ky kz">model.add(tf.keras.layers.Flatten())</span><span id="9f7a" class="kv js hi kr b fi la kx l ky kz">model.add(tf.keras.layers.Dense(128,activation='relu'))</span><span id="f176" class="kv js hi kr b fi la kx l ky kz">model.add(tf.keras.layers.Dense(10,activation='softmax'))</span><span id="d1b9" class="kv js hi kr b fi la kx l ky kz">model.summary()</span></pre><p id="5d49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Conv2D、MaxPool2D、Dropout、Dense、Flatten是TensorFlow <a class="ae jq" href="https://www.tensorflow.org/guide/keras" rel="noopener ugc nofollow" target="_blank"> Keras </a>实现给我们的基本积木。</p><h1 id="adf2" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">我们的建筑</h1><pre class="je jf jg jh fd kq kr ks kt aw ku bi"><span id="48fc" class="kv js hi kr b fi kw kx l ky kz">Model: "sequential"<br/>_________________________________________________________________<br/>Layer (type)                 Output Shape              Param #<br/>=================================================================<br/>conv2d (Conv2D)              (None, 26, 26, 32)        320<br/>_________________________________________________________________<br/>max_pooling2d (MaxPooling2D) (None, 13, 13, 32)        0<br/>_________________________________________________________________<br/>dropout (Dropout)            (None, 13, 13, 32)        0<br/>_________________________________________________________________<br/>conv2d_1 (Conv2D)            (None, 11, 11, 64)        18496<br/>_________________________________________________________________<br/>max_pooling2d_1 (MaxPooling2 (None, 5, 5, 64)          0<br/>_________________________________________________________________<br/>dropout_1 (Dropout)          (None, 5, 5, 64)          0<br/>_________________________________________________________________<br/>conv2d_2 (Conv2D)            (None, 3, 3, 128)         73856<br/>_________________________________________________________________<br/>max_pooling2d_2 (MaxPooling2 (None, 1, 1, 128)         0<br/>_________________________________________________________________<br/>dropout_2 (Dropout)          (None, 1, 1, 128)         0<br/>_________________________________________________________________<br/>flatten (Flatten)            (None, 128)               0<br/>_________________________________________________________________<br/>dense (Dense)                (None, 128)               16512<br/>_________________________________________________________________<br/>dense_1 (Dense)              (None, 10)                1290<br/>=================================================================<br/>Total params: 110,474<br/>Trainable params: 110,474</span></pre><p id="fdeb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仔细观察输出形状。这是我们模型的架构，不是一个花哨的模型，而是一个体面的模型。我在制作各种模型时了解到，内核的形状和过滤器的数量遵循一种简单的模式，这种模式似乎总是很好，将过滤器的数量增加2倍，并将内核大小保持为奇数</p><p id="d8bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第三步:最激动人心的一步，训练步骤</strong></p><pre class="je jf jg jh fd kq kr ks kt aw ku bi"><span id="d2c3" class="kv js hi kr b fi kw kx l ky kz">checkpointer = tf.keras.callbacks.ModelCheckpoint(filepath="best_weights.hdf5",<br/>monitor = 'val_accuracy',verbose=1,save_best_only=True)</span><span id="9eaf" class="kv js hi kr b fi la kx l ky kz">es=tf.keras.callbacks.EarlyStopping(monitor='val_loss',patience=2)</span><span id="6b41" class="kv js hi kr b fi la kx l ky kz">model.compile(optimizer='adam',loss='sparse_categorical_crossentropy',metrics=['accuracy'])</span><span id="a071" class="kv js hi kr b fi la kx l ky kz">history=model.fit(train_images,train_labels,batch_size=128,<br/>   validation_data=(test_images,test_labels),epochs=100,<br/>   callbacks=[checkpointer,es])</span></pre><p id="9081" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们使用一些<a class="ae jq" href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">回调函数</strong> </a>，这是TensorFlow提供的最有用的工具，它帮助你在模型工作时与模型交互，而不是让你失去模型，如果出现任何问题，我使用的回调是<a class="ae jq" href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/EarlyStopping" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">提前停止</strong> </a> <strong class="ih hj"> </strong>，它帮助我在最大2个时期内验证损失没有变化时停止，这导致停止训练并避免过度拟合，我使用的另一个回调是<a class="ae jq" href="https://www.tensorflow.org/guide/checkpoint" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">检查指针</strong>你甚至可以在没有这个的情况下训练，但是当你对要设置的纪元数量感到困惑时，这个会有所帮助。我已经使用了最常见和最可靠的优化器</a><a class="ae jq" href="https://www.tensorflow.org/api_docs/python/tf/keras/optimizers/Adam" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Adam优化器</strong> </a>。我故意使用稀疏分类交叉熵，因为我们的输出不是1–10，它得到1–10的实际概率是(1x10)的输出大小，其中每个no是得到该数字的概率，例如[0.1，0.1，0.1，0.1，0.1，0.9，0.1，0.1，0.1]</p><p id="cfdd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这表明这个数字有90%的可能性是<strong class="ih hj"> 6 </strong></p><p id="a62e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第四步:观看我们的火车模型</p><p id="dced" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a.失败</p><pre class="je jf jg jh fd kq kr ks kt aw ku bi"><span id="615f" class="kv js hi kr b fi kw kx l ky kz">plt.plot(history.history[‘loss’])<br/>plt.plot(history.history[‘val_loss’])<br/>plt.xlabel(‘Epochs’)<br/>plt.ylabel(‘Loss’)<br/>plt.title(‘Loss Graph’)<br/>plt.legend((‘train’,’test’))</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lg"><img src="../Images/5215dd79e75cee4eccbf0fde1162c502.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*bwGtGsJ3UiBZmyHjfUq1JA.png"/></div></figure><p id="1200" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b.准确(性)</p><pre class="je jf jg jh fd kq kr ks kt aw ku bi"><span id="3263" class="kv js hi kr b fi kw kx l ky kz">plt.plot(history.history[‘accuracy’])<br/>plt.plot(history.history['val_accuracy'])<br/>plt.xlabel('Epochs')<br/>plt.ylabel('Loss')<br/>plt.title('Loss Graph')<br/>plt.legend(('train','test'))</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lh"><img src="../Images/6e77cf1513ccfe8ffcf96e058475c295.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*a7gbwV6MRStAOSjqlEKIJg.png"/></div></figure><p id="296a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们观察到，该模型相当不错，训练和测试准确率分别为98.22 %和98.9 %。看到损失后，你可能会说，训练和确认损失相差很大，这样够好了吗？但是观察左边的刻度，可以看到测试损失很小，这表明它概括得更好</p><p id="81f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第六步:预测</strong></p><p id="eb9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们做这个步骤，实际上是这个算法的任务，预测数字</p><pre class="je jf jg jh fd kq kr ks kt aw ku bi"><span id="2511" class="kv js hi kr b fi kw kx l ky kz">def disp_pred():<br/> id = random.randint(0,test_images.shape[0])<br/> img = test_images[id]<br/> #print(img.shape)<br/> l = test_labels[id]<br/> plt.imshow(img.reshape(28,28))<br/> print("This is image of Number "+str(l))<br/> print("This is Predicted to be Number    "+str(np.argmax(model.predict(img.reshape(1,28,28,1)))))<br/>disp_pred()</span><span id="d8f7" class="kv js hi kr b fi la kx l ky kz">'''<br/>This is image of Number 5<br/>This is Predicted to be Number 5<br/>'''</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es li"><img src="../Images/9e81e908822ac4b6d2aacdf2c106794a.png" data-original-src="https://miro.medium.com/v2/resize:fit:336/format:webp/1*ryYhFA5I1N78oUY3YQjrIw.png"/></div><figcaption class="lc ld et er es le lf bd b be z dx translated">这是数字5，预计是数字5</figcaption></figure><h1 id="ef33" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">现在让我们开始这篇文章所针对的步骤</h1><p id="9c27" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">第一步。我们首先要决定哪一层的激活我们想要可视化，并建立我们的激活模型。</p><p id="274a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，在我的架构中，从[0:8]，即从conv2d到dropout_2d</p><pre class="je jf jg jh fd kq kr ks kt aw ku bi"><span id="136b" class="kv js hi kr b fi kw kx l ky kz">Model: "sequential"<br/>_________________________________________________________________<br/>Layer (type)                 Output Shape              Param #<br/>=================================================================<br/>conv2d (Conv2D)              (None, 26, 26, 32)        320<br/>_________________________________________________________________<br/>max_pooling2d (MaxPooling2D) (None, 13, 13, 32)        0<br/>_________________________________________________________________<br/>dropout (Dropout)            (None, 13, 13, 32)        0<br/>_________________________________________________________________<br/>conv2d_1 (Conv2D)            (None, 11, 11, 64)        18496<br/>_________________________________________________________________<br/>max_pooling2d_1 (MaxPooling2 (None, 5, 5, 64)          0<br/>_________________________________________________________________<br/>dropout_1 (Dropout)          (None, 5, 5, 64)          0<br/>_________________________________________________________________<br/>conv2d_2 (Conv2D)            (None, 3, 3, 128)         73856<br/>_________________________________________________________________<br/>max_pooling2d_2 (MaxPooling2 (None, 1, 1, 128)         0<br/>_________________________________________________________________<br/>dropout_2 (Dropout)          (None, 1, 1, 128)         0<br/>_________________________________________________________________<br/>flatten (Flatten)            (None, 128)               0<br/>_________________________________________________________________<br/>dense (Dense)                (None, 128)               16512<br/>_________________________________________________________________<br/>dense_1 (Dense)              (None, 10)                1290<br/>=================================================================</span></pre><p id="cc9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">列出我们需要的图层</p><pre class="je jf jg jh fd kq kr ks kt aw ku bi"><span id="c98b" class="kv js hi kr b fi kw kx l ky kz">layer_outputs = [layer.output for layer <strong class="kr hj">in</strong> model.layers[0:8]]<br/>activation_model = tf.keras.Model(inputs=model.input,<br/> outputs=layer_outputs)</span></pre><p id="8661" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤2:我们现在从测试数据集中选择一个随机图像，我们将在其上使用我们的激活模型。</p><pre class="je jf jg jh fd kq kr ks kt aw ku bi"><span id="e1bc" class="kv js hi kr b fi kw kx l ky kz">img = test_images[51].reshape(1,28,28,1)</span></pre><p id="67e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤3:我们现在使用我们的激活模型来输出所选层的激活。</p><pre class="je jf jg jh fd kq kr ks kt aw ku bi"><span id="3f36" class="kv js hi kr b fi kw kx l ky kz">activations = activation_model.predict(img)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lo"><img src="../Images/130bf823571cf336b4799793ede117e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:352/format:webp/1*0Zzx2b-3pGJcR_wwMXlfRg.png"/></div></figure><p id="02a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第四步:使用Matplotlib可视化每一层</p><p id="cb11" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图层的名称，这样您就可以将它们作为绘图的一部分</p><pre class="je jf jg jh fd kq kr ks kt aw ku bi"><span id="3b4f" class="kv js hi kr b fi kw kx l ky kz">layer_names = []<br/>for layer in model.layers[0:8]:<br/>    layer_names.append(layer.name)</span></pre><p id="ea82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">显示要素地图</p><pre class="je jf jg jh fd kq kr ks kt aw ku bi"><span id="bb9b" class="kv js hi kr b fi kw kx l ky kz">images_per_row = 16</span><span id="708a" class="kv js hi kr b fi la kx l ky kz">for layer_name, layer_activation in zip(layer_names, activations):<br/>    n_features = layer_activation.shape[-1]<br/>    size = layer_activation.shape[1]<br/>    n_cols = n_features <br/>    display_grid = np.zeros((size * n_cols, images_per_row * size))</span><span id="4aa2" class="kv js hi kr b fi la kx l ky kz">    for col in range(n_cols): <br/>        for row in range(images_per_row):</span><span id="b200" class="kv js hi kr b fi la kx l ky kz">            channel_image = layer_activation[0,:, :,col *   images_per_row + row]</span><span id="eaa4" class="kv js hi kr b fi la kx l ky kz">           channel_image -= channel_image.mean()<br/>           channel_image /= channel_image.std()<br/>           channel_image *= 64<br/>           channel_image += 128<br/>           channel_image = np.clip(channel_image, 0, 255).astype('uint8')<br/>           display_grid[col * size : (col + 1) * size, row * size : (row + 1) * size] = channel_image<br/>     scale = 1. / size<br/>     plt.figure(figsize=(scale * display_grid.shape[1],<br/>     scale * display_grid.shape[0]))<br/>     plt.title(layer_name)<br/>     plt.grid(False)<br/>     plt.imshow(display_grid, aspect='auto', cmap='viridis')</span></pre><p id="3699" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一层</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/13b3580c9b59fc7448d5f2ff04e765dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0DAafwI8mlFCmoEAVGnwmw.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/d4e22bec741b159bc3e3b78897931038.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QFYcHF7wUWMUiY0CNvhECA.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/38c14cbef9377b2d9766feb24a39cf02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YmZaUZ2ROWlWxTxmL-ZIUg.png"/></div></div></figure><p id="e7d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第二层</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/e49169e3645b2dc1c058333f7ee2fe97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ByDIoeMWnYk8FIVHfLNFfA.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/9890bfe200f2a66b7010f6671f3eeb27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zAAEQRIjCtUKXP0Z4FvxKg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/8dfdd291c79af4c0a94e03682cfd78fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VWMBvIpRcoe7q6FP-jwimA.png"/></div></div></figure><p id="aca5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第三层</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/f4ce2c60bf4a83673acff53e36baa095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yfwLbgUR7BpQ0qIgOg_6lQ.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/a00d32461b8d31c47d1a83dbf0df791c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IjqFISzMspqGIXewkMhOww.png"/></div></div></figure><p id="79eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们观察第1、2、3层中的所有滤镜，数量为32、64、128个滤镜，以及它们如何对数字3的图像做出反应</p><p id="bf2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这实际上有助于可视化深层对图像的反应，以及这些特征实际上如何有助于给出预测</p><p id="570d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这篇文章能帮助你理解卷积网络</p><p id="9613" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">快乐的深度学习</p></div></div>    
</body>
</html>