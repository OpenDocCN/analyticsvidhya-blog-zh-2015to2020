<html>
<head>
<title>Can we use XGBoost to predict public housing price in Singapore? (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们能用XGBoost预测新加坡的公共住房价格吗？(第一部分)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/can-we-use-xgboost-to-predict-public-housing-price-in-singapore-part-1-f58200981fca?source=collection_archive---------12-----------------------#2020-11-24">https://medium.com/analytics-vidhya/can-we-use-xgboost-to-predict-public-housing-price-in-singapore-part-1-f58200981fca?source=collection_archive---------12-----------------------#2020-11-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="b757" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">R中的极端梯度推进分析</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/f9e9f2a70a55c87b9c702a8b49ef5238.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r61837xoNMkn5QCuS7TgtA.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">图片来源:来自<a class="ae jn" href="https://pixabay.com/photos/bridge-bishan-park-bishanpark-1931388/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的孔文五</figcaption></figure><p id="c5f6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最近，我的一个亲戚决定去HDB的二手房市场找房子，他想知道一套三居室公寓的“公允价值”。出于好奇，我想看看能否回答她的问题，并研究是否有可能预测HDB转售市场的房价。</p><h1 id="24cb" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated"><strong class="ak">研究问题</strong></h1><p id="562b" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">(1)HDB一套三居室转售公寓的中位数价格是多少？<br/> (2)解释HDB转售价格的重要变量是什么？<br/> (3)给定物业的一系列特征，我们能多准确地预测HDB转售公寓的价格？</p><h1 id="e80a" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated"><strong class="ak">数据</strong></h1><p id="6d9f" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">三周前，我利用网络搜集技术，从房地产网站99.co获得了一个包含7620个HDB房源的横截面数据集。数据集包含物业级别的变量，如<em class="lh">平方英尺</em>和<em class="lh">卧室数量</em>，以及舒适度级别的变量，如<em class="lh">到最近学校的距离</em>和1公里半径内学校的数量<em class="lh"/>。</p><p id="9783" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> <em class="lh">网络抓取伦理</em> </strong> <br/>明智的做法是先使用<strong class="jq hj"> <em class="lh"> robotstxt </em> </strong>包来检查我们是否被允许从网页上抓取数据。如果<strong class="jq hj"><em class="lh">" paths _ allowed()"</em></strong>的输出为真，则表示我们准备就绪！如果你对网络搜集的技术感兴趣，一定要访问这篇文章的第二部分，在那里我会举例说明如何从99.co获得数据。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="03ae" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">显然，从包含个人信息的网站上抓取数据是不允许的，比如脸书或Instagram。</p><h1 id="2088" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated"><strong class="ak">变量定义</strong></h1><p id="1a29" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">以下是数据集中变量含义的简要概述。我将跳过对那些标准变量的解释，如<strong class="jq hj"><em class="lh">【bedrm】</em></strong>，其中<strong class="jq hj"> <em class="lh"> </em> </strong>指的是房产中卧室的数量。</p><p id="1d50" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"><em class="lh">【lease _ left】</em></strong>指99年租约到期的年数；此后，HDB的所有权将归还给政府。<em class="lh">(是的，你没看错。我们的组屋只向政府租用99年。</em></p><p id="3cee" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"><em class="lh">“dist _ CBD”</em></strong>指物业到中央商务区，或者市中心的距离。</p><p id="c594" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"><em class="lh">【dist _ orchard】</em></strong>指到新加坡黄金购物带的距离。</p><p id="b328" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"><em class="lh">“dist _ mrt”、“dist_park”、“dist _ sch”</em></strong>分别指物业到最近的火车站、公园、学校的距离。</p><p id="4847" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> <em class="lh">“捷运数量”、“公园数量”、“学校数量”</em> </strong>指该物业1公里范围内的火车站、公园和学校数量。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="a1f1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"><em class="lh">“price _ PSF _ 1yr”</em></strong>是指该街区内房产过去一年每平方英尺的成交均价。</p><p id="840e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"><em class="lh">【txn _ count _ 1yr】</em></strong>指过去一年该地块内房产的成交套数。</p><p id="2e52" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果我们看一下<a class="ae jn" href="https://www.hdb.gov.sg/cs/infoweb/residential/buying-a-flat/new/types-of-flats" rel="noopener ugc nofollow" target="_blank"> HDB的网站</a>，HDB的公寓一般分为“2室”、“3室”、“4室”、“5室”和“行政”。<strong class="jq hj"><em class="lh">【new _ house type】</em></strong>体现了这种分类。</p><p id="dc32" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">汇总统计<br/> </strong>我们可以通过<strong class="jq hj"><em class="lh">【new _ house type】</em></strong>对数据进行分组，以获得对平均和中值房价的一些总体看法。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="901e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">乍一看，我怀疑这些数据包含一些异常值。HDB公寓的转售价格很少达到100万美元大关，更不用说了。此外，一套五居室公寓的价格不太可能达到令人瞠目结舌的4500万美元！</p><p id="ce01" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">由于这些是房产中介提供的房源数据，而非官方交易数据，因此可能会有一些无意义的条目。因此，在进行进一步分析之前，谨慎的做法是删除异常值。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="li lj l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lk"><img src="../Images/9662cd96c7a48f542195cc7837eed0d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w6qgywP108Xrlhx2UlRvmA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">作者图片</figcaption></figure><p id="2db8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">既然已经删除了异常值，让我们再来看看汇总统计数据。哪个区的组屋最贵，哪里可以找到更便宜的组屋？</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="9c91" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">给定1，311个观察值的子样本，似乎一套中等的三居室公寓的成本约为438，000美元(基于中值价格)。</p><p id="4b35" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">对于大多数居住在<a class="ae jn" href="https://www.propertyguru.com.sg/property-management-news/2016/3/119296/more-singaporeans-now-living-in-condos-survey#:~:text=Around%2080.1%20percent%20of%20households,room%20flats%20(18.2%20percent)." rel="noopener ugc nofollow" target="_blank">四室公寓</a>的新加坡家庭来说，根据2753个观察子样本，他们的房子在今天的市场上预计可以卖到55万美元左右(基于中值价格)。</p><p id="9a0a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">从地区层面来看，HDB 2区、3区、12区和15区的房价相当高是不足为奇的，因为这些地区靠近市中心。第二区组屋的中位数价格非常接近100万美元！</p><p id="cbd1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">相比之下，组屋往往在23、25、27和28区更实惠，这些区位于新加坡的远北、西北和东北地区。</p><h1 id="7c45" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">用XGBoost算法预测HDB价格</h1><p id="90de" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">现在我们已经查看了汇总统计数据，让我们在实现<strong class="jq hj"> XGBoost </strong>算法之前预处理我们的数据集。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="41d6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">因为XGBoost算法只接受数字变量，所以我必须对数据进行两次转换。“character”类型的变量被删除，而分类变量“district”被转换为多个虚拟变量。例如，位于第28区的HDB公寓如果位于第28区，将被赋值为“1”，否则为“0”。“性格”变量的省略不会影响我们的分析。</p><p id="1447" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，我们可以将数据分为训练集和测试集。我们将使用80%的数据来训练模型，并留出剩余的20%来评估模型的预测准确性。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="cfc3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">为什么是XGBoost？</strong> <br/>首先，XGBoost基于梯度增强框架构建，与现有的梯度增强包相比，在计算速度方面可能快10倍。其次，就预测准确性而言，它是最好的算法之一(基于许多Kaggle数据科学竞赛)。</p><p id="6795" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">对于XGBoost算法背后的数学的直观解释，我建议观看YouTube上的<a class="ae jn" href="https://www.youtube.com/watch?v=OtD8wVaFm6E&amp;ab_channel=StatQuestwithJoshStarmer" rel="noopener ugc nofollow" target="_blank"> StatQuest的视频</a>。它提供了最好的，也是最简单的解释。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="li lj l"/></div></figure><h1 id="47b8" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated"><strong class="ak">上面的参数是什么意思？</strong></h1><p id="c821" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated"><strong class="jq hj"> <em class="lh">目标= 'reg:squarederror' </em> </strong>表示我们面临的是一个回归问题，目标是最小化平方误差。</p><p id="d25c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"><em class="lh">【eta】</em></strong>指模型的学习率。较低的eta值意味着该模型对过拟合更稳健，但计算速度较慢。默认值为0.3。</p><p id="4b67" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"><em class="lh">【n rounds】</em></strong>控制升压迭代的最大次数。根据<a class="ae jn" href="https://cran.r-project.org/web/packages/xgboost/xgboost.pdf" rel="noopener ugc nofollow" target="_blank"> XGBoost手册</a>，较低的eta意味着较大的nrounds值。</p><p id="5f19" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"><em class="lh">【lambda】</em></strong>为正则化参数，默认值为0。</p><p id="dad3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">使用默认值，我们获得了大约4.93%的平均绝对百分比误差(MAPE)，这已经很不错了！让我们看看是否可以通过调整算法做得更好。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="0d56" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这里，我们通过最小化均方根误差(RMSE)指标来要求模型的最佳迭代。虽然MAPE略有改善，达到4.92%，但与之前相比，RMSE的增长更加明显。</p><p id="7e59" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">实际值与预测值的直观对比<br/> </strong>坦率地说，下面的散点图看起来与我非常相似。但是与R平方为0.8774的未调优模型相比，调优模型产生了较低的RMSE和较高的R平方值0.936。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="li lj l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ll"><img src="../Images/e0bbe0ec0082d4215434aa58aafd9d3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V2ljrc8RNKq736ZgbnhhWQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">左:R平方= 0.8774。右:R的平方= 0.936</figcaption></figure><p id="3c39" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">特征重要性<br/> </strong>现在让我们看看特征重要性，看看哪些是解释HDB价格变化的最重要变量。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="li lj l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lm"><img src="../Images/3ffdcccb4bf0c5cf4ce3ce25e569a086.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*syQwAxUKXAc_gJ23GRZbkQ.png"/></div></figure><p id="7355" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"><em class="lh">【price _ PSF _ 1yr】</em></strong><strong class="jq hj"><em class="lh">【sqft】</em></strong>和<strong class="jq hj"><em class="lh">【lease _ left】</em></strong>等变量是解释HDB价格的3个最重要的变量。但是，这种产出有经济意义吗？</p><p id="49a9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">回想一下<strong class="jq hj"><em class="lh">“price _ PSF _ 1yr”</em></strong>是指该区块过去一年的单元平均成交价格。<strong class="jq hj"><em class="lh">【price _ PSF _ 1yr】</em></strong>与HDB价格的相关性为<em class="lh"> 0.696 </em>，这表明过去的交易价格是<em class="lh">【粘性】</em>，买方&amp;卖方隐含地利用它们来形成对HDB市场估值的预期。</p><p id="5a80" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"><em class="lh">【sqft】</em></strong>与HDB价格的相关性为<em class="lh"> 0.44 </em>。这相当简单；房子越大，市场价格越高。</p><p id="a710" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"><em class="lh">【lease _ left】</em></strong>与HDB价格的相关性为<em class="lh"> 0.345 </em>，这在经济上也是有道理的。较短的<strong class="jq hj"><em class="lh">【lease _ left】</em></strong>意味着房产必须尽快归还政府，理论上应该在转售市场上获得较低的价格。</p><p id="7055" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我惊讶的是，<strong class="jq hj"><em class="lh">【dist _ mrt】</em></strong>和HDB在-0.01只是轻度负相关。直觉上，如果你的房产离火车站更近，价格应该会更高。一个可能的原因是距离溢价已经反映在价格中了。毕竟，<a class="ae jn" href="https://www.lta.gov.sg/content/ltagov/en/upcoming_projects.html" rel="noopener ugc nofollow" target="_blank">陆路交通管理局</a>一直在扩大铁路网，到2030年，10个家庭中有8个将连接到距离火车站不到10分钟的地方。</p><p id="5ffc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最后，我们还有一些变量，如<strong class="jq hj"> <em class="lh"> "dist_orchard" </em> </strong>和<strong class="jq hj"> <em class="lh"> "dist_CBD" </em> </strong>，这些变量反映了这样一个事实，即离市中心越近的组屋价格越高。</p><h1 id="6c39" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">结论</h1><p id="90f9" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">在这篇文章中，我们仔细观察了新加坡的公共住房市场。特别是，我们试图找出HDB地区和公寓类型的转售价格的变化，并应用XGBoost算法来预测给定一组独特特征的房地产价格。</p><p id="868a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><a class="ae jn" href="https://cheongweisi.medium.com/can-we-use-xgboost-to-predict-public-housing-price-in-singapore-part-2-7291f552dc80" rel="noopener">本文的第2部分</a>将说明我是如何使用网络抓取技术从99.co的网站上获得这里使用的数据集的。</p><p id="f1a6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在未来，我将在类似的分析中关注新加坡的共管公寓。敬请关注！</p><p id="d336" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> <em class="lh">非常感谢您的阅读！</em>T19】</strong></p></div></div>    
</body>
</html>