<html>
<head>
<title>Visual outputs in R- one example with categorical variables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R中的视觉输出——一个有分类变量的例子</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/visual-outputs-in-r-example-1-d71cb4be50eb?source=collection_archive---------11-----------------------#2020-02-29">https://medium.com/analytics-vidhya/visual-outputs-in-r-example-1-d71cb4be50eb?source=collection_archive---------11-----------------------#2020-02-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d1b0567dd7530f0fd6754b1d6271d0e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5OzqgNyuIAYH4dTTeV1ttw.jpeg"/></div></div></figure><p id="237d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在R中有多种创建图形的方法，提供示例有助于让其他人熟悉一些片段，这些片段可以改善可视化输出并增加分析层。本博客中的示例是ggplot中的一个输出，它以百分比值和分组因子的比例显示标签。想法是输出一个描述a %的标签值，并且与每个子组成比例(在本例中是地点A和地点B)。一些额外的美学考虑也提出来分享你的视觉输出可能的轮廓想法。</p><h1 id="b109" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">步骤1:上传相关库</h1><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="beec" class="kv jp hi kr b fi kw kx l ky kz">library(dplyr)<br/>library(ggplot2)</span></pre><p id="90b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">dplyr是一种数据操作语法，提供了一组一致的动词，帮助您解决最常见的数据操作挑战。更常见的命令有:</p><blockquote class="la lb lc"><p id="997f" class="iq ir ld is b it iu iv iw ix iy iz ja le jc jd je lf jg jh ji lg jk jl jm jn hb bi translated"><code class="du lh li lj kr b"><em class="hi">filter()</em></code> <em class="hi">根据值选择案例。<br/> </em> <code class="du lh li lj kr b"><em class="hi">arrange()</em></code> <em class="hi">对病例进行重新排序。<br/> </em> <code class="du lh li lj kr b"><em class="hi">select()</em></code> <em class="hi">和</em> <code class="du lh li lj kr b"><em class="hi">rename()</em></code> <em class="hi">根据名称选择变量。<br/> </em> <code class="du lh li lj kr b"><em class="hi">mutate()</em></code> <em class="hi">和</em> <code class="du lh li lj kr b"><em class="hi">transmute()</em></code> <em class="hi">添加新变量，即现有变量的函数。<br/> </em> <code class="du lh li lj kr b"><em class="hi">summarise()</em></code> <em class="hi">将多个值浓缩为一个值。<br/></em><code class="du lh li lj kr b"><em class="hi">sample_n()</em></code><em class="hi"/><code class="du lh li lj kr b"><em class="hi">sample_frac()</em></code><em class="hi">随机抽取样本。</em></p></blockquote><p id="1ba5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ggplot2是一个基于<a class="ae lk" href="http://amzn.to/2ef1eWp" rel="noopener ugc nofollow" target="_blank">图形</a>语法的声明式创建图形的系统。您提供数据，告诉ggplot2如何将变量映射到美学，使用什么图形原语，它负责处理细节</p><h1 id="3a82" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">步骤2:创建数据集</h1><p id="910f" class="pw-post-body-paragraph iq ir hi is b it ll iv iw ix lm iz ja jb ln jd je jf lo jh ji jj lp jl jm jn hb bi translated">除非已经提供了数据集，否则可以通过随机化一些变量的分布来创建数据集，在这种情况下，我们可以命名为:类别类型(例如，借方、贷方)、二元变量(是、否)和另一个分类变量，例如位置。在这个模拟中，我们还设置了每个属性出现在每个变量中的概率。</p><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="b1b0" class="kv jp hi kr b fi kw kx l ky kz">set.seed(1234)<br/>Random &lt;- data.frame(replicate(3,sample(0:3, 3024, rep=TRUE)))</span><span id="0377" class="kv jp hi kr b fi lq kx l ky kz">Random$Type&lt;- sample(c(“Debit”, “Credit”),size = nrow(Random), prob = c(0.76, 0.24), replace = TRUE)</span><span id="5847" class="kv jp hi kr b fi lq kx l ky kz">Random$YN &lt;- sample(c(“Yes”, “No”), size = nrow(Random), prob = c(0.76, 0.24), replace = TRUE)</span><span id="fcec" class="kv jp hi kr b fi lq kx l ky kz">Random$Place &lt;- sample(c(“PlaceA”, “PlaceB”), size = nrow(Random), prob = c(0.76, 0.24), replace = TRUE)</span></pre><p id="1788" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">初始数据集的输出如下所示。这只是第一个条目，但行数可能会更多。</p><figure class="km kn ko kp fd ij er es paragraph-image"><div class="er es lr"><img src="../Images/34b544f4c3cca2014b6538646c5513ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:302/format:webp/1*yxZv7Lh_jAN35_ArOJB2Fg.png"/></div></figure><h1 id="ec0c" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">步骤3:测量变量间的分布</h1><p id="6853" class="pw-post-body-paragraph iq ir hi is b it ll iv iw ix lm iz ja jb ln jd je jf lo jh ji jj lp jl jm jn hb bi translated">这是继续进行可视化输出的关键步骤，该可视化输出表示各种变量之间的每种组合的频率。在这种情况下，left_join函数特别有助于以表格形式描述t</p><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="ad83" class="kv jp hi kr b fi kw kx l ky kz">Random %&gt;% <br/>count(<!-- -->Type<!-- -->, YN, Place) %&gt;% <br/>left_join(Random %&gt;% <br/>count(<!-- -->Type<!-- -->, Place, name = "m"), by = c("<!-- -->Type<!-- -->", "Place")) %&gt;%<br/>mutate(Prop = n/m) </span></pre><p id="31e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输出将类似于。n列描述了每种组合的出现，而m代表比例</p><figure class="km kn ko kp fd ij er es paragraph-image"><div class="er es ls"><img src="../Images/9810d555e0c2e44b52def6fed749580d.png" data-original-src="https://miro.medium.com/v2/resize:fit:618/format:webp/1*ojoFM-cqX_ORK-ohYSO74w.jpeg"/></div></figure><h1 id="d2db" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">步骤4:绘制频率的总体分布图</h1><p id="4673" class="pw-post-body-paragraph iq ir hi is b it ll iv iw ix lm iz ja jb ln jd je jf lo jh ji jj lp jl jm jn hb bi translated">考虑到表格形式的结果，可以执行库ggplot以通过聚集形式的图形显示先前的分布。</p><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="0431" class="kv jp hi kr b fi kw kx l ky kz">%&gt;% ggplot(aes(x = YN, y = Prop, fill = Place)) +<br/>geom_col(position = position_dodge())</span></pre><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/c63457e0b4bc0faa3b4f6db53d471800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dL0vDI-WXfmfrqOFjSYTgQ.png"/></div></div></figure><p id="664b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从图表中可以看出，没有按类型进行分类，而只是按地方进行分类:每个地方回答“是”和“否”的比例。</p><h1 id="4f0e" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">步骤5:按类别分解图表</h1><p id="526c" class="pw-post-body-paragraph iq ir hi is b it ll iv iw ix lm iz ja jb ln jd je jf lo jh ji jj lp jl jm jn hb bi translated">按类型分解图形的下一步是由命令facet_wrap提供的，它使用户能够表示频率分布的附加层。</p><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="f2a8" class="kv jp hi kr b fi kw kx l ky kz">facet_wrap(~ <!-- -->Type<!-- -->, scales = "free_x", ncol = 2) +</span></pre><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/3f736c00095cc3beebf0a5cec74dfec4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IUdT0RR3UhHHW-FogGCUsQ.png"/></div></div></figure><h1 id="6229" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">第6步:显示百分比值</h1><p id="f567" class="pw-post-body-paragraph iq ir hi is b it ll iv iw ix lm iz ja jb ln jd je jf lo jh ji jj lp jl jm jn hb bi translated">该代码的一个主要目的是以表格的形式表示之前确定的百分比值的分解。包比例(已经嵌入在R中)允许比例值显示在可视输出中</p><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="ef8c" class="kv jp hi kr b fi kw kx l ky kz">geom_text(aes(label = scales::percent(Prop)), position = position_dodge(0.9),<!-- -->hjust = -0.25<!-- -->) +</span></pre><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/6ecabd3bdaf1aceea2b6580cc6c9f714.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Hm0S_7aAkjCnej3XGtdAQ.png"/></div></div></figure><h1 id="a428" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">第7步:显示百分比值</h1><p id="eec4" class="pw-post-body-paragraph iq ir hi is b it ll iv iw ix lm iz ja jb ln jd je jf lo jh ji jj lp jl jm jn hb bi translated">一旦最终产品提供了预期的分析输出，视觉的美学部分也是另一个重要的考虑因素。Ggplot嵌入了特定的函数来实现这一点。选择颜色模式的是scale_fill_brewer，沿y轴建立%值的是scale_y_continuous。见下面一些例子和调色板和剪贴产品一个更有吸引力的图表。</p><figure class="km kn ko kp fd ij er es paragraph-image"><div class="er es lu"><img src="../Images/9bdb83fd05c49175e26b34b15032714f.png" data-original-src="https://miro.medium.com/v2/resize:fit:428/format:webp/1*aoqojmwaZeGGGWL7_TQtHQ.jpeg"/></div></figure><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="370a" class="kv jp hi kr b fi kw kx l ky kz">scale_fill_brewer(palette = "Greens") +<br/>scale_y_continuous(limits = c(0, 1), labels = scales::percent)+<br/>xlab("Answers") +<br/>ylab("Frequency") +<br/>coord_flip()</span></pre><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/9622cd1eeccff31083387b91dee43d93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*06F0akpiR7JSFP39ab7IPA.png"/></div></div></figure><p id="763c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">视觉输出现在显示两层分解和相应的%值。第一层是按地点分解，第二层是按分类变量分解(在本例中为信用和借贷)。</p><h1 id="2f4b" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">第八步:最后润色</h1><p id="500b" class="pw-post-body-paragraph iq ir hi is b it ll iv iw ix lm iz ja jb ln jd je jf lo jh ji jj lp jl jm jn hb bi translated">在发布视觉输出之前，最后的润色也很重要。set_plot_dimension函数有助于建立最终输出大小的标准。</p><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="bbf8" class="kv jp hi kr b fi kw kx l ky kz">set_plot_dimensions &lt;- function(width_choice, height_choice) <br/>{options(repr.plot.width = width_choice, repr.plot.height = height_choice)}</span><span id="ea14" class="kv jp hi kr b fi lq kx l ky kz">set_plot_dimensions(10,4)</span></pre><p id="ab74" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在经过一些尝试和错误以获得最优维度之后，主题函数中建立了一系列其他参数。例如，element_rect有助于定义背景颜色，而对于文本大小，调整以下元素无疑是有帮助的:strip.text、plot.title、axis.text和axis.title</p><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="4256" class="kv jp hi kr b fi kw kx l ky kz">theme(panel.background = element_rect(fill = "white"),<br/>        legend.position = "bottom",<br/>        strip.text.x = element_text(size = 15, colour = "black"),<br/>        plot.title = element_text(size = 16, face = "bold"),<br/>        axis.text = element_text(size = 12),<br/>        axis.title = element_text(size = 12))</span></pre><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/3d49239f1757c2a4ea5feb37908e55d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jUri16B1Uaa6dZZebNmXtQ.png"/></div></div></figure><p id="de4f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">瞧，最终的视觉输出现在显示了百分比和不同的分解层次</p></div></div>    
</body>
</html>