<html>
<head>
<title>Building Tensorflow 1.14 with GPU Support and TensorRT on Ubuntu 16.04 LTS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Ubuntu 16.04 LTS版上使用GPU支持和TensorRT构建Tensorflow 1.14</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/building-tensorflow-1-14-with-gpu-support-and-tensorrt-on-ubuntu-16-04-84bbd356e03?source=collection_archive---------2-----------------------#2019-09-26">https://medium.com/analytics-vidhya/building-tensorflow-1-14-with-gpu-support-and-tensorrt-on-ubuntu-16-04-84bbd356e03?source=collection_archive---------2-----------------------#2019-09-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ed03a623d671f7feb4881b43969d5188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IrsxToTZqbZlDDlRZbPzJg.png"/></div></div></figure><p id="d8b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我和我的Ubuntu的关系有点奇怪。我很乐意告诉你一切，但事实是我甚至不知道那是什么。我只看到了后果…灾难性的后果。我们都说了一些我们不想说的话，但我想这是因为我和TensorFlow的事情。我猜他们还没准备好通奸。😐</p><p id="6763" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是我在过去两个月中第三次安装TensorFlow，我是那些希望自己的机器最好的人之一，所以我不能接受更低的价格。我已经尝试过这个过程很多次了，所以我决定写一篇文章给那些正在努力维持他们的关系的人。).</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="c48e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jv">要在Ubuntu 18.04 LTS上构建有GPU支持和TensorRT的Tensorflow 2.0，按照这个</em> <a class="ae jw" rel="noopener" href="/@shivam.iitmandi/building-tensorflow-2-0-with-gpu-support-and-tensorrt-on-ubuntu-18-04-lts-part-1-e04ce41f885c"> <em class="jv">链接</em> </a> <em class="jv">。</em></p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="affc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好吧，那么我们需要什么？</p><ul class=""><li id="775c" class="jx jy hi is b it iu ix iy jb jz jf ka jj kb jn kc kd ke kf bi translated">CUDA 10.0(针对Tensorflow ≥ 1.13.0)</li><li id="0688" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">NVIDIA GPU驱动(CUDA 10.0要求≥ 410.x)</li><li id="19cf" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">cuDNN SDK (≥ 7.4.1)</li><li id="dc0c" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">CUPTI(附带CUDA工具包)</li><li id="e2f4" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">Bazel (0.24.1 ≤版本≤ 0.26.1)</li></ul></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="96d0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以开始了吗？</p><p id="04ec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我会分段写下步骤，让过程更简洁，更切题。</p><h1 id="9df4" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">更新和升级您的系统。</h1><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="6e1b" class="ls km hi lo b fi lt lu l lv lw">$ sudo apt-get update</span><span id="6cca" class="ls km hi lo b fi lx lu l lv lw">$ sudo apt-get upgrade</span></pre><h1 id="f537" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">验证您是否拥有支持CUDA的GPU。</h1><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="075e" class="ls km hi lo b fi lt lu l lv lw">$ lspci | grep -i nvidia</span></pre><p id="67c8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jv"> lspci </em> </strong>命令返回系统上安装的所有硬件的列表。使用<strong class="is hj"><em class="jv">grep |-I nvidia</em></strong>只会返回你的NVIDIA硬件的名称。记下名称，并在<a class="ae jw" href="https://developer.nvidia.com/cuda-gpus" rel="noopener ugc nofollow" target="_blank">http://developer.nvidia.com/cuda-gpus</a>检查您的GPU是否支持CUDA。</p><p id="0239" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果有，记下它的计算能力。</p><h1 id="3aa3" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">移除任何现有或先前安装的CUDA</h1><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="3da3" class="ls km hi lo b fi lt lu l lv lw">$ sudo apt-get purge nvidia*</span><span id="9eee" class="ls km hi lo b fi lx lu l lv lw">$ sudo apt-get autoremove</span><span id="9268" class="ls km hi lo b fi lx lu l lv lw">$ sudo apt-get autoclean</span><span id="47d0" class="ls km hi lo b fi lx lu l lv lw">$ sudo rm -rf /usr/local/cuda*</span></pre><p id="0d13" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第一个命令将卸载安装在您系统上的nvidia驱动程序。我们稍后会安装兼容的。第二个和第三个是删除无用和不必要的文件，这些文件是作为其他包的依赖项安装的，但不再需要。最后一个命令将删除包含CUDA的文件夹。</p><h1 id="e472" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">为Ubuntu 16.04安装CUDA 10.0</h1><p id="c360" class="pw-post-body-paragraph iq ir hi is b it ly iv iw ix lz iz ja jb ma jd je jf mb jh ji jj mc jl jm jn hb bi translated">不要安装CUDA-10.1。Tensorflow尚未与最新版本兼容。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="1930" class="ls km hi lo b fi lt lu l lv lw">$ sudo apt-get install gnupg-curl</span></pre><p id="07d6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将有助于使用任何支持的协议在服务器之间传输数据。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="d07d" class="ls km hi lo b fi lt lu l lv lw">$ wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1604/x86_64/cuda-repo-ubuntu1604_10.0.130-1_amd64.deb</span></pre><p id="04ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将从服务器下载CUDA 10.0。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="93ac" class="ls km hi lo b fi lt lu l lv lw">$ sudo dpkg -i cuda-repo-ubuntu1604_10.0.130-1_amd64.deb</span><span id="4c52" class="ls km hi lo b fi lx lu l lv lw">$ sudo apt-key adv --fetch-keys https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1604/x86_64/7fa2af80.pub</span></pre><p id="a078" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jv"> dpkg </em> </strong>命令用于安装<em class="jv">。Ubuntu上的deb </em>文件。第一个命令将为以后的安装添加CUDA 10.0。第二个命令是添加存储库密钥。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="d6cb" class="ls km hi lo b fi lt lu l lv lw">$ sudo apt-get update</span></pre><p id="06dc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更新您的套餐列表。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="efcb" class="ls km hi lo b fi lt lu l lv lw">$ wget <a class="ae jw" href="http://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1604/x86_64/nvidia-machine-learning-repo-ubuntu1604_1.0.0-1_amd64.deb" rel="noopener ugc nofollow" target="_blank">http://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1604/x86_64/nvidia-machine-learning-repo-ubuntu1604_1.0.0-1_amd64.deb</a></span><span id="090a" class="ls km hi lo b fi lx lu l lv lw">$ sudo apt install ./nvidia-machine-learning-repo-ubuntu1604_1.0.0-1_amd64.deb</span></pre><p id="ab3d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下载并添加tensorflow所需的NVIDIA机器学习工具。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="b8d9" class="ls km hi lo b fi lt lu l lv lw">$ sudo apt-get update</span><span id="5fb8" class="ls km hi lo b fi lx lu l lv lw">$ reboot</span></pre><p id="d073" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更新并重启系统。</p><h2 id="e91f" class="ls km hi bd kn md me mf kr mg mh mi kv jb mj mk kz jf ml mm ld jj mn mo lh mp bi translated">安装所需的NVIDIA驱动程序。**</h2><p id="a94d" class="pw-post-body-paragraph iq ir hi is b it ly iv iw ix lz iz ja jb ma jd je jf mb jh ji jj mc jl jm jn hb bi translated">CUDA不会安装，除非你的系统有你的GPU所需的NVIDIA驱动程序。通过PPA安装它。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="b0a6" class="ls km hi lo b fi lt lu l lv lw">$ sudo add-apt-repository ppa:graphics-drivers/ppa</span><span id="b976" class="ls km hi lo b fi lx lu l lv lw">$ sudo apt-get update</span></pre><p id="6a8b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">进入Ubuntu中的<strong class="is hj">附加驱动</strong>窗口，选择首选驱动，然后应用这些更改。重新启动系统以加载驱动程序。</p><p id="aaed" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">*** <strong class="is hj">重要</strong> ***</p><p id="cf32" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">驱动的选择取决于你的系统和Ubuntu内核版本。<strong class="is hj">附加驱动程序</strong>窗口会显示许多选项，如下所示:</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/52d2ef82fc702f98738aa8e1c36db0d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hl-Ho6Axrb4FCmLRFJB4ag.png"/></div></div></figure><p id="e82e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，你可能会尝试安装最新的版本，但这可能会导致某些并发症，比如，屏幕变暗或重启后无法启动到Ubuntu。为了避免这种情况，我推荐使用NVIDIA-410.x 。我试过更高的版本，但它们不适合我的系统。还有，NVIDIA-410.x工作起来像个魔咒！</p><h1 id="e0b9" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">最后安装CUDA 10.0，cuDNN SDK，CUPTI，TensorRT</h1><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="2ac9" class="ls km hi lo b fi lt lu l lv lw">$ sudo apt-get install --no-install-recommends \<br/>    cuda-10-0 \<br/>    libcudnn7=7.6.2.24-1+cuda10.0  \<br/>    libcudnn7-dev=7.6.2.24-1+cuda10.0<!-- --> </span><span id="7c36" class="ls km hi lo b fi lx lu l lv lw">$ export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda/extras/CUPTI/lib64</span><span id="c957" class="ls km hi lo b fi lx lu l lv lw">$ sudo apt-get install -y --no-install-recommends libnvinfer5=5.1.5-1+cuda10.0 \<br/>    libnvinfer-dev=5.1.5-1+cuda10.0</span></pre><p id="942d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将最终在您的系统上安装CUDA 10.0、cuDNN SDK 7.6.2、CUPTI和TensorRT。</p><h1 id="5080" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">将安装目录的路径添加到PATH变量中</h1><p id="3e03" class="pw-post-body-paragraph iq ir hi is b it ly iv iw ix lz iz ja jb ma jd je jf mb jh ji jj mc jl jm jn hb bi translated">将最近安装的文件的路径添加到PATH变量中，这样它就知道在需要时在哪里可以找到它们。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="7a2d" class="ls km hi lo b fi lt lu l lv lw">$ echo 'export PATH=/usr/local/cuda-10.0/bin${PATH:+:${PATH}}' &gt;&gt; ~/.bashrc</span><span id="06af" class="ls km hi lo b fi lx lu l lv lw">$ echo 'export LD_LIBRARY_PATH=/usr/local/cuda-10.0/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}' &gt;&gt; ~/.bashrc</span></pre><p id="ffc3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些命令会将路径添加到PATH变量中。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="6bfe" class="ls km hi lo b fi lt lu l lv lw">$ source ~/.bashrc</span><span id="6b1c" class="ls km hi lo b fi lx lu l lv lw">$ sudo ldconfig</span></pre><p id="6e5b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重新加载并更新<em class="jv"> bashrc </em>文件。重启系统。</p><h1 id="9407" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">验证CUDA 10.0、cuDNN和TensorRT的安装。</h1><h2 id="7904" class="ls km hi bd kn md me mf kr mg mh mi kv jb mj mk kz jf ml mm ld jj mn mo lh mp bi translated">CUDA 10.0的验证:</h2><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="359f" class="ls km hi lo b fi lt lu l lv lw">$ cuda-install-samples-10.0.sh ~</span><span id="ba7f" class="ls km hi lo b fi lx lu l lv lw">$ cd ~/NVIDIA_CUDA-10.0_Samples/5_Simulations/nbody</span><span id="78ad" class="ls km hi lo b fi lx lu l lv lw">$ make</span><span id="0d05" class="ls km hi lo b fi lx lu l lv lw">$ ./nbody</span></pre><p id="8cb2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些命令将安装CUDA 10.0示例并运行其中一个。如果你看到某种动画，那么你的CUDA 10.0工作得非常好。</p><h2 id="d0d1" class="ls km hi bd kn md me mf kr mg mh mi kv jb mj mk kz jf ml mm ld jj mn mo lh mp bi translated">cuDNN 7.6.2的验证:</h2><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="dc3a" class="ls km hi lo b fi lt lu l lv lw">$ whereis cudnn.h</span></pre><p id="a6f5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将返回<strong class="is hj"> cudnn.h </strong>文件的位置。记下来。姑且称之为<strong class="is hj"> ${CUDNN_H_PATH} </strong>。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="8dd6" class="ls km hi lo b fi lt lu l lv lw">$ cat ${CUDNN_H_PATH} | grep CUDNN_MAJOR -A 2</span></pre><p id="9f4a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它应该会返回如下内容:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="a08f" class="ls km hi lo b fi lt lu l lv lw">#define CUDNN_MAJOR <strong class="lo hj">7</strong><br/>#define CUDNN_MINOR <strong class="lo hj">6</strong><br/>#define CUDNN_PATCHLEVEL <strong class="lo hj">2</strong><br/>--<br/>#define CUDNN_VERSION (CUDNN_MAJOR * 1000 + CUDNN_MINOR * 100 + CUDNN_PATCHLEVEL)</span><span id="942c" class="ls km hi lo b fi lx lu l lv lw">#include "driver_types.h"</span></pre><h2 id="51c6" class="ls km hi bd kn md me mf kr mg mh mi kv jb mj mk kz jf ml mm ld jj mn mo lh mp bi translated">TensorRT的验证:</h2><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="3452" class="ls km hi lo b fi lt lu l lv lw">$ dpkg -l | grep nvinfer</span></pre><p id="37e6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这应该会返回如下内容:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="ab42" class="ls km hi lo b fi lt lu l lv lw">ii  libnvinfer-dev                                  5.1.5-1+cuda10.0                              amd64        TensorRT development libraries and headers<br/>ii  libnvinfer5                                     5.1.5-1+cuda10.0                              amd64        TensorRT runtime libraries</span></pre><h1 id="81dd" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">安装依赖项</h1><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="49c8" class="ls km hi lo b fi lt lu l lv lw">$ pip3 install -U --user pip six numpy wheel setuptools mock</span><span id="7d70" class="ls km hi lo b fi lx lu l lv lw">$ pip3 install -U --user keras_applications==1.0.6 --no-deps</span><span id="dea6" class="ls km hi lo b fi lx lu l lv lw">$ pip3 install -U --user keras_preprocessing==1.0.5 --no-deps</span></pre><p id="3586" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果在虚拟环境中安装，则省略<code class="du mr ms mt lo b">--user</code> <em class="jv"> </em>。</p><h1 id="c9dd" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">使用bazel build从源代码构建Tensorflow 1.14</h1><h2 id="a800" class="ls km hi bd kn md me mf kr mg mh mi kv jb mj mk kz jf ml mm ld jj mn mo lh mp bi translated">下载并安装Bazel:</h2><p id="4fb7" class="pw-post-body-paragraph iq ir hi is b it ly iv iw ix lz iz ja jb ma jd je jf mb jh ji jj mc jl jm jn hb bi translated">从https://github.com/bazelbuild/bazel/releases下载巴泽尔。我用过<strong class="is hj"> 0.25.0 </strong>。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="57f4" class="ls km hi lo b fi lt lu l lv lw">$ cd ~/ # My bazel file was in $HOME</span><span id="121d" class="ls km hi lo b fi lx lu l lv lw">$ chmod +x bazel-0.25.0-installer-linux-x86_64.sh</span><span id="c1d6" class="ls km hi lo b fi lx lu l lv lw">$ ./bazel-0.25.0-installer-linux-x86_64.sh --user</span></pre><p id="dc95" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将在您的系统上安装bazel。现在将其路径添加到path变量中。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="3e48" class="ls km hi lo b fi lt lu l lv lw">$ echo 'export PATH="$PATH:$HOME/bin"' &gt;&gt; ~/.bashrc^C</span><span id="e241" class="ls km hi lo b fi lx lu l lv lw">$ source ~/.bashrc</span><span id="6a18" class="ls km hi lo b fi lx lu l lv lw">$ sudo ldconfig</span></pre><h2 id="98b2" class="ls km hi bd kn md me mf kr mg mh mi kv jb mj mk kz jf ml mm ld jj mn mo lh mp bi translated">克隆Tensorflow存储库:</h2><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="c2c0" class="ls km hi lo b fi lt lu l lv lw">$ git clone https://github.com/tensorflow/tensorflow.git</span></pre><p id="6891" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">克隆完成后，将目录更改为tensorflow，并签出到版本分支。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="d638" class="ls km hi lo b fi lt lu l lv lw">$ cd tensorflow</span><span id="4de4" class="ls km hi lo b fi lx lu l lv lw">$ git checkout r1.14</span></pre><h2 id="cc8a" class="ls km hi bd kn md me mf kr mg mh mi kv jb mj mk kz jf ml mm ld jj mn mo lh mp bi translated">配置版本:</h2><p id="0942" class="pw-post-body-paragraph iq ir hi is b it ly iv iw ix lz iz ja jb ma jd je jf mb jh ji jj mc jl jm jn hb bi translated">是时候配置构建并决定赋予tensorflow的特性了。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="444d" class="ls km hi lo b fi lt lu l lv lw">$ ./configure</span></pre><p id="6004" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将在终端上加载一个参数解析器，询问路径和特性。像这样:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="de81" class="ls km hi lo b fi lt lu l lv lw">Please specify the location of python. [Default is /usr/bin/python]: /usr/bin/python3</span><span id="0971" class="ls km hi lo b fi lx lu l lv lw">Do you wish to build TensorFlow with Apache Ignite support? [Y/n]: Y</span><span id="c81a" class="ls km hi lo b fi lx lu l lv lw">Do you wish to build TensorFlow with XLA JIT support? [Y/n]: Y</span><span id="3b80" class="ls km hi lo b fi lx lu l lv lw">Do you wish to build TensorFlow with OpenCL SYCL support? [y/N]: N<br/><br/>Do you wish to build TensorFlow with ROCm support? [y/N]: N<br/><br/>Do you wish to build TensorFlow with CUDA support? [y/N]: Y</span></pre><p id="9afe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它会自动检测到CUDA、cuDNN和TensorRT的路径。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="bba8" class="ls km hi lo b fi lt lu l lv lw">Do you wish to build TensorFlow with TensorRT support? [y/N]: Y</span><span id="445e" class="ls km hi lo b fi lx lu l lv lw">Enter the compute capability to use. Please note that each additional compute capability significantly increases your build time and binary size. [Default is: 5.0] {<strong class="lo hj">Enter the compute capability noted before</strong>}</span><span id="daad" class="ls km hi lo b fi lx lu l lv lw">Do you want to use clang as CUDA compiler? [y/N]: N</span><span id="2af9" class="ls km hi lo b fi lx lu l lv lw">Please specify which gcc should be used by nvcc as the host compiler. [Default is /usr/bin/gcc]: /usr/bin/gcc</span><span id="65fe" class="ls km hi lo b fi lx lu l lv lw">Do you wish to build TensorFlow with MPI support? [y/N]: N<br/><br/>Please specify optimization flags to use during compilation when bazel option "--config=opt" is specified [Default is -march=native]: -march=native<br/><br/>Would you like to interactively configure ./WORKSPACE for Android builds? [y/N]:N</span></pre><p id="5074" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将配置构建。</p><h2 id="3160" class="ls km hi bd kn md me mf kr mg mh mi kv jb mj mk kz jf ml mm ld jj mn mo lh mp bi translated">开始构建过程:</h2><p id="e796" class="pw-post-body-paragraph iq ir hi is b it ly iv iw ix lz iz ja jb ma jd je jf mb jh ji jj mc jl jm jn hb bi translated">Building将创建一个稍后安装的tensor flow pip包。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="8d8f" class="ls km hi lo b fi lt lu l lv lw">$ bazel build --config=opt --config=cuda //tensorflow/tools/pip_package:build_pip_package</span></pre><p id="abd8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">***旁注***</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="bc48" class="ls km hi lo b fi lt lu l lv lw">add "--config=mkl" if you want Intel MKL support for newer intel cpu for faster training on cpu<br/><br/>add "--config=monolithic" if you want static monolithic build (try this if build failed)<br/><br/>add "--local_resources 2048,.5,1.0" if your PC has low RAM causing Segmentation fault or other related errors</span></pre><p id="8e75" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个过程需要很长时间。大概2-3个小时。因此，等待和期待任何建设失败，他们应该来了。如果发生这种情况，请查看其背后的错误，并使用Google查找解决方案。如果你不明白或者在Google上找不到解决方案，那么使用以下命令关闭bazel本地服务器:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="3ffa" class="ls km hi lo b fi lt lu l lv lw">$ bazel clean --expunge</span></pre><p id="39c0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并再次运行构建过程。我成功了两次。</p><h2 id="48d7" class="ls km hi bd kn md me mf kr mg mh mi kv jb mj mk kz jf ml mm ld jj mn mo lh mp bi translated">构建tensorflow的whl文件进行安装:</h2><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="e151" class="ls km hi lo b fi lt lu l lv lw">$ bazel-bin/tensorflow/tools/pip_package/build_pip_package tensorflow_pkg</span></pre><h2 id="20df" class="ls km hi bd kn md me mf kr mg mh mi kv jb mj mk kz jf ml mm ld jj mn mo lh mp bi translated">用pip安装Tensorflow:</h2><p id="fc4c" class="pw-post-body-paragraph iq ir hi is b it ly iv iw ix lz iz ja jb ma jd je jf mb jh ji jj mc jl jm jn hb bi translated">如果不使用虚拟环境:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="90a4" class="ls km hi lo b fi lt lu l lv lw">$ cd tensorflow_pkg</span><span id="c575" class="ls km hi lo b fi lx lu l lv lw">$ pip3 install tensorflow*.whl</span></pre><p id="cd3a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于虚拟环境:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="e0fe" class="ls km hi lo b fi lt lu l lv lw">$ sudo apt-get install virtualenv</span><span id="ad36" class="ls km hi lo b fi lx lu l lv lw">$ virtualenv tf_1.14_cuda10.0 -p /usr/bin/python3</span><span id="cafa" class="ls km hi lo b fi lx lu l lv lw">$ source tf_1.14_cuda10.0/bin/activate</span><span id="e0c2" class="ls km hi lo b fi lx lu l lv lw">$ pip3 install tensorflow*.whl</span></pre><h2 id="fb08" class="ls km hi bd kn md me mf kr mg mh mi kv jb mj mk kz jf ml mm ld jj mn mo lh mp bi translated">验证Tensorflow安装:</h2><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="51c7" class="ls km hi lo b fi lt lu l lv lw">$ python3<br/><br/>&gt;&gt;&gt; import tensorflow as tf</span><span id="7195" class="ls km hi lo b fi lx lu l lv lw">&gt;&gt;&gt; hello = tf.constant('Hello, TensorFlow!')</span><span id="fbe5" class="ls km hi lo b fi lx lu l lv lw">&gt;&gt;&gt; sess = tf.Session()</span><span id="d6bd" class="ls km hi lo b fi lx lu l lv lw">&gt;&gt;&gt; print(sess.run(hello))</span></pre><p id="7215" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果系统输出结果，那么万岁！您已经准备好使用Tensorflow了。</p><h1 id="00b1" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">我们完事了。！！</h1><p id="2aeb" class="pw-post-body-paragraph iq ir hi is b it ly iv iw ix lz iz ja jb ma jd je jf mb jh ji jj mc jl jm jn hb bi translated"><strong class="is hj"> ** </strong>我之所以在CUDA之后安装NVIDIA驱动，是因为出于某种原因反其道而行之安装了CUDA 10.1而不是CUDA 10.0，并且默认情况下我的系统开始使用NVIDIA-418.x驱动。如果你发现了问题，告诉我！</p><p id="aee9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就这样吧！非常感谢你一路向下滚动。希望这篇文章对你有用。这是我的第一篇文章，希望继续写下去。谢谢大家！爱你Tensorflow！</p><p id="cc2e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一路平安！</p><p id="5085" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">【https://www.tensorflow.org/install/gpu】Ref:T4</p><p id="f494" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jw" href="https://www.tensorflow.org/install/source" rel="noopener ugc nofollow" target="_blank">https://www.tensorflow.org/install/source</a></p><p id="bc04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jw" href="https://www.pytorials.com/" rel="noopener ugc nofollow" target="_blank">https://www.pytorials.com</a></p></div></div>    
</body>
</html>