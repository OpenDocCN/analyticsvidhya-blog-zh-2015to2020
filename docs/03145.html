<html>
<head>
<title>Python Stock Analysis -Retrieving and Comparing Income Statements</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python股票分析-检索和比较损益表</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/retrieving-and-comparing-income-statement-data-with-python-a6f184b160cc?source=collection_archive---------3-----------------------#2020-01-18">https://medium.com/analytics-vidhya/retrieving-and-comparing-income-statement-data-with-python-a6f184b160cc?source=collection_archive---------3-----------------------#2020-01-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="82e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在准备CFA考试的时候，我遇到了很多比率、分析、表格等等。非常有用的方法和分析，以便更好地理解公司背后的东西，并找到有趣的公司。然而，令人沮丧的是，如果我要分析一家公司，我需要花费大量时间收集所有需要的数据，浏览每份超过100页的年度报告。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/100e8e1dd9d2eb1212c3cf1de980caad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*ujnBJ_nO6nFzacNZo8Wypw.jpeg"/></div></figure><p id="56b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">手动收集股票数据是一项乏味的任务，我不愿意承担。我没有时间，也没有动机去做那件事。幸运的是，还有另一种方法。利用我在Python和Pandas方面的知识，我可以获得继续分析所需的信息。我打算通过Python来自动化我的财务分析。</p><h2 id="17de" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated">在自动化了一些财务分析工具后，我想为什么不在网上和其他人分享，这样每个人都能受益。</h2><p id="6d28" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">然后，我突然想到，为什么不创建一个媒体账户，开始与所有感兴趣的人分享内容呢？这就是我在这里发布Python金融系列文章和创建Youtube视频教程的原因。我将发布更多的媒体故事，分享我迄今为止所做的所有分析。开始吧！</p><p id="7b08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">在Python股票分析</strong>的第一个故事中，我想向你展示如何使用Python、Pandas和一个名为<a class="ae kl" href="https://financialmodelingprep.com/developer/docs/" rel="noopener ugc nofollow" target="_blank"> financialmodelingprep </a>的免费API以编程的方式从不同的公司检索损益表。</p><p id="d930" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，一旦我们检索到财务数据，我们将建立一个纵向通用规模的损益表，它将允许对各种损益表项目进行简单的比较，如毛利润、净收入等。不同的公司。</p><blockquote class="km kn ko"><p id="385a" class="if ig kp ih b ii ij ik il im in io ip kq ir is it kr iv iw ix ks iz ja jb jc hb bi translated">普通规模的损益表只是将损益表的每个项目表示为收入的百分比。</p></blockquote><p id="75cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个非常有用的工具，可以比较同行业的不同公司，或者跨不同时期的相同公司。在<a class="ae kl" href="https://www.investopedia.com/terms/c/commonsizeincomestatement.asp" rel="noopener ugc nofollow" target="_blank"> Investopedia </a>中了解有关该分析工具的更多信息。</p><p id="1bce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦脚本准备好，通过传递我们想要分析的公司名称，我们将在几秒钟内得到我们的分析！不精彩吗？</p><p id="787c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我有一个Youtube视频，一步一步地解释如何编写脚本从多个公司获取损益表数据。我会强烈推荐你观看它来学习如何自己做。如果你不喜欢看视频，那完全没问题，我会在这里张贴Python代码，这样你就可以尝试一下，自己得到所有的财务数据。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kt ku l"/></div><figcaption class="kv kw et er es kx ky bd b be z dx translated">用Python比较损益表</figcaption></figure><p id="5fb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从编码开始。首先，我们将使用一个函数"<em class="kp"> selectquote" </em>，在这里我们将传递我们想要从中获取信息的股票。在这种情况下，我们需要通过公司的股票代号，例如，<em class="kp">代表苹果</em>。然后，我们调用API来获取一个字典，其中包含我们传递给函数的公司损益表。</p><pre class="je jf jg jh fd kz la lb lc aw ld bi"><span id="e6c4" class="jl jm hi la b fi le lf l lg lh">def selectquote(quote):<br/>    r= requests.get(f"<a class="ae kl" href="https://financialmodelingprep.com/api/v3/financials/income-statement/{quote}?period=quarter" rel="noopener ugc nofollow" target="_blank">https://financialmodelingprep.com/api/v3.</a>...")<br/>    r = r.json()<br/>    <br/>    stock = r['financials']<br/>    stock = pd.DataFrame.from_dict(stock)<br/>    stock = stock.T</span></pre><p id="40a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将get请求的响应存储在一个变量中，然后将这个变量转换成一个字典。从我们的字典中，我们可以很容易地将其转换为Pandas数据帧，以便使用它并执行一些基本的数据操作。我们将重命名DataFrame列，删除一些无用的数据，并将object列转换为numbers。</p><p id="14ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们将收益表的每个项目除以收入。我们用下面的代码完成了所有的工作。希望它是清楚的，否则观看上面嵌入的视频，所有的脚本是一步一步解释。</p><pre class="je jf jg jh fd kz la lb lc aw ld bi"><span id="45de" class="jl jm hi la b fi le lf l lg lh">    stock.columns = stock.iloc[0]<br/>    stock.reset_index(inplace=True)<br/>    stock = stock.iloc[:,0:2]<br/>    stock.rename(columns={ stock.columns[1]: quote }, inplace = True)<br/>    cols = stock.columns.drop('index')<br/>    stock[cols] = stock[cols].apply(pd.to_numeric, errors='coerce')<br/>    stock = stock.iloc[1:,]<br/>    #Divide whole dataframe for first row (i.e. revenue)<br/>    stock[quote] = (stock[quote]/stock.iloc[0,1])<br/>    #Format numbers as Percentage<br/>    stock[quote] = pd.Series(["{0:.2f}%".format(val * 100) for val in stock[quote]], index = stock.index)</span><span id="f64d" class="jl jm hi la b fi li lf l lg lh">    return stock</span></pre><p id="8488" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在代码的最后一部分，为了获得不止一家公司的数据并实现可比性，我们将遍历一个我们想要分析的股票列表，并将它们合并到一个我称为x的combine Pandas DataFrame中。</p><p id="9720" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下面的例子中，我们将苹果、微软、脸书和谷歌结合在一起:</p><pre class="je jf jg jh fd kz la lb lc aw ld bi"><span id="79b6" class="jl jm hi la b fi le lf l lg lh">listofstocks = ['AAPL','MSFT','FB']</span><span id="3744" class="jl jm hi la b fi li lf l lg lh">x = selectquote('GOOGL')</span><span id="334c" class="jl jm hi la b fi li lf l lg lh">for item in listofstocks:<br/>    y = selectquote(item)<br/>    x = x.merge(y,on='index')</span></pre><p id="6234" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的最终结果呈现在下图中。几秒钟之内，我们就可以清楚地对比每家公司的表现。</p><p id="254b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从下面，我们可以看到苹果的<em class="kp">收入成本</em>比脸书高得多，这使得脸书的毛利润占收入的比例更高。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es lj"><img src="../Images/c8fe8efede564f0f6ef86478fe5a7d40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0dW4YwZ3AZnWN4ZApa_XGQ.png"/></div></div><figcaption class="kv kw et er es kx ky bd b be z dx translated">使用Python的普通大小损益表</figcaption></figure><p id="94cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下一个故事中，我将向您展示如何从不同的公司下载财务比率，并将它们合并到一个单一的Pandas数据框架中，以便进行比较。</p></div></div>    
</body>
</html>