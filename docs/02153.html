<html>
<head>
<title>Calculations methods used on database records in Rails 6</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Rails 6中数据库记录使用的计算方法</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/calculations-methods-used-on-database-records-in-rails-6-f147221dd5f6?source=collection_archive---------10-----------------------#2019-12-03">https://medium.com/analytics-vidhya/calculations-methods-used-on-database-records-in-rails-6-f147221dd5f6?source=collection_archive---------10-----------------------#2019-12-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f553" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你好，</p><p id="39ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将讨论一些有用的方法，当我们需要使用数据库记录进行一些计算时，这些方法非常方便</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/d6b43700cc918643937e8d4614d89fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*r2r7tUhA1RNxOtrw"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">克里斯·利维拉尼在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><ol class=""><li id="6c51" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated"><strong class="ih hj">平均值:</strong></li></ol><blockquote class="kd ke kf"><p id="476a" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">语法:<strong class="ih hj">平均值</strong>(列名)</p></blockquote><p id="b574" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你们大多数人已经知道这个rails方法了。听起来它的工作是获取给定列的平均值。</p><p id="7de9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">例如:</strong></p><p id="7b0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">用户</strong>。平均(<strong class="ih hj">:年龄</strong> ) <code class="du kk kl km kn b"><em class="kg"># =&gt; 22.5</em></code></p><blockquote class="kd ke kf"><p id="ceb0" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">Sql查询:</p><p id="f8e5" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">选择AVG(“用户”)。“年龄”)与“用户”</p></blockquote><p id="2b7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。计数:</strong></p><p id="1976" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们rails开发人员经常使用的一种方法，它的工作是统计记录，这就是<strong class="ih hj">点。</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ko"><img src="../Images/95b3daac2f26a6c200cf9a6256188d21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*ebYQe-ghdfuPYXTIMfZR9g.jpeg"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">计数方法</figcaption></figure><p id="d921" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">例如:</strong></p><pre class="je jf jg jh fd kp kn kq kr aw ks bi"><span id="17f9" class="kt ku hi kn b fi kv kw l kx ky">User.count<br/><em class="kg"># =&gt; the total count of all users</em><br/><br/>User.count(:age)<br/><em class="kg"># =&gt; returns the total count of all users whose age is present in database</em><br/><br/>User.count(:all)<br/><em class="kg"># =&gt; performs a COUNT(*) (:all is an alias for '*')</em><br/><br/>User.distinct.count(:age)<br/><em class="kg"># =&gt; counts the number of different age values</em></span></pre><p id="3a15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果将count与group method一起使用，它将返回一个哈希，该哈希的键表示聚合列，值是各自的数量。</p><p id="5ed6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果<code class="du kk kl km kn b"><a class="ae jt" href="https://api.rubyonrails.org/classes/ActiveRecord/Calculations.html#method-i-count" rel="noopener ugc nofollow" target="_blank">count</a></code>与select方法一起使用，它将对选择的列进行计数。</p><pre class="je jf jg jh fd kp kn kq kr aw ks bi"><span id="d64f" class="kt ku hi kn b fi kv kw l kx ky">User.select(:age).count<br/><em class="kg"># =&gt; counts the number of different age values</em></span></pre><blockquote class="kd ke kf"><p id="f3cb" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">Sql查询:</p><p id="6b14" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj">选择计数("用户")。“年龄”)来自“用户”</strong></p></blockquote><p id="56a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3。id:</strong></p><p id="6c18" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想挑选一个表的所有id，这是它。</p><p id="480b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:它使用主键进行提取。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kz"><img src="../Images/6ea7834eb0c52e4ce53859f94f518984.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*DglXMjUH8HZ5gLBOjNPrxQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">ids方法</figcaption></figure><p id="78cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">例如:</strong></p><p id="96ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">User.ids</p><p id="6019" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它以数组的形式返回。</p><blockquote class="kd ke kf"><p id="ed0d" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">Sql查询</p><p id="4ee3" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">选择“用户”。“用户”的“id”</p></blockquote><p id="a49b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 4。最大值&amp;最小值:</strong></p><p id="8277" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">听起来像是计算给定列的最大值和最小值。返回的值与列的数据类型相同，如果没有行，则返回<code class="du kk kl km kn b">nil</code>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es la"><img src="../Images/2f11cd1a77e8a93cf20f7c016b140aa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/format:webp/1*q0e5J7eEtgMH0DrcCRfXqw.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">最小和最大方法</figcaption></figure><p id="a1c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">例如:</strong></p><pre class="je jf jg jh fd kp kn kq kr aw ks bi"><span id="1535" class="kt ku hi kn b fi kv kw l kx ky">User.maximum(:age) <em class="kg"># =&gt; 93</em></span><span id="44c6" class="kt ku hi kn b fi lb kw l kx ky">User.minimum(:age) <em class="kg"># =&gt; 7</em></span></pre><p id="234f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 5。拔毛:</strong></p><blockquote class="kd ke kf"><p id="7161" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">语法:<strong class="ih hj">选取</strong>(*列名)</p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lc"><img src="../Images/4f0583cb647dbc1193075cbeea15689f.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*BeHoLQHG9VW76tCx8IsPiA.jpeg"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">采摘方法</figcaption></figure><p id="c967" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<code class="du kk kl km kn b"><a class="ae jt" href="https://api.rubyonrails.org/classes/ActiveRecord/Calculations.html#method-i-pluck" rel="noopener ugc nofollow" target="_blank">pluck</a></code>作为选择一个或多个属性的快捷方式，而无需加载一堆记录来获取您想要的属性。</p><p id="975e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Pluck返回一个属性值的<code class="du kk kl km kn b"><a class="ae jt" href="https://api.rubyonrails.org/classes/Array.html" rel="noopener ugc nofollow" target="_blank">Array</a></code>,该属性值被类型转换以匹配所选取的列名</p><pre class="je jf jg jh fd kp kn kq kr aw ks bi"><span id="f9f5" class="kt ku hi kn b fi kv kw l kx ky">User.pluck(:name)<br/><em class="kg"># SELECT users.name FROM users</em><br/><em class="kg"># =&gt; ['David', 'Jeremy', 'Jose']</em><br/><br/>User.pluck(:id, :name)<br/><em class="kg"># SELECT users.id, users.name FROM users</em><br/><em class="kg"># =&gt; [[1, 'David'], [2, 'Jeremy'], [3, 'Jose']]</em></span></pre><p id="055f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 6。挑选:</strong></p><p id="f16d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是rails 6中引入的一种新方法，从当前关系的指定列中选取值。这是<code class="du kk kl km kn b">relation.limit(1).pluck(*column_names).first</code>的简写，主要在你有一个已经缩小到单行的关系时有用。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ld"><img src="../Images/823ce6000e826c60315062d8ce862861.png" data-original-src="https://miro.medium.com/v2/resize:fit:676/format:webp/1*RAce7F6CqcNgxN5UhnrcSQ.jpeg"/></div></figure><p id="5ec2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就像<code class="du kk kl km kn b"><a class="ae jt" href="https://api.rubyonrails.org/classes/ActiveRecord/Calculations.html#method-i-pluck" rel="noopener ugc nofollow" target="_blank">pluck</a></code>，<code class="du kk kl km kn b"><a class="ae jt" href="https://api.rubyonrails.org/classes/ActiveRecord/Calculations.html#method-i-pick" rel="noopener ugc nofollow" target="_blank">pick</a></code>只会加载实际值，而不是整个记录对象，所以它也更高效。与pluck一样，该值也是由列类型进行类型转换的。</p><p id="ba95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Ex: </strong></p><pre class="je jf jg jh fd kp kn kq kr aw ks bi"><span id="4588" class="kt ku hi kn b fi kv kw l kx ky">User.where(id: 1).pick(:name)<br/><em class="kg"># SELECT User.name FROM users WHERE id = 1 LIMIT 1</em><br/><em class="kg"># =&gt; 'David'</em></span></pre><p id="36ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 7。总和:</strong></p><p id="9b1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">计算给定列中值的总和。如果没有行，返回的值与列的数据类型相同，<code class="du kk kl km kn b">0</code>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es le"><img src="../Images/20b1f21d81809e11f5da7b1d924e1a65.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*5CnsbfMHMccQFp0IwQEfNw.jpeg"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">总和法</figcaption></figure><pre class="je jf jg jh fd kp kn kq kr aw ks bi"><span id="00a7" class="kt ku hi kn b fi kv kw l kx ky">User.sum(:age) <em class="kg"># =&gt; 4562</em></span></pre><p id="590a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 8。计算:</strong></p><p id="6848" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想做以上所有的方法，除了在另一个方法中选择快捷方式。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lf"><img src="../Images/648f2c13a90a649d7f67b45cdec1919e.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/1*Kvlsl1tqc-1lrxNTbgVyXg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">计算器</figcaption></figure><blockquote class="kd ke kf"><p id="d814" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">语法:<strong class="ih hj">计算</strong>(运算，列名)</p></blockquote><pre class="je jf jg jh fd kp kn kq kr aw ks bi"><span id="1928" class="kt ku hi kn b fi kv kw l kx ky">User.calculate(:count, :all) <em class="kg"># The same as User.count</em></span></pre></div></div>    
</body>
</html>