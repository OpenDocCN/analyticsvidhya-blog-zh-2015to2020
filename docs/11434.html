<html>
<head>
<title>How to use Flask-Login with SQLite3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 SQLite3 中使用 Flask-Login</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-use-flask-login-with-sqlite3-9891b3248324?source=collection_archive---------0-----------------------#2020-12-03">https://medium.com/analytics-vidhya/how-to-use-flask-login-with-sqlite3-9891b3248324?source=collection_archive---------0-----------------------#2020-12-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e9c2f8a749313ca1a0d050ea4e1d67b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*77S3Z8s__CX_HJT2LnIvKw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Python、Flask 和 SQLite3</figcaption></figure><p id="1ce7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">大家好！！！</p><p id="cb50" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我看过很多关于如何用<strong class="iw hj"> SQLAlchemy </strong>使用 Flask-Login 的教程。另一方面，我们也可以通过<strong class="iw hj"> SQLite3 数据库</strong>使用 Flask-Login。</p><p id="b2b8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">其中 SQLite3 是比 SQLAlchemy 快 3 倍的 T4。</p><p id="7f38" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这里，我将展示如何使用 SQLite3 数据库与 Flask-Login，这是我的项目的一部分，我已经向你展示。</p><p id="69ee" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">重要说明我在这个项目中使用了<strong class="iw hj">树莓 Pi 3 </strong>。</p><blockquote class="js jt ju"><p id="18b6" class="iu iv jv iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hb bi translated"><strong class="iw hj">首先，我们安装所有必要的软件开始运行，</strong></p></blockquote><ol class=""><li id="191b" class="jz ka hi iw b ix iy jb jc jf kb jj kc jn kd jr ke kf kg kh bi translated">创建一个 Python 虚拟环境。</li></ol><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="108a" class="kr ks hi kn b fi kt ku l kv kw">sudo apt<strong class="kn hj">-</strong>get install python<strong class="kn hj">-</strong>virtualenv #Install Python virtual-env</span><span id="24c5" class="kr ks hi kn b fi kx ku l kv kw">cd /var/ # Navigate to var directory</span><span id="e2b1" class="kr ks hi kn b fi kx ku l kv kw">mkdir www # Create directory named "www"</span><span id="330a" class="kr ks hi kn b fi kx ku l kv kw">cd www</span><span id="9411" class="kr ks hi kn b fi kx ku l kv kw">mkdir flask</span><span id="5fba" class="kr ks hi kn b fi kx ku l kv kw">cd flask</span><span id="ff75" class="kr ks hi kn b fi kx ku l kv kw">virtualenv flask-sqlite3 #Create the virtual-env "flask-sqlite3"<!-- --> </span><span id="9c9b" class="kr ks hi kn b fi kx ku l kv kw">. flask-sqlite3/bin/activate # To activate virtual-env</span><span id="adfb" class="kr ks hi kn b fi kx ku l kv kw">deactivate # To deactivate virtual-env</span></pre><p id="e2e9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">2.安装 Flask，Flask-Login &amp; wtforms。</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="8a07" class="kr ks hi kn b fi kt ku l kv kw">. flask-sqlite3/bin/activate</span><span id="81c4" class="kr ks hi kn b fi kx ku l kv kw">pip install flask # Install Flask</span><span id="1c24" class="kr ks hi kn b fi kx ku l kv kw">pip install flask-login # Install flask-login</span><span id="d9a8" class="kr ks hi kn b fi kx ku l kv kw">pip install flask-wtf # Install flask-wtf</span><span id="7775" class="kr ks hi kn b fi kx ku l kv kw">pip install WTForms # Install WTForms</span></pre><p id="0b51" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">3.安装 SQLite3。</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="ff38" class="kr ks hi kn b fi kt ku l kv kw">apt-get install sqlite3 # Install sqlite3</span><span id="7e1b" class="kr ks hi kn b fi kx ku l kv kw">sqlite3 login.db # Create a new sqlite database named "login"</span></pre></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><p id="a217" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">“我使用<strong class="iw hj"> Nginx </strong>作为我的网络服务器，使用<strong class="iw hj"> Uwsgi </strong>作为我的应用程序网关”</p><blockquote class="js jt ju"><p id="1d65" class="iu iv jv iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hb bi translated"><strong class="iw hj">设置 SQLite3 </strong></p></blockquote><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="c2f4" class="kr ks hi kn b fi kt ku l kv kw">sqlite3 login.db</span></pre><p id="064a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在我们将创建一个名为“login”的表来存储数据库中的所有登录数据。</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="ccbe" class="kr ks hi kn b fi kt ku l kv kw">create table login(<br/>user_id NUMBER PRIMARY KEY AUTOINCREMENT,<br/>email text not null,<br/>password text not null);</span></pre><p id="8567" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">通过使用<strong class="iw hj">自动增量</strong>，开发者不必在插入细节时跟踪 id。它会自动为每个注册用户分配 user _ ids。</p><p id="4837" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">“使用注册表将登录数据插入 log in . db”</strong></p><p id="0b75" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我假设您已经在登录数据中插入了一些数据</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="01d7" class="kr ks hi kn b fi kt ku l kv kw">insert into login values('xyz@gmail.com','XYZ123abc')</span></pre></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><blockquote class="js jt ju"><p id="72bb" class="iu iv jv iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hb bi translated"><strong class="iw hj"> flask_login.py </strong></p></blockquote><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="5b26" class="kr ks hi kn b fi kt ku l kv kw">nano flask.py # Create a new python file named "flask"</span><span id="ed9c" class="kr ks hi kn b fi kx ku l kv kw">                              .  .  . </span><span id="3d08" class="kr ks hi kn b fi kx ku l kv kw">from flask import Flask<br/>from flask import render_template, url_for, flash, request, redirect, Response<br/>import sqlite3<br/>from flask_login import LoginManager, UserMixin, login_required, login_user, logout_user, current_user<br/>from forms import LoginForm</span><span id="e9c8" class="kr ks hi kn b fi kx ku l kv kw">app = Flask(__name__)<br/>app.debug=True</span><span id="9443" class="kr ks hi kn b fi kx ku l kv kw">login_manager = LoginManager(app)<br/>login_manager.login_view = "login"</span><span id="bcd9" class="kr ks hi kn b fi kx ku l kv kw">class User(UserMixin):<br/>    def __init__(self, id, email, password):<br/>         self.id = unicode(id)<br/>         self.email = email<br/>         self.password = password<br/>         self.authenticated = False</span><span id="4615" class="kr ks hi kn b fi kx ku l kv kw">    def is_active(self):<br/>         return self.is_active()</span><span id="5295" class="kr ks hi kn b fi kx ku l kv kw">    def is_anonymous(self):<br/>         return False</span><span id="2251" class="kr ks hi kn b fi kx ku l kv kw">    def is_authenticated(self):<br/>         return self.authenticated</span><span id="e381" class="kr ks hi kn b fi kx ku l kv kw">    def is_active(self):<br/>         return True</span><span id="5537" class="kr ks hi kn b fi kx ku l kv kw">    def get_id(self):<br/>         return self.id</span><span id="8173" class="kr ks hi kn b fi kx ku l kv kw"><a class="ae lf" href="http://twitter.com/login_manager" rel="noopener ugc nofollow" target="_blank">@login_manager</a>.user_loader<br/>def load_user(user_id):<br/>   conn = sqlite3.connect('/var/www/flask/login.db')<br/>   curs = conn.cursor()<br/>   curs.execute("SELECT * from login where id = (?)",[user_id])<br/>   lu = curs.fetchone()<br/>   if lu is None:<br/>      return None<br/>   else:<br/>      return User(int(lu[0]), lu[1], lu[2])</span><span id="dbc8" class="kr ks hi kn b fi kx ku l kv kw"><a class="ae lf" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route("/login", methods=['GET','POST'])<br/>def login():<br/>  if current_user.is_authenticated:<br/>     return redirect(url_for('profile'))<br/>  form = LoginForm()<br/>  if form.validate_on_submit():<br/>     conn = sqlite3.connect('/var/www/flask/login.db')<br/>     curs = conn.cursor()<br/>     curs.execute("SELECT * FROM login where email = (?)",    [form.email.data])<br/>     user = list(curs.fetchone())<br/>     Us = load_user(user[0])<br/>     if form.email.data == Us.email and form.password.data == Us.password:<br/>        login_user(Us, remember=form.remember.data)<br/>        Umail = list({form.email.data})[0].split('@')[0]<br/>        flash('Logged in successfully '+Umail)<br/>        redirect(url_for('profile'))<br/>     else:<br/>        flash('Login Unsuccessfull.')<br/>  return render_template('login.html',title='Login', form=form)</span><span id="dd07" class="kr ks hi kn b fi kx ku l kv kw">if __name__ == "__main__":<br/>  app.run(host='0.0.0.0',port=8080,threaded=True)</span></pre><blockquote class="js jt ju"><p id="3768" class="iu iv jv iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hb bi translated"><strong class="iw hj"> forms.py </strong></p></blockquote><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="82ee" class="kr ks hi kn b fi kt ku l kv kw">from flask_wtf import FlaskForm<br/>from wtforms import StringField, PasswordField, SubmitField, BooleanField<br/>from wtforms.validators import DataRequired, Length, Email, EqualTo, ValidationError<br/>import sqlite3</span><span id="dfce" class="kr ks hi kn b fi kx ku l kv kw">class LoginForm(FlaskForm):<br/> email = StringField('Email',validators=[DataRequired(),Email()])<br/> password = PasswordField('Password',validators=[DataRequired()])<br/> remember = BooleanField('Remember Me')<br/> submit = SubmitField('Login')</span><span id="6813" class="kr ks hi kn b fi kx ku l kv kw"> def validate_email(self, email):<br/>    conn = sqlite3.connect('/var/www/flask/login.db')<br/>    curs = conn.cursor()<br/>    curs.execute("SELECT email FROM login where email = (?)",[email.data])<br/>    valemail = curs.fetchone()<br/>    if valemail is None:<br/>      raise ValidationError('This Email ID is not registered. Please register before login')</span></pre></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><p id="fea6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在我们使用 HTML 和 CSS 为登录页面设计模板。</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="0862" class="kr ks hi kn b fi kt ku l kv kw">mkdir templates # create a templates directory.</span><span id="07ec" class="kr ks hi kn b fi kx ku l kv kw">cd templates</span></pre><blockquote class="js jt ju"><p id="c3d0" class="iu iv jv iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hb bi translated"><strong class="iw hj"> html_template.html </strong></p></blockquote><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="0791" class="kr ks hi kn b fi kt ku l kv kw">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;</span><span id="fe63" class="kr ks hi kn b fi kx ku l kv kw">&lt;!-- Basic Page Needs<br/>   --&gt;<br/>  &lt;meta charset="utf-8"&gt;<br/>  {% if title %}<br/>   &lt;title&gt;{{ title }}&lt;/title&gt;<br/>  {% endif %}</span><span id="9217" class="kr ks hi kn b fi kx ku l kv kw">&lt;!-- Mobile Specific Metas<br/>   --&gt;<br/>  &lt;meta name="viewport" content="width=device-width, initial-scale=1 shrink-to-fit=no"&gt;</span><span id="e8a6" class="kr ks hi kn b fi kx ku l kv kw">&lt;!-- FONT<br/>  --&gt;    <br/>  &lt;link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css"&gt;</span><span id="e404" class="kr ks hi kn b fi kx ku l kv kw">&lt;link rel="stylesheet" href="../static/css/normalize.css"&gt;<br/>  &lt;link rel="stylesheet" href="../static/css/skeleton.css"&gt;</span><span id="3985" class="kr ks hi kn b fi kx ku l kv kw">&lt;link rel="icon" type="image/png" href="../static/logo.png"&gt;</span><span id="83e1" class="kr ks hi kn b fi kx ku l kv kw">&lt;/head&gt;<br/>&lt;body&gt;</span><span id="dc94" class="kr ks hi kn b fi kx ku l kv kw">&lt;!-- Primary Page Layout<br/>   --&gt;<br/>&lt;div style="margin-top:5%; margin-left:5%"&gt;<br/> &lt;div style="width:100%;"&gt;<br/>  &lt;div style="width: 80%; height: 100px; float: left;"&gt;<br/>     {% with messages = get_flashed_messages(with_categories=True)%}<br/> {% if messages %}<br/>  {% for category, message in messages %}<br/>   &lt;div class="alert alert-{{ category }}"&gt;<br/>    &lt;h5&gt;{{ message }}&lt;h5&gt;<br/>   &lt;/div&gt;<br/>  {% endfor %}<br/> {% endif %}<br/>     {% endwith %}<br/>     {% block info %}<br/>     {% endblock %}<br/>  &lt;/div&gt;<br/> &lt;/div&gt;<br/>&lt;/div&gt;</span><span id="c991" class="kr ks hi kn b fi kx ku l kv kw">&lt;!-- End Document<br/>   --&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="f435" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我使用了<strong class="iw hj"> skeleton.css </strong>进行设计</p><p id="4752" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">参考<a class="ae lf" href="http://getskeleton.com/" rel="noopener ugc nofollow" target="_blank"><strong class="iw hj">http://getskeleton.com/</strong></a>或<a class="ae lf" href="https://github.com/dhg/Skeleton" rel="noopener ugc nofollow" target="_blank"><strong class="iw hj">https://github.com/dhg/Skeleton</strong></a></p><blockquote class="js jt ju"><p id="57b7" class="iu iv jv iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hb bi translated"><strong class="iw hj">login.html</strong></p></blockquote><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="8ff8" class="kr ks hi kn b fi kt ku l kv kw">{% extends "html_template.html" %}<br/>{% block info %}<br/> &lt;form method='POST' action=""&gt;<br/>  {{ form.hidden_tag() }}<br/>  &lt;fieldset class="form-group"&gt; <br/>   &lt;h1&gt;Log In&lt;/h1&gt;<br/>   &lt;div class="form-group"&gt;<br/>    {{ form.email.label(class="form-control-label")}}<br/>    {% if form.email.errors %}<br/>     {{ form.email(class="form-control form-control-lg is-invalid") }}<br/>     &lt;div class="invalid-feedback"&gt;<br/>      {% for error in form.email.errors %}<br/>       &lt;span&gt;{{ error }}&lt;/span&gt;<br/>      {% endfor %}<br/>     &lt;/div&gt;<br/>    {% else %}  <br/>     {{ form.email(class="form-control form-control-lg")}}<br/>    {% endif %}<br/>   &lt;/div&gt;<br/>   &lt;div class="form-group"&gt;<br/>    {{ form.password.label(class="form-control-label")}}<br/>    {% if form.password.errors %}<br/>     {{ form.password(class="form-control form-control-lg is-invalid") }}<br/>     &lt;div class="invalid-feedback"&gt;<br/>      {% for error in form.password.errors %}<br/>       &lt;span&gt;{{ error }}&lt;/span&gt;<br/>      {% endfor %}<br/>     &lt;/div&gt;<br/>    {% else %}<br/>     {{ form.password(class="form-control form-control-lg")}}<br/>    {% endif %}<br/>   &lt;/div&gt;<br/>   &lt;div class="form-group"&gt;<br/>    {{ form.remember(class="form-check-input") }} <br/>    {{ form.remember.label(class="form-check-label") }}<br/>   &lt;/div&gt;<br/>  &lt;/fieldset&gt;<br/>  &lt;div class="form-group"&gt;<br/>   {{ form.submit(class="btn btn-outline-info")}}<br/>  &lt;/div&gt;<br/>  &lt;a href="javascript:void(0)" onclick="location.href='/reset'"&gt;Forgot Password?&lt;/a&gt;<br/> &lt;/form&gt;<br/> &lt;h6&gt;Create an Account &lt;a href="javascript:void(0)" onclick="location.href='/register'"&gt;Sign Up Now&lt;/a&gt;&lt;/h6&gt;<br/>{% endblock info %}</span></pre></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><p id="7602" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，运行 web 应用程序，</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="b152" class="kr ks hi kn b fi kt ku l kv kw">python flask_login.py</span></pre><h2 id="02fc" class="kr ks hi bd lg lh li lj lk ll lm ln lo jf lp lq lr jj ls lt lu jn lv lw lx ly bi translated">感谢所有觉得它有用的人</h2></div></div>    
</body>
</html>