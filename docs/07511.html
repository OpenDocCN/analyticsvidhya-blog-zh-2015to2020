<html>
<head>
<title>Mapping COVID-19 Infections with Python: an Introduction to GeoPandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python绘制新冠肺炎感染地图:GeoPandas简介</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/mapping-covid-19-infections-in-toronto-with-python-an-introduction-to-plotting-with-geopandas-9e7a3b721c39?source=collection_archive---------13-----------------------#2020-06-28">https://medium.com/analytics-vidhya/mapping-covid-19-infections-in-toronto-with-python-an-introduction-to-plotting-with-geopandas-9e7a3b721c39?source=collection_archive---------13-----------------------#2020-06-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="33a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">利用来自多伦多开放数据门户的数据，我准备了一份使用Python简单绘制矢量数据的简介。这篇文章不会教你如何重现我们在网络上看到的一些一流的交互式仪表盘(比如我最喜欢的约翰·霍普斯金大学的仪表盘)。相反，本文将向初学者介绍如何使用Python中的GeoPandas库，并制作两种地图:比例符号和choropleth地图。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="dcbf" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated"><strong class="ak">一、什么是GeoPandas？</strong></h1><p id="b137" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">GeoPandas是一个开源python项目，旨在使地理空间数据更易于使用。它本质上是用于数据分析的Pandas库的扩展，并为操纵和绘制地理空间数据提供了一个用户友好的界面(来源:【https://geopandas.org/】T4)。</p><p id="88c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然存在更强大、更复杂的GIS软件，但GeoPandas对任何对Python有基本了解的人都是开放的，可以实现基本的可视化任务。</p><h1 id="47b1" class="jl jm hi bd jn jo ko jq jr js kp ju jv jw kq jy jz ka kr kc kd ke ks kg kh ki bi translated"><strong class="ak">二。数据</strong></h1><p id="a63e" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">地理空间数据可以在多伦多市的开放数据门户<a class="ae jd" href="https://open.toronto.ca/dataset/neighbourhoods/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。在<strong class="ih hj">下载数据</strong>下拉菜单下，选择以‘shape file’格式下载数据。下载后，您会发现六个文件，它们都很重要，但是您只会与<strong class="ih hj">进行交互。Python中的shp </strong>文件。这是包含140个多伦多街区的地理坐标的形状文件。邻域边界被表示为由纬度和经度坐标定义的<strong class="ih hj">多边形</strong>。这是<strong class="ih hj">矢量</strong>数据的一个例子——它使用点和线段来识别地球上的位置。我们将使用该数据集来创建底图。</p><p id="956a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">新冠肺炎的数据可以从多伦多的互动数据仪表板上下载，该仪表板于今年早些时候向公众发布。我们将可视化的数据反映了2020年6月26日多伦多所有140个街区的新冠肺炎情况。对于每个邻域，我们都有两个数据点:</p><ol class=""><li id="0ba9" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ky kz la lb bi translated"><strong class="ih hj">病例数:</strong>新冠肺炎病例总数(导致死亡或康复的病例包括在此数中)</li></ol><p id="4d3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.<strong class="ih hj">每10万人发病率:</strong>每10万人确诊的新增病例数</p><h2 id="1cd9" class="lc jm hi bd jn ld le lf jr lg lh li jv iq lj lk jz iu ll lm kd iy ln lo kh lp bi translated">如何下载新冠肺炎数据:</h2><ol class=""><li id="87b9" class="kt ku hi ih b ii kj im kk iq lq iu lr iy ls jc ky kz la lb bi translated">跟随这个<a class="ae jd" href="https://www.toronto.ca/home/covid-19/covid-19-latest-city-of-toronto-news/covid-19-status-of-cases-in-toronto/" rel="noopener ugc nofollow" target="_blank">链接</a></li><li id="9e43" class="kt ku hi ih b ii lt im lu iq lv iu lw iy lx jc ky kz la lb bi translated">在交互式数据面板中，导航至“新冠肺炎多伦多街区地图”</li><li id="5829" class="kt ku hi ih b ii lt im lu iq lv iu lw iy lx jc ky kz la lb bi translated">选择“下载Excel数据”</li><li id="bad5" class="kt ku hi ih b ii lt im lu iq lv iu lw iy lx jc ky kz la lb bi translated">在excel文档中，导航至“按社区分类的病例数”选项卡，并将电子表格导出为. csv文件</li></ol><p id="a856" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦所有东西都下载完毕，我们就可以开始用Python打开这些文件了。我为这个教程创建了一个Jupyter笔记本，你可以在这里查看它的全部内容<a class="ae jd" href="https://github.com/silent-j/toronto-mapping/tree/master/toronto-covid-nbrhoods" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="a069" class="jl jm hi bd jn jo ko jq jr js kp ju jv jw kq jy jz ka kr kc kd ke ks kg kh ki bi translated"><strong class="ak">三世。加载和准备数据</strong></h1><p id="cee9" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">在这之前的第一步是确保在您的环境中安装了必要的Python库。我们将使用以下内容:</p><ul class=""><li id="9526" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ly kz la lb bi translated"><a class="ae jd" href="https://geopandas.org/install.html" rel="noopener ugc nofollow" target="_blank">地质公园</a></li><li id="00cf" class="kt ku hi ih b ii lt im lu iq lv iu lw iy lx jc ly kz la lb bi translated"><a class="ae jd" href="https://pandas.pydata.org/getting_started.html" rel="noopener ugc nofollow" target="_blank">熊猫</a></li><li id="c432" class="kt ku hi ih b ii lt im lu iq lv iu lw iy lx jc ly kz la lb bi translated"><a class="ae jd" href="https://matplotlib.org/users/installing.html" rel="noopener ugc nofollow" target="_blank"> Matplotlib </a></li><li id="a15b" class="kt ku hi ih b ii lt im lu iq lv iu lw iy lx jc ly kz la lb bi translated"><a class="ae jd" href="https://hvplot.holoviz.org/getting_started/index.html" rel="noopener ugc nofollow" target="_blank"> hVPlot </a></li></ul><p id="fe69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您还没有安装这些包，那么您需要花一些时间在您的python环境中获得这些包及其需求。</p><p id="97d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦安装完毕，您就可以开始加载数据了:</p><ol class=""><li id="3287" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ky kz la lb bi translated">将新冠肺炎数据加载到熊猫数据框架中。我们可以按照案件数量递减的顺序对街区进行排序</li></ol><figure class="ma mb mc md fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es lz"><img src="../Images/845f82aea600af09b5bae65b7998d90d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LjIFMo0rC4H_lSRVCwDIJw.png"/></div></div><figcaption class="ml mm et er es mn mo bd b be z dx translated">这个数据集实际上包含了一个额外的行，用于地址/邮政编码无法识别的情况。它将被自动忽略，所以没有必要删除它</figcaption></figure><p id="2b14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.使用GeoPandas将shapefile数据加载到地理数据框架中。地理数据框架需要Shapely对象形式的地理数据。通过GeoPandas访问的几何操作实际上是由Python中的另一个地理空间库Shapely执行的。</p><figure class="ma mb mc md fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es mp"><img src="../Images/0c32d6d6ed396e35c689f5dfb06d400d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IAJXcpUj7gyqS5IMtkY9IA.png"/></div></div><figcaption class="ml mm et er es mn mo bd b be z dx translated">数据字段标签实际上位于单独的。名为“Neighbourhoods _ fields.csv”的csv文件。您需要将这些标注与地理数据框相结合</figcaption></figure><figure class="ma mb mc md fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es mq"><img src="../Images/6d9e1a4477856b2b8c1a6e1856cf36b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xLiSYt-Bv92MkiOuw0JEyg.png"/></div></div><figcaption class="ml mm et er es mn mo bd b be z dx translated">在此地理数据框架中，我们使用面对象来描绘邻域的边界</figcaption></figure><p id="8f23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.在一些小的数据争论之后，通过邻域索引两个数据框。</p><figure class="ma mb mc md fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es mr"><img src="../Images/b92b84d52a43d9dca4078eaf9ed98777.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ftntDNHFvZ35hSb5oM0tKQ.png"/></div></div></figure><p id="06a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据集的不一致是一个令人痛苦的现实。<strong class="ih hj">下载新数据集时，请确保对数据进行辩论并执行“质量检查”,以确保感兴趣的变量格式正确。</strong>在这种情况下，更改某些街区的名称以符合基本地图的街区惯例是一个不容错过的重要步骤。</p><p id="42a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">四。创建比例符号图</strong></p><p id="1de7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">比例符号地图使用不同大小的符号来显示定量数据。它们有助于以快速、直接的方式了解位置内的数量。我们将使用新冠肺炎案例的原始计数来演示如何使用GeoPandas绘制这些地图。</p><ol class=""><li id="141c" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ky kz la lb bi translated">我们的每个邻域多边形都包含一个称为“质心”的属性，即多边形计算中心的X，Y坐标。你可以得到一系列多边形的形心。GeoSeries的“质心”属性。</li><li id="8901" class="kt ku hi ih b ii lt im lu iq lv iu lw iy lx jc ky kz la lb bi translated">使用新冠肺炎数据框连接邻域质心的地理系列。</li></ol><figure class="ma mb mc md fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es ms"><img src="../Images/4adf8c45551914dcc02226e755e50c8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p8a6M96hg6OqcIJT8nej2w.png"/></div></div></figure><p id="94bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.创建地图:</p><ul class=""><li id="878b" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ly kz la lb bi translated">绘制多伦多街区的基本地图。多边形的边和面颜色可以通过GeoPandas的<strong class="ih hj">进行调整。plot() </strong>。</li><li id="86e0" class="kt ku hi ih b ii lt im lu iq lv iu lw iy lx jc ly kz la lb bi translated">使用邻域质心绘制符号图层。我使用原始案例计数作为参数“标记大小”的参数，但是您可以很容易地计算每个质心的有意义的统计数据，并使用它来代替。</li></ul><figure class="ma mb mc md fd me er es paragraph-image"><div class="er es mt"><img src="../Images/ef65f2e01d7754918c7b36f7d9bfda6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*CzfY2vV32zKfsC1lYplIdg.png"/></div><figcaption class="ml mm et er es mn mo bd b be z dx translated"><strong class="bd jn">基准:</strong>北美基准1983 | <strong class="bd jn">投影:</strong>朗伯保形Conal 2SP | <strong class="bd jn">权威:</strong> EPSG 3161</figcaption></figure><p id="a4c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">先说这个地图非常明显的弊端。你可以看到城市中哪些地区的新冠肺炎病例数量较高，但你不一定知道这些地区的名称。这张地图也缺少信息丰富的图例。人们可以更进一步，使用Matplotlib创建一个定制的图例，但是这需要一些繁琐的注释。如果我们能够以另一种方式来表示数据，以补充这张地图，那就更容易了。</p><p id="8d48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还使用新冠肺炎案例的<em class="mu">计数</em>来改变我们符号的大小。这种类型的统计数据所带来的信息的价值在理解新冠肺炎在一个地理位置中的实际流行程度方面是有限的。幸运的是，我们下载的多伦多市数据集也为我们提供了一个信息率，我们将在下一节探讨。</p><h1 id="47c8" class="jl jm hi bd jn jo ko jq jr js kp ju jv jw kq jy jz ka kr kc kd ke ks kg kh ki bi translated">动词 （verb的缩写）创建Choropleth地图</h1><p id="722a" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">Choropleth地图是一种专题地图，它根据给定地理区域的综合统计数据对地图区域进行着色。在本节中，我们将在choropleth图中展示每100，000人中的发病率。提醒一下，这一统计数据是某一地区每100，000人中发现的新病例数。发病率在流行病学领域被广泛用于测量疾病的频率。</p><p id="368e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建choropleth地图没有太多的步骤；GeoPandas让这变得非常简单。</p><ol class=""><li id="feb1" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ky kz la lb bi translated">调用<strong class="ih hj">。包含邻近面的地理数据框架中的plot() </strong>方法(在上一节中，我们将其用作底图)</li></ol><ul class=""><li id="5048" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ly kz la lb bi translated">matplotlib轴被传入<strong class="ih hj">‘ax’</strong>参数，以便我们访问matplotlib的后端进行注释。</li><li id="e605" class="kt ku hi ih b ii lt im lu iq lv iu lw iy lx jc ly kz la lb bi translated">将感兴趣的列(病毒发生率)作为'<strong class="ih hj">列'</strong>'参数的参数进行传递，以让GeoPandas知道应根据此统计数据的比例进行着色</li><li id="68bc" class="kt ku hi ih b ii lt im lu iq lv iu lw iy lx jc ly kz la lb bi translated">将包含图例的布尔参数设置为<strong class="ih hj">真</strong>，并对图例在图中的显示方式进行一些调整。</li></ul><figure class="ma mb mc md fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es mv"><img src="../Images/da54e030557eaa661ccaf8dd26c57fae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cFU1Qkf7nbXfXfkWBju1cw.png"/></div></div></figure><p id="0d15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.最后，为最终产品添加一个合适的标题并关闭图形轴。</p><ul class=""><li id="37c0" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ly kz la lb bi translated">制图原则表明，地图标题应该向浏览者传达高层次的信息。任何无法传达的信息应在其他地方传达(即地图图例)。</li></ul><figure class="ma mb mc md fd me er es paragraph-image"><div class="er es mw"><img src="../Images/225649ce3214ae7f96c0dc635c2c7650.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*R7XG29Gij8WegULUWqfXIw.png"/></div><figcaption class="ml mm et er es mn mo bd b be z dx translated"><strong class="bd jn">基准:</strong>北美基准1983 | <strong class="bd jn">投影:</strong>兰伯特保形Conal 2SP | <strong class="bd jn">权威:</strong> EPSG 3161</figcaption></figure><p id="fb11" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种choropleth和比例符号图之间的可解释性差异是显而易见的。利用图中一侧的颜色条，您可以看到多伦多西北部的新冠肺炎感染率明显高于中部和市区(东部的一个斯卡伯勒街区除外)。</p><p id="7d44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与之前的地图相比，这张地图在用户友好性方面胜出，因为我们可以清楚地看到每个区域的边界和解释阴影的信息性图例(或“颜色条”)。</p><p id="78f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实际上不知道街区名称的缺点仍然存在。然而，我找到了一个简单而有效的解决方案。</p><h1 id="6243" class="jl jm hi bd jn jo ko jq jr js kp ju jv jw kq jy jz ka kr kc kd ke ks kg kh ki bi translated">不及物动词奖金部分！<strong class="ak">将GEOPANDAS CHOROPLETH转换为交互式地图</strong></h1><p id="4345" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">如果您的Python环境中安装了<strong class="ih hj"> hvplot </strong>库，那么您可以轻松地将choropleth转换成动态可视化。只需要几行简单的代码。这个库也允许你将你的交互视觉保存为HTML格式，使其易于嵌入。</p><figure class="ma mb mc md fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es mx"><img src="../Images/d1a8dce616529338d0453c824dea20b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JBd9gqA4OFsp5mjj-IM1LQ.png"/></div></div></figure><p id="0b10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">生成的地图将看起来像我们以前的choropleth，但是使用hVPlot绘图功能允许交互性。将鼠标悬停在每个居民区上方将显示姓名、病例数和每100，000人中的发病率。</p><p id="32e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">交互式choropleth已发布到GitHub页面，可通过点击以下链接访问:</p><div class="my mz ez fb na nb"><a href="https://silent-j.github.io/toronto-mapping/toronto-covid-nbrhoods/docs/" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab dw"><div class="nd ab ne cl cj nf"><h2 class="bd hj fi z dy ng ea eb nh ed ef hh bi translated">互动合唱团</h2><div class="ni l"><p class="bd b fp z dy ng ea eb nh ed ef dx translated">silent-j.github.io</p></div></div></div></a></div><p id="91bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">敬请关注更多GeoPandas制图技巧的后续教程！</p></div></div>    
</body>
</html>