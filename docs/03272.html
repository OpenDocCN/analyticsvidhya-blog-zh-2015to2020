<html>
<head>
<title>Spatial Visualization and Network Analysis with Geo Pandas Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Geo Pandas Python的空间可视化和网络分析</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/spatial-visualization-and-network-analysis-with-geo-pandas-python-60bfc48396c8?source=collection_archive---------2-----------------------#2020-01-23">https://medium.com/analytics-vidhya/spatial-visualization-and-network-analysis-with-geo-pandas-python-60bfc48396c8?source=collection_archive---------2-----------------------#2020-01-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/02645e79216f856ed8f32e856e6423c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DgLCASHv1nQg9gVaQRceHA.png"/></div></div></figure><div class=""/><p id="4e59" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">空间数据是指存在于地理空间或视野中的所有类型的数据对象或元素。它能够在全球范围内查找和定位世界上任何地方的个人或设备。</p><p id="951c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">空间数据用于地理信息系统和其他地理定位或定位服务。空间数据由点、线、多边形和其他地理和几何数据图元组成，可以通过位置进行映射。空间数据可以分为标量数据或矢量数据。每一个都提供关于地理或空间位置的不同信息。在本节中，我们可以解释两种类型的数据空间点、空间线和空间面。</p><h1 id="b77c" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">1.空间多边形</h1><p id="d2d8" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">在python中使用geo pandas进行构建，您可以在jupyter笔记本中安装Geo pandas和environmental Anaconda，</p><figure class="ks kt ku kv fd hk er es paragraph-image"><div class="er es kr"><img src="../Images/b4182bf54154eb4b5e817959f35c4e89.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/1*N5p--HuDYh4mOCgJ5aw8jw.jpeg"/></div></figure><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="50f4" class="lb jp ht kx b fi lc ld l le lf">pip install geopandas</span></pre><p id="9fb2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，如果你的笔记本电脑有问题，你可以在kaggle.com使用笔记本，在Kaggle笔记本中你不需要安装包，Kaggle已经有了geopandas包。要得到数据框多边形你可以在网上搜索，例如，你可以在我的链接中下载<a class="ae lg" href="https://www.kaggle.com/imammuhajir/map-data/settings" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/imammuhajir/map-data/settings</a></p><p id="03e3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">或者</p><p id="3dc9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae lg" href="http://www.info-geospasial.com/2015/10/data-shp-seluruh-indonesia.html" rel="noopener ugc nofollow" target="_blank">http://www . info-geospasial . com/2015/10/data-shp-selu ruh-Indonesia . html</a></p><p id="9904" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们去Kaggle笔记本里试试:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="07ce" class="lb jp ht kx b fi lc ld l le lf">import numpy as np<br/>import pandas as pd <br/>import matplotlib.pyplot as plt<br/>import geopandas as gpd</span><span id="df3f" class="lb jp ht kx b fi lh ld l le lf">import os<br/>for dirname, _, filenames in os.walk('/kaggle/input'):<br/>    for filename in filenames:<br/>        print(os.path.join(dirname, filename))</span></pre><p id="d855" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">导入数据shp</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="59f6" class="lb jp ht kx b fi lc ld l le lf">indo = gpd.read_file("/kaggle/input/map-data/INDONESIA_PROP.shp")<br/>indo.head()</span></pre><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es li"><img src="../Images/d81461004aad206f3ee8a5680104ba37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x79l7mO27C1MGwOJxvPtnQ.png"/></div></div></figure><p id="1aba" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，您可以尝试使用多边形数据进行可视化，使用包geopandas使可视化变得如此简单…</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="f6e2" class="lb jp ht kx b fi lc ld l le lf">indo.plot(column='Propinsi', cmap='Set1', legend=True, figsize = (30,40))<br/>plt.title('TITIK GEMPA')<br/>plt.show()</span></pre><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lj"><img src="../Images/17415c5597793d31ebf4c2f6e88b9218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8tm7EewJQeZ0poJ0NNIo6A.png"/></div></div></figure><p id="d035" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是可视化多边形，现在你可以尝试过滤区域，你可以做…</p><h1 id="0b52" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">过滤地理熊猫</h1><p id="385c" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我们只得到地区' ' ' "苏门答腊" "苏门答腊巴拉特" " JAWA腾格里" "普罗班登" "迪"。亚齐”、“JAWA帖木儿”、“JAWA巴拉特”、“楠榜”、“DKI雅加达”、“RIAU”、“占碑”、“邦加勿里洞”、“苏门答腊塞拉坦”、“达拉伊斯提梅瓦日惹”</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="f81b" class="lb jp ht kx b fi lc ld l le lf"># get data <br/>geo_df = gpd.read_file("/kaggle/input/map-data/INDONESIA_PROP.shp")</span><span id="b79b" class="lb jp ht kx b fi lh ld l le lf"># data can get <br/>filter_sumatra_jawa = [ "SUMATERA UTARA", "SUMATERA BARAT","JAWA TENGAH","PROBANTEN","DI. ACEH","JAWA TIMUR","JAWA BARAT" ,"LAMPUNG" ,"DKI JAKARTA","RIAU", "JAMBI","BANGKA BELITUNG" ,"SUMATERA SELATAN","DAERAH ISTIMEWA YOGYAKARTA"]</span><span id="4b81" class="lb jp ht kx b fi lh ld l le lf">ori_len = len(geo_df)<br/>geo_df['Wilayah'] = list(range(len(geo_df)))</span><span id="a00a" class="lb jp ht kx b fi lh ld l le lf"># filter data <br/>for i in range(ori_len):<br/>    if geo_df['Propinsi'][i] in filter_sumatra_jawa :<br/>        geo_df['Wilayah'][i] = 1<br/>    else:<br/>        geo_df['Wilayah'][i] = 0<br/>geo_df = geo_df[geo_df['Wilayah'] == 1]</span><span id="a14c" class="lb jp ht kx b fi lh ld l le lf">geo_df.head()</span></pre><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lk"><img src="../Images/c3c7993bcbe9ad4d1670612af3ba3d60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q-PL8ZZNnBD0tXMpgZLS9g.png"/></div></div></figure><p id="c444" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">再次可视化…</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="1d9a" class="lb jp ht kx b fi lc ld l le lf">leg_kwds = {'title':'NAMA WILAYAH', 'loc':'upper left','bbox_to_anchor':(1,1.05), 'ncol':1}</span><span id="baea" class="lb jp ht kx b fi lh ld l le lf">geo_df.plot(column='Propinsi', cmap='Set1', legend=True, legend_kwds = leg_kwds, figsize = (20,50))</span><span id="141d" class="lb jp ht kx b fi lh ld l le lf">plt.title('TITIK GEMPA')<br/>plt.show()</span></pre><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ll"><img src="../Images/b4f69d8c535ef5f8af715652e8d3e9b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rSQgzMKCvuY2KuChy3tCnA.png"/></div></div></figure><h1 id="8d5f" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">2.空间点和空间多边形</h1><p id="72aa" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">在这个可视化中我们可以使用地震数据，你可以从链接【https://www.kaggle.com/imammuhajir/data-gempa T4】下载数据</p><p id="e763" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个数据包含坐标位置(纬度和经度)，两个变量的组合可以使点定位在你的地图上。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="5e4b" class="lb jp ht kx b fi lc ld l le lf">train_09 = pd.read_csv('/kaggle/input/data-gempa/2009.csv')<br/>train_10 = pd.read_csv('/kaggle/input/data-gempa/2010.csv')<br/>train_11 = pd.read_csv('/kaggle/input/data-gempa/2011.csv')<br/>train_12 = pd.read_csv('/kaggle/input/data-gempa/2012.csv')<br/>train_13 = pd.read_csv('/kaggle/input/data-gempa/2013.csv')<br/>train_14 = pd.read_csv('/kaggle/input/data-gempa/2014.csv')<br/>train_15 = pd.read_csv('/kaggle/input/data-gempa/2015.csv')<br/>train_16 = pd.read_csv('/kaggle/input/data-gempa/2016.csv')<br/>train_17 = pd.read_csv('/kaggle/input/data-gempa/2017.csv')<br/>train_18 = pd.read_csv('/kaggle/input/data-gempa/2018.csv')<br/>train_all = [train_09,train_10,train_11,train_12,train_13,train_14,train_15,train_16,train_17,train_18 ]</span><span id="5c05" class="lb jp ht kx b fi lh ld l le lf"># me replace name stiap data<br/>for i in train_all:<br/>    i.columns = ['index', 'Date', 'Time', 'Latitude', 'Longitude','Depth',<br/>              'Magnitude', 'TypeMag', 'smaj', 'smin', 'az', 'rms', 'cPhase',<br/>               'Region']<br/>    i.drop(0,axis=0,inplace=True)<br/>    <br/># menyatukan data mendjadi 1 <br/>train = pd.concat(train_all)</span></pre><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lm"><img src="../Images/2c1d4f40d85f0cea9ed4f8b561c9db8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nTNVJ1ywpBiimxxvrgxzLw.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">t</figcaption></figure><p id="2cbe" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些数据非常脏，仍然有多种类型的数据，为了计算或可视化，我们必须更改为数字数据，所以让我们转到<strong class="is hu">清理数据… </strong></p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="a644" class="lb jp ht kx b fi lc ld l le lf"># mengsplit data dan membersihkan nilai menjadi number<br/>train["Longitude"] = train.Longitude.apply(lambda x : x.split()[0])<br/>train["Depth"] = train.Depth.apply(lambda x : x.split()[0])<br/>train["Magnitude"] = train.Magnitude.apply(lambda x : x.split()[0])<br/>train["Time"] = train.Time.apply(lambda x : x.split()[0])</span><span id="e5cc" class="lb jp ht kx b fi lh ld l le lf"># meng ekstrak data <br/>train["year"] = train.Date.apply(lambda x : x.split('/')[2])<br/>train["date"] = train.Date.apply(lambda x : x.split('/')[1])<br/>train["month"] = train.Date.apply(lambda x : x.split('/')[0])<br/>train["hour"] = train.Time.apply(lambda x : x.split(':')[0])</span><span id="39c0" class="lb jp ht kx b fi lh ld l le lf">train["Date"] = train.Date.apply(lambda x : x.split()[0])<br/>train['Date'] = train[['Date', 'Time']].apply(lambda x : ' '.join(x), axis = 1)<br/>train['Date'] = pd.to_datetime(train['Date'])</span><span id="72f2" class="lb jp ht kx b fi lh ld l le lf">train.index = train['Date']</span><span id="acfd" class="lb jp ht kx b fi lh ld l le lf">train_len = len(train)<br/>for i in range(train_len):<br/>    if train['Latitude'][i].split()[1] == 'LS':<br/>        train['Latitude'][i] = float(train['Latitude'][i].split()[0]) * -1<br/>    else:<br/>        train['Latitude'][i] = train['Latitude'][i].split()[0]</span><span id="1e94" class="lb jp ht kx b fi lh ld l le lf">train.head()</span></pre><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lr"><img src="../Images/f8df537b211dff7d3392957d3b1ebfe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x1KRD_wWJeLdSK74OcNMig.png"/></div></div></figure><p id="7578" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将印度尼西亚国家的数据格式更改为浮动和过滤</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="e554" class="lb jp ht kx b fi lc ld l le lf">#convert type data ke float<br/>columns = ['Latitude','Longitude', 'Depth', 'Magnitude']<br/>for var in columns:<br/>    train[var] = train[var].astype("float64")</span><span id="bd85" class="lb jp ht kx b fi lh ld l le lf"># Filter indonesia<br/>train = train.loc[((train['Latitude'] &gt;= -12.5) &amp; (train['Latitude'] &lt;= 7) &amp;  (train['Longitude'] &gt;= 94.31644) &amp; (train['Longitude'] &lt;= 142.71813) )]</span></pre><p id="b7fd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">背景多边形数据和坐标数据的空间数据可视化。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="3067" class="lb jp ht kx b fi lc ld l le lf">leg_kwds = {'title':'NAMA WILAYAH', 'loc':'upper left', 'bbox_to_anchor':(1,1.05), 'ncol':1}<br/>geo_df.plot(column='Propinsi', cmap='Set1', legend=True, legend_kwds = leg_kwds, figsize = (30,30))<br/>plt.title('TITIK GEMPA')</span><span id="736b" class="lb jp ht kx b fi lh ld l le lf">plt.scatter(y= train.Latitude, x = train.Longitude , c = train.Magnitude, alpha=0.8);<br/>plt.show()</span></pre><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ls"><img src="../Images/7ff0df363594634ebaee77bf097f0395.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*10Xh6MdsPb8ZCNCyI7Y3ew.png"/></div></div></figure><p id="157d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">基于量值过滤数据…</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="8a1e" class="lb jp ht kx b fi lc ld l le lf">train5 = train[train['Magnitude'] &gt;= 5.5]</span><span id="05ff" class="lb jp ht kx b fi lh ld l le lf">leg_kwds = {'title':'NAMA WILAYAH', 'loc':'upper left', 'bbox_to_anchor':(1,1.05), 'ncol':1}<br/>geo_df.plot(column='Propinsi', cmap='Set1', legend=True, legend_kwds = leg_kwds, figsize = (30,30))<br/>plt.title('TITIK GEMPA')</span><span id="adea" class="lb jp ht kx b fi lh ld l le lf">plt.scatter(y= train5.Latitude, x = train5.Longitude , c = train5.Magnitude, alpha=0.8);<br/>plt.show()</span></pre><h1 id="7955" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">3.用地震分析网站地震</h1><p id="3e84" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">要对地震进行地震台站网络分析，第一阶段我们必须确定地震台站本身，因为数据不知道台站的位置。为了确定地震台的位置，我们假设“smin”小于0.3的地震是靠近地震台的地震。<br/>注:“smin”是地震到最近台站的距离</p><p id="d1ef" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们看看过滤的结果</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="0079" class="lb jp ht kx b fi lc ld l le lf">train_loc = train.copy()</span><span id="ff74" class="lb jp ht kx b fi lh ld l le lf">train_loc = train_loc[train_loc.smin &lt; 0.3]</span><span id="9517" class="lb jp ht kx b fi lh ld l le lf">leg_kwds = {'title':'NAMA WILAYAH', 'loc':'upper left', 'bbox_to_anchor':(1,1.05), 'ncol':1}<br/>geo_df.plot(column='Propinsi', cmap='Set1', legend=True, legend_kwds = leg_kwds, figsize = (30 ,30))<br/>plt.title('TITIK GEMPA')</span><span id="ba2d" class="lb jp ht kx b fi lh ld l le lf">plt.scatter(y= train_loc.Latitude, x = train_loc.Longitude, alpha=0.8);<br/>plt.show()</span></pre><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ls"><img src="../Images/1bb010f7908f8715c769b8d2838c594c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FhF1aNoJjGy1jLxdJb0pnw.png"/></div></div></figure><p id="4ed3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">了解了台站附近的地震数据分布后。我们必须确定地震台站的准确位置，因此我们使用K-均值聚类来确定该位置。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="6412" class="lb jp ht kx b fi lc ld l le lf">from sklearn.cluster import KMeans</span><span id="7f6e" class="lb jp ht kx b fi lh ld l le lf">train_clus = train_loc[['Latitude', 'Longitude']]<br/>num_clusters = 152</span><span id="d575" class="lb jp ht kx b fi lh ld l le lf">km = KMeans(n_clusters=num_clusters, random_state = 1)<br/>km.fit(train_clus)<br/>clusters = km.labels_.tolist()</span><span id="255c" class="lb jp ht kx b fi lh ld l le lf">train_clus['Clustering'] = clusters</span><span id="4373" class="lb jp ht kx b fi lh ld l le lf">loc_statiun = train_clus.groupby('Clustering').mean()<br/>loc_statiun = loc_statiun.reset_index()</span></pre><p id="8875" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可视化结果:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="23d9" class="lb jp ht kx b fi lc ld l le lf">leg_kwds = {'title':'NAMA WILAYAH', 'loc':'upper left', 'bbox_to_anchor':(1,1.05), 'ncol':1}<br/>geo_df.plot(column='Propinsi', cmap='Set1', legend=False, legend_kwds = leg_kwds, figsize = (30,30))<br/>plt.title('Lokasi Statiun Gempa')</span><span id="96d5" class="lb jp ht kx b fi lh ld l le lf">plt.scatter(y= loc_statiun.Latitude, x = loc_statiun.Longitude, marker='^', alpha=1, c = '#1f77b4');<br/>plt.show()</span></pre><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lj"><img src="../Images/cb0917d58c81d0cd55f638eac13afb44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9JV0jygE2IYvQSpCoiH-wg.png"/></div></div></figure><h1 id="450d" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">最近震点地震台网分析</h1><p id="0ed5" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">创建一个新要素:站点和地震点之间的距离，最近的地震站点的名称</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="7f08" class="lb jp ht kx b fi lc ld l le lf">#from pandas.tools.plotting import scatter_matrix<br/>from sklearn.model_selection import StratifiedShuffleSplit<br/>from sklearn.preprocessing import LabelBinarizer<br/>from sklearn.preprocessing import StandardScaler<br/>from geopy.distance import vincenty</span><span id="6726" class="lb jp ht kx b fi lh ld l le lf">import gc</span><span id="9125" class="lb jp ht kx b fi lh ld l le lf">statiun_coords = {}</span><span id="852c" class="lb jp ht kx b fi lh ld l le lf">for dat in loc_statiun.iterrows():<br/>    row = dat[1]<br/>    <br/>    statiun_coords[int(row['Clustering'])] = (float(row['Latitude']), float(row['Longitude']))</span></pre><p id="a6c1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">功能:寻找最近的地震点。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="6c46" class="lb jp ht kx b fi lc ld l le lf">def closest_point(location, location_dict):<br/>    """ take a tuple of latitude and longitude and <br/>        compare to a dictionary of locations where<br/>        key = location name and value = (lat, long)<br/>        returns tuple of (closest_location , distance) """<br/>    closest_location = None<br/>    for city in location_dict.keys():<br/>        distance = vincenty(location, location_dict[city]).kilometers<br/>        if closest_location is None:<br/>            closest_location = (city, distance)<br/>        elif distance &lt; closest_location[1]:<br/>            closest_location = (city, distance)<br/>    return closest_location</span><span id="5627" class="lb jp ht kx b fi lh ld l le lf">train_clus['close_station'] = train_clus.apply(lambda x: closest_point((x['Latitude'],x['Longitude']), statiun_coords), axis = 1)</span><span id="59fc" class="lb jp ht kx b fi lh ld l le lf">train_clus['close_station_name'] = [x[0] for x in train_clus['close_station'].values]<br/>train_clus['close_station_dist'] = [x[1] for x in train_clus['close_station'].values]</span><span id="68c3" class="lb jp ht kx b fi lh ld l le lf">train['close_station'] = train.apply(lambda x: closest_point((x['Latitude'],x['Longitude']), statiun_coords), axis = 1)<br/>train['close_station_name'] = [x[0] for x in train['close_station'].values]<br/>train['close_station_dist'] = [x[1] for x in train['close_station'].values]</span><span id="69e9" class="lb jp ht kx b fi lh ld l le lf">train.head()</span></pre><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lt"><img src="../Images/46a2868e9abd6265160c013fd813ac15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l60tAolbaIra4mB8zvJdsQ.png"/></div></div></figure><p id="6c32" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可视化网络</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="b020" class="lb jp ht kx b fi lc ld l le lf">train.plot(kind='scatter', x='Longitude', y='Latitude',  marker='^', alpha=1, c = '#1f77b4', figsize= (30, 10 )<br/>    )</span><span id="98e7" class="lb jp ht kx b fi lh ld l le lf">for line in train.iterrows():<br/> dat = line[1]<br/> x1 = dat['Longitude']<br/> y1 = dat['Latitude']<br/> p2 = statiun_coords[dat['close_station_name']]<br/> x2 = p2[1]<br/> y2 = p2[0]<br/> plt.plot([x1,x2],[y1, y2], 'k-',linewidth=0.5)<br/>    <br/>    <br/>#plt.imshow(peta_gempa,  extent=[ 93 , 118.5, -13.3 , 7.7], alpha=0.9)<br/>#plt.imshow(peta_gempa,  extent=[ 90 , 115.5, -14.7 , 7.9], alpha=1)<br/>plt.ylabel("Latitude", fontsize=14)<br/>plt.xlabel("Longitude", fontsize=14)<br/>plt.title("Map Jaringan Lokasi Stasiun dengan Gempa", fontsize = 20)<br/>plt.show()</span></pre><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lu"><img src="../Images/54719328d64eb6d6515571fe9e8dd8f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-te82pjyffoAOwrtYvLJWw.png"/></div></div></figure><p id="0709" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">具有5.5级滤波器的网络</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="a6f4" class="lb jp ht kx b fi lc ld l le lf">train5 = train[train['Magnitude'] &gt;= 5.5]</span><span id="c825" class="lb jp ht kx b fi lh ld l le lf"># graph of vectors connecting points to their nearest city</span><span id="7a60" class="lb jp ht kx b fi lh ld l le lf">train5.plot(kind='scatter', x='Longitude', y='Latitude',  marker='^', alpha=1, c = '#1f77b4', figsize = (30, 10)<br/>    )</span><span id="cc72" class="lb jp ht kx b fi lh ld l le lf">for line in train5.iterrows():<br/>    <br/> dat = line[1]<br/> x1 = dat['Longitude']<br/> y1 = dat['Latitude']<br/> p2 = statiun_coords[dat['close_station_name']]<br/> x2 = p2[1]<br/> y2 = p2[0]<br/>    <br/> plt.plot([x1,x2],[y1, y2], 'k-',linewidth=0.5)<br/>    <br/>    <br/>#plt.imshow(peta_gempa,  extent=[ 93 , 118.5, -13.3 , 7.7], alpha=0.9)</span></pre><figure class="ks kt ku kv fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lu"><img src="../Images/add3d624ce5e21071dc8310e674c1bbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5v-oGP9Gj3ceetuBWRasyQ.png"/></div></div></figure><p id="7be4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢您的阅读，您可以在我的Kaggle笔记本中找到完整的代码</p><div class="hh hi ez fb hj lv"><a href="https://www.kaggle.com/imammuhajir/visualisation" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab dw"><div class="lx ab ly cl cj lz"><h2 class="bd hu fi z dy ma ea eb mb ed ef hs bi translated">形象化</h2><div class="mc l"><h3 class="bd b fi z dy ma ea eb mb ed ef dx translated">使用来自多个数据源的数据</h3></div><div class="md l"><p class="bd b fp z dy ma ea eb mb ed ef dx translated">www.kaggle.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj hp lv"/></div></div></a></div></div></div>    
</body>
</html>