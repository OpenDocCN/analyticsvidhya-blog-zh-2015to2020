<html>
<head>
<title>Recommendation System: Collaborative Filtering (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">推荐系统:协同过滤(下)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/recommendation-system-collaborative-filtering-part-2-2cad286d32c6?source=collection_archive---------23-----------------------#2020-07-03">https://medium.com/analytics-vidhya/recommendation-system-collaborative-filtering-part-2-2cad286d32c6?source=collection_archive---------23-----------------------#2020-07-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="04a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文包含了协作过滤在python中的详细实现步骤，从头开始不需要任何外部库。</p><p id="7dc6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">顾名思义，这是推荐系统文章的第2部分，其中第1部分关注基于内容的推荐系统，本文将关注协同过滤方法，即利用其他用户的质量判断的t 2。</p><blockquote class="je jf jg"><p id="d665" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">协同过滤的主要思想是基于一组相似用户给出的评分，为用户<strong class="ih hj"> X </strong>预测一个项目的评分。</p></blockquote><p id="c899" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们试着理解这个定义，这里“相似用户”指的是与用户<em class="jh"> X </em>相似和不相似的一组用户。因此，例如，如果用户X不喜欢项目<em class="jh"> a </em>，那么相似用户一定也不喜欢项目<em class="jh"> a </em>，反之亦然。尽管它们相似性的强度取决于用户提供的评级。图2描述了这个过程，其中我们试图预测a先生喜欢的物品。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es jl"><img src="../Images/794de59d74436767b2143c4e4d2daf9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*B3FzUMcGULTgTIzr3cXE5Q.png"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">图2</figcaption></figure><p id="8607" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们有一组用户已经以与用户<em class="jh"> X </em>相似的方式对项目进行了评级，那么我们可以开始预测用户<em class="jh"> X </em>尚未使用的项目的评级，并且具有最高评级的项目将被推荐给用户<em class="jh"> X </em>。这种方法也被称为<strong class="ih hj">基于用户-用户的协同过滤</strong>，因为我们匹配的是用户简档而不是项目简档，在这种情况下，它将是基于项目-项目的协同过滤。</p><p id="e7fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">听起来很简单！让我们试着实现它。</p><h2 id="9289" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">数据集:</h2><p id="8e6f" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">我使用的数据集与第1部分中使用的相同，即来自Kaggle的动画数据集。数据集包含两个文件rating.csv和anime.csv，其中rating . CSV包含用户对不同动漫的评级，因此总共有3列，anime . CSV包含所有动漫的详细信息，如名称、类型、平均评级等。共有12，294部独特动漫，73，516个独特用户和7，813，737个总评分。</p><p id="786b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种方法中，我们将主要使用rating.csv文件，即包含每个用户对某些动画的评级的文件。用户有缺失值<em class="jh"> -1 </em>，表示用户看过这部动漫但没有评价。全球平均评分为7.8。</p><h2 id="1b05" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">实施步骤:</h2><p id="fbbd" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">实施主要分为3项任务:</p><p id="2e33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">任务1: </strong>计算一组截至用户<em class="jh"> X </em>的相似用户。并且为了计算两个用户之间的相似性，我们使用了用户x与其余所有用户之间的<em class="jh">皮尔逊相关系数</em>。一旦完成，它将返回一个最相似用户的列表。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es kx"><img src="../Images/5c8989754b2c51d05288695512b6dd63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QAzIbc5-IaaarNz62vjZtw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">图2 ( <em class="lc">皮尔逊相关系数</em>)</figcaption></figure><p id="8b52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">任务2: </strong>在得到用户<em class="jh"> X </em>的相似用户列表后，我们可以预测用户<em class="jh"> X </em>没有看过但是集合<em class="jh"> N </em>的相似用户看过的动漫的评分。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es ld"><img src="../Images/5ba6ff068d1c915f709bd7251a1b7771.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b-d_v8AVtbhMGkcMfnM_uQ.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">图3(预测用户X对动漫I的评级)</figcaption></figure><p id="d059" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">任务3: </strong>在预测用户<em class="jh"> X </em>的评分时应用常规做法，即<em class="jh">正则化</em>来改进预测结果。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es le"><img src="../Images/1f2b12e3df424082d0a11aaf115d99f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fq6V0tlO24ATFUsd0jGDTw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">图4(调整预测评级)</figcaption></figure><p id="8cce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于编码，有一些事情需要记住。由于数据集非常庞大，即大约800万个总评分，我们将使用spark的rdd进行内存计算和惰性评估，这将有助于我们获得一些速度，并在以后创建一个字典来快速访问数据集。</p><pre class="jm jn jo jp fd lf lg lh li aw lj bi"><span id="6944" class="jx jy hi lg b fi lk ll l lm ln"><em class="jh"># Reading from rating.csv and transforming data</em><br/>df = spark.read.text("/content/drive/My Drive/Colab Notebooks/rating.csv").rdd<br/>data = df.map(<strong class="lg hj">lambda</strong> x: x[0].split(','))<br/>data2 = data.groupBy(<strong class="lg hj">lambda</strong> x : x[0])<br/>data3 = data2.collect()</span><span id="b008" class="jx jy hi lg b fi lo ll l lm ln"><em class="jh"># Preparing data : a dictionary utility = {users: {anime : ratings}}</em><br/>utility = {}<br/>all_animes = []<br/>all_users = []<br/><strong class="lg hj">for</strong> user <strong class="lg hj">in</strong> range(len(data3)):<br/>    <strong class="lg hj">if</strong> data3[user][0] == 'user_id':<br/>        <strong class="lg hj">continue</strong><br/>    utility[int(data3[user][0])] = {}<br/>    <strong class="lg hj">for</strong> i <strong class="lg hj">in</strong> data3[user][1]:        <br/>        <strong class="lg hj">if</strong> int(i[1]) <strong class="lg hj">not</strong> <strong class="lg hj">in</strong> all_animes:<br/>            all_animes.append(int(i[1]))<br/>        <strong class="lg hj">if</strong> int(i[2]) == -1:<br/>            <strong class="lg hj">continue</strong>            <br/>        utility[int(i[0])][int(i[1])] = int(i[2])</span></pre><p id="109e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，完成这一步后，我们将得到一个效用矩阵，它将用于进一步的实施。那么可以为每个任务创建三种方法，然后可以为用户进行预测。</p><pre class="jm jn jo jp fd lf lg lh li aw lj bi"><span id="bcbc" class="jx jy hi lg b fi lk ll l lm ln"><strong class="lg hj">def</strong> recommend_with_regularization(matrix, user):<br/>    <em class="jh"># this method returns the predictions wrt most similar users</em><br/>    similar_users = most_similar_user(matrix, user)<br/>    predictions = {}<br/>    <strong class="lg hj">for</strong> anime <strong class="lg hj">in</strong> all_animes:<br/>        num = 0<br/>        den = 0<br/>        <strong class="lg hj">for</strong> user_ <strong class="lg hj">in</strong> similar_users:<br/>            <strong class="lg hj">if</strong> anime <strong class="lg hj">in</strong> matrix[user_[0]].keys():<br/>                b_xj = global_avg + (avg_rating_of_user[user_[0]] - global_avg) + (avg_rating_of_animes[anime]- global_avg)<br/>                num += (matrix[user_[0]][anime]- b_xj) * user_[1]<br/>                den += user_[1]<br/>        <strong class="lg hj">if</strong> den == 0:<br/>            <strong class="lg hj">continue</strong><br/>        <em class="jh"># if anime in matrix[user[0]].keys():</em><br/>        b_xi = global_avg + (avg_rating_of_user[user] - global_avg) + (avg_rating_of_animes[anime] - global_avg)<br/>        <strong class="lg hj">if</strong> b_xi + float(num/den) &gt; 10:<br/>            predictions[anime] = 10<br/>        <strong class="lg hj">else</strong>:<br/>            predictions[anime] = b_xi + float(num/den)<br/>    <strong class="lg hj">return</strong> predictions</span></pre><h2 id="55f9" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">结果:</h2><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es lp"><img src="../Images/ed4a563da9c8059dbebbce48f09c9eef.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*tM1gnEx2_--Bkhbv7XzeVQ.png"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">图5(用于评估的效用矩阵)</figcaption></figure><p id="0c16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个效用矩阵以用户为行，以动漫为列。为了比较两种算法的性能，我们使用了相同的测试数据来衡量性能。我们随机抽取了995名用户和3304部动漫。</p><p id="e66a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了评估该模型，我们对相同的测试数据集使用了RMSE评分，因为我们再次预测了评级。</p><p id="ae2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">没有正规化的RMSE:1.72669202</strong></p><p id="f2d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">正规化的RMSE:1.4481453462</strong></p><p id="2421" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为用户3推荐动漫。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es lq"><img src="../Images/8bfcc748e0b828b19257f4ba080fd270.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tb8CcTFLASQoEBuvWbBjfQ.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">图6(推荐动漫)</figcaption></figure><h2 id="82fa" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated"><strong class="ak">讨论:</strong></h2><p id="07e1" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">这种方法给出了多样化的结果，更适合于一般用户喜欢不同类型的项目。虽然，将会有一个开始的问题，即在用户对系统是新的并且没有先前的评级或更少的情况下。在这个项目中实现的精度是1.48 RMSE，因为在这里我们预测用户会给动画的评级，并返回最佳结果。</p><p id="9df2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，这两种方法各有利弊，您可以根据手头的问题来决定采用哪种方法。</p><p id="819c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是上述模型的完整实现。注意:在本文中，为了保持文章的简洁，我没有包括数据集的预处理等内容。</p><div class="lr ls ez fb lt lu"><a href="https://github.com/arsh1207/BigDataProject/blob/master/User_based_CF_colab.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="lv ab dw"><div class="lw ab lx cl cj ly"><h2 class="bd hj fi z dy lz ea eb ma ed ef hh bi translated">arsh 1207/大数据项目</h2><div class="mb l"><h3 class="bd b fi z dy lz ea eb ma ed ef dx translated">permalink dissolve GitHub是超过5000万开发人员的家园，他们一起工作来托管和审查代码，管理…</h3></div><div class="mc l"><p class="bd b fp z dy lz ea eb ma ed ef dx translated">github.com</p></div></div><div class="md l"><div class="me l mf mg mh md mi jr lu"/></div></div></a></div><p id="78b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参考资料:</p><p id="dd5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">海量数据集的挖掘:<a class="ae jd" href="http://www.mmds.org/" rel="noopener ugc nofollow" target="_blank">http://www.mmds.org</a></p><p id="5495" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据集:<a class="ae jd" href="https://www.kaggle.com/CooperUnion/anime-recommendations-database#rating.csv" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/Cooper union/anime-recommendations-database # rating . CSV</a></p><p id="1c01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://www.analyticsvidhya.com/blog/2015/08/beginners-guide-learn-content-based-recommender-systems/" rel="noopener ugc nofollow" target="_blank">https://www . analyticsvidhya . com/blog/2015/08/初学者-指南-学习-基于内容-推荐系统/ </a></p><p id="469b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">项目回购:【https://github.com/arsh1207/BigDataProject T2】</p></div></div>    
</body>
</html>