<html>
<head>
<title>Implementing ColumnTransformer for a dataset having columns of different data types</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为具有不同数据类型的列的数据集实现ColumnTransformer</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/handling-heterogeneous-features-in-a-dataset-using-columntransformer-aa525ebe0486?source=collection_archive---------7-----------------------#2020-05-18">https://medium.com/analytics-vidhya/handling-heterogeneous-features-in-a-dataset-using-columntransformer-aa525ebe0486?source=collection_archive---------7-----------------------#2020-05-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e7a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在现实世界中，所提供的数据集可能具有由非结构化文本列、分类列和数字列组成的要素列。您可能需要执行要素选择，然后可能会对传递这些不同的数据类型列来训练数据集感兴趣。在本文中，我将讨论相同的场景，在数据集上执行特征选择后，我必须处理分类列、数字列和非结构化文本列。</p><p id="3d3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一个挑战是如何将不同类型的功能整合在一起。为此，我使用了ColumnTransformer类。这是scikit-learn 0.20版本中提供的一个类。</p><p id="4844" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看一下代码。</p><p id="d8c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我使用Kaggle数据集作为本文的样本。(下面的方法只是在这个数据集上使用列转换器，并不试图解决这个Kaggle问题)。</p><div class="jd je ez fb jf jg"><a href="https://www.kaggle.com/nicapotato/womens-ecommerce-clothing-reviews" rel="noopener  ugc nofollow" target="_blank"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hj fi z dy jl ea eb jm ed ef hh bi translated">女性电子商务服装评论</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">23，000条客户评论和评级</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">www.kaggle.com</p></div></div><div class="jp l"><div class="jq l jr js jt jp ju jv jg"/></div></div></a></div><p id="9466" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">df = PD . read _ csv('/女装电子商务评论. CSV ')</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es jw"><img src="../Images/02230794aca1b3292009fda0b95b6f30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ha14apRtmTnoD31K3gxRYA.png"/></div></div></figure><p id="f8fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们执行通用特征工程步骤。</p><p id="ab01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.正在移除未命名的列0。</p><p id="0784" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.从“类名”、“审阅文本”和“标题”中删除空行。</p><pre class="jx jy jz ka fd kh ki kj kk aw kl bi"><span id="cdc1" class="km kn hi ki b fi ko kp l kq kr">df.drop(df.columns[0], axis=1, inplace=True)<br/>df = df[~df['Class Name'].isnull()]<br/>df = df[~df['Review Text'].isnull()]<br/>df = df[~df['Title'].isnull()]</span></pre><p id="4e1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看df现在是什么样子</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es ks"><img src="../Images/190ca56ad24088b153b8e9c1708427ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N88XHdtp3nlvLlRhh684Xg.png"/></div></div></figure><p id="7c91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们找出df中每一列的数据类型。</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es kt"><img src="../Images/0fdffb41081995f54b92b5200ca5cdc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eglmyuOANvGZ5j7dTqz9CA.png"/></div></div></figure><p id="c289" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">显然，df有不同的数据类型。现在，假设我渴望在模型中使用所有这些特性。因此，在将它们提供给模型之前，需要将特性转换成一个精炼的版本。对于数字特征，我需要使用standardScaler来缩放它们；对于分类类型，执行一键编码，并对文本列使用countvectorizer。我们可以使用ColumnTransformer类实现所有这些，并将它们一起输入到模型中。</p><p id="d93e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ColumnTransformer类最多可以有6个参数，但是在本文中，我将只使用其中的两个参数— <strong class="ih hj"> transformers </strong>和<strong class="ih hj"> remainder </strong>。</p><p id="364d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">先说变形金刚。</p><p id="1a7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“转换器”是指定要应用于数据子集的转换器对象的元组列表。它以下面提到的两种格式之一表示。</p><p id="f297" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">多列→(名称、变压器、[列])</p><p id="63a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">单个文本列→(名称、变压器、列)</p><p id="f107" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在哪里</p><p id="14b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">名称:</strong>类型<strong class="ih hj">类型<em class="ku"> str </em>类型</strong></p><p id="a92e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用于使用set_params设置参数，并帮助在网格搜索中进行搜索。</p><p id="88cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">变压器<em class="ku"> {'drop '，' passthrough'}，或估计器</em> </strong></p><p id="fe75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">估计器必须支持<a class="ae kv" href="https://scikit-learn.org/stable/glossary.html#term-fit" rel="noopener ugc nofollow" target="_blank">拟合</a>和<a class="ae kv" href="https://scikit-learn.org/stable/glossary.html#term-transform" rel="noopener ugc nofollow" target="_blank">变换</a>。我将对数值列使用StandardScaler，对非结构化文本列使用CountVectorizer，对分类列使用OneHotEncoder。</p><p id="145b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">【栏目】</strong></p><p id="1e60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要对其执行变换的数据框列的列表。</p><p id="5a51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以从sci kit-learn . org:-<a class="ae kv" href="https://scikit-learn.org/stable/modules/generated/sklearn.compose.ColumnTransformer.html#sklearn.compose.ColumnTransformer" rel="noopener ugc nofollow" target="_blank">https://sci kit-learn . org/stable/modules/generated/sk learn . compose . column transformer . html # sk learn . compose . column transformer</a></p><p id="81f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于我的数据集，我需要在ColumnTransfomer函数的transformers参数中传递下面提到的转换器。</p><ol class=""><li id="962b" class="kw kx hi ih b ii ij im in iq ky iu kz iy la jc lb lc ld le bi translated">简单估算器，常量估算到分类列['部门名称'，'部门名称']</li><li id="0926" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">“审阅文本”上带有停用词的CountVectorizer，而“标题”列上只有CountVectorizer。</li><li id="d44d" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">用于数字列['服装ID '，'年龄'，'评分'，'推荐指数'，'正反馈计数']的简单估算器。</li></ol><pre class="jx jy jz ka fd kh ki kj kk aw kl bi"><span id="b1f7" class="km kn hi ki b fi ko kp l kq kr">STOPWORDS = set(stopwords.words('english'))</span><span id="427f" class="km kn hi ki b fi lk kp l kq kr">catTransformer = Pipeline(steps=[('cat_imputer', SimpleImputer(strategy='constant', fill_value='missing')),('cat_ohe', OneHotEncoder(handle_unknown='ignore'))])</span><span id="2611" class="km kn hi ki b fi lk kp l kq kr">textTransformer_0 = Pipeline(steps=[<br/>    ('text_bow', CountVectorizer(lowercase=True,\<br/>                                 token_pattern=r"(?u)\b\w+\b",\<br/>                                 stop_words=STOPWORDS))])</span><span id="f726" class="km kn hi ki b fi lk kp l kq kr">textTransformer_1 = Pipeline(steps=[('text_bow1', CountVectorizer())])</span><span id="4ec1" class="km kn hi ki b fi lk kp l kq kr">numeric_features = ['Clothing ID','Age','Rating','Recommended IND','Positive Feedback Count']</span><span id="ec0a" class="km kn hi ki b fi lk kp l kq kr">numTransformer = Pipeline(steps=[('imputer', SimpleImputer(strategy='median')),('scaler', StandardScaler())])</span><span id="0e6f" class="km kn hi ki b fi lk kp l kq kr">ct = ColumnTransformer(<br/>transformers=[<br/>('cat', catTransformer, ['Division Name','Department Name']),<br/>('num', numTransformer, numeric_features),<br/>('text1', textTransformer_0, 'Review Text'),<br/>('text2', textTransformer_1, 'Title')<br/>])</span></pre><p id="9e0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">拆分数据集并使上面创建的ColumnTransformer适合管道。</p><pre class="jx jy jz ka fd kh ki kj kk aw kl bi"><span id="a2e2" class="km kn hi ki b fi ko kp l kq kr">X = df.drop('Class Name', axis='columns')</span><span id="5b6d" class="km kn hi ki b fi lk kp l kq kr">y=df['Class Name']</span><span id="93b6" class="km kn hi ki b fi lk kp l kq kr">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2,random_state = 42)</span><span id="eeaa" class="km kn hi ki b fi lk kp l kq kr">pipeline = Pipeline(steps=[('feature_engineer', ct),('RF', RandomForestClassifier(n_jobs=-1, class_weight='balanced'))])</span><span id="3b32" class="km kn hi ki b fi lk kp l kq kr">pipeline.fit(X_train, y_train)</span><span id="bcd7" class="km kn hi ki b fi lk kp l kq kr">preds = pipeline.predict(X_test)</span><span id="b214" class="km kn hi ki b fi lk kp l kq kr">print('accuracy %s' % accuracy_score(preds, y_test))<br/>print(confusion_matrix(y_test, preds))<br/>print(classification_report(y_test, preds))</span></pre><p id="a58f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我已经成功地创建了一个管道，并通过传递定义其转换的异构特性来预测模型的准确性。</p><p id="80c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们来讨论第二个参数'<strong class="ih hj">余数'</strong>。此参数用于处理数据集中未定义转换的剩余列。该参数将<strong class="ih hj"> ** </strong> 'drop '作为其默认值，这意味着如果我没有为该参数指定任何值，则剩余的列将从数据集中删除；其他值为<strong class="ih hj">*</strong>‘通过’。使用该参数的每个值也会影响模型的准确性。在这种情况下，我通过使用“传递”值，即情况1，获得了更好的准确性。</p><p id="06a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，我不希望从数据集中转换任何特定的列，而是希望按原样提供它们。以“评级”栏为例来说明这两个参数值。为了使“Rating”列符合“remainder”参数，我不会对它应用数值转换。</p><p id="c468" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">案例1 </strong></p><p id="1347" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">* with remainder = 'passthrough '。</p><pre class="jx jy jz ka fd kh ki kj kk aw kl bi"><span id="61ab" class="km kn hi ki b fi ko kp l kq kr">STOPWORDS = set(stopwords.words('english'))</span><span id="0eff" class="km kn hi ki b fi lk kp l kq kr">catTransformer = Pipeline(steps=[('cat_imputer', SimpleImputer(strategy='constant', fill_value='missing')),('cat_ohe', OneHotEncoder(handle_unknown='ignore'))])</span><span id="d530" class="km kn hi ki b fi lk kp l kq kr">textTransformer_0 = Pipeline(steps=[<br/>    ('text_bow', CountVectorizer(lowercase=True,\<br/>                                 token_pattern=r"(?u)\b\w+\b",\<br/>                                 stop_words=STOPWORDS))])</span><span id="90bc" class="km kn hi ki b fi lk kp l kq kr">textTransformer_1 = Pipeline(steps=[('text_bow1', CountVectorizer())])</span><span id="ff5a" class="km kn hi ki b fi lk kp l kq kr">numeric_features = ['Clothing ID','Age','Recommended IND','Positive Feedback Count']</span><span id="57be" class="km kn hi ki b fi lk kp l kq kr">numTransformer = Pipeline(steps=[('imputer', SimpleImputer(strategy='median')),('scaler', StandardScaler())])</span><span id="e702" class="km kn hi ki b fi lk kp l kq kr">ct = ColumnTransformer(</span><span id="37fe" class="km kn hi ki b fi lk kp l kq kr">transformers=[('cat', catTransformer, ['Division Name','Department Name']),('num', numTransformer, numeric_features),('text1', textTransformer_0, 'Review Text'),('text2', textTransformer_1, 'Title')],remainder='passthrough')</span></pre><p id="a093" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">案例2 </strong></p><p id="17c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">* * column transformer类将考虑不设置“remainder”参数的值，即其默认值“drop ”,因此“Rating”列应从输入数据集中删除。</p><pre class="jx jy jz ka fd kh ki kj kk aw kl bi"><span id="67af" class="km kn hi ki b fi ko kp l kq kr">STOPWORDS = set(stopwords.words('english'))</span><span id="e884" class="km kn hi ki b fi lk kp l kq kr">catTransformer = Pipeline(steps=[('cat_imputer', SimpleImputer(strategy='constant', fill_value='missing')),('cat_ohe', OneHotEncoder(handle_unknown='ignore'))])</span><span id="feb2" class="km kn hi ki b fi lk kp l kq kr">textTransformer_0 = Pipeline(steps=[<br/>    ('text_bow', CountVectorizer(lowercase=True,\<br/>                                 token_pattern=r"(?u)\b\w+\b",\<br/>                                 stop_words=STOPWORDS))])</span><span id="a56f" class="km kn hi ki b fi lk kp l kq kr">textTransformer_1 = Pipeline(steps=[('text_bow1', CountVectorizer())])</span><span id="d7a8" class="km kn hi ki b fi lk kp l kq kr">numeric_features = ['Clothing ID','Age','Recommended IND','Positive Feedback Count']</span><span id="28b8" class="km kn hi ki b fi lk kp l kq kr">numTransformer = Pipeline(steps=[('imputer', SimpleImputer(strategy='median')),('scaler', StandardScaler())])</span><span id="9c87" class="km kn hi ki b fi lk kp l kq kr">ct = ColumnTransformer(transformers=[<br/>('cat', catTransformer, ['Division Name','Department Name']),<br/>('num', numTransformer, numeric_features),<br/>('text1', textTransformer_0, 'Review Text'),<br/>('text2', textTransformer_1, 'Title')])</span></pre><p id="e5f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">总结</strong></p><p id="dbd0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们学习了如何使用ColumnTransformer传递各种异构数据类型列及其特定转换。</p><p id="ac54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">演示:</p><ul class=""><li id="1329" class="kw kx hi ih b ii ij im in iq ky iu kz iy la jc ll lc ld le bi translated">处理数字、分类和非结构化文本列</li><li id="3103" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc ll lc ld le bi translated">具有“通过”和“丢弃”值的剩余参数</li></ul><p id="628a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望你喜欢阅读这篇文章！！</p></div></div>    
</body>
</html>