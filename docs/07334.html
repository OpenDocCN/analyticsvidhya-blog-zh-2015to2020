<html>
<head>
<title>Social Distancing Analyzer using OpenCV and YOLO</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用OpenCV和YOLO的社交距离分析器</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/social-distancing-analyzer-using-opencv-and-yolo-7572aed7b3bf?source=collection_archive---------5-----------------------#2020-06-22">https://medium.com/analytics-vidhya/social-distancing-analyzer-using-opencv-and-yolo-7572aed7b3bf?source=collection_archive---------5-----------------------#2020-06-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/b3d534edf038a5e0cc049d18cb042e1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*2YphMNpdYCbcn6bRqz6NCw.jpeg"/></div></figure><h1 id="2c2d" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated"><strong class="ak">简介</strong></h1><p id="77ab" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">社交距离是有意增加人与人之间的物理空间，以避免传播疾病。与他人保持至少六英尺的距离会降低你感染<strong class="jm hj">新冠肺炎</strong>的几率。我们可以使用<strong class="jm hj"> OpenCV </strong>和<strong class="jm hj"> YOLO </strong>来监测/分析人们是否保持社交距离。</p><h1 id="75e0" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">使用的技术和工具</h1><p id="3b5d" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">我为这个项目使用了<strong class="jm hj"> Python </strong>。我使用的一些其他工具是<strong class="jm hj"> OpenCV </strong>和<strong class="jm hj"> NumPy </strong>。</p><h1 id="fe16" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">理论</h1><p id="cfe4" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">一点理论不会有坏处:)</p><h2 id="525c" class="ki in hi bd io kj kk kl is km kn ko iw jv kp kq ja jz kr ks je kd kt ku ji kv bi translated"><strong class="ak"> OpenCV </strong></h2><p id="c80c" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">所以，如果你不知道OpenCV是什么，OpenCV是一个主要针对实时计算机视觉的编程函数库。OpenCV(开源计算机视觉库)是一个开源的计算机视觉和机器学习软件库。OpenCV旨在为计算机视觉应用提供一个公共基础设施，并加速机器感知在商业产品中的应用。作为一个BSD许可的产品，OpenCV使得企业利用和修改代码变得很容易。</p><p id="19ce" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">该库拥有超过2500种优化算法，包括一套全面的经典和最先进的计算机视觉和机器学习算法。</p><p id="ecc7" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">更多信息<a class="ae lb" href="https://opencv.org/" rel="noopener ugc nofollow" target="_blank">点击此处</a>。</p><h2 id="eea2" class="ki in hi bd io kj kk kl is km kn ko iw jv kp kq ja jz kr ks je kd kt ku ji kv bi translated"><strong class="ak"> YOLO </strong></h2><p id="c6a8" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">YOLO(你只看一次)是一个聪明的卷积神经网络(CNN)，用于实时进行对象检测。该算法将单个神经网络应用于整个图像，然后将图像分成多个区域，并预测每个区域的边界框和概率。这些边界框由预测概率加权。</p><p id="5244" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">YOLO很受欢迎，因为它实现了高精度，同时还能够实时运行。该算法“只看一次”图像，因为它只需要一次通过神经网络的前向传播来进行预测。在非最大值抑制(确保对象检测算法只检测每个对象一次)之后，它会输出已识别的对象以及边界框。</p><p id="7a4f" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">更多信息<a class="ae lb" href="https://pjreddie.com/darknet/yolo/" rel="noopener ugc nofollow" target="_blank">点击此处</a>。</p><p id="a0a0" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">我们将在我们的项目中广泛使用以上两种方法。</p><h2 id="5951" class="ki in hi bd io kj kk kl is km kn ko iw jv kp kq ja jz kr ks je kd kt ku ji kv bi translated">概观</h2><ul class=""><li id="3d61" class="lc ld hi jm b jn jo jr js jv le jz lf kd lg kh lh li lj lk bi translated">我们将使用YOLO进行物体检测。</li><li id="8b5d" class="lc ld hi jm b jn ll jr lm jv ln jz lo kd lp kh lh li lj lk bi translated">一旦物体(人)被检测到，我们将在它们周围画一个边界框。</li><li id="62cd" class="lc ld hi jm b jn ll jr lm jv ln jz lo kd lp kh lh li lj lk bi translated">使用盒子的质心，然后我们测量它们之间的距离。</li><li id="607a" class="lc ld hi jm b jn ll jr lm jv ln jz lo kd lp kh lh li lj lk bi translated">对于距离测量，使用了<strong class="jm hj">欧几里德距离</strong>。</li><li id="ba4f" class="lc ld hi jm b jn ll jr lm jv ln jz lo kd lp kh lh li lj lk bi translated">如果<strong class="jm hj">不安全</strong>，一个盒子被涂成红色，如果<strong class="jm hj">安全</strong>，则被涂成绿色。</li><li id="f4f4" class="lc ld hi jm b jn ll jr lm jv ln jz lo kd lp kh lh li lj lk bi translated">我们还会计算因为没有保持社交距离而变得不安全的人数。</li></ul><p id="23a4" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">已经感兴趣了？让我们从有趣的部分开始吧…</p><figure class="lr ls lt lu fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/e2c220b77d20e39db14dbb48c3b47531.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*KMsccuU1RBpZp25yNzLT7g.jpeg"/></div></figure><h1 id="8040" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">项目</h1><ol class=""><li id="e8e3" class="lc ld hi jm b jn jo jr js jv le jz lf kd lg kh lv li lj lk bi translated">首先，让我们看看项目结构</li></ol><figure class="lr ls lt lu fd ij er es paragraph-image"><div class="er es lw"><img src="../Images/73318d640a150b6598944ea250212e69.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*4Zibn8nhldne3j8pxijPjA.png"/></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">项目结构</figcaption></figure><p id="728a" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">2.现在为video.mp4文件(输入)<a class="ae lb" href="https://github.com/sherwyn11/Social-Distancing-Analyzer/blob/master/videos/video.mp4?raw=true" rel="noopener ugc nofollow" target="_blank">点击这里</a>。您也可以从这里下载YOLOv3重量、配置和COCO名称:</p><ul class=""><li id="fe19" class="lc ld hi jm b jn kw jr kx jv mb jz mc kd md kh lh li lj lk bi translated">YOLOv3砝码— <a class="ae lb" href="https://pjreddie.com/media/files/yolov3.weights" rel="noopener ugc nofollow" target="_blank">点击此处</a></li><li id="c03c" class="lc ld hi jm b jn ll jr lm jv ln jz lo kd lp kh lh li lj lk bi translated">YOLOv3 cfg — <a class="ae lb" href="https://github.com/pjreddie/darknet/blob/master/cfg/yolov3.cfg" rel="noopener ugc nofollow" target="_blank">点击此处</a></li><li id="cd4d" class="lc ld hi jm b jn ll jr lm jv ln jz lo kd lp kh lh li lj lk bi translated">可可姓名— <a class="ae lb" href="https://github.com/pjreddie/darknet/blob/master/data/coco.names" rel="noopener ugc nofollow" target="_blank">点击此处</a></li></ul><p id="5819" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">3.现在完成之后，打开<strong class="jm hj"> constants.py </strong>并复制以下代码行</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="1a50" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">等等…我刚刚复制了什么？</p><p id="8842" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">放心吧！该文件仅包含YOLO权重的绝对路径、cfg文件、COCO名称、输入视频路径、输出视频路径以及需要维护的<strong class="jm hj">安全距离</strong>。</p><p id="6a20" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">4.现在进入主要部分。打开<strong class="jm hj"> main.py </strong>文件。<strong class="jm hj"> </strong>首先让我们进行必要的进口。我们还定义了另外两个常量<strong class="jm hj">标签</strong>和<strong class="jm hj">颜色</strong>，我们稍后会用到。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="4458" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">5.接下来，我们使用之前下载的配置和权重加载YOLO模型。readNetFromDarknet函数帮助我们做到这一点。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="a33b" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated"><strong class="jm hj">层名</strong>包含了我们需要的来自YOLO的所有输出层名。</p><p id="4adb" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">6.现在，我们使用OpenCV的<strong class="jm hj"> VideoCapture </strong>函数读取输入的视频流。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="c4ce" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">我们最初还将视频帧(W，H)的尺寸设置为(无，无)。在此之后，我们使用OpenCV的<strong class="jm hj"> CAP_PROP_FRAME_COUNT </strong>来统计给定输入视频流中的帧数。我们还将它嵌入到try/except中，以便捕捉任何异常。</p><p id="0afc" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">7.然后，我们读取输入视频流的每一帧。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="047c" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">OpenCV的<strong class="jm hj"> read </strong>函数帮助我们轻松做到这一点。你问框架是什么？很简单！顾名思义，一帧基本上就是视频的一个镜头。所有这些帧拼接在一起构成了一个视频。帧是由3个数组组成的数组。每个阵列代表一种颜色，即蓝、绿、红(<strong class="jm hj"/>)。每个数组由0到255之间的数字组成，这些数字称为像素值。每个图像都是由像素组成的。所以对于一个4 * 4的图像，有16个像素。</p><p id="dc40" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">我们使用一个<strong class="jm hj"> while </strong>循环来循环输入视频的所有帧。如果在任何情况下，一个帧没有被抓取，我们就中断while循环，因为它可能是视频的结尾。我们还将H和W变量从(None，None)更新为(height_of_frame，width_of_frame)。接下来，我们创建一个图像帧的斑点。由于OpenCV使用“传统”的颜色表示，它们是以<strong class="jm hj"> BGR </strong>的形式(蓝色、绿色、红色)。因此，我们传递参数swapRB = True来交换R &amp; B颜色数组。因此，我们现在得到一个<strong class="jm hj"> RGB </strong>颜色数组。我们还通过将数组元素除以255来重新缩放图像，以便每个元素位于0到1之间，这有助于模型更好地执行。</p><p id="ed10" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated"><strong class="jm hj">斑点</strong>代表二进制大对象，指的是二进制<strong class="jm hj">图像</strong>中的一组相连像素。然后我们把它作为模型的输入，然后我们向前传递YOLO。</p><p id="8b0e" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">8.YOLO的输出由一组值组成。这些值帮助我们定义对象属于哪个类，并且它也给我们检测到的对象的边界框值。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="1b08" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">我们对layer_outputs中的每个输出和输出中的每个检测进行循环。我们从<strong class="jm hj">检测</strong>数组中得到每个类(COCO名字中的80个类)的分数。我们也获得了每个职业的自信。然后，我们将阈值置信度保持为0.5，因为我们只对检测人感兴趣，所以我们将classID设置为0。从每次检测中，我们得到一个包围盒。检测数组的前4个元素为我们提供了[X_center_of_box，Y_center_of_box，Width_of_box，Height_of_box]，然后我们将其缩放到我们的图像帧尺寸。</p><p id="44f8" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">9.然后我们开始画边界框</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="63c2" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">我们使用非最大抑制来避免弱的和重叠的包围盒。然后我们计算当前框<strong class="jm hj"> </strong>的<strong class="jm hj">形心</strong>与所有其他检测到的边界框形心之间的距离。我们使用<strong class="jm hj">欧几里德距离</strong>来度量盒子之间的距离。下面是欧几里德距离的公式。</p><figure class="lr ls lt lu fd ij er es paragraph-image"><div class="er es mg"><img src="../Images/053591c16fbb2def4c45e37dfad292cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*AsY9lVJwcnL0OaWp-b5DdQ.jpeg"/></div></figure><p id="3a89" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">我们将每个距离与之前在<strong class="jm hj"> constants.py </strong>文件中定义的<strong class="jm hj">安全距离</strong>常数进行比较。接下来，我们使用OpenCV的使用<strong class="jm hj">矩形</strong>功能来创建一个<strong class="jm hj">矩形</strong>，它具有我们从模型中获得的盒子尺寸。我们检查盒子是安全的还是不安全的。如果不安全，那么框的颜色将是红色，否则框将是绿色。我们还使用OpenCV的<strong class="jm hj"> text </strong>函数显示了不安全人数的文本。</p><p id="b2f2" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">10.现在，我们通过将每一帧连接起来来创建一个视频</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="c76f" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">OpenCV的<strong class="jm hj"> VideoWriter </strong>功能可以帮助我们做到这一点。它会将输出视频存储在我们之前在<strong class="jm hj"> constants.py </strong>文件中定义的<strong class="jm hj"> OUTPUT_PATH </strong>指定的位置。<strong class="jm hj">释放</strong>功能将释放文件指针。</p><h1 id="76d8" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">输出</h1><p id="0e93" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">唷！…既然编码部分已经结束，是时候看看我们努力的成果了。</p><p id="cec4" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">继续运行<strong class="jm hj"> main.py </strong>文件，如下所示。</p><pre class="lr ls lt lu fd mh mi mj mk aw ml bi"><span id="da21" class="ki in hi mi b fi mm mn l mo mp">python main.py</span></pre><p id="6903" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">一旦程序执行完毕，检查你的<strong class="jm hj">输出</strong>文件夹并打开output.avi文件。</p><p id="ce14" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">它应该看起来像这样…</p><figure class="lr ls lt lu fd ij er es paragraph-image"><div class="er es mq"><img src="../Images/1d4ffb0c9ba9ae169c40afdd651d2241.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*ooYlumQgBSv0UaL5L0jm_g.gif"/></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">输出. avi</figcaption></figure><p id="3878" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">令人印象深刻的权利！</p><h1 id="3e6d" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">局限性和未来范围</h1><p id="1bd4" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">虽然这个项目很酷，但是它有一些限制，</p><ul class=""><li id="d43f" class="lc ld hi jm b jn kw jr kx jv mb jz mc kd md kh lh li lj lk bi translated">这个项目没有考虑相机视角。</li><li id="588f" class="lc ld hi jm b jn ll jr lm jv ln jz lo kd lp kh lh li lj lk bi translated">它没有利用适当的摄像机校准(距离测量不准确)。</li></ul><p id="d628" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">我们可以在未来解决这些限制。</p><p id="0d91" class="pw-post-body-paragraph jk jl hi jm b jn kw jp jq jr kx jt ju jv ky jx jy jz kz kb kc kd la kf kg kh hb bi translated">仅此而已。只需OpenCV、python和几行代码，我们就能创造出很酷的东西！</p><h1 id="21e8" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">密码</h1><p id="cb80" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">本文的全部代码都在这个GitHub链接上。如果你喜欢这个项目，请在我的GitHub回购上留下⭐️。</p><div class="mr ms ez fb mt mu"><a href="https://github.com/sherwyn11/Social-Distancing-Analyzer" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab dw"><div class="mw ab mx cl cj my"><h2 class="bd hj fi z dy mz ea eb na ed ef hh bi translated">sherwyn 11/社交距离分析仪</h2><div class="nb l"><h3 class="bd b fi z dy mz ea eb na ed ef dx translated">社交距离是有意增加人与人之间的物理空间，以避免传播疾病。住在…</h3></div><div class="nc l"><p class="bd b fp z dy mz ea eb na ed ef dx translated">github.com</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni ik mu"/></div></div></a></div><h1 id="a0de" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">结束注释</h1><p id="02d3" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">如果你觉得这篇文章有用，请给它一个掌声。谢谢大家！</p></div></div>    
</body>
</html>