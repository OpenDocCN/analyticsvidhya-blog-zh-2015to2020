<html>
<head>
<title>ETL pipeline in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的ETL管道</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/design-an-etl-pipeline-using-pandas-fd42adcb21f7?source=collection_archive---------2-----------------------#2020-04-24">https://medium.com/analytics-vidhya/design-an-etl-pipeline-using-pandas-fd42adcb21f7?source=collection_archive---------2-----------------------#2020-04-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6cc2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在数据世界中，ETL代表提取、转换和加载。几乎在每个数据管道或工作流中，我们通常从各种来源(结构化、半结构化或非结构化格式)提取数据，转换或清理数据，并将其加载到ODS(运营数据源)或DWH(数据仓库)中，这最后一步基本上将数据整理成统一的格式，供各种下游应用程序使用。</p><p id="683d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">执行ETL有多种方式，可以是普通的SQL(结构化查询语言)、ETL工具或任何编程语言。这篇博客的主要重点是设计一个非常基本的ETL管道，在这里我们将学习从数据库(比如Oracle)中提取数据，使用各种Pandas方法转换或清理数据，并将转换或清理的数据加载到目标系统(CSV或DB)中。这篇博客的内容非常基础，可以帮助你理解python中ETL程序的流程。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/a5cce58022fec5e8ca693407f757cf2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*9RcA-lvpuS2P9xR0O9HpZw.jpeg"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">ETL过程</figcaption></figure><p id="0b9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们有一个XYZ组织的员工数据和他们各自部门的信息，我们将尝试执行一些工资操作和其他东西，随着我们的进展，我们会知道。</p><p id="70e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在从这里开始，我们将用编码语言交谈。好了，让我们直接跳到代码部分。</p><ol class=""><li id="83b3" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated"><strong class="ih hj">连接到源系统</strong></li></ol><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="1d16" class="kd ke hi jz b fi kf kg l kh ki">import pandas as pd<br/>from sqlalchemy import create_engine<br/>engine = create_engine(‘oracle://scott:scott@orcl’, echo=False)</span></pre><p id="bd62" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SQLAlchemy是一个Python SQL工具包，它为我们提供了连接各种关系数据库的灵活性，在我们的例子中是Oracle。</p><p id="ac9e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">create_engine是在SQLAlchemy下定义的一个方法，它使用参数(连接字符串)来连接数据库。</p><p id="9327" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。从数据源提取数据</strong></p><p id="d185" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">提取在XYZ组织工作的雇员的数据，并执行各种转换操作来操作数据。</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="87dc" class="kd ke hi jz b fi kf kg l kh ki">emp_df=pd.read_sql_query(‘select * from emp’,engine)<br/>emp_df.head(10)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kj"><img src="../Images/75b44f4cb0dff410955aefb1c9442a9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*CUDYwRRObrIV9-v010VRRg.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">员工数据</figcaption></figure><p id="acc8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">提取员工各自的部门信息。</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="8e63" class="kd ke hi jz b fi kf kg l kh ki">dept_df=pd.read_sql_query(‘select * from dept’,engine)<br/>dept_df.head(10)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kk"><img src="../Images/18611a450d941d7951303a70131ea703.png" data-original-src="https://miro.medium.com/v2/resize:fit:596/format:webp/1*AcrcHS6seowNsZvy2iJoiQ.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">部门数据</figcaption></figure><p id="a350" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">read_sql_query是一个连接数据库的pandas方法，该方法以<strong class="ih hj">查询</strong>和<strong class="ih hj">连接字符串</strong>作为输入参数，在数据库上触发查询，并以pandas数据帧格式给出结果。</p><p id="4bfb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3。数据转换和清理:</strong>我们将把这个部分分成子部分。</p><p id="4fa4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第一部分。</strong>编写一个函数，根据税板计算雇员工资的税。我们将通过各种可能的方法来解决这个问题。</p><p id="8d47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">场景1:使用map()(T13)定义一个函数来计算薪水系列的税额</strong></p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="fe97" class="kd ke hi jz b fi kf kg l kh ki">def cal_taxes(sal):<br/>	tax=0<br/>	if sal &gt;500 and sal &lt;=1250:<br/> 		tax=sal*.125<br/>	elif sal&gt;1250 and sal&lt;=1700:<br/>		tax=sal*.175<br/>	elif sal&gt;1700 and sal&lt;=2500:<br/>		tax=sal*.225<br/>	elif sal&gt;2500:<br/>		tax=sal*.275<br/>	else:<br/>		tax=0<br/>	return tax</span></pre><p id="a590" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Pandas map()在系列上实现定义的功能。</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="8cdc" class="kd ke hi jz b fi kf kg l kh ki">emp_df[‘Tax’]=emp_df[‘sal’].map(cal_taxes)<br/>emp_df.head(10)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kl"><img src="../Images/a7962187a4a1ec2c6bdd636e9ec88f01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*EjnAjMMuAiEJZbbxE7vxOw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">带映射的函数</figcaption></figure><p id="c60b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">场景2:在map()中使用lambda表达式</strong></p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="979c" class="kd ke hi jz b fi kf kg l kh ki">#lambda expression with nested if-else<br/>emp_df[‘tax’]=emp_df[‘sal’].map(lambda x: x*.125 if x&gt;500 and x&lt;=1250 else x*.175 if x&gt;1250 and x&lt;=1750<br/> 	else x*.225 if x&gt;1750 and x&lt;2250<br/>	 else x*.275 )<br/>emp_df.head(10)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kq"><img src="../Images/c4094ce26d17eb8687baef6ed0d27fb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*EnSMW9wqdzqZ65JLVtF2Fw.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">使用lambda映射</figcaption></figure><p id="6179" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">场景3:通过apply()使用lambda表达式</strong></p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="5df9" class="kd ke hi jz b fi kf kg l kh ki">#default axis of apply is axis=0 and with this argument it works exactly like map<br/>emp_df[‘app_tax’]=emp_df[‘sal’].apply(lambda x: x*.125 if x&gt;500 and x&lt;=1250 <br/>	else x*.175 if x&gt;1250 and x&lt;=1750 <br/>	else x*.225 if x&gt;1750 and x&lt;2250<br/>	else x*.275 )<br/>emp_df.head(10)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kr"><img src="../Images/2e5b960019ad0b127b1c66c0d43fd78f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DDFGRCemU2cgAPalJAEMhA.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">应用lambda</figcaption></figure><p id="7baa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第二部分。</strong>计算佣金/销售百分比%</p><p id="1e57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先删除tax列，因为我们只需要其中一项。</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="0495" class="kd ke hi jz b fi kf kg l kh ki">#drop syntax to drop single or multiple columns<br/>emp_df.drop(columns=[‘tax’,’app_tax’],inplace=True)<br/>emp_df.head(10)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ks"><img src="../Images/41c9279cd9fcf37d07abc76d0d6d54b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*nfmgH-LNY5gnRzzkvQW-0A.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">删除列</figcaption></figure><p id="fc9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在计算comm/sal百分比之前，似乎需要对数据进行一些清理，因为我们可以在comm列中看到NaN或Null和零，这些不需要的数据会影响计算。让我们清理数据。</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="80dd" class="kd ke hi jz b fi kf kg l kh ki">#replace Nan or nulls or 0 in comm with their respective salary values<br/>#means replace null in comm with value in salary of that record</span><span id="6b45" class="kd ke hi jz b fi kt kg l kh ki">emp_df[‘comm’]=emp_df[[‘sal’,’comm’]].apply(lambda x: x[0] <br/>	if (pd.isnull(x[1]) or int(x[1])==0) else x[1], axis=1)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ku"><img src="../Images/ae7758f2538110649254275aa8b6a638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*xaCgxpksOl5MDJ0ClXSGDA.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">零处理</figcaption></figure><p id="5f9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们的数据被清理，让我们计算佣金/销售%</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="1e5e" class="kd ke hi jz b fi kf kg l kh ki">emp_df[‘comm_%’]=(emp_df[‘comm’]/emp_df[‘sal’])*100<br/>emp_df.head(10)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kv"><img src="../Images/1c6d0bb791637bd60b5ac08c51d11d66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*AkccXjiUG3_aPZBC5JVPfg.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">佣金/销售百分比</figcaption></figure><p id="0f86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第三部分。我们可以看到，许多记录的comm值都是100%,这显然不是因为性能，而是因为数据处理。在下一个需求中，我们必须将数据标记为<strong class="ih hj">有效</strong>和<strong class="ih hj">无效</strong>，并创建单独的数据集。</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="b77b" class="kd ke hi jz b fi kf kg l kh ki">emp_df[‘Comm_Flag’]=emp_df[[‘sal’,’comm’]].apply(lambda x: ‘Invalid’ <br/>	 if int(x[0])==int(x[1]) else ‘Valid’,axis=1)<br/>emp_df.head(10)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kw"><img src="../Images/7870f33471bc56eb5dfb8681dc0c9369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9JQiPthU8q2oRTINuYyQzw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">标记记录</figcaption></figure><p id="c450" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，过滤数据并创建单独的数据框</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="8274" class="kd ke hi jz b fi kf kg l kh ki">#valid data<br/>comm_valid=emp_df[emp_df[‘Comm_Flag’]==’Valid’]<br/>comm_valid.head(5)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kx"><img src="../Images/d6fef439af5e6a88e411965075ad3bb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*X9_xmBPhBAEQnSFZpBgYZg.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">有效数据集</figcaption></figure><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="71da" class="kd ke hi jz b fi kf kg l kh ki">#invalid values<br/>comm_invalid=emp_df[emp_df[‘Comm_Flag’]==’Invalid’]<br/>comm_invalid.head(10)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ky"><img src="../Images/6102d6426060b39efcd2dacc747a4590.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8O1f_KiFG8PXsP3Awu98YA.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">无效的数据集</figcaption></figure><p id="e592" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第四部分。分组数据</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="b202" class="kd ke hi jz b fi kf kg l kh ki">#calculate department wise average salary <br/>agg_sal=emp_df.groupby([‘deptno’])[‘sal’].mean()<br/>print(agg_sal)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kz"><img src="../Images/b5c9b77fdd521c60f0483be7858bbac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*qhxSFjA_iUD04nUb7Lxc0g.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">平均sal</figcaption></figure><p id="f260" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第五部分。</strong>将分组数据集与原始数据帧合并</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="e58c" class="kd ke hi jz b fi kf kg l kh ki">#pandas merge() to combine data sets<br/>joined_df=pd.merge(emp_df,agg_sal,on=’deptno’)<br/>joined_df</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es la"><img src="../Images/1e31a3f74a73b6c86c7c281ba4adcef2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ppxTspppRSyOEondSMe2gw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">组合数据集</figcaption></figure><p id="e95b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">列名看起来不酷，所以让我们重命名列以便更好地识别。</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="2cdc" class="kd ke hi jz b fi kf kg l kh ki">#rename columns to make data more meaningful<br/>joined_df.rename(columns={‘sal_x’:’sal’,’sal_y’:’avg_sal’},inplace=True)<br/>joined_df.drop(columns=’Comm_Flag’,inplace=True)<br/>joined_df.sort_values(‘deptno’)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lb"><img src="../Images/70f1b8f0cc23bde735df47fcb8ec6044.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NOClITVKcjR2K0vmvwAfFQ.png"/></div></div></figure><p id="62ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第六部分。</strong>数据操作。</p><p id="178f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们假设我们有一个来自下游应用程序的特定要求，他们有特定的工作代码，他们希望数据是这种格式。因此，首先根据需求定义一个映射并实现代码。</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="39fa" class="kd ke hi jz b fi kf kg l kh ki">#mapping of job codes defined below<br/>job_map={‘MANAGER’:’MGR’,’PRESIDENT’:’Country_Head’,’CLERK’:’CLK’,<br/> ‘ANALYST’:’SDE2',’SALESMAN’:’Sales&amp;Marketing’}</span><span id="f8d5" class="kd ke hi jz b fi kt kg l kh ki">#create a new dataframe with update job values<br/>df=joined_df.replace({‘job’:job_map})<br/>df</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lc"><img src="../Images/26377f43e22a9caf6b7d5749dbbcf181.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uCf7BVzW6S30y3gJnXo11w.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">数据操作</figcaption></figure><p id="c8be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第七部分。</strong>合并员工及其各自部门的数据集。</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="0e9c" class="kd ke hi jz b fi kf kg l kh ki">final=pd.merge(df,dept_df[[‘deptno’,’dname’,’loc’]],on=’deptno’,how=’inner’)<br/>final</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ld"><img src="../Images/47688b9542075cd9eb27f92070c25fe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8bPdRojtGpSXcLlLPxt-6Q.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">合并数据集</figcaption></figure><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="6902" class="kd ke hi jz b fi kf kg l kh ki">#manipulate dept names, just to get a more cleanliness<br/>dname_map={‘RESEARCH’:’R&amp;D’,’SALES’:’SALES’,’ACCOUNTING’:’ACCT’}<br/>final=final.replace({‘dname’:dname_map})<br/>final</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es le"><img src="../Images/ab1541bed360b2718cb20800b79a394a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pSOy42yto1BsM4JVfDq5SQ.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">部门名称操作</figcaption></figure><p id="b476" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第八部分。</strong>创建干净的最终数据集。</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="b3d0" class="kd ke hi jz b fi kf kg l kh ki">cleaned_df=final[[‘empno’,’ename’,’job’,’hiredate’,’sal’,’Tax’,’avg_sal’,’dname’,’loc’]]<br/>cleaned_df</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lf"><img src="../Images/42163e3648bdc928fdb741005a82733b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*FQH21kluZ1--mOO_5C5oIQ.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">最终数据集</figcaption></figure><p id="d177" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 4。加载到目标</strong></p><p id="969b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是数据加载过程的最后一步，我们已经提取和处理了数据集，现在是时候将数据加载到DWH/ODS，以使数据可供下游使用。</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="00e4" class="kd ke hi jz b fi kf kg l kh ki">cleaned_df.to_sql(‘emp_dept’,con=engine,if_exists=’replace’,index=False)</span></pre><p id="4ca2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">pandas <strong class="ih hj"> to_sql() </strong>方法将数据转储到目标系统中。最后查询表并检查数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lg"><img src="../Images/aef1f7c32ff9c29645927cb3b0fe000c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ARq4LJIsNPCjXzGMp-v_w.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">数据加载到目标中</figcaption></figure><h1 id="6ee7" class="lh ke hi bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated"><strong class="ak">概要:</strong></h1><p id="8a9c" class="pw-post-body-paragraph if ig hi ih b ii me ik il im mf io ip iq mg is it iu mh iw ix iy mi ja jb jc hb bi translated">使用pandas设计ETL管道的简单方法</p><p id="0185" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">了解用于建立数据库连接的<strong class="ih hj"> SQLAlchemy </strong>包</p><p id="c4d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">熊猫<strong class="ih hj"> read_sql_query() </strong>和<strong class="ih hj"> to_sql() </strong>方法</p><p id="3d19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">熊猫<strong class="ih hj"> map() </strong>，<strong class="ih hj"> apply() </strong>和<strong class="ih hj"> lambda </strong>表达式与<strong class="ih hj">嵌套if-else </strong></p><p id="be9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">熊猫<strong class="ih hj">分组方式()</strong>方法</p><p id="0819" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用pandas <strong class="ih hj"> merge() </strong>合并数据集</p><p id="8a9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Pandas <strong class="ih hj"> replace() </strong>方法来操作序列中的值</p><p id="6129" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<strong class="ih hj"> to_sql() </strong>方法将数据加载到目标</p><p id="7c8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢所有人阅读我的博客，如果你喜欢我的内容和解释，请在媒体上关注我并分享你的反馈，这将永远帮助我们所有人提高我们的知识。</p><p id="4d12" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢</p><p id="b3b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Vivek Chaudhary</p></div></div>    
</body>
</html>