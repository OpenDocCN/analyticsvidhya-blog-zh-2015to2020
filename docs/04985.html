<html>
<head>
<title>Building Tensorflow 2.0 with GPU support and TensorRT on Ubuntu 18.04 LTS [Part 1]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Ubuntu 18.04 LTS上使用GPU支持和TensorRT构建Tensorflow 2.0第1部分]</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/building-tensorflow-2-0-with-gpu-support-and-tensorrt-on-ubuntu-18-04-lts-part-1-e04ce41f885c?source=collection_archive---------6-----------------------#2020-04-07">https://medium.com/analytics-vidhya/building-tensorflow-2-0-with-gpu-support-and-tensorrt-on-ubuntu-18-04-lts-part-1-e04ce41f885c?source=collection_archive---------6-----------------------#2020-04-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/678ef425c8ee1bf2c7bf742904fd7679.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LtgpwS2Ly3WDFOv_MIHFiw.png"/></div></div></figure><p id="f734" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi jo translated">有一次，我发现自己站在一条分成两条路的路上:Tensorflow还是Pytorch？和几乎任何其他生活选择一样，这也有它自己的不确定性、确定性和满足感。我选择了我内心呼唤的那条路…它让一切都变得不同。</p><p id="6144" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我不否认安装Tensorflow可能是一件痛苦且极其麻烦的事情，尤其是如果我们不知道我们的目标是什么，而我们几乎从来不知道。然而由于某些原因(灵活性和控制是两个最突出的原因)，我总是喜欢从源代码构建张量流。这正是本文所要讨论的。由于这是一个漫长的过程，我决定将其分为两部分，内容分配如下:</p><p id="8c4f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Part 1: </strong> <a class="ae jx" rel="noopener" href="/@shivam.iitmandi/building-tensorflow-2-0-with-gpu-support-and-tensorrt-on-ubuntu-18-04-lts-part-1-e04ce41f885c">安装NVIDIA驱动、CUDA、cuDNN </a>。</p><p id="ec6e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第二部分:</strong> <a class="ae jx" rel="noopener" href="/@shivam.iitmandi/building-tensorflow-2-0-with-gpu-support-and-tensorrt-on-ubuntu-18-04-lts-part-2-ff2b1482c0a3">安装TensorRT和Tensorflow </a>。</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><p id="5aef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kf">在Ubuntu 16.04上构建有GPU支持的Tensorflow 1.14和TensorRT，请参考此</em> <a class="ae jx" rel="noopener" href="/analytics-vidhya/building-tensorflow-1-14-with-gpu-support-and-tensorrt-on-ubuntu-16-04-84bbd356e03"> <em class="kf">链接</em> </a> <em class="kf">。</em></p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><p id="c4a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">要求:</strong></p><ul class=""><li id="1fb5" class="kg kh hi is b it iu ix iy jb ki jf kj jj kk jn kl km kn ko bi translated">CUDA = 10.0</li><li id="d939" class="kg kh hi is b it kp ix kq jb kr jf ks jj kt jn kl km kn ko bi translated">NVIDIA GPU驱动(= 410.x)</li><li id="34a1" class="kg kh hi is b it kp ix kq jb kr jf ks jj kt jn kl km kn ko bi translated">cuDNN SDK (= 7.3.1)</li><li id="7780" class="kg kh hi is b it kp ix kq jb kr jf ks jj kt jn kl km kn ko bi translated">CUPTI(附带CUDA工具包)</li><li id="556b" class="kg kh hi is b it kp ix kq jb kr jf ks jj kt jn kl km kn ko bi translated">坦索特(= 5.0)</li><li id="c9d5" class="kg kh hi is b it kp ix kq jb kr jf ks jj kt jn kl km kn ko bi translated">巴泽尔</li><li id="1608" class="kg kh hi is b it kp ix kq jb kr jf ks jj kt jn kl km kn ko bi translated">Python (2.7，3.5 — 3.7) [Tensorflow 2.1是支持Python 2的最后一个版本]</li><li id="5a9b" class="kg kh hi is b it kp ix kq jb kr jf ks jj kt jn kl km kn ko bi translated">pip(版本≥ 19.0)</li></ul></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="eb01" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">第一步:更新和升级你的系统。</h1><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="8f54" class="mb kv hi lx b fi mc md l me mf">$ sudo apt-get update</span><span id="f49e" class="mb kv hi lx b fi mg md l me mf">$ sudo apt-get upgrade</span></pre><h1 id="5d8a" class="ku kv hi bd kw kx mh kz la lb mi ld le lf mj lh li lj mk ll lm ln ml lp lq lr bi translated">步骤2:确认你有支持CUDA的GPU。</h1><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="ee86" class="mb kv hi lx b fi mc md l me mf">$ lspci | grep -i nvidia</span></pre><p id="746c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="kf"> lspci </em> </strong>命令返回系统上安装的所有硬件的列表。使用<strong class="is hj"> <em class="kf"> grep -i nvidia </em> </strong>只返回nvidia驱动的名称。记下名称，并在<a class="ae jx" href="http://developer.nvidia.com/cuda-gpus." rel="noopener ugc nofollow" target="_blank">http://developer.nvidia.com/cuda-gpus.</a>检查您的GPU是否支持CUDA</p><p id="c6b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果有，记下它的计算能力。以后会需要的。</p><h1 id="a9b4" class="ku kv hi bd kw kx mh kz la lb mi ld le lf mj lh li lj mk ll lm ln ml lp lq lr bi translated">第3步:删除任何现有的或以前安装的CUDA以及NVIDIA显卡驱动程序。</h1><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="eef3" class="mb kv hi lx b fi mc md l me mf">$ sudo apt-get --purge remove "*cublas*" "cuda*" "nvidia-cuda*"</span><span id="ff89" class="mb kv hi lx b fi mg md l me mf">$ sudo rm -rf /usr/local/cuda*</span><span id="3a0a" class="mb kv hi lx b fi mg md l me mf">$ sudo apt-get --purge remove "*nvidia*"</span><span id="69ee" class="mb kv hi lx b fi mg md l me mf">$ sudo apt-get autoremove</span><span id="3ac9" class="mb kv hi lx b fi mg md l me mf">$ sudo apt-get autoclean</span></pre><p id="95ca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">前两个命令将分别删除所有cuda文件和文件夹。第三个命令是卸载安装在您系统上的nvidia驱动程序，稍后将替换为兼容的驱动程序。最后两个命令用于删除不合适的和不必要的文件，这些文件是作为这个包的依赖项安装的，但不再需要。</p><h1 id="73b9" class="ku kv hi bd kw kx mh kz la lb mi ld le lf mj lh li lj mk ll lm ln ml lp lq lr bi translated">步骤4:安装所需的NVIDIA驱动程序。**</h1><p id="ad5f" class="pw-post-body-paragraph iq ir hi is b it mm iv iw ix mn iz ja jb mo jd je jf mp jh ji jj mq jl jm jn hb bi translated">在安装CUDA之前，您需要在您的机器上安装兼容版本的NVIDIA驱动程序。有两种安装驱动程序的方法:</p><h2 id="72e0" class="mb kv hi bd kw mr ms mt la mu mv mw le jb mx my li jf mz na lm jj nb nc lq nd bi translated">通过图形用户界面安装:</h2><p id="5af1" class="pw-post-body-paragraph iq ir hi is b it mm iv iw ix mn iz ja jb mo jd je jf mp jh ji jj mq jl jm jn hb bi translated">点击键盘上的<strong class="is hj"> Windows </strong>键，搜索<strong class="is hj">软件和更新</strong>。打开后，进入选项卡<strong class="is hj">下的附加驱动</strong>，如下图所示:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ne"><img src="../Images/24c1e9a5d66979930b063aa86bc61b9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3iVBfdzsAn8-UIAIF250gg.png"/></div></div></figure><p id="c3aa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让它获取与您的系统兼容的可用NVIDIA驱动程序的信息。完成后，从列表中选择所需的驱动程序，并点击<strong class="is hj">应用更改</strong>。</p><p id="2754" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在重启。</p><h2 id="c6ed" class="mb kv hi bd kw mr ms mt la mu mv mw le jb mx my li jf mz na lm jj nb nc lq nd bi translated">通过命令行安装:</h2><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="867b" class="mb kv hi lx b fi mc md l me mf">$ sudo add-apt-repository ppa:graphics-drivers/ppa</span><span id="745c" class="mb kv hi lx b fi mg md l me mf">$ sudo apt-get update</span></pre><p id="bfdf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第一个命令是添加Ubuntu图形驱动程序的规范包。第二个是用最近添加的驱动程序包重新加载包管理器。</p><p id="e895" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，您必须在安装最新驱动程序或特定版本之间做出选择。选择取决于您的系统、Ubuntu内核版本和项目的目标(CUDA 10.0不支持≤ 410.x的版本)。</p><p id="d4fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不建议安装最新的驱动程序，因为这个PPA还在测试中。有时你可能会遇到依赖问题。我个人面临一些复杂的问题，比如没有显示，重启后无法进入Ubuntu，等等。T11】</p><blockquote class="nf ng nh"><p id="93f9" class="iq ir kf is b it iu iv iw ix iy iz ja ni jc jd je nj jg jh ji nk jk jl jm jn hb bi translated">要安装最新的驱动程序:</p></blockquote><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="7959" class="mb kv hi lx b fi mc md l me mf">$ sudo ubuntu-drivers devices</span><span id="2d99" class="mb kv hi lx b fi mg md l me mf">$ sudo ubuntu-drivers autoinstall</span></pre><p id="1031" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第一个命令列出了两种图形硬件的可用驱动程序，即Intel和NVIDIA(或AMD？但从未尝试过AMD)。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nl"><img src="../Images/a9dd9a48345afb4414741fcfb5e042b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EbS4KeeF7uSHag9VDDsLJA.png"/></div></div></figure><p id="524c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第二个命令为所有图形设备安装最新的驱动程序(或推荐的驱动程序)。</p><blockquote class="nf ng nh"><p id="965a" class="iq ir kf is b it iu iv iw ix iy iz ja ni jc jd je nj jg jh ji nk jk jl jm jn hb bi translated">要安装特定版本:</p></blockquote><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="e2c4" class="mb kv hi lx b fi mc md l me mf">$ sudo apt install nvidia-${version_number}</span></pre><p id="bd99" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用所需版本替换<strong class="is hj">$ {版本号} </strong>。</p><p id="f943" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重启。</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><p id="ada0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> ** </strong>如果您选择使用<em class="kf"> runfile </em>安装方法安装CUDA，可以跳过这一步。详见<strong class="is hj">步骤5 </strong>下<strong class="is hj">选择安装方法</strong>。</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h2 id="b94b" class="mb kv hi bd kw mr ms mt la mu mv mw le jb mx my li jf mz na lm jj nb nc lq nd bi translated">验证NVIDIA图形驱动程序的安装:</h2><blockquote class="nf ng nh"><p id="82f9" class="iq ir kf is b it iu iv iw ix iy iz ja ni jc jd je nj jg jh ji nk jk jl jm jn hb bi translated">方法1:</p></blockquote><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="a0a9" class="mb kv hi lx b fi mc md l me mf">$ nvidia-smi | grep "Driver Version" | awk '{print $6}' | cut -c1-</span></pre><p id="111c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果该过程成功，将会打印安装的驱动程序版本。</p><blockquote class="nf ng nh"><p id="0a6e" class="iq ir kf is b it iu iv iw ix iy iz ja ni jc jd je nj jg jh ji nk jk jl jm jn hb bi translated">方法二:</p></blockquote><p id="0144" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">转到<strong class="is hj">设置&gt;细节</strong>，然后检查<strong class="is hj">图形</strong>查询的条目。如果它显示某个NVIDIA驱动程序，则该驱动程序安装成功。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nm"><img src="../Images/2a1fa5371be1095e983297de0ad4bf8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kkOal-hL3qeYAxGSbFwjYw.png"/></div></div></figure><blockquote class="nf ng nh"><p id="7b74" class="iq ir kf is b it iu iv iw ix iy iz ja ni jc jd je nj jg jh ji nk jk jl jm jn hb bi translated">方法三:</p></blockquote><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="9129" class="mb kv hi lx b fi mc md l me mf">$ prime-select query</span></pre><p id="dc88" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> prime </strong>是一个NVIDIA命令，用于在英特尔和NVIDIA图形驱动程序之间切换。上面的命令显示了正在使用的驱动程序的名称。如果输出是<strong class="is hj"> <em class="kf"> nvidia </em> </strong>，那么驱动安装成功。</p><h1 id="d750" class="ku kv hi bd kw kx mh kz la lb mi ld le lf mj lh li lj mk ll lm ln ml lp lq lr bi translated">步骤5:安装所需的CUDA版本。</h1><h2 id="b8a9" class="mb kv hi bd kw mr ms mt la mu mv mw le jb mx my li jf mz na lm jj nb nc lq nd bi translated">安装前步骤:</h2><ul class=""><li id="1328" class="kg kh hi is b it mm ix mn jb nn jf no jj np jn kl km kn ko bi translated"><strong class="is hj">验证您的系统已经安装了<em class="kf">gcc</em>:</strong></li></ul><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="09cc" class="mb kv hi lx b fi mc md l me mf">$ gcc --version</span></pre><p id="b795" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该命令返回安装在您系统中的<strong class="is hj"> gcc </strong>的版本。虽然Tensorflow文档要求gcc版本为7.3.1，但它在使用bazel构建pip包时给了我一个编译错误。我做了任何程序员都会做的事，我谷歌了一下。我发现这个问题在更高版本的gcc中依然存在。我不确定它与哪个版本不兼容，但我发现了版本7和8的问题。我宁愿选择6.5版本，它对我来说非常有用。</p><p id="fde5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">【更新】:GCC 7 . 5 . 0版也管用。以前，我在bazel build命令中有一些标志错误。如果7不适合您，请使用版本6。</p><blockquote class="nf ng nh"><p id="0eb9" class="iq ir kf is b it iu iv iw ix iy iz ja ni jc jd je nj jg jh ji nk jk jl jm jn hb bi translated">安装gcc版本6.5(可选):</p></blockquote><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="32b3" class="mb kv hi lx b fi mc md l me mf">$ sudo apt-get install gcc-6 g++-6</span><span id="30e2" class="mb kv hi lx b fi mg md l me mf">$ sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-6 600 --slave /usr/bin/g++ g++ /usr/bin/g++-</span><span id="ec79" class="mb kv hi lx b fi mg md l me mf">$ sudo update-alternatives --config gcc</span></pre><p id="d724" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第一个命令是安装gcc和g++版本6。安装后，您需要告诉系统使用当前安装的版本，而不是正在使用的版本。这是通过为gcc设置可选选项(或者通过创建符号链接，无论您喜欢哪种方式)来完成的，因此是第二个命令。然后使用第三个命令从备选选项中选择所需的版本，其输出如下所示:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nq"><img src="../Images/6290d726ad629c459905d27e90e2a806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3hChlNvWACt4Mz55Sl4jgw.png"/></div></div></figure><ul class=""><li id="942e" class="kg kh hi is b it iu ix iy jb ki jf kj jj kk jn kl km kn ko bi translated"><strong class="is hj">验证系统具有正确的内核头文件和开发包:</strong></li></ul><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="dbcd" class="mb kv hi lx b fi mc md l me mf">$ uname -r</span><span id="538b" class="mb kv hi lx b fi mg md l me mf">$ sudo apt-get install linux-headers-<strong class="lx hj">${uname -r}</strong></span></pre><p id="ebad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第一个命令显示系统上运行的内核版本。第二个命令安装相应的内核头文件和开发包。用第一个命令的输出替换第二个命令中的<strong class="is hj"> ${uname -r} </strong>。</p><p id="8531" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">CUDA驱动程序的安装要求内核头文件和开发包的版本与系统上运行的内核版本相同。<em class="kf">运行文件</em>不执行包验证，但<em class="kf">执行包验证。转速</em>和<em class="kf">。deb </em>安装会尝试安装内核头文件和开发包，如果找不到的话。然而，它将安装最新版本，这可能与您的内核不匹配。强烈建议手动安装软件包。</p><ul class=""><li id="ad68" class="kg kh hi is b it iu ix iy jb ki jf kj jj kk jn kl km kn ko bi translated"><strong class="is hj">选择安装方式:</strong></li></ul><blockquote class="nf ng nh"><p id="cc27" class="iq ir kf is b it iu iv iw ix iy iz ja ni jc jd je nj jg jh ji nk jk jl jm jn hb bi translated">方法1: RPM或DEB安装</p></blockquote><p id="e717" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kf">。转速</em>和<em class="kf">。deb包是特定于发行版的包，它会干扰发行版的本地包管理系统。这使得it部门可以随时更新/升级软件包。</em></p><blockquote class="nf ng nh"><p id="dadb" class="iq ir kf is b it iu iv iw ix iy iz ja ni jc jd je nj jg jh ji nk jk jl jm jn hb bi translated">方法2:运行文件安装</p></blockquote><p id="a978" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">runfile 包是一个独立于发行版的包，它允许您在更广泛的Linux发行版上工作，但不更新发行版的本地包管理系统。它还安装了NVIDIA图形驱动程序以及CUDA工具包。</p><p id="095b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我个人更喜欢<em class="kf"> runfile </em>包，因为更新会导致依赖性的不兼容，而且一个稳定的系统是一个有效的系统！</p><ul class=""><li id="725d" class="kg kh hi is b it iu ix iy jb ki jf kj jj kk jn kl km kn ko bi translated"><strong class="is hj">下载NVIDIA CUDA工具包10.0: </strong></li></ul><p id="f3a4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下载想要的包(<em class="kf">)。转速</em> / <em class="kf">。从这个<a class="ae jx" href="https://developer.nvidia.com/cuda-10.0-download-archive" rel="noopener ugc nofollow" target="_blank">链接</a>运行CUDA 10.0的deb </em>或<em class="kf"> runfile </em>。如果去找<em class="kf">。deb </em>包，选择<em class="kf"> deb(local) </em>选项，否则选择<em class="kf"> runfile </em>包，如下图所示:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nr"><img src="../Images/95293a901a49c088e8196a7ee1cdff7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hitStj0AExZ6hgUH8-yGjw.png"/></div></div></figure><h2 id="ce76" class="mb kv hi bd kw mr ms mt la mu mv mw le jb mx my li jf mz na lm jj nb nc lq nd bi translated">安装CUDA 10.0:</h2><blockquote class="nf ng nh"><p id="edd5" class="iq ir kf is b it iu iv iw ix iy iz ja ni jc jd je nj jg jh ji nk jk jl jm jn hb bi translated">。rpm或。deb安装:</p></blockquote><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="a42e" class="mb kv hi lx b fi mc md l me mf">$ cd ~ <em class="kf">#Or the directory containing the downloaded .deb package</em></span><span id="62ae" class="mb kv hi lx b fi mg md l me mf">$ sudo dpkg -i cuda-repo-ubuntu1804-10-0-local-10.0.130-410.48_1.0-1_amd64.deb</span><span id="feee" class="mb kv hi lx b fi mg md l me mf">$ sudo dpkg -i cuda-repo-ubuntu1804-10-0-local-nvjpeg-update-1_1.0-1_amd64.deb</span><span id="32bb" class="mb kv hi lx b fi mg md l me mf">$ sudo apt-key add /var/cuda-repo-10-0-local-10.0.130-410.48/7fa2af80.pub</span><span id="ba4e" class="mb kv hi lx b fi mg md l me mf">$ sudo apt-get update</span><span id="5ced" class="mb kv hi lx b fi mg md l me mf">$ sudo apt-get install cuda</span></pre><p id="deb7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第一个命令是将目录更改为包含下载包的目录。第二个和第三个命令分别安装存储库和补丁的元数据。第四个命令是安装CUDA的公共GPG密钥。第五个和最后一个命令分别是更新APT存储库缓存和安装CUDA。</p><blockquote class="nf ng nh"><p id="883e" class="iq ir kf is b it iu iv iw ix iy iz ja ni jc jd je nj jg jh ji nk jk jl jm jn hb bi translated">运行文件安装:</p></blockquote><p id="a86e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">由于<em class="kf"> runfile </em>安装也会安装NVIDIA显卡驱动，我们首先需要禁用Ubuntu中默认使用的<em class="kf"> nouveau </em>驱动(假设没有安装或运行NVIDIA驱动)。</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="8aca" class="mb kv hi lx b fi mc md l me mf">$ sudo gedit /etc/modprobe.d/blacklist-nouveau.conf</span><span id="f85a" class="mb kv hi lx b fi mg md l me mf"><em class="kf">#Add these lines to it:</em><br/><strong class="lx hj">blacklist nouveau<br/>options nouveau modeset=0</strong></span><span id="810e" class="mb kv hi lx b fi mg md l me mf">$ sudo update-initramfs -u</span></pre><p id="2407" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第一个命令是创建一个<em class="kf">配置</em>文件。在打开的文件中记下粗线，保存后关闭。然后使用最后一个命令更新内核的initramfs(在普通根文件系统中找到的完整目录集)。</p><p id="c1c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重启以完全禁用<em class="kf">新</em>驱动<strong class="is hj"> ** </strong>。当系统重启时，使用<strong class="is hj"> Ctrl + Alt + F3 </strong>进入文本模式(运行级别3)。</p><p id="2f01" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在继续安装之前，请确保您没有任何应用程序和/或进程使用NVIDIA驱动程序(如果以前安装过的话)。***</p><p id="600f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，运行以下命令启动安装过程，并按照说明进行操作。安装完成后，采取类似的步骤安装修补程序。</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="f115" class="mb kv hi lx b fi mc md l me mf">$ sudo sh cuda_10.0.130_410.48_linux.run</span><span id="d52e" class="mb kv hi lx b fi mg md l me mf"><em class="kf">#CUDA Version: 10.0.130<br/>#NVIDIA Driver Version: 410.48</em></span></pre></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><p id="5c80" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> ** </strong>如果重启后文本模式无法加载或显示有问题(通常发生在游戏笔记本电脑上)，请尝试执行以下操作:</p><p id="49bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重启系统，当grub启动时，在启动前按“e”编辑它。在编辑模式下，在单词“splash”后输入以下内核引导参数<strong class="is hj">:</strong></p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="41aa" class="mb kv hi lx b fi mc md l me mf"> nouveau.modeset=0 tpm_tis.interrupts=0 acpi_osi=Linux i915.preliminary_hw_support=1 idle=nomwait</span></pre><p id="919a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并按下F10启动。现在应该可以了。</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><p id="184c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">***如果安装出现错误，表示无法卸载<em class="kf"> nvidia-drm </em>，请在进入文本模式后立即键入以下命令:</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="b55f" class="mb kv hi lx b fi mc md l me mf">$ systemctl ignore multi-user.target</span><span id="6a10" class="mb kv hi lx b fi mg md l me mf">$ modprobe -r nvidia-drm</span></pre><p id="94a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第一个命令禁用图形目标，这是保持显示管理器运行的原因。第二个命令然后卸载<em class="kf"> nvidia-drm </em>。</p><p id="93c8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装完成后，确保使用以下命令再次加载它:</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="9b27" class="mb kv hi lx b fi mc md l me mf">$ systemctl start graphical.target</span></pre></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h2 id="1aba" class="mb kv hi bd kw mr ms mt la mu mv mw le jb mx my li jf mz na lm jj nb nc lq nd bi translated">安装后步骤:</h2><p id="a238" class="pw-post-body-paragraph iq ir hi is b it mm iv iw ix mn iz ja jb mo jd je jf mp jh ji jj mq jl jm jn hb bi translated">将最近安装的软件包的路径添加到PATH变量中，这样它就知道在需要时在哪里可以找到它。</p><blockquote class="nf ng nh"><p id="e723" class="iq ir kf is b it iu iv iw ix iy iz ja ni jc jd je nj jg jh ji nk jk jl jm jn hb bi translated">如果使用<em class="hi">安装。deb </em>包:</p></blockquote><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="5133" class="mb kv hi lx b fi mc md l me mf">$ export PATH=/usr/local/cuda-10.0/bin:/usr/local/cuda-10.0/NsightCompute-2019.1${PATH:+:${PATH}}</span></pre><blockquote class="nf ng nh"><p id="98ee" class="iq ir kf is b it iu iv iw ix iy iz ja ni jc jd je nj jg jh ji nk jk jl jm jn hb bi translated">如果使用运行文件包安装:</p></blockquote><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="ac03" class="mb kv hi lx b fi mc md l me mf">$ export PATH=/usr/local/cuda-10.0/bin:/usr/local/cuda-10.0/NsightCompute-2019.1${PATH:+:${PATH}}</span><span id="6931" class="mb kv hi lx b fi mg md l me mf">For 64-bit operating system:<br/>$ export LD_LIBRARY_PATH=/usr/local/cuda-10.0/lib64\<br/>                         ${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}</span><span id="aa65" class="mb kv hi lx b fi mg md l me mf">For 32-bit operating system:<br/>$ export LD_LIBRARY_PATH=/usr/local/cuda-10.0/lib\<br/>                         ${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}</span></pre><h2 id="ec17" class="mb kv hi bd kw mr ms mt la mu mv mw le jb mx my li jf mz na lm jj nb nc lq nd bi translated">验证CUDA工具包10.0的安装:</h2><p id="c5f1" class="pw-post-body-paragraph iq ir hi is b it mm iv iw ix mn iz ja jb mo jd je jf mp jh ji jj mq jl jm jn hb bi translated">要验证CUDA 10.0是否已成功安装，请尝试运行一些示例程序。这可以通过安装CUDA样例来完成，它随软件包一起提供。</p><p id="3ad0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你使用<em class="kf"> runfile </em>包安装了CUDA，那么你不必安装CUDA示例，但是如果你使用了<em class="kf">。deb </em>包，然后使用以下命令安装示例:</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="be59" class="mb kv hi lx b fi mc md l me mf">$ cuda-install-samples-10.0.sh &lt;directory&gt;</span><span id="440a" class="mb kv hi lx b fi mg md l me mf"><em class="kf">#Replace </em><strong class="lx hj"><em class="kf">&lt;directory&gt;</em></strong><em class="kf"> with the location where you want to install the samples.</em></span></pre><p id="42f9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装后，使用以下命令集运行示例程序:</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="ed1b" class="mb kv hi lx b fi mc md l me mf">$ cd NVIDIA_CUDA-10.0_Samples/</span><span id="6454" class="mb kv hi lx b fi mg md l me mf">$ make</span><span id="5e82" class="mb kv hi lx b fi mg md l me mf">$ cd 1_Utilities/deviceQuery</span><span id="bcdb" class="mb kv hi lx b fi mg md l me mf">$ ./deviceQuery</span></pre><p id="0d31" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果输出如下所示，那么这意味着CUDA已经成功安装。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ns"><img src="../Images/27ccbed1387859604b9127b9c285b594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*osV93Awt5RPL_r4VUVX5Ww.png"/></div></div></figure><p id="8db2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">边注:</strong>以上过程不编译图形样本，只编译那些使用命令行界面的。如果您想要构建所有的示例，请使用以下命令安装依赖项[OpenGL(例如，Mesa)、GLU、GLUT和X11(包括Xi、Xmu和GLX)]:</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="8c74" class="mb kv hi lx b fi mc md l me mf">$ sudo apt-get install freeglut3-dev build-essential libx11-dev libxmu-dev  libxi-dev libgl1-mesa-glx libglu1-mesa libglu1-mesa-dev</span></pre><p id="0b67" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过运行CUDA 10.0的图形示例来验证安装:</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="ebd7" class="mb kv hi lx b fi mc md l me mf">$ cd NVIDIA_CUDA-10.0_Samples/</span><span id="2dc3" class="mb kv hi lx b fi mg md l me mf">$ make</span><span id="22dc" class="mb kv hi lx b fi mg md l me mf">$ cd 5_Simulations/nbody</span><span id="eb7d" class="mb kv hi lx b fi mg md l me mf">$ ./nbody</span></pre><p id="fb8e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">附言:</strong>安装<em class="kf"> Mesa </em>可能会覆盖之前由NVIDIA驱动程序安装的<em class="kf"> /usr/lib/libGL.so </em>，因此在安装这些库之后可能需要重新安装NVIDIA驱动程序。</p><h1 id="8d27" class="ku kv hi bd kw kx mh kz la lb mi ld le lf mj lh li lj mk ll lm ln ml lp lq lr bi translated">步骤6:安装所需的cuDNN库。</h1><p id="701c" class="pw-post-body-paragraph iq ir hi is b it mm iv iw ix mn iz ja jb mo jd je jf mp jh ji jj mq jl jm jn hb bi translated">为CUDA 10.0和Ubuntu 18.04下载cuDNN <strong class="is hj"> </strong> <a class="ae jx" href="https://developer.nvidia.com/compute/machine-learning/cudnn/secure/v7.3.1/prod/10.0_2018927/Ubuntu18_04-x64/libcudnn7_7.3.1.20-1-cuda10.0_amd64" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">运行时库</strong></a><a class="ae jx" href="https://developer.nvidia.com/compute/machine-learning/cudnn/secure/v7.3.1/prod/10.0_2018927/Ubuntu18_04-x64/libcudnn7-dev_7.3.1.20-1-cuda10.0_amd64" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">开发者库</strong></a><a class="ae jx" href="https://developer.nvidia.com/compute/machine-learning/cudnn/secure/v7.3.1/prod/10.0_2018927/Ubuntu18_04-x64/libcudnn7-doc_7.3.1.20-1-cuda10.0_amd64" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">代码示例和用户指南</strong> </a>。</p><p id="0063" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，运行以下命令来安装它们:</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="c2e7" class="mb kv hi lx b fi mc md l me mf">$ cd ~ <em class="kf">#Or the directory containing the downloaded .deb package</em></span><span id="d809" class="mb kv hi lx b fi mg md l me mf">$ sudo dpkg -i libcudnn7_7.3.1.20-1+cuda10.0_amd64.deb</span><span id="f7be" class="mb kv hi lx b fi mg md l me mf">$ sudo dpkg -i libcudnn7-dev_7.3.1.20-1+cuda10.0_amd64.deb</span><span id="9242" class="mb kv hi lx b fi mg md l me mf">$ sudo dpkg -i libcudnn7-doc_7.3.1.20-1+cuda10.0_amd64.deb</span></pre><h2 id="e704" class="mb kv hi bd kw mr ms mt la mu mv mw le jb mx my li jf mz na lm jj nb nc lq nd bi translated">验证cuDNN库的安装:</h2><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="6da0" class="mb kv hi lx b fi mc md l me mf">$ cp -r /usr/src/cudnn_samples_v7/ ~</span><span id="7d4c" class="mb kv hi lx b fi mg md l me mf">$ cd cudnn_samples_v7/mnistCUDNN/</span><span id="198c" class="mb kv hi lx b fi mg md l me mf">$ make clean &amp;&amp; make</span><span id="5585" class="mb kv hi lx b fi mg md l me mf">$ ./mnistCUDNN</span></pre><p id="3b7c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果cuDNN已正确安装并在您的系统上运行，您将看到类似以下内容的消息:</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="1c4f" class="mb kv hi lx b fi mc md l me mf">Test passed!</span></pre></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><p id="57a3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这标志着第1部分的结束。请按照下一部分继续这一过程。链接可以在这里找到<a class="ae jx" rel="noopener" href="/@shivam.iitmandi/building-tensorflow-2-0-with-gpu-support-and-tensorrt-on-ubuntu-18-04-lts-part-2-ff2b1482c0a3">。</a></p><p id="3763" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">谢谢！</p></div></div>    
</body>
</html>