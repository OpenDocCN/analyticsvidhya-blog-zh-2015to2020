<html>
<head>
<title>PRAW — a python package to scrape Reddit Post data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PRAW——一个抓取Reddit帖子数据的python包</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/praw-a-python-package-to-scrape-reddit-post-data-b759a339ed9a?source=collection_archive---------7-----------------------#2020-07-02">https://medium.com/analytics-vidhya/praw-a-python-package-to-scrape-reddit-post-data-b759a339ed9a?source=collection_archive---------7-----------------------#2020-07-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8116e3e096847960221bf3a29e107cf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YwMTgdfGPkyt4ry72Glewg.png"/></div></div></figure><h1 id="d87f" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated"><strong class="ak">简介</strong></h1><p id="53be" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">RRAW代表“Python Reddit API Wrapper ”,是一个Python包，允许简单访问Reddit的API。它有一个有据可查的<a class="ae km" href="https://praw.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">官方网站</a>，代码片段可以参考。在这里，我将讨论安装、配置和编写一些python脚本来抓取Reddit帖子的步骤。</p><h1 id="c92a" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">安装和升级</h1><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="279b" class="kw ir hi ks b fi kx ky l kz la">pip install praw</span><span id="50be" class="kw ir hi ks b fi lb ky l kz la">pip install --upgrade praw</span></pre><h1 id="9bb2" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated"><strong class="ak">要求</strong></h1><p id="787f" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">熊猫应该事先安装，这将有助于管理和存储在CSV文件更容易抓取的数据。如果没有安装，请使用下面的命令进行安装。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="b836" class="kw ir hi ks b fi kx ky l kz la">conda install pandas</span></pre><h1 id="4b88" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated"><strong class="ak">报名与注册</strong></h1><p id="a4dc" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">如果你已经有一个Reddit的个人资料，去登录。如果没有，请转到<a class="ae km" href="https://www.reddit.com/" rel="noopener ugc nofollow" target="_blank">这里</a>并点击如下所示的“注册”按钮。</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/19562897ad370c56cbf32dafebb7cca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bPPI_iF--7ucL52co3d78g.png"/></div></div></figure><p id="87e4" class="pw-post-body-paragraph jo jp hi jq b jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh lh kj kk kl hb bi translated">注册后，你将被重定向到Reddit主页。点击个人资料图片旁边的下拉按钮(如下图红色箭头所示)。</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/5bb119007c36e18c19cc416ffa89bfe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kHqRUUR60I4ktvaPGtN3Qw.png"/></div></div></figure><p id="1563" class="pw-post-body-paragraph jo jp hi jq b jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh lh kj kk kl hb bi translated">点击“访问老Reddit”。</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/1d8450fae15d99198360c4dee8ee5d4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZXIgV6Bwo75A7c0XTJ17gw.png"/></div></div></figure><p id="8f3b" class="pw-post-body-paragraph jo jp hi jq b jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh lh kj kk kl hb bi translated">现在转到页面右上角的首选项。</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/dd818e81667dc3e61a2db703ca65464b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uXWJsYm-3gfppHY0WNvxgQ.png"/></div></div></figure><p id="5283" class="pw-post-body-paragraph jo jp hi jq b jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh lh kj kk kl hb bi translated">导航到导航栏上的<strong class="jq hj">应用</strong>部分，点击按钮<strong class="jq hj">“你是开发者吗？创建一个应用…"</strong>[如下图所示，使用红色箭头]</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/19e3e0e88c916338463d69446026965e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AeOaxKzc2Rb2WMAz3WlTew.png"/></div></div></figure><p id="dcf9" class="pw-post-body-paragraph jo jp hi jq b jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh lh kj kk kl hb bi translated">填写所有细节，不要忘记选择<strong class="jq hj">脚本</strong>【默认选择<strong class="jq hj"> web app </strong>】。最后，点击<strong class="jq hj">“创建应用程序”</strong>按钮。这里的所有字段都是必填的，忽略任何一个都不会允许您继续。</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/98216d0d332dd0668476b62b2a3994b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AwsPHGkUET9rmy-jUKuxiA.png"/></div></div></figure><p id="b220" class="pw-post-body-paragraph jo jp hi jq b jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh lh kj kk kl hb bi translated">您将被重定向到一个页面，在该页面上将给出<strong class="jq hj">个人使用脚本</strong>和<strong class="jq hj">安全令牌</strong>【如图所示】。将它们复制到剪贴板中，这在编写Python脚本时肯定是需要的。</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/8db53fdcae8ef5a5503280c0cb285c9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nSl1RS-FD2MGWTP-C9JHaA.png"/></div></div></figure><h1 id="dd98" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated"><strong class="ak">编写Python脚本</strong></h1><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/db51360a6cd031669481993ed24fc366.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GLYPIz22lTzv42BKVo9WSw.png"/></div></div></figure><p id="bdec" class="pw-post-body-paragraph jo jp hi jq b jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh lh kj kk kl hb bi translated">在这里我将使用Jupyter笔记本来演示整个过程。您可以使用自己选择的任何笔记本或代码编辑器。</p><p id="3b6d" class="pw-post-body-paragraph jo jp hi jq b jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh lh kj kk kl hb bi translated">我们将创建一个数据集，由来自不同子编辑的Reddit帖子的特征组成。PRAW提供了近20个属性来抓取Reddit帖子的各种功能，如Id、作者、天赋、标题、Upvote等。在这里，我们将存储每个Reddit帖子的7个特征来创建数据集。</p><h2 id="270c" class="kw ir hi bd is ll lm ln iw lo lp lq ja jz lr ls je kd lt lu ji kh lv lw jm lx bi translated"><strong class="ak">导入库</strong></h2><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="09e0" class="kw ir hi ks b fi kx ky l kz la">import praw<br/>import pandas as pd</span></pre><h2 id="027c" class="kw ir hi bd is ll lm ln iw lo lp lq ja jz lr ls je kd lt lu ji kh lv lw jm lx bi translated"><strong class="ak">使用秘密令牌访问API</strong></h2><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="6f0d" class="kw ir hi ks b fi kx ky l kz la">reddit = praw.Reddit(client_id = "CLIENT_ID", #peronal use script<br/>                    client_secret = "CLIENT_SECRET", #secret token<br/>                    usernme = "USERNAME", #profile username<br/>                    password = "PASSWORD", #profile password<br/>                    user_agent = "USERAGENT")</span></pre><h2 id="737b" class="kw ir hi bd is ll lm ln iw lo lp lq ja jz lr ls je kd lt lu ji kh lv lw jm lx bi translated"><strong class="ak">初始化每个特征的空列表</strong></h2><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="6a8c" class="kw ir hi ks b fi kx ky l kz la">author_list = []<br/>id_list = []<br/>link_flair_text_list = []<br/>num_comments_list = []<br/>score_list = []<br/>title_list = []<br/>upvote_ratio_list = []</span></pre><h2 id="23cb" class="kw ir hi bd is ll lm ln iw lo lp lq ja jz lr ls je kd lt lu ji kh lv lw jm lx bi translated"><strong class="ak">提及所有将被清除的子条目</strong></h2><p id="b7e1" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我们将从十个受欢迎的子网站中收集热门帖子。因此，所有这些子编辑名称将被存储在一个列表中，我们将遍历列表中的每个元素。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="277c" class="kw ir hi ks b fi kx ky l kz la">subreddit_list=  ['india',<br/>                  'worldnews',<br/>                  'announcements',<br/>                  'funny',<br/>                  'AskReddit',<br/>                  'gaming',<br/>                  'pics',<br/>                  'science',<br/>                  'movies',<br/>                  'todayilearned'<br/>                 ]</span></pre><h2 id="5606" class="kw ir hi bd is ll lm ln iw lo lp lq ja jz lr ls je kd lt lu ji kh lv lw jm lx bi translated"><strong class="ak">子编辑和各种属性</strong></h2><p id="9bbb" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated"><em class="ly"> subreddit( ) </em>函数采用单个参数，即subreddit名称。每个子区域都有一个名为<strong class="jq hj">热</strong>的分区。我们使用函数<em class="ly"> hot()，</em>访问热门的Reddit帖子，该函数带有一个“限制”属性，使用该属性我们可以指定想要从该子编辑中访问的帖子的数量。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="9691" class="kw ir hi ks b fi kx ky l kz la">subreddit = reddit.subreddit(subred)<br/>hot_post = subreddit.hot(limit = 10000)</span></pre><p id="5449" class="pw-post-body-paragraph jo jp hi jq b jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh lh kj kk kl hb bi translated">现在我们可以迭代hot_post，对于每个实例，我们可以调用诸如作者、id、分数、标题等属性。然后，可以将每个属性相应地附加到先前初始化的列中。例如，从subreddit(这里是印度)中抓取1000篇热帖的单个属性(这里是作者姓名)的脚本如下所示。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="f173" class="kw ir hi ks b fi kx ky l kz la">subreddit = reddit.subreddit('india')<br/>hot_post = subreddit.hot(limit = 1000)</span><span id="586a" class="kw ir hi ks b fi lb ky l kz la">for sub in hot_post:<br/>  author_list.append(sub.author)</span></pre><p id="5af3" class="pw-post-body-paragraph jo jp hi jq b jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh lh kj kk kl hb bi translated">你可以从PRAW官网<a class="ae km" href="https://praw.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">这里</a>了解更多属性。</p><h2 id="6ba6" class="kw ir hi bd is ll lm ln iw lo lp lq ja jz lr ls je kd lt lu ji kh lv lw jm lx bi translated">最终剧本</h2><p id="6f4b" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">下面给出了遍历10个子编辑名称列表、抓取和存储每个帖子的特定属性的脚本。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="8107" class="kw ir hi ks b fi kx ky l kz la">for subred in subreddit_list:<br/>    <br/>  subreddit = reddit.subreddit(subred)<br/>  hot_post = subreddit.hot(limit = 10000)</span><span id="b5da" class="kw ir hi ks b fi lb ky l kz la">  for sub in hot_post:</span><span id="702e" class="kw ir hi ks b fi lb ky l kz la">    author_list.append(sub.author)<br/>    id_list.append(sub.id)<br/>    link_flair_text_list.append(sub.link_flair_text)<br/>    num_comments_list.append(sub.num_comments)<br/>    score_list.append(sub.score)<br/>    title_list.append(sub.title)<br/>    upvote_ratio_list.append(sub.upvote_ratio)</span><span id="29a1" class="kw ir hi ks b fi lb ky l kz la">  print(subred, 'completed; ', end='')<br/>  print('total', len(author_list), 'posts has been scraped')</span></pre><p id="59a2" class="pw-post-body-paragraph jo jp hi jq b jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh lh kj kk kl hb bi translated">最后两条打印语句将帮助我们直观地看到每个子记录的终止以及到那时为止丢弃的数据总数。</p><h2 id="9291" class="kw ir hi bd is ll lm ln iw lo lp lq ja jz lr ls je kd lt lu ji kh lv lw jm lx bi translated">将数据集存储在CSV文件中</h2><p id="dc2d" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">为了存储所有抓取的数据，我们将使用pandas库，首先将数据列表转换为pandas dataframe，然后转换为CSV文件。每个列表将被视为数据集中的一列，数据集中的每一行都将描述一个独特的Reddit帖子。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="7fed" class="kw ir hi ks b fi kx ky l kz la">df = pd.DataFrame({'ID':id_list, <br/>                   'Author':author_list, <br/>                   'Title':title_list,<br/>                   'Count_of_Comments':num_comments_list,<br/>                   'Upvote_Count':score_list,<br/>                   'Upvote_Ratio':upvote_ratio_list,<br/>                   'Flair':link_flair_text_list<br/>                  })<br/>df.to_csv('reddit_dataset.csv', index = False)</span></pre><h1 id="06c1" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">结论</h1><p id="1f83" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">这是完整的Python脚本。你也可以从这个<a class="ae km" href="https://github.com/senpinaki222/PRAW-blog" rel="noopener ugc nofollow" target="_blank"> Github repo </a>中克隆脚本和CSV文件。</p><figure class="kn ko kp kq fd ij"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="e61b" class="pw-post-body-paragraph jo jp hi jq b jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh lh kj kk kl hb bi translated">这里有一个<a class="ae km" href="https://www.kaggle.com/senpinaki222/reddit-post-dataset" rel="noopener ugc nofollow" target="_blank"> Reddit数据集</a>上传到Kaggle上，你可以用于你的机器学习项目。如果你觉得有帮助，就给它投个赞成票。</p><p id="40d0" class="pw-post-body-paragraph jo jp hi jq b jr ld jt ju jv le jx jy jz lf kb kc kd lg kf kg kh lh kj kk kl hb bi translated">非常感谢你的阅读。如果有任何更正/建议，请告诉我。请吧👏如果你喜欢邮报。提前感谢…</p></div></div>    
</body>
</html>