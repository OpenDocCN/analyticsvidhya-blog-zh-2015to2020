<html>
<head>
<title>Visualizing Your Data from MongoDB to Word Cloud with Python 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python 3将数据从MongoDB可视化到Word Cloud</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/visualizing-your-data-from-mongodb-to-word-cloud-with-python-3-3e9c4b4f2743?source=collection_archive---------10-----------------------#2020-08-07">https://medium.com/analytics-vidhya/visualizing-your-data-from-mongodb-to-word-cloud-with-python-3-3e9c4b4f2743?source=collection_archive---------10-----------------------#2020-08-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><ul class=""><li id="6a2e" class="if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw bi translated"><a class="ae ix" href="#0d55" rel="noopener ugc nofollow">技术堆栈</a></li><li id="60d3" class="if ig hi ih b ii iy ik iz im ja io jb iq jc is it iu iv iw bi translated"><a class="ae ix" href="#e758" rel="noopener ugc nofollow">连接到MongoDB </a></li><li id="c6cb" class="if ig hi ih b ii iy ik iz im ja io jb iq jc is it iu iv iw bi translated"><a class="ae ix" href="#177b" rel="noopener ugc nofollow">分词</a></li><li id="c3b0" class="if ig hi ih b ii iy ik iz im ja io jb iq jc is it iu iv iw bi translated"><a class="ae ix" href="#80da" rel="noopener ugc nofollow">生成文字云图片</a></li><li id="927d" class="if ig hi ih b ii iy ik iz im ja io jb iq jc is it iu iv iw bi translated"><a class="ae ix" href="#f290" rel="noopener ugc nofollow">翻译成另一种语言</a></li></ul><p id="91df" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">词云现在已经变得越来越流行，因为它是一种直接而有效的数据交流方式。主要优点是它有助于简化理解复杂图表的过程，这些复杂图表通常需要一些先决知识来帮助消化。</p><p id="6cd9" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">一个规则代表了单词云的简单性——文本大小，即文本越大越重要。这个显而易见的特性保证了来自各种背景的人能够容易地理解内容。</p><p id="f1cb" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">在本文中，我们介绍了一个将从幼儿日常活动中收集的数据转换为word cloud的示例。word cloud的设计有助于将幼儿的活动可视化，使家长和看护者可以轻松看到，然后利用这种方式来培养他们教育孩子的方式。</p><p id="3d5a" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">在深入研究技术细节之前，让我们先看看结果。</p><div class="js jt ju jv fd ab cb"><figure class="jw jx jy jz ka kb kc paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><img src="../Images/de376269f1ae1e08cea820b86ce352a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*ScME2rZkDsDLzFa-4IyLbQ.png"/></div></figure><figure class="jw jx jy jz ka kb kc paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><img src="../Images/0027823f705fc3d3a0cfe24bc94ce38b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*weFAMEASePthflRjfcSJ0w.png"/></div></figure></div><p id="dbad" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">上面的单词云是基于老师在一段固定时间内对一个孩子的评论。左边的云是评论中使用的原始语言，右边的词云是其中文翻译。比其他字体大的单词突出了孩子的注意力和与他人交流的情感。</p></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><h1 id="0d55" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">技术栈</h1><p id="b25e" class="pw-post-body-paragraph jd je hi ih b ii lo jf jg ik lp jh ji im lq jk jl io lr jn jo iq ls jq jr is hb bi translated"><strong class="ih hj"> MongoDB </strong>:存储采集的数据<br/> <strong class="ih hj"> Python 3 </strong>:处理数据并生成文字云图片<br/> <strong class="ih hj">库</strong> : <a class="ae ix" href="https://spacy.io/" rel="noopener ugc nofollow" target="_blank"> spaCy </a>，<a class="ae ix" href="https://numpy.org/" rel="noopener ugc nofollow" target="_blank"> Numpy </a>，<a class="ae ix" href="https://amueller.github.io/word_cloud/" rel="noopener ugc nofollow" target="_blank"> wordcloud </a>，<a class="ae ix" href="https://pypi.org/project/googletrans/" rel="noopener ugc nofollow" target="_blank"> googletrans </a></p></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><h1 id="e758" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">正在连接到MongoDB</h1><p id="6742" class="pw-post-body-paragraph jd je hi ih b ii lo jf jg ik lp jh ji im lq jk jl io lr jn jo iq ls jq jr is hb bi translated">选择托管的MongoDB云服务MongoDB Atlas ，是因为M0沙盒是免费的，它节省了部署和维护本地数据库的时间。</p><p id="8968" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">连接细节可以放入环境变量中，并从Python中读取，如下所示。如果需要使用Docker和Kubernetes将应用程序作为服务部署到云中，那么使用环境变量是一种很好的做法。</p><pre class="js jt ju jv fd lt lu lv lw aw lx bi"><span id="84aa" class="ly kr hi lu b fi lz ma l mb mc">MONGO_USERNAME = os.getenv('MONGO_USERNAME')<br/>MONGO_PASSWORD = os.getenv('MONGO_PASSWORD')<br/>MONGO_URL = os.getenv('MONGO_URL')</span></pre><p id="ac71" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">然后需要初始化MongoDB客户端。所有与MongoDB相关的代码都可以放在一个单独的Python文件中，以便组织和将来重用。</p><figure class="js jt ju jv fd jx"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="6c3c" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">在本例中,<code class="du mf mg mh lu b">db</code>将从命令行初始化，因此这里为空。如下添加了一个用于读取集合的简单函数。</p><figure class="js jt ju jv fd jx"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="da9e" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">从主脚本中检索数据。</p><figure class="js jt ju jv fd jx"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="edb2" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated"><code class="du mf mg mh lu b">collection</code>是MongoDB集合名，<code class="du mf mg mh lu b">data_entry</code>是值的键名。这里有一个样本数据。这里用的<code class="du mf mg mh lu b">data_entry</code>就是下面的<code class="du mf mg mh lu b">detail</code>。</p><figure class="js jt ju jv fd jx"><div class="bz dy l di"><div class="md me l"/></div></figure></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><h1 id="177b" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">标记单词</h1><p id="9c24" class="pw-post-body-paragraph jd je hi ih b ii lo jf jg ik lp jh ji im lq jk jl io lr jn jo iq ls jq jr is hb bi translated">在上一节中，段落被加载到一个数组中。如果数据量很大，可以考虑流式传输。</p><p id="41b0" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">这些段落需要分解成单词。这听起来像是一个简单的工作，但是需要大量的努力来确保最终结果的准确性。处理自然语言对计算机来说是一个挑战，因为它们永远无法直接理解单词。</p><p id="1e9e" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">自然语言处理和机器学习是大课题。由于本文关注的是单词cloud，所以只考虑几个步骤来处理这些文本。</p><ol class=""><li id="788b" class="if ig hi ih b ii ij ik il im in io ip iq ir is mi iu iv iw bi translated">丢弃不需要的符号</li><li id="4f5f" class="if ig hi ih b ii iy ik iz im ja io jb iq jc is mi iu iv iw bi translated">删除组织和人员姓名</li><li id="ae07" class="if ig hi ih b ii iy ik iz im ja io jb iq jc is mi iu iv iw bi translated">规范化单词(词干)</li><li id="9e16" class="if ig hi ih b ii iy ik iz im ja io jb iq jc is mi iu iv iw bi translated">过滤停用词</li></ol><p id="d5a1" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">spaCy 是自然语言处理的强大工具。我们用它来标记名字和词干，这只是冰山一角。</p><p id="84cc" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">第一步是初始化空间并加载没有不需要的符号的数据。数据被加载到名为<code class="du mf mg mh lu b">content</code>的数组中，空间由<code class="du mf mg mh lu b">en_core_web_sm.load()</code>初始化</p><figure class="js jt ju jv fd jx"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="99c2" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">其次，我们使用spaCy来过滤组织和人名。它们被分类为<code class="du mf mg mh lu b">label_</code>等于<code class="du mf mg mh lu b">PERSON</code>和<code class="du mf mg mh lu b">ORG</code>。命名实体的完整列表可在<a class="ae ix" href="https://spacy.io/api/annotation#named-entities" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><figure class="js jt ju jv fd jx"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="54e8" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">然后，我们在一个循环中进行词干提取、标点符号删除和停用词删除。可以通过获取<code class="du mf mg mh lu b">lemma_</code>属性来提取令牌的基本形式。</p><figure class="js jt ju jv fd jx"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="135a" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">基于对数据的研究，我们决定也有一个定制的停用词列表。引入了一个名为<code class="du mf mg mh lu b">stop-words.txt</code>的文件供脚本动态加载。</p><figure class="js jt ju jv fd jx"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="fd82" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">这是一个标记化单词的例子。</p><pre class="js jt ju jv fd lt lu lv lw aw lx bi"><span id="4cdd" class="ly kr hi lu b fi lz ma l mb mc">['play', 'dough', 'disco', 'time', 'construction', 'activity', 'afternoon', 'engaged', 'stamp', 'pat', 'play', 'piano', 'play', 'dough', 'piece', 'spend', 'lot', 'morning', 'explore', 'painting', 'equipment', 'stamp', 'roll', 'create', 'different', 'print', 'friend', 'time', 'decorate', 'carefully', 'gingerbread', 'biscuit', 'colourful', 'flake', 'explore', 'conker', 'paint', 'roll', 'shake', 'box', 'show', 'able', 'independently', 'find', 'way', 'suit', 'conker', 'create', 'picture', 'watch', 'closely', 'see', 'different', 'mark', 'conker', 'make', 'move', 'keen', 'help', 'teacher', 'create', 'gloop', 'morning', 'spoon', 'mix', 'water', 'corn', 'flour']</span></pre><h1 id="80da" class="kq kr hi bd ks kt mj kv kw kx mk kz la lb ml ld le lf mm lh li lj mn ll lm ln bi translated">生成Wordcloud图像</h1><p id="e2b6" class="pw-post-body-paragraph jd je hi ih b ii lo jf jg ik lp jh ji im lq jk jl io lr jn jo iq ls jq jr is hb bi translated">随着数据的收集和处理，下一步是将其可视化为单词云图像。<a class="ae ix" href="https://numpy.org/" rel="noopener ugc nofollow" target="_blank"> Numpy </a>和<a class="ae ix" href="https://amueller.github.io/word_cloud/" rel="noopener ugc nofollow" target="_blank"> wordcloud </a>让这一步变得简单明了。</p><figure class="js jt ju jv fd jx"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="4e4e" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">与其他在线单词云网站类似，可以选择一个遮罩图像作为基础图像。然后，可以调整相当多的参数，如<code class="du mf mg mh lu b">font_path</code>和<code class="du mf mg mh lu b">background_color</code>，以生成符合您特定需求的图像。例子可以在官方的wordcloud库网站<a class="ae ix" href="https://amueller.github.io/word_cloud/auto_examples/index.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><h1 id="f290" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">翻译成另一种语言</h1><p id="ad04" class="pw-post-body-paragraph jd je hi ih b ii lo jf jg ik lp jh ji im lq jk jl io lr jn jo iq ls jq jr is hb bi translated">由于数据可能来自不同的来源，而单词cloud受众可能来自不同的国家，因此可能有必要将单词翻译成另一种语言以便更好地理解。</p><p id="6830" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated"><a class="ae ix" href="https://pypi.org/project/googletrans/" rel="noopener ugc nofollow" target="_blank"> googletrans </a>是一个非官方的Python库，实现了Google Translate。我们在代码中初始化这个库，并且一次发送一组单词给Google Translate。</p><figure class="js jt ju jv fd jx"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="77eb" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">做翻译似乎很简单，但是需要注意一些问题。</p><ol class=""><li id="ab07" class="if ig hi ih b ii ij ik il im in io ip iq ir is mi iu iv iw bi translated">该库不是来自谷歌，所以稳定性没有保证。</li><li id="54e6" class="if ig hi ih b ii iy ik iz im ja io jb iq jc is mi iu iv iw bi translated">单次提交的最大文本大小为15k</li><li id="232f" class="if ig hi ih b ii iy ik iz im ja io jb iq jc is mi iu iv iw bi translated">单词在不同的上下文中可能有不同的翻译</li><li id="0806" class="if ig hi ih b ii iy ik iz im ja io jb iq jc is mi iu iv iw bi translated">有些翻译需要更正</li></ol><p id="fe53" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">如果稳定性是一个问题，建议使用官方的谷歌翻译API。</p><p id="0fdc" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">根据我们的令牌化数据，可以通过对多次提交的数组进行分段来简单地限制大小。</p><p id="2b5e" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">最困难的问题是上面的第三点。如果单词的翻译需要基于上下文，其他复杂的处理也需要到位。</p><p id="dea5" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">在本文中，我们采用一种简单的方法来翻译没有上下文的单词。由于远程Google Translate API调用的时间开销很大，我们无法一次提交一个单词。最简单和最直接的解决方案是找到一个好的分隔符，并将其添加到单词列表中，使翻译与上下文无关。在下面的代码片段中，令牌以500个为一组提交，以<code class="du mf mg mh lu b">&gt;</code>作为分隔符。</p><figure class="js jt ju jv fd jx"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="30bf" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">最后一步是检查你的翻译，并纠正那些与整体上下文无关的意思，否则翻译就是不够好。新的翻译映射文件<code class="du mf mg mh lu b">translation-map-zh-cn.csv</code>用于如下校正。左侧的文字将由右侧的文字替换。</p><pre class="js jt ju jv fd lt lu lv lw aw lx bi"><span id="4952" class="ly kr hi lu b fi lz ma l mb mc">股票,分享<br/>铅,带头<br/>匙,勺子</span></pre><p id="c831" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">读取文件并进行更正的代码如下。</p><figure class="js jt ju jv fd jx"><div class="bz dy l di"><div class="md me l"/></div></figure></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><p id="3eb6" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">总之，本文涵盖了4个主题。连接到远程MongoDB，标记单词，生成单词云图像，最后将单词翻译成其他语言。目标是用最有意义的单词生成单词云。根据收集的数据和单词云的目的，对原始数据的深入研究对于制定自己的单词标记化计划至关重要。</p><p id="7308" class="pw-post-body-paragraph jd je hi ih b ii ij jf jg ik il jh ji im jj jk jl io jm jn jo iq jp jq jr is hb bi translated">这里是这个展示项目的GitLab链接。如何为自己的数据生成文字云，请看<a class="ae ix" href="https://gitlab.com/conanzxn/mongodb-wordcloud/-/blob/master/README.md" rel="noopener ugc nofollow" target="_blank">自述</a>。欢迎公关！</p></div></div>    
</body>
</html>