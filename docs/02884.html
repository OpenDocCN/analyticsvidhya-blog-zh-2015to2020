<html>
<head>
<title>Troubleshooting While Turning a Pycharm Project into an AWS Lambda Function (Windows)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Pycharm项目转换为AWS Lambda函数时的故障排除(Windows)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/troubleshooting-while-turning-a-pycharm-project-into-an-aws-lambda-function-windows-cec052e6b01c?source=collection_archive---------9-----------------------#2020-01-06">https://medium.com/analytics-vidhya/troubleshooting-while-turning-a-pycharm-project-into-an-aws-lambda-function-windows-cec052e6b01c?source=collection_archive---------9-----------------------#2020-01-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a642dfefe1c08a4e0b750a5f66424872.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s14Lvsc9McQIpcGs"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">萨法尔·萨法罗夫在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="ac34" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我最初的项目是一个使用Pytrends和Tweepy的API的机器人，每当我运行Python脚本时，它就会发出一个笑话。我想把它变成一个Lambda函数，这样它就可以每天自动运行。本指南展示了我遇到的一些错误及其解决方案。如果您有需要查找的特定错误，请查看目录，或者如果您试图将Python项目移植到Lambda中，请通读全文。</p><p id="5bc9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">作为一名学生，我远非专家，但这篇文章的目的是提出一些我希望在从事我的项目时能找到的答案。我对任何在错误中挣扎的人的最大建议是访问AWS Discord(【https://discord.gg/ZNGyXk】<a class="ae iu" href="https://discord.gg/ZNGyXk" rel="noopener ugc nofollow" target="_blank"/>)。记住要有礼貌，对你的问题要有耐心。作为免责声明，我不知道我做的任何事情是否是最佳实践，但我成功地修复了我自己的问题。</p><h2 id="7d63" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">目录:</h2><p id="b052" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">出于某种原因，我需要点击链接两次来导航到该部分。</p><p id="9320" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="#71fd" rel="noopener ugc nofollow">无服务器vs Jetbrains插件:如果你不知道自己在做什么，请阅读这一部分</a></p><p id="890e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="#3d17" rel="noopener ugc nofollow"> Requirements.txt问题</a></p><p id="b6f7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="#11b8" rel="noopener ugc nofollow">配置文件出，环境变量入</a></p><p id="8b86" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="#c875" rel="noopener ugc nofollow">读写s3桶txt文件</a></p><p id="1797" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="#4aa8" rel="noopener ugc nofollow">调用GetObject操作时AccessDenied】</a></p><p id="8879" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="#50e8" rel="noopener ugc nofollow">无法读取未定义</a>的属性“工件”</p><h1 id="71fd" class="kt ju hi bd jv ku kv kw jz kx ky kz kd la lb lc kg ld le lf kj lg lh li km lj bi translated">无服务器vs Jetbrains插件:如果你不知道自己在做什么，请阅读这一部分</h1><p id="35c5" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">第一个问题是弄清楚使用哪种技术。我尝试使用Pycharm AWS插件，但是我努力想出如何避免ImportModuleError。错误看起来像这样，运行Lambda函数时的响应，pytrends被替换为您正在使用的任何未包含的库。</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="e7ef" class="jt ju hi lp b fi lt lu l lv lw">{ <br/>“errorMessage”: “Unable to import module ‘app’: No module named ‘pytrends’”, <br/>“errorType”: “Runtime.ImportModuleError” <br/>}</span></pre><p id="fbb6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">问题是在Lambda中运行的Python环境没有您已经安装的要求。为了解决这个问题，我切换到了<a class="ae iu" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>，它有<a class="ae iu" href="https://serverless.com/plugins/serverless-python-requirements/" rel="noopener ugc nofollow" target="_blank">无服务器Python需求插件</a>来为你处理需求。<a class="ae iu" href="https://read.iopipe.com/the-right-way-to-do-serverless-in-python-e99535574454" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">这本优秀的中级指南</strong> </a> <strong class="ix hj"> </strong>讲解了如何使用Python演示无服务器需求插件。老实说，该指南帮助我走了很远，因为它使用python模板奠定了基础。</p><p id="e290" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从该指南中获得的关键是创建新的。py文件，将其添加到serverless.yml文件中并进行部署。部署后，Lambda函数出现在AWS Lambda控制台上(如果看不到它，请检查不同的服务器，例如俄勒冈州和弗吉尼亚州)。</p><p id="f5a5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从那里，我有一些错误，这是这篇文章的主要贡献。</p><h1 id="3d17" class="kt ju hi bd jv ku kv kw jz kx ky kz kd la lb lc kg ld le lf kj lg lh li km lj bi translated">Requirements.txt问题</h1><p id="4a16" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">首先，前面提到的指南使用</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="6991" class="jt ju hi lp b fi lt lu l lv lw">echo “requests” &gt;&gt; requirements.txt</span></pre><p id="4936" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">向需求文本文件添加请求，但是实际上添加了“请求”而不是请求(没有引号)。为了让您的功能正常工作，您的需求应该如下所示:</p><figure class="lk ll lm ln fd ij er es paragraph-image"><div class="er es lx"><img src="../Images/f278421255dee470e0fbae16f5dac3e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:296/format:webp/1*NPX-DfWng3lJ3XDygdGCUg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">我的项目requirements.txt</figcaption></figure><p id="3210" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">不需要放boto3，os，json，因为默认情况下Lambda的Python版本中包含了它们。如果您不知道默认情况下已经包含了哪些库，您可以像我一样，将import语句中的所有库复制到requirements.txt中，然后逐个处理错误。sls deploy回复中的json错误如下所示:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="8fe5" class="jt ju hi lp b fi lt lu l lv lw">STDERR: ERROR: Could not find a version that satisfies the requirement json (from -r /var/task/requirements.txt (line 1)) (from versions: none)<br/> ERROR: No matching distribution found for json (from -r /var/task/requirements.txt (line 1))</span></pre><p id="fe0e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您看到这个，这意味着您需要从requirements.txt中删除这一行，在这种情况下，需要删除的是json。</p><h1 id="11b8" class="kt ju hi bd jv ku kv kw jz kx ky kz kd la lb lc kg ld le lf kj lg lh li km lj bi translated">配置文件输出，环境变量输入</h1><p id="d20c" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">接下来，我最初有一个config.json文件来存储我的Twitter API键。由于Lambda无法访问该文件，我的选择是将文件上传到数据库，每次都检索并解析它，或者在Lambda中设置环境变量，这要容易得多。</p><p id="c8c9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是使用配置文件的“之前”代码:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="a0e9" class="jt ju hi lp b fi lt lu l lv lw"># Open config file<br/>with open(‘config.json’) as config_file:<br/> config = json.load(config_file)</span><span id="ac73" class="jt ju hi lp b fi ly lu l lv lw"># Tweepy authentication<br/>auth = tweepy.OAuthHandler(config[‘keys’][‘api_key’], config[‘keys’][‘api_key_secret’])<br/>auth.set_access_token(config[‘keys’][‘consumer_key’], config[‘keys’][‘consumer_key_secret’])<br/>api = tweepy.API(auth)</span></pre><p id="75ae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我需要做的是添加环境变量，方法是转到Lambda控制台→函数→单击您的函数→向下滚动到环境变量，并输入您的键值对，如下所示:(keys redacted)</p><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/d8debdf9156e85ac20d11b561572ea3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j1L8KpnP28vrwXVoMwzyXg.png"/></div></div></figure><p id="7aa1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，“之后”代码看起来像这样:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="ca90" class="jt ju hi lp b fi lt lu l lv lw"># Tweepy authentication using AWS environmental values<br/>auth = tweepy.OAuthHandler(os.environ['api_key'], os.environ['api_key_secret'])<br/>auth.set_access_token(os.environ['consumer_key'], os.environ['consumer_key_secret'])<br/>api = tweepy.API(auth)</span></pre><p id="6dbc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">记得在你的顶部导入操作系统。努力让它发挥作用。</p><h1 id="c875" class="kt ju hi bd jv ku kv kw jz kx ky kz kd la lb lc kg ld le lf kj lg lh li km lj bi translated">从s3 bucket txt文件中读取和写入</h1><p id="a0c9" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">下一个大问题是我的机器人最初是从。txt文件作为推特的潜在候选文件。这和config.json有同样的问题，但是这一次，我也写入文件来跟踪我已经在tweets中使用了哪些单词。这需要一个数据库，不和谐中的人推荐s3，因为它是免费的，我不需要任何简单文本文件的重型数据流。我创建了一个bucket并上传了文本文件。</p><p id="dc96" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要使用s3，您需要在您的顶部导入boto3。py文件。同样，这是之前和之后:</p><p id="7e8d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">之前，从与。py文件:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="c25e" class="jt ju hi lp b fi lt lu l lv lw">lines = open("samples.txt").read().splitlines()<br/>chosenSamplesString = random.choice(lines)</span></pre><p id="e611" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">之后，使用名为playbarnesbot的s3存储桶:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="cd3b" class="jt ju hi lp b fi lt lu l lv lw">s3 = boto3.resource('s3')<br/>samples = s3.Object('playbarnesbot', 'samples.txt')<br/>body = samples.get()['Body'].read().splitlines()<br/>chosenSamplesString = random.choice(body)<br/>tempString = chosenSamplesString.decode('ascii') #ascii or utf-8</span></pre><p id="af59" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意，我必须解码该字符串，因为当我们从s3存储桶中取出它时，它是二进制数据。中看到的示例词。txt文件将作为b'sampleWord '检索，无需解码。</p><p id="ab73" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是另一个示例，该方法检查playbarnesbot存储桶中名为search.txt的文件中是否包含字符串:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="db1b" class="jt ju hi lp b fi lt lu l lv lw">def checkHistory(string):<br/>    s3 = boto3.resource('s3')<br/>    obj = s3.Object('playbarnesbot', 'search.txt')<br/><br/>    if string in str(obj.get()['Body'].read()):<br/>        print(string + ' has been used already')<br/>        return True<br/>    else:<br/>        print(string + ' hasn\'t been used before')<br/>        return False</span></pre><p id="21f8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这向另一个方向提出了挑战:如果它不在search.txt文件中，我如何将它添加到文件中？我了解到物体(如。txt文件)在s3桶中是不可变的，这意味着它们不能被更改。这意味着我不能像以前那样只是追加到samples.txt文件中。相反，我必须将文件下载到分配给每个Lambda函数的/tmp/ storage中，像平常一样编辑文件，然后再次上传到s3 bucket中。</p><p id="c828" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">之前，只需将。本地txt文件:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="ae8a" class="jt ju hi lp b fi lt lu l lv lw">def addHistory(string):<br/>    with open('search.txt', "a", encoding="utf-8") as file:<br/>        file.write(string)<br/>        file.write("\n")</span></pre><p id="f8e6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">之后，将文件下载到/tmp/目录，并在编辑后重新加载:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="eced" class="jt ju hi lp b fi lt lu l lv lw">def addHistory(string):<br/>    s3_client = boto3.client('s3')<br/>    s3_client.download_file('playbarnesbot','search.txt','/tmp/search.txt')<br/>    with open('/tmp/search.txt', "w", encoding="utf-8") as file:<br/>        file.write(string)<br/>        file.write("\n")<br/>    s3_client.upload_file('/tmp/search.txt','playbarnesbot','search.txt')</span></pre><p id="1110" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有人建议我使用<a class="ae iu" href="https://docs.python.org/3/library/tempfile.html" rel="noopener ugc nofollow" target="_blank"> tempfile </a>而不是/tmp/</p><h1 id="4aa8" class="kt ju hi bd jv ku kv kw jz kx ky kz kd la lb lc kg ld le lf kj lg lh li km lj bi translated">调用GetObject操作时AccessDenied</h1><p id="2dcb" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">前一节中用于检索对象的代码应该可以工作，但是没有，而是给了我以下错误:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="9ee8" class="jt ju hi lp b fi lt lu l lv lw">{<br/> “errorMessage”: “An error occurred (AccessDenied) when calling the GetObject operation: Access Denied”,<br/> “errorType”: “ClientError”,<br/> “stackTrace”: [<br/> “ File \”/var/task/playBarnes.py\”, line 89, in lambda_handler\n body = samples.get()[‘Body’].read().splitlines()\n”,<br/> “ File \”/var/runtime/boto3/resources/factory.py\”, line 520, in do_action\n response = action(self, *args, **kwargs)\n”,<br/> “ File \”/var/runtime/boto3/resources/action.py\”, line 83, in __call__\n response = getattr(parent.meta.client, operation_name)(**params)\n”,<br/> “ File \”/var/runtime/botocore/client.py\”, line 272, in _api_call\n return self._make_api_call(operation_name, kwargs)\n”,<br/> “ File \”/var/runtime/botocore/client.py\”, line 576, in _make_api_call\n raise error_class(parsed_response, operation_name)\n”<br/> ]<br/>}</span></pre><p id="68d5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此错误是由无服务器帐户无权访问存储桶的数据引起的，我不能100%确定是什么修复了此错误，但我执行了以下操作，问题得到了解决:</p><ol class=""><li id="9218" class="ma mb hi ix b iy iz jc jd jg mc jk md jo me js mf mg mh mi bi translated">我进入s3控制台，使我的bucket不阻止公共访问(单击bucket→Permissions→edit block public access)。我不确定这一步是否有必要。</li><li id="1d1f" class="ma mb hi ix b iy mj jc mk jg ml jk mm jo mn js mf mg mh mi bi translated">我写了一个桶策略来允许访问(桶→权限→桶策略)</li></ol><p id="b7b1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">策略看起来像这样，但是您可能想使用策略生成器来创建自己的策略。</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="e8fe" class="jt ju hi lp b fi lt lu l lv lw"><br/>{<br/> “Version”: “2012–10–17”,<br/> “Id”: “Policy1578283143575”,<br/> “Statement”: [<br/> {<br/> “Sid”: “Stmt1578283132694”,<br/> “Effect”: “Allow”,<br/> “Principal”: {<br/> “AWS”: “arnofyourserverlessuser”<br/> },<br/> “Action”: “s3:*”,<br/> “Resource”: “arn:aws:s3:::playbarnesbot/*”<br/> }<br/> ]<br/>}</span></pre><p id="4455" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以在IAM控制台的“用户→无服务器→用户arn”下找到无服务器用户的arn。用你的桶替换playbarnesbot。这一步可能是必要的。</p><p id="3b5f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.在IAM控制台中，我为无服务器用户编写了一个内联策略，授予它访问bucket的权限。</p><p id="3a6c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该策略如下所示:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="9e08" class="jt ju hi lp b fi lt lu l lv lw">{<br/> “Version”: “2012–10–17”,<br/> “Statement”: [<br/> {<br/> “Effect”: “Allow”,<br/> “Action”: [<br/> “s3:ListBucket”<br/> ],<br/> “Resource”: [<br/> “arn:aws:s3:::playbarnesbot”<br/> ]<br/> },<br/> {<br/> “Effect”: “Allow”,<br/> “Action”: [<br/> “s3:PutObject”,<br/> “s3:GetObject”,<br/> “s3:DeleteObject”<br/> ],<br/> “Resource”: [<br/> “arn:aws:s3:::playbarnesbot/*”<br/> ]<br/> }<br/> ]<br/>}</span></pre><p id="c341" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这一步似乎也很重要，但下一步是解决问题的步骤。</p><p id="6bcc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">4.在lambda设置中，在执行角色下，我点击了“查看我的-无服务器-项目…角色”</p><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/710913e08f1f7412dd02cecddad60ac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8yhFOFFLAVljnAaqo7DbmA.png"/></div></div></figure><p id="6a27" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后将AdministratorAccess策略附加到该角色。请注意，无服务器用户已经拥有AdministratorAccess策略，但这是角色。</p><p id="6623" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这解决了我的问题，但是如果你仍然有问题，你可以试试亚马逊的故障诊断指南。</p><h1 id="50e8" class="kt ju hi bd jv ku kv kw jz kx ky kz kd la lb lc kg ld le lf kj lg lh li km lj bi translated">无法读取未定义的属性“artifact”</h1><p id="c1f0" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">我遇到的最后一点麻烦是运行sls deploy和sls invoke -f playBarnes(测试Lambda函数的标准过程),没有遇到Python/Lambda错误，但却得到了以下错误:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="20e5" class="jt ju hi lp b fi lt lu l lv lw">TypeError: Cannot read property ‘artifact’ of undefined<br/> at ServerlessPythonRequirements.BbPromise.bind.then.then.then (C:\Users\Kevin\myService2\node_modules\serverless-python-requirements\index.js:176:48)<br/> at ServerlessPythonRequirements.tryCatcher (C:\Users\Kevin\myService2\node_modules\bluebird\js\release\util.js:16:23)<br/> at Promise._settlePromiseFromHandler (C:\Users\Kevin\myService2\node_modules\bluebird\js\release\promise.js:547:31)<br/> at Promise._settlePromise (C:\Users\Kevin\myService2\node_modules\bluebird\js\release\promise.js:604:18)<br/> at Promise._settlePromise0 (C:\Users\Kevin\myService2\node_modules\bluebird\js\release\promise.js:649:10)<br/> at Promise._settlePromises (C:\Users\Kevin\myService2\node_modules\bluebird\js\release\promise.js:729:18)<br/> at _drainQueueStep (C:\Users\Kevin\myService2\node_modules\bluebird\js\release\async.js:93:12)<br/> at _drainQueue (C:\Users\Kevin\myService2\node_modules\bluebird\js\release\async.js:86:9)<br/> at Async._drainQueues (C:\Users\Kevin\myService2\node_modules\bluebird\js\release\async.js:102:5)<br/> at Immediate.Async.drainQueues [as _onImmediate] (C:\Users\Kevin\myService2\node_modules\bluebird\js\release\async.js:15:14)<br/> at runCallback (timers.js:705:18)<br/> at tryOnImmediate (timers.js:676:5)<br/> at processImmediate (timers.js:658:5)<br/> at process.topLevelDomainCallback (domain.js:120:23)</span></pre><p id="2d7f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这显然是由Python需求插件引起的，这里讨论<a class="ae iu" href="https://github.com/UnitedIncome/serverless-python-requirements/issues/414" rel="noopener ugc nofollow" target="_blank">的</a>。在我阅读github问题时，似乎还没有解决方案(除了恢复版本之外),但是我最终通过使用</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="b01d" class="jt ju hi lp b fi lt lu l lv lw">sls deploy --stage dev</span><span id="5732" class="jt ju hi lp b fi ly lu l lv lw">sls invoke -f playBarnes</span></pre><p id="7267" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">而不是标准部署。我不知道这为什么有效，但它确实有效，而且后续的常规部署也允许常规调用。</p><p id="499a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我希望至少有一个人发现了他们遇到的错误，并使用这篇文章修复了它。</p></div></div>    
</body>
</html>