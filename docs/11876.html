<html>
<head>
<title>Serverless Framework — Package Your Lambda Functions Easily</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器框架——轻松打包您的Lambda函数</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/serverless-framework-package-your-lambda-functions-easily-6c4f0351cdab?source=collection_archive---------7-----------------------#2020-12-22">https://medium.com/analytics-vidhya/serverless-framework-package-your-lambda-functions-easily-6c4f0351cdab?source=collection_archive---------7-----------------------#2020-12-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7098" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，一天无服务器是云计算世界中快速发展的技术。大多数公司正在从传统架构转向集装箱架构或无服务器架构。</p><p id="d1f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">AWS是最流行和最强大的云之一。它有许多服务，并对无服务器技术有很大的支持。</p><p id="a6b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">AWS Lambda是运行无服务器工作负载的强大服务之一，结合了API Gateway、DynamoDB、S3等其他服务..</p><p id="30cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在软件开发中，我们都有使用一些外部依赖项的要求，当涉及到在AWS Lambda中使用外部包部署代码时，您创建一个代码的zip文件，并将其上传到S3 bucket，然后配置您的Lambda函数以指向该位置，但如果我说您不必做所有这些，而是专注于创建您的代码，一个框架会负责将您的代码打包并部署到AWS Lambda，那会怎么样？听起来很有趣？如果是，那么继续阅读这篇博客。</p><h1 id="ca8e" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">无服务器框架的先决条件</h1><ul class=""><li id="526f" class="kb kc hi ih b ii kd im ke iq kf iu kg iy kh jc ki kj kk kl bi translated">IAM用户的访问密钥和秘密访问密钥。</li><li id="7f95" class="kb kc hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">Docker已安装并在系统中运行</li><li id="2bdf" class="kb kc hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">AWS CLI</li><li id="3003" class="kb kc hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">结节</li></ul><h1 id="01e6" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">让我们开始吧。</h1><ul class=""><li id="a461" class="kb kc hi ih b ii kd im ke iq kf iu kg iy kh jc ki kj kk kl bi translated">正在安装无服务器框架。</li></ul><p id="63f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kr">注意:如果你的机器上还没有</em> <a class="ae ks" href="https://nodejs.org/en/download/package-manager/" rel="noopener ugc nofollow" target="_blank"> <em class="kr">节点</em> </a> <em class="kr">，你需要先安装它。我建议使用NodeJS的最新LTS版本。</em></p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="cfc2" class="lc je hi ky b fi ld le l lf lg">npm install -g serverless</span></pre><h1 id="485d" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">在本地创建您的服务</h1><p id="d85b" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">一个<code class="du lk ll lm ky b">service</code>就像一个项目。在这里定义AWS Lambda函数、触发它们的<code class="du lk ll lm ky b">events</code>以及它们需要的任何AWS基础设施<code class="du lk ll lm ky b">resources</code>，所有这些都在一个名为<code class="du lk ll lm ky b">serverless.yml</code>的文件中。</p><p id="fac3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以从模板创建服务。我准备用Python 3。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="e354" class="lc je hi ky b fi ld le l lf lg">serverless create \<br/> --template aws-python3 \<br/> --name harsh-test \<br/> --path harsh-test<!-- --> </span></pre><p id="dc76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lk ll lm ky b">serverless create</code>命令将创建一个服务。<code class="du lk ll lm ky b">--template aws-python3</code>将使用python3初始化我们的服务<code class="du lk ll lm ky b">--name harsh-test</code>将被用作服务名，而<code class="du lk ll lm ky b">--path harsh-test</code>将创建一个名为harsh-test的目录来存储我们的代码和来自无服务器框架的一些其他文件。</p><blockquote class="ln lo lp"><p id="f755" class="if ig kr ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated">无服务器框架带有一些预定义的模板。您可以阅读更多关于其他可用模板的信息—<a class="ae ks" href="https://www.serverless.com/framework/docs/providers/aws/guide/services/" rel="noopener ugc nofollow" target="_blank">https://www . server less . com/framework/docs/providers/AWS/guide/services/</a></p></blockquote><figure class="kt ku kv kw fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es lt"><img src="../Images/156f584012f93dfbe8b9af953d83e240.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HhTSzlrIEDFTID95fQ45qA.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx translated">使用aws-python3模板创建无服务器</figcaption></figure><p id="3b80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将在我们的目录中创建两个文件，即<code class="du lk ll lm ky b">handler.py</code>和<code class="du lk ll lm ky b">serverless.yml</code>文件。</p><figure class="kt ku kv kw fd lu er es paragraph-image"><div class="er es mf"><img src="../Images/3c280be791054db049f0c28baf0e2794.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*3IkofS-fvHHIv8e4eV978w.png"/></div></figure><h1 id="08b1" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">创建虚拟环境</h1><p id="4ba1" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">我们将在无服务器框架创建的目录中创建一个虚拟环境。你可以阅读<a class="ae ks" href="https://python-guide-pt-br.readthedocs.io/pt_BR/latest/dev/virtualenvs.html" rel="noopener ugc nofollow" target="_blank">这里</a>关于如何和为什么使用Python虚拟环境。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="9e08" class="lc je hi ky b fi ld le l lf lg">virtualenv venv --python=python3</span></pre><p id="2395" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您没有安装virtualenv，您可以使用<code class="du lk ll lm ky b">pip3 install virtualenv</code>来安装</p><figure class="kt ku kv kw fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mg"><img src="../Images/0e9d096d364f65fcef4f5d6380c5a9a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NmSWujhFAcjb2eZRtNdpcw.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx translated">virtuaenv usig python3</figcaption></figure><p id="7eae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用以下命令激活虚拟环境:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="1701" class="lc je hi ky b fi ld le l lf lg">source venv/bin/activate</span></pre><p id="d7ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们设置想要部署的功能。在您最喜欢的文本编辑器中打开<code class="du lk ll lm ky b">handler.py</code>,添加以下几行:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="ed04" class="lc je hi ky b fi ld le l lf lg"># handler.py</span><span id="99df" class="lc je hi ky b fi mh le l lf lg">import numpy as np</span><span id="c384" class="lc je hi ky b fi mh le l lf lg">def main(event, context):<br/>  a = np.arange(15).reshape(3, 5)<br/>  print("Your numpy array:")<br/>  print(a)</span><span id="4643" class="lc je hi ky b fi mh le l lf lg">if __name__ == "__main__":<br/>  main('', '')</span></pre><p id="3870" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个简单的函数，使用了<a class="ae ks" href="https://numpy.org/doc/stable/user/quickstart.html" rel="noopener ugc nofollow" target="_blank">数字快速入门</a>中的一个例子。当使用AWS Lambda函数时，您需要定义一个接受两个参数的函数:<code class="du lk ll lm ky b">event</code>和<code class="du lk ll lm ky b">context</code>。你可以在AWS上阅读更多关于Python 的<a class="ae ks" href="http://docs.aws.amazon.com/lambda/latest/dg/python-programming-model-handler-types.html" rel="noopener ugc nofollow" target="_blank"> Lambda函数处理程序。</a></p><p id="d5d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们运行<code class="du lk ll lm ky b">python handler.py</code>，它将运行我们的<code class="du lk ll lm ky b">main()</code>功能。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="a59c" class="lc je hi ky b fi ld le l lf lg">python handler.py</span></pre><figure class="kt ku kv kw fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mi"><img src="../Images/2cc728a4e5c42af58acc1506352c8707.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vjWIfalswz8F7Qms_4AADA.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx translated">编辑和运行handler.py文件</figcaption></figure><p id="ee1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">啊，我们还没有在我们的虚拟环境中安装<code class="du lk ll lm ky b">numpy</code>。让我们在虚拟环境中安装<code class="du lk ll lm ky b">numpy</code>。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="dd71" class="lc je hi ky b fi ld le l lf lg">pip install numpy</span></pre><figure class="kt ku kv kw fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mj"><img src="../Images/3325a76a9dbdb22352c10b49fa00d2d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*On3iCSCyunX74-JcC0vu6Q.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx translated">在virtualenv中安装Numpy</figcaption></figure><p id="7a28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用的是<code class="du lk ll lm ky b">pip install numpy</code>，但是你也可以在创建virtualenv时编写<code class="du lk ll lm ky b">pip3 insatll numpy</code>，我们已经提到过我们想要使用<code class="du lk ll lm ky b">python3</code>创建virtualenv，所以在我们的virtualenv <code class="du lk ll lm ky b">pip</code>中将使用<code class="du lk ll lm ky b">python3</code>来安装包。</p><p id="8a57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们创建<code class="du lk ll lm ky b">requirements.txt</code>文件。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="1fe1" class="lc je hi ky b fi ld le l lf lg">pip freeze &gt; requirements.txt</span></pre><figure class="kt ku kv kw fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mk"><img src="../Images/2c4614bce783f07133ddb5eee9372f2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RKdTFgiUG6vEGo4zFAVJ1A.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx translated">生成requirements.txt文件</figcaption></figure><p id="2582" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们运行代码。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="09be" class="lc je hi ky b fi ld le l lf lg">python handler.py</span></pre><figure class="kt ku kv kw fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es ml"><img src="../Images/6d88b20f836ab41773ee25d302889cf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rQ49TF1UED4s1XIR0ryxhA.png"/></div></div></figure><p id="fb95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">恭喜你！！👏我们已经成功地在本地运行了python代码。</p><h1 id="0dae" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">部署我们的无服务器服务</h1><p id="48c7" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">我们的功能正在本地工作，并且已经准备好部署到Lambda。在您最喜欢的文本编辑器中打开<code class="du lk ll lm ky b">serverless.yml</code>文件，并写下以下几行:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="38e5" class="lc je hi ky b fi ld le l lf lg"># serverless.yml</span><span id="9f4c" class="lc je hi ky b fi mh le l lf lg">---<br/>service: harsh-test</span><span id="246e" class="lc je hi ky b fi mh le l lf lg">frameworkVersion: '2'</span><span id="40e4" class="lc je hi ky b fi mh le l lf lg">provider:<br/>  name: aws<br/>  runtime: python3.8</span><span id="1287" class="lc je hi ky b fi mh le l lf lg">functions:<br/>  hello:<br/>    handler: handler.main</span></pre><p id="807d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个叫做<code class="du lk ll lm ky b">harsh-test</code>的基础服务。它将向AWS部署一个名为<code class="du lk ll lm ky b">hello</code>的Python 3.8函数，而<code class="du lk ll lm ky b">hello</code>函数的入口点是<code class="du lk ll lm ky b">handler.py</code>模块中的<code class="du lk ll lm ky b">main</code>函数。</p><figure class="kt ku kv kw fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mm"><img src="../Images/f698f9970594b5e811560344ab9e4c21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qCLwKI5bZfQfFysjaMISCQ.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx translated">无服务器. yml文件</figcaption></figure><p id="abd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">部署前的最后一步是添加<code class="du lk ll lm ky b">serverless-python-requirements</code>插件。让我们创建一个<code class="du lk ll lm ky b">package.json</code>文件来保存您的节点依赖关系。</p><p id="bea7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该命令将创建<code class="du lk ll lm ky b">package.json</code>文件，接受所有默认值。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="e059" class="lc je hi ky b fi ld le l lf lg">npm init</span></pre><figure class="kt ku kv kw fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mn"><img src="../Images/42a9c4cafdb82a6f546768cb162fffb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7dP9iinRIIsi5Z6WbMb3xQ.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx translated">创建pacakge.json文件</figcaption></figure><p id="f2f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将再运行一个命令来安装`<code class="du lk ll lm ky b">serverless-python-requirements</code>package</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="ebb7" class="lc je hi ky b fi ld le l lf lg">npm install --save serverless-python-requirements</span></pre><figure class="kt ku kv kw fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mo"><img src="../Images/240aaae26c5f750e3c62e68c3bac0a56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XhbWJJa8c6gw2zuDSPFVwQ.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx translated">安装无服务器-python-要求</figcaption></figure><p id="ea99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了配置我们的<code class="du lk ll lm ky b">serverless.yml</code>文件来使用这个插件，我们将在我们的<code class="du lk ll lm ky b">serverless.yml</code>中添加以下几行:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="776b" class="lc je hi ky b fi ld le l lf lg">[...]</span><span id="9941" class="lc je hi ky b fi mh le l lf lg">plugins:<br/>  - serverless-python-requirements</span><span id="5661" class="lc je hi ky b fi mh le l lf lg">custom:<br/>  pythonRequirements:<br/>    dockerizePip: non-linux</span></pre><figure class="kt ku kv kw fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mp"><img src="../Images/264089b867932455e4c5167ed268005c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_E1g_80gnV32417Gbuwthw.png"/></div></div></figure><p id="27d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lk ll lm ky b">plugins</code>部分向框架注册插件。在<code class="du lk ll lm ky b">custom</code>部分，我们告诉插件在用pip安装包时使用Docker。它将使用一个类似于Lambda环境的Docker容器，因此编译后的扩展将是兼容的。</p><p id="98c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">进行部署之前的最后一步是配置IAM用户的密钥。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="5e8a" class="lc je hi ky b fi ld le l lf lg">aws configure</span></pre><p id="ab3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它会要求您输入IAM用户的访问密钥Id和秘密访问密钥。正确配置值。</p><p id="a063" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们将部署我们的功能:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="9b02" class="lc je hi ky b fi ld le l lf lg">serverless deploy</span></pre><p id="cd19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">恭喜你！👏您已经使用无服务器框架成功部署了AWS Lambda函数。</p><h1 id="ee77" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">使用变量</h1><p id="e43e" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">到目前为止，我们已经创建了基本的lambda函数，使用一个简单的命令，使用无服务器框架部署它。</p><p id="307c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们向前迈出一步，让我们的环境变得更有活力。</p><p id="5d89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">考虑一个场景，您希望在多个环境中部署相同的功能。我们将在我们的<code class="du lk ll lm ky b">serverless.yml</code>文件中使用一些自定义变量来将我们的代码部署到多个区域。</p><p id="3baf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打开<code class="du lk ll lm ky b">serverless.yml</code>文件，添加以下几行:</p><ul class=""><li id="fb5c" class="kb kc hi ih b ii ij im in iq mq iu mr iy ms jc ki kj kk kl bi translated">添加自定义变量</li></ul><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="3834" class="lc je hi ky b fi ld le l lf lg">[Previous Content.....]</span><span id="5e75" class="lc je hi ky b fi mh le l lf lg">custom:<br/>  defaultEnv: dev</span><span id="587e" class="lc je hi ky b fi mh le l lf lg">  #Env Specific Variables</span><span id="909e" class="lc je hi ky b fi mh le l lf lg">  dev:<br/>    region: us-east-1<br/>    profile: dev</span><span id="96c2" class="lc je hi ky b fi mh le l lf lg">  staging:<br/>    region: ap-south-1<br/>    profile: staging</span><span id="0438" class="lc je hi ky b fi mh le l lf lg">  pythonRequirements:<br/>    dockerizePip: non-linux</span></pre><p id="54c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的<code class="du lk ll lm ky b">serverless.yml</code>文件中，我们有一个名为<code class="du lk ll lm ky b">custom</code>的键。在这里，我们提到了<code class="du lk ll lm ky b">defaultEnv: dev</code>，我们还创建了<code class="du lk ll lm ky b">dev</code>键，并指定我们要使用<code class="du lk ll lm ky b">us-east-1</code>区域和<code class="du lk ll lm ky b">dev</code>配置文件。对于<code class="du lk ll lm ky b">staging</code>环境也是如此。你可以在这里阅读更多关于无服务器框架<a class="ae ks" href="https://www.serverless.com/framework/docs/providers/aws/guide/variables/" rel="noopener ugc nofollow" target="_blank">中的变量。</a></p><ul class=""><li id="a73f" class="kb kc hi ih b ii ij im in iq mq iu mr iy ms jc ki kj kk kl bi translated">在我们的提供者中使用变量。</li></ul><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="7f79" class="lc je hi ky b fi ld le l lf lg">[Existing Content.....]</span><span id="a664" class="lc je hi ky b fi mh le l lf lg">provider:<br/>  name: aws<br/>  runtime: python3.8<br/>  stage: ${opt:stage, self:custom.defaultStage}<br/>  region: ${self:custom.${self:provider.stage}.region}<br/>  profile: ${opt:profile,self:custom.${self:provider.stage}.profile}</span><span id="ef57" class="lc je hi ky b fi mh le l lf lg">[Existing Content....]</span></pre><p id="6613" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的<code class="du lk ll lm ky b">provider</code>部分，我们写了<code class="du lk ll lm ky b">stage: ${opt:stage, self:custom.defaultStage}</code>，这意味着我们可以在运行命令<code class="du lk ll lm ky b">serverless deploy</code>时传递stage的值，否则它将使用默认stage。例如，如果你写<code class="du lk ll lm ky b">serverless deploy --stage staging</code>，那么它将被翻译成<code class="du lk ll lm ky b">stage: staging</code>。你可以在这里阅读更多关于AWS提供者<a class="ae ks" href="https://www.serverless.com/framework/docs/providers/aws/guide/serverless.yml/" rel="noopener ugc nofollow" target="_blank">的可用选项。我在<code class="du lk ll lm ky b">provider</code>中使用的键都来自那个文档，我们正在使它动态化。</a></p><ul class=""><li id="ef07" class="kb kc hi ih b ii ij im in iq mq iu mr iy ms jc ki kj kk kl bi translated">现在，我们将把现有功能部署到舞台环境中。</li></ul><p id="9872" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要再次运行AWS Configure来为我们的<code class="du lk ll lm ky b">stageing</code>环境配置凭证。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="20fb" class="lc je hi ky b fi ld le l lf lg">aws configure --profile staging</span></pre><p id="85d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您必须配置临时环境IAM用户的Access_Key_Id和Secret_Access_Key。</p><ul class=""><li id="0b10" class="kb kc hi ih b ii ij im in iq mq iu mr iy ms jc ki kj kk kl bi translated">最终<code class="du lk ll lm ky b">serverless.yml</code>文件:</li></ul><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="5084" class="lc je hi ky b fi ld le l lf lg">---<br/>service: harsh-test</span><span id="d102" class="lc je hi ky b fi mh le l lf lg">frameworkVersion: '2'</span><span id="dd6a" class="lc je hi ky b fi mh le l lf lg">custom:<br/>  defaultStage: dev</span><span id="6ee7" class="lc je hi ky b fi mh le l lf lg">  dev:<br/>    region: us-east-1<br/>    profile: dev</span><span id="63e2" class="lc je hi ky b fi mh le l lf lg">  staging:<br/>    region: ap-south-1<br/>    profile: staging</span><span id="ee51" class="lc je hi ky b fi mh le l lf lg">  pythonRequirements:<br/>    dockerizePip: non-linux</span><span id="9ef2" class="lc je hi ky b fi mh le l lf lg">provider:<br/>  name: aws<br/>  runtime: python3.8<br/>  stage: ${opt:stage, self:custom.defaultStage}<br/>  region: ${self:custom.${self:provider.stage}.region}<br/>  profile: ${opt:profile,self:custom.${self:provider.stage}.profile}</span><span id="56fa" class="lc je hi ky b fi mh le l lf lg">functions:<br/>  hello:<br/>    handler: handler.main</span><span id="b748" class="lc je hi ky b fi mh le l lf lg">plugins:<br/>  - serverless-python-requirements</span></pre><h1 id="fcfd" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">将我们的功能部署到另一个环境</h1><p id="8190" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">一旦您完成了对<code class="du lk ll lm ky b">serverless.yml</code>文件的更改，我们只需运行一个命令，它就会将我们的功能部署到环境中。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="58e9" class="lc je hi ky b fi ld le l lf lg">serverless deploy --stage staging --profile staging</span></pre><p id="efba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:—在我的例子中，我的环境名称是staging，我的AWS概要文件名称也是staging。这就是为什么在我们的命令中，阶段名和概要名是相同的。在配置AWS凭证时，<code class="du lk ll lm ky b">--profile</code>对应于AWS配置文件。</p></div></div>    
</body>
</html>