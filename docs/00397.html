<html>
<head>
<title>Natural Language Processing: Experimenting spaCy and updating the model (Part 5)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自然语言处理:空间实验与模型更新(五)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/natural-language-processing-experimenting-spacy-and-updating-the-model-part-5-ffb13e239248?source=collection_archive---------2-----------------------#2019-05-26">https://medium.com/analytics-vidhya/natural-language-processing-experimenting-spacy-and-updating-the-model-part-5-ffb13e239248?source=collection_archive---------2-----------------------#2019-05-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7d0870e86889e50a10457ce9473d77a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uy8zKcQP5nxg2KUH6rFcqw.jpeg"/></div></div></figure><h1 id="8e51" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">介绍</h1><p id="5f2c" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在前4篇文章中，我们已经说明了Google和AWS NLP APIs的用法。我们还试验了spacy库，从不同的文档中提取实体和名词。我们已经展示了如何使用spaCy的模式匹配函数来改进该模型。</p><p id="e855" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们想比以前的文章更进一步，试验spacy的高级功能。spaCy允许更新统计模型并用新实体训练模型，而不使用“硬编码”匹配规则。这将允许根据我们的特定领域对模型进行微调。这对于实体识别或文本分类非常有用。</p><p id="7537" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们选择使用个人简介和职位描述，因为这是一个常见的用例，任何人都很容易理解，尽管我们认为使用这种算法来匹配候选人和职位是远远不够的。</p><h1 id="8afe" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">使用预先训练的模型</h1><p id="e4e3" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">如前一篇文章所示，让我们用通用职位描述文档上预先训练好的大型英语模型来解析文档，并让我们看看哪些实体已被识别:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="9eff" class="la ir hi kw b fi lb lc l ld le">import spacy spacy.load('en_core_web_lg') <br/>docJob=nlp(textCV) <br/>for ent in docJob.ents: <br/>   # Print the entity text and its label <br/>   if ent.label_=='PRODUCT': <br/>   print(ent.text, ent.label_,) <br/>SLQ ORG <br/>7 years DATE <br/>Statistics ORG <br/>Mathematics ORG <br/>C++ LANGUAGE <br/>Java LOC <br/>SLQ ORG <br/>S3 PRODUCT <br/>Spark ORG <br/>DigitalOcean ORG <br/>3rd ORDINAL <br/>Google Analytics ORG <br/>Site Catalyst, ORG <br/>Coremetrics ORG <br/>Adwords ORG <br/>Crimson Hexagon ORG <br/>Facebook Insights ORG <br/>Hadoop NORP <br/>Hive ORG <br/>Gurobi GPE <br/>MySQL GPE <br/>Business Objects ORG <br/>Glassdoor ORG</span></pre><p id="1eb0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">有趣的是，C++被认为是一种语言，而Java被认为是一个地缘政治实体，因为它是印度尼西亚的一个岛屿。例如JavaScript根本没有识别。这显然取决于模型被训练的背景类型，并且可能不特别是在计算机科学领域。</p><p id="644e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">之前我们已经展示了我们可以将自己的规则添加到模型中。因此，让我们将我们自己的检测规则添加到模型中，以更接近我们想要的，即识别人们档案中的技术技能:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="250d" class="la ir hi kw b fi lb lc l ld le"># define patterns we want to recognize <br/>patterns = [{"label": "PROG", "pattern": [{"lower": "java"}]}, {"label": "PROG", "pattern": [{"lower": "javascript"}]}] <br/># define an entity ruler using predefined patterns <br/>ruler = EntityRuler(nlp, patterns=patterns,overwrite_ents=True) <br/># add the ruler to the nlp pipeline <br/>nlp.add_pipe(ruler) <br/># apply to the job document <br/>docJob=nlp(textJob) <br/>for ents in docJob.ents: <br/># Print the entity text and its label <br/>  if ents.label_=='PROG': <br/>     print(ents.text, ents.label_,) <br/>Java PROG <br/>JavaScript PROG</span></pre><p id="57a1" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，我们已经将Java和JavaScript确定为编程语言。</p><p id="37c4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">因此，我们能够将基于规则的实体识别添加到统计模型中。这允许以快速的方式对模型进行微调，以适应特定的领域和需求。</p><p id="d21c" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这很有趣，因为在这种情况下，模型将Java检测为一个地缘政治实体，将JavaScript检测为一个组织。这是自动完成的，不需要为这个特定的文档编写特定的规则。</p><p id="99f7" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">因此，总之，我们可以说，不仅实体识别依赖于所使用的统计模型，而且显然依赖于用于训练的文档所涉及的领域类型。</p><h1 id="9db6" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">培训和更新模型</h1><p id="3809" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">spaCy允许我们训练底层神经网络，并用我们特定的领域知识更新它。这是一个coll特性，因为这正是我们想要做的。首先让我们添加一些我们想要在代表性句子中检测的实体的例子:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="c364" class="la ir hi kw b fi lb lc l ld le">trainData=[('Java is a programming language', {'entities': [(0, 4,'PROG')]}), ('I have 5 years experience in JavaScript', {'entities': [(27, 37,'PROG')]}), ('Extensive Java experience required', {'entities': [(10, 14,'PROG')]}), ('JavaScript is a programming language used mainly in front-end development', {'entities': [(0, 10, 'PROG')]}), ('Java is an object oriented programming language', {'entities': [(0, 4, 'PROG')]}), ('I have a long experience in project management', {'entities': []})]</span></pre><p id="174a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">它还建议举出反面例子，例如没有任何实体的句子。</p><p id="b57e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，让我们使用这些新实体和训练示例来训练和更新模型:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="02c0" class="la ir hi kw b fi lb lc l ld le"># initialize a blank spacy model <br/>nlp = spacy.blank('en') <br/># Create blank entity recognizer and add it to the pipeline <br/>ner = nlp.create_pipe('ner') <br/>nlp.add_pipe(ner) <br/># Add a new label for programming language <br/>ner.add_label('PROG') <br/># Start the training <br/>nlp.begin_training() <br/># Train for 10 iterations <br/>for itn in range(10): <br/>  random.shuffle(trainData) <br/>  # Divide examples into batches <br/>  for batch in spacy.util.minibatch(trainData, size=2): <br/>    texts = [text for text, annotation in batch] <br/>    annotations = [annotation for text, annotation in batch] <br/>    # Update the model <br/>    nlp.update(texts, annotations)</span></pre><p id="17cd" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，我们准备像以前一样在同一个文档上测试我们的模型。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="e2ba" class="la ir hi kw b fi lb lc l ld le">docJob=nlp(textJob) <br/>for ents in docJob.ents: <br/>  # Print the document text and entitites <br/>  if ents.label_=='PROG': <br/>  print(ents.text, ents.label_,) <br/>Data PROG <br/>Job PROG <br/>Description PROG <br/>Job PROG <br/>Java PROG <br/>JavaScript PROG <br/>Site PROG <br/>Map PROG</span></pre><p id="8458" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这很酷，现在Java和JavaScript已经被spaCy神经网络识别了。不幸的是，它也将一些新词归类为PROG，但这是一个好的开始。</p></div><div class="ab cl lf lg gp lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hb hc hd he hf"><p id="a526" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><em class="lm">原载于2019年5月26日</em><a class="ae ln" href="https://smartlake.ch/natural-language-processing-experimenting-spacy-and-updating-the-model-part-5/" rel="noopener ugc nofollow" target="_blank"><em class="lm">https://smart lake . ch</em></a><em class="lm">。</em></p></div></div>    
</body>
</html>