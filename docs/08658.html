<html>
<head>
<title>Linting Python Codes Better with Travis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">林挺 Python 和 Travis 一起编码更好</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/linting-python-codes-better-with-travis-ab166034400?source=collection_archive---------15-----------------------#2020-08-07">https://medium.com/analytics-vidhya/linting-python-codes-better-with-travis-ab166034400?source=collection_archive---------15-----------------------#2020-08-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3432b5ab7c845e6d3e7f5a7600007204.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j8POYEMu_hZFvwDih9hxsA.jpeg"/></div></div></figure><p id="360d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在为开源组织做贡献时，人们会注意到需要遵循编码标准和惯例来审查和合并您的拉式请求。成熟的公司和许多初创公司都是如此:他们都喜欢遵循自己选择的编程语言的编码标准。这个过程就是所谓的 T2 林挺 T3。当组织放弃他们的代码时，每个人都很高兴，因为编码标准被遵循了。<br/>但是我们能在我们的私人账户里有同样的设置吗？可以像这些组织一样运作。答案是肯定的，我们可以，如果你留下来，我会带你去看。</p><p id="22be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本教程结束时，我们将:</p><ul class=""><li id="8476" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">了解林挺是什么</li><li id="3553" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">设置 TravisCI 并将其集成到我们的存储库中</li><li id="281a" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">使用 Travis CI 通过 flake8 和 pylint 来 lint Python 代码</li></ul><h1 id="e0aa" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">什么是林挺</h1><p id="4aa7" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">林挺是指分析源代码以标记编程错误和风格错误的过程。如果操作得当，林挺可以检测程序中的格式差异和错误，并确保您遵守编码标准和惯例。Linters(林挺的一个工具)确保你遵循最佳实践，使你的代码可读，易于维护，并可能节省时间。<br/>组织使用 CI 工具来自动化他们的林挺，并确保未来代码库的贡献者遵循 lint 规则。</p><p id="9605" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每种语言都使用自己的一套行，所以我在下面只列出了三种编程语言的三个 linters:</p><ul class=""><li id="f92c" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">Python: pylint，flake8，bandit</li><li id="1b81" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">go lang:Go-critical、go-vet、golangci-lint(包含 Go 语言中的所有 linters)</li><li id="dc44" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">JavaScript: ESLint，JSLint。</li></ul><p id="079e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于本教程的重点，我们将集中在林挺 python 代码。</p><h1 id="4511" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">设置 TravisCI 并将 TravisCI 集成到您的存储库中</h1><p id="fd88" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">在上一节中，我们讨论了组织使用 CI 工具来自动化他们的林挺。但是 CI 是什么呢？</p><p id="ff48" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">持续集成是一种软件开发实践，开发人员定期将他们的代码变更合并到一个中央存储库中，然后运行自动化构建和测试。<br/>持续集成通常是指软件发布过程的构建或集成阶段，需要自动化组件(如 CI 或构建服务)和文化组件(如经常学习集成)。<br/> Travis CI(拜托，顾名思义)是组织用来自动测试 lint 的工具之一。许多开源组织使用 Travis 来实现自动化，我们将模仿他们来自动检查 lint。</p><p id="ca77" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Travis CI 在他们的文档中有所有需要设置的步骤，因此在这里输入这些步骤是多余的。请点击查看他们的文档。完成后，Travis 就设置好了，并与您的帐户关联。<br/>要将 Travis 与您的存储库集成，您需要在项目级目录中添加一个<strong class="is hj"> .travis.yml </strong>文件来触发 Travis CI 构建。</p><h1 id="8f62" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">林挺 Python 代码与特拉维斯 CI</h1><p id="3383" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">现在我们前面提到了 Python 中的 linters，所以我们从中挑选两个来使用:flake8 和 pylint。我们将检查包中的以下代码。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="bb7d" class="lq ke hi lm b fi lr ls l lt lu">import json<br/>class Dog:</span><span id="dad1" class="lq ke hi lm b fi lv ls l lt lu">def __init__(self, name, age):<br/>        """Initialize name and age attributes."""<br/>        self.dog_name = name<br/>        self.dog_age = age<br/>        self.name = "Rambo"<br/>        self.age = 12</span><span id="fa8f" class="lq ke hi lm b fi lv ls l lt lu">def sit(self):<br/>        print(f"{self.dog_name} is now sitting")</span><span id="d2b1" class="lq ke hi lm b fi lv ls l lt lu">def roll_over(self):<br/>        print(f"{self.dog_age} rolled over!")</span><span id="cb0a" class="lq ke hi lm b fi lv ls l lt lu">my_dog = Dog("Maxwell", 6)</span></pre><p id="728f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将上面的代码保存在一个名为<code class="du lw lx ly lm b">app.py</code>的新文件中，然后我们用下面的内容创建一个<code class="du lw lx ly lm b">requirements.txt</code>文件</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="2c6b" class="lq ke hi lm b fi lr ls l lt lu">pytest-pylint==0.16.1<br/>pytest-flake8==1.0.5</span></pre><p id="bddb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们选择这些包是因为 Travis CI 需要运行一个测试，以及使用哪个包更好。<br/> Pytest 用于运行测试，将在后续文章中详细介绍。</p><blockquote class="lz ma mb"><p id="43c7" class="iq ir jo is b it iu iv iw ix iy iz ja mc jc jd je md jg jh ji me jk jl jm jn hb bi translated"><strong class="is hj"> <em class="hi">注意</em> </strong> <em class="hi">:以下环节需单独完成。首先使用 flake8 包，观察结果，修复后，将代码返回到上面的格式，并用 pylint 进行测试。<br/>这样做是为了让你看到两个包装之间的差异，并选择你最喜欢的一个。</em></p></blockquote><h1 id="8bbc" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">薄片 8</h1><p id="4523" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">Flake8 是一个用于实施样式指南的工具。这意味着 flake8 的主要目的是确保你的代码风格正确。<br/>是“验证 pep8、pyflakes 和循环复杂度的包装器”。要在 Travis 中设置它，按照上面的说明创建一个 Travis YAML 文件，并向其中添加以下代码。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="396d" class="lq ke hi lm b fi lr ls l lt lu">language: python<br/>python: "3.8"</span><span id="d822" class="lq ke hi lm b fi lv ls l lt lu">install:<br/>    - pip install -r requirements.txt<br/>scripts:<br/>    - pytest --flake8</span></pre><ul class=""><li id="03ad" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">语言:这告诉 Travis 使用 python 作为这次构建的编程语言。</li><li id="3701" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">python:在这里你选择你想要测试代码的版本，它支持从 2.7 到现在的所有 python 版本，但是我们用 python 3.8 版本测试我们的代码。</li><li id="2408" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">安装:我们正在安装我们已经在<code class="du lw lx ly lm b">requirements.txt</code>文件中定义的包。我们希望将包安装在 Travis 环境中，以便可以访问它。</li><li id="6cb8" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">脚本:这里，我们正在执行我们安装的<code class="du lw lx ly lm b">pytest --flake8</code>包。这个包裹集 pytest 和 flake8 于一身。这意味着它将针对 flake8 测试代码中的所有<code class="du lw lx ly lm b">.py</code>文件。</li></ul><h1 id="fccb" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">皮林特</h1><p id="3ddc" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">Pylint 与 flake8 有点不同，它实际上是完整的:它检查样式指南、编程错误，并遵循最佳实践。有些人甚至说 pylint 的规则太严格了(这是真的，你会看到的)，所以有些人用<code class="du lw lx ly lm b">black</code>代替 pylint。<br/>我们要做和上面一样的设置<br/>编辑上面的文件<code class="du lw lx ly lm b">.travis.yml</code>来使用 pylint，</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="c1b3" class="lq ke hi lm b fi lr ls l lt lu">language: python<br/>python: "3.8"</span><span id="beca" class="lq ke hi lm b fi lv ls l lt lu">install:<br/>    - pip install -r requirements.txt<br/>scripts:<br/>    - pytest --pylint</span></pre><p id="3f0e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它遵循与上面相同的解释，这次我们执行 pylint 来检查，而不是 flake8。</p><h1 id="0460" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结果</h1><p id="8be8" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">当我们将上述代码提交到存储库时，Travis 构建了测试 flake8 或 pylint 代码所需的环境。<br/>如果您使用 flake8 包，您应该会得到以下错误:</p><p id="20b9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您使用 pylint 包，您应该会得到以下错误:</p><p id="8e67" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在 pylint 有一个烦人的<code class="du lw lx ly lm b">C103: Constant name "my_dog" doesn't conform to UPPER_CASE naming style (invalid-name)</code>规则。<br/>我不喜欢这样，所以我们会选择忽略那个特定的错误，我们通过...</p><p id="1922" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，通过 flake8 和 pylint 的最终代码如下:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="a7c2" class="lq ke hi lm b fi lr ls l lt lu">"""This module is an attempt to practise class in python."""</span><span id="b236" class="lq ke hi lm b fi lv ls l lt lu">class Dog:<br/>    """A simple attempt to model a dog."""</span><span id="95d7" class="lq ke hi lm b fi lv ls l lt lu">def __init__(self, name, age):<br/>        """Initialize name and age attributes."""<br/>        self.dog_name = name<br/>        self.dog_age = age<br/>        self.name = "Rambo"<br/>        self.age = 12</span><span id="c023" class="lq ke hi lm b fi lv ls l lt lu">def sit(self):<br/>        """Simulate a dog sitting in response to a command."""<br/>        print(f"{self.dog_name} is now sitting")</span><span id="a4f6" class="lq ke hi lm b fi lv ls l lt lu">def roll_over(self):<br/>        """Simulate a dog sitting in response to a command."""<br/>        print(f"{self.dog_age} rolled over!")</span><span id="6689" class="lq ke hi lm b fi lv ls l lt lu">my_dog = Dog("Maxwell", 6)</span></pre><p id="8b52" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，如果我们将代码推送到 git 存储库，测试就成功通过了。如果您检查与您的 git 帐户相关的电子邮件，您应该会看到一条祝贺消息，说您已经修复了构建。</p><h1 id="b279" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结论</h1><p id="e0c2" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">我们已经了解了什么是林挺，如何将 Travis CI 添加到我们的 git 环境中，并使用 Python 中的 linters 根据 Python 规则测试了我们的代码。<br/>您应该知道，您还可以使用 Travis 来测试您的代码是否做了它应该做的事情。这被称为测试驱动开发，我们将在即将到来的 Pytest 系列中对此进行大量讨论。</p><p id="7d05" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在那之前，享受自动化的力量吧！</p><p id="6229" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最初发布于<a class="ae lg" href="https://dev.to/edeediong/using-travisci-to-write-better-python-codes-27kg" rel="noopener ugc nofollow" target="_blank">发展至</a>。</p></div></div>    
</body>
</html>