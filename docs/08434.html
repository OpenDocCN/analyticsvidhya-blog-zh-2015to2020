<html>
<head>
<title>Forecasting using LSTMs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 LSTMs 进行预测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/forecasting-using-lstms-61bc273d3c2e?source=collection_archive---------18-----------------------#2020-07-29">https://medium.com/analytics-vidhya/forecasting-using-lstms-61bc273d3c2e?source=collection_archive---------18-----------------------#2020-07-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="0363" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用 LSTMs 预测<strong class="ih hj">新冠肺炎</strong>病例<strong class="ih hj">印度</strong>为<strong class="ih hj">例</strong>。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="be5f" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">简短的描述</h1><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ki"><img src="../Images/b5e6f5643ba50fd2e264f7701aa1cb2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*USoQ3a51hMos1Fq0DiSr6A.png"/></div></div></figure><p id="e1b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">LSTM 代表'<strong class="ih hj">长短期记忆，</strong>是由<a class="ae ku" href="http://www.bioinf.jku.at/publications/older/2604.pdf" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">hoch Reiter&amp;schmid Huber</strong></a>在 1997 年提出的。LSTMs 是一种特殊类型的 RNNs(递归神经网络)，有助于解决<strong class="ih hj">长期依赖性问题</strong>。正常的 RNN 面临<strong class="ih hj">消失梯度</strong>的挑战，这使得网络难以学习长序列。这就是 LSTMs 介入并帮助解决上述问题的原因。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="6c96" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">构建 LSTM 模式</h1><p id="ce91" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">我将使用<strong class="ih hj"> TensorFlow 2.0 </strong>来创建模型。</p><h2 id="e682" class="la jl hi bd jm lb lc ld jq le lf lg ju iq lh li jy iu lj lk kc iy ll lm kg ln bi translated">加载所需的库</h2><pre class="kj kk kl km fd lo lp lq lr aw ls bi"><span id="440d" class="la jl hi lp b fi lt lu l lv lw">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import tensorflow as tf<br/>from sklearn.preprocessing import MinMaxScaler<br/>from tensorflow.keras.layers import Input, Dense, LSTM<br/>from tensorflow.keras.models import Model<br/>from tensorflow.keras.optimizers import SGD, Adam</span></pre><h2 id="a2c2" class="la jl hi bd jm lb lc ld jq le lf lg ju iq lh li jy iu lj lk kc iy ll lm kg ln bi translated">正确构建培训数据</h2><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lx"><img src="../Images/6e9752a2ce145300a02ef5432ec85b19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IVsGQTDO73u-AZSSHF_9-g.png"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">这是数据框的外观</figcaption></figure><p id="2e7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们只想预测每天的新病例，所以我们将只从上面的数据框架中提取相关数据。</p><pre class="kj kk kl km fd lo lp lq lr aw ls bi"><span id="f01b" class="la jl hi lp b fi lt lu l lv lw">y_tot = df_new[' New_cases'].values<br/>data_train = np.array(y_tot)<br/>X_train = []<br/>Y_train = []</span><span id="409e" class="la jl hi lp b fi mc lu l lv lw"><strong class="lp hj"><em class="md">#We want to use the last 7 days of data to predict for the next 7 days</em></strong></span><span id="7b6b" class="la jl hi lp b fi mc lu l lv lw">for i in range(7, len(data_train)-7):<br/>    X_train.append(data_train[i-7:i])<br/>    Y_train.append(data_train[i:i+7])</span><span id="ef5e" class="la jl hi lp b fi mc lu l lv lw"><strong class="lp hj"><em class="md">#The shape of X_train is (168, 7)</em></strong></span><span id="cb52" class="la jl hi lp b fi mc lu l lv lw">X_train, Y_train = np.array(X_train), np.array(Y_train)<br/>scaler_x = MinMaxScaler()<br/>scaler_y = MinMaxScaler()<br/>X_train = scaler_x.fit_transform(X_train)<br/>Y_train = scaler_y.fit_transform(Y_train)<br/>X_train = X_train.reshape(168, 7, 1)</span></pre><p id="e86e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码单元格中，我们创建了'<strong class="ih hj"> X_train </strong>，其中包含第<strong class="ih hj">天</strong>天之前<strong class="ih hj">七</strong>天的案例数，以及'<strong class="ih hj"> Y_train </strong>，其中包含第天<strong class="ih hj">天</strong>之后<strong class="ih hj">七</strong>天<strong class="ih hj">的案例名(包括第 I 天的实例数)，之后我们进行了缩放</strong></p><h2 id="6943" class="la jl hi bd jm lb lc ld jq le lf lg ju iq lh li jy iu lj lk kc iy ll lm kg ln bi translated">构建模型</h2><p id="ffd3" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">LSTM 模型的构建是一个高度<strong class="ih hj">迭代</strong>的过程。必须添加具有不同<strong class="ih hj">参数</strong>的不同类型的<strong class="ih hj">层</strong>，用<strong class="ih hj"> dropou </strong> t 层进行实验以最终确定模型，该模型适当地符合它们的数据。</p><pre class="kj kk kl km fd lo lp lq lr aw ls bi"><span id="7101" class="la jl hi lp b fi lt lu l lv lw">model = tf.keras.models.Sequential()<br/>model.add(tf.keras.layers.LSTM(60, activation = 'relu', input_shape=(7, 1)))    <br/>model.add(tf.keras.layers.Dense(7))<br/>model.compile(loss = 'mse', optimizer='adam')<br/>model.fit(X_train, Y_train, epochs=100)</span></pre><p id="6fe5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用“<strong class="ih hj">均方误差</strong>作为损失函数，使用“<strong class="ih hj"> Adam </strong>作为优化函数。</p><h2 id="6d22" class="la jl hi bd jm lb lc ld jq le lf lg ju iq lh li jy iu lj lk kc iy ll lm kg ln bi translated">预言</h2><p id="d385" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">我保留了最后七个值，用于预测接下来的七个天<strong class="ih hj">。在这个特殊的例子中，它们也作为测试集。</strong></p><pre class="kj kk kl km fd lo lp lq lr aw ls bi"><span id="c212" class="la jl hi lp b fi lt lu l lv lw">X_test = list(y_tot[-7:])<br/>X_test = np.array(X_test)<br/>X_test = X_test.reshape(1, 7)<br/>X_test = scaler_x.transform(X_test)<br/>X_test = X_test.reshape(1, 7, 1)</span><span id="1134" class="la jl hi lp b fi mc lu l lv lw">pred = model.predict(X_test)</span></pre><h2 id="5118" class="la jl hi bd jm lb lc ld jq le lf lg ju iq lh li jy iu lj lk kc iy ll lm kg ln bi translated">结果</h2><p id="1226" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">作为结果，我们得到的一系列预测并不完全是预测，因为模型和预测已经使用了<strong class="ih hj">缩放的</strong>数据，所以输出本身也是缩放的，所以它必须被改变以显示实际值。</p><pre class="kj kk kl km fd lo lp lq lr aw ls bi"><span id="c9a7" class="la jl hi lp b fi lt lu l lv lw">y_true = scaler_x.inverse_transform(pred)<br/>y_true.astype(int)</span></pre><p id="b9a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">输出</strong></p><p id="a194" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来<strong class="ih hj">七</strong>天的案件数量如下:</p><pre class="kj kk kl km fd lo lp lq lr aw ls bi"><span id="0d85" class="la jl hi lp b fi lt lu l lv lw">46456, 48228, 50931, 54741, 62993, 68006, 67171</span></pre><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es me"><img src="../Images/356a38a3670fa47d20f3a8065dbc946c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IZPKW_oxkSMIokES3F3TNw.png"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">截至 7 月 28 日的数据，以及截至 8 月 4 日的预测</figcaption></figure><p id="cdfb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注</strong>:预测可能<strong class="ih hj">也可能</strong>不正确，因为病例数取决于各种<strong class="ih hj">外部因素</strong>。LSTM 预测是为了对未来的病例数有一个大概的了解，并做相应的准备。本文<strong class="ih hj">旨在</strong>以印度新冠肺炎数据为例，展示一个简单<strong class="ih hj"> LSTM </strong>的<strong class="ih hj">构造</strong>。</p><h1 id="f9d5" class="jk jl hi bd jm jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh bi translated">密码</h1><p id="13b8" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">上述 LSTM 模型的代码已经上传到下面的 GitHub <a class="ae ku" href="https://github.com/rahulks9/COVID_PRED" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">库</strong> </a>。</p><h1 id="8823" class="jk jl hi bd jm jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh bi translated">数据</h1><p id="4c09" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">数据取自以下<a class="ae ku" href="https://covid19.who.int/info/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">网站</strong> </a>。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="76a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢你，如果你能走到这一步。请在下面的回复部分提出任何建议。</p></div></div>    
</body>
</html>