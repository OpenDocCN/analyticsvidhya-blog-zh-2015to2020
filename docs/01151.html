<html>
<head>
<title>Create a Rapping AI using deep learning — Part 1, Collecting the data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用深度学习创建说唱人工智能—第1部分，收集数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/create-a-rapping-ai-using-deep-learning-part-1-collecting-the-data-634bbfa51ff5?source=collection_archive---------4-----------------------#2019-10-04">https://medium.com/analytics-vidhya/create-a-rapping-ai-using-deep-learning-part-1-collecting-the-data-634bbfa51ff5?source=collection_archive---------4-----------------------#2019-10-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6f73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">问候所有<strong class="ih hj">数据忍者</strong>和<strong class="ih hj"> ML战士</strong>！</p><p id="dec5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是关于我如何创造一个<strong class="ih hj">人工智能</strong>来生成全新的，但可信的(！)、<strong class="ih hj">说唱歌词</strong>。<strong class="ih hj">从零开始！</strong></p><p id="33ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(也就是我从零开始创造了AI。人工智能不会从零开始创造任何东西。需要对海量的说唱歌词进行训练。想想看，我可能接受过关于如何使用数据<strong class="ih hj"> <em class="jd">【递归思维爆炸】</em> </strong>训练一个模型的大量数据培训，以便能够创建这个人工智能。严格地说，可能没有人从零开始创造过任何东西。不管怎样…重点是你将能够从头开始创建你自己的Rap生成AI(某种程度上)!)</p><p id="cacf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">免责声明:</strong>这将是一个非常实用的、非理论的、代码繁重的、没有数学的教程。关于语言模型背后的理论，有大量的资源，我会在我认为合适的时候尝试参考它们。然而，本系列文章的目的是构建一些可以使用、重用、调整的东西，并有希望启发构建其他类似的应用程序。不是教深度学习或者NLP的理论。<br/> <em class="jd">呼</em> <br/>我们出发了……</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/fae2227b0a1fe5264d306a55aebd3db9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-G4bxEtn87lt_88Yb9hl3w.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">我们项目的预期结果</figcaption></figure><h1 id="7897" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">第1部分—收集数据</h1><p id="3d3f" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">任何有趣的ML项目的第一部分都是收集数据。一般来说，越多越好。</p><p id="adba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个说唱AI自然会被训练说唱歌词。幸运的是，世界上最大的歌词集<a class="ae kx" href="https://genius.com/" rel="noopener ugc nofollow" target="_blank"> Genius </a>，有一个免费使用的API，我们可以利用它来收集说唱歌词。您需要做的第一件事是注册一个Genius developer帐户。进入<a class="ae kx" href="https://genius.com/developers" rel="noopener ugc nofollow" target="_blank">开发者页面</a>，点击<strong class="ih hj">创建API客户端</strong>。其中两个字段是必填的，<strong class="ih hj">应用名称</strong>和<strong class="ih hj">应用网址</strong>，但其他字段可以留空。接下来，您将收到一个客户端ID、密码和访问令牌。请将它们存放在安全的地方，因为需要它们来访问Genius API和下载歌词。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ky"><img src="../Images/88a81f7790da79189010142676b4bacf.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*kxTeLkssxm8_VyBd.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">将这些信息保存在安全的地方</figcaption></figure><p id="8a89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将使用Python实现一个客户端脚本，它将通过向Genius API发送请求来下载我们想要的所有歌词。我们可以使用HTTP客户端库直接向Genius REST API发送请求。幸运的是，有人已经在Python库<a class="ae kx" href="https://github.com/johnwmillr/LyricsGenius" rel="noopener ugc nofollow" target="_blank">lyric genius</a>中为我们实现了一个包装器(没有双关的意思)，所以我们就用它吧。</p><p id="316d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要使用<strong class="ih hj"> pip </strong>安装lyricsgenius，只需在终端中键入<code class="du kz la lb lc b">pip install lyricsgenius</code>。</p><p id="7175" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下面的代码片段中，您可以看到我如何创建自己的<strong class="ih hj">包装类</strong>(双关语)，它使用<strong class="ih hj"> lyricsgenius </strong>下载特定艺术家的歌词，按照它们在genius数据库中的顺序:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ld le l"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">访问Genius并下载歌词</figcaption></figure><p id="222c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如您所见，访问Genius API所需要的只是我们之前生成的<strong class="ih hj"> client_access_token </strong>。所有找到的歌词都将存储在Python项目的根文件夹中，在一个名为<strong class="ih hj"> data </strong>的子文件夹中。而且每首歌的歌词都会保存到单独的<strong class="ih hj">。txt </strong>文件放在以艺人名字命名的子文件夹中。<br/> <strong class="ih hj">举例:</strong> <code class="du kz la lb lc b">/rap_generator/data/Eminem/My name is.txt</code></p><p id="7df6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为你能想到的每个说唱歌手运行<code class="du kz la lb lc b">Genius.scrape_artist</code>方法真的很繁琐。此外，正如我之前所说，我们需要大量的数据来训练我们的说唱人工智能。当然，我不知道你能说出多少说唱歌手的名字…但我意识到我肯定需要我从未听说过的艺术家的歌曲来获得我需要的数据量。我所做的是我去了维基百科页面，复制了所有艺术家的名字，并创建了一个每行一个名字的文本文件。总共约有1500名说唱歌手。然后我从那个文件中读取名字，并为每个名字调用<code class="du kz la lb lc b">Genius.scrape_artist</code>。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ld le l"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">下载所有艺术家的歌词</figcaption></figure><p id="6101" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这段代码将从文件<strong class="ih hj"> rappers.txt </strong>中读取说唱歌手的名字，并尝试从每个说唱歌手那里下载50首歌曲的歌词。注意，我将<strong class="ih hj"> secret_access_token </strong>作为命令行参数传递，它是使用<code class="du kz la lb lc b">sys.argv[1]</code>读取的。这很有效，最终我们将拥有1500首歌曲。问题是…这要花很长时间。对Genius API的每个请求都有很长的往返时间。幸运的是，有一个解决方案，叫做并发！坚持住…</p><p id="a8fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于<a class="ae kx" href="https://wiki.python.org/moin/GlobalInterpreterLock" rel="noopener ugc nofollow" target="_blank">全局解释器锁</a>和yadayadayada，Python通常被指责为不是最具并行性的语言。这是真的。然而，在解释器由于外部进程(如文件I/O或web服务器请求)而大部分时间被阻塞的情况下，这些进程是相互独立的，我们也可以并行运行所有的进程。对于这个用例，Python大放异彩！</p><p id="45d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并行运行Python代码最简单(可能也是最方便)的方式是通过<code class="du kz la lb lc b">concurrent.futures</code>模块。只需查看这几行代码:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ld le l"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">同时下载歌词</figcaption></figure><p id="557f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们将<strong class="ih hj"> rappers.txt </strong>读入一个列表。然后，我们实例化一个<code class="du kz la lb lc b">ThreadPoolExecutor</code>。(这听起来比实际要复杂得多。一个<strong class="ih hj">线程</strong>只是一段可以和其他代码并行运行的代码，即其他<strong class="ih hj">线程</strong>，一个<strong class="ih hj">池</strong>只是一堆<strong class="ih hj">线程</strong>，而<strong class="ih hj">执行器</strong>只是一个可以执行<strong class="ih hj">池</strong>中<strong class="ih hj">线程</strong>的东西。)我们必须指定并行运行的线程数量(即池的大小)，我选择了5。</p><p id="6a63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，下一行是很酷的东西:<br/> <code class="du kz la lb lc b">executor.map(genius.scrape_artist, rappers)</code></p><p id="303d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们运行这一行时，执行器将从列表<code class="du kz la lb lc b">rappers</code>中一次获取一个<strong class="ih hj">元素</strong>，该列表作为第二个参数传递给<code class="du kz la lb lc b">executor.map</code>。它将调用作为第一个参数传递给<code class="du kz la lb lc b">executor.map</code>的函数<code class="du kz la lb lc b">genius.scrape_artist</code>，并将每个<strong class="ih hj">元素</strong>作为参数传递给该函数。因此，第一个呼叫将是<code class="du kz la lb lc b">scrape_artist(rappers[0])</code>，第二个将是<code class="du kz la lb lc b">scrape_artist(rappers[1])</code>，以此类推…</p><p id="2af1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最酷的是，执行程序会自动并行启动5个这样的调用，等到其中一个调用结束，再启动一个新的调用，以此类推，直到整个列表用尽！</p><p id="9384" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像我在这个例子中所做的那样设置<code class="du kz la lb lc b">num_workers=5</code>将产生大约5倍的加速，因为这个脚本中的大部分时间都在等待请求完成。<strong class="ih hj">警告！</strong>如果这个数字增加得太多，您可能会达到一个客户端同时请求的服务器端限制。超过这个限制甚至可能会导致禁令，所以要小心…</p><p id="f025" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下载所有歌词后，您可能希望将它们连接成一个大的文本文件，用于训练生成型NLP模型:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ld le l"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">将所有下载的歌词连接成一个文本文件</figcaption></figure><p id="5d38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里发生的事情是，我列出了我们之前创建的data文件夹中的所有子文件夹，对于每个子文件夹，我遍历包含rap歌词的所有文本文件。我在每首歌的歌词前加上艺术家的名字和歌名。我希望人工智能能够在每首新歌的歌词生成之前，自己想出艺术家的名字和歌名。那该多酷啊。</p><p id="b7c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我用一个特殊的分隔符(字符<code class="du kz la lb lc b">'*'</code>的50倍)将所有歌词连接起来，并将所有内容写入一个新文件。</p><p id="8e3f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">关于异常处理的注意:</strong>因为我们下载了很多文件，其中一些可能因为…原因而损坏…这就是为什么我只是吞下任何可能发生的错误。无论如何，我们都希望有足够的数据。</p><p id="2ab0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样！我们现在有一个相当不错的数据集，包括大约40，000首说唱歌曲的歌词。现在是时候教一个AI如何用类似的风格写新歌词了。</p><h1 id="7867" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">我们今天学了什么？</h1><ul class=""><li id="c063" class="lf lg hi ih b ii ks im kt iq lh iu li iy lj jc lk ll lm ln bi translated">如何使用Python从Genius下载歌词</li><li id="0045" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">如何使用Python并发发送web请求</li><li id="7c30" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">如何使用Python连接文本文件</li></ul><h1 id="cfd9" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">下次我们会学到什么？</h1><ul class=""><li id="7a16" class="lf lg hi ih b ii ks im kt iq lh iu li iy lj jc lk ll lm ln bi translated">如何加载预训练的通用语言模型</li><li id="5d2d" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">如何使用自己的数据集微调预先训练的语言模型</li></ul><p id="d5e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">未完待续…</p></div></div>    
</body>
</html>