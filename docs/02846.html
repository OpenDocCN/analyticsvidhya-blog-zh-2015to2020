<html>
<head>
<title>Building Akinator with Python using Bayes Theorem</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用贝叶斯定理用Python构建导航器</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/building-akinator-with-python-using-bayes-theorem-216253c98daa?source=collection_archive---------1-----------------------#2020-01-05">https://medium.com/analytics-vidhya/building-akinator-with-python-using-bayes-theorem-216253c98daa?source=collection_archive---------1-----------------------#2020-01-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8331" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最近我开始研究概率规划，它的基础是贝叶斯定理。人们总是告诉你，你需要有一个“贝叶斯思维”的心态来掌握概率编程，其中的一部分是学习在新的证据下更新你的信念。</p><p id="7f84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这让我想起了这个游戏<a class="ae jd" href="https://akinator.com" rel="noopener ugc nofollow" target="_blank"> Akinator </a>，在这个游戏中，你想一个角色，任何一个角色，它都会问你问题，以精确地找出你在想什么。当Akinator出现的时候，互联网还很年轻，那时候它就像魔术一样神奇！现在我意识到它完全符合贝叶斯理论:它对你可能想到的角色有一些信念，然后它不断问你问题，以收集更多证据来证明它可能是哪个角色。</p><p id="d162" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本教程中，我们将使用Python实现一个简单版本的Akinator。</p><p id="9605" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从一个简单的flask web服务器和一个用于提问的基本HTML开始:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jj jk l"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">server.py</figcaption></figure><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jj jk l"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">模板/索引. html</figcaption></figure><p id="b627" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，如果您使用<code class="du jp jq jr js b">python server.py</code>启动web服务器，您将会看到:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jt"><img src="../Images/945d94fc1aa31827146e88ec76135d7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*w-FGS5xgNvgJbpg5w0Yqgg.png"/></div></figure><p id="68d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么这将如何工作呢？首先让我们记住一些理论，想象我在想教皇，教皇是阿根廷人的可能性有多大？</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jw"><img src="../Images/07b1ca6fdfa67ab1e38eecc61e6540c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/0*CScQOVszzNzbWr-L.png"/></div></figure><p id="b293" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是这个符号的意思:假设(用|)我有教皇，我得到一个阿根廷人<em class="jx">的<em class="jx">概率</em>(用P表示)是多少？百分之百，因为只有一个教皇，而且他是阿根廷人。这被称为<em class="jx">向前概率</em>。</em></p><p id="b710" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但我们更感兴趣的是反过来的问题:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jw"><img src="../Images/1da4bef5e6e3300a520a42a3721a1ee5.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/0*JktKVTFDh2k2YxlS.png"/></div></figure><p id="3250" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我知道某人是阿根廷人，那么他成为教皇的可能性有多大？你可以看到这是一个完全不同的问题，而且更难，在这种情况下，它是4500万分之一，因为这是阿根廷的人口，只有一个教皇出来。这被称为<em class="jx">逆概率</em>，这正是我们想要Akinator做的。</p><p id="b3df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在18世纪，托马斯·贝叶斯牧师给了我们一种计算逆概率的方法。如果你还不知道它，你可以稍后检查它背后的故事，现在只要相信数学。这是公式，在酷氖:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jy"><img src="../Images/9c5d51112ca4200cd80c1a17a47ce7c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Xb5sZYEaZvM3Xy5P.jpg"/></div></div></figure><p id="8d6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的例子中，A是一个<strong class="ih hj">字符</strong>作者试图猜测，B是你给他的问题的<strong class="ih hj">答案</strong>。所以用英语来说就是:给定<strong class="ih hj">答案</strong> ( <em class="jx">逆概率</em>，你在思考这个<strong class="ih hj">人物</strong>的概率等于给定你在思考那个<strong class="ih hj">人物</strong> ( <em class="jx">可能性</em>)时你给出这个<strong class="ih hj">答案的概率，乘以选择那个<strong class="ih hj">人物</strong> ( <em class="jx">先于</em>)的独立概率，除以选择的独立概率</strong></p><p id="068f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">唯一的事情是，对于我们的问题，我们必须扩展这个公式一点，因为Akinator不仅有一个证据要考虑，而是几个证据，通过向玩家提问获得。</p><p id="800f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，如果我想到荷马·辛普森，我已经告诉过你我的角色是黄色的男性:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es kd"><img src="../Images/65f73fcafa0ca0b7c1140f269002b950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gNAszEA7qFlFW27-.png"/></div></div></figure><p id="6bbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于为什么这个公式会以多种证据的方式扩展的更多细节，我推荐你看看这篇论文，它解释得很好:<a class="ae jd" href="http://cs.wellesley.edu/~anderson/writing/naive-bayes.pdf" rel="noopener ugc nofollow" target="_blank">http://cs.wellesley.edu/~anderson/writing/naive-bayes.pdf</a></p><p id="b85e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就这样，这绝对是我们需要的所有理论，让我们来看代码！</p><p id="b39c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，为了简单起见，我不使用数据库，只使用那些数据结构:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jj jk l"/></div></figure><p id="f836" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我添加了4个问题和3个角色:荷马·辛普森，海绵宝宝，除了最后一个问题外，它真的很像荷马，珊迪·奇克斯，它与海绵宝宝完全相反。选择这些的想法是为了测试我们的命名者在有明显差异和非常小的差异时的表现。</p><p id="5d1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">问题字典上的每个键都是它的id，然后在字符列表上我们有一个这些问题的答案图。请注意，桑迪遗漏了一个答案，这没什么，因为Akinator不会一直为所有角色提供答案，尤其是新角色。</p><p id="fb8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们替换我们的<code class="du jp jq jr js b">index</code>函数来添加我们游戏的主要逻辑:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jj jk l"/></div></figure><p id="68d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望代码应该简单易懂。我们创建两个变量来保存目前游戏的状态:<code class="du jp jq jr js b">questions_so_far</code>和<code class="du jp jq jr js b">answers_so_far</code>，然后我们检查用户是否提交了HTML表单，并将他们的问题和答案添加到这些变量中。<code class="du jp jq jr js b">question</code>参数是用户正在回答的问题id，而<code class="du jp jq jr js b">answer</code>参数是一个介于0和1之间的浮点数，表示用户对答案为“是”的信心。</p><p id="6699" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们使用游戏的当前状态来计算所有角色的概率，这是我们接下来将看到的贝叶斯计算(我还添加了一个<code class="du jp jq jr js b">print</code>语句来跟踪每个答案后的变化)。然后我们检查是否还有问题，如果有，我们随机选择下一个问题问用户，如果没有，我们得到最大概率的角色并完成游戏，让玩家惊讶“Akinator怎么能读取我的想法？”</p><p id="94df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的<code class="du jp jq jr js b">calculate_probabilities</code>函数基本上只是一个为每个字符计算概率的循环:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jj jk l"/></div></figure><p id="4c58" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jp jq jr js b">calculate_character_probability</code>功能是Akinator的大脑真正生活的地方:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jj jk l"/></div></figure><p id="10dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于前面的<code class="du jp jq jr js b">P_character</code>，我们简单地用1除以字符数。也就是说，在完全不知道任何事情或者没有问你任何问题的情况下，你想到海绵宝宝的概率是33%。</p><p id="f1b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后计算<code class="du jp jq jr js b">P_answers_given_character</code>和<code class="du jp jq jr js b">P_answers_given_not_character</code>就比较复杂了。如果你回头看看上面的公式，你会发现我们需要乘以每个<em class="jx"> P(答案|字符)</em>，所以我们从1开始，循环每对问题和答案。</p><p id="de1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设我回答了问题“你的角色是黄色的吗？”我在检查全垒打的概率，所以<em class="jx"> P(yellow = 1|homer) </em>。为了计算，我们使用辅助函数<code class="du jp jq jr js b">character_answer</code>来看看荷马是黄色的概率是多少，是1，如果我们没有关于它的信息，我们将使用0.5，作为每个人的默认答案。</p><p id="f413" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，如果玩家对这个问题也回答了1，那就是匹配，我们为<em class="jx"> P(黄色= 1 |荷马)</em>返回1，如果用户回答了0，那么我们需要为<em class="jx"> P(黄色= 0 |荷马)</em>返回0。这就是小公式<em class="jx">1-ABS(answer-character _ answer)</em>为我们做的事情。最后，我们使用<code class="du jp jq jr js b">max</code>来避免乘法中出现0，因为0会使所有的概率无效，并且即使用户选择了一个错误的答案，也不会给字符选择概率的机会。</p><p id="20cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来对于<code class="du jp jq jr js b">P_answer_not_character</code>我们做的基本相同，但是对于所有其他字符，取一个平均值。</p><p id="1b3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们可以将变量相乘，根据公式得到<code class="du jp jq jr js b">P_answers</code>和<code class="du jp jq jr js b">P_character_given_answers</code>。</p><p id="7fb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们<a class="ae jd" href="https://www.xkcd.com/2059/" rel="noopener ugc nofollow" target="_blank">计算正确的话</a>我们的游戏应该会成功，而且Akinator会正确的预测我在想海绵宝宝</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ke"><img src="../Images/16640316d6823028a5a76303732f684c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BhkM2003s42YOFLBho8ERw.png"/></div></div></figure><p id="67d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样，我们可以用不到100行代码实现Akinator！</p><h1 id="b878" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">下一步是什么？</h1><p id="6caa" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">你可能已经注意到游戏中仍然缺少一些东西，我建议你试着把它们作为练习来实现:</p><ul class=""><li id="8b98" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">如果提问者真的对答案有把握，尽早停止提问</li><li id="0138" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">如果命名者弄错了，允许用户添加新字符，并保存他们的答案</li><li id="57e8" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">如果命名者答对了，强化人物的答案</li><li id="b0dd" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">允许用户添加新问题</li><li id="4221" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">使用数据库而不是内存来无限增加新的字符和问题</li><li id="7b35" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">不要随意选择问题，选择那些可以解开最大猜测的问题</li></ul><p id="3947" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另外，如果你对贝叶斯统计和概率编程感兴趣，这里有一些有趣的内容:</p><ul class=""><li id="0d91" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">Blogpost: <a class="ae jd" href="https://towardsdatascience.com/probability-concepts-explained-bayesian-inference-for-parameter-estimation-90e8930e5348" rel="noopener" target="_blank">概率概念讲解:参数估计的贝叶斯推断。</a></li><li id="dca4" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">书:<a class="ae jd" href="https://www.amazon.com/dp/B07HHBCR9G" rel="noopener ugc nofollow" target="_blank">用Python和PyMC3进行贝叶斯分析</a></li><li id="68c7" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">播客:<a class="ae jd" href="https://learnbayesstats.anvil.app/" rel="noopener ugc nofollow" target="_blank">学习贝叶斯统计</a></li></ul><p id="1977" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您阅读<br/>在twitter上关注我<a class="ae jd" href="https://twitter.com/_rchaves_" rel="noopener ugc nofollow" target="_blank"> @_rchaves_ </a></p></div></div>    
</body>
</html>