# ä½¿ç”¨ Numpy çš„å·ç§¯ç¥ç»ç½‘ç»œâ€”ç¬¬ 2 éƒ¨åˆ†

> åŸæ–‡ï¼š<https://medium.com/analytics-vidhya/convolutional-neural-networks-using-numpy-part-2-27bdd34a32a3?source=collection_archive---------14----------------------->

![](img/99b03b81a3934fb28862081bcaee6383.png)

# **åŠ¨æœº**

è¿™ç¯‡æ–‡ç« å±•ç¤ºäº†ä½¿ç”¨ numpy å®ç°å·ç§¯ç¥ç»ç½‘ç»œ(CNN)ã€‚æˆ‘æ—©äº›æ—¶å€™åœ¨[å†™è¿‡ä¸€ç¯‡ç±»ä¼¼çš„æ–‡ç« ](https://blog.lore.ai/convolutional-neural-networks-using-numpy-part-1/)ï¼Œä½†é‚£ç¯‡æ–‡ç« æ›´ä¾§é‡äºè§£é‡Šä»€ä¹ˆæ˜¯å·ç§¯ï¼Œç‰¹åˆ«æ˜¯ CNNï¼Œè€Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œé‡ç‚¹å°†æ›´å¤šåœ°æ”¾åœ¨*é€šè¿‡ä½¿ç”¨çŸ¢é‡åŒ–*åœ¨ numpy ä¸­æœ‰æ•ˆåœ°å®ç°å®ƒä»¬ã€‚

å€¼å¾—æŒ‡å‡ºçš„æ˜¯ï¼Œä¸ tensorflowã€pytorch ç­‰è½¯ä»¶åŒ…ç›¸æ¯”ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨ numpy åœ¨é€Ÿåº¦ä¸Šæ²¡æœ‰ä»»ä½•å¥½å¤„ã€‚äº‹å®ä¸Šï¼Œå¦‚æœåŒ…æ‹¬å¼€å‘æ—¶é—´ï¼Œå®ƒå¾ˆå¯èƒ½æ›´æ…¢ã€‚å¸–å­çš„æƒ³æ³•ä¸æ˜¯å®£ä¼  numpy å¯¹é€Ÿåº¦çš„ä½¿ç”¨ï¼Œè€Œæ˜¯åˆ†äº«ä½œè€…é‡å»ºè½®å­çš„ç»éªŒã€‚è™½ç„¶åŒæ ·çš„ä¸œè¥¿ç»å¸¸è¢«å˜²ç¬‘ï¼Œç”šè‡³è¢«å¦–é­”åŒ–ï¼Œä½†åªæœ‰æ”¹é€ å‡ ä¸ªè½®å­ï¼Œäººä»¬æ‰èƒ½å‘æ˜æ–°çš„æœºå™¨ã€‚æ›´ä¸ç”¨è¯´ï¼Œæœ‰æ—¶é‡å»ºè½¦è½®åªæ˜¯æ™®é€šçš„ä¹è¶£ï¼

æˆ‘ä»¬å°†åªå…³æ³¨å®ƒçš„ CNN éƒ¨åˆ†ï¼Œå…¶ä»–ç›¸å…³æ–¹é¢å¦‚æ¿€æ´»å‡½æ•°å’Œ maxpooling ç­‰å°†ä¸ä¼šåœ¨è¿™é‡Œè®¨è®ºï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥ä½œä¸ºä½œç”¨äº CNN å±‚è¾“å‡ºçš„ç‹¬ç«‹å±‚æ¥å®ç°ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ç¡®å®è®¨è®ºäº†å·ç§¯è¿‡ç¨‹å›ºæœ‰çš„å¡«å……å’Œæ­¥å¹…ã€‚

è¿™ç¯‡æ–‡ç« çš„ä»£ç å¯ä»¥åœ¨[èµ„æºåº“](https://github.com/borundev/DNN_Lectures)ä¸­æ‰¾åˆ°ï¼Œå¤§éƒ¨åˆ†ä»£ç åŒ…å«åœ¨æ–‡ä»¶ [CNN.py](https://github.com/borundev/DNN_Lectures/blob/master/Layers/CNN.py) ä¸­

å› ä¸ºè¿™ç¯‡æ–‡ç« çš„ç›®æ ‡æ˜¯å±•ç¤ºå¦‚ä½•åœ¨ numpy ä¸­é«˜æ•ˆåœ°å®ç° CNNï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šåœ¨è¿™ç¯‡æ–‡ç« ä¸­æä¾›æ‰€æœ‰ä»£ç ï¼Œè€Œæ˜¯è§£é‡Šç”¨å¤§é‡å¯è§†åŒ–å’Œç›¸å…³ä»£ç æ¥åšä»€ä¹ˆçš„æƒ³æ³•ã€‚å½“ç„¶ï¼Œæ‰€æœ‰ä»£ç éƒ½å¯ä»¥åœ¨å‰é¢æåˆ°çš„å­˜å‚¨åº“ä¸­æ‰¾åˆ°ã€‚

# å·ç§¯ç¥ç»ç½‘ç»œ

## å‰è¿›ä¼ çƒ

æˆ‘ä»¬å°†ä½¿ç”¨å¤šé€šé“å¤„ç†**äºŒç»´å›¾åƒã€‚å¯¹äºå®é™…å›¾åƒï¼Œå•è‰²å›¾åƒçš„é€šé“æ•°ä¸º 1ï¼Œå½©è‰²å›¾åƒçš„é€šé“æ•°ä¸º 3(ç®€ç§°ä¸ºçº¢/ç»¿/è“æˆ– RGB)ã€‚ç„¶è€Œï¼ŒCNN æœ¬èº«å¯ä»¥ä½œç”¨äºå‰ä¸€ä¸ª CNN çš„è¾“å‡ºï¼Œç„¶åé€šé“çš„å«ä¹‰æ˜¯å‰ä¸€å±‚çš„ä¸åŒæ»¤æ³¢å™¨çš„è¾“å‡ºï¼Œå› æ­¤é€šé“çš„æ•°é‡å¯ä»¥æ˜¯ä»»ä½•æ­£æ•´æ•°ã€‚ç„¶è€Œï¼Œåœ¨ä¸‹é¢çš„**ä¸­ï¼Œæˆ‘ä»¬å…·ä½“è®¨è®ºäº† 3 ä¸ªé€šé“ï¼ŒåŒæ—¶å°†å®ƒä»¬ç€è‰²ä¸º RGBï¼Œä»¥å¸®åŠ©å¯è§†åŒ–è¯¥è¿‡ç¨‹**ã€‚**

å·ç§¯å±‚å…·æœ‰ä½œä¸ºå¯å­¦ä¹ å‚æ•°çš„è¿‡æ»¤å™¨æƒé‡å’Œä¸¤ä¸ªè¶…å‚æ•°-æ­¥å¹…å’Œå¡«å……ã€‚è¿™äº›åœ¨ä¸‹é¢è¡¨ç¤ºä¸º

![](img/4e8c5a2682d94f10e4a1e26d0122de69.png)

é‡é‡ã€æ­¥å¹…å’Œè¡¬å«ã€‚å¯¹äºæƒé‡ï¼Œç¬¬ä¸€å’Œç¬¬äºŒç´¢å¼•ä»¥åŠå·ç§¯æ»¤æ³¢å™¨è¡Œå’Œåˆ—ä»¥åŠç¬¬ä¸‰å’Œç¬¬å››ç´¢å¼•æ ‡è¯†è¾“å…¥å’Œè¾“å‡ºé€šé“çš„æ»¤æ³¢å™¨ã€‚åŸåˆ™ä¸Šï¼Œå¯¹äºä¸åŒçš„æ–¹å‘ï¼Œæ­¥å¹…å’Œå¡«å……å¯ä»¥ä¸åŒï¼Œä½†æ˜¯ä¸ºäº†ç¬¦å·çš„ç®€å•ï¼Œæˆ‘ä»¬ä¿æŒå®ƒä»¬ç›¸åŒã€‚å­˜å‚¨åº“ä¸­çš„ä»£ç æ›´åŠ é€šç”¨ã€‚

å®ƒä»¬åˆ†åˆ«æ˜¯ä¸€ä¸ªå››ç»´å¼ é‡å’Œä¸¤ä¸ªæ ‡é‡ã€‚æƒé‡çš„å‰ä¸¤ä¸ªç»´åº¦åœ¨å·ç§¯æ»¤æ³¢å™¨çš„è¡Œå’Œåˆ—ä¸Šè¿è¡Œï¼Œè€Œç¬¬ä¸‰ä¸ªç»´åº¦åœ¨è¾“å…¥é€šé“ä¸Šè¿è¡Œï¼Œç¬¬å››ä¸ªç»´åº¦åœ¨è¾“å‡ºé€šé“ä¸Šè¿è¡Œã€‚æ³¨æ„ï¼Œå¯¹äºå›¾åƒçš„æ¯ä¸ªç»´åº¦ï¼Œæ­¥å¹…å’Œå¡«å……å¯ä»¥ä¸åŒï¼Œä½†æ˜¯ä¸ºäº†è¡¨ç¤ºç®€å•ï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢ä¿æŒå®ƒä»¬ç›¸åŒ(å°½ç®¡åœ¨å®é™…ä»£ç ä¸­å…è®¸ä¸åŒçš„å€¼)ã€‚

æˆ‘ä»¬å°†å·ç§¯å±‚çš„è¾“å…¥è¡¨ç¤ºä¸º

![](img/0583023e1d0d31c323f0a73bad369d1f.png)

CNN çš„è¾“å…¥ã€‚ç¬¬ä¸€ä¸ªç´¢å¼•æ˜¯ minibatch ç´¢å¼•ï¼Œç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªæ˜¯è¡Œå’Œåˆ—ï¼Œç¬¬å››ä¸ªæ˜¯é€šé“ã€‚

å…¶ä¸­ç´¢å¼•åˆ†åˆ«æ˜¯å°æ‰¹æ¬¡ã€è¡Œã€åˆ—å’Œé€šé“ã€‚è¾“å‡ºç±»ä¼¼åœ°è¡¨ç¤ºä¸º

![](img/865b3f6c87008110787eb584fbfff27b.png)

CNN çš„è¾“å‡ºã€‚ç´¢å¼•ä¸è¾“å…¥çš„æ„ä¹‰ç›¸åŒã€‚

ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œé™¤äº†å°æ‰¹é‡æŒ‡æ•°ä¹‹å¤–ï¼Œå…¶ä»–æŒ‡æ•°çš„èŒƒå›´å¯èƒ½ä¸è¾“å…¥æŒ‡æ•°çš„èŒƒå›´ä¸åŒã€‚è¿™æ„å‘³ç€è¾“å‡ºå›¾åƒå¤§å°å’Œé€šé“æ•°é‡å¯èƒ½ä¸åŒã€‚

**å¡«å……**çš„æ¦‚å¿µæ¥è‡ªäºå°†è¯¥å›¾åƒåµŒå…¥(å¯èƒ½)æ›´å¤§çš„ 0 å¡«å……æ•°ç»„ä¸­

![](img/939120c78dfea0027532fbaf5060517e.png)

è¾“å…¥å›¾åƒè¢«å¡«å……(å¦‚æœéœ€è¦)åœ¨ä¸€ä¸ªåœ¨è¡Œå’Œåˆ—æ–¹å‘è¾ƒå¤§çš„æ•°ç»„ä¸­ï¼Œå¹¶ä¸”è¢«é›¶å¡«å……ã€‚

å…¶ä¸­ *ğ‘ƒ* æ˜¯å¡«å……ã€‚**å·ç§¯**è¿ç®—å®šä¹‰ä¸º

![](img/e33c266a058e942fa577f1347b447328.png)

å·ç§¯è¿ç®—ã€‚æ±‚å’ŒæŒ‡æ•°è¦†ç›–å·ç§¯æ»¤æ³¢å™¨çš„æ•´ä¸ªå°ºå¯¸ã€‚

å…¶ä¸­ *ğ‘ * ä¸º**æ­¥è·**ã€‚

ä¸ºäº†ç†è§£ä¸Šé¢çš„å†…å®¹ï¼Œæˆ‘ä»¬é€šè¿‡æ‹æ‘„ä¸€ä¸ªå¤§å°ä¸º 6Ã—8 çš„â€œå›¾åƒâ€æ¥å¯è§†åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œè¯¥å›¾åƒæœ‰ä¸‰ä¸ªé€šé“ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­é¡ºåºåœ°å¡«å……å€¼ã€‚å› æ­¤ï¼Œçº¢è‰²é€šé“çš„ç¬¬ä¸€è¡Œä» 0 åˆ° 7ï¼Œç¬¬äºŒè¡Œä» 8 åˆ° 15ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°ç¬¬å…­è¡Œä¸Šå‡åˆ° 47ã€‚ç»¿è‰²é€šé“ä» 48 å¼€å§‹ï¼Œä»¥åŒæ ·çš„æ–¹å¼å¡«å……ã€‚

![](img/63a576dc261650e88018a792a694a157.png)

å›¾åƒæ˜¯ä¸‰ç»´é˜µåˆ—

åœ¨ä¸Šé¢æˆ‘ä»¬æ²¿ç€æ·±åº¦æ–¹å‘ç»˜åˆ¶äº†é€šé“ã€‚

æˆ‘ä»¬åˆ¶ä½œäº†ä¸€ä¸ªç»“æ„ç›¸åŒä½†å¤§å°ä¸åŒçš„â€œè¿‡æ»¤å™¨â€ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬é‡‡ç”¨ 5Ã—3 å°ºå¯¸çš„è¿‡æ»¤å™¨ã€‚*è¯·æ³¨æ„ï¼Œè™½ç„¶è¿™é‡Œæœ‰ä¸‰ä¸ªæ»¤æ³¢å™¨ï¼Œæ¯ä¸ªæ»¤æ³¢å™¨å¯¹åº”ä¸€ä¸ªè¾“å…¥é€šé“ï¼Œä½†è¿™ç»„æ»¤æ³¢å™¨åªä¼šäº§ç”Ÿä¸€ä¸ªè¾“å‡ºé€šé“ã€‚å¯¹äºè¾“å‡ºçš„æ¯ä¸ªé€šé“ï¼Œæˆ‘ä»¬éœ€è¦è¿™ä¸‰ä¸ªæ»¤æ³¢å™¨çš„å•ç‹¬å‰¯æœ¬*ã€‚

![](img/77e2b843dbf88c5ef928053c6745538a.png)

å·ç§¯æ»¤æ³¢å™¨æ˜¯ä¸€ä¸ªå››ç»´é˜µåˆ—ï¼Œè¿™é‡Œæ˜¾ç¤ºçš„æ˜¯å‰ä¸‰ä¸ªç»´åº¦ã€‚è¿™ä¸‰ä¸ªä¸å›¾åƒä¸€èµ·å°†åœ¨å·ç§¯ä¸Šäº§ç”Ÿå•ä¸ªé€šé“è¾“å‡ºã€‚å› æ­¤ï¼Œå¿…é¡»å¯¹è¾“å‡ºçš„æ¯ä¸ªé€šé“è¿›è¡Œä¸‹é¢è¯¦è¿°çš„æ“ä½œã€‚è¿™å¬èµ·æ¥æ¯”å®é™…å›°éš¾ï¼Œå› ä¸º numpy çŸ¢é‡åŒ–å¤„ç†äº†æ‰€æœ‰è¿™äº›é—®é¢˜ã€‚

ç°åœ¨æˆ‘ä»¬è€ƒè™‘çº¢è‰²æ»¤å…‰ç‰‡å¯¹çº¢è‰²é€šé“çš„å½±å“ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå†çœ‹ä¸€ä¸‹ä¸Šé¢çš„å·ç§¯è¡¨è¾¾å¼ï¼Œè¯•ç€ç†è§£å‘ç”Ÿäº†ä»€ä¹ˆã€‚

åœ¨ä¸‹å›¾çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨ y æ–¹å‘ä¸Šé‡‡ç”¨äº† 2 çš„**å¡«å……**,åœ¨ x æ–¹å‘ä¸Šé‡‡ç”¨äº† 1 çš„å¡«å……ã€‚è¿™æ„å‘³ç€åŸå§‹å›¾åƒåµŒå…¥åœ¨ä¸€ä¸ª 0 å¡«å……çš„æ•°ç»„çš„ä¸­å¿ƒï¼Œè¯¥æ•°ç»„åœ¨ y æ–¹å‘ä¸Šå¤§ 4 å€ï¼Œåœ¨ x æ–¹å‘ä¸Šå¤§ 2 å€ã€‚è¿™ç¡®ä¿äº†å·ç§¯çš„è¾“å‡ºä¸è¾“å…¥å¤§å°ç›¸åŒ(åœ¨æ²¡æœ‰æ­¥å¹…çš„æƒ…å†µä¸‹)ï¼Œä½†æˆ‘ä»¬ä¸å¿…è¿™æ ·åšã€‚å¡«å……å¯å¤§å¯å°ã€‚

![](img/a3c008a31be65f13cd0bbf23c9cb9612.png)

è¡¥é›¶çš„åŸå§‹çº¢è‰²é€šé“ä¸çº¢è‰²é€šé“æ»¤é•œçš„å·ç§¯ã€‚æ•¦ä¿ƒè¯»è€…éªŒè¯ä¸€äº›ç»“æœï¼Œä»¥ç¡®ä¿ä»–ä»¬ç†è§£ä»€ä¹ˆæ˜¯å·ç§¯è¿ç®—ã€‚

ç°åœ¨ï¼Œçœ‹çœ‹çº¢è‰²æ»¤é•œå¯¹(è¾ƒå¤§çš„åµŒå…¥)å›¾åƒéƒ¨åˆ†çš„å·ç§¯æ•ˆæœï¼Œè¯¥å›¾åƒä½äºä»(4ï¼Œ3)å¼€å§‹çš„æ¡†ä¸­ï¼Œå¤§å°ä¸ç”¨çº¯è“ç»˜åˆ¶çš„æ»¤é•œç›¸åŒã€‚çª—å£çš„æ¯ä¸ªå…ƒç´ ä¹˜ä»¥æ»¤æ³¢å™¨çš„ç›¸åº”å…ƒç´ ï¼Œç„¶åå°†ç»“æœç›¸åŠ ã€‚è¯·æ³¨æ„ï¼Œè¿™æ¶‰åŠä¸€è¡Œç”¨é›¶å¡«å……çš„å€¼ã€‚è¿™ä¸ªå’Œæ˜¯çº¢è‰²é€šé“å·ç§¯çš„ç¬¬(4ï¼Œ3)ä¸ªå…ƒç´ ã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰é›¶å¡«å……ï¼Œæˆ‘ä»¬ç”šè‡³ä¸èƒ½æœ‰è¿™ä¸ªæ¡ç›®ï¼Œå¹¶ä¸”è¾“å‡ºå°†è¢«é™åˆ¶ä¸ºæ¥è‡ªå®Œå…¨é€‚åˆåŸå§‹(éé›¶å¡«å……)å›¾åƒçš„å·ç§¯æ»¤æ³¢å™¨çš„é‚£äº›å€¼ã€‚

è®©æˆ‘ä»¬ä¹Ÿæ¥çœ‹çœ‹**å¤§æ­¥èµ°**ã€‚æ­¥å¹…çš„å½±å“å¯ä»¥ä»ç†è®ºè¡¨è¾¾å¼ä¸­çœ‹å‡ºã€‚é»˜è®¤æ­¥å¹…ä¸º 1ï¼Œå…¶ç»“æœå¦‚ä¸Šæ‰€ç¤ºã€‚ç„¶è€Œï¼Œä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬é€‰æ‹©æ­¥å¹…ä¸º 2ï¼Œé‚£ä¹ˆæ‰€ä½¿ç”¨çš„çª—å£å°†ç±»ä¼¼äºè“è‰²è™šçº¿çª—å£ï¼Œæˆ‘ä»¬çœ‹åˆ°å®ƒä»¬ä»¥æ­¥é•¿ 2 ç§»åŠ¨ã€‚

ä¸‰ä¸ªé€šé“çš„*ä¸€ä¸ªæ»¤æ³¢å™¨*çš„æœ€ç»ˆè¾“å‡ºé€šè¿‡å¯¹ä¸‰ä¸ªé€šé“çš„å·ç§¯æ±‚å’Œç»™å‡ºï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

![](img/3dcbae06fc2f35c344b672283ecd1482.png)

é€šè¿‡å¯¹æ¯ä¸ªè¾“å…¥é€šé“çš„å·ç§¯å€¼æ±‚å’Œï¼Œäº§ç”Ÿæœ€ç»ˆè¾“å‡ºã€‚å†æ¬¡æ³¨æ„ï¼Œè¿™æ˜¯å•ä¸ªè¾“å‡ºé€šé“ä¸Šçš„è¾“å‡ºã€‚å…¶ä»–ä¿¡é“çš„è¾“å‡ºä½¿ç”¨ç›¸åº”çš„å·ç§¯æƒé‡ç»„ç±»ä¼¼åœ°äº§ç”Ÿã€‚

## åå‘ä¼ æ’­

åœ¨åå‘ä¼ æ’­æœŸé—´ï¼Œå±‚**æ¥æ”¶æŸè€—ç›¸å¯¹äºæ­£å‘ä¼ é€’è¾“å‡ºçš„å¯¼æ•°ä½œä¸ºè¾“å…¥**ï¼Œå¹¶ä¸”**è¾“å‡ºæŸè€—ç›¸å¯¹äºæ­£å‘ä¼ é€’è¾“å…¥çš„å¯¼æ•°**ã€‚å¦‚æœæƒé‡æ˜¯å¯å­¦ä¹ çš„ï¼Œåˆ™åœ¨åå‘ä¼ æ’­æœŸé—´ï¼Œè¯¥å±‚è¿˜æ ¹æ®æƒé‡æ›´æ–°è§„åˆ™è°ƒæ•´æƒé‡ã€‚ä¸ºäº†**æƒé‡æ›´æ–°**ï¼Œéœ€è¦æŸå¤±ç›¸å¯¹äºæƒé‡çš„å¯¼æ•°ã€‚(*æ³¨æ„ï¼Œæˆ‘ä»¬éšå«åœ°åªè€ƒè™‘ä¾èµ–äºæŸå¤±çš„ä¸€é˜¶å¯¼æ•°çš„æ›´æ–°ï¼Œä½†æ˜¯è®¨è®ºå¯ä»¥ç›´æ¥æ¨å¹¿åˆ°ä½¿ç”¨é«˜é˜¶å¯¼æ•°è®¡ç®—åŠ¨é‡ç­‰çš„æ›´æ–°æ–¹æ³•ã€‚)*
æŸå¤±ç›¸å¯¹äºæƒé‡çš„å¯¼æ•°(ç†Ÿæ‚‰å¾®ç§¯åˆ†çš„äººå¯ä»¥å®¹æ˜“åœ°å¯¼å‡º)ç”±ä¸‹å¼ç»™å‡º

![](img/16b3164644dcc7216bb29f980eba4d31.png)

ä»æŸè€—ç›¸å¯¹äºè¾“å‡ºçš„åå¯¼æ•°è·å¾—æŸè€—ç›¸å¯¹äºæ»¤æ³¢å™¨çš„åå¯¼æ•°ã€‚

æŸè€—ç›¸å¯¹äºè¾“å…¥çš„å¯¼æ•°ç”±ä¸‹å¼ç»™å‡º

![](img/c41af1fc13d36a20975093f43b179031.png)

ä»æŸè€—ç›¸å¯¹äºè¾“å‡ºçš„åå¯¼æ•°è·å¾—æŸè€—ç›¸å¯¹äºè¾“å…¥çš„åå¯¼æ•°ã€‚

åœ¨å“ªé‡Œ

![](img/5cac56d439db97ed20d72550d1acfca6.png)

å¹¶ä¸” *ğ¾* æ˜¯è¿‡æ»¤å™¨å°ºå¯¸ã€‚æ‰€æœ‰è¿™äº›éƒ½å¯ä»¥ç”¨ç®€å•çš„ä»£æ•°å’Œå¾®ç§¯åˆ†çš„é“¾å¼æ³•åˆ™æ¥è®¡ç®—ã€‚

å¹¶ä¸” *ğ¾* æ˜¯è¿‡æ»¤å™¨å°ºå¯¸ã€‚æ‰€æœ‰è¿™äº›éƒ½å¯ä»¥ç”¨ç®€å•çš„ä»£æ•°å’Œå¾®ç§¯åˆ†çš„é“¾å¼æ³•åˆ™æ¥è®¡ç®—ã€‚

æˆ‘ä»¬è§‚å¯Ÿåˆ°ï¼ŒæŸè€—ç›¸å¯¹äºè¾“å…¥å±‚çš„å¯¼æ•°ä»…ä»…æ˜¯è¯¯å·®ç›¸å¯¹äºæŸè€—ç›¸å¯¹äºè¾“å‡ºçš„å¯¼æ•°çš„å·ç§¯ï¼Œå…¶ä¸­æ»¤æ³¢å™¨å…·æœ‰æ²¿å‰ä¸¤ä¸ªæ–¹å‘ç›¸åçš„æŠ˜å°„ç‡ã€‚

è¿™ä¸€è§‚å¯Ÿå‘Šè¯‰æˆ‘ä»¬ï¼Œæˆ‘ä»¬å¯ä»¥é‡å¤ä½¿ç”¨å·ç§¯ä»£ç ï¼Œä½†åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬ä»éœ€è¦å¤„ç†åŒ…å«æŸè€—å¯¹è¾“å‡ºçš„å¯¼æ•°çš„æ•°ç»„ã€‚æˆ‘ä»¬å¯ä»¥é¦–å…ˆå°†å…³äºè¾“å‡ºçš„é”™è¯¯åµŒå…¥åˆ°ä¸€ä¸ªæ•°ç»„ä¸­

![](img/740cfa20f24c113c532a7e74a46a88ba.png)

é›¶å¡«å……æŸè€—ç›¸å¯¹äºè¾“å‡ºçš„å¯¼æ•°

æ ¹æ®*ğ‘ƒ*â€”*ğ¾*+1 çš„ç¬¦å·ï¼Œz çš„ä¸€éƒ¨åˆ†è¢«åµŒå…¥åˆ°å³é›¶å¡«å……çš„æ•°ç»„ y ä¸­ï¼Œæˆ–è€… z è¢«åµŒå…¥åˆ°å·¦é›¶å¡«å……å’Œå³é›¶å¡«å……çš„æ•°ç»„ y ä¸­ã€‚è¿™ç§æ¨ç†ä¸å®¹æ˜“è§£é‡Šï¼Œæˆ‘å¿…é¡»åšçš„æ˜¯ä»”ç»†è€ƒè™‘å¡«å……å¤§å°çš„æ‰€æœ‰å¯èƒ½æ€§ï¼Œå¹¶æ‰¾å‡ºæ­£ç¡®çš„é€»è¾‘ã€‚å½“ç„¶ï¼Œå¡«å……å¤§å°è¶…è¿‡è¿‡æ»¤å™¨å¤§å°çš„ä¸€åŠä¼¼ä¹æ˜¯ä¸åˆç†çš„ï¼Œä½†æ˜¯å¿…é¡»è§£å†³é€»è¾‘é—®é¢˜ï¼Œä»¥ç¡®ä¿ä»£ç ä¸ä¼šä¸­æ–­ã€‚å¦‚æœè¯»è€…æ‰¾åˆ°ä¸€ä¸ªç®€å•çš„è§£é‡Šï¼Œæˆ‘ä¼šå¾ˆé«˜å…´æ”¶åˆ°åŒæ ·çš„è§£é‡Šå¹¶æ›´æ–°è¿™ç¯‡æ–‡ç« ã€‚è¿™éƒ¨åˆ†çš„ä»£ç å¦‚ä¸‹ã€‚

```
def _prepare_back(self,der_y):
    mb, n1, n2, _ = self.prev_layer.shape
    ch = der_y.shape[3]

    m1 = max(self.stride_1 * der_y.shape[1], n1)
    m2 = max(self.stride_2 * der_y.shape[2], n2)

    z = np.zeros(shape=(mb, m1, m2, ch))
    y = np.zeros(shape=(
    mb, m1 + self.filter_size_1 - 1, m2 + self.filter_size_2 - 1, ch))

    z[:,
    :self.stride_1 * der_y.shape[1]:self.stride_1,
    :self.stride_2 * der_y.shape[2]:self.stride_2
    ] = der_y

    p1_left = self.padding_1 + 1 - self.filter_size_1
    p2_left = self.padding_2 + 1 - self.filter_size_2

    # i1,i2 are the start positions in z and iy1,iy2 are the start
    # positions in y
    i1 = i2 = iy1 = iy2 = 0

    if p1_left > 0:
        i1 = p1_left
    else:
        iy1 = -p1_left

    if p2_left > 0:
        i2 = p2_left
    else:
        iy2 = -p2_left

    # size of array taken from x
    f1 = z.shape[1] - i1
    f2 = z.shape[2] - i2

    y[:,
    iy1:iy1 + f1,
    iy2:iy2 + f2
    ] = z[:, i1:, i2:, :]
    return y
```

æœ€åï¼Œæˆ‘ä»¬æœ‰

![](img/ca33a79163dda5d1488f188595eff2e9.png)

è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„å·ç§¯ã€‚

# ä¸€ç§é«˜æ•ˆçš„æ•°å­—å®ç°

è¿™ä¸€åˆ‡éƒ½å¾ˆå¥½ï¼Œä½†ä»¥ä¸Šè¿°æ–¹å¼å¤©çœŸåœ°å®æ–½ï¼Œè¿‡ç¨‹éå¸¸ç¼“æ…¢ã€‚è¿™æ˜¯å› ä¸ºæœ‰å‡ ä¸ªå¾ªç¯:

(I)åœ¨æ•´ä¸ªå£°é“ä¸Šç§»åŠ¨å£°é“ç‰¹å®šæ»¤æ³¢å™¨(å®é™…å·ç§¯)ï¼Œ
(ii)åœ¨è¾“å…¥å£°é“ä¸Šå¾ªç¯ï¼Œ
(iii)åœ¨è¾“å‡ºå£°é“ä¸Šå¾ªç¯ã€‚
(å››)åœ¨è¿·ä½ å§ä¸Šå¾ªç¯

å¦‚æœå®ç°å·§å¦™ï¼Œä»£ç ä¸ä»…å¯ä»¥ä½¿ç”¨ numpy çŸ¢é‡åŒ–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å·²ç»ç¼–å†™å¥½çš„å¯†é›†å±‚(æ‚¨å¯ä»¥åœ¨ä¸Šé¢æåˆ°çš„åº“ä¸­æ‰¾åˆ°å®ç°)ã€‚åœ¨æ€è€ƒå¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹æ—¶ï¼Œæˆ‘çœ‹åˆ°äº†è¥¿å°”ä¸‡Â·æ ¼é²æ ¼çš„ä¸€ä¸ªå¸–å­ï¼Œä»–åšäº†ä¸€äº›ç±»ä¼¼çš„äº‹æƒ…ï¼Œæˆ‘çš„æƒ³æ³•ä¹Ÿå—åˆ°äº†åŒæ ·çš„å¯å‘ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸¤ä¸ªä¸åŒä¹‹å¤„:

(I)å¯¹äºä»–çš„åˆ†æï¼Œé€šé“ç´¢å¼•æ˜¯ç¬¬äºŒä¸ªï¼Œç´§æ¥åœ¨ minibatch ä¹‹åï¼Œæ ‡å‡†å›¾åƒæ ¼å¼å°†å…¶ä½œä¸ºæœ€åä¸€ä¸ªï¼Œè¿™å°±æ˜¯æˆ‘å®ç°ä»£ç çš„æ–¹å¼

(ii)æˆ‘å¯¹åå‘ä¼ æ’­çš„å®ç°æ˜¯ä¸åŒçš„ã€‚è€å®è¯´ï¼Œæˆ‘ä¸èƒ½è·Ÿéšä»–çš„å®ç°ï¼Œæˆ‘(æ˜¾ç„¶)è®¤ä¸ºæˆ‘çš„æ›´å¹²å‡€ï¼Œä½†ä»–å¯èƒ½ä¸åŒæ„ã€‚æˆ‘å°†è®©è¯»è€…è‡ªå·±å†³å®šå“ªä¸ªæ›´å¥½ã€‚

è®©æˆ‘ä»¬å†æ¥çœ‹çœ‹å·ç§¯çš„è¡¨è¾¾å¼

![](img/8aacccc69cf99f5466c2f59c75209681.png)

æˆ‘ä»¬çœ‹åˆ°å¯ä»¥å°†æ»¤é•œ*çš„æŒ‡æ ‡ *ğ›¼* ã€ *ğ›½* ã€*ğ‘˜*ğ‘Š*æŠ˜å æˆä¸€ä¸ªæŒ‡æ ‡*ğœ‡*=*ğ›¼*âˆ«*ğ‘“*2âˆ«*ğ‘*+*t22âˆ«*åœ¨ numpy ä¸­ï¼Œè¿™å¯ä»¥ç®€å•åœ°é€šè¿‡**

```
W.reshape(-1,W.shape[-1])
```

æˆ‘ä»¬éœ€è¦ç›¸åº”åœ°å»ºç«‹ä¸€ä¸ªæ–°çš„å¼ é‡ï¼Œå®ƒçš„å…ƒç´ è¦ä¹˜ä»¥æ•´å½¢åçš„ğ‘Šçš„å…ƒç´ ã€‚å¯ä»¥è‚¯å®šçš„æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œè¾“å‡ºä¼šæœ‰å†—ä½™ï¼Œä½†å®ƒå°†å…è®¸åŠ é€Ÿï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œçœ‹çœ‹è¡¨è¾¾å¼

![](img/703b3333d1d7c8181c7876ca5b338700.png)

æˆ‘ä»¬çœ‹åˆ°ï¼Œå®ƒç°åœ¨åªæ˜¯ä¸€ä¸ªå¯†é›†å±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç›¸åŒçš„å‰å‘ä¼ é€’å’Œåå‘ä¼ æ’­è¿‡ç¨‹ä¸­çš„æƒé‡æ›´æ–°ã€‚å¯»æ‰¾æŸå¤±ç›¸å¯¹äº *ğ‘™* 0 çš„å¯¼æ•°çš„åå‘ä¼ æ’­æ˜¯æˆ‘ä»¬å°†å¾ˆå¿«è§£å†³çš„äº‹æƒ…ã€‚

ä»" tilde l0 "(æˆ‘å¸Œæœ› medium å…è®¸ MathJax)è·å–" bar l0 "çš„è¿‡ç¨‹éå¸¸ç®€å•ï¼Œä¸‹é¢ç»™å‡ºçš„ä»£ç å¾ˆå¥½åœ°è§£é‡Šäº†è¿™ä¸€è¿‡ç¨‹ã€‚ç„¶è€Œï¼Œè®©æˆ‘ä»¬é¦–å…ˆæƒ³è±¡æ­£åœ¨å‘ç”Ÿä»€ä¹ˆã€‚

![](img/b30b518754a8056443f655869f81ab5d.png)

åœ¨ä¸Šé¢çš„å›¾åƒä¸­ï¼Œè½¬æ¢çš„åŸå§‹å›¾åƒç”±é‡æ–°æ’åˆ—çš„é›¶å¡«å……å›¾åƒçš„å…ƒç´ ç»„æˆ(å¸¦æœ‰å‰¯æœ¬),å› æ­¤æ¯ä¸ªé¢æ¿(é¢æ¿åœ¨æ·±åº¦æ–¹å‘ä¸Šå¸ƒå±€)åŒ…å«æ‰€æœ‰è¦ä¹˜ä»¥å·ç§¯æ»¤æ³¢å™¨çš„ä¸€ä¸ªå…ƒç´ çš„å…ƒç´ ã€‚å·ç§¯æ»¤é•œæœ¬èº«åœ¨æ·±åº¦æ–¹å‘ä¸Šæ˜¯æ•£å¼€çš„(åœ¨ä¸Šé¢çš„å›¾åƒä¸­æˆ‘ä»¬ç§°ä¹‹ä¸ºæ‰å¹³æ»¤é•œ)ã€‚è¿™ä¸¤è€…ä¹˜ç§¯å¦‚ä¸‹æ‰€ç¤ºã€‚

![](img/f4d6d7eb4734a476ea8e7095c08ff32f.png)

å†æ¬¡æ˜¾ç¤ºè½¬æ¢å›¾åƒå’Œå¹³å¦åŒ–æ»¤æ³¢å™¨çš„ä¹˜ç§¯ï¼Œç„¶åæˆ‘ä»¬æ˜¾ç¤ºæ‰€æœ‰è¿™äº›é¢æ¿çš„æ€»å’Œã€‚äººä»¬å¯ä»¥è¯å®ç»“æœæ˜¯ç›¸åŒçš„ã€‚

ä¸‹é¢ç»™å‡ºäº†ä»é›¶å¡«å……å›¾åƒè·å¾—ä¸Šè¿°å˜æ¢å›¾åƒçš„ä»£ç ï¼Œè¿™æ˜¯æœ¬æ–‡çš„è¦ç‚¹ã€‚åŒæ ·ï¼Œä»£ç æ˜¯ CNN å±‚çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤å¼•ç”¨äº†â€œè‡ªæˆ‘â€,ä½†æ˜¯æ„æ€åº”è¯¥å¾ˆæ¸…æ¥šã€‚

```
def _take(self, y, stride=(1, 1)): stride_1, stride_2 = stride
    mb, en1, en2, ch = y.shape # Till we discuss the minibatch index, all comments are for the first
    # image # Make a 2d array of indices of the top-left edges of the windows
    # from which to take elements. These are to be the indices on the
    # first channel. This makes the indices the top-left-back end of the
    # cuboid to be taken
    s1 = np.arange(0, en1 - self.filter_size_1 + 1, stride_1)
    s2 = np.arange(0, en2 - self.filter_size_2 + 1, stride_2)
    start_idx = (s1[:, None] * en2 * ch + s2[None, :] * ch) # Make a grid of elements to be taken in the entire cuboid whose
    # top-left-back indices we have taken above. This is done only for
    # the first of the above cuboids in mind.
    # Note the cuboid elements are flattened and will now be along the
    # 4th direction of the output
    g1 = np.arange(self.filter_size_1)
    g2 = np.arange(self.filter_size_2)
    g3 = np.arange(ch)
    grid = (g1[:, None, None] * en2 * ch + g2[None, :, None] *
            ch + g3[None, None, :]).ravel() # Combine the above two to make a 3d array which corresponds to just
    # the first image in a minibatch.
    grid_to_take = start_idx[:, :, None] + grid[None, None, :] # Make and index for the starting entry in every image in a minibatch
    batch = np.array(range(0, mb)) * ch * en1 * en2 # This is the final result
    res = y.take(batch[:, None, None, None] + grid_to_take[None, :, :, :])
    return res
```

ç›¸åŒçš„ä»£ç å¯ç”¨äºæŸå¤±ç›¸å¯¹äºè¾“å‡ºçš„å‡†å¤‡å¥½çš„å¯¼æ•°(è§ä¸Šé¢çš„ä»£ç ),ä»¥ç»™å‡ºç›¸åº”çš„å˜æ¢ç‰ˆæœ¬æ¥æ‰§è¡Œåå‘ä¼ æ’­çš„å·ç§¯ã€‚

å‰©ä¸‹çš„ä»£ç éå¸¸ç®€å•ï¼Œå¯ä»¥åœ¨æœ¬æ–‡å¼€å¤´æåˆ°çš„èµ„æºåº“ä¸­æ‰¾åˆ°ã€‚