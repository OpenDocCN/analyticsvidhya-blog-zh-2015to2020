<html>
<head>
<title>A simple Selenium image scrape from an interactive Google Image Search on Mac.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个简单的Selenium图片来自Mac上的交互式Google图片搜索。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/a-simple-selenium-image-scrape-from-an-interactive-google-image-search-on-mac-45d403e60d9a?source=collection_archive---------9-----------------------#2020-08-25">https://medium.com/analytics-vidhya/a-simple-selenium-image-scrape-from-an-interactive-google-image-search-on-mac-45d403e60d9a?source=collection_archive---------9-----------------------#2020-08-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/4245fb71bd672a7a31d7c4e0d29c7679.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WhGAx4PDQmTDWhN2QCrIPg.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">照片由<a class="ae hv" href="https://www.pexels.com/@darshan394?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> <strong class="bd hw">提婆达尔山</strong> </a>发自<a class="ae hv" href="https://www.pexels.com/photo/aerial-photo-of-gray-concrete-road-938582/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> <strong class="bd hw">派克斯</strong> </a></figcaption></figure><div class=""/><p id="4bf9" class="pw-post-body-paragraph iw ix hz iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">最近，我在完成毕业于Flatiron数据科学项目的最后一个顶点项目时，遇到了一个挑战。对于顶点，我们被要求编译我们自己的数据集。我的项目是一个图像分类模型，所以我选择刮一些图像。我第一次尝试使用Beautiful Soup从谷歌图片搜索中抓取图片是错误的，因为我无法让抓取的图片向下滚动页面，它只会返回一小组10张图片，这远远低于我训练模型所需的数量。其他网站建议我研究硒。由于不熟悉它以及它是如何工作的，我发现自己在试图让Selenium为我所需要的工作时遇到了一些障碍。下面是我使用Selenium抓取图像的一些步骤，希望它也能给你一些解决方案。这是一种简单的方法，尽管有许多其他的用例以及方法来处理这种情况，而我的方法恰好是一种非常“简单”的方法。这是我的github链接，我在卫星图像分类项目中使用的图像刮刀代码笔记本:<a class="ae hv" href="https://github.com/alexanderbeat/riverdelta-satellite-image-classification" rel="noopener ugc nofollow" target="_blank">https://github . com/Alexander beat/river delta-satellite-image-class ification</a></p><h1 id="2ee9" class="ju jv hz bd hw jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">1.获取ChromeDriver。</h1><p id="d1f9" class="pw-post-body-paragraph iw ix hz iy b iz kr jb jc jd ks jf jg jh kt jj jk jl ku jn jo jp kv jr js jt hb bi translated">第一步是获得你当前运行的Chrome版本。转到Chrome设置，然后点击边栏底部的“关于Chrome”。它将显示您的当前版本。进入<a class="ae hv" href="https://chromedriver.chromium.org/downloads" rel="noopener ugc nofollow" target="_blank"> ChromeDriver </a>链接进行下载，这是运行Selenium所需要的。它会根据你当前的Chrome版本告诉你下载哪个版本。拉开拉链，得到chromedriver.exe。</p><figure class="kx ky kz la fd hk er es paragraph-image"><div class="er es kw"><img src="../Images/d85297e9532adf679d77c24a4ef8d990.png" data-original-src="https://miro.medium.com/v2/resize:fit:536/format:webp/1*U5hmA5PAhjzfhUKEOCQN2g.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">点按Chrome设置边栏中的“关于Chrome”按钮。</figcaption></figure><figure class="kx ky kz la fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lb"><img src="../Images/66768eb13429c03d0f82e7e900ca2bbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lS9D9ZFIwdzLNku6iFTMHQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">根据您的Chrome浏览器版本下载不同版本的Chromedriver。</figcaption></figure><h1 id="d909" class="ju jv hz bd hw jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">2.显示隐藏文件— usr/local/bin</h1><p id="fc9f" class="pw-post-body-paragraph iw ix hz iy b iz kr jb jc jd ks jf jg jh kt jj jk jl ku jn jo jp kv jr js jt hb bi translated">下载ChromeDriver后，你需要将它放在一个隐藏的文件夹中。在Finder窗口中显示隐藏文件夹的典型方式是键入Cmd + Shift +。(点)。我在一台装有El Capitan的09年旧Mac上运行这个程序，这样快捷方式就不起作用了，必须使用终端。打开“终端”,键入“默认写入com . apple . finder appleshowlfiles YES ”,然后按Enter键。</p><figure class="kx ky kz la fd hk er es paragraph-image"><div class="er es lc"><img src="../Images/af70dbbb0200c7ef216f76e28760f0de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*srmQALSWIY17N026CHjPpg.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">命令在终端窗口中的外观。</figcaption></figure><p id="4a19" class="pw-post-body-paragraph iw ix hz iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">这将允许隐藏文件出现在您的finder窗口中。如果他们没有出现，重新启动Finder，然后他们应该会出现。在Finder中，如果你点击你的启动驱动器，会有一个名为“usr”的隐藏文件夹。转到usr/local/bin，把ChromeDriver放在那里。</p><figure class="kx ky kz la fd hk er es paragraph-image"><div class="er es ld"><img src="../Images/45f51b5e46e9b05f1d38b6c468759c8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*1rLSM7yr_1cqvZsZEsf_RQ.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">启动驱动器中隐藏的usr文件夹。您的启动驱动器可能有不同的名称。</figcaption></figure><figure class="kx ky kz la fd hk er es paragraph-image"><div class="er es le"><img src="../Images/dcda9e8341ce5514d09a537e7845084f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*S9wpb5BU2OaueZHZJw_bdQ.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">usr中包含的本地文件夹。</figcaption></figure><p id="4296" class="pw-post-body-paragraph iw ix hz iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">之后，您可以通过在终端中键入“defaults write com . apple . finder AppleShowAllFiles NO”并按Enter键来再次隐藏隐藏的文件。隐藏文件不应再出现在Finder中。</p><figure class="kx ky kz la fd hk er es paragraph-image"><div class="er es lf"><img src="../Images/22446c55e048d9da79554645f89fa0a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*NrLKWgUVdfgtmx-LpFh-Aw.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">隐藏终端中显示的隐藏文件的命令。</figcaption></figure><h1 id="68b4" class="ju jv hz bd hw jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">3.在你的笔记本中使用硒。</h1><h2 id="2e03" class="lg jv hz bd hw lh li lj jz lk ll lm kd jh ln lo kh jl lp lq kl jp lr ls kp lt bi translated">设置和导入。</h2><p id="0feb" class="pw-post-body-paragraph iw ix hz iy b iz kr jb jc jd ks jf jg jh kt jj jk jl ku jn jo jp kv jr js jt hb bi translated">现在在Jupyter笔记本上，你可以pip安装selenium，导入webdriver，然后实例化它。</p><pre class="kx ky kz la fd lu lv lw lx aw ly bi"><span id="0167" class="lg jv hz lv b fi lz ma l mb mc">!pip install selenium</span><span id="9a72" class="lg jv hz lv b fi md ma l mb mc"><strong class="lv ia">from</strong> <strong class="lv ia">selenium</strong> <strong class="lv ia">import</strong> webdriver<br/><strong class="lv ia">import</strong> <strong class="lv ia">time</strong></span><span id="57a9" class="lg jv hz lv b fi md ma l mb mc"><em class="me">#instantiate the driver<br/></em>driver = webdriver.Chrome(‘chromedriver’)</span></pre><h2 id="d668" class="lg jv hz bd hw lh li lj jz lk ll lm kd jh ln lo kh jl lp lq kl jp lr ls kp lt bi translated">设置您的URL。</h2><p id="eb54" class="pw-post-body-paragraph iw ix hz iy b iz kr jb jc jd ks jf jg jh kt jj jk jl ku jn jo jp kv jr js jt hb bi translated">然后输入你要刮的网址。这将打开一个你的网址的Chrome窗口。</p><pre class="kx ky kz la fd lu lv lw lx aw ly bi"><span id="1bb0" class="lg jv hz lv b fi lz ma l mb mc">url = https://www.your_url.com</span><span id="502a" class="lg jv hz lv b fi md ma l mb mc">driver.get(url)</span></pre><h2 id="56eb" class="lg jv hz bd hw lh li lj jz lk ll lm kd jh ln lo kh jl lp lq kl jp lr ls kp lt bi translated">向下滚动页面。</h2><p id="c29a" class="pw-post-body-paragraph iw ix hz iy b iz kr jb jc jd ks jf jg jh kt jj jk jl ku jn jo jp kv jr js jt hb bi translated">然后，您将希望使用下面的代码让驱动程序交互式地向下滚动到页面的底部，以便您可以访问所有的图像。以前导入时间将允许您使用睡眠计数来加载页面。这里有几个关于这个主题的链接，我发现它们有助于让scrape发挥作用:</p><div class="hh hi ez fb hj mf"><a href="https://towardsdatascience.com/image-scraping-with-python-a96feda8af2d" rel="noopener follow" target="_blank"><div class="mg ab dw"><div class="mh ab mi cl cj mj"><h2 class="bd ia fi z dy mk ea eb ml ed ef hy bi translated">使用Python进行图像抓取</h2><div class="mm l"><h3 class="bd b fi z dy mk ea eb ml ed ef dx translated">学习如何用Python从Google下载图片的代码指南！</h3></div><div class="mn l"><p class="bd b fp z dy mk ea eb ml ed ef dx translated">towardsdatascience.com</p></div></div><div class="mo l"><div class="mp l mq mr ms mo mt hp mf"/></div></div></a></div><p id="a8ab" class="pw-post-body-paragraph iw ix hz iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated"><a class="ae hv" href="https://github.com/rmei97/shiba_vs_jindo/blob/master/image_scraper.ipynb" rel="noopener ugc nofollow" target="_blank"><em class="me">https://github . com/rmei 97/shiba _ vs _ jindo/blob/master/image _ scraper . ipynb</em></a><em class="me">。</em></p><pre class="kx ky kz la fd lu lv lw lx aw ly bi"><span id="d140" class="lg jv hz lv b fi lz ma l mb mc">page_scroll_sleep = 2<br/><br/>    <em class="me"># Get scroll height</em><br/>    last_height = driver.execute_script("return document.body.scrollHeight")<br/><br/>    <strong class="lv ia">while</strong> <strong class="lv ia">True</strong>:<br/>        <em class="me"># Scroll down to bottom</em><br/>        driver.execute_script("window.scrollTo(0, document.body.scrollHeight);")<br/><br/>        <em class="me"># Wait to load page</em><br/>        time.sleep(page_scroll_sleep)<br/><br/>        <em class="me"># Calculate new scroll height and compare with last scroll height</em><br/>        new_height = driver.execute_script("return document.body.scrollHeight")<br/><br/>        <strong class="lv ia">if</strong> new_height == last_height:<br/>        <em class="me">#break #insert press load more</em><br/>            <strong class="lv ia">try</strong>:<br/>                element = driver.find_elements_by_class_name('mye4qd') <em class="me">#returns list</em><br/>                element[0].click()<br/>            <strong class="lv ia">except</strong>:<br/>                <strong class="lv ia">break</strong><br/>        last_height = new_height</span></pre><p id="210e" class="pw-post-body-paragraph iw ix hz iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">类“mye4qd”用于页面底部出现的一个按钮，看起来就像下图所示。驱动程序代码将点击此按钮，以保持滚动到页面底部。</p><figure class="kx ky kz la fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mu"><img src="../Images/f1eaf6ff892f62f3ff668ea61eebd2be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UWjPQbXj0XMcwkCBrn3_3g.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">Inspect中显示的“显示更多结果”按钮的“mye4qd”类。</figcaption></figure><h2 id="8370" class="lg jv hz bd hw lh li lj jz lk ll lm kd jh ln lo kh jl lp lq kl jp lr ls kp lt bi translated">获取图像类对象。</h2><p id="4015" class="pw-post-body-paragraph iw ix hz iy b iz kr jb jc jd ks jf jg jh kt jj jk jl ku jn jo jp kv jr js jt hb bi translated">现在你已经滚动到了页面的底部，所有的图片都被加载了，这将会找到页面中所有的图片类。</p><pre class="kx ky kz la fd lu lv lw lx aw ly bi"><span id="5096" class="lg jv hz lv b fi lz ma l mb mc"><em class="me"># gets link list of images</em></span><span id="4101" class="lg jv hz lv b fi md ma l mb mc">image_links = driver.find_elements_by_class_name(‘rg_i.Q4LuWd’)</span></pre><h2 id="b518" class="lg jv hz bd hw lh li lj jz lk ll lm kd jh ln lo kh jl lp lq kl jp lr ls kp lt bi translated">从图像对象中提取图像链接。</h2><p id="f754" class="pw-post-body-paragraph iw ix hz iy b iz kr jb jc jd ks jf jg jh kt jj jk jl ku jn jo jp kv jr js jt hb bi translated">下面的这些循环将从上面创建的“image_links”变量中的每个图像类中提取实际的图像源链接。有时链接是“src”链接，有时是“数据-src”链接。它有助于通过右键单击搜索页面上的一个图像，然后单击“检查”来了解我的意思。这些循环将收集这两种类型，您可以将它们组合成一个您喜欢的列表，或者分别从它们中提取图像。</p><pre class="kx ky kz la fd lu lv lw lx aw ly bi"><span id="120a" class="lg jv hz lv b fi lz ma l mb mc">src_links = [image_links[i].get_attribute(‘src’) <strong class="lv ia">for</strong> i <strong class="lv ia">in</strong> range(len(image_links))]</span><span id="638d" class="lg jv hz lv b fi md ma l mb mc">data_src_links = [image_links[i].get_attribute(‘data-src’) <strong class="lv ia">for</strong> i <strong class="lv ia">in</strong> range(len(image_links))]</span></pre><figure class="kx ky kz la fd hk er es paragraph-image"><div class="er es mv"><img src="../Images/ce34036265e72adebe18d969d3021563.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*VGhsqmQO-xm1wYI06ihbLQ.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">右键单击图像，然后单击进行检查。</figcaption></figure><figure class="kx ky kz la fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mw"><img src="../Images/de7ead84adf62285b4af741b7f36ac98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sQYN8xBwqbBTtTsrZZbG2A.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">这将显示该特定映像的“src”链接。</figcaption></figure><h2 id="d0b4" class="lg jv hz bd hw lh li lj jz lk ll lm kd jh ln lo kh jl lp lq kl jp lr ls kp lt bi translated">用urllib保存图像。</h2><p id="6d0a" class="pw-post-body-paragraph iw ix hz iy b iz kr jb jc jd ks jf jg jh kt jj jk jl ku jn jo jp kv jr js jt hb bi translated">numpy的睡眠时间列表将在不同的时间间隔从你的链接列表中随机抓取每张图片，以避免被认为你是机器人的网站屏蔽。Urllib.request会将您的图像保存在您用于笔记本的当前工作目录中。Tqdm是一个基本的进度条，它会在页面迭代、抓取和保存图像时向您显示进度。</p><pre class="kx ky kz la fd lu lv lw lx aw ly bi"><span id="5a57" class="lg jv hz lv b fi lz ma l mb mc"><strong class="lv ia">import</strong> <strong class="lv ia">urllib.request</strong></span><span id="cb7e" class="lg jv hz lv b fi md ma l mb mc"><strong class="lv ia">import</strong> <strong class="lv ia">numpy</strong> <strong class="lv ia">as</strong> <strong class="lv ia">np</strong></span><span id="4a1c" class="lg jv hz lv b fi md ma l mb mc"><strong class="lv ia">from</strong> <strong class="lv ia">tqdm</strong> <strong class="lv ia">import</strong> tqdm</span><span id="e843" class="lg jv hz lv b fi md ma l mb mc">sleeps = [1,0.5,1.5,0.7]</span></pre><p id="45c8" class="pw-post-body-paragraph iw ix hz iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">f字符串将根据它在图片链接列表中的索引位置对你的图片进行编号，并且循环遍历包含你抓取的所有“src”和/或“数据-src”链接的名为“链接”的列表。最后，“driver.quit()”将关闭交互式Chrome窗口进程。</p><pre class="kx ky kz la fd lu lv lw lx aw ly bi"><span id="0c96" class="lg jv hz lv b fi lz ma l mb mc"><em class="me"># urllib save images into folder and renames using data_name string</em><br/>    <strong class="lv ia">for</strong> i,link <strong class="lv ia">in</strong> enumerate(tqdm(links)):<br/><br/>        name = data_name+f'<strong class="lv ia">{i}</strong>.jpeg'<br/><br/>        urllib.request.urlretrieve(link, name)<br/>        time.sleep(np.random.choice(sleeps))<br/>        <br/>    driver.quit()</span></pre><h1 id="e056" class="ju jv hz bd hw jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="9bf1" class="pw-post-body-paragraph iw ix hz iy b iz kr jb jc jd ks jf jg jh kt jj jk jl ku jn jo jp kv jr js jt hb bi translated">如果你以不道德的方式使用图像，抓取图像可能会很麻烦，所以我不建议你为了任何金钱利益或类似的活动而窃取图像。我只是展示这一点，作为一个例子，我能够获得一组用于教育学校项目的图像。请记住这一点，因为很多谷歌图片都有版权。</p></div></div>    
</body>
</html>