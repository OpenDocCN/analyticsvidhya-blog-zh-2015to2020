<html>
<head>
<title>How to make your own fully customizable Audio-Assistant with Python and Amazon Polly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Python 和 Amazon Polly 制作完全可定制的音频助理</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-make-your-own-fully-customizable-audio-assistant-with-python-and-amazon-polly-def49074d5e9?source=collection_archive---------5-----------------------#2020-12-25">https://medium.com/analytics-vidhya/how-to-make-your-own-fully-customizable-audio-assistant-with-python-and-amazon-polly-def49074d5e9?source=collection_archive---------5-----------------------#2020-12-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c81b7db54afedab34cae3b729a37e867.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TgLr2AWjvJjFQqX2"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">马库斯·温克勒在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="1b68" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你正开车从一个重要的约会赶往另一个约会(在目前的情况下，你可能更倾向于参加在线会议)，你需要为工作、运动和社交活动找到时间——你的时间是有限而宝贵的。理想情况下，您希望与您和您的企业相关的新闻和数据被自动收集起来，并在两次约会之间以简短的音频消息的形式读给您听:定制的、过滤的新闻——每天。</p><p id="60dd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我们将尝试使用 Python、web 抓取、简单的数学方程和 Amazon Polly 来解决这个问题。结果应该是一个完全自动化的助手，它每天在指定的时间准备并读出每日报告。</p><p id="f2b9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">一如既往，我的文章旨在教你项目中使用的工具的基础知识，并让你了解如何使用当前的技术创造性地解决问题。</em></p><h2 id="dc38" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">我们从哪里开始？我们需要什么？</h2><p id="350d" class="pw-post-body-paragraph iv iw hi ix b iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">该项目分为以下工作包:</p><p id="3fe0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">1.<strong class="ix hj">计划</strong> —我想在每日报告中听到什么？我在哪里可以获得这方面所需的信息？</p><p id="b154" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.<strong class="ix hj">代码</strong>——编写一个程序，获取需要的信息，做一些简单的功能，将信息打包成短信。</p><p id="776a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.<strong class="ix hj">亚马逊网络服务(AWS) —亚马逊 Polly </strong> —创建一个 AWS 账户，执行设置，在我们的代码中包含 Polly，并对我们的文本执行神经文本到语音转换(NTTS)。</p></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><h2 id="4a16" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">1.内容是什么，我们从哪里获得？</h2><p id="4291" class="pw-post-body-paragraph iv iw hi ix b iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">在这个项目中，我为自己设定了获取以下信息的目标:</p><ul class=""><li id="b233" class="lb lc hi ix b iy iz jc jd jg ld jk le jo lf js lg lh li lj bi translated">今天的日期和天气预报。</li><li id="08fa" class="lb lc hi ix b iy lk jc ll jg lm jk ln jo lo js lg lh li lj bi translated">比特币和 IOTA 的当前价格</li><li id="1028" class="lb lc hi ix b iy lk jc ll jg lm jk ln jo lo js lg lh li lj bi translated">比特币当前价格与特定购买价值的比率</li><li id="d505" class="lb lc hi ix b iy lk jc ll jg lm jk ln jo lo js lg lh li lj bi translated">对价格发展趋势的预测。(由于这部分内容会非常广泛，我会在下一篇文章《音频助手第二部分》中参考)。</li><li id="44f2" class="lb lc hi ix b iy lk jc ll jg lm jk ln jo lo js lg lh li lj bi translated">某些股票的表现</li><li id="f569" class="lb lc hi ix b iy lk jc ll jg lm jk ln jo lo js lg lh li lj bi translated">从个人选择的列表中随机引用</li></ul><p id="6d87" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当然，你可以按照自己喜欢的方式定制新闻，并使用同样的技术添加你从网上搜集到的任何信息。</p></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><p id="5fb9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">大部分信息都可以在网上找到，用 BeautifulSoup 搜集。为此，我们需要找到包含所需信息的网页，并在 HTML 丛林中奋力寻找我们想要的容器。为了不超出本文的范围，我不会详细讨论这个问题。然而，如果你不熟悉刮痧或美容，请看看我的上一篇文章:</p><div class="lp lq ez fb lr ls"><a rel="noopener follow" target="_blank" href="/analytics-vidhya/how-to-find-a-car-under-market-value-with-python-beautifulsoup-and-your-own-telegram-bot-c9d91e23c0d1"><div class="lt ab dw"><div class="lu ab lv cl cj lw"><h2 class="bd hj fi z dy lx ea eb ly ed ef hh bi translated">如何找到低于市场价值的汽车——使用 Python、BeautifulSoup 和您自己的 Telegram Bot。</h2><div class="lz l"><h3 class="bd b fi z dy lx ea eb ly ed ef dx translated">买车是一项需要深思熟虑的投资。但是，当你在竞争时，你如何找到一个好的报价…</h3></div><div class="ma l"><p class="bd b fp z dy lx ea eb ly ed ef dx translated">medium.com</p></div></div><div class="mb l"><div class="mc l md me mf mb mg io ls"/></div></div></a></div><p id="9e5a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，我通过展示一个例子来解释抓取的基本原理，这个例子展示了如何提取你正在寻找的信息，处理它，并设置一个电报机器人来发送自动警报消息。</p></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><p id="c83b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于这个项目，我们将使用 coindesk 网站拉比特币和 IOTA 价格。由于一次只有一个值，所以搜索相对简单。查找 HTML 代码，我们可以看到当前值在带有 span 标签的 div 容器“price-large”中。</p><figure class="mi mj mk ml fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/5dcb7e1100bc7ffff03c7cd903f9ca22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bQx_4gH2bxYXBiaBT-NOSA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">比特币 HTML-容器</figcaption></figure><p id="de2b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于天气，我使用网站 wetter.de，同样可以很快发现 div 容器“weather-daybox-minMax”包含两个对象:当天的最高温度和最低温度。为了获得特斯拉股票的当前价格，我使用了 marketwatch 网站。</p><h2 id="29f6" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">2.让我们开始编码吧</h2><p id="4c15" class="pw-post-body-paragraph iv iw hi ix b iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">我们的代码主要包括清理收集的数据，做一些简单的计算，创建一个报价列表，一个随机的报价输出，然后将所有信息保存在一个文本中。然后我们嵌入 Amazon Polly，让她朗读我们的文本。首先，我们加载所需的库，我们需要。要使用 Amazon Polly，我们需要从 AWS 服务加载 Boto3 库。</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="3cf0" class="ju jv hi mn b fi mr ms l mt mu">import requests<br/>from bs4 import BeautifulSoup<br/>from requests import get<br/>import pandas as pd<br/>import decimal<br/>import itertools<br/>import schedule<br/>import time<br/>import random<br/>from time import sleep<br/>from datetime import datetime<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>from datetime import date<br/>import boto3</span></pre><p id="2a1a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了清理数据(温度、比特币、IOTA、股票价格)，我们再次使用 join、isdigit 和 filter 函数。然后我们把对象转换成整数。这样，原始数据就可以使用了。</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="c3c7" class="ju jv hi mn b fi mr ms l mt mu">price = ''.join(filter(lambda i: i.isdigit(), price))<br/>price = int(price)</span></pre><p id="fd3c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">天气和日期:</strong>为了获得当前日期，我们从“datetime”中导入了“date”。使用函数 date.today()我们可以获得当前日期。用名称%B 我们可以得到月份，用%d 可以得到当天的数字。此选项在音频文件中最有意义。我把关于温度和日期的信息结合成一句话:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="59eb" class="ju jv hi mn b fi mr ms l mt mu">d = date.today()<br/>date = d.strftime("%B %d")<br/>print("date =", date)<br/>dateweather = "Hello Alexander, today is " + date +" and the maximum temperature is "+ temperature +"° celsius."</span></pre><p id="dbc8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">输出如下所示:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="88fb" class="ju jv hi mn b fi mr ms l mt mu">date = December 23<br/>Hello Alexander, today is December 23 and the maximum temperature is 18° celsius.</span></pre><p id="6997" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> Crypto: </strong>为了自动给出我们盈利或亏损的信息，我们首先输入一个“购买”值，我们(理论上)购买了硬币，并执行一些简单的计算。假设我们花 17.000 美元买了一个比特币，想知道盈亏情况:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="2cbe" class="ju jv hi mn b fi mr ms l mt mu">CurrentStr = str(Current)<br/>Bought=17000<br/>BoughtStr = str(Bought)<br/>Ratio = Bought/Current<br/>Difference = Current-Bought<br/>DifferenceStr = str(Difference)<br/>IotaStr=str(IOTA_value)<br/>if Difference &gt; 0:<br/><br/>    BitcoinText = "The bitcoin price today is " + CurrentStr + ", which     means you have made a profit of " + DifferenceStr<br/>else:<br/>    Difference = Bought-Current<br/>    DifferenceStr = str(Difference)<br/>    BitcoinText = "The bitcoin price today is" + CurrentStr + ". As of today you have made a loss of " + DifferenceStr<br/><br/>IOTA_Text = "The current price for IOTA is " + IotaStr + "dollars."<br/>crypto = BitcoinText + IOTA_Text</span></pre><figure class="mi mj mk ml fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mv"><img src="../Images/b2612d8fb699a99823adfe5dd8810572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ysC1Q_1djY9fSD83"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://unsplash.com/@gillyberlin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">吉利</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="e2ef" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">语录:</strong>现在我们创建一个有趣语录列表，每天从列表中随机抽取一段语录发送给我们。创建列表:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="d1d1" class="ju jv hi mn b fi mr ms l mt mu">quote_list =["InsertQuote1Here","InsertQuote2Here","InsertQuote3Here"]<br/>#insert as many quotes in the list as you like</span></pre><p id="b00f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我为此收集了十句名言，并把它们列在这个列表上。要获得随机报价，我们可以使用 random.choice 函数。为此，我们一开始就导入了‘Random’库。</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="d2b1" class="ju jv hi mn b fi mr ms l mt mu">random_quote = random.choice(quote_list)</span></pre><p id="9960" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">将所有零件放在一起:</strong></p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="a2af" class="ju jv hi mn b fi mr ms l mt mu">finaltext = dateweather + crypto + stock + random_quote</span></pre><h2 id="1ac8" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">3.文本到语音</h2><p id="cb13" class="pw-post-body-paragraph iv iw hi ix b iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">现在有趣的部分来了。在神经文本到语音的帮助下，我们将文本变得栩栩如生。Amazon Polly 支持某些 SSML 标签，以便在文本中进行更精确的设置。为此有许多标签。可以在<a class="ae iu" href="https://docs.aws.amazon.com/de_de/polly/latest/dg/supportedtags.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到它们的概述。</p><p id="0d3f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于这个短消息，我们可以使用标签<break>和<p>在消息之间添加逻辑中断。不过也有很多有趣的标签，比如轻声说话或者耳语<effect name="”whispered”">。另一个有趣的功能是强调，当某个单词应该被强调时——使用标签<em class="jt"> &lt;强调&gt;。</em></effect></p></break></p><figure class="mi mj mk ml fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mw"><img src="../Images/6696543104c48215287e0d790dd9deb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DAkaSdcsGJy_cY9hPM0Vwg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">一些 SSML 标签的概述</figcaption></figure></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><p id="8b76" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了让 Polly 运行起来，我们首先需要创建一个免费的 AWS Amazon 帐户。这包括许多免费功能和许多服务的有限使用。亚马逊 Polly 每个字符的成本:标准 TTS 版本为 100 万个字符(大约 23 小时的音频)支付 4 美元，神经 TTS 版本(听起来不那么机器人化)为 100 万个字符支付 16 美元。然而，前 12 个月是完全免费的，最多 100 万字的配额。</p><p id="958a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建 AWS 帐户后，我们需要创建我们的 AWS 凭据。为此，我们转到 AWS 服务中的“IAM”。在“用户”选项卡中，我们可以创建一个新用户。在接下来的创建步骤中，我们为其提供“编程访问”并分配所需的权限。为此，我们转到“直接附加现有策略”并选择“AmazonPollyFullAccess”。一旦创建了用户，保存“访问密钥 ID”和“秘密访问密钥”是很重要的，因为我们将在设置时立即需要它们。</p><figure class="mi mj mk ml fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/1046f66a9870813207d5dc67af1a81cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uPI0OaslbiPeDpAmIgftEg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">授予此用户完全 Polly 访问权限</figcaption></figure><p id="74b8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，我们安装 Amazon CLI——这是一个用作 AWS 命令行接口的工具。你可以在这里下载 CLI。安装完成后，我们可以通过命令提示符或终端输入命令“aws configure”来输入我们的用户。在这里，我们输入刚刚创建的 AWS 访问密钥 ID 和 AWS 秘密访问密钥，选择一个地区(例如 us-east-2)。<em class="jt">旁注:你可以使用命令“aws 帮助”来显示帮助页面。</em></p><p id="e20e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就完成了设置，我们可以继续代码。一开始，我们已经导入了 Boto3 库来使用该服务。现在我们只需要输入我们想使用的服务，我们的输入文本，输出格式，我们选择的声音，以及我们想使用标准版本还是神经版本。最后一部分是保存音频文件。</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="9669" class="ju jv hi mn b fi mr ms l mt mu">polly = boto3.client('polly')<br/>spoken_text = polly.synthesize_speech(Text=finaltext,<br/>                                      OutputFormat='mp3',<br/>                                      VoiceId='Joanna',<br/>                                      Engine='neural')<br/>with open('news2.mp3', 'wb') as daily:<br/>    daily.write(spoken_text['AudioStream'].read())<br/>    daily.close()</span></pre></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><p id="7676" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当我们运行该程序时，所有的数据将被收集、准备并创建音频文件。你现在如何处理这个文件取决于你自己。你可以在家里或路上在笔记本上播放，或者再写几行代码，通过电报机器人自动将音频文件发送给你。</p><p id="22ca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我已经在 soundcloud 上传了今天新闻的最终结果:</p><figure class="mi mj mk ml fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure></div></div>    
</body>
</html>