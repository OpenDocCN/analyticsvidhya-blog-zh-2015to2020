<html>
<head>
<title>Python — SQLAlchamy — PyMySql</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python — SQLAlchamy — PyMySql</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/python-sqlalchamy-pymysql-253c6fa0213f?source=collection_archive---------4-----------------------#2020-10-25">https://medium.com/analytics-vidhya/python-sqlalchamy-pymysql-253c6fa0213f?source=collection_archive---------4-----------------------#2020-10-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2d8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SQLAlchemy支持使用方言/引擎的多个数据库客户机</p><p id="600f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">支持方言的完整列表<a class="ae jd" href="https://docs.sqlalchemy.org/en/13/dialects/" rel="noopener ugc nofollow" target="_blank">点击此处</a></p><p id="197f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du je jf jg jh b">create_engine</code>接受数据源名称(dsn)作为参数</p><h1 id="1c9c" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">dsn的组成部分</h1><p id="1828" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated"><code class="du je jf jg jh b">scheme://username:password@host/database?params</code></p><p id="c5da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于我们使用的MySQL方案是<code class="du je jf jg jh b">mysql</code></p><p id="6a9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:- </strong>在我们的例子中，主机是<code class="du je jf jg jh b">mysql</code>，因为它运行在docker中，通常是127.0.0.1或localhost</p><p id="38f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kl">engine = create _ engine(' MySQL+pymysql://root:password @ MySQL/stack overflow _ survey _ 1 ')</em></p><h1 id="3cc0" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">获得连接</h1><p id="3987" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">conn = engine.connect()</p><h1 id="217d" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">将示例查询转换为数据框架</h1><p id="8e0e" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">我们可以使用熊猫<code class="du je jf jg jh b">read_sql</code>函数将结果直接转换成数据帧，它接受2个强制参数</p><ol class=""><li id="b7dd" class="km kn hi ih b ii ij im in iq ko iu kp iy kq jc kr ks kt ku bi translated">询问</li><li id="5faa" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">数据库连接对象</li></ol><pre class="la lb lc ld fd le jh lf lg aw lh bi"><span id="d3f7" class="li jj hi jh b fi lj lk l ll lm">query <strong class="jh hj">=</strong> 'SELECT * FROM responses limit 5;';</span><span id="ad28" class="li jj hi jh b fi ln lk l ll lm">pd.read_sql(query, conn,index_col<strong class="jh hj">=</strong>'id')</span></pre><h1 id="13f3" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">ORM</h1><p id="cb03" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">对象关系映射是一种使用面向对象编程语言在不兼容类型系统之间转换数据的技术。</p><p id="79d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在数据库管理系统中，它将查询结果转换成对象</p><p id="7c57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SQLAlchemy支持开箱即用的ORM</p><h1 id="b9d2" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">资料组</h1><p id="7a2c" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">我们使用2018年至2020年堆栈溢出调查的数据集。</p><h1 id="b004" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">数据库模式</h1><figure class="la lb lc ld fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lo"><img src="../Images/3f0d34736c42ae516e1b4189a47b0ae1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cW34Ca8ogyBrGfWBLKf-2A.png"/></div></div></figure><h1 id="e434" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">将架构转换为ORM</h1><blockquote class="lw lx ly"><p id="cfe1" class="if ig kl ih b ii ij ik il im in io ip lz ir is it ma iv iw ix mb iz ja jb jc hb bi translated"><em class="hi">Base = declarative _ Base()<br/>Base . metadata . bind = engine<br/>Base . metadata . create _ all()<br/>Session = Session maker(bind = engine)<br/>ses = Session()</em></p></blockquote><p id="4277" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在python中创建的用于访问模式的类</p><blockquote class="lw lx ly"><p id="72f6" class="if ig kl ih b ii ij ik il im in io ip lz ir is it ma iv iw ix mb iz ja jb jc hb bi translated"><em class="hi"> ##响应表<br/>类响应(基本):<br/>_ _ tablename _ _ = " Responses "<br/>_ _ table _ args _ _ = { ' extend _ existing ':True }</em></p><p id="4d4a" class="if ig kl ih b ii ij ik il im in io ip lz ir is it ma iv iw ix mb iz ja jb jc hb bi translated"><em class="hi"> Id = Column(Integer，primary _ key = True)<br/>Age = Column(Integer)<br/>Hobbyist = Column(Boolean)<br/>Country = Column(String)<br/>Gender = Column(String)<br/>Education = Column(String)<br/>Employment = Column(String)<br/>years code = Column(Integer)<br/>YearsCode pro = Column(Integer)<br/>CreatedAt = Column(DateTime)<br/>update dat = Column(dat</em></p></blockquote><p id="62af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">在不编写查询的情况下获取5条记录的示例查询</strong></p><blockquote class="lw lx ly"><p id="7a99" class="if ig kl ih b ii ij ik il im in io ip lz ir is it ma iv iw ix mb iz ja jb jc hb bi translated"><em class="hi"> query = ses.query(Response)。limit(5) <br/> print("query:"，query，" \ n \ n ")<br/>for response in query . all():<br/>print(response。Id，回复。年龄，反应。爱好者，回应。国家，回应。性别)</em></p></blockquote><p id="4935" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">这会自己创建查询，并在我们打印时从数据库返回数据</strong></p><pre class="la lb lc ld fd le jh lf lg aw lh bi"><span id="5e82" class="li jj hi jh b fi lj lk l ll lm">query :  SELECT responses.`Id` AS `responses_Id`, responses.`Age` AS `responses_Age`, responses.`Hobbyist` AS `responses_Hobbyist`, responses.`Country` AS `responses_Country`, responses.`Gender` AS `responses_Gender`, responses.`Education` AS `responses_Education`, responses.`Employment` AS `responses_Employment`, responses.`YearsCode` AS `responses_YearsCode`, responses.`YearsCodePro` AS `responses_YearsCodePro`, responses.`CreatedAt` AS `responses_CreatedAt`, responses.`UpdatedAt` AS `responses_UpdatedAt` <br/>FROM responses <br/> LIMIT %(param_1)s <br/><br/><br/>1 None True germany male<br/>2 None False united kingdom none<br/>3 None True russian federation none<br/>4 25 True albania male<br/>5 31 True united states male</span></pre><p id="5340" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">选择国家/地区，按国家/地区分组计数，按计数顺序取前5个结果</strong></p><blockquote class="lw lx ly"><p id="1adb" class="if ig kl ih b ii ij ik il im in io ip lz ir is it ma iv iw ix mb iz ja jb jc hb bi translated"><em class="hi"> query = ses.query(响应。Country，func . count(" * ")\<br/>。group_by(响应。国家)\ <br/>。order_by(func.count('* ')。desc())。限制(5) <br/> print("query:"，query，" \ n \ n ")<br/>for RES in query . all():<br/>print(RES)</em></p></blockquote><p id="6d1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">这会自己创建查询，并在我们打印时从数据库返回数据</strong></p><pre class="la lb lc ld fd le jh lf lg aw lh bi"><span id="9c14" class="li jj hi jh b fi lj lk l ll lm">query :  SELECT responses.`Country` AS `responses_Country`, count(%(count_2)s) AS count_1 <br/>FROM responses GROUP BY responses.`Country` ORDER BY count(%(count_3)s) DESC <br/> LIMIT %(param_1)s <br/><br/><br/>('united states', 53727)<br/>('india', 31185)<br/>('germany', 16215)<br/>('united kingdom', 15854)<br/>('canada', 8979)<br/></span></pre><p id="5c1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以用orm做更多的事情，比如定义关系和自动获取关系等等。</p><p id="923f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在数据科学中，因为我们需要使用复杂的查询，所以ORM可能不是非常有用</p><h1 id="3da8" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">使用ORM的优势</h1><ol class=""><li id="e1f5" class="km kn hi ih b ii kg im kh iq mc iu md iy me jc kr ks kt ku bi translated">它是数据库不可知的，为支持的方言提供编程接口。</li><li id="58a7" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">它防止SQL注入</li><li id="46f8" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">易于可视化和维护代码</li></ol><h1 id="da26" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">不足之处</h1><ol class=""><li id="7bf4" class="km kn hi ih b ii kg im kh iq mc iu md iy me jc kr ks kt ku bi translated">相对来说，它比原始SQL要慢</li><li id="1d8d" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">难以编写复杂的查询</li><li id="8822" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">需要为一些聚合和分析函数编写原始SQL</li></ol></div></div>    
</body>
</html>