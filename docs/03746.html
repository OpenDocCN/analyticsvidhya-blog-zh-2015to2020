<html>
<head>
<title>How does Prophet work? Part-1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">先知是如何工作的？第一部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-does-prophet-work-44addaab6148?source=collection_archive---------1-----------------------#2020-02-17">https://medium.com/analytics-vidhya/how-does-prophet-work-44addaab6148?source=collection_archive---------1-----------------------#2020-02-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/175119f23199bad627c0bd1760c9f89c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WkED3Veot7OiWTJoBEWgaw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">使用Fbprophet进行预测</figcaption></figure><p id="1a0e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，每当我们想到实现时间序列建模时，我们脑海中首先出现的几个库是——回归、ARIMA或先知。但是我们知道在这些算法的背景下发生了什么吗？我们如何进一步调整它们，使其适用于我们的时间序列数据集—</p><p id="3ddb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">预言者预测模型——它是一个加性回归模型</p><p id="56ee" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这个模型的方程式是—</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es js"><img src="../Images/662ebc2bc6a0cec308b82e75f0c4a3a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*Oe2mGHiiwDMmRcBlbvS39Q.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">预言者预测模型方程</figcaption></figure><p id="428f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们稍微深入了解一下这些组件—</p><p id="1dbe" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这篇文章中，我将重点关注趋势因子的调整。在我的下一篇文章中，我将分享如何调整先知的季节性和其他T2成分。</p><blockquote class="jy jz ka"><p id="cfa6" class="iu iv kb iw b ix iy iz ja jb jc jd je kc jg jh ji kd jk jl jm ke jo jp jq jr hb bi translated"><strong class="iw hj"> g(t) —趋势因子—它实现了两种可能的趋势模型</strong></p></blockquote><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es kf"><img src="../Images/86e540e15880f977b14c3438b1a4f028.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*D0CR1LmqtjKtEAugs_Iu9g.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">趋势因子可以使用这些模型进行调整</figcaption></figure><p id="bea0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> <em class="kb"> a) </em>逻辑增长模型<em class="kb"> — </em> </strong>它处理的是饱和的非线性增长<em class="kb">(你可能会好奇它现在是什么意思？哦..迷茫？？)</em>让我们明白——</p><p id="e278" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">饱和状态下的非线性增长—增长的初始阶段近似为指数增长(几何增长)，随着饱和状态的开始，增长速度减慢为线性增长(算术增长)，到了成熟期，增长停止。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es kg"><img src="../Images/26596d2e700650e654de9f2825d1175e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*gcKfLuupziw8ZZTs62tNPA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">饱和的逻辑增长(摘自solla price 1963)</figcaption></figure><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es kh"><img src="../Images/aff8b32423918a108ea12ca110dd6de1.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/format:webp/1*vwe1owN2s3CnJEj16SgVNQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">逻辑增长模型</figcaption></figure><p id="902e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">x0-sigmoid点的X值</p><p id="9b71" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">L —曲线的最大值</p><p id="950d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">k——逻辑增长率或曲线的陡度</p><pre class="jt ju jv jw fd ki kj kk kl aw km bi"><span id="42fa" class="kn ko hi kj b fi kp kq l kr ks"><strong class="kj hj">m = Prophet(growth='logistic')<br/>m.fit(df)</strong></span></pre><blockquote class="jy jz ka"><p id="d26f" class="iu iv kb iw b ix iy iz ja jb jc jd je kc jg jh ji kd jk jl jm ke jo jp jq jr hb bi translated"><strong class="iw hj"> <em class="hi"> b)分段线性模型— </em> </strong>这是线性模型的一个简单修改，然而非常有用。不同的𝑥范围，出现不同的线性关系单一的线性模型可能无法提供充分的解释或描述断点是斜率变化处的𝑥值断点的值在分析前可能已知也可能未知，未知时必须进行估计</p><p id="239e" class="iu iv kb iw b ix iy iz ja jb jc jd je kc jg jh ji kd jk jl jm ke jo jp jq jr hb bi translated">默认情况下，Prophet使用线性增长模型。—恒定增长率—最适合无饱和增长的情况。</p></blockquote><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es kt"><img src="../Images/ae2924776e11b7d8e1b7e2c96c9f0093.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*MNjgBtsASahdL_AXjfsopg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">分段线性模型</figcaption></figure><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es ku"><img src="../Images/c7fd6f565385495fa750c6f4d2f8f6c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*qfyt2dxN09ZCIYEKGODmYg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">分段线性模型</figcaption></figure><p id="bad1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">𝑐是断点的值</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/59187cd434243daeba6d95d77ef0288c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7VmMVew0jw1I7bTL-5qkIA.png"/></div></div></figure><p id="52ee" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们可以通过设置断点(也称为变点)和总上限(即市场规模或容量值)来调整我们的prophet模型中的这些参数(趋势成分)——必须为数据框中的每一行指定，并且不必是常数。如果市场规模在增长，那么上限可能是一个递增序列。</p><pre class="jt ju jv jw fd ki kj kk kl aw km bi"><span id="37d1" class="kn ko hi kj b fi kp kq l kr ks"><strong class="kj hj"># Python<br/>future = m.make_future_dataframe(periods=1826)<br/>future['cap'] = 8.5<br/>fcst = m.predict(future)<br/>fig = m.plot(fcst)<br/></strong></span></pre><p id="ba88" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">像CAP一样，我们也有饱和最小值(称为下限)。</p><pre class="jt ju jv jw fd ki kj kk kl aw km bi"><span id="101a" class="kn ko hi kj b fi kp kq l kr ks"><strong class="kj hj"># Python<br/>df['y'] = 10 - df['y']<br/>df['cap'] = 6<br/>df['floor'] = 1.5<br/>future['cap'] = 6<br/>future['floor'] = 1.5<br/>m = Prophet(growth='logistic')<br/>m.fit(df)<br/>fcst = m.predict(future)<br/>fig = m.plot(fcst)</strong></span></pre><p id="95fa" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">该库本身可以通过拟合历史数据来选择趋势变化的最佳点。</p><p id="360e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你想手动调整它们——你可以参考<a class="ae jx" href="https://facebook.github.io/prophet/docs/trend_changepoints.html" rel="noopener ugc nofollow" target="_blank">这里</a> —</p><blockquote class="kw"><p id="580f" class="kx ky hi bd kz la lb lc ld le lf jr dx translated"><code class="du lg lh li kj b">m = Prophet(changepoint_prior_scale=0.08)</code></p></blockquote><p id="c6cc" class="pw-post-body-paragraph iu iv hi iw b ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn ln jp jq jr hb bi translated">Python代码-默认情况下，此参数(<code class="du lg lh li kj b">changepoint_prior_scale</code>)设置为0.05。增加它将使趋势<em class="kb">更加</em>灵活。</p><pre class="jt ju jv jw fd ki kj kk kl aw km bi"><span id="bf11" class="kn ko hi kj b fi kp kq l kr ks"><strong class="kj hj">m = Prophet(changepoint_prior_scale=0.5)<br/>forecast = m.fit(df).predict(future)<br/>fig = m.plot(forecast)</strong></span></pre><p id="485e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可以使用<code class="du lg lh li kj b">changepoints</code>参数手动指定潜在变更点的位置</p><pre class="jt ju jv jw fd ki kj kk kl aw km bi"><span id="802a" class="kn ko hi kj b fi kp kq l kr ks"><strong class="kj hj"># Python<br/>m = Prophet(changepoints=['2014-01-01'])<br/>forecast = m.fit(df).predict(future)<br/>fig = m.plot(forecast)</strong></span></pre><p id="7903" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您还可以设置— changepoint_range参数。默认情况下，Prophet指定了25个潜在的变点，这些变点统一位于时间序列的前80%</p><pre class="jt ju jv jw fd ki kj kk kl aw km bi"><span id="bcf7" class="kn ko hi kj b fi kp kq l kr ks"><strong class="kj hj"># Python<br/>from fbprophet.plot import add_changepoints_to_plot<br/>fig = m.plot(forecast)<br/>a = add_changepoints_to_plot(fig.gca(), m, forecast)<br/></strong></span></pre><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es lo"><img src="../Images/de4e1758f2b98d139cbbcc3923563687.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*P767kWfWXtk5qy5EbRGbpg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">红色的变化点</figcaption></figure><p id="f37b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可以通过以下方式更改该参数—</p><blockquote class="kw"><p id="9dec" class="kx ky hi bd kz la lb lc ld le lf jr dx translated"><code class="du lg lh li kj b"><strong class="ak">m = Prophet(changepoint_range=0.9)</strong></code></p></blockquote><p id="14f9" class="pw-post-body-paragraph iu iv hi iw b ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn ln jp jq jr hb bi translated"><code class="du lg lh li kj b">(based on the breakpoints you have in your data)</code></p><p id="3f2f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，如果你看到你的趋势在上升，但你的实际数据集点在下降，那么你可以调整这些参数，使你的趋势更加灵活(但请记住不要过度拟合你的数据(我将在我即将发布的帖子中分享如何<a class="ae jx" href="http://yet to come" rel="noopener ugc nofollow" target="_blank">交叉验证你的数据</a>)。</p><p id="b99a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">例如，你可以用以下公式绘制先知方程的组成部分</p><blockquote class="jy jz ka"><p id="82c5" class="iu iv kb iw b ix iy iz ja jb jc jd je kc jg jh ji kd jk jl jm ke jo jp jq jr hb bi translated">m.plot_components(预测)。</p><p id="7bd5" class="iu iv kb iw b ix iy iz ja jb jc jd je kc jg jh ji kd jk jl jm ke jo jp jq jr hb bi translated">因此，您可以通过查看趋势线(蓝色实线——是否与您的最终输出一致)来调整上述参数。如果你的实际点的趋势是下降的，而你的预测趋势似乎是上升的，那么你肯定需要使用上面讨论的参数来改进你的趋势组件。</p></blockquote><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es lp"><img src="../Images/9eb8e2b0310f976a6583038c7bdc2527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*c388S01n0FLyC8wn7u3XGA.png"/></div></figure><p id="d147" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">关于季节性和其他组成部分，请参见<a class="ae jx" rel="noopener" href="/analytics-vidhya/how-does-prophet-work-part-2-c47a6ceac511?source=friends_link&amp;sk=4a285048592930d6728b3b049fbe713d">第2部分</a>。</p><p id="1826" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">链接到我的GitHub库—<a class="ae jx" href="https://github.com/DeeptiAgl?tab=repositories" rel="noopener ugc nofollow" target="_blank">https://github.com/DeeptiAgl?tab=repositories</a></p><p id="50f7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您有任何问题，请分享您的反馈。我将尽力回答这些问题。</p></div></div>    
</body>
</html>