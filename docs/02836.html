<html>
<head>
<title>Python script to track Amazon Prices!! | Daily Python #1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">跟踪亚马逊价格的Python脚本！！|每日Python #1</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/python-script-to-track-amazon-prices-4b2610da5f49?source=collection_archive---------1-----------------------#2020-01-04">https://medium.com/analytics-vidhya/python-script-to-track-amazon-prices-4b2610da5f49?source=collection_archive---------1-----------------------#2020-01-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="665a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文是一篇教程，介绍如何使用一个简单的Python web scraper跟踪任何电子商务平台上的产品价格。</p><h1 id="dd55" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">要求:</h1><ol class=""><li id="c031" class="kb kc hi ih b ii kd im ke iq kf iu kg iy kh jc ki kj kk kl bi translated">Python 3.0</li><li id="4b59" class="kb kc hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">点</li></ol><h1 id="4394" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">安装以下软件包:</h1><ol class=""><li id="7394" class="kb kc hi ih b ii kd im ke iq kf iu kg iy kh jc ki kj kk kl bi translated"><a class="ae kr" href="https://pypi.org/project/requests/" rel="noopener ugc nofollow" target="_blank">请求</a>—Python的HTTP库</li><li id="817d" class="kb kc hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated"><a class="ae kr" href="https://pypi.org/project/beautifulsoup4/" rel="noopener ugc nofollow" target="_blank"> bs4 </a> —用于网页抓取的库</li><li id="5b76" class="kb kc hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">smtplib——发送电子邮件的库。</li></ol><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="a67b" class="lb je hi kx b fi lc ld l le lf">pip install requests bs4 smptlib</span></pre><p id="e5de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从导入代码中的库开始…</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="161f" class="lb je hi kx b fi lc ld l le lf">import requests<br/>from bs4 import BeautifulSoup<br/>import smtplib</span></pre><p id="1de6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将编写一个获取给定产品价格的函数。为此，我们将需要来自亚马逊(或任何其他电子商务平台)的产品的URL。</p><p id="b911" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，我希望从亚马逊购买这些耐克运动鞋，所以我将复制这个特定产品的URL</p><figure class="ks kt ku kv fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es lg"><img src="../Images/b6939ef115d461274b91ef94324f487b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_I4KeBvlZAxyP_U00EmsDw.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">亚马逊截图</figcaption></figure><p id="5c77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们定义一个检查产品价格的函数。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="ea32" class="lb je hi kx b fi lc ld l le lf">def check_price(URL, threshold_amt):<br/>    headers = {'User-Agent':"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.88 Safari/537.36"}</span><span id="7fbf" class="lb je hi kx b fi ls ld l le lf">page = requests.get(URL,headers=headers)</span><span id="0221" class="lb je hi kx b fi ls ld l le lf">soup = BeautifulSoup(page.content,'html.parser')</span><span id="ef46" class="lb je hi kx b fi ls ld l le lf">title = soup.find(id="productTitle").get_text().strip()</span><span id="de1c" class="lb je hi kx b fi ls ld l le lf">price = soup.find(id="priceblock_saleprice").get_text()[1:].strip().replace(',','')</span><span id="9d3c" class="lb je hi kx b fi ls ld l le lf">Fprice = float(price)</span><span id="3edf" class="lb je hi kx b fi ls ld l le lf">if Fprice &lt; threshold_amt:<br/>        alert_me()</span></pre><p id="a2bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">字典“头”包含<a class="ae kr" href="https://en.wikipedia.org/wiki/User_agent" rel="noopener ugc nofollow" target="_blank">用户代理</a>信息，即浏览器的信息。你可以通过谷歌搜索<strong class="ih hj">我的用户代理</strong>来获得这些信息</p><figure class="ks kt ku kv fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es lt"><img src="../Images/180aab27124f0d41983384805f0ec140.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NxfkOPvGR0Bm21AEm2H7nA.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">谷歌搜索我的用户代理</figcaption></figure><p id="33b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">requests包中的get()方法将获得给定URL的HTTP响应。这个响应被浏览器解析，给我们用户体验的感觉。</p><p id="8a36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个保存在变量‘page’中的HTTP响应是用这个神奇的库<strong class="ih hj">漂亮的汤</strong>解析的。美汤是一个库，可以很容易的从网页上抓取信息。它位于HTML或XML解析器之上，为迭代、搜索和修改解析树提供了Pythonic习惯用法。BeautifulSoup库最大的优点是它构建在html5lib、lxml、html.parser等HTML解析库之上。所以BeautifulSoup对象和指定解析器库可以同时创建。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="2161" class="lb je hi kx b fi lc ld l le lf">soup = BeautifulSoup(page.content,'html.parser')</span></pre><p id="613b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将返回我们请求的网页的HTML代码。现在，可以访问网页的每个元素。如果您想要打印此解析的内容，请执行以下操作:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="ceff" class="lb je hi kx b fi lc ld l le lf">print(soup.prettify())</span></pre><p id="e389" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出将类似于以下内容:</p><figure class="ks kt ku kv fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es lu"><img src="../Images/d30ef9b6562486cd8d933513d04e7d8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e4EvlvSpMTrhyd835mvncQ.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">soup.prettify()产生的输出片段</figcaption></figure><p id="de27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">访问每个元素的最佳方式是使用它的ID。几乎所有网页上的重要元素都有一个ID，即代表该元素的唯一文本。你可以在Google Chrome上做一个inspect元素来发现这一点。</p><figure class="ks kt ku kv fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es lv"><img src="../Images/1718a403ee786557df31ba518a652119.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9aoBR3VRWti3A-9pfrLakg.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">Amazon.in的Snip和检查元素工具</figcaption></figure><p id="2b5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到，包含产品标题的元素的ID是' productTitle '。同样，包含价格的元素的ID是“priceblock_saleprice”。这些id可能因平台而异。</p><p id="62b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> find() </strong>用于从解析后的HTML代码中查找元素。</p><p id="79db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> get_text() </strong>用于获取找到的元素的文本。</p><p id="9ebc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> strip() </strong>用于删除文本前后多余的空格。</p><p id="4f7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将价格从字符串格式转换为'<a class="ae kr" href="https://www.ibm.com/support/knowledgecenter/en/SSGU8G_12.1.0/com.ibm.sqlr.doc/ids_sqr_118.htm" rel="noopener ugc nofollow" target="_blank"> float </a>'。首先，我们使用切片来剥离货币图标([1:] —从索引1开始直到结束)。然后，我们删除逗号('，')，用空格(')代替它。此外，我们将该字符串类型转换为“float”。</p><p id="20b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们有了可以与某个值进行比较的实际价格之后，我们根据产品价格来设置条件。如果我想在这些耐克运动鞋的价格低于3000卢比时收到电子邮件，那么我会相应地设置条件。</p><p id="5c7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果价格低于给定的阈值金额，向我发送电子邮件的功能应该被触发。</p><p id="b27a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要收到电子邮件提醒，首先，我们需要允许谷歌允许不太安全的应用程序。要做到这一点，搜索“谷歌允许不太安全的应用”。</p><figure class="ks kt ku kv fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es lw"><img src="../Images/4de019e7f8d57ffb1f72d5fa212768f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LDRauX4FYh3hmnp5HLoljw.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">谷歌搜索允许不太安全的应用程序</figcaption></figure><p id="11b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到“不太安全的应用程序-登录-谷歌帐户”页面，并启用谷歌允许不太安全的应用程序。</p><figure class="ks kt ku kv fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es lx"><img src="../Images/9d6dbf6c62ae5052077b8a0807aac47d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GxhMlJhkDSZxHXGJYTTwRQ.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">拦截不太安全的应用程序访问(谷歌)</figcaption></figure><p id="0cc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们可以使用Gmail密码进行身份验证，但更安全的方法是启用谷歌两步验证。只需搜索“谷歌两步验证”并打开两步验证。</p><figure class="ks kt ku kv fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es ly"><img src="../Images/754025656ea91205e806b84bd7e1c0db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dp-x9rCbfr4FQWQCB22Jaw.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">谷歌搜索2步验证截图</figcaption></figure><p id="8cbe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">启用两步验证后，我们现在可以为不同的应用程序设置密码。搜索“谷歌应用程序密码”并访问应用程序密码页面。Google会要求您登录以进行身份验证。现在，我们设置应用程序的类型，在这种情况下，邮件和设备的类型，在这种情况下，Windows计算机。单击Generate后，我们会看到一个弹出窗口，显示应用程序的密码。</p><figure class="ks kt ku kv fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es lz"><img src="../Images/f923f62dfa19b27a214f61d525046be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZEEQ2uc9szUFPnPvIxoSGw.png"/></div></div></figure><p id="a0bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们编写一个函数‘alert _ me’来在它被调用时发送一封电子邮件。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="7a24" class="lb je hi kx b fi lc ld l le lf">def alert_me(URL,title, price):<br/>    server = smtplib.SMTP('smtp.gmail.com',587)<br/>    <br/>    server.ehlo()<br/>    server.starttls()<br/>    server.ehlo()<br/>    <br/>    server.login('YOUR_EMAIL','GOOGLE_APP_PASSWORD')<br/>    <br/>    subject = 'Price fell down for '+title</span><span id="f807" class="lb je hi kx b fi ls ld l le lf">    body = 'Buy it now here: '+URL</span><span id="1725" class="lb je hi kx b fi ls ld l le lf">    msg = f"Subject:{subject}\n\n{body}"<br/>    <br/>    server.sendmail('YOUR_EMAIL','TO_EMAIL',msg)</span><span id="48d5" class="lb je hi kx b fi ls ld l le lf">    print('Email alert sent')</span><span id="91cd" class="lb je hi kx b fi ls ld l le lf">    server.quit()</span></pre><p id="70f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们首先通过提供主机“smtp.gmail.com”和端口号<a class="ae kr" href="https://serversmtp.com/port-587/" rel="noopener ugc nofollow" target="_blank"> 587 </a>来实例化SMTP的对象。</p><p id="b8db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们使用<code class="du ma mb mc kx b">EHLO</code>向ESMTP服务器表明自己身份。您可以从python文档中了解更多信息。然后，我们将SMTP连接置于TLS(传输层安全性)模式。接下来的所有SMTP命令都将被加密。</p><p id="65e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们准备邮件的主题和正文，并将它们连接成一个变量“msg”。该消息随后被传递到'<strong class="ih hj"> sendmail </strong>()'上，后者将电子邮件发送到目标电子邮件地址。</p><figure class="ks kt ku kv fd lh er es paragraph-image"><div class="er es md"><img src="../Images/d5d8da6c4bab352fae4c3eb2b4b58175.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*FYOiaQ5MAwAwNGLN7XAEEQ.jpeg"/></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">收到的邮件的截图</figcaption></figure><p id="efbc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这封电子邮件被发送，因为我设置的阈值金额超过了测试目的的当前价格。为了保持这个脚本运行，添加一个睡眠一小时的循环，以保持每小时检查一次。</p><p id="b906" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这篇文章是有帮助的，如果你喜欢它或者有任何建议，请留下评论。</p><div class="me mf ez fb mg mh"><a href="https://github.com/Ajinkya-Sonawane/Python/tree/master/Python%20Daily" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab dw"><div class="mj ab mk cl cj ml"><h2 class="bd hj fi z dy mm ea eb mn ed ef hh bi translated">Ajinkya-Sonawane/Python</h2><div class="mo l"><h3 class="bd b fi z dy mm ea eb mn ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mp l"><p class="bd b fp z dy mm ea eb mn ed ef dx translated">github.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv lm mh"/></div></div></a></div><div class="me mf ez fb mg mh"><a href="https://www.instagram.com/daily.py/" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab dw"><div class="mj ab mk cl cj ml"><h2 class="bd hj fi z dy mm ea eb mn ed ef hh bi translated">登录* Instagram</h2><div class="mo l"><h3 class="bd b fi z dy mm ea eb mn ed ef dx translated">欢迎回到Instagram。登录查看您的朋友、家人和兴趣爱好捕捉和分享了什么…</h3></div><div class="mp l"><p class="bd b fp z dy mm ea eb mn ed ef dx translated">www.instagram.com</p></div></div></div></a></div></div></div>    
</body>
</html>