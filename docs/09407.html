<html>
<head>
<title>Building A Decision Support Tool For Capital Budgeting With Python Pulp</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python纸浆构建资本预算的决策支持工具</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/building-a-decision-support-tool-for-capital-budgeting-with-python-pulp-f56785f6668e?source=collection_archive---------5-----------------------#2020-09-05">https://medium.com/analytics-vidhya/building-a-decision-support-tool-for-capital-budgeting-with-python-pulp-f56785f6668e?source=collection_archive---------5-----------------------#2020-09-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="d85f" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated"><strong class="ak">汇总</strong></h1><p id="8604" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><em class="kb">像线性规划这样的优化技术通常仍然是许多决策支持系统背后的可靠工作。不幸的是，与花哨的机器学习算法相比，它们往往没有得到应有的重视。在本文中，我们将了解线性规划应用于资本预算优化问题的基本原理，以及如何使用线性规划的Python库</em>来优化资本预算</p><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="kh ki l"/></div></figure><h1 id="2ae2" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">概述</h1><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es kj"><img src="../Images/9ffa4f186fd4393f6c479e7a27ba281e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vXledJ1NrGfHhv0FBT6nKg.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">来源:阿拉米股票照片</figcaption></figure><ol class=""><li id="3c2a" class="ku kv hi jf b jg kw jk kx jo ky js kz jw la ka lb lc ld le bi translated"><a class="ae lf" href="#49bf" rel="noopener ugc nofollow"> <strong class="jf hj">什么是资本预算？</strong> </a></li><li id="0fd6" class="ku kv hi jf b jg lg jk lh jo li js lj jw lk ka lb lc ld le bi translated"><a class="ae lf" href="#21f4" rel="noopener ugc nofollow">T9】什么是线性/整数规划？ </a></li><li id="25bf" class="ku kv hi jf b jg lg jk lh jo li js lj jw lk ka lb lc ld le bi translated"><a class="ae lf" href="#eef4" rel="noopener ugc nofollow"> <strong class="jf hj">优化纸浆项目组合的资本预算</strong> </a></li><li id="4236" class="ku kv hi jf b jg lg jk lh jo li js lj jw lk ka lb lc ld le bi translated"><a class="ae lf" href="#698f" rel="noopener ugc nofollow"> <strong class="jf hj">结论</strong> </a></li><li id="ab4d" class="ku kv hi jf b jg lg jk lh jo li js lj jw lk ka lb lc ld le bi translated"><a class="ae lf" href="#5098" rel="noopener ugc nofollow">T21更多资源</a></li></ol><h1 id="49bf" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated"><strong class="ak"> 1什么是资本预算？</strong></h1><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es ll"><img src="../Images/3b19d6e243c04ce72f27c37a2cb01412.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/0*ZHZBG9NPudf3BUnx.png"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">图像来源:Dreamstime.com股票照片</figcaption></figure><p id="2595" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">“资本预算”问题是许多组织面临的一种情况，即有一长串的项目要完成，但有限的预算(或其他资源，如人力)限制了项目的执行。</p><div class="lp lq ez fb lr ls"><a href="https://www.investopedia.com/articles/financial-theory/11/corporate-project-valuation-methods.asp" rel="noopener  ugc nofollow" target="_blank"><div class="lt ab dw"><div class="lu ab lv cl cj lw"><h2 class="bd hj fi z dy lx ea eb ly ed ef hh bi translated">资本预算导论</h2><div class="lz l"><h3 class="bd b fi z dy lx ea eb ly ed ef dx translated">资本预算包括选择能为公司增加价值的项目。资本预算过程可能涉及…</h3></div><div class="ma l"><p class="bd b fp z dy lx ea eb ly ed ef dx translated">www.investopedia.com</p></div></div><div class="mb l"><div class="mc l md me mf mb mg ko ls"/></div></div></a></div><p id="45c6" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">因此，面临的挑战是如何在这些稀缺资源下的项目组合中做出“最佳”选择，以使公司价值最大化</p><h1 id="21f4" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">2什么是线性/整数规划？</h1><p id="97c3" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">有许多优化资本预算流程的方法，但线性规划应用起来相对直接，理解起来也比较直观。</p><p id="91a2" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">如果变量之间的关系(即≤ , ≥ , =)本质上是线性的(即X + Y = Z，而不是X + Y = Z，这将是非线性的)，则线性规划是一种可用于解决优化问题的技术</p><div class="lp lq ez fb lr ls"><a href="https://www.analyticsvidhya.com/blog/2017/02/lintroductory-guide-on-linear-programming-explained-in-simple-english/" rel="noopener  ugc nofollow" target="_blank"><div class="lt ab dw"><div class="lu ab lv cl cj lw"><h2 class="bd hj fi z dy lx ea eb ly ed ef hh bi translated">(有抱负的)数据科学家线性规划入门指南</h2><div class="lz l"><h3 class="bd b fi z dy lx ea eb ly ed ef dx translated">引言优化是生活的方式。我们都有有限的资源和时间，我们想充分利用…</h3></div><div class="ma l"><p class="bd b fp z dy lx ea eb ly ed ef dx translated">www.analyticsvidhya.com</p></div></div><div class="mb l"><div class="mh l md me mf mb mg ko ls"/></div></div></a></div><p id="5896" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">例如，如下所示——如果目标是最大化/最小化“y”变量，则需要做的就是上下移动一条直线，并读取与灰色三角形相交的y坐标(y max = 6或y min = 3)</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es mi"><img src="../Images/cb666c97f02e93f4ad47b6dfddcf516b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*S_Cs-mUT464pi-YPw3jYjg.png"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">图像来源:<a class="ae lf" href="http://www.purplemath.com/modules/linprog.htm" rel="noopener ugc nofollow" target="_blank">http://www.purplemath.com/modules/linprog.htm</a></figcaption></figure><p id="b7e2" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">二进制整数线性规划是线性规划的特例，其中决策变量被约束为1或0，并且是可用于“解决”资本预算优化问题的主要方法</p><h1 id="eef4" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">3使用Python PuLP优化资本预算</h1><p id="be53" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果您想继续学习，可以通过以下链接获得源代码和输入文件:</p><div class="lp lq ez fb lr ls"><a href="https://github.com/ZhijingEu/Optimizing_Capital_Budgeting_With_ILP_Methods/tree/master/PreviewArticle" rel="noopener  ugc nofollow" target="_blank"><div class="lt ab dw"><div class="lu ab lv cl cj lw"><h2 class="bd hj fi z dy lx ea eb ly ed ef hh bi translated">ZhijingEu/Optimizing _ Capital _ Budgeting _ With _ ILP _ Methods</h2><div class="lz l"><h3 class="bd b fi z dy lx ea eb ly ed ef dx translated">这是一个包含示例脚本和文件的存储库，附带了一个Youtube视频系列和一篇关于如何…</h3></div><div class="ma l"><p class="bd b fp z dy lx ea eb ly ed ef dx translated">github.com</p></div></div><div class="mb l"><div class="mj l md me mf mb mg ko ls"/></div></div></a></div><h2 id="d570" class="mk ig hi bd ih ml mm mn il mo mp mq ip jo mr ms it js mt mu ix jw mv mw jb mx bi translated"><strong class="ak"> 3.1为什么选择Python？</strong></h2><p id="8fcd" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">你们中的一些人可能熟悉Excel的规划求解加载项，它是一种提供建模优化问题的简单方法的工具。</p><div class="lp lq ez fb lr ls"><a href="https://support.microsoft.com/en-us/office/load-the-solver-add-in-in-excel-612926fc-d53b-46b4-872c-e24772f078ca" rel="noopener  ugc nofollow" target="_blank"><div class="lt ab dw"><div class="lu ab lv cl cj lw"><h2 class="bd hj fi z dy lx ea eb ly ed ef hh bi translated">在Excel中加载规划求解加载宏</h2><div class="lz l"><h3 class="bd b fi z dy lx ea eb ly ed ef dx translated">在Excel 2010和更高版本中，转到文件&gt;选项注意:对于Excel 2007，请单击Microsoft Office按钮，然后单击…</h3></div><div class="ma l"><p class="bd b fp z dy lx ea eb ly ed ef dx translated">support.microsoft.com</p></div></div><div class="mb l"><div class="my l md me mf mb mg ko ls"/></div></div></a></div><p id="1cc7" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">然而，使用电子表格运行优化模型存在许多问题:</p><ul class=""><li id="c413" class="ku kv hi jf b jg kw jk kx jo ky js kz jw la ka mz lc ld le bi translated">电子表格将数据模型和规划求解模型的逻辑“耦合”在一起——虽然这有时对临时建模很方便，但这会<em class="kb">限制跨大型数据集推广模型的能力</em>,因为“逻辑”与数据的外观紧密相关</li><li id="cda5" class="ku kv hi jf b jg lg jk lh jo li js lj jw lk ka mz lc ld le bi translated">与拥有更强大版本控制工具如Git或SVN的<em class="kb">编程代码不同，对电子表格的修订管理是有限的，这使得出错的可能性更大，尤其是当多方在同一个模型上工作时(除了求解器插件之外还使用VBA代码，这使得事情变得更加混乱，这也并不罕见)</em></li><li id="c4df" class="ku kv hi jf b jg lg jk lh jo li js lj jw lk ka mz lc ld le bi translated">电子表格(通常)是“独立”的工具，而像Python这样的编程语言可以让你在数据库或可视化工具之间来回移动信息</li></ul><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es na"><img src="../Images/7423ef1ab57d7c6b5d2f58627561a6d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*4qt6uPIRHAx6QV2ZHvPwYQ.png"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">图片来源:<a class="ae lf" href="https://www.decusoft.com/nightmare-on-spreadsheet/" rel="noopener ugc nofollow" target="_blank">https://www.decusoft.com/nightmare-on-spreadsheet/</a></figcaption></figure><p id="b185" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">因此，代替Excel，我们将使用<a class="ae lf" href="https://coin-or.github.io/pulp/index.html" rel="noopener ugc nofollow" target="_blank"> PuLP </a>一个用于线性编程的Python编程库来对问题建模。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es nb"><img src="../Images/2ee4adecbfd3b871835026648215abdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*REaw6_bA0zlhdNGr.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated"><a class="ae lf" href="https://coin-or.github.io/pulp/index.html" rel="noopener ugc nofollow" target="_blank">https://coin-or.github.io/pulp/index.html</a></figcaption></figure><h2 id="fba6" class="mk ig hi bd ih ml mm mn il mo mp mq ip jo mr ms it js mt mu ix jw mv mw jb mx bi translated">3.2问题描述</h2><p id="12cc" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">一家公司有5个潜在项目，每个项目都有单独的资本支出成本阶段和净现值估算，如下所示:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es nc"><img src="../Images/86963749930a04679a8d0b62c299823e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OUAU77CmqYfZTcetB08e9w.png"/></div></div></figure><p id="3a2b" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">必须在这些限制条件下选择最大化总NPV的项目入围名单</p><p id="2931" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">a)每年分别需要满足1000万、1000万和600万的3年资本支出阈值</p><p id="c249" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">b)项目1和2互为条件，即要么一起选择，要么根本不选择</p><p id="23e6" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">c)项目3和项目5是互斥的，即不能一起选择(尽管也可以两者都不选择)</p><h2 id="c04e" class="mk ig hi bd ih ml mm mn il mo mp mq ip jo mr ms it js mt mu ix jw mv mw jb mx bi translated"><strong class="ak"> 3.3。将问题转化为关系</strong></h2><p id="0ef6" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这个<strong class="jf hj">【决策变量】</strong>就是我们要解决的。这里是所有5个项目的选择状态，我们可以将其建模为a list = [ StatusProject1，StatusProject2，…，StatusProject5]其中每行为1(是)或0(否)</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es nd"><img src="../Images/ed706bf54e4ef199f2725c03d0269fed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oHF4Alf5NNxAFV1Me1gQ0Q.png"/></div></div></figure><p id="3abc" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">我们试图最大化的<strong class="jf hj">【目标】</strong>是NPV，所以它只是每个项目的选择状态的总和乘以每个项目的NPV。(即上表中的黄色单元格)</p><pre class="kc kd ke kf fd ne nf ng nh aw ni bi"><span id="5ba9" class="mk ig hi nf b fi nj nk l nl nm">Total NPV = SUM ( [Selection Status] X [NPV] For Each Project)</span></pre><p id="82cc" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated"><strong class="jf hj">约束条件</strong>:对于约束条件(a)，情况类似，即第1年、第2年和第3年的资本支出总和乘以选择状态(蓝色单元格)，选择状态必须小于年度限额(绿色单元格)</p><pre class="kc kd ke kf fd ne nf ng nh aw ni bi"><span id="2697" class="mk ig hi nf b fi nj nk l nl nm">Total Selected CAPEX Yr 1 = <br/>              SUM ([Selection Status]X[CAPEX Yr 1] For Each Project)</span><span id="8d2c" class="mk ig hi nf b fi nn nk l nl nm">...and so on for Yr 2 , 3  </span></pre><p id="3d97" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">对于约束(b ),它是这样处理的</p><pre class="kc kd ke kf fd ne nf ng nh aw ni bi"><span id="d943" class="mk ig hi nf b fi nj nk l nl nm">Selection Status[Project1] = SelectionStatus[Project2]</span></pre><p id="3d2d" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">因为这意味着它们总是要么被选择，要么不被一起选择</p><p id="6a43" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">和约束(c)</p><pre class="kc kd ke kf fd ne nf ng nh aw ni bi"><span id="e6fa" class="mk ig hi nf b fi nj nk l nl nm">Selection Status[Project3] + SelectionStatus[Project5] &lt;= 1</span></pre><p id="23d1" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">因为这意味着要么两者都没有被选择，所以0+0 ≤ 1，要么两者中只有一个可以“开”，所以0+1 ≤ 1或1+ 0 ≤ 1，它们是互斥的</p><h2 id="26dc" class="mk ig hi bd ih ml mm mn il mo mp mq ip jo mr ms it js mt mu ix jw mv mw jb mx bi translated"><strong class="ak"> 3.4。用Python纸浆代表问题</strong></h2><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es no"><img src="../Images/1772d128cb18ebd19b660b5649a527eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*vIa_sUdyQqsNUCNZx9BJ1A.png"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">不是我——尽管我希望我有3个屏幕(来源:Dreamstime.Com股票图片)</figcaption></figure><p id="8805" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">完整的代码如下</p><p id="11d5" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">步骤1和2很简单，因为它只是加载库并将数据放入Python。</p><pre class="kc kd ke kf fd ne nf ng nh aw ni bi"><span id="ee9f" class="mk ig hi nf b fi nj nk l nl nm">#Step 1 : Import Libraries<br/>import pandas as pd<br/>import numpy as np<br/>import pulp</span><span id="91a4" class="mk ig hi nf b fi nn nk l nl nm">#Step 2: Load Data for Project List and Yrly CAPEX Limits<br/>proj_list= <br/>    pd.read_csv('Example1_ProjList.csv', index_col=['ID']).fillna(0)</span><span id="12e6" class="mk ig hi nf b fi nn nk l nl nm">capexconstraints=<br/>    pd.read_csv('Example1_AnnualCAPEX.csv')['CAPEX'].values.tolist()</span></pre><p id="ca48" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">第3步开始变得有点有趣，因为我们开始构建所有互斥项目对、偶发项目等的列表。这将是我们以后要利用的东西…</p><pre class="kc kd ke kf fd ne nf ng nh aw ni bi"><span id="bec2" class="mk ig hi nf b fi nj nk l nl nm">#Step 3: Build Sub-Lists Of Projects With Dependency Relationships</span><span id="8f36" class="mk ig hi nf b fi nn nk l nl nm">relationships=proj_list[['Relationship','RelationshipProjID']].dropna(thresh=2)<br/>relationships['RelationshipProjID2']=relationships.index</span><span id="a271" class="mk ig hi nf b fi nn nk l nl nm">MutuallyExclusive=relationships.loc[relationships['Relationship'] == 'Mutually_Exclusive'].sort_values(['RelationshipProjID2'])<br/>MutuallyExclProjectsList=list(set(map(lambda x: tuple(sorted(x)),[[i , j] for i, j in zip(MutuallyExclusive['RelationshipProjID2'].values.tolist(), MutuallyExclusive['RelationshipProjID'].values.tolist())])))</span><span id="0b38" class="mk ig hi nf b fi nn nk l nl nm">Contingent=relationships.loc[relationships['Relationship'] == 'Contingent'].sort_values(['RelationshipProjID2'])<br/>ContingentProjectsList = list(set(map(lambda x: tuple(sorted(x)),[[i , j] for i, j in zip(Contingent['RelationshipProjID2'].values.tolist(), Contingent['RelationshipProjID'].values.tolist())])))</span><span id="db37" class="mk ig hi nf b fi nn nk l nl nm">Mandatory=relationships.loc[relationships['Relationship'] == 'Mandatory'].sort_values(['RelationshipProjID2'])<br/>MandatoryProjectsList = Mandatory['RelationshipProjID2'].values.tolist()</span></pre><p id="3c5a" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">在步骤4-5中，实际纸浆代码和过程是相似的，其中决策变量和目标被定义。</p><pre class="kc kd ke kf fd ne nf ng nh aw ni bi"><span id="397f" class="mk ig hi nf b fi nj nk l nl nm"># Step 4: Create A Model</span><span id="cc86" class="mk ig hi nf b fi nn nk l nl nm">phasing = pulp.LpProblem("Maximise", pulp.LpMaximize)</span><span id="a571" class="mk ig hi nf b fi nn nk l nl nm">Selection = pulp.LpVariable.dicts("Selection", proj_list.index, cat='Binary')</span><span id="79ab" class="mk ig hi nf b fi nn nk l nl nm"># Step 5 : Set The Objective Function                                                                                                         <br/>phasing += pulp.lpSum(Selection[idx]*proj_list.loc[idx]["NPV"] for idx in proj_list.index)</span></pre><p id="c452" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">第6步是最有趣的一步，因为代码使用Python编程的强大功能迭代约束，而不是逐行定义每个约束…</p><p id="607f" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">例如，对于互斥项目，代码并不明确表示选择状态[项目3] +选择状态[项目5] = 1，而是使用互斥项目的列表，并将这些项目对传递到一个循环中以分配关系。</p><p id="89c6" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated"><strong class="jf hj"/></p><pre class="kc kd ke kf fd ne nf ng nh aw ni bi"><span id="c0ca" class="mk ig hi nf b fi nj nk l nl nm"># Step 6 : Set The Constraints</span><span id="88a3" class="mk ig hi nf b fi nn nk l nl nm">#Loop over the individual Years<br/>for m in range(0,len(capexconstraints)):<br/>    year=str(m+1)<br/>    phasing += sum([Selection[idx] * proj_list.loc[idx]["CAPEX Yr"+year] for idx in proj_list.index]) &lt;= capexconstraints[m]</span><span id="923d" class="mk ig hi nf b fi nn nk l nl nm"># Loop over for mutually exclusive projects<br/>for i in range(0,len(MutuallyExclProjectsList)):<br/>    phasing += Selection[MutuallyExclProjectsList[i][0]] + Selection[MutuallyExclProjectsList[i][1]] == 1<br/>                                                                     <br/># Loop over contingent projects<br/>for j in range(0,len(ContingentProjectsList)):<br/>    phasing += Selection[ContingentProjectsList[j][0]] == Selection[ContingentProjectsList[j][1]]</span><span id="d120" class="mk ig hi nf b fi nn nk l nl nm"># Loop over mandatory projects</span><span id="7137" class="mk ig hi nf b fi nn nk l nl nm">for k in range(0,len(MandatoryProjectsList)):<br/>    phasing += Selection[MandatoryProjectsList[k]] == 1</span><span id="7428" class="mk ig hi nf b fi nn nk l nl nm"># Step 7: Run The Solver(s)</span><span id="b8b0" class="mk ig hi nf b fi nn nk l nl nm">%time phasing.solve() #equivalent to phasing.solve(pulp.PULP_CBC_CMD()) as CBC is PulP's default solver</span><span id="4345" class="mk ig hi nf b fi nn nk l nl nm">pulp.LpStatus[phasing.status]</span><span id="df27" class="mk ig hi nf b fi nn nk l nl nm"># Print our objective function value and Output Solution<br/>print (pulp.value(phasing.objective))</span></pre><p id="f9cd" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">PulP运行求解算法后的最后一步是将数据输出为用户友好的格式。</p><pre class="kc kd ke kf fd ne nf ng nh aw ni bi"><span id="2f88" class="mk ig hi nf b fi nj nk l nl nm"># Step 8 : Convert output into user friendly output for viewing or downloading <br/>outputtablecolumns=[]<br/>outputtablecolumns.append('Selection Y/N')<br/>for n in range(0,len(capexconstraints)):<br/>    year=str(n+1)<br/>    outputtablecolumns.append("CAPEX Yr"+year+" Selected")<br/>outputtablecolumns.append('NPV Selected')</span><span id="423d" class="mk ig hi nf b fi nn nk l nl nm">pulpsolution=pd.DataFrame()<br/>pulpsolution['Selection Y/N']= [Selection[idx].value() for idx in proj_list.index]</span><span id="469e" class="mk ig hi nf b fi nn nk l nl nm">for n in range(0,len(capexconstraints)):<br/>    year=str(n+1)<br/>    pulpsolution["CAPEX Yr"+year+" Selected"]= [Selection[idx].value()*proj_list.loc[idx]["CAPEX Yr"+year] for idx in proj_list.index]</span><span id="2f34" class="mk ig hi nf b fi nn nk l nl nm">pulpsolution['NPV Selected']= [Selection[idx].value()*proj_list.loc[idx]["NPV"] for idx in proj_list.index]</span><span id="f00e" class="mk ig hi nf b fi nn nk l nl nm">pulpsolution</span><span id="632a" class="mk ig hi nf b fi nn nk l nl nm">pulpsolution.index += 1 <br/>pulpsolution</span><span id="611d" class="mk ig hi nf b fi nn nk l nl nm">pulpoutput = pd.concat([proj_list, pulpsolution], axis=1)<br/>pulpoutput</span><span id="587a" class="mk ig hi nf b fi nn nk l nl nm">yearSumCapexColumns=[]<br/>for p in range(0,len(capexconstraints)):<br/>    year=str(p+1)<br/>    yearSumCapexColumns.append("CAPEX Yr"+year+" Selected")<br/>yearSumCapexColumns</span><span id="f7b1" class="mk ig hi nf b fi nn nk l nl nm">CAPEX_Totals=[pulpsolution[yr].sum() for yr in yearSumCapexColumns]</span><span id="95e1" class="mk ig hi nf b fi nn nk l nl nm">CAPEX_CheckSum= pd.DataFrame()<br/>CAPEX_CheckSum['Year'] = np.arange(len(yearSumCapexColumns))+1<br/>CAPEX_CheckSum['CAPEX Phasing'] = CAPEX_Totals<br/>CAPEX_CheckSum['Constraints'] = capexconstraints<br/>CAPEX_CheckSum['Budget Utilisation%'] = round(CAPEX_CheckSum['CAPEX Phasing']/CAPEX_CheckSum['Constraints'],2)*100</span><span id="a78e" class="mk ig hi nf b fi nn nk l nl nm">print("Summary")<br/>print()<br/>print('Total NPV=', round(pulpsolution['NPV Selected'].sum(),2))<br/>print()<br/>print(len(pulpoutput.loc[pulpoutput['Selection Y/N'] == 1]), "out of" ,len(proj_list.index) ,"total projects submitted were shortlisted for execution" )<br/>print()<br/>print(CAPEX_CheckSum.to_string(index = False))</span><span id="aa16" class="mk ig hi nf b fi nn nk l nl nm">print("Selected Projects")<br/>print("-----------------")<br/>pulpoutput.loc[pulpoutput['Selection Y/N'] == 1]</span><span id="eb13" class="mk ig hi nf b fi nn nk l nl nm">print("Dropped Projects")<br/>print("----------------")<br/>pulpoutput.loc[pulpoutput['Selection Y/N'] == 0]</span></pre><p id="6a9b" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">在任何情况下，解决当前问题都会产生以下结果:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es np"><img src="../Images/f2444a244202d1a943ba0a98310a9cc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hh9qBAlm306k7zuPVvKt8A.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">选择了项目1、2、5</figcaption></figure><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es nq"><img src="../Images/512349a7d5310e7e0159fab3c3b16521.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*7Stx2EE35xgcJ4hE91m26Q.png"/></div></figure><p id="b4c6" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">现在，这看起来不太像，但如果我们再次尝试，但有一个更长的30个项目和4年的资本支出阶段(而不是3年)，代码仍然能够发现最佳解决方案，而不需要对代码进行任何修改…</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es nr"><img src="../Images/8d22d9b953937b5fbe244fe113c42e5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_GW5tb9MYH7KAORyig19zw.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">该表包含30个项目X 4年资本支出阶段，而之前的5个项目X 3年资本支出阶段</figcaption></figure><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es ns"><img src="../Images/003b3798a48564b87849f57e91892570.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*xUltJ1riNggIho-KV48xjg.png"/></div></figure><h2 id="0cbf" class="mk ig hi bd ih ml mm mn il mo mp mq ip jo mr ms it js mt mu ix jw mv mw jb mx bi translated">3.5到云和更远！</h2><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es nt"><img src="../Images/c47eca063bc4f4dde2c65b37bccb0f23.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*5irgIiX3oN7P95V7GNjcLQ.png"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">图片来源:<a class="ae lf" href="https://www.gettyimages.com/" rel="noopener ugc nofollow" target="_blank"> Getty Images </a></figcaption></figure><p id="c5ee" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">在上面的例子中，输入来自CSV文件，输出显示在Python JupyterNotebook文件中。</p><p id="95bc" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">但是，可以使用Python直接从中央数据库(如SAP等)加载实时输入，并将输出发送到可视化工具(如Power BI、Tableau或其他仪表板)与他人共享。</p><p id="639a" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">由于这只是一个代码片段，它甚至可以由虚拟机托管和运行，以利用云计算资源(类似于一些机器学习模型的工作方式)</p><p id="6609" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">这对于资本预算可能没有意义，因为这通常与年度财务计划周期相关，但同样的整数/线性规划技术也经常用于调度、生产计划或库存管理(通常有数百甚至数千个变量，因此“求解”最优值在计算上变得更加困难)，这些都需要每周、每天甚至每小时的运营决策，而这种方法肯定会有所帮助。</p><h1 id="698f" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">4.结论</h1><p id="99b3" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">希望通过上面的例子，我已经设法…</p><ul class=""><li id="928f" class="ku kv hi jf b jg kw jk kx jo ky js kz jw la ka mz lc ld le bi translated">帮助您理解线性编程背后的基本思想</li><li id="4355" class="ku kv hi jf b jg lg jk lh jo li js lj jw lk ka mz lc ld le bi translated">演示如何使用纸浆优化资本预算</li><li id="2ae0" class="ku kv hi jf b jg lg jk lh jo li js lj jw lk ka mz lc ld le bi translated">围绕为什么编程语言应该是构建和维护复杂优化模型而不是电子表格求解器插件模型的首选方法，提出一些优点。</li></ul><h1 id="5098" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">5.更多资源</h1><p id="9c63" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果您对这个主题感兴趣，这实际上是一个更全面的教程系列的一部分，它更详细地介绍了资本预算问题和线性规划</p><div class="lp lq ez fb lr ls"><a rel="noopener follow" target="_blank" href="/@zhijingeu/optimizing-capital-budgeting-using-linear-programming-tools-dfd1dec5a64d"><div class="lt ab dw"><div class="lu ab lv cl cj lw"><h2 class="bd hj fi z dy lx ea eb ly ed ef hh bi translated">使用线性规划工具优化资本预算</h2><div class="lz l"><h3 class="bd b fi z dy lx ea eb ly ed ef dx translated">(Excel解算器、Open Solver、Solver Studio、Python PulP / Pyomo、Frontline Systems分析解算器)</h3></div><div class="ma l"><p class="bd b fp z dy lx ea eb ly ed ef dx translated">medium.com</p></div></div><div class="mb l"><div class="nu l md me mf mb mg ko ls"/></div></div></a></div><p id="da77" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo lm jq jr js ln ju jv jw lo jy jz ka hb bi translated">涉及的一些主题包括:-</p><ul class=""><li id="2382" class="ku kv hi jf b jg kw jk kx jo ky js kz jw la ka mz lc ld le bi translated">如何为多个项目具有灵活开始日期的投资组合建模优化</li><li id="b81c" class="ku kv hi jf b jg lg jk lh jo li js lj jw lk ka mz lc ld le bi translated">如何对NPV或CAPEX估计不确定的项目组合进行优化建模</li><li id="2220" class="ku kv hi jf b jg lg jk lh jo li js lj jw lk ka mz lc ld le bi translated">如何应用其他开源(免费！)除了Excel Solver和Python PuLP之外的建模工具，例如Python <a class="ae lf" href="https://www.pyomo.org/" rel="noopener ugc nofollow" target="_blank"> Pyomo </a>(用于非线性建模)、更高级的Excel AddIns ( <a class="ae lf" href="https://opensolver.org/" rel="noopener ugc nofollow" target="_blank"> Open Solver </a>、<a class="ae lf" href="https://solverstudio.org/" rel="noopener ugc nofollow" target="_blank"> Solver Studio </a>)与商业工具如<a class="ae lf" href="https://www.solver.com/" rel="noopener ugc nofollow" target="_blank">Frontline System Analytic Solver</a></li></ul></div></div>    
</body>
</html>