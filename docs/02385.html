<html>
<head>
<title>Spark Thrift Server Deep Dive</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spark Thrift服务器深度挖掘</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/spark-thrift-server-deep-dive-fccf6cd7321e?source=collection_archive---------8-----------------------#2019-12-14">https://medium.com/analytics-vidhya/spark-thrift-server-deep-dive-fccf6cd7321e?source=collection_archive---------8-----------------------#2019-12-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f16a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我在星火深潜系列中的一个故事</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/25acbaf51d8d82720626ce7aa3fabf3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qTFw_bzUJk9zrhRQ"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Jez Timms 在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><div class="ju jv ez fb jw jx"><a rel="noopener follow" target="_blank" href="/@somanathsankaran"><div class="jy ab dw"><div class="jz ab ka cl cj kb"><h2 class="bd hj fi z dy kc ea eb kd ed ef hh bi translated">索玛纳特·桑卡兰培养基</h2><div class="ke l"><h3 class="bd b fi z dy kc ea eb kd ed ef dx translated">阅读索马纳特·桑卡兰在媒介上的作品。对python和spark感兴趣的大数据开发者。每天，索马纳特…</h3></div><div class="kf l"><p class="bd b fp z dy kc ea eb kd ed ef dx translated">medium.com</p></div></div><div class="kg l"><div class="kh l ki kj kk kg kl jn jx"/></div></div></a></div><p id="a077" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个被低估的有趣的服务是spark节俭服务器。让我们详细看看节约服务器的用途。</p><ol class=""><li id="19ea" class="km kn hi ih b ii ij im in iq ko iu kp iy kq jc kr ks kt ku bi translated">火花节约服务器</li><li id="9c41" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">Spark节俭服务器的使用</li><li id="f423" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">启动节俭服务器及其工作原理</li><li id="c78c" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">用SQL Alchemy连接Thift服务器</li><li id="9307" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">探索节俭服务器用户界面</li></ol><p id="7424" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">星火节俭服务器</strong>:</p><p id="bc36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该服务通过spark提供了一种服务器-客户端(jdbc/odbc)设施的风格</p><p id="e0e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">服务器客户端设备意味着我们不需要在我们的机器上安装spark。相反，我们将是一个客户端，我们将获得一个服务器的网址</p><p id="4135" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以通过我们的应用程序连接和使用数据，例如在我们的用例中，我们将使用Pyhive客户端连接到在一些服务器上启动的spark生态系统</p><p id="cafa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">Spark节俭服务器的用途</strong></p><ol class=""><li id="4a68" class="km kn hi ih b ii ij im in iq ko iu kp iy kq jc kr ks kt ku bi translated">使用tablaeu、superset等BI工具进行连接</li><li id="3e38" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated"><strong class="ih hj">在不启动spark应用程序的情况下，将spark表和查询与用Java Python等编写的应用程序连接起来</strong></li></ol><p id="938e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">启动节俭服务器</strong></p><p id="6a9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以在$SPARK_HOME/sbin下启动thriftserver</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es la"><img src="../Images/6cc1115014584b82bf6a3c4ba6852ef5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zXdCh9W7ZTig4gPzYgcZTQ.png"/></div></div></figure><p id="4765" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在启动thriftserver时，它将显示它将记录在一个文件中</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lb"><img src="../Images/ac37cc4a69268fd0c39379e5f0a47f54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ir8DUYi3PFsmNcmnYrjoBQ.png"/></div></div></figure><p id="2653" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在检查该文件时，我发现它在内部调用spark类，所以优点是我们可以用conf指定spark属性和start-thrift server</p><p id="fb3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">工作原理</strong></p><p id="d5f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它在内部调用hive thriftserver，并且默认情况下将暴露端口localhost:10000，我们可以向该端口发送sql查询以获取结果。spark thriftserver将使用指定的executor内存选项来运行查询</p><p id="fcfa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们必须使用-conf num-executors参数来增加executor，以改善延迟</p><p id="195e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以通过查看web ui来验证thriftserver是否启动，spark会显示它正在作为thrift server运行</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lc"><img src="../Images/9750621f5cff17243c24b73fc25f30cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vzuKScHm8pprnrVSwq4jkA.png"/></div></div></figure><p id="0cea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">连接Thift服务器和熊猫</strong></p><p id="254b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用pyhive来连接spark并执行spark sql查询</p><p id="5c66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们必须安装</p><p id="b393" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">pip安装pyhive</p><p id="7c55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">pip安装节约</p><p id="7156" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">pip安装节约_sasl</p><p id="27d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用pyhive创建配置单元连接对象</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ld"><img src="../Images/18042cc61f59c6e280b8fd97d02a8e65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*bVmi4u7CFPz2b5Mk42P_NQ.png"/></div></figure><p id="9fdd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将连接对象和配置单元查询传递给pandas.read_sql</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es le"><img src="../Images/fa2a22ac3cf4106809693a0f3a9c4ef3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*KV4QSHTDKonJTLxbLRDsRQ.png"/></div></figure><p id="a1aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">选择一个配置单元表</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lf"><img src="../Images/f8bb81a900546a48eac00259134c6b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1uxvFBECNeuOJ7g_8FSYgQ.png"/></div></div></figure><p id="6297" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">探索节俭服务器UI </strong></p><p id="3c7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Spark UI中的thrift server选项卡下，我们将执行查询，查询来自的IP和更多细节如下所示</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lg"><img src="../Images/c0b8c6a0489a44646e8cb30e463dad06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zZswKnnWqxQhflrHsLNEXA.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lh"><img src="../Images/88ce69bad127420f497e622d9ff2c616.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5UGE4QpI8z-uaSeDl1arow.png"/></div></div></figure><p id="566b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天就到这里吧！！:)</p><p id="b150" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Github链接:<a class="ae jt" href="https://github.com/SomanathSankaran/spark_medium/tree/master/spark_csv" rel="noopener ugc nofollow" target="_blank">https://github . com/SomanathSankaran/spark _ medium/tree/master/spark _ CSV</a></p><p id="9c9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"/></p><p id="744d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">学习并让别人学习！！</strong></p></div></div>    
</body>
</html>