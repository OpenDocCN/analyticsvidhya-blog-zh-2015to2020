<html>
<head>
<title>Preparing Madrid air quality data for analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">准备用于分析的马德里空气质量数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/preparing-madrid-air-quality-data-for-analysis-8820389a78ad?source=collection_archive---------15-----------------------#2020-05-19">https://medium.com/analytics-vidhya/preparing-madrid-air-quality-data-for-analysis-8820389a78ad?source=collection_archive---------15-----------------------#2020-05-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div class="er es hg"><img src="../Images/3093f84c18439e584e7d72728ad139b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*Jsxr5kYxM1exLttYStyR1A.jpeg"/></div><figcaption class="hn ho et er es hp hq bd b be z dx translated">被污染覆盖的马德里的可怕景象</figcaption></figure><div class=""/><div class=""><h2 id="f6bb" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated">对分析马德里空气质量数据感兴趣的人的一些预处理步骤</h2></div><p id="541b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi ke translated">疼痛是受新冠肺炎袭击最严重的国家之一。自3月份危机爆发以来，西班牙政府已经采取了多项措施来遏制疫情，将该国置于特殊的封锁状态。采取了强有力的社会距离措施，如教育机构停课、交通限制和停止任何非关键经济活动。经济瘫痪和对行动自由权的限制导致交通、工业活动和发电量急剧减少，因此<a class="ae kn" href="https://www.eea.europa.eu/highlights/air-pollution-goes-down-as" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">导致空气污染浓度</strong> </a> <strong class="jk hu">出现历史性下降。</strong></p><p id="4d9a" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我最近在西班牙网站Agenda Pública上发表了一篇<a class="ae kn" href="http://agendapublica.elpais.com/la-calidad-del-aire-en-madrid-en-tiempos-del-coronavirus/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">文章</strong> </a>，分析了COVID19危机期间马德里的空气质量数据。然而，<strong class="jk hu">本文的目的只是分享我用来准备分析数据的python代码，</strong>因为我相信它可以被回收，希望能为那些可能对使用马德里空气质量数据进行工作感兴趣的研究人员节省一些时间。</p><p id="0d53" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">像往常一样，完整的项目可以在我的GitHub <a class="ae kn" href="https://github.com/jcanalesluna/air_quality_madrid_covid19" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">资源库</strong> </a> <strong class="jk hu">中找到。</strong></p><h2 id="ed6c" class="ko kp ht bd kq kr ks kt ku kv kw kx ky jr kz la lb jv lc ld le jz lf lg lh li bi translated">准备用于分析的数据</h2><p id="0175" class="pw-post-body-paragraph ji jj ht jk b jl lj iu jn jo lk ix jq jr ll jt ju jv lm jx jy jz ln kb kc kd hb bi translated">马德里空气质量数据可在<a class="ae kn" href="https://datos.madrid.es/sites/v/index.jsp?vgnextoid=f3c0f7d512273410VgnVCM2000000c205a0aRCRD&amp;vgnextchannel=374512b9ace9f310VgnVCM100000171f5a0aRCRD" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">城市马德里的开放数据门户</strong> </a> <strong class="jk hu">获得。遍布全市的24个远程监测站监测着空气污染。在</strong> 中可以找到关于站点和被测气体和粒子的信息<a class="ae kn" href="https://datos.madrid.es/FWProjects/egob/Catalogo/MedioAmbiente/Aire/Ficheros/Interprete_ficheros_%20calidad_%20del_%20aire_global.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">。出于分析的目的，我使用了涵盖2010年至2020年期间(直到4月)的每日数据。</strong></a></p><p id="9b73" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">幸运的是，数据文件结构良好，并且有一个通用的格式。一旦我们下载了CSV，我们可以使用<strong class="jk hu"> glob将它们合并到一个数据帧中。</strong><a class="ae kn" href="https://docs.python.org/3/library/glob.html" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">glob</strong></a>模块查找与指定模式匹配的所有路径名在我们的例子中，我将所有文件保存在同一个路径中，并使用模式“datosxxxx . CSV”<em class="lo">，</em>是数据被监控的年份XXXX。下面的代码将读取路径中与模式匹配的所有文件，使用pandas read.csv函数读取它们并将它们连接起来。</p><figure class="lp lq lr ls fd hk"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="85a7" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">现在我们有了数据框架，是时候看看它的外观了。</p><figure class="lp lq lr ls fd hk er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es lv"><img src="../Images/2e4b349ddf9d8a262408ba78e0204c1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YS4l5GdZy82Ezl3m49MW5Q.png"/></div></div></figure><p id="2315" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">本质上，数据框架包含由城市中的24个监测站(ESTACION)收集的不同污染物的每日测量值(MAGNITUD)。一列表示年份(ANO)，另一列表示月份(MES)，还有一列表示一个月中的每一天(D01-D31)。每个日列都有一个相关的列(V01-V31)，表示测量是否有效(“V”表示测量有效，“N”表示测量无效)。关于变量的完整信息可以在  <strong class="jk hu">这里找到<a class="ae kn" href="https://github.com/jcanalesluna/air_quality_madrid_covid19/blob/master/README.md" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">。</strong></a></strong></p><p id="3017" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">由于我们的数据帧有无效的数据点，最好将它们设置为空值。为了只保留有效的测量值，我将使用函数<a class="ae kn" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.combine_first.html" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">【combine _ first】</strong></a><strong class="jk hu">，</strong><strong class="jk hu"/>通过用其他数据帧的非空值填充一个数据帧中的空值来组合两个数据帧对象。</p><p id="7be2" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">为了创建两个dataframe，我们可以使用正则表达式来标识匹配特定模式的列名(为了方便起见，我们将列名转换为小写)。我们希望确定每日测量值和每日测量值的有效性:</p><figure class="lp lq lr ls fd hk"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="2f7e" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">该代码将返回以下内容:</p><div class="lp lq lr ls fd ab cb"><figure class="ma hk mb mc md me mf paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><img src="../Images/55bead21d926cf1b4b49edca1e82830d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*8vTZkseXTh-0zcFcsYDCfw.png"/></div></figure><figure class="ma hk mg mc md me mf paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><img src="../Images/04dec5091ae5872bf9622eed3549405c.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*WAcVxKUA2WOoHfdLyA6juw.png"/></div></figure></div><p id="f06e" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">现在，我们只需在右侧数据框中为空值设置“V ”,并使用函数combine_first用左侧数据框中的测量值填充空值。一旦创建了now数据帧，剩余的“N”可以被设置为空。最后，我们可以添加剩余的列。</p><figure class="lp lq lr ls fd hk"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="7643" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">接下来，我们希望通过用日期替换单独一列中的日、年和日来简化数据框架。这将允许我们以后利用日期时间格式的力量。</p><figure class="lp lq lr ls fd hk"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="9535" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">在这一步之后，我们的数据框架看起来更有吸引力:</p><figure class="lp lq lr ls fd hk er es paragraph-image"><div class="er es mh"><img src="../Images/7fec4a22c6d007c54f2329bd3a0c2a71.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/format:webp/1*tGIbGwSn6tEjEiNTXlXJaA.png"/></div></figure><p id="c99f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">然而，仍有一些改进的余地。在许多情况下，我们可能对获得每个站点的空气质量数据不感兴趣，而是以一种汇总的方式。因此，我们可以使用函数<strong class="jk hu"> groupby </strong>来获得每种污染物的日平均排放量。</p><figure class="lp lq lr ls fd hk"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="4ef0" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">最后，我们可以使用函数<strong class="jk hu"> pivot </strong>根据‘magnitude’中的列值生成新的列。新列将代表不同污染物的测量值。识别每种污染物的数字代码可以在  <strong class="jk hu">这里找到<a class="ae kn" href="https://datos.madrid.es/FWProjects/egob/Catalogo/MedioAmbiente/Aire/Ficheros/Interprete_ficheros_%20calidad_%20del_%20aire_global.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">。</strong></a></strong></p><figure class="lp lq lr ls fd hk"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="6e48" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">最后，我们可以将日期索引转换成DateTime格式。生成的数据帧将如下所示:</p><figure class="lp lq lr ls fd hk er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mi"><img src="../Images/7f446ce74623b22998d8e76fb698d255.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HhG9QDyNPEfcD4J0rFaGDg.png"/></div></div></figure><p id="a255" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">希望这些简单的预处理步骤能对任何有兴趣分析马德里空气质量数据的人有所帮助。</p></div></div>    
</body>
</html>