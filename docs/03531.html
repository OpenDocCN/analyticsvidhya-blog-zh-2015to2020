<html>
<head>
<title>PREDICTING ELECTRICITY</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测电力</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/predicting-electricity-3700b8c4458?source=collection_archive---------10-----------------------#2020-02-06">https://medium.com/analytics-vidhya/predicting-electricity-3700b8c4458?source=collection_archive---------10-----------------------#2020-02-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ff2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">沙特中央作业区用电负荷</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/8a55ca8edcaaff8f326cddb16b49b999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_zcNZRV2maQ3e7OKhv_JMw.jpeg"/></div></div></figure><h1 id="fc93" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">项目定义</h1><h2 id="2179" class="ko jr hi bd js kp kq kr jw ks kt ku ka iq kv kw ke iu kx ky ki iy kz la km lb bi translated">项目概述</h2><p id="0382" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">我的任务是建立机器学习模型，可以预测和预测中央运营区(COA)的电力消耗。</p><p id="c32c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我得到了一个数据集的样本，如下</p><p id="fbe8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">项目数据</strong></p><ul class=""><li id="5d70" class="lh li hi ih b ii ij im in iq lj iu lk iy ll jc lm ln lo lp bi translated">沙特中央作业区的每小时电力需求。</li><li id="49b0" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">涵盖2012年至2017年。</li><li id="99c4" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">共找到52，607项记录。</li></ul><p id="c979" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在我的<a class="ae lv" href="https://github.com/IbrahimYahyaHakami/Data-Science-Udacity-capstone" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中找到数据集。</p><p id="5113" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">利益相关方</strong></p><p id="8e24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我试图准确预测电力需求，并希望将我的发现呈现给感兴趣的利益相关者，这些利益相关者要么推动政策，要么与沙特阿拉伯的电力部门相关。</p><p id="6dd6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">接近</strong></p><p id="a8e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于计算领域的最新进展，特别是机器学习和数据科学，我们现在可以接近准确地预测长期、中期和短期的用电量。</p><h2 id="0e7b" class="ko jr hi bd js kp kq kr jw ks kt ku ka iq kv kw ke iu kx ky ki iy kz la km lb bi translated"><strong class="ak">问题陈述</strong></h2><ul class=""><li id="241f" class="lh li hi ih b ii lc im ld iq lw iu lx iy ly jc lm ln lo lp bi translated">用电消耗一个国家的资源，特别是沙特阿拉伯。</li><li id="ce15" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">因此，对其进行长期、中期和短期预测，对于更好地估计将使用多少资源以及推动电网扩展政策至关重要。</li></ul><h2 id="98f5" class="ko jr hi bd js kp kq kr jw ks kt ku ka iq kv kw ke iu kx ky ki iy kz la km lb bi translated">韵律学</h2><p id="1e2c" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">我将使用均方根误差作为主要得分指标，这是预测的常用指标，我还将使用r2得分，因为它更容易理解。</p><h1 id="af60" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">分析</h1><h2 id="0eed" class="ko jr hi bd js kp kq kr jw ks kt ku ka iq kv kw ke iu kx ky ki iy kz la km lb bi translated">数据探索和可视化</h2><p id="6bcc" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">首先让我们快速看一下数据帧的头部</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="3da1" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># load and shoe 1st 5 rows of data</em><br/>df = pd.read_csv('../dataset/full_COA_v3.csv')<br/>df.head()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mi"><img src="../Images/6a9279426b54c6fac5ab651ce596bebd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2v4tS_uE-0JiiHcaOsNjag.png"/></div></div></figure><p id="7d64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们做一些可视化，这将导致对数据的理解。</p><p id="7d05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，为了更好地可视化，我将在前置后使用数据框，前置将在后面讨论。</p><p id="3f7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前置后的数据集将包含以下内容</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mj"><img src="../Images/31186b51969a1d151146793fe66a9928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CBuGeGisA3tv1fdZJ-sTXw.png"/></div></div></figure><p id="4a8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">箱线图</strong></p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="a8f4" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># Showing boxplots</em><br/>plt.figure(figsize=(14,5))<br/>plt.subplot(1,2,1)<br/>plt.subplots_adjust(wspace=0.2)<br/>sns.boxplot(x="year", y="COA", data=df)<br/>plt.xlabel('year')<br/>plt.ylabel('Power Demand (MWh)')<br/>plt.title('Box plot of Yearly COA Power Demand MWh')<br/>sns.despine(left=<strong class="ma hj">True</strong>)<br/>plt.tight_layout()<br/>plt.subplot(1,2,2)<br/>sns.boxplot(x="quarter", y="COA", data=df)<br/>plt.xlabel('quarter')<br/>plt.ylabel('Power Demand (MWh)')<br/>plt.title('Box plot of Quarterly COA Power Demand MWh')<br/>sns.despine(left=<strong class="ma hj">True</strong>)<br/>plt.tight_layout();</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mk"><img src="../Images/9b6bf005287e54206e600aa50eac5580.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pNUaLK8IQDMKh_a1uAVDSQ.png"/></div></div></figure><p id="1db6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:多年来电力需求的增长趋势，也是逐季度显示第3季度的需求最大，与其他国家不同，沙特阿拉伯国家的需求高峰在夏季。</p><p id="51e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">不同时间段的电力需求</strong></p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="779b" class="ko jr hi ma b fi me mf l mg mh">plt.figure(figsize=(14,8))<br/>plt.subplot(2,2,1)<br/>df.groupby('year').COA.agg('mean').plot()<br/>plt.xlabel('')<br/>plt.title('Mean COA Power Demand by Year (MWh)')<br/>plt.ylabel('Power Demand (MWh)')<br/><br/>plt.subplot(2,2,2)<br/>df.groupby('quarter').COA.agg('mean').plot()<br/>plt.xlabel('')<br/>plt.title('Mean COA Power Demand by Quarter (MWh)')<br/><br/>plt.subplot(2,2,3)<br/>df.groupby('month').COA.agg('mean').plot()<br/>plt.xlabel('')<br/>plt.title('Mean COA Power Demand by Month (MWh)')<br/>plt.ylabel('Power Demand (MWh)')<br/><br/>plt.subplot(2,2,4)<br/>df.groupby('day').COA.agg('mean').plot()<br/>plt.xlabel('')<br/>plt.title('Mean COA Power Demand by Day (MWh)');</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ml"><img src="../Images/f25bdf45fc0f6f0a6153448c84ee97cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F9HK6NAARNfEILciSzPL0w.png"/></div></div></figure><p id="0dcc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:顶部的两个图显示了与箱形图相似的洞察力，而按月分组显示了一年的趋势，最后按日分组显示了一个月的趋势。</p><p id="87f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">季节性检查</strong></p><p id="bec0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我想展示一下数据集中的季节性，我们将看到电力消耗是如何趋向于流行和季节性的。</p><p id="860f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">季节性对于以后选择模型的参数非常重要。</p><p id="bb94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">年度季节性</strong></p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="6bf4" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># Showing Yearly seasonality</em><br/><em class="jd"># Yearly seasonality is clear in the plot</em><br/>df['2012-01-01':'2015-01-01'].COA.plot(figsize=(15,5))<br/>plt.axvline('2013-01-01' , c='r')<br/>plt.axvline('2014-01-01',c='r')</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mm"><img src="../Images/4b29aaf61fb5e6e9590b536459606493.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PTifCcTgSlkjR0Ql4WeXAg.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">功率需求(MWh)与时间的关系</figcaption></figure><p id="b91d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:每年的趋势几乎相同</p><p id="9775" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">弱季节性</strong></p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="5c3d" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># Showing weekly seasonality</em><br/><em class="jd"># Weekly seasonality is clear in the plot</em><br/>df['2012-02-01':'2012-4-01'].COA.plot(figsize=(15,5))<br/>plt.axvline('2012-03-02' , c='r')<br/>plt.axvline('2012-03-09',c='r')</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mr"><img src="../Images/8bc0f06544d8d8afef72e977014fd87e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*72qHdm26jx08EPYUnYAT0g.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">功率需求(MWh)与时间的关系</figcaption></figure><p id="4491" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:工作日比周末有更多的需求，这可能是一些工厂放假的结果。</p><p id="b244" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">每日季节性</strong></p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="03e9" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># Showing daily seasonality </em><br/><em class="jd"># Daily seasonality is clear in the plot</em><br/>df['2012-01-01 01:00:00':'2012-01-03 01:00:00'].COA.plot(figsize=(15,5))<br/>plt.axvline('2012-01-02 00:00:00' , c='r')<br/>plt.axvline('2012-01-03 00:00:00' , c='r')</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ms"><img src="../Images/c004559605971502f1637d0007663082.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KRzSkK69NPdqthQWBcbleA.png"/></div></div></figure><p id="eec3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:明显的季节性和高峰在下午6点，这是在人们下班回家之后。</p><h1 id="a476" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">方法学</h1><h2 id="477b" class="ko jr hi bd js kp kq kr jw ks kt ku ka iq kv kw ke iu kx ky ki iy kz la km lb bi translated">数据预处理</h2><p id="9b2e" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">由于我的电气工程背景，我能够想出一些我认为与电力消耗高度相关的特征，并开始寻找获得这些特征的方法。</p><p id="6b6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，这是我拥有的数据集的标题</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="3a67" class="ko jr hi ma b fi me mf l mg mh">df = pd.read_csv('dataset/demand_dataframe.csv')[['Time' ,'COA']]<br/>df.head()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mt"><img src="../Images/291bc3ffa4a00c888f0ee7cfcd5e40ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:428/format:webp/1*ER__WW1ojLva5t-nxx6OZg.png"/></div></figure><p id="f09c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，重要的是要确保日期格式正确，以便pandas将日期更改为日期时间对象。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="10c0" class="ko jr hi ma b fi me mf l mg mh">df.index = pd.to_datetime(df.index, format="<strong class="ma hj">%d</strong>-%m-%y %H:%M" , dayfirst=<strong class="ma hj">True</strong>)<br/>df.tail()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mu"><img src="../Images/a0974c1ce738e112d2f22b0b0b49ceef.png" data-original-src="https://miro.medium.com/v2/resize:fit:494/format:webp/1*sr8Q-4GWGgC-uacGhtAjyA.png"/></div></figure><p id="6257" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步有点挑战性，所以我知道温度是非常重要的特性，所以我需要与电力消耗数据集相同时间段的天气数据。</p><p id="cead" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用<a class="ae lv" href="https://darksky.net/dev" rel="noopener ugc nofollow" target="_blank"> Darksky </a> API从位于机场的利雅得城市传感器提取天气数据，我能够提取每小时的天气数据</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="7711" class="ko jr hi ma b fi me mf l mg mh">df_temp = pd.read_csv('../dataset/df_weather2012-2018.csv')[['time' , 'temperature','dewPoint','humidity','windSpeed']]<br/>df_temp.head()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mv"><img src="../Images/910dedef4412b295acc7c2118bd9d7b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*-9vG8P4o22N21n-JuKsQbA.png"/></div></figure><p id="5128" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是用下面的代码将时间戳转换成日期</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="52d2" class="ko jr hi ma b fi me mf l mg mh">df_temp['Time']=df_temp.time.map(<strong class="ma hj">lambda</strong> x: time.strftime("%Y-%m-<strong class="ma hj">%d</strong> %H:%M:%S", time.localtime(x)))<br/>df_temp.head()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mw"><img src="../Images/a4f5ba70ec7e9eb6fb4193e76e6614fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9QxKZrC0cT4Q0gPrg0Jb3w.png"/></div></div></figure><p id="4c7d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">，但是数据框中缺少一些小时，并且没有标记为空，所以我无法将其与主数据框合并，因为它具有不同的形状。</p><p id="02de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我提出的解决方案如下，我制作了一个测试数据框，它包含与主数据框相同的日期范围。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="7e5b" class="ko jr hi ma b fi me mf l mg mh">df_test = pd.DataFrame(pd.date_range('2012-01-01 01:00:00' , '2017-12-31 23:00:00' , freq='1H') , columns=['Time'])<br/>df_test.head()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mx"><img src="../Images/40e14d5a244b64b49ab50535d9f9c53b.png" data-original-src="https://miro.medium.com/v2/resize:fit:408/format:webp/1*G9u0_Qf2oYR2vFTw-bkqig.png"/></div></figure><p id="62a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后将其与天气数据框合并，以获得预期的缺失日期的空值。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="062e" class="ko jr hi ma b fi me mf l mg mh">df_t = df_temp['2012-01-01 01:00:00':'2017-12-31 23:00:00'].merge(df_test , how = 'outer' ,on = 'Time' ).sort_values('Time')<br/>df_t.isnull().sum()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es my"><img src="../Images/cb1a2e9c8057cc103d404f0ff1de0539.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/format:webp/1*9e0fHFuvlItydn6DgqvaCA.png"/></div></figure><p id="bde7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还要确保两个数据帧具有相同的长度。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mz"><img src="../Images/5e53d1788f3abbc54fc27d2ebe773f46.png" data-original-src="https://miro.medium.com/v2/resize:fit:228/format:webp/1*ENqP4oJuh9qRrZ-d3YmLCA.png"/></div></figure><p id="bfec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">至于空值，经过一些探索后，我注意到所有的空值恰好连续3到5个小时，这对于传感器停机一段时间然后得到修复是有意义的，所以我用向前填充来填充缺失的值，因为3个小时内是否会保持不变。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="6c18" class="ko jr hi ma b fi me mf l mg mh">df_t.fillna(method='ffill' , inplace=<strong class="ma hj">True</strong>)</span></pre><p id="cf8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我可以将它们合并在一起</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="901e" class="ko jr hi ma b fi me mf l mg mh">df_l['temp'] = df_t.temperature.values<br/>df_l['dewPoint'] = df_t.dewPoint.values<br/>df_l['humidity'] = df_t.humidity.values<br/>df_l['windSpeed'] = df_t.windSpeed.values</span></pre><p id="17a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可能认为我在这里停下来是为了这些特性，但是我仍然添加了更多的特性。</p><p id="7628" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一些数据工程的时间，从日期时间对象添加其他列。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="8e45" class="ko jr hi ma b fi me mf l mg mh">df_l['year'] = df_l['Time'].apply(<strong class="ma hj">lambda</strong> x: x.year)<br/>df_l['quarter'] = df_l['Time'].apply(<strong class="ma hj">lambda</strong> x: x.quarter)<br/>df_l['month'] = df_l['Time'].apply(<strong class="ma hj">lambda</strong> x: x.month)<br/>df_l['day'] = df_l['Time'].apply(<strong class="ma hj">lambda</strong> x: x.day)<br/>df_l.sort_values('Time', inplace=<strong class="ma hj">True</strong>, ascending=<strong class="ma hj">True</strong>)<br/>df_l["weekday"]=df_l.apply(<strong class="ma hj">lambda</strong> row: row["Time"].weekday(),axis=1)<br/>df_l["weekday"] = df_l["weekday"].astype(str)<br/>df_l['weekday_name']=df_l.index.strftime("%A")<br/>df_l['hour_24']=df_l.index.strftime("%H") df_l['weekday_no']=df_l.index.map(<strong class="ma hj">lambda</strong> x:x.weekday())</span></pre><p id="4811" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">周末和工作日这一列有些棘手，因为在沙特阿拉伯，我们在2013年更改了周末，所以我必须查找日期并相应地标记它们。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="6802" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># Define an empty column in the df_l dataframe</em><br/>df_l['weekend_bool'] = pd.Series()<br/>  <em class="jd"><br/># Setting up the weekend boolean for the Thursday &amp; Friday weekend (Before 29-6-2013)</em> df_l['weekend_bool'][df_l.Time &lt;='2013-06-29']=df_l.weekday_no.apply(<strong class="ma hj">lambda</strong> x: int(1) <strong class="ma hj">if</strong> x==3 <strong class="ma hj">or</strong> x==4 <strong class="ma hj">else</strong> int(0))  <em class="jd"># Setting up the weekend boolean for the Friday &amp; Saterday weekend (After 29-6-2013)</em> df_l['weekend_bool'][df_l.Time &gt;='2013-06-29']=df_l.weekday_no.apply(<strong class="ma hj">lambda</strong> x: int(1) <strong class="ma hj">if</strong> x==4 <strong class="ma hj">or</strong> x==5 <strong class="ma hj">else</strong> int(0))</span></pre><p id="ccd6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后一栏是学校假期，我查找了所有有学校假期的日期，并相应地标注出来。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="05a3" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># Below are the school vacations during the years 2012-2017 to be added to the school vacation feature</em><br/><br/>df_l['school_vacation'][(df_l.Time &gt;='2012-01-19')&amp;(df_l.Time &lt;'2012-01-28')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2012-03-22')&amp;(df_l.Time &lt;'2012-03-31')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2012-06-07')&amp;(df_l.Time &lt;'2012-09-01')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2012-09-23')&amp;(df_l.Time &lt;'2012-09-24')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2012-10-18')&amp;(df_l.Time &lt;'2012-11-02')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2013-01-17')&amp;(df_l.Time &lt;'2013-01-26')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2013-03-21')&amp;(df_l.Time &lt;'2013-03-30')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2013-06-06')&amp;(df_l.Time &lt;'2013-09-01')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2013-09-23')&amp;(df_l.Time &lt;'2013-09-24')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2013-10-10')&amp;(df_l.Time &lt;'2013-10-21')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2014-01-17')&amp;(df_l.Time &lt;'2014-01-26')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2014-03-21')&amp;(df_l.Time &lt;'2014-03-30')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2014-06-06')&amp;(df_l.Time &lt;'2014-08-31')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2014-09-23')&amp;(df_l.Time &lt;'2014-09-24')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2014-09-30')&amp;(df_l.Time &lt;'2014-10-12')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2015-01-16')&amp;(df_l.Time &lt;'2015-01-25')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2015-03-20')&amp;(df_l.Time &lt;'2015-03-29')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2015-06-05')&amp;(df_l.Time &lt;'2015-08-23')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2015-09-18')&amp;(df_l.Time &lt;'2015-10-04')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2016-01-08')&amp;(df_l.Time &lt;'2016-01-17')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2016-03-11')&amp;(df_l.Time &lt;'2016-03-20')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2016-05-26')&amp;(df_l.Time &lt;'2016-09-18')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2016-09-22')&amp;(df_l.Time &lt;'2016-09-23')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2016-11-09')&amp;(df_l.Time &lt;'2016-11-20')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2017-01-27')&amp;(df_l.Time &lt;'2017-02-05')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2017-03-29')&amp;(df_l.Time &lt;'2017-04-09')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2017-06-16')&amp;(df_l.Time &lt;'2017-09-17')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)<br/>df_l['school_vacation'][(df_l.Time &gt;='2017-09-24')&amp;(df_l.Time &lt;'2017-09-25')]=df_l.school_vacation.apply(<strong class="ma hj">lambda</strong> x: 1)</span><span id="17f1" class="ko jr hi ma b fi na mf l mg mh"><em class="jd"># filling empty school vacation days with 0</em><br/>df_l.school_vacation.fillna(0,inplace=<strong class="ma hj">True</strong>)</span></pre><p id="ceec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我终于停止了自我，去实现，</p><h2 id="f114" class="ko jr hi bd js kp kq kr jw ks kt ku ka iq kv kw ke iu kx ky ki iy kz la km lb bi translated">履行</h2><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es nb"><img src="../Images/f83fca9dd895bf8cbf9cc4a666fdfa9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xEM626aBXOGgvvOQMOTfAA.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">来源:<a class="ae lv" href="https://ethicaljournalismnetwork.org/artificial-intelligence-human-rights-democracy-law" rel="noopener ugc nofollow" target="_blank">https://ethicaljournalism network . org/人工智能-人权-民主-法律</a></figcaption></figure><p id="e01e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一节中，我将介绍我在做预测时的思维过程，选择我做预测的方式，并展示结果。</p><p id="9ddc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我选择了2012年到2016年底这几年作为训练数据，并尝试对2017年进行预测。</p><p id="9586" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在选择预测方法之前，我选择查看所有特征与电力消耗的相关性</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="4c1c" class="ko jr hi ma b fi me mf l mg mh"><em class="jd">#COA correlation matrix</em><br/>corrmat = abs(df_l.drop(columns=['Time']).iloc[:df_l.drop(columns=['Time']).shape[0],:].corr())<br/>plt.figure(figsize=(17, 8))<br/>k = 10 <em class="jd">#number of variables for heatmap</em><br/>cols = corrmat.nlargest(k, 'COA')['COA'].index<br/>cm = np.corrcoef(df_l.drop(columns=['Time']).iloc[:df_l.drop(columns=['Time']).shape[0],:][cols].values.T)<br/>sns.set(font_scale=1.50)<br/>hm = sns.heatmap(cm, cbar=<strong class="ma hj">True</strong>, annot=<strong class="ma hj">True</strong>, square=<strong class="ma hj">True</strong>,<br/>                 fmt='.2f', annot_kws={'size': 10}, yticklabels=cols.values, xticklabels=cols.values,<br/>                 cmap = 'RdBu', linecolor = 'white', linewidth = 1)<br/>plt.title("Correlations between COA and k features", fontsize =15)<br/>plt.show()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es nc"><img src="../Images/12df35f33133495d5492723f2b0e3f0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*tGurRzJ4e__NXqATds5P1A.png"/></div></figure><p id="7388" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:与温度和湿度高度相关。与学校假期显著相关。</p><p id="4587" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于具有高度相关的特征，我选择做回归和时间序列模型。</p><p id="8696" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">预测方法学</strong></p><p id="372b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我尝试了不同时间段的不同模型，并假设沙特电力公司(SEC)会对短期和长期预测感兴趣，因此我将数据分组以进行预测，如下所示:</p><ul class=""><li id="937b" class="lh li hi ih b ii ij im in iq lj iu lk iy ll jc lm ln lo lp bi translated">明年的每小时预测</li><li id="f4df" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">每日预测</li><li id="f3f7" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">月度预测</li><li id="201b" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">第二天每小时预测</li></ul><p id="e8d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">使用的型号</strong></p><p id="bd50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用的模型是:</p><ul class=""><li id="2431" class="lh li hi ih b ii ij im in iq lj iu lk iy ll jc lm ln lo lp bi translated">带有外生回归量的季节性自回归综合移动平均数</li><li id="1428" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">RNN·LSTM细胞(长短期记忆)</li><li id="b039" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">先知</li><li id="c59d" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">XGBoost(极限梯度提升)</li><li id="fd5f" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">lightGBM(一种高效的梯度推进决策树)</li></ul><p id="67b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">整点数据预测</strong></p><p id="8e7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在每小时数据中，我们将使用预处理后的数据框。</p><p id="3024" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> LSTM </strong></p><p id="ec9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先我们要拆分数据来训练和测试，我们要得到数据帧的长度和一个要拆分的长度。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="641f" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># length of dataset</em><br/>l_df = len(df_l)</span><span id="fc1d" class="ko jr hi ma b fi na mf l mg mh"><em class="jd"># length to split</em><br/>l_split = len(df_l['2017-01-01 00:00:00':])</span></pre><p id="cd57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建训练和测试分割</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="b1b1" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># train test split</em><br/>dataset = df_l.COA.values <em class="jd">#numpy.ndarray</em><br/>dataset = dataset.astype('float32') <em class="jd"># make sure values are float</em><br/>dataset = np.reshape(dataset, (-1, 1)) <em class="jd"># reshape to vertical</em><br/>scaler = MinMaxScaler(feature_range=(0, 1)) <em class="jd"># define minmax scaler</em><br/>train_size = l_df-l_split <br/>test_size = len(dataset) - train_size<br/>train, test = scaler.fit_transform(dataset[0:train_size,:]), scaler.transform(dataset[train_size:len(dataset),:]) <em class="jd"># scale data</em></span></pre><p id="9a9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个函数是LSTM的基础，它将使回望决定用于预测目标的滞后数。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="fe53" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># convert an array of values into a dataset matrix</em><br/><strong class="ma hj">def</strong> create_dataset(dataset, look_back=1):<br/>    X, Y = [], []<br/>    <strong class="ma hj">for</strong> i <strong class="ma hj">in</strong> range(len(dataset)-look_back-1):<br/>        a = dataset[i:(i+look_back), 0]<br/>        X.append(a)<br/>        Y.append(dataset[i + look_back, 0])<br/>    <strong class="ma hj">return</strong> np.array(X), np.array(Y)</span></pre><p id="1077" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为训练和测试创建特征和目标。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="6d30" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># reshape into X=t and Y=t+1</em><br/>look_back = 1<br/>X_train, Y_train = create_dataset(train, look_back)<br/>X_test, Y_test = create_dataset(test, look_back)</span></pre><p id="baef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">重塑要素，为LSTM做好准备</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="a3ba" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># reshape input to be [samples, time steps, features]</em><br/>X_train = np.reshape(X_train, (X_train.shape[0], 1, X_train.shape[1]))<br/>X_test = np.reshape(X_test, (X_test.shape[0], 1, X_test.shape[1]))</span></pre><p id="ada5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">网络体系结构</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="b5a1" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># network architecture</em><br/>model = Sequential()<br/>model.add(LSTM(200, input_shape=(X_train.shape[1], X_train.shape[2])))<br/>model.add(Dropout(0.2))<br/>model.add(Dense(50, activation='relu'))<br/>model.add(Dropout(0.2))<br/><em class="jd"># model.add(Dense(15, activation='relu'))</em><br/><em class="jd"># model.add(Dropout(0.2))</em><br/>model.add(Dense(1))<br/>opt = optimizers.Adam(lr=.001)<br/>model.compile(loss='mean_squared_error', optimizer=opt)</span><span id="af3b" class="ko jr hi ma b fi na mf l mg mh">history = model.fit(X_train, Y_train, epochs=30, batch_size=24, validation_data=(X_test, Y_test), <br/>                    callbacks=[EarlyStopping(monitor='val_loss', patience=5)], verbose=1, shuffle=<strong class="ma hj">False</strong>)</span><span id="c325" class="ko jr hi ma b fi na mf l mg mh"><em class="jd"># Training Phase</em><br/>model.summary()</span></pre><p id="5cde" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用训练好的模型进行预测，并将缩放后的数据反演回正常值。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="5e94" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># make predictions</em><br/>train_predict = model.predict(X_train)<br/>test_predict = model.predict(X_test)<br/><em class="jd"># invert predictions</em><br/>train_predict = scaler.inverse_transform(train_predict)<br/>Y_train = scaler.inverse_transform([Y_train])<br/>test_predict = scaler.inverse_transform(test_predict)<br/>Y_test = scaler.inverse_transform([Y_test])</span></pre><p id="46d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">绘制列车和测试损失图</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="46ee" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># plotting train and test loss</em><br/>plt.figure(figsize=(8,4))<br/>plt.plot(history.history['loss'], label='Train Loss')<br/>plt.plot(history.history['val_loss'], label='Test Loss')<br/>plt.title('model loss')<br/>plt.ylabel('loss')<br/>plt.xlabel('epochs')<br/>plt.legend(loc='upper right')<br/>plt.show();</span></pre><p id="f0bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了绘制训练和测试，我们希望为两者制作数据框，以便于绘制。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="5fca" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># make data frame for test </em><br/>tes = pd.DataFrame(Y_test.reshape(Y_test.shape[1],Y_test.shape[0]) , columns=['test'] , index= df_l.iloc[train_size+look_back:-1].index)</span><span id="3912" class="ko jr hi ma b fi na mf l mg mh"><em class="jd"># make data frame for prediction</em><br/>pre = pd.DataFrame(test_predict , columns=['pred'] , index= df_l.iloc[train_size+look_back:-1].index)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es nd"><img src="../Images/cd2f369ef5b5126fbddac5b959a1bef7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bX5Fi2TG8k-jFyE9wtpMCQ.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">LSTM每小时预测值与实际值(MWh)</figcaption></figure><p id="c2d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:LSTM在巨大数据集上的表现确实不错。</p><p id="69d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">先知</strong></p><p id="fca4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Prophet要求我们将日期重命名为“ds ”,将预测目标重命名为“y”。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="fdf3" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># reset index to prepare data frame for prophet</em><br/>df_l = df_l.reset_index()</span><span id="cbbf" class="ko jr hi ma b fi na mf l mg mh"><em class="jd"># rename columns to prepare it for prophet</em><br/>df_l = df_l.rename(columns = {'Time':'ds',<br/>                      'COA':'y'})</span></pre><p id="6102" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">把我们的数据拆分出来进行训练和测试。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="e12a" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># define a length to split, split last year</em><br/>l_split = len(df_l[df_l.ds &gt;= '2017-01-01 00:00:00'])</span><span id="78dc" class="ko jr hi ma b fi na mf l mg mh"><em class="jd"># split by pre defined length</em><br/>train = df_l.iloc[:(len(df_l)-l_split)]<br/>test = df_l.iloc[(len(df_l)-l_split):]</span></pre><p id="43e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Prophet允许我们添加来自同一数据框架的回归量，然后训练模型。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="5f89" class="ko jr hi ma b fi me mf l mg mh">model = Prophet(seasonality_mode='multiplicative')<br/>model.add_regressor('temp')<br/>model.add_regressor('year')<br/>model.add_regressor('quarter')<br/>model.add_regressor('month')<br/>model.add_regressor('day')<br/>model.add_regressor('weekday_0')<br/>model.add_regressor('weekday_1')<br/>model.add_regressor('weekday_2')<br/>model.add_regressor('weekday_3')<br/>model.add_regressor('weekday_4')<br/>model.add_regressor('weekday_5')<br/>model.add_regressor('weekday_6')<br/>model.fit(train)</span></pre><p id="0ee7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">制作一个包含我们预测的数据帧，然后使用该模型对该数据帧进行预测，或者您可以在删除目标后使用测试数据帧。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="8f6f" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># make data frame to hold the prediction</em><br/>future = model.make_future_dataframe(periods=24 , freq='H')</span><span id="0f8a" class="ko jr hi ma b fi na mf l mg mh"><em class="jd"># make prediction on the data frame made </em><br/>forecast = model.predict(test.drop(columns=['y']))</span></pre><p id="977a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用测试和预测数据帧来绘制它们之间的关系。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="6082" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># make a seperate data set for prediction only</em><br/>predictions = forecast[['ds','yhat']][forecast.ds &gt;='2017']</span><span id="546c" class="ko jr hi ma b fi na mf l mg mh"><em class="jd"># set time as index</em><br/>predictions = predictions.set_index('ds')<br/>test = test.set_index('ds')</span><span id="2f59" class="ko jr hi ma b fi na mf l mg mh"><em class="jd"># plot test vs prediction</em><br/>test.y.plot(legend=<strong class="ma hj">True</strong>,figsize=(12,5))<br/>predictions.yhat.plot(legend=<strong class="ma hj">True</strong>)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ne"><img src="../Images/0b9161d44cece9768725972ae440776d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4qPbDkQL7S3XmhvE7MIs_g.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">Prophet每小时预测值与实际值(MWh)</figcaption></figure><p id="6865" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:prophet能够捕获每年的季节性，但不能捕获其他季节性。</p><p id="6fb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">每日预测</strong></p><p id="89fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在每日预测中，我们希望使用panda的时间重采样方法将我们的数据分组为每日记录。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="7ab2" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># resample data to daily data</em><br/>df_d = df_l.resample(rule = 'D').mean()</span></pre><p id="5c8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> LSTM </strong></p><p id="f6c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之前针对LSTM讨论的相同代码也将在这里用于每日数据集，并将为我们产生以下预测与实际。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es nd"><img src="../Images/5e7b352954db03ea968702b504b98273.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*807s2EFrQYpTsu5cWef_Jg.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">LSTM每日预测与实际(MWh)</figcaption></figure><p id="5f6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:其他来自LSTM的非常好的表现。</p><p id="e301" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">先知</strong></p><p id="ef6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之前针对prophet讨论的相同代码也将在这里用于每日数据集，并将为我们产生以下预测与实际。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ne"><img src="../Images/59dceaa22fe7415c481b57fb352bc0a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5eoSnFpRDcOxWU5mgvwozw.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">预言者每日预测与实际(MWh)</figcaption></figure><p id="74b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:再次捕捉每年的季节性，但不能捕捉其他。</p><p id="3203" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">月度预测</strong></p><p id="bdf3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在月度预测中，我们希望使用panda的时间重采样方法将我们的数据分组为月度记录。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="1b8e" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># resample data to daily data</em><br/>df_m = df_l.resample(rule = 'MS').mean()</span></pre><p id="7d80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> LSTM </strong></p><p id="e746" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之前针对LSTM讨论的相同代码也将用于月度数据集中，并将为我们提供以下预测与实际数据对比。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es nd"><img src="../Images/054032dcc6a96c5d453d757df2345ea2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XWEM6pb2f2_5QWp-op1SNQ.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">LSTM月度预测与实际(MWh)</figcaption></figure><p id="bd69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:我们可以看到LSTM开始比其他组表现差。</p><p id="edd4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">先知</strong></p><p id="f6ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之前讨论的prophet的相同代码也将在这里用于月度数据集，并将为我们产生以下预测与实际。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ne"><img src="../Images/76a06927e2f558f833301e6e956a07a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jOCg07yGDdJ4SdQ_VtMiAg.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">预言家每月预测与实际(MWh)</figcaption></figure><p id="7898" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:prophet出色地捕捉到了每月的季节性。</p><p id="9a1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">萨里马克斯</strong></p><p id="a06b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于SARIMAX，检查季节性以选择正确的参数非常重要。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="41c6" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># plot whole data</em><br/>df_m.COA.plot(figsize=(15,5)).autoscale(axis='x',tight=<strong class="ma hj">True</strong>)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es nf"><img src="../Images/b73355322d5dc6f990c2f0a94831f0ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9fWmJmwXlDtiIuYYwcxq2Q.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">COA与时间</figcaption></figure><p id="7982" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的月度数据中，我们可以清楚地看到每年的季节性，这为我们选择SARIMAX模型的参数提供了一个思路。</p><p id="9d45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我将选择一个长度进行分割，然后分割数据进行训练和测试。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="5f44" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># length to split</em><br/>l_split = len(df_m['2017-01-01 00:00:00':])</span><span id="d3d4" class="ko jr hi ma b fi na mf l mg mh"><em class="jd"># split by pre defined length</em><br/>train = df_m.COA.iloc[:(len(df_m)-l_split)]<br/>test = df_m.COA.iloc[(len(df_m)-l_split):]</span></pre><p id="8f4f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将计算SARIMAX模型预测的起点和终点，起点在训练数据之后，终点在测试之后。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="42ba" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># define start and end of prediction</em><br/>start = len(train)<br/>end = len(train) + len(test) - 1</span></pre><p id="bda8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">auto arima非常有助于为我们的SARIMAX模型找到最佳参数，它将对所有参数进行网格搜索，即P、D、Q、P、D和Q，并返回产生最少<a class="ae lv" href="https://www.sciencedirect.com/topics/social-sciences/akaike-information-criterion" rel="noopener ugc nofollow" target="_blank"> Akaike信息标准(AIC) </a>的顺序。</p><p id="4e79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，我将选择m = 12，这是因为月度数据之前显示的季节性是每年的，这在我们的月度数据中每12个数据点发生一次。</p><p id="70bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">m参数选择正确是最重要的。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="a276" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"> stepwise_model = auto_arima(train,</em><br/><em class="jd">                            m=12,</em><br/><em class="jd">                            trace=True,</em><br/><em class="jd">                            error_action='ignore',  </em><br/><em class="jd">                            suppress_warnings=True, </em><br/><em class="jd">                            stepwise=True)</em><br/><em class="jd"> print(stepwise_model.aic())</em></span></pre><p id="0b69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在网格搜索之后，我将使用自动arima选择的顺序，然后将其应用于训练数据。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="5e72" class="ko jr hi ma b fi me mf l mg mh">model = SARIMAX(train,<br/>                                order=(1, 0, 0),<br/>                            seasonal_order=(0, 1, 0, 12),<br/>                                enforce_stationarity=<strong class="ma hj">False</strong>,<br/>                                enforce_invertibility=<strong class="ma hj">False</strong>).fit()</span></pre><p id="8eb1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用拟合模型，在之前计算的开始和结束范围内进行预测。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="af81" class="ko jr hi ma b fi me mf l mg mh">predictions = model.predict(start=start , end=end).rename('SARIMA(1, 0, 0)(0, 1, 0, 12) Predictions')</span></pre><p id="4248" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，绘制预测与实际的对比图。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="4b45" class="ko jr hi ma b fi me mf l mg mh">test.rename('test').plot(legend=<strong class="ma hj">True</strong>,figsize=(12,8))<br/>predictions.plot(legend=<strong class="ma hj">True</strong>)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ng"><img src="../Images/eabb052ac80e7c357a617caf9fbaba1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*Gd3psDEFAaQnNRA9PlHgZA.png"/></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">SARIMAX每月预测值与实际值(MWh)</figcaption></figure><p id="6b6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:SARIMAX以比lstm更好的性能出现在这里。</p><p id="89c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">次日整点预测</strong></p><p id="c16c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于这一部分，我们将使用我们的原始数据集(每小时记录)并选择2017年的最后一天作为我们的测试，并尝试预测短期内明天的用电量。</p><p id="6cd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> LSTM </strong></p><p id="19f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之前针对LSTM讨论的相同代码也将用于每小时的数据集，并将产生以下预测与实际值。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es nh"><img src="../Images/5b13b6383549080e32cd28127b5f87aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NIgbsV4VAoJO72puejSY9Q.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">LSTM第二天每小时预测与实际(MWh)</figcaption></figure><p id="831e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:LSTM仍然表现得还可以。</p><p id="cb5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> XGBOOST </strong></p><p id="f678" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我也试过回归法。</p><p id="9aec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们不想要任何数据类型为object的列，所以我们将为这些列获取虚拟变量</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="0bf3" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># creating dummy variables for all categorical variables in the cleaned and merged dataset</em><br/>df_d = pd.get_dummies(df.drop(columns=['Time']) , drop_first=<strong class="ma hj">True</strong>)</span></pre><p id="036f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了确保没有数据泄漏，我将进行训练、测试和验证。</p><p id="a9c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最近(2017年的最后一天)的x和y将不在训练或测试集中。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="1e47" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># length to split</em><br/>l_split = 24</span><span id="9af5" class="ko jr hi ma b fi na mf l mg mh"><em class="jd"># make a regression problem</em><br/>X = df_d.drop(columns=['COA'])[:-l_split]<br/>y = df_d.COA[:-l_split]<br/>X_lately = df_d.drop(columns=['COA'])[-l_split:]<br/>y_lately = df_d.COA[-l_split:]</span></pre><p id="405b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">列车测试分离。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="f3ef" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># train split test with given length to split</em><br/><strong class="ma hj">from</strong> <strong class="ma hj">sklearn.model_selection</strong> <strong class="ma hj">import</strong> train_test_split<br/>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33, random_state=42)</span></pre><p id="0e67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用标准定标器来定标我们的数据集，重要的是只适合于训练集，并且只在测试和验证时转换。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="6f09" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># importing scaler, then scale training and test dataframes</em><br/><strong class="ma hj">from</strong> <strong class="ma hj">sklearn.preprocessing</strong> <strong class="ma hj">import</strong> StandardScaler </span><span id="6f45" class="ko jr hi ma b fi na mf l mg mh">s = StandardScaler()</span><span id="1919" class="ko jr hi ma b fi na mf l mg mh">X_train_d_s = pd.DataFrame(s.fit_transform(X_train) , columns=X_train.columns)<br/>X_test_d_s = pd.DataFrame(s.transform(X_test) , columns=X_test.columns)<br/>X_lately_df = pd.DataFrame(s.transform(X_lately) , columns=X_lately.columns)</span></pre><p id="fb75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的训练数据中导入并拟合模型。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="badc" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># importing models </em><br/><strong class="ma hj">from</strong> <strong class="ma hj">xgboost.sklearn</strong> <strong class="ma hj">import</strong> XGBRegressor</span><span id="0fee" class="ko jr hi ma b fi na mf l mg mh"><em class="jd"># define and fit the model</em><br/>model = XGBRegressor()<br/>model.fit(X_train_d_s , y_train)</span></pre><p id="df2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为测试和预测制作数据帧</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="8c01" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># making a dataframe to hold test predictions</em><br/>predictions = pd.DataFrame(model.predict(X_lately_df) , index=pd.date_range('2017-12-31 00:00:00','2017-12-31 23:00:00' , freq='H'), columns=['pred'])</span><span id="9bae" class="ko jr hi ma b fi na mf l mg mh"><em class="jd"># making a dataframe to hold test data</em><br/>test = pd.DataFrame(np.array(y_lately) , index=pd.date_range('2017-12-31 00:00:00','2017-12-31 23:00:00' , freq='H') , columns=['test'])</span></pre><p id="8dd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将测试和预测对立起来。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="a43b" class="ko jr hi ma b fi me mf l mg mh"><em class="jd"># plot prediction vs test</em><br/>test.test.plot(figsize=(12,5) , legend=<strong class="ma hj">True</strong>)<br/>predictions.pred.plot(legend=<strong class="ma hj">True</strong>)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ni"><img src="../Images/ca8dc65f40f155c9392a7e5ce7bfd2ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6GzIciSN8jFvGmyQDabxUg.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">Xgboost第二天每小时预测值与实际值(MWh)</figcaption></figure><p id="4970" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:XGBOOST并不是很好的结果。</p><p id="ebaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> LIGHTGBM </strong></p><p id="73e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于lightGBM，我将使用相同的管线，唯一会改变的是模型的拟合。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="263a" class="ko jr hi ma b fi me mf l mg mh"><strong class="ma hj">from</strong> <strong class="ma hj">lightgbm</strong> <strong class="ma hj">import</strong> LGBMRegressor</span><span id="fffa" class="ko jr hi ma b fi na mf l mg mh">lgb =  LGBMRegressor()<br/>lgb.fit(X_train_d_s,y_train)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ni"><img src="../Images/e363ce298b5d07f557201a6f1f0d2f0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lIKxcZBEzfa7uzneIXIODg.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">lightGBM第二天每小时预测值与实际值(MWh)</figcaption></figure><p id="40a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:lightGBM作为一种回归方法比XGBOOST执行得更好。</p><p id="48bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">萨里马克斯</strong></p><p id="59fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里也将使用前面讨论的SARIMAX的相同代码。</p><p id="bd2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">唯一会改变的是，auto arima中的m参数将是24，因为我们每小时的数据集中有每日季节性，季节性发生在每24个数据点。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es nj"><img src="../Images/b898c788df4a613a2b2166c3d9e66d72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0R81YgE0GPvcimrlFjGK_g.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">SARIMAX第二天每小时预测值与实际值(MWh)</figcaption></figure><p id="806a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:最终萨里麦克斯·克利里在这里获得了胜利。</p><h2 id="9b22" class="ko jr hi bd js kp kq kr jw ks kt ku ka iq kv kw ke iu kx ky ki iy kz la km lb bi translated">精炼</h2><p id="94ff" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">在这一节中，我将讨论每个算法如何改进。</p><p id="df16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> LSTM </strong></p><p id="b507" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以改善LSTM的主要变化是网络架构。</p><p id="e3a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以添加密集层，改变优化器，改变学习率，添加另一个LSTM细胞，等等。</p><p id="e353" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不断改变，直到你对结果满意为止。</p><p id="3623" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">先知</strong></p><p id="a4a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加回归变量会有很大帮助，但是要确保如果你添加了一个回归变量，当你想预测未来时，你需要有相同的回归变量，不要使用你得不到的回归变量。</p><p id="1aa5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一件事是趋势，它是乘法还是加法？两种方法都试试，看看哪一种效果最好。</p><p id="a26a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">萨里马克斯</strong></p><p id="5c36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了改善SARIMAX，你可以增加外生变量，但正如先知所说，确保你得到这些变量来预测。</p><p id="9caa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，SARIMAX的主要问题是它不能捕捉多个季节。</p><p id="460b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">傅立叶级数有一个技巧可以解决这个问题，通过添加傅立叶级数作为外生变量，我在这里没有这样做，希望在未来实现。</p><p id="a5ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">回归</strong></p><p id="fe63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最重要的是增加更多的功能，增加相关功能后可以明显看到一个改进。</p><p id="59c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我想在未来的工作中增加的一个功能是GDP，我认为它与电力消耗有关。</p><h1 id="1ad7" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">结果</h1><h2 id="e8db" class="ko jr hi bd js kp kq kr jw ks kt ku ka iq kv kw ke iu kx ky ki iy kz la km lb bi translated">模型评估、验证和论证</h2><p id="2782" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated"><strong class="ih hj">每小时数据预测</strong></p><p id="568a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">R2分数摘要</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es nk"><img src="../Images/855af3322022b521832808a5ab23d9e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*dliG38H8ChDXAyeEvFSkhA.png"/></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">每小时预测摘要</figcaption></figure><p id="198a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">LSTM在小时分组中表现更好，这可能是因为PROPHET没有能够很好地捕捉到多重季节性。</p><p id="f0fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，LSTM表现更好，记录数量更多。</p><p id="9a8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">每日预测</strong></p><p id="f17a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">R2分数摘要</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es nk"><img src="../Images/56bb3a96f0c45a11b6103d5e568f0502.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*rEpBSjTSaASKnkYFXNK7jw.png"/></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">ML每日预测摘要</figcaption></figure><p id="6fc7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每日数据也是同样的原因</p><p id="8372" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">月度预测</strong></p><p id="5ef7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">R2分数摘要</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es nl"><img src="../Images/706f538ebbc6c3dba76f8e23b0828584.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*CTUkIeLApq_c_ghtfnVfNQ.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">ML每月预测汇总</figcaption></figure><p id="ff2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为只有一个季节性，SARIMAX和PROPHET都很容易捕捉到，而LSTM开始受到月度数据中记录数量少的困扰。</p><p id="8fe2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">次日整点预测</strong></p><p id="0d52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">R2分数摘要</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es nm"><img src="../Images/14a4e08a454959bd715b5fa23bfebc41.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*kTVbtRruAM1EeRrsl0C2iA.png"/></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">第二天每小时预测汇总</figcaption></figure><p id="f544" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了对这一短期进行预测，只需要捕捉一个季节性，即每日季节性，SARIMAX捕捉得非常好。</p><h1 id="cf92" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">结论</h1><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es nn"><img src="../Images/287c650ba38256dcb97b21d62ed26fd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7GLST68zPwlvZZBQ-d_sQg.jpeg"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">来源:<a class="ae lv" href="https://depositphotos.com/221270752/stock-photo-writing-note-showing-conclusion-business.html" rel="noopener ugc nofollow" target="_blank">https://deposit photos . com/221270752/stock-photo-writing-note-showing-结语-business.html </a></figcaption></figure><h2 id="dcd6" class="ko jr hi bd js kp kq kr jw ks kt ku ka iq kv kw ke iu kx ky ki iy kz la km lb bi translated">反射</h2><ul class=""><li id="0a4e" class="lh li hi ih b ii lc im ld iq lw iu lx iy ly jc lm ln lo lp bi translated">机器学习可以用来预测电力负荷，准确率很高。</li><li id="3141" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">电力公司可以使用这种模型来预测短期/中期/长期电力负荷，并相应地规划他们的发电，这可以节省资源和资金，并为他们的客户提供更好的服务。</li><li id="1cce" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">理解和实现所有这些模型需要花费大量的时间和精力，因为我想对长期、中期和短期进行预测，我必须使用不同的模型，并且每个模型在特定的时期表现得更好。</li><li id="709b" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">与其他模型相比，LSTM真的很难理解和实现。</li><li id="6a7b" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">在寻找所有这些方法的过程中，我学到了很多东西，这是值得努力的。</li></ul><h2 id="826f" class="ko jr hi bd js kp kq kr jw ks kt ku ka iq kv kw ke iu kx ky ki iy kz la km lb bi translated">改进</h2><ul class=""><li id="bc90" class="lh li hi ih b ii lc im ld iq lw iu lx iy ly jc lm ln lo lp bi translated">通过对每天的数据进行重新采样并取最大值，我可以做出另一个重要的预测方法，即预测每天的电力负荷峰值</li><li id="02d4" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">实现一个web接口，该接口接受输入，从模型中获取预测并显示出来。</li><li id="09ad" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">探索R编程语言，因为它具有强大的统计和时间序列预测模型。</li><li id="4af1" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">正如在“优化”一节中所讨论的，SARIMAX可以通过傅立叶变换实现强大的功能，我对此很感兴趣。</li></ul><h2 id="fee7" class="ko jr hi bd js kp kq kr jw ks kt ku ka iq kv kw ke iu kx ky ki iy kz la km lb bi translated">承认</h2><p id="ad31" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">感谢我们在Udacity的所有老师，感谢他们在课程和这个项目中提供的所有支持，这是一次美妙的经历。</p></div></div>    
</body>
</html>