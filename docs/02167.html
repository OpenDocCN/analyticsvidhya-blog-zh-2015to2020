<html>
<head>
<title>[Kaggle] Housing Price Prediction — Top 13%</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[Kaggle]房价预测—最高13%</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/kaggle-housing-price-prediction-top-13-393a52d914af?source=collection_archive---------1-----------------------#2019-12-04">https://medium.com/analytics-vidhya/kaggle-housing-price-prediction-top-13-393a52d914af?source=collection_archive---------1-----------------------#2019-12-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b7ef35589448134021f5cd8144dab77b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gkn9gQCWvVccQ59uSzyZig.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">(来源:<a class="ae iu" href="https://www.bizjournals.com/columbus/news/2018/10/06/heres-why-m-i-thinks-columbus-is-ready-for-denser.html" rel="noopener ugc nofollow" target="_blank">https://www . biz journals . com/Columbus/news/2018/10/06/heres-why-m-I-thinks-Columbus-is-ready-for-denser . html</a></figcaption></figure><p id="9bac" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在泰坦尼克号生存预测之后，我继续从事另一个具有更大数据集的项目，以提高我的数据处理和特征工程技能。在Kaggle，房价预测比赛是另一个适合初学者的好项目。这一次预测是数字，不同于泰坦尼克号的生存预测是“是/否”。我们开始吧！</p><h1 id="f968" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">索引</h1><ol class=""><li id="7804" class="kr ks hi ix b iy kt jc ku jg kv jk kw jo kx js ky kz la lb bi translated">背景</li><li id="933d" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">探索性数据分析</li><li id="5890" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">缺失数据/异常值的插补</li><li id="8b60" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">数据差异/多重共线性</li><li id="c257" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">数据转换</li><li id="4d8f" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">特征创建</li><li id="fe9a" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">歪斜</li><li id="6182" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">模型</li><li id="af1e" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">提交</li></ol></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="aafc" class="jt ju hi bd jv jw lo jy jz ka lp kc kd ke lq kg kh ki lr kk kl km ls ko kp kq bi translated">1.背景</h1><p id="5058" class="pw-post-body-paragraph iv iw hi ix b iy kt ja jb jc ku je jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated"><strong class="ix hj">挑战</strong></p><p id="c917" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请购房者描述他们梦想中的房子，他们可能不会从地下室天花板的高度或靠近东西向铁路开始。但是这个游乐场竞赛的数据集证明，影响价格谈判的远不止卧室的数量或白色尖桩栅栏。</p><p id="e75b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有79个解释变量描述了(几乎)爱荷华州埃姆斯住宅的每个方面，这个比赛挑战你预测每个家庭的最终价格。</p><p id="9dd0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">练习技能</strong></p><ol class=""><li id="2085" class="kr ks hi ix b iy iz jc jd jg lw jk lx jo ly js ky kz la lb bi translated">创造性特征工程</li><li id="c0c2" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">高级回归技术，如随机森林和梯度推进</li></ol><p id="67b0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">确认</strong></p><p id="cdde" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Ames Housing数据集由Dean De Cock编制，用于数据科学教育。对于寻找经常被引用的波士顿住房数据集的现代化和扩展版本的数据科学家来说，这是一个令人难以置信的替代方案。</p></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="8821" class="jt ju hi bd jv jw lo jy jz ka lp kc kd ke lq kg kh ki lr kk kl km ls ko kp kq bi translated">2.探索性数据分析</h1><p id="b987" class="pw-post-body-paragraph iv iw hi ix b iy kt ja jb jc ku je jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated">导入库:</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="6d75" class="mi ju hi me b fi mj mk l ml mm">import numpy as np<br/>import pandas as pd<br/>import seaborn as sns<br/>import warnings<br/>from math import sqrt<br/>from matplotlib import pyplot as plt, rcParams<br/>from numpy import median<br/>from scipy.special import boxcox1p<br/>from scipy.stats import skew<br/>from sklearn.feature_selection import VarianceThreshold<br/>from sklearn.linear_model import Lasso, LassoCV<br/>from sklearn.metrics import mean_squared_error<br/>from sklearn.model_selection import cross_val_score, GridSearchCV, KFold<br/>from sklearn.preprocessing import LabelEncoder</span><span id="ed1c" class="mi ju hi me b fi mn mk l ml mm">warnings.filterwarnings(‘ignore’)</span></pre><p id="b35d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">导入数据:</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="8d74" class="mi ju hi me b fi mj mk l ml mm">df_train = pd.read_csv(‘train.csv’)<br/>df_test = pd.read_csv(‘test.csv’)</span></pre><p id="dc40" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">数据结构:</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="d618" class="mi ju hi me b fi mj mk l ml mm">df_train.info()</span><span id="0bc1" class="mi ju hi me b fi mn mk l ml mm">Output:<br/>&lt;class 'pandas.core.frame.DataFrame'&gt;<br/>RangeIndex: 1460 entries, 0 to 1459<br/>Data columns (total 81 columns):<br/>Id               1460 non-null int64<br/>MSSubClass       1460 non-null int64<br/>MSZoning         1460 non-null object<br/>LotFrontage      1201 non-null float64<br/>LotArea          1460 non-null int64<br/>Street           1460 non-null object<br/>Alley            91 non-null object<br/>LotShape         1460 non-null object<br/>LandContour      1460 non-null object<br/>Utilities        1460 non-null object<br/>LotConfig        1460 non-null object<br/>LandSlope        1460 non-null object<br/>Neighborhood     1460 non-null object<br/>Condition1       1460 non-null object<br/>Condition2       1460 non-null object<br/>BldgType         1460 non-null object<br/>HouseStyle       1460 non-null object<br/>OverallQual      1460 non-null int64<br/>OverallCond      1460 non-null int64<br/>YearBuilt        1460 non-null int64<br/>YearRemodAdd     1460 non-null int64<br/>RoofStyle        1460 non-null object<br/>RoofMatl         1460 non-null object<br/>Exterior1st      1460 non-null object<br/>Exterior2nd      1460 non-null object<br/>MasVnrType       1452 non-null object<br/>MasVnrArea       1452 non-null float64<br/>ExterQual        1460 non-null object<br/>ExterCond        1460 non-null object<br/>Foundation       1460 non-null object<br/>BsmtQual         1423 non-null object<br/>BsmtCond         1423 non-null object<br/>BsmtExposure     1422 non-null object<br/>BsmtFinType1     1423 non-null object<br/>BsmtFinSF1       1460 non-null int64<br/>BsmtFinType2     1422 non-null object<br/>BsmtFinSF2       1460 non-null int64<br/>BsmtUnfSF        1460 non-null int64<br/>TotalBsmtSF      1460 non-null int64<br/>Heating          1460 non-null object<br/>HeatingQC        1460 non-null object<br/>CentralAir       1460 non-null object<br/>Electrical       1459 non-null object<br/>1stFlrSF         1460 non-null int64<br/>2ndFlrSF         1460 non-null int64<br/>LowQualFinSF     1460 non-null int64<br/>GrLivArea        1460 non-null int64<br/>BsmtFullBath     1460 non-null int64<br/>BsmtHalfBath     1460 non-null int64<br/>FullBath         1460 non-null int64<br/>HalfBath         1460 non-null int64<br/>BedroomAbvGr     1460 non-null int64<br/>KitchenAbvGr     1460 non-null int64<br/>KitchenQual      1460 non-null object<br/>TotRmsAbvGrd     1460 non-null int64<br/>Functional       1460 non-null object<br/>Fireplaces       1460 non-null int64<br/>FireplaceQu      770 non-null object<br/>GarageType       1379 non-null object<br/>GarageYrBlt      1379 non-null float64<br/>GarageFinish     1379 non-null object<br/>GarageCars       1460 non-null int64<br/>GarageArea       1460 non-null int64<br/>GarageQual       1379 non-null object<br/>GarageCond       1379 non-null object<br/>PavedDrive       1460 non-null object<br/>WoodDeckSF       1460 non-null int64<br/>OpenPorchSF      1460 non-null int64<br/>EnclosedPorch    1460 non-null int64<br/>3SsnPorch        1460 non-null int64<br/>ScreenPorch      1460 non-null int64<br/>PoolArea         1460 non-null int64<br/>PoolQC           7 non-null object<br/>Fence            281 non-null object<br/>MiscFeature      54 non-null object<br/>MiscVal          1460 non-null int64<br/>MoSold           1460 non-null int64<br/>YrSold           1460 non-null int64<br/>SaleType         1460 non-null object<br/>SaleCondition    1460 non-null object<br/>SalePrice        1460 non-null int64<br/>dtypes: float64(3), int64(35), object(43)<br/>memory usage: 924.0+ KB</span><span id="6e8f" class="mi ju hi me b fi mn mk l ml mm">len(df_test)</span><span id="4254" class="mi ju hi me b fi mn mk l ml mm">Output:<br/>1459</span></pre><p id="f929" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">检查缺失数据大于30%的要素:</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="68e9" class="mi ju hi me b fi mj mk l ml mm">PctMiss = df_train.isnull().sum()*100/len(df_train)<br/>PctMiss.sort_values(ascending=False, inplace=True)</span><span id="d5a7" class="mi ju hi me b fi mn mk l ml mm">PctMiss.head(10)</span><span id="d49c" class="mi ju hi me b fi mn mk l ml mm">Output:<br/>PoolQC          99.520548<br/>MiscFeature     96.301370<br/>Alley           93.767123<br/>Fence           80.753425<br/>FireplaceQu     47.260274<br/>LotFrontage     17.739726<br/>GarageCond       5.547945<br/>GarageType       5.547945<br/>GarageYrBlt      5.547945<br/>GarageFinish     5.547945<br/>dtype: float64</span></pre><p id="503f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">前4个功能的缺失数据超过70%。当然，我们必须移除它们。对于丢失了47%数据的FireplaceQu，我决定也删除它。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="4868" class="mi ju hi me b fi mj mk l ml mm">df_train.drop([‘Alley’, ‘FireplaceQu’, ‘PoolQC’, ‘Fence’, ‘MiscFeature’], axis=1, inplace=True)<br/>df_test.drop([‘Alley’, ‘FireplaceQu’, ‘PoolQC’, ‘Fence’, ‘MiscFeature’], axis=1, inplace=True)</span></pre><p id="c981" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以还剩下74个特征。让我们首先将它们分为数字特征和分类特征。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="f75e" class="mi ju hi me b fi mj mk l ml mm">feature_num = df_train.drop([‘Id’,‘SalePrice’],axis=1).select_dtypes(include=[np.number]).columns</span><span id="999f" class="mi ju hi me b fi mn mk l ml mm">feature_cat = df_train.select_dtypes(exclude=[np.number]).columns</span><span id="a9c5" class="mi ju hi me b fi mn mk l ml mm">len(feature_num)<br/>len(feature_cat)</span><span id="361d" class="mi ju hi me b fi mn mk l ml mm">Output:<br/>36<br/>38</span></pre><p id="2619" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">数字特征—分布图:</strong></p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="1dd0" class="mi ju hi me b fi mj mk l ml mm">nd = pd.melt(df_train, value_vars = feature_num)<br/>n1 = sns.FacetGrid(nd, col=’variable’, col_wrap=4, sharex=False, sharey=False)<br/>n1 = n1.map(sns.distplot, ‘value’)</span><span id="da6d" class="mi ju hi me b fi mn mk l ml mm">plt.savefig('feature_num.png') <br/># due to large plot size, better save to file and open)</span></pre><figure class="lz ma mb mc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/44be56f2d5e01fac40fa0a83a480a600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xSvw5X4-_uKjo2NfnkLAzw.png"/></div></div></figure><p id="ba52" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">观察结果:</p><ol class=""><li id="c14c" class="kr ks hi ix b iy iz jc jd jg lw jk lx jo ly js ky kz la lb bi translated">左/右偏斜(例如BsmtUnfSF、GarageYtBlt)</li><li id="7d02" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">异常值(例如LotFrontage、LotArea、MasVnrArea、GrLivArea)</li><li id="e412" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">低方差或几乎为零方差(例如，池面积、误增值)</li></ol><p id="c23e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">数字特征与销售价格—散点图:</strong></p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="5855" class="mi ju hi me b fi mj mk l ml mm">nd_num = pd.melt(df_train, id_vars=’SalePrice’, value_vars = feature_num)<br/>n1 = sns.FacetGrid(nd_num, col=’variable’, col_wrap=4, sharex=False, sharey=False)<br/>n1 = n1.map(sns.scatterplot, ‘value’, ‘SalePrice’)<br/>plt.savefig('feature_num_vs_SalePrice.png')</span></pre><figure class="lz ma mb mc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/0cd262785b0589cdab236905cbeb015e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wbm5UdvNR3VDu8HJhz8blQ.png"/></div></div></figure><p id="491f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">观察结果:</p><ol class=""><li id="a94f" class="kr ks hi ix b iy iz jc jd jg lw jk lx jo ly js ky kz la lb bi translated">与销售价格高度相关的特性(例如，总体质量、GrLivArea、1stFlrSF)</li><li id="4382" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">一些具有大量零值，并且似乎与销售价格不相关(例如，LowQualFinSF、WoodDeckSF、ScreenPorch)。</li></ol><p id="c3d9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">分类特征—计数图:</strong></p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="66f0" class="mi ju hi me b fi mj mk l ml mm">nd_cat = pd.melt(df_train, value_vars = feature_cat)<br/>n2 = sns.FacetGrid(nd_cat, col=’variable’, col_wrap=4, sharex=False, sharey=False)<br/>n2 = n2.map(sns.countplot, ‘value’)</span><span id="60e1" class="mi ju hi me b fi mn mk l ml mm">plt.savefig('feature_cat.png')</span></pre><figure class="lz ma mb mc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d6e0ede60d91c1c2f8b119d6ed0b7087.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vjdhEiPwuYmXaSNaNuOR0A.png"/></div></div></figure><p id="8c56" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">观察结果:</p><ol class=""><li id="dd74" class="kr ks hi ix b iy iz jc jd jg lw jk lx jo ly js ky kz la lb bi translated">巨大的多样性(例如邻里关系)</li><li id="4a5c" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">低方差或几乎为零方差(例如，公用设施、条件2、屋顶材料、供暖)</li></ol><p id="b211" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">分类特征与销售价格—箱线图:</strong></p><figure class="lz ma mb mc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/57c8e1658e4945576fec5e21236c4fc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dlm-LbBf14MLP9k8uE35eA.png"/></div></div></figure><p id="41b6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">观察结果:</p><ol class=""><li id="d3f3" class="kr ks hi ix b iy iz jc jd jg lw jk lx jo ly js ky kz la lb bi translated">具有销售价格指示力的特征(例如，ExterQual、Neighborhood)</li><li id="7bf3" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">无销售价格指示能力的特征(例如，Landslope、BldgType、BsmtFinType2)</li></ol></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="9992" class="jt ju hi bd jv jw lo jy jz ka lp kc kd ke lq kg kh ki lr kk kl km ls ko kp kq bi translated">3.缺失数据/异常值的插补</h1><p id="8d7b" class="pw-post-body-paragraph iv iw hi ix b iy kt ja jb jc ku je jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated"><strong class="ix hj">数字特征—缺失数据:</strong></p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="780b" class="mi ju hi me b fi mj mk l ml mm">PctMiss_num_train = df_train[feature_num].isnull().sum()*100/len(df_train)<br/>PctMiss_num_train.sort_values(ascending=False, inplace=True)</span><span id="80a9" class="mi ju hi me b fi mn mk l ml mm">PctMis_num_train.head(10)</span><span id="4dc5" class="mi ju hi me b fi mn mk l ml mm">Output:<br/>LotFrontage     17.739726<br/>GarageYrBlt      5.547945<br/>MasVnrArea       0.547945<br/>YrSold           0.000000<br/>BsmtFinSF2       0.000000<br/>LowQualFinSF     0.000000<br/>2ndFlrSF         0.000000<br/>1stFlrSF         0.000000<br/>TotalBsmtSF      0.000000<br/>BsmtUnfSF        0.000000</span><span id="73b7" class="mi ju hi me b fi mn mk l ml mm">PctMiss_num_test = df_test[feature_num].isnull().sum()*100/len(df_test)<br/>PctMiss_num_test.sort_values(ascending=False, inplace=True)</span><span id="2c27" class="mi ju hi me b fi mn mk l ml mm">PctMis_num_test.head(10)</span><span id="c0aa" class="mi ju hi me b fi mn mk l ml mm">Output:<br/>LotFrontage     15.558602<br/>GarageYrBlt      5.346127<br/>MasVnrArea       1.028101<br/>BsmtHalfBath     0.137080<br/>BsmtFullBath     0.137080<br/>GarageArea       0.068540<br/>BsmtFinSF1       0.068540<br/>BsmtFinSF2       0.068540<br/>BsmtUnfSF        0.068540<br/>TotalBsmtSF      0.068540<br/>dtype: float64</span></pre><p id="72de" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">停车场</strong></p><p id="ef13" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由于LotFrontage有相当大一部分缺失数据(即17.7%)，我决定根据某些相关的分类特征来估算缺失数据。根据数据描述，地段临街面是与物业相连的街道的直线英尺数。因此，地段临街似乎与邻里有联系。此外，从上述计数图来看，邻域具有很大的多样性。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="e8bd" class="mi ju hi me b fi mj mk l ml mm">lotfrontage_by_neighborhood = df_train.groupby(‘Neighborhood’).LotFrontage.median()</span><span id="ccc6" class="mi ju hi me b fi mn mk l ml mm">plt.subplots_adjust(bottom=0.2)<br/>plt.show()</span></pre><figure class="lz ma mb mc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/20dd78d70a885b903ea3a444cfe47f9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GLyejoOwwwwQQdtgJeX8yQ.png"/></div></div></figure><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="1422" class="mi ju hi me b fi mj mk l ml mm">for ngh in lotfrontage_by_neighborhood.index:<br/> df_train.loc[(df_train.LotFrontage.isnull()) &amp; (df_train.Neighborhood==ngh), [‘LotFrontage’]] = lotfrontage_neighborhood[ngh]<br/> df_test.loc[(df_test.LotFrontage.isnull()) &amp; (df_test.Neighborhood==ngh), [‘LotFrontage’]] = lotfrontage_neighborhood[ngh]</span></pre><p id="a8e5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于其他人，只需将缺失数据估算为0。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="0bf2" class="mi ju hi me b fi mj mk l ml mm">for x in feature_num:<br/> df_train[x].fillna(0, inplace=True)<br/> df_test[x].fillna(0, inplace=True)</span></pre><p id="c7aa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">数字特征—异常值:</strong></p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="68e2" class="mi ju hi me b fi mj mk l ml mm">df_train.drop(df_train[df_train.GrLivArea&gt;4500].index, inplace=True)<br/>df_train.drop(df_train[df_train.LotFrontage&gt;300].index, inplace=True)<br/>df_train.drop(df_train[df_train.LotArea&gt;100000].index, inplace=True)<br/>df_train.drop(df_train[df_train.MasVnrArea&gt;1500].index, inplace=True)<br/>df_train.drop(df_train[df_train.OpenPorchSF&gt;500].index, inplace=True)</span></pre><p id="2d70" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">分类特征—缺失数据:</strong></p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="10c0" class="mi ju hi me b fi mj mk l ml mm">PctMiss_cat_train = df_train[feature_cat].isnull().sum()*100/len(df_train)<br/>PctMiss_cat_train.sort_values(ascending=False, inplace=True)</span><span id="6095" class="mi ju hi me b fi mn mk l ml mm">PctMiss_cat_train.head(10)</span><span id="61b4" class="mi ju hi me b fi mn mk l ml mm">Output:<br/>GarageCond      5.547945<br/>GarageQual      5.547945<br/>GarageFinish    5.547945<br/>GarageType      5.547945<br/>BsmtFinType2    2.602740<br/>BsmtExposure    2.602740<br/>BsmtCond        2.534247<br/>BsmtQual        2.534247<br/>BsmtFinType1    2.534247<br/>MasVnrType      0.547945<br/>dtype: float64</span><span id="6eb5" class="mi ju hi me b fi mn mk l ml mm">PctMiss_cat_test = df_test[feature_cat].isnull().sum()*100/len(df_test)<br/>PctMiss_cat_test.sort_values(ascending=False, inplace=True)<br/>PctMiss_cat_test.head(10)</span><span id="0a54" class="mi ju hi me b fi mn mk l ml mm">Output:<br/>GarageCond      5.551748<br/>GarageQual      5.551748<br/>GarageFinish    5.551748<br/>GarageType      5.551748<br/>BsmtFinType2    2.604524<br/>BsmtExposure    2.604524<br/>BsmtCond        2.535984<br/>BsmtQual        2.535984<br/>BsmtFinType1    2.535984<br/>MasVnrType      0.548321<br/>dtype: float64</span></pre><p id="ae4a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从上面的模式可以推断，缺失数据可能是由于缺少车库/地下室，因为在Garagexxx/Bsmtxxx中有相同数量的行存在缺失数据。因此，我决定将所有缺失的数据填写为“其他”，而不是简单地输入模式。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="dcaa" class="mi ju hi me b fi mj mk l ml mm">for x in feature_cat:<br/> df_train[x].fillna(‘Others’, inplace=True)<br/> df_test[x].fillna(‘Others’, inplace=True)</span></pre><p id="9dd9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">仔细检查丢失的数据。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="f5a9" class="mi ju hi me b fi mj mk l ml mm">df_train.isnull().sum().sum()<br/>df_test.isnull().sum().sum()</span><span id="dce0" class="mi ju hi me b fi mn mk l ml mm">Output:<br/>0<br/>0</span></pre></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="40a3" class="jt ju hi bd jv jw lo jy jz ka lp kc kd ke lq kg kh ki lr kk kl km ls ko kp kq bi translated">4.数据差异/多重共线性</h1><p id="0246" class="pw-post-body-paragraph iv iw hi ix b iy kt ja jb jc ku je jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated">在输入缺失数据后，让我们筛选出那些低方差(或高优势)的特征，以便为进一步的数据处理节省时间。</p><p id="4af8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">数字特征—数据差异:</strong></p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="4da3" class="mi ju hi me b fi mj mk l ml mm">constant_filter = VarianceThreshold(threshold=0.25) <br/>constant_filter.fit(df_train[feature_num])<br/>constant_feature_num = [num for num in feature_num if num not in df_train[feature_num].columns[constant_filter.get_support()]]</span><span id="111b" class="mi ju hi me b fi mn mk l ml mm">constant_feature_num</span><span id="b105" class="mi ju hi me b fi mn mk l ml mm">Output:<br/>['BsmtHalfBath', 'KitchenAbvGr']</span></pre><p id="b780" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">分类特征—数据优势:</strong></p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="c4fe" class="mi ju hi me b fi mj mk l ml mm">constant_feature_cat = []<br/>for x in feature_cat:<br/> if df_train[x].value_counts().max()/len(df_train[x]) &gt; 0.9:<br/> constant_feature_cat.append(x)</span><span id="7046" class="mi ju hi me b fi mn mk l ml mm">constant_feature_cat</span><span id="6bc8" class="mi ju hi me b fi mn mk l ml mm">Output:<br/>['Street', 'Utilities', 'LandSlope', 'Condition2', 'RoofMatl', 'Heating', 'CentralAir', 'Electrical', 'Functional', 'GarageCond', 'PavedDrive']</span></pre><p id="af01" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由于具有低方差/高优势的特征不具有指示能力，所以让我们将它们筛选出来，以节省进一步处理的时间。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="cf50" class="mi ju hi me b fi mj mk l ml mm">for x in constant_feature_num:<br/> feature_num.remove(x)</span><span id="76b0" class="mi ju hi me b fi mn mk l ml mm">for x in constant_feature_cat:<br/>    feature_cat.remove(x)</span></pre><p id="9c3e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">数字特征-数据多重共线性:</strong></p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="9ea3" class="mi ju hi me b fi mj mk l ml mm">corr_matrix = df_train[feature_num + ['SalePrice']].corr()<br/>sns.heatmap(corr_matrix, cmap=’coolwarm’, linewidths=.5, xticklabels=True, yticklabels=True)<br/>plt.show()</span></pre><figure class="lz ma mb mc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/bdc04683e9d653e282d20a289be079da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GS5f1gZ6E5D3A-ZVRCo9rQ.png"/></div></div></figure><p id="dc64" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从热图中，我们可以看到一些功能彼此高度相关。由于多重共线性会影响模型精度，因此最好移除两个高度相关的要素中的一个。保留与销售价格关联度较高的。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="a548" class="mi ju hi me b fi mj mk l ml mm">def feature_corr(feature, corr_threshold):<br/>    corr_matrix = df_train[feature + ['SalePrice']].corr()<br/>    numToDrop = []<br/>    numNotDrop = []<br/>    for i in range(len(corr_matrix)):<br/>        if corr_matrix.index[i] != 'SalePrice':<br/>            row_corr_saleprice = abs(corr_matrix['SalePrice'][i])<br/>            for j in range(i):<br/>                if corr_matrix.columns[j] != 'SalePrice':<br/>                    col_corr_saleprice = abs(corr_matrix['SalePrice'][j])<br/>                    if abs(corr_matrix.iloc[i][j]) &gt;= corr_threshold:<br/>                       if row_corr_saleprice &gt; col_corr_saleprice:<br/>                           if corr_matrix.index[j] not in numToDrop:<br/>                               numToDrop.append(corr_matrix.index[j])<br/>                               numNotDrop.append(corr_matrix.index[i])<br/>                       else:<br/>                           if corr_matrix.index[i] not in numToDrop:<br/>                               numToDrop.append(corr_matrix.index[i])<br/>                               numNotDrop.append(corr_matrix.index[j])<br/>    return numToDrop, numNotDrop</span><span id="84d1" class="mi ju hi me b fi mn mk l ml mm">numToDrop, numNotDrop = feature_corr(feature_num, 0.8)</span><span id="fe67" class="mi ju hi me b fi mn mk l ml mm">numToDrop<br/>numToKeep</span><span id="5009" class="mi ju hi me b fi mn mk l ml mm">Output:<br/>['1stFlrSF', 'TotRmsAbvGrd', 'GarageArea']<br/>['TotalBsmtSF', 'GrLivArea', 'GarageCars']</span></pre><p id="070d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由上可知，1stFlrSF和TotalBsmtSF高度相关(即&gt; 0.8)。由于TotalBsmtSF与SalePrice的相关性较高，我们将保留TotalBsmtSF，去掉1stFlrSF。其他两对也一样。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="bebc" class="mi ju hi me b fi mj mk l ml mm">for x in numToDrop:<br/> feature_num.remove(x)</span></pre></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="6abc" class="jt ju hi bd jv jw lo jy jz ka lp kc kd ke lq kg kh ki lr kk kl km ls ko kp kq bi translated">5.数据转换</h1><p id="8f11" class="pw-post-body-paragraph iv iw hi ix b iy kt ja jb jc ku je jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated"><strong class="ix hj">序数范畴特征</strong></p><p id="4cdd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于分类特征，观察顺序特征。让我们将这些有序分类特征转换为数字。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="ccd7" class="mi ju hi me b fi mj mk l ml mm">qual_dict1 = {‘Others’: 0, ‘Po’: 1, ‘Fa’: 2, ‘TA’: 3, ‘Gd’: 4, ‘Ex’: 5}<br/>df_train[‘ExterQual’] = df_train[‘ExterQual’].map(qual_dict1).astype(int)<br/>df_test[‘ExterQual’] = df_test[‘ExterQual’].map(qual_dict1).astype(int)</span><span id="8946" class="mi ju hi me b fi mn mk l ml mm">df_train[‘HeatingQC’] = df_train[‘HeatingQC’].map(qual_dict1).astype(int)<br/>df_test[‘HeatingQC’] = df_test[‘HeatingQC’].map(qual_dict1).astype(int)<br/> <br/>qual_dict2 = {‘Others’: 0, ‘Unf’: 1, ‘LwQ’: 2, ‘Rec’: 3, ‘BLQ’: 4, ‘ALQ’: 5, ‘GLQ’: 6}<br/>df_train[‘BsmtFinType1’] = df_train[‘BsmtFinType1’].map(qual_dict2).astype(int)<br/>df_test[‘BsmtFinType1’] = df_test[‘BsmtFinType1’].map(qual_dict2).astype(int)</span><span id="0758" class="mi ju hi me b fi mn mk l ml mm">df_train[‘BsmtFinType2’] = df_train[‘BsmtFinType2’].map(qual_dict2).astype(int)<br/>df_test[‘BsmtFinType2’] = df_test[‘BsmtFinType2’].map(qual_dict2).astype(int)</span><span id="8632" class="mi ju hi me b fi mn mk l ml mm">qual_dict3 = {‘Others’: 0, ‘Unf’: 1, ‘RFn’: 2, ‘Fin’: 3}<br/>df_train[‘GarageFinish’] = df_train.GarageFinish.map(qual_dict3).astype(int)<br/>df_test[‘GarageFinish’] = df_test.GarageFinish.map(qual_dict3).astype(int)</span><span id="3f6d" class="mi ju hi me b fi mn mk l ml mm">qual_dict4 = {‘Others’:0, ‘Reg’: 1, ‘IR1’:2, ‘IR2’:3, ‘IR3’: 4}<br/>df_train[‘LotShape’] = df_train.LotShape.map(qual_dict4).astype(int)<br/>df_test[‘LotShape’] = df_test.LotShape.map(qual_dict4).astype(int)</span><span id="56cc" class="mi ju hi me b fi mn mk l ml mm">feature_ordinal=[‘ExterQual’, ‘HeatingQC’, ‘BsmtFinType1’, ‘BsmtFinType2’, ‘GarageFinish’, ‘LotShape’]</span><span id="8c71" class="mi ju hi me b fi mn mk l ml mm">for x in feature_ordinal:<br/> feature_cat.remove(x)</span></pre><p id="38b5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> MSSubClass </strong></p><p id="9a62" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从数据描述中可以看出，MSSubClass实际上是分类特征。让我们来看看MSSubClass的分布。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="8cbb" class="mi ju hi me b fi mj mk l ml mm">sns.countplot(df_train[‘MSSubClass’])<br/>plt.show()</span></pre><figure class="lz ma mb mc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/ab5cf4e8c207197e77ca1b132ef0b42a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*13MBxilIo92Td4YpXpn-Zw.png"/></div></div></figure><p id="6d29" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由于一些计数太少，最好将类别组合到某些组中。我决定根据销售价格的中位数对他们进行分组。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="286d" class="mi ju hi me b fi mj mk l ml mm">df_train.groupby([‘MSSubClass’])[‘SalePrice’].median().sort_values().plot(kind=’bar’)<br/>plt.show()</span></pre><figure class="lz ma mb mc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/c539cdd60963a9de7d509dd7363bf52d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tZKL89GpPhE20hi_fFsZhw.png"/></div></div></figure><p id="4948" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们把他们分成5组。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="4bac" class="mi ju hi me b fi mj mk l ml mm">remap = {180: 1, 30: 1, 45: 1, 190: 2, 50: 2, 90: 2, 85: 2, 40: 2, 160: 2, 70: 3, 20: 3, 75: 3, 80: 3, 120: 4, 60: 5}<br/>df_train['MSSubClass'].replace(remap, inplace=True)<br/>sns.countplot(df_train['MSSubClass'])<br/>plt.show()</span></pre><figure class="lz ma mb mc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/8a819dbd3a7de4af7619beb74c7b92d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_fQIAglIiOwbgHn3HbRS4w.png"/></div></div></figure><p id="f098" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">计数图看起来更适合预测。MSSubClass现在成为序数特征。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="c075" class="mi ju hi me b fi mj mk l ml mm">feature_num.remove('MSSubClass')<br/>feature_ordinal.append('MSSubClass')</span></pre><p id="8899" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对剩余的分类特征进行编码。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="2836" class="mi ju hi me b fi mj mk l ml mm">le = LabelEncoder()</span><span id="c9b3" class="mi ju hi me b fi mn mk l ml mm">df_whole = df_train.append(df_test)</span><span id="52f3" class="mi ju hi me b fi mn mk l ml mm">for x in feature_cat:<br/>    df_whole[x] = le.fit_transform(df_whole[x])</span><span id="6de2" class="mi ju hi me b fi mn mk l ml mm">df_train = df_whole[:len(df_train)]<br/>df_test = df_whole[len(df_train):]</span></pre><p id="7ee6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">移除高度相关的特征，与之前相同。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="5a83" class="mi ju hi me b fi mj mk l ml mm">catToDrop, catNotDrop = feature_corr(feature_cat, 0.8)<br/>for x in catToDrop:<br/> feature_cat.remove(x)</span></pre></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="9314" class="jt ju hi bd jv jw lo jy jz ka lp kc kd ke lq kg kh ki lr kk kl km ls ko kp kq bi translated">6.特征创建</h1><p id="e8d2" class="pw-post-body-paragraph iv iw hi ix b iy kt ja jb jc ku je jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated">特征的加/减:</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="c44b" class="mi ju hi me b fi mj mk l ml mm">df_train[‘TtlPorchArea’] = df_train.OpenPorchSF + df_train.EnclosedPorch + df_train[‘3SsnPorch’] + df_train.ScreenPorch + df_train.WoodDeckSF<br/>df_test[‘TtlPorchArea’] = df_test.OpenPorchSF + df_test.EnclosedPorch + df_test[‘3SsnPorch’] + df_test.ScreenPorch + df_test.WoodDeckSF</span><span id="1862" class="mi ju hi me b fi mn mk l ml mm">df_train[‘TtlFootage’] = df_train.GrLivArea + df_train.BsmtFinSF1 + df_train.BsmtFinSF2<br/>df_test[‘TtlFootage’] = df_test.GrLivArea + df_test.BsmtFinSF1 + df_test.BsmtFinSF2</span><span id="2a35" class="mi ju hi me b fi mn mk l ml mm">df_train[‘TtlBath’] = df_train.FullBath + 0.5*df_train.HalfBath + df_train.BsmtFullBath + 0.5*df_train.BsmtHalfBath<br/>df_test[‘TtlBath’] = df_test.FullBath + 0.5*df_test.HalfBath + df_test.BsmtFullBath + 0.5*df_test.BsmtHalfBath</span><span id="a5ab" class="mi ju hi me b fi mn mk l ml mm">df_train[‘Age’] = df_train[‘YrSold’] — df_train[‘YearBuilt’]<br/>df_test[‘Age’] = df_test[‘YrSold’] — df_test[‘YearBuilt’]</span><span id="33dc" class="mi ju hi me b fi mn mk l ml mm">df_train[‘Remod_Age’] = abs(df_train[‘YrSold’] — df_train[‘YearRemodAdd’])<br/>df_test[‘Remod_Age’] = abs(df_test[‘YrSold’] — df_test[‘YearRemodAdd’])</span><span id="0234" class="mi ju hi me b fi mn mk l ml mm">df_train[‘RemodSinceBuilt’] = df_train[‘YearRemodAdd’] — df_train[‘YearBuilt’]<br/>df_test[‘RemodSinceBuilt’] = df_test[‘YearRemodAdd’] — df_test[‘YearBuilt’]</span><span id="38ef" class="mi ju hi me b fi mn mk l ml mm">df_train[‘LivAndBsmt’] = df_train[‘GrLivArea’] + df_train[‘TotalBsmtSF’]*0.5<br/>df_test[‘LivAndBsmt’] = df_test[‘GrLivArea’] + df_test[‘TotalBsmtSF’]*0.5</span><span id="8bcb" class="mi ju hi me b fi mn mk l ml mm">feature_new_num = [‘TtlPorchArea’, ‘TtlFootage’, ‘TtlBath’, ‘Age’, ‘Remod_Age’, ‘RemodSinceBuilt’, ‘LivAndBsmt’]<br/>for x in feature_new_num:<br/>    feature_num.append(x)</span></pre><p id="aa49" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">二元特征:</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="3857" class="mi ju hi me b fi mj mk l ml mm">df_train.loc[df_train.OpenPorchSF&gt;0, ‘HasOpenPorch’] = 1<br/>df_train[‘HasOpenPorch’].fillna(0, inplace=True)<br/>df_test.loc[df_test.OpenPorchSF&gt;0, ‘HasOpenPorch’] = 1<br/>df_test[‘HasOpenPorch’].fillna(0, inplace=True)</span><span id="ab7f" class="mi ju hi me b fi mn mk l ml mm">df_train.loc[df_train[‘2ndFlrSF’]&gt;0, ‘Has2ndFlr’] = 1<br/>df_train[‘Has2ndFlr’].fillna(0, inplace=True)<br/>df_test.loc[df_test[‘2ndFlrSF’]&gt;0, ‘Has2ndFlr’] = 1<br/>df_test[‘Has2ndFlr’].fillna(0, inplace=True)</span><span id="33d5" class="mi ju hi me b fi mn mk l ml mm">df_train[‘HasPool’] = df_train.PoolArea.apply(lambda x: 1 if x &gt; 0 else 0)<br/>df_test[‘HasPool’] = df_test.PoolArea.apply(lambda x: 1 if x &gt; 0 else 0)</span><span id="5875" class="mi ju hi me b fi mn mk l ml mm">feature_new_cat = [‘HasOpenPorch’, ‘Has2ndFlr’, ‘HasPool’]<br/>for x in feature_new_cat:<br/>    feature_cat.append(x)</span></pre><p id="7994" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建新要素后，再次检查任何多重共线性并将其移除。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="ca40" class="mi ju hi me b fi mj mk l ml mm">numToDrop_2nd, numNotDrop_2nd = feature_corr(feature_num, 0.8)</span><span id="d7df" class="mi ju hi me b fi mn mk l ml mm">numToDrop_2nd<br/>numNotDrop_2nd</span><span id="8e6d" class="mi ju hi me b fi mn mk l ml mm">Output:<br/>['YearBuilt', 'YearRemodAdd', 'GrLivArea', 'TtlFootage']<br/>['Age', 'Remod_Age', 'LivAndBsmt', 'LivAndBsmt']</span><span id="e2b2" class="mi ju hi me b fi mn mk l ml mm">for x in numToDrop:<br/> feature_num.remove(x)</span></pre></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="b0d3" class="jt ju hi bd jv jw lo jy jz ka lp kc kd ke lq kg kh ki lr kk kl km ls ko kp kq bi translated">7.歪斜</h1><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="113a" class="mi ju hi me b fi mj mk l ml mm">df_whole = df_train.append(df_test)</span><span id="7ab9" class="mi ju hi me b fi mn mk l ml mm">skewed = df_whole[feature_num + feature_ordinal].apply(lambda x: skew(x)<br/>skewed.sort_values().plot(kind='bar')<br/>plt.subplots_adjust(bottom=0.3)<br/>plt.show()</span></pre><figure class="lz ma mb mc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/48e334579c4998a462a1d4baa126546a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ez-7PLkCmwZ0IomAdg1GUA.png"/></div></div></figure><p id="a765" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">减少数字特征的偏斜度。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="dda3" class="mi ju hi me b fi mj mk l ml mm">skewed_high = skewed[abs(skewed) &gt; 0.5]<br/>skewed_features = skewed_high.index</span><span id="b0ff" class="mi ju hi me b fi mn mk l ml mm">lam = 0.3<br/>for x in skewed_features:<br/>    df_whole[x] = boxcox1p(df_whole[x], lam)</span><span id="538f" class="mi ju hi me b fi mn mk l ml mm">skewed_rev = df_whole[feature_num + feature_ordinal].apply(lambda x: skew(x))<br/>skewed_rev.sort_values().plot(kind='bar')<br/>plt.subplots_adjust(bottom=0.3)<br/>plt.show()</span></pre><figure class="lz ma mb mc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/80f1620507a836cdda53606911f03d9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Maa5KlEcIxgjHYHz5F5Pgw.png"/></div></div></figure></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="b5cd" class="jt ju hi bd jv jw lo jy jz ka lp kc kd ke lq kg kh ki lr kk kl km ls ko kp kq bi translated">8.模型</h1><p id="5d55" class="pw-post-body-paragraph iv iw hi ix b iy kt ja jb jc ku je jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated">最终确定用于预测的要素。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="196f" class="mi ju hi me b fi mj mk l ml mm">feature_total = feature_num + feature_ordinal + feature_cat + feature_new_bin<br/>df_whole_final = df_whole[feature_total]</span></pre><p id="02a7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">获取分类特征的模型。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="5fe0" class="mi ju hi me b fi mj mk l ml mm">df_whole_final = pd.get_dummies(df_whole_final, columns=feature_cat)</span><span id="7f6b" class="mi ju hi me b fi mn mk l ml mm">df_train_final = df_whole_final[:len(df_train)]<br/>df_test_final = df_whole_final[len(df_train):]</span></pre><p id="7422" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们来看看SalePrice的分布。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="a253" class="mi ju hi me b fi mj mk l ml mm">sns.distplot(df_train.SalePrice)<br/>plt.show()</span></pre><figure class="lz ma mb mc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/293b73a78cc3f6d88ad016f5d4f6f270.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ToVu-q2ipblmw0yhecd8aw.png"/></div></div></figure><p id="d6dc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">销售价格的分布是右偏的。为了提高模型预测精度，应该减少偏斜度。我选择在SalePrice上记录日志。取对数后，销售价格的分布看起来类似于正态分布。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="a8f0" class="mi ju hi me b fi mj mk l ml mm">X_train = df_train_final<br/>y_train = np.log1p(df_train[‘SalePrice’])</span><span id="9b6e" class="mi ju hi me b fi mn mk l ml mm">sns.distplot(df_train.SalePrice)<br/>plt.show()</span></pre><figure class="lz ma mb mc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/6bbb14cfd1106986d316ca2622e739fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VTqKU2RNDnwby0OO_ofJ-Q.png"/></div></div></figure><p id="050f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我选择了Lasso模型进行预测。它工作得很好，也更快。让；调整模型参数。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="a9af" class="mi ju hi me b fi mj mk l ml mm">kfolds = KFold(n_splits=10, shuffle=True, random_state=42)</span><span id="7bbd" class="mi ju hi me b fi mn mk l ml mm">model_Lasso = Lasso(random_state=42)</span><span id="f661" class="mi ju hi me b fi mn mk l ml mm">grid_param_lasso = {‘alpha’: [0.0001, 0.0002, 0.0003, 0.0004, 0.0005]}</span><span id="bea2" class="mi ju hi me b fi mn mk l ml mm">gd_sr = GridSearchCV(estimator=model_Lasso,<br/> param_grid=grid_param_lasso,<br/> scoring=’neg_mean_squared_log_error’,<br/> cv=5,<br/> n_jobs=-1)</span><span id="d5ac" class="mi ju hi me b fi mn mk l ml mm">gd_sr.fit(X_train, y_train)<br/>best_parameters = gd_sr.best_params_<br/>print(best_parameters)</span><span id="1efc" class="mi ju hi me b fi mn mk l ml mm">Output:<br/>{'alpha': 0.0004}</span></pre><p id="c11c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们对训练数据集进行建模，并通过交叉验证生成预测得分。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="38f5" class="mi ju hi me b fi mj mk l ml mm">model_Lasso = Lasso(alpha=0.0004, random_state=42)</span><span id="b128" class="mi ju hi me b fi mn mk l ml mm">all_accuracies = np.sqrt(-cross_val_score(estimator=model_Lasso, X=X_train, y=y_train, scoring='neg_mean_squared_error', cv=kfolds))<br/>print(all_accuracies.mean())</span><span id="b03d" class="mi ju hi me b fi mn mk l ml mm">Output:<br/>0.10724677083241012</span></pre><p id="4ea2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">看看套索模型是如何挑选特征的。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="5e9a" class="mi ju hi me b fi mj mk l ml mm">coef = pd.Series(model_Lasso.coef_, index = X_train.columns)</span><span id="8e93" class="mi ju hi me b fi mn mk l ml mm">imp_coef = pd.concat([coef.sort_values().head(10),<br/> coef.sort_values().tail(10)])<br/>rcParams[‘figure.figsize’] = (8.0, 10.0)<br/>imp_coef.plot(kind = “barh”)<br/>plt.title(“Coefficients in Lasso Model”)</span></pre><figure class="lz ma mb mc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/c0a66e85e0c251e29ee07d8a42f8e871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fn3NPO5WaVTh3IrdMsCFBQ.png"/></div></div></figure><p id="3068" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">OverallCond和MsZoning_0的系数最大。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="0551" class="mi ju hi me b fi mj mk l ml mm">print("Lasso picked " + str(sum(coef != 0)) + " features and eliminated the other " +  str(sum(coef == 0)) + " features")</span><span id="b09b" class="mi ju hi me b fi mn mk l ml mm">Output:<br/>Lasso picked 91 features and eliminated the other 97 features</span></pre></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="ef3e" class="jt ju hi bd jv jw lo jy jz ka lp kc kd ke lq kg kh ki lr kk kl km ls ko kp kq bi translated">9.提交</h1><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="83ed" class="mi ju hi me b fi mj mk l ml mm">model_Lasso.fit(X_train, y_train)<br/>X_test = df_test_final<br/>predictions = np.exp(model_Lasso.predict(X_test))<br/>output = pd.DataFrame({‘Id’: df_test.Id, ‘SalePrice’: predictions.astype(float)})<br/>output.to_csv(‘my_submission.csv’, index=False)</span></pre><p id="a981" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Kaggle得分为0.11627(前13%)</p><figure class="lz ma mb mc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mr"><img src="../Images/e09cbfbcda9428b01a4166e73bd6d2c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OxsvSLkzM-9ORCk4UgFqyw.png"/></div></div></figure><p id="8def" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢您的阅读:)</p></div></div>    
</body>
</html>