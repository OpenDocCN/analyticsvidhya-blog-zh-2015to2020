<html>
<head>
<title>Generating Maps with Python: “Maps with Markers”-Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python生成地图:“带标记的地图”——第2部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/generating-maps-with-python-maps-with-markers-part-2-2e291d987821?source=collection_archive---------5-----------------------#2020-06-02">https://medium.com/analytics-vidhya/generating-maps-with-python-maps-with-markers-part-2-2e291d987821?source=collection_archive---------5-----------------------#2020-06-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/33a9e13aa81e3ed476dc424bc5afd113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Aookm3lta6MCKpzn6mtemA.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">作者图片</figcaption></figure><div class=""/><h1 id="3995" class="iu iv hx bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">带标记的地图</h1><p id="49d0" class="pw-post-body-paragraph js jt hx ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">让我们使用<strong class="ju hy"> pandas </strong> `read_csv()`方法下载并导入警察局事件的数据。</p><blockquote class="kq kr ks"><p id="4b2c" class="js jt kt ju b jv ku jx jy jz kv kb kc kw kx kf kg ky kz kj kk la lb kn ko kp hb bi translated">下载数据集并读入<strong class="ju hy">熊猫</strong>数据帧:</p></blockquote><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="b70c" class="ll iv hx lh b fi lm ln l lo lp"><strong class="lh hy">df_incidents = pd.read_csv('</strong><a class="ae lq" href="https://s3-api.us-geo.objectstorage.softlayer.net/cf-courses-data/CognitiveClass/DV0101EN/labs/Data_Files/Police_Department_Incidents_-_Previous_Year__2016_.csv'" rel="noopener ugc nofollow" target="_blank"><strong class="lh hy">https://s3-api.us-geo.objectstorage.softlayer.net/cf-courses-data/CognitiveClass/DV0101EN/labs/Data_Files/Police_Department_Incidents_-_Previous_Year__2016_.csv'</strong></a><strong class="lh hy">)</strong></span><span id="0983" class="ll iv hx lh b fi lr ln l lo lp"><strong class="lh hy">print('Dataset downloaded and read into a pandas dataframe!')</strong></span></pre><blockquote class="kq kr ks"><p id="3ed7" class="js jt kt ju b jv ku jx jy jz kv kb kc kw kx kf kg ky kz kj kk la lb kn ko kp hb bi translated">让我们看看数据集中的前五项。</p></blockquote><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="3d51" class="ll iv hx lh b fi lm ln l lo lp"><strong class="lh hy">df_incidents.head()</strong></span></pre><figure class="lc ld le lf fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ls"><img src="../Images/6bff7a51c56d25b9022960f5f9e593ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s0sprUMCXiWT5il2VsP0qQ.png"/></div></div></figure><p id="edad" class="pw-post-body-paragraph js jt hx ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">所以每一行由13个特征组成:<br/> 1。<strong class="ju hy">事件编号</strong>:事件编号<br/> 2。<strong class="ju hy">类别</strong>:犯罪或事件的类别<br/> 3。<strong class="ju hy">描述</strong>:犯罪或事件的描述<br/> 4。<strong class="ju hy"> DayOfWeek </strong>:事件发生的那一周的某一天<br/> 5。<strong class="ju hy">日期</strong>:事件发生的日期<br/> 6。时间:事件发生的当天的时间。警察局辖区8。<strong class="ju hy">决议</strong>:根据犯罪者是否被捕来解决犯罪问题。9。<strong class="ju hy">地址</strong>:距离事件发生地最近的地址<br/> 10。<strong class="ju hy"> X </strong>:案发地点的经度值<br/> 11。<strong class="ju hy"> Y </strong>:案发地点的纬度值<br/> 12。<strong class="ju hy">位置</strong>:经纬度值<br/> 13的元组。<strong class="ju hy"> PdId </strong>:警察部门Id</p><blockquote class="kq kr ks"><p id="9be7" class="js jt kt ju b jv ku jx jy jz kv kb kc kw kx kf kg ky kz kj kk la lb kn ko kp hb bi translated">让我们看看数据集中有多少条目。</p></blockquote><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="a3da" class="ll iv hx lh b fi lm ln l lo lp"><strong class="lh hy">df_incidents</strong>.shape</span></pre><p id="d17f" class="pw-post-body-paragraph js jt hx ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated"><em class="kt"> (150500，13) </em></p><p id="881d" class="pw-post-body-paragraph js jt hx ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">所以这个数据框架包含了150，500起犯罪，发生在2016年。以便降低计算成本。</p><blockquote class="kq kr ks"><p id="e787" class="js jt kt ju b jv ku jx jy jz kv kb kc kw kx kf kg ky kz kj kk la lb kn ko kp hb bi translated">让我们只处理这个数据集中的前100个事件。</p></blockquote><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="ddce" class="ll iv hx lh b fi lm ln l lo lp"># get the first 100 crimes in the df_incidents dataframe<br/><strong class="lh hy">limit = 100<br/>df_incidents = df_incidents.iloc[0:limit, :]</strong></span></pre><blockquote class="kq kr ks"><p id="f2b6" class="js jt kt ju b jv ku jx jy jz kv kb kc kw kx kf kg ky kz kj kk la lb kn ko kp hb bi translated">现在我们把数据简化了一点，让我们想象一下这些犯罪发生在旧金山的什么地方。我们将使用默认样式，并将缩放级别初始化为12。</p></blockquote><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="e438" class="ll iv hx lh b fi lm ln l lo lp"># San Francisco latitude and longitude values<br/><strong class="lh hy">latitude = 37.77<br/>longitude = -122.42</strong></span><span id="5af1" class="ll iv hx lh b fi lr ln l lo lp"># create map and display it<br/><strong class="lh hy">sanfran_map = folium.Map(location=[latitude, longitude], zoom_start=12)</strong></span><span id="f5c0" class="ll iv hx lh b fi lr ln l lo lp"># display the map of San Francisco<br/><strong class="lh hy">sanfran_map</strong></span></pre><figure class="lc ld le lf fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lt"><img src="../Images/940b3838be2b35ac2af70f96ccc77323.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XAGoxShZzXbpAJhNyzLouA.png"/></div></div></figure><blockquote class="kq kr ks"><p id="6f38" class="js jt kt ju b jv ku jx jy jz kv kb kc kw kx kf kg ky kz kj kk la lb kn ko kp hb bi translated">现在让我们把犯罪地点叠加到地图上。在<strong class="ju hy">叶子</strong>中的方法是创建一个具有自己特征和风格的<strong class="ju hy">特征组</strong>，然后将其添加到<strong class="ju hy"> sanfran_map </strong>中。</p></blockquote><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="5174" class="ll iv hx lh b fi lm ln l lo lp">#instantiate a feature group for the incidents in the dataframe</span><span id="f85c" class="ll iv hx lh b fi lr ln l lo lp"><strong class="lh hy">incidents = folium.map.FeatureGroup()</strong></span><span id="6a31" class="ll iv hx lh b fi lr ln l lo lp">#loop through the 100 crimes and add each to the incidents feature group</span><span id="915c" class="ll iv hx lh b fi lr ln l lo lp"><strong class="lh hy">for lat, lng, in zip(df_incidents.Y, df_incidents.X):<br/> incidents.add_child(<br/> folium.features.CircleMarker(<br/> [lat, lng],<br/> radius=5, # define how big you want the circle markers to be<br/> color=’yellow’,<br/> fill=True,<br/> fill_color=’blue’,<br/> fill_opacity=0.6<br/> )<br/>)</strong></span><span id="7335" class="ll iv hx lh b fi lr ln l lo lp"># add incidents to map<br/><strong class="lh hy">sanfran_map.add_child(incidents)</strong></span></pre><figure class="lc ld le lf fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lu"><img src="../Images/0631ac87392e4003197e87b9d731e3df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pQKCwGo1genQ1euj4imIgw.png"/></div></div></figure><p id="3c22" class="pw-post-body-paragraph js jt hx ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">您还可以添加一些弹出文本，当您将鼠标悬停在标记上时会显示这些文本。</p><blockquote class="kq kr ks"><p id="45d3" class="js jt kt ju b jv ku jx jy jz kv kb kc kw kx kf kg ky kz kj kk la lb kn ko kp hb bi translated">让我们将鼠标悬停在每个标记上时，显示犯罪的类别。</p></blockquote><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="3d9b" class="ll iv hx lh b fi lm ln l lo lp"># instantiate a feature group for the incidents in the dataframe<br/><strong class="lh hy">incidents = folium.map.FeatureGroup()</strong></span><span id="87e6" class="ll iv hx lh b fi lr ln l lo lp"># loop through the 100 crimes and add each to the incidents feature group</span><span id="993d" class="ll iv hx lh b fi lr ln l lo lp"><strong class="lh hy">for lat, lng, in zip(df_incidents.Y, df_incidents.X):<br/> incidents.add_child(<br/> folium.features.CircleMarker(<br/> [lat, lng],<br/> radius=5, # define how big you want the circle markers to be<br/> color=’yellow’,<br/> fill=True,<br/> fill_color=’red’,<br/> fill_opacity=0.6<br/>   )<br/> )</strong></span><span id="2ed9" class="ll iv hx lh b fi lr ln l lo lp"># add pop-up text to each marker on the map<br/><strong class="lh hy">latitudes = list(df_incidents.Y)<br/>longitudes = list(df_incidents.X)<br/>labels = list(df_incidents.Category)</strong></span><span id="5afa" class="ll iv hx lh b fi lr ln l lo lp"><strong class="lh hy">for lat, lng, label in zip(latitudes, longitudes, labels):<br/> folium.Marker([lat, lng], popup=label).add_to(sanfran_map) <br/> </strong><br/># add incidents to map<br/><strong class="lh hy">sanfran_map.add_child(incidents)</strong></span></pre><figure class="lc ld le lf fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/33a9e13aa81e3ed476dc424bc5afd113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Aookm3lta6MCKpzn6mtemA.png"/></div></div></figure><p id="154d" class="pw-post-body-paragraph js jt hx ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi lv translated">这真的很酷吗？现在，您可以知道每个标记处发生的犯罪类别。</p><p id="1201" class="pw-post-body-paragraph js jt hx ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">如果您发现地图上的所有标记都很拥挤，有一个解决这个问题的方法:</p><ol class=""><li id="daad" class="me mf hx ju b jv ku jz kv kd mg kh mh kl mi kp mj mk ml mm bi translated">正确的补救方法是将标记分组到不同的簇中。然后，每个聚类由每个邻域中的犯罪数量表示。这些集群可以被认为是旧金山的小块区域，您可以单独对其进行分析。</li></ol><blockquote class="kq kr ks"><p id="d31e" class="js jt kt ju b jv ku jx jy jz kv kb kc kw kx kf kg ky kz kj kk la lb kn ko kp hb bi translated">为了实现这一点，我们首先实例化一个<strong class="ju hy"> MarkerCluster </strong>对象，并将dataframe中的所有数据点添加到该对象中。</p></blockquote><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="1938" class="ll iv hx lh b fi lm ln l lo lp"><strong class="lh hy">from folium import plugins</strong></span><span id="94ce" class="ll iv hx lh b fi lr ln l lo lp"># let’s start again with a clean copy of the map of San Francisco<br/><strong class="lh hy">sanfran_map = folium.Map(location = [latitude, longitude], zoom_start = 12)</strong></span><span id="3759" class="ll iv hx lh b fi lr ln l lo lp"># instantiate a mark cluster object for the incidents in the dataframe<br/><strong class="lh hy">incidents = plugins.MarkerCluster().add_to(sanfran_map)</strong></span><span id="eca1" class="ll iv hx lh b fi lr ln l lo lp"># loop through the dataframe and add each data point to the mark cluster<br/><strong class="lh hy">for lat, lng, label, in zip(df_incidents.Y, df_incidents.X, df_incidents.Category):<br/> folium.Marker(<br/> location=[lat, lng],<br/> icon=None,<br/> popup=label,<br/> ).add_to(incidents)</strong></span><span id="7721" class="ll iv hx lh b fi lr ln l lo lp"># display map<br/><strong class="lh hy">sanfran_map</strong></span></pre><figure class="lc ld le lf fd hk er es paragraph-image"><div class="er es mn"><img src="../Images/c944e7a3a98e0141ac1b440489aca4f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*UR8jMFIEwhJU6QXzxDbEvA.gif"/></div></figure><p id="1606" class="pw-post-body-paragraph js jt hx ju b jv ku jx jy jz kv kb kc kd kx kf kg kh kz kj kk kl lb kn ko kp hb bi translated">请注意，当你一直缩小时，所有标记都被分组到一个集群中，<strong class="ju hy">全球集群</strong>，由<strong class="ju hy"> 100个标记</strong>或<strong class="ju hy">犯罪</strong>组成，这是我们数据框中的犯罪总数。一旦你开始放大，<strong class="ju hy">全局集群</strong>将开始分解成<strong class="ju hy">更小的集群</strong>。一直放大会产生单独的标记。</p><h1 id="e22b" class="iu iv hx bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">感谢观看</h1><p id="c926" class="pw-post-body-paragraph js jt hx ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">欲了解更多此类内容，请点击此处</p></div></div>    
</body>
</html>