<html>
<head>
<title>Developing WebServer using EFS as Storage as a Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用EFS作为存储即服务开发web服务器</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/developing-webserver-using-efs-as-storage-as-a-service-8654ef86b97b?source=collection_archive---------16-----------------------#2020-07-14">https://medium.com/analytics-vidhya/developing-webserver-using-efs-as-storage-as-a-service-8654ef86b97b?source=collection_archive---------16-----------------------#2020-07-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/8f10ab5cc437152886633ff3e533aed0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d-st3tmwmS82kN5SowQaSw.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="ca2b" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated">*我们必须做什么？</h2></div><p id="b3d5" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">1.创建一个允许端口80的安全组。</p><p id="f9b0" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">2.启动EC2实例。</p><p id="3a50" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">3.在这个Ec2实例中，使用我们在步骤1中创建的现有密钥或提供的密钥和安全组。</p><p id="9837" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">4.使用EFS服务启动一个卷并将其附加到您的vpc中，然后将该卷挂载到/var/www/html中。</p><p id="d133" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">5.开发人员已经上传到GitHub回购代码，回购也有一些图像。</p><p id="7ad1" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">6.将GitHub repo代码复制到/var/www/html中。</p><p id="c255" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">7.创建一个s3存储桶，将GitHub repo中的映像复制/部署到S3存储桶中，并将权限更改为public readable。</p><p id="8f13" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">8使用s3 bucket(包含图像)创建一个Cloudfront，并使用Cloudfront URL更新/var/www/html中的代码。</p></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><blockquote class="kl km kn"><p id="bf47" class="ji jj ko jk b jl jm iu jn jo jp ix jq kp js jt ju kq jw jx jy kr ka kb kc kd hb bi translated">注意:-</p><p id="9bfd" class="ji jj ko jk b jl jm iu jn jo jp ix jq kp js jt ju kq jw jx jy kr ka kb kc kd hb bi translated">除了步骤4，即创建EFS卷并使用EBS volume挂载到/var/www/html，您可以在我的上一篇文章(下面的链接)中获得上述任务的所有步骤的详细解释。</p></blockquote><div class="hh hi ez fb hj ks"><a rel="noopener follow" target="_blank" href="/@akashdeepg06/automating-aws-cloud-infrastructure-with-terraform-45d9d1160475"><div class="kt ab dw"><div class="ku ab kv cl cj kw"><h2 class="bd hu fi z dy kx ea eb ky ed ef hs bi translated">使用Terraform自动化AWS云基础架构</h2><div class="kz l"><h3 class="bd b fi z dy kx ea eb ky ed ef dx translated">*我们将要做什么？</h3></div><div class="la l"><p class="bd b fp z dy kx ea eb ky ed ef dx translated">medium.com</p></div></div><div class="lb l"><div class="lc l ld le lf lb lg hp ks"/></div></div></a></div></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><p id="7c67" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">因此，在解决创建EFS卷的部分问题之前，让我们看看什么是AWS_EFS，以及我们为什么使用而不是EBS。</p><blockquote class="kl km kn"><p id="c253" class="ji jj ko jk b jl jm iu jn jo jp ix jq kp js jt ju kq jw jx jy kr ka kb kc kd hb bi translated">E <!-- --> FS</p></blockquote><p id="e104" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi lh translated"><span class="l li lj lk bm ll lm ln lo lp di"> E </span> FS是运行任何具有高工作负载、需要可扩展存储并且必须快速产生输出的应用程序的最佳选择。它可以自动扩展，甚至可以应对最突然的工作负载高峰。在高容量存储需求时期过去后，EFS将自动缩减规模。EFS可以挂载到不同的AWS服务，并且可以从您的所有虚拟机进行访问。使用它来运行共享卷或进行大数据分析。您将始终为您实际使用的存储付费，而不是提前调配存储，这最终会造成浪费。</p></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><blockquote class="kl km kn"><p id="316f" class="ji jj ko jk b jl jm iu jn jo jp ix jq kp js jt ju kq jw jx jy kr ka kb kc kd hb bi translated">一个<!-- -->马赞EFS的好处</p></blockquote><p id="3b12" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi lh translated"><span class="l li lj lk bm ll lm ln lo lp di"> P </span>可扩展以支持任何工作负载的性能:EFS提供不断变化的工作负载所需的吞吐量。即使对于高达500，000 IOPS或每秒10 GB的工作负载，它也可以提供与文件系统突然增长相匹配的更高吞吐量。</p><p id="e60e" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi lh translated">能源弹性:自动增加或减少你的文件系统存储。删除或添加文件，从不打扰应用程序。一旦创建了EFS文件系统，您就可以添加文件，而不必担心存储资源调配。</p><p id="ca42" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi lh translated"><span class="l li lj lk bm ll lm ln lo lp di"> A </span>可访问的文件存储:本地服务器和EC2实例可以同时访问共享文件系统。EC2实例还可以通过VPC对等访问位于其他AWS区域的EFS文件系统。</p><p id="ed1f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi lh translated"><span class="l li lj lk bm ll lm ln lo lp di"> C </span>全面的托管服务:EFS是一项完整的托管服务，这意味着您的公司将永远不必修补、部署或维护您的文件系统。</p><p id="baf8" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi lh translated">节省成本:您只需为您使用的存储付费，因为没有预先配置、预付费用或承诺。此外，您可以使用<a class="ae lq" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/object-lifecycle-mgmt.html" rel="noopener ugc nofollow" target="_blank">生命周期管理</a>将一个月未使用的文件转移到更具成本效益的存储类别，这可以降低高达85%的费用。</p><p id="2982" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi lh translated"><span class="l li lj lk bm ll lm ln lo lp di"> T </span>更强的安全性和合规性:您可以使用当前的安全解决方案安全地访问文件系统，或者使用<a class="ae lq" href="https://aws.amazon.com/iam/" rel="noopener ugc nofollow" target="_blank"> AWS身份和访问管理(IAM) </a>、<a class="ae lq" href="https://aws.amazon.com/vpc/" rel="noopener ugc nofollow" target="_blank">亚马逊虚拟私有云(亚马逊VPC) </a>或<a class="ae lq" href="https://docs.aws.amazon.com/redshift/latest/dg/pattern-matching-conditions-posix.html" rel="noopener ugc nofollow" target="_blank"> POSIX </a>权限来控制对EFS文件系统的访问。此外，EFS可以加密您的数据，无论是传输中的还是静态的。这为您提供了可靠的安全性，并使法规遵从性更容易。</p></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><blockquote class="kl km kn"><p id="c202" class="ji jj ko jk b jl jm iu jn jo jp ix jq kp js jt ju kq jw jx jy kr ka kb kc kd hb bi translated">为什么要用EFS而不是EBS？</p></blockquote><p id="e4f0" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi lh translated">虽然EBS和EFS都提供了出色的功能，但这两种存储解决方案实际上是为两种完全不同的用途而构建的。EBS卷仅限于单个实例，更重要的是，一次只能由一个实例访问。使用EFS，您可以让成百上千个实例同时访问文件系统。这使得AWS EFS非常适合任何需要良好性能的集中式共享存储的应用，如媒体处理或共享代码库。</p><p id="7f23" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">您还可以使用AWS EFS来提供web内容，保存各种备份，并减少存储开支。虽然EFS的成本确实高于EBS(EFS为每GB 0.30美元，而EBS为每GB 0.10美元)，但您只需为每个EFS文件系统支付一次费用。这意味着，如果您附加了十几个实例，您仍将支付相同的金额，就好像您只附加了一个实例一样。使用EBS卷，您需要为每卷付费。因此，为了节省存储成本，EFS有时可以作为EBS的替代品。</p><p id="5598" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">EFS随容量一起扩展性能，虽然这在某些情况下非常有益，但也可能是一个严重的缺点。您可能没有足够高的利用率来达到文件系统的预期吞吐量。因为AWS EBS为您提供稳定且可预测的性能，EBS几乎总是更好的选择，除非您需要多个实例同时访问您的存储。</p></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h2 id="acc3" class="lr ls ht bd lt lu lv lw lx ly lz ma mb jr mc md me jv mf mg mh jz mi mj mk ml bi translated">*解决方案:-</h2><ul class=""><li id="03b6" class="mm mn ht jk b jl mo jo mp jr mq jv mr jz ms kd mt mu mv mw bi translated">正在创建EFS卷。</li></ul><pre class="mx my mz na fd nb nc nd ne aw nf bi"><span id="f403" class="lr ls ht nc b fi ng nh l ni nj"># — Creating EFS volume</span><span id="8b01" class="lr ls ht nc b fi nk nh l ni nj">resource “aws_efs_file_system” “efs” {<br/> creation_token = “efs”<br/> performance_mode = “generalPurpose”<br/> throughput_mode = “bursting”<br/> encrypted = “true”<br/> tags = {<br/> Name = “Efs”<br/> }<br/>}</span></pre><figure class="mx my mz na fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nl"><img src="../Images/d5a488fe73c406508754308bf80b5515.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*upzZXjTXseed-GM_Z_b0EA.png"/></div></div><figcaption class="nm nn et er es no np bd b be z dx translated">electrical field stimulation 电场刺激</figcaption></figure></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><ul class=""><li id="cf5a" class="mm mn ht jk b jl jm jo jp jr nq jv nr jz ns kd mt mu mv mw bi translated">将此EFS卷安装到/var/www/html。</li></ul><pre class="mx my mz na fd nb nc nd ne aw nf bi"><span id="c5b2" class="lr ls ht nc b fi ng nh l ni nj"># — Mounting the EFS volume</span><span id="fba8" class="lr ls ht nc b fi nk nh l ni nj">resource “aws_efs_mount_target” “efs-mount” {<br/> depends_on = [<br/> aws_instance.web_server,<br/> aws_security_group.sg,<br/> aws_efs_file_system.efs,<br/> ]<br/> <br/> file_system_id = “${aws_efs_file_system.efs.id}”<br/> subnet_id = “${aws_instance.web_server.subnet_id}”<br/> security_groups = [“${aws_security_group.sg.id}”]<br/> <br/> <br/> connection {<br/> type = “ssh”<br/> user = “ec2-user”<br/> private_key = “${tls_private_key.key1.private_key_pem}”<br/> host = “${aws_instance.web_server.public_ip}”<br/> }</span><span id="e176" class="lr ls ht nc b fi nk nh l ni nj">provisioner “remote-exec” {<br/> inline = [<br/> “sudo mount ${aws_efs_file_system.efs.id}:/ /var/www/html”,<br/> “sudo echo ‘${aws_efs_file_system.efs.id}:/ /var/www/html efs defaults,_netdev 0 0’ &gt;&gt; /etc/fstab”,<br/> “sudo rm -rf /var/www/html/*”,<br/> “sudo git clone <a class="ae lq" href="https://github.com/Akashdeep-47/cloud_task2.git" rel="noopener ugc nofollow" target="_blank">https://github.com/Akashdeep-47/cloud_task2.git</a> /var/www/html/”<br/> ]<br/> }<br/>}</span></pre><p id="8b2a" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">这里，我使用了默认的vpc和默认的子网id。</p></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h2 id="d4ae" class="lr ls ht bd lt lu lv lw lx ly lz ma mb jr mc md me jv mf mg mh jz mi mj mk ml bi translated">*最终结果:-</h2><figure class="mx my mz na fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nl"><img src="../Images/099b579f8818aa19b769947da3212b1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wFWYdDsD4BzfslPNeqIYIg.png"/></div></div><figcaption class="nm nn et er es no np bd b be z dx translated">任务2的结果</figcaption></figure><p id="7535" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">这个任务的完整代码，请参考我的Github库…</p><div class="hh hi ez fb hj ks"><a href="https://github.com/Akashdeep-47/cloud_task2.git" rel="noopener  ugc nofollow" target="_blank"><div class="kt ab dw"><div class="ku ab kv cl cj kw"><h2 class="bd hu fi z dy kx ea eb ky ed ef hs bi translated">Akashdeep-47/cloud_task2</h2><div class="kz l"><h3 class="bd b fi z dy kx ea eb ky ed ef dx translated">使用efs作为存储服务启动web服务器。为Akashdeep-47/cloud_task2的开发做出贡献</h3></div><div class="la l"><p class="bd b fp z dy kx ea eb ky ed ef dx translated">github.com</p></div></div><div class="lb l"><div class="nt l ld le lf lb lg hp ks"/></div></div></a></div><h2 id="a1ac" class="lr ls ht bd lt lu lv lw lx ly lz ma mb jr mc md me jv mf mg mh jz mi mj mk ml bi translated">请随意给些建议</h2><p id="1abf" class="pw-post-body-paragraph ji jj ht jk b jl mo iu jn jo mp ix jq jr nu jt ju jv nv jx jy jz nw kb kc kd hb bi translated">热烈欢迎所有的叉子和拍手。</p><blockquote class="kl km kn"><p id="acdc" class="ji jj ko jk b jl jm iu jn jo jp ix jq kp js jt ju kq jw jx jy kr ka kb kc kd hb bi translated">感谢您抽出宝贵的时间阅读本文。</p></blockquote></div></div>    
</body>
</html>