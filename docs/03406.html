<html>
<head>
<title>CamelCase Models with FastAPI and Pydantic</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带FastAPI和Pydantic的茶包模型</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/camel-case-models-with-fast-api-and-pydantic-5a8acb6c0eee?source=collection_archive---------0-----------------------#2020-01-30">https://medium.com/analytics-vidhya/camel-case-models-with-fast-api-and-pydantic-5a8acb6c0eee?source=collection_archive---------0-----------------------#2020-01-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="8028" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">最简单的方法是在保持模型大小写不变的情况下拥有骆驼式JSON请求/响应体</h2></div><h1 id="a890" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">介绍</h1><p id="a3fc" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我花了一段时间才弄明白如何将camel-caseing用于我一直在从事的快速API微服务端点之一，同时保持“模型”字段的蛇形封装。</p><p id="0678" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">关于<a class="ae kq" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank"> FastAPI </a>和<a class="ae kq" href="https://pydantic-docs.helpmanual.io/" rel="noopener ugc nofollow" target="_blank"> Pydantic </a>的文档非常棒，但是它并没有用一个简单易懂的例子来描述这部分。这就是为什么我决定创建这个教程。</p><p id="c4b3" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">我还创建了一个名为<code class="du kr ks kt ku b">fastapi_camelcase</code>的包，你可以使用<code class="du kr ks kt ku b">pip</code>安装并立即使用，我在这里写了一篇关于它的文章<a class="ae kq" rel="noopener" href="/@ahmed.nafies/fastapi-and-pydantic-camelcase-2db80d16b300"/>。</p><p id="e2f3" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated"><em class="kv">提示</em>:本教程假设您对FAST API有一些经验，并且知道如何使用Pydantic模型创建REST端点</p></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><h1 id="fcb4" class="ix iy hi bd iz ja ld jc jd je le jg jh io lf ip jj ir lg is jl iu lh iv jn jo bi translated">问题是</h1><p id="c2dd" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">让我们假设您有下面的应用程序，该应用程序公开了一个API端点，该端点在您的“models.py”中表示一个名为“User”的资源</p><pre class="li lj lk ll fd lm ku ln lo aw lp bi"><span id="8c65" class="lq iy hi ku b fi lr ls l lt lu">from pydantic import BaseModel<br/><br/><br/>class User(BaseModel):<br/>    first_name: str<br/>    last_name: str = None<br/>    age: int</span></pre><p id="e782" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">您有了包含“运行”配置的“main.py”</p><pre class="li lj lk ll fd lm ku ln lo aw lp bi"><span id="4fd0" class="lq iy hi ku b fi lr ls l lt lu">import uvicorn<br/>from fastapi import FastAPI<br/>from models import User<br/><br/><br/>app = FastAPI()<br/><br/><br/>@app.post("/user/", response_model=User)<br/>async def create_user(user: User):<br/>    return user<br/><br/><br/>if __name__ == "__main__":<br/>    uvicorn.run(app, host="0.0.0.0", port=8000)</span></pre><p id="dbb8" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">如果您运行该应用程序</p><pre class="li lj lk ll fd lm ku ln lo aw lp bi"><span id="a895" class="lq iy hi ku b fi lr ls l lt lu">python main.py</span></pre><figure class="li lj lk ll fd lw er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es lv"><img src="../Images/cf636779208eb506a4794f7e300bdfdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tw0z4L_-PkiKD5os7PtXLg.png"/></div></div><figcaption class="md me et er es mf mg bd b be z dx translated">snake_case请求/回复</figcaption></figure><p id="0b14" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">正如我们所料，我们将在OpenAPI文档中看到蛇形的请求/响应体。现在我们可以将字段名改为camelCase，但这不符合PEP-8标准。</p><figure class="li lj lk ll fd lw er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es mh"><img src="../Images/88a9bed0ad0e79e88c1451e46df66dfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*qC_vzKniv60pCscYKwSA4w.jpeg"/></div></div></figure><h1 id="53cd" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">Pydantic别名</h1><p id="9a74" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">pydantic模型的别名可以在camel case而不是snake case的JSON序列化中使用，如下所示:</p><pre class="li lj lk ll fd lm ku ln lo aw lp bi"><span id="7254" class="lq iy hi ku b fi lr ls l lt lu">from pydantic import BaseModel, Field<br/><br/><br/>class User(BaseModel):<br/>    first_name: str = Field(..., alias='firstName')<br/>    last_name: str = Field(..., alias='lastName')<br/>    age: int = Field(..., alias='age')</span></pre><p id="ff31" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">我们在camelCase中创建我们的模式</p><figure class="li lj lk ll fd lw er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es mi"><img src="../Images/833819ae0c32972bfd6b2ef3bc828e0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MDXY8LMwtvmH2IR6iUMRcg.png"/></div></div><figcaption class="md me et er es mf mg bd b be z dx translated">camel-case请求/响应主体</figcaption></figure><p id="abf3" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">如果我们有1000个字段而不是3个，我们现在怎么办？我希望有一个神奇的别名生成器。</p><p id="39e4" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated"><strong class="jr hj">幸好有:)</strong></p><h2 id="dd9c" class="lq iy hi bd iz mj mk ml jd mm mn mo jh jy mp mq jj kc mr ms jl kg mt mu jn mv bi translated">别名生成器</h2><p id="68b2" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">Pyndantic有一个控制模型行为的<a class="ae kq" href="https://pydantic-docs.helpmanual.io/usage/model_config/" rel="noopener ugc nofollow" target="_blank"> Config </a>类。我们可以为所有模型字段生成别名，如下所示:</p><pre class="li lj lk ll fd lm ku ln lo aw lp bi"><span id="0726" class="lq iy hi ku b fi lr ls l lt lu">from pydantic import BaseModel<br/>from humps import camelize<br/><br/><br/>def to_camel(string):<br/>    return camelize(string)<br/><br/><br/>class User(BaseModel):<br/>    first_name: str<br/>    last_name: str = None<br/>    age: float<br/><br/>    class Config:<br/>        alias_generator = to_camel</span></pre><p id="59cf" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">现在让我们试一试</p><figure class="li lj lk ll fd lw er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es mi"><img src="../Images/b6c109ef1c866e46d92258864463c632.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BL9IkxW0KmAAUx4iQu7eug.png"/></div></div><figcaption class="md me et er es mf mg bd b be z dx translated">内部服务器错误</figcaption></figure><p id="0cd1" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">内部服务器错误？说什么？</p><figure class="li lj lk ll fd lw"><div class="bz dy l di"><div class="mw mx l"/></div></figure><figure class="li lj lk ll fd lw er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es my"><img src="../Images/9af4e3f64d13c700e45847f2662f313c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TTizirTdRBUJ2Dyqc6_yGg.png"/></div></div><figcaption class="md me et er es mf mg bd b be z dx translated">错误日志</figcaption></figure><p id="d977" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">当然，我们使用别名(camelCase)而不是字段名(snake_case)，我希望有一个简单的方法来解决这个问题</p><p id="2cae" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated"><strong class="jr hj">幸好有:D </strong></p><p id="d8c2" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">所需要做的就是将以下内容添加到模型配置类中</p><pre class="li lj lk ll fd lm ku ln lo aw lp bi"><span id="a2f2" class="lq iy hi ku b fi lr ls l lt lu">allow_population_by_field_name = True</span></pre><p id="14d3" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">所以我们的模型现在应该是这样的</p><pre class="li lj lk ll fd lm ku ln lo aw lp bi"><span id="9b93" class="lq iy hi ku b fi lr ls l lt lu">from pydantic import BaseModel<br/>from humps import camelize<br/><br/><br/>def to_camel(string):<br/>    return camelize(string)<br/><br/><br/>class User(BaseModel):<br/>    first_name: str<br/>    last_name: str = None<br/>    age: float<br/><br/>    class Config:<br/>        alias_generator = to_camel<br/>        allow_population_by_field_name = True</span></pre><p id="ebfd" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">让我们再试最后一次</p><figure class="li lj lk ll fd lw er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es mz"><img src="../Images/4eee1ca377a924ce551a39a11aa90952.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lP3ei_ddm_Twdk5xNOBq5g.png"/></div></div><figcaption class="md me et er es mf mg bd b be z dx translated">成功的宁静</figcaption></figure><p id="99db" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">然后嘣！，我们所有的代码都在snake_case中，请求/响应和文档都在camelCase中，这不是很棒吗？</p><h1 id="f5f2" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">最后一个增强</h1><p id="ba81" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我们可能会有许多API端点使用的许多模型，我们希望在它们之间使用camelCase，对吗？大概是:)</p><p id="08ee" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">现在让我们使用继承的力量</p><pre class="li lj lk ll fd lm ku ln lo aw lp bi"><span id="8b5a" class="lq iy hi ku b fi lr ls l lt lu">from pydantic import BaseModel<br/>from humps import camelize<br/><br/><br/>def to_camel(string):<br/>    return camelize(string)<br/><br/><br/>class CamelModel(BaseModel):<br/>    class Config:<br/>        alias_generator = to_camel<br/>        allow_population_by_field_name = True</span><span id="6a8d" class="lq iy hi ku b fi na ls l lt lu"><br/>class User(CamelModel):<br/>    first_name: str<br/>    last_name: str = None<br/>    age: int</span></pre><p id="1389" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">太好了，现在你可以继承<code class="du kr ks kt ku b">CamelModel</code>而不是<code class="du kr ks kt ku b">BaseModel</code>了，尽情享受吧！！！</p><p id="11fb" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">按照上面的教程，我创建了一个简单易用的包。</p><p id="bc89" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated"><code class="du kr ks kt ku b">pip install fastapi_camelcase</code></p><pre class="li lj lk ll fd lm ku ln lo aw lp bi"><span id="bb10" class="lq iy hi ku b fi lr ls l lt lu">from fastapi_camelcase import CamelModel</span><span id="6564" class="lq iy hi ku b fi na ls l lt lu">class User(CamelModel):<br/>    first_name: str<br/>    last_name: str = None<br/>    age: int</span></pre><p id="73dd" class="pw-post-body-paragraph jp jq hi jr b js kl ij ju jv km im jx jy kn ka kb kc ko ke kf kg kp ki kj kk hb bi translated">这个例子的完整代码可以在github的找到</p></div></div>    
</body>
</html>