<html>
<head>
<title>Creating Contour Lines on Folium Map with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python在树叶地图上创建等高线</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/creating-contour-lines-on-folium-map-with-python-b7994e67924b?source=collection_archive---------5-----------------------#2019-12-05">https://medium.com/analytics-vidhya/creating-contour-lines-on-folium-map-with-python-b7994e67924b?source=collection_archive---------5-----------------------#2019-12-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="47bf" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">等高线为你的视觉化和地图增加额外的维度</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/807298e9d3f4cb23669eea3ac7e4644a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1jMj_kiNcUmL-DMw"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">安妮·斯普拉特在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h2 id="5e77" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">学分:</h2><ul class=""><li id="af8b" class="km kn hi ko b kp kq kr ks jz kt kd ku kh kv kw kx ky kz la bi translated">【https://pypi.org/project/geojsoncontour/】T5<a class="ae jn" href="https://pypi.org/project/geojsoncontour/" rel="noopener ugc nofollow" target="_blank">T6</a></li><li id="c2cb" class="km kn hi ko b kp lb kr lc jz ld kd le kh lf kw kx ky kz la bi translated"><a class="ae jn" href="https://www.tjansson.dk/2018/10/contour-map-in-folium/" rel="noopener ugc nofollow" target="_blank"><strong class="ko hj">https://www.tjansson.dk/2018/10/contour-map-in-folium/</strong></a></li><li id="b9dd" class="km kn hi ko b kp lb kr lc jz ld kd le kh lf kw kx ky kz la bi translated"><strong class="ko hj"> Jorge Manchola在代码的第4块中捕捉错误</strong></li></ul><p id="37e7" class="pw-post-body-paragraph lg lh hi ko b kp li ij lj kr lk im ll jz lm ln lo kd lp lq lr kh ls lt lu kw hb bi translated">在许多情况下，我们可能会遇到在二维地图上添加第三维空间的需要，如海拔、降雨量、温度、人口和许多其他信息。创建等高线是一种方法。这篇文章将引导你一步一步地使用Python在follow上创建轮廓线。</p><p id="1381" class="pw-post-body-paragraph lg lh hi ko b kp li ij lj kr lk im ll jz lm ln lo kd lp lq lr kh ls lt lu kw hb bi translated"><strong class="ko hj">该过程所需的库有:</strong></p><p id="ffae" class="pw-post-body-paragraph lg lh hi ko b kp li ij lj kr lk im ll jz lm ln lo kd lp lq lr kh ls lt lu kw hb bi translated">numpy，pandas，leav，branca，matplotlib.pyplot，scipy.interpolate，geojsoncontour，scipy，Raster2xyz，tiffile和rasterio。其中一些是常用的，但其余的是特殊的映射。根据你的三维数据的文件格式，你可以跳过一些代码，或者你可能需要使用不同的工具来读取不同的文件格式。在本例中，我们将使用TIFF格式的DEM(数字高程模型)。</p><p id="9827" class="pw-post-body-paragraph lg lh hi ko b kp li ij lj kr lk im ll jz lm ln lo kd lp lq lr kh ls lt lu kw hb bi translated">以TIFF格式读取DEM并显示。</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="5fa6" class="jo jp hi lw b fi ma mb l mc md"><strong class="lw hj">import</strong> tifffile <strong class="lw hj">as</strong> tiff<br/><strong class="lw hj">import</strong> matplotlib.pyplot <strong class="lw hj">as</strong> plt<br/><strong class="lw hj">import</strong> rasterio</span><span id="a7a0" class="jo jp hi lw b fi me mb l mc md">filename = '../path/...TIF' # name the file path and name<br/>tfile <strong class="lw hj">=</strong> tiff.imread(filename) # read the data<br/>tfile.shape # arrange the data into an array<br/>tiff.imshow(tfile) # display the map</span></pre><p id="fe61" class="pw-post-body-paragraph lg lh hi ko b kp li ij lj kr lk im ll jz lm ln lo kd lp lq lr kh ls lt lu kw hb bi translated">上面的代码产生了下图。如果这是您唯一需要的东西，那么您就万事俱备了。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mf"><img src="../Images/0eacd0847fdfd167922fc4ed2ca40bcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HZJdTWR-tgojSroV-PQ4fQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">根据数字高程模型制作的佛罗里达基韦斯特地图</figcaption></figure><p id="36d4" class="pw-post-body-paragraph lg lh hi ko b kp li ij lj kr lk im ll jz lm ln lo kd lp lq lr kh ls lt lu kw hb bi translated">上图显示了x，y坐标中的地图，主要显示了低于零平均海平面的海拔。我们可能希望从DEM中获取更多信息，例如地表高程。我们可能需要创建等高线来显示更多信息的地图。让我们创建等高线，并显示在叶。</p><p id="8aba" class="pw-post-body-paragraph lg lh hi ko b kp li ij lj kr lk im ll jz lm ln lo kd lp lq lr kh ls lt lu kw hb bi translated"><strong class="ko hj">等高线生成</strong></p><p id="602a" class="pw-post-body-paragraph lg lh hi ko b kp li ij lj kr lk im ll jz lm ln lo kd lp lq lr kh ls lt lu kw hb bi translated">首先，我们希望将图像保存为<strong class="ko hj"> csv </strong>格式，如下所示:</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="86f5" class="jo jp hi lw b fi ma mb l mc md"><strong class="lw hj">from</strong> raster2xyz.raster2xyz <strong class="lw hj">import</strong> Raster2xyz</span><span id="17ac" class="jo jp hi lw b fi me mb l mc md">input_raster = filename # set the input file name<br/>out_csv = filename + ".csv" # set the output file name</span><span id="d4e9" class="jo jp hi lw b fi me mb l mc md">rtxyz = Raster2xyz(input_raster) # transform raster to x,y,z<br/>rtxyz.translate(input_raster, out_csv) # save to a csv file</span><span id="9ebc" class="jo jp hi lw b fi me mb l mc md">DEM = pd.read_csv('Job504475_2007_FDEM_South_xyz.csv', header = None, names = ['longitude','latitude','elevation'])# read the x,y,z file and assign the column names<br/>DEM.drop(DEM.head(1).index, inplace=True)# delete the first row that contain labels 'x,y,z'<br/>DEM = DEM.replace(',','.', regex=True).astype(float) # set data type to float, they were saved as strings</span></pre><p id="c434" class="pw-post-body-paragraph lg lh hi ko b kp li ij lj kr lk im ll jz lm ln lo kd lp lq lr kh ls lt lu kw hb bi translated">为了在leav上显示我们的地图，我们需要将我们的坐标转换成经度和纬度格式。下面的循环将完成这项工作。但是，请记住，根据文件的大小，这个过程可能非常耗时。作为练习，使用一个小数据集来确保您的代码有效。</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="e16c" class="jo jp hi lw b fi ma mb l mc md">R = 6371 # Earth radius in km<br/>for i in range(1,len(DEM)):<br/>    DEM['latitude'][i] = np.degrees(np.arcsin(DEM['elevation'][i]/(3.280833*R*1000))) # our data is in ft.<br/>    DEM['longitude'][i] = np.degrees(np.arctan2(DEM['latitude'][i]/(3.280833*1000), DEM['longitude'][i]/(3.280833*1000)))<br/>DEM = DEM.to_csv("DEM.csv", index=True, header=True) # save to csv</span></pre><p id="16c5" class="pw-post-body-paragraph lg lh hi ko b kp li ij lj kr lk im ll jz lm ln lo kd lp lq lr kh ls lt lu kw hb bi translated">现在，我们准备创建基韦斯特地图的等高线高程。为此，我们需要导入一些库。如果您还没有这样做，您可能需要预安装其中的一些。</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="158b" class="jo jp hi lw b fi ma mb l mc md"><strong class="lw hj">import</strong> folium<br/><strong class="lw hj">import</strong> branca<br/><strong class="lw hj">from</strong> folium <strong class="lw hj">import</strong> plugins<br/><strong class="lw hj">from</strong> scipy.interpolate <strong class="lw hj">import</strong> griddata<br/><strong class="lw hj">import</strong> geojsoncontour<br/><strong class="lw hj">import</strong> scipy as sp<br/><strong class="lw hj">import</strong> scipy.ndimage</span><span id="a0eb" class="jo jp hi lw b fi me mb l mc md">%matplotlib inline</span><span id="63c1" class="jo jp hi lw b fi me mb l mc md"># Read the digital elevation  model in longitude, latitude and elevation format.<br/>DEM = pd.read_csv('DEM.csv', header = None, names = ['longitude','latitude','elevation'])</span><span id="9bac" class="jo jp hi lw b fi me mb l mc md"># Set all negative elevations to zero to show that they will be under the mean sea level of zero<br/>for i in range(0,len(DEM)):<br/>    if DEM['elevation'][i] &lt;= 0.:<br/>        DEM['elevation'][i] = 0.</span><span id="b72d" class="jo jp hi lw b fi me mb l mc md"># Setup minimum and maximum values for the contour lines<br/>vmin = DEM['elevation'].min() <br/>vmax = DEM['elevation'].max()</span><span id="f30f" class="jo jp hi lw b fi me mb l mc md"># Setup colormap<br/>colors = ['blue','royalblue', 'navy','pink',  'mediumpurple',  'darkorchid',  'plum',  'm', 'mediumvioletred', 'palevioletred', 'crimson',<br/>         'magenta','pink','red','yellow','orange', 'brown','green', 'darkgreen']<br/>levels = len(colors)<br/>cm     = branca.colormap.LinearColormap(colors, vmin=vmin, vmax=vmax).to_step(levels)</span><span id="fc41" class="jo jp hi lw b fi me mb l mc md"># Convertion from dataframe to array<br/>x = np.asarray(DEM.longitude.tolist())<br/>y = np.asarray(DEM.latitude.tolist())<br/>z = np.asarray(DEM.elevation.tolist()) </span><span id="e1b2" class="jo jp hi lw b fi me mb l mc md"># Make a grid<br/>x_arr          = np.linspace(np.min(x), np.max(x), 500)<br/>y_arr          = np.linspace(np.min(y), np.max(y), 500)<br/>x_mesh, y_mesh = np.meshgrid(x_arr, y_arr)<br/> <br/># Grid the elevation (Edited on March 30th, 2020)<br/>z_mesh = griddata((x, y), z, (x_mesh, y_mesh), method='linear')<br/> <br/># Use Gaussian filter to smoothen the contour<br/>sigma = [5, 5]<br/>z_mesh = sp.ndimage.filters.gaussian_filter(z_mesh, sigma, mode='constant')<br/> <br/># Create the contour<br/>contourf = plt.contourf(x_mesh, y_mesh, z_mesh, levels, alpha=0.5, colors=colors, linestyles='None', vmin=vmin, vmax=vmax)</span></pre><p id="d25b" class="pw-post-body-paragraph lg lh hi ko b kp li ij lj kr lk im ll jz lm ln lo kd lp lq lr kh ls lt lu kw hb bi translated">上面的代码以MatPlotLib格式创建等高线。这与leav map不兼容。所以我们需要用下面的代码把这个等高线转换成GeoJson格式。</p><pre class="iy iz ja jb fd lv lw lx ly aw lz bi"><span id="2210" class="jo jp hi lw b fi ma mb l mc md"># Convert matplotlib contourf to geojson<br/>geojson = geojsoncontour.contourf_to_geojson(<br/>    contourf=contourf,<br/>    min_angle_deg=3.0,<br/>    ndigits=5,<br/>    stroke_width=1,<br/>    fill_opacity=0.1)<br/> <br/># Set up the map placeholdder<br/>geomap1 = folium.Map([DEM.latitude.mean(), DEM.longitude.mean()], zoom_start=12, tiles="OpenStreetMap")</span><span id="9f43" class="jo jp hi lw b fi me mb l mc md"># Plot the contour on Folium map<br/>folium.GeoJson(<br/>    geojson,<br/>    style_function=lambda x: {<br/>        'color':     x['properties']['stroke'],<br/>        'weight':    x['properties']['stroke-width'],<br/>        'fillColor': x['properties']['fill'],<br/>        'opacity':   0.5,<br/>    }).add_to(geomap1)<br/> <br/># Add the colormap to the folium map for legend<br/>cm.caption = 'Elevation'<br/>geomap1.add_child(cm)<br/> <br/># Add the legend to the map<br/>plugins.Fullscreen(position='topright', force_separate_button=True).add_to(geomap1)<br/>geomap1</span></pre><p id="eb3c" class="pw-post-body-paragraph lg lh hi ko b kp li ij lj kr lk im ll jz lm ln lo kd lp lq lr kh ls lt lu kw hb bi translated">下图是我们佛罗里达州基韦斯特的等高线高程图。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mg"><img src="../Images/fc03fb8f0a41a63b513b5f1bae1f8026.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iTaGcCpRYlw31mQwJYXI6Q.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">佛罗里达基韦斯特等高线地图</figcaption></figure><p id="77d3" class="pw-post-body-paragraph lg lh hi ko b kp li ij lj kr lk im ll jz lm ln lo kd lp lq lr kh ls lt lu kw hb bi translated">享受创建地图，我希望我能与你分享更多的地图技巧。</p><p id="204d" class="pw-post-body-paragraph lg lh hi ko b kp li ij lj kr lk im ll jz lm ln lo kd lp lq lr kh ls lt lu kw hb bi translated">数据来源:美国国家海洋和大气局</p></div></div>    
</body>
</html>