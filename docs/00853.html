<html>
<head>
<title>When Addresses Alone Are Not Enough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当仅有地址还不够时</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/when-addresses-alone-are-not-enough-35da9b37bbea?source=collection_archive---------6-----------------------#2019-09-13">https://medium.com/analytics-vidhya/when-addresses-alone-are-not-enough-35da9b37bbea?source=collection_archive---------6-----------------------#2019-09-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="ec21" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">Python中的地理编码和反向地理编码</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ix"><img src="../Images/9bf6df2b88d5e6832005e4e5a0ef84a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*MjKv0sQPfrYxNCP_6238bQ.png"/></div><figcaption class="jf jg et er es jh ji bd b be z dx translated">代表ArcGIS网站地理编码内容的漫画:<a class="ae jj" href="https://developers.arcgis.com/assets/img/features/features-hero_geocoding.png" rel="noopener ugc nofollow" target="_blank">https://developers . ArcGIS . com/assets/img/features/features-hero _ geocoding . png</a></figcaption></figure><p id="c111" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">在之前的一个项目中，我试图预测一家餐厅是否会获得纽约市健康和心理卫生部门的A级检查，我的一个想法是:如果能看到一些餐厅因严重违规而被传讯的区域，看看是否有一种模式，这不是很好吗？违规越严重，餐厅获得a的机会就越小。但是，用于项目的数据集不包括经度和纬度坐标，而这是在地图上绘制位置所必需的。然后我听说了地理编码，这个问题的解决方案。</p><h1 id="9ee2" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated"><strong class="ak">什么是地理编码？</strong></h1><p id="5f1a" class="pw-post-body-paragraph jk jl hi jm b jn ky ij jp jq kz im js jt la jv jw jx lb jz ka kb lc kd ke kf hb bi translated">根据谷歌地图地理编码API的<a class="ae jj" href="https://developers.google.com/maps/documentation/geocoding/start" rel="noopener ugc nofollow" target="_blank">网站</a>:</p><blockquote class="ld le lf"><p id="a7bc" class="jk jl lg jm b jn jo ij jp jq jr im js lh ju jv jw li jy jz ka lj kc kd ke kf hb bi translated"><strong class="jm hj">地理编码</strong>是将地址(如街道地址)转换为地理坐标(如纬度和经度)的过程，您可以使用地理坐标在地图上放置标记或定位地图。</p></blockquote><p id="bd20" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">既然有把地址转换成坐标的方法，那就一定有逆向工作，把坐标转换成地址的方法。这叫做<strong class="jm hj">反向地理编码。</strong>这里我将重点介绍地理编码，但同样的步骤也可用于反向地理编码。</p><h1 id="7216" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">地理编码是怎么做的？</h1><p id="3b2a" class="pw-post-body-paragraph jk jl hi jm b jn ky ij jp jq kz im js jt la jv jw jx lb jz ka kb lc kd ke kf hb bi translated">现在我们了解了什么是地理编码，下一个大问题是:地理编码是如何完成的？答案是:地理编码器！</p><p id="4db5" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated"><strong class="jm hj">地理编码器</strong>是一个软件或网络服务，由一个参考数据集和一个算法组成，实现将地址转换为经度和纬度坐标的过程。有多种地理编码器可用，如ArcGIS、Google Maps地理编码API、TIGER(美国人口普查)和Nominatim(使用OpenStreetMaps中的数据)。</p><p id="aef9" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">但是使用哪一种地理编码器最好呢？选择地理编码器取决于数据和经验。有几种方法可以测试地理编码器，以了解哪种方法符合您的目的，例如单独使用每个地理编码API。作为一个新手，我决定使用一个可以访问各种地理编码器的库。</p></div><div class="ab cl lk ll gp lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hb hc hd he hf"><h1 id="fc56" class="kg kh hi bd ki kj lr kl km kn ls kp kq io lt ip ks ir lu is ku iu lv iv kw kx bi translated">GeoPy用于地理编码的Python解决方案</h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es lw"><img src="../Images/9a971206b91e52a22fc1e382cd3f8f7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I9Miy4XzfFIewVJe5GclRg.png"/></div></div><figcaption class="jf jg et er es jh ji bd b be z dx translated">GeoPy网站上的logo:<a class="ae jj" href="https://geopy.readthedocs.io/en/stable/_images/logo-wide.png" rel="noopener ugc nofollow" target="_blank">https://geo py . readthedocs . io/en/stable/_ images/logo-wide . png</a></figcaption></figure><p id="b3c4" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">正如他们的文档中所描述的，<strong class="jm hj"> GeoPy </strong>是一个Python包，作为一个客户端来提供对web上一些最流行的地理编码器的一致访问。对于那些熟悉使用数据库的人来说，这个包类似于使用Python驱动程序来访问MySQL(即mysql连接器)或PostgreSQL数据库(即。psycopg2)。</p><blockquote class="ld le lf"><p id="c488" class="jk jl lg jm b jn jo ij jp jq jr im js lh ju jv jw li jy jz ka lj kc kd ke kf hb bi translated">Geopy使Python开发人员能够使用第三方地理编码器和其他数据源轻松定位地址、城市、国家和地标的坐标</p></blockquote><p id="8ac3" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">最好的部分是它与Pandas配合得很好，这对批量地理编码真的很有帮助(想象一下你有一个很大的地址列表，批量地理编码比转换单个地址更高效)。</p><h1 id="3dd3" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">与地质公园和熊猫一起工作</h1><p id="752c" class="pw-post-body-paragraph jk jl hi jm b jn ky ij jp jq kz im js jt la jv jw jx lb jz ka kb lc kd ke kf hb bi translated">了解一个包的最好方法就是直接投入进去。回到我开始研究地理编码的原因，我决定使用我之前项目中的纽约餐馆检查数据来试验GeoPy。对于那些对这个迷你项目的完整代码感兴趣的人，可以在Github <a class="ae jj" href="https://github.com/lasoya/Restaurant_Inspections_Map" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><ol class=""><li id="b581" class="mb mc hi jm b jn jo jq jr jt md jx me kb mf kf mg mh mi mj bi translated">首先，<strong class="jm hj">使用pip </strong> — <strong class="jm hj"> <em class="lg">安装GeoPy。</em>T9】</strong></li></ol><p id="bb47" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">2.接下来，<strong class="jm hj">清理数据</strong>。对于Pandas的批量地理编码，这也涉及到将地址隔离到它自己的列中。</p><p id="05a4" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated"><strong class="jm hj"> <em class="lg">这一步为什么重要？</em>T15】</strong></p><p id="1b5c" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">嗯，如果地址中的拼写有差异，或者地址中单词的顺序有差异，这可能会导致错误。因为每个地址都与后端参考表上的条目进行比较，所以如果地址的格式与表上的条目不同，则不会对其进行地理编码。</p><p id="6eef" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">3.既然数据是干净的，地址也是独立的，是时候通过地理编码器运行它了。由于这是我第一次进行地理编码，对于这个迷你项目，使用了默认的地理编码器。但是，也可以使用其他地理编码器。</p><ul class=""><li id="8a48" class="mb mc hi jm b jn jo jq jr jt md jx me kb mf kf mk mh mi mj bi translated">每个地理编码器都使用自己的参考数据集。如果一个地理编码器没有产生任何结果，尝试另一个地理编码器可能会解决问题。例如，当我使用nomist对地址进行地理编码:“1057 LEXINGTON AVENUE MANHATTAN NY 10021”时，出现了一个错误，即没有找到该地址。然而，当我在谷歌地图上查找时，却发现。</li></ul><p id="e710" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">以下是使用GeoPy和Pandas进行批量地理编码的通用代码:</p><pre class="iy iz ja jb fd ml mm mn mo aw mp bi"><span id="0b4e" class="mq kh hi mm b fi mr ms l mt mu"># import modules from geopy library<br/>from geopy.geocoders import Nominatim<br/>from geopy.extra.rate_limiter import RateLimiter<br/><br/># create an instance of the geocoder<br/>geolocator = Nominatim(user_agent="inspections_locations")<br/><br/># create an instance or geocoder object with rate limit implemented<br/>geocode = RateLimiter(geolocator.geocode, min_delay_seconds=1, max_retries=0)<br/><br/># create a new column in dataframe for storing the location details from geocoding<br/>df['LOCATION'] = df['ADDRESS'].apply(geocode)<br/><br/># create a new column called POINT and fill column with coordinates as tuple pulled from the Location column<br/>df['POINT'] = df['LOCATION'].apply(lambda LOC: tuple(LOC.point) if LOC else None)</span></pre><ul class=""><li id="b807" class="mb mc hi jm b jn jo jq jr jt md jx me kb mf kf mk mh mi mj bi translated">正如您可能在上面的代码片段中注意到的，使用了RateLimiter对象。这是因为批量地理编码会淹没地理编码服务，其容量与任何API相同。为了防止这种情况，有必要在每个地址或地址子集被处理后增加一个延迟。在这个小型项目中，数据以100个子集的形式输入地理编码器，每个地址后延迟1秒。</li><li id="9a1c" class="mb mc hi jm b jn mv jq mw jt mx jx my kb mz kf mk mh mi mj bi translated">重试次数也可以在RateLimiter对象下编辑。多次通过地理编码器运行地址可能会延迟整个地理编码过程，这可能是因为难以将地址与一组坐标进行匹配，也可能是因为连接问题。因此，使用这个参数来限制重试次数是很有帮助的，这样可以减少总的花费时间。在这种情况下，我将最大重试次数设置为0。</li></ul><p id="7aa2" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">最终，在800个唯一地址中，有486个地址能够转换成地理坐标。不完美，但这些结果对我来说已经足够了。</p><p id="4415" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">唷！好了，地理编码步骤到此结束。很简单，对吧？即使是批量地理编码，也只有3个主要步骤。</p></div><div class="ab cl lk ll gp lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hb hc hd he hf"><h1 id="b22b" class="kg kh hi bd ki kj lr kl km kn ls kp kq io lt ip ks ir lu is ku iu lv iv kw kx bi translated">正在运行的地理编码结果</h1><p id="7a3e" class="pw-post-body-paragraph jk jl hi jm b jn ky ij jp jq kz im js jt la jv jw jx lb jz ka kb lc kd ke kf hb bi translated">现在我有了坐标，我可以创建可视化效果来查看是否有特定区域的餐厅存在更多严重违规行为。为此，我使用了follow，这是一个Python包，构建在名为fleed . js的Javascript库之上，用于地图可视化。</p><p id="4d70" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">下面的地图显示了每个餐馆的位置(红色)，似乎显示大多数严重违规的餐馆都在曼哈顿。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es na"><img src="../Images/f6a69d1cb037b2562274b3d011226ea8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MC1Rxl3ViW7U894c1cHsKA.png"/></div></div><figcaption class="jf jg et er es jh ji bd b be z dx translated">使用flour创建的地图可视化快照(单个位置)</figcaption></figure><p id="2e5c" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">这方面的另一个视图在下面的地图中，该地图将每个区域中存在严重违规的餐厅位置聚集在一起，以获得更清晰的外观。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es nb"><img src="../Images/51ad4cb28996b9368cccc7fc78799264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cPsglnJyLuCTSZcNlAANNg.png"/></div></div><figcaption class="jf jg et er es jh ji bd b be z dx translated">使用follow创建的地图可视化快照(聚类位置)</figcaption></figure><p id="3b0f" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">然而，这可能是因为大多数餐馆都位于曼哈顿。按区查看餐馆检查的分布，检查最多的区是曼哈顿。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es nc"><img src="../Images/e1af81cc19f1b649872a2be1b5f06f86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DruNNNDfK5zRl-LaJtnJ6w.png"/></div></div><figcaption class="jf jg et er es jh ji bd b be z dx translated">纽约市各区餐厅检查的分布情况</figcaption></figure><p id="20c7" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">因此，看到曼哈顿的大多数餐馆都有严重违规行为，并不能真正产生在寻找安全就餐地点时应该避开的区域的洞察力。此外，如果一家餐厅有更多的严重违规行为，它不太可能获得A，尽管在同一次检查访问或随后的检查访问中有严重违规行为，但仍有餐厅获得A。</p><p id="2439" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">尽管没有从该项目中获得很多有用的见解，但这是了解地理编码并了解如何将其用于地图可视化的一个很好的方式。只有通过在这样一个简单的项目中实际尝试，我才能够理解地理编码的一些挑战。</p><h1 id="c70b" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">资源</h1><div class="nd ne ez fb nf ng"><a href="https://geopy.readthedocs.io/en/stable/#" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab dw"><div class="ni ab nj cl cj nk"><h2 class="bd hj fi z dy nl ea eb nm ed ef hh bi translated">欢迎来到GeoPy的文档！- GeoPy 1.19.0文档</h2><div class="nn l"><h3 class="bd b fi z dy nl ea eb nm ed ef dx translated">编辑描述</h3></div><div class="no l"><p class="bd b fp z dy nl ea eb nm ed ef dx translated">geopy.readthedocs.io</p></div></div></div></a></div><div class="nd ne ez fb nf ng"><a href="https://sunnykrgupta.github.io/a-practical-guide-to-geopy.html" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab dw"><div class="ni ab nj cl cj nk"><h2 class="bd hj fi z dy nl ea eb nm ed ef hh bi translated">守护博客Geopy实用指南</h2><div class="nn l"><h3 class="bd b fi z dy nl ea eb nm ed ef dx translated">桑尼·库马尔的文章和文章</h3></div><div class="no l"><p class="bd b fp z dy nl ea eb nm ed ef dx translated">sunnykrgupta.github.io</p></div></div><div class="np l"><div class="nq l nr ns nt np nu jd ng"/></div></div></a></div><div class="nd ne ez fb nf ng"><a href="https://python-visualization.github.io/folium/quickstart.html#GeoJSON/TopoJSON-Overlays" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab dw"><div class="ni ab nj cl cj nk"><h2 class="bd hj fi z dy nl ea eb nm ed ef hh bi translated">快速入门-0 . 9 . 0文档</h2><div class="nn l"><h3 class="bd b fi z dy nl ea eb nm ed ef dx translated">要创建底图，只需将您的起始坐标传递给follow:</h3></div><div class="no l"><p class="bd b fp z dy nl ea eb nm ed ef dx translated">python-visualization.github.io</p></div></div></div></a></div><div class="nd ne ez fb nf ng"><a href="https://deparkes.co.uk/2016/06/10/folium-map-tiles/" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab dw"><div class="ni ab nj cl cj nk"><h2 class="bd hj fi z dy nl ea eb nm ed ef hh bi translated">树叶地图切片-分离</h2><div class="nn l"><h3 class="bd b fi z dy nl ea eb nm ed ef dx translated">使用不同的地图分块是更改或改善地图外观的好方法。这篇文章向你展示了如何…</h3></div><div class="no l"><p class="bd b fp z dy nl ea eb nm ed ef dx translated">deparkes.co.uk</p></div></div><div class="np l"><div class="nv l nr ns nt np nu jd ng"/></div></div></a></div><div class="nd ne ez fb nf ng"><a href="https://deparkes.co.uk/2016/06/24/folium-marker-clusters/" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab dw"><div class="ni ab nj cl cj nk"><h2 class="bd hj fi z dy nl ea eb nm ed ef hh bi translated">叶子标记簇-分离</h2><div class="nn l"><h3 class="bd b fi z dy nl ea eb nm ed ef dx translated">标记聚类是简化包含许多标记的地图的好方法。当地图缩小到标记附近时…</h3></div><div class="no l"><p class="bd b fp z dy nl ea eb nm ed ef dx translated">deparkes.co.uk</p></div></div><div class="np l"><div class="nw l nr ns nt np nu jd ng"/></div></div></a></div></div></div>    
</body>
</html>