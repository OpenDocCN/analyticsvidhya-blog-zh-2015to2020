<html>
<head>
<title>Notes on Time Series Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于时间序列分析的注记</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/notes-on-time-series-analysis-dafc8388df95?source=collection_archive---------9-----------------------#2020-03-02">https://medium.com/analytics-vidhya/notes-on-time-series-analysis-dafc8388df95?source=collection_archive---------9-----------------------#2020-03-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1083" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">时间序列是一系列按时间顺序排列的数据点。最常见的是，时间序列是在连续的等间隔时间点取得的序列。因此，它是一个离散时间数据序列。</p><p id="b2fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">时间序列分析包括分析时间序列数据的方法，以便提取有意义的统计数据和数据的其他特征。时间序列预测是使用模型根据以前观察到的值来预测未来值。</p><h1 id="b02d" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">文章的布局</h1><p id="4acb" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated"><strong class="ih hj">了解您的数据</strong></p><p id="dbad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">绘制系列图</p><p id="7801" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查季节性的月度箱线图</p><p id="f4bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查趋势的每年平均值</p><p id="8519" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">清理数据</strong></p><p id="aa1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将数据分为训练和测试</p><p id="3591" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据每年的季节性进行调整</p><p id="947c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">针对每周季节性进行调整</p><p id="13c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">时间序列预测的ARIMA模型</strong></p><p id="6e66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ADF测试检查静止</p><p id="d91a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">PACF和ACF图决定AR和MA的滞后</p><p id="8e64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在测试数据集上测试模型的性能</p><p id="0411" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">使用auto_arima决定最佳滞后</strong></p><p id="6d6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用auto_arima的最佳模型</p><p id="e763" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在测试数据集上测试模型的性能</p><p id="85bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">比较上述两个模型的性能</p><h1 id="c5d4" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">1.了解您的数据</h1><p id="e5af" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">从2004年1月1日至2013年12月31日提供每日电力需求。请参考图1(折线图)。</p><p id="7e07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">据观察，有很强的月度季节性，高峰在1月、7月和8月，低谷在4月、5月和10月。请参考图2(箱线图)。</p><p id="5eb1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据中没有年度趋势。请参考图3(柱状图)。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/11cd168627bf5726e441ac91bcb20c74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VugZIlGlQg6_DtbFOPRDqg.png"/></div></div></figure><p id="df39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图1:绘制系列图</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ks"><img src="../Images/3f6748020fb2762c74c84c91fbd7d908.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2vDIXZVJadoOwKIm3fCeag.png"/></div></div></figure><p id="0941" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图2:检查季节性的月度箱线图</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/450238de9155e235fda19abe72f41a70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8mKmbQbXUNs1vTdtcFd7ag.png"/></div></div></figure><p id="d23b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图3:检查趋势的每年平均值</p><h1 id="9b25" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">2.清理数据</h1><p id="fe0b" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">数据被分成训练和测试数据集。训练数据集包含8年的数据(2004年1月1日至2011年12月31日)，测试数据集包含1年的数据(2012年1月1日至2012年12月1日)。</p><p id="6f89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">观察到数据集中有很强的月季节性。根据训练数据集计算月平均功率需求。针对每月的季节性调整训练数据集和测试数据集。请参考表1。</p><p id="c97d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">调整值(m) =价值/季节性因素(m)</p><p id="72c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">观察到有很强的周季节性。从每月调整的训练数据集中计算一周中某一天的平均功率需求。针对每周的季节性调整训练数据集和测试数据集。请参考表2。</p><p id="e269" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">调整值(mw) =调整值(m) /季节性因素(w)</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es kt"><img src="../Images/ed07ce638b40339e0f1ea14bad219b55.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/1*uICuLE6Po3rFj9axSEQQLQ.png"/></div></figure><p id="eb27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ku">表1:调整年度季节性</em></p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es kt"><img src="../Images/deaa1c4357d37bc2b7e3447f77bfeabc.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/1*zbYdNoJTfOYzvrx47LphEQ.png"/></div></figure><p id="35db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ku">表2:调整每周季节性</em></p><h1 id="3d4d" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">3.时间序列预测的ARIMA模型</h1><p id="d245" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">进行ADF测试是为了检查静止状态。发现该序列是平稳的:</p><blockquote class="kv kw kx"><p id="a7ba" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o ADF统计:-15.848</p><p id="73b6" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o p值:0.000</p></blockquote><p id="a405" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">生成PACF和ACF图来确定AR和MA的滞后。由于ACF图显示逐渐下降，而PACF显示急剧下降，因此推断模型为AR(p)。为了获得最佳的AR滞后，我们检查了AIC不同的可能的滞后组合。请参考图4 (ACF图)、图5 (PACF图)和表3 (AIC表)。</p><blockquote class="kv kw kx"><p id="e0c1" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o如果系列的偏相关函数(PACF)显示一个锐截止和/或滞后-1自相关为正，即，如果系列出现轻微的“差异不足”，则考虑向模型添加一个或多个AR项。PACF截断的滞后是指示的AR项的数目。</p><p id="80ed" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o如果系列的自相关函数(ACF)显示一个锐截止和/或滞后-1自相关为负，即如果系列出现轻微的“过度差异”，则考虑在模型中添加一个MA项。ACF切断超过的延迟是指示的MA项的数量</p><p id="bae6" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o基于AIC，得出AR(3)是最佳模型的结论。当滞后从3增加到4时，AIC的增加几乎不明显。</p></blockquote><p id="2dfb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">模型在测试数据集上的性能。</p><blockquote class="kv kw kx"><p id="65aa" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o首先，每周的季节性会成倍增加。然后，每月的季节性被放大。请参考图6(实际与预测)。</p><p id="f296" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o将预测系列与2012年1月1日至2012年12月1日的实际电力需求进行比较。</p><p id="bec9" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o观察到RMSE为43，947.82，实际需求功率的平均值为442，072.12。</p></blockquote><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lb"><img src="../Images/c48f2adf78a0146f8accee037d0d8765.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dWmmoV6vAToJM13AyBG7WA.png"/></div></div></figure><p id="a325" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图4: ACF图</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lc"><img src="../Images/2c81bfc7400eb0ba02e673a4547caef7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0TtBIkx4hTMnMeD1MkHAdw.png"/></div></div></figure><p id="e8a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图5: PACF图</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es ld"><img src="../Images/d1ddb5a4782438e861aff70f87e75744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*4gRDjZqVpZFkXJh3_8sR1g.png"/></div></figure><p id="f0f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">表3:不同AR(p)的AIC值</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/cb96a642cc1ae38daf73dc6b16f5490e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*soahqoWsW5Ip6g5A3VltEw.png"/></div></div></figure><p id="03d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图6:实际与预测</p><h1 id="af31" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">4.使用auto_arima确定最佳滞后时间</h1><p id="6638" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">python库pmdarima提供了auto_arima过程来获得最佳模型。PMDARIMA相当于R的auto.arima功能。它收集了平稳性、季节性和时间序列效用的统计测试。</p><blockquote class="kv kw kx"><p id="4404" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o AUTO_ARIMA分别为AR、I和MA提供p、d和q的最佳值。</p><p id="7026" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o Python语法:</p><p id="1283" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">auto_arima(train['variable']，error_action='ignore ')。摘要()</p></blockquote><p id="4d9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ARIMA模型</p><blockquote class="kv kw kx"><p id="c628" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o auto _ ARIMA选择的最佳模型是SARIMAX(1，1，2)</p><p id="4c66" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o其中:p=1，d=1，q=2</p><p id="0c62" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o适合模型的Python语法</p><p id="1d9b" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">模型= ARIMA(火车['变量']，顺序=(1，1，2))</p><p id="1cd8" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">结果= model.fit()</p><p id="9348" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">结果摘要()</p></blockquote><p id="77ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在测试数据集上测试模型的性能</p><blockquote class="kv kw kx"><p id="d774" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o首先，每周的季节性会成倍增加。然后，每月的季节性被放大。请参考图7(实际与预测)。</p><p id="58ef" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o将预测系列与2012年1月1日至2012年12月1日的实际电力需求进行比较。</p><p id="a545" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o据观察，RMSE为40，663.4，实际需求功率的平均值为442，072.12。</p></blockquote><p id="07e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">比较上述两种模型的性能</p><blockquote class="kv kw kx"><p id="a80f" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">第一种方法(使用ACF图和PACF图)—观察到RMSE为43，947.82，实际需求功率的平均值为442，072.12。</p><p id="79e4" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o第二种方法(使用auto_arima) —观察到RMSE为40，663.4，实际需求功率的平均值为442，072.12。</p><p id="61dc" class="if ig ku ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">o与第一种方法(使用ACF图和PACF图)相比，第二种方法(使用auto_arima)的结果更好。</p></blockquote><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es le"><img src="../Images/1681f89b528b8ed372a68633048ad525.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c1u41Mlk88roHijLVQHx-g.png"/></div></div></figure><p id="e9f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图7:实际与预测</p></div></div>    
</body>
</html>