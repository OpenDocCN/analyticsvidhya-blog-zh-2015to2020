<html>
<head>
<title>Normalized Immutable State in REDUX</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">REDUX中的规范化不可变状态</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/normalized-immutable-state-in-redux-daae0abb2f8?source=collection_archive---------10-----------------------#2020-02-21">https://medium.com/analytics-vidhya/normalized-immutable-state-in-redux-daae0abb2f8?source=collection_archive---------10-----------------------#2020-02-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="9b77" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">从表面上看，不变状态的概念似乎简单且易于理解。开发人员似乎很难适应它的应用程序…</p></blockquote><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jh"><img src="../Images/be174a4b1de3ec8bd2118fa03a6e0ff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5KlgZaWxIcimkg4h"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">约书亚·索蒂诺在<a class="ae jx" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="f82e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">我在理解什么是不可变状态方面没有任何困难，但是当我开始尝试实现它时，我花了一周的时间来尝试应用它。我试图解释为什么一个不可变的状态很难实现，以帮助我自己理解它，也帮助其他人理解它。</p><p id="a514" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">为了解释它，我将用三个不同的句子来描述它…</p><p id="0e00" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated"><em class="ik">不可变的状态是一种永远不会被直接修改，而是被改变的值所影响的状态。</em></p><p id="30b1" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">不可变状态是一种被复制、改变然后返回的状态，它的原始内容从不被直接改变。</p><p id="0427" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated"><em class="ik">不可变状态以其原始形式再现，改变后再返回。</em></p><p id="4bb1" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">希望这三句话已经帮助你理解了不变性的概念。对于某些人来说，很难区分可变和不可变状态，因为从概念上看，它们非常相似。一旦这一点被灌输到你的头脑中，一切都归结于实施它。</p><h2 id="38cf" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jy km kn ko jz kp kq kr ka ks kt ku kv bi translated">冗余和规范化</h2><p id="07a4" class="pw-post-body-paragraph ii ij hi il b im kw io ip iq kx is it jy ky iw ix jz kz ja jb ka la je jf jg hb bi translated">规范化是扁平化数据的概念，这带来了巨大的性能提升，因为数据是直接和即时引用的，而不是循环引用。这是因为规范化的嵌套数据是由id表示的，这些id稍后将用于引用该数据。</p><p id="64d0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">在较大的应用程序中，规范化数据的实现变得至关重要，因为需要筛选大量数据来找到特定的文档。一个很好的例子就是在脸书这样的社交媒体平台上的帖子。这些平台中的帖子包含大量具体数据。这些数据可能包括评论、用户信息和帖子信息等。如果这些数据是以JSON格式组成的，程序查找嵌套数据会非常耗时，因为这些数据是直接存储的，不会被引用。例如，在一篇文章中有评论，在评论中有每个发帖者的用户id，有时还有对评论的评论。显然，如果使用规范化数据，通过循环查找嵌套数据是多余的。直接查找数据的剪切速度令人满意，因为客户端可以通过重新加载单个数据来对这些变化做出反应。</p><p id="a53b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated"><strong class="il hj">归一化数据</strong></p><p id="554f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">有几个NPM存储库使得规范化过程变得更加容易。一个是“normalizr ”,它获取JSON数据并将其转换为规范化数据。</p><h2 id="5506" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jy km kn ko jz kp kq kr ka ks kt ku kv bi translated">已处理的JSON数据</h2><pre class="ji jj jk jl fd lb lc ld le aw lf bi"><span id="4c8e" class="kb kc hi lc b fi lg lh l li lj">[</span><span id="ff8e" class="kb kc hi lc b fi lk lh l li lj">   {</span><span id="56ba" class="kb kc hi lc b fi lk lh l li lj">   <strong class="lc hj"> posterId:</strong> "1",</span><span id="4775" class="kb kc hi lc b fi lk lh l li lj">   <strong class="lc hj"> id:</strong> "1",</span><span id="12ec" class="kb kc hi lc b fi lk lh l li lj">    <strong class="lc hj">title:</strong> "title 1",</span><span id="8d8e" class="kb kc hi lc b fi lk lh l li lj">   <strong class="lc hj"> content:</strong> "This is some content.",</span><span id="2405" class="kb kc hi lc b fi lk lh l li lj">   <strong class="lc hj"> comments:</strong> [<br/>       {<br/>      <strong class="lc hj">  posterId:</strong> "1234",</span><span id="f23c" class="kb kc hi lc b fi lk lh l li lj">        id: "1",</span><span id="e740" class="kb kc hi lc b fi lk lh l li lj">        content: "This is some comment content"<br/>       },</span><span id="d972" class="kb kc hi lc b fi lk lh l li lj">       {<br/>     <strong class="lc hj">   posterId:</strong> "4321",</span><span id="fe30" class="kb kc hi lc b fi lk lh l li lj">        id: "2",</span><span id="7429" class="kb kc hi lc b fi lk lh l li lj">        content: "This is some comment content"</span><span id="f145" class="kb kc hi lc b fi lk lh l li lj">       }<br/>    ]</span><span id="ec10" class="kb kc hi lc b fi lk lh l li lj">},</span><span id="dff5" class="kb kc hi lc b fi lk lh l li lj">  {<br/> <strong class="lc hj">  posterId:</strong> "1",</span><span id="1a1d" class="kb kc hi lc b fi lk lh l li lj">  <strong class="lc hj"> id:</strong> "2",</span><span id="9ab5" class="kb kc hi lc b fi lk lh l li lj"><strong class="lc hj">   title:</strong> "title 2",</span><span id="da4e" class="kb kc hi lc b fi lk lh l li lj"><strong class="lc hj">   content:</strong> "This is some more content.",</span><span id="5038" class="kb kc hi lc b fi lk lh l li lj">  <strong class="lc hj"> comments:</strong> [<br/>      {</span><span id="eff4" class="kb kc hi lc b fi lk lh l li lj">       <strong class="lc hj">posterId:</strong> "1234",</span><span id="28e5" class="kb kc hi lc b fi lk lh l li lj">     <strong class="lc hj">  id:</strong> "1",</span><span id="1bb8" class="kb kc hi lc b fi lk lh l li lj">     <strong class="lc hj">  content:</strong> "This is some more comment content"</span><span id="8bac" class="kb kc hi lc b fi lk lh l li lj">      },</span><span id="d765" class="kb kc hi lc b fi lk lh l li lj">      {<br/>      <strong class="lc hj">  posterId:</strong> "4321",</span><span id="1995" class="kb kc hi lc b fi lk lh l li lj">    <strong class="lc hj">    id:</strong> "2",</span><span id="d5c0" class="kb kc hi lc b fi lk lh l li lj">      <strong class="lc hj">  content:</strong> "This is some more comment content"</span><span id="85ac" class="kb kc hi lc b fi lk lh l li lj">       }</span><span id="f8b6" class="kb kc hi lc b fi lk lh l li lj">    ]<br/>}<br/>]</span></pre><p id="d0f2" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">标准化数据</p><pre class="ji jj jk jl fd lb lc ld le aw lf bi"><span id="c3f2" class="kb kc hi lc b fi lg lh l li lj">{</span><span id="8b87" class="kb kc hi lc b fi lk lh l li lj"><strong class="lc hj">   entities:</strong> {</span><span id="dbf4" class="kb kc hi lc b fi lk lh l li lj">     <strong class="lc hj">  posts:</strong> {</span><span id="0839" class="kb kc hi lc b fi lk lh l li lj">        <strong class="lc hj">  1 :</strong> {</span><span id="15c1" class="kb kc hi lc b fi lk lh l li lj">               posterId: "1",</span><span id="386b" class="kb kc hi lc b fi lk lh l li lj">               title: "title 1",</span><span id="e25b" class="kb kc hi lc b fi lk lh l li lj">               content: "This is some content.",</span><span id="1a0b" class="kb kc hi lc b fi lk lh l li lj">               comments: [1, 2],</span><span id="51c3" class="kb kc hi lc b fi lk lh l li lj">          },<br/>     <strong class="lc hj">     2 :</strong> {<br/>               posterId: "1",</span><span id="61e6" class="kb kc hi lc b fi lk lh l li lj">               title: "title 2",</span><span id="ce41" class="kb kc hi lc b fi lk lh l li lj">               content: "This is some content.",</span><span id="b230" class="kb kc hi lc b fi lk lh l li lj">               comments: [1, 2]<br/>   }</span><span id="f233" class="kb kc hi lc b fi lk lh l li lj">},</span><span id="6b23" class="kb kc hi lc b fi lk lh l li lj"> <strong class="lc hj">   comments:</strong> {<br/>     <strong class="lc hj">    1:</strong> {<br/>             posterId: "1234",</span><span id="d8f0" class="kb kc hi lc b fi lk lh l li lj">             content: "This is some comment content"</span><span id="6096" class="kb kc hi lc b fi lk lh l li lj">         },</span><span id="5661" class="kb kc hi lc b fi lk lh l li lj">     <strong class="lc hj">    2:</strong> {</span><span id="6a80" class="kb kc hi lc b fi lk lh l li lj">             posterId: "4321",</span><span id="33ae" class="kb kc hi lc b fi lk lh l li lj">             content: "This is some comment content"</span><span id="5c92" class="kb kc hi lc b fi lk lh l li lj">         }<br/>     }<br/>   }<br/>}</span></pre><p id="a8bd" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">好吧，让我们来分解一下。在第一列代码中，有经过处理的JSON数据，这是一个包含相应数据集的对象数组。第二个包含一组经过Normalizr npm软件包处理的标准化数据。这两组数据的主要区别在于，内容是根据它们的标题分开的。通过使用Normlizr的模式建模，用户可以定义如何将他们的数据组织成其规范化的对应物。在这种情况下，定义了“post模式”和“comments模式”, comments模式嵌套在post模式中。这样，normlizr知道当它接收到帖子数据时，它需要提取每个帖子中的所有评论，并将它们转换成自己的对象。然后，它获取每个评论的id，并将它们放在相应帖子的评论数组中。这样，当一篇文章需要评论的内容时，它只需要将评论数组中的id与存储在评论数组中的id进行比较。这乍一看似乎很复杂，但从概念上讲是有意义的。这一切都归结于通过查找id来处理基于关系的数据，而不是为了找到一个文档而遍历大量数据。</p><p id="3594" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">由于在尝试使用规范化数据时，创建和使用API可能会非常困难，因此我提供了一些可能有助于这一过程的资源。请花时间通读文档，因为它真正解释了你需要做什么来成功完成你的项目。</p><h2 id="bbff" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jy km kn ko jz kp kq kr ka ks kt ku kv bi translated"><strong class="ak">资源:</strong></h2><p id="a0cd" class="pw-post-body-paragraph ii ij hi il b im kw io ip iq kx is it jy ky iw ix jz kz ja jb ka la je jf jg hb bi translated"><strong class="il hj"> Redux的规范化数据文档:</strong><a class="ae jx" href="https://redux.js.org/recipes/structuring-reducers/normalizing-state-shape" rel="noopener ugc nofollow" target="_blank">https://Redux . js . org/recipes/structuring-reducers/normalizing-state-shape</a></p><p id="5552" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated"><strong class="il hj">https://www.npmjs.com/package/normalizr</strong><a class="ae jx" href="https://www.npmjs.com/package/normalizr" rel="noopener ugc nofollow" target="_blank">NPM套餐</a></p><p id="107c" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">如果你使用mongoose，这里有一个<strong class="il hj"> JSON规范器插件</strong>用于你的模式:<a class="ae jx" href="https://github.com/meanie/mongoose-to-json" rel="noopener ugc nofollow" target="_blank">https://github.com/meanie/mongoose-to-json</a></p><p id="1b91" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated"><strong class="il hj">有用视频:</strong></p><p id="201a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated"><a class="ae jx" href="https://www.youtube.com/watch?v=YvRDgLEY6sE" rel="noopener ugc nofollow" target="_blank"> <em class="ik">数据规格化和冗余:</em>https://www.youtube.com/watch?v=YvRDgLEY6sE</a></p><p id="9850" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated"><em class="ik">存储数据的最佳方式:【https://www.youtube.com/watch?v=aJxcVidE0I0】T22</em>T23】</p></div></div>    
</body>
</html>