<html>
<head>
<title>Pipenv: A tool all Python developers should be using</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pipenv:所有Python开发人员都应该使用的工具</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/a-tool-all-python-developers-should-be-using-5d547bfb45b7?source=collection_archive---------0-----------------------#2019-04-17">https://medium.com/analytics-vidhya/a-tool-all-python-developers-should-be-using-5d547bfb45b7?source=collection_archive---------0-----------------------#2019-04-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5062" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章讲述了我第一次使用pipenv作为包管理器，并使用其虚拟环境进行测试，从空白画布到生产就绪代码的经历。</p><p id="0740" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我想先打个比方。我想让你想象你在一家餐馆当服务员，厨师说“今天我们将把这顿饭的各种成分放在单独的盘子里”。</p><p id="ec60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">饭菜越复杂，你要端上顾客餐桌的盘子就越多。</p><p id="44b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你听到铃声，服务开始了，但是饭菜的组成部分在不同的时间出来，以及不同的桌子点同样的饭菜。此外，你必须确保它正确地到达顾客手中，满足顾客的偏好(例如，牛排五分熟)……听起来像一场噩梦，对吗？</p><p id="637d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你把这顿饭的组成部分想象成Python包，把不同的桌子想象成虚拟环境，把偏好想象成依赖关系的特定版本，那么我们就可以开始看到这些场景有多么相似了。就算这顿饭“解决”了，你还会留小费吗？</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/9d8483100135192988527a36cce8567b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mQPYYdGYfcfZbd62"/></div></div></figure><p id="a4ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为Python开发者，我们应该专注于这一点……用Python开发。</p><p id="7771" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Scala有SBT，Ruby有RubyGems，C#有NuGet，不胜枚举。</p><p id="a767" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，我们可以将pip与virtualenv/pyenv一起使用，它们是很好的工具，但是它们可能很复杂，尤其是如果你没有使用它们的经验。</p><p id="a09a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果只是将目录更改为不同的项目，并让virtualenv准备就绪，而不必为该项目激活正确的目录，这不是很好吗？</p><blockquote class="jp"><p id="1e28" class="jq jr hi bd js jt ju jv jw jx jy jc dx translated">“启动一个pipenv项目就像送走一整包Tunnock的焦糖薄饼一样容易”——<em class="jz">亚历克斯·瓦拉塔拉贾</em></p></blockquote><p id="f839" class="pw-post-body-paragraph if ig hi ih b ii ka ik il im kb io ip iq kc is it iu kd iw ix iy ke ja jb jc hb bi translated">转到终端，为您的项目创建一个新目录:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kf"><img src="../Images/7aec3432cdb20808c04cfabf93a8ecfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nxORS2-qC8xrCswvPNp0xw.png"/></div></div></figure><p id="a845" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后做一个<code class="du kg kh ki kj b">pip install pipenv</code>然后<code class="du kg kh ki kj b">pipenv install pandas --python 3.6</code>，几秒钟内你就已经创建了一个带有Python 3.6虚拟环境的项目，准备开始工作了。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kk"><img src="../Images/91b29312bda4dc6a01e7d44048e61190.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*51_luEx6bXnwAOnR8TtXww.png"/></div></div></figure><p id="25f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用<code class="du kg kh ki kj b">pipenv shell</code>直接访问您的虚拟环境:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kl"><img src="../Images/de8e97d73925f4b576dccb26609d0b57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*srch-CroIv9O2ajisbsAWg.png"/></div></div><figcaption class="km kn et er es ko kp bd b be z dx translated">键入“exit”以离开虚拟环境</figcaption></figure><p id="ff25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者您可以使用<code class="du kg kh ki kj b">pipenv run &lt;your program&gt;</code>在虚拟环境中运行程序</p><p id="4ab5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Pipenv创建Pipfile和Pipfile.lock文件，替换requirements.txt，这是管理依赖关系的地方。您将需要检查Pipfile.lock以进行确定性构建的版本控制，同时使用Pipfile进行抽象开发。</p><p id="55ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在虚拟环境中安装依赖项时<code class="du kg kh ki kj b">pipenv install -d --skip-lock</code>(用于本地开发)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kq"><img src="../Images/606d3c56c32d939ae6f080cb1675a05e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4B6GGl4azTk-I3_HkKzrbA.png"/></div></div></figure><p id="d6e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">而<code class="du kg kh ki kj b">pipenv install --ignore-pipefile</code>(制作用)会是你的朋友。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kr"><img src="../Images/db7987559c108b68b22a19a329124a05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cBJ-abP_bieb9t1jJ4JSKw.png"/></div></div></figure><p id="b336" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">显然，根据项目的不同，您需要的不仅仅是Pipfile和Pipfile.lock，因为setup.py仍然是包分发所必需的。</p><p id="d60e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在最近一次需要快速上市的特性交付中，我的团队认为这是测试这种新方法的合适时机。</p><p id="3968" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">事实证明，这种风险让我们在创业和尽快获得MVP的过程中变得更加容易。使用这个设置，再添加一些东西，我们就有了一个婴儿骨架，可以让我们的数据科学团队开始工作了。</p><p id="fb15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中一个主要目标是有一个cookiecutter，这样我们可以快速开始新的项目，整个团队可以从同一个点开始，具有相同的依赖关系。而不必担心处于正确的虚拟环境中，跟踪新的依赖关系，以及固定用于项目的依赖关系(与使用requirements.txt不同)。</p><p id="c366" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Pipenv的一个伟大之处在于它创建了一个虚拟环境，可以通过哈希来跟踪。Pipenv还支持不同的python版本，如果您想在多个Python版本上测试您的代码，它与Tox兼容。</p><p id="ac4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后Pytest就变得很简单，只需从项目目录中键入<code class="du kg kh ki kj b">pipenv run pytest</code>，它就会在一个虚拟环境中运行您的测试，并且包含您安装的所有依赖项。</p><p id="7496" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有多少次你运行一个程序让你看到一个错误<code class="du kg kh ki kj b">E ModuleNotFoundError: No module named '&lt;x&gt;’</code>让你检查你是否在正确的虚拟环境中或者需要安装模块等等。</p><p id="4d4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">时间可以被更好地利用。</p><p id="319e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">也就是说，如果您决定更改项目中文件夹的名称和结构，您需要删除virtualenv。这是因为散列是使用文件夹和命名结构创建的(因此pipenv总能找到项目的virtualenv)。</p><p id="84e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，只需使用<code class="du kg kh ki kj b">pipenv –-rm</code>:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ks"><img src="../Images/dead337367f1738a540a9c0f24fe47c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a27R9xJB3hBTgxHuh86B_A.png"/></div></div></figure><p id="eb0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后你必须再做一次<code class="du kg kh ki kj b">pipenv install</code>来创建一个新的虚拟，如果你只是想重新开始，你也可以这样做。</p><p id="8360" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在生产中，您仍然希望使用固定的依赖关系，使用Pipenv的Pipfile.lock <code class="du kg kh ki kj b">pipenv install –ignore-pipfile</code>。这将仅使用先前在开发过程中锁定的工作依赖项进行安装。</p><p id="eb3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看到它让我们变得如此富有成效，我们已经开始将其他项目转移到Pipenv。</p><p id="af39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">事实上，pipenv解决了我们在pytest-cov中遇到的一个错误，在我们的一个使用ONZO内部PyPI repo的项目中，模块之间存在依赖性解决问题。</p><p id="5372" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在设置了Pipfile中的依赖项并创建了Pipfile.lock之后，转换变得相对容易，我们有了一个Dockerfile，它在我们的Kubernetes容器中运行Pipenv，还有一个rakefile，它使用Pipenv for Pytest运行我们的测试，并使用Pylint、Flake8和Sonar获得报告。</p><p id="8174" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经创建了一个Cookiecutter(它使用Jinja作为模板项目)，我们将在未来的所有基于Python的项目中使用它。</p><p id="e642" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该项目正在进行中，是一个用于开发的开源数据科学/R&amp;D入门套件，包括Pipenv、Pandas，可以运行Jupyter笔记本。它还有一些Postgres测试基础设施，带有可以在测试中使用的初始测试模式和表格。</p><p id="aa28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在这里找到它:<a class="ae kt" href="https://github.com/onzo-com/python-cookie-cutter-public" rel="noopener ugc nofollow" target="_blank">https://github.com/onzo-com/python-cookie-cutter-public</a></p></div></div>    
</body>
</html>