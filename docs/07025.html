<html>
<head>
<title>Magic of Flutter, Provider, and Firestore</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">颤动、供应商和Firestore的魔力</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/magic-of-flutter-provider-and-firestore-66f1a86903c3?source=collection_archive---------2-----------------------#2020-06-11">https://medium.com/analytics-vidhya/magic-of-flutter-provider-and-firestore-66f1a86903c3?source=collection_archive---------2-----------------------#2020-06-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/b12f04e77f55a9f212b95090f0a538e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*e4jGUs1O3Q-5AaHRuXk0Ng.png"/></div></figure><p id="9739" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">大家好，今天我们将通过简单的步骤学习firestore作为后端的flutter。在开始阅读本文之前，您应该已经在您的应用程序中集成了一个firebase，并设置了一个firestore作为带有测试模式的数据库。我们将为产品建立一个简单的应用程序，并在其上应用CRUD操作。</p><p id="58c4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">第一步:让我们先进入项目结构，你必须有和我一样的项目结构，这样事情会对你更清楚。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es jk"><img src="../Images/84b74c2c4a215e31c56cb7c94eca6f6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*w8GDrJvK6j2VYZwZiMhmzw.png"/></div></figure><p id="c6f3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">步骤2:将以下依赖项复制粘贴到您的pubspec.yaml文件中:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="7e89" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">cloud_firestore</strong>: ^0.13.4+2<br/><strong class="jq hj">provider</strong>: ^4.0.5<br/><strong class="jq hj">uuid</strong>: ^2.0.4</span></pre><ol class=""><li id="a391" class="ka kb hi io b ip iq it iu ix kc jb kd jf ke jj kf kg kh ki bi translated">cloud_firestore:这允许在我们的flutter应用程序中使用firestore函数。</li><li id="0fd7" class="ka kb hi io b ip kj it kk ix kl jb km jf kn jj kf kg kh ki bi translated">提供商:这将用于管理我们的应用程序的状态，即区分用户界面和逻辑部分。</li><li id="c4e5" class="ka kb hi io b ip kj it kk ix kl jb km jf kn jj kf kg kh ki bi translated">UUID:这个包将被用来生成一个产品的ID。</li></ol><p id="3985" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">步骤3:首先转到models文件夹并创建一个product.dart类。模型类基本上被称为用户生成的数据类型，其中数据根据用户需求进行分类。</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="0264" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">class </strong>Product{<br/>  String <strong class="jq hj">productId</strong>;<br/>  String <strong class="jq hj">productName</strong>;<br/>  double <strong class="jq hj">price</strong>;<br/><br/>  Product({<strong class="jq hj">this</strong>.<strong class="jq hj">price</strong>,<strong class="jq hj">this</strong>.<strong class="jq hj">productId</strong>,<strong class="jq hj">this</strong>.<strong class="jq hj">productName</strong>});<br/><br/><br/>  Map&lt;String,<strong class="jq hj">dynamic</strong>&gt; createMap(){<br/>    <strong class="jq hj">return </strong>{<br/>      <strong class="jq hj">'productId'</strong>: <strong class="jq hj">productId</strong>,<br/>      <strong class="jq hj">'productName'</strong>: <strong class="jq hj">productName</strong>,<br/>      <strong class="jq hj">'productPrice'</strong>: <strong class="jq hj">price<br/>    </strong>};<br/>  }<br/><br/>  Product.fromFirestore(Map&lt;String,<strong class="jq hj">dynamic</strong>&gt; firestoreMap): <br/><strong class="jq hj">productId </strong>= firestoreMap[<strong class="jq hj">'productId'</strong>],<br/>   <strong class="jq hj">productName </strong>= firestoreMap[<strong class="jq hj">'productName'</strong>],<br/>   <strong class="jq hj">price </strong>= firestoreMap[<strong class="jq hj">'productPrice'</strong>];<br/>}</span></pre><p id="660b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这个类中，我们有三个属性:</p><p id="e826" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">a)字符串productId。</p><p id="d8bd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">b)字符串productName。</p><p id="62c6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">c)双倍价格。</p><p id="b801" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们创建了一个命名的构造函数，即顺序，而传递数据给构造函数是没有必要的。</p><p id="ddc8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">product.dart模型类中定义了两个函数:</p><ol class=""><li id="1dd2" class="ka kb hi io b ip iq it iu ix kc jb kd jf ke jj kf kg kh ki bi translated">Map <string dynamic=""> createmap():这意味着它将产品属性转换成地图，并将其作为地图返回。</string></li><li id="eed6" class="ka kb hi io b ip kj it kk ix kl jb km jf kn jj kf kg kh ki bi translated">product . from Firestore(Map &lt; String，dynamic firestoreMap):这意味着firestore以地图的形式返回数据，因此该方法用于将地图转换为属性，这意味着create map函数反之亦然。</li></ol><p id="7444" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">步骤4:转到provider文件夹，在其中创建一个名为products_provider.dart的新类，并将以下代码复制粘贴到其中。</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="41a0" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">class </strong>ProductProvider <strong class="jq hj">with </strong>ChangeNotifier{<br/>  String <strong class="jq hj">_name</strong>;<br/>  String <strong class="jq hj">_productId</strong>;<br/>  double <strong class="jq hj">_price</strong>;<br/><br/>//getters:</span><span id="a881" class="ju jv hi jq b fi ko jx l jy jz">  String <strong class="jq hj">get getName </strong>=&gt; <strong class="jq hj">_name</strong>;<br/>  double <strong class="jq hj">get getPrice </strong>=&gt; <strong class="jq hj">_price</strong>;<br/><br/><em class="kp">//Setters:<br/><br/>  </em><strong class="jq hj">void </strong>changeProductName(String val) {<br/>    <strong class="jq hj">_name </strong>= val;<br/>    notifyListeners();<br/>  }<br/><br/>  <strong class="jq hj">void </strong>changeProductPrice(String val) {<br/>    <strong class="jq hj">_price </strong>= double.<em class="kp">parse</em>(val);<br/>    notifyListeners();<br/>  }</span></pre><p id="fef8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们创建了三个私有属性下划线将属性定义为私有，并且简单地为我们的属性创建了getters和setters。因为我们没有得到任何产品id和设置，因为它将是动态或自动生成的。</p><p id="0e6e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">步骤5:转到main.dart，删除所有代码，并复制粘贴以下代码:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="1162" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">import 'package:flutter/material.dart'</strong>;<br/><strong class="jq hj">import 'package:flutter_responsiveness/providers/product_provider.dart'</strong>;<br/><strong class="jq hj">import 'package:flutter_responsiveness/screens/edit_add_product.dart'</strong>;<br/><strong class="jq hj">import 'package:provider/provider.dart'</strong>;<br/><strong class="jq hj">import './screens/product_list.dart'</strong>;<br/><strong class="jq hj">import './services/firestore_service.dart'</strong>;</span><span id="a54d" class="ju jv hi jq b fi ko jx l jy jz"><strong class="jq hj">void </strong>main()=&gt;runApp(MyApp());<br/><br/><br/><strong class="jq hj">class </strong>MyApp <strong class="jq hj">extends </strong>StatelessWidget {<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    <strong class="jq hj">return </strong>MultiProvider(<br/>      providers: [<br/>        ChangeNotifierProvider.value(value: ProductProvider()),<br/>      ],<br/>          child: MaterialApp(<br/>        debugShowCheckedModeBanner: <strong class="jq hj">false</strong>,<br/>        theme: ThemeData(<br/>          primaryColor: Colors.<em class="kp">blueAccent</em>[700],<br/>          accentColor: Colors.<em class="kp">indigoAccent</em>[700],<br/>          canvasColor: Colors.<em class="kp">white</em>,<br/>        ),<br/>        home: ProductList(),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="d14a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">多提供商使我们能够在我们的应用程序中使用多个提供商。它包含接受提供者数组的提供者属性和包含小部件的子属性。</p><p id="8479" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">步骤6:转到屏幕文件夹，创建一个名为product_list.dart的新文件，并复制粘贴以下代码:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="d7fb" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">import 'package:flutter/material.dart'</strong>;<br/><br/><strong class="jq hj">class </strong>ProductList <strong class="jq hj">extends </strong>StatelessWidget {<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    <strong class="jq hj">return </strong>Scaffold(<br/>      appBar: AppBar(<br/>        title: Text(<strong class="jq hj">'Product'</strong>),<br/>        actions: [<br/>          IconButton(<br/>            icon: Icon(<br/>              Icons.<em class="kp">add</em>,<br/>            ),<br/>            onPressed: () {},<br/>          ),<br/>        ],<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="e55d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">简单地说，我们有一个带有标题和动作的图标按钮的应用程序栏小部件。动作是在应用程序栏右侧定义的小部件。</p><p id="ef75" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">步骤7:在screens文件夹中创建另一个名为edit_add_product.dart的类，并复制粘贴以下代码:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="ebbe" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">import 'package:flutter/material.dart'</strong>;<br/><strong class="jq hj">import 'package:provider/provider.dart'</strong>;<br/><strong class="jq hj">import '../providers/product_provider.dart'</strong>;<br/><br/><strong class="jq hj">class </strong>AddEditProduct <strong class="jq hj">extends </strong>StatefulWidget {<br/>  <strong class="jq hj">static const </strong><em class="kp">routeArgs </em>= <strong class="jq hj">'/add-edit-screen'</strong>;<br/><br/>  @override<br/>  _AddEditProductState createState() =&gt; _AddEditProductState();<br/>}<br/><br/><strong class="jq hj">class </strong>_AddEditProductState <strong class="jq hj">extends </strong>State&lt;AddEditProduct&gt; {<br/>  <strong class="jq hj">final _formKey </strong>= GlobalKey&lt;FormState&gt;();</span><span id="06c1" class="ju jv hi jq b fi ko jx l jy jz"><strong class="jq hj">final nameController </strong>= TextEditingController();<br/><strong class="jq hj">final priceController </strong>= TextEditingController();</span><span id="3909" class="ju jv hi jq b fi ko jx l jy jz">@override<br/><strong class="jq hj">void </strong>dispose() {<br/>  <strong class="jq hj">super</strong>.dispose();<br/>  <strong class="jq hj">nameController</strong>.dispose();<br/>  <strong class="jq hj">priceController</strong>.dispose();<br/>}<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    <strong class="jq hj">final </strong>productProvider = Provider.<em class="kp">of</em>&lt;ProductProvider&gt;(context);<br/>    <strong class="jq hj">return </strong>Scaffold(<br/>      appBar: AppBar(<br/>        title: Text(<strong class="jq hj">'Add or Edit Product'</strong>),<br/>      ),<br/>      body: Center(<br/>          child: Form(<br/>        key: <strong class="jq hj">_formKey</strong>,<br/>        child: SingleChildScrollView(<br/>          child: Padding(<br/>            padding: <strong class="jq hj">const </strong>EdgeInsets.all(10.0),<br/>            child: Column(<br/>              children: [<br/>                TextFormField(</span><span id="8644" class="ju jv hi jq b fi ko jx l jy jz">                 controller: <strong class="jq hj">nameController</strong>,                                                     validator: (value) {<br/>                    <strong class="jq hj">if </strong>(value.<strong class="jq hj">isEmpty</strong>) {<br/>                      <strong class="jq hj">return 'Please Enter Name'</strong>;<br/>                    }<br/>                    <strong class="jq hj">return null</strong>;<br/>                  },<br/>                  decoration: InputDecoration(<br/>                    hintText: <strong class="jq hj">'Enter Product Name'</strong>,<br/>                  ),<br/>                  onChanged: (val) =&gt; productProvider.changeProductName(val),<br/>                ),<br/>                TextFormField(</span><span id="220a" class="ju jv hi jq b fi ko jx l jy jz">                 controller: <strong class="jq hj">priceController</strong>,<br/>                  validator: (value) {<br/>                    <strong class="jq hj">if </strong>(value.<strong class="jq hj">isEmpty</strong>) {<br/>                      <strong class="jq hj">return 'Please Enter Price'</strong>;<br/>                    }<br/>                    <strong class="jq hj">return null</strong>;<br/>                  },<br/>                  decoration: InputDecoration(<br/>                    hintText: <strong class="jq hj">'Enter Product Price'</strong>,<br/>                  ),<br/>                  onChanged: (value) =&gt;<br/>                      productProvider.changeProductPrice(value),<br/>                ),<br/>                SizedBox(<br/>                  height: 20,<br/>                ),<br/>                RaisedButton(<br/>                  child: Text(<strong class="jq hj">'Save'</strong>),<br/>                  onPressed: () {<br/>               <br/>                  },<br/>                  color: Theme.<em class="kp">of</em>(context).<strong class="jq hj">accentColor</strong>,<br/>                  textColor: Colors.<em class="kp">white</em>,<br/>                ),<br/>                RaisedButton(<br/>                  child: Text(<strong class="jq hj">'Delete'</strong>),<br/>                  onPressed: () {<br/>                  },<br/>                  color: Colors.<em class="kp">red</em>,<br/>                  textColor: Colors.<em class="kp">white</em>,<br/>                )<br/>              ],<br/>            ),<br/>          ),<br/>        ),<br/>      )),<br/>    );<br/>  }<br/>}</span></pre><p id="56d1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">onchanged方法采用参数化函数，该函数包含字符串数据，我们还使用产品提供者的setter来更改产品的名称和价格。</p><p id="568c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">正如你所看到的，我们正在使用表单，我已经在flutter中介绍了表单，所以你可以查看我的表单及其验证的中间文章:</p><div class="kq kr ez fb ks kt"><a rel="noopener follow" target="_blank" href="/@mashoodsidd97/forms-and-its-validation-in-flutter-1c2b3f9c985c"><div class="ku ab dw"><div class="kv ab kw cl cj kx"><h2 class="bd hj fi z dy ky ea eb kz ed ef hh bi translated">颤振中的形式及其验证</h2><div class="la l"><h3 class="bd b fi z dy ky ea eb kz ed ef dx translated">大家好，我希望你们都做得很好，今天我们将讨论一个flutter应用程序中的表单，这篇文章…</h3></div><div class="lb l"><p class="bd b fp z dy ky ea eb kz ed ef dx translated">medium.com</p></div></div><div class="lc l"><div class="ld l le lf lg lc lh ik kt"/></div></div></a></div><p id="7e0d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">此外，代码有多个可用的小部件，我们也可以进行一些代码重构，我的这篇文章深入而简单地解释了代码重构的步骤，请点击此处:</p><div class="kq kr ez fb ks kt"><a rel="noopener follow" target="_blank" href="/@mashoodsidd97/refactoring-flutter-widgets-into-sub-widgets-3cf0f1f29645"><div class="ku ab dw"><div class="kv ab kw cl cj kx"><h2 class="bd hj fi z dy ky ea eb kz ed ef hh bi translated">将Flutter小部件重构为子小部件</h2><div class="la l"><h3 class="bd b fi z dy ky ea eb kz ed ef dx translated">大家好，今天我将讨论构建一个flutter应用程序最重要的部分是代码重构…</h3></div><div class="lb l"><p class="bd b fp z dy ky ea eb kz ed ef dx translated">medium.com</p></div></div><div class="lc l"><div class="li l le lf lg lc lh ik kt"/></div></div></a></div><p id="c534" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我不会做任何代码重构或表单解释，因为这篇文章太长了。</p><p id="c14e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在让我们转向flutter的CRUD操作，</p><p id="582a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">步骤8:转到services，创建一个名为firestore_services.dart的新文件，并将以下代码复制粘贴到其中:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="db6b" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">import 'package:cloud_firestore/cloud_firestore.dart'</strong>;<br/><strong class="jq hj">import 'package:flutter_responsiveness/models/product.dart'</strong>;<br/><br/><strong class="jq hj">class </strong>FireStoreService {<br/>  Firestore <strong class="jq hj">_db </strong>= Firestore.<em class="kp">instance</em>;<br/><br/>  Future&lt;<strong class="jq hj">void</strong>&gt; saveProduct(Product product) {<br/>    <strong class="jq hj">return _db<br/>        </strong>.collection(<strong class="jq hj">'Products'</strong>)<br/>        .document(product.<strong class="jq hj">productId</strong>)<br/>        .setData(product.createMap());<br/>  }<br/><br/>  Stream&lt;List&lt;Product&gt;&gt; getProducts() {<br/>    <strong class="jq hj">return _db</strong>.collection(<strong class="jq hj">'Products'</strong>).snapshots().map((snapshot) =&gt; snapshot<br/>        .<strong class="jq hj">documents<br/>        </strong>.map((document) =&gt; Product.fromFirestore(document.<strong class="jq hj">data</strong>))<br/>        .toList());<br/>  }<br/><br/>  Future&lt;<strong class="jq hj">void</strong>&gt; removeItem(String productId) {<br/>    <strong class="jq hj">return _db</strong>.collection(<strong class="jq hj">'Products'</strong>).document(productId).delete();<br/>  }<br/>}</span></pre><p id="887b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Firestore以收集和文档为基础。这是一种不同于SQL数据库的方法。</p><ol class=""><li id="15f8" class="ka kb hi io b ip iq it iu ix kc jb kd jf ke jj kf kg kh ki bi translated">保存产品:这种方法将数据保存到我们的firestore中。我写的代码意味着firestore在集合上工作，这是一种不同于SQL数据库的方法，我们创建了一个firestore实例来使用它的功能。_db.collections('产品')表示转到firestore并添加一个包含产品和串联的新集合。documents意味着我们在集合内部传递我们自己的自定义id，setData意味着我们希望保存在这个集合中的数据，它应该是Map的形式。</li><li id="1f2f" class="ka kb hi io b ip kj it kk ix kl jb km jf kn jj kf kg kh ki bi translated">GetProducts:这个方法返回一个流。一个流就像一个管道，你在一端放一个值，如果在另一端有一个监听器，这个监听器将会接收这个值。一个流可以有多个侦听器，当它被放入管道时，所有这些侦听器将接收相同的值。代码行解释:</li></ol><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="f6e1" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">_db</strong>.collection(<strong class="jq hj">'Products'</strong>).snapshots().map((snapshot) =&gt; snapshot<br/>        .<strong class="jq hj">documents<br/>        </strong>.map((document) =&gt; Product.fromFirestore(document.<strong class="jq hj">data</strong>))<br/>        .toList());</span></pre><p id="c180" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这意味着转到产品集合，获取返回数据流的快照，并对其进行映射，这意味着映射您从流中获得的数据，这需要一个函数，在该函数中，我们访问产品集合中的文档，并且还映射该文档，因为firestore以映射的形式返回数据，所以我们需要将其转换为属性，以便我们可以将它们填充到我们的小部件中，因为我们已经创建了该方法 它将map转换为产品模型类中的属性，即来自firestore的属性，因此我们可以访问它并传递文档。 toList()放在方法的末尾，以列表的形式返回数据。</p><p id="ed2d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">3.移除项目方法:该方法只需获取一个产品id，并将其从应用程序和后端删除，由于我们使用的是流，我们不需要刷新应用程序来查看更改，流使我们更容易检测应用程序中的实时更改。</p><p id="f4ea" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">步骤9:现在转到products_provider.dart类:</p><p id="17a8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">a)导入Firestore服务类别和UUID:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="be5d" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">import '../services/firestore_service.dart'</strong>;<br/><strong class="jq hj">import 'package:uuid/uuid.dart'</strong>;</span></pre><p id="d786" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">b)在ProductProvIDer和UUID中创建products_provider的最终字段以获得随机id</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="b79a" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">final service </strong>= FireStoreService();<br/><strong class="jq hj">var uuid </strong>= Uuid();</span></pre><p id="007d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">c)现在在产品提供商内部创建一个方法，将数据保存到firestore中:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="52f4" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">void </strong>saveData() {<br/><strong class="jq hj">var </strong>newProduct =    Product(productName: <strong class="jq hj">getName</strong>, productId: </span><span id="851f" class="ju jv hi jq b fi ko jx l jy jz"><strong class="jq hj">uuid</strong>.v4(), price: <strong class="jq hj">getPrice</strong>);</span><span id="505c" class="ju jv hi jq b fi ko jx l jy jz"><strong class="jq hj">service</strong>.saveProduct(newProduct);</span><span id="3663" class="ju jv hi jq b fi ko jx l jy jz">}</span></pre><p id="c13e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">与在我们的服务类中一样，我们的saveProduct将产品模型类作为参数，因此我们需要首先定义一个产品，然后将其传递到保存产品的参数中，其中getName是设置为edit_add_product.dart类的名称，如下所示:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="f825" class="ju jv hi jq b fi jw jx l jy jz">TextFormField(<br/>  validator: (value) {<br/>    <strong class="jq hj">if </strong>(value.<strong class="jq hj">isEmpty</strong>) {<br/>      <strong class="jq hj">return 'Please Enter Name'</strong>;<br/>    }<br/>    <strong class="jq hj">return null</strong>;<br/>  },<br/>  controller: <strong class="jq hj">nameController</strong>,<br/>  decoration: InputDecoration(<br/>    hintText: <strong class="jq hj">'Enter Product Name'</strong>,<br/>  ),<br/>  onChanged: (val) =&gt; productProvider.changeProductName(val),<br/>),</span></pre><p id="6ba8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">getPrice也是如此。产品是UUID.v4，这将是我们在firestore中添加的每个产品的唯一ID。</p><p id="6745" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">步骤10:让我们回到edit_add_product.dart类，转到Save Raised Button compressed方法，用下面的代码替换Save Raised Button的代码:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="710c" class="ju jv hi jq b fi jw jx l jy jz">RaisedButton(<br/>  child: Text(<strong class="jq hj">'Save'</strong>),<br/>  onPressed: () {<br/>    <strong class="jq hj">if</strong>(<strong class="jq hj">_formKey</strong>.<strong class="jq hj">currentState</strong>.validate())<br/>    {<br/>    productProvider.saveData();<br/>    Navigator.<em class="kp">of</em>(context).pop();<br/>  }<br/>  },<br/>  color: Theme.<em class="kp">of</em>(context).<strong class="jq hj">accentColor</strong>,<br/>  textColor: Colors.<em class="kp">white</em>,<br/>),</span></pre><p id="18d2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这种情况下，我们验证表单，如果输入了所有字段，则将数据保存到firebase，pop意味着在将数据添加到firestore后，立即从屏幕堆栈中弹出屏幕。</p><p id="6269" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在运行应用程序，按下应用程序栏上的“+”按钮，然后输入产品名称和价格，您会看到数据已添加到firestore中。</p><p id="99b6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">第十一步:让我们回到正题。dart文件，因为我们以流的形式获得产品数据，所以我们也必须注册它，这是我在flutter应用程序中使用firestore的方法。也有不同的方法，您可以在文档中找到更多信息，或者在googling上搜索不同的方法。让我们回到正题，更换主。dart代码与此代码:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="a29d" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">import 'package:flutter/material.dart'</strong>;<br/><strong class="jq hj">import 'package:flutter_responsiveness/providers/product_provider.dart'</strong>;<br/><strong class="jq hj">import 'package:flutter_responsiveness/screens/edit_add_product.dart'</strong>;<br/><strong class="jq hj">import 'package:provider/provider.dart'</strong>;<br/><strong class="jq hj">import './screens/product_list.dart'</strong>;<br/><strong class="jq hj">import './services/firestore_service.dart'</strong>;<br/><strong class="jq hj">void </strong>main()=&gt;runApp(MyApp());<br/><br/><br/><strong class="jq hj">class </strong>MyApp <strong class="jq hj">extends </strong>StatelessWidget {<br/>  @override<br/>  Widget build(BuildContext context) {<br/>        <strong class="jq hj">final </strong>firestoreService = FireStoreService();<br/><br/>    <strong class="jq hj">return </strong>MultiProvider(<br/>      providers: [<br/>        ChangeNotifierProvider.value(value: ProductProvider()),<br/>        StreamProvider.value(value: firestoreService.getProducts()),<br/>      ],<br/>          child: MaterialApp(<br/>        debugShowCheckedModeBanner: <strong class="jq hj">false</strong>,<br/>        theme: ThemeData(<br/>          primaryColor: Colors.<em class="kp">blueAccent</em>[700],<br/>          accentColor: Colors.<em class="kp">indigoAccent</em>[700],<br/>          canvasColor: Colors.<em class="kp">white</em>,<br/>        ),<br/>        home: ProductList(),<br/>      routes: {<br/>        AddEditProduct.<em class="kp">routeArgs</em>:(ctx)=&gt;AddEditProduct(),<br/>      },<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="8a0d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们使用stream provider从firebase获取所有产品，以获得对我们的数据采取的每个操作的更新。</p><p id="5fd7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">步骤12:现在转到product_list.dart并复制粘贴以下代码:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="4ca9" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">import 'package:flutter/material.dart'</strong>;<br/><strong class="jq hj">import 'package:flutter_responsiveness/models/product.dart'</strong>;<br/><strong class="jq hj">import 'package:flutter_responsiveness/screens/edit_add_product.dart'</strong>;<br/><strong class="jq hj">import 'package:provider/provider.dart'</strong>;<br/><br/><strong class="jq hj">class </strong>ProductList <strong class="jq hj">extends </strong>StatelessWidget {<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    <strong class="jq hj">final </strong>productList = Provider.<em class="kp">of</em>&lt;List&lt;Product&gt;&gt;(context);<br/>    <strong class="jq hj">return </strong>Scaffold(<br/>      appBar: AppBar(<br/>        title: Text(<strong class="jq hj">'Product'</strong>),<br/>        actions: [<br/>          IconButton(<br/>            icon: Icon(<br/>              Icons.<em class="kp">add</em>,<br/>            ),<br/>            onPressed: () {<br/>          Navigator.<em class="kp">of</em>(context).pushNamed(AddEditProduct.<em class="kp">routeArgs</em>);<br/>            },<br/>          ),<br/>        ],<br/>      ),<br/>      body: productList != <strong class="jq hj">null<br/>          </strong>? ListView.builder(<br/>              itemCount: productList.<strong class="jq hj">length</strong>,<br/>              itemBuilder: (ctx, i) =&gt; ListTile(<br/>                title: Text(productList[i].<strong class="jq hj">productName</strong>),<br/>                trailing: Text(productList[i].<strong class="jq hj">price</strong>.toString()),<br/>                onTap: () =&gt; Navigator.<em class="kp">of</em>(context)<br/>                    .pushNamed(AddEditProduct.<em class="kp">routeArgs</em>, arguments: {<br/>                  <strong class="jq hj">'productId'</strong>: productList[i].<strong class="jq hj">productId</strong>,<br/>                  <strong class="jq hj">'productName'</strong>: productList[i].<strong class="jq hj">productName</strong>,<br/>                  <strong class="jq hj">'productPrice'</strong>: productList[i].<strong class="jq hj">price</strong>,<br/>                }),<br/>              ),<br/>            )<br/>          : Center(<br/>              child: CircularProgressIndicator(),<br/>            ),<br/>    );<br/>  }<br/>}</span></pre><p id="9267" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们创建了一个供应商产品列表。因为“of”是一个泛型类型，所以我们需要在&lt;&gt;括号中传递数据类型。所以我们通过了列表<products>，因为我们想要得到所有的产品。创建正文部分我们使用三元运算符检查，如果产品不为空，则创建一个listview.builder，其中item count是列表项的长度，builder获取每个项的上下文和索引。我们使用粗箭头符号返回列表平铺窗口小部件，标题和尾部表示它将位于屏幕的最右侧，我们还使用了列表平铺窗口小部件上的tap，在该窗口小部件中，我们将转到Add_Edit_product类，参数表示我们要传递给该类的数据，我们将地图数据传递给add_edit_product， 除非你需要将数据传递给正在进行的类，否则并不总是需要使用参数，同样在这之后':'我们返回循环进度指示器，当我们获得数据时，它将自动隐藏，我们的列表视图将填充数据。</products></p><p id="86fe" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们热重启应用程序，并检查您的第一个屏幕将填充您输入的数据。</p><p id="ad77" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">步骤13:现在是更新数据的时候了，首先转到产品提供者并在里面保存数据拷贝-替换以下代码:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="9590" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">void </strong>saveData() {<br/>  <strong class="jq hj">if </strong>(<strong class="jq hj">_productId </strong>== <strong class="jq hj">null</strong>) {<br/>    <strong class="jq hj">var </strong>newProduct =<br/>        Product(productName: <strong class="jq hj">getName</strong>, productId: <strong class="jq hj">uuid</strong>.v4(), price: <strong class="jq hj">getPrice</strong>);<br/>    <strong class="jq hj">service</strong>.saveProduct(newProduct);<br/>  } <strong class="jq hj">else </strong>{<br/>    <strong class="jq hj">var </strong>updatedProduct =<br/>        Product(productName: <strong class="jq hj">getName</strong>, price: <strong class="jq hj">getPrice</strong>, productId: <strong class="jq hj">_productId</strong>);<br/>    <strong class="jq hj">service</strong>.saveProduct(updatedProduct);<br/>  }<br/>}</span></pre><p id="09a3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们在这里检查产品id是否为空，这意味着如果我们发现任何产品id，我们将向firestore添加新数据，这意味着我们将向Firestone更新该数据。</p><p id="9dce" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">步骤14:让我们转向add_edit_products并在其中创建init状态:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="ff82" class="ju jv hi jq b fi jw jx l jy jz">@override<br/><strong class="jq hj">void </strong>initState() {<br/>  <strong class="jq hj">super</strong>.initState();<br/>  <strong class="jq hj">new </strong>Future.delayed(Duration(microseconds: 10), () {<br/>    <strong class="jq hj">routeData </strong>=<br/>        ModalRoute.<em class="kp">of</em>(<strong class="jq hj">context</strong>).<strong class="jq hj">settings</strong>.<strong class="jq hj">arguments as </strong>Map&lt;String, <strong class="jq hj">dynamic</strong>&gt;;<br/>  }).then((_) =&gt; <strong class="jq hj">routeData </strong>== <strong class="jq hj">null<br/>      </strong>? <strong class="jq hj">new </strong>Future.delayed(Duration.<em class="kp">zero</em>, () {<br/>          clearData();<br/>          <strong class="jq hj">final </strong>productProvider =<br/>              Provider.<em class="kp">of</em>&lt;ProductProvider&gt;(<strong class="jq hj">context</strong>, listen: <strong class="jq hj">false</strong>);<br/>          productProvider.loadValues(Product());<br/>        })<br/>      : Future.delayed(Duration.<em class="kp">zero</em>, () {<br/>          print(<strong class="jq hj">routeData</strong>);<br/>          <strong class="jq hj">nameController</strong>.<strong class="jq hj">text </strong>= <strong class="jq hj">routeData</strong>[<strong class="jq hj">'productName'</strong>];<br/>          <strong class="jq hj">priceController</strong>.<strong class="jq hj">text </strong>= <strong class="jq hj">routeData</strong>[<strong class="jq hj">'productPrice'</strong>].toString();<br/><br/>          <strong class="jq hj">final </strong>productProvider =<br/>              Provider.<em class="kp">of</em>&lt;ProductProvider&gt;(<strong class="jq hj">context</strong>, listen: <strong class="jq hj">false</strong>);<br/>          Product p = Product(<br/>            productId: <strong class="jq hj">routeData</strong>[<strong class="jq hj">'productId'</strong>],<br/>            price: <strong class="jq hj">routeData</strong>[<strong class="jq hj">'productPrice'</strong>],<br/>            productName: <strong class="jq hj">routeData</strong>[<strong class="jq hj">'productName'</strong>],<br/>          );<br/>          productProvider.loadValues(p);<br/>        }));<br/>}</span></pre><p id="f72d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将产品列表中的数据作为映射参数传递给add_edit_product类，因此我们接受它，如下所示:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="77b8" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">routeData </strong>=<br/>        ModalRoute.<em class="kp">of</em>(<strong class="jq hj">context</strong>).<strong class="jq hj">settings</strong>.<strong class="jq hj">arguments as </strong>Map&lt;String, <strong class="jq hj">dynamic</strong>&gt;;</span></pre><p id="2575" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">由于init，状态不能直接访问上下文，因为它是有状态小部件的第一个生命周期方法，所以要访问init状态中的上下文，我们使用Future。延迟，其中包含持续时间和方法，这意味着当给定的操作在未来完成时，我们希望运行这些代码行，因此在内部，我们检查路线数据是否为空，然后我们在文本字段中输入新数据，否则我们将更新文本字段中的数据，这些数据将自动填充以供编辑。</p><p id="9ae3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因为如果我们编辑或添加一个产品，数据将一直存在，所以我们需要加载并告诉提供者，所以我们将在products_provider.dart类中创建一个新方法:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="ba47" class="ju jv hi jq b fi jw jx l jy jz">loadValues(Product product) {<br/>  <strong class="jq hj">_name </strong>= product.<strong class="jq hj">productName</strong>;<br/>  <strong class="jq hj">_price </strong>= product.<strong class="jq hj">price</strong>;<br/>  <strong class="jq hj">_productId </strong>= product.<strong class="jq hj">productId</strong>;<br/>}</span></pre><p id="bdba" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个方法根据添加或更新数据来更新我们的状态。</p><p id="33e0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在运行应用程序，点击列表项，您会看到数据已填充到文本字段中，尝试更改字段中的数据，然后点击保存，您会看到应用程序中的数据因streams和firestore而更新。</p><p id="81e0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">步骤15:现在让我们从Firestore中删除该项目，转到products_provider类并添加该方法:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="d3c3" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">void </strong>removeData() {<br/>  <strong class="jq hj">service</strong>.removeItem(<strong class="jq hj">_productId</strong>);<br/>}</span></pre><p id="68d0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">此方法将从firestore中移除该项目。</p><p id="beed" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">步骤16:让我们转到add_edit_product类，在第二个凸起的delete按钮内用下面的代码替换它:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="8a12" class="ju jv hi jq b fi jw jx l jy jz">RaisedButton(<br/>  child: Text(<strong class="jq hj">'Delete'</strong>),<br/>  onPressed: () {<br/>    productProvider.removeData();<br/>    Navigator.<em class="kp">of</em>(context).pop();<br/>  },<br/>  color: Colors.<em class="kp">red</em>,<br/>  textColor: Colors.<em class="kp">white</em>,<br/>)</span></pre><p id="fd41" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这将删除以下数据，并从屏幕堆栈中弹出屏幕。</p><p id="5c03" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从头开始运行应用程序，并通过添加、更新和删除以及读取数据进行检查。</p><p id="578e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如有任何疑问，请给我留言或评论。</p><p id="f415" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">今天到此为止。对于firestore和provider来说，这确实是一次深度探索和一篇大文章。</p><p id="3c4c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我已经尽了很大努力用最简单的方式来写这篇文章，所以不要忘记鼓掌和关注。</p><p id="2a5c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Github回购链接:</p><div class="kq kr ez fb ks kt"><a href="https://github.com/Mashood97/flutter_firestore" rel="noopener  ugc nofollow" target="_blank"><div class="ku ab dw"><div class="kv ab kw cl cj kx"><h2 class="bd hj fi z dy ky ea eb kz ed ef hh bi translated">Mashood97/flutter_firestore</h2><div class="la l"><h3 class="bd b fi z dy ky ea eb kz ed ef dx translated">扑火商店。在GitHub上创建一个帐户，为Mashood97/flutter_firestore开发做贡献。</h3></div><div class="lb l"><p class="bd b fp z dy ky ea eb kz ed ef dx translated">github.com</p></div></div><div class="lc l"><div class="lj l le lf lg lc lh ik kt"/></div></div></a></div><p id="58a8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">别忘了开始回购，跟我来。</p><p id="4f31" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">谢谢你。</p></div></div>    
</body>
</html>