<html>
<head>
<title>Nox: the shining python test automation tool</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Nox:闪亮的python测试自动化工具</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/nox-the-shining-python-test-automation-tool-3e189e343b57?source=collection_archive---------3-----------------------#2019-12-30">https://medium.com/analytics-vidhya/nox-the-shining-python-test-automation-tool-3e189e343b57?source=collection_archive---------3-----------------------#2019-12-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ef706381fcce064bf218482f709141a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IwfA2DpPBdFdU9dq"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae iu" href="https://unsplash.com/@franckinjapan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Franck V. </a>拍摄的照片</figcaption></figure><p id="88a4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上周我发现了<a class="ae iu" href="https://nox.thea.codes/en/stable/index.html" rel="noopener ugc nofollow" target="_blank"> nox </a>这是一个命令行工具，可以在多种python环境中自动测试，类似于<a class="ae iu" href="https://tox.readthedocs.org/" rel="noopener ugc nofollow" target="_blank"> tox </a>。它被他的创造者认为像托克斯的<em class="jt">后代</em>。</p><p id="27ff" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对我来说，它相对于tox的主要优势是，您可以在自动化过程中利用python语言的所有功能，但它还有其他很酷的特性。它也被一些伟大的项目所使用，如<a class="ae iu" href="https://github.com/googlecloudplatform/google-cloud-python" rel="noopener ugc nofollow" target="_blank"> google-cloud-python </a>或<a class="ae iu" href="https://github.com/urllib3/urllib3" rel="noopener ugc nofollow" target="_blank"> urllib3 </a>。</p><h1 id="8586" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">使用</h1><h2 id="3247" class="ks jv hi bd jw kt ku kv ka kw kx ky ke jg kz la ki jk lb lc km jo ld le kq lf bi translated">基础</h2><p id="2265" class="pw-post-body-paragraph iv iw hi ix b iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated">对于这个例子，我们将想象一个简单的项目，它有一个模块example.py，其中有一个函数将两个数相加。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="d0ee" class="ks jv hi lq b fi lu lv l lw lx">def addition(a, b):<br/>    return a + b</span></pre><p id="4169" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了测试这个文件，我们还将创建一个test_example.py文件。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="84a6" class="ks jv hi lq b fi lu lv l lw lx">import pytest<br/><br/>from .example import addition<br/><br/><br/>@pytest.mark.parametrize(('a', 'b', 'c'), [<br/>    (0, 0, 0),<br/>    (1, 2, 3)<br/>])<br/>def test_addition_returns_correct_result(a, b, c):<br/>    assert c == addition(a, b)</span></pre><p id="bbf0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们将创建一个noxfile.py来测试这个文件。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="3ed4" class="ks jv hi lq b fi lu lv l lw lx">import nox<br/><br/><br/>@nox.session<br/>def lint(session):<br/>    session.install('flake8')<br/>    session.run('flake8', 'example.py')<br/><br/><br/>@nox.session<br/>def tests(session):<br/>    session.install('pytest')<br/>    session.run('pytest')</span></pre><p id="f7b0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Nox与<strong class="ix hj">会话</strong>的概念一起工作。session是一个用<strong class="ix hj"> nox修饰的可调用函数。session </strong>接受一个<em class="jt"> session </em>参数，我们用它来执行各种操作。您通常会执行的两个主要动作是<strong class="ix hj">安装</strong>和<strong class="ix hj">运行</strong>，但还有<a class="ae iu" href="https://nox.thea.codes/en/stable/config.html#module-nox.sessions" rel="noopener ugc nofollow" target="_blank">其他</a>。</p><p id="e054" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在前面的例子中，我们定义了两个会话，一个用于检查模块example.py是否符合python编写标准，以及优秀的<a class="ae iu" href="http://flake8.pycqa.org/en/latest/" rel="noopener ugc nofollow" target="_blank"> flake8 </a>。Nox将按照我们第一个命令<strong class="ix hj"><em class="jt">session . install(‘flake8’)</em></strong>的要求，在一个<strong class="ix hj"> <em class="jt">默认创建的新虚拟环境中安装flake 8包。nox项目顶部的</em> </strong>文件夹，但是你可以改变它的<a class="ae iu" href="https://nox.thea.codes/en/stable/config.html#modifying-nox-s-behavior-in-the-noxfile" rel="noopener ugc nofollow" target="_blank"/>。注意，这个<em class="jt">安装</em>命令将把它所有的参数传递给<strong class="ix hj"> <em class="jt"> pip安装</em> </strong>命令。第二个命令使用参数example.py运行flake8。还要注意，如果您想要运行类似于<strong class="ix hj"> <em class="jt"> foo -x bar </em> </strong>的命令，您应该将命令的每个字符串像参数一样传递给session.run命令，即<strong class="ix hj"> <em class="jt"> session.run('foo '，'-x '，')</em> </strong>。</p><p id="ac57" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第二个会话使用pytest库检查我们的脚本是否按照我们期望的方式工作。</p><p id="88e6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要列出所有可用的会话，您可以运行以下命令。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="2fd0" class="ks jv hi lq b fi lu lv l lw lx">nox -l<br/>Sessions defined in ..</span><span id="d6f6" class="ks jv hi lq b fi ly lv l lw lx">* lint<br/>* tests</span></pre><p id="4507" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您想运行所有会话，只需运行<em class="jt"> nox </em>，您将得到如下输出:</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="3325" class="ks jv hi lq b fi lu lv l lw lx">nox &gt; Running session lint<br/>nox &gt; Creating virtual environment ..<br/>...</span><span id="ea5b" class="ks jv hi lq b fi ly lv l lw lx">nox &gt; Ran multiple sessions:<br/>nox &gt; * lint: success<br/>nox &gt; * tests: success</span></pre><h2 id="262b" class="ks jv hi bd jw kt ku kv ka kw kx ky ke jg kz la ki jk lb lc km jo ld le kq lf bi translated">针对多个版本的python进行测试</h2><p id="cb32" class="pw-post-body-paragraph iv iw hi ix b iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated">您可以指定多个python版本进行测试，或者使用session decorator指定一个特定的版本。</p><p id="f467" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">单一版本</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="a199" class="ks jv hi lq b fi lu lv l lw lx">@nox.session(python="3.8")<br/>def test(session):<br/>    ...</span></pre><p id="6390" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">多个版本</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="11f6" class="ks jv hi lq b fi lu lv l lw lx">@nox.session(python=["3.6", "3.7", "3.8"])<br/>def tests(session):<br/>    ...</span></pre><p id="c530" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你再次检查会话列表，你会看到它变得更加丰富。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="5c29" class="ks jv hi lq b fi lu lv l lw lx">nox -l<br/>..<br/>* lint<br/>* tests-3.6<br/>* tests-3.7<br/>* tests-3.8</span><span id="411e" class="ks jv hi lq b fi ly lv l lw lx">sessions marked with * are selected, sessions marked with - are skipped.</span></pre><p id="6e76" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意，您需要在计算机上安装指定的python版本，以便会话能够正确运行。此外，如果您不想运行所有会话，您可以通过“-s”选项指定您想要的会话。要检查您是否将运行您想要的会话，您还可以组合“-l”选项。例如，在前面的例子中，如果我想运行lint和tests-3.7会话，我将首先使用命令:</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="db45" class="ks jv hi lq b fi lu lv l lw lx">nox -l -s lint tests-3.7<br/>..</span><span id="850a" class="ks jv hi lq b fi ly lv l lw lx">* lint<br/>- tests-3.6<br/>* tests-3.7<br/>- tests-3.8</span><span id="665f" class="ks jv hi lq b fi ly lv l lw lx">sessions marked with * are selected, sessions marked with - are skipped.</span></pre><p id="f94b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意，所选会话前面有一个<strong class="ix hj">星号</strong>，那些不运行的会话前面有一个<strong class="ix hj">减号</strong>。</p><p id="2fec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您还可以使用环境变量NOXSESSION来实现相同的目标。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="db1d" class="ks jv hi lq b fi lu lv l lw lx">export NOXSESSION=lint,tests-3.7<br/># you can use set command on Windows<br/>nox -l<br/>...<br/>* lint<br/>- tests-3.6<br/>* tests-3.7<br/>- tests-3.8</span><span id="a15d" class="ks jv hi lq b fi ly lv l lw lx">sessions marked with * are selected, sessions marked with - are skipped.</span></pre><h2 id="7029" class="ks jv hi bd jw kt ku kv ka kw kx ky ke jg kz la ki jk lb lc km jo ld le kq lf bi translated">参数化</h2><p id="c5e2" class="pw-post-body-paragraph iv iw hi ix b iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated">nox的另一个很酷的特性是参数化。例如，您可以轻松地创建一个适合您需求的测试矩阵。在这里，我们创建了一个由四个会话组成的矩阵，用两个不同的数据库测试django的两个版本:</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="3ee8" class="ks jv hi lq b fi lu lv l lw lx">@nox.session<br/>@nox.parametrize('django', ['1.9', '2.0'])<br/>@nox.parametrize('database', ['postgres', 'mysql'])<br/>def tests(session, django, database):<br/>    ...</span></pre><p id="048a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将创建以下会话:</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="33e9" class="ks jv hi lq b fi lu lv l lw lx">nox -l<br/>...<br/>* tests(database='postgres', django='1.9')<br/>* tests(database='mysql', django='1.9')<br/>* tests(database='postgres', django='2.0')<br/>* tests(database='mysql', django='2.0')</span></pre><h2 id="56a4" class="ks jv hi bd jw kt ku kv ka kw kx ky ke jg kz la ki jk lb lc km jo ld le kq lf bi translated">改变nox文件中的NOx行为</h2><p id="a35a" class="pw-post-body-paragraph iv iw hi ix b iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated">你可以改变noxfile中的一些行为，比如将要创建虚拟环境的文件夹，或者重用现有的虚拟环境，而不是系统地创建一个新的。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="ea28" class="ks jv hi lq b fi lu lv l lw lx">nox.options.envdir = ".cache"<br/>nox.options.reuse_existing_virtualenvs = True</span></pre><p id="a2b4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意，在命令行上传递的参数优先于在noxfile中定义的参数。有关可用于更改行为的选项的完整列表，请参考此<a class="ae iu" href="https://nox.thea.codes/en/stable/config.html#modifying-nox-s-behavior-in-the-noxfile" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><h2 id="114c" class="ks jv hi bd jw kt ku kv ka kw kx ky ke jg kz la ki jk lb lc km jo ld le kq lf bi translated">将tox文件转换为nox文件</h2><p id="a143" class="pw-post-body-paragraph iv iw hi ix b iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated">如果您正在使用tox，并且希望转换到nox，后者提供了一个简单的脚本来从您的tox文件创建一个noxfile。您需要额外依赖地安装nox。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="77a3" class="ks jv hi lq b fi lu lv l lw lx">pip install --upgrade nox[tox_to_nox]</span></pre><p id="ad3e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，您只需要在包含您的tox文件的目录中运行脚本tox_to_nox。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="b747" class="ks jv hi lq b fi lu lv l lw lx">tox_to_nox</span></pre><p id="7974" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意，您可能需要检查生成的noxfile并手工修复它，因为到目前为止对tox转换的支持还很少。</p><p id="5034" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是这篇教程的全部内容，希望你喜欢。如果你想了解更多关于nox的知识，我邀请你查阅<a class="ae iu" href="https://nox.thea.codes/en/stable/index.html" rel="noopener ugc nofollow" target="_blank">官方文件</a>。</p><p id="e88b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是我的第一个教程，所以如果你对如何改进它有任何意见，我很乐意听到他们:)</p></div></div>    
</body>
</html>