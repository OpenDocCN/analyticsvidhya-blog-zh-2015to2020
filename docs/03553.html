<html>
<head>
<title>The most insightful story behind Web Scraping using Python’s Scrapy Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python Scrapy框架的Web抓取背后最有见地的故事</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/the-most-insightful-story-behind-web-scraping-using-pythons-scrapy-framework-9ac0a2769fbe?source=collection_archive---------7-----------------------#2020-02-07">https://medium.com/analytics-vidhya/the-most-insightful-story-behind-web-scraping-using-pythons-scrapy-framework-9ac0a2769fbe?source=collection_archive---------7-----------------------#2020-02-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9630" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Python是一种出色的解释语言，可用于小型和大型产品。这很容易学。另外，这可以作为通向不同编程语言和框架的垫脚石。</p><p id="8131" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想象一下，你被指示从一个网站上提取大量数据，你想尽可能快地完成。如果不手动访问每个网站并获取数据，你会怎么做？</p><p id="2734" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗯，“网络抓取”就是答案。网络抓取只是使这项工作更容易和更快。</p><p id="c5a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，您将简要了解使用<a class="ae jd" href="https://scrapy.org/" rel="noopener ugc nofollow" target="_blank"> scrapy </a>框架进行web抓取，并通过一些演示项目了解如何从网站中提取数据。</p><h1 id="e502" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">网页抓取是如何工作的？</h1><p id="fdd3" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">要了解网页抓取的工作原理，您需要遵循以下基本步骤:</p><ol class=""><li id="9237" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">找到您想要抓取的URL</li><li id="709e" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">检查页面</li><li id="133e" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">查找要提取的数据</li><li id="a4c3" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">写代码</li><li id="f2fd" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">运行代码并提取数据</li><li id="271e" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">以要求的格式存储数据</li></ol><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/502c9419508c2810346b6194ba28d25e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VU8eWRu3OLWkGgkigax0Rw.jpeg"/></div></div></figure><h1 id="8474" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">为什么是Scrapy？</h1><p id="fd35" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我知道你在想:</p><blockquote class="lh li lj"><p id="130a" class="if ig lk ih b ii ij ik il im in io ip ll ir is it lm iv iw ix ln iz ja jb jc hb bi translated">为什么我要用Scrapy而不是一些很酷的库比如<a class="ae jd" href="https://www.crummy.com/software/BeautifulSoup/" rel="noopener ugc nofollow" target="_blank"> BeautifulSoup </a>和<a class="ae jd" href="http://lxml.de/" rel="noopener ugc nofollow" target="_blank"> lxml </a>？</p></blockquote><p id="e471" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是啊！如果您觉得使用BeautifulSoup或lxml更舒服，您可以轻松地使用它们。BeautifulSoup和lxml是用于解析HTML和xml的库。Scrapy是一个用于编写网络蜘蛛的应用程序框架，可以抓取网站并从中提取数据。毕竟，它们只是解析可以从任何Python代码导入和使用的库。</p><p id="008f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">换句话说，把BeautifulSoup或lxml比作Scrapy就像把<a class="ae jd" href="http://jinja.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> jinja2 </a>比作<a class="ae jd" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a>。</p><h1 id="b8bb" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">刮的时间到了</h1><h2 id="c784" class="lo jf hi bd jg lp lq lr jk ls lt lu jo iq lv lw js iu lx ly jw iy lz ma ka mb bi translated">创建新目录来存储项目文件:</h2><p id="101a" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">首先，我们需要创建一个包含我们所有作品的文件夹。从开始菜单打开anaconda提示符，然后进入桌面目录:</p><p id="c34a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将目录名设为Scrapy。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="mc md l"/></div></figure><h2 id="418c" class="lo jf hi bd jg lp lq lr jk ls lt lu jo iq lv lw js iu lx ly jw iy lz ma ka mb bi translated">创建虚拟环境</h2><p id="a699" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">为我们的项目创建一个虚拟环境总是一个好主意。您可以按照以下步骤创建自己的虚拟环境:</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="433d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将在Scrapy文件夹中创建一个新文件夹。您可以使用“dir”命令来检查它。要在Windows上激活virtualenv，激活脚本位于脚本文件夹中:</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="d47d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们在虚拟环境中安装Scrapy。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="0bf6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将在虚拟环境中安装所有必需的软件包。</p><p id="6a68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在你开始刮之前，你必须建立一个新的刮项目。输入要存储代码的目录，然后运行:</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="mc md l"/></div><figcaption class="me mf et er es mg mh bd b be z dx translated">这将在<code class="du mi mj mk ml b">project_dir</code>目录下创建一个零碎的项目。</figcaption></figure><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es mm"><img src="../Images/144fe49aebf0976f2a476e6fb8f3c313.png" data-original-src="https://miro.medium.com/v2/resize:fit:428/format:webp/1*f8iGJ2BYS0y91zO93D8Yvg.png"/></div></figure><h2 id="abd5" class="lo jf hi bd jg lp lq lr jk ls lt lu jo iq lv lw js iu lx ly jw iy lz ma ka mb bi translated">生成一个蜘蛛</h2><p id="e8b7" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">蜘蛛是你定义的类，Scrapy用它从网站上抓取信息。</p><p id="6fad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将废弃一个演示<a class="ae jd" href="http://books.toscrape.com/" rel="noopener ugc nofollow" target="_blank">网站</a>。</p><p id="f53e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以从项目内部使用<code class="du mi mj mk ml b">scrapy</code>工具来控制和管理它们。</p><p id="bc73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，创建一个新的蜘蛛:</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="mc md l"/></div></figure><h2 id="91ec" class="lo jf hi bd jg lp lq lr jk ls lt lu jo iq lv lw js iu lx ly jw iy lz ma ka mb bi translated">写一个<a class="ae jd" href="https://docs.scrapy.org/en/latest/topics/spiders.html#topics-spiders" rel="noopener ugc nofollow" target="_blank">蜘蛛</a>来抓取一个站点</h2><p id="b0d1" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">运行上述命令后，它将在spiders文件夹中创建一个is Thespider.py文件。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="a7a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们的目标文件，我们将在其中编写python代码来提取数据。</p><p id="a8b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们需要做一些事情。首先，我们需要在start_urls中给出正确的URL。为此，请点击页面底部的“下一步”,转到网站的第二页。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es mn"><img src="../Images/21fba0bf9cc511d3a888b2758840785f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*rAxBB6-WIgdPx8sfMD8cBw.png"/></div></figure><p id="1366" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之所以转到第2页，是因为，它显示了网站的完整网址。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es mo"><img src="../Images/569797357c7cebab9daf7c5767be3dab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OOiSnXJDi2wqLJp0B-gdwA.png"/></div></div><figcaption class="me mf et er es mg mh bd b be z dx translated"><a class="ae jd" href="http://books.toscrape.com/catalogue/page-2.html" rel="noopener ugc nofollow" target="_blank">http://books.toscrape.com/catalogue/page-2.html</a></figcaption></figure><p id="21cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在把这个网址放在start_urls上。你可以这样改变页码来询问要刮多少页:</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="f86e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要将信息存储在某个地方，因此我们将定义一个名为“data”的空字典。</p><p id="27a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">示例:</p><p id="4761" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据= {}</p><p id="a75f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在回到网站，选择您想要使用web inspect element废弃的元素。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es mp"><img src="../Images/de334d7b015bab5ff6d91ff94cf3d24e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*NeDn35adlxKsDd1vwJcv9A.gif"/></div></div></figure><h2 id="2006" class="lo jf hi bd jg lp lq lr jk ls lt lu jo iq lv lw js iu lx ly jw iy lz ma ka mb bi translated">在表格中循环</h2><p id="92e1" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">一页有20本书。所以我们应该用一个循环来遍历它。但是我们通过什么循环呢？如果我们检查整行，我们会看到所有的books表都在<ol class="”row”">下，并且每一行都由HTML标签<article class="”product_pod”"> … </article>表示。</ol></p><p id="75c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以我们的循环应该找到每个标签，然后获取内容。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="d83a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们按HTML元素提取数据，如下所示:</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="e1db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于开始评级，我们需要给每一个不同的值。</p><p id="8045" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的例子中，我们可以定义一个字典，并将它作为我们自己的字典，以便更有效地存储开始评级，如下所示:</p><p id="c453" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">'一':1，'二':2，'三':3，'四':4，'五':5</p><p id="00ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如此接近，现在让我们从网站上抓取数据。使用下面的命令开始爬行。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="ffbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将生成一个包含书名、价格、可用性状态和星级的CSV文件。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es mq"><img src="../Images/8f02dd7439966ad162ae60f95deb54b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*Xd5JtUhkiprqHIrfVPgnCQ.png"/></div></figure></div><div class="ab cl mr ms gp mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hb hc hd he hf"><p id="b24b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经废弃了另外两个资源的数据。</p><ol class=""><li id="f768" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated"><a class="ae jd" href="http://quotes.toscrape.com/" rel="noopener ugc nofollow" target="_blank">http://quotes.toscrape.com/</a></li><li id="adcf" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated"><a class="ae jd" href="https://www.flipkart.com/" rel="noopener ugc nofollow" target="_blank">https://www.flipkart.com/</a></li></ol><p id="64a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<a class="ae jd" href="https://github.com/ishritam/Web-Scraping-using-Python-s-Scrapy-Framework" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">找到代码GitHub </strong> </a>。</p></div><div class="ab cl mr ms gp mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hb hc hd he hf"><p id="a46c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">恭喜你。您刚刚在技能列表中添加了一项新技能。现在，是时候去一些合法的网站来获得这项技能了。</p><h1 id="96b3" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">参考:</h1><p id="b3d9" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">【https://docs.scrapy.org/en/latest/index.html T4】</p></div></div>    
</body>
</html>