<html>
<head>
<title>Mapping the Spread of Coronavirus COVID-19 with python and Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用python和Plotly绘制新冠肺炎冠状病毒传播图</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/mapping-the-spread-of-coronavirus-covid-19-d7830c4282e?source=collection_archive---------7-----------------------#2020-03-08">https://medium.com/analytics-vidhya/mapping-the-spread-of-coronavirus-covid-19-d7830c4282e?source=collection_archive---------7-----------------------#2020-03-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9e40e6eda19be9e7b7215d60dcb6ffc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aK8ZbJYQW0iXTYtTpEbESw.png"/></div></div></figure><p id="c236" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我将分享我最近在python和Plotly中学习可视化的经验。通过这个示例，我将回顾以下技能:</p><ul class=""><li id="2e0c" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">如何将网络上的csv文件读入熊猫数据框架(df)</li><li id="8f27" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">如何使数据帧<em class="kc">【整齐】</em></li><li id="1c43" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">如何在plotly中创建时间序列图</li><li id="107f" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">如何在plotly中创建动画时空地图</li></ul><h1 id="e545" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">第一部分。准备数据</h1><p id="a3fd" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">在这一部分中，我将展示如何从遍布全球的冠状病毒库中获取数据。<a class="ae lg" href="https://github.com/CSSEGISandData/COVID-19" rel="noopener ugc nofollow" target="_blank">这个知识库</a>由约翰·霍普金斯大学提供，是<a class="ae lg" href="https://www.arcgis.com/apps/opsdashboard/index.html#/bda7594740fd40299423467b48e9ecf6" rel="noopener ugc nofollow" target="_blank">这个伟大可视化</a>背后的数据源。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="96a0" class="lq ke hi lm b fi lr ls l lt lu"># Starting the required libraries<br/>import numpy as np</span><span id="a376" class="lq ke hi lm b fi lv ls l lt lu">import geopandas as gpd<br/>import pandas as pd<br/>from functools import reduce</span></pre><p id="266b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 1.1。下载数据</strong> <br/>主存储库在两个独立的文件夹中包含两组csv文件。一个文件夹包含每日csv文件，另一个文件夹包含每日数据的时间序列。在这里，我使用的是三个熊猫数据框架中的<em class="kc">确诊、死亡和恢复</em>病例数的时间序列数据。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="a364" class="lq ke hi lm b fi lr ls l lt lu">#### Part 1 : Preparing the data</span><span id="4db4" class="lq ke hi lm b fi lv ls l lt lu"># 1.1 Downloading csv into dataframe<br/>df_confirmed = pd.read_csv('<a class="ae lg" href="https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv'" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv'</a>)<br/>df_deaths = pd.read_csv('<a class="ae lg" href="https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Deaths.csv'" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Deaths.csv'</a>)<br/>df_recovered = pd.read_csv('<a class="ae lg" href="https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Recovered.csv'" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Recovered.csv'</a>)</span></pre><p id="981c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 1.2。整理数据</strong> <br/>我第一次了解到<em class="kc">整理数据</em>的想法时，我真的很欣赏它，并认为它很棒。如果你为了你的分析，特别是可视化的目的，使你的数据整洁，你将有希望为你自己节省很多时间和挫折。我第一次了解到它是通过这套绝妙的套装和它的创造者T21·哈德利·威克姆。你可以在这里了解更多关于<em class="kc">整理数据</em> <a class="ae lg" href="https://r4ds.had.co.nz/tidy-data.html" rel="noopener ugc nofollow" target="_blank">的想法。</a></p><p id="78d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我记得，一个整洁的数据集的第一条规则，可能也是最重要的一条规则是，每一行代表一个也是唯一一个观察值。让我们看一下我们的一个数据帧，看看它是否整洁:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="4fb1" class="lq ke hi lm b fi lr ls l lt lu">df_confirmed.head(5)</span></pre><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/070f1651c7eda96cff2a44d018b76873.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iZVCiL0gu3IjqLwkUinuXw.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">这个数据框整齐吗？</figcaption></figure><p id="4026" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的数据框架有49列，其中45列包含特定一天某个地方的确诊病例数。</p><blockquote class="mb mc md"><p id="979f" class="iq ir kc is b it iu iv iw ix iy iz ja me jc jd je mf jg jh ji mg jk jl jm jn hb bi translated">整洁吗？</p></blockquote><p id="1643" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">记住<em class="kc">‘一排_一观察’</em>的规律，我想你知道答案。那么让我们继续:<br/>让我们创建一个列来存储日期，并将数字放在另一个适当的列中。然后我们将把三个ddataframes合并成一个，使用<em class="kc">[‘省/州’，‘国家/地区’，‘纬度’，‘长’，‘日期’]</em>作为键<em class="kc">。</em></p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="4242" class="lq ke hi lm b fi lr ls l lt lu"># 1.2 Tidying the data<br/># Using melt() command in pandas (similar to gather() in R's tidyr)</span><span id="8c57" class="lq ke hi lm b fi lv ls l lt lu">id_list = df_confirmed.columns.to_list()[:4]<br/>vars_list = df_confirmed.columns.to_list()[4:]</span><span id="b5e7" class="lq ke hi lm b fi lv ls l lt lu">confirmed_tidy = pd.melt(df_confirmed, id_vars=id_list,\<br/>     value_vars=vars_list, var_name='Date', value_name='Confirmed')<br/>deaths_tidy = pd.melt(df_deaths, id_vars=id_list,\<br/>     value_vars=vars_list, var_name='Date', value_name='Deaths')<br/>recovered_tidy = pd.melt(df_recovered, id_vars=id_list,\<br/>     value_vars=vars_list, var_name='Date', value_name='recovered')</span><span id="2123" class="lq ke hi lm b fi lv ls l lt lu"># 1.3 Merging the three dataframes into one<br/>data_frames = [confirmed_tidy, deaths_tidy, recovered_tidy]          <br/>df_corona = reduce(lambda left, right: pd.merge(left, right, on =\<br/>               id_list+['Date'], how='outer'), data_frames)</span><span id="e8f4" class="lq ke hi lm b fi lv ls l lt lu"># 1.4 Each row should only represent one observation<br/>id_vars = df_corona.columns[:5]<br/>data_type = ['Confirmed', 'Deaths', 'recovered']<br/>df_corona = pd.melt(df_corona, id_vars=id_vars,\<br/>          value_vars=data_type, var_name='type', value_name='Count')<br/>df_corona['Date'] = pd.to_datetime(df_corona['Date'],\ <br/>            format='%m/%d/%y', errors='raise')</span></pre><p id="467c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们检查组合的数据帧是否整齐:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="e813" class="lq ke hi lm b fi lr ls l lt lu">df_corona.head(5)</span></pre><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/d6b552d03700dd6047557d6aa5e05033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KkSqbNEn7CobGLb4AERxng.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">tidyed数据帧</figcaption></figure><p id="dcf1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">新的数据帧是否遵循规则<em class="kc">‘一行一观察’</em>？<br/>如果是的话，我们可以继续前进，开始创建可视化。</p><h1 id="12a4" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">第二部分。形象化</h1><p id="2178" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">在这一部分中，我将展示如何使用python中令人惊叹的<a class="ae lg" href="https://plot.ly/python/" rel="noopener ugc nofollow" target="_blank"> plotly </a>包来创建漂亮的交互式可视化效果。一个时间序列图和一个新冠肺炎随时间发展的动画地图。我们将使用<a class="ae lg" href="https://plot.ly/python/plotly-express/" rel="noopener ugc nofollow" target="_blank"> <em class="kc"> plotly.express </em> </a>库。与使用标准的plotly库相比，这使得工作变得更加容易。虽然，和往常一样，它没有标准库灵活。让我们开始:</p><p id="322d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 2.1。时间序列图</strong> <br/>让我们创建一个确诊、死亡和痊愈病例总数的时间序列图，类似于这个漂亮的<a class="ae lg" href="https://www.arcgis.com/apps/opsdashboard/index.html#/bda7594740fd40299423467b48e9ecf6" rel="noopener ugc nofollow" target="_blank">约翰霍普金斯仪表盘</a>中的那个。</p><p id="b28a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先对每个日期的值求和:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="9a47" class="lq ke hi lm b fi lr ls l lt lu">corona_sums = df_corona.groupby(['type', 'Date'],\<br/>                     as_index=False).agg({'Count':'sum'})</span></pre><p id="89db" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">和时间序列图:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="ac01" class="lq ke hi lm b fi lr ls l lt lu">import plotly_express as px<br/>def plot_timeseries(df):<br/>    fig = px.line(df, x='Date', y='Count', color='type',\<br/>             template='plotly_dark')<br/><br/>    fig.update_layout(legend_orientation="h")<br/>    return(fig)</span><span id="8f9b" class="lq ke hi lm b fi lv ls l lt lu"><br/>fig = plot_timeseries(corona_sums)<br/>fig.show()</span></pre><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/313b1148ffba852d9e21b518b8bbbb89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B18OOVkQagTLIoSKddZzPQ.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">新冠肺炎案例的时间序列图</figcaption></figure><p id="ee3f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.2.动画时间序列图<br/>现在让我们创建确诊病例的空间时间序列。这样我们就可以看到病毒是如何随着时间在全世界传播的。这里我使用气泡图，气泡的大小与确诊病例数成比例。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="e92a" class="lq ke hi lm b fi lr ls l lt lu">import plotly_express as px</span><span id="37ad" class="lq ke hi lm b fi lv ls l lt lu"># Selecting only the Confirmed cases<br/>tsmap_corona = df_corona[df_corona['type']=='Confirmed']<br/>tsmap_corona['Date'] = tsmap_corona['Date'].astype(str)</span></pre><p id="ae26" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了控制气泡的大小，我在下面的代码中创建了一个分类列，并将气泡的大小与七类数据相关联。在这里，我硬编码了箱的切割值。这是为了防止添加新的材料到这个职位。我建议使用标准方法来计算这个切割值。<a class="ae lg" href="https://www.axismaps.com/guide/data/data-classification/" rel="noopener ugc nofollow" target="_blank">在这里</a>您可以了解更多关于在地图上可视化数据的数据分类。同样在python中这样做，你可以考虑使用<a class="ae lg" href="https://github.com/pysal/mapclassify" rel="noopener ugc nofollow" target="_blank"> <em class="kc"> mapclassify </em> </a>库。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="d7f2" class="lq ke hi lm b fi lr ls l lt lu"># Classifying data for visulalization<br/>to_Category = pd.cut(tsmap_corona['Count'], [-1,0,105, 361, 760,\<br/>            1350, 6280, 200000], labels=[0, 1, 8, 25, 40, 60, 100])<br/>tsmap_corona = tsmap_corona.assign(size=to_Category)</span></pre><p id="b647" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的动画空间时间序列图创建如下:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="82f2" class="lq ke hi lm b fi lr ls l lt lu">fig_time= px.scatter_mapbox(data_frame=test2,lat='Lat',lon='Long',\ <br/>        hover_name= 'Country/Region', hover_data=['Province/State',\<br/>        'Count'], size='size', animation_frame='Date',\<br/>       mapbox_style='stamen-toner', template='plotly_dark', zoom=1,\<br/>       size_max=70)<br/>fig_time.show()</span></pre><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/dfb571aee4cfa354ba7cb0e33ea612f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KjgClmZRUYDZ5g8a5Q6CjA.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">新冠肺炎确诊病例的动画时空情节</figcaption></figure><p id="e1fa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就是这样。我希望这篇文章对你有用。我会很感激你的想法，建议和对这篇文章的任何评论。</p><p id="65ac" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">T22【巴巴克】T23</strong></p></div></div>    
</body>
</html>