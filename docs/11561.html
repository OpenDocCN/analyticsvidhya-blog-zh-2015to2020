<html>
<head>
<title>Pytest — part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pytest —第2部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/pytest-part-2-9c594c36b9f4?source=collection_archive---------2-----------------------#2020-12-09">https://medium.com/analytics-vidhya/pytest-part-2-9c594c36b9f4?source=collection_archive---------2-----------------------#2020-12-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6601" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个博客是我的pytest初学者指南博客的延续。</p><div class="jd je ez fb jf jg"><a href="https://gunturu-lali.medium.com/pytest-a-beginner-guide-9ba84a18d3dd" rel="noopener follow" target="_blank"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hj fi z dy jl ea eb jm ed ef hh bi translated">pytest——初学者指南。📄</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">pytest框架入门…</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">gunturu-lali.medium.com</p></div></div><div class="jp l"><div class="jq l jr js jt jp ju jv jg"/></div></div></a></div><figure class="jx jy jz ka fd kb er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es jw"><img src="../Images/1e8ee5729b7989a923a643921efb5979.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KytxagAYOEfIFFCM"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx translated">在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的<a class="ae kl" href="https://unsplash.com/@thisisengineering?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> ThisisEngineering RAEng </a></figcaption></figure><p id="12b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里涉及的主题有:</p><ul class=""><li id="7cdf" class="km kn hi ih b ii ij im in iq ko iu kp iy kq jc kr ks kt ku bi translated"><strong class="ih hj"> <em class="kv">分组测试</em> </strong></li><li id="0579" class="km kn hi ih b ii kw im kx iq ky iu kz iy la jc kr ks kt ku bi translated"><strong class="ih hj"> <em class="kv">创建pytest.ini文件</em> </strong></li><li id="933e" class="km kn hi ih b ii kw im kx iq ky iu kz iy la jc kr ks kt ku bi translated"><strong class="ih hj"> <em class="kv">自定义标记</em> </strong></li><li id="3935" class="km kn hi ih b ii kw im kx iq ky iu kz iy la jc kr ks kt ku bi translated"><strong class="ih hj"> <em class="kv">内置标记</em> </strong></li><li id="3b4d" class="km kn hi ih b ii kw im kx iq ky iu kz iy la jc kr ks kt ku bi translated"><strong class="ih hj"> <em class="kv">为什么python脱颖而出</em> </strong></li><li id="4681" class="km kn hi ih b ii kw im kx iq ky iu kz iy la jc kr ks kt ku bi translated"><strong class="ih hj"> <em class="kv">参数化标记</em> </strong></li><li id="1d24" class="km kn hi ih b ii kw im kx iq ky iu kz iy la jc kr ks kt ku bi translated"><strong class="ih hj"> <em class="kv">并行测试</em> </strong></li><li id="dc26" class="km kn hi ih b ii kw im kx iq ky iu kz iy la jc kr ks kt ku bi translated"><strong class="ih hj"><em class="kv">N次失败后停止</em> </strong></li><li id="7ac8" class="km kn hi ih b ii kw im kx iq ky iu kz iy la jc kr ks kt ku bi translated"><strong class="ih hj"> <em class="kv">汇报</em> </strong></li></ul></div><div class="ab cl lb lc gp ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="hb hc hd he hf"><p id="f9c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">分组测试- </strong></p><p id="f716" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在pytest中，我们可以使用测试函数上的标记对测试进行分组。pytest的妙处就在这里，我们可以使用内置的标记，或者如果需要，我们可以创建自己的标记。最广泛使用的标记是parametrize、xfail和skip。创建自定义标记的语法是，</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="07f6" class="ln lo hi lj b fi lp lq l lr ls">@pytest.mark.&lt;markername&gt;</span></pre><p id="fb7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，@ symbol描述了一个装饰器，为了使用标记，我们必须首先用命令<strong class="ih hj">导入pytest </strong>导入pytest模块。</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es lt"><img src="../Images/8489073c784a29666a90a667130535b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m18gmuNTbliitM1y"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx translated">泰勒·米利根在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="2696" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">pytest中有两种类型的标记。他们是，</p><ul class=""><li id="a44f" class="km kn hi ih b ii ij im in iq ko iu kp iy kq jc kr ks kt ku bi translated">内置标记</li><li id="a806" class="km kn hi ih b ii kw im kx iq ky iu kz iy la jc kr ks kt ku bi translated">自定义标记</li></ul><p id="05d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">标记只能应用于测试，对夹具没有影响。</p><p id="1304" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要显示所有可用的标记(包括内置的和自定义的),使用的命令是，</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="825e" class="ln lo hi lj b fi lp lq l lr ls"><em class="kv">pytest --markers</em></span></pre><p id="493c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">示例代码，</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="7da0" class="ln lo hi lj b fi lp lq l lr ls">import pytest</span><span id="afa9" class="ln lo hi lj b fi lu lq l lr ls">@pytest.mark.concat<br/>def test_strConcat(input_value):<br/>    assert "Hello " + input_value == "Hello python"</span></pre><p id="0663" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里<strong class="ih hj"> <em class="kv"> concat </em> </strong>是自定义标记，分配给函数执行字符串串联操作。</p><p id="8ac5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要使用特定的标记执行特定的测试，可以使用下面的命令。</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="a50a" class="ln lo hi lj b fi lp lq l lr ls">pytest -m &lt;markername&gt; -v</span></pre><p id="6061" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例子，</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="ca83" class="ln lo hi lj b fi lp lq l lr ls">pytest -m concat -v</span></pre><p id="0b10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该命令获取所有标有<em class="kv">连接</em>的测试，并执行这些测试。</p><p id="ba2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们有自定义标记，他们需要注册。为了注册，我们必须创建一个名为<strong class="ih hj"> <em class="kv"> pytest.ini. </em> </strong>的文件</p></div><div class="ab cl lb lc gp ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="hb hc hd he hf"><h1 id="9391" class="lv lo hi bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">正在创建pytest.ini文件</h1><p id="f168" class="pw-post-body-paragraph if ig hi ih b ii ms ik il im mt io ip iq mu is it iu mv iw ix iy mw ja jb jc hb bi translated">INI代表初始化。从它的名字我们可以看出它保存了配置信息。它包含文本内容，这样我们可以很容易地阅读，这有助于如果一个新的程序员进入概念。它遵循一个结构，我们必须添加我们的自定义标记名称。</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div class="er es mx"><img src="../Images/a41505bdf4295b0820eac91421b4b2c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:574/format:webp/0*6L3QPQMyOynBUs13.png"/></div></figure><p id="41b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上图可以看到，<strong class="ih hj"> <em class="kv"> Test </em> </strong>是我的包，pytest.ini是创建的文件。</p><p id="ec6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">pytest.ini文件的示例结构如下:</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="48b5" class="ln lo hi lj b fi lp lq l lr ls">[pytest]</span><span id="5e0f" class="ln lo hi lj b fi lu lq l lr ls">markers =<br/>    add : to add numbers<br/>    sub : to subtract numbers<br/>    concat : To concatenate strings</span></pre><p id="b26c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，<em class="kv"> add，sub，concat </em>是自定义标记，定义每个标记的用法供用户参考，是可选的。</p><p id="29fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Pytest提供了一个优秀的特性，叫做<em class="kv"> strict markers，</em>，如果marker没有注册，通过它我们可以限制测试的执行。</p><p id="b1c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这可以通过使用，<strong class="ih hj"> <em class="kv"> addopts = — strict -markers来实现。</em>T11】</strong></p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="5292" class="ln lo hi lj b fi lp lq l lr ls">[pytest]</span><span id="9066" class="ln lo hi lj b fi lu lq l lr ls">addopts = --strict -markers<br/>markers =<br/>    add : to add numbers<br/>    sub : to subtract numbers<br/>    concat : To concatenate strings</span></pre></div><div class="ab cl lb lc gp ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="hb hc hd he hf"><h1 id="cc7a" class="lv lo hi bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">内置标记</h1><p id="bc30" class="pw-post-body-paragraph if ig hi ih b ii ms ik il im mt io ip iq mu is it iu mv iw ix iy mw ja jb jc hb bi translated">Pytest提供了一些内置的标记，最常用的有<strong class="ih hj"> <em class="kv"> skip、xfail、parametrize、incremental等。</em>T15】</strong></p><p id="a421" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="kv">跳过— </em> </strong>总是跳过一个测试功能</p><p id="09d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">语法，</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="cbc1" class="ln lo hi lj b fi lp lq l lr ls">pytest -m skip filename.py</span></pre><p id="4607" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="kv"> xfail — </em> </strong>如果满足某个条件，就会产生“预期失败”的结果。</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="af26" class="ln lo hi lj b fi lp lq l lr ls">pytest -m xfail filename.py</span></pre><p id="e2ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="kv">参数化— </em> </strong>测试的参数化是通过多组输入/数据来运行测试。</p></div><div class="ab cl lb lc gp ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="hb hc hd he hf"><h1 id="4119" class="lv lo hi bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">pytest脱颖而出的原因-</h1><p id="6933" class="pw-post-body-paragraph if ig hi ih b ii ms ik il im mt io ip iq mu is it iu mv iw ix iy mw ja jb jc hb bi translated">现在让我们考虑一个测试在一段时间内不相关的情况，这里python提供了一个优秀的标记，叫做<strong class="ih hj"> xfail。我们有两个选择，要么失败，要么跳过。</strong></p><p id="5070" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，pytest实际上执行了xfailed测试，但是它不被视为通过或失败的测试，即使测试失败，也不会打印测试的更多细节。</p><p id="d4d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以使用以下标记进行xfail测试</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="c34a" class="ln lo hi lj b fi lp lq l lr ls">@pytest.mark.xfail</span></pre><p id="a618" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例子，</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="e466" class="ln lo hi lj b fi lp lq l lr ls">import pytest</span><span id="42ea" class="ln lo hi lj b fi lu lq l lr ls">@pytest.mark.skip<br/>def test_upper(input_value):<br/>    assert input_value.upper() == "PYTHON"</span><span id="a8f2" class="ln lo hi lj b fi lu lq l lr ls">@pytest.mark.xfail<br/>def test_lower(input_value):<br/>    assert input_value.lower() == "python"</span></pre><p id="29f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用以下命令执行测试</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="9b49" class="ln lo hi lj b fi lp lq l lr ls">pytest test_customMark.py -v</span></pre><p id="aea8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">执行时，上述命令将生成以下结果</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="bc2d" class="ln lo hi lj b fi lp lq l lr ls">========================= test session starts =========================<br/>platform win32 -- Python 3.9.0, pytest-6.1.2, py-1.9.0, pluggy-0.13.1 -- c:\users\pycharmprojects\testing\venv\scripts\python.exe<br/>cachedir: .pytest_cache<br/>metadata: {'Python': '3.9.0', 'Platform': 'Windows-10-10.0.18362-SP0', 'Packages': {'pytest': '6.1.2', 'py': '1.9.0', 'pluggy': '0.13.1'}, 'Plugins': {'forked': '1.3.0', 'html': '2.1.1', 'metadata': '1.10.0', 'xdist': '2.1.0'}}<br/>rootdir: C:\Users\PycharmProjects\Testing\Test, configfile: pytest.ini<br/>plugins: forked-1.3.0, html-2.1.1, metadata-1.10.0, xdist-2.1.0<br/>collected 2 items / 2 deselected                                                                                                                                                                                                          </span><span id="4975" class="ln lo hi lj b fi lu lq l lr ls">======================= 2 deselected in 0.05s ========================</span></pre><p id="a5cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们分析执行，两个测试函数被执行，但是没有显示为选中。</p></div><div class="ab cl lb lc gp ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="hb hc hd he hf"><h1 id="0b7a" class="lv lo hi bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">参数化标记</h1><p id="6ba3" class="pw-post-body-paragraph if ig hi ih b ii ms ik il im mt io ip iq mu is it iu mv iw ix iy mw ja jb jc hb bi translated">完成测试的参数化是为了用多组输入/数据运行测试。Pytest提供了一个内置的标记来执行参数化。</p><p id="016c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这可以使用参数化装饰来完成。</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="2b39" class="ln lo hi lj b fi lp lq l lr ls">@pytest.mark.parametrize</span></pre><p id="997a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建参数化夹具，</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="d981" class="ln lo hi lj b fi lp lq l lr ls">@pytest.mark.parametrize("variable1, variable2",<br/>			 [(dataset1),(dataset2)]<br/>			 )<br/>def function_name(variable1, variable2):<br/>	** --- assertion here --- **</span></pre><p id="68c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，<em class="kv">变量1和变量2 </em>是两个<strong class="ih hj">参数名。</strong></p><p id="85fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kv">数据集1和数据集2 </em>是两个<strong class="ih hj">参数值。</strong></p><p id="34e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们以相同的字符串连接操作为例来看看它是如何工作的，</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="56d9" class="ln lo hi lj b fi lp lq l lr ls">import pytest<br/>@pytest.mark.parametrize("str1,str2,result",<br/>                         [("Open ", "source", "Open source"),<br/>                         ("Hello ", "World", "Hello World") <br/>                          ])<br/>def test_strConcat(str1, str2, result):<br/>    assert str1 + str2 == result</span></pre><p id="940b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出-</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="fa8c" class="ln lo hi lj b fi lp lq l lr ls">collected 2 items                                                                                                                                                                                                                         <br/>test_Parameterized.py ..                                                                                                                                                                                                            [100%]</span><span id="ceec" class="ln lo hi lj b fi lu lq l lr ls">==================================== 2 passed in 0.04s =====================================</span></pre></div><div class="ab cl lb lc gp ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="hb hc hd he hf"><h1 id="2067" class="lv lo hi bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">平行测试</h1><p id="c671" class="pw-post-body-paragraph if ig hi ih b ii ms ik il im mt io ip iq mu is it iu mv iw ix iy mw ja jb jc hb bi translated">并行测试意味着我们通过分割处理器的数量来执行测试。我们可以分配多个工人并执行。</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es my"><img src="../Images/e80e1e6f632ff0874c910a940211000f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c4il-akb_ojJB9T1"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx translated"><a class="ae kl" href="https://unsplash.com/@jancanty?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Jan Canty </a>在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="d7c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Pytest按顺序运行所有的测试文件。当执行一堆测试时，它会自动增加执行时间。在这种情况下，并行测试有助于并行运行测试。</p><p id="3fd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们必须安装一个名为，</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="f308" class="ln lo hi lj b fi lp lq l lr ls">pytest-xdist</span></pre><p id="a0a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在命令行中执行以下命令-</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="9f13" class="ln lo hi lj b fi lp lq l lr ls">pip install pytest-xdist</span></pre><p id="c772" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数字可以指定为:</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="bc31" class="ln lo hi lj b fi lp lq l lr ls"><strong class="lj hj">pytest -n &lt;num&gt;</strong></span></pre><p id="2ce5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例子，</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="eef4" class="ln lo hi lj b fi lp lq l lr ls">pytest -n 2</span></pre><p id="09ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出，</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="c497" class="ln lo hi lj b fi lp lq l lr ls">(venv) C:\Users\user1\PycharmProjects\Testing\Test&gt;pytest -n 2<br/>===================== test session starts =============================<br/>platform win32 -- Python 3.9.0, pytest-6.1.2, py-1.9.0, pluggy-0.13.1<br/>rootdir: C:\Users\user1\PycharmProjects\Testing\Test, configfile: pytest.ini<br/>plugins: forked-1.3.0, html-2.1.1, metadata-1.10.0, xdist-2.1.0<br/>gw0 [0] / gw1 [0]</span><span id="ca2a" class="ln lo hi lj b fi lu lq l lr ls">=================== no tests ran in 0.75s ============================</span></pre><p id="dd15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们分析执行的测试代码，内部测试被分组并执行。swe提及2，测试被分组为gw0[0] / gw1[0]</p><p id="4664" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="kv"> gw </em> </strong>代表集团职工。</p><p id="0640" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实施例2，</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="232c" class="ln lo hi lj b fi lp lq l lr ls">pytest -n 4</span></pre><p id="4542" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出，</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="8367" class="ln lo hi lj b fi lp lq l lr ls">(venv) C:\Users\PycharmProjects\Testing\Test&gt;pytest -n 4<br/>======================= test session starts ===========================<br/>platform win32 -- Python 3.9.0, pytest-6.1.2, py-1.9.0, pluggy-0.13.1<br/>rootdir: C:\Users\PycharmProjects\Testing\Test, configfile: pytest.ini<br/>plugins: forked-1.3.0, html-2.1.1, metadata-1.10.0, xdist-2.1.0<br/>gw0 [0] / gw1 [0] / gw2 [0] / gw3 [0]</span><span id="d687" class="ln lo hi lj b fi lu lq l lr ls">======================= no tests ran in 0.96s =========================</span></pre><p id="5493" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里测试分为4组，分别为gw0[0]，gw1[0]，gw2[0]，gw3[0]</p><p id="6f00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们想知道执行了哪些测试，我们可以尝试使用-v verbose选项，如下所示</p><p id="4132" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">T5【pytest-n4-vT7】</strong></p><p id="a4dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kv">举例，</em></p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="55d6" class="ln lo hi lj b fi lp lq l lr ls">(venv) C:\Users\user1\PycharmProjects\Testing\Test&gt;pytest -n 4 -v<br/>======================== test session starts =========================<br/>platform win32 -- Python 3.9.0, pytest-6.1.2, py-1.9.0, pluggy-0.13.1 -- c:\users\pycharmprojects\testing\venv\scripts\python.exe<br/>cachedir: .pytest_cache<br/>metadata: {'Python': '3.9.0', 'Platform': 'Windows-10-10.0.18362-SP0', 'Packages': {'pytest': '6.1.2', 'py': '1.9.0', 'pluggy': '0.13.1'}, 'Plugins': {'forked': '1.3.0', 'html': '2.1.1', 'metadata': '1.10.0', 'xdist': '2.1.0'}}<br/>rootdir: C:\Users\PycharmProjects\Testing\Test, configfile: pytest.ini<br/>plugins: forked-1.3.0, html-2.1.1, metadata-1.10.0, xdist-2.1.0<br/>[gw0] win32 Python 3.9.0 cwd: C:\Users\user1\PycharmProjects\Testing\Test<br/>[gw1] win32 Python 3.9.0 cwd: C:\Users\user1\PycharmProjects\Testing\Test<br/>[gw2] win32 Python 3.9.0 cwd: C:\Users\user1\PycharmProjects\Testing\Test<br/>[gw3] win32 Python 3.9.0 cwd: C:\Users\use1\PycharmProjects\Testing\Test<br/>[gw0] Python 3.9.0 (tags/v3.9.0:9cf6752, Oct  5 2020, 15:34:40) [MSC v.1927 64 bit (AMD64)]<br/>[gw1] Python 3.9.0 (tags/v3.9.0:9cf6752, Oct  5 2020, 15:34:40) [MSC v.1927 64 bit (AMD64)]<br/>[gw2] Python 3.9.0 (tags/v3.9.0:9cf6752, Oct  5 2020, 15:34:40) [MSC v.1927 64 bit (AMD64)]<br/>[gw3] Python 3.9.0 (tags/v3.9.0:9cf6752, Oct  5 2020, 15:34:40) [MSC v.1927 64 bit (AMD64)]<br/>gw0 [0] / gw1 [0] / gw2 [0] / gw3 [0]<br/>scheduling tests via LoadScheduling</span></pre><p id="95e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将给出每个工人执行测试详细视图。</p></div><div class="ab cl lb lc gp ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="hb hc hd he hf"><h1 id="1ef1" class="lv lo hi bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">N次失败后停止</h1><p id="706c" class="pw-post-body-paragraph if ig hi ih b ii ms ik il im mt io ip iq mu is it iu mv iw ix iy mw ja jb jc hb bi translated">该功能允许在发生“n”次故障后停止进一步测试。</p><p id="7f95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在实际场景中，一旦新版本的代码准备好进行部署，它将首先部署到生产前/准备环境中。然后在其上运行一个测试套件。</p><p id="8904" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只有测试套件通过，代码才有资格部署到生产环境中。如果测试失败，不管是一次还是多次，代码都没有准备好投入生产。</p><p id="e6c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，如果我们想在n次测试失败后立即停止测试套件的执行，该怎么办。这可以在pytest中使用maxfail来完成。</p><p id="7cb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在n次测试失败后立即停止执行测试套件的语法如下</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="e203" class="ln lo hi lj b fi lp lq l lr ls">pytest --maxfail = &lt;num&gt;</span></pre><p id="1165" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要在第一次失败后停止测试，</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="a300" class="ln lo hi lj b fi lp lq l lr ls">pytest -x</span></pre><p id="23fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要在第一次失败后停止测试，</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="e94d" class="ln lo hi lj b fi lp lq l lr ls">pytest --exitfirst</span></pre><p id="a000" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用以下代码创建一个文件test_failure.py。</p><pre class="jx jy jz ka fd li lj lk ll aw lm bi"><span id="4ed5" class="ln lo hi lj b fi lp lq l lr ls">pytest --exitfirst 2</span></pre><p id="6dbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">执行此测试文件时，所有测试都将失败。这里，我们将在两次失败后停止测试的执行。</p></div><div class="ab cl lb lc gp ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="hb hc hd he hf"><h1 id="ee4f" class="lv lo hi bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">报告</h1><p id="68ab" class="pw-post-body-paragraph if ig hi ih b ii ms ik il im mt io ip iq mu is it iu mv iw ix iy mw ja jb jc hb bi translated">执行此操作的第一步是使用以下命令安装html包，</p><p id="3206" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> pip install pytest-html — </strong>在命令提示符下安装所有软件包，生成一个html文件。</p><p id="0d2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后执行这个命令，</p><p id="b0ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">pytest—html = report . html</strong></p><p id="3724" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们执行了这个命令，HTML或XML文件就会出现在我们的项目树中。</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div class="er es mx"><img src="../Images/d9e4d30fc4b68729e2af093788657cd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:574/format:webp/0*17rfByagsGmWbtQ5.png"/></div></figure><p id="f088" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是为我们的测试创建XML或HTML报告的方式。</p><p id="a9d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢阅读…</p></div></div>    
</body>
</html>