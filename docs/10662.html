<html>
<head>
<title>How to automate WhatsApp messages programmatically from your computer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在电脑上以编程方式自动发送WhatsApp信息</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-automate-whatsapp-messages-programmatically-from-your-computer-a042d0f4269f?source=collection_archive---------0-----------------------#2020-10-29">https://medium.com/analytics-vidhya/how-to-automate-whatsapp-messages-programmatically-from-your-computer-a042d0f4269f?source=collection_archive---------0-----------------------#2020-10-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/055c4cce6e161a3d18877ee2e1057a18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*_dGNbm7QY2eHgIGz6V82xg.jpeg"/></div></figure><p id="8360" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我是一个组织的WhatsApp平台的管理员。管理员们做的最重要的事情是祝每个人生日快乐。我们不应该错过它。它包括保留一本书(字面上)关于组织的每个成员，这样我们就不会错过他们的生日。我想到了建立一个应用程序，可以做到这一点，只需照顾簿记，也有一个报警系统，将告知当天谁是监礼人。现在，我发现我们也可以通过程序从应用程序发送消息。本质上，我们可以用代码做所有的事情。</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h2 id="77a3" class="jr js hi bd jt ju jv jw jx jy jz ka kb ix kc kd ke jb kf kg kh jf ki kj kk kl bi translated">介绍</h2><p id="b13d" class="pw-post-body-paragraph im in hi io b ip km ir is it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj hb bi translated">我们将使用Twilio和编程语言Python来发送消息。真的是安装它，它有一个免费层。它被蓝围裙，Zendesk，美国红十字会，CipherHealth等使用。Twilio也有其他编程语言的绑定，请查看<a class="ae kr" href="https://www.twilio.com/docs/quickstart" rel="noopener ugc nofollow" target="_blank">快速入门</a>页面。</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h2 id="2155" class="jr js hi bd jt ju jv jw jx jy jz ka kb ix kc kd ke jb kf kg kh jf ki kj kk kl bi translated">装置</h2><p id="45b4" class="pw-post-body-paragraph im in hi io b ip km ir is it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj hb bi translated">首先，您应该安装python，因为我们将使用python。如果你没有安装python，我建议你去python.org<a class="ae kr" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank">下载python 3的最新更新。</a></p><p id="9b88" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，我们必须安装Twilio。在您的终端中，执行以下操作:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="02c9" class="jr js hi kx b fi lb lc l ld le">pip install twilio</span></pre><p id="71de" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果你没有一个IDE，基本上是一个好的文本编辑器，可以帮助你有效地开发应用程序，我推荐使用<a class="ae kr" href="https://code.visualstudio.com/download" rel="noopener ugc nofollow" target="_blank"> vs code </a>。</p><p id="8eb0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这些是我们现在唯一要安装的东西。</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h1 id="54f5" class="lf js hi bd jt lg lh li jx lj lk ll kb lm ln lo ke lp lq lr kh ls lt lu kk lv bi translated">创建项目文件夹和文件</h1><p id="6312" class="pw-post-body-paragraph im in hi io b ip km ir is it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj hb bi translated">在你的电脑上为这个项目创建一个文件夹，命名为<em class="lw"> birthday_messages_app </em>。在其中创建一个文件名<em class="lw"> main.py，</em>我们将编写我们的应用程序的代码。</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h1 id="ee0e" class="lf js hi bd jt lg lh li jx lj lk ll kb lm ln lo ke lp lq lr kh ls lt lu kk lv bi translated">我们的程序</h1><ol class=""><li id="d5fc" class="lx ly hi io b ip km it kn ix lz jb ma jf mb jj mc md me mf bi translated">我们需要一个数据库来存储一些员工的数据。</li><li id="5a67" class="lx ly hi io b ip mg it mh ix mi jb mj jf mk jj mc md me mf bi translated">我们将查询该数据库，以查看谁的出生月份和生日与今天的日期和月份相匹配。</li><li id="2c8c" class="lx ly hi io b ip mg it mh ix mi jb mj jf mk jj mc md me mf bi translated">然后我们会给那个人发一条WhatsApp信息，表达我们对他的感激之情。</li></ol></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h2 id="2008" class="jr js hi bd jt ju jv jw jx jy jz ka kb ix kc kd ke jb kf kg kh jf ki kj kk kl bi translated">步骤1:建立数据库</h2><p id="d5f1" class="pw-post-body-paragraph im in hi io b ip km ir is it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj hb bi translated">我们的应用程序将使用的数据库是一个单文件数据库。但是，我们将使用SQLite，它具有单个文件数据库的所有优点，没有任何缺点，而不是使用文件作为数据库，这有很多不好的副作用。SQLite是python自带的，所以你不需要安装任何东西。</p><p id="9c02" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要使用SQLite，我们必须在python中导入sqlite3模块。打开<em class="lw"> birthday_messages_app </em>文件夹中的main.py文件，编写以下内容。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="7cf2" class="jr js hi kx b fi lb lc l ld le">import sqlite3</span><span id="7f66" class="jr js hi kx b fi ml lc l ld le">conn = sqlite3.connect("company_data.db")<br/>cursor = conn.cursor()</span><span id="0a7f" class="jr js hi kx b fi ml lc l ld le">conn.close()</span></pre><p id="4ac5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在上面的代码中，我们导入了sqlite3模块，然后连接到一个名为company_data.db的文件数据库，如果这个文件不存在，它将由sqlite3创建，如果它也存在，它将不会被覆盖。所以本质上它连接到一个叫做company_data的数据库。</p><p id="55d6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">一个公司的数据可能包括很多东西；其中有我们想要的:员工数据。那可能会存储在一个名为<em class="lw">雇员_数据</em>的表中。公司将存储的员工数据包括:名、姓、电话号码、出生日期、地址等。我们只会对名字、电话号码和出生日期感兴趣。我们将只从数据库中读取数据。因为我们在模仿数据，所以我们应该创建那个表，并放入一些员工数据，以便能够构建我们的应用程序。</p><p id="c380" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们编写函数将数据输入到数据库中。将此添加到<em class="lw"> main.py </em></p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="3cab" class="jr js hi kx b fi lb lc l ld le">def employee_data():</span><span id="8e10" class="jr js hi kx b fi ml lc l ld le">    sql = "CREATE TABLE employees_data (first_name, dob, phone)"<br/>    cursor.execute(sql)</span><span id="f11b" class="jr js hi kx b fi ml lc l ld le">    sql = "INSERT INTO employees_data VALUES (?, ?, ?)"<br/>    data = [('John', '10/30/1990', '+1234567890'),<br/>            ('Tim', '10/29/1992', '+1234567890'),<br/>            ('Van', '10/29/2001', '+1234567890'),<br/>            ]</span><span id="2357" class="jr js hi kx b fi ml lc l ld le">    cursor.executemany(sql, data)<br/>    conn.commit()</span></pre><p id="3b78" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">上面的代码创建了一个名为employees_data的表，其中包含first_name、birth date(DOB)和phone三列，然后添加三行包含这些数据的雇员。<strong class="io hj"> <em class="lw">出于实验原因，请将电话号码替换为您目前在whatsapp </em> <em class="lw">上使用的电话号码。</em>T11】</strong></p><blockquote class="mm mn mo"><p id="624b" class="im in lw io b ip iq ir is it iu iv iw mp iy iz ja mq jc jd je mr jg jh ji jj hb bi translated"><strong class="io hj">注意，在“出生日期”一栏中，日期的安排应该是为了让我们的系统试验起来更有趣。因此，请为其中两个使用当天，然后为另一个使用第二天。因此，如果应用程序永远运行，我们今天会收到两条消息，明天会收到另一条。</strong></p></blockquote><p id="4a04" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">但是首先我们必须运行函数，因为代码在函数内部。将这一行添加到main.py的底部以运行该函数</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="5e84" class="jr js hi kx b fi lb lc l ld le">employee_data()</span></pre><p id="e665" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以现在在<em class="lw"> main.py </em>中我们应该有:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="6d21" class="jr js hi kx b fi lb lc l ld le">import sqlite3</span><span id="d68f" class="jr js hi kx b fi ml lc l ld le">conn = sqlite3.connect("company_data.db")<br/>cursor = conn.cursor()<br/></span><span id="65d6" class="jr js hi kx b fi ml lc l ld le">def employee_data():</span><span id="32c8" class="jr js hi kx b fi ml lc l ld le">    sql = "CREATE TABLE employees_data (first_name, dob, phone)"<br/>    cursor.execute(sql)</span><span id="a095" class="jr js hi kx b fi ml lc l ld le">    sql = "INSERT INTO employees_data VALUES (?, ?, ?)"<br/>    data = [('John', '10/30/1990', '+1234567890'),<br/>            ('Tim', '10/29/1992', '+1234567890'),<br/>            ('Van', '10/29/2001', '+1234567890'),<br/>            ]</span><span id="a872" class="jr js hi kx b fi ml lc l ld le">    cursor.executemany(sql, data)<br/>    conn.commit()</span><span id="95db" class="jr js hi kx b fi ml lc l ld le"><br/>employee_data()</span><span id="7527" class="jr js hi kx b fi ml lc l ld le">conn.close()</span></pre><p id="10e6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">打开你的终端，输入</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="c712" class="jr js hi kx b fi lb lc l ld le">cd birthday_messages_app</span></pre><p id="fc53" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这将把你的shell导航到<em class="lw">生日消息应用</em>文件夹。</p><p id="6bf1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，通过输入以下代码运行<em class="lw"> main.py </em>文件。这就是我们将如何运行我们的main.py。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="6e61" class="jr js hi kx b fi lb lc l ld le">python main.py</span></pre><p id="3055" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="lw">如果上面的代码运行没有错误，您将拥有一个名为company_data的数据库和一个名为employees_data的表，表中有3名雇员的名字、出生日期和电话号码</em></p><p id="3f8e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，我们开始创建应用程序。</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h2 id="b095" class="jr js hi bd jt ju jv jw jx jy jz ka kb ix kc kd ke jb kf kg kh jf ki kj kk kl bi translated">步骤2:查询数据库</h2><p id="5d31" class="pw-post-body-paragraph im in hi io b ip km ir is it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj hb bi translated">是时候查询数据库知道是谁的生日了。</p><p id="3f8b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们创建一个函数来做这件事。在上面的employee_data函数中，我们不必创建函数，因为我们将静态数据放入数据库中。函数employee_data现在没有用了，但是我们必须创建一个函数来查询数据库，因为我们将使用python中的返回值。</p><p id="637d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在您的<em class="lw"> main.py </em>文件<strong class="io hj">中删除</strong>现在已经过时的行:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="b27f" class="jr js hi kx b fi lb lc l ld le">employee_data()</span></pre><p id="180d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">但是，保留employee_data函数以供参考</p><p id="e9be" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将与时间打交道，所以<strong class="io hj">将下面几行添加到文件顶部的导入语句中:</strong></p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="3cb2" class="jr js hi kx b fi lb lc l ld le">...<br/>from time import gmtime, strftime<br/>...</span></pre><p id="0cb2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">将<em class="lw"> check_birthdays </em>函数添加到文件底部:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="a3b4" class="jr js hi kx b fi lb lc l ld le">...</span><span id="376c" class="jr js hi kx b fi ml lc l ld le">def check_birthdays():<br/>    birthday_people = []</span><span id="046f" class="jr js hi kx b fi ml lc l ld le">    sql = "SELECT first_name, dob, phone from employees_data"<br/>    cursor.execute(sql)<br/>    birth_list = cursor.fetchall()</span><span id="f852" class="jr js hi kx b fi ml lc l ld le">    day, month = strftime('%d %m', gmtime()).split(' ')</span><span id="5137" class="jr js hi kx b fi ml lc l ld le">    for name, date_set, phone in birth_list:<br/>        dates = date_set.split('/')<br/>        if dates[0] == month and dates[1] == day:<br/>            birthday_people.append((name, phone))<br/><br/>    return set(birthday_people)</span></pre><p id="97c0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在上面的代码中，我们检查了employees_data数据库表中那些出生月份和生日与我们当前的日期和月份相匹配的人。</p><p id="e9a4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当你把它添加到你的<em class="lw"> main.py </em>文件中时，你应该得到如下所示的东西:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="cd20" class="jr js hi kx b fi lb lc l ld le">from time import gmtime, strftime<br/>import sqlite3</span><span id="fd22" class="jr js hi kx b fi ml lc l ld le">conn = sqlite3.connect("company_data.db")<br/>cursor = conn.cursor()<br/></span><span id="f875" class="jr js hi kx b fi ml lc l ld le">def employee_data():</span><span id="2601" class="jr js hi kx b fi ml lc l ld le">    sql = "CREATE TABLE employees_data (first_name, dob, phone)"<br/>    cursor.execute(sql)</span><span id="68bd" class="jr js hi kx b fi ml lc l ld le">    sql = "INSERT INTO employees_data VALUES (?, ?, ?)"<br/>    data = [('John', '10/30/1990', '+1234567890'),<br/>            ('Tim', '10/29/1992', '+1234567890'),<br/>            ('Van', '10/29/2001', '+1234567890'),<br/>            ]</span><span id="2272" class="jr js hi kx b fi ml lc l ld le">    cursor.executemany(sql, data)<br/>    conn.commit()</span><span id="0f22" class="jr js hi kx b fi ml lc l ld le">def check_birthdays():<br/>    birthday_people = []</span><span id="3217" class="jr js hi kx b fi ml lc l ld le">    sql = "SELECT first_name, dob, phone from employees_data"<br/>    cursor.execute(sql)<br/>    birth_list = cursor.fetchall()</span><span id="5d0c" class="jr js hi kx b fi ml lc l ld le">    day, month = strftime('%d %m', gmtime()).split(' ')</span><span id="b5ca" class="jr js hi kx b fi ml lc l ld le">    for name, date_set, phone in birth_list:<br/>        dates = date_set.split('/')<br/>        if dates[0] == month and dates[1] == day:<br/>            birthday_people.append((name, phone))<br/><br/>    return set(birthday_people)</span><span id="3ee4" class="jr js hi kx b fi ml lc l ld le"><br/>conn.close()</span></pre><p id="6459" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您可以试验一下<em class="lw"> check_birthdays </em>函数返回的内容。但是我们在运行应用程序时不会这样运行，所以我们还没有调用它。</p><p id="a376" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，我们需要一个函数，从check_birthdays函数中获取生日的人，然后使用另一个函数向每个人发送消息。我更喜欢调用main函数，因为它将是主调用者。不要生气，你可以叫它任何你想叫的名字。</p><p id="b8fc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以在你的main.py <strong class="io hj">文件的底部添加</strong>main函数:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="242a" class="jr js hi kx b fi lb lc l ld le">def main():<br/>    birthday_people = check_birthdays()<br/>    send_messages(birthday_people)<br/></span></pre><p id="19e7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从上面的代码中可以看出，我们必须创建一个名为<em class="lw"> send_messages </em>的函数，并使用它将我们的消息发送给那些人。</p><p id="8066" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="lw"> send_messages </em>函数将向这些个人发送消息。</p><p id="a198" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要发送这些消息，我们必须使用Twilio，记住我们安装了它，但要发送WhatsApp消息，我们需要注册Twilio。我不相信有其他方法可以做到这一点，例如直接使用WhatsApp API，唯一的出路是使用Twilio，所以让我们注册Twilio免费试用，本质上是有限制的Twilio forever。</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h2 id="0dee" class="jr js hi bd jt ju jv jw jx jy jz ka kb ix kc kd ke jb kf kg kh jf ki kj kk kl bi translated">第三步:注册</h2><p id="dcd4" class="pw-post-body-paragraph im in hi io b ip km ir is it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj hb bi translated">我们可以使用一个免费的Twilio号码，并用它请求WhatsApp注册，但这可能需要几天时间。所以让我们使用沙盒版本，它本质上给了我们一个可以使用的WhatsApp商业帐户，但你必须重新打开，因为它每24小时关闭一次。别烦我，我们开始吧。</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><p id="ded8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">报名参加twilio</p><p id="d29b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">前往<a class="ae kr" href="https://www.twilio.com/try-twilio" rel="noopener ugc nofollow" target="_blank"> Twilio </a>注册Twilio，应该很简单，当你完成后，你应该被重定向或者前往<a class="ae kr" href="https://www.twilio.com/console" rel="noopener ugc nofollow" target="_blank">https://www.twilio.com/console</a>。</p><p id="000c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您应该会看到类似这样的内容:</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="er es ms"><img src="../Images/c3f2f05f6ec25700ea4920f4ab5dc325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tzzHrowtv1E5xDIlGUd_hA.png"/></div></div></figure><p id="9ba3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你将需要<strong class="io hj">账号SID </strong>和<strong class="io hj">认证令牌</strong>。您将通过点击显示按钮显示您的<strong class="io hj">认证令牌</strong>。复制两张或让窗户开着。</p><p id="d426" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下一步，你应该有一个安装了Whatsapp的设备。</p><p id="585e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">前往<a class="ae kr" href="https://www.twilio.com/console/sms/whatsapp/sandbox/" rel="noopener ugc nofollow" target="_blank">https://www.twilio.com/console/sms/whatsapp/sandbox/</a>，在那里你会找到我们将要使用的沙盒。通过选择一个要使用的数字来激活沙盒。您必须向该号码发送加入{keyword}消息才能激活。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="er es mx"><img src="../Images/e0338127c502fc02ebddcbef03e92efd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*foDxMO1fprOZnxTbWwfGaA.png"/></div></div></figure><p id="683c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，让我们搜索一个图像，我们可以使用它作为发送此人的媒体。使用这张我从网上借来的图片在<a class="ae kr" href="https://karaspartyideas.com/wp-content/uploads/2019/04/Chic-Pastel-Dino-Party-via-Karas-Party-Ideas-KarasPartyIdeas.com_.png" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="72cf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，让我们回到我们的应用程序。</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h2 id="6dfc" class="jr js hi bd jt ju jv jw jx jy jz ka kb ix kc kd ke jb kf kg kh jf ki kj kk kl bi translated">第四步:发送信息</h2><p id="e832" class="pw-post-body-paragraph im in hi io b ip km ir is it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj hb bi translated">在我们的<em class="lw"> main.py </em>进口twilio</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="b9b6" class="jr js hi kx b fi lb lc l ld le">...<br/>import sqlite3</span><span id="75f7" class="jr js hi kx b fi ml lc l ld le">from twilio.rest import Client</span><span id="dd81" class="jr js hi kx b fi ml lc l ld le">...</span></pre><p id="74d3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后创建send_messages函数。您需要从Twilio控制台分别用您的<strong class="io hj">帐户SID </strong>和<strong class="io hj">验证令牌</strong>替换<em class="lw">帐户_sid </em>和<em class="lw">验证令牌</em>。</p><p id="08bd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果您不喜欢提供的<em class="lw">生日_封面</em>图片，请随意使用互联网上的另一张图片。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="5bc8" class="jr js hi kx b fi lb lc l ld le">...<br/>def send_messages(people):</span><span id="111a" class="jr js hi kx b fi ml lc l ld le">    account_sid = 'AXXXXXXXXXXXXXXXXXXXXXXXXXX'<br/>    auth_token = "XXXXXXXXXXXXXXXXXXXXXXXXXXXXX"<br/>    client = Client(account_sid, auth_token)</span><span id="df86" class="jr js hi kx b fi ml lc l ld le">    birthday_cover = "https://karaspartyideas.com/wp-content/uploads/2019/04/Chic-Pastel-Dino-Party-via-Karas-Party-Ideas-KarasPartyIdeas.com_.png"</span><span id="8d66" class="jr js hi kx b fi ml lc l ld le">    for name, phone in people:</span><span id="790d" class="jr js hi kx b fi ml lc l ld le">        msg = f"Happy birthday {name}."<br/>        msg += " We at good Company celebrate you!"</span><span id="7e86" class="jr js hi kx b fi ml lc l ld le">        message = client.messages.create(<br/>            media_url=[birthday_cover],<br/>            from_="whatsapp:+14155238886",<br/>            body=msg,<br/>            to=f"whatsapp:{phone}"<br/>        )</span><span id="69f9" class="jr js hi kx b fi ml lc l ld le">    return True</span></pre><p id="a671" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在上面的代码中，我们设置变量来保存我们的<strong class="io hj">帐户SID </strong>和<strong class="io hj">身份验证令牌</strong>，请更改<em class="lw"> XXX </em>来反映您的值，我们将需要它来成功调用Twilio的SMS API。</p><p id="07d5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，我们通过传入上述两个值来创建客户机对象的实例。接下来是我们将作为信息媒体的生日封面。</p><p id="8ad9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，我们循环遍历<em class="lw">人</em>，这样我们就可以向多个生日庆祝者发送消息，如果他们是多个的话。</p><p id="a57d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，我们创建一个<em class="lw"> msg </em>变量来保存一条定制的消息，该消息包含两行人名，以符合PEP8。</p><p id="109d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，我们最终使用<em class="lw"> client.messages.create </em>从<em class="lw"> twilio.rest </em>模块调用API。我们在<strong class="io hj"><em class="lw">【media _ URL】</em></strong><strong class="io hj"><em class="lw">from _</em></strong><strong class="io hj"><em class="lw">body</em></strong><strong class="io hj"><em class="lw">to</em></strong>变量中传递。</p><ul class=""><li id="89cc" class="lx ly hi io b ip iq it iu ix my jb mz jf na jj nb md me mf bi translated"><strong class="io hj"> <em class="lw"> media_url </em> </strong>:是包含我们选择的封面图片的列表</li><li id="3bdd" class="lx ly hi io b ip mg it mh ix mi jb mj jf mk jj nb md me mf bi translated"><strong class="io hj"> <em class="lw"> from_ </em> </strong>:是沙盒中提供的数字。也可以是你的<a class="ae kr" href="https://www.twilio.com/docs/whatsapp/tutorial/connect-number-business-profile" rel="noopener ugc nofollow" target="_blank">免费Twilio号</a>，格式应该是“whatsapp:+012345678911”</li><li id="43d3" class="lx ly hi io b ip mg it mh ix mi jb mj jf mk jj nb md me mf bi translated"><strong class="io hj"> <em class="lw">正文</em> </strong>:是消息的正文</li><li id="9f70" class="lx ly hi io b ip mg it mh ix mi jb mj jf mk jj nb md me mf bi translated"><strong class="io hj"> <em class="lw">到</em> </strong>:是你加入沙盒的whatsapp号。应该是“whatsapp:+012345678911”的格式</li></ul><p id="27a9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来我们在函数上返回<em class="lw">真值</em>就这样。</p><p id="66f3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在将这一行添加到main.py文件的底部，以运行main函数</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="92de" class="jr js hi kx b fi lb lc l ld le">main()</span></pre><p id="5d79" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以现在的<em class="lw"> main.py </em>文件应该是这样的，XXX被替换了:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="b382" class="jr js hi kx b fi lb lc l ld le">from time import gmtime, strftime<br/>import sqlite3</span><span id="734c" class="jr js hi kx b fi ml lc l ld le">from twilio.rest import Client<br/></span><span id="c6c0" class="jr js hi kx b fi ml lc l ld le">conn = sqlite3.connect("company_data.db")<br/>cursor = conn.cursor()<br/></span><span id="cd0a" class="jr js hi kx b fi ml lc l ld le">def employee_data():</span><span id="5dbc" class="jr js hi kx b fi ml lc l ld le">    sql = "CREATE TABLE employees_data (first_name, dob, phone)"<br/>    cursor.execute(sql)</span><span id="051a" class="jr js hi kx b fi ml lc l ld le">    sql = "INSERT INTO employees_data VALUES (?, ?, ?)"<br/>    data = [('John', '10/30/1990', '+1234567890'),<br/>            ('Tim', '10/29/1992', '+1234567890'),<br/>            ('Van', '10/29/2001', '+1234567890'),<br/>            ]</span><span id="b6f8" class="jr js hi kx b fi ml lc l ld le">    cursor.executemany(sql, data)<br/>    conn.commit()</span><span id="eaad" class="jr js hi kx b fi ml lc l ld le">def check_birthdays():<br/>    birthday_people = []</span><span id="fa1c" class="jr js hi kx b fi ml lc l ld le">    sql = "SELECT first_name, dob, phone from employees_data"<br/>    cursor.execute(sql)<br/>    birth_list = cursor.fetchall()</span><span id="0d00" class="jr js hi kx b fi ml lc l ld le">    day, month = strftime('%d %m', gmtime()).split(' ')</span><span id="6ca2" class="jr js hi kx b fi ml lc l ld le">    for name, date_set, phone in birth_list:<br/>        dates = date_set.split('/')<br/>        if dates[0] == month and dates[1] == day:<br/>            birthday_people.append((name, phone))<br/><br/>    return set(birthday_people)</span><span id="9b5f" class="jr js hi kx b fi ml lc l ld le">def send_messages(people):</span><span id="2adc" class="jr js hi kx b fi ml lc l ld le">    account_sid = 'AXXXXXXXXXXXXXXXXXXXXXXXXXX'<br/>    auth_token = "XXXXXXXXXXXXXXXXXXXXXXXXXXXXX"<br/>    client = Client(account_sid, auth_token)</span><span id="6da7" class="jr js hi kx b fi ml lc l ld le">    birthday_cover = "https://karaspartyideas.com/wp-content/uploads/2019/04/Chic-Pastel-Dino-Party-via-Karas-Party-Ideas-KarasPartyIdeas.com_.png"</span><span id="3630" class="jr js hi kx b fi ml lc l ld le">    for name, phone in people:</span><span id="acc2" class="jr js hi kx b fi ml lc l ld le">        msg = f"Happy birthday {name}."<br/>        msg += " We at good Company celebrate you!"</span><span id="cb9b" class="jr js hi kx b fi ml lc l ld le">        message = client.messages.create(<br/>            media_url=[birthday_cover],<br/>            from_="whatsapp:+14155238886",<br/>            body=msg,<br/>            to=f"whatsapp:{phone}"<br/>        )</span><span id="0763" class="jr js hi kx b fi ml lc l ld le">    return True<br/></span><span id="c3a0" class="jr js hi kx b fi ml lc l ld le">def main():<br/>    birthday_people = check_birthdays()<br/>    send_messages(birthday_people)</span><span id="e34c" class="jr js hi kx b fi ml lc l ld le"><br/>main()</span><span id="920b" class="jr js hi kx b fi ml lc l ld le">conn.close()</span></pre><p id="3011" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在打开终端并运行main.py文件。您应该可以上网发送此邮件。在您的终端中输入以下内容</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="2a22" class="jr js hi kx b fi lb lc l ld le">python main.py</span></pre><p id="2498" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">万岁！！！你应该会在你的Whatsapp上收到一条非常漂亮的媒体消息。类似于这样的东西:</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="er es nc"><img src="../Images/07eda7fecd969a4158adb3b3628b6493.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XDhDpNZAfR7JEPOAhI736g.jpeg"/></div></div></figure><p id="9fc8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">万岁！！！</strong></p><h2 id="8157" class="jr js hi bd jt ju jv jw jx jy jz ka kb ix kc kd ke jb kf kg kh jf ki kj kk kl bi translated">你可以在这里结束教程，或者你可以选择成为一名忍者。</h2></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h2 id="1421" class="jr js hi bd jt ju jv jw jx jy jz ka kb ix kc kd ke jb kf kg kh jf ki kj kk kl bi translated">奖励:时间循环系统</h2><p id="71ae" class="pw-post-body-paragraph im in hi io b ip km ir is it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj hb bi translated">从我们当前的<em class="lw"> main.py </em>文件中，我们可以只运行main函数来检查生日并向他们发送消息，但我更喜欢我们有一个时间检查系统，这样我们只运行这个应用程序一次，但它每天都向当天的生日庆祝者发送消息，而无需我们再次调用它。</p><p id="e38c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因为我们将使用时间模块中的睡眠功能，所以将您的时间导入语句更新为:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="8624" class="jr js hi kx b fi lb lc l ld le">from time import gmtime, strftime, sleep</span></pre><p id="0c34" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们把我们的主函数改写成这样:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="4eff" class="jr js hi kx b fi lb lc l ld le">def main():<br/>    while True:<br/>        if not_wished_today():<br/>            birthday_people = check_birthdays()<br/>            if send_messages(birthday_people):<br/>                update_last_wished()</span><span id="816c" class="jr js hi kx b fi ml lc l ld le">        else:<br/>            sleep(3600)</span></pre><p id="d9ea" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">上面的代码使用了一个永远运行的while循环。然后，它会检查我们今天是否希望人们睡眠3600秒(1小时)，并再次检查，以便我们不会错过午夜的钟声。如果我们没有许愿，我们会检查庆祝者并发送消息，在我们发送完消息后，我们会更新上次许愿的日期。</p><p id="9033" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将需要一个数据存储来存储我们最后一次希望人们。让我们为此创建一个数据库表。</p><p id="5ad4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在<em class="lw"> main.py </em>文件中创建一个函数<em class="lw">生日_系统</em></p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="7cc7" class="jr js hi kx b fi lb lc l ld le">def birthday_sys():<br/>    sql = "CREATE TABLE birthday_sys (last_wished)"<br/>    cursor.execute(sql)</span><span id="d05d" class="jr js hi kx b fi ml lc l ld le">    sql = "INSERT INTO birthday_sys VALUES ('0 0')"<br/>    cursor.execute(sql)<br/>    conn.commit()</span></pre><p id="191d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">上面的代码在运行时将创建一个包含一列last_wished的表birthday_sys。它还插入一个字符串“0 0”来表示没有日期和月份。</p><p id="178b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从main.py的底部删除对main函数的调用，并添加以下内容:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="6076" class="jr js hi kx b fi lb lc l ld le">birthday_sys()</span></pre><p id="9c5f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以现在在你的main.py中，你应该有这样的东西</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="c570" class="jr js hi kx b fi lb lc l ld le">from time import gmtime, strftime, sleep<br/>import sqlite3</span><span id="d0db" class="jr js hi kx b fi ml lc l ld le">from twilio.rest import Client</span><span id="a64a" class="jr js hi kx b fi ml lc l ld le">conn = sqlite3.connect("company_data.db")<br/>cursor = conn.cursor()<br/></span><span id="44be" class="jr js hi kx b fi ml lc l ld le">def employee_data():</span><span id="3937" class="jr js hi kx b fi ml lc l ld le">    sql = "CREATE TABLE employees_data (first_name, dob, phone)"<br/>    cursor.execute(sql)</span><span id="a109" class="jr js hi kx b fi ml lc l ld le">    sql = "INSERT INTO employees_data VALUES (?, ?, ?)"<br/>    data = [('John', '10/30/1990', '+1234567890'),<br/>            ('Tim', '10/29/1992', '+1234567890'),<br/>            ('Van', '10/29/2001', '+1234567890'),<br/>            ]</span><span id="9e48" class="jr js hi kx b fi ml lc l ld le">    cursor.executemany(sql, data)<br/>    conn.commit()<br/></span><span id="f937" class="jr js hi kx b fi ml lc l ld le">def check_birthdays():<br/>    birthday_people = []</span><span id="0e7c" class="jr js hi kx b fi ml lc l ld le">    sql = "SELECT first_name, dob, phone from employees_data"<br/>    cursor.execute(sql)<br/>    birth_list = cursor.fetchall()</span><span id="10b2" class="jr js hi kx b fi ml lc l ld le">    day, month = strftime('%d %m', gmtime()).split(' ')</span><span id="e74d" class="jr js hi kx b fi ml lc l ld le">    for name, date_set, phone in birth_list:<br/>        dates = date_set.split('/')<br/>        if dates[0] == month and dates[1] == day:<br/>            birthday_people.append((name, phone))<br/><br/>    return set(birthday_people)</span><span id="7283" class="jr js hi kx b fi ml lc l ld le">def send_messages(people):</span><span id="645f" class="jr js hi kx b fi ml lc l ld le">    account_sid = 'AXXXXXXXXXXXXXXXXXXXXXXXXXX'<br/>    auth_token = "XXXXXXXXXXXXXXXXXXXXXXXXXXXXX"<br/>    client = Client(account_sid, auth_token)</span><span id="97fd" class="jr js hi kx b fi ml lc l ld le">    birthday_cover = "https://karaspartyideas.com/wp-content/uploads/2019/04/Chic-Pastel-Dino-Party-via-Karas-Party-Ideas-KarasPartyIdeas.com_.png"</span><span id="a49c" class="jr js hi kx b fi ml lc l ld le">    for name, phone in people:</span><span id="8686" class="jr js hi kx b fi ml lc l ld le">        msg = f"Happy birthday {name}."<br/>        msg += " We at good Company celebrate you!"</span><span id="a051" class="jr js hi kx b fi ml lc l ld le">        message = client.messages.create(<br/>            media_url=[birthday_cover],<br/>            from_="whatsapp:+14155238886",<br/>            body=msg,<br/>            to=f"whatsapp:{phone}"<br/>        )</span><span id="7357" class="jr js hi kx b fi ml lc l ld le">    return True<br/></span><span id="09fb" class="jr js hi kx b fi ml lc l ld le">def birthday_sys():<br/>    sql = "CREATE TABLE birthday_sys (last_wished)"<br/>    cursor.execute(sql)</span><span id="366c" class="jr js hi kx b fi ml lc l ld le">    sql = "INSERT INTO birthday_sys VALUES ('0 0')"<br/>    cursor.execute(sql)<br/>    conn.commit()</span><span id="90b4" class="jr js hi kx b fi ml lc l ld le">def main():<br/>    while True:<br/>        if not_wished_today():<br/>            birthday_people = check_birthdays()<br/>            if send_messages(birthday_people):<br/>                update_last_wished()</span><span id="6eb7" class="jr js hi kx b fi ml lc l ld le">        else:<br/>            sleep(3600)<br/></span><span id="525a" class="jr js hi kx b fi ml lc l ld le">birthday_sys()</span><span id="6905" class="jr js hi kx b fi ml lc l ld le">conn.close()</span></pre><p id="18d4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从python运行应用程序，这应该会得到<em class="lw">生日系统</em>表。</p><p id="5899" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在让我们编写<em class="lw"> not_wished_today </em>函数</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="f5a9" class="jr js hi kx b fi lb lc l ld le">def not_wished_today():<br/>    sql = "SELECT * FROM birthday_sys"<br/>    cursor.execute(sql)</span><span id="df7e" class="jr js hi kx b fi ml lc l ld le">    last_wished = cursor.fetchone()[0]<br/>    curr_time = strftime('%d %m', gmtime())</span><span id="eaab" class="jr js hi kx b fi ml lc l ld le">    if last_wished != curr_time:<br/>        return True<br/>    else:<br/>        return False</span></pre><p id="8049" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="lw">上面的代码从birthday_sys表中获取最后一个愿望，并用我们的当前日期进行验证，看看日期是否相同。如果他们不是，那么那天我们没有祝福任何人。</em></p><p id="5775" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，我们还要编写<em class="lw"> update_last_wished </em>函数</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="4355" class="jr js hi kx b fi lb lc l ld le">def update_last_wished():<br/>    curr_time = strftime('%d %m', gmtime())<br/>    sql = f"UPDATE birthday_sys SET last_wished='{curr_time}'"<br/>    cursor.execute(sql)<br/>    conn.commit()</span></pre><p id="fef8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="lw">上面的代码将更新last _ wished列来保存当前的日期和月份</em></p><p id="74f5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在一切都完成了。<strong class="io hj">在main.py中添加</strong>主函数调用</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="e35e" class="jr js hi kx b fi lb lc l ld le">main()</span></pre><p id="168b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，main.py文件最终应该是这样的，其中的<strong class="io hj"> XXX </strong>值发生了变化:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="b6f9" class="jr js hi kx b fi lb lc l ld le">from time import gmtime, strftime, sleep<br/>import sqlite3</span><span id="e2f1" class="jr js hi kx b fi ml lc l ld le">from twilio.rest import Client</span><span id="8868" class="jr js hi kx b fi ml lc l ld le">conn = sqlite3.connect("company_data.db")<br/>cursor = conn.cursor()<br/></span><span id="d373" class="jr js hi kx b fi ml lc l ld le">def employee_data():<br/>    sql = "CREATE TABLE employees_data (first_name, dob, phone)"<br/>    cursor.execute(sql)<br/>    sql = "INSERT INTO employees_data VALUES (?, ?, ?)"<br/>    data = [('John', '10/30/1990', '+1234567890'),<br/>            ('Tim', '10/29/1992', '+1234567890'),<br/>            ('Van', '10/29/2001', '+1234567890'),<br/>            ]<br/>    cursor.executemany(sql, data)<br/>    conn.commit()<br/></span><span id="5d14" class="jr js hi kx b fi ml lc l ld le">def check_birthdays():<br/>    birthday_people = []<br/>    sql = "SELECT first_name, dob, phone from employees_data"<br/>    cursor.execute(sql)<br/>    birth_list = cursor.fetchall()<br/>    day, month = strftime('%d %m', gmtime()).split(' ')<br/>    for name, date_set, phone in birth_list:<br/>        dates = date_set.split('/')<br/>        if dates[0] == month and dates[1] == day:<br/>            birthday_people.append((name, phone))</span><span id="2299" class="jr js hi kx b fi ml lc l ld le">    return set(birthday_people)<br/></span><span id="8f08" class="jr js hi kx b fi ml lc l ld le">def send_messages(people):<br/>    account_sid = 'AXXXXXXXXXXXXXXXXXXXXXXXXXX'<br/>    auth_token = "XXXXXXXXXXXXXXXXXXXXXXXXXXXXX"<br/>    client = Client(account_sid, auth_token)<br/>    birthday_cover = "https://karaspartyideas.com/wp-content/uploads/2019/04/Chic-Pastel-Dino-Party-via-Karas-Party-Ideas-KarasPartyIdeas.com_.png"<br/>    for name, phone in people:<br/>        msg = f"Happy birthday {name}."<br/>        msg += " We at good Company celebrate you!"</span><span id="87f2" class="jr js hi kx b fi ml lc l ld le">        message = client.messages.create(<br/>            media_url=[birthday_cover],<br/>            from_="whatsapp:+14155238886",<br/>            body=msg,<br/>            to=f"whatsapp:{phone}"<br/>        )<br/>    return True<br/></span><span id="f81a" class="jr js hi kx b fi ml lc l ld le">def birthday_sys():<br/>    sql = "CREATE TABLE birthday_sys (last_wished)"<br/>    cursor.execute(sql)<br/>    sql = "INSERT INTO birthday_sys VALUES ('0 0')"<br/>    cursor.execute(sql)<br/>    conn.commit()<br/></span><span id="f3d6" class="jr js hi kx b fi ml lc l ld le">def not_wished_today():<br/>    sql = "SELECT * FROM birthday_sys"<br/>    cursor.execute(sql)<br/>    last_wished = cursor.fetchone()[0]<br/>    curr_time = strftime('%d %m', gmtime())<br/>    if last_wished != curr_time:<br/>        return True<br/>    else:<br/>        return False<br/></span><span id="ed73" class="jr js hi kx b fi ml lc l ld le">def update_last_wished():<br/>    curr_time = strftime('%d %m', gmtime())<br/>    sql = f"UPDATE birthday_sys SET last_wished='{curr_time}'"<br/>    cursor.execute(sql)<br/>    conn.commit()</span><span id="7446" class="jr js hi kx b fi ml lc l ld le">def main():<br/>    while True:<br/>        if not_wished_today():<br/>            birthday_people = check_birthdays()<br/>            if send_messages(birthday_people):<br/>                update_last_wished()<br/>        else:<br/>            sleep(3600)</span><span id="7831" class="jr js hi kx b fi ml lc l ld le">main()<br/>conn.close()</span></pre><p id="7790" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请为此，我建议你打开一个单独的终端。导航到<em class="lw">生日消息应用</em>文件夹</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="5e92" class="jr js hi kx b fi lb lc l ld le">cd birthday_messages_app</span></pre><p id="bae0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后运行main.py</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="1410" class="jr js hi kx b fi lb lc l ld le">python main.py</span></pre><p id="c6af" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你应该首先看到一条消息，如果你让终端一直打开到第二天午夜12点，你应该会收到另一条消息(根据你的数据库)，只有到那时你才应该关闭终端，对吗？:)</p></div></div>    
</body>
</html>