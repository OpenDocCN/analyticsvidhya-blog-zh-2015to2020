<html>
<head>
<title>Deploying a machine learning model on the Web using Flask and Python.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Flask和Python在Web上部署机器学习模型。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploying-a-machine-learning-model-on-web-using-flask-and-python-54b86c44e14a?source=collection_archive---------3-----------------------#2019-12-02">https://medium.com/analytics-vidhya/deploying-a-machine-learning-model-on-web-using-flask-and-python-54b86c44e14a?source=collection_archive---------3-----------------------#2019-12-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bf04" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建一个机器学习模型并对现实世界的问题进行预测听起来很酷。但是，这对于除了模型创建者之外的任何人来说都不是很有用，因为它只在他们的机器上可用。</p><p id="65e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我们将讨论如何使用<a class="ae jd" href="http://flask.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Flask </strong> </a>(一个用Python构建网站和API的微框架)来构建我们的Web API</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/4c49d48c9aebd31d1a7d6629f77bc769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*O0S2-UBv_Y1RRgHgRkg1yQ.png"/></div></figure><p id="6c94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们通过用Python 构建一个简单的<strong class="ih hj">线性回归模型来开始这个过程</strong></p><p id="c886" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第一步</strong>。使用Scikit Learn导入构建线性回归模型所需的所有必要库</p><p id="6fb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我使用homeprices.csv文件来训练我们的模型，该模型有两个特征，面积和房价。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jm"><img src="../Images/df8d8e6733ff53222355ecc5704c93f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:286/format:webp/1*Kvr9usx76qSbBanEtfArvA.png"/></div></figure><p id="8944" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第二步</strong>。使用pandas读取数据并定义我们的训练变量</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jn jo l"/></div></figure><p id="ff47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第三步</strong>。训练我们的模型</p><p id="1db6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第四步</strong>。计算分数和系数，并对面积变量的某个值进行预测。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jn jo l"/></div></figure><p id="bf56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们简单的线性回归模型已经准备好了，让我们转向模型持久化，并将上面的内容保存为<strong class="ih hj">。pkl文件</strong></p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jn jo l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jp"><img src="../Images/32faef6253cd60d4e53eebd95de4b7b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*lyxhm9CNDAUDk15tqsiifw.png"/></div></figure><p id="e6e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们的模型被保存了，并且可以通过在任何时候再次加载相同的模型而被重用。</p><p id="dd91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们使用Flask构建一个Web API，并理解以简单的方式实现它的过程。</p><h1 id="a208" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">对Flask的简单介绍</h1><p id="f1eb" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">如果您下载了Anaconda发行版，那么您已经安装了Flask，否则，您将不得不用— <code class="du kt ku kv kw b">pip install flask</code>自己安装它。</p><p id="e535" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Flask是非常小的，因为你只在需要的时候把零件带进来。为了演示这一点，下面是创建一个非常简单的web服务器的Flask代码。</p><pre class="jf jg jh ji fd kx kw ky kz aw la bi"><span id="f18d" class="lb jr hi kw b fi lc ld l le lf">from flask import Flask</span><span id="9636" class="lb jr hi kw b fi lg ld l le lf">app = Flask(__name__)<br/></span><span id="f479" class="lb jr hi kw b fi lg ld l le lf">@app.route("/")<br/>def hello():<br/>    return "Hello World!"<br/></span><span id="5925" class="lb jr hi kw b fi lg ld l le lf">if __name__ == '__main__':<br/>    app.run(debug=True)</span></pre><p id="05b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦执行，您就可以导航到显示在终端上的网址，并观察预期的结果。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lh"><img src="../Images/d73138fd6cf2526cbc7f49f55b4458b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/format:webp/0*4BEMPFOr3sU2DWVj.png"/></div></figure><p id="8e76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们回顾一下执行的代码在做什么。</p><p id="8c24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导入后，我们创建Flask类的一个实例，并传入Python为我们填充的<code class="du kt ku kv kw b"><a class="ae jd" href="https://docs.python.org/3/library/__main__.html" rel="noopener ugc nofollow" target="_blank">__name__</a></code>变量。如果这个文件作为脚本直接通过Python运行，这个变量将是<code class="du kt ku kv kw b">"__main__"</code>。如果我们导入文件，<code class="du kt ku kv kw b">__name__</code>的值将是我们导入的文件的名称。例如，如果我们有<code class="du kt ku kv kw b">test.py</code>和<code class="du kt ku kv kw b">run.py</code>，并且我们将<code class="du kt ku kv kw b">test.py</code>导入到<code class="du kt ku kv kw b">run.py</code>中，<code class="du kt ku kv kw b">test.py</code>的<code class="du kt ku kv kw b">__name__</code>值将是<code class="du kt ku kv kw b">test</code>。</p><p id="3477" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的<code class="du kt ku kv kw b">hello</code>方法定义之上，是<code class="du kt ku kv kw b">@app.route("/")</code>行。<code class="du kt ku kv kw b">@</code>表示一个<a class="ae jd" href="https://jeffknupp.com/blog/2013/11/29/improve-your-python-decorators-explained/" rel="noopener ugc nofollow" target="_blank">装饰器</a>，它允许它前面的函数、属性或类被动态改变。</p><p id="5642" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kt ku kv kw b">hello</code>方法是我们放置代码的地方，每当我们的应用程序或API的路由遇到顶级路由:<code class="du kt ku kv kw b">/</code>。</p><p id="651b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们的<code class="du kt ku kv kw b">__name__</code>变量是<code class="du kt ku kv kw b">__main__,</code>,表明我们直接运行文件而不是导入它，那么它将启动Flask应用程序，它将运行并等待web请求，直到过程结束。</p><h1 id="86ec" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">创建API</h1><h2 id="ff99" class="lb jr hi bd js li lj lk jw ll lm ln ka iq lo lp ke iu lq lr ki iy ls lt km lu bi translated">预测API</h2><p id="2d13" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">预测API非常简单。我们给它我们的数据，房子的面积，并把它传递给我们模型的<code class="du kt ku kv kw b">predict</code>方法。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jn jo l"/></div></figure><p id="4297" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里发生了不少事情，我们来分解一下。</p><p id="c545" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">类似于上面介绍Flask的代码，我们称之为<code class="du kt ku kv kw b">@app.route</code>装饰器。</p><blockquote class="lv lw lx"><p id="16e4" class="if ig ly ih b ii ij ik il im in io ip lz ir is it ma iv iw ix mb iz ja jb jc hb bi translated">在我们的路由方法定义中，我们将请求方法限制为GET/POST，如果是这样，我们<a class="ae jd" href="http://flask.pocoo.org/docs/0.12/api/#flask.Request.get_json" rel="noopener ugc nofollow" target="_blank">获取请求体</a>的JSON，这样我们就可以访问它的数据。有了这个变量，我们就可以访问我们想要的数据的键— <code class="du kt ku kv kw b">area</code>并把它解析成一个浮点数。我们还将模型从持久文件加载到内存中。</p></blockquote><p id="937d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果解析数据没有错误，那么我们将解析后的变量传递给线性回归模型的<code class="du kt ku kv kw b">predict</code>方法；当我们在启动时加载Flask应用程序时，该变量被拉入内存。接下来，我们必须将<code class="du kt ku kv kw b">predict</code>方法的输出改为一个列表，因为没有它，我们会得到一个错误:<code class="du kt ku kv kw b">Object of type 'ndarray' is not JSON serializable</code>。然后我们调用Flask的<code class="du kt ku kv kw b">[jsonify](<a class="ae jd" href="http://flask.pocoo.org/docs/0.12/api/#flask.json.jsonify" rel="noopener ugc nofollow" target="_blank">http://flask.pocoo.org/docs/0.12/api/#flask.json.jsonify</a>)</code>方法以JSON的形式发送响应数据。</p><blockquote class="lv lw lx"><p id="ce94" class="if ig ly ih b ii ij ik il im in io ip lz ir is it ma iv iw ix mb iz ja jb jc hb bi translated">现在我们可以运行我们的API了(在PyCharm中，您只需右键单击脚本中的任意位置，然后单击“run”)。随着API的运行，我们可以执行代码来调用它。</p></blockquote><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jn jo l"/></div></figure><p id="7cb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们可以在终端上看到输出。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mc"><img src="../Images/d15e36488609aeb82a14c2d6b5a1c61e.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*Jf4-8iGaqYO0jUAjoNqEsw.png"/></div></figure><p id="9c2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ly">在这篇文章中，我们学习了Flask是什么，如何使用它来创建API，最重要的是如何应用这些知识来创建与机器学习模型交互的API。</em> </strong></p><p id="b180" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望你觉得这个教程有用，谢谢你读到这里。我很好奇你是怎么想的，所以给我一些建议吧。你也可以通过<a class="ae jd" href="mailto:soumyansh@gmail.com" rel="noopener ugc nofollow" target="_blank">邮箱</a>直接和我联系。</p></div></div>    
</body>
</html>