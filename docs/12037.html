<html>
<head>
<title>7 simple steps for scraping and extracting S&amp;P 500 index data from Yahoo Finance API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从雅虎财经API中抓取和提取标准普尔500指数数据的7个简单步骤</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/scraping-s-p-500-index-and-extracting-stock-market-data-from-yahoo-finance-api-72218eeed1be?source=collection_archive---------8-----------------------#2020-12-29">https://medium.com/analytics-vidhya/scraping-s-p-500-index-and-extracting-stock-market-data-from-yahoo-finance-api-72218eeed1be?source=collection_archive---------8-----------------------#2020-12-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/76f4b49dee707ad81437c0c564748680.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CdYZOj6SLoenMSyuuSHLtw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">由Freepik设计的</figcaption></figure><h1 id="eee2" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">概观</h1><p id="8c2b" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">股票交易是世界上最复杂的过程之一。人们越来越努力地学习股票交易系统，希望能预测股票价格的走势。</p><p id="3831" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">如果能够获得股票价格的历史数据，就可以更好地预测股票价格。这可以通过两种方式实现:通过数据服务提供商或通过简单的web抓取器。我们可以刮给我们这项工作的股票价格数据的网站。股票数据可以在很多网站上找到，包括最受欢迎的网站之一雅虎财经。</p><p id="f6da" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">在本文中，我们将重点关注通过抓取维基百科从标准普尔500获取公司列表，然后从雅虎提取股票相关数据。我们将一步一步地展示网页抓取的实现，这样你就能很容易地掌握它。</p><h1 id="79c0" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">目标</h1><ol class=""><li id="e9dd" class="kv kw hi ju b jv jw jz ka kd kx kh ky kl kz kp la lb lc ld bi translated">通过抓取维基百科获得标准普尔500的公司名单</li><li id="1f64" class="kv kw hi ju b jv le jz lf kd lg kh lh kl li kp la lb lc ld bi translated">从雅虎提取标准普尔500公司的股票相关数据</li></ol><h1 id="649d" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">规范</h1><p id="1d2e" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">标准普尔500由代表所有经济部门的500家公司组成。该指数仅涵盖在美国市场上市的大型公司，包括纽约证券交易所或纳斯达克。因为标准普尔500代表了美国最大的上市公司，它被认为是最广泛引用的股票市场指数之一。标准普尔500的这些公司占美国所有股票的四分之三。</p><h1 id="ecd7" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">里程碑</h1><blockquote class="lj lk ll"><p id="8b94" class="js jt lm ju b jv kq jx jy jz kr kb kc ln ks kf kg lo kt kj kk lp ku kn ko kp hb bi translated"><strong class="ju hj">网页抓取</strong></p></blockquote><p id="17d0" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">首先，我们需要导入所需的库。我们用漂亮的汤擦掉了维基百科上包含公司代码或符号的表格。我们使用请求从维基百科中检索源代码，然后事后使用Pickle保存。</p><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="8377" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">在提取列表之前，我们需要看一下源代码。你可以在你的浏览器中右击某处，选择<em class="lm"> inspect element ( </em>按<em class="lm">F12</em>on<em class="lm"/>Windows<em class="lm">)</em>。可以在<em class="lm"> &lt;表格&gt; </em>标签下查看<em class="lm"> html </em>编码。</p><p id="f4f9" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">然后，它被转换成一个BeautifulSoup对象，可以像Python对象一样进行操作。更具体地说，该脚本发出一个<em class="lm"> http </em>请求，然后用漂亮的Soup解析Wiki页面。Beautiful Soup允许我们以类似解析树的格式从HTML中提取数据。</p><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="b255" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">接下来，我们遍历整个表。美汤中的<em class="lm"> Findall </em>方法将从<em class="lm"> html </em>表中提取文本。表格的每一行都由<em class="lm"> html </em>代码中的<em class="lm"> &lt; tr &gt; </em>标签表示。<em class="lm"> </em>需要从表格中删除的标题行(即<em class="lm">【1:】</em>)。我们创建一个空列表，并在其中添加代码。每行包括ticker，即表数据<em class="lm"> &lt; td &gt;。</em>注意，在从维基百科提取数据的过程中，它会在每个字符串的末尾生成“<em class="lm"> \n </em>”。因此，在将其纳入清单之前，应将其删除。</p><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="0f9b" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">在这个阶段，我们可以使用Pickle保存列表。或者，我们可以将其转换为数据帧，但我们使用前者。</p><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure><blockquote class="lj lk ll"><p id="d564" class="js jt lm ju b jv kq jx jy jz kr kb kc ln ks kf kg lo kt kj kk lp ku kn ko kp hb bi translated"><strong class="ju hj">获取股票价格数据</strong></p></blockquote><p id="6a92" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">在这一节中，我们将获得我们在上一节中收集的标准普尔500公司的财务信息。我们将在Pandas的帮助下使用雅虎财经数据，Pandas是最好的Python包之一。</p><p id="52dc" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">我们增加了几个库，包括指定日期的<em class="lm"> datatime </em>，创建和检查目录的<em class="lm"> os </em>。</p><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="6991" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">我们需要访问之前保存的Pickle文件。然后，我会将每只股票的信息存储在单独的目录中。它是可选的，你可以将500家公司的所有数据保存在一个文件中，也可以将数据分割成单独的文件。</p><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="7016" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">这和之前的过程是一样的，所以我们遍历股票代码列表并获取雅虎数据。偶尔，维基百科可能会使用不同的代码来代表同一家公司，如伯克希尔哈撒韦公司(BRK-B)，然而，在雅虎的缩写似乎是“BRK”。b "所以我们需要在遇到任何错误之前替换这些特殊字符。</p><figure class="lq lr ls lt fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="81bb" class="pw-post-body-paragraph js jt hi ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp hb bi translated">我们需要的所有信息都唾手可得，所以是时候开动脑筋，开始对股票数据进行一些有用而令人兴奋的分析了。</p></div></div>    
</body>
</html>