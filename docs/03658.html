<html>
<head>
<title>Minimizing menu selection costs with Integer Programming (and PuLP)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用整数规划(和纸浆)最小化菜单选择成本</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/minimizing-tata-sky-bills-with-integer-programming-and-pulp-be3a95877c58?source=collection_archive---------19-----------------------#2020-02-12">https://medium.com/analytics-vidhya/minimizing-tata-sky-bills-with-integer-programming-and-pulp-be3a95877c58?source=collection_archive---------19-----------------------#2020-02-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/e5cbde60701e54952d33a45bc5616945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*53Yg2qsAcFyjDGQr.jpg"/></div></div></figure><div class=""/><p id="04f3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">(以及重新构建问题如何导致简单的解决方案)</em></p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="f9d0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">塔塔天空是一家印度电视网络提供商，像所有此类提供商一样，它提供了一系列错综复杂的独立和捆绑频道供用户选择。鉴于我很少使用，我一直想尽量减少我在他们服务上的巨额支出，但实际上浏览他们的目录并计算我是否会更好地使用一个包，或者一个独立的频道，或者两者的某种复杂组合，是一项相当艰巨的任务，我一直推迟到我意识到这是一个我可以用整数编程解决的问题。</p><p id="35e6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我想出了一个方法之后，让我着迷的是，一旦这个问题以一种稍微不同的方式被框定，它会变得多么微不足道。这种重构，而不仅仅是解决方案的技术细节，是我写这篇文章的动机。</p><h1 id="2e18" class="jw jx ht bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">问题是</h1><p id="c243" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hb bi translated">Tata Sky提供超过300个付费频道(和275个免费频道),以及大约170个包，由大约54个频道的中间值组成，一些大的包数以百计。我们的目标是选择独立频道和软件包的组合，为用户提供所需的所有<em class="jo">SaaS-胡巴系列</em>，同时将支出降至最低。要找到这项任务的最佳组合，需要搜索包和独立通道的整个空间，这是一项相当艰巨的手动任务，这就需要整数编程。</p><h1 id="2935" class="jw jx ht bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">线性和整数规划</h1><p id="b130" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hb bi translated">一般的线性规划问题可以表示为:</p><figure class="la lb lc ld fd hk er es paragraph-image"><div class="er es kz"><img src="../Images/b6feb6b2a22ae6c371fcba2da2ffc2b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*t9v6D_XpXTbdUyUd0NwUjA.png"/></div></figure><p id="fae2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们本质上是在给定一组线性约束和实值决策变量的情况下，试图最小化一个线性函数。经济、商业、车辆路线、调度中的许多问题都可以作为线性规划(LP)来建模和求解。</p><p id="2471" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，我们要使用的是LP的一个变体，其中决策变量被进一步限制为整数，在我们的例子中，只是二进制的。一个常见的问题是背包问题。</p><figure class="la lb lc ld fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es le"><img src="../Images/ac397e3284b9c62b59417c500e52dde2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KnYoqMkAPHpVHPk8.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">基本背包问题(<a class="ae lj" href="https://www.codesdope.com/course/algorithms-knapsack-problem/" rel="noopener ugc nofollow" target="_blank">环节</a>)</figcaption></figure><p id="94c8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">简单地说，这里的目标是最大化包中物品的价值，同时满足其携带限制。然而，我们正在解决的是这个问题的逆问题:我们试图在保留观看所选频道的能力的同时最小化成本。</p><p id="b716" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从计算角度来看，这并不是一个简单的解决方案。虽然大多数线性程序在多项式时间内是可解的，但是对于整数程序却没有这样的保证，在最坏的情况下，整数程序具有指数复杂性。如果我们选择50个我们希望能够观看的频道，并且我们知道有100个包装至少具有这些频道中的一个，那么我们有2个⁵⁰组合来搜索！</p><figure class="la lb lc ld fd hk er es paragraph-image"><div class="er es lk"><img src="../Images/25a3e44baa08f4e57f7ab4a95d34af29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/1*gq4gaDEUfRSOWDrNSigwlg.gif"/></div><figcaption class="lf lg et er es lh li bd b be z dx translated">一个线性规划可以在灰色区域取任何值，而一个IP解决方案只能是其中一个蓝点。</figcaption></figure><p id="69eb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了实现这一点，我将使用PuLP，这是一个用于线性优化问题的Python建模库。</p><p id="f480" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不过，先说数据。</p><h1 id="a118" class="jw jx ht bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">数据，数据，数据…</h1><p id="15cc" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hb bi translated">正如人们常说的，ML的困难部分——尽管这并不是真正的ML——是数据，而且创建这个解决方案的大部分时间都花在了ETL上。由于Tata Sky没有通过提供现成的开源数据集来让我轻松做到这一点，所以第一步是找到一种方法来构建它。</p><p id="e613" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里最直接的解决方案是从他们的网站上抓取数据，但由于我不确定这背后的合法性，我决定谨慎行事。幸运的是，我在网上找到了一些pdf文件，它们带有格式相对较好的表格中的频道和包。因为，pdf是基于文本的。我可以通过点击和拖动从文档中选择文本，我可以使用Python的Camelot库从文本中提取数据。</p><p id="cf72" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从几乎完全由单个频道表组成的pdf中提取单个频道信息相对简单。</p><figure class="la lb lc ld fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ll"><img src="../Images/0f82a41bea1c30f2ab6e5bf99bcc0ea3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B1JXTdxQSAM9W8v6oNkB-g.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">是的，从第4个到第578个被执行的单元格——这是一个笔记本的组装！</figcaption></figure><p id="a035" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，这些包明显更难，有很多错误和不一致，并且在验证方面需要更多的东西。</p><figure class="la lb lc ld fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lm"><img src="../Images/b842ba09eb40dc5a8994ca23f555ef6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ez8QKBcnoAIa9Dy16NlvuQ.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">没错，是组装的，但弄清楚还是挺有趣的。</figcaption></figure><p id="c9f5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个漫长的数据步骤的最终结果是一个表，其中包含所有588个不同的频道、它们的独立价格以及它们所属的所有包的列表。</p><figure class="la lb lc ld fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ln"><img src="../Images/e62e6978888d7c7a39b85a178b724215.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rjZ7z_zEurP6OYEMMlD7Ew.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">目前，流行栏只是一个频道所属的所有包的简单计数，不可否认，这不是一个频道流行度的良好估计。</figcaption></figure><p id="7faf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，这导致了建模。</p><h1 id="052a" class="jw jx ht bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">解决方案</h1><p id="998f" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hb bi translated">我对这个问题的最初框架有一个相当基本的缺口:我无法找出一种方法在通用IP框架内链接包和通道。在背包问题及其逆问题中，每个项目本质上是一个单一的事物，可以用{0，1}决策变量排除或包含在最优解中。但是，在这里，我们有两层项目:</p><ul class=""><li id="5abd" class="lo lp ht is b it iu ix iy jb lq jf lr jj ls jn lt lu lv lw bi translated">单数项目，即。独立频道。</li><li id="1d53" class="lo lp ht is b it lx ix ly jb lz jf ma jj mb jn lt lu lv lw bi translated">由大量独立频道组成的包。</li></ul><p id="c008" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">包含一个包——比如说英语新闻——意味着包含大量的频道。最初，我设想了类似于每个包的查找表的东西，试图将这些关系编码到问题中，但这不适合LP框架，并且肯定不能由标准求解器解决。</p><p id="48d4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，最终，我意识到只需要稍微调整一下约束。我可以使用约束来间接地创建通道和包之间的某种连接，而不是直接创建。</p><p id="8eea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我举个例子来说明这一点。</p><p id="70cf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设，我们选择5个通道。</p><figure class="la lb lc ld fd hk er es paragraph-image"><div class="er es mc"><img src="../Images/de08033b061c11e948be8273bec80879.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*-T2wIhINtLHZcsPMInTP4w.png"/></div></figure><p id="f283" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">生成的最小化函数由5个通道本身和33个包含至少1个通道的独特包组成。频道和套餐被编码为布尔决策变量(c和x ),并乘以各自的价格。</p><figure class="la lb lc ld fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es md"><img src="../Images/74502216e68b072c01829830f96af287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u1TyTjqjdbyBCjMKSBNtKg.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">5个频道，33包。</figcaption></figure><p id="b738" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">除此之外，我们还有5个约束，分别针对5个选定的通道。每个约束由一个通道变量和包含该通道的所有包组成。例如，HBO HD的约束包含16个决策变量— 1个用于频道，15个用于包含HBO HD的所有不同包装。</p><figure class="la lb lc ld fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es me"><img src="../Images/8806f3a01e6f22f2563a27373c77f5cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9z-PPb0AQfx-ia2pUm5bng.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">纸浆对HBO HD产生的约束</figcaption></figure><p id="7671" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这编码的意思是，既然我们想要HBO HD，我们需要为频道本身付费，或者至少为包含它的一个包付费。这是一个不平等的约束，因为只要总支出最小化，我们就不在乎订阅任何特定频道多少次，只要我们至少订阅一次。</p><p id="6b9a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这巧妙地解决了我们在链接包和通道时遇到的问题。通过在约束函数中为通道指定包，我们不需要在它们之间显式地链接，因为包的选择显式地满足了它所包含的通道的约束。</p><p id="0427" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">仅此而已。</p><p id="7bda" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这种近乎退化的情况下，最佳解决方案是选择每个单独的通道。</p><figure class="la lb lc ld fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mf"><img src="../Images/6d7d2f7677442df5e7c02a3aba32265e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y0i3nOsiswLMTgpDrafgpA.png"/></div></div></figure><p id="7427" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，如果有更多的频道选择，我们可以得到更有趣的建议。有了大约100多个随机选择的频道，我们得到了这个，这肯定比选择更大的包装便宜得多——这可能花费高达1000英镑——或者只是单独购买频道，这花费超过500英镑。</p><figure class="la lb lc ld fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mg"><img src="../Images/0a4abfe699166e0ecff322b55f927c90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2RvLbM567AxnozkIUi_62g.png"/></div></div></figure><h1 id="cc1c" class="jw jx ht bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">结论和代码</h1><p id="d2ae" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hb bi translated">整数编程代码可以在我的<a class="ae lj" href="https://github.com/AbhishekKaps/Integer-Programing-with-PuLP" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中找到，还有通道和包的数据。</p><p id="7766" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">纸浆文档是介绍这一领域的极好资源，可以在<a class="ae lj" href="https://pythonhosted.org/PuLP/main/optimisation_concepts.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="cf65" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我的下一步是想出一个方法来保持包装和渠道信息的更新。此外，我在最初的解决方案中忽略了一些复杂性，例如多电视支持的成本等，我计划将它们也加入进来。最后，通过我的(第一个)网络应用程序来部署它。</p></div></div>    
</body>
</html>