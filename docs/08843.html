<html>
<head>
<title>Automated Reporting with Python (Part 1): Generating Pivot tables and Charts and saving to HTML</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 自动生成报告(第 1 部分):生成数据透视表和图表并保存到 HTML</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/automated-reporting-with-python-part-1-generating-pivot-tables-and-charts-and-saving-to-html-ecd6590cd1b1?source=collection_archive---------0-----------------------#2020-08-16">https://medium.com/analytics-vidhya/automated-reporting-with-python-part-1-generating-pivot-tables-and-charts-and-saving-to-html-ecd6590cd1b1?source=collection_archive---------0-----------------------#2020-08-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c961ed2034a004e42c47a54cc64f101b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xTJtSQEGM4gkapqbeMRhAA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">在<a class="ae iu" href="https://unsplash.com/s/photos/data?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae iu" href="https://unsplash.com/@adeolueletu?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Adeolu Eletu </a>拍摄的照片</figcaption></figure><p id="596a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你做过 Excel 吗？它是创建和生成报告的强大工具。但是，如果您的任务非常耗时且重复，或者数据集太大，excel 无法处理(比如 100，000 行 x 50 列)，该怎么办呢？你可以使用 VB 脚本，但是这也很难，而且容易出错。</p><p id="5866" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Python 是编写脚本和编程的绝佳语言，有 Pandas 这样的大数据友好库，Matplotlib 和 Seaborn 这样的可视化库。</p><p id="1b1e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本教程由两部分组成，这将是第一部分，包括在 pandas 中创建数据帧和用 MatplotLib 可视化，然后我将进一步把数据保存为 HTML。</p><p id="c214" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在下一部分，我将展示如何将 HTML 转换成 PDF，并通过 Gmail API 在电子邮件中共享数据</p><p id="c6e2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我带了 kaggle.com 的安置日期，<a class="ae iu" href="https://www.kaggle.com/benroshan/factors-affecting-campus-placement" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/Ben roshan/factors-affecting-campus-Placement</a></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jt"><img src="../Images/6e6c246914a1fc6a7434043efc637306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n9cYR84vDra-tEPDu6UMIA.png"/></div></div></figure><p id="c5b8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">写代码</strong>(我用的是 Jupyter 笔记本，用 Pandas 和 matplotlib 都很流畅)</p><p id="bf23" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">导入库和读取文件</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="0426" class="kd ke hi jz b fi kf kg l kh ki">import pandas as pd<br/>import numpy as np</span><span id="ceb8" class="kd ke hi jz b fi kj kg l kh ki">data = pd.read_csv(‘Placement_Data_Full_Class.csv’)<br/>data.head(5)</span></pre><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kk"><img src="../Images/6f1028d116557abb7ee1723b80223c9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FJEFq_nF_TNoePeIV1-5BA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">data.head()显示数据的顶部行</figcaption></figure><p id="0888" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">透视数据(检查后) :根据需要检查要包含在数据透视表中的行和列</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="95b5" class="kd ke hi jz b fi kf kg l kh ki">pivot=pd.pivot_table(<br/>                     data,<br/>                     values=’sl_no’,<br/>                     index=[‘degree_t’,’specialisation’],<br/>                     columns=[‘status’,’gender’],aggfunc=np.sum<br/>                     )</span><span id="a550" class="kd ke hi jz b fi kj kg l kh ki">pivot=pivot.fillna(0).astype(np.int64)</span><span id="fd05" class="kd ke hi jz b fi kj kg l kh ki">pivot</span></pre><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kl"><img src="../Images/74ef931493362fc80f694831defcdfad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*6bapEfEWxcrWjDFrjasrig.png"/></div></figure><p id="941b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">或者您可以更改语法以获得简单性。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="9fb2" class="kd ke hi jz b fi kf kg l kh ki">pivot=data.pivot_table(index=[‘degree_t’,’specialisation’],<br/> columns=[‘status’,’gender’],<br/> values=’sl_no’,aggfunc=np.sum).fillna(0)</span><span id="1ecd" class="kd ke hi jz b fi kj kg l kh ki">pivot</span></pre><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es km"><img src="../Images/e38edfa9fc49ce6609eb6f1b597f0eb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*5FvbZ4-xJxRq9tpE5Y3Zag.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">函数的作用是:用需要的值替换 na 值</figcaption></figure><p id="ef50" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">列名看起来是不是有点奇怪？让我们用更易读的东西来改变它们。可读字段总是有利于表示。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="809f" class="kd ke hi jz b fi kf kg l kh ki">new_columns = [<br/>                'Unplaced_Females',<br/>                'Placed_Females',<br/>                'Unplaced_Males',<br/>                'Placed_Males'<br/>                ]</span><span id="0ad7" class="kd ke hi jz b fi kj kg l kh ki">pivot.columns = new_columns</span></pre><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kn"><img src="../Images/eb5d6d01981282308624d40d9c46f251.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*IsjOtb5D9_jTsW8pVpPTNA.png"/></div></figure><p id="0d95" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">绘制数据:</strong>我们将为数据绘制一个<strong class="ix hj">条形图</strong>以便更好地可视化，因为条形图似乎适合此处，您也可以尝试不同的图。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="83cf" class="kd ke hi jz b fi kf kg l kh ki">plot = pivot.plot(kind=’bar’,figsize=(12,6))<br/>plot.tick_params(rotation=40)<br/>plot</span></pre><p id="7f02" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> Kind </strong>是选择图表类型的关键字参数，可以使用 kind="line "进行折线图绘制，使用<strong class="ix hj"> figsize </strong>可以改变绘图的大小。</p><p id="4f1b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> tick_params() </strong>用于修改标签的参数。这里我们将标签倾斜以便于阅读。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/00a8b063d6f358c7a95e3e9aa5221d43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2sYupOjHgGxTw2UnBVuuRQ.png"/></div></div></figure><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="cd11" class="kd ke hi jz b fi kf kg l kh ki"><strong class="jz hj">#Converting to HTML</strong></span><span id="1129" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj"># saving plot image to local file</strong><br/>image = plot.get_figure().savefig('plot.png')<br/>image_tag = '&lt;img src="plot.png"&gt;'</span><span id="ce84" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj">#writing HTML Content</strong><br/>heading = '&lt;h1&gt; Automated Report Tutorial by Abhinav Sharma&lt;/h1&gt;'<br/>subheading = '&lt;h3&gt; Sample Report for Placement &lt;/h3&gt;'</span><span id="d055" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj"># Using .now() from datetime library to add Time stamp</strong><br/>now = datetime.now()<br/>current_time = now.strftime("%m/%d/%Y %H:%M:%S")<br/>header = '&lt;div class="top"&gt;' + heading + subheading +'&lt;/div&gt;'<br/>footer = '&lt;div class="bottom"&gt; &lt;h3&gt; This Report has been Generated\n<br/>          on '+ current_time +'&lt;/h3&gt; &lt;/div&gt;'</span><span id="ba29" class="kd ke hi jz b fi kj kg l kh ki">content = '&lt;div class="table"&gt; '+pivot.to_html()+' &lt;/div&gt; \n<br/>          &lt;div class="chart"&gt; '+ image_tag +'&lt;/div&gt;'</span><span id="6ef2" class="kd ke hi jz b fi kj kg l kh ki"><strong class="jz hj"># Concating everything to a single string</strong><br/>html = header + content + footer<br/></span></pre><p id="b0e3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">写完标签后，我们需要在 HTML 文件中写下所有内容。如果我们对 div 有把握，我们可以事先在 HTML 文件中添加 CSS，或者我们也可以使用 Jinja 在 sode HTML 中传递数据，这里我已经写了一个完整的 HTML，只需很少的努力就可以用 2 行 CSS 来设置样式。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="55c6" class="kd ke hi jz b fi kf kg l kh ki"><strong class="jz hj"># Writing the file</strong><br/>with open(‘report.html’,’w+’) as file:<br/> file.write(html)</span></pre><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kp"><img src="../Images/196440f7b2aa7ff08069445d0a25db35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*sAFb3d8va9vNs_Hv5kVKnw.png"/></div></figure><p id="9abc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在下一部分中，我将展示如何用<strong class="ix hj">样式化这个 HTML </strong>，<strong class="ix hj">将其转换成 PDF </strong>，并使用<strong class="ix hj"> Gmail API </strong>将报告发送给多个收件人。</p><p id="ccf8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">链接到下一部分</strong> → <a class="ae iu" rel="noopener" href="/@abhinavsharma150/automated-reporting-with-python-part-2-converting-an-html-file-to-pdf-and-sending-automated-2fb85eec89e9">使用 Python 自动报告，第 2 部分</a></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kq"><img src="../Images/467ca46fdf9fe8e2d77d837edeaaf3f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*mKpQge4TWO1cbAVSJdEs0g.jpeg"/></div></figure><p id="ecd6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">非常感谢</p><p id="76e8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">祝你有美好的一天！！</p><p id="6aa6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">更多来自作者:</strong></p><ol class=""><li id="ae8f" class="kr ks hi ix b iy iz jc jd jg kt jk ku jo kv js kw kx ky kz bi translated"><a class="ae iu" href="https://abhinavsharma150.medium.com/the-big-data-technology-what-why-where-and-how-fdeac3dc1c7b" rel="noopener">大数据技术</a></li><li id="eb63" class="kr ks hi ix b iy la jc lb jg lc jk ld jo le js kw kx ky kz bi translated">自动电报机器人</li><li id="da9a" class="kr ks hi ix b iy la jc lb jg lc jk ld jo le js kw kx ky kz bi translated"><a class="ae iu" rel="noopener" href="/@abhinavsharma150/didnt-understand-heap-lets-implement-and-know-eeb80395198">堆数据结构</a></li></ol></div></div>    
</body>
</html>