<html>
<head>
<title>Bubble Chart in D3js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">D3js 中的气泡图</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/bubble-chart-d3js-c1dfc01bae86?source=collection_archive---------9-----------------------#2020-09-01">https://medium.com/analytics-vidhya/bubble-chart-d3js-c1dfc01bae86?source=collection_archive---------9-----------------------#2020-09-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4e05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用 d3 v6 理解图表</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/0c4b05a0fb2d3f42495f3e3e7f575aaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/0*0XnVU5NNCHJUQ7KX.jpg"/></div></figure><p id="6624" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">D3js 有时是人类可读的，但是在某些情况下，你会看到一个你想要创建的图表，或者只是从其他地方复制</p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><p id="cafd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本帖中，我们将看到一个基本气泡图的教程，可能会对你有所帮助。老实说，这也是我自己的教程。在过去的几年里，我做了十张泡泡图，每次都是从零开始。</p><h2 id="bdc9" class="js jt hi bd ju jv jw jx jy jz ka kb kc iq kd ke kf iu kg kh ki iy kj kk kl km bi translated">介绍</h2><p id="2f76" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">第一个问题，什么是气泡图…</p><blockquote class="ks"><p id="90f3" class="kt ku hi bd kv kw kx ky kz la lb jc dx translated"><em class="lc">具有可变点尺寸的散点图</em></p></blockquote><p id="0997" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">来自<a class="ae li" href="https://www.data-to-viz.com/" rel="noopener ugc nofollow" target="_blank">https://www.data-to-viz.com/</a>,这是一个令人惊奇的、奇妙的、令人敬畏的资源，如果你是从 DataViz 开始的话，你应该看一看</p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><p id="32f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">气泡图是什么样子的</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lj"><img src="../Images/38c754009d8cac7e792a97c8ab31836e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*iOMMQVmyhuE-DsFsh2Iz_A.png"/></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">来自维基百科，一个气泡图显示了三个变量之间的关系。</figcaption></figure><h2 id="baa8" class="js jt hi bd ju jv jw jx jy jz ka kb kc iq kd ke kf iu kg kh ki iy kj kk kl km bi translated">版本 6</h2><p id="f4b5" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">为什么是 6？</p><p id="d664" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此时是 d3 的最新稳定版本。对我来说，它更紧凑，你有更多的功能在它的核心，更容易加载它的模块…</p><p id="34b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我还是给你留了在不同环境下安装的链接</p><p id="374e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae li" href="https://github.com/d3/d3#installing" rel="noopener ugc nofollow" target="_blank">https://github.com/d3/d3#installing</a></p><p id="f672" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，我喜欢 npm，所以如果你和我一样…</p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="d511" class="js jt hi lp b fi lt lu l lv lw">$ npm i d3</span></pre><p id="20ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，在你加载你的 js</p><p id="7f45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lx ly lz lp b">index.js</code></p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="a7f0" class="js jt hi lp b fi lt lu l lv lw">import * as d3 from "d3";</span></pre><h2 id="e642" class="js jt hi bd ju jv jw jx jy jz ka kb kc iq kd ke kf iu kg kh ki iy kj kk kl km bi translated">资料组</h2><p id="783b" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">我们将创建类似的东西，现在想象你有一个类似的数据集</p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="1950" class="js jt hi lp b fi lt lu l lv lw">const dataset = [<br/>{ type: "Sample 1", value: 50, radius: 7 },<br/>{ type: "Sample 2", value: 30, radius: 11 },<br/>{ type: "Sample 3", value: 10, radius: 3 }<br/>];</span></pre><p id="8604" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，首先在 d3 中有几个操作数据实用函数</p><p id="a603" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">d3 .计算最小值和最大值的范围</p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="5731" class="js jt hi lp b fi lt lu l lv lw"><strong class="lp hj">d3.extent</strong>(dataset, d =&gt; d.value) ==&gt; <em class="ma">[10, 50]</em></span></pre><p id="49e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，我们的 Y 轴从 0 开始，所以我们只能使用 d3.max 函数，并以 60 结束。</p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="c4b4" class="js jt hi lp b fi lt lu l lv lw"><strong class="lp hj">d3.max</strong>(dataset, d =&gt; d.value) + 10 ==&gt; <em class="ma">60</em></span></pre><p id="120d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，我们需要一个包含所有顺序值的数组，这样我们就可以使用 es6 的 map 函数或 d3 的 mapping 来提取名称。</p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="9b30" class="js jt hi lp b fi lt lu l lv lw">dataset.<strong class="lp hj">map</strong>(d =&gt; d.type) ==&gt; <em class="ma">["Sample 1", "Sample 2", "Sample 3"]</em></span><span id="d267" class="js jt hi lp b fi mb lu l lv lw">d3.map(dataset, d =&gt; d.type).keys() ==&gt; <em class="ma">["Sample 1", "Sample 2", "Sample 3"]</em></span></pre><p id="a823" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如你所看到的，d3 有一些对数组非常有用的原生函数。</p><h2 id="19c1" class="js jt hi bd ju jv jw jx jy jz ka kb kc iq kd ke kf iu kg kh ki iy kj kk kl km bi translated">挽救（saving 的简写）</h2><p id="c3f3" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">它总是一样的，创建一个有边距的框架，内容的宽度和高度，正确地翻译它以视觉/显示正确等等…</p><p id="f123" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lx ly lz lp b">index.html</code></p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="a384" class="js jt hi lp b fi lt lu l lv lw">&lt;div id="<strong class="lp hj">viz</strong>"&gt;&lt;/div&gt;</span></pre><p id="15d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lx ly lz lp b">index.js</code></p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="cf1a" class="js jt hi lp b fi lt lu l lv lw">const <strong class="lp hj">margin</strong> = { top: 40, right: 150, bottom: 60, left: 30 },<br/><strong class="lp hj">width</strong> = 500 - margin.left - margin.right,<br/><strong class="lp hj">height</strong> = 420 - margin.top - margin.bottom;</span><span id="c4d8" class="js jt hi lp b fi mb lu l lv lw">const svg = d3<br/>.select("<strong class="lp hj">#viz</strong>")<br/>.append("<strong class="lp hj">svg</strong>")<br/>.attr("width", width + margin.left + margin.right)<br/>.attr("height", height + margin.top + margin.bottom)<br/>.append("g")<br/>.attr("transform", "translate(" + margin.left + "," + margin.top + ")");</span></pre><h2 id="382c" class="js jt hi bd ju jv jw jx jy jz ka kb kc iq kd ke kf iu kg kh ki iy kj kk kl km bi translated">轴和刻度</h2><p id="633b" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">对于 X 轴，我们必须创建和缩放沿轴均匀分布的离散值</p><p id="e098" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lx ly lz lp b">index.js</code></p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="b302" class="js jt hi lp b fi lt lu l lv lw">const types = dataset.map(d =&gt; d.type); ==&gt; <em class="ma">["Sample 1", "Sample 2", "Sample 3"]</em></span><span id="7751" class="js jt hi lp b fi mb lu l lv lw">// Add X scale</span><span id="3488" class="js jt hi lp b fi mb lu l lv lw">const x = d3<br/>.<strong class="lp hj">scaleBand</strong>()<br/>.domain(types)<br/>.range([0, width]);</span><span id="8c59" class="js jt hi lp b fi mb lu l lv lw">// Add X axis</span><span id="359f" class="js jt hi lp b fi mb lu l lv lw">svg<br/>.append("g")<br/>.attr("transform", "translate(0," + height + ")")<br/>.call(d3.<strong class="lp hj">axisBottom</strong>(x));</span></pre><p id="fc3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此时，你可能会奇怪我为什么用 scaleBand 而不是 scaleOrdinal？？？</p><blockquote class="ks"><p id="8b85" class="kt ku hi bd kv kw kx ky kz la lb jc dx translated"><code class="du lx ly lz lp b">scaleOrdinal</code>将离散值(由数组指定)映射到离散值(也由数组指定)</p></blockquote><p id="ab95" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">和</p><blockquote class="ks"><p id="2d7c" class="kt ku hi bd kv kw kx ky kz la lb jc dx translated"><code class="du lx ly lz lp b">In scaleBand</code>域被指定为一个值数组(每个带一个值),范围被自动分割成<em class="lc"> n 个</em>带，计算它们的位置和宽度。</p></blockquote><p id="d6b1" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">因此，基本上使用 scaleBand，我们指定的内容更少，我们可以自动完成部分工作</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mc"><img src="../Images/6b5329b80a0b8c7094b41a3f328d124d.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*PYVc38FJ1ebVcMNW7xD42A.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">我们用下面的代码创建的 X 轴和 X 刻度</figcaption></figure><p id="151b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了了解规模，另一个惊人的资源是</p><p id="75ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">【https://www.d3indepth.com/scales/ T2】号</p><p id="b268" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于 Y 轴，我们创建一个从 0 到最大值的线性标度</p><p id="b926" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lx ly lz lp b">index.js</code></p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="f70d" class="js jt hi lp b fi lt lu l lv lw">const yMax = d3.max(dataset, d =&gt; d.value) + 10 ==&gt; <em class="ma">60</em></span><span id="4b96" class="js jt hi lp b fi mb lu l lv lw">// Add Y scale</span><span id="67ab" class="js jt hi lp b fi mb lu l lv lw">const y = d3<br/>.<strong class="lp hj">scaleLinear</strong>()<br/>.domain([0, yMax])<br/>.range([height, 0]);</span><span id="d6a1" class="js jt hi lp b fi mb lu l lv lw">// Add Y axis</span><span id="e21d" class="js jt hi lp b fi mb lu l lv lw">svg.append("g").call(d3.<strong class="lp hj">axisLeft</strong>(y));</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mh"><img src="../Images/038223d13f1da7e889b11c8ba87507d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*c_BgXxO_rYsYQA_gZEsSGQ.png"/></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">我们用下面的代码创建的轴和刻度</figcaption></figure><h2 id="7d6e" class="js jt hi bd ju jv jw jx jy jz ka kb kc iq kd ke kf iu kg kh ki iy kj kk kl km bi translated">气泡</h2><p id="88bf" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">对于气泡，我们使用数据集中的半径值来创建圆，并用其类型和值来定位它们。通常情况下，使用自定义的半径比例和彩色气泡，事情会更复杂。</p><p id="6361" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lx ly lz lp b">index.js</code></p><pre class="je jf jg jh fd lo lp lq lr aw ls bi"><span id="19dd" class="js jt hi lp b fi lt lu l lv lw">// Add bubbles</span><span id="5744" class="js jt hi lp b fi mb lu l lv lw">svg<br/>.append("g")<br/>.selectAll("bubble")<br/>.data(dataset)<br/>.enter()<br/>.append("circle")<br/>.attr("<strong class="lp hj">cx</strong>", d =&gt; x(d.type) + 50)<br/>.attr("<strong class="lp hj">cy</strong>", d =&gt; y(d.value))<br/>.attr("<strong class="lp hj">r</strong>", d =&gt; d.radius)<br/>.style("fill", "lightcyan")<br/>.style("opacity", "0.7")<br/>.attr("stroke", "black");</span></pre><h2 id="5009" class="js jt hi bd ju jv jw jx jy jz ka kb kc iq kd ke kf iu kg kh ki iy kj kk kl km bi translated">结果</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mi"><img src="../Images/9a18f7fd9751ad4413315c472ac76dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*tI3-Uuha4lnmDoGdKxlynQ.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">这是我们的基本气泡图</figcaption></figure><h2 id="6fff" class="js jt hi bd ju jv jw jx jy jz ka kb kc iq kd ke kf iu kg kh ki iy kj kk kl km bi translated">密码</h2><div class="mj mk ez fb ml mm"><a href="https://github.com/ackuser/d3js-bubble-chart" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab dw"><div class="mo ab mp cl cj mq"><h2 class="bd hj fi z dy mr ea eb ms ed ef hh bi translated">ackuser/d3js 气泡图</h2><div class="mt l"><h3 class="bd b fi z dy mr ea eb ms ed ef dx translated">由斯塔克布里兹·⚡️.创作在 GitHub 上创建一个帐户，为 ackuser/d3js 气泡图的开发做出贡献。</h3></div><div class="mu l"><p class="bd b fp z dy mr ea eb ms ed ef dx translated">github.com</p></div></div><div class="mv l"><div class="mw l mx my mz mv na jj mm"/></div></div></a></div><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="nb nc l"/></div></figure><h2 id="2b66" class="js jt hi bd ju jv jw jx jy jz ka kb kc iq kd ke kf iu kg kh ki iy kj kk kl km bi translated">结论</h2><p id="7c99" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">你可以玩它，改变很多东西，定制颜色，轴等。</p><p id="b155" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你从 dataviz 和 d3js 开始，试着深入理解你做的每一件事。开始时这是一项艰巨的任务，但是有大量的资源，一步一步来，你可以做令人惊奇的事情。</p><p id="4496" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢阅读。</p></div></div>    
</body>
</html>