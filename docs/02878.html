<html>
<head>
<title>Cloud Web Scraper — The Setup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">云Web Scraper —设置</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/cloud-web-scraper-the-setup-c542ca77c6ae?source=collection_archive---------3-----------------------#2020-01-06">https://medium.com/analytics-vidhya/cloud-web-scraper-the-setup-c542ca77c6ae?source=collection_archive---------3-----------------------#2020-01-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="da7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你对网络抓取的概念不熟悉，我建议你阅读我写的这篇文章。他们是我将在这个刮擦系统上建立的想法。</p><p id="d3e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我整理的东西开始时是一个有点笨重的python脚本，我会在本地运行它，从LinkedIn中抓取一些我自己的统计数据，并将输出保存到电子表格中。我一直在努力改进它，现在它运行在一个基于云的虚拟机上。这台机器将输出保存到数据库中，然后可以通过第二台运行小型web服务器的虚拟机进行可视化。</p><p id="2ed8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种可视化显示了最近被抓取的帖子、具有最高浏览量的帖子和具有最高反应量的帖子。最重要的是，有一个简单的表单可以将新帖子插入到抓取列表中。</p><p id="cb40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将详细介绍如何设置两个虚拟机和数据库。我将在后面的单独文章中继续介绍抓取和可视化数据的代码和脚本，以及在其中一个虚拟机上设置web服务器的代码和脚本。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/6ffd84decd468da993b42b41f2e42dee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*XB-TEkQ0JpFXXeJvSEVwnw.gif"/></div></div></figure><h2 id="96a8" class="jq jr hi bd js jt ju jv jw jx jy jz ka iq kb kc kd iu ke kf kg iy kh ki kj kk bi translated">设置虚拟机</h2><p id="ac4e" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq kn is it iu ko iw ix iy kp ja jb jc hb bi translated">首先，我们将使用甲骨文云(坚持免费层产品)，所以你需要<a class="ae jd" href="http://bit.ly/OCTrialLink" rel="noopener ugc nofollow" target="_blank">注册一个账户</a>。一旦你设置好你的账户，你应该会在主页上看到一个“快速行动”菜单。从这里，我们将开始设置虚拟机实例。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kq"><img src="../Images/3f408e83c50a0adfe2cbba24db14bc32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V_QjfyJ8ZU5mrMisw7NpqQ.png"/></div></div></figure><p id="40d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们有两个虚拟机需要设置，它们都具有相同的设置。由于这种情况，我将运行一次设置。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kr"><img src="../Images/c94fb6d55ad1bafbc1ca3a682462383d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SQIu0-2NwnTd-gy5ngkUbA.png"/></div></div></figure><p id="81c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，单击“创建虚拟机实例”按钮。您将进入一个页面，详细介绍虚拟机的设置。这里要做的第一件事是命名您的VM实例，使用有意义的名称使事情更容易进行。例如，在这些文章中，我将把他们称为“<em class="ks">网络爬虫</em>和“<em class="ks">可视化者</em>”。</p><p id="c543" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，确保“形状和类型”旁边有“<em class="ks">始终免费合格的</em>”标签(假设您想留在免费层)。您仍然需要打开“显示形状、网络和存储选项”菜单，但是如果这不在空闲层内，您需要选择不同的“<em class="ks">可用性域</em>”，直到在“更改形状”菜单中出现“<em class="ks">始终免费合格的</em>”形状。对于“英国-伦敦”地区，我发现'<em class="ks"> AD 2 </em>'应该提供正确的形状。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kt"><img src="../Images/96bc865db4f98ba784a63a7a5ca75298.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RCQAH4986JvRmIaJboqVyg.png"/></div></div></figure><p id="09a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在“显示形状、网络和存储选项”菜单中，几乎在底部，有一个选项是“<em class="ks">不分配公共IP地址</em>”或“<em class="ks">分配公共IP地址</em>”。您需要将其更改为“<em class="ks">分配公共IP地址</em>”，以便我们可以远程访问虚拟机。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ku"><img src="../Images/4739dbb9531fb9ea882a2eebaa7a950a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*dNY-EIX87WR6mMgGzSLxXA.png"/></div></figure><p id="ffd0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将IP地址设置为public后，您需要滚动到页面底部来上传您的公共SSH密钥。您可以使用任何工具来生成您的公钥-私钥对，您将在远程访问中使用它们。在我的例子中，我使用了“油灰键生成器”。如果您也这样做，请确保在“密钥”下拉菜单中选择了“SSH-2 RSA密钥”。</p><p id="2b52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">生成密钥后，点击“保存私钥”按钮，将密钥保存在安全的地方。然后从密钥生成器窗口的框中复制公钥。将此粘贴到纯文本文件中，并使用文件类型'保存它。酒吧。点击“保存公钥”按钮，保存公钥的格式与窗口中显示的格式略有不同。</p><p id="30a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回到虚拟机设置页面点击“选择文件”按钮，并选择您的<strong class="ih hj"> <em class="ks">公共</em> </strong>键。完成后，点击页面底部的“创建”。您需要等待几分钟，以便调配和启动虚拟机。同样，由于我们将使用两个虚拟机，因此您需要执行两次。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kq"><img src="../Images/4484a1f28ba4f3cd5bfc78abb6dcf392.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2yC8STSgJoYWfraeas1VJQ.png"/></div></div></figure><h2 id="3148" class="jq jr hi bd js jt ju jv jw jx jy jz ka iq kb kc kd iu ke kf kg iy kh ki kj kk bi translated">设置数据库</h2><p id="7908" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq kn is it iu ko iw ix iy kp ja jb jc hb bi translated">接下来，数据库设置更加简单。点击“快速操作”按钮，当您重定向到设置页面时，像命名虚拟机一样命名数据库。接下来，您需要向下滚动，确保“选择工作负载类型”设置为“<em class="ks">数据仓库</em>”，并且“选择部署类型”设置为“<em class="ks">无服务器</em>”。</p><p id="3ef5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这两个选项下面是“配置数据库”菜单。在这里你会发现一个“<em class="ks">永远免费</em>”滑块。确保此选项已打开(滑块后面的蓝色背景)。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kv"><img src="../Images/30512328e5ad53215b074f8d614755e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QhHMu47pVB-pLVEjUY-tag.png"/></div></div></figure><p id="035d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，您需要向下滚动到下一部分，并设置您的管理员密码。确保您使用了安全的密码，并且您记住了它。设置完成后，滚动到页面底部，点击“创建自治数据库”按钮。</p></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><p id="0bdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我之前所说的，我将介绍python、SQL、HTML等。在我的下一篇文章中。但是我将在这里介绍WebScraper所需的各种包和库，以防您同时想自己尝试这些概念。</p><p id="a085" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为我们使用的是Oracle Linux(除非您更改了虚拟机上的默认设置)，所以首先要说明的是，它是一个Red Hat Linux。在很大程度上，这种区别对我们来说是无关紧要的。然而，我们需要注意的是，我们将不会使用通常的“apt-get”包处理程序。在Red Hat发行版中，处理程序是“yum”。给我的一天带来一点快乐和幽默的启示。</p><h2 id="54bd" class="jq jr hi bd js jt ju jv jw jx jy jz ka iq kb kc kd iu ke kf kg iy kh ki kj kk bi translated">包和Python库</h2><p id="6253" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq kn is it iu ko iw ix iy kp ja jb jc hb bi translated">首先，我将介绍我们需要的包，然后是python库(将使用python脚本进行抓取)。要安装它，您需要访问虚拟机实例。为此，您可以SSH到实例中；如果你不知道如何查看我写的这篇短文，我会告诉你如何去做。</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="ce47" class="jq jr hi le b fi li lj l lk ll">$ sudo yum install python3<br/>$ sudo yum install python3-pip<br/>$ sudo yum install firefox<br/>$ sudo yum install xorg-x11-utils.x86_64<br/>$ sudo yum install xorg-x11-server-Xvfb.x86_64</span></pre><p id="3b29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ks"> python3 </em>是为了能够执行python代码，<em class="ks"> python3-pip </em>是为了安装python库。我们将使用“<em class="ks"> firefox </em>浏览器来浏览LinkedIn，以便搜集我们想要的信息。</p><p id="4c56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看起来神秘的'<em class="ks"> xorg-x11-utils.x86_64 </em>'让我们可以访问'<em class="ks">屏幕</em>命令。这允许我们启动一个“屏幕”，一个与终端窗口无关的终端实例，在这里我们可以设置代码运行。这使得我们可以避免终端窗口关闭时停止任何正在运行的代码或命令的问题。这在测试抓取时非常有用，因为代码执行的时间可能会超过连接超时，因此当终端断开连接时会失败。</p><p id="8103" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，第二个xorg，'<em class="ks">xorg-X11-server-xvfb . x86 _ 64</em>'，允许我们运行虚拟显示。这很重要，因为我们设置的虚拟机是无头的(没有显示器/其他显示器)，而Firefox需要一个显示器与之交互。</p><p id="09cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在所有的yum安装之后，是python库的时候了。这就是我们将使用'<em class="ks"> pip3 </em>'工具的地方。</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="4a7d" class="jq jr hi le b fi li lj l lk ll">$ sudo pip3 install pyvirtualdisplay<br/>$ sudo pip3 install selenium<br/>$ sudo pip3 install python-dotenv<br/>$ sudo pip3 install webdriverdownloader</span></pre><p id="c4f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">pyvirtualdisplay允许我们从python脚本中与虚拟显示器进行交互。这是操作的基本要求，但同样重要。selenium可以说是我们正在下载的最重要的库，因为它将控制浏览器以方便我们的抓取。</p><p id="311d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ks">一个‘的使用’。env</em>’文件不是必需的，但是它使共享脚本和文件变得更加简洁。我将在中包含的内容。如果你愿意，env 文件可以简单地硬编码到你的python脚本中。'<em class="ks"> python-dotenv </em>'库将允许我们使用'<em class="ks">。env </em>文件与我们的python脚本。</p><p id="51f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一个有用但不重要的包含是'<em class="ks"> webdriverdownloader </em>'。为了让Firefox在Selenium上正常工作，我们需要一个web驱动程序，在这里是Gecko驱动程序。虽然你可以去下载并手动安装，这个库只是简化了过程。安装后，运行以下命令:</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="7c9f" class="jq jr hi le b fi li lj l lk ll">$ python3<br/>&gt;&gt;&gt; from webdriverdownloader import GeckoDriverDownloader<br/>&gt;&gt;&gt; GeckoDriverDownloader().download_and_install()</span></pre><p id="988c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦运行完成，您就可以下载并安装Gecko驱动程序了！最后要做的是将'<em class="ks"> geckodriver </em>'添加到PATH变量中。这是按如下方式完成的:</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="e4ce" class="jq jr hi le b fi li lj l lk ll">$ readlink -f geckodriver</span></pre><p id="2706" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过突出显示输出来复制该语句的输出，这将把它添加到剪贴板。在下一个语句中，当您进入“粘贴输出”时，只需右击鼠标，这将粘贴最后一个复制到剪贴板的项目。</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="8a25" class="jq jr hi le b fi li lj l lk ll">$ export PATH=$PATH:'paste output'</span></pre><p id="4317" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，当我们自动运行python脚本时，为了使Gecko驱动程序可以被VM访问，将PATH变量复制到sudo用户的“crontab”文件中:</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="0425" class="jq jr hi le b fi li lj l lk ll">$ echo $PATH</span></pre><p id="68db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像以前一样复制这个的输出。</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="af15" class="jq jr hi le b fi li lj l lk ll">$ sudo EDITOR=nano crontab -e</span></pre><p id="e83f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将打开sudo用户的crontab文件，以nano作为编辑器。你可以使用任何你觉得最舒服的编辑器，但是我将假设使用nano。将以下内容添加到文件中:</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="e8ff" class="jq jr hi le b fi li lj l lk ll">PATH='paste output'</span></pre><p id="1f47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后按ctrl+x退出编辑器，按“y”保存所做的更改。这让我们的WebScraper虚拟机为python脚本的到来做好了准备。</p></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><p id="bfd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">几周后，当我讨论在Visualiser上设置web服务器时，请回来查看！</p><p id="61dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">问题，评论？你可以在LinkedIn上找到我。</p><blockquote class="lm"><p id="509c" class="ln lo hi bd lp lq lr ls lt lu lv jc dx translated">*所有观点均为我个人观点，与甲骨文无关*</p></blockquote></div></div>    
</body>
</html>