<html>
<head>
<title>Apache Beam-Python on Google Cloud Platform (GCP) -Building and Running data pipelines-A step by step Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Apache Beam-Google云平台上的Python(GCP)-构建和运行数据管道-逐步指南</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/apache-beam-python-on-google-cloud-platform-gcp-building-and-running-data-pipelines-a-step-by-8afaec3e8e1?source=collection_archive---------4-----------------------#2020-12-30">https://medium.com/analytics-vidhya/apache-beam-python-on-google-cloud-platform-gcp-building-and-running-data-pipelines-a-step-by-8afaec3e8e1?source=collection_archive---------4-----------------------#2020-12-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="1824" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这篇文章的重点是:</p><p id="952c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">a)在GCP创建一个项目</p><p id="bfb3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">b)建立项目环境</p><p id="5b11" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">c)使用Apache Beam和Python构建数据管道</p><p id="5570" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">d)运行管道</p><p id="4748" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">e)附加注释</p><h1 id="17df" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated"><strong class="ak"> A)在GCP创建一个项目</strong></h1><p id="3ea8" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">1.使用您的gmail帐户登录<a class="ae kf" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> GCP控制台</a>。新客户可以使用谷歌云90天免费试用和300美元积分</p><p id="817b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.创建新项目。输入项目名称，然后单击创建。在项目名称下面记下项目id(您可以通过单击项目名称下面的编辑按钮来编辑项目ID)。ID用于向Google Cloud tools标识您的项目，因此最好使其可读。</p><p id="7b91" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如你所见，我的项目id是<strong class="ig hi"> <em class="kg"> gcpproject-id </em> </strong></p><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es kh"><img src="../Images/619b4e1effb819d8612e55468db0faf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*sWiDwXq_aWHWhgAF_lVL0g.png"/></div></figure><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es kp"><img src="../Images/d4a46bda7b23444e89b2185540459334.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*qBudXyWFMAeBcywckT25sg.png"/></div></figure><p id="67fc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.启用<a class="ae kf" href="https://console.cloud.google.com/billing?_ga=2.192057002.1043866382.1609189417-891824868.1600960180&amp;_gac=1.120468218.1609189893.Cj0KCQiAoab_BRCxARIsANMx4S5Oi4Zbcx0jxtiJ0snaO6k1Hrrh8CBUsgJULwB5jKkbbCh2a4pfFWwaAkUnEALw_wcB" rel="noopener ugc nofollow" target="_blank">计费账户</a></p><p id="803e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.单击Google Cloud控制台顶部的“激活云外壳”按钮。如果需要，参考<a class="ae kf" href="https://cloud.google.com/shell/docs/using-cloud-shell" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/shell/docs/using-cloud-shell</a>。确保所选项目是您想要处理的项目。</p><p id="cd75" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用下拉按钮选择您的项目</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kq"><img src="../Images/83b3fd6bcb3c07c483ed89f79566db77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qhv3NPsYdF11JdSeNmvgPQ.png"/></div></div></figure><p id="dfab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">5.创建一个<a class="ae kf" href="https://console.cloud.google.com/apis/credentials/serviceaccountkey?_ga=2.20739325.457761025.1609201108-978686323.1601309429" rel="noopener ugc nofollow" target="_blank">服务账户</a>。从<strong class="ig hi">服务账户</strong>列表中选择<strong class="ig hi">新服务账户。</strong>在<strong class="ig hi">服务帐户名称</strong>字段中，输入一个名称。从<strong class="ig hi">角色</strong>列表中，选择<strong class="ig hi">项目</strong> &gt; <strong class="ig hi">所有者。下载json文件并保存，我们以后会用到它。<em class="kg">我已经把它重命名为gcpdataflowkey.json </em></strong></p><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es kv"><img src="../Images/d54c5e4cbf4b11e92ae634cacefa3a30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*9TvhEgqrelKboCktVRIBmA.png"/></div></figure><p id="e033" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">6.在<a class="ae kf" href="https://console.cloud.google.com/storage/browser?_ga=2.263886665.457761025.1609201108-978686323.1601309429" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">云存储浏览器</strong> </a>页面。点击<strong class="ig hi">创建桶</strong>。指定以下属性:名称、默认存储类(标准)和位置，然后单击创建</p><h1 id="bf45" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">b)建立项目环境</h1><ol class=""><li id="675a" class="kw kx hh ig b ih ka il kb ip ky it kz ix la jb lb lc ld le bi translated">要从云控制台启动云外壳会话，请使用您的<a class="ae kf" href="http://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">控制台</a>中的<strong class="ig hi">激活云外壳</strong>按钮。</li><li id="7f38" class="kw kx hh ig b ih lf il lg ip lh it li ix lj jb lb lc ld le bi translated">在云外壳中，为您的项目ID分配一个项目变量</li></ol><pre class="ki kj kk kl fd lk ll lm ln aw lo bi"><span id="9165" class="lp jd hh ll b fi lq lr l ls lt">export PROJECT=gcpproject-id</span></pre><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es lu"><img src="../Images/3ca7a79d38b7136172d3d076f17273b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bj_c2zugnSttns23E8CtlA.png"/></div></div></figure><p id="1038" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.从云Shell终端，您可以运行以下命令来启动云Shell编辑器:</p><pre class="ki kj kk kl fd lk ll lm ln aw lo bi"><span id="a819" class="lp jd hh ll b fi lq lr l ls lt">cloudshell edit .</span></pre><p id="74ee" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">也可以点击云壳窗口工具栏上带铅笔图标的打开编辑器按钮来启动编辑器。</p><p id="d286" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更多信息请点击这里:<a class="ae kf" href="https://cloud.google.com/shell/docs/launching-cloud-shell-editor" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/shell/docs/launching-cloud-shell-editor</a></p><p id="2a14" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.为您的项目创建一个目录(文件夹)(在我的例子中为gcpdataflow ),并在该目录中创建一个python文件(在我的例子中为bestsellers.py ),可以通过访问file菜单从编辑器中创建，也可以使用以下命令从云shell终端创建</p><pre class="ki kj kk kl fd lk ll lm ln aw lo bi"><span id="2a67" class="lp jd hh ll b fi lq lr l ls lt">mkdir gcpdataflow<br/>cd gcpdataflow/<br/>touch bestsellers.py</span></pre><p id="d681" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.虚拟环境:</p><p id="2327" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Virtualenv 让您创建和管理虚拟Python环境。关于它的更多信息，请点击这里:<a class="ae kf" href="https://dont-be-afraid-to-commit.readthedocs.io/en/latest/virtualenv.html" rel="noopener ugc nofollow" target="_blank">https://don-be-fear-to-commit . readthedocs . io/en/latest/virtualenv . html</a></p><p id="f441" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在云shell终端的项目目录(在我的例子中是gcpdataflow，用于设置虚拟环境)中运行以下命令</p><pre class="ki kj kk kl fd lk ll lm ln aw lo bi"><span id="e8ea" class="lp jd hh ll b fi lq lr l ls lt"><strong class="ll hi">python3 -m pip install — user venv<br/>virtualenv -p python3 venv<br/>source venv/bin/activate<br/>pip install 'apache-beam[gcp]'</strong></span></pre><p id="a1ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意:<strong class="ig hi"> venv </strong>是我给我的虚拟环境起的名字。你可以用你的来代替。</p><p id="357a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">5.导航到编辑器并将服务帐户密钥(在“在GCP创建项目”下的第5点中创建)上传到您的项目文件夹。</p><p id="a4a3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是我的文件夹结构供比较:</p><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es lv"><img src="../Images/19bcb058681dc2c2879ffeb362678b5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*39Kqu8n1Yro23gzJjrnblw.png"/></div></figure><h1 id="3c9b" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated"><strong class="ak"> C)使用Apache Beam和Python构建数据管道</strong></h1><p id="2e2c" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">在这篇文章中，我使用的是kaggle数据集:<a class="ae kf" href="https://www.kaggle.com/sootersaalu/amazon-top-50-bestselling-books-2009-2019" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/sootersaalu/Amazon-top-50-best-selling-books-2009-2019</a>。这是亚马逊2009-2019年前50本畅销书的数据集。，它包含550本书，并使用Goodreads分类为小说和非小说。</p><p id="beb1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下载这个csv并进行数据清理(我已经用分号替换了Name列中的逗号)。将此csv上传到桶中(在GCP创建项目的第6点中创建)。你可以在我的github中找到干净的csv文件(链接在附加注释中给出)</p><p id="2add" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">csv的快照在这里:</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es lw"><img src="../Images/17aaf6b92097f366b9d963c1c4914328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*Kt-fWzWQOyY7oHkBTZDMtQ.png"/></div></div></figure><h1 id="b133" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated"><strong class="ak">问题陈述:</strong></h1><ol class=""><li id="7aa6" class="kw kx hh ig b ih ka il kb ip ky it kz ix la jb lb lc ld le bi translated">找出小说类图书、非小说类图书以及所有图书的平均用户评分，并将结果写入单独的文件中</li><li id="eaec" class="kw kx hh ig b ih lf il lg ip lh it li ix lj jb lb lc ld le bi translated">按字母顺序对书籍和最后5本书进行排序，并打印输出</li></ol><h2 id="a0c8" class="lp jd hh bd je lx ly lz ji ma mb mc jm ip md me jq it mf mg ju ix mh mi jy mj bi translated"><strong class="ak">导入库和JSON密钥</strong></h2><ol class=""><li id="b5ce" class="kw kx hh ig b ih ka il kb ip ky it kz ix la jb lb lc ld le bi translated">将Python代码中的GOOGLE_APPLICATION_CREDENTIALS环境变量设置为key.json文件路径</li></ol><pre class="ki kj kk kl fd lk ll lm ln aw lo bi"><span id="2082" class="lp jd hh ll b fi lq lr l ls lt">from __future__ import absolute_import<br/>import argparse<br/>import logging<br/>import re<br/>import apache_beam as beam<br/>from apache_beam.options.pipeline_options import PipelineOptions<br/>import os</span><span id="3a19" class="lp jd hh ll b fi mk lr l ls lt"># set GOOGLE_APPLICATION_CREDENTIALS environment variable in Python code to the path key.json file</span><span id="dffd" class="lp jd hh ll b fi mk lr l ls lt">os.environ[‘GOOGLE_APPLICATION_CREDENTIALS’] = “/home/annapooraniks/gcpdataflow/gcpdataflowkey.json”</span></pre><h2 id="883e" class="lp jd hh bd je lx ly lz ji ma mb mc jm ip md me jq it mf mg ju ix mh mi jy mj bi translated"><strong class="ak">创建/配置管道</strong></h2><p id="39fb" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">管道代表从开始到结束的整个数据处理任务。<strong class="ig hi">流水线=读取输入+转换数据+写入输出</strong></p><p id="3b41" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建Beam SDK类管道的实例。当您构造PipelineOptions对象时，将配置选项设置为从命令行读取选项，如下所示:</p><pre class="ki kj kk kl fd lk ll lm ln aw lo bi"><span id="e1e3" class="lp jd hh ll b fi lq lr l ls lt"># instantiate the pipeline<br/>options = PipelineOptions()<br/>with beam.Pipeline(options=options) as p:</span></pre><p id="c7f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">除了标准PipelineOptions之外，要构建自己的定制选项，请使用<code class="du ml mm mn ll b">add_argument()</code>方法</p><pre class="ki kj kk kl fd lk ll lm ln aw lo bi"><span id="cf75" class="lp jd hh ll b fi lq lr l ls lt"># defining custom arguments - To add your own options, use the add_argument() method</span><span id="1762" class="lp jd hh ll b fi mk lr l ls lt"># specify a description which appears when a user passes --help as a command-line argument, and a default value.</span><span id="fdc3" class="lp jd hh ll b fi mk lr l ls lt">class MyOptions(PipelineOptions):<br/>@classmethod</span><span id="782d" class="lp jd hh ll b fi mk lr l ls lt">def _add_argparse_args(cls, parser):</span><span id="ba03" class="lp jd hh ll b fi mk lr l ls lt">parser.add_argument('--input',<br/>                    help='Input for the pipeline',<br/>                    dest='input',<br/>                    required=False,<br/>                    default='gs://gcpdataflow/bestsellers.csv')<br/>parser.add_argument('--output',<br/>                    help='Output for the pipeline',<br/>                    required=False,<br/>                    default='gs://gcpdataflow/computedresult.txt')</span></pre><h2 id="fb65" class="lp jd hh bd je lx ly lz ji ma mb mc jm ip md me jq it mf mg ju ix mh mi jy mj bi translated">p集合</h2><p id="2f8d" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">PCollection是一个<strong class="ig hi">不可变的</strong>分布式数据集，Beam pipeline在其上运行，它充当pipeline中每一步的输入和输出。</p><h2 id="abac" class="lp jd hh bd je lx ly lz ji ma mb mc jm ip md me jq it mf mg ju ix mh mi jy mj bi translated"><strong class="ak">管道输入/输出</strong></h2><p id="3bf8" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">Read transforms从外部源读取数据，并返回数据的一个<code class="du ml mm mn ll b">PCollection</code>表示。在这里，我阅读了文件的内容——畅销书收藏中的畅销书. csv</p><pre class="ki kj kk kl fd lk ll lm ln aw lo bi"><span id="4ff7" class="lp jd hh ll b fi lq lr l ls lt"># reading the csv and splitting lines by elements we want to retain<br/>bestsellers = (<br/>     p | beam.io.ReadFromText(input_filename, skip_header_lines=1)<br/>       | beam.ParDo(Split())<br/>)</span></pre><p id="3229" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，我已经将skipped header设置为TRUE (1)。如果你需要标题，你可以把它设置为0</p><p id="6685" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">写转换将<code class="du ml mm mn ll b">PCollection</code>中的数据写入外部数据源</p><pre class="ki kj kk kl fd lk ll lm ln aw lo bi"><span id="af0b" class="lp jd hh ll b fi lq lr l ls lt">"Write results to Fiction_Results file" &gt;&gt;beam.io.WriteToText('gs://gcpdataflow/Fiction_Result')</span></pre><h2 id="0d4d" class="lp jd hh bd je lx ly lz ji ma mb mc jm ip md me jq it mf mg ju ix mh mi jy mj bi translated"><strong class="ak">变换</strong></h2><p id="b5c0" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">转换是管道中的操作。它将PCollection作为输入，并返回一个PCollection作为输出。使用|管道运算符调用多个转换。</p><p id="eddf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通用示例:</p><pre class="ki kj kk kl fd lk ll lm ln aw lo bi"><span id="4002" class="lp jd hh ll b fi lq lr l ls lt">[Final Output PCollection] <strong class="ll hi">=</strong> ([Initial Input PCollection] <br/>              <strong class="ll hi">| </strong>[First Transform]<br/>              <strong class="ll hi">|</strong> [Second Transform]<br/>              <strong class="ll hi">|</strong> [Third Transform])</span></pre><p id="ba40" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如，畅销书集合包含所有畅销书的列表。我正在创建一个新的管道，使用“流派”列只过滤“小说”书籍，然后使用MyTransform()计算所有小说书籍的平均用户评级，然后将结果打印在一个文件中</p><pre class="ki kj kk kl fd lk ll lm ln aw lo bi"><span id="7316" class="lp jd hh ll b fi lq lr l ls lt">Fiction_pipeline = (</span><span id="b3ea" class="lp jd hh ll b fi mk lr l ls lt">   bestsellers<br/>  | beam.Filter(lambda record: FilterBasedonGenre('Fiction',record))<br/>  | "Composite Transformation for Fiction elements" &gt;&gt; MyTransform()<br/>  | "Write results to Fiction_Results file"   &gt;&gt;beam.io.WriteToText('gs://gcpdataflow/Fiction_Result')</span><span id="7fb4" class="lp jd hh ll b fi mk lr l ls lt">)</span></pre><h2 id="78a4" class="lp jd hh bd je lx ly lz ji ma mb mc jm ip md me jq it mf mg ju ix mh mi jy mj bi translated"><strong class="ak">复合变换</strong></h2><p id="bccc" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">当您需要重复执行多个简单的转换时，那么您可以将许多简单的转换放在一个“复合”转换中。</p><p id="0394" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如，这里MyTransform()是一个复合转换。我需要表演1。提取评分2 .计算平均评分3 .格式化小说书籍、非小说书籍和所有书籍的结果。所以我将这三个简单的转换嵌套成一个复合转换。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es mo"><img src="../Images/922ebc04f5188d1db01a592e2d589c6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vK7sxfnqvu9AGcJRemhwTA.png"/></div></div></figure><p id="a5a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> GroupByKey : </strong>用于聚合有共同点的数据。它接受键、值对作为输入。当我们拥有包含多个具有相同键但不同值的对的数据时，要收集与每个唯一键相关的所有值，可以使用GroupByKey()</p><p id="450e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ExtractRating:返回包含1(键)和评级值的元组列表。这形成了GroupByKey的输入，它将(Key，value)对作为输入</p><pre class="ki kj kk kl fd lk ll lm ln aw lo bi"><span id="8e95" class="lp jd hh ll b fi lq lr l ls lt">class ExtractRating(beam.DoFn):<br/>      def process(self, element):<br/>            result = [(1, element['Rating'])]<br/>            return result</span></pre><h2 id="3351" class="lp jd hh bd je lx ly lz ji ma mb mc jm ip md me jq it mf mg ju ix mh mi jy mj bi translated"><strong class="ak">帕尔多和DoFn </strong></h2><p id="a9cd" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">ParDo变换独立地并且可能并行地处理输入p集合中的每个元素，并且向输出p集合产生零个或多个元素。DoFn是ParDo处理输入PCollection元素的参数。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es mp"><img src="../Images/604c86d0c661f6727c135fe9dbab8e02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zphry19jKKWBuBAJG-XLIw.png"/></div></div></figure><p id="bb8e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Split()的调用如下:</p><pre class="ki kj kk kl fd lk ll lm ln aw lo bi"><span id="00c8" class="lp jd hh ll b fi lq lr l ls lt">beam.ParDo(Split())</span></pre><h1 id="dc45" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated"><strong class="ak"> D)运行管道</strong></h1><p id="6ebf" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">运行程序:</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es mq"><img src="../Images/3db39a8b1c816ef65ac9321421c64f20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GXotuCAUwgPvyIlS2JAyjQ.png"/></div></div></figure><p id="3302" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">输出以降序显示前5本书的名字，按照我们使用beam时的字母顺序排序。地图(印刷)</p><p id="4f42" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您将看到桶中有3个新文件，上面印有平均值</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es mr"><img src="../Images/9fa200970a5308016fb371de0013916c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DlNLH7Ic5lr13FLjyDNnlQ.png"/></div></div></figure><pre class="ki kj kk kl fd lk ll lm ln aw lo bi"><span id="ec84" class="lp jd hh ll b fi lq lr l ls lt">#Fiction Result File<br/>AVERAGE RATING OF BOOKS:4.648333333333334</span><span id="2354" class="lp jd hh ll b fi mk lr l ls lt">#Non Fiction Result File<br/>AVERAGE RATING OF BOOKS:4.595161290322581</span><span id="4426" class="lp jd hh ll b fi mk lr l ls lt">#computedresults<br/>AVERAGE RATING OF BOOKS:4.618363636363635</span></pre><h1 id="9bb5" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated"><strong class="ak"> E)附加说明</strong></h1><ol class=""><li id="f80a" class="kw kx hh ig b ih ka il kb ip ky it kz ix la jb lb lc ld le bi translated">Github链接:<a class="ae kf" href="https://github.com/annapooranik/ApacheBeam-Python-Datapipeline" rel="noopener ugc nofollow" target="_blank">https://github . com/annapooranik/Apache beam-Python-data pipeline</a></li></ol><blockquote class="ms mt mu"><p id="c755" class="ie if kg ig b ih ii ij ik il im in io mv iq ir is mw iu iv iw mx iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="hh">希望这篇文章对你有用。如果你做到了，欢迎鼓掌或关注我:)</em> </strong></p></blockquote></div></div>    
</body>
</html>