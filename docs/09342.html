<html>
<head>
<title>Journey of Apache Kafka &amp; Zookeeper Administrator(Part 11 )</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">阿帕奇卡夫卡与动物园管理员之旅(十一)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/journey-of-apache-kafka-zookeeper-administrator-part-11-197d4ea232d0?source=collection_archive---------11-----------------------#2020-09-02">https://medium.com/analytics-vidhya/journey-of-apache-kafka-zookeeper-administrator-part-11-197d4ea232d0?source=collection_archive---------11-----------------------#2020-09-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a6e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2020年6月(AWS云上的Terraform Magic)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/3d8f039b8950518bf0ad25843a4af172.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kj-VwKf1Orssnh-3j_lfGA.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">礼貌:数据狗</figcaption></figure><p id="68ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你正在阅读我的文章，那么你会明白，到目前为止，我还没有谈到在云上运行卡夫卡。这里面有起有落。</p><p id="64bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们以#AWS云为例。</p><p id="aeae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> AWS </strong>提供<strong class="ih hj"> MSK </strong>为卡夫卡提供<strong class="ih hj">托管服务。它解决了Kafka的许多问题，集群设置可以在几分钟内完成，而不是手动几个小时。对于MSK，我们也失去了控制，所以这是一个权衡，你需要决定你是应该学习一切还是仅仅依靠AWS的支持。</strong></p><p id="c2d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我建议您应该在AWS中拥有一个没有MSK的手动开发集群，这样您就可以理解集群任务的不同方面。今天我解释了如何用#Terraform + #Ansible建立一个Kafka集群，这样我们就可以完全控制所有的事情。</p><p id="67cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注:</strong></p><ol class=""><li id="2565" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">你应该知道阿帕奇卡夫卡的基本知识，如果不是的话，那就去读一读，或者试试我以前的文章。</li><li id="c762" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">你应该知道Terraform的基础知识，我不能在这里涵盖这些东西。</li><li id="c2ba" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">你应该知道AWS EC2，VPC和标签。</li><li id="fe7b" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">翻译知识也是必需的。</li></ol></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><p id="b9d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">在AWS云中应该做一些事情，这样我们就可以从Terraform代码开始。</strong></p><ol class=""><li id="7243" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">创建IAM用户并保存其凭证，如access_key和secret_key。</li><li id="a7fa" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">创建EC2 ssh-key对，稍后将用于Ansible。</li><li id="70e7" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">每个VPC子网都应该有标签“type=public/private”。</li><li id="d259" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">应在所有AZ中创建子网，并且其中不应有空白。</li><li id="2db4" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">这些文章中分享的所有示例都会随着时间的推移而改变，所以请查看<a class="ae ko" href="https://github.com/116davinder/kafka-cluster-ansible/tree/master/terraform/aws" rel="noopener ugc nofollow" target="_blank"> GitHub以获取最新代码</a>。</li></ol><p id="09f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从Terraform代码开始，试着理解它。</p><p id="7681" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应该有一个<a class="ae ko" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/terraform/aws/provider.tf" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">Provider . TF</strong></a><strong class="ih hj"/>指定使用哪个provider插件和地区。</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="edb2" class="ku kv hi kq b fi kw kx l ky kz">terraform {<br/>  required_version        = "&gt;= 0.12"<br/>}</span><span id="1b7f" class="ku kv hi kq b fi la kx l ky kz">provider aws {   <br/>    region                = var.region<br/>}</span></pre><p id="7260" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ko" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/terraform/aws/data.tf" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">data . TF</strong></a><strong class="ih hj">/收集事实</strong></p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="89fd" class="ku kv hi kq b fi kw kx l ky kz">data "aws_ami" "amazon_ami" {<br/>most_recent               = true<br/>owners                    = ["amazon"]</span><span id="64ec" class="ku kv hi kq b fi la kx l ky kz">filter {<br/>   name                   = "owner-alias"<br/>   values                 = ["amazon"]<br/> }</span><span id="bbb7" class="ku kv hi kq b fi la kx l ky kz">filter {<br/>   name                   = "name"<br/>   values                 = ["amzn2-ami-hvm*"]<br/> }<br/> <br/>}</span><span id="cf86" class="ku kv hi kq b fi la kx l ky kz">data "aws_availability_zones" "available" {<br/>  state                   = "available"<br/>}</span><span id="deee" class="ku kv hi kq b fi la kx l ky kz"># it should be private subnets in production environment.<br/>data "aws_subnet" "public_subnet" {<br/>  count                   = var.kafka_nodes<br/>  vpc_id                  = var.vpc_id<br/>  filter {<br/>    name                  = "tag:type"<br/>    values                = ["public"]<br/>  }<br/>  availability_zone       = data.aws_availability_zones.available.names[ count.index % length(data.aws_availability_zones.available.names) ]</span><span id="b1e1" class="ku kv hi kq b fi la kx l ky kz">}</span></pre><p id="c645" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">data.tf有趣的部分是“aws_subnet”。它将找到所有带有“tag: type=public”的“可用”子网。</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="8112" class="ku kv hi kq b fi kw kx l ky kz">data.aws_availability_zones.available.names[ count.index % length(data.aws_availability_zones.available.names) ]</span></pre><p id="4802" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面这段代码有很多东西，它会在每个AZ中找到子网。这将用于在所有Az上平均分配Kafka节点。</p><p id="8a80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">例子:</strong></p><p id="6ad7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">地区:</strong>EU-中央-1<br/>T3】AZ ' s带子网:3<br/>T6】卡夫卡节点数:9<br/>T9】分布:每个AZ上3个卡夫卡节点。</p><p id="50ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">地区:</strong>us-east-1<br/><strong class="ih hj">AZ ' s with Subnet:</strong>5<br/><strong class="ih hj">卡夫卡节点数:</strong> 10 <br/> <strong class="ih hj">分布</strong>:每个AZ上2个卡夫卡节点。</p><p id="ee1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">所有#Terraform变量</strong>:<a class="ae ko" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/terraform/aws/var.tf" rel="noopener ugc nofollow" target="_blank">Kafka-cluster-ansi ble/terra form/AWS/var . TF</a></p><p id="2b02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在创建EC2机器之前，我们需要创建一些东西。</p><ol class=""><li id="95d7" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">由于Kafka需要大量的持久存储，所以我将使用<a class="ae ko" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/terraform/aws/ebs.tf" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> AWS EBS </strong> </a>。</li></ol><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="1bba" class="ku kv hi kq b fi kw kx l ky kz">resource "aws_ebs_volume" "kafka" {<br/>  count                   = var.kafka_nodes<br/>  availability_zone       = data.aws_availability_zones.available.names[ count.index % length(data.aws_availability_zones.available.names) ]<br/>  size                    = var.kafka_volume_size</span><span id="048a" class="ku kv hi kq b fi la kx l ky kz">tags = {<br/>    Name                  = "kafka-data-vol-${var.env}-${count.index}"<br/>    Env                   = var.env<br/>    Owner                 = "Terraform"<br/>  }</span><span id="db1c" class="ku kv hi kq b fi la kx l ky kz">}</span></pre><p id="3dea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.我需要创建一个安全组。</p><p id="936f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">请务必更改以下代码，因为它允许从任何地方访问SSH / Kafka端口</strong>。</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="8ca9" class="ku kv hi kq b fi kw kx l ky kz">resource "aws_security_group" "kafka_sg" {<br/>  name                    = "kafka-sg-${var.env}"<br/>  description             = "Allow kafka traffic"<br/>  vpc_id                  = var.vpc_id</span><span id="e371" class="ku kv hi kq b fi la kx l ky kz">ingress {<br/>    from_port             = 22<br/>    to_port               = 22<br/>    protocol              = "tcp"<br/>    cidr_blocks           = ["0.0.0.0/0"]<br/>  }</span><span id="b252" class="ku kv hi kq b fi la kx l ky kz">ingress {<br/>    from_port             = 0<br/>    to_port               = 0<br/>    protocol              = "-1"<br/>    self                  = true<br/>  }</span><span id="3087" class="ku kv hi kq b fi la kx l ky kz">ingress {<br/>    from_port             = 9092<br/>    to_port               = 9092<br/>    protocol              = "tcp"<br/>    cidr_blocks           = ["0.0.0.0/0"]<br/>  }</span><span id="f482" class="ku kv hi kq b fi la kx l ky kz">egress {<br/>    from_port             = 0<br/>    to_port               = 0<br/>    protocol              = "-1"<br/>    cidr_blocks           = ["0.0.0.0/0"]<br/>  }</span><span id="b57c" class="ku kv hi kq b fi la kx l ky kz">tags                    = {<br/>    Name                  = "kafka-sg-${var.env}"<br/>    Env                   = var.env<br/>    Owner                 = "Terraform"<br/>  }<br/>}</span></pre><p id="24f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.我们还需要创建<a class="ae ko" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/terraform/aws/iam.tf" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> IAM EC2概要文件</strong> </a>，以便EC2机器可以在需要时将其日志写入<strong class="ih hj"> AWS CloudWatch </strong>。</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="ac65" class="ku kv hi kq b fi kw kx l ky kz">data "aws_iam_policy" "cloudwatchAgent" {<br/>  arn = "arn:aws:iam::aws:policy/CloudWatchAgentServerPolicy"<br/>}</span><span id="a60f" class="ku kv hi kq b fi la kx l ky kz">resource "aws_iam_role" "Kafka-CloudWatchAgentServerRole" {<br/>  name = var.ec2_cloudwatch_role</span><span id="3c98" class="ku kv hi kq b fi la kx l ky kz">assume_role_policy = &lt;&lt;EOF<br/>{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>    {<br/>        "Action": "sts:AssumeRole",<br/>        "Principal": {<br/>        "Service": "ec2.amazonaws.com"<br/>        },<br/>        "Effect": "Allow",<br/>        "Sid": ""<br/>    }<br/>    ]<br/>}<br/>EOF</span><span id="53b1" class="ku kv hi kq b fi la kx l ky kz">tags = {<br/>    Owner                 = "Terraform"<br/>  }<br/>}</span><span id="1183" class="ku kv hi kq b fi la kx l ky kz">resource "aws_iam_role_policy_attachment" "Kafka-CloudWatchAgentServerRole" {<br/>  role       = var.ec2_cloudwatch_role<br/>  policy_arn = data.aws_iam_policy.cloudwatchAgent.arn</span><span id="ad78" class="ku kv hi kq b fi la kx l ky kz">depends_on = [aws_iam_role.Kafka-CloudWatchAgentServerRole, data.aws_iam_policy.cloudwatchAgent]<br/>}</span><span id="8929" class="ku kv hi kq b fi la kx l ky kz">resource "aws_iam_instance_profile" "Kafka-CloudWatchAgentServerRole-Profile" {<br/>  name = var.ec2_cloudwatch_role<br/>  role = aws_iam_role.Kafka-CloudWatchAgentServerRole.name<br/>}</span></pre><p id="c7a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在是时候为卡夫卡创造<a class="ae ko" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/terraform/aws/kafka.tf" rel="noopener ugc nofollow" target="_blank"> EC2机器了。</a></p><ol class=""><li id="e00c" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">我也使用EBS卷作为根卷。</li><li id="4c6e" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">现在不需要详细的监控。</li></ol><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="4760" class="ku kv hi kq b fi kw kx l ky kz">resource "aws_instance" "kafka" {<br/>  count                   = var.kafka_nodes</span><span id="77ad" class="ku kv hi kq b fi la kx l ky kz">ami                     = data.aws_ami.amazon_ami.id<br/>  instance_type           = var.instance_type<br/>  key_name                = var.key_name<br/>  subnet_id               = element(data.aws_subnet.public_subnet.*.id, count.index)<br/>  vpc_security_group_ids  = ["${aws_security_group.kafka_sg.id}"]<br/>  <br/>  root_block_device {<br/>    volume_type           = "gp2"<br/>    volume_size           = var.kafka_root_volume_size<br/>  }</span><span id="e2c4" class="ku kv hi kq b fi la kx l ky kz">tags = {<br/>    Name                  = "kafka-${var.env}-${count.index}"<br/>    Env                   = var.env<br/>    Owner                 = "Terraform"<br/>    Software              = "Apache Kafka"<br/>  }</span><span id="f1f6" class="ku kv hi kq b fi la kx l ky kz">volume_tags = {<br/>    Owner                 = "Terraform"<br/>  }</span><span id="90e6" class="ku kv hi kq b fi la kx l ky kz">monitoring              = false</span><span id="f99c" class="ku kv hi kq b fi la kx l ky kz">availability_zone       = data.aws_availability_zones.available.names[ count.index % length(data.aws_availability_zones.available.names) ]<br/>  iam_instance_profile    = var.ec2_cloudwatch_role<br/>  depends_on              = [aws_security_group.kafka_sg,aws_iam_instance_profile.Kafka-CloudWatchAgentServerRole-Profile]</span><span id="c103" class="ku kv hi kq b fi la kx l ky kz">}</span></pre><p id="67bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦EC2代码准备就绪，<a class="ae ko" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/terraform/aws/kafka.tf#L34-L40" rel="noopener ugc nofollow" target="_blank">我们还需要附加EBS </a>。</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="b6db" class="ku kv hi kq b fi kw kx l ky kz">resource "aws_volume_attachment" "kafka_ebs_attach" {<br/>  count                   = var.kafka_nodes<br/>  device_name             = var.kafka_ebs_attach_location<br/>  volume_id               = element(aws_ebs_volume.kafka.*.id, count.index)<br/>  instance_id             = element(aws_instance.kafka.*.id, count.index)<br/>  force_detach            = true<br/>}</span></pre><p id="367e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还需要EC2机器的出口IP，所以<a class="ae ko" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/terraform/aws/ouput.tf" rel="noopener ugc nofollow" target="_blank">输出。<br/> <strong class="ih hj">注意:如果使用私有子网，也应该更改。</strong></a></p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="a64f" class="ku kv hi kq b fi kw kx l ky kz">output public_ip {<br/>  value                   = aws_instance.kafka[*].public_ip<br/>  sensitive               = false<br/>}</span></pre><p id="79e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">如何运行Terraform代码？</strong></p><p id="fad0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">克隆项目:</strong><a class="ae ko" href="https://github.com/116davinder/kafka-cluster-ansible" rel="noopener ugc nofollow" target="_blank">116 dav inder/Kafka-cluster-ansi ble</a>或<a class="ae ko" href="https://github.com/116davinder/kafka-cluster-ansible/releases" rel="noopener ugc nofollow" target="_blank">下载发布</a>。<br/>将文件夹切换到<strong class="ih hj">Kafka-cluster-ansi ble/terra form/AWS。<br/>运行地形命令</strong> : init / apply。<br/>或<br/> <strong class="ih hj">跟随本自述:</strong><a class="ae ko" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/terraform/readme.md" rel="noopener ugc nofollow" target="_blank">116 dav inder/Kafka-cluster-ansi ble/terraform/Readme . MD</a></p></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><p id="30ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Terraform将为我们创造所有的裸资源。现在是Ansible再次发光的时候了。</p><p id="2f3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于EC2机器上的AWS云，我们必须做一些预设置。</p><ol class=""><li id="62fe" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">安装Python 3及其依赖项。</li><li id="997a" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">安装AWS云观察日志代理。</li><li id="11f5" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">将EBS卷配置到分区。</li></ol><p id="6c3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ko" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/inventory/development/cluster-aws.ini" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">库存</strong> </a></p><p id="7e5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考消息:</strong>我没有使用动态库存。</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="abde" class="ku kv hi kq b fi kw kx l ky kz">[all:vars]<br/>ansible_user=ec2-user<br/>ansible_connection=ssh <br/>ansible_become_method=sudo <br/>ansible_become=true<br/>ansible_ssh_private_key_file=~/.ssh/davinder-test-terraform.pem</span><span id="9320" class="ku kv hi kq b fi la kx l ky kz">[clusterNodes]<br/>18.159.111.208</span><span id="c6aa" class="ku kv hi kq b fi la kx l ky kz">[clusterAddNodes]</span><span id="1195" class="ku kv hi kq b fi la kx l ky kz">[clusterRemoveNodes]</span><span id="96a9" class="ku kv hi kq b fi la kx l ky kz">[kafka-mirror-maker]</span><span id="33b3" class="ku kv hi kq b fi la kx l ky kz">[kafka-mirror-maker-remove-nodes]</span></pre><p id="8c8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">所需的额外变量是</strong></p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="eeb0" class="ku kv hi kq b fi kw kx l ky kz"># Variables Only for AWS Based Cluster<br/>aws_kafka_ec2_region: "eu-central-1"<br/>aws_kafka_ebs_device: /dev/xvdc<br/>aws_kafka_ebs_device_fs: xfs<br/>aws_kafka_ebs_device_mount_location: "{{ kafkaInstallDir }}"</span></pre><p id="d2de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经创建了一个非常简单可行的剧本:<a class="ae ko" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/clusterAwsPreSetup.yml" rel="noopener ugc nofollow" target="_blank"> clusterAwsPreSetup.yml </a></p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="7f8a" class="ku kv hi kq b fi kw kx l ky kz">---</span><span id="d3f9" class="ku kv hi kq b fi la kx l ky kz">- name: install xfs untils<br/>  package:<br/>    name: xfsprogs<br/>    state: present<br/>  ignore_errors: true</span><span id="8878" class="ku kv hi kq b fi la kx l ky kz">- name: check filesystem on given device<br/>  command: file -s "{{ aws_kafka_ebs_device }}"<br/>  register: kafka_ebs_device_status</span><span id="ad30" class="ku kv hi kq b fi la kx l ky kz">- name: create filesystem on given device<br/>  filesystem:<br/>    fstype: "{{ aws_kafka_ebs_device_fs }}"<br/>    dev: "{{ aws_kafka_ebs_device }}"<br/>  when: kafka_ebs_device_status.stdout | regex_search(' data')</span><span id="23bc" class="ku kv hi kq b fi la kx l ky kz">- name: create kafka ebs mount dir<br/>  file:<br/>    path: "{{ aws_kafka_ebs_device_mount_location }}"<br/>    state: directory</span><span id="223e" class="ku kv hi kq b fi la kx l ky kz">- name: mount kafka ebs volume<br/>  mount:<br/>    path: "{{ aws_kafka_ebs_device_mount_location }}"<br/>    src: "{{ aws_kafka_ebs_device }}"<br/>    fstype: xfs<br/>    state: mounted</span></pre><p id="0e1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">行动手册的其余部分现在将按预期工作。<strong class="ih hj">请阅读</strong><a class="ae ko" href="https://github.com/116davinder/kafka-cluster-ansible/blob/master/Readme.md" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">readme . MD</strong></a><strong class="ih hj">。</strong></p></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><p id="1bc4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">旅程将在下一个主题继续(Oracle云上的Terraform)</p></div></div>    
</body>
</html>