<html>
<head>
<title>Django Rest Framework: Generic Views, Using Parameters in the Url with the Query</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django Rest框架:通用视图，在查询中使用Url中的参数</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/django-rest-framework-generic-views-using-parameters-in-the-url-with-the-query-fd61eba85f4?source=collection_archive---------5-----------------------#2020-05-29">https://medium.com/analytics-vidhya/django-rest-framework-generic-views-using-parameters-in-the-url-with-the-query-fd61eba85f4?source=collection_archive---------5-----------------------#2020-05-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9497" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">一名导游</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/dcf8f163b55d69974a06792d05e842c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_6oZAheCwiQiKHAHeJDK5w.png"/></div></figure><p id="a608" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Django rest framework的通用视图是创建API端点的一种很好的方式，并且不会在处理数据的技术细节上浪费太多时间。然而，因为视图是为了适应标准使用而内置的(因此得名<em class="jd">通用</em>)，所以它不能很好地满足定制需求。因此，我们发现自己正在从头开始写观点。</p><p id="d69b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是如果我们不需要呢？如果我们能够<em class="jd">定制</em>通用视图会怎么样？</p><p id="a45b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">自定义需求的一个例子是创建端点，这些端点使用URL中的参数和查询体中的参数。例如，假设我们有一个包含以下端点的图书模型:</p><pre class="jf jg jh ji fd jm jn jo jp aw jq bi"><span id="db23" class="jr js hi jn b fi jt ju l jv jw">/books/<br/>/books/&lt;book_id:int&gt;/</span></pre><p id="9210" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们想在这个模型中添加一个图像字段来存储图书封面。我们希望端点保持一致，因此图像端点的设计如下所示:</p><pre class="jf jg jh ji fd jm jn jo jp aw jq bi"><span id="5742" class="jr js hi jn b fi jt ju l jv jw">/books/&lt;book_id:int&gt;/image/</span></pre><p id="2ff8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个端点需要处理GET请求，该请求将返回指定书籍的图像(如果有)。它还处理向图书添加或更改图像的POST请求。</p><p id="ebaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为我们不希望在查询体和端点的URL中出现重复的<code class="du jx jy jz jn b">b</code> ook_id `,所以我们将创建一个仅包含image字段的serialize，然后使用URL中的参数来标识我们正在处理的图书。这就是为什么序列化程序将如下所示:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="e330" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，因为通用视图(generics。创建和通用。RETRIVE)在创建中只使用查询数据，因为<code class="du jx jy jz jn b">b</code>ook _ id’在URL中而不是在查询中，我们将不得不覆盖创建过程。</p><p id="d563" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是我们如何在序列化器中获得book_id呢？</p><p id="bce9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们将创建一个通道，将book_id从视图传送到序列化程序。我们通过覆盖视图上的get_serializer_context方法来实现，并传递带有上下文的book_id，然后通过覆盖图书的序列化程序上的validate方法从另一端获取它。</p><p id="3683" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以视图会是这样的:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="b5ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">NB。因为我们正在处理一个文件，我们必须设置解析器类来处理，因此:</p><pre class="jf jg jh ji fd jm jn jo jp aw jq bi"><span id="6f50" class="jr js hi jn b fi jt ju l jv jw">parser_classes = (MultiPartParser, FormParser)</span></pre><p id="7ff8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">序列化程序将会这样结束:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ka kb l"/></div></figure></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><p id="f1c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您的阅读，希望对您有所帮助。</p></div></div>    
</body>
</html>