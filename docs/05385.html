<html>
<head>
<title>Azure Databricks for Data Noobs Part 1 — The Basics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure Databricks for Data Noobs第1部分—基础知识</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/azure-databricks-for-data-noobs-part-1-the-basics-c6ce8e0116bc?source=collection_archive---------21-----------------------#2020-04-19">https://medium.com/analytics-vidhya/azure-databricks-for-data-noobs-part-1-the-basics-c6ce8e0116bc?source=collection_archive---------21-----------------------#2020-04-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="b6d9" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">介绍</h1><p id="04ca" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我的<a class="ae kb" rel="noopener" href="/@farooqamahmud/pyspark-for-data-noobs-part-2-getting-shakespearean-d60dfeb4fe64">以前的帖子</a>解释了如何在Docker中启动和运行一个本地Spark实例，加载数据和查询数据。我还提到这是一个很好的介绍Spark的方式，因为它很容易设置和运行。</p><p id="5c8e" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">当您准备升级到企业级Spark实例时，您会希望在Spark集群上加载和分析数据，因为它可以轻松处理大量数据集。然而，配置一个Spark集群远非小事<a class="ae kb" href="https://spark.apache.org/docs/latest/running-on-kubernetes.html" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="e24d" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">进入<a class="ae kb" href="https://azure.microsoft.com/en-us/services/databricks/" rel="noopener ugc nofollow" target="_blank"> Azure Databricks </a>。</p><p id="fce0" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">阅读完本文后，您将完成以下任务:</p><ol class=""><li id="953c" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated">了解Azure Databricks的优势及其解决的问题。</li><li id="fb47" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">使用PowerShell和Azure CLI设置Azure Databricks环境。为什么？因为“自动化所有的事情”是好的</li><li id="3fcd" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">创建Azure Databricks群集。</li><li id="8895" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">创建数据块笔记本。</li><li id="e639" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">运行笔记本代码，从GitHub存储库中加载数据集，进行一些基本的清理并查看数据。</li></ol><h1 id="f6d9" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">GitHub知识库</h1><p id="2e2f" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">本文提到的所有代码都位于<a class="ae kb" href="https://github.com/farooq-teqniqly/blog-databricks-for-noobs" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中。</p><h1 id="9dd3" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">数据块和Azure数据块</h1><p id="da07" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">是的，这是两码事。Databricks由创建Apache Spark的人在2013年创建。Spark团队意识到建立一个企业级的Spark环境是困难的。Databricks通过自动化抽象了很多这种复杂性。将此与云提供商相结合，您就拥有了一个Spark平台，它可以自动扩展、安全，并且可以连接众多服务。在<a class="ae kb" href="https://docs.databricks.com/getting-started/overview.html" rel="noopener ugc nofollow" target="_blank"> Databricks文档网站</a>上有一个关于AWS的不错的Databricks概述。</p><p id="82fa" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">Azure Databricks是一个Spark平台，它可以自动扩展，是安全的，并且可以通过利用<em class="kv"> Azure </em>平台连接大量服务:</p><ul class=""><li id="5fc4" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka kw kn ko kp bi translated">Azure计算资源提供了可扩展性。</li><li id="fe2a" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka kw kn ko kp bi translated">网络资源和Azure Active Directory提供安全性。</li><li id="d7f1" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka kw kn ko kp bi translated">Azure Databricks可以与blob存储、数据湖、SQL服务器、物联网中心和许多其他Azure服务一起工作。</li></ul><p id="536a" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><a class="ae kb" href="https://azure.microsoft.com/en-us/blog/a-technical-overview-of-azure-databricks/" rel="noopener ugc nofollow" target="_blank">这里的</a>是Azure环境下的一个很好的数据块概述。</p><h1 id="206d" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">设置数据块环境</h1><p id="d661" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Azure Databricks环境由一个资源组组成。在这个资源组中，我们创建了一个Azure data bricks<em class="kv">workspace</em>资源。Azure Databricks工作区是您进入Azure Databricks环境的入口点。</p><p id="5569" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj">注意:</strong>在继续之前，请从您的PowerShell会话登录Azure。运行<code class="du kx ky kz la b">az login</code>，如果您需要更改您的默认订阅，也可以选择<code class="du kx ky kz la b">az account set --subscription &lt;&lt;your subscription name&gt;&gt;</code>。</p><h2 id="4574" class="lb ig hi bd ih lc ld le il lf lg lh ip jo li lj it js lk ll ix jw lm ln jb lo bi translated">创建Azure资源组</h2><pre class="lp lq lr ls fd lt la lu lv aw lw bi"><span id="922d" class="lb ig hi la b fi lx ly l lz ma">#Create resource group<br/>$resourceGroupName = “&lt;&lt;name&gt;&gt;”<br/>$resourceGroupLocation = “&lt;&lt;location&gt;&gt;”<br/>az group create `<br/> — name $resourceGroupName `<br/> — location $resourceGroupLocation</span></pre><h2 id="998f" class="lb ig hi bd ih lc ld le il lf lg lh ip jo li lj it js lk ll ix jw lm ln jb lo bi translated">创建Azure Databricks工作区</h2><p id="0fde" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">遗憾的是，无法使用Azure CLI创建Databricks工作区。因此，我们使用公开可用的ARM模板进行部署。ARM模板的参数在下面的PowerShell脚本中动态创建。现在是喝饮料或吃点心的最佳时机，因为部署需要几分钟时间。</p><pre class="lp lq lr ls fd lt la lu lv aw lw bi"><span id="6333" class="lb ig hi la b fi lx ly l lz ma">#Create Databricks workspace<br/>$workspaceName = ‘&lt;&lt;your workspace name&gt;&gt;’</span><span id="abeb" class="lb ig hi la b fi mb ly l lz ma">$armTemplateUri = ‘<a class="ae kb" href="https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/101-databricks-workspace/azuredeploy.json'" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/101-databricks-workspace/azuredeploy.json'</a></span><span id="bb29" class="lb ig hi la b fi mb ly l lz ma">$armTemplateParameters = @{<br/> pricingTier = @{ value = ‘premium’ }<br/> location = @{ value = $resourceGroupLocation }<br/> workspaceName = @{ value = $workspaceName }<br/> } | ConvertTo-Json<br/> <br/>$tempFileName = New-TemporaryFile<br/>[System.IO.File]::WriteAllText($tempFileName, $armTemplateParameters)</span><span id="8f8a" class="lb ig hi la b fi mb ly l lz ma">try {<br/> az group deployment create `<br/> — resource-group $resourceGroupName `<br/> — template-uri $armTemplateUri `<br/> — parameters “””$tempFileName”””<br/>} finally {<br/> Remove-Item -Path $tempFileName -Force<br/>}</span></pre><p id="217d" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">现在Databricks工作区正在运行，我们可以在工作区内创建一个集群。Databricks集群执行您提交的Spark作业，即笔记本中的Python代码。</p><ol class=""><li id="89a5" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated">在Azure门户中，转到Databricks资源并单击<strong class="jf hj">启动工作区</strong>按钮。</li></ol><figure class="lp lq lr ls fd md er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es mc"><img src="../Images/19dd451c7394dc87baeeb1b74bd3242f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bK34n1fzU9G83YHwcGn5Jw.png"/></div></div></figure><p id="6937" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">2.点击<strong class="jf hj">集群</strong>图标。</p><figure class="lp lq lr ls fd md er es paragraph-image"><div class="er es mk"><img src="../Images/00c92ba88f9ee0f08637017924f56533.png" data-original-src="https://miro.medium.com/v2/resize:fit:274/format:webp/1*Ul80Dg-CEH2or5wyo5BHDA.png"/></div></figure><p id="f265" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">3.点击<strong class="jf hj">创建集群</strong>按钮。</p><figure class="lp lq lr ls fd md er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es ml"><img src="../Images/754f3575134c2af5e08e7afc4f126ae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*AXIDffTUcaAqBc4vLahw4w.png"/></div></div></figure><p id="54de" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">4.为您的集群命名。将<strong class="jf hj">最小工人</strong>和<strong class="jf hj">最大工人</strong>设置分别更改为<strong class="jf hj"> 2 </strong>和<strong class="jf hj"> 4、</strong>。点击<strong class="jf hj">创建集群。</strong></p><figure class="lp lq lr ls fd md er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es mm"><img src="../Images/a2c62e49a6544cdb949adfa1140e739f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2T-zTK-LcLp9dbbUyFGHEg.png"/></div></div></figure><p id="61d0" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">5.您将被重定向到集群列表页面。几秒钟后，您的集群将以<em class="kv">挂起</em>状态出现在列表中。集群的状态转换到<em class="kv">运行</em> <strong class="jf hj">需要几分钟时间。</strong></p><figure class="lp lq lr ls fd md er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es mn"><img src="../Images/947d3a719af9e7a2424c61e420eb08a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fQ1C14S8sFudawq3K6wxIA.png"/></div></div></figure><h1 id="accf" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">旁白—“自动化所有的事情”</h1><p id="52a1" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果您想知道集群创建是否可以自动化，答案是肯定的！有一个基于Python的Databricks CLI可用。我有意没有在本文中提到它，因为我不想引入额外的复杂性。如果您对设置Databricks CLI感兴趣，请查看Azure Databricks文档。</p><h1 id="4230" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">我们在哪里？</h1><p id="7748" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">至此，我们有了一个运行Spark集群的Azure Databricks工作区！现在，我们可以将数据湖中飞行数据文件加载到Spark中并对其进行分析。</p><h1 id="cc9b" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">数据基础设施</h1><p id="cc06" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在对数据做任何事情之前，让我们看看Azure为我们创建的基础设施。当我第一次看到Databricks集群中涉及的所有资源时，我很庆幸自己不必自己设置(或者找专家来设置)。</p><p id="4811" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">创建群集会创建虚拟机、存储帐户和网络资源。这些资源包含在所谓的<em class="kv">托管资源组中。</em>你可以通过Azure门户中的Databricks workspace页面访问这个资源组。</p><figure class="lp lq lr ls fd md er es paragraph-image"><div class="er es mo"><img src="../Images/f0b4a80b664c4874e7ac432d6ae28527.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*09yItNJzIHuIXBZqijiK4w.png"/></div></figure><p id="e46f" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">注意到上图中的<em class="kv"> URL </em>是Databricks UI的URL。您可以将此URL加入书签，以便快速访问UI。</p><p id="17e2" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">单击该链接可查看托管资源组的资源。请注意，这里有两个虚拟机，因为我们在创建集群时指定了最少两个工作节点。存储帐户资源包含数据块文件系统(DBFS)。请注意，如果您尝试查看存储帐户容器，将会收到一条未经授权的消息。Azure限制了DBFS的访问。</p><figure class="lp lq lr ls fd md er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es mp"><img src="../Images/f76e2e246630408f4634b2897af7fccd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uNAVFyudQLxC8h8uyltzeA.png"/></div></div></figure><h1 id="f14a" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">创建数据块笔记本</h1><p id="63da" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">让我们创建一个Python笔记本，我们将使用它来进行分析。</p><ol class=""><li id="f9bc" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated">浏览至数据块用户界面。</li><li id="be47" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">点击<strong class="jf hj">工作区&gt;创建&gt;笔记本。</strong>提供笔记本名称。</li></ol><figure class="lp lq lr ls fd md er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es mq"><img src="../Images/5f60306b40a100f824f8fba03b44cea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZtIzH9GqNtcZDYPiDeEOIQ.png"/></div></div></figure><p id="e203" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">3.笔记本以编辑模式打开。现在我们可以编写Python代码来加载和探索飞行数据了！</p><h1 id="10aa" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">运行代码</h1><p id="fa0e" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">您在<em class="kv">单元格中编写数据块代码。</em>一个单元格可以包含一行代码，也可以包含数百行代码——由您决定。在单元格中运行代码时，您有多种选择。键盘爱好者可以按下<strong class="jf hj"> CTRL+ENTER。</strong>有GUI思想的人可以点击<strong class="jf hj">运行单元</strong>按钮。</p><figure class="lp lq lr ls fd md er es paragraph-image"><div class="er es mr"><img src="../Images/200de3f339ebbe4d1b3d0725fe758392.png" data-original-src="https://miro.medium.com/v2/resize:fit:230/format:webp/1*Csojymxu3eME115S4aNvjQ.png"/></div></figure><p id="a071" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">也可以按<strong class="jf hj"> SHIFT+ENTER </strong>运行代码。不同之处在于，该方法将执行代码并创建一个新的单元格。</p><h1 id="0735" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">旁白——魔法命令</h1><p id="b58a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">您可以从Databricks笔记本中浏览驱动程序节点的文件系统。在单元格中运行以下代码，打印当前工作目录及其内容:</p><pre class="lp lq lr ls fd lt la lu lv aw lw bi"><span id="3b68" class="lb ig hi la b fi lx ly l lz ma">%sh<br/>pwd<br/>ls</span></pre><p id="ba97" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">您应该会看到类似如下的列表:</p><figure class="lp lq lr ls fd md er es paragraph-image"><div class="er es ms"><img src="../Images/9fae715cd462ac07e0c6bb809079cfd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:470/format:webp/1*7A3639kqtr0fq6GYUL4wpQ.png"/></div></figure><p id="4a67" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><code class="du kx ky kz la b">%sh</code>命令被称为<em class="kv">魔法命令。</em><code class="du kx ky kz la b">%sh</code>magic命令允许你在一个单元中运行shell命令。</p><p id="6782" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">魔法命令<code class="du kx ky kz la b">%fs</code>允许你查看DBFS:</p><pre class="lp lq lr ls fd lt la lu lv aw lw bi"><span id="c3b5" class="lb ig hi la b fi lx ly l lz ma">%fs<br/>ls</span></pre><p id="8add" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">尽管我们创建了一个Python笔记本，但是您可以使用一个神奇的命令来运行Scala代码:</p><pre class="lp lq lr ls fd lt la lu lv aw lw bi"><span id="d9ee" class="lb ig hi la b fi lx ly l lz ma">%scala<br/>println(“Hello, world”)</span></pre><p id="7d35" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">markdown有一个神奇的命令，对记录笔记本很有用。在单元格中运行以下代码，查看呈现的内容:</p><pre class="lp lq lr ls fd lt la lu lv aw lw bi"><span id="b089" class="lb ig hi la b fi lx ly l lz ma">%md # Exploring the Databricks File System *(DBFS)*</span></pre><h1 id="9225" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">从GitHub存储库中导入数据集</h1><p id="07d8" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在笔记本单元格中运行下面的代码，从本文的GitHub存储库中下载飞行数据集。</p><pre class="lp lq lr ls fd lt la lu lv aw lw bi"><span id="925a" class="lb ig hi la b fi lx ly l lz ma">import requests</span><span id="be9d" class="lb ig hi la b fi mb ly l lz ma">csv = requests.get(‘<a class="ae kb" href="https://raw.githubusercontent.com/farooq-teqniqly/blog-databricks-for-noobs/master/flight_data.txt').text" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/farooq-teqniqly/blog-databricks-for-noobs/master/flight_data.txt').text</a></span></pre><p id="185f" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">现在我们需要将<code class="du kx ky kz la b">csv</code>变量中的文本保存到DBFS中的一个文件中，这样我们就可以将它加载到数据框中。运行下面的代码创建一个名为<code class="du kx ky kz la b">demo_data</code>的文件夹，并将下载的数据保存到该文件夹中一个名为<code class="du kx ky kz la b">flight_data.csv</code>的文件中。</p><pre class="lp lq lr ls fd lt la lu lv aw lw bi"><span id="ca3a" class="lb ig hi la b fi lx ly l lz ma">dbutils.fs.mkdirs(‘/demo_data/’)<br/>dbutils.fs.put(‘/demo_data/flight_data.csv’, csv)</span></pre><p id="174f" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">现在将文件加载到数据框中。注意需要<code class="du kx ky kz la b">delimiter</code>选项，因为列分隔符不是逗号。</p><pre class="lp lq lr ls fd lt la lu lv aw lw bi"><span id="25fe" class="lb ig hi la b fi lx ly l lz ma">flight_data_df = (spark.read<br/> .format(‘csv’)<br/> .options(header=’true’, inferSchema=’true’, delimiter=’|’)<br/> .load(‘dbfs:/demo_data/flight_data.csv’))</span></pre><h1 id="e924" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">旁白—加载文件</h1><p id="4e0d" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在企业环境中，数据将从像blob存储或数据湖存储这样的Azure服务中加载。由于增加了复杂性，我故意不想以这种方式加载文件。然而，我将在以后的文章中讨论这个场景。</p><h1 id="ae70" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">火花执行模型</h1><p id="a07b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在执行了前面的代码之后，注意到输出包含数据帧的模式和关于执行代码的<em class="kv"> Spark作业</em>的信息。</p><figure class="lp lq lr ls fd md er es paragraph-image"><div class="er es mt"><img src="../Images/c490545b68b3092861a291828ec03b60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*yh1aZQ5J4pzPpDuCZXr3rg.png"/></div></figure><p id="55ba" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">数据帧包括两个空列，<code class="du kx ky kz la b">_c0</code>和<code class="du kx ky kz la b">c_17</code>。让我们移除它们。这是一个在分析之前通常需要清理数据集的例子。在单元格中运行下面的代码。</p><pre class="lp lq lr ls fd lt la lu lv aw lw bi"><span id="83c3" class="lb ig hi la b fi lx ly l lz ma">flight_data_df = flight_data_df.drop(‘_c0’, ‘_c17’)</span></pre><p id="a81b" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">输出显示了数据框的新方案。栏目都没有了，但是Spark工作信息在哪里呢？</p><p id="28b9" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">在过去的一篇文章中，我提到Spark会推迟查询的执行，直到您想看到数据。所以让我们来看看数据(或者无论如何是部分数据):</p><pre class="lp lq lr ls fd lt la lu lv aw lw bi"><span id="4e42" class="lb ig hi la b fi lx ly l lz ma">flight_data_df.show()</span></pre><p id="1b22" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">我们看到了最终的工作:</p><figure class="lp lq lr ls fd md er es paragraph-image"><div class="er es mu"><img src="../Images/9cfbb74f2012df98f7c9082d0b7e0946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*xirexbyo4A819-ALMjs32w.png"/></div></figure><h1 id="40d9" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">清除</h1><p id="0b6e" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">请删除资源组以避免产生额外成本。在PowerShell会话中运行以下命令:</p><pre class="lp lq lr ls fd lt la lu lv aw lw bi"><span id="3d99" class="lb ig hi la b fi lx ly l lz ma">az group delete — name $resourceGroupName — yes</span></pre><h1 id="3785" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">结论</h1><p id="8515" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果你读到这里，感谢你的阅读！希望你对Azure Databricks有了一个有用的概述，并开始你自己的Azure Databricks之旅。</p></div></div>    
</body>
</html>