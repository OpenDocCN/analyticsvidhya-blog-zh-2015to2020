<html>
<head>
<title>Tensorflow Lite(TFLite) with Golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带Golang的Tensorflow Lite(TFLite)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/tensorflow-lite-tflite-with-golang-37a326c089ff?source=collection_archive---------4-----------------------#2020-07-18">https://medium.com/analytics-vidhya/tensorflow-lite-tflite-with-golang-37a326c089ff?source=collection_archive---------4-----------------------#2020-07-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2ec652941a34cd871448c54544c33601.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ylzNw8zdNKKXc9mJOtS4Q.png"/></div></div></figure><p id="00d7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://www.tensorflow.org/lite" rel="noopener ugc nofollow" target="_blank"> Tensorflow Lite </a>俗称TFLite，用于在移动和物联网(边缘)设备上生成和推断机器学习模型。TFLite使得多种设备架构的设备上(离线)推断更加容易，比如Android、iOS、Raspberry pi甚至后端服务器。使用TFLite，您可以使用任何编程语言和轻量级模型来构建基于轻量级服务器的推理应用程序，而不是使用笨重的Tensorflow模型。</p><p id="e5db" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">作为开发人员，我们可以简单地使用现有的优化研究<a class="ae jo" href="https://www.tensorflow.org/lite/models" rel="noopener ugc nofollow" target="_blank">模型</a>或将现有的Tensorflow模型转换为TFLite。在您的移动、物联网或服务器应用中，有多种方式使用TFLite。</p><ul class=""><li id="2feb" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">使用TFLite提供的<a class="ae jo" href="https://www.tensorflow.org/lite/guide/get_started#3_run_inference_with_the_model" rel="noopener ugc nofollow" target="_blank">标准库、SDK</a>实现不同架构(Android、iOS等)的推理。</li><li id="125b" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">使用<a class="ae jo" href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/lite/c/README.md" rel="noopener ugc nofollow" target="_blank"> TFLite C API </a>进行推理，同时使用独立于平台的编程语言，如<a class="ae jo" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank"> Golang </a>。并且<strong class="is hj">为Android、iOS等平台交叉编译</strong>...</li></ul></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><p id="f822" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我将展示使用平台无关语言Golang和交叉编译共享库的TFLite推理应用程序的实现。然后可以被Android、iOS等使用…</p><p id="49bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先感谢<a class="ae jo" href="https://github.com/mattn" rel="noopener ugc nofollow" target="_blank"> mattn </a>创建了TFLite Go绑定，你可以在这里找到repo <a class="ae jo" href="https://github.com/mattn/go-tflite" rel="noopener ugc nofollow" target="_blank">。我们将开始实现一个简单的Golang应用程序，用于TFLite推断(您可以在这里找到示例</a><a class="ae jo" href="https://github.com/duladissa/go-tflite/tree/cross_compilation_support/_example/cross_complie" rel="noopener ugc nofollow" target="_blank"/>)。在这里，我使用一个简单的文本分类器，它将分类为“积极”或“消极”。</p><p id="4461" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是classifier.go，它有go函数，并被<strong class="is hj">导出</strong>供C代码使用。</p><figure class="kk kl km kn fd ij"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="0a85" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Build() : </strong>函数将初始化go运行时环境中的所有对象引用，并返回内存指针以备将来使用。</p><p id="4c07" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Classify(appPointer不安全。Pointer，word *C.char) : </strong>函数会接受Build()函数返回的appPointer和word a C字符串的输入。</p><p id="d3ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> //export : </strong>用于导出要在C代码中使用的Go函数。</p><p id="80b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更多关于cgo的信息你可以在这里找到<a class="ae jo" href="https://golang.org/cmd/cgo/" rel="noopener ugc nofollow" target="_blank"/>。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><p id="4590" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们已经在classifier.go中实现了文本分类的Golang。下一个大挑战是将上述文本分类器的<strong class="is hj">交叉编译</strong>到一个共享库。在Golang中，您可以构建针对特定操作系统和架构的应用程序。我们示例中使用的重要Go命令。</p><pre class="kk kl km kn fd kq kr ks kt aw ku bi"><span id="968e" class="kv kw hi kr b fi kx ky l kz la">GOARCH      - target architecture<br/>GOOS        - target operating system<br/>buildmode   - which kind of object file is to be built. More info <a class="ae jo" href="https://golang.org/cmd/go/#hdr-Build_modes" rel="noopener ugc nofollow" target="_blank">here</a><br/>CGO_ENABLED - Whether the cgo command is supported. In this case it's 1</span></pre><p id="d485" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以在这里找到支持的GOOS和GOARCH信息<a class="ae jo" href="https://gist.github.com/asukakenji/f15ba7e588ac42795f421b48b8aede63" rel="noopener ugc nofollow" target="_blank">或者你可以通过运行下面的命令得到它。</a></p><pre class="kk kl km kn fd kq kr ks kt aw ku bi"><span id="b23a" class="kv kw hi kr b fi kx ky l kz la">go tool dist list | column -c 75 | column -t</span><span id="b164" class="kv kw hi kr b fi lb ky l kz la">Output :</span><span id="43ed" class="kv kw hi kr b fi lb ky l kz la">aix/ppc64        freebsd/amd64   linux/mipsle   openbsd/386<br/>android/386      freebsd/arm     linux/ppc64    openbsd/amd64<br/>android/amd64    illumos/amd64   linux/ppc64le  openbsd/arm<br/>android/arm      js/wasm         linux/s390x    openbsd/arm64<br/>android/arm64    linux/386       nacl/386       plan9/386<br/>darwin/386       linux/amd64     nacl/amd64p32  plan9/amd64<br/>darwin/amd64     linux/arm       nacl/arm       plan9/arm<br/>darwin/arm       linux/arm64     netbsd/386     solaris/amd64<br/>darwin/arm64     linux/mips      netbsd/amd64   windows/386<br/>dragonfly/amd64  linux/mips64    netbsd/arm     windows/amd64<br/>freebsd/386      linux/mips64le  netbsd/arm64   windows/arm</span></pre><p id="00c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是我为生成Linux、Macos、Android和iOS的共享库而创建的Makefile。</p><figure class="kk kl km kn fd ij"><div class="bz dy l di"><div class="ko kp l"/></div></figure></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><p id="fd2a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，您可以使用上面生成的共享库(。所以还是。a)在Android和iOS中。在Android中，你可以通过JNI(Java Native Interface)使用共享库，在iOS中，你可以将它用作框架模块。对于flutter，你也可以使用dart:ffi(外部函数接口)。</p><p id="7619" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可以找到文本分类器<a class="ae jo" href="https://github.com/duladissa/go-tflite/blob/cross_compilation_support/_example/cross_complie" rel="noopener ugc nofollow" target="_blank">的实现https://github . com/dula dissa/go-TF lite/blob/cross _ compilation _ support/_ example/cross _ complie</a></p></div></div>    
</body>
</html>