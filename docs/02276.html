<html>
<head>
<title>Image segmentation with YOLOv3 and GrabCut</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用YOLOv3和GrabCut进行图像分割</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/image-segmentation-with-yolov3-and-grabcut-59a0abaafa3e?source=collection_archive---------5-----------------------#2019-12-09">https://medium.com/analytics-vidhya/image-segmentation-with-yolov3-and-grabcut-59a0abaafa3e?source=collection_archive---------5-----------------------#2019-12-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="5420" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">YOLOv3和GrabCut的组合</h2></div><blockquote class="ix iy iz"><p id="6b16" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">被困在付费墙后面？点击这个<a class="ae jx" rel="noopener" href="/analytics-vidhya/image-segmentation-with-yolov3-and-grabcut-59a0abaafa3e?source=friends_link&amp;sk=b05259efad6d0254e9393b38b3466294">好友链接</a>！</p></blockquote></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="a796" class="kf kg hi bd kh ki kj kk kl km kn ko kp io kq ip kr ir ks is kt iu ku iv kv kw bi translated">动机</h1><p id="c8ef" class="pw-post-body-paragraph ja jb hi jd b je kx ij jg jh ky im jj kz la jm jn lb lc jq jr ld le ju jv jw hb bi translated">《YOLO》是一部以高FPS进行物体检测的惊艳之作，作者在过去几年里做了很多改动，分别是YOLOv2和YOLOv3。</p><p id="032f" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kz jl jm jn lb jp jq jr ld jt ju jv jw hb bi translated">事实上，GrabCut[1]是一个有趣的算法，它使用用户提供的矩形进行图像分割。如论文所示，GrabCut给了我们一个诱人的图像分割结果。</p><figure class="lg lh li lj fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lf"><img src="../Images/755e9e2d21408393d6b915be791e8570.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rA_ispl2IP_ZQvzlj0EP8Q.jpeg"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">原象</figcaption></figure><figure class="lg lh li lj fd lk er es paragraph-image"><div class="er es lv"><img src="../Images/274d283cfa3905277fba4db45ac3125b.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/format:webp/1*9cvth5twNnk73nTNznC4lA.jpeg"/></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">GrabCut应用于下图，红色加粗矩形。这两幅图像取自[1]。</figcaption></figure><p id="868e" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kz jl jm jn lb jp jq jr ld jt ju jv jw hb bi translated">总而言之，对象检测使用边界框来指示用户对象的位置，而GrabCut应用矩形或边界框来进行图像分割。当我在写毕业论文的时候，我突然想到，是否有可能将这两个看似不相关的东西结合在一起，这样我们就可以创建一个速度快、效果好的图像分割系统。因此，我做了这个兼职项目，并把结果和想法写在这个帖子里。此外，我还展示了如何在自定义数据集上应用这样的图像分割系统。</p><h1 id="cac3" class="kf kg hi bd kh ki lw kk kl km lx ko kp io ly ip kr ir lz is kt iu ma iv kv kw bi translated">什么是GrabCut</h1><p id="04bf" class="pw-post-body-paragraph ja jb hi jd b je kx ij jg jh ky im jj kz la jm jn lb lc jq jr ld le ju jv jw hb bi translated">GrabCut是一种交互式前景提取，它通过提供一个矩形来分割所需的对象。你在前景区域周围画一个矩形(确保你的前景完全在矩形内！).接下来，该算法尝试通过应用特定迭代来分割对象。更多信息可以阅读官方OpenCV教程中的<a class="ae jx" href="https://docs.opencv.org/master/d8/d83/tutorial_py_grabcut.html" rel="noopener ugc nofollow" target="_blank">这篇帖子</a>。</p><h1 id="b95e" class="kf kg hi bd kh ki lw kk kl km lx ko kp io ly ip kr ir lz is kt iu ma iv kv kw bi translated">准备</h1><ol class=""><li id="d429" class="mb mc hi jd b je kx jh ky kz md lb me ld mf jw mg mh mi mj bi translated">克隆这个回购。</li><li id="888c" class="mb mc hi jd b je mk jh ml kz mm lb mn ld mo jw mg mh mi mj bi translated">从<a class="ae jx" href="https://drive.google.com/file/d/1L6JgzbFhC7Bb_5w_V-stAkPSgMplvsmq/view?usp=sharing" rel="noopener ugc nofollow" target="_blank"> my Google Drive </a>下载预训练的权重，并将其放入<code class="du mp mq mr ms b">yolo-fish</code>目录。</li><li id="3dc4" class="mb mc hi jd b je mk jh ml kz mm lb mn ld mo jw mg mh mi mj bi translated">创建<code class="du mp mq mr ms b">conda</code>虚拟环境并安装依赖项:<br/>T2</li><li id="bc40" class="mb mc hi jd b je mk jh ml kz mm lb mn ld mo jw mg mh mi mj bi translated">激活虚拟环境。</li><li id="037a" class="mb mc hi jd b je mk jh ml kz mm lb mn ld mo jw mg mh mi mj bi">Run a demonstration with this command: <code class="du mp mq mr ms b">$ python main.py --image ./images/七星斑.jpg --yolo yolo-fish</code></li></ol><p id="fcfd" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kz jl jm jn lb jp jq jr ld jt ju jv jw hb bi translated">你会在<code class="du mp mq mr ms b">fish-yolo-grabcut</code>根目录下找到一个名为<code class="du mp mq mr ms b">grabcut0.jpg</code>的图片，应该是这样的:</p><figure class="lg lh li lj fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es mt"><img src="../Images/9770b957baa925b6381dca10525190bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UwkNoHwLonhUNTuFi7MwWA.jpeg"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">Result of 七星斑.jpg</figcaption></figure><h1 id="531d" class="kf kg hi bd kh ki lw kk kl km lx ko kp io ly ip kr ir lz is kt iu ma iv kv kw bi translated">说明</h1><p id="2cde" class="pw-post-body-paragraph ja jb hi jd b je kx ij jg jh ky im jj kz la jm jn lb lc jq jr ld le ju jv jw hb bi translated">你会想知道这种魔法是如何发生的，所以我将在这一节解释我是如何让这种魔法发生的。</p><p id="4314" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kz jl jm jn lb jp jq jr ld jt ju jv jw hb bi translated">对于YOLOv3对象检测部分，你可以在这里看到<a class="ae jx" rel="noopener" href="/@clh0524/a-detailed-guide-of-yolo-on-opencv-python-98890baa2d6?sk=de8b1e2523b1cc5a637db5a56a739ab7"/>，因为它相当罗嗦:)</p><p id="aed7" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kz jl jm jn lb jp jq jr ld jt ju jv jw hb bi translated">对于GrabCut部分，下面是创造这种奇迹的代码:</p><ol class=""><li id="b422" class="mb mc hi jd b je jf jh ji kz mu lb mv ld mw jw mg mh mi mj bi translated"><code class="du mp mq mr ms b">cv.grabCut(img, mask, rect, bgdModel, fgdModel, iterCount[, mode])</code>【2】这个函数用一个矩形对你的图像应用GrabCut，我们接下来要近距离看一些参数:<br/> (1) <code class="du mp mq mr ms b">img</code>:输入8位3通道图像，通常是彩色图像。<br/> (2) <code class="du mp mq mr ms b">mask</code>:输入输出8位单通道掩码。在这里，我将<code class="du mp mq mr ms b">img</code> <br/> (3) <code class="du mp mq mr ms b">rect</code>的宽度和高度设置为相同:ROI(感兴趣区域)包含一个分割的对象。矩形外的像素或ROI被认为是“确定的背景”。<br/> (4) <code class="du mp mq mr ms b">bgdModel</code>:背景模型临时数组。<br/> (5) <code class="du mp mq mr ms b">fgdModel</code>:前景模型的临时数组。<br/> (6) <code class="du mp mq mr ms b">iterCount</code>:在函数返回结果之前，算法必须进行的迭代次数。这里我设置为5。<br/> (7) <code class="du mp mq mr ms b">mode</code>:运行模式。我设置为<code class="du mp mq mr ms b">cv.GC_INIT_WITH_RECT</code>是因为我将使用YOLOv3生成的边界框来应用GrabCut。<br/>综上所述，你现在可以体会到<code class="du mp mq mr ms b">GrabCut.py</code>中所写代码的含义了:</li></ol><figure class="lg lh li lj fd lk"><div class="bz dy l di"><div class="mx my l"/></div></figure><p id="81c6" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kz jl jm jn lb jp jq jr ld jt ju jv jw hb bi translated">请注意，我使用输入图像的deepcopy，因为可能有不止一个检测，我不想覆盖输入图像(将在以下要点中解释)。</p><p id="ca15" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kz jl jm jn lb jp jq jr ld jt ju jv jw hb bi translated">2.应用GrabCut后的后处理，该函数将返回修改后的<code class="du mp mq mr ms b">mask</code>、<code class="du mp mq mr ms b">bgdModel</code>和<code class="du mp mq mr ms b">fgdModel</code>。我们可以通过这些代码得到分割结果:</p><figure class="lg lh li lj fd lk"><div class="bz dy l di"><div class="mx my l"/></div></figure><p id="fc26" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kz jl jm jn lb jp jq jr ld jt ju jv jw hb bi translated">你可以看到我在这里修改了<code class="du mp mq mr ms b">image</code>(第23行)；因此，我在上面的点上做了一个深拷贝。</p><p id="280e" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kz jl jm jn lb jp jq jr ld jt ju jv jw hb bi translated">此外，我将<code class="du mp mq mr ms b">image</code>添加到列表<code class="du mp mq mr ms b">imgs</code>中，因为可能有不止一个检测。</p><h1 id="6d33" class="kf kg hi bd kh ki lw kk kl km lx ko kp io ly ip kr ir lz is kt iu ma iv kv kw bi translated">结论和想法</h1><p id="babc" class="pw-post-body-paragraph ja jb hi jd b je kx ij jg jh ky im jj kz la jm jn lb lc jq jr ld le ju jv jw hb bi translated">在这篇文章中，我举例说明了如何结合YOLOv3和GrabCut来创建一个图像分割系统，并在我的自定义数据集上展示了结果。此外，我还解释了如何使用OpenCV GrabCut函数，以及在应用GrabCut时需要注意的一些问题。</p><p id="ba3e" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kz jl jm jn lb jp jq jr ld jt ju jv jw hb bi translated">由于这些想法，我发现结果不如GrabCut论文中显示的结果有吸引力，但我认为我可以通过重新训练YOLOv3来改善这一点，以便它可以进行更精确的检测来改善GrabCut的结果。</p><h1 id="6884" class="kf kg hi bd kh ki lw kk kl km lx ko kp io ly ip kr ir lz is kt iu ma iv kv kw bi translated">参考</h1><p id="94f5" class="pw-post-body-paragraph ja jb hi jd b je kx ij jg jh ky im jj kz la jm jn lb lc jq jr ld le ju jv jw hb bi translated">[1]<a class="ae jx" href="https://cvg.ethz.ch/teaching/cvl/2012/grabcut-siggraph04.pdf" rel="noopener ugc nofollow" target="_blank">https://cvg . ethz . ch/teaching/CVL/2012/grab cut-siggraph 04 . pdf</a></p><p id="8ffb" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kz jl jm jn lb jp jq jr ld jt ju jv jw hb bi translated">[2]<a class="ae jx" href="https://docs.opencv.org/master/d7/d1b/group__imgproc__misc.html#ga909c1dda50efcbeaa3ce126be862b37f" rel="noopener ugc nofollow" target="_blank">https://docs . opencv . org/master/D7/d1b/group _ _ imgproc _ _ misc . html # ga 909 C1 DDA 50 efcbeaa 3a ce 126 be 862 b 37 f</a></p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><blockquote class="ix iy iz"><p id="6d47" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><em class="hi">如果你有什么想法和问题要分享，请联系我</em><a class="ae jx" href="http://clh960524@gmail.com/" rel="noopener ugc nofollow" target="_blank"><strong class="jd hj"><em class="hi">clh 960524【at】Gmail . com</em></strong></a><em class="hi">。还有，其他作品可以查看我的</em> <a class="ae jx" href="https://github.com/Cuda-Chen" rel="noopener ugc nofollow" target="_blank"> <em class="hi"> GitHub库</em> </a> <em class="hi">。如果你和我一样热衷于机器学习、图像处理和并行计算，可以随时在LinkedIn上</em> <a class="ae jx" href="https://www.linkedin.com/in/lu-hsuan-chen-78071b171/" rel="noopener ugc nofollow" target="_blank"> <em class="hi">添加我</em> </a> <em class="hi">。</em></p></blockquote></div></div>    
</body>
</html>