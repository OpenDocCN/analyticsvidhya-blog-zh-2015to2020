<html>
<head>
<title>Plotting the Pandemic with Python and Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python和Plotly绘制疫情</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/plotting-the-pandemic-with-python-and-plotly-e8011a141e3c?source=collection_archive---------6-----------------------#2020-04-17">https://medium.com/analytics-vidhya/plotting-the-pandemic-with-python-and-plotly-e8011a141e3c?source=collection_archive---------6-----------------------#2020-04-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/7fa66d3ecac2a689356c38bb4485c765.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*fscpR6EV2rClEWwhti94tA.png"/></div></figure><h2 id="5edd" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">使用Python、Plotly和Elastic Beanstalk创建和部署您自己的交互式仪表板，以监控新冠肺炎疫情的进度。</h2><p id="351b" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke hb bi translated">可视化是理解和交流数据含义的强大工具。当前对新冠肺炎疫情进展数据的日常饮食中的真理和意义的探索激发了许多令人敬畏的数据可视化的例子。</p><p id="ef46" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">这篇博客详细介绍了如何使用新冠肺炎数据构建自己的引人注目的交互式图表，将它们包装到仪表板中，并使用开源软件将其部署到互联网上。这里的可以找到一个例子<a class="ae kk" href="http://www.randomseed42.co.uk/" rel="noopener ugc nofollow" target="_blank">。所有的代码都可以在</a><a class="ae kk" href="https://github.com/LUNDR/covid-19" rel="noopener ugc nofollow" target="_blank"> github </a>上找到。</p><p id="3689" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">该博客分为5个部分，带您了解设置和配置、一个示例可视化的编码(一段时间内新冠肺炎案例的动画地图)以及创建随时可部署的dash应用程序:</p><ol class=""><li id="4b6b" class="kl km hi jm b jn kf jr kg ix kn jb ko jf kp ke kq kr ks kt bi translated">编码设置</li><li id="5c9f" class="kl km hi jm b jn ku jr kv ix kw jb kx jf ky ke kq kr ks kt bi translated">读入和争论数据</li><li id="dfe3" class="kl km hi jm b jn ku jr kv ix kw jb kx jf ky ke kq kr ks kt bi translated">用plotly创建交互式图表</li><li id="e365" class="kl km hi jm b jn ku jr kv ix kw jb kx jf ky ke kq kr ks kt bi translated">使用dash创建仪表板</li><li id="5e13" class="kl km hi jm b jn ku jr kv ix kw jb kx jf ky ke kq kr ks kt bi translated">将应用部署到AWS Elastic Beanstalk</li></ol><h1 id="27cf" class="kz in hi bd io la lb lc is ld le lf iw lg lh li ja lj lk ll je lm ln lo ji lp bi translated">1.编码设置</h1><p id="b26a" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke hb bi translated"><strong class="jm hj">软件</strong></p><p id="e918" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">在数据科学的世界里，有许多不同的软件和操作系统可以使用，这取决于资源和喜好。作为最低要求，你需要Python 3.5+和git来进行版本控制。还推荐使用代码编辑器和包管理器。我使用以下内容:</p><ul class=""><li id="702e" class="kl km hi jm b jn kf jr kg ix kn jb ko jf kp ke lq kr ks kt bi translated">Python 3.7</li><li id="98cb" class="kl km hi jm b jn ku jr kv ix kw jb kx jf ky ke lq kr ks kt bi translated">包管理器:Anaconda 4.8.3</li><li id="185a" class="kl km hi jm b jn ku jr kv ix kw jb kx jf ky ke lq kr ks kt bi translated">版本控制:git</li><li id="ba9f" class="kl km hi jm b jn ku jr kv ix kw jb kx jf ky ke lq kr ks kt bi translated">编辑:Spyder，Jupyter Lab和Notepad++</li><li id="112a" class="kl km hi jm b jn ku jr kv ix kw jb kx jf ky ke lq kr ks kt bi translated">操作系统:Windows 10</li></ul><p id="186e" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">如果你有一个不同的设置，下面的说明不会有很大的不同，但是请记住，终端中的一些命令可能是不同的，你可能需要安装额外的依赖项。</p><p id="b3d3" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated"><strong class="jm hj">版本控制</strong></p><p id="b5ed" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">使用版本控制是一个很好的实践，当您开始部署时会用到它。假设您已经安装了git，那么您可以从终端完成这项工作。</p><p id="d47e" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">打开conda终端(从windows的开始菜单)并创建一个新目录。请注意，如果您使用的是Linux操作系统，您将需要使用正斜杠，而不是反斜杠。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="bd09" class="im in hi lw b fi ma mb l mc md">mkdir .\covid-app</span></pre><p id="1064" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">进入那个目录。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="b51e" class="im in hi lw b fi ma mb l mc md">cd .\covid-app</span></pre><p id="292c" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">制作一个自述文件(标题为“新冠肺炎app”)。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="1943" class="im in hi lw b fi ma mb l mc md">echo "# covid-19 app" &gt;&gt; readme.md</span></pre><p id="1050" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">开始版本控制。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="3753" class="im in hi lw b fi ma mb l mc md">git init</span></pre><p id="41bb" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">将自述文件添加到版本控制中。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="cd8f" class="im in hi lw b fi ma mb l mc md">git add readme.md</span></pre><p id="37c3" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">提交文件。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="de41" class="im in hi lw b fi ma mb l mc md">git commit -m "first-commit"</span></pre><p id="f794" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">(可选)如果您有一个github帐户，您现在可以在那里建立一个存储库并链接到它。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="4b66" class="im in hi lw b fi ma mb l mc md">git remote add origin remote repository [repository url] <br/>git remote -v git push origin master</span></pre><p id="2d1d" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">瞧。您已经设置了版本控制。</p><p id="60f3" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated"><strong class="jm hj">创造新环境</strong></p><p id="115d" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">人们会忘记这样做。这一点很重要，因为在安装互相冲突的包时，你可能会陷入混乱。如果你已经在一个环境中做了，事情出错了，很容易关闭环境并重新开始。如果你没有，你可能会面临一个配置/卸载的噩梦。</p><p id="c1a0" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">在conda终端中，创建一个新环境，并使用一个您会记住的名称。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="81ac" class="im in hi lw b fi ma mb l mc md">conda create --name [environment-name]</span></pre><p id="08a8" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">然后进入环境(每次打开终端时都必须这样做)。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="2adc" class="im in hi lw b fi ma mb l mc md">conda activate [environment-name]</span></pre><p id="6cd1" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated"><strong class="jm hj">配置</strong></p><p id="c8fa" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">在您的环境中，您需要安装几个额外的包</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="19ee" class="im in hi lw b fi ma mb l mc md">conda install jupyterlab plotly dash palettable</span></pre><p id="2d31" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">如果你不安装jupyterlab，那么你需要单独安装pandas和numpy。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="aaec" class="im in hi lw b fi ma mb l mc md">conda install pandas numpy</span></pre><p id="468f" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">要设计应用程序，您需要安装(conda不提供)。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="4731" class="im in hi lw b fi ma mb l mc md">pip install dash_bootstrap_components</span></pre><p id="5039" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">为了让plotly图表显示在<strong class="jm hj"> jupyter笔记本</strong>中，你还需要一些附加组件，按照<a class="ae kk" href="https://plotly.com/python/getting-started/#jupyterlab-support-python-35" rel="noopener ugc nofollow" target="_blank"> plotly文档</a>中的说明进行操作</p><h1 id="7ff7" class="kz in hi bd io la lb lc is ld le lf iw lg lh li ja lj lk ll je lm ln lo ji lp bi translated">2.读入和争论数据</h1><p id="7a9e" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke hb bi translated">在您的新冠肺炎应用文件夹中，创建一个新的。py或ipynb文件，并使用pandas导入数据。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="6ab4" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">这些数据来自欧洲疾病预防和控制中心，该中心(在撰写本文时)每天发布各国病例和死亡的最新情况。与所有数据一样，您应该了解您正在绘制的内容，以及它的注意事项和限制。你可以在他们的<a class="ae kk" href="https://www.ecdc.europa.eu/en" rel="noopener ugc nofollow" target="_blank">网站</a>上了解更多。</p><p id="1816" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">如果你看一眼，</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="2446" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">这些数据通常非常干净，所以幸运的是没有太多事情要做。但是,“dateRep”列(即日期)不会被识别为日期时间对象，而是按照从最近到最早的顺序排列。如果不加以纠正，它会给我们以后带来问题。</p><p id="bb6c" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated"><strong class="jm hj">日期格式</strong></p><p id="1fa9" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">要纠正该问题:</p><ul class=""><li id="e783" class="kl km hi jm b jn kf jr kg ix kn jb ko jf kp ke lq kr ks kt bi translated">将“日期报告”列转换为日期时间</li><li id="7c3e" class="kl km hi jm b jn ku jr kv ix kw jb kx jf ky ke lq kr ks kt bi translated">按照每个国家的时间顺序对数据进行重新排序</li><li id="f597" class="kl km hi jm b jn ku jr kv ix kw jb kx jf ky ke lq kr ks kt bi translated">重新索引数据以防止创建聚合时出错</li></ul><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="bf6b" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated"><strong class="jm hj">创建“全球”/“世界”数据集合</strong></p><p id="968c" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">我们还对每天的全球病例和死亡总数感兴趣，但是你会看到它不在数据集中，所以我们需要创建它。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="dfe9" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">要为整个世界创建条目:</p><ul class=""><li id="5afd" class="kl km hi jm b jn kf jr kg ix kn jb ko jf kp ke lq kr ks kt bi translated">创建一个汇总所有国家/地区的图表。</li><li id="c369" class="kl km hi jm b jn ku jr kv ix kw jb kx jf ky ke lq kr ks kt bi translated">为<em class="mg">数据中的每一列添加新“World”系列的值。</em></li><li id="18d7" class="kl km hi jm b jn ku jr kv ix kw jb kx jf ky ke lq kr ks kt bi translated">将“World”的值添加到原始数据集中。</li></ul><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="1f43" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated"><strong class="jm hj">按国家创建累计病例和死亡总数</strong></p><p id="bd13" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">数据集只包含每天的数字，我们希望绘制出病例和死亡是如何随着时间的推移而累积的。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="6062" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated"><strong class="jm hj">创建变量，根据大陆给出颜色</strong></p><p id="cc47" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">首先，读入一个文件，该文件通过三个字母的ISO-3代码(存在于两个数据集中)将国家和大陆进行匹配，然后将其合并到<em class="mg">数据中。</em>最后创建一个颜色字典，将各大洲用一种颜色映射，这将在以后使用。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="4082" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated"><strong class="jm hj">创建一个字符串形式的日期列表</strong></p><p id="c94b" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">对于将日期作为字符串的滑块，比使用日期时间格式更容易</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><h1 id="859e" class="kz in hi bd io la lb lc is ld le lf iw lg lh li ja lj lk ll je lm ln lo ji lp bi translated">3.用plotly创建交互式图表</h1><p id="6cfb" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke hb bi translated">我们现在准备开始制作一些图表。</p><p id="c9ab" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">正如许多软件包一样，在plotly中有多种方式来做事情，我只向您展示一种。下图显示了plotly地块的高级架构。导入plotly.graph_objects库后，您将构建一个“图形”字典，其中包含:</p><ul class=""><li id="3692" class="kl km hi jm b jn kf jr kg ix kn jb ko jf kp ke lq kr ks kt bi translated">一个<strong class="jm hj">‘数据’</strong>元素。词典列表。列表中的每个字典定义了图表的类型(如散点图/条形图)和要绘制的数据。如果您想要在同一个图表上显示多个系列(也称为轨迹)，您可以将更多的词典添加到列表中。</li><li id="c8e1" class="kl km hi jm b jn ku jr kv ix kw jb kx jf ky ke lq kr ks kt bi translated">(可选)<strong class="jm hj">‘布局’</strong>参数，用于控制图表布局的几乎每个方面。你可以在plotly <a class="ae kk" href="https://plotly.com/python-api-reference/generated/plotly.graph_objects.Layout.html" rel="noopener ugc nofollow" target="_blank">文档</a>中读到更多</li><li id="c01e" class="kl km hi jm b jn ku jr kv ix kw jb kx jf ky ke lq kr ks kt bi translated">(可选)如果您要添加任何形式的动画，您还需要将一个字典列表传递到<strong class="jm hj">‘frames’</strong>元素中，该元素定义了在动画的每一帧应该绘制什么样的vie图表。</li></ul><p id="1ed4" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">然后调用<code class="du mh mi mj lw b">go.Figure()</code>来创建图表。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="fdfc" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">它应该是这样的:</p><figure class="lr ls lt lu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="er es mk"><img src="../Images/5c8623f496c43150e3a7f64e46645cec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hIaxsTuZpF4ICVJT_ZfthQ.png"/></div></div><figcaption class="mp mq et er es mr ms bd b be z dx translated">基本图表</figcaption></figure><p id="4696" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">现在，我们准备构建一个稍微复杂一点的东西，看起来像这样，有一个滑块显示随时间变化的快照，还有一个“播放”按钮启动一个动画，显示随时间变化的案例。</p><figure class="lr ls lt lu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="er es mk"><img src="../Images/321e55ba5399f171fc0549cf72a7b6c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6hag5Gq883LNjdifeXosWg.png"/></div></div></figure><p id="4b01" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated"><strong class="jm hj">构建新冠肺炎病例总数的动画地图</strong></p><p id="3848" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">首先，初始化图形字典。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="9b94" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated"><strong class="jm hj">“数据”</strong></p><p id="656a" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">要创建“数据”元素，请选择加载图表时希望作为默认视图的日期——我已经将其设置为最近的一天。然后对数据集进行子集划分，只包含当天的数据。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="ddf9" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">因为我们希望每个大陆在地图上有自己的系列(颜色),我们将循环遍历各个大陆，为每个大陆创建单独的轨迹，这些轨迹将一起出现在地图上。在每一个循环中，根据上面创建的“颜色”字典，给大陆分配一种颜色。然后，在创建跟踪字典之前，数据按洲名(“cont”)进一步细分。在每个循环结束时，为每个洲创建的data_dict被附加到<em class="mg">图</em>字典的数据元素中。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="06f8" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">因为我们想让这个图表随着时间的推移而动画化，所以我们需要定义帧。这些将是上面为图中的“数据”元素定义的相同图表，但是重新绘制了数据集中每个日期的数据。我们将通过采用与上面相同的代码来实现这一点，但是添加了一个额外的循环，以便也可以循环几天。</p><p id="e3d3" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">同时，我们将需要捕获步骤列表。步长是布局参数，它将帧链接到滑块上的日期，并定义如何在帧之间切换。</p><p id="1052" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">在我们进入循环之前，我们创建空列表来捕获帧和步骤。在外部循环中，我们创建了一个<em class="mg">‘frame’</em>字典，它将收集每天的所有踪迹。在内部循环结束时，它被附加到<em class="mg">图形</em>字典的“帧”元素中。每次外部循环在新的一天开始时，都会重新创建<em class="mg">帧</em>字典。</p><p id="c299" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">在每个外部循环(代表一天)中，还定义了一个<em class="mg">‘step’</em>字典。然后，在每个循环结束时，将其添加到<em class="mg">‘步骤’</em>列表中。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="e97f" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">现在我们已经有了添加滑块所需的步骤。这是通过在列表中创建一个字典来实现的，它是整个图形的“布局”字典的一个参数。“步骤”列表作为一个参数添加到滑块字典中。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="df03" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">最后，我们需要定义布局。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="36dd" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">最后，我们可以将整个图形放在一起，并存储为“map1”</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="60fe" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">地图的整个代码应该如下所示:</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="90aa" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">到目前为止，我们已经读入了数据，添加了一些额外的功能，并创建了一个交互式的动画图表。但这一切仍然只在我们的代码编辑器/终端中运行。现在我们需要准备部署。</p><h1 id="8de0" class="kz in hi bd io la lb lc is ld le lf iw lg lh li ja lj lk ll je lm ln lo ji lp bi translated">4.使用dash创建仪表板</h1><p id="22a5" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke hb bi translated">一旦您创建了一个或多个图形，您可以使用dash将它们一起放入仪表板。Dash允许您创建一个由plotly构建的相对简单的方法来完成这项工作。</p><p id="9f44" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">导入所需的包后。你可以用几行代码创建你的第一个基于浏览器的应用。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="1674" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">运行上面的代码后，您应该会看到下面的消息。这意味着您的仪表板已启动并在本地运行。如果你将<code class="du mh mi mj lw b"><a class="ae kk" href="http://127.0.0.1:8050/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8050/</a></code>粘贴到你的浏览器中，你应该会看到地图出现，并且是完全交互式的。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="68d8" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated"><strong class="jm hj">创建更复杂的仪表板</strong></p><p id="0e84" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">您可以添加更多的图表到您的仪表板，包括进一步的。Div术语。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="a826" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">您还可以通过在“样式”字典中包含css样式参数来设置仪表板的样式。您还可以通过更新初始应用程序定义来导入现成的样式表。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="01d3" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">你的应用程序更复杂的样式将引导你进入HTML和CSS如果你不熟悉这些，有很多很好的解释，比如<a class="ae kk" href="https://www.w3schools.com/html/" rel="noopener ugc nofollow" target="_blank"> W3学校</a>，在dash框架中增加元素非常容易。</p><h1 id="4b85" class="kz in hi bd io la lb lc is ld le lf iw lg lh li ja lj lk ll je lm ln lo ji lp bi translated">5.将应用部署到AWS Elastic Beanstalk</h1><p id="946b" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke hb bi translated">现在你已经创建了你的应用程序，你希望其他人能够看到你的创造性天才的成果。你想通过互联网提供它。同样，有许多途径可以做到这一点。我选择弹性豆茎是因为它的灵活性和可伸缩性。有了一个简单的仪表板(就像这样)，你可以很高兴地部署到heroku或亚马逊S3。然而，如果你正在考虑构建一些更复杂的需要用户输入(因此需要回调)的东西，那么elastic beanstalk会更好；尤其是当你预计交通流量很大的时候。</p><p id="ee5d" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">部署前，您需要在covid19-app目录文件夹中创建一个“app”子文件夹，其中包含以下内容:</p><ul class=""><li id="9eb4" class="kl km hi jm b jn kf jr kg ix kn jb ko jf kp ke lq kr ks kt bi translated"><strong class="jm hj">application . py</strong>——包含dash应用代码。请注意，这必须称为“application.py ”,而不是app.py或任何其他名称。</li><li id="3d0e" class="kl km hi jm b jn ku jr kv ix kw jb kx jf ky ke lq kr ks kt bi translated"><strong class="jm hj"> figures.py </strong> —包含图表的代码。创建图表的代码可以放在应用程序文件的顶部，但是我发现把它们分开会更整洁，也更容易调试。</li><li id="1e5e" class="kl km hi jm b jn ku jr kv ix kw jb kx jf ky ke lq kr ks kt bi translated"><strong class="jm hj"> requirements.txt </strong> —包含需要安装在elastic beanstalk实例上的python包</li><li id="77c2" class="kl km hi jm b jn ku jr kv ix kw jb kx jf ky ke lq kr ks kt bi translated"><strong class="jm hj"> assets/ </strong> —包含任何图像、css文件和补充数据的文件夹。</li></ul><p id="a698" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated"><strong class="jm hj">更新application.py文件</strong></p><p id="b228" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">为了便于部署，应用程序代码需要看起来稍有不同。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="5690" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">请注意添加的<code class="du mh mi mj lw b">application = app.server</code>和对最后两行的更改。</p><p id="ab02" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">如果您已经将图表分离成figures.py，您还需要将它们导入application.py文件。</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="5beb" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated"><strong class="jm hj">创建一个requirements.txt文件</strong></p><p id="f712" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">该文件应该如下所示:</p><figure class="lr ls lt lu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="9e05" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated"><strong class="jm hj">建立AWS账户</strong></p><p id="b2c7" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">如果你没有AWS账户，那么你需要在<a class="ae kk" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/</a>办一个。我建议从第27步开始，遵循这篇<a class="ae kk" rel="noopener" href="/@miloharper/a-beginner-s-guide-to-creating-your-first-python-website-using-flask-aws-ec2-elastic-beanstalk-6a82b9be25e0">博客</a>中的指示。</p><p id="29d1" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated"><strong class="jm hj">安装AWS客户端</strong></p><p id="c3f2" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">接下来，您需要下载eb客户端。从您的终端运行:</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="3bb5" class="im in hi lw b fi ma mb l mc md">pip install awsebcli --upgrade --user</span></pre><p id="d83c" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">确保您在covid19-app/app文件夹中，然后初始化一个弹性beanstalk环境。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="2742" class="im in hi lw b fi ma mb l mc md">eb init</span></pre><p id="9dc5" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">出现提示时，选择您附近的地区。接受默认值，包括python版本——即使我在本地运行python 3.7，我也需要为Elastic Beanstalk选择3.6。当询问您是否要设置ssh时，选择“否”。当它询问您是否要使用“代码提交”时，也选择“否”。</p><p id="358c" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">接下来，确保应用程序文件夹中的所有文件夹和文件都已提交。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="1e4b" class="im in hi lw b fi ma mb l mc md">git add .<br/>git commit -m "commit in preparation from deploy"</span></pre><p id="80cb" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated"><strong class="jm hj">在环境中创建应用程序的实例</strong></p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="325b" class="im in hi lw b fi ma mb l mc md">eb create</span></pre><p id="ae1f" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">您可以接受默认设置，然后等待应用程序创建。完成后，您应该会看到一个“CNAME”链接。将该链接粘贴到您的浏览器中，您应该会看到您的应用程序出现。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="6d23" class="im in hi lw b fi ma mb l mc md">CNAME:<a class="ae kk" href="http://covid-app-dev.eu-west-2.elasticbeanstalk.com/" rel="noopener ugc nofollow" target="_blank">http://covid-app-dev.eu-west-2.elasticbeanstalk.com/</a></span></pre><p id="b2c8" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">如果您对应用程序代码进行了更改，只需git add、git commit和run</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="0f5a" class="im in hi lw b fi ma mb l mc md">eb deploy</span></pre><p id="4d5d" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">你的应用将会更新。</p><p id="a472" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">如果你看到一个错误，而不是你的应用程序，你可以检查日志。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="c6d9" class="im in hi lw b fi ma mb l mc md">eb logs</span></pre><p id="2ae2" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">日志会指出代码中的错误(通常是缺少逗号或不匹配的括号！)并帮你调试。</p><p id="213c" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">就这样，你开始运行了。现在有时间花无数的时间来设计和创建新的图表。</p><p id="2592" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated"><strong class="jm hj">参考文献:</strong></p><p id="25dd" class="pw-post-body-paragraph jk jl hi jm b jn kf jp jq jr kg jt ju ix kh jw jx jb ki jz ka jf kj kc kd ke hb bi translated">*<a class="ae kk" rel="noopener" href="/@miloharper/a-beginner-s-guide-to-creating-your-first-python-website-using-flask-aws-ec2-elastic-beanstalk-6a82b9be25e0">https://medium . com/@ Milo Harper/a-beginner-s-guide-to-creating-your-first-python-website-using-flask-AWS-ec2-elastic-beanstalk-6a 82 b 9 be 25 e 0</a>*<a class="ae kk" rel="noopener" href="/@austinlasseter/plotly-dash-and-the-elastic-beanstalk-command-line-89fb6b67bb79">https://medium . com/@ Austin lasser/plotly-dash-and-the-elastic-beanstalk-命令行-89fb6b67bb79 </a></p></div></div>    
</body>
</html>