<html>
<head>
<title>Tensorflow 2.1.0 in Azure Machine learning Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure机器学习服务中的Tensorflow 2.1.0</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/tensorflow-2-1-0-in-azure-machine-learning-service-8ae66497d5d5?source=collection_archive---------30-----------------------#2020-07-11">https://medium.com/analytics-vidhya/tensorflow-2-1-0-in-azure-machine-learning-service-8ae66497d5d5?source=collection_archive---------30-----------------------#2020-07-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/e2be0edf6b9f8c7c15394f5fb35939b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/0*dTqC4mw4RabTm6gp"/></div></figure><h1 id="5162" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">构建一个简单的Hello world张量流模型来测试张量流版本2.1.0</h1><h1 id="aeb4" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">首先将pip版本升级到最新版本</h1><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="5a92" class="jt in hi jp b fi ju jv l jw jx">!pip install --upgrade pip</span></pre><h1 id="e017" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">现在检查tensorflow版本，以确保我们有正确的版本</h1><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="0870" class="jt in hi jp b fi ju jv l jw jx">import tensorflow as tf print(tf.__version__)</span></pre><p id="703e" class="pw-post-body-paragraph jy jz hi ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">如果遇到问题，请检查依赖包的错误并进行pip安装。当我创建计算实例时，我的版本是2.1.0</p><h1 id="02d8" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">安装tensorflow</h1><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="a7a8" class="jt in hi jp b fi ju jv l jw jx">pip install --upgrade tensorflow</span></pre><p id="1a24" class="pw-post-body-paragraph jy jz hi ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">在这里可以找到最新版本的tensorflow软件包。</p><p id="85e7" class="pw-post-body-paragraph jy jz hi ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated"><a class="ae kw" href="https://www.tensorflow.org/install/pip" rel="noopener ugc nofollow" target="_blank">https://www.tensorflow.org/install/pip</a></p><p id="c87f" class="pw-post-body-paragraph jy jz hi ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">以上是设置必要的包。</p><p id="39f6" class="pw-post-body-paragraph jy jz hi ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">现在是时候开始编码了。</p><h1 id="c6e4" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">Hello world示例</h1><p id="0fb5" class="pw-post-body-paragraph jy jz hi ka b kb kx kd ke kf ky kh ki kj kz kl km kn la kp kq kr lb kt ku kv hb bi translated">导入tenforflow包。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="4ea7" class="jt in hi jp b fi ju jv l jw jx">import tensorflow as tf</span></pre><p id="80cc" class="pw-post-body-paragraph jy jz hi ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">加载数据集并拆分用于训练和测试。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="a6bc" class="jt in hi jp b fi ju jv l jw jx">mnist = tf.keras.datasets.mnist <br/>(x_train, y_train), (x_test, y_test) = mnist.load_data() x_train, x_test = x_train / 255.0, x_test / 255.0</span></pre><p id="05ae" class="pw-post-body-paragraph jy jz hi ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">现在构建深度神经网络架构</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="0e88" class="jt in hi jp b fi ju jv l jw jx">model = tf.keras.models.Sequential([ tf.keras.layers.Flatten(input_shape=(28, 28)), tf.keras.layers.Dense(128, activation='relu'), tf.keras.layers.Dropout(0.2), tf.keras.layers.Dense(10) ])</span></pre><p id="f7ab" class="pw-post-body-paragraph jy jz hi ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">现在训练模型</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="2dec" class="jt in hi jp b fi ju jv l jw jx">predictions = model(x_train[:1]).numpy() predictions</span></pre><p id="1bdf" class="pw-post-body-paragraph jy jz hi ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">将类转换为概率</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="e994" class="jt in hi jp b fi ju jv l jw jx">tf.nn.softmax(predictions).numpy()</span></pre><p id="9783" class="pw-post-body-paragraph jy jz hi ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">损失。SparseCategoricalCrossentropy loss接受一个logits向量和一个真实索引，并返回每个示例的标量损失。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="faa8" class="jt in hi jp b fi ju jv l jw jx">loss_fn = tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True)</span></pre><p id="0850" class="pw-post-body-paragraph jy jz hi ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">这个未经训练的模型给出的概率接近随机(每类1/10)，所以初始损失应该接近-tf.log(1/10) ~= 2.3。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="a4f9" class="jt in hi jp b fi ju jv l jw jx">loss_fn(y_train[:1], predictions).numpy()</span><span id="6de0" class="jt in hi jp b fi lc jv l jw jx">model.compile(optimizer='adam', loss=loss_fn, metrics=['accuracy'])</span></pre><p id="cb71" class="pw-post-body-paragraph jy jz hi ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">Model.fit方法调整模型参数以最小化损失:</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="bd23" class="jt in hi jp b fi ju jv l jw jx">model.fit(x_train, y_train, epochs=5)</span></pre><p id="eb68" class="pw-post-body-paragraph jy jz hi ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">用测试数据评估模型</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="144e" class="jt in hi jp b fi ju jv l jw jx">model.evaluate(x_test, y_test, verbose=2)</span></pre><p id="9f63" class="pw-post-body-paragraph jy jz hi ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">如果希望模型返回概率，可以包装定型模型，并将softmax附加到它:</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="4d8c" class="jt in hi jp b fi ju jv l jw jx">probability_model = tf.keras.Sequential([ model, tf.keras.layers.Softmax() ])</span></pre><p id="5100" class="pw-post-body-paragraph jy jz hi ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">显示输出</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="b1e1" class="jt in hi jp b fi ju jv l jw jx">probability_model(x_test[:5])</span></pre><p id="5d20" class="pw-post-body-paragraph jy jz hi ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">样本结束。</p></div><div class="ab cl ld le gp lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hb hc hd he hf"><p id="8f1f" class="pw-post-body-paragraph jy jz hi ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated"><em class="lk">最初发表于</em><a class="ae kw" href="https://github.com/balakreshnan/mlops/blob/master/tensorflow/tensorflowtest.md" rel="noopener ugc nofollow" target="_blank">T5【https://github.com】</a><em class="lk">。</em></p></div></div>    
</body>
</html>