<html>
<head>
<title>Server validation in Flask API with JSON schema</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有 JSON 模式的 Flask API 中的服务器验证</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/server-validation-in-flask-api-with-json-schema-963aa05e305f?source=collection_archive---------2-----------------------#2020-09-17">https://medium.com/analytics-vidhya/server-validation-in-flask-api-with-json-schema-963aa05e305f?source=collection_archive---------2-----------------------#2020-09-17</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><figure class="ew ey ih ii ij ik es et paragraph-image"><div role="button" tabindex="0" class="il im di in bf io"><div class="es et ig"><img src="../Images/40e0e9d064ec29ac6dea1f98b130d2fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7JcnPKLe-xA9zc3h"/></div></div><figcaption class="ir is eu es et it iu bd b be z dy translated">Aviv Perets 在<a class="ae iv" href="https://www.pexels.com/@avivperets" rel="noopener ugc nofollow" target="_blank"> pexels </a>上拍摄的照片</figcaption></figure><p id="c913" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">在 API 世界中，验证意味着检查发送的数据是好是坏。你永远不能完全依赖于只有客户端验证。因为你不知道客户端上发生了什么，所以你不能相信你收到的数据。即使你有一个私有的 API，有人仍然可以向你发送无效的请求。</p><p id="37d6" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">服务器端验证意味着检查多项内容:</p><ul class=""><li id="24c8" class="ju jv hj iy b iz ja jd je jh jw jl jx jp jy jt jz ka kb kc bi translated">预期的属性是什么</li><li id="4fbf" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated">他们有好的格式/类型吗</li><li id="57b5" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated">该属性是必需的吗</li></ul><h1 id="202a" class="ki kj hj bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">Json 模式</h1><p id="10ba" class="pw-post-body-paragraph iw ix hj iy b iz lg jb jc jd lh jf jg jh li jj jk jl lj jn jo jp lk jr js jt hc bi translated">JSON 模式是一种描述任何 JSON 数据实例的方式，就像在我们的 HTTP 请求或响应中发现的那样。</p><p id="20d5" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">关键字<strong class="iy hk"> <em class="ll"> type </em> </strong>会把你的属性限制在某个类型。有几个可能的值:</p><ul class=""><li id="35d1" class="ju jv hj iy b iz ja jd je jh jw jl jx jp jy jt jz ka kb kc bi translated">线</li><li id="4aa8" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated">数字</li><li id="21ac" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated">目标</li><li id="c584" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated">排列</li><li id="8ba0" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated">布尔型</li><li id="2773" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated">空</li></ul><h2 id="5420" class="lm kj hj bd kk ln lo lp ko lq lr ls ks jh lt lu kw jl lv lw la jp lx ly le lz bi translated">数字</h2><pre class="ma mb mc md fe me mf mg mh aw mi bi"><span id="9a2a" class="lm kj hj mf b fj mj mk l ml mm">"my_param": { "type": "number" }</span></pre><p id="b660" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">您可以使用附加参数确保您的参数在某个范围内:</p><ul class=""><li id="cee0" class="ju jv hj iy b iz ja jd je jh jw jl jx jp jy jt jz ka kb kc bi translated"><em class="ll"> x </em> ≥ <code class="dv mn mo mp mf b">minimum</code></li><li id="8205" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated"><em class="ll">x</em>T48<code class="dv mn mo mp mf b">exclusiveMinimum</code></li><li id="86db" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated"><em class="ll"> x </em> ≤ <code class="dv mn mo mp mf b">maximum</code></li><li id="94f5" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated"><em class="ll">x</em>T49<code class="dv mn mo mp mf b">exclusiveMaximum</code></li></ul><pre class="ma mb mc md fe me mf mg mh aw mi bi"><span id="a1f8" class="lm kj hj mf b fj mj mk l ml mm">"my_param": { <br/>    "type": "number",<br/>    "minimum": 0,<br/>    "maximum": 100<br/>}</span></pre><h2 id="b43a" class="lm kj hj bd kk ln lo lp ko lq lr ls ks jh lt lu kw jl lv lw la jp lx ly le lz bi translated">用线串</h2><pre class="ma mb mc md fe me mf mg mh aw mi bi"><span id="9948" class="lm kj hj mf b fj mj mk l ml mm">"my_param": { "type": "string" }</span></pre><p id="3173" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">还有一些可选参数:</p><ul class=""><li id="25e0" class="ju jv hj iy b iz ja jd je jh jw jl jx jp jy jt jz ka kb kc bi translated">minLength(我的字符串可以包含的最小字符数)</li><li id="46ed" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated">maxLength(我的字符串可以包含的最大字符数)</li><li id="1398" class="ju jv hj iy b iz kd jd ke jh kf jl kg jp kh jt jz ka kb kc bi translated">模式(这是一个正则表达式，如果字符串匹配正则表达式，将被视为有效)</li></ul><pre class="ma mb mc md fe me mf mg mh aw mi bi"><span id="643a" class="lm kj hj mf b fj mj mk l ml mm">"firstname": {<br/>    "type": "string",<br/>    "minLength": 2,<br/>    "maxLength": 50<br/>}</span></pre><h2 id="4715" class="lm kj hj bd kk ln lo lp ko lq lr ls ks jh lt lu kw jl lv lw la jp lx ly le lz bi translated">目标</h2><pre class="ma mb mc md fe me mf mg mh aw mi bi"><span id="24c0" class="lm kj hj mf b fj mj mk l ml mm">"my_param": { "type": "object" }</span></pre><p id="04a4" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">使用<em class="ll">属性</em>你可以描述对象内部的所有变量。</p><pre class="ma mb mc md fe me mf mg mh aw mi bi"><span id="57a0" class="lm kj hj mf b fj mj mk l ml mm">{<br/>  "type": "object",<br/>  "properties": {<br/>    "number": { "type": "number" },<br/>    "street_name": { "type": "string" },<br/>  },<br/>  "required": ["street_name"]<br/>}</span></pre><p id="2249" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated"><em class="ll">中的一个重要关键字需要</em>。它将确保在请求中发送一些值。</p><h2 id="06a2" class="lm kj hj bd kk ln lo lp ko lq lr ls ks jh lt lu kw jl lv lw la jp lx ly le lz bi translated"><strong class="ak">阵列</strong></h2><pre class="ma mb mc md fe me mf mg mh aw mi bi"><span id="3d10" class="lm kj hj mf b fj mj mk l ml mm">"my_param": { "type": "array" }</span></pre><p id="b38f" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">如果数组的元素都遵循相同的模式，则可以对它们进行验证。您可以检查数组<em class="ll">最小项</em>和<em class="ll">最大项的长度。</em></p><pre class="ma mb mc md fe me mf mg mh aw mi bi"><span id="9b13" class="lm kj hj mf b fj mj mk l ml mm">"my_param": { <br/>    "type": "array, <br/>    "minItems<em class="ll">"</em>: 3,<em class="ll"><br/></em>    "items: {<br/>        "type": "number"<br/>    }<br/>}</span></pre><p id="9e4d" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">您可以创建复杂元素的列表，并拥有本身包含列表的对象列表…</p><h2 id="04d3" class="lm kj hj bd kk ln lo lp ko lq lr ls ks jh lt lu kw jl lv lw la jp lx ly le lz bi translated"><strong class="ak">布尔型</strong></h2><pre class="ma mb mc md fe me mf mg mh aw mi bi"><span id="4fd4" class="lm kj hj mf b fj mj mk l ml mm">"my_param": { "type": "boolean" }</span></pre><p id="3ed1" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">这里没有真正的惊喜，值可以是<em class="ll">真</em>或<em class="ll">假</em></p><h2 id="c55d" class="lm kj hj bd kk ln lo lp ko lq lr ls ks jh lt lu kw jl lv lw la jp lx ly le lz bi translated">空</h2><pre class="ma mb mc md fe me mf mg mh aw mi bi"><span id="7245" class="lm kj hj mf b fj mj mk l ml mm">"my_param": { "type": "null" }</span></pre><p id="08ff" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">用于表示缺失值，它相当于 python 中的<em class="ll"> None </em></p><h2 id="9630" class="lm kj hj bd kk ln lo lp ko lq lr ls ks jh lt lu kw jl lv lw la jp lx ly le lz bi translated">多种类型</h2><p id="c2bf" class="pw-post-body-paragraph iw ix hj iy b iz lg jb jc jd lh jf jg jh li jj jk jl lj jn jo jp lk jr js jt hc bi translated">也许一个参数可以有多种可能的类型，例如<em class="ll">字符串</em>和<em class="ll">无。</em>当值 send 既可以是空的也可以是字符串。</p><pre class="ma mb mc md fe me mf mg mh aw mi bi"><span id="5607" class="lm kj hj mf b fj mj mk l ml mm">"my_param": { "type": ["string, "null"] }</span></pre></div><div class="ab cl mq mr gq ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="hc hd he hf hg"><h1 id="c998" class="ki kj hj bd kk kl mx kn ko kp my kr ks kt mz kv kw kx na kz la lb nb ld le lf bi translated">用烧瓶验证</h1><h2 id="e644" class="lm kj hj bd kk ln lo lp ko lq lr ls ks jh lt lu kw jl lv lw la jp lx ly le lz bi translated">包裹</h2><p id="900a" class="pw-post-body-paragraph iw ix hj iy b iz lg jb jc jd lh jf jg jh li jj jk jl lj jn jo jp lk jr js jt hc bi translated">有几个 python 包会基于 JSON 模式进行验证。我个人使用<a class="ae iv" href="https://pypi.org/project/flask-expects-json/" rel="noopener ugc nofollow" target="_blank"><strong class="iy hk">flask-expects-JSON</strong></a><strong class="iy hk">。</strong></p><p id="05e2" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">要安装它:</p><pre class="ma mb mc md fe me mf mg mh aw mi bi"><span id="2a24" class="lm kj hj mf b fj mj mk l ml mm">pip install flask-expects-json</span></pre><h2 id="cfba" class="lm kj hj bd kk ln lo lp ko lq lr ls ks jh lt lu kw jl lv lw la jp lx ly le lz bi translated">它是如何工作</h2><p id="0837" class="pw-post-body-paragraph iw ix hj iy b iz lg jb jc jd lh jf jg jh li jj jk jl lj jn jo jp lk jr js jt hc bi translated">这个包只是作为你的 flask 端点的装饰器。</p><pre class="ma mb mc md fe me mf mg mh aw mi bi"><span id="59b7" class="lm kj hj mf b fj mj mk l ml mm">schema = {<br/>  "type": "object",<br/>  "properties": {<br/>    "name": { "type": "string" },<br/>    "email": { "type": "string" }<br/>  },<br/>  "required": ["email"]<br/>}</span><span id="3538" class="lm kj hj mf b fj nc mk l ml mm">@app.route('/', methods=['POST'])<br/>@expects_json(schema)<br/>def example_endpoint():<br/>    ...</span></pre><p id="220f" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">如果收到的请求与模式不符，将会引发错误。并将发送一个 400 错误作为响应。-</p><h2 id="df91" class="lm kj hj bd kk ln lo lp ko lq lr ls ks jh lt lu kw jl lv lw la jp lx ly le lz bi translated">跳过验证方法</h2><p id="6181" class="pw-post-body-paragraph iw ix hj iy b iz lg jb jc jd lh jf jg jh li jj jk jl lj jn jo jp lk jr js jt hc bi translated">如果您的端点有几个方法，您可以忽略其中一些方法的验证。</p><pre class="ma mb mc md fe me mf mg mh aw mi bi"><span id="c44e" class="lm kj hj mf b fj mj mk l ml mm">@app.route('/', methods=['GET', 'POST'])<br/>@expects_json(schema, ignore_for=['GET'])<br/>def example():<br/>    return</span></pre></div><div class="ab cl mq mr gq ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="hc hd he hf hg"><p id="3ee5" class="pw-post-body-paragraph iw ix hj iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">json-schema 中还有其他有用的关键字。我在这里只讨论了最有用的。</p></div></div>    
</body>
</html>