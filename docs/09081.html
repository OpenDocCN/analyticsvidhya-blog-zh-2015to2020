<html>
<head>
<title>Language Model using Transfer Learning for Cricketers: Demo, Code &amp; Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">板球运动员使用迁移学习的语言模型:演示、代码和博客</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/language-model-using-transfer-learning-for-cricketers-3b022a5717f6?source=collection_archive---------20-----------------------#2020-08-24">https://medium.com/analytics-vidhya/language-model-using-transfer-learning-for-cricketers-3b022a5717f6?source=collection_archive---------20-----------------------#2020-08-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="f4f4" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">开发和部署语言模型的快速而聪明的方法</p></blockquote><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="jm jn l"/></div></figure><h1 id="c9df" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">介绍</h1><p id="d872" class="pw-post-body-paragraph ii ij hi il b im km io ip iq kn is it ko kp iw ix kq kr ja jb ks kt je jf jg hb bi translated">语言模型是学习预测任何句子的下一个单词的模型。要做到这一点，你需要非常精通英语以及世界知识。</p><p id="66b0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">在下面的代码中，我们将使用<strong class="il hj">迁移学习</strong>开发一个语言模型，其中包含与以下板球运动员相关联的文本文档:</p><ul class=""><li id="3b6c" class="ku kv hi il b im in iq ir ko kw kq kx ks ky jg kz la lb lc bi translated"><em class="ik">《AB de Villiers》</em></li><li id="8b05" class="ku kv hi il b im ld iq le ko lf kq lg ks lh jg kz la lb lc bi translated"><em class="ik">《布莱恩·拉拉》</em></li><li id="1562" class="ku kv hi il b im ld iq le ko lf kq lg ks lh jg kz la lb lc bi translated"><em class="ik">‘拉胡尔·德拉维德’</em></li><li id="28e0" class="ku kv hi il b im ld iq le ko lf kq lg ks lh jg kz la lb lc bi translated"><em class="ik">《罗希特·夏尔马》</em></li><li id="ffad" class="ku kv hi il b im ld iq le ko lf kq lg ks lh jg kz la lb lc bi translated"><em class="ik">‘萨钦·坦杜尔卡尔’</em></li><li id="ea0e" class="ku kv hi il b im ld iq le ko lf kq lg ks lh jg kz la lb lc bi translated"><em class="ik">‘谢恩·沃恩’</em></li></ul><p id="6627" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">数据来源:<a class="ae li" href="https://www.kaggle.com/anandpuntambekar/cricketer-text-corpus-txt" rel="noopener ugc nofollow" target="_blank"> Kaggle </a></p><p id="2d47" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">代码:<a class="ae li" href="https://github.com/anandpuntambekar/Cricket_Language_Model" rel="noopener ugc nofollow" target="_blank"> Github库</a></p><p id="8d4e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">演示:<a class="ae li" href="https://www.youtube.com/watch?v=utMuDChKDCA" rel="noopener ugc nofollow" target="_blank"> Youtube </a></p><h2 id="f8ab" class="lj jp hi bd jq lk ll lm ju ln lo lp jy ko lq lr kc kq ls lt kg ks lu lv kk lw bi translated">让我们开始吧！！</h2><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es lx"><img src="../Images/3533a86806370800e0b8fe6536bfa630.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cy_so3qlVmmoESCHSOO32g.jpeg"/></div></div></figure></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><h1 id="cfb6" class="jo jp hi bd jq jr ml jt ju jv mm jx jy jz mn kb kc kd mo kf kg kh mp kj kk kl bi translated">步骤1:为Google Colab设置Fastai</h1><p id="8ec7" class="pw-post-body-paragraph ii ij hi il b im km io ip iq kn is it ko kp iw ix kq kr ja jb ks kt je jf jg hb bi translated">要将Google Colab与Fastai V1一起使用，请设置运行时-&gt;将运行时类型设置为GPU</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es mq"><img src="../Images/b2b9a7749c91b0ba35844438e09fe626.png" data-original-src="https://miro.medium.com/v2/resize:fit:536/format:webp/1*AnIOLkHPDHZG1UOBn1lieA.png"/></div></figure><p id="07fe" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">我们将在Colab中运行以下代码来安装PyTorch和Fastai的更新版本:</p><pre class="jh ji jj jk fd mr ms mt mu aw mv bi"><span id="ad1a" class="lj jp hi ms b fi mw mx l my mz">from os.path import exists</span><span id="da01" class="lj jp hi ms b fi na mx l my mz">from wheel.pep425tags import get_abbr_impl, get_impl_ver, get_abi_tag</span><span id="9efb" class="lj jp hi ms b fi na mx l my mz">platform = ‘{}{}-{}’.format(get_abbr_impl(), get_impl_ver(), get_abi_tag())</span><span id="eea2" class="lj jp hi ms b fi na mx l my mz">cuda_output = !ldconfig -p|grep cudart.so|sed -e ‘s/.*\.\([0–9]*\)\.\([0–9]*\)$/cu\1\2/’</span><span id="6326" class="lj jp hi ms b fi na mx l my mz">accelerator = cuda_output[0] if exists(‘/dev/nvidia0’) else ‘cpu’</span><span id="8303" class="lj jp hi ms b fi na mx l my mz">!pip install torch_nightly -f <a class="ae li" href="https://download.pytorch.org/whl/nightly/{accelerator}/torch_nightly.html" rel="noopener ugc nofollow" target="_blank">https://download.pytorch.org/whl/nightly/{accelerator}/torch_nightly.html</a></span><span id="b3be" class="lj jp hi ms b fi na mx l my mz">import torch</span><span id="08ba" class="lj jp hi ms b fi na mx l my mz">print(torch.__version__)</span><span id="6f3a" class="lj jp hi ms b fi na mx l my mz">print(torch.cuda.is_available())</span><span id="1e5a" class="lj jp hi ms b fi na mx l my mz">print(torch.backends.cudnn.enabled)</span><span id="6959" class="lj jp hi ms b fi na mx l my mz">!pip install fastai</span></pre></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><h1 id="8e1f" class="jo jp hi bd jq jr ml jt ju jv mm jx jy jz mn kb kc kd mo kf kg kh mp kj kk kl bi translated">步骤2:清理输入数据</h1><p id="690e" class="pw-post-body-paragraph ii ij hi il b im km io ip iq kn is it ko kp iw ix kq kr ja jb ks kt je jf jg hb bi translated">在上传数据之前，我擅自删除了文本文件中的空格、制表符和超链接，以创建一个更有效的语言模型。</p><h2 id="ace3" class="lj jp hi bd jq lk ll lm ju ln lo lp jy ko lq lr kc kq ls lt kg ks lu lv kk lw bi translated">上传文本数据</h2><pre class="jh ji jj jk fd mr ms mt mu aw mv bi"><span id="255b" class="lj jp hi ms b fi mw mx l my mz">from google.colab import files<br/>files.upload()</span></pre></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><h1 id="6d77" class="jo jp hi bd jq jr ml jt ju jv mm jx jy jz mn kb kc kd mo kf kg kh mp kj kk kl bi translated">步骤3:查看导入的数据</h1><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es nb"><img src="../Images/8cf7f53b573219b5d59d1cafb4054b64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*GufkkbSp5KKq9WZFfLIbeg.png"/></div></figure><p id="3277" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">现在我们来看看导入的文件:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es nc"><img src="../Images/d96c455f576ff981fe85e1413f443f3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i970zKZXONtlKH2fa6D0ZQ.png"/></div></div></figure><pre class="jh ji jj jk fd mr ms mt mu aw mv bi"><span id="f811" class="lj jp hi ms b fi mw mx l my mz">[“\ufeff an ordinary piece to something truly extraordinary. Who Will Win The World Cup? by Murari Gupta Dasa AT THE HEIGHT OF Sachin Tendulkar’s popularity a giant billboard proclaimed: Cricket is our religion and Sachin is our god. That sums up the mood of \n”, ….</span></pre></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><h1 id="6127" class="jo jp hi bd jq jr ml jt ju jv mm jx jy jz mn kb kc kd mo kf kg kh mp kj kk kl bi translated">步骤4:自然语言处理的迁移学习</h1><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es nd"><img src="../Images/b5ce825297f26fb83cb4f05491a26f08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*S7_mwYQNJMODXGbhPy_uSw.png"/></div></figure><p id="232b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">对于神经网络，权重矩阵开始是随机的。因此，如果你从一些随机参数开始，并试图训练这些参数来学习，你就会有成千上万个1和0来预测下一个单词。</p><p id="127b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">我们拥有的文本数据显然不足以学习如何说好英语，不足以预测下一个单词。</p><p id="d5e7" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">有时这可能非常微妙。特别是关于板球的文章，记者们经常会使用讽刺的语言。</p><p id="133a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">所以诀窍，(希望你能猜到:)，是使用<strong class="il hj">转移学习</strong>。</p><p id="9baa" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">我们是否需要学习“如何说英语？”我们需要一大套文件，但我们没有。</p><p id="4a07" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">因此，我们将从一个预先训练好的模型开始，它已经被教会做一些不同的事情，然后针对板球运动员的语言模型对它进行微调。</p></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><h1 id="c552" class="jo jp hi bd jq jr ml jt ju jv mm jx jy jz mn kb kc kd mo kf kg kh mp kj kk kl bi translated">Wikitext 103</h1><p id="ce96" class="pw-post-body-paragraph ii ij hi il b im km io ip iq kn is it ko kp iw ix kq kr ja jb ks kt je jf jg hb bi translated">Wikitext 103是一个数据集，它是维基百科中最大文章的子集，经过一点预处理，可以下载。</p><p id="ca4a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">就像预先训练的ImageNet模型存在于视觉中一样，也有预先训练的Wikitext模型存在于NLP中。这个模型对语言和语言描述的东西有相当多的了解。我们将使用该模型并执行迁移学习来为板球运动员创建新的语言模型。</p><pre class="jh ji jj jk fd mr ms mt mu aw mv bi"><span id="ddf7" class="lj jp hi ms b fi mw mx l my mz">#If somebody changes underlying library code while I’m running this, please reload it automatically</span><span id="e7e8" class="lj jp hi ms b fi na mx l my mz">#If somebody asks to plot something, then please plot it here in this Jupyter Notebook</span><span id="4a72" class="lj jp hi ms b fi na mx l my mz">#We starts with the following three lines;</span><span id="b072" class="lj jp hi ms b fi na mx l my mz">%reload_ext autoreload<br/>%autoreload 2<br/>%matplotlib inline</span></pre></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><h1 id="1dc8" class="jo jp hi bd jq jr ml jt ju jv mm jx jy jz mn kb kc kd mo kf kg kh mp kj kk kl bi translated">步骤5:关于使用Fastai进行文本挖掘</h1><p id="ae92" class="pw-post-body-paragraph ii ij hi il b im km io ip iq kn is it ko kp iw ix kq kr ja jb ks kt je jf jg hb bi translated">fastai库的文本模块包含所有必要的函数，以定义适用于各种NLP(自然语言处理)任务的数据集，并快速生成模型。:</p><ul class=""><li id="26fe" class="ku kv hi il b im in iq ir ko kw kq kx ks ky jg kz la lb lc bi translated">text.transform包含预处理数据的所有脚本，从原始文本到令牌id；</li><li id="79b8" class="ku kv hi il b im ld iq le ko lf kq lg ks lh jg kz la lb lc bi translated">text.data包含TextDataBunch的定义，这是NLP中需要的主类；和</li><li id="bda9" class="ku kv hi il b im ld iq le ko lf kq lg ks lh jg kz la lb lc bi translated">包含帮助函数，可以快速创建语言模型或RNN分类器。</li></ul><p id="ad1d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">一些重要的<strong class="il hj"> NLP </strong>术语包括:</p><ol class=""><li id="e0a4" class="ku kv hi il b im in iq ir ko kw kq kx ks ky jg ne la lb lc bi translated"><strong class="il hj">记号化</strong>是一种将一段文本分割成称为记号的更小单元的方法。这里的标记可以是单词、字符或子单词。</li><li id="5e53" class="ku kv hi il b im ld iq le ko lf kq lg ks lh jg ne la lb lc bi translated"><strong class="il hj">词干化</strong>是将单词中的词尾变化减少到其词根形式的过程，例如将一组单词映射到同一个词干，即使该词干本身在语言中不是有效的单词。</li></ol><pre class="jh ji jj jk fd mr ms mt mu aw mv bi"><span id="50f4" class="lj jp hi ms b fi mw mx l my mz">from fastai.text import *</span><span id="d819" class="lj jp hi ms b fi na mx l my mz"># Batch Size:</span><span id="5360" class="lj jp hi ms b fi na mx l my mz"># In order to avoid memory error( too many parameter updates for the amount of RAM ) — batch size needs to be fixed.</span><span id="7ee3" class="lj jp hi ms b fi na mx l my mz"># bs: batch size (i.e. number of words processed at a time)</span><span id="3803" class="lj jp hi ms b fi na mx l my mz">bs=48<br/>path = “/content”</span></pre><p id="95d3" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">我们将从板球运动员的语言模型开始。现在好消息是，我们不必训练Wikitext 103语言模型，因为在一个像样的GPU上需要两三天。没有很好的理由从随机权重开始，如果可以，我们应该总是尝试使用迁移学习。</p><p id="490c" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">所以将开始微调我们板球运动员的语言模型。</p></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><h1 id="b65d" class="jo jp hi bd jq jr ml jt ju jv mm jx jy jz mn kb kc kd mo kf kg kh mp kj kk kl bi translated">步骤6:创建数据簇</h1><p id="67d1" class="pw-post-body-paragraph ii ij hi il b im km io ip iq kn is it ko kp iw ix kq kr ja jb ks kt je jf jg hb bi translated">为了在fastai中创建一个模型，我们需要创建一个DataBunch对象——在我们的例子中，就是<em class="ik"> data_lm </em>变量。在Fastai中，我们将在其上构建模型的每个对象都是一个DataBunch对象。DataBunch对象包含2或3个数据集，即训练数据；验证数据和可选的测试数据。</p><p id="89ad" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">上面的每个都包含文本和标签。在定义DataBunch时，我们还需要创建验证数据集以避免过度拟合。过拟合是指训练数据的精度很高，但在训练数据之外的较低端。使用“验证集”可以避免过度拟合。</p><pre class="jh ji jj jk fd mr ms mt mu aw mv bi"><span id="7963" class="lj jp hi ms b fi mw mx l my mz">data_lm = (TextList.from_folder(path)</span><span id="cfd4" class="lj jp hi ms b fi na mx l my mz">#Inputs: all the text files in path</span><span id="c05f" class="lj jp hi ms b fi na mx l my mz">.filter_by_folder()</span><span id="5f50" class="lj jp hi ms b fi na mx l my mz">#We may have other temp folders that contain text files so we only keep what’s in train and test</span><span id="0b26" class="lj jp hi ms b fi na mx l my mz">.split_by_rand_pct(0.1)</span><span id="969f" class="lj jp hi ms b fi na mx l my mz">#We randomly split and keep 10% (10,000 reviews) for validation</span><span id="b1ef" class="lj jp hi ms b fi na mx l my mz">.label_for_lm()</span><span id="7ea7" class="lj jp hi ms b fi na mx l my mz">#We want to do a language model so we label accordingly</span><span id="425c" class="lj jp hi ms b fi na mx l my mz">.databunch(bs=bs))</span></pre><p id="e47d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">每个文档都是一个单独的文本文件。对于验证集，我们随机将其除以0.1。</p><p id="4f76" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">但是我们如何给它贴上标签呢？</p><p id="bd40" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">语言模型在某种程度上有自己的标签。文本本身有标签(下一个单词)，所以label for a language model(<em class="ik">label _ for _ lm</em>)为我们执行标注。现在，创建一个数据串并保存它，这需要几分钟的时间进行标记化和数值化，这样我们就保存了它。稍后，我们可以加载它，而不需要再次运行它。</p></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><p id="1a65" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated"><strong class="il hj">查看数据串:</strong></p><pre class="jh ji jj jk fd mr ms mt mu aw mv bi"><span id="13fd" class="lj jp hi ms b fi mw mx l my mz">data_lm.show_batch()</span></pre><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es nf"><img src="../Images/bd665f16bee73ac6527e2a529c057813.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ft4qdzPbRDyz_uAcou3tIw.png"/></div></div></figure><ul class=""><li id="b860" class="ku kv hi il b im in iq ir ko kw kq kx ks ky jg kz la lb lc bi translated">我们词汇表中的每个单词都需要在神经网络的权重矩阵中有单独的一行。因此，为了避免权重矩阵变得太大，我们将词汇表限制为不超过(默认)60，000个单词。同样，如果一个单词没有出现两次以上，我们也不会把它放入词汇表中。</li><li id="8415" class="ku kv hi il b im ld iq le ko lf kq lg ks lh jg kz la lb lc bi translated">这样，我们将词汇量保持在一个合理的范围内。当你看到类似“xxunk”的术语时，它们实际上是未知的令牌。这意味着这个词在我们的词汇中并不常见，尽管有一些特殊的标记。</li><li id="3ae8" class="ku kv hi il b im ld iq le ko lf kq lg ks lh jg kz la lb lc bi translated">例如，“xxfld”——这是一个特殊功能，如果您有标题、摘要、摘要、正文等。(即文档的独立部分)，这些特征中的每一个都将获得一个独立的字段并被编号(例如xxfld 2)</li></ul></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><h1 id="db57" class="jo jp hi bd jq jr ml jt ju jv mm jx jy jz mn kb kc kd mo kf kg kh mp kj kk kl bi translated">步骤7:创建学习者</h1><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es ng"><img src="../Images/f6d554d7b5854e30c2be3bb896882fdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*DabsGOV3Mv9hBPhVuezqjA.png"/></div></figure><p id="bba6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">我们将用<em class="ik"> AWD_LSTM创建一个语言模型学习者。</em>当我们创建一个与模型相关联的学习者时，您必须传入以下内容:</p><ul class=""><li id="fe93" class="ku kv hi il b im in iq ir ko kw kq kx ks ky jg kz la lb lc bi translated">数据；</li><li id="7f85" class="ku kv hi il b im ld iq le ko lf kq lg ks lh jg kz la lb lc bi translated">我们要用的预训练模型:Wikitext 103(和ImageNet预训练模型一样会从fastai下载)；和</li><li id="04d5" class="ku kv hi il b im ld iq le ko lf kq lg ks lh jg kz la lb lc bi translated">避免欠拟合的下降量(<em class="ik"> drop_mult </em>设置)。随意增加<em class="ik"> drop_mult </em>以避免过度拟合</li></ul><p id="d318" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">现在我们有了一个学习者，我们可以使用<em class="ik"> lr_find </em>来寻找最佳学习率。</p><pre class="jh ji jj jk fd mr ms mt mu aw mv bi"><span id="4e67" class="lj jp hi ms b fi mw mx l my mz">learn = language_model_learner(data_lm, AWD_LSTM, drop_mult=0.1)</span></pre><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es nh"><img src="../Images/8fd6d2d5278d96ff3ca26ace007598a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*ZcM0bAV0Y4T0o7NBLTWZ_w.png"/></div></figure><p id="4f62" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated"><strong class="il hj">学习率:</strong>学习率决定了模型中参数更新的速度。基于学习率查找器，我们将找到一个最佳的学习率。</p><p id="2193" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated"><strong class="il hj">不同的学习速率</strong>以相同的速率训练所有的层是没有意义的，因为我们知道较深的层对于原始模型工作得很好。所以现在我们可以将一个学习率范围传递给<em class="ik"> learn.fit_one_cycle </em>。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es ni"><img src="../Images/54f673bf9a7e42ad2261cf20bfd41208.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*2canNIA0ZwlxqNqIlMNJjw.png"/></div></figure><pre class="jh ji jj jk fd mr ms mt mu aw mv bi"><span id="2f93" class="lj jp hi ms b fi mw mx l my mz">learn.fit_one_cycle(1, 1e-1/3, moms=(0.8,0.7))</span></pre><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es nj"><img src="../Images/aa858f10c399b53b6fc9374c81eecddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*W0hsDZi8_Q5bh_CR_xHlnA.png"/></div></figure><p id="73ef" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">我们发现了一些相当有效的系数和参数。所以如果我们想多玩一会儿再回来，我们应该节省这些重量。<strong class="il hj"> </strong>请使用<em class="ik"> learn.save </em>并给它命名。</p><pre class="jh ji jj jk fd mr ms mt mu aw mv bi"><span id="b0d1" class="lj jp hi ms b fi mw mx l my mz">learn.save(‘fit_head’)<br/>#learn.load(‘fit_head’)</span></pre></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><h1 id="6ec8" class="jo jp hi bd jq jr ml jt ju jv mm jx jy jz mn kb kc kd mo kf kg kh mp kj kk kl bi translated">步骤8:微调模型</h1><p id="fb53" class="pw-post-body-paragraph ii ij hi il b im km io ip iq kn is it ko kp iw ix kq kr ja jb ks kt je jf jg hb bi translated">通常，在我们微调了最后几层之后，我们接下来解冻并训练整个模型。</p><p id="b3c5" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated"><em class="ik">解冻</em>功能有助于训练整个模型。调用unfreeze后，我们可以再次调用<em class="ik"> fit_one_cycle </em>。</p><pre class="jh ji jj jk fd mr ms mt mu aw mv bi"><span id="bc4d" class="lj jp hi ms b fi mw mx l my mz">learn.unfreeze()<br/>learn.fit_one_cycle(10, max_lr=slice(1e-3,0.3e-2), moms=(0.8,0.7))</span></pre><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es nk"><img src="../Images/654c9acf47046ca216ae20fe59b1a868.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*nUCfvttKzxJNi9mIhbT03Q.png"/></div></figure><p id="62fd" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">准确度0.27意味着我们将正确地猜出cricket文章的下一个单词，几乎有1/3的几率，这是一个相当高的数字。所以这是我们语言模型表现良好的一个指标。</p><p id="4f4b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">对于更有限的特定领域文档(如医疗记录和法律记录)，您通常会发现这种准确性会高得多。所以有时候，准确率甚至可以达到50%以上。</p></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><h1 id="9819" class="jo jp hi bd jq jr ml jt ju jv mm jx jy jz mn kb kc kd mo kf kg kh mp kj kk kl bi translated">步骤9:测试模型</h1><p id="eef1" class="pw-post-body-paragraph ii ij hi il b im km io ip iq kn is it ko kp iw ix kq kr ja jb ks kt je jf jg hb bi translated">下面是一个示例文本案例:</p><pre class="jh ji jj jk fd mr ms mt mu aw mv bi"><span id="a698" class="lj jp hi ms b fi mw mx l my mz">TEXT = “Brian Lara’s performance “<br/>N_WORDS = 30<br/>N_SENTENCES = 3</span></pre><p id="5d8e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">你现在可以运行<em class="ik"> learn.predict </em>并传入一个句子的开头，它会尝试为你结束那个句子。</p><pre class="jh ji jj jk fd mr ms mt mu aw mv bi"><span id="e40e" class="lj jp hi ms b fi mw mx l my mz">#Lowering temperature will make the texts less randomized.</span><span id="845f" class="lj jp hi ms b fi na mx l my mz">print(“\n”.join(learn.predict(TEXT, N_WORDS, temperature=0.8) for _ in range(N_SENTENCES)))</span></pre><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es nl"><img src="../Images/7206e7ce6889784c40de45d60368cb9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*niG6vHIxK1sndUOwSDCDKg.png"/></div></div><figcaption class="nm nn et er es no np bd b be z dx translated">看来布莱恩表现不错</figcaption></figure></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><p id="8d99" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated">你该出手了！！</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es nq"><img src="../Images/f12486b5ad6ed405e4e6eccd41694c37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ehKYmAPgh3cWvKwQ_B2fGA.jpeg"/></div></div></figure><p id="3ff5" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ko iv iw ix kq iz ja jb ks jd je jf jg hb bi translated"><strong class="il hj">快乐编码！！</strong></p></div></div>    
</body>
</html>