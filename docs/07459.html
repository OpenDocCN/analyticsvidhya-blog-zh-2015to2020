<html>
<head>
<title>Streams with ListView and Smooth Scrolling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有ListView和平滑滚动的流</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/streams-with-listview-and-smooth-scrolling-546158e1b3c5?source=collection_archive---------9-----------------------#2020-06-26">https://medium.com/analytics-vidhya/streams-with-listview-and-smooth-scrolling-546158e1b3c5?source=collection_archive---------9-----------------------#2020-06-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8ee7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大家好，今天我们将讨论如何使用流和listview来构建项目，当用户到达项目的特定位置时，我们将使用包含5000张图像的照片的JSON占位符API，我们将在文章的结尾学习如何使用流控制器和listview来平滑滚动，所以不浪费时间，让我们开始❤</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/7dd4eca20a4da5df45f1f7ea6ef002c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*zYelGAikHv77wdicCKU9qg.png"/></div></figure><p id="c164" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建一个名为“flutter_stream_project”的新的flutter项目，并确保您有这样的项目结构:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jl"><img src="../Images/a234b6b0e13f8e81829d2fbe165bdfae.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*YnHcXG8jL5z3ZCZCc5dl7A.png"/></div></figure><p id="0755" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在首先创建一个名为“Photo”的模型类，并复制粘贴以下代码:</p><pre class="je jf jg jh fd jm jn jo jp aw jq bi"><span id="3d9e" class="jr js hi jn b fi jt ju l jv jw"><strong class="jn hj">class </strong>Photo {<br/>  <strong class="jn hj">final </strong>String <strong class="jn hj">title</strong>;<br/>  <strong class="jn hj">final </strong>String <strong class="jn hj">url</strong>;<br/><br/>  Photo.fromJsonMap(Map map)<br/>      : <strong class="jn hj">title </strong>= map[<strong class="jn hj">'title'</strong>],<br/>        <strong class="jn hj">url </strong>= map[<strong class="jn hj">'url'</strong>];<br/>}</span></pre><p id="53e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为我们只需要JSON占位符API中的图片URL和标题。</p><p id="7112" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">fromJsonMap是将JSON数据映射到一个Map中。</p><p id="77cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们在screens文件夹中创建一个名为PhotoList的新文件，并复制粘贴以下代码:</p><pre class="je jf jg jh fd jm jn jo jp aw jq bi"><span id="da3a" class="jr js hi jn b fi jt ju l jv jw"><strong class="jn hj">import 'dart:async'</strong>;<br/><br/><strong class="jn hj">import 'package:flutter/material.dart'</strong>;<br/><strong class="jn hj">import 'package:flutterstreamproject/models/Photo.dart'</strong>;<br/><strong class="jn hj">import 'dart:convert'</strong>;<br/><br/><strong class="jn hj">import 'package:http/http.dart' as </strong>http;<br/><strong class="jn hj">class </strong>PhotoList <strong class="jn hj">extends </strong>StatefulWidget {<br/>  @override<br/>  _PhotoListState createState() =&gt; _PhotoListState();<br/>}<br/><br/><strong class="jn hj">class </strong>_PhotoListState <strong class="jn hj">extends </strong>State&lt;PhotoList&gt; {<br/>  StreamController&lt;Photo&gt; <strong class="jn hj">_streamController</strong>;<br/>  List&lt;Photo&gt; <strong class="jn hj">list </strong>= [];<br/><br/>  @override<br/>  <strong class="jn hj">void </strong>initState() {<br/>    <strong class="jn hj">super</strong>.initState();<br/>    <strong class="jn hj">_streamController </strong>= StreamController.broadcast();<br/><br/>    <strong class="jn hj">_streamController</strong>.<strong class="jn hj">stream</strong>.listen((p) =&gt; setState(() =&gt; <strong class="jn hj">list</strong>.add(p)));<br/><br/>    load(<strong class="jn hj">_streamController</strong>);<br/>  }<br/><br/>  load(StreamController&lt;Photo&gt; sc) <strong class="jn hj">async </strong>{<br/>    String url = <strong class="jn hj">"https://jsonplaceholder.typicode.com/photos"</strong>;<br/>    <strong class="jn hj">var </strong>client = <strong class="jn hj">new </strong>http.Client();<br/><br/>    <strong class="jn hj">var </strong>req = <strong class="jn hj">new </strong>http.Request(<strong class="jn hj">'get'</strong>, Uri.<em class="jx">parse</em>(url));<br/><br/>    <strong class="jn hj">var </strong>streamedRes = <strong class="jn hj">await </strong>client.send(req);<br/><br/>    streamedRes.<strong class="jn hj">stream<br/>        </strong>.transform(utf8.<strong class="jn hj">decoder</strong>)<br/>        .transform(json.<strong class="jn hj">decoder</strong>)<br/>        .expand((e) =&gt; e)<br/>        .map((map) =&gt; Photo.fromJsonMap(map))<br/>        .pipe(sc);<br/>  }<br/><br/>  @override<br/>  <strong class="jn hj">void </strong>dispose() {<br/>    <strong class="jn hj">super</strong>.dispose();<br/>    <strong class="jn hj">_streamController</strong>?.close();<br/>    <strong class="jn hj">_streamController </strong>= <strong class="jn hj">null</strong>;<br/>  }<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    <strong class="jn hj">return </strong>Scaffold(<br/>      appBar: AppBar(<br/>        title: Text(<strong class="jn hj">"Photo Streams"</strong>),<br/>      ),<br/>      body: Center(<br/>        child: ListView.builder(<br/><em class="jx">//          scrollDirection: Axis.horizontal,<br/><br/>          </em>itemBuilder: (BuildContext context, int index) =&gt; _makeElement(index),<br/>          itemCount: <strong class="jn hj">list</strong>.<strong class="jn hj">length</strong>,<br/>        ),<br/>      ),<br/>    );<br/>  }<br/><br/>  Widget _makeElement(int index) {<br/>    <strong class="jn hj">if </strong>(index &gt;= <strong class="jn hj">list</strong>.<strong class="jn hj">length</strong>) {<br/>      <strong class="jn hj">return null</strong>;<br/>    }<br/><br/>    <strong class="jn hj">return </strong>Container(<br/>        padding: EdgeInsets.all(5.0),<br/>        child: Padding(<br/>          padding: EdgeInsets.only(top: 200.0),<br/>          child: Column(<br/>            children: &lt;Widget&gt;[<br/>              Image.network(<strong class="jn hj">list</strong>[index].<strong class="jn hj">url</strong>, width: 150.0, height: 150.0),<br/>              Text(<strong class="jn hj">list</strong>[index].<strong class="jn hj">title</strong>),<br/>            ],<br/>          ),<br/>        ));<br/>  }<br/>}</span></pre><p id="91d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们创建一个流控制器，因为流控制器是一个通用类型，所以我们需要在&lt;&gt;尖括号内定义数据类型，因为我们需要照片数据，所以我们在尖括号内传递照片模型， 现在，为了初始化流控制器，我们需要init状态。现在，我们广播流控制器，也就是说，我们订阅流控制器的每一个更改，然后我们使用listen方法并传递p，它可以与我们在流控制器中传递的照片模型类无关。现在，每当列表中添加新项目时，我们都需要更改，所以我们将p添加到我们的列表中，它是一个照片模型，然后我们 创建一个带参数的方法load作为流控制器，现在一个load方法我们用get请求调用我们的API，并在来自JsonMap方法的Photo model类的帮助下映射流的结果，然后我们调用dispose方法来处理所有的流控制器并传递null，这样如果我们导航到另一个屏幕等，它就不会占用任何内存或导致任何内存泄漏。</p><p id="226a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们用listview.builder创建一个简单的UI，在item builder中，我们创建了一个makeElement方法，它有一个容器和一个子列，并传递网络图像和文本小部件。</p><p id="b561" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们运行应用程序，用户界面不会很好，但你会注意到滚动如何通过这种方法变得如此平滑，而且我们订阅了每当新项目添加时的更改，流控制器更改方法将被调用并突然进行更改。</p><p id="ac20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望你明白如何使用listview和API的流控制器，希望看到你们对这篇文章的评论和鼓掌。</p><p id="a9fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢你，❤.</p><p id="dc75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">示例项目的Github Repo链接:</p><p id="463d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jy" href="https://github.com/Mashood97/flutter_stream_project" rel="noopener ugc nofollow" target="_blank">https://github.com/Mashood97/flutter_stream_project</a></p></div></div>    
</body>
</html>