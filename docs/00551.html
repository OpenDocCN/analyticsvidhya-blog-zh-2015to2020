<html>
<head>
<title>Achieve Big with Less via Google Tag Manager import/export</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Google Tag Manager导入/导出实现事半功倍</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/achieve-big-with-less-via-google-tag-manager-import-export-ed693f8db381?source=collection_archive---------1-----------------------#2019-07-28">https://medium.com/analytics-vidhya/achieve-big-with-less-via-google-tag-manager-import-export-ed693f8db381?source=collection_archive---------1-----------------------#2019-07-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b53dc40b66b27c2d9c145e5a14b982d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o1379kOnugcT6ausENgZvg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">谷歌标签管理食谱</figcaption></figure><p id="f9ca" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi js translated">oogle Tag Manager是为了简化我们的分析实施而推出的，拥有许多独特的功能。然而，很多时候，我们忽略了这些特性和功能。如果你像我一样经常使用谷歌标签管理器，你可能正在寻找新的方法来提高你的网站性能，更快地捕捉错误，并以更高的效率和准确性提供结果。</p><p id="6e10" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">一个困扰业余爱好者和有经验者的问题:我们如何在Google Tag Manager容器中批量编辑/更新标签或触发器？我们大多数人生活在禁欲主义的信仰中，认为在GTM中我们只能手动地一个接一个地编辑/更新触发器或标签。这往往导致相同任务的重复，扼杀了我们的兴趣和效率。</p><p id="fd3b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这让我想起了我们面临的挑战，当时我们不得不推出相同的更改，以适应GDPR，跨多个容器达到400多个触发器！用户权限是关键因素，必须加以考虑，以适应整个站点标记的GDPR，关键特征是能够决定用户权限获取变量是否设置为真。至少可以说，一想到30-40个小时乏味、忙乱和单调的手工工作就令人生畏。</p><p id="3440" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所以这个问题的答案是，GTM或任何第三方工具都没有为批量更新触发器或标签提供任何内置的解决方案。幸运的是，我们有JavaScript来拯救我们。让我们看看如何，</p></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><h1 id="97d5" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated"><strong class="ak">《救世主》</strong></h1><p id="1dc5" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr hb bi translated">尽管没有任何可用的内置特性，但这并不意味着不可能在GTM中进行批量修改。因此，我们编写了一个定制的解决方案，使用模板脚本代码来编辑/更新GTM标签/触发器。</p><p id="c416" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">快速总结解决方案:</strong> <br/>第一步:导出你的GTM容器，<br/>第二步:在触发器或标签中写下你要做的修改，<br/>第三步:分别从容器文件中复制标签/触发器块，<br/>第四步:*Script Magic*，<br/>第五步:在GTM中导入更新后的容器文件，<em class="ll">瞧！结束了。</em></p><p id="e346" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这篇文章是根据我自己的经验写的，我使用了一小段脚本和GTM的高级特性，在GTM中自动批量更新/编辑标签/触发器。开始讨论解决方案之前的一些先决条件</p><h1 id="ecb3" class="ki kj hi bd kk kl ln kn ko kp lo kr ks kt lp kv kw kx lq kz la lb lr ld le lf bi translated"><strong class="ak">该如何？</strong></h1><p id="5ea1" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr hb bi translated"><strong class="iw hj">步骤1:导出您的GTM容器:<br/> </strong>自动化过程的第一步是导出您的GTM容器。导出容器时，请确保选择了正确的工作空间。</p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/f650133f0b80fbb3436a0081d8109328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kqp6PQM3nh5U8jUok7Fe7Q.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">这是您的Google标签管理器容器导出屏幕的外观</figcaption></figure><p id="354a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">第二步:编写/复制你想要添加的触发条件(JSON格式):<br/> </strong>在所有的触发器中编写你想要更新的附加过滤条件。新的过滤条件应该是JSON格式，因为GTM导入/导出使用JSON格式。</p><p id="7668" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您还可以从任何现有的触发器中复制过滤条件，<a class="ae lm" href="https://github.com/analytics-jiten/gtm_bulk_update/blob/master/create_new_trigger_condition" rel="noopener ugc nofollow" target="_blank">下面是如何复制触发条件</a>的方法。</p><figure class="lt lu lv lw fd ij"><div class="bz dy l di"><div class="lx ly l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">GTM触发条件滤波器模块</figcaption></figure><p id="7c65" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">第三步:提取触发块，过滤条件:</strong></p><p id="8d51" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在高级文本编辑器(如notepad++)中打开下载的容器文件。GTM容器文件的结构如下:</p><p id="046d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">-账户设置<br/>-标签块<br/> - <strong class="iw hj">触发块<br/> - </strong>变量块<br/>-文件夹块</p><p id="e777" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">从导出的GTM容器文件中复制触发器块，并将其与您编写的过滤条件一起保存在另一个文本文件中。</p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/ce6e559d12c78707fc616b61c3f05848.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WDp8H5A_3bLzuxXQq-eIbw.png"/></div></div></figure><p id="7c53" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">步骤4:自动化更新:</strong></p><p id="46cc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，打开Java Script IDE，将复制的触发器块分配给一个变量，将过滤条件分配给另一个变量。</p><figure class="lt lu lv lw fd ij"><div class="bz dy l di"><div class="lx ly l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">将触发器过滤条件和触发器块分配给JS变量</figcaption></figure><p id="9456" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">“_triggerObj”变量将返回JSON对象，可以使用以下命令在IDE或浏览器控制台上检索该对象的元素:</p><p id="7eb7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="ll"> _triggerObj.trigger[0]。&lt;任意元素&gt;T16】</em></p><p id="9e4e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在获取触发器的长度，并运行一个循环，直到它的长度。检查每个触发器中的过滤器是否存在，如果存在，则在过滤器对象的末尾添加新的过滤条件。下面的代码应该可以解决这个问题:</p><figure class="lt lu lv lw fd ij"><div class="bz dy l di"><div class="lx ly l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">在GTM触发器中批量编辑/添加新条件的模板脚本</figcaption></figure><p id="5f91" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">第五步:更新并导入容器文件。</strong></p><p id="5671" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">一旦脚本成功执行，检查控制台上更新的触发器，您应该能够看到所有触发器中添加的过滤条件。忽略通过else块返回的触发器，因为这些触发器要么是自动触发器，要么是没有任何逻辑条件/过滤器的空白触发器。</p><p id="cbb6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">使用“<em class="ll">JSON . stringify(_ trigger obj)</em>”将更新后的触发器对象字符串化。复制触发器块，使用任何JSON格式编辑器在线缩进它，并将其粘贴到您先前下载的同一个容器文件中。现在将更新的容器文件导入到您的GTM帐户中。</p><p id="4d2c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">继续将容器文件导入GTM之前的清单:</p><ol class=""><li id="3efa" class="ma mb hi iw b ix iy jb jc jf mc jj md jn me jr mf mg mh mi bi translated">确保选择正确的工作空间，因为它将影响未发布的更改</li><li id="1e32" class="ma mb hi iw b ix mj jb mk jf ml jj mm jn mn jr mf mg mh mi bi translated">选择容器导入的方法。我建议覆盖现有的容器。</li><li id="a52c" class="ma mb hi iw b ix mj jb mk jf ml jj mm jn mn jr mf mg mh mi bi translated">监控标签、触发器和变量更新/计数，以留意记录的重复。</li></ol><h1 id="c8d9" class="ki kj hi bd kk kl ln kn ko kp lo kr ks kt lp kv kw kx lq kz la lb lr ld le lf bi translated"><strong class="ak">结尾注释</strong></h1><p id="39f8" class="pw-post-body-paragraph iu iv hi iw b ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr hb bi translated">最后，这就是我们如何在最少人工干预的情况下实现GTM标签或触发器的批量更新，从而节省数小时的繁琐工作。本文是基于触发器上的批量编辑/更新编写的。发布的脚本可以作为模板使用，只需稍作修改，就可以与标签和变量兼容。</p><p id="41fc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有没有任何改进批量更新自动化的建议，请在下面的评论中留下。</p></div></div>    
</body>
</html>