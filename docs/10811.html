<html>
<head>
<title>Simple NLP Project: Hotel Review Sentiment Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简单的NLP项目:酒店评论情感分析</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/simple-nlp-project-hotel-review-sentiment-analysis-9a772f6170d1?source=collection_archive---------13-----------------------#2020-11-03">https://medium.com/analytics-vidhya/simple-nlp-project-hotel-review-sentiment-analysis-9a772f6170d1?source=collection_archive---------13-----------------------#2020-11-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="7d08" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">假设我们打开一个酒店页面，并寻找评论部分。我们会的菲。不同用户编写的一些文本。如果我们使用一些数据科学技术来分析所有的文本并得出评论的结论，会发生什么？我们将使用文本分析从互联网上获取数据信息。这叫做情感分析。</p><blockquote class="jk jl jm"><p id="b852" class="im in jn io b ip iq ir is it iu iv iw jo iy iz ja jp jc jd je jq jg jh ji jj hb bi translated"><a class="ae jr" href="https://en.wikipedia.org/wiki/Sentiment_analysis" rel="noopener ugc nofollow" target="_blank"> <strong class="io hj">情感分析</strong> </a>(又称<strong class="io hj">观点挖掘</strong>或<strong class="io hj">情感AI </strong>)是指利用<a class="ae jr" href="https://en.wikipedia.org/wiki/Natural_language_processing" rel="noopener ugc nofollow" target="_blank">自然语言处理</a>、<a class="ae jr" href="https://en.wikipedia.org/wiki/Text_analytics" rel="noopener ugc nofollow" target="_blank">文本分析</a>、<a class="ae jr" href="https://en.wikipedia.org/wiki/Computational_linguistics" rel="noopener ugc nofollow" target="_blank">计算语言学</a>、<a class="ae jr" href="https://en.wikipedia.org/wiki/Biometrics" rel="noopener ugc nofollow" target="_blank">生物统计学</a>对情感状态和主观信息进行系统的识别、提取、量化和研究。情感分析广泛应用于<a class="ae jr" href="https://en.wikipedia.org/wiki/Voice_of_the_customer" rel="noopener ugc nofollow" target="_blank">客户之声</a>材料，如评论和调查回复、在线和社交媒体以及医疗保健材料，应用范围从<a class="ae jr" href="https://en.wikipedia.org/wiki/Marketing" rel="noopener ugc nofollow" target="_blank">营销</a>到<a class="ae jr" href="https://en.wikipedia.org/wiki/Customer_relationship_management" rel="noopener ugc nofollow" target="_blank">客户服务</a>再到临床医学。</p></blockquote><p id="5f2d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">情感分析是自然语言处理(NLP)的一个领域，它建立了一个识别和提取文本形式观点的系统。酒店点评的数据例子我们可以从<a class="ae jr" href="https://www.kaggle.com/anu0012/hotel-review" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>得到。</p><h1 id="5a61" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">加载数据</h1><p id="cc22" class="pw-post-body-paragraph im in hi io b ip kq ir is it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj hb bi translated">首先，我们应该将数据加载到我们的项目中。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="9dbb" class="le jt hi la b fi lf lg l lh li">import pandas as pd</span><span id="53eb" class="le jt hi la b fi lj lg l lh li">train_df = pd.read_csv(“train.csv”)</span><span id="5f35" class="le jt hi la b fi lj lg l lh li">test_df = pd.read_csv(“test.csv”)</span></pre><h1 id="9bb1" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">探索性数据</h1><p id="301a" class="pw-post-body-paragraph im in hi io b ip kq ir is it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj hb bi translated">让我们执行一个快速的探索性数据。</p><p id="eaa4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">描述列车数据帧:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="f565" class="le jt hi la b fi lf lg l lh li">print(train_df.describe().transpose())</span></pre><figure class="kv kw kx ky fd ll er es paragraph-image"><div class="er es lk"><img src="../Images/af29e89374f5d1e7917fe2bcddf1f1af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*HFTfnC5jybcBdomHZPE-Vw.png"/></div></figure><p id="c14c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在显示两类考核的百分比分布。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="a0d5" class="le jt hi la b fi lf lg l lh li">import matplotlib.pyplot as plt</span><span id="664d" class="le jt hi la b fi lj lg l lh li">plt.figure(figsize=(12,6))</span><span id="7bef" class="le jt hi la b fi lj lg l lh li">plt.title("Percentage Distributions by Review Type")</span><span id="9770" class="le jt hi la b fi lj lg l lh li">g = plt.pie(round(train_df.Is_Response.value_counts(normalize=True)*100,2),explode=(0.025,0.025), labels=round(train_df.Is_Response.value_counts(normalize=True)*100,2).index, colors=["c","m"],autopct="%1.1f%%", startangle=180)</span><span id="20c9" class="le jt hi la b fi lj lg l lh li">plt.show()</span></pre><figure class="kv kw kx ky fd ll er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lo"><img src="../Images/729b1e92e8a9cdf64f9174086924ade2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dKy34U7ghfN6ybDoqD7EFg.png"/></div></div></figure><h1 id="21df" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">预处理数据</h1><p id="9196" class="pw-post-body-paragraph im in hi io b ip kq ir is it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj hb bi translated">为了适应模型，我们只需要描述列，所以我们应该使用drop函数删除不相关的列。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="e3e4" class="le jt hi la b fi lf lg l lh li">train_df.drop(columns = ['User_ID', 'Browser_Used', 'Device_Used'], inplace = True)</span></pre><p id="8cc3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因为我们处理的是文本数据，所以清理数据是这里的重要部分。我们对文本数据进行基本的清理，例如转换成小写字母，去掉方括号，去掉数字和标点符号。我们像这样设置函数</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="d06a" class="le jt hi la b fi lf lg l lh li">def text_clean_1(text):<br/>    text = text.lower()<br/>    text = re.sub('\[.*?\]', '', text)<br/>    text = re.sub('[%s]' % re.escape(string.punctuation), '', text)<br/>    text = re.sub('\w*\d\w*', '', text)<br/>    return text<br/>cleaned1 = lambda x: text_clean_1(x)</span><span id="9449" class="le jt hi la b fi lj lg l lh li">def text_clean_2(text):<br/>    text = re.sub('[‘’“”…]', '', text)<br/>    text = re.sub('\n', '', text)<br/>    return text<br/>cleaned2 = lambda x: text_clean_2(x)</span></pre><p id="05b5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">也是为了解构文本</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="ecf5" class="le jt hi la b fi lf lg l lh li">def decontract_text(text):<br/># specific<br/>    text = re.sub(r"won\'t", "will not", text)<br/>    text = re.sub(r"can\'t", "can not", text)<br/>    text = re.sub(r"won\’t", "will not", text)<br/>    text = re.sub(r"can\’t", "can not", text)<br/>    text = re.sub(r"\'t've", " not have", text)<br/>    text = re.sub(r"\'d've", " would have", text)<br/>    text = re.sub(r"\'clock", "f the clock", text)<br/>    text = re.sub(r"\'cause", " because", text)<br/># general<br/>    text = re.sub(r"n\'t", " not", text)<br/>    text = re.sub(r"\'re", " are", text)<br/>    text = re.sub(r"\'s", " is", text)<br/>    text = re.sub(r"\'d", " would", text)<br/>    text = re.sub(r"\'ll", " will", text)<br/>    text = re.sub(r"\'t", " not", text)<br/>    text = re.sub(r"\'ve", " have", text)<br/>    text = re.sub(r"\'m", " am", text)<br/>    text = re.sub(r"n\’t", " not", text)<br/>    text = re.sub(r"\’re", " are", text)<br/>    text = re.sub(r"\’s", " is", text)<br/>    text = re.sub(r"\’d", " would", text)<br/>    text = re.sub(r"\’ll", " will", text)<br/>    text = re.sub(r"\’t", " not", text)<br/>    text = re.sub(r"\’ve", " have", text)<br/>    text = re.sub(r"\’m", " am", text)<br/>return text</span></pre><p id="a466" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">把它放在新的栏目里</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="d33c" class="le jt hi la b fi lf lg l lh li">train_df['cleaned_description'] = train_df['Description'].apply(lambda x: decontract_text(x))</span><span id="9c77" class="le jt hi la b fi lj lg l lh li">train_df['cleaned_description'] = train_df['cleaned_description'].apply(lambda x: text_clean_1(x))</span><span id="8d4f" class="le jt hi la b fi lj lg l lh li">train_df['cleaned_description'] = train_df['cleaned_description'].apply(lambda x: text_clean_2(x))</span></pre><p id="a2fc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以知道前三个数据的区别</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="599b" class="le jt hi la b fi lf lg l lh li">print('Original:\n', train_df['Description'][:3])<br/>print('\n\nCleaned:\n', train_df['cleaned_description'][:3])</span><span id="9e47" class="le jt hi la b fi lj lg l lh li">Original: <br/>0 The room was kind of clean but had a VERY stro… <br/>1 I stayed at the Crown Plaza April — — April -… <br/>2 I booked this hotel through Hotwire at the low…<br/>Cleaned: <br/>0 the room was kind of clean but had a very stro… <br/>1 i stayed at the crown plaza april april th… <br/>2 i booked this hotel through hotwire at the low…</span></pre><h1 id="c48f" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">模特培训</h1><p id="6d5e" class="pw-post-body-paragraph im in hi io b ip kq ir is it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj hb bi translated">现在，在sklearn中，我们使用train_test_split对训练数据执行80–20拆分，以获得拟合模型所需的训练和测试数据集。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="442d" class="le jt hi la b fi lf lg l lh li">from sklearn.model_selection import train_test_split</span><span id="82cd" class="le jt hi la b fi lj lg l lh li">x, y = train_df['cleaned_description'], train_df['Is_Response']<br/>x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.1,random_state=42)</span><span id="2f50" class="le jt hi la b fi lj lg l lh li">print(f'x_train: {len(x_train)}')<br/>print(f'x_test: {len(x_test)}')<br/>print(f'y_train: {len(y_train)}')<br/>print(f'y_test: {len(y_test)}')</span><span id="9c2e" class="le jt hi la b fi lj lg l lh li">x_train : 35038<br/>x_test  : 3894<br/>y_train : 35038<br/>y_test  : 3894</span></pre><p id="bee1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我们找到预测值。我们将使用tfidf矢量器，通过将清理后的文本转换为TF-IDF特征矩阵来提取特征。对于分类，我们使用逻辑回归。最后，我们通过结合矢量器和分类器创建了一个模型管道。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="809a" class="le jt hi la b fi lf lg l lh li">from sklearn.feature_extraction.text import TfidfVectorizer<br/>from sklearn.linear_model import LogisticRegression</span><span id="2edb" class="le jt hi la b fi lj lg l lh li">tvec = TfidfVectorizer()<br/>clf2 = LogisticRegression(solver = “lbfgs”)</span><span id="bd68" class="le jt hi la b fi lj lg l lh li">from sklearn.pipeline import Pipeline</span><span id="2948" class="le jt hi la b fi lj lg l lh li">model = Pipeline([(‘vectorizer’,tvec),(‘classifier’,clf2)])<br/>model.fit(x_train, y_train)</span><span id="9a2e" class="le jt hi la b fi lj lg l lh li">from sklearn.metrics import confusion_matrix</span><span id="233f" class="le jt hi la b fi lj lg l lh li">predictions = model.predict(x_test)<br/>confusion_matrix(predictions, y_test)</span></pre><p id="f3a0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以得到测试的向量</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="a287" class="le jt hi la b fi lf lg l lh li">array([[2426,  310],<br/>       [ 145, 1013]])</span></pre><h1 id="873e" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">模型预测法</h1><p id="2182" class="pw-post-body-paragraph im in hi io b ip kq ir is it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj hb bi translated">现在，我们通过计算准确度、精确度和召回率来评估模型。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="c64c" class="le jt hi la b fi lf lg l lh li">from sklearn.metrics import accuracy_score, precision_score, recall_score</span><span id="e576" class="le jt hi la b fi lj lg l lh li">y_pred = model.predict(x_test)</span><span id="bc9c" class="le jt hi la b fi lj lg l lh li">print(f'Accurcy: {accuracy_score(y_pred, y_test)}')<br/>print(f'Precision: {precision_score(y_pred, y_test, average="weighted")}')<br/>print(f'Recall: {recall_score(y_pred, y_test, average="weighted")}')</span><span id="80c7" class="le jt hi la b fi lj lg l lh li">Accurcy: 0.9096045197740112 <br/>Precision: 0.9130447094377214 <br/>Recall: 0.9096045197740112</span></pre><p id="1f06" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">准确性是我们的模型的正确预测的分数。从准确度值来看，我们得到了0.91，这意味着总共100%的例子中有91%的正确预测。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="b87f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您可以通过我的GitHub下载数据和python代码文档:</p><div class="lt lu ez fb lv lw"><a href="https://github.com/dwiknrd/medium-code/tree/master/hotel_review_sentiment_analysis" rel="noopener  ugc nofollow" target="_blank"><div class="lx ab dw"><div class="ly ab lz cl cj ma"><h2 class="bd hj fi z dy mb ea eb mc ed ef hh bi translated">dwiknrd/中等代码</h2><div class="md l"><h3 class="bd b fi z dy mb ea eb mc ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="me l"><p class="bd b fp z dy mb ea eb mc ed ef dx translated">github.com</p></div></div><div class="mf l"><div class="mg l mh mi mj mf mk lm lw"/></div></div></a></div></div></div>    
</body>
</html>