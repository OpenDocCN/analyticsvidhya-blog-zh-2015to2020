<html>
<head>
<title>Deploy ML tensorflow model using Flask(backend+frontend)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Flask部署ML tensorflow模型(后端+前端)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploy-ml-tensorflow-model-using-flask-backend-frontend-12a38ce53b7f?source=collection_archive---------3-----------------------#2020-04-15">https://medium.com/analytics-vidhya/deploy-ml-tensorflow-model-using-flask-backend-frontend-12a38ce53b7f?source=collection_archive---------3-----------------------#2020-04-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a194" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用flask连接张量流模型或任何python项目，而不使用任何API调用。添加任何ML原型和展示您的项目。使用heroku部署。</p><h2 id="9235" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">动机:</h2><p id="78ed" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">因为，许多<strong class="ih hj">学生</strong>想要部署他们的<strong class="ih hj">大学项目</strong>，例如最后一年的项目，但是他们对不同的技术不太熟悉。他们的主要动机是生产而不是部署，所以大多数学生给<strong class="ih hj">最少的部署时间</strong>。</p><blockquote class="kd ke kf"><p id="8267" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj">注意:这不是部署的实际解决方案，而是展示您的工作原型的简单方法。</strong></p></blockquote><p id="9562" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设你创建了一个<strong class="ih hj">机器学习项目</strong>，但是你必须用<strong class="ih hj">漂亮的GUI </strong>向<strong class="ih hj">你的向导</strong>展示最终的工作模型，它应该看起来像最终产品。</p><p id="6d85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，相反，我们运行代码，并试图解释发生了什么，你的向导可能不喜欢。因此，为了让它工作，我创建了这个教程来处理机器学习模型<strong class="ih hj">而不使用任何API调用</strong>和其他复杂的东西。</p><p id="03de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以用类似的方式部署任何python项目，而不是使用tkinter或任何其他框架。</p><blockquote class="kd ke kf"><p id="11ad" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">这种方法有一些缺点:</p><p id="ad23" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">没有api调用，因此进程不会异步运行。程序可能需要一些时间来完成进程，因为它的执行是同步进行的。</p></blockquote><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es kk"><img src="../Images/21efef18c9e70fc53e50c31676a7d72a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/1*Q_cZSGkYN-KoAey2AWDgYQ.png"/></div></figure><h1 id="b131" class="ks je hi bd jf kt ku kv jj kw kx ky jn kz la lb jq lc ld le jt lf lg lh jw li bi translated">目录:</h1><blockquote class="kd ke kf"><p id="50ee" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">1.创建Flask web应用程序</p><p id="10fa" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">2.下载并检查模型文件或使用您自己的文件</p><p id="89c2" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">3.创建表单以从flask web应用程序获取输入</p><p id="bb32" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">4.将图像传递给模型</p><p id="9bb4" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">5.预测结果</p><p id="7947" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">6.部署</p><p id="93c9" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">7.维持</p></blockquote><p id="7355" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kg">每一步都提供了所有中间代码的链接。</em></p><h1 id="9ab5" class="ks je hi bd jf kt ku kv jj kw kx ky jn kz la lb jq lc ld le jt lf lg lh jw li bi translated">1.创建Flask web应用程序</h1><p id="ed5e" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">完成下面给定的教程或直接从教程中克隆git库。</p><div class="lj lk ez fb ll lm"><a rel="noopener follow" target="_blank" href="/@hasan123.haider/create-anywhere-use-flask-web-app-with-pycharm-fa67719df4d7"><div class="ln ab dw"><div class="lo ab lp cl cj lq"><h2 class="bd hj fi z dy lr ea eb ls ed ef hh bi translated">使用pycharm在任何地方创建Flask web应用程序</h2><div class="lt l"><h3 class="bd b fi z dy lr ea eb ls ed ef dx translated">Flask网络应用程序创建与系统的flask文件结构，即用型模板和使用它在任何地方为任何…</h3></div><div class="lu l"><p class="bd b fp z dy lr ea eb ls ed ef dx translated">medium.com</p></div></div><div class="lv l"><div class="lw l lx ly lz lv ma kq lm"/></div></div></a></div><p id="5912" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你将得到一个现成的文件结构，它将被使用。在上面的教程中，我们将项目文件夹命名为‘flask _ H5’。</p><h1 id="d3b3" class="ks je hi bd jf kt ku kv jj kw kx ky jn kz la lb jq lc ld le jt lf lg lh jw li bi translated">2.下载并检查模型文件或使用您自己的模型文件</h1><p id="0670" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">让我们为我们的项目找出一些预先训练好的模型文件。您可以带着您想要使用的模型文件和代码。</p><p id="785c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们正在从<strong class="ih hj"> imageAI </strong>中获取预训练图像<strong class="ih hj">预测模型文件</strong></p><div class="lj lk ez fb ll lm"><a href="https://imageai.readthedocs.io/en/latest/prediction/index.html" rel="noopener  ugc nofollow" target="_blank"><div class="ln ab dw"><div class="lo ab lp cl cj lq"><h2 class="bd hj fi z dy lr ea eb ls ed ef hh bi translated">预测类别— ImageAI 2.1.5文档</h2><div class="lt l"><h3 class="bd b fi z dy lr ea eb ls ed ef dx translated">ImageAI提供了非常强大但易于使用的类来执行图像识别任务。您可以执行所有这些…</h3></div><div class="lu l"><p class="bd b fp z dy lr ea eb ls ed ef dx translated">imageai.readthedocs.io</p></div></div><div class="lv l"><div class="mb l lx ly lz lv ma kq lm"/></div></div></a></div><p id="da94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我下载了我们项目的第一个h5模型文件。阅读imageAI文档以了解更多信息。</p><p id="88f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">resnet 50 _ weights _ TF _ dim _ ordering _ TF _ kernels . H5车型链接</strong>:</p><blockquote class="kd ke kf"><p id="ede8" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><a class="ae mc" href="https://github.com/OlafenwaMoses/ImageAI/releases/download/1.0/resnet50_weights_tf_dim_ordering_tf_kernels.h5" rel="noopener ugc nofollow" target="_blank">https://github . com/OlafenwaMoses/ImageAI/releases/download/1.0/resnet 50 _ weights _ TF _ dim _ ordering _ TF _ kernels . H5</a></p></blockquote><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es md"><img src="../Images/7015ccb411cc7acac8ae7975e7c87013.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*dd_Y_X87lIndy1ZL79G03Q.png"/></div></figure><p id="28bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是时候让<strong class="ih hj">测试我们的模型</strong>了。为此，我们将在“app”文件夹中创建一个新的<strong class="ih hj"><em class="kg">python文件</em> </strong>，我们希望在将来使用我们的模型。</p><blockquote class="kd ke kf"><p id="4e60" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">您可以在任何地方创建它，因为我们正在测试我们的模型，然后在测试后将其添加到<strong class="ih hj">应用程序文件夹</strong>中。</p></blockquote><p id="b9e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我把它命名为<strong class="ih hj">‘process . py’</strong>。</p><p id="5678" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在文档页的末尾(<a class="ae mc" href="https://imageai.readthedocs.io/en/latest/prediction/index.html" rel="noopener ugc nofollow" target="_blank">https://imageai . readthe docs . io/en/latest/prediction/index . html</a>)<strong class="ih hj">提供了预测一幅图像的示例代码</strong>。</p><p id="fbc7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将整个代码粘贴到我们的<strong class="ih hj"> <em class="kg">流程</em> </strong>文件中。</p><p id="555a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们只写<strong class="ih hj">所需库、加载模型、预测、返回结果等预测代码</strong>(不需要从头到尾粘贴整个笔记本内容)。</p><blockquote class="kd ke kf"><p id="e595" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">使用IDE的好处是我们不需要找出我们的错误和依赖。</p></blockquote><p id="88d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们需要tensorflow来运行我们的模型文件，因此我们将使用pip安装tensorflow库。我们采用<strong class="ih hj"> tensorflow v1 </strong>是因为我们的imageAI模型与v1兼容。</p><p id="2628" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您也可以通过<strong class="ih hj"> PyCharm设置</strong>来完成</p><p id="3fe9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到文件→设置→项目→项目解释器</p><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es md"><img src="../Images/fab566165834433a71a747089aa6b33f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*5AqKJzBaVCdGq1XAd3Nr3w.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx translated">pip安装张量流==1.15</figcaption></figure><p id="edd0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将看到虚拟环境中安装的所有模块。点击右上角的+图标。搜索tensorflow。勾选指定版本并<strong class="ih hj">选择版本1.15。</strong></p><p id="423d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击<strong class="ih hj">安装包。</strong></p><p id="416e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您得到错误或无法安装它从设置。</p><p id="2bd0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尝试以下命令:</p><blockquote class="kd ke kf"><p id="9fdd" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj"> pip安装张量流==1.15 </strong></p></blockquote><h2 id="9b11" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">使用process.py</h2><p id="3ddf" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">如果您使用自己的模型和代码，请跳过这一部分。</p><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es md"><img src="../Images/3e1978e306bc359851e0bc69ccbba6f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*kD0Ayc0VQmWRIc4dWCYBIg.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx translated">process.py</figcaption></figure><p id="747f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将在<strong class="ih hj">行1 </strong>看到一个错误，即导入库。</p><p id="0095" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里点击灯泡按钮，安装imageAI库。您也可以通过在虚拟环境中编写pip命令来手动完成。</p><blockquote class="kd ke kf"><p id="dd2f" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj"> pip安装图像ai </strong></p></blockquote><p id="bff3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装软件包可能需要一些时间。</p><p id="36df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在此之前，让我们找出代码中的内容。</p><p id="9813" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">在开始</strong>时，所有的依赖项都被导入。</p><p id="1301" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第4行</strong>获取当前文件位置，我们将在稍后连接flask时删除该位置。</p><p id="af55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第6到9行</strong>定义并加载我们的模型文件。这里我们可以看到使用了resnet模型，我<strong class="ih hj">在文件'<strong class="ih hj">static/</strong>resnet 50 _ weights _ TF _ dim _ ordering _ TF _ kernels . H5前添加了静态文件夹位置</strong></p><p id="565a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将模型文件复制并粘贴到<strong class="ih hj"> app/static </strong>文件夹中。</p><p id="f7cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下载任何输入图像并<strong class="ih hj">放入app/static </strong>文件夹。</p><p id="ff08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">编辑<strong class="ih hj">第10行</strong>并将图像位置更改为我们下载的图像</p><blockquote class="kd ke kf"><p id="b5e6" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">预测，概率= prediction . prediction image(OS . path . join(execution _ path，<strong class="ih hj">" static/input _ image _ name . jpg "</strong>)，result_count=10)</p></blockquote><p id="004c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，我们的包imageAI已经安装好了。模型文件、输入图像也放在静态文件夹中。</p><p id="f9ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在<strong class="ih hj">运行并测试process.py </strong>文件。</p><p id="c0e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kg">如果你有任何错误，请尝试解决，否则请在评论区提问。</em></p><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es mi"><img src="../Images/a20733f91445ece30d72b1b6d018a0c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:618/format:webp/1*0YdLEfxEup7fBNNsRRDmxA.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx translated">试验结果</figcaption></figure><blockquote class="kd ke kf"><p id="57f9" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">注意:如果您没有GPU，则无需担心tensorflow警告。</p></blockquote><p id="962e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到预测是成功的。</p><h1 id="a9e2" class="ks je hi bd jf kt ku kv jj kw kx ky jn kz la lb jq lc ld le jt lf lg lh jw li bi translated">3.创建表单以从Flask web应用程序获取输入</h1><p id="8fd9" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">现在，我们将尝试制作一个页面，并从用户那里获取图像，然后将其保存为临时文件，这些文件将在使用后被删除。</p><h2 id="0274" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">a.在模板文件夹中创建一个名为predict.html的html文件</h2><p id="6d58" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated"><strong class="ih hj"> Predict.html: </strong></p><p id="bad7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，我们将照常扩展布局文件，并开始实际的块。</p><p id="2565" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里面，我们添加了一个表单域，它将接受图像输入。</p><div class="lj lk ez fb ll lm"><a href="https://github.com/hasan-haider/Deploy-ML-tensorflow-model-using-Flask/blob/8727f2402d2fe8c2a5a8d0e3f588ec0334a8bcc4/app/templates/predict.html#L5" rel="noopener  ugc nofollow" target="_blank"><div class="ln ab dw"><div class="lo ab lp cl cj lq"><h2 class="bd hj fi z dy lr ea eb ls ed ef hh bi translated">Hasan-Haider/Deploy-ML-tensor flow-model-using-Flask</h2><div class="lt l"><h3 class="bd b fi z dy lr ea eb ls ed ef dx translated">使用flask连接tensorflow模型，不使用任何API调用。添加任何ML原型和展示您的项目。…</h3></div><div class="lu l"><p class="bd b fp z dy lr ea eb ls ed ef dx translated">github.com</p></div></div><div class="lv l"><div class="mj l lx ly lz lv ma kq lm"/></div></div></a></div><h2 id="ea8a" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">b.为预测页面添加路由功能</h2><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es mk"><img src="../Images/553b6b75a93766227ea0b7e5ae35113c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*3gq97sUtLsgBEe0o1-9qDQ.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx translated">routes.py</figcaption></figure><p id="57b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是连接我们的html文件和flask。</p><h2 id="1d21" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">c.修改layout.html并在导航栏中添加预测链接</h2><p id="f174" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated"><a class="ae mc" href="https://github.com/hasan-haider/Deploy-ML-tensorflow-model-using-Flask/blob/8727f2402d2fe8c2a5a8d0e3f588ec0334a8bcc4/app/templates/layout.html#L26" rel="noopener ugc nofollow" target="_blank">点击此处查看代码</a></p><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es ml"><img src="../Images/c8a1559d96b0155f11bd55ae51fb98e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*KLZRvGerY3_5B-T7vOV8wQ.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx translated">导航条</figcaption></figure><p id="cb93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过在虚拟环境中键入命令来运行flask应用程序。终端:</p><blockquote class="kd ke kf"><p id="1331" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj"> python app.py </strong></p></blockquote><h2 id="da49" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">d.创建名为“上传”的新路由函数，该函数将由表单操作调用，它会将输入图像保存在临时文件夹中。</h2><p id="84f6" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">添加获取表单输入请求的方法。在app文件夹中新建<strong class="ih hj">文件夹</strong>，命名为<strong class="ih hj"> <em class="kg"> temp </em> </strong>。</p><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es md"><img src="../Images/57bee7487acd4e54ac5ec898ba84baf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*UpxwqYJaUGefSQ-Y1ICk0A.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx translated">routes.py中的上传功能</figcaption></figure><p id="9d9e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该功能将图像文件保存在临时文件夹中，并将用于发送预测。</p><p id="8737" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">继续运行应用程序以查看中间结果。</p><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es mm"><img src="../Images/9fff9e2e3e7cf7b472034903de7004fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*1IYSXq9aBhCbAjI2EjUPVg.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx translated">127 . 0 . 0 . 1/预测</figcaption></figure><p id="51d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将选择图像并检查文件是否保存在临时文件夹中。</p><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es md"><img src="../Images/53565e66fc4babc9fb24b88d78997de6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*BSiUQNBgVKM6y8M7GTQYbw.png"/></div></figure><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es mn"><img src="../Images/b1a8e6d61c05556622a0bda994283d85.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/format:webp/1*uaGZTF4Jc6XyVCRyyZlCGA.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx translated">临时文件夹</figcaption></figure><p id="6e56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">我得到错误</strong>(因为，调用后上传函数没有返回任何内容)，但我的文件保存在临时文件夹中，这意味着<strong class="ih hj">表单工作正常</strong>。</p><h1 id="5ba4" class="ks je hi bd jf kt ku kv jj kw kx ky jn kz la lb jq lc ld le jt lf lg lh jw li bi translated">4.将输入图像传递给模型</h1><p id="4759" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">创建<strong class="ih hj">新的路由函数‘预测(文件名)’</strong>，以文件名作为其参数。</p><p id="e97a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">保存图像后，我们的上传函数将调用该函数。</p><div class="lj lk ez fb ll lm"><a href="https://github.com/hasan-haider/Deploy-ML-tensorflow-model-using-Flask/blob/8727f2402d2fe8c2a5a8d0e3f588ec0334a8bcc4/app/routes.py#L34" rel="noopener  ugc nofollow" target="_blank"><div class="ln ab dw"><div class="lo ab lp cl cj lq"><h2 class="bd hj fi z dy lr ea eb ls ed ef hh bi translated">Hasan-Haider/Deploy-ML-tensor flow-model-using-Flask</h2><div class="lt l"><h3 class="bd b fi z dy lr ea eb ls ed ef dx translated">使用flask连接tensorflow模型，不使用任何API调用。添加任何ML原型和展示您的项目。…</h3></div><div class="lu l"><p class="bd b fp z dy lr ea eb ls ed ef dx translated">github.com</p></div></div><div class="lv l"><div class="mo l lx ly lz lv ma kq lm"/></div></div></a></div><p id="d450" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">在路线中导入process.py </strong>而不是添加整个型号代码。</p><p id="3e7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我修改了process.py，使它只包含<strong class="ih hj">一个从route调用的函数</strong>。</p><p id="62f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae mc" href="https://github.com/hasan-haider/Deploy-ML-tensorflow-model-using-Flask/blob/master/app/process.py" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">点击此处打开process.py </strong> </a>的git链接</p><p id="b364" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">process.py中的<strong class="ih hj"> <em class="kg"> predict_img </em> </strong>函数将<strong class="ih hj">返回</strong>字典结果，即您的模型的输出。</p><h2 id="4c69" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">创建将显示结果的新html文件。</h2><p id="df77" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">我创建了output.html，它通过结果变量在路由中传递。</p><p id="18e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae mc" href="https://github.com/hasan-haider/Deploy-ML-tensorflow-model-using-Flask/blob/master/app/templates/output.html" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">output.html代码</strong> </a></p><p id="898c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的应用程序已经可以使用了。</p><p id="1e48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们试一试</p><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es mp"><img src="../Images/d8a50012f42d9d9ec27c16be1144e57e.png" data-original-src="https://miro.medium.com/v2/resize:fit:718/format:webp/1*7KnWDLzo_Z1cz0l7uk_asQ.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx">1</figcaption></figure><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es mq"><img src="../Images/59669b18fe5476195f576869a5d89aec.png" data-original-src="https://miro.medium.com/v2/resize:fit:282/format:webp/1*rezeK831gT9so_UpCBLq0w.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx">2</figcaption></figure><p id="fa8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.选择图像</p><p id="438c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.图像已上传</p><p id="c656" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.终端的最后一行显示上传工作正常，图像被传递给预测函数。如果有tf信息/警告，请忽略。</p><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es md"><img src="../Images/04151c2606ec8d4d8565c8ff521aa586.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*i3_VwEttu9Ty1_-AOPwzlg.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx">3</figcaption></figure><blockquote class="kd ke kf"><p id="32b3" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj">对于CPU用户:要隐藏张量流警告，请在process.py中添加代码</strong></p><p id="657a" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="hi">开始时:</em> </strong></p><p id="508e" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">导入张量流</p><p id="f2c2" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">OS . environ[<strong class="ih hj">" TF _ CPP _ MIN _ LOG _ LEVEL "</strong>]=<strong class="ih hj">" 3 "</strong></p><p id="73e3" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="hi">在</em> predict_img <em class="hi">函数中，模型将被加载到:</em> </strong></p><p id="c3a0" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">tensor flow . compat . v1 . logging . set _ verbosity(tensor flow . compat . v1 . logging . error)</p></blockquote><h1 id="7ca6" class="ks je hi bd jf kt ku kv jj kw kx ky jn kz la lb jq lc ld le jt lf lg lh jw li bi translated">5.预测结果</h1><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es md"><img src="../Images/91c6c8534c57f3deb8af2b381d43bab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*pt2Q9ubihiU_VIv7pKYm2Q.png"/></div></figure><h2 id="8671" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">总结我们到目前为止所做的工作:</h2><p id="4719" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">从表单中获取输入，并将其传递给route函数。</p><p id="452e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将表单数据重定向到预测路由函数。</p><p id="d752" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预测路由函数调用存在于另一个文件中实际模型函数。</p><p id="937d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果返回给预测路径函数，并作为变量通过render_template传递给用户。</p><h1 id="a496" class="ks je hi bd jf kt ku kv jj kw kx ky jn kz la lb jq lc ld le jt lf lg lh jw li bi translated">6.与heroku一起部署</h1><p id="2354" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">在heroku的帮助下，可以展开测试<strong class="ih hj">自由</strong>的烧瓶。</p><p id="71b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Heroku免费给<strong class="ih hj"> 500 Mb空间</strong>来部署我们的网站。只需从网站下载heroku即可部署。关于配置flask文件，你可以找到很多关于如何在heroku上部署的文章。</p><div class="lj lk ez fb ll lm"><a href="https://devcenter.heroku.com/articles/getting-started-with-python" rel="noopener  ugc nofollow" target="_blank"><div class="ln ab dw"><div class="lo ab lp cl cj lq"><h2 class="bd hj fi z dy lr ea eb ls ed ef hh bi translated">使用Python开始使用Heroku</h2><div class="lt l"><h3 class="bd b fi z dy lr ea eb ls ed ef dx translated">本教程将让你在几分钟内部署一个Python应用程序(一个简单的Django应用程序)。再坚持几分钟…</h3></div><div class="lu l"><p class="bd b fp z dy lr ea eb ls ed ef dx translated">devcenter.heroku.com</p></div></div><div class="lv l"><div class="mr l lx ly lz lv ma kq lm"/></div></div></a></div><p id="320e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了让您大致了解在heroku中部署需要做些什么，您将创建一个名为<strong class="ih hj">‘proc file’</strong>的文件，不带任何扩展名。</p><p id="c2f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ProcFile内部:</p><blockquote class="kd ke kf"><p id="faff" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj"> web: gunicorn应用:应用</strong></p></blockquote><p id="8762" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将需要<strong class="ih hj"> requirements.txt </strong>文件，您可以在flask虚拟环境中键入命令自动创建该文件:</p><blockquote class="kd ke kf"><p id="6a3b" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj"> pip冻结&gt;需求. txt </strong></p></blockquote><p id="1b58" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您必须<strong class="ih hj">将</strong> app.py重命名为application.py。同样在init和其他文件中，您必须将<strong class="ih hj"> app </strong> =Flask… <strong class="ih hj">更改为application </strong> =Flask…</p><p id="259d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">在使用app变量的地方使用“应用程序”来折射app变量。</strong></p><p id="1f63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在主“flask_h5”文件夹中创建名为<strong class="ih hj"> 'config.py' </strong>的文件。它将包含密钥。</p><p id="17f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">配置文件:</strong></p><blockquote class="kd ke kf"><p id="db87" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">导入操作系统</p><p id="6f92" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">类别配置:</p><p id="2464" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">SECRET _ KEY = OS . environ . get(' SECRET _ KEY ')</p></blockquote><p id="df34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除__init__.py中添加的密钥，包含密钥的config.py将在init中被调用。</p><p id="5515" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> __init__。py: </strong></p><blockquote class="kd ke kf"><p id="058b" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">从配置导入配置</p><p id="0b7e" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi">…</p><p id="ec3a" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">应用程序=烧瓶(__name__)</p><p id="77f0" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj">应用程序.配置.来自_对象(配置)</strong></p><p id="24ff" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi">…</p></blockquote><p id="c2d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些是在heroku上部署flask的要求。</p><p id="1801" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前往heroku网站，验证所有修改是否符合他们的要求。</p><h1 id="fd2d" class="ks je hi bd jf kt ku kv jj kw kx ky jn kz la lb jq lc ld le jt lf lg lh jw li bi translated">6.维持</h1><p id="6dd2" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">如果您想更改或修改已部署的heroku平台中的代码。</p><p id="35c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用git提交更新文件，然后使用<strong class="ih hj"><em class="kg">‘git push heroku master’</em></strong>命令在heroku中再次部署。</p><p id="7c33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您发现任何步骤有困难，请发表评论。</p><div class="lj lk ez fb ll lm"><a href="https://github.com/hasan-haider/Deploy-ML-tensorflow-model-using-Flask" rel="noopener  ugc nofollow" target="_blank"><div class="ln ab dw"><div class="lo ab lp cl cj lq"><h2 class="bd hj fi z dy lr ea eb ls ed ef hh bi translated">Hasan-Haider/Deploy-ML-tensor flow-model-using-Flask</h2><div class="lt l"><h3 class="bd b fi z dy lr ea eb ls ed ef dx translated">使用flask连接tensorflow模型，不使用任何API调用。添加任何ML原型和展示您的项目…</h3></div><div class="lu l"><p class="bd b fp z dy lr ea eb ls ed ef dx translated">github.com</p></div></div><div class="lv l"><div class="ms l lx ly lz lv ma kq lm"/></div></div></a></div><p id="5161" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">觉得这个有用就鼓掌。</p></div></div>    
</body>
</html>