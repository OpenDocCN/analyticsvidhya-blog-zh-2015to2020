<html>
<head>
<title>Creating Map Animations Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python创建地图动画</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/creating-map-animations-using-python-3b52061768a3?source=collection_archive---------14-----------------------#2020-08-03">https://medium.com/analytics-vidhya/creating-map-animations-using-python-3b52061768a3?source=collection_archive---------14-----------------------#2020-08-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="99e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将向你展示制作地图动画的整个过程，我在我的第一篇<a class="ae jd" rel="noopener" href="/@rahulrisav/covid-19-in-india-visualising-the-data-ec78897a8dbc">文章</a>中使用过这个过程。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/3eb23143c3ea886f0d3ba9d02a94f109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HRhUfhn1DBaeElOM4HTRmw.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">由<a class="ae jd" href="https://unsplash.com/@louishansel" rel="noopener ugc nofollow" target="_blank">路易·汉瑟</a>在<a class="ae jd" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="6672" class="kb kc hi bd kd ke kf kg kh ki kj kk kl iq km kn ko iu kp kq kr iy ks kt ku kv bi translated">我将使用的Python包:</h2><p id="a0e0" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">我将使用的Python包是<a class="ae jd" href="https://scitools.org.uk/cartopy/docs/latest/" rel="noopener ugc nofollow" target="_blank"> Cartopy </a>。它最初是由英国气象局开发的，这样科学家就可以准确地可视化他们的数据。Cartopy利用了<strong class="ih hj"> PROJ.4 </strong>、<strong class="ih hj"> NumPy </strong>和<strong class="ih hj"> Shapely </strong>库，并在<strong class="ih hj"> Matplotlib </strong>之上构建了一个接口。</p><h2 id="e281" class="kb kc hi bd kd ke kf kg kh ki kj kk kl iq km kn ko iu kp kq kr iy ks kt ku kv bi translated">抽样资料</h2><p id="39dd" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">样本数据是从以下<a class="ae jd" href="https://data.humdata.org/dataset/novel-coronavirus-2019-ncov-cases" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">网站</strong> </a>下载的新冠肺炎数据。它包含受新冠肺炎影响的每个国家的<strong class="ih hj">纬度</strong>和<strong class="ih hj">经度</strong>数据，以及每天的累计病例数。</p><h2 id="1447" class="kb kc hi bd kd ke kf kg kh ki kj kk kl iq km kn ko iu kp kq kr iy ks kt ku kv bi translated">数据预览</h2><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lb"><img src="../Images/fc8b7da835f35c39acc3fa09014d9e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3i1S23yNFZG0lfhe03kqmA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">这是数据的样子</figcaption></figure><h2 id="2bb4" class="kb kc hi bd kd ke kf kg kh ki kj kk kl iq km kn ko iu kp kq kr iy ks kt ku kv bi translated">提取纬度和经度</h2><p id="c112" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">我们需要从上面的数据中提取经纬度列表，列表从国家开始按顺序为排列<strong class="ih hj">，这显示了<strong class="ih hj">第一个新冠肺炎</strong>案例。</strong></p><p id="1209" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下面给出的代码中，对于每个数据列，我们迭代所有的行，检查特定行和列的值是否为<strong class="ih hj">零</strong>。如果该值不等于零，则附加相应的纬度和经度，从而确保纬度和经度列表按照该特定国家的新冠肺炎出现的顺序排列。由于相同的纬度和经度会被追加很多次，我们<strong class="ih hj">将</strong>的值更改为<strong class="ih hj"> 500 </strong>(更改为这样的<strong class="ih hj">值</strong>，使得<strong class="ih hj">不可能</strong>拥有<strong class="ih hj">纬度</strong>或<strong class="ih hj">经度</strong>)，以便以后更容易将它们从列表中删除。</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="cc3a" class="kb kc hi ld b fi lh li l lj lk">list_lat= []<br/>list_long = []</span><span id="19e9" class="kb kc hi ld b fi ll li l lj lk">for i in range(3, 193):<br/>    for k in range(data.shape[0]):<br/>        if(int(data.iloc[k, i]) != 0):<br/>            list_lat.append(data.iloc[k, 1])<br/>            list_long.append(data.iloc[k, 2])<br/><strong class="ld hj"><em class="lm">#Change the already appended values to a different value</em></strong><br/>            data.iloc[k, 1] = 500 <br/>            data.iloc[k, 2] = 500<br/>        else:<br/>            continue<br/>            <br/>list_lat[0:5] <br/>list_long[0:5]</span><span id="934d" class="kb kc hi ld b fi ll li l lj lk"><strong class="ld hj"><em class="lm">#Removing the 500s from the list<br/>#Latitude<br/></em></strong>for i in range(list_lat.count(500)):<br/>    list_lat.remove(500)<br/><strong class="ld hj"><em class="lm">#Longitude</em></strong><br/>for i in range(list_long.count(500)):<br/>    list_long.remove(500)</span></pre><h2 id="a626" class="kb kc hi bd kd ke kf kg kh ki kj kk kl iq km kn ko iu kp kq kr iy ks kt ku kv bi translated">创建制图地图</h2><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="bdbc" class="kb kc hi ld b fi lh li l lj lk"><strong class="ld hj"><em class="lm">#Installing Cartopy</em></strong><br/>pip install cartopy</span><span id="12c0" class="kb kc hi ld b fi ll li l lj lk"><strong class="ld hj"><em class="lm">#Importing required libraries<br/></em></strong>import cartopy<br/>import cartopy.crs as ccrs<br/>import cartopy.feature as cfeature<br/>from cartopy.mpl.gridliner import LONGITUDE_FORMATTER, LATITUDE_FORMATTER<br/>import matplotlib.pyplot as plt<br/>import cartopy.mpl.geoaxes<br/>from mpl_toolkits.axes_grid1.inset_locator import inset_axes<br/>from matplotlib.animation import FuncAnimation</span></pre><p id="3cb9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要检查Cartopy所需的<strong class="ih hj">依赖关系</strong>，请查看以下<a class="ae jd" href="https://scitools.org.uk/cartopy/docs/latest/installing.html" rel="noopener ugc nofollow" target="_blank">网站</a>。</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="3ca5" class="kb kc hi ld b fi lh li l lj lk"><strong class="ld hj"><em class="lm">#Creating the map object</em></strong><br/>fig = plt.figure()<br/>m1 = fig.add_subplot(1, 1, 1, projection=ccrs.PlateCarree())<br/><strong class="ld hj"><em class="lm">#Adding features to the map</em></strong><br/>m1.add_feature(cfeature.LAND)   <br/>m1.add_feature(cfeature.OCEAN)<br/>m1.add_feature(cfeature.COASTLINE)<br/>m1.add_feature(cfeature.BORDERS, linestyle=':')<br/>m1.add_feature(cfeature.LAKES, alpha=0.5)<br/>m1.add_feature(cfeature.RIVERS)<br/>m1.stock_img()</span></pre><p id="95a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在代码中，给出了上面的'<strong class="ih hj"> ccrs。______() </strong>'决定所创建地图的投影。Cartopy提供了多种投影，可以在下面的<a class="ae jd" href="https://scitools.org.uk/cartopy/docs/latest/crs/projections.html" rel="noopener ugc nofollow" target="_blank">网站</a>上查看。</p><p id="bd56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上面给出的代码中可以很明显地看出，‘<a class="ae jd" href="https://scitools.org.uk/cartopy/docs/latest/matplotlib/feature_interface.html#example-of-using-the-feature-class-with-the-matplotlib-interface" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">c feature</strong></a>’用于向地图添加各种功能。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ln"><img src="../Images/89ce7eab6bc1679570cf307ecc01229b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eExMnTMEGN215WxmLa9QBw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">可添加到地图的要素列表</figcaption></figure><h2 id="a833" class="kb kc hi bd kd ke kf kg kh ki kj kk kl iq km kn ko iu kp kq kr iy ks kt ku kv bi translated">动画</h2><p id="bacd" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">在下面给出的代码中，我们首先定义了一个'<strong class="ih hj"> animate </strong>函数，我们在<strong class="ih hj"> FuncAnimation </strong>中调用它。在“动画”功能中，我们在地图上绘制第一个点，之后我们从列表中删除它，这样当我们再次调用该功能时，将绘制下一组点。</p><p id="0eb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在FuncAnimation中，<strong class="ih hj"> fig </strong>代表我们已经创建的图形，<strong class="ih hj"> animate </strong>是我们已经创建的函数，<strong class="ih hj"> 265 </strong>表示我们想要调用“animate”函数的次数，而“interval”是我们想要在绘制两个点之间的时间间隔(以毫秒为单位)。</p><pre class="jf jg jh ji fd lc ld le lf aw lg bi"><span id="d996" class="kb kc hi ld b fi lh li l lj lk">X_points_1 = list_long<br/>Y_points_1= list_lat</span><span id="7c58" class="kb kc hi ld b fi ll li l lj lk">def animate(i):<br/>    X_points= X_points_1[0]<br/>    Y_points= Y_points_1[0]<br/>    X_points_1.remove(X_points_1[0])<br/>    Y_points_1.remove(Y_points_1[0])<br/>    m1.scatter(X_points, Y_points, color = 'red')</span><span id="2a89" class="kb kc hi ld b fi ll li l lj lk">ani= FuncAnimation(fig, animate, 265, interval=200, repeat = False)<br/>plt.show()</span></pre><p id="2be1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="lm">注:标绘点的输入格式为:(经度，纬度)。我建议使用终端或命令提示符在本地运行代码，而不是使用Jupyter Notebook。</em> </strong></p><h2 id="d7a9" class="kb kc hi bd kd ke kf kg kh ki kj kk kl iq km kn ko iu kp kq kr iy ks kt ku kv bi translated">结果</h2><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lo"><img src="../Images/3ebd02c85f0718316e5f926adf6db65a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*z-Ro55kNbytyI_6w-MHh2Q.gif"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">上面的动画展示了新冠肺炎的传播。</figcaption></figure><h2 id="c526" class="kb kc hi bd kd ke kf kg kh ki kj kk kl iq km kn ko iu kp kq kr iy ks kt ku kv bi translated">密码</h2><p id="e44a" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">上面动画的代码已经上传到下面的GitHub <a class="ae jd" href="https://github.com/rahulks9/COVID_VIZ/blob/master/animation.ipynb" rel="noopener ugc nofollow" target="_blank">库</a>。</p><h2 id="a2d5" class="kb kc hi bd kd ke kf kg kh ki kj kk kl iq km kn ko iu kp kq kr iy ks kt ku kv bi translated">数据</h2><p id="1ab5" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">数据摘自以下<a class="ae jd" href="https://data.humdata.org/dataset/novel-coronavirus-2019-ncov-cases" rel="noopener ugc nofollow" target="_blank">网站</a>。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="2a7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢你能走到这一步。请在下面的回复部分提出任何建议。</p></div></div>    
</body>
</html>