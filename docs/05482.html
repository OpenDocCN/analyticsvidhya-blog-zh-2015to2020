<html>
<head>
<title>DIY Data analysis of COVID-19</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">新冠肺炎DIY数据分析</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/diy-data-analysis-of-covid-19-da6cd0c99cd8?source=collection_archive---------27-----------------------#2020-04-22">https://medium.com/analytics-vidhya/diy-data-analysis-of-covid-19-da6cd0c99cd8?source=collection_archive---------27-----------------------#2020-04-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/42e6a6afc27bbf6a010b38dccad3565a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*jBzqg5V5xgZCv6hZjR9y1Q.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">来源:谷歌图片</figcaption></figure><p id="905a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">新冠肺炎·疫情把世界带入了一个反乌托邦的境地。</p><p id="b278" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">世界各地的政府和医学专家正在采取严厉的措施来控制病毒的传播，每个新闻频道都使用如上图所示的图表来更新该国的每日传播状况。有没有想过绘制这样的图表或者分析/可视化你家里的传播统计数据？</p><p id="a5e6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本帖中，我将向您展示如何使用新冠肺炎数据集通过逐步说明和解释来绘制图表。我们将使用Kaggle的数据集，可以从下面的链接下载，我们将使用Google Colab来运行我们的代码。所以打开Google Colab，新建一个Python3笔记本。</p><div class="jo jp ez fb jq jr"><a href="https://www.kaggle.com/imdevskp/covid19-corona-virus-india-dataset" rel="noopener  ugc nofollow" target="_blank"><div class="js ab dw"><div class="jt ab ju cl cj jv"><h2 class="bd hj fi z dy jw ea eb jx ed ef hh bi translated">新冠肺炎冠状病毒印度数据集</h2><div class="jy l"><h3 class="bd b fi z dy jw ea eb jx ed ef dx translated">州/UT/NCR wise新冠肺炎数据</h3></div><div class="jz l"><p class="bd b fp z dy jw ea eb jx ed ef dx translated">www.kaggle.com</p></div></div><div class="ka l"><div class="kb l kc kd ke ka kf ik jr"/></div></div></a></div><p id="3a42" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们将为我们的分析安装必要的库。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="9b9c" class="kp kq hi kl b fi kr ks l kt ku">!pip install fastai2 -q<br/>from fastai2.tabular.all import *</span></pre><p id="f61e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将安装fastai2库以及pandas和matplotlib，下一行将导入我们将使用的Fastai2的表格模块。</p><p id="e194" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们需要将下载的数据集上传到实例的内存中。我们可以通过点击左侧菜单栏中的文件-&gt;上传，或者使用下面的代码来创建一个文件上传GUI。现在，我们将只使用“complete.csv”文件。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="e91d" class="kp kq hi kl b fi kr ks l kt ku">from google.colab import files<br/>files.upload()</span></pre><p id="f630" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上传后，可以使用Pandas的read_csv函数查看我们的数据，df.head()显示数据帧的前5行。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="2fe4" class="kp kq hi kl b fi kr ks l kt ku">df=pd.read_csv('complete.csv')<br/>df.head()</span></pre><p id="0e26" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在将导入seaborn，一个专门用于数据可视化的库。每当我们访问该库时，我们可以将seaborn称为“sns”。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="af44" class="kp kq hi kl b fi kr ks l kt ku">import seaborn  as  sns</span></pre><p id="c5f2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最初，我们会在各州和确诊病例总数之间做一个散点图。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="1993" class="kp kq hi kl b fi kr ks l kt ku">sns.relplot(x="Total Confirmed cases",y="Name of State / UT",height=10,data=df).<em class="kv">set</em>(title="State-wise spread scatter plot")</span></pre><p id="c4a2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重要且相当困难的一步是转换数据以适应我们的目的，即预处理。在我们的数据集中，在特定日期在两个不同地方检测到的阳性病例被记录为两个不同的行。我们必须以这样一种方式创建一个数据框，每一行对应一个日期。我们将通过按日期对数据框的内容进行分组并对该日期检测到的所有阳性病例进行求和来实现这一点。使用相同的过程，我们将获得死亡和治愈数据，并创建一个新的数据框。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="49c9" class="kp kq hi kl b fi kr ks l kt ku">grp=df.groupby(by="Date")<br/>dates=df['Date'].unique()<br/>date_list=[]<br/>for i in dates:<br/>date_list.append(i)<br/>ddf=pd.DataFrame(date_list, columns=['Date'])</span></pre><p id="e282" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">既然我们已经创建了一个仅包含日期的数据框，我们可以将所需的数据添加到该数据框中。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="f080" class="kp kq hi kl b fi kr ks l kt ku">n=1<br/>count_list=[]<br/>labels=['Death','Total Confirmed cases','Cured/Discharged/Migrated']<br/>for l in labels:<br/>  for i in dates:<br/>    d=grp.get_group(i)[l]<br/>    count=d.sum()<br/>    count_list.append(count)</span><span id="b595" class="kp kq hi kl b fi kw ks l kt ku">  ddf.insert(n,l,count_list)<br/>  n+=1<br/>  count=0<br/>  count_list=[]</span></pre><p id="363b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们的新数据框(ddf)已经可以查看了。</p><p id="d7f1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，我碰巧注意到对应于日期13/04/2020的记录是错误的，因此我们将用上一个和下一个值的平均值替换该值。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="f91b" class="kp kq hi kl b fi kr ks l kt ku"><em class="kv">def</em> avg_val(<em class="kv">l</em>,<em class="kv">val</em>=74):<br/>  new_val=(array(ddf[l])[val-1] + array(ddf[l])[val+1] )/2<br/>  return <em class="kv">int</em>(new_val)<br/>change_label=['Death','Total Confirmed cases','Cured/Discharged/Migrated']</span><span id="e14d" class="kp kq hi kl b fi kw ks l kt ku">for l in change_label:<br/>  ddf.replace(to_replace=array(ddf[l])[74], value=avg_val(l)   ,inplace=True )</span></pre><p id="5205" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们的数据框已准备好进行绘制。我们将使用Seaborn的relplot()函数创建一个线形图，x轴表示日期，y轴表示案例总数。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="5af4" class="kp kq hi kl b fi kr ks l kt ku">plot=sns.relplot(x="Date",y="Total Confirmed cases" ,data=ddf,kind="line",height=10, estimator=None).<em class="kv">set</em>(title="Death Rate")<br/>plot.fig.autofmt_xdate()</span></pre><figure class="kg kh ki kj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es kx"><img src="../Images/bf05c0f5f23cfccf720644e43c44e48b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5IEesXzQvJ8XeZf-xO3r1A.png"/></div></div></figure><p id="1c22" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">类似地，我们可以通过改变“y”值来绘制死亡数据和治愈数据相对于日期的图表。</p><p id="7079" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从图中可以明显看出，尽管封锁了21天，但曲线似乎在稳步上升，这使得有必要延长印度的封锁期，以有效遏制病毒传播。</p><p id="5b49" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了比较所有这三个参数的趋势，我们可以使用多个lineplot()函数将它们绘制在一个图形中。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="7b0d" class="kp kq hi kl b fi kr ks l kt ku">plt.figure(figsize=(15,15))<br/>sns.lineplot(x="Date",y="Death",data=ddf,estimator=None)<br/>sns.lineplot(x="Date",y="Cured/Discharged/Migrated",data=ddf,estimator=None)<br/>sns.lineplot(x="Date",y="Total Confirmed cases",data=ddf,estimator=None)</span></pre><p id="4936" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可以通过更改figsize中的x和y值来调整图形的大小。</p><p id="9255" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了绘制各州的分布图，我们需要创建一个新的数据框，以便该数据框包含所有州的列表以及与该州相对应的确诊病例数。</p><p id="e93b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为此，我们将按状态对数据框进行分组，获取与状态对应的最新记录数据，并创建一个新的数据框。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="61a6" class="kp kq hi kl b fi kr ks l kt ku">state_group=df.groupby(by='Name of State / UT')<br/>states=df['Name of State / UT'].unique()</span><span id="fd2e" class="kp kq hi kl b fi kw ks l kt ku">state_case,state_death=[],[]<br/>for s in states:<br/>c=df.loc[df['Name of State / UT']==s].iloc[-1]['Total Confirmed cases']<br/>d=df.loc[df['Name of State / UT']==s].iloc[-1]['Death']<br/>c=<em class="kv">int</em>(c)<br/>d=<em class="kv">int</em>(d)<br/>state_case.append(c)<br/>state_death.append(d)<br/>c,d=0,0</span></pre><p id="f3c0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们已经获得了数据，我们可以创建一个新的数据帧——state _ df</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="f528" class="kp kq hi kl b fi kr ks l kt ku">state_df=pd.DataFrame(states, columns=['States'])<br/>state_df.insert(1,'case_count',state_case)<br/>state_df.insert(2,'Deaths',state_death)</span></pre><p id="a858" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有了这个数据框，我们将使用catplot()函数创建一个条形图。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="e9b2" class="kp kq hi kl b fi kr ks l kt ku">sns.catplot(y="States",x="case_count",data=state_df, kind="bar", height=10).<em class="kv">set</em>(title="state-wise spread")</span></pre><p id="e1b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的数据集有一些小故障，首先，数据集有相同states/UT的多个副本。为了在印度地图上绘制扩散强度，我们必须删除这些重复。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="26cd" class="kp kq hi kl b fi kr ks l kt ku">for d in (7,11,18): state_df.drop(index=d,inplace=True)</span></pre><p id="4fae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了在印度地图上绘制这些数据，我们必须获得印度地图的shapefile。可以从下面的链接下载。</p><p id="3e1e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae lc" href="https://www.arcgis.com/home/item.html?id=cf9b387de48248a687aafdd4cdff1127" rel="noopener ugc nofollow" target="_blank">https://www . ArcGIS . com/home/item . html id = cf9b 387 de 48248 a 687 aafdd 4 cdff 1127</a></p><p id="5924" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将导入geopandas库来在地图上绘制数据。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="20f5" class="kp kq hi kl b fi kr ks l kt ku">!pip install geopandas <br/>import geopandas as gpd<br/>import matplotlib.pyplot as plt</span></pre><p id="d0b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上传下载的。shp文件上传到Colab实例，就像我们上传“complete.csv”文件一样。上传后，获取文件的路径并保存在一个变量中，用read_file()函数打开文件。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="07c0" class="kp kq hi kl b fi kr ks l kt ku">gpath="/content/INDIA.shp"<br/>map_df=gpd.read_file(gpath)<br/>mad_df.head()<br/>map_df.plot(figsize=(5,5))</span></pre><p id="337b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这应该输出一个印度地图的图像。接下来，我们将创建一个仅包含州列表和case_count的数据框副本。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="0d09" class="kp kq hi kl b fi kr ks l kt ku">gdf=state_df[['States','case_count']]</span></pre><p id="5111" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们下载的shapefile具有一个状态列表和用于绘制状态的相应几何图形，该状态列表应与我们的数据框中的状态列表相匹配，以便可以合并它们。因此，我们将替换数据框中的州名以匹配shapefile。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="e383" class="kp kq hi kl b fi kr ks l kt ku">index=(22,1,14,20,28,15)<br/>value=['Jammu And Kashmir','Nct Of Delhi','Orissa','CHANDIGARH','ANDAMAN AND NICOBAR ISLANDS','Pondicherry']<br/>for i,v in zip(index,value):<br/>  gdf=gdf.replace(to_replace=gdf['States'][i], value=v)</span></pre><p id="0847" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在可以合并shapefile和我们的数据框了。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="6071" class="kp kq hi kl b fi kr ks l kt ku">merge=map_df.set_index('ST_NAME').join(gdf.set_index('States'))<br/>merge.head()</span></pre><p id="06ec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的合并数据框已经准备好进行绘制了！！</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="4855" class="kp kq hi kl b fi kr ks l kt ku">merge.plot(column=var, cmap='Reds',legend=True, figsize=(10,10),linewidth=5,legend_kwds=<br/>{'label': "Corona spread intensity",'orientation':"horizontal"})</span></pre><p id="0fd4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的最终输出应该如下所示:</p><figure class="kg kh ki kj fd ij er es paragraph-image"><div class="er es ld"><img src="../Images/f278555bf36ffc7cb02556726084effc.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*2K_1zGijy3B6rhefLYTetQ.png"/></div></figure><p id="8a85" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以从下面的GitHub链接获得完整的代码。</p><div class="jo jp ez fb jq jr"><a href="https://github.com/ajaykumaar/Deep-learning/blob/master/plot_india_covid.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="js ab dw"><div class="jt ab ju cl cj jv"><h2 class="bd hj fi z dy jw ea eb jx ed ef hh bi translated">ajaykumaar/深度学习</h2><div class="jy l"><h3 class="bd b fi z dy jw ea eb jx ed ef dx translated">permalink dissolve GitHub是4000多万开发人员的家园，他们一起工作来托管和审查代码，管理…</h3></div><div class="jz l"><p class="bd b fp z dy jw ea eb jx ed ef dx translated">github.com</p></div></div><div class="ka l"><div class="le l kc kd ke ka kf ik jr"/></div></div></a></div><p id="2d98" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，要了解Fastai库的更多信息，请点击下面的链接查看杰瑞米·霍华德的课程——“程序员的深度学习”。</p><div class="jo jp ez fb jq jr"><a href="https://course.fast.ai/" rel="noopener  ugc nofollow" target="_blank"><div class="js ab dw"><div class="jt ab ju cl cj jv"><h2 class="bd hj fi z dy jw ea eb jx ed ef hh bi translated">程序员实用深度学习，v3</h2><div class="jy l"><h3 class="bd b fi z dy jw ea eb jx ed ef dx translated">欢迎光临！如果你是所有这些深度学习的新手，那么不要担心-我们将带你一步一步地完成它…</h3></div><div class="jz l"><p class="bd b fp z dy jw ea eb jx ed ef dx translated">course.fast.ai</p></div></div><div class="ka l"><div class="lf l kc kd ke ka kf ik jr"/></div></div></a></div><p id="dae8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢，继续学习；)</p></div></div>    
</body>
</html>