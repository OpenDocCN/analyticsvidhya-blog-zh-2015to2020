<html>
<head>
<title>Python code obfuscation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 代码混淆</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/python-code-obfuscation-a2779af857bb?source=collection_archive---------10-----------------------#2020-12-06">https://medium.com/analytics-vidhya/python-code-obfuscation-a2779af857bb?source=collection_archive---------10-----------------------#2020-12-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/89a9d18f6b0c9060ab7e27dd3639d4ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SOn2wMaqTWc3te8Z"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://unsplash.com/@joshboot?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">乔希·布特</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="3802" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您正在使用 Python 并直接在 docker 镜像中或通过<a class="ae iu" href="https://pip.pypa.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> pip </a>可安装包部署您的代码。没有额外的预防措施，你的源代码很容易被任何人访问。如果您不介意的话，您可能仍然希望防止任何人篡改代码。由于 Python 的解释性质，这样做需要额外的步骤。谢天谢地，像往常一样，在丰富的 Python 生态系统中:解决方案是存在的。下面列出了针对此问题的现有解决方案的类别以及所选解决方案的详细信息。</p><p id="e0de" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">免责声明— </em>有人告诉我，只要付出足够的努力，任何事情都可以被逆向工程。我们的目标是让这变得更加困难。此外，基于<strong class="ix hj">信任</strong>做出固执己见的选择。这一次<strong class="ix hj">闭源</strong>解决方案是首选，因为恶意用户没有机会查看它的实现细节。</p><ul class=""><li id="3494" class="ju jv hi ix b iy iz jc jd jg jw jk jx jo jy js jz ka kb kc bi translated"><strong class="ix hj"> Python to exe family </strong> <br/>将 Python 代码作为可执行文件的工具将解释器和源代码捆绑到一个二进制文件中。无需额外的预防措施，即可轻松访问该资源。这些工具应该与下面描述的其他技术一起使用！</li><li id="e11b" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><strong class="ix hj">混淆<br/> </strong>简单的 python 混淆例如 base64 编码很容易被破解。很容易猜到…</li><li id="0a3b" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><strong class="ix hj">通过加密进行混淆</strong> <br/>这些更先进，允许额外的功能，如在加密代码的基础上设置过期时间(TTL)。(强制过期时间:未测试)</li><li id="7827" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><strong class="ix hj">一些更复杂的技术(比如 dropbox)也以逆向工程告终。关于这方面的有趣阅读，请点击这些<a class="ae iu" href="https://reverseengineering.stackexchange.com/questions/22648/best-way-to-protect-source-code-of-exe-program-running-on-python?" rel="noopener ugc nofollow" target="_blank">链接</a>。</strong></li><li id="eaa8" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated">cyt honcyt hon<br/>特别值得一提的是 Cython ，它值得拥有自己的类别。使用 Cython，您可以将 Python 代码编译成 C 二进制文件，这也使得逆向工程变得足够困难。然而，选择这种方式可能会涉及更改代码和额外的工作。</li></ul></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><h1 id="1e64" class="kp kq hi bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">用 sourcedefender 加密 python 源代码</h1><p id="ad8a" class="pw-post-body-paragraph iv iw hi ix b iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo lr jq jr js hb bi translated">选择的解决方案是:<a class="ae iu" href="https://pypi.org/project/sourcedefender/" rel="noopener ugc nofollow" target="_blank"> SourceDefender </a>，因为它很简单:</p><ul class=""><li id="8aa6" class="ju jv hi ix b iy iz jc jd jg jw jk jx jo jy js jz ka kb kc bi translated">您只需要运行一个命令来加密您想要保护免受<strong class="ix hj">攻击的源代码片段。py </strong>至<strong class="ix hj">。pye </strong>。</li><li id="e18f" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated">也因为他们通过快速解决一个 bug 而提供的技术支持。</li></ul><blockquote class="ls lt lu"><p id="2b4b" class="iv iw jt ix b iy iz ja jb jc jd je jf lv jh ji jj lw jl jm jn lx jp jq jr js hb bi translated">SOURCEdefender 可以用 AES 256 位加密保护你的明文 Python 源代码。由于解密过程发生在模块导入期间或在命令行上加载脚本时，因此不会影响正在运行的应用程序的性能。一旦从<em class="hi">加载，加密代码的运行速度不会变慢。与从<em class="hi">加载相比，pye </em>文件。py </em>或<em class="hi">。pyc </em>文件。</p></blockquote><p id="cf82" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从 pypi 页面可以看出，基本用法很简单。一旦运行受保护的代码，像 Python 的 inspect 模块的<a class="ae iu" href="https://docs.python.org/3/library/inspect.html#inspect.getsource" rel="noopener ugc nofollow" target="_blank"> getsource </a>这样的基本窥探工具就会返回乱码。在错误回溯中，包括文件名和行号，但也没有源。</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="3857" class="mh kq hi md b fi mi mj l mk ml">Traceback (most recent call last):<br/>  File "src/config/helper.pye", line 85, in start<br/>IxlqeEBtjE9CDDaHwLr395P6GeE1hjM07faWWV+D6ytu7lgbRXBeHGlRt...<br/>  File "src/config/settings.pye", line 49, in get_service<br/>kIAsrHxOSEXRBwKAPMe7Ys9GY85aT5J+d9muxXUoMFeajjZFCsvPwG121...<br/>ImportError: cannot import name '+++++'</span></pre><p id="ab82" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当通过在 docker 映像中复制代码来部署代码时，这就是您所需要的。如果您部署为 python 包，请继续阅读。</p><h1 id="f1b5" class="kp kq hi bd kr ks mm ku kv kw mn ky kz la mo lc ld le mp lg lh li mq lk ll lm bi translated">Python 包加密</h1><p id="61cc" class="pw-post-body-paragraph iv iw hi ix b iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo lr jq jr js hb bi translated">为了用加密的 python 代码创建 Pip 安装包，你需要欺骗<a class="ae iu" href="https://setuptools.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> setuptools </a>，并让它打包<strong class="ix hj"> *。pye </strong>文件给你。历史上，distutils 和 setuptools 依赖于<code class="du mr ms mt md b">__init__.py</code>文件的存在。使用 Python3 的<a class="ae iu" href="https://www.python.org/dev/peps/pep-0420/" rel="noopener ugc nofollow" target="_blank">隐式名称空间包</a>，允许创建没有<code class="du mr ms mt md b">__init__.py</code>文件的包，以及 setuptools 中的相应功能:<a class="ae iu" href="https://setuptools.readthedocs.io/en/latest/userguide/package_discovery.html#using-find-namespace-or-find-namespace-packages" rel="noopener ugc nofollow" target="_blank">find _ Namespace _ Packages</a>，您需要在您的<code class="du mr ms mt md b">setup.py</code>文件中做的就是:</p><ul class=""><li id="148d" class="ju jv hi ix b iy iz jc jd jg jw jk jx jo jy js jz ka kb kc bi translated">用<code class="du mr ms mt md b">find_namespace_packages </code>代替<code class="du mr ms mt md b">find_packages</code></li><li id="7017" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated">捆绑所有<strong class="ix hj"> *。pye </strong>文件为<code class="du mr ms mt md b">package_data</code></li></ul><h1 id="51bf" class="kp kq hi bd kr ks mm ku kv kw mn ky kz la mo lc ld le mp lg lh li mq lk ll lm bi translated">完整 setup.py 示例</h1><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="2ec6" class="mh kq hi md b fi mi mj l mk ml">try:<br/>    import sourcedefender<br/>except ModuleNotFoundError:<br/>    pass</span><span id="a582" class="mh kq hi md b fi mu mj l mk ml">import os</span><span id="599d" class="mh kq hi md b fi mu mj l mk ml">from setuptools import setup, find_namespace_packages</span><span id="dc10" class="mh kq hi md b fi mu mj l mk ml">PROJECT = "hello_world"</span><span id="7166" class="mh kq hi md b fi mu mj l mk ml">def package_pye_files(directory):<br/>    paths = []<br/>    for (path, directories, filenames) in os.walk(directory):<br/>        for filename in filenames:<br/>            if filename.endswith('.pye'):<br/>                paths.append(os.path.join('..', path, filename))<br/>    return paths</span><span id="be65" class="mh kq hi md b fi mu mj l mk ml">pye_files = package_pye_files(f"./{PROJECT}")</span><span id="9ae4" class="mh kq hi md b fi mu mj l mk ml">PACKAGE_DATA = {<br/>    PROJECT: ["./resources/*"] + pye_files<br/>}</span><span id="6ff1" class="mh kq hi md b fi mu mj l mk ml">with open("requirements.txt", "r") as f:<br/>    REQUIREMENTS = f.read().splitlines()</span><span id="1fc0" class="mh kq hi md b fi mu mj l mk ml">setup(<br/>    name=PROJECT,<br/>    version="0.0.1",<br/>    description="hello_world",<br/>    author="None",<br/>    python_requires='&gt;=3',<br/>    packages=find_namespace_packages(include=[f"{PROJECT}*"]),<br/>    package_data=PACKAGE_DATA,<br/>    include_package_data=True,<br/>    install_requires=REQUIREMENTS<br/>)</span></pre><h1 id="48dd" class="kp kq hi bd kr ks mm ku kv kw mn ky kz la mo lc ld le mp lg lh li mq lk ll lm bi translated">参考</h1><ul class=""><li id="389d" class="ju jv hi ix b iy ln jc lo jg mv jk mw jo mx js jz ka kb kc bi translated"><a class="ae iu" rel="noopener" href="/ochrona/understanding-python-package-distribution-types-25d53308a9a"> python 包分发类型</a></li><li id="e823" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><a class="ae iu" href="https://vigneshgig.medium.com/python-application-obfuscate-and-licensing-7531f06d6296" rel="noopener"> python 应用混淆和许可</a></li></ul></div></div>    
</body>
</html>