<html>
<head>
<title>Data Wrangling in Pyspark with Regex</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pyspark中与Regex的数据争论</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/data-wrangling-in-pyspark-with-regex-ecda9b8f6256?source=collection_archive---------0-----------------------#2020-01-19">https://medium.com/analytics-vidhya/data-wrangling-in-pyspark-with-regex-ecda9b8f6256?source=collection_archive---------0-----------------------#2020-01-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/25f98d9a4de38723063b36ed0594ebd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WP2M9MW4H9DUyGDA"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Jez Timms 在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="9971" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是我在星火深潜系列中的一个故事</p><p id="d1bd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">【https://medium.com/@somanathsankaran T4】</p><p id="cfa7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正则表达式是处理数据的有力工具之一。让我们看看如何利用正则表达式来提取数据。</p><p id="2403" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们在sparksql中看到以下内容</p><ol class=""><li id="7499" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">pyspark中的正则表达式</li><li id="59e0" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">火花正则函数</li><li id="264f" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">捕获和非捕获组</li></ol><p id="046c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">pyspark中的正则表达式:</strong></p><p id="502b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Spark在以下函数中利用正则表达式。</p><ol class=""><li id="938b" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">正则表达式_提取</li><li id="80b8" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">正则表达式_替换</li><li id="381e" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">rlike</li></ol><p id="6739" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">转义正则表达式</strong></p><p id="b6e3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">pyspark中的Regex内部使用java regex。regex的一个常见问题是转义反斜杠，因为它使用java regex，我们将把原始python字符串传递给spark.sql，我们可以从一个示例中看到\d代表regex中的数字。让我们使用spark regexp_extract来匹配数字</p><figure class="ki kj kk kl fd ij er es paragraph-image"><div class="er es kh"><img src="../Images/e1db50fa89466bd6121a0f1574fa12ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*v4xLayvnuyatMXzErBS-XQ.png"/></div></figure><p id="e180" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们假设这个函数将提取数字，但是由于这个字符串将被转换成java列，并且反斜杠在java中有特殊的含义，我们需要用另一个反斜杠对它进行转义，如下所示</p><figure class="ki kj kk kl fd ij er es paragraph-image"><div class="er es km"><img src="../Images/9a1e195b8dca8dc292a556e777457bc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*nqerts6JBkfxoONaHfU00A.png"/></div></figure><p id="1b96" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">或者我们可以使用below属性通过设置自动转义\或类似的转义序列</p><p id="a37d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">设置spark . SQL . parser . escapedstringliterals = true</strong></p><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/88f12c3759b758886d09c980bfcda5fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NmTMkP3MrJxBugL_IJ66lQ.png"/></div></div></figure><p id="48f2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们可以看到第一个表达式本身给出了下面的结果。</p><figure class="ki kj kk kl fd ij er es paragraph-image"><div class="er es ko"><img src="../Images/2d578da2fc8019653b11de2a1474d0ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*svw9oEaY9jsbdaD3HS4lXA.png"/></div></figure><p id="eee0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们继续默认火花设置的工作，我们将添加反斜杠</p><p id="5253" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在继续之前，我将添加一些元字符，它们是正则表达式的构建块(将在下面详细解释)</p><figure class="ki kj kk kl fd ij er es paragraph-image"><div class="er es kp"><img src="../Images/d1979d6ddca7c44c477bf9d94c89d2d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*_w5Q1EZ1LT8vyaCTwimkFA.png"/></div></figure><p id="b1af" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> Regexp_extract </strong>:</p><p id="6556" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">它可以通过使用大括号来提取一部分数据。Regexp_extract需要3个参数</p><ol class=""><li id="e8f0" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">数据-要从中提取数据的列或字符串</li><li id="ed07" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">pattern-我们要提取的正则表达式模式</li><li id="4576" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">匹配组——我们需要提取的匹配部分</li></ol><p id="7228" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，在下面的示例中，我们需要分别提取数字和单词，并从单词“11ss”中添加2个diff列，如下所示</p><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kq"><img src="../Images/de3ce40006eba576eab6270274c1fa63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2v5_Qf7RjCzSdVrtOo-ZZw.png"/></div></div></figure><p id="57d7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在regexp_extract中,' 11ss '表示列</p><p id="52e2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因为我们想首先提取数字，所以我们添加\\d和+来匹配多个数字，如11或12等，添加1是因为我们想匹配以红色突出显示的第一组匹配</p><p id="e3e1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，我们希望提取数字后的单词，因此我们使用\w+来匹配数字后的单词，因为它是第二个捕获组，用黄色大括号突出显示</p><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/712ef81137de184789caddbe9ba97c29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K8oDxaV4Sv8tHRXTVKmJNg.png"/></div></div></figure><p id="b873" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> regexp_replace: </strong></p><p id="ffcd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">顾名思义，它可以用替换来替换给定的模式</p><p id="5359" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">它接受3个参数</p><ol class=""><li id="338c" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">数据列或字符串</li><li id="4a90" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">模式-待替换</li><li id="6493" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">替换字符串，用来替换模式</li></ol><p id="a2f7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，要用空格替换数字，我们可以在正则表达式下面使用</p><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/76915139653ef4cdd6d1f29460a1c406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fL4rnaJP9siZshw5M82x4w.png"/></div></div></figure><p id="b1ca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> Rlike </strong>:</p><p id="e627" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">它用于检查是否找到匹配项，可以与where子句一起使用，而不是与select子句一起使用</p><p id="3cf6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，我们希望验证amount列是否只包含整数，否则我们应该说无效，如下所示</p><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/c33d190df921d08874f4edccabb4dd93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ERdfVprhVAk6fLEXqCStvQ.png"/></div></div></figure><p id="7f3c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">捕获组:</strong></p><p id="580e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">捕获是regex表达式中的概念，我们需要使用regexp_replace中的捕获数据替换部分。我们可以使用美元符号($)来访问捕获的组，它将从索引0开始到括号号</p><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ku"><img src="../Images/5e5b7abe3e6414adbde0e54e7df141c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cqkHTmYOwdoFaFsgm89v3g.png"/></div></div></figure><p id="586a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，我们使用了2个括号，当我们用$0(红色)替换时，它将使用整个组，$1表示第一个括号(黄色)，而$2可用于第二个组(绿色)</p><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/847631cdc679008399ff84a35b1e3601.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tACIszTamupX2eLuf-AwuA.png"/></div></div></figure><p id="2943" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，一个常见的用例是模仿敏感数据，如带有x的卡片</p><p id="ba49" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，出于安全原因，我们将隐藏字符串下面的数字</p><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kw"><img src="../Images/c55ed86b02049ebe5415bce1bc78f68d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MCh4aNsTgg5a53LtP7NmoQ.png"/></div></div></figure><p id="de1e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">sssa112ss在这个字符串中，我们将使用上面的正则表达式用x替换digit</p><p id="c570" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以上正则表达式中有很多东西，我会试着解释每一部分</p><ol class=""><li id="024f" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">图案部分</li></ol><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kx"><img src="../Images/a2241731b5d8167162629e27eeea6549.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hdd4WRi2PlEjVhUe98t0xQ.png"/></div></div></figure><p id="4a5a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在pattern中，我们有[a-z]+它将匹配a到z中带有一个或多个重复项的任何内容，如“s”或ss等(黄色)(捕获组1)</p><p id="eec9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">\d+匹配匹配数字(红色)(捕获组2)</p><p id="5dc2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">[a-z]+它将匹配a到z中带有一个或多个重复项的任何内容，如“s”或“ss”等(绿色)(捕获组3)</p><p id="2fa2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.更换零件-</p><p id="8e2c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在替换部分中，我们希望仅替换捕获组2，并保留剩余部分。因此，我们将使用捕获组，它将捕获上述每个组，并且可以在替换部分中以$1x$3的价格访问</p><p id="e812" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">今天就到这里吧！！:)</p><p id="5b19" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Github链接:<a class="ae iu" href="https://github.com/SomanathSankaran/spark_medium/tree/master/spark_csv" rel="noopener ugc nofollow" target="_blank">https://github . com/SomanathSankaran/spark _ medium/tree/master/spark _ CSV</a></p><p id="dc68" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"/></p><p id="d173" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">学习并让别人学习！！</strong></p></div></div>    
</body>
</html>