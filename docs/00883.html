<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/efficient-pdfs-processing-with-python-abffd75b1af7?source=collection_archive---------2-----------------------#2019-09-16">https://medium.com/analytics-vidhya/efficient-pdfs-processing-with-python-abffd75b1af7?source=collection_archive---------2-----------------------#2019-09-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><ol class=""><li id="7311" class="hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy bi translated">使用Python高效处理pdf</li></ol><p id="6238" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">PDF文件使用起来似乎非常方便。它们易于阅读和打印，但是用纯文本解析它们的内容要困难得多。不幸的是，我们每个人迟早都会面临从它们身上提取内容的需求。</p><figure class="ip iq ir is fd it er es paragraph-image"><div role="button" tabindex="0" class="iu iv di iw bf ix"><div class="er es io"><img src="../Images/748db680defdf091e55bb01de17c8142.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*79tx_0fV3ayxUX_G"/></div></div><figcaption class="ja jb et er es jc jd bd b be z dx translated">安妮·斯普拉特在<a class="ae je" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="633c" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">幸运的是，有许多好的、随时可用的库，有了它们，我们几乎可以用pdf做任何事情——从提取文本数据，通过找到特定元素的X，Y坐标，到转换成众所周知的格式。但是你有机会测试过这样的库吗？你对它的动作速度满意吗？或者你可能想知道如何更有效地使用它？</p><p id="e333" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">PDF文件以二进制格式存储，这使得它们比文本文件(通常是ASCII)更复杂。他们收集了大量关于文本的字体、颜色和布局的信息。它们的处理速度很大程度上取决于它们的内容。一个有很多图形或表格的文档加载起来会很慢，这是不可避免的。然而，处理文件的预期速度取决于我们个人的偏好。要么您同时处理几千个文档，节省下来的每一秒对您都很重要，要么您只需要处理一个文件，该库完全符合您的期望。</p><p id="68e1" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">所以，要不要和我一起测试一下最流行的库，看看哪个最快？</p><figure class="ip iq ir is fd it er es paragraph-image"><div role="button" tabindex="0" class="iu iv di iw bf ix"><div class="er es jf"><img src="../Images/77b40a70d277becc75960564e7e8613f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3BOdQL229_W6GUgKJpOvww.png"/></div></div><figcaption class="ja jb et er es jc jd bd b be z dx translated">标签1。PDF文件的前1024个<strong class="bd jg">字节</strong></figcaption></figure></div><div class="ab cl jh ji gp jj" role="separator"><span class="jk bw bk jl jm jn"/><span class="jk bw bk jl jm jn"/><span class="jk bw bk jl jm"/></div><div class="hb hc hd he hf"><p id="0e9b" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated"><strong class="hj jo">用这个，用这个……</strong></p><p id="6ef0" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">想象一下，早上来到办公室，一边喝着咖啡，一边浏览电子邮件。您的一位客户写道，他不仅想在数据库中存储PDF文档，还想存储每个文档的页数信息。</p><p id="a481" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated"><strong class="hj jo">你做的第一件事:</strong></p><figure class="ip iq ir is fd it er es paragraph-image"><div role="button" tabindex="0" class="iu iv di iw bf ix"><div class="er es jp"><img src="../Images/a81fafa6e45d91e8f75b9d75bb9164cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DmBPbqTLjV49Hb0Zf8R59g.png"/></div></div></figure><p id="89d1" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">通常，搜索结果归结为<a class="ae je" href="https://stackoverflow.com/" rel="noopener ugc nofollow" target="_blank"><strong class="hj jo"><em class="jq">stackoverflow.com</em></strong></a>——我们大概可以承认，如果我们不知道某样东西，我们会在那里找到它。您转到第一个更好的链接，就有了一段现成的代码—您所要做的就是将文件名改为我们的:</p><pre class="ip iq ir is fd jr js jt ju aw jv bi"><span id="88ed" class="jw jx hi js b fi jy jz l ka kb"><strong class="js jo">from</strong> pdfminer.pdfdocument <strong class="js jo">import</strong> PDFDocument<br/><strong class="js jo">from</strong> pdfminer.pdfparser <strong class="js jo">import</strong> PDFParser<br/><strong class="js jo">from</strong> pdfminer.pdftypes <strong class="js jo">import</strong> resolve1<br/><br/><strong class="js jo">with</strong> open(<strong class="js jo">'/path/to/file.pdf'</strong>, <strong class="js jo">'rb'</strong>) as f:<br/>   parser = PDFParser(f)<br/>   doc = PDFDocument(parser)<br/>  <br/>   parser.set_document(doc)<br/>   pages = resolve1(doc.catalog[<strong class="js jo">'Pages'</strong>)<br/>   pages_count = pages.get(<strong class="js jo">'Count'</strong>, 0)</span></pre><p id="68f5" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">任务看起来很简单。</p><p id="512c" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">你被彻底告知每一个后续步骤:<br/> <em class="jq">“我建议你用PDFMiner得到页数”</em>。</p><p id="f7e8" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">你使用说明书了吗？砰！我们有了我们需要的信息，我们可以继续其他任务。</p><p id="51c5" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">一个月过去了，文档的数量在增加，我们提取页数信息的伟大方法起作用了——您还想要什么？</p><p id="6726" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">然后另一条消息从客户端传来:<br/>“Man<em class="jq">，我在这里上传了10k个文档，我的网站关闭了，做点什么吧！</em></p><p id="b98c" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated"><strong class="hj jo">当有更多解决方案时……</strong></p><p id="4761" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">于是你开始寻找解决方案……过了一段时间，事实证明，你可以通过与其他库合作来获得类似的效果(出于本文的需要，我尝试选择了最受欢迎的库):</p><figure class="ip iq ir is fd it er es paragraph-image"><div role="button" tabindex="0" class="iu iv di iw bf ix"><div class="er es kc"><img src="../Images/2f705634c7e7f92d75d500a9b054000e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PHBc-lelkFrzEnclS5jLJg.png"/></div></div><figcaption class="ja jb et er es jc jd bd b be z dx translated"><strong class="bd jg">标签2。最流行的处理PDF的Python库</strong></figcaption></figure><p id="1d95" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">以上库都有基本的功能，比如数据提取，页面旋转，文档拆分，但不仅限于此。</p><p id="20bc" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">多亏了<strong class="hj jo"> Apache Tika </strong>，我们可以识别多达1400种文件类型。</p><p id="3cec" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">反过来，使用<strong class="hj jo"> PDFMiner </strong>，我们可以轻松定位文本或字体坐标。</p><p id="31b7" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">每个库都是为实现特定任务而编写的，其余的是现有解决方案的包装器。</p><p id="0789" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated"><strong class="hj jo">那么……哪一个呢？</strong></p><p id="9158" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">你已经回顾了图书馆，你知道每一个图书馆的可能性。现在你只需要选择一个符合你期望的——尽可能快地得到PDF文档的页数。</p><p id="4eff" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">在这个阶段你已经知道会是哪一个了吗？不，你必须去看看。</p><p id="3fc6" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">一些(或绝大多数)文件将包含各种图形、表格、字体等，只有统一的文本。</p><p id="54ed" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">为了选择最有效的库，我进行了一个简单的实验:</p><ol class=""><li id="909a" class="hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy bi translated">我从<a class="ae je" href="https://www.ncbi.nlm.nih.gov/pubmed/" rel="noopener ugc nofollow" target="_blank"> <strong class="hj jo"> Pubmed </strong> </a>上随机下载了114份出版物(pdf)，其中最小的文件重25 KB，最大的4.7 MB(<a class="ae je" href="https://bit.ly/2yHHqEK" rel="noopener ugc nofollow" target="_blank"><strong class="hj jo">https://bit.ly/2yHHqEK</strong></a>)</li></ol><figure class="ip iq ir is fd it er es paragraph-image"><div role="button" tabindex="0" class="iu iv di iw bf ix"><div class="er es kd"><img src="../Images/b634cd58be0710683e009cb1fb1f9f56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ibrix1zP49tVv_QCHpeg8g.png"/></div></div></figure><figure class="ip iq ir is fd it er es paragraph-image"><div role="button" tabindex="0" class="iu iv di iw bf ix"><div class="er es ke"><img src="../Images/2e2e40a41375c43162f74041d252742d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*33eH9TN8bVn4lGqBSlo_vQ.png"/></div></div></figure><p id="e722" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">2)我已经通过我们的图书馆传递了这些文档:</p><figure class="ip iq ir is fd it er es paragraph-image"><div role="button" tabindex="0" class="iu iv di iw bf ix"><div class="er es kf"><img src="../Images/3121a9fba841e5c6c6f866575cf4af5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DeoeISrDPVqaej7PXN1VQA.png"/></div></div></figure><p id="3ed6" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">3)我已经用<a class="ae je" href="https://plot.ly/" rel="noopener ugc nofollow" target="_blank"><strong class="hj jo"/></a>可视化了处理的结果。<br/> a) <strong class="hj jo">图表1</strong>—<a class="ae je" href="https://bit.ly/2knWwf4" rel="noopener ugc nofollow" target="_blank">https://bit.ly/2knWwf4</a></p><figure class="ip iq ir is fd it er es paragraph-image"><div role="button" tabindex="0" class="iu iv di iw bf ix"><div class="er es kg"><img src="../Images/810653feda9ab504b0f06fcfc9cc3d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BMVmI0WwcxtIfU0mqOsOAw.png"/></div></div></figure><p id="8f8f" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">b) <strong class="hj jo">图表2</strong>—<a class="ae je" href="https://bit.ly/2kmC7qL" rel="noopener ugc nofollow" target="_blank">https://bit.ly/2kmC7qL</a></p><figure class="ip iq ir is fd it er es paragraph-image"><div role="button" tabindex="0" class="iu iv di iw bf ix"><div class="er es kh"><img src="../Images/49b63df09b0906d4706dbcfc975b0a86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8UTwcM0POYzGWLmxdpgS2Q.png"/></div></div></figure><pre class="ip iq ir is fd jr js jt ju aw jv bi"><span id="96ab" class="jw jx hi js b fi jy jz l ka kb">{<br/>   <strong class="js jo">"pdfminer_errors"</strong>:{<br/>       <strong class="js jo">"count"</strong>:0,<br/>       <strong class="js jo">"errors"</strong>:[]<br/>   },<br/>   <strong class="js jo">"pdfminer_total_pages"</strong>:2433,<br/>   <strong class="js jo">"pdfminer_total_parsing_time"</strong>:29.1801664831,<br/>   <strong class="js jo">"pdfquery_errors"</strong>:{<br/>       <strong class="js jo">"count"</strong>:0,<br/>       <strong class="js jo">"errors"</strong>:[]<br/>   },<br/>   <strong class="js jo">"pdfquery_total_pages"</strong>:2433,<br/>   <strong class="js jo">"pdfquery_total_parsing_time"</strong>:29.766777754,<br/>   <strong class="js jo">"pdfrw_errors"</strong>:{<br/>       <strong class="js jo">"count"</strong>:0,<br/>       <strong class="js jo">"errors"</strong>:[]<br/>   },<br/>   <strong class="js jo">"pdfrw_total_pages"</strong>:2433,<br/>   <strong class="js jo">"pdfrw_total_parsing_time"</strong>:3.6624541282,<br/>   <strong class="js jo">"pymupdf_errors"</strong>:{<br/>       <strong class="js jo">"count"</strong>:0,<br/>       <strong class="js jo">"errors"</strong>:[]<br/>   },<br/>   <strong class="js jo">"pymupdf_total_pages"</strong>:2433,<br/>   <strong class="js jo">"pymupdf_total_parsing_time"</strong>:0.0998632911,<br/>   <strong class="js jo">"pypdf2_errors"</strong>:{<br/>       <strong class="js jo">"count"</strong>:0,<br/>       <strong class="js jo">"errors"</strong>:[]<br/>   },<br/>   <strong class="js jo">"pypdf2_total_pages"</strong>:2433,<br/>   <strong class="js jo">"pypdf2_total_parsing_time"</strong>:1.4632689952,<br/>   <strong class="js jo">"regex_errors"</strong>:{<br/>       <strong class="js jo">"count"</strong>:0,<br/>       <strong class="js jo">"errors"</strong>:[]<br/>   },<br/>   <strong class="js jo">"regex_total_pages"</strong>:2433,<br/>   <strong class="js jo">"regex_total_parsing_time"</strong>:0.1071991922,<br/>   <strong class="js jo">"tika_errors"</strong>:{<br/>       <strong class="js jo">"count"</strong>:0,<br/>       <strong class="js jo">"errors"</strong>:[]<br/>   },<br/>   <strong class="js jo">"tika_total_pages"</strong>:2433,<br/>   <strong class="js jo">"tika_total_parsing_time"</strong>:6.526471615<br/>}</span></pre><p id="5aef" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated"><strong class="hj jo">结论</strong></p><p id="b567" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">原来互联网用户之前推荐的<strong class="hj jo"> <em class="jq"> PDFMiner </em> </strong>库并没有给出最好的结果。</p><p id="a17f" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">我测试的赢家是<strong class="hj jo"> <em class="jq"> PyMuPDF </em> </strong>库——处理114个PDF文档用了大约0.1秒。</p><p id="031a" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">如果仔细观察图表，您会注意到，除了前面讨论的库之外，<strong class="hj jo"> <em class="jq"> regex </em> </strong>也出现在最终结果中。而这个排在第二位(~ 0.11秒)！</p><p id="dbe0" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">是啊！Regex也可用于提取PDF中的页数信息:</p><pre class="ip iq ir is fd jr js jt ju aw jv bi"><span id="48be" class="jw jx hi js b fi jy jz l ka kb"><strong class="js jo">import </strong>re</span><span id="6522" class="jw jx hi js b fi ki jz l ka kb">regex_pattern = re.compile(<br/>   <strong class="js jo">b"/Type\s*/Page([^s][^s]</strong>,<br/>   re.MULTILINE | re.DOTALL<br/>)</span><span id="aade" class="jw jx hi js b fi ki jz l ka kb"><strong class="js jo">with </strong>open(<strong class="js jo">'/path/to/file.pdf'</strong>, <strong class="js jo">'rb'</strong>) <strong class="js jo">as </strong>f:<br/>   data = f.read()<br/>   pages_count = len(regex_pattern.findall(data))</span></pre><p id="e1c1" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated"><strong class="hj jo"> <em class="jq"> PyPDF2 </em> </strong>以大约1.46秒排在第三，第四<strong class="hj jo"> <em class="jq"> pdfrw </em> </strong>以大约3.66秒排在第四。</p><p id="cbbd" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">另外值得一提的是<strong class="hj jo"> <em class="jq">阿帕奇蒂卡</em></strong>——成绩稍差~ 6.52秒。</p><p id="df0a" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">互联网用户推荐的库——pdf miner仅以~ 29.18秒的时间排在倒数第二位，紧随其后的是当之无愧的<strong class="hj jo"> <em class="jq"> pdfquery </em> </strong>工具，时间~ 29.77秒。</p><p id="dfe2" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated"><strong class="hj jo">总结</strong></p><p id="faa2" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">亲爱的读者，我希望通过做这个简短的实验，我让你相信，使用简单的工具，你能够检查哪个库最接近你的期望。以及他们中哪一个最快。</p><p id="eded" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">在我们着手解决一个给定的问题之前，我们应该首先考虑我们选择的工具是否适合它。</p><p id="4986" class="pw-post-body-paragraph hz ia hi hj b hk hl ib ic hm hn id ie ho if ig ih hq ii ij ik hs il im in hu hb bi translated">项目和交互图表可以在<a class="ae je" href="https://github.com/miodeqqq/pdfs_performance" rel="noopener ugc nofollow" target="_blank"> <strong class="hj jo"> <em class="jq">这里找到</em> </strong> </a>。</p></div></div>    
</body>
</html>