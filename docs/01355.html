<html>
<head>
<title>A/B Testing Using the Northwind Dataset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Northwind数据集进行A/B测试</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/a-b-testing-using-the-northwind-dataset-e564e9460927?source=collection_archive---------17-----------------------#2019-10-16">https://medium.com/analytics-vidhya/a-b-testing-using-the-northwind-dataset-e564e9460927?source=collection_archive---------17-----------------------#2019-10-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/af844ad63a9a1e243f18413b02aa1d46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZE77yWoBxve5qOQg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae iu" href="https://unsplash.com/@olloweb?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">agency followeb</a>拍摄</figcaption></figure><p id="95b7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我最近的项目中，我的任务是使用虚构的Northwind数据集来展示假设或A/B测试。在这篇博文中，我想探究这样一个问题:“订单发往的国家对折扣有显著的统计影响吗？”</p><p id="ea95" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我必须发展我的无效假设和替代假设。无效假设是基于订单运送目的地的折扣没有影响。这意味着所有国家的平均折扣值是相同的。另一个假设是，某些国家或高或低的平均折扣。</p><p id="71e7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">既然假设已经成立，就需要对数据进行探索。数据存储在SQLite文件中，需要转换成pandas数据帧，以便于查看和操作。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="1195" class="kc kd hi jy b fi ke kf l kg kh">def query_to_df(query):<br/>    “””Takes in a SQL query and returns a pandas dataframe with         column names”””<br/>    cur.execute(query)<br/>    df = pd.DataFrame(cur.fetchall())<br/>    df.columns = [x[0] for x in cur.description]<br/>    return df</span></pre><p id="e991" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面的代码是一个函数，它接受一个SQL查询并返回一个pandas数据帧，该数据帧带有准备处理的列名。我需要的信息是订单发往的国家和每份订单的折扣。一个简单的SQL查询，如果您已经熟悉编写它们的话。关于SQL的提醒，你可以访问这个<a class="ae iu" rel="noopener" href="/swlh/basics-of-sql-7f1e72772e63">帖子</a>。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="4510" class="kc kd hi jy b fi ke kf l kg kh">query4 = “””SELECT ShipCountry, OrderId, Discount<br/>            FROM [Order]<br/>            JOIN OrderDetail<br/>            ON [Order].Id = OrderDetail.OrderId;”””</span></pre><p id="f141" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有了pandas数据框架，我就能够确定所有向其发货的国家和给予的折扣级别。国家被视为分类变量，并将被视为分类变量。我要运行的第一个测试是ANOVA测试，比较“ShipCountry”列和“Discount”列</p><p id="eac9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">方差分析(ANOVA)是一种统计技术，用于检查两个或多个组的平均值是否存在显著差异。ANOVA通过比较不同样本的平均值来检查一个或多个因素的影响。在这种情况下，样品将是每个“发货国家”,我们想看看每个订单的“折扣”的含义是否有任何不同。</p><p id="9c4a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在方差分析测试之前，我绘制了每个装运国的折扣分布图:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="6d05" class="kc kd hi jy b fi ke kf l kg kh">country_list = df4.ShipCountry.tolist()<br/>country_list = np.unique(np.array(country_list))<br/>plt.figure(figsize=(10,8))<br/>plt.title(‘Distribution of Discounts per ShipCountry’)<br/>for country in country_list:<br/>    country_df = df4[df4[‘ShipCountry’] == country]<br/>    sns.distplot(country_df.Discount, label=country)<br/> <br/>plt.legend();</span></pre><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es ki"><img src="../Images/b2bd1f7a8e818faad9b1f1ba97109caf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*n9zrY3zkf9YuH9GMaXH6-g.png"/></div></figure><p id="6775" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">方差分析测试将告诉我们是否有来自发货国的统计显著性。方差分析测试相对容易操作，也容易解释。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="c08b" class="kc kd hi jy b fi ke kf l kg kh">import statsmodels.api as sm<br/>from statsmodels.formula.api import ols</span><span id="ceb4" class="kc kd hi jy b fi kj kf l kg kh">formula = ‘Discount ~ C(ShipCountry)’<br/>lm = ols(formula, df4).fit()<br/>table = sm.stats.anova_lm(lm, typ=2)<br/>print(table)</span><span id="adb8" class="kc kd hi jy b fi kj kf l kg kh">                   sum_sq      df         F        PR(&gt;F)<br/>C(ShipCountry)   0.609834    16.0  5.662696  3.781260e-12<br/>Residual        14.390506  2138.0       NaN           NaN</span></pre><p id="1805" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面的代码返回一个干净的表，从中可以得出结论。两个重要的值是F值和PR(&gt;F)或p值。F统计量测量不同样本的均值是否显著不同。使用F表，您可以找到p值，或者在这种情况下，它已经给出。值非常非常小(3.781260e-12)。远小于通常的0.05的阈值。可以拒绝零假设。某些国家之间可能存在显著差异，需要进行更多测试。</p><p id="0b4a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">显示平均折扣值的条形图有助于直观显示平均折扣差异的大小:</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es kk"><img src="../Images/e46f1c9513162e31bc94711ecffd680c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*DSOZ88fsdecoQzTttWRzCg.png"/></div></figure><p id="68b8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了评估每个国家，需要进一步分析。方差分析测试告诉我们，国与国之间存在显著差异；然而，ANOVA测试并没有指定哪些国家。为了进一步探索，必须考虑事后测试。可供选择的几个测试是韦尔奇对每个国家进行的带有Bonferroni修正的T检验或图基的HSD检验。</p></div></div>    
</body>
</html>