<html>
<head>
<title>Covid-19 Curve fitting and future Projections</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">新冠肺炎曲线拟合和未来预测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/covid-19-curve-fitting-and-future-projections-a4ffdb2e17e7?source=collection_archive---------17-----------------------#2020-03-31">https://medium.com/analytics-vidhya/covid-19-curve-fitting-and-future-projections-a4ffdb2e17e7?source=collection_archive---------17-----------------------#2020-03-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e164" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从这里的文章<a class="ae jd" rel="noopener" href="/@vaibhavgarg1982/charting-spread-of-covid-19-using-worldometers-info-data-6a918969c324">继续</a>，让我们试着预测未来。</p><p id="563b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基于从worldometers.info网站上各个国家页面的html中抓取的数据，我们想知道最适合的<em class="je">曲线，并推断未来。让我们看看这是如何工作的:</em></p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="de90" class="jo jp hi jk b fi jq jr l js jt">import requests<br/>import matplotlib.pyplot as plt<br/>from scipy.optimize import curve_fit<br/>import numpy as np<br/>from datetime import datetime, timedelta</span><span id="1351" class="jo jp hi jk b fi ju jr l js jt">def test(x, a, b): <br/>    return a * np.exp(b * x)</span><span id="bc0b" class="jo jp hi jk b fi ju jr l js jt">plt.rcParams["figure.figsize"] = (20,10)<br/>countries = ['india']<br/>for country in countries:<br/>    data = requests.get("<a class="ae jd" href="https://www.worldometers.info/coronavirus/country/" rel="noopener ugc nofollow" target="_blank">https://www.worldometers.info/coronavirus/country/</a>"+ country)<br/>    data = data.text<br/>    active = data[data.find("data: [")+len("data: ["):data.find("]", data.find("data: [")+len("data: ["))]<br/>    tot = data[data.find("data: [", data.find("name: \'Cases\'"))+len("data: ["):data.find("]", data.find("data: [", data.find("name: \'Cases\'"))+len("data: ["))]</span><span id="890a" class="jo jp hi jk b fi ju jr l js jt">active = [int(i) for i in active.split(',')]<br/>    tot = [int(i) for i in tot.split(',')]<br/>    print(active)<br/>    print(tot)</span><span id="b95a" class="jo jp hi jk b fi ju jr l js jt">dates = data [data.find("categories: [")+len("categories: [") : data.find("]" , data.find("categories: [")+len("categories: ["))]<br/>    dates = [date for date in dates.split(",")]</span><span id="4299" class="jo jp hi jk b fi ju jr l js jt">print(len(tot))</span><span id="74ce" class="jo jp hi jk b fi ju jr l js jt">#use only the exponential part to fit the curve, not the whole data<br/>    finish = 40<br/>    start = 0<br/>    span = finish-start<br/>    param, param_cov = curve_fit(test, np.linspace(0, span-1, span) , tot[start:finish])<br/> <br/>    clean_dates = [datetime.strptime(str(date) + " 2020", '\"%b %d\" %Y') for date in dates]<br/>    plt.plot(clean_dates, tot ,  label = country.upper() +" Total \n" + clean_dates[-1].strftime('%Y-%m-%d') + ":" + str(tot[-1]))<br/>    plt.plot(clean_dates, active ,  label = country.upper() +" Active" )<br/>    lobf = []<br/>    cleandates_lobf = []</span><span id="0730" class="jo jp hi jk b fi ju jr l js jt">for i in range(len(tot)+5):<br/>        lobf.append(test(i, param[0], param[1]))<br/>        cleandates_lobf.append(min(clean_dates)+ timedelta(days = i))</span><span id="114e" class="jo jp hi jk b fi ju jr l js jt">print(lobf)<br/>    plt.plot(cleandates_lobf, lobf, label = country.upper() + " exp curve fit on totals projected 1 week \n " + str(param[0]) + " , " + str(param[1]))</span><span id="42e0" class="jo jp hi jk b fi ju jr l js jt">plt.legend()<br/>plt.grid(which = "both")<br/>plt.yscale("log")<br/>plt.xticks(rotation=90)<br/>plt.xticks(cleandates_lobf)<br/>plt.show()</span></pre><p id="1cfb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来看看代码的关键部分，以了解它是如何工作的:</p><h1 id="c00f" class="jv jp hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">曲线拟合</h1><p id="c4a9" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">该功能</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="23a0" class="jo jp hi jk b fi jq jr l js jt">def test(x, a, b): <br/>    return a * np.exp(b * x)</span></pre><p id="8d66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">定义指数函数的基本形式，由<em class="je"> a </em>和<em class="je">b</em>参数化。我们需要找到最符合我们数据的值。为此，我们使用优秀的scipy.optimize库中的<a class="ae jd" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html" rel="noopener ugc nofollow" target="_blank"> curve_fit </a>函数。从文件上看，签名是:</p><blockquote class="kx ky kz"><p id="28c3" class="if ig je ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated"><code class="du ld le lf jk b">scipy.optimize.<strong class="ih hj">curve_fit</strong></code> ( <em class="hi"> f </em>，<em class="hi"> xdata </em>，<em class="hi"> ydata </em>，<em class="hi"> p0=None </em>，<em class="hi"> sigma=None </em>，<em class="hi"> absolute_sigma=False </em>，<em class="hi"> check_finite=True </em>，<em class="hi"> bounds=(-inf </em>，<em class="hi"> inf) </em>，<em class="hi"> method=None </em>，</p><p id="372e" class="if ig je ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">使用非线性最小二乘法将函数f拟合到数据。</p></blockquote><p id="c4fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是我们的功能<em class="je">测试</em>的用武之地。我们在下面的代码中使用了相同的代码:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="9a64" class="jo jp hi jk b fi jq jr l js jt">#use only the exponential part to fit the curve, not the whole data<br/>    finish = 40<br/>    start = 0<br/>    span = finish-start<br/>    param, param_cov = curve_fit(test, np.linspace(0, span-1, span) , tot[start:finish])</span></pre><p id="f1ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中tot是要拟合的数据，np.linspace生成要传递给函数的x值。</p><p id="1630" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们有了参数，我们就用它们来预测未来5天</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="d68d" class="jo jp hi jk b fi jq jr l js jt">for i in range(len(tot)+5):<br/>        lobf.append(test(i, param[0], param[1]))<br/>        cleandates_lobf.append(min(clean_dates)+ timedelta(days = i))</span></pre><p id="ceab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">瞧，我们得到了我们想要的。我们可以使用matplotlib绘制这些，我们得到:</p><figure class="jf jg jh ji fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es lg"><img src="../Images/0d8446700de13cd3fdf3b58131a94aed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lJ1DCGgi2QXNFjkU01-1EA.png"/></div></div></figure><p id="19cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">模型参数和最新值位于图例中，以避免弄乱线条。</p></div></div>    
</body>
</html>