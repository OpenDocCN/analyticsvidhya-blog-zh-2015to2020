<html>
<head>
<title>“Data Augmentation-CNN(Keras)” in nutshell [Code]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">“数据增强-CNN(Keras)”简而言之[代码]</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/data-augmentation-keras-in-nutshell-code-c70fcb9f872e?source=collection_archive---------9-----------------------#2020-04-25">https://medium.com/analytics-vidhya/data-augmentation-keras-in-nutshell-code-c70fcb9f872e?source=collection_archive---------9-----------------------#2020-04-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/85478d0c09dd6a30f53850090277f350.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*qR29v7u_VFb5oOGgCTB--w.jpeg"/></div></figure><p id="e871" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">数据</strong>是任何神经网络所需要的最重要的东西，高质量的数据是它所需要的最基本的东西。增加的数据将比真实数据多一点修改，或者我们可以说<strong class="io hj">这只是移动图像中的一些像素来获得新数据</strong>。在本文中，我将带您了解Keras DataGenerator技术的编码，如果您对数据扩充感兴趣或想深入了解，请查看:</p><div class="jk jl ez fb jm jn"><a rel="noopener follow" target="_blank" href="/analytics-vidhya/data-augmentation-keras-in-nutshell-theory-98c2e865abce"><div class="jo ab dw"><div class="jp ab jq cl cj jr"><h2 class="bd hj fi z dy js ea eb jt ed ef hh bi translated">“数据增强-keras”概括地说[理论]</h2><div class="ju l"><h3 class="bd b fi z dy js ea eb jt ed ef dx translated">数据是任何神经网络所需要的最重要的东西，高质量的数据是神经网络所需要的最基本的东西</h3></div><div class="jv l"><p class="bd b fp z dy js ea eb jt ed ef dx translated">medium.com</p></div></div><div class="jw l"><div class="jx l jy jz ka jw kb ik jn"/></div></div></a></div><p id="307b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以，首先让我们先了解一下“海绵宝宝”的形象，因为谁不喜欢“海绵宝宝”呢？Yeyyy！</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kc"><img src="../Images/0d7cc924243f259a4e858313152c8ffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lvGv4Epp3qXSEsWL"/></div></div></figure><p id="2858" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在回到编码！因此，这里我们有海绵宝宝图像，并观察到图像的背景是纯白色。这就是训练所需的图像，因为在背景中没有干扰，这使得模型在图像特征方面更有效。</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kl"><img src="../Images/49a2d6f4191294b8fee5636452889251.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lrszIO-e_52dghZ-x6OPBA.jpeg"/></div></div></figure><p id="75a1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在让我们导入为此所需的一切:</p><pre class="kd ke kf kg fd km kn ko kp aw kq bi"><span id="7451" class="kr ks hi kn b fi kt ku l kv kw">from numpy import expand_dims<br/>from keras.preprocessing.image import load_img<br/>from keras.preprocessing.image import img_to_array<br/>from keras.preprocessing.image import ImageDataGenerator</span><span id="32e5" class="kr ks hi kn b fi kx ku l kv kw">import matplotlib.pyplot as plt<br/>import cv2</span></pre><p id="bef3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里是我们在本文中使用的主要库。</p><pre class="kd ke kf kg fd km kn ko kp aw kq bi"><span id="4482" class="kr ks hi kn b fi kt ku l kv kw">img = load_img('SpongeBob.jpg')</span></pre><p id="4638" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这里，我们使用“<strong class="io hj"> load_img </strong>”从工作目录加载图像，这个函数除了加载图像什么也不做。您也可以从其他目录导入图像，只需将路径地址粘贴到<strong class="io hj"> load_img( &lt; path &gt;)中即可。</strong></p><p id="351c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">导入图像后，我们将构建一个对图像进行预处理的函数，并显示增强的图像样本。</p><pre class="kd ke kf kg fd km kn ko kp aw kq bi"><span id="0b58" class="kr ks hi kn b fi kt ku l kv kw">def DataGen(datagen):<br/>    data = img_to_array(img)<br/>    samples = expand_dims(data, 0)<br/>    print(samples.shape)<br/>    it = datagen.flow(samples, batch_size=1)<br/>    <br/>    for i in range(9):<br/>        plt.subplot(330 + 1 + i)<br/>        batch = it.next()<br/>        image = batch[0].astype('uint32')<br/>        plt.imshow(image)</span><span id="d269" class="kr ks hi kn b fi kx ku l kv kw">    plt.show()</span></pre><p id="3e44" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，当调用函数<strong class="io hj"> </strong>时，该函数<strong class="io hj"> DataGen </strong>将对输入图像进行预处理，并生成9幅样本图像。</p><pre class="kd ke kf kg fd km kn ko kp aw kq bi"><span id="1ee5" class="kr ks hi kn b fi kt ku l kv kw">data = img_to_array(img)</span></pre><p id="f851" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> img_to_array </strong>是<strong class="io hj"> </strong>主要用于将图像或像素值转换成numpy数组，这很有帮助，因为处理numpy数组比普通数组快。</p><pre class="kd ke kf kg fd km kn ko kp aw kq bi"><span id="513b" class="kr ks hi kn b fi kt ku l kv kw">samples = expand_dims(data, 0)</span></pre><p id="de76" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> expand_dims </strong>将只扩展image numpy数组的维度，因为Keras-ImageDataGenerator只接受4D数组，所以这里我们将3D数组转换为4D数组。</p><pre class="kd ke kf kg fd km kn ko kp aw kq bi"><span id="3301" class="kr ks hi kn b fi kt ku l kv kw">it = datagen.flow(samples, batch_size=1)</span></pre><p id="d32e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> datagen.flow </strong>是执行所有动作的对象，<strong class="io hj"> datagen </strong>是调用该函数之前应该传递的参数。该参数包括要扩充的数据的方式，并且<strong class="io hj">流</strong>将采用预处理的numpy数组，并且batch_size为1，因为我们只有1个图像。</p><pre class="kd ke kf kg fd km kn ko kp aw kq bi"><span id="2ec0" class="kr ks hi kn b fi kt ku l kv kw">for i in range(9):<br/>        plt.subplot(330 + 1 + i)<br/>        batch = it.next()<br/>        image = batch[0].astype('uint32')<br/>        plt.imshow(image)</span><span id="5a8a" class="kr ks hi kn b fi kx ku l kv kw">plt.show()</span></pre><p id="5d7a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这段代码将简单地打印9个样本图像。</p><p id="6501" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当我们构建函数时。现在，让我们通过一些我认为有效的论据来开始添加更多图像的不同方法:</p><p id="bcb5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">宽度移动:</strong>基本上是水平移动一定范围内的像素。</p><pre class="kd ke kf kg fd km kn ko kp aw kq bi"><span id="312c" class="kr ks hi kn b fi kt ku l kv kw">datagen = ImageDataGenerator(width_shift_range=[-250,250])<br/>print("width_shift_range")<br/>DataGen(datagen)</span></pre><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es ky"><img src="../Images/a284e2ab74ed2ca11f741ac246feaeb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*F-suy7nDAW9cTHfWI_LlfQ.jpeg"/></div></figure><p id="b46a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">正如你所看到的，每个增强的图像基本上都是水平移动的。</p><p id="153f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">高度移动:</strong>与宽度移动相同，但垂直移动。</p><pre class="kd ke kf kg fd km kn ko kp aw kq bi"><span id="6eb0" class="kr ks hi kn b fi kt ku l kv kw">datagen = ImageDataGenerator(height_shift_range=0.5)<br/>print("height_shift_range")<br/>DataGen(datagen)</span></pre><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kz"><img src="../Images/a471012177cb88fa1b4f7eb21359e96c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AU5bpdeToeXhw9-TeAj5Yg.jpeg"/></div></div></figure><p id="5391" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如你所见，每个增强图像基本上都是垂直移动的。</p><p id="1777" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">旋转范围:</strong>简单的将图像旋转一定的角度。</p><pre class="kd ke kf kg fd km kn ko kp aw kq bi"><span id="db3e" class="kr ks hi kn b fi kt ku l kv kw">datagen = ImageDataGenerator(rotation_range=90)<br/>print("rotation_range")<br/>DataGen(datagen)</span></pre><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es la"><img src="../Images/fec5c3864afdf6f664aa6d8dc2d84dbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KyiL-k85PYAzJZ3Jf_g_Xg.jpeg"/></div></div></figure><p id="da1a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如你所见，每个增强图像基本上都旋转了90度。我建议使用python random.rand()作为随机角度，以获得更多种类的旋转。</p><p id="d736" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">水平翻转:</strong>这是一种基本的水平翻转图像的方式，看起来像镜像。</p><pre class="kd ke kf kg fd km kn ko kp aw kq bi"><span id="6139" class="kr ks hi kn b fi kt ku l kv kw">datagen = ImageDataGenerator(horizontal_flip=True)<br/>print("horizontal_flip")<br/>DataGen(datagen)</span></pre><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lb"><img src="../Images/769a940629541bc7a9a57abed9a9ccb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O0DVCxxJVtG7AKHf_E1b9g.jpeg"/></div></div></figure><p id="31b8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">正如你所看到的，每个增强的图像被翻转，看起来像一个镜像。</p><p id="6220" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">亮度范围:</strong>它只是通过增加或降低亮度来调节亮度。</p><pre class="kd ke kf kg fd km kn ko kp aw kq bi"><span id="760c" class="kr ks hi kn b fi kt ku l kv kw">datagen = ImageDataGenerator(brightness_range=[0.2,1.0])<br/>print("brightness_range")<br/>DataGen(datagen)</span></pre><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lc"><img src="../Images/79fd64fc1590363e6dd347860e3a8ca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CCIAiRPWsx64imD0uCnHpw.jpeg"/></div></div></figure><p id="bf47" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">正如你所看到的，一些增强图像更暗，而另一些图像在亮度级别上更暗。</p><p id="408a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">缩放范围:</strong>基本上是放大缩小图像，有利于训练空间模式</p><pre class="kd ke kf kg fd km kn ko kp aw kq bi"><span id="05bf" class="kr ks hi kn b fi kt ku l kv kw">datagen = ImageDataGenerator(zoom_range=[0.5,1.0])<br/>print("zoom_range")<br/>DataGen(datagen)</span></pre><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ld"><img src="../Images/2bb4515425fe103fccb7b418f7f586eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H9fVXWe6hL4PPzPNuKUayg.jpeg"/></div></div></figure><p id="c86f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">正如你所看到的，一些增强图像放大了很多，一些放大了一点。</p><p id="d93e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下面是完整的代码片段:</p><pre class="kd ke kf kg fd km kn ko kp aw kq bi"><span id="116b" class="kr ks hi kn b fi kt ku l kv kw">from numpy import expand_dims<br/>from keras.preprocessing.image import load_img<br/>from keras.preprocessing.image import img_to_array<br/>from keras.preprocessing.image import ImageDataGenerator</span><span id="976e" class="kr ks hi kn b fi kx ku l kv kw">import matplotlib.pyplot as plt<br/>import cv2</span><span id="15b2" class="kr ks hi kn b fi kx ku l kv kw">img = load_img('SpongeBob.jpg')</span><span id="a0e5" class="kr ks hi kn b fi kx ku l kv kw">def DataGen(datagen):<br/>    data = img_to_array(img)<br/>    samples = expand_dims(data, 0)<br/>    print(samples.shape)<br/>    it = datagen.flow(samples, batch_size=1)<br/>    <br/>    for i in range(9):<br/>        plt.subplot(330 + 1 + i)<br/>        batch = it.next()<br/>        image = batch[0].astype('uint32')<br/>        plt.imshow(image)</span><span id="dd3a" class="kr ks hi kn b fi kx ku l kv kw">    plt.show()</span><span id="869f" class="kr ks hi kn b fi kx ku l kv kw">datagen = ImageDataGenerator(width_shift_range=[-250,250])<br/>print("width_shift_range")<br/>DataGen(datagen)</span><span id="816e" class="kr ks hi kn b fi kx ku l kv kw">datagen = ImageDataGenerator(height_shift_range=0.5)<br/>print("height_shift_range")<br/>DataGen(datagen)</span><span id="322c" class="kr ks hi kn b fi kx ku l kv kw">datagen = ImageDataGenerator(rotation_range=90)<br/>print("rotation_range")<br/>DataGen(datagen)</span><span id="bae9" class="kr ks hi kn b fi kx ku l kv kw">datagen = ImageDataGenerator(horizontal_flip=True)<br/>print("horizontal_flip")<br/>DataGen(datagen)</span><span id="f34b" class="kr ks hi kn b fi kx ku l kv kw">datagen = ImageDataGenerator(brightness_range=[0.2,1.0])<br/>print("brightness_range")<br/>DataGen(datagen)</span><span id="3a6d" class="kr ks hi kn b fi kx ku l kv kw">datagen = ImageDataGenerator(zoom_range=[0.5,1.0])<br/>print("zoom_range")<br/>DataGen(datagen)</span></pre><p id="2e6c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以这些是我认为最有效的论点，还有更多种类你可以探索:</p><div class="jk jl ez fb jm jn"><a href="https://keras.io/preprocessing/image/" rel="noopener  ugc nofollow" target="_blank"><div class="jo ab dw"><div class="jp ab jq cl cj jr"><h2 class="bd hj fi z dy js ea eb jt ed ef hh bi translated">图像预处理</h2><div class="ju l"><h3 class="bd b fi z dy js ea eb jt ed ef dx translated">keras . preprocessing . image . image data generator(feature wise _ center = False，samplewise_center=False…</h3></div><div class="jv l"><p class="bd b fp z dy js ea eb jt ed ef dx translated">keras.io</p></div></div><div class="jw l"><div class="le l jy jz ka jw kb ik jn"/></div></div></a></div><p id="7158" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">并且可以随意更改范围值，以查看增强中越来越多的变化。</p></div></div>    
</body>
</html>