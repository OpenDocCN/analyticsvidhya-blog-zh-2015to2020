<html>
<head>
<title>Demystifying Tensorflow Estimator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">揭开张量流估计器的神秘面纱</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/demystifying-tensorflow-estimator-7113e7275606?source=collection_archive---------25-----------------------#2020-03-24">https://medium.com/analytics-vidhya/demystifying-tensorflow-estimator-7113e7275606?source=collection_archive---------25-----------------------#2020-03-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/df5f34ab645571a5972b6687b90d4943.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2vM5TV90j8nronsMz3d_Dw.jpeg"/></div></div></figure><p id="e0ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Tensorflow是最受欢迎的机器学习库之一。它是少数几个让你在机器学习的最低和最高抽象层次工作的框架之一。您可以使用处理一切的高级API进行有用的机器学习，或者您可以从头开始构建一个自定义模型，控制从模型架构到训练循环的一切</p><blockquote class="jo jp jq"><p id="0c09" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated">您可以在这里找到并运行完整的代码片段示例<a class="ae jv" href="https://www.kaggle.com/junaidkhattak/avocado-price-prediction-with-tensorflow-estimator" rel="noopener ugc nofollow" target="_blank"/></p></blockquote><h2 id="23ce" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jb kh ki kj jf kk kl km jj kn ko kp kq bi translated">什么是张量流估计量？？</h2><p id="87b8" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">类似于<strong class="is hj"> keras的模型API </strong>，Tensorflow Estimator是一个<strong class="is hj">的高层</strong> API，<strong class="is hj">封装了训练、评估、预测和服务</strong>。换句话说，您不必编写训练、评估或预测循环，esitmator会为您完成所有工作。它还为您提供了一个可重复使用的模型，您可以在任何地方保存或加载该模型。</p><h2 id="6507" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jb kh ki kj jf kk kl km jj kn ko kp kq bi translated">为什么要使用Estimator API？</h2><p id="88f3" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">Estimator是一个易于使用的API，它为您处理大量的复杂性，但仍然提供足够的定制机会。您可以一次设计您的模型，它将在您的本地机器上无缝运行，无论有无GPU，也可以在有GPU和TPU的多服务器分布式环境上运行！！！</p><p id="0683" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它安全地运行一个分布式训练循环，负责加载数据、检查点并为tensor board编写摘要</p><h2 id="6871" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jb kh ki kj jf kk kl km jj kn ko kp kq bi translated">它是如何工作的？</h2><p id="8140" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">Estimator API允许您使用预制的以及定制的估算器。在这里，我将介绍如何使用预制的估算器，而将定制的估算器留待下次讨论</p><p id="8085" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过以下步骤，您可以使任何预制的评估器工作</p><h2 id="df10" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jb kh ki kj jf kk kl km jj kn ko kp kq bi translated">答:数据集输入函数</h2><p id="df46" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">这些函数接收数据集并返回要素字典和标注。特征字典是数据集中特征名称到特征值的映射</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="f059" class="jw jx hi lb b fi lf lg l lh li">def make_input_fn(df, epochs=500, shuffle=True, batch_size=32):<br/>    df = df.copy()<br/>    labels = df.pop('AveragePrice') # extract label from dataframe<br/>    def input_function():<br/>        <em class="jr"># create dataset from inmemory pandas dataframe        </em><br/>        dataset = tf.data.Dataset.from_tensor_slices((dict(df), labels))<br/>        if shuffle:<br/>            dataset = dataset.shuffle(buffer_size=len(df))<br/>        <br/>        dataset = dataset.batch(batch_size).repeat(epochs)<br/>        return dataset<br/>    return input_function<br/><br/>train_input_fn = make_input_fn(train_df)<br/>eval_input_fn = make_input_fn(eval_df, epochs=1, shuffle=False)</span></pre><p id="453e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的示例中，make_input_fn是输入函数创建者，因为它返回实际数据集输入函数input_function</p><h2 id="1636" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jb kh ki kj jf kk kl km jj kn ko kp kq bi translated">b:定义特征列</h2><p id="9e81" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">在第二步中，我们创建了一个所有特征列的列表，我们希望在这些特征列上训练我们的模型。它将所有特性定义为tf.feature_column，它需要特性名称和可选的数据类型以及预处理函数</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="dfaa" class="jw jx hi lb b fi lf lg l lh li">DENSE_COLUMNS = ['Total_Bags','Small_Bags','Large_Bags','XLarge_Bags']<br/><br/>SPARSE_COLUMNS = ['type', 'year', 'region']<br/><br/>feature_columns = []<br/>for feature <strong class="lb hj">in</strong> DENSE_COLUMNS:<br/>    feature_columns.append(tf.feature_column.numeric_column(feature))<br/>for feature <strong class="lb hj">in</strong> SPARSE_COLUMNS:<br/>    vocab = data[feature].unique()<br/>    categorical_feature = tf.feature_column.categorical_column_with_vocabulary_list(feature, vocab)<br/>    feature_columns.append(tf.feature_column.indicator_column(categorical_feature))</span></pre><p id="5e2d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的例子中，我有一个数据集，它有一些密集(连续)和一些稀疏(分类)的特征。对于每个特征类型，创建tf.feature并将其添加到feature_columns列表中。然后，我们的模型将使用这个列表来处理数据集中的实际数据</p><h2 id="203f" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jb kh ki kj jf kk kl km jj kn ko kp kq bi translated">c:实例化评估人员和培训</h2><p id="bab3" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">有许多<a class="ae jv" href="https://www.tensorflow.org/api_docs/python/tf/estimator/" rel="noopener ugc nofollow" target="_blank">预制估算器</a>可用。你可以在这里浏览完整的<a class="ae jv" href="https://www.tensorflow.org/api_docs/python/tf/estimator/" rel="noopener ugc nofollow" target="_blank">列表。您只需将专题专栏传递给它，就万事大吉了。如果需要执行参数调整，也可以传递这些参数。要开始训练，只需在估计器上调用train方法，并将数据集输入函数作为参数传递</a></p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="4c96" class="jw jx hi lb b fi lf lg l lh li">linear_regressor = tf.estimator.LinearRegressor(<br/>    feature_columns=feature_columns,<br/>    model_dir=output_dir<br/>)<br/>linear_regressor.train(train_input_fn)</span></pre><p id="9c82" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">仅此而已！！！</p><p id="4274" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您的模型将开始训练，并在output_dir中保存模型检查点和摘要。你也可以将张量板指向这个目录来监控训练</p><p id="4086" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jr"> Tensorflow附带了</em><strong class="is hj"><em class="jr">tensor board</em></strong><em class="jr">，这是一个用于可视化不同模型指标的强大工具。你可以在</em><a class="ae jv" href="https://bit.ly/2STa5Ax" rel="noopener ugc nofollow" target="_blank"><strong class="is hj"><em class="jr">Neptune . ai</em></strong></a>查看非常有用的tensorboard介绍</p></div></div>    
</body>
</html>