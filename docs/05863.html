<html>
<head>
<title>Improving Workflow with Cloud Storage FUSE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用云存储FUSE改进工作流</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/improve-workflow-with-cloud-storage-fuse-89b8d76d0886?source=collection_archive---------10-----------------------#2020-05-04">https://medium.com/analytics-vidhya/improve-workflow-with-cloud-storage-fuse-89b8d76d0886?source=collection_archive---------10-----------------------#2020-05-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/7f48821f3d86bf4ec3ec183a31f80c64.png" data-original-src="https://miro.medium.com/v2/resize:fit:676/format:webp/1*wYQqQzLRDj2Th3LI7pUyRA.png"/></div></figure><p id="7ee6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我使用云存储Fuse已经一年多了，我发现它在自动化/改进数据工程项目工作流方面非常有用。作为开源FUSE <a class="ae jk" href="https://github.com/libfuse/libfuse" rel="noopener ugc nofollow" target="_blank">实现</a>的适配器，云存储FUSE允许我们挂载一个GCS桶作为文件系统。</p><p id="a9c8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这使我们的语法保持干净，因为我们可以用本地路径引用我们的文件，而不是通过GCS客户端库来读/写多行代码。</p><p id="c1ee" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下面是设置它的方法:</p><p id="5195" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="jl">注意:</em> <em class="jl">我在我的计算引擎VM中使用的是Ubuntu 18.04 LTS镜像；GCS Fuse目前不支持Windows ( </em> <a class="ae jk" href="https://cloud.google.com/storage/docs/gcs-fuse" rel="noopener ugc nofollow" target="_blank"> <em class="jl">仅适用于Linux/MacOS </em> </a> <em class="jl">)。</em></p><p id="5320" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">步骤0:安装Google Cloud SDK(如果您尚未安装)</strong></p><p id="a87f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><a class="ae jk" href="https://cloud.google.com/sdk/docs/quickstart-debian-ubuntu" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/sdk/docs/quickstart-debian-ubuntu</a></p><p id="54d9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">第一步:认证</strong></p><p id="3430" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，我们需要对GCS Fuse进行身份验证才能工作。FUSE将通过以下三种方法中的任何一种自动发现凭据:</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es jm"><img src="../Images/9b58b99b72736b067baacfd9a659dc93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xjJL47VNyCTgXYBuR6tfGw.png"/></div></div></figure><p id="4bd2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">出于我们的目的，我们将使用第三个选项设置环境变量:</p><pre class="jn jo jp jq fd jv jw jx jy aw jz bi"><span id="fd6e" class="ka kb hi jw b fi kc kd l ke kf">gcloud auth application-default login</span></pre><figure class="jn jo jp jq fd ij er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es kg"><img src="../Images/30fd53615527ed77b97e300250ffa211.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*vQUV3og54vWuSk5uG8tcgw.gif"/></div></div></figure><p id="cc36" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">第二步:安装云存储保险丝</strong></p><p id="6362" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">认证之后，我们会在我们的Ubuntu机器上安装云存储FUSE。这些信息可以在Github 上找到，并为其他Linux发行版和Mac OS提供了指导。</p><pre class="jn jo jp jq fd jv jw jx jy aw jz bi"><span id="63d1" class="ka kb hi jw b fi kc kd l ke kf">export GCSFUSE_REPO=gcsfuse-`lsb_release -c -s`</span><span id="5968" class="ka kb hi jw b fi kh kd l ke kf">echo "deb http://packages.cloud.google.com/apt $GCSFUSE_REPO main" | sudo tee /etc/apt/sources.list.d/gcsfuse.list<br/>curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -</span><span id="f805" class="ka kb hi jw b fi kh kd l ke kf">sudo apt-get update<br/>sudo apt-get install gcsfuse</span></pre><figure class="jn jo jp jq fd ij er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es ki"><img src="../Images/4f128817c660b59b116b9f3591d754cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*UzjAzhb8oWHBGH8GQM0vXQ.gif"/></div></div><figcaption class="kj kk et er es kl km bd b be z dx translated">安装云存储保险丝</figcaption></figure><p id="18bc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">第三步:安装云存储桶</strong></p><p id="4dee" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们已经在机器上安装了gcsfuse，我们将把我们的GCS bucket挂载为一个文件系统。我使用下面的函数创建了一个默认配置的bucket，然后上传了两个csv文件。</p><pre class="jn jo jp jq fd jv jw jx jy aw jz bi"><span id="97c9" class="ka kb hi jw b fi kc kd l ke kf">gsutil mb gs://test-gcsfuse8592</span></pre><figure class="jn jo jp jq fd ij er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es kn"><img src="../Images/397a9384dd9b00e5f9eb7b828dfd715f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GzOBv_gUc6zN00Ekkdo6DA.png"/></div></div></figure><p id="ec9d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了挂载云存储FUSE，我们首先创建一个新的空文件夹，然后运行gcsfuse来在该文件夹中挂载我们的bucket。</p><pre class="jn jo jp jq fd jv jw jx jy aw jz bi"><span id="5ff7" class="ka kb hi jw b fi kc kd l ke kf">mkdir test-bucket</span><span id="a4d1" class="ka kb hi jw b fi kh kd l ke kf">gcsfuse --implicit-dirs test-gcsfuse8592 test-bucket/</span></pre><figure class="jn jo jp jq fd ij er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es ki"><img src="../Images/a854b77d84a2d197513f96270e3b6d24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*VEi4VctxyUbKB7vrUe7a0Q.gif"/></div></div></figure><p id="9b59" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">注意:<em class="jl">有几个标志可以用来改变gcsfuse的工作方式；我个人总是使用implicit-dirs标志运行函数，但是这也有一些缺点，尤其是如果您有很多文件并且担心延迟的话。更多信息请访问:</em><a class="ae jk" href="https://github.com/GoogleCloudPlatform/gcsfuse/blob/master/docs/semantics.md" rel="noopener ugc nofollow" target="_blank"><em class="jl">https://github . com/Google cloud platform/GCS fuse/blob/master/docs/semantics . MD</em></a></p><p id="d28e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">上面的命令让我们把我们的bucket挂载为一个文件系统；我们的bucket内容(我们的两个CSV文件)现在可以在test-bucket文件夹中找到。</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es ko"><img src="../Images/11fcec4e51ed5705a6bce4b6ba0df0d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lWVnN_kTHjeVaUaVXtbZ9w.png"/></div></div></figure><p id="876e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">步骤4:卸载铲斗</strong></p><p id="ac9b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">卸载也非常简单，使用以下命令:</p><pre class="jn jo jp jq fd jv jw jx jy aw jz bi"><span id="b8a5" class="ka kb hi jw b fi kc kd l ke kf">fusermount -u test-bucket</span></pre><p id="9c90" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">卸载存储桶后，文件夹会保留，但内容会消失。</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es ki"><img src="../Images/cf613a93ff1a274c195a38801b6f8e84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*-fNNEEp9Yw6HDdAZH6Gj4Q.gif"/></div></div><figcaption class="kj kk et er es kl km bd b be z dx translated">卸载铲斗</figcaption></figure><p id="73dd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">感谢阅读！</p><p id="e0c1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi">— -</p><p id="b639" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这篇文章于2020年8月31日转载到我的个人<a class="ae jk" href="https://www.dataarchitecting.com/post/improving-workflow-with-cloud-storage-fuse" rel="noopener ugc nofollow" target="_blank">博客</a>上。</p></div></div>    
</body>
</html>