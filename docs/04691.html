<html>
<head>
<title>Handling imbalanced dataset in image classification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">图像分类中不平衡数据集的处理</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/handling-imbalanced-dataset-in-image-classification-dc6f1e13aeee?source=collection_archive---------4-----------------------#2020-03-29">https://medium.com/analytics-vidhya/handling-imbalanced-dataset-in-image-classification-dc6f1e13aeee?source=collection_archive---------4-----------------------#2020-03-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/dc71f2c6dc1f336edcc270666b0ea52d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ftGV1hvEQuqemtTBpBE6Iw.png"/></div></figure><p id="628c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我一直致力于在雷达图像上探测火山的测试任务。图像尺寸为100x100像素，单通道。训练数据集非常不平衡(没有火山的图像数量是有火山的图像数量的5倍)。</p><p id="13f3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">有很多方法可以解决这个问题，如类权重、过采样训练数据集、焦点损失等。</p><p id="e3e7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在本文中，我将介绍训练数据集的手动过采样，以解决类不平衡的问题。</p><p id="c978" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们首先概述一下数据中类的分布。这里我们看到过采样前每类的样本数:</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es jk"><img src="../Images/6ac420b53352eb892da671272e7d8ab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*RtuvSs8j_DBU2Yu-nXFALg.png"/></div></figure><p id="c2dd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以看到1K的有火山的样本和6K左右没有火山的样本。</p><p id="28fd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">过采样意味着我们增加小类中的样本数量，以便不同类中的样本数量变得相等或接近，从而变得更加平衡。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jp"><img src="../Images/799068f127eb9c8c963d112eff107078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZoLKXa4ALrsNNY3RtMlOdQ.png"/></div></div></figure><p id="41e3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们在准备训练样本时应用手动过采样。</p><p id="3956" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我在prepareImages方法中应用了过采样:</p><pre class="jl jm jn jo fd ju jv jw jx aw jy bi"><span id="2c99" class="jz ka hi jv b fi kb kc l kd ke">def prepareImages(train, shape, data_path, mode):</span><span id="7839" class="jz ka hi jv b fi kf kc l kd ke">    for index, row in train.iterrows():</span><span id="8509" class="jz ka hi jv b fi kf kc l kd ke">        has_volcano = row['Volcano?']<br/>        ...<br/>        if has_volcano and mode == 'train':</span><span id="2875" class="jz ka hi jv b fi kf kc l kd ke">            x_train[count] = img_to_array( cv2.flip( img, 1 ) )</span><span id="30ed" class="jz ka hi jv b fi kf kc l kd ke">            y_train[count] = int(has_volcano)</span><span id="5951" class="jz ka hi jv b fi kf kc l kd ke">            count += 1</span><span id="1f54" class="jz ka hi jv b fi kf kc l kd ke">            // repeat the same step three more times applying different transformation and incrementing count</span></pre><p id="1e9a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们在这里读到“火山？”样本的属性。如果图像包含火山，我们对原始图像进行一些变换，并将修改后的图像与相应的标签一起添加到数据集。在我的例子中，我应用了3次翻转(值为0，1和-1)和旋转(cv2。顺时针旋转90度)。</p><p id="c521" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们显示过采样后的类分布</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kg"><img src="../Images/d9ddae664be17b9aa0d936c7a5c698ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*dI9O9aWXVY9bNvPZ6GEZpg.png"/></div></figure><h1 id="4906" class="kh ka hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">过采样的实验评估</h1><h2 id="b037" class="jz ka hi bd ki le lf lg km lh li lj kq ix lk ll ku jb lm ln ky jf lo lp lc lq bi translated">过采样的结果</h2><p id="24ee" class="pw-post-body-paragraph im in hi io b ip lr ir is it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj hb bi translated">当不应用过采样时</p><pre class="jl jm jn jo fd ju jv jw jx aw jy bi"><span id="7900" class="jz ka hi jv b fi kb kc l kd ke">loss: 0.2359 — acc: 0.9202 — val_loss: 0.4253 — val_acc: 0.8626</span><span id="aaba" class="jz ka hi jv b fi kf kc l kd ke">AUC = 0.500</span></pre><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es lw"><img src="../Images/8017b6216bbf357789f334cc9c1f1dff.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/0*9_HjyOpvejy6ZTar"/></div></figure><p id="3824" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">和损失/精度图</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es lx"><img src="../Images/7b72eb83c83a1372e381426cc52ee6eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/0*7YPvahPx5ixr-VRw"/></div></figure><p id="5cab" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当对测试数据集执行预测时，我们得到以下结果:</p><pre class="jl jm jn jo fd ju jv jw jx aw jy bi"><span id="2c90" class="jz ka hi jv b fi kb kc l kd ke">number of images with volcanoes: 0</span><span id="e598" class="jz ka hi jv b fi kf kc l kd ke">number of images without volcanoes: 2734</span></pre><p id="6ea2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以看到所有的测试样本都被归类为没有火山。</p><h2 id="d3ed" class="jz ka hi bd ki le lf lg km lh li lj kq ix lk ll ku jb lm ln ky jf lo lp lc lq bi translated">过采样的结果</h2><p id="6a70" class="pw-post-body-paragraph im in hi io b ip lr ir is it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj hb bi translated">当我们应用过采样时</p><pre class="jl jm jn jo fd ju jv jw jx aw jy bi"><span id="3db6" class="jz ka hi jv b fi kb kc l kd ke">loss: 0.6885 — acc: 0.5264 — val_loss: 0.6856 — val_acc: 0.5718</span><span id="658f" class="jz ka hi jv b fi kf kc l kd ke">AUC = 0.504</span></pre><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es lw"><img src="../Images/2c697fc49acfca1b94b2120bff9ee2f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/0*pg-XrTgeKdBPjeYn"/></div></figure><p id="de20" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">和我们的学习曲线</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es lx"><img src="../Images/6f84d025ab07a3eb32f11de27d4db297.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/0*xoKU545NKHuwXJSk"/></div></figure><p id="20fb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当对测试数据集执行预测时，我们得到以下结果:</p><pre class="jl jm jn jo fd ju jv jw jx aw jy bi"><span id="24bc" class="jz ka hi jv b fi kb kc l kd ke">number of images with volcanoes: 27</span><span id="874f" class="jz ka hi jv b fi kf kc l kd ke">number of images without volcanoes: 2707</span></pre><p id="765c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">就是这样。</p></div></div>    
</body>
</html>