<html>
<head>
<title>Twitter Missing Data Recovery Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python恢复Twitter丢失的数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/twitter-missing-data-recovery-using-python-7c193cfecb18?source=collection_archive---------8-----------------------#2020-05-14">https://medium.com/analytics-vidhya/twitter-missing-data-recovery-using-python-7c193cfecb18?source=collection_archive---------8-----------------------#2020-05-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9eff5b40699b973a21fbe70a4b6f17f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*CgU2S6LJZo9Z_1qMS-mljw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">资料来源:freepik.com</figcaption></figure><p id="612d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">随着互联网的普及，社交媒体已经成为我们日常生活的一部分。数十亿用户在社交媒体平台上分享他们的想法，彼此保持联系，分享视频，上传图片。所有这些状态更新、图片和视频都包含有价值的信息。分享的信息可以用来了解人民的情绪。情感分析可以帮助影响营销策略或预测选举结果，或向人们提供个性化的建议等等。</p><p id="d750" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">今天，数据已经成为新的石油；它无处不在。根据官方在2014年发布的推特使用统计数据，平均每天有5亿条推文被发送，也就是说，每秒钟有6000条推文。想象一下，在任何领域的研究中，这些数据是多么强大。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="124e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae js" href="https://developer.twitter.com/en/docs/tweets/filter-realtime/overview" rel="noopener ugc nofollow" target="_blank"> Twitter流媒体应用编程接口(API) </a>允许我们收集近乎实时产生的推文。这些推文可以基于某些标签或关键词或twitter句柄来收集。<a class="ae js" href="http://docs.tweepy.org/en/latest/" rel="noopener ugc nofollow" target="_blank"> Tweepy </a>是最流行的Python库，可以用来连接流媒体API，适当处理错误。</p><p id="936b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在传输实时推文时，需要遵循一些规则:</p><ol class=""><li id="4b47" class="ka kb hi iw b ix iy jb jc jf kc jj kd jn ke jr kf kg kh ki bi translated">创建到Twitter API的持久连接，并增量读取每个连接</li><li id="0428" class="ka kb hi iw b ix kj jb kk jf kl jj km jn kn jr kf kg kh ki bi translated">快速处理推文，不要让你的程序出现备份</li><li id="8416" class="ka kb hi iw b ix kj jb kk jf kl jj km jn kn jr kf kg kh ki bi translated">认真处理错误和其他问题</li></ol></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="ae02" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在跳到这些规则之前，让我们讨论一下如何建立到Twitter流API的连接。</p><ul class=""><li id="d825" class="ka kb hi iw b ix iy jb jc jf kc jj kd jn ke jr ko kg kh ki bi translated">我们需要一个有效的<a class="ae js" href="https://developer.twitter.com/en/apply-for-access" rel="noopener ugc nofollow" target="_blank">开发者账户</a>来访问API。查看此<a class="ae js" href="https://www.extly.com/docs/autotweetng_joocial/tutorials/how-to-auto-post-from-joomla-to-twitter/apply-for-a-twitter-developer-account/#apply-for-a-developer-account" rel="noopener ugc nofollow" target="_blank">链接</a>了解如何申请的更多详情。</li><li id="2f9a" class="ka kb hi iw b ix kj jb kk jf kl jj km jn kn jr ko kg kh ki bi translated">在设置了Twitter开发者的帐户之后，我们需要创建一个应用程序来生成API密钥和访问令牌。</li></ul><p id="dd96" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">按照以下步骤生成API密钥和访问令牌:</p><ol class=""><li id="c956" class="ka kb hi iw b ix iy jb jc jf kc jj kd jn ke jr kf kg kh ki bi translated">点击你的Twitter开发者账户名，进入“应用”选项</li><li id="a461" class="ka kb hi iw b ix kj jb kk jf kl jj km jn kn jr kf kg kh ki bi translated">点击你创建的应用程序右侧的“详细信息”按钮。转到“密钥和令牌”选项。您将在那里看到生成的密钥和令牌。</li><li id="d8ab" class="ka kb hi iw b ix kj jb kk jf kl jj km jn kn jr kf kg kh ki bi translated">现在，您可以使用这些密钥和令牌开始使用Twitter API了</li></ol><p id="f670" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下面你可以看到代码建立到Twitter API的连接，并传输接近实时的数据。收集的数据被转储到一个JSON文件中。</p><p id="84b3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">注</strong>:用各自的代币替换大写字母。</p><figure class="kp kq kr ks fd ij"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="fc85" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">不幸的是，获取实时流数据并不总是那么简单。Twitter流API施加了速率限制，并禁止太多太快的连接尝试。它还可以防止使用相同的授权密钥建立太多的连接。此外，如果处理tweets的时间太长，它们将开始排队，Twitter API连接将丢失。网络不稳定也可能是断线的原因。很有可能丢失在丢失连接和重新连接之间的时间间隔内发送的数据。</p><p id="8141" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于任何要得出结论的研究，基础数据的质量决定了商业决策的有效性。高质量的数据有利于做出更明智的决策，通过创建吸引受众的可靠广告来恰当地锁定受众，提高盈利能力等。如果我们没有所需的数据，我们就无法分析特定的趋势或了解我们的业务是如何运作的。糟糕或不完整的数据会导致糟糕的分析，最终导致糟糕的业务决策，带来更糟糕的结果。必须恢复任何丢失的数据，并确保正在分析的数据完整可信。</p><p id="472b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae js" href="https://developer.twitter.com/en/docs/tweets/search/overview" rel="noopener ugc nofollow" target="_blank"> Twitter的标准REST API </a>确实提供了对旧推文的访问，但只能覆盖一周的推文。如果我们需要检索比这更早的推文呢？也许几周，几个月，甚至几年？</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es kv"><img src="../Images/d6a872c8071f4c20b679f4c118cf6928.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/1*iuxgrQvzcsw5qcpTbXHvXQ.gif"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">资料来源:giphy.com</figcaption></figure><p id="6efc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">幸运的是，当我在寻找解决这个问题的资源时，我发现了一个Python库和一个scraper，可以有效地用来获取旧的tweets。这两个工具都不需要Twitter API凭证来连接API和获取数据。他们利用Python库，如requests、urllib、json、bs4、PyQuery等。来收集推特数据。</p><ol class=""><li id="172e" class="ka kb hi iw b ix iy jb jc jf kc jj kd jn ke jr kf kg kh ki bi translated"><strong class="iw hj"> GetOldTweets </strong> → python工具最初由<a class="ae js" href="https://github.com/Jefferson-Henrique/GetOldTweets-python" rel="noopener ugc nofollow" target="_blank"> Jefferson Henrique </a>在python版本2.x中开发，后来由<a class="ae js" href="https://github.com/Mottl/GetOldTweets3" rel="noopener ugc nofollow" target="_blank"> Dmitri Mottl </a>在Python版本3.x中修改</li><li id="baf9" class="ka kb hi iw b ix kj jb kk jf kl jj km jn kn jr kf kg kh ki bi translated"><strong class="iw hj">snscrape</strong>→<a class="ae js" href="https://github.com/JustAnotherArchivist/snscrape" rel="noopener ugc nofollow" target="_blank">snscrape</a>是一个社交网络服务(SNS)的刮刀。它抓取用户资料、标签或搜索，然后返回相关的帖子。</li></ol><h1 id="8ca6" class="kw kx hi bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><strong class="ak"> GetOldTweets3- </strong></h1><p id="7f17" class="pw-post-body-paragraph iu iv hi iw b ix lu iz ja jb lv jd je jf lw jh ji jj lx jl jm jn ly jp jq jr hb bi translated">要安装GetOldTweets3库，请使用以下命令。</p><p id="28af" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="lz"> pip安装GetOldTweets3 </em></p><p id="495f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">可以通过命令行或使用Python类使用GetOldTweets3获取tweets。你可以在这里找到更多关于命令行用法或者Python类<a class="ae js" href="https://github.com/Mottl/GetOldTweets3" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="935c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要收集某些twitter句柄发布的tweets，请参考下面的代码，它使用GetOldTweets3 Python类并将结果存储在一个<strong class="iw hj">中。CSV </strong>文件。</p><figure class="kp kq kr ks fd ij"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="1cc3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">。CSV </strong>输出文件如下图所示。</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ma"><img src="../Images/2906958756dd600f4d34f54e63d435fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sVIPqVh9G98gKZPnJd063A.png"/></div></div></figure><h1 id="ff98" class="kw kx hi bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><strong class="ak">snscreage-</strong></h1><p id="06c2" class="pw-post-body-paragraph iu iv hi iw b ix lu iz ja jb lv jd je jf lw jh ji jj lx jl jm jn ly jp jq jr hb bi translated">要安装snscrape，请使用以下命令。</p><p id="e4d4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="lz"> pip3安装snscrape </em></p><p id="91ed" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">只能通过命令行使用snscrape来获取twitter数据。<br/>对于一个单独的twitter句柄，可以使用下面的命令获取该句柄发布的tweets，获取的数据存储在一个文本文件中。</p><p id="a1ed" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="lz">snscrape Twitter-用户“speaker Pelosi”&gt;Twitter-speaker Pelosi</em></p><p id="3a89" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下面是该命令的示例输出。</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/ade867e7f83105d7e30ce6ba38e053f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ba0cdpk9ODF6X-DqtGRZA.png"/></div></div></figure><p id="41c6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果想从多个twitter句柄获取数据，可以使用下面的Python代码。</p><figure class="kp kq kr ks fd ij"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="e182" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里需要注意的一点是，snscrape只能获取推文的HTML链接，这些链接包含发布推文的twitter句柄和推文的唯一id。它不会获取与tweet相关的所有信息。</p><p id="d6bf" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">但是好消息是Tweepy为我们提供了一个"<strong class="iw hj"> get_status() </strong>"方法，它可以根据tweet id获取整个tweet以及与之相关的所有信息。</p><p id="b289" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">最后，之前使用snscrape获取的tweet ids可以传递给这个get_status()方法，整个tweet信息可以存储在一个<strong class="iw hj">中。CSV </strong>文件使用下面的Python代码。</p><p id="4edb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">注意，tweet_mode被设置为“<strong class="iw hj"> extended </strong>”以获取tweet的整个未截断文本。默认情况下，tweepy返回tweet的状态对象。API方法包含只有140个字符的截短的tweet文本。更多详情见<a class="ae js" href="http://docs.tweepy.org/en/latest/extended_tweets.html" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><figure class="kp kq kr ks fd ij"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="7512" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">通过这种方式，我们可以将使用Twitter Streaming API收集的数据与新获取的数据进行比较，并恢复丢失的推文。</p><p id="f7bb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">总之，我们学习了如何连接到Twitter流API并获取实时数据，Twitter API施加的限制，确保数据的完整性和有用性的重要性，以及可用于恢复任何丢失数据的各种Python包。</p><p id="4564" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我希望这篇文章内容丰富，能够帮助那些正在为类似的丢失数据问题而挣扎的人。这篇文章的源代码可以在<a class="ae js" href="https://github.com/aditideokar93/Twitter-Missing-Data-Recovery" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><p id="dc17" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是我的第一篇技术文章，我很想知道你们是如何发现它的。任何反馈/建议都将不胜感激！</p><p id="41a4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">快乐学习！😊</p></div></div>    
</body>
</html>