<html>
<head>
<title>Custom Deep Learning Models Training Loop</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">定制深度学习模型训练循环</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/custom-deep-learning-models-training-loop-b8c7a5de2e65?source=collection_archive---------10-----------------------#2019-09-16">https://medium.com/analytics-vidhya/custom-deep-learning-models-training-loop-b8c7a5de2e65?source=collection_archive---------10-----------------------#2019-09-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="94d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章旨在帮助你理解回访以及如何使用回访。也是为了让你准备好进入复杂的回调系统，无论是在 <a class="ae je" href="https://docs.fast.ai/callbacks.html" rel="noopener ugc nofollow" target="_blank"> <em class="jd"> fast.ai </em> </a> <em class="jd">还是</em> <a class="ae je" href="https://keras.io/callbacks/" rel="noopener ugc nofollow" target="_blank"> <em class="jd"> keras </em> </a> <em class="jd">回调。</em></p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/19fcad6d3b0f95f5597904b432f407d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AIZUT-4HLmhFBJpa"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">照片由<a class="ae je" href="https://unsplash.com/@clemhlrdt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Clément H </a>在<a class="ae je" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="999a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Pytorch中深度学习模型的基本训练循环包括五个步骤:-</p><ol class=""><li id="db9c" class="jv jw hi ih b ii ij im in iq jx iu jy iy jz jc ka kb kc kd bi translated">计算预测。</li><li id="063d" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">计算损失。</li><li id="6458" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">向后传球。</li><li id="951d" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">更新参数。</li><li id="a9a7" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">消除渐变。</li></ol><p id="d185" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这五个步骤可以简单地放入如下代码行中</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es kj"><img src="../Images/17230d6d3fab76c6b8faf759637d7bd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nVC8OxpKEAjktkHARCnAug.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">训练深度学习模型的基本步骤。</figcaption></figure><h2 id="0eae" class="kk kl hi bd km kn ko kp kq kr ks kt ku iq kv kw kx iu ky kz la iy lb lc ld le bi translated">说明</h2><ul class=""><li id="4611" class="jv jw hi ih b ii lf im lg iq lh iu li iy lj jc lk kb kc kd bi translated">训练神经网络中的数据总是以小批量的形式输入，每个小批量包含特征和标签(<em class="jd">数据和目标</em>)。我们将特征传递给神经网络架构来计算预测。这就是通常所说的<em class="jd">向前传球</em>。</li><li id="eca7" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc lk kb kc kd bi translated">使用向前传球的预测和实际目标，我们计算损失，这告诉我们离目标有多远。这是使用<em class="jd">损失函数</em>完成的。</li><li id="6b17" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc lk kb kc kd bi translated">在获得损耗之后，我们通过网络架构向后传播损耗相对于模型参数的梯度。这就是<em class="jd">反向传播算法</em>发挥作用的地方。</li><li id="472f" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc lk kb kc kd bi translated">然后，在<em class="jd">反向通过</em>后，我们更新/调整正在优化的模型参数。</li><li id="9f10" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc lk kb kc kd bi translated">最后，我们不希望在小批量之间累积梯度，所以我们将把模型参数的梯度归零。</li></ul><h2 id="c45e" class="kk kl hi bd km kn ko kp kq kr ks kt ku iq kv kw kx iu ky kz la iy lb lc ld le bi translated">什么可能会出错？</h2><p id="fbd8" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">上面的训练循环工作得非常好，但是非常有限。想象一种情况，你想:-</p><ul class=""><li id="d805" class="jv jw hi ih b ii ij im in iq jx iu jy iy jz jc lk kb kc kd bi translated">控制培训的学习速度</li><li id="a6e3" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc lk kb kc kd bi translated">训练期间控制坡度</li><li id="f95e" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc lk kb kc kd bi translated">在培训期间跟踪指标</li><li id="2e08" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc lk kb kc kd bi translated">添加正则化技术</li><li id="56f8" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc lk kb kc kd bi">…</li></ul><p id="6627" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是创建自定义训练循环的要点，通过它我们可以在训练神经网络时添加任何我们可能想到的东西。</p></div><div class="ab cl lo lp gp lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="hb hc hd he hf"><h1 id="7f0f" class="lv kl hi bd km lw lx ly kq lz ma mb ku mc md me kx mf mg mh la mi mj mk ld ml bi translated"><strong class="ak">回调</strong></h1><p id="147a" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">到目前为止，唯一允许我们定制训练循环的方法是使用<em class="jd">回调。"你只有在想家的时候才会讨厌路途。"那是一次回调。在编程中，把回调看作一个只在特定条件下调用的函数/方法。</em></p><p id="56ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们都是从这个主题开始，在进入复杂的回调系统之前，这里有一个简单的代码来演示回调是如何工作的。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es mm"><img src="../Images/a9b364275932a5dc7d0b80298f64e576.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*pSQ2ybNr51szSzIBuFu-9Q.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">回调时的代码演示</figcaption></figure><p id="8e3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过回调，我们现在可以选择在训练开始或结束时，在epoch开始或结束时，在批处理开始或结束时，在我们的训练循环上做一些事情。我们甚至可以关注培训和验证指标。</p><p id="5e9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">例#1 </strong>，考虑到我们要避免对训练数据的过拟合，我们可以在每个历元之后使用回调来决定是否继续训练。这仅仅意味着我们希望在epoch end上实现早期停止。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es mn"><img src="../Images/7a478f73e0b06d840c11e404854314c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*EzUCF6SKJtV1UrnzIsoWKw.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">回调如何用于提前停止的示例</figcaption></figure><p id="6054" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">示例#2，</strong>假设我们想要通过使用梯度裁剪方法来对抗爆炸梯度问题来提高我们的神经网络训练稳定性。我们可以在每次反向传递后使用回调来剪裁超出首选范围的模型参数的梯度值。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es mo"><img src="../Images/cab701d577ccf609b09796c3c7817a1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZcvVY_W4DzfLtRWTNlV00A.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">回调如何用于渐变剪辑的示例</figcaption></figure><p id="3925" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在我的<a class="ae je" href="https://github.com/shebogholo/pytorch/blob/master/custom_train_loop.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到这篇文章的工作代码演示。</p></div><div class="ab cl lo lp gp lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="hb hc hd he hf"><h2 id="5417" class="kk kl hi bd km kn ko kp kq kr ks kt ku iq kv kw kx iu ky kz la iy lb lc ld le bi translated">承认</h2><p id="e22e" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">感谢你阅读这篇文章，特别感谢<a class="ae je" href="https://twitter.com/alienelf" rel="noopener ugc nofollow" target="_blank">杰德·雅培</a>和<a class="ae je" href="https://twitter.com/ThisIsApix" rel="noopener ugc nofollow" target="_blank">弗雷德里克·阿皮娜</a>花时间阅读这篇文章。</p></div></div>    
</body>
</html>