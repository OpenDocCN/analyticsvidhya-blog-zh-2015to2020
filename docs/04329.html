<html>
<head>
<title>2 techniques you need to know to handle imbalance data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你需要知道的处理不平衡数据的两个技巧</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/two-techniques-you-need-to-know-to-handle-imbalance-data-6ce674d1434e?source=collection_archive---------17-----------------------#2020-03-14">https://medium.com/analytics-vidhya/two-techniques-you-need-to-know-to-handle-imbalance-data-6ce674d1434e?source=collection_archive---------17-----------------------#2020-03-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f71bacf224ed63f366b8555ed3b0a6ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sCAfeR_O4YjmZlBX"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">戴维·沃布鲁克在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="2947" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你在现实世界中做过机器学习分类问题吗？如果是这样，您可能对不平衡数据问题有一些经验。不平衡数据意味着我们想要预测的类别不成比例。构成大部分数据的类称为多数类。那些占较小部分的是少数阶级。例如，我们希望使用机器学习模型来捕获信用卡欺诈，欺诈活动大约占数百万笔交易的0.1%。大多数常规交易会妨碍机器学习算法识别欺诈活动的模式。</p><p id="76f2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们从一个使用scikit-learn提供的乳腺癌数据的简单案例开始。如下图，数据是平衡的。</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es jz"><img src="../Images/fdc4596de6bb8ffc153bfca0f94721a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*05vxGVgc1PfzD2UxbbkekQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">原始乳腺癌数据</figcaption></figure><p id="33de" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后我们可以建立一个简单的决策树模型，观察性能。对于类别1，精度显示81%的模型预测类别1确实是类别1；并且召回显示了97%的真实肯定率，即97%的实际类别1被模型捕获。</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es ka"><img src="../Images/ee37dc445b229973e3e5c05e89009f32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*0ym5uOOSJJpvc1q_mO1ioA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">天平数据的性能矩阵</figcaption></figure><h1 id="e6f9" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">创建不平衡数据</h1><p id="409b" class="pw-post-body-paragraph iv iw hi ix b iy kz ja jb jc la je jf jg lb ji jj jk lc jm jn jo ld jq jr js hb bi translated">对于实验，我们通过分别从类0和类1中抽取10，000和100个样本来创建不平衡数据。少数阶层的比例为1%。</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es le"><img src="../Images/b0a35dee551f00e2c15d9372ed55f157.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*DrLB7Jl6xqhHxfIKaTwnTQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">不平衡的乳腺癌数据</figcaption></figure><p id="cf57" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，我们对这种不平衡数据应用相同的简单决策树模型。类别1的真实阳性率从97%下降到33%。我们如何解决这个问题？</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es lf"><img src="../Images/c5fcabf2c6c6042d9625e59595c54f8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*8O0_Jy_KZdC6I2Jk8I5O0g.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">不平衡数据的性能矩阵</figcaption></figure><h1 id="47bf" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">方法1 —等级权重</h1><p id="c310" class="pw-post-body-paragraph iv iw hi ix b iy kz ja jb jc la je jf jg lb ji jj jk lc jm jn jo ld jq jr js hb bi translated">Scikit-learn提供了一种简单的方法来解决这个问题。通过为DecisionTreeClassifier指定class_weight = 'balanced ',分类器会自动查找每个类的权重。我们的实验表明，使用平衡的类权重可以将召回率从33%提高到96%，但是会导致很多误报，准确率从100%下降到36%。</p><pre class="jt ju jv jw fd lg lh li lj aw lk bi"><span id="146f" class="ll kc hi lh b fi lm ln l lo lp">clf = DecisionTreeClassifier(random_state=0,min_samples_leaf=30,class_weight='balanced') <br/>clf = clf.fit(X_train, y_train)</span></pre><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/14e44b88c8ce8495c7f2980b678b0d69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*FedJHj1kwLXeV-CzHubc2A.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">通过平衡类权重寻址不平衡数据的性能矩阵</figcaption></figure><h1 id="cb42" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">方法2 —上采样</h1><p id="85cd" class="pw-post-body-paragraph iv iw hi ix b iy kz ja jb jc la je jf jg lb ji jj jk lc jm jn jo ld jq jr js hb bi translated">另一种方法是应用上采样。这意味着我们保留所有多数类，并从少数类中随机抽样替换，以增加少数类的比例。这里，我们从类1中随机选择1000条记录。少数民族阶层的比例增加到13%。</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es lr"><img src="../Images/f366c2913cd02c75a74fef272d4d9d25.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*Go5Yo3AdoGyxylsrwa4E4Q.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">上采样数据</figcaption></figure><p id="e7f0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们再次用上采样数据训练我们的简单决策树模型。我们的实验表明，上采样产生了与方法1相当的真阳性率，同时将准确率从3%提高到62%。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es ls"><img src="../Images/0d46b4f08ccceb002be1a6a54ef8b9f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*F6o-R_MRLHcq-v3NGJeQuw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">通过上采样处理不平衡数据的性能矩阵</figcaption></figure><h1 id="4270" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">摘要</h1><p id="f8ac" class="pw-post-body-paragraph iv iw hi ix b iy kz ja jb jc la je jf jg lb ji jj jk lc jm jn jo ld jq jr js hb bi translated">在本文中，我们1)解释不平衡数据的问题；简单决策树模型对平衡乳腺癌数据工作良好，但对不平衡数据工作不佳。2)介绍了两种解决不平衡数据问题的方法。一种方法是类权重，另一种是上采样。下面列出了我们的基准和这两种方法之间的比较。注意，对于这两种方法，我们可以通过微调类权重和少数类比率来进一步提高性能。</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><h1 id="b930" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">参考</h1><ol class=""><li id="4e12" class="lt lu hi ix b iy kz jc la jg lv jk lw jo lx js ly lz ma mb bi translated"><a class="ae iu" href="https://github.com/colawhite/article/blob/master/handle_imbalance_data.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/cola white/article/blob/master/handle _ unbalance _ data . ipynb</a></li><li id="3856" class="lt lu hi ix b iy mc jc md jg me jk mf jo mg js ly lz ma mb bi translated"><a class="ae iu" href="https://developers.google.com/machine-learning/data-prep/construct/sampling-splitting/imbalanced-data" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/machine-learning/data-prep/construct/sampling-splitting/失衡数据</a></li></ol></div></div>    
</body>
</html>