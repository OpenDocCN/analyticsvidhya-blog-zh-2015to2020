<html>
<head>
<title>Integrating Rasa Open Source Chatbot Into Unity [Part 1] : The Connection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Rasa开源聊天机器人集成到Unity[第1部分]:连接</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/integrating-rasa-open-source-chatbot-into-unity-part-1-the-connection-9ba582c804cd?source=collection_archive---------5-----------------------#2020-03-02">https://medium.com/analytics-vidhya/integrating-rasa-open-source-chatbot-into-unity-part-1-the-connection-9ba582c804cd?source=collection_archive---------5-----------------------#2020-03-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a1559cd11adaf9f59d59d02de7909599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ivs0GWKJU3fqR_GlT3vGVg.png"/></div></div></figure><p id="1d6c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你好！在这个系列中，我们将使用Rasa开源框架创建一个聊天机器人，并将其与Unity集成，完全支持呈现Rasa提供的所有不同类型的响应。相同的源代码可以在<a class="ae jo" href="https://github.com/retrogeek46/Rasa-Unity" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="ebfa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将从寻找Rasa和Unity相互连接的方法开始，然后在下一部分继续为玩家创建一个与聊天机器人交互的UI。</p><h2 id="ea76" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">介绍</h2><p id="c043" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">Unity是一个非常受欢迎的游戏引擎，用于制作2D、3D、VR/AR/XR游戏和许多其他应用程序。用它制作的流行游戏的例子有Ori和盲目的森林，空心骑士和Cuphead。你可以在这里阅读更多关于<a class="ae jo" href="https://unity.com/" rel="noopener ugc nofollow" target="_blank">Unity</a>。</p><p id="8c63" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Rasa是一个开源的对话式人工智能框架，可用于轻松创建聊天机器人，能够与用户互动，并在处理意外输入的同时提供/检索信息。你可以在这里阅读更多关于<a class="ae jo" href="https://rasa.com/" rel="noopener ugc nofollow" target="_blank"> Rasa的信息。</a></p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kp"><img src="../Images/c769ec5bb197f775ff047bb5bdc4b7eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*w9XFL-npMIPHZ00dolPTfw.gif"/></div></div></figure><h1 id="8e02" class="ku jq hi bd jr kv kw kx jv ky kz la jz lb lc ld kc le lf lg kf lh li lj ki lk bi translated">装置</h1><p id="0b8d" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">创建一个文件夹来保存所有相关的代码，并将其命名为Rasa-Unity。在这个文件夹中，我们将有两个子文件夹，一个包含Rasa项目，另一个包含Unity。让我们从安装所有依赖项开始。</p><h2 id="9a1c" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated"><strong class="ak"> Rasa </strong></h2><p id="079b" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">使用rasa文件夹中的<a class="ae jo" href="https://rasa.com/docs/rasa/user-guide/installation/" rel="noopener ugc nofollow" target="_blank">该网页</a>中的说明安装Rasa和moodbot。通过运行Rasa服务器并在任何浏览器中打开<a class="ae jo" href="http://localhost:5005" rel="noopener ugc nofollow" target="_blank"> http://localhost:5005 </a>来测试您的安装。你应该得到一个回复“你好，Rasa 1.7.0 ”,最后一部分是Rasa安装的版本。</p><h2 id="3db0" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">一致</h2><p id="d443" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">使用<a class="ae jo" href="https://unity3d.com/get-unity/download" rel="noopener ugc nofollow" target="_blank"> Unity Hub </a>和Unity的最新版本(撰写本文时为Unity 2019.3.0f5)创建一个新的2D项目，并在Unity文件夹中将其命名为Rasa。</p><p id="f887" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Rasa和Unity的安装到此结束，现在我们可以开始将它们相互集成。</p><h2 id="7ac6" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">将Unity连接到Rasa服务器</h2><p id="e621" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">Unity可以使用自定义连接器和POST请求与Rasa通信。Rasa实现了默认的rest连接器，可以在<a class="ae jo" href="http://localhost:5005/webhooks/rest/webhook." rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">访问http://localhost:5005/web hooks/rest/web hook</strong>。</a>在本教程中，我们将使用这个默认钩子。如果您想创建自己的自定义连接器，请参考<a class="ae jo" href="https://rasa.com/docs/rasa/user-guide/connectors/custom-connectors/" rel="noopener ugc nofollow" target="_blank">本页</a>，了解如何在Rasa中创建自定义连接器。</p><p id="eb48" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们刚刚创建的Unity项目中，在Assets下创建两个文件夹Scripts和Scenes。这将有助于保持我们的项目整洁有序。在Scripts文件夹中，创建一个名为<strong class="is hj"> NetworkManager.cs </strong>的新C#脚本。这个脚本将包含在我们的Unity项目的所有网络相关的代码。</p><p id="69dc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">目前我们将有两个方法，<strong class="is hj"> SendMessageToRasa() </strong>和<strong class="is hj"> PostRequest() </strong>。<strong class="is hj">当用户按下发送按钮时，将调用SendMessageToRasa() </strong>，而<strong class="is hj"> PostRequest() </strong>将向Rasa服务器创建异步post请求并检索响应。</p><p id="d8d7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们还创建了一个类<strong class="is hj"> PostMessageJson </strong>，它有助于创建Json对象，因为Unity有一个非常基本的本地Json支持。</p><figure class="kq kr ks kt fd ij"><div class="bz dy l di"><div class="ll lm l"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">网络管理器</figcaption></figure><p id="5b4c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们将编辑场景来使用这个脚本。</p><p id="dc26" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">1.创建一个名为<strong class="is hj"> GameManager </strong>的空游戏对象，重置其变换，并将<strong class="is hj"> NetworkManager </strong>脚本拖到上面。<br/> 2。创建一个<strong class="is hj"> UI按钮</strong>并重置其转换。添加到检查器窗口中的<strong class="is hj"> OnClick </strong>()列表，并拖动上面创建的<strong class="is hj"> GameManager </strong>对象。从<strong class="is hj">网络管理器</strong>下的下拉菜单中选择<strong class="is hj"> SendMessageToRasa </strong>()方法。将按钮文本子对象的文本更改为“发送”。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/c991eff760425dce49984d34d8a3aa91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OUhTm024JfrrozLWqJvFLw.png"/></div></div></figure><p id="5cb1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们准备从Unity向Rasa发出第一个请求。播放场景，点击发送按钮。您应该会在控制台中收到来自Rasa的响应。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es ls"><img src="../Images/d018c9bec06232ec86b9dbabc190f22d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*5oU43fZ_twQNXSltbN3e4Q.gif"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">来自Rasa的响应应该可以在控制台中看到</figcaption></figure><h2 id="01a7" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">解析聊天机器人响应</h2><p id="21e2" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">服务器返回包含消息和其他相关信息的json字符串。为了解析这些信息，我们需要创建类似于发送消息的类。</p><p id="775d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些类将是RootReceiveMessageJson，它提取机器人可能给出的多个响应，而ReceiveMessageJson类将提取单个消息。我们还将为这两个类添加<strong class="is hj">【可序列化】</strong>属性，以便它们采用Unity易于存储和重构的格式。要使用<strong class="is hj">【可序列化】</strong>属性，记得在顶部添加<code class="du lt lu lv lw b">using System;</code>。</p><p id="f555" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后我们将创建一个名为<strong class="is hj">receive response()</strong>的新方法来解析接收到的响应。这个函数将使用反射来遍历机器人可以响应的所有可能的消息类型。为了使用反射，我们将包括系统。用<code class="du lt lu lv lw b">using System.Reflection;</code>反射</p><figure class="kq kr ks kt fd ij"><div class="bz dy l di"><div class="ll lm l"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">带有响应解析器的NetworkManager.cs</figcaption></figure><p id="c1a0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，当我们点击发送按钮时，我们将收到从json字符串中提取的文本消息。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es lx"><img src="../Images/bccd810a126bf1d6e30b89bda3a9b697.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*15hB21-0zA7u3CuhoKPPeg.png"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">已经提取了响应中的文本</figcaption></figure><h2 id="e337" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">结论</h2><p id="470b" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">我们用Rasa创建了一个聊天机器人，并用Unity与它对话。</p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><p id="560a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在下一部分中，我们将研究如何创建一个简单的UI，用户可以通过它向机器人键入消息并查看响应。</p></div></div>    
</body>
</html>