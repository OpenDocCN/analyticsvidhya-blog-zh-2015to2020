<html>
<head>
<title>The hitchhiker’s guide to GTFS with python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用python编写的GTFS搭便车指南</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/the-hitchhikers-guide-to-gtfs-with-python-e9790090952a?source=collection_archive---------4-----------------------#2020-12-17">https://medium.com/analytics-vidhya/the-hitchhikers-guide-to-gtfs-with-python-e9790090952a?source=collection_archive---------4-----------------------#2020-12-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="ad01" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">别慌，只是公交数据</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/504f2a6e9a7ba22f83ca85cf1cdcb06d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MGFJBjFreS3En7DZnTlCSQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">最初，GTFS标准是由谷歌创建的。这让很多人非常愤怒，并被广泛认为是一个糟糕的举动。</figcaption></figure><p id="8b64" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">自2004年发布以来,《通用公共交通供给规范》( GTFS)彻底改变了我们处理公共交通数据的方式。它定义了公共交通时刻表和相关地理信息的通用格式。GTFS提要由一系列收集在ZIP文件中的文本文件组成。每个文件都模拟了交通信息的一个特定方面:<a class="ae kj" href="https://developers.google.com/transit/gtfs/reference" rel="noopener ugc nofollow" target="_blank">站点、路线、行程和其他时间表数据</a>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es kk"><img src="../Images/237bf1a7697ea2c6ec62bc8b3ad99fe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*G41S529mkAw_Alyk0NgKXg.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">组成GTFS提要的txt强制和可选文件。</figcaption></figure><p id="eefc" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">GTFS feeds允许公共交通机构发布他们的交通数据，开发人员编写应用程序，以可互操作的方式使用这些数据。在<a class="ae kj" href="https://transitfeeds.com/" rel="noopener ugc nofollow" target="_blank">开放移动数据网站</a>上可以公开获得这些信息。</p><p id="8537" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hj">但是让我们面对它</strong>，如果你曾经处理过GTFS数据集，你就会知道<strong class="jp hj">总是会有</strong>缺失字段或跳过停靠点，这使得它很难投入实际使用。</p><p id="874f" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">正因为如此，我们可以使用各种编程语言的许多模块来纠正错误、填补空白，并为您当地交通机构的破损GTFS数据集生成缺失文件。</p><p id="b1c7" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我最近承担了为许多transit feeds做这件事的任务，并想与世界分享我所学到的东西。因此，无论您是尝试在OpenTripPlanner中获取路径、构建自己的GTFS还是仅仅运行公共交通分析，这里都有一些python中的脚本可供您增强数据集。</p><p id="6bc0" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在本文中，我们将讨论GTFS订阅源中最常见的一些问题，例如:</p><ol class=""><li id="2c7e" class="kl km hi jp b jq jr jt ju jw kn ka ko ke kp ki kq kr ks kt bi translated">验证和查找GTFS提要中的错误</li><li id="e359" class="kl km hi jp b jq ku jt kv jw kw ka kx ke ky ki kq kr ks kt bi translated">从头开始创建shapes.txt文件</li><li id="a8f6" class="kl km hi jp b jq ku jt kv jw kw ka kx ke ky ki kq kr ks kt bi translated">插值空白停止时间</li><li id="141d" class="kl km hi jp b jq ku jt kv jw kw ka kx ke ky ki kq kr ks kt bi translated">将两个GTFS馈送合并在一起</li><li id="ae5e" class="kl km hi jp b jq ku jt kv jw kw ka kx ke ky ki kq kr ks kt bi translated">向routes.txt文件中的线条添加颜色</li><li id="1d80" class="kl km hi jp b jq ku jt kv jw kw ka kx ke ky ki kq kr ks kt bi translated">构建和修改calendar.txt文件</li><li id="507c" class="kl km hi jp b jq ku jt kv jw kw ka kx ke ky ki kq kr ks kt bi translated">直观检查地图中的结果</li></ol></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><h1 id="d46b" class="lg lh hi bd li lj lk ll lm ln lo lp lq io lr ip ls ir lt is lu iu lv iv lw lx bi translated"><em class="ly">了解GTFS的最新动态</em></h1><p id="85f9" class="pw-post-body-paragraph jn jo hi jp b jq lz ij js jt ma im jv jw mb jy jz ka mc kc kd ke md kg kh ki hb bi translated">有一些工具可以很好地识别GTFS提要的问题。最受欢迎的两个是<a class="ae kj" href="https://static-gtfs-manager.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> WRI城市的GTFS经理</a>和<a class="ae kj" href="https://developers.google.com/transit/gtfs/guides/tools" rel="noopener ugc nofollow" target="_blank">谷歌的提要验证器</a>。这些接口的问题是很难记录和复制对提要所做的更改，尽管它们的接口很棒。</p><p id="d22c" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">所以我们将使用名为<a class="ae kj" href="https://pypi.org/project/gtfs-kit/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp hj"> gtfs-kit </strong> </a>的python包。这个包拥有快速修复提要所需的所有功能，但最重要的是，它有一个<code class="du me mf mg mh b">.validate()</code>方法。此外，您还可以在Jupyter笔记本中使用它，让复制和与他人分享结果变得更加容易。</p><div class="mi mj ez fb mk ml"><a href="https://pypi.org/project/gtfs-kit/" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab dw"><div class="mn ab mo cl cj mp"><h2 class="bd hj fi z dy mq ea eb mr ed ef hh bi translated">gtfs套件</h2><div class="ms l"><h3 class="bd b fi z dy mq ea eb mr ed ef dx translated">GTFS工具包是一个Python 3.6+工具包，用于分析内存中的通用交通供给规范(GTFS)数据，而无需…</h3></div><div class="mt l"><p class="bd b fp z dy mq ea eb mr ed ef dx translated">pypi.org</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz jh ml"/></div></div></a></div><p id="5274" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这里有一个如何开始的快速示例。我们将使用来自巴西萨尔瓦多市的GTFS。它并不完全是参宿四，但是如果你考虑到宇宙的大小，也不会太远。在这个要点中，我们将导入gtfs-kit模块，声明压缩的gtfs提要的路径，用<code class="du me mf mg mh b">.read_feed()</code>函数读取它，然后验证它。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="na nb l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nc"><img src="../Images/f3a451ba60848454ec470ff4536d671a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rt9Eun-fiWZ70wWmZCVNaQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">输出应该像这样，告诉您在哪里寻找错误或不一致。</figcaption></figure><p id="0aff" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">该函数将警告我们的最常见错误之一是缺少<strong class="jp hj"> shapes.txt </strong>文件。从指定GTFS提要中每个文件的图表中，您会注意到这是少数几个具有空间信息的文件之一，但也是一个可选文件。对gtfs-kit来说不是。没有<strong class="jp hj"> <em class="nd"> shapes文件</em> </strong>这个工具就无法工作，所以我们将求助于所有<strong class="jp hj"> <em class="nd"> shapefiles </em> </strong>的<em class="nd">母舰</em>，Esri本身。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ne"><img src="../Images/b8c4693bd18c17fe66469843a9594ac7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_kElR9kaWdN6h99D0fQauA.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">Arthur Dent经常在清晨醒来，突然意识到他必须购买价值数千美元的ArcGIS Desktop许可。</figcaption></figure><h1 id="5d80" class="lg lh hi bd li lj nf ll lm ln ng lp lq io nh ip ls ir ni is lu iu nj iv lw lx bi translated">Arcpy，宇宙和一切</h1><p id="5bd3" class="pw-post-body-paragraph jn jo hi jp b jq lz ij js jt ma im jv jw mb jy jz ka mc kc kd ke md kg kh ki hb bi translated">ArcGIS平台是地理空间软件行业中的超级新星，在过去几年中受到了一些严重的打击。像Mapbox和Carto这样的平台正在快速发展，QGIS也越来越受欢迎。但是Esri有办法让我们回到ArcGIS。这一次，他们设法在ArcGIS Pro转换工具箱中加入了一个非常有用的工具箱，专门用于处理GTFS源。</p><p id="4b2b" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">其中一个工具是<a class="ae kj" href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/conversion/generate-shapes-features-from-gtfs.htm" rel="noopener ugc nofollow" target="_blank"> <strong class="jp hj">从GTFS </strong>生成形状</a>。此工具非常依赖于ArcGIS网络数据集来连接给定道路网络上的行程停靠点。</p><div class="mi mj ez fb mk ml"><a href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/conversion/generate-shapes-features-from-gtfs.htm" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab dw"><div class="mn ab mo cl cj mp"><h2 class="bd hj fi z dy mq ea eb mr ed ef hh bi translated">从GTFS生成形状要素(转换)</h2><div class="ms l"><h3 class="bd b fi z dy mq ea eb mr ed ef dx translated">生成公共交通系统中车辆行驶路径的估计。该工具的输出可以…</h3></div><div class="mt l"><p class="bd b fp z dy mq ea eb mr ed ef dx translated">pro.arcgis.com</p></div></div></div></a></div><p id="d837" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">要使用它，您需要一个没有shape.txt文件和道路网络空间数据的有效GTFS源。获取网络最简单的方法是使用<a class="ae kj" href="https://export.hotosm.org/en/v3/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp hj"> HOTOSM导出工具</strong> </a>进行OSM提取，然后从头开始创建和构建<a class="ae kj" href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/network-analyst/create-network-dataset.htm" rel="noopener ugc nofollow" target="_blank"> <strong class="jp hj">网络数据集</strong> </a>。准备好地理数据库后，您可以执行如下操作:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="na nb l"/></div></figure><p id="8c12" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">确保未选中出行模式“1-地铁”,这样该工具会将此模式的形状计算为直线，而不是地铁车辆在表面上行驶。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nk"><img src="../Images/b1e9635839cb78921ddbdbba71e3d49a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aiJHl7YxxnqhNCujdOrwgA@2x.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">在ArcGIS Pro中，结果将如下所示</figcaption></figure><h1 id="d3c1" class="lg lh hi bd li lj nf ll lm ln ng lp lq io nh ip ls ir ni is lu iu nj iv lw lx bi translated">时间是一种幻觉。停止时间加倍如此。</h1><p id="531c" class="pw-post-body-paragraph jn jo hi jp b jq lz ij js jt ma im jv jw mb jy jz ka mc kc kd ke md kg kh ki hb bi translated">除了ArcGIS中的GTFS本地工具，我们还可以使用GIS社区开发的脚本。这就是<a class="ae kj" href="https://github.com/Esri/public-transit-tools/tree/master/interpolate-blank-stop-times" rel="noopener ugc nofollow" target="_blank">插值空白停靠时间</a>工具的情况，这是一组python脚本，使用arcpy来估计只有初始出发时间和最终到达时间的行程中的停靠时间，这是GTFS数据集中一个非常常见的问题。例如，让我们使用<strong class="jp hj"> gtfs-kit </strong>模块来检查萨尔瓦多地铁系统1号线的行程。</p><p id="98b3" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">Gtfs-kit将每个txt文件分配给一个pandas数据帧，这非常实用。在这里，我们通过trip_id过滤stop_times数据帧(也就是说，从L1路线出发的一次单程旅行)，毫不奇怪，所有的中间站点都是空白的。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nl"><img src="../Images/98cb32f0dbb711c746a5b1ea37f777b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FTID9BxYnj76JjBKDPq6Cg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">只填写最初的出发时间和最终的到达时间。</figcaption></figure><p id="1461" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">使用这些脚本真的没有什么吸引力，所以我不会在这里包含要点，因为它们相当长。你可以在下面的资源库中找到我自己的Jupyter笔记本版本。只需在ArcGIS或python环境中使用arcpy运行它们。</p><div class="mi mj ez fb mk ml"><a href="https://github.com/guilhermeiablo/gtfswithpython/blob/main/NB2_EstimateStopTimes.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab dw"><div class="mn ab mo cl cj mp"><h2 class="bd hj fi z dy mq ea eb mr ed ef hh bi translated">guilhermeiablo/gtfswithpython</h2><div class="ms l"><h3 class="bd b fi z dy mq ea eb mr ed ef dx translated">Permalink GitHub是5000多万开发人员的家园，他们一起工作来托管和审查代码、管理项目以及…</h3></div><div class="mt l"><p class="bd b fp z dy mq ea eb mr ed ef dx translated">github.com</p></div></div><div class="mu l"><div class="nm l mw mx my mu mz jh ml"/></div></div></a></div><p id="8bf4" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">运行该脚本后，当我们检查完全相同的1号线地铁行程时，我们会发现所有的停靠时间都已被填入。不过，请对此有所保留，因为这是一个简单的线性插值，而不是将道路网络考虑在内的实际时间。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nn"><img src="../Images/079415578c7553a41f9d22369cfb279a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kGKNH2x3F4ljVD9mYbGt7g.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">现在所有的到达和离开时间都填好了。神奇！</figcaption></figure><h1 id="3c6d" class="lg lh hi bd li lj nf ll lm ln ng lp lq io nh ip ls ir ni is lu iu nj iv lw lx bi translated">Java。基本无害。</h1><p id="fcf8" class="pw-post-body-paragraph jn jo hi jp b jq lz ij js jt ma im jv jw mb jy jz ka mc kc kd ke md kg kh ki hb bi translated">既然我们已经使用arcpy增强了我们的GTFS feed，让我们回到gtfs-kit，看看它如何看待if。gtfs-kit模块会将我们的gtfs识别为有效，但仍会指出错误和警告。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es no"><img src="../Images/10df97d0471ca893ab1fca2b5b404c87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d1CiRl5nTWnDYeFu-OMEYg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">我希望会有一个错误42，所以我可以在这里做一个双关语。叹气。</figcaption></figure><p id="6080" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这完全没问题，但是当您发现自己必须一次验证多个提要时，这就变得棘手了。这并不罕见，因为许多运输机构向同一城市提供不止一个feed，按<strong class="jp hj">流域、运营商甚至运输模式</strong>划分。</p><p id="24d9" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">所以抓紧你的毛巾，因为我们将不得不从python绕道走<strong class="jp hj"> Java旁路</strong>。这是因为目前可用于合并两个或更多GTFS提要的最佳工具是Java独有的<a class="ae kj" href="http://developer.onebusaway.org/modules/onebusaway-gtfs-modules/current/onebusaway-gtfs-merge-cli.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jp hj"> onebusaway </strong> </a> gtfs模块。</p><div class="mi mj ez fb mk ml"><a href="http://developer.onebusaway.org/modules/onebusaway-gtfs-modules/current/onebusaway-gtfs-merge-cli.html" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab dw"><div class="mn ab mo cl cj mp"><h2 class="bd hj fi z dy mq ea eb mr ed ef hh bi translated">onebusaway-gtfs-modules - GTFS合并命令行应用程序</h2><div class="ms l"><h3 class="bd b fi z dy mq ea eb mr ed ef dx translated">注意:该工具正在开发中！该文档可能不是最新的。onebusaway-gtfs-merge-cli…</h3></div><div class="mt l"><p class="bd b fp z dy mq ea eb mr ed ef dx translated">developer.onebusaway.org</p></div></div></div></a></div><p id="916f" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">为了使用它，您需要安装Java 1.6运行时来运行客户端。一旦你有了，就把。jar文件和您想要合并到同一个文件夹中的两个GTFS提要，访问它并在您的终端窗口中运行如下内容:</p><blockquote class="np nq nr"><p id="9e42" class="jn jo nd jp b jq jr ij js jt ju im jv ns jx jy jz nt kb kc kd nu kf kg kh ki hb bi translated"><code class="du me mf mg mh b">java -jar onebusaway-gtfs-merge-cli.jar --duplicateDetection=fuzzy gtfs1.zip gtfs2.zip gtfsmerge.zip</code></p></blockquote><h2 id="c998" class="nv lh hi bd li nw nx ny lm nz oa ob lq jw oc od ls ka oe of lu ke og oh lw oi bi translated">一旦你按下回车键，就会有很多事情发生。</h2><p id="1790" class="pw-post-body-paragraph jn jo hi jp b jq lz ij js jt ma im jv jw mb jy jz ka mc kc kd ke md kg kh ki hb bi translated">gtfs-merge工具将做出类似于"<em class="nd">的决定，是否应该将两个非常接近的停靠点视为同一个停靠点？</em>"，"<em class="nd">ID相同的路由是否应视为重复？</em>”，以此类推。</p><p id="c701" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">好消息是:<strong class="jp hj">模糊重复检测</strong>选项确保了如果两个条目有共同的元素(例如，停靠点名称或位置、路线简称、行程停靠点序列)，那么它们被认为是相同的。这是更宽松的匹配政策，高度依赖于匹配的GTFS条目的类型。</p><h1 id="c995" class="lg lh hi bd li lj nf ll lm ln ng lp lq io nh ip ls ir ni is lu iu nj iv lw lx bi translated">好吧，怀斯盖先生…如果你这么聪明，你告诉我们它应该是什么颜色。</h1><p id="78d1" class="pw-post-body-paragraph jn jo hi jp b jq lz ij js jt ma im jv jw mb jy jz ka mc kc kd ke md kg kh ki hb bi translated">现在，我们已经有了一个单一的、功能性的GTFS提要，让我们来看看一些非常重要而又次要的细节。一个想到的是公交路线的颜色。世界上几乎每个运输机构都用特定的颜色来标识其路线。几乎每个人都懒得在他们的GTFS订阅中填写这些信息。让我们为此写一个脚本。</p><p id="f72b" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">GTFS以十六进制格式存储与路线相关的颜色。所以我们首先调用一个颜色选择器小部件来选择我们想要的颜色。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oj"><img src="../Images/0193c7319aacc136f383564c6bd76a6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KWJltA1xuqaVNvIjLS88ZA.png"/></div></div></figure><p id="67a7" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在你知道了你想要的颜色的正确代码，你需要做的就是将正确的过滤器应用到你的路线数据帧。在下面的例子中，我们将根据路线名称、代理ID和路线类型进行过滤。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="na nb l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">不要忘记不要包含十六进制代码中的#号。</figcaption></figure><p id="e5c1" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这将反映在路由软件上，如OpenTripPlanner。这里你可以看到，当线路1是旅程的一部分时，它实际上显示为红色。我们还可以选择将text_color字段更改为白色，并在主色和叠加文本之间进行更好的对比。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ok"><img src="../Images/c1734720a472270c9dd4c3666e345875.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EGiBJ3hUgjM0_lQF928njw.png"/></div></div></figure><h1 id="02bd" class="lg lh hi bd li lj nf ll lm ln ng lp lq io nh ip ls ir ni is lu iu nj iv lw lx bi translated">任何事情都会发生。不过，它不一定按照时间顺序来做。</h1><p id="f631" class="pw-post-body-paragraph jn jo hi jp b jq lz ij js jt ma im jv jw mb jy jz ka mc kc kd ke md kg kh ki hb bi translated">可能是因为<strong class="jp hj"> gtfs-kit </strong>对结果很满意，看不到更多的错误，但是如果您碰巧正在考虑使用GTFS feed来生成使用<a class="ae kj" href="https://www.opentripplanner.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp hj"> OpenTripPlanner </strong> </a>的路线，那么您的feed会有一个更加挑剔的客户。</p><p id="bb12" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">OpenTripPlanner——如果你不知道这是什么，可以把它看作一个可以安装在你的机器上的开源google maps routing api不会为没有日历的旅行生成旅行。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ol"><img src="../Images/e8728cabd54ae19c2b47653d4f0d307e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*WAa0cje7EW2P8D2z6roj9w.gif"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">阿瑟·登特，等到你不得不决定一条公共汽车路线是否在星期天运行的时候。</figcaption></figure><p id="c8b1" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">也就是说，所有的旅行都应该在calendar.txt文件中，说明一周中的<strong class="jp hj">天</strong>这些特定的停止时间是有效的。例如，这有助于区分在周末特定时间运行的公共汽车。</p><p id="bb26" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">因此，要创建一个日历文件，我们将使用trips数据帧作为基础，因为我们需要所有的trips IDs，然后删除不必要的字段并添加强制字段。你可以通过查看谷歌的GTFS参考页面找到哪些是哪些。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="na nb l"/></div></figure><h1 id="1d0a" class="lg lh hi bd li lj nf ll lm ln ng lp lq io nh ip ls ir ni is lu iu nj iv lw lx bi translated">终极答案</h1><p id="089c" class="pw-post-body-paragraph jn jo hi jp b jq lz ij js jt ma im jv jw mb jy jz ka mc kc kd ke md kg kh ki hb bi translated">改变颜色并将日历数据框添加到我们的提要中只是使用<strong class="jp hj"> gtfs-kit </strong>所能做的事情的冰山一角。如果您决定使用它，您必须对一些字段进行微小的修改，删除重复的条目，等等。在这个过程中，您可能希望使用模块的映射功能来检查您的停留和行程是否有意义。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="na nb l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es om"><img src="../Images/c4dabddd2891e27d0ed4877182c87608.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qf6wQ1tOMh7DfrgCgMLViA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">map_routes()函数的输出将在您的笔记本中创建一个传单地图。</figcaption></figure><h1 id="ada7" class="lg lh hi bd li lj nf ll lm ln ng lp lq io nh ip ls ir ni is lu iu nj iv lw lx bi translated">再见，谢谢所有的鱼</h1><p id="a33b" class="pw-post-body-paragraph jn jo hi jp b jq lz ij js jt ma im jv jw mb jy jz ka mc kc kd ke md kg kh ki hb bi translated">这一块就到此为止！我们已经用python成功地丰富和清理了一个GTFS feed，我们可以在未来复制这种方式。你可以在我的Github页面找到整个工作流程。如果你有问题或建议，不要犹豫，随时给我写信！</p><p id="bb38" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">另外，如果你喜欢这篇文章，考虑给我买一杯咖啡，这样我会继续写更多这样的文章！</p><div class="mi mj ez fb mk ml"><a href="https://www.buymeacoffee.com/guilhermeiablo" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab dw"><div class="mn ab mo cl cj mp"><h2 class="bd hj fi z dy mq ea eb mr ed ef hh bi translated">古伊列梅·亚布洛诺夫斯基正在传播空间数据科学</h2><div class="ms l"><h3 class="bd b fi z dy mq ea eb mr ed ef dx translated">嘿👋我刚刚在这里创建了一个页面。你现在可以给我买杯咖啡了！</h3></div><div class="mt l"><p class="bd b fp z dy mq ea eb mr ed ef dx translated">www.buymeacoffee.com</p></div></div><div class="mu l"><div class="on l mw mx my mu mz jh ml"/></div></div></a></div><div class="mi mj ez fb mk ml"><a href="https://github.com/guilhermeiablo/gtfswithpython" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab dw"><div class="mn ab mo cl cj mp"><h2 class="bd hj fi z dy mq ea eb mr ed ef hh bi translated">guilhermeiablo/gtfswithpython</h2><div class="ms l"><h3 class="bd b fi z dy mq ea eb mr ed ef dx translated">清理和增强GTFS feeds的python脚本集GitHub是5000多万开发者的家园，他们一起工作…</h3></div><div class="mt l"><p class="bd b fp z dy mq ea eb mr ed ef dx translated">github.com</p></div></div><div class="mu l"><div class="oo l mw mx my mu mz jh ml"/></div></div></a></div><div class="mi mj ez fb mk ml"><a href="https://www.linkedin.com/in/guilhermeiablo/" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab dw"><div class="mn ab mo cl cj mp"><h2 class="bd hj fi z dy mq ea eb mr ed ef hh bi translated">古伊列梅·亚布洛诺夫斯基-地理空间数据科学家…</h2><div class="ms l"><h3 class="bd b fi z dy mq ea eb mr ed ef dx translated">我对如何重新利用专注于领域的学科的技术和论述充满热情…</h3></div><div class="mt l"><p class="bd b fp z dy mq ea eb mr ed ef dx translated">www.linkedin.com</p></div></div><div class="mu l"><div class="op l mw mx my mu mz jh ml"/></div></div></a></div><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="oq nb l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">我打赌你已经预见到了。</figcaption></figure></div></div>    
</body>
</html>