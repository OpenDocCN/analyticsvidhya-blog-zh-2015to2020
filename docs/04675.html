<html>
<head>
<title>How Google Colab helped me to speed up my video processing tasks while working in remote and had no GPU.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google Colab如何帮助我在远程工作且没有GPU的情况下加快视频处理任务的速度。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-google-colab-helped-me-to-speed-up-my-video-processing-tasks-during-quarantine-62641dc3b325?source=collection_archive---------12-----------------------#2020-03-28">https://medium.com/analytics-vidhya/how-google-colab-helped-me-to-speed-up-my-video-processing-tasks-during-quarantine-62641dc3b325?source=collection_archive---------12-----------------------#2020-03-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/878d5db1420f9af26d97bfefb085632d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0kMQZ23fqfzna2K_yFwuVg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://unsplash.com/@rajeshwerbatchu7?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">拉杰什瓦尔·巴楚</a>在<a class="ae iu" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="54cd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在今天的帖子中，我想向你展示我们如何简单地在google colab上运行人脸检测程序。</p><h1 id="10f1" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">动机</strong></h1><p id="5fde" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">几天前，我国许多公司(包括我的公司)决定对员工采用远程工作政策，以减少他们对冠状病毒感染的担忧。嗯，远程工作确实很棒，但对我来说也有一些缺点:</p><ul class=""><li id="10cc" class="kw kx hi ix b iy iz jc jd jg ky jk kz jo la js lb lc ld le bi translated">许多人呆在家里，当然也使用他们的电话互联网(主要是Instagram)。我通过笔记本电脑上的hotspot分享我的手机数据(你已经猜到接下来会发生什么了！).所以我经常忍受工作中的滞后和脱节。我现在真的很怀念办公室的免费快速上网！</li><li id="469f" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">我的工作是处理视频和预训练网络，它们都很重，每个都超过300 MB。我经常需要从我公司的服务器上下载或上传视频来检查我的视频结果。通过VPN连接将文件传输到办公室(通常带宽较低)给服务器带来了很大压力(这也增加了我同事连接的延迟)。</li><li id="ce07" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">最后也是最重要的，我有一台没有GPU计算支持的笔记本电脑(这是最痛苦的情况！).我不得不等了很久(真的！)对于pytorch/tensorflow/keras/…中的我的模型，来训练或准备输出视频。</li></ul><p id="e38e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以我必须想办法解决这些问题。在<a class="ae iu" href="https://stackoverflow.com/questions/60703371/how-to-be-able-to-import-every-file-in-a-folder-in-google-drive" rel="noopener ugc nofollow" target="_blank">这里</a>我在stackoverflow上问了一个问题后，突然想到用google colab。它为我提供了以下优势:</p><ul class=""><li id="6561" class="kw kx hi ix b iy iz jc jd jg ky jk kz jo la js lb lc ld le bi translated">无需在本地机器上下载大量文件。也可以在虚拟机上完成。它还提供了显示在线视频结果的工具。</li><li id="c069" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">没有互联网和快速下载/上传的限制(我可以使用<code class="du lk ll lm ln b">wget</code>命令从任何链接获取任何文件)。</li><li id="c5d2" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">也可以在多个驱动器中存储多个数据集。每当我想处理特定数据集时，我可以挂载任何驱动器。</li><li id="7157" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">当然，谷歌提供的GPU或TPU是使用这项服务的最重要原因。(爱你谷歌！)</li></ul><p id="482e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是为着急的人准备的<a class="ae iu" href="https://github.com/masouduut94/Pytorch_Retinaface" rel="noopener ugc nofollow" target="_blank"> github库</a>。我将教程分为7部分，并为每一部分提供了教程gif。</p><h1 id="14d7" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak"> 1)第一步:创建Colab文件</strong></h1><p id="7816" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">在你的google drive中创建一个文件夹，命名为“face_detection”。然后在google drive中安装google colaboratory后，右键单击google drive并选择创建新的google colaboratory文件，该文件与系统上的jupyter笔记本文件具有相同的文件扩展名。然后将文件重命名为face_detection。</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/9762aa237154d4fa74d982be920c61cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Yw9DgAnV9OeCulZ1THY3bg.gif"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">创建google协作文件</figcaption></figure><h1 id="7733" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">第二步:设置运行时类型</strong></h1><p id="5c7b" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">现在，您必须单击runtime选项卡并选择change runtime type。选择GPU或TPU来加速进程。</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/9204aa3906399e695d6a6938e5fcc6eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*nRa77dASlTEgnMAE-NPJjg.gif"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">将运行时类型更改为GPU</figcaption></figure><h1 id="4a69" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">第三步:安装谷歌硬盘</strong></h1><p id="b90b" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">为了能够安装google drive，我们使用以下代码(<a class="ae iu" href="https://stackoverflow.com/questions/60703371/how-to-be-able-to-import-every-file-in-a-folder-in-google-drive/60706508" rel="noopener ugc nofollow" target="_blank">参考</a>):</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/28b292b3f2e6bf34a85a3cc4560b416b.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*LsB844qM_Gyy5xEfUZjAWA.png"/></div></figure><p id="9ff7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，google处理认证步骤并安装驱动器。现在您可以将目录更改为<code class="du lk ll lm ln b">face_recognition</code>目录。</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div class="er es lu"><img src="../Images/6ecdf9cf9137738394865e697ff535c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/1*er5pu5Ed3irMb-lM6DPf6w.png"/></div></figure><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/46fd19feceb0a11f4fb23d05d1d772cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*nm_4YUypfYS3DUUd187Bug.gif"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">安装google drive</figcaption></figure><h1 id="686d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">第四步:克隆人脸检测库</strong></h1><p id="8c75" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">是时候克隆你的项目来驱动了。在我的例子中，我使用我的<code class="du lk ll lm ln b">RetinaFace</code>库，它是一个快速且极其精确的人脸检测程序。你可以在这个<a class="ae iu" href="https://github.com/masouduut94/Pytorch_Retinaface" rel="noopener ugc nofollow" target="_blank">链接</a>里找到。</p><p id="1aa2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用此命令克隆存储库。如您所知，在jupyter笔记本中，可以通过在命令开头使用<code class="du lk ll lm ln b">!</code>来使用终端命令:</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div class="er es lv"><img src="../Images/943ded7829255a429b0dfd6db4a46920.png" data-original-src="https://miro.medium.com/v2/resize:fit:1094/format:webp/1*4qDlm-79rzdrWuPTEaJh0Q.png"/></div></figure><p id="2ab6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后我用这个命令进行了一点文件夹管理。我只是将<code class="du lk ll lm ln b">Pytorch_Retinaface</code>目录中的每个文件移动到它的父目录中，然后删除它。</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div class="er es lw"><img src="../Images/ae45d4360cbd4dd58a94eb4ef45f3464.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/1*4hMncc-natv8AvjDx_aS4A.png"/></div></figure><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/352ae6dcd0ff594a95c218b5f9a5e21f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*wmpJLgvU-WDBYkxiluxaPQ.gif"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">克隆retinanet人脸检测库</figcaption></figure><h1 id="6731" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">第五步:从另一个google drive获取预训练的重量。</strong></h1><p id="4319" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">现在正如在<a class="ae iu" href="https://github.com/masouduut94/Pytorch_Retinaface" rel="noopener ugc nofollow" target="_blank"> github库</a> readme文件中提到的，我们必须得到预训练的模型来运行程序并得到合理的结果。我们打开链接，右击名为<code class="du lk ll lm ln b">Resnet_50_Final.pth </code>的文件，将文件添加到<code class="du lk ll lm ln b">My Drive/face_detection/weight </code>目录。对我来说，这里最酷的事情是不需要用终端下载、上传和额外的拷贝粘贴，只需点击几下就可以完成。这与我在办公室的日常工作正好相反，我不得不花很长时间来下载大文件。<br/>查看以下gif文件，获取视觉指南。</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/4dc3fc106c59218185bca19894e67715.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*wkVsj5-F1tjHFuN6Kcw4Kg.gif"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">从链接中获取预训练的模型权重，并将其添加到我们的项目文件夹权重中。</figcaption></figure><h1 id="4f70" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">步骤6:获取运行算法的视频(如有必要)</strong></h1><p id="bd3a" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">你可以使用<code class="du lk ll lm ln b">wget </code>方法来获得你的测试文件。我在Coverr.com找到了视频文件，并把链接复制粘贴到了笔记本上。然后使用下面的代码下载视频:</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div class="er es lx"><img src="../Images/e03f90bc5c7879267d7dca457e5e66a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*868iG8HKTLCm9hGZ5lDwbw.png"/></div></figure><p id="23d6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我当然装不下这个环节。现在，我使用下面的代码准备上传文件夹中的输入视频，并删除多余的文件:</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div class="er es ly"><img src="../Images/9e49ffa5a88cfa7b08097d81b92ca1a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:702/format:webp/1*OUQAeofnpqr0ArIWWrDllw.png"/></div></figure><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/b17dbeb09b0df7e48bc80645e63cb743.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2qBSVTCVi6e-qplFmyHa0g.gif"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">为人脸识别过程设置视频文件</figcaption></figure><h1 id="0fd7" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">第7步:运行face_detection_server.py文件</h1><p id="c0ed" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">最后一部分是运行此命令来启动人脸检测的视频处理:</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/c576c1bb1470ab8e549371b919244b43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*JSeGFFC4axjiQn0a-bo5jg.png"/></div></figure><p id="dd02" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">出于项目目的，还可以调整其他参数，但是这里我们需要的只是输入文件夹。处理后，输出文件将保存在公共目录中。</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/aae18d184fe3547e1998f2ba58d2df1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*--SiPa3iI16WeGTkuCBAKA.gif"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">检查输出结果</figcaption></figure><p id="adf7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，我真的希望这些提示和技巧对你有用，特别是如果你是远程做机器学习项目的另一个受害者。<br/>当我享受远程编码的时候，我意识到远程工作还有另一个缺点，那就是你如何找到做饭的方法(再也没有办公餐了！).不幸的是，谷歌没有烹饪在线食物的API！</p></div></div>    
</body>
</html>