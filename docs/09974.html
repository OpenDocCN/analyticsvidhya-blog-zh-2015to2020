<html>
<head>
<title>Config Files and Logging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">配置文件和日志记录</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/config-files-and-logging-a7b4cc377fd5?source=collection_archive---------14-----------------------#2020-09-28">https://medium.com/analytics-vidhya/config-files-and-logging-a7b4cc377fd5?source=collection_archive---------14-----------------------#2020-09-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3c0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大多数用 Python 编码的数据科学家都习惯使用 Jupyter Notebook。大多数数据科学家缺乏的最基本技能之一是编写生产就绪代码。</p><p id="d65a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于 Jupyter Notebook 提供了一个无缝的 IDE 来检查变量并在代码下方显示打印语句，数据科学家发现编写生产脚本很困难。一个生产就绪脚本应该是<em class="jd">通用的</em>和<em class="jd">在一个文件中写调试或错误语句。</em></p><p id="0d1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">什么是通用代码？</em>代码应该具有最小的硬编码。如果环境变量有任何变化，如输入文件夹已移动、DB 模式(在多租户配置的情况下)已更改等，则不应更改程序。这种环境变量应该从配置文件(或简称为<em class="jd">配置文件</em>)中读取，无需修改代码和重新部署代码即可更改。</p><p id="6e79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">为什么将消息写入日志文件很重要？</em>程序/脚本结束后，控制台中使用<code class="du je jf jg jh b">print()</code>语句输出的任何消息都不可用于调试。因此，开发人员更喜欢将消息记录在 a 文件中，以便在程序异常终止时可以参考。</p><h1 id="6b14" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">配置文件—使代码通用化</h1><p id="d938" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">确保硬编码最少的方法之一是使用配置文件。配置文件用于保存与数据库连接、日志文件位置和其他环境变量相关的配置值。<code class="du je jf jg jh b">configparser</code>用于读取配置文件。配置文件包含配置值部分。下面是一个配置文件的例子。该文件在服务器中保存为 config.ini。</p><figure class="kl km kn ko fd kp"><div class="bz dy l di"><div class="kq kr l"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">配置文件</figcaption></figure><p id="a81c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du je jf jg jh b">[Logger]</code>是该节的名称。该段有三种配置— <code class="du je jf jg jh b">folder</code>、<code class="du je jf jg jh b">file</code>和<code class="du je jf jg jh b">level</code>。我们将在下一节讨论日志记录时讨论这些配置。</p><p id="8209" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">读取配置文件的第一步是导入<code class="du je jf jg jh b">configparser</code>包。</p><figure class="kl km kn ko fd kp"><div class="bz dy l di"><div class="kq kr l"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">正在导入 ConfigParser</figcaption></figure><p id="f267" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来调用函数来读取配置</p><figure class="kl km kn ko fd kp"><div class="bz dy l di"><div class="kq kr l"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">在读取配置文件之前</figcaption></figure><p id="6df4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">需要完成的最少的硬编码是配置文件所在的文件夹、配置文件的名称和配置文件中所有必要配置所在的部分。<code class="du je jf jg jh b">MASTER_FOLDER</code>是存储配置文件的文件夹。<code class="du je jf jg jh b">MASTER_FILE</code>的值为<code class="du je jf jg jh b">config.ini</code>，这是配置文件的名称。<code class="du je jf jg jh b">LOGGER_SECTION</code>的值为<code class="du je jf jg jh b">Logger</code>，该值将用于查找配置。<code class="du je jf jg jh b">Logger</code>是指<code class="du je jf jg jh b">config.ini</code>文件中的<code class="du je jf jg jh b">[Logger]</code>。<code class="du je jf jg jh b">read_config</code>功能读取文件和配置。</p><figure class="kl km kn ko fd kp"><div class="bz dy l di"><div class="kq kr l"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">读取配置文件的函数</figcaption></figure><p id="e0a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个函数中，创建了一个解析器对象，用于读取配置文件。该部分的详细内容在<code class="du je jf jg jh b">section_details</code>字典中有所了解。这个字典是从函数返回的。<code class="du je jf jg jh b">main</code>中的<code class="du je jf jg jh b">logger_details</code>存储所有配置的详细信息。<code class="du je jf jg jh b">logger_details</code>将在下一节中用到。</p><h1 id="8544" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">日志记录—调试的必备工具</h1><p id="4456" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">在上一节中，我们已经阅读了配置文件并将配置存储在字典中。在本节中，我们将使用这个字典来记录消息。将消息记录在文件中对于在程序被执行并从内存中清除后查看消息是非常重要的。有 5 种类型的日志消息—调试、信息、警告、错误和严重。这些级别的严重程度依次递增。</p><p id="5ded" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">调试</strong> —与诊断代码中的问题相关的消息。这些通常是放在 Jupyter 笔记本上的<code class="du je jf jg jh b">print</code>陈述。</p><p id="5067" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">信息</strong> —这些是与代码进度相关的消息。</p><p id="7d0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">警告</strong>—这些警告消息可能会带来潜在的未来问题。例如，当 RAM 达到阈值时，会记录一条警告消息。</p><p id="7c53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">错误</strong>——这些是代码中严重的 bug。它可能是任何异常，如内存不足错误。通常程序会在记录错误信息后终止。</p><p id="d5a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">关键</strong> —这些是代码中的关键问题，由于这些问题，程序可能会突然终止或停止运行。</p><p id="86ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些严重性级别的值将在本文后面提到。</p><p id="7d37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Python 包<code class="du je jf jg jh b">logging</code>用于在文件中记录消息。首先要做的是导入包。</p><figure class="kl km kn ko fd kp"><div class="bz dy l di"><div class="kq kr l"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">正在导入日志包</figcaption></figure><p id="6be7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导入包后，应该设置日志记录的基本配置，以提及将在其中创建日志的文件。如果未设置此基本配置，则日志记录将仅在控制台中进行。我们将在读取<code class="du je jf jg jh b">config.ini</code>文件后，从<code class="du je jf jg jh b">main</code>调用一个方法来设置与登录相关的基本配置。<code class="du je jf jg jh b">main</code>的代码如下。您应该已经看到了上一节中的大部分代码。代码的最后一行与调用函数来设置日志记录的基本配置有关。</p><figure class="kl km kn ko fd kp"><div class="bz dy l di"><div class="kq kr l"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">调用函数来设置日志记录配置</figcaption></figure><p id="15b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du je jf jg jh b">set_logging_basics</code>不返回任何值及其目的 id 来设置仅用于日志记录的基本配置。因为这个函数设置了环境，所以它不返回任何值。先前读取的<code class="du je jf jg jh b">logger_details</code>被传递给该函数。<code class="du je jf jg jh b">logger_details</code>是一个字典，包含我们将进一步讨论的配置细节。</p><figure class="kl km kn ko fd kp"><div class="bz dy l di"><div class="kq kr l"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">用于为日志记录设置基本配置的功能</figcaption></figure><p id="5312" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个函数中，我们到目前为止讨论过的所有内容都聚集在一起。首先，我们读取字典值，并将它们存储在不同的变量中。如果参考文章顶部提到的<code class="du je jf jg jh b">config.ini</code>文件，你就会明白<code class="du je jf jg jh b">folder</code> = <code class="du je jf jg jh b">C:\Logs\</code>、<code class="du je jf jg jh b">file</code> = <code class="du je jf jg jh b">application.log</code>和<code class="du je jf jg jh b">level</code> = <code class="du je jf jg jh b">DEBUG</code>。所有这些变量都用于通过调用<code class="du je jf jg jh b">basicConfig</code>方法来设置记录的基本配置。</p><p id="3ab9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<code class="du je jf jg jh b">logging.basicConfig</code>中，第一个参数是<code class="du je jf jg jh b">filename</code>，它是消息将被写入的文件的路径。第二个参数<code class="du je jf jg jh b">filemode</code>指定文件应该以哪种模式打开。我已经提到过<code class="du je jf jg jh b">filemode='w' </code>，这意味着文件将以写模式打开，程序每次运行时消息都将被覆盖。</p><p id="847a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du je jf jg jh b">format</code>指定消息写入文件的方式。首先，将写入用于记录呼叫的记录器的名称。之后是消息级别(<code class="du je jf jg jh b">INFO</code>、<code class="du je jf jg jh b">DEBUG</code>等)。)将被写入，后跟开发人员指定的消息。当我们很快记录下这个消息时，事情就会变得清楚了。</p><p id="cd32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du je jf jg jh b">level</code>参数指定了最低级别的严重性。更多关于<code class="du je jf jg jh b">level</code>稍后。</p><p id="ac9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦设置了这些基本配置，消息将被写入<code class="du je jf jg jh b">C:\Logs\application.log</code>文件。消息将被记录如下</p><figure class="kl km kn ko fd kp"><div class="bz dy l di"><div class="kq kr l"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">如何使用日志模块记录消息</figcaption></figure><p id="e1ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">application.log 文件看起来像这样—</p><figure class="kl km kn ko fd kp"><div class="bz dy l di"><div class="kq kr l"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">日志文件</figcaption></figure><p id="570b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些记录的消息有助于开发人员在出现错误时调试代码，并跟踪代码的进度。</p><p id="a463" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">关于</strong> <code class="du je jf jg jh b"><strong class="ih hj">logging.basicConfig</strong></code> <strong class="ih hj"> — </strong>中 <code class="du je jf jg jh b"><strong class="ih hj">level</strong></code> <strong class="ih hj">的说明</strong></p><p id="4886" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du je jf jg jh b">level</code>参数指定最低的严重性级别。请记住，按照严重程度递增的顺序，这些级别是—</p><p id="6d1b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">调试&lt;信息&lt;警告&lt;错误&lt;严重</strong></p><p id="d03f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果<code class="du je jf jg jh b">level</code>中的值是<code class="du je jf jg jh b">INFO</code>，那么只有严重性大于或等于<code class="du je jf jg jh b">INFO</code>的消息才会被记录。这意味着任何具有调试级别的消息都不会被记录。另一个例子——如果<code class="du je jf jg jh b">level</code>中的值是 ERROR，那么只有 ERROR 和 CRITICAL 消息会被记录，其他所有消息都不会被记录。在<code class="du je jf jg jh b">config.ini</code>文件中，我使用了<code class="du je jf jg jh b">level</code> = <code class="du je jf jg jh b">DEBUG</code>暗示所有类型的消息都将被记录到日志文件中。</p><h1 id="eb5b" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">结论</h1><p id="a00e" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">不仅是数据科学家，每个开发人员都应该知道如何编写通用代码，并在出现任何问题时调试代码。使用配置文件和记录器是用于减少硬编码和记录消息的工具。每个开发人员都必须知道如何使用它们。</p></div></div>    
</body>
</html>