<html>
<head>
<title>Predicting King County House Prices with Multiple Linear Regression</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用多元线性回归预测金县房价</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/predicting-king-county-house-prices-with-multiple-linear-regression-84de5feeafb2?source=collection_archive---------2-----------------------#2020-08-29">https://medium.com/analytics-vidhya/predicting-king-county-house-prices-with-multiple-linear-regression-84de5feeafb2?source=collection_archive---------2-----------------------#2020-08-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e4edbf62ce1284339eff1aed981dc846.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2JH6KI618VkX3G11vf8cGg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由马克西米利安·康纳奇拍摄</figcaption></figure><h1 id="04f3" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">介绍</h1><p id="3c18" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated"><a class="ae iu" href="https://www.kaggle.com/harlfoxem/housesalesprediction" rel="noopener ugc nofollow" target="_blank"> <strong class="jv hj">金县房屋数据集</strong> </a>包含大量关于华盛顿州金县房屋的价格、大小、位置、状况和各种其他特征的信息。在本文中，我将展示如何用Python构建多元线性回归模型来预测房价。</p><p id="1905" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><a class="ae iu" href="https://gist.github.com/AvonleaFisher/e29ecbe25ec7a7a48d4ee4e1f77ecd9c" rel="noopener ugc nofollow" target="_blank"> <strong class="jv hj">这里的</strong> </a> <strong class="jv hj"> </strong>是我在这个分析中使用的模块的完整列表。下面嵌入的代码中包含了许多，但不是全部。您可能会发现有些变量名不明确，所以下面是对每个变量名的简要描述:</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kw"><img src="../Images/5a3495f83773c0849fca1265cb42a65c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tfBY7bRc6ttOaBmUX4RVyg.png"/></div></div></figure><p id="b1df" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">首先，我将数据读入pandas dataframe并运行df.info()来了解形状、列和数据类型。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/f9fa074ef5b17916410ba43e7c6caea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MDabYfDSiXTbaVkif9WfoQ.png"/></div></div></figure><p id="47e3" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">我们可以看到这是一个大型数据集，包含21，000多个条目和20个列。几乎所有的列都包含数值数据，方便线性回归！</p><h1 id="1814" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">缺少值</h1><p id="a9e9" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">接下来，我查看了每一列中缺失值的比例。</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lc ld l"/></div></figure><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es le"><img src="../Images/43424a1f23226ed80b7d614c8b191e82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*GbO6VOZFgvkVetfNC8pMYQ.png"/></div></figure><p id="8116" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">接下来，我查看了有缺失值的3个变量的值计数。由于缺少值的比例很高，我决定删除“yr _ renovated”，用0填充“water front”NAs(它与列中的大多数其他值匹配，表示“no waterfront”)，并用列的平均值填充少量缺少的“view”值。</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lc ld l"/></div></figure><h1 id="15cb" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">极端值</h1><p id="4e30" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">为了排除可能不是独户住宅的建筑，我使用以下代码格式检查了卧室和浴室列中的异常值:</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="de23" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">浴室的异常值是187，卧室是47(不包括重叠)。上面的代码将任何偏离平均值超过3个标准偏差的值视为异常值，并删除所有包含异常值的行。</p><h1 id="522f" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">一键编码</h1><p id="546e" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">数据集中有一个变量，我们预计它与价格高度相关，但没有明确的线性关系:条件。该列的<a class="ae iu" href="https://info.kingcounty.gov/assessor/esales/Glossary.aspx?type=r" rel="noopener ugc nofollow" target="_blank"> <strong class="jv hj">值描述</strong> </a> <strong class="jv hj"> </strong>表示该列以1-5的线性标度进行编码，1表示“差”，5表示“非常好”</p><p id="093d" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">有趣的是，下面的散点图显示，就价格而言,“普通”房屋往往表现最佳:</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lf"><img src="../Images/2a20403e5444247faf9ab7e934f133fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jZvr-evTZHRvvRFtRYHPBQ.png"/></div></div></figure><p id="e4c7" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">这可能是因为条件值与年龄和等级(指建筑的设计/质量，而不是建筑的实用性/功能性)相关。一座新的、设计优秀的、非常昂贵的建筑，如果需要一些功能性维修，可以被评为“一般”状况。正如我们在下面的散点图中所看到的，条件一般的房子往往也有最高的评级。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lg"><img src="../Images/2a006fe50b7f5d2ff2b20d8531fdf5aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xrfWkRvYXOIWHFuh72QPWQ.png"/></div></div></figure><p id="3dfb" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">价格和特定条件值之间可能存在更清晰的线性关系，我们可以通过对变量进行一次性编码来更有效地探索这种关系。以下代码为每个条件值创建一个虚拟变量，删除第一个值以避免<a class="ae iu" href="https://stattrek.com/multiple-regression/dummy-variables.aspx" rel="noopener ugc nofollow" target="_blank"> <strong class="jv hj">虚拟变量陷阱</strong> </a>，删除原始列，并将新变量连接到数据框。</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="5ad0" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">现在，我们可以在散点图上可视化每个条件评级和房价之间的关系。值为1表示房屋具有对应于每一列的条件评级，而值为0表示不具有:</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/e744fb27b7194ab8b864cb6d0b1d1a6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SifkNuci3kMe0VqbIPmnzg.png"/></div></div></figure><p id="be07" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">现在，每一列都有线性关系，条件等级2和3具有最显著的关系。</p><h1 id="379c" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">多重线性回归假设</h1><p id="8124" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">作为多元线性回归分析过程的一部分，必须检查四个假设:</p><ul class=""><li id="7c47" class="li lj hi jv b jw kr ka ks ke lk ki ll km lm kq ln lo lp lq bi translated"><strong class="jv hj">无多重共线性</strong></li><li id="74d5" class="li lj hi jv b jw lr ka ls ke lt ki lu km lv kq ln lo lp lq bi translated"><strong class="jv hj">解释变量和响应变量之间的线性关系</strong></li><li id="fa74" class="li lj hi jv b jw lr ka ls ke lt ki lu km lv kq ln lo lp lq bi translated"><strong class="jv hj">误差项的同方差</strong></li><li id="cf74" class="li lj hi jv b jw lr ka ls ke lt ki lu km lv kq ln lo lp lq bi translated"><strong class="jv hj">模型残差的正态分布</strong></li></ul><p id="00da" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">当我们检查这些假设时，我们将更深入地研究它们。</p><h2 id="7c42" class="lw iw hi bd ix lx ly lz jb ma mb mc jf ke md me jj ki mf mg jn km mh mi jr mj bi translated">多重共线性</h2><p id="97fd" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">利用seaborn，我创建了一个每个变量和所有其他变量之间相关性的热图。计算相关性的绝对值是因为只有线性关系的强度，而不是方向，才能满足这一假设。</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lc ld l"/></div></figure><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/a60a25e66eacaaaa15061bdbe401e31f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T1IbikbBB5mq9ftl"/></div></div></figure><p id="e234" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">正如我们所料，许多与房屋大小相关的变量(如平方英尺、房间数量)彼此高度相关。一般情况下，我们不希望在同一个模型中包含任何两个相关性超过. 80的x变量。然而，我们确实想包含与y变量相关的变量。下面，我创建并显示了两个小数据框，它们缩小了我们最感兴趣的相关性。</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lc ld l"/></div></figure><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es ml"><img src="../Images/88fdb5b46ebfb95412c765d13d1d63c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*DIZm8CKyU7e79136alFZHQ.png"/></div></figure><p id="982c" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">虽然sqft_living和sqft_above都与价格高度相关，但由于它们之间也高度相关，因此只能将其中一个包含在多元回归模型中。幸运的是，其相关性违反这一假设的其他两个变量(条件评级3和4)与价格的相关性相对较弱。</p><h2 id="aa6f" class="lw iw hi bd ix lx ly lz jb ma mb mc jf ke md me jj ki mf mg jn km mh mi jr mj bi translated">线性关系</h2><p id="6cc2" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">散点图是检查解释变量和响应变量之间的关系是否是线性的一种简单方法。在为与价格相关性最强的变量创建对象后，我制作了以下散点图。</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lc ld l"/></div></figure><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/73199c186b656b73657ac53c066cb1b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eho6IL_x07IWHMGDrxUgdw.png"/></div></div></figure><p id="73ce" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">“景观”、“楼层”和“卧室”变量与房价没有明显的线性关系。Sqft_living与价格的线性关系比sqft_above更强，因此将在多元回归模型中使用。由于它与上面的sqft多重共线性，上面的sqft将被排除。</p><h1 id="dfe6" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">构建多元回归模型</h1><p id="e521" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">接下来的两个假设——正态性和同方差性——要求我们首先创建一个回归模型，因为它们指的是模型的<em class="mn">残差</em>而不是其特征。在线性回归中，残差是实际值和回归线估计值之间的垂直距离。在创建多元回归模型之前，我完成了对浴室、等级、sqft_living和sqft_living15的简单线性回归分析。在这个过程中，我发现sqft变量的残差并不完全满足正态性和同方差性。为了解决这个问题，我使用<code class="du mo mp mq mr b">np.log()</code>将price和sqft值更新到它们的自然日志中。</p><p id="25e1" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">对于多元回归模型，我在不违反多重共线性假设的情况下，包含了与价格相关性最高的四个变量:</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lc ld l"/></div></figure><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ms"><img src="../Images/296883e7b68cf785ca0c5c2a73946a3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H5vnpHKH80g_Nb2gMDVRCw.png"/></div></div></figure><p id="8f89" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">r平方值为0.535，表明该模型可以解释其均值附近约53%的价格可变性。多元回归的零假设是<em class="mn">所选解释变量和响应变量之间没有关系。</em>所有的p值舍入到0，这意味着我们可以拒绝零假设。现在我们可以确认该模型满足正态性和同方差性的假设。</p><h2 id="561c" class="lw iw hi bd ix lx ly lz jb ma mb mc jf ke md me jj ki mf mg jn km mh mi jr mj bi translated">残差正态性</h2><p id="5f35" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">分位数-分位数图是检验正态性假设的一种方法。如果残差呈正态分布，它们的点将主要落在一条直线上。下面是模型残差的Q-Q图。</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lc ld l"/></div></figure><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/97a1fc8ba9ad038ac7f76d6ea29772bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QdRzYML9T4YAzFqAD4qasg.png"/></div></div></figure><p id="383d" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">由于几乎所有的数据点都落在这个QQ图的直线上，我们可以认为满足了正态假设。</p><h2 id="23f9" class="lw iw hi bd ix lx ly lz jb ma mb mc jf ke md me jj ki mf mg jn km mh mi jr mj bi translated"><strong class="ak">同方差</strong></h2><p id="23c4" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">同方差假设指出，对于任何x值，残差的方差大致相同。为了形象化，我做了一个散点图，y轴是模型的残差，x轴是拟合值。为了满足同方差假设，点的形状应该在y=0的直线上大致对称。</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lc ld l"/></div></figure><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mu"><img src="../Images/56d966eb972ee41717ab030c29c498fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jppLxYSYLMErOMu9xiNh9g.png"/></div></div></figure><p id="78ab" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">我们可以看到，这些点具有大致对称的水滴状形状，在x轴上是一致的。该模型满足——最后但并非最不重要的——同方差假设。</p><h1 id="05c2" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">模型验证</h1><p id="9f81" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">评估模型质量的最后一步是交叉验证，它让我们了解对于相同的变量，使用新数据时模型的表现如何。我使用sklearn的train_test_split函数将数据分成两个子集:一个子集将用于训练模型，另一个子集将用于测试模型。默认情况下，该函数将75%的数据作为定型子集，将另外25%的数据作为测试子集。</p><p id="f2be" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><strong class="jv hj">均方误差</strong></p><p id="5485" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">下面的代码为x和y变量创建训练和测试数据，使用x子集预测新的y值，然后计算这些值与实际y值之间的距离。最后，我们使用均方误差函数来计算两个子集的MSE。</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lc ld l"/></div></figure><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mv"><img src="../Images/0ed64fd2440077a4cad72389b5f1de8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hv-97fGctMrafKAJ_T5zSA.png"/></div></div></figure><p id="617e" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">训练和测试子集的MSEs是相似的，这表明该模型在不同的数据上表现相似。</p><h1 id="047a" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">结论</h1><p id="f9a0" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">总的来说，面积、等级、浴室数量和邻居房屋的大小是金县房价的最佳预测指标。该模型确实有一些局限性:考虑到一些变量需要进行对数转换以满足回归假设，任何用于该模型的新数据都必须经过类似的预处理。此外，考虑到房价的地区差异，该模型对其他县数据的适用性可能有限。</p><p id="f30d" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">所以，如果你正在寻找一个不会倾家荡产的房子，明智的做法是节省面积，和另外三个人共用一个浴室。但是我们大多数城市居民不是已经在这么做了吗？</p></div><div class="ab cl mw mx gp my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="hb hc hd he hf"><p id="cca5" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">完整代码可在<a class="ae iu" href="https://github.com/AvonleaFisher/dsc-mod-2-project-v2-1-onl01-dtsc-ft-070620" rel="noopener ugc nofollow" target="_blank"> <strong class="jv hj"> GitHub </strong> </a>上获得</p></div></div>    
</body>
</html>