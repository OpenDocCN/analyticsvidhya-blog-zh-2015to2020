<html>
<head>
<title>Python Machine Learning Web Application Deployment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python机器学习Web应用部署</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/python-machine-learning-web-application-deployment-d313511b9000?source=collection_archive---------38-----------------------#2020-04-19">https://medium.com/analytics-vidhya/python-machine-learning-web-application-deployment-d313511b9000?source=collection_archive---------38-----------------------#2020-04-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a87130be57e3a6e180e516c750fef0e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*45uoH6G3uXaBj4IMBBNL8w.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">前往印度北阿坎德邦Dayara trek途中的某处(2018年3月)</figcaption></figure><p id="f4c3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这篇文章的目标是— (1)用python构建一个用于员工工资预测的样本机器学习模型(2)使用python flask构建web应用程序(3)使用Heroku部署应用程序。随着每一步的进展，我们将查看目录结构。</p></div><div class="ab cl js jt gp ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hb hc hd he hf"><p id="62c7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="jz">机器学习模型开发— </em></p><p id="d0d5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这一部分中，我们将使用python开发一个简单的机器学习模型，并保存该模型以在下一步中使用。使用下面的代码，我们将读入一个训练数据文件“hiring.csv”，处理空值并将文本值替换为数值，以便将它们输入到模型中。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="90a3" class="kj kk hi kf b fi kl km l kn ko">import pandas as pd<br/>import pickle<br/><br/>dataset = pd.read_csv("hiring.csv")<br/>dataset['experience'].fillna(0, inplace=True)<br/>dataset['test_score'].fillna(dataset['test_score'].mean(), inplace=True)<br/><br/>X = dataset.iloc[:, :3]<br/><br/># converting words into integer values<br/>def convert_to_int(word):<br/>    word_dict = {'one': 1, 'two': 2, 'three': 3, 'four': 4, 'five': 5,<br/>                 'six': 6, 'seven': 7, 'eight': 8, 'nine': 9, 'ten': 10,<br/>                 'eleven': 11, 'twelve': 12, 'zero': 0, 0: 0}<br/>    return word_dict[word]<br/><br/><br/>X['experience'] = X['experience'].apply(lambda x: convert_to_int(x))<br/>y = dataset.iloc[:, -1]</span></pre><p id="3433" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">此外，我们将从sklearn加载LinearRegression模块，并在整个训练数据上拟合模型，因为我们只有少量记录。(因为我们只是为了说明的目的而构建模型，所以我们不关心模型的性能)然后我们将模型保存在“model.pkl”中，以便在下一步中加载它进行预测。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="abc8" class="kj kk hi kf b fi kl km l kn ko"># training the model on entire data as we have very small number of training examples<br/>from sklearn.linear_model import LinearRegression<br/>model = LinearRegression()<br/>model.fit(X, y)<br/># saving the trained model<br/>pickle.dump(model, open('model.pkl', 'wb'))<br/><br/># loading the model to make predictions<br/>model = pickle.load(open('model.pkl', 'rb'))</span></pre><p id="ea5a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="jz">使用Flask web框架开发Web应用— </em></p><p id="e811" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们将使用flask创建web应用程序，并尝试首先在本地系统上运行它。下面附上app开发代码。我们将导入必要的包和我们在上一部分中训练的机器学习模型。然后，我们将创建一个简单的应用程序对象，并将它与index.html页面链接起来。这个HTML页面将有一个HTML表单，并接受数字输入。我们将这些输入存储在int_features变量中，并将这些值作为特征值传递到模型中。该模型将预测这些输入值的雇员薪金，并输出消息“prediction_text= '雇员薪金应为$ {}”</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="1174" class="kj kk hi kf b fi kl km l kn ko">import numpy as np<br/>from flask import Flask, request, jsonify, render_template<br/>import pickle</span><span id="1830" class="kj kk hi kf b fi kp km l kn ko">#'app' is the name of the app </span><span id="07e7" class="kj kk hi kf b fi kp km l kn ko">app = Flask(__name__)<br/>model = pickle.load(open('model.pkl', 'rb'))<br/></span><span id="7383" class="kj kk hi kf b fi kp km l kn ko">#this is the render the home page of the application when we launch the app<br/>@app.route('/')<br/>def home():<br/>    return render_template('index.html')</span><span id="c0d1" class="kj kk hi kf b fi kp km l kn ko">@app.route('/predict', methods=['POST'])<br/>def predict():<br/>    <em class="jz">"""for rendering results to HTML GUI"""<br/>    </em>int_features = [int(x) for x in request.form.values()]<br/>    final_features = [np.array(int_features)]<br/>    prediction = model.predict(final_features)<br/>    output = round(prediction[0], 2)<br/>    return render_template('index.html', prediction_text='Employee salary should be $ {}'.format(output))<br/><br/><br/>if __name__ == '__main__':<br/>    app.run(debug=True)</span></pre><p id="d722" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="jz"> Web应用部署— </em></p><p id="83de" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有各种平台来部署web应用程序，但我们将使用一个免费使用的平台Heroku来部署我们的应用程序。Heroku是<em class="jz"> Salesforce旗下的云平台即服务公司。</em>我们<em class="jz">正在</em>使用它进行部署，因为有两个原因——(a)它是免费使用的，(b)易于应用程序部署。</p><p id="e851" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先，我们必须在heroku上创建一个免费帐户来登录heroku系统。有3种不同的应用程序部署方法，但我们将采用无需安装heroku CLI的方法。git的安装依赖于我们。如果我们在GitHub上已经有了应用程序文件，那么就不需要安装git，但是如果我们在Github上没有，那么我们要么使用git上传文件和文件夹的工具来上传它们，要么我们可以安装git，然后将项目文件推送到git中。下面是项目目录结构。要求项目目录中包含<strong class="iw hj"> <em class="jz"> Procfile </em> </strong>和<strong class="iw hj">requests . txt</strong>文件。heroku需要Procfile来将应用程序检测为python应用程序。requirements.txt应该有运行应用程序的所有包列表。只需在python shell中执行“pip freeze requirements.txt ”,就可以获得已安装的软件包列表。我们还需要包含runtime.txt。该文件应该有一行提到python版本为“python 3.7.2”。下面是目录结构—</p><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kq"><img src="../Images/96d51f7ada63925aa3272de9b4d18330.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g2st9RSnQp3kRtRoobO2EA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">项目结构</figcaption></figure><p id="bd6e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，我们准备好部署这个应用程序了。我们将按照以下步骤部署应用程序—</p><p id="ce68" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">(一)使用注册凭证登录Heroku在线平台</p><p id="b0ac" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">(ii)单击右上角的“新建”按钮，在下一个屏幕上选择一个应用程序名称(这也将包含在我们的应用程序网址中)，然后单击“创建应用程序”继续。</p><p id="1307" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">(iii)在应用程序部署方法中，选择GitHub并连接上面创建的git项目存储库</p><p id="5424" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">(iv)转到设置选项卡并添加Python buildpack</p><p id="a694" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">(v)最后，单击“deploy application ”,这样首先会检测到应用程序类型(python ),然后它会自动安装requirements.txt文件中包含的包。瞧，我们已经成功部署了我们的第一个web应用程序。</p><p id="a364" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们可以去<app-name> .herokuapp.com试着运行一下应用。<a class="ae kr" href="https://salary-prediction-413.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://salary-prediction-413.herokuapp.com/</a>是我已经部署的应用，继续访问吧。感谢您的阅读，如果您在以下步骤中遇到任何问题，请留下您的评论。</app-name></p></div></div>    
</body>
</html>