<html>
<head>
<title>How to get into BigQuery analysis on Kaggle with Python?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Python在Kaggle上进入BigQuery分析？</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-get-into-bigquery-analysis-on-kaggle-with-python-b75ee5e0a79d?source=collection_archive---------15-----------------------#2019-10-21">https://medium.com/analytics-vidhya/how-to-get-into-bigquery-analysis-on-kaggle-with-python-b75ee5e0a79d?source=collection_archive---------15-----------------------#2019-10-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="6881" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">可以用Python替代BigQuery SQL查询吗？</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/e6f54cf4f85c46c80052b267330210d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ZAdVysgmPAxBlkVy1c2XQ.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">一条懒惰的蟒蛇</figcaption></figure><p id="742c" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这篇文章概述了在Kaggle上开始使用BigQuery所需的步骤。最初，我认为使用Python就足够了。然而，正如我在这里解释的，为了有效地工作，学习一些BigQuery似乎是不可避免的。</p><p id="150b" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">(本文是用Python分析BigQuery区块链数据系列文章的一部分。有关该项目的概述，请参见<a class="ae kj" rel="noopener" href="/@nocibambi/blockchain-data-analysis-on-kaggle-with-bigquery-and-python-c7ab2f46ace">此链接。</a>)</p><p id="8240" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这篇文章的概要:</p><ul class=""><li id="0635" class="kk kl hi jp b jq jr jt ju jw km ka kn ke ko ki kp kq kr ks bi translated">概述了我考虑用来访问区块链数据的Python库和方法。</li><li id="35cd" class="kk kl hi jp b jq kt jt ku jw kv ka kw ke kx ki kp kq kr ks bi translated">简要讨论当前Python方法不够用的原因以及BigQuery的必要性。</li><li id="33ba" class="kk kl hi jp b jq kt jt ku jw kv ka kw ke kx ki kp kq kr ks bi translated">学习BigQuery的参考资料，重点是在Kaggle上使用它。</li></ul><h1 id="0279" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">用Python访问BigQuery的方法</h1><p id="56a9" class="pw-post-body-paragraph jn jo hi jp b jq lq ij js jt lr im jv jw ls jy jz ka lt kc kd ke lu kg kh ki hb bi translated">起初，我想避免学习太多的BigQuery SQL，并希望尽可能地依赖Python。我最熟悉Python的pandas，它有一些处理BigQuery的库和方法。</p><p id="6fd2" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我调查的是:</p><ul class=""><li id="632c" class="kk kl hi jp b jq jr jt ju jw km ka kn ke ko ki kp kq kr ks bi translated">Python <a class="ae kj" href="http://ibis-project.org" rel="noopener ugc nofollow" target="_blank"> Ibis项目</a></li><li id="2652" class="kk kl hi jp b jq kt jt ku jw kv ka kw ke kx ki kp kq kr ks bi translated">BigQuery的<a class="ae kj" href="https://googleapis.dev/python/bigquery/latest/index.html" rel="noopener ugc nofollow" target="_blank">客户端库</a>。</li><li id="26c4" class="kk kl hi jp b jq kt jt ku jw kv ka kw ke kx ki kp kq kr ks bi translated">由Kaggle的人开发的bigquery_helper 。</li><li id="a3f8" class="kk kl hi jp b jq kt jt ku jw kv ka kw ke kx ki kp kq kr ks bi translated">Pandas的<a class="ae kj" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_gbq.html" rel="noopener ugc nofollow" target="_blank"> pandas-read_gbq </a>方法及其背后的<a class="ae kj" href="https://pandas-gbq.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> pandas-gbq </a>库。</li></ul><p id="712d" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">然而，所有这些都在几个方面受到限制:</p><ul class=""><li id="7bc4" class="kk kl hi jp b jq jr jt ju jw km ka kn ke ko ki kp kq kr ks bi translated">Ibis:不支持BigQuery的UNNEST*操作，虽然它还在路线图中，但是到目前为止，它是最不成熟的问题。</li><li id="d938" class="kk kl hi jp b jq kt jt ku jw kv ka kw ke kx ki kp kq kr ks bi translated">BigQuery的客户端方法:它在开始分析时很方便，但是，同样，它既不支持UNNEST，也不在它的范围内。不过，当我询问时，他们提供了一些<a class="ae kj" href="https://github.com/googleapis/google-cloud-python/issues/9460#issuecomment-541796213" rel="noopener ugc nofollow" target="_blank">解决方法代码</a>。</li><li id="3d94" class="kk kl hi jp b jq kt jt ku jw kv ka kw ke kx ki kp kq kr ks bi translated">bigquery_helper:奇怪的是，尽管几乎所有关于bigquery和SQL的Kaggle教程都在使用它，但它抛出了一个警告，表示它将被弃用。(当我写完这篇文章时，他们实际上重写了一些教程。他们不再使用这个库)。因此，我选择避开它。</li><li id="9f09" class="kk kl hi jp b jq kt jt ku jw kv ka kw ke kx ki kp kq kr ks bi translated">pandas-read_gpq:这个方法本身接受一个SQL查询，并将其转换为pandas dataframe，因此它的用途非常有限。</li></ul><p id="e1b0" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">(* UNNEST是用于展平嵌套数组的BigQuery操作。我可能会在另一篇文章中写它。)</p><p id="3d89" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">虽然在这些工具中，Ibis似乎是未来最有前途的工具，但这不会很快发生。此外，BigQuery还可以选择对数据运行机器学习算法，这甚至不在Ibis的范围内。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lv"><img src="../Images/7d016ef16fa915be3997b6cb4c2dd5d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*MCGgo4Mv8eDhVHfvvmZTTA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">使用Ibis:短期内不会…</figcaption></figure><h1 id="bd45" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">评估BigQuery的需求</h1><p id="6b09" class="pw-post-body-paragraph jn jo hi jp b jq lq ij js jt lr im jv jw ls jy jz ka lt kc kd ke lu kg kh ki hb bi translated">在理想的情况下，即使我使用BigQuery来提取数据，我仍然会使用pandas进行大部分的数据管理和分析。这背后的原因是，首先，我已经习惯了，其次，我可以通过相对快速地尝试不同的查询来更有效地参数化它。</p><p id="cf9f" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">然而，由于数据的巨大规模和查询限制，这是不可行的。因此，值得花些时间仔细考虑我们到底想要提取什么数据，以及我们需要编写什么SQL查询。</p><p id="bc2f" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">因此，简而言之，我决定比我最初打算的更坚定地控制BigQuery。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lw"><img src="../Images/98a6eae0969ebb3a7677c195e41fc133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qfDG3KkujVr9C079"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">一只悲伤的熊猫。<a class="ae kj" href="https://unsplash.com/@veverkolog?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杜安·斯美塔纳</a>在<a class="ae kj" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="972f" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">学习BigQuery的资源</h1><p id="ac00" class="pw-post-body-paragraph jn jo hi jp b jq lq ij js jt lr im jv jw ls jy jz ka lt kc kd ke lu kg kh ki hb bi translated">我在Kaggle上找到了一些关于SQL实践的参考资料。因为我发现绕过它们有点令人困惑(特别是关于bigquery-helper的问题)，所以这里有一个我认为最有用的方法的快速概述:</p><ul class=""><li id="772b" class="kk kl hi jp b jq jr jt ju jw km ka kn ke ko ki kp kq kr ks bi translated"><a class="ae kj" href="https://www.kaggle.com/jessicali9530/tutorial-how-to-use-bigquery-in-kaggle-kernels" rel="noopener ugc nofollow" target="_blank">Kaggle上的BigQuery的一般介绍</a>。</li><li id="7993" class="kk kl hi jp b jq kt jt ku jw kv ka kw ke kx ki kp kq kr ks bi translated">Kaggle的维护人员刚刚更新了他们的SQL教程(以前他们使用的是不推荐的bigquery-helper库)。它们非常基础，但仍然有用:<a class="ae kj" href="https://www.kaggle.com/learn/intro-to-sql" rel="noopener ugc nofollow" target="_blank">SQL简介</a>和<a class="ae kj" href="https://www.kaggle.com/learn/advanced-sql" rel="noopener ugc nofollow" target="_blank">高级SQL </a>。</li><li id="4ddf" class="kk kl hi jp b jq kt jt ku jw kv ka kw ke kx ki kp kq kr ks bi translated"><a class="ae kj" href="https://www.kaggle.com/sohier/beyond-queries-exploring-the-bigquery-api/" rel="noopener ugc nofollow" target="_blank">关于客户端对象、使用模式和估计查询大小的有用教程</a>。</li><li id="c9db" class="kk kl hi jp b jq kt jt ku jw kv ka kw ke kx ki kp kq kr ks bi translated"><a class="ae kj" href="https://www.kaggle.com/product-feedback/48573" rel="noopener ugc nofollow" target="_blank">ka ggle上BigSQL的实用概述，尤其是关于如何控制资源使用的概述</a>。</li></ul><p id="cb50" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">Kaggle还有一系列更实用的SQL教程，名为<a class="ae kj" href="https://www.kaggle.com/rtatman/sql-scavenger-hunt-handbook/" rel="noopener ugc nofollow" target="_blank"> SQL清道夫狩猎</a>，不过它使用了bigquery-helper。因此，我不会建议它学习BigQuery，但我认为它仍然是一个有用的实践资源。</p><p id="b35d" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">然而，所有这些教程仅仅触及了SQL的表面及其BigQuery细节。不幸的是，我没有在周围找到太多的BigQuery材料，除了上面的那些，它们都假设你在Google Cloud上使用BigQuery。然而，对于在Kaggle数据集上的使用，<a class="ae kj" href="https://cloud.google.com/bigquery/docs/query-overview" rel="noopener ugc nofollow" target="_blank">查询参考指南</a>似乎特别有用。</p><p id="22d9" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我还研究了区块链特有的教程，这里不讨论。我可能会在以后的文章中这样做。</p></div></div>    
</body>
</html>