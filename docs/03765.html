<html>
<head>
<title>How does Prophet work? Part-2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">先知是如何工作的？第二部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-does-prophet-work-part-2-c47a6ceac511?source=collection_archive---------2-----------------------#2020-02-18">https://medium.com/analytics-vidhya/how-does-prophet-work-part-2-c47a6ceac511?source=collection_archive---------2-----------------------#2020-02-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8861" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，我们已经学会了如何调整prophet库的趋势组件(你可以在这里查看<a class="ae jd" rel="noopener" href="/@deepti.agl16/how-does-prophet-work-44addaab6148?source=friends_link&amp;sk=6f11622ef44ca1bb64fa7cf68c72968a"/>)。</p><p id="8e4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将解释<strong class="ih hj">季节性成分和假期</strong></p><p id="12bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">组件- </strong></p><p id="1df6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个模型的方程式是—</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/628cf5cc0c2b399dc39780a5f9322f90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/0*y6xgqILoPkWKMCBl.png"/></div></figure><p id="047f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们稍微深入了解一下季节性成分(s(t))，它为模型提供了灵活性(每周、每年、每天的季节性变化成分)。</p><p id="bcf2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该组件使用<strong class="ih hj">傅立叶级数— </strong></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jm"><img src="../Images/25dbeb93e29ddd47cdff37c43dad71a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/1*hBR26OFeHQgRS2XFC3QZMA.gif"/></div><figcaption class="jn jo et er es jp jq bd b be z dx translated">长度为1、2、3和4项的四个部分和(傅立叶级数)。显示了方波的近似值如何随着项数的增加而提高</figcaption></figure><p id="d16c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">季节性是使用部分傅立叶和估计的。傅立叶顺序决定了季节性变化的速度(每年季节性的默认顺序是10，每周季节性的顺序是3)。增加傅立叶阶次可以使季节性适应变化更快的周期(我们在设置该参数时需要非常小心，因为它会导致过度拟合)。</p><pre class="jf jg jh ji fd jr js jt ju aw jv bi"><span id="a94e" class="jw jx hi js b fi jy jz l ka kb"><strong class="js hj">m = Prophet(weekly_seasonality=False)<br/>m.add_seasonality(name='monthly', period=30.5, fourier_order=5)</strong></span></pre><p id="2d1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了周、年和日季节性之外，我们还可以使用条件季节性。注意:-使用条件季节性的主要原因是-默认的周季节性假设周季节性的模式在一年中是相同的。</p><p id="3802" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有另一个可以调整的参数—</p><p id="7ec7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="kc">季节性_先验_标度</em> </strong> - &gt;它调整季节性模型与数据的拟合程度(注意:——同样我们也通过使用— <strong class="ih hj"> <em class="kc">先验_标度</em> </strong>参数为各个假日设置类似的变量)。为了更深入的了解，你可以查看官方指南。</p><pre class="jf jg jh ji fd jr js jt ju aw jv bi"><span id="89bb" class="jw jx hi js b fi jy jz l ka kb"># Python<br/>m = Prophet()<br/>m.add_seasonality(<br/>    name='weekly', period=7, fourier_order=3, prior_scale=0.1)</span></pre><blockquote class="kd ke kf"><p id="209f" class="if ig kc ih b ii ij ik il im in io ip kg ir is it kh iv iw ix ki iz ja jb jc hb bi translated">假期部分(h(t))</p></blockquote><p id="3287" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个国家的假期由Python中的<code class="du kj kk kl js b">holidays</code>包提供。您可以使用它，也可以为假期创建自己的数据框架—注意:-记住您的假期应该包含两个参数— <code class="du kj kk kl js b">holiday</code>和<code class="du kj kk kl js b">ds</code></p><p id="26fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您还可以包括列<code class="du kj kk kl js b">lower_window</code>和<code class="du kj kk kl js b">upper_window</code>，它们将假期延长到日期前后的<code class="du kj kk kl js b">[lower_window, upper_window]</code>天。您还可以包含一个列<code class="du kj kk kl js b">prior_scale</code>来分别设置每个假期的优先等级。</p><p id="8a89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将dataframe作为参数传递给prophet，如下所示</p><pre class="jf jg jh ji fd jr js jt ju aw jv bi"><span id="16b9" class="jw jx hi js b fi jy jz l ka kb"><strong class="js hj">Holiday_dataframe = pd.DataFrame({<br/>  'holiday': 'superbowl',<br/>  'ds': pd.to_datetime(['2010-02-07', '2014-02-02', '2016-02-07']),<br/>  'lower_window': 0,<br/>  'upper_window': 1,<br/>})<br/></strong># Python<br/>m = Prophet(holidays=<strong class="js hj">Holiday_dataframe</strong>)<br/>forecast = m.fit(df).predict(future)</span></pre><p id="1c44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以通过使用<code class="du kj kk kl js b">add_country_holidays</code>方法来使用一个内置的特定于国家的假日集合</p><pre class="jf jg jh ji fd jr js jt ju aw jv bi"><span id="0a01" class="jw jx hi js b fi jy jz l ka kb"><strong class="js hj"># Python<br/>m = Prophet(holidays=holidays)<br/>m.add_country_holidays(country_name='US')<br/>m.fit(df)</strong></span></pre><p id="83ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">去看假期—</p><pre class="jf jg jh ji fd jr js jt ju aw jv bi"><span id="9f5a" class="jw jx hi js b fi jy jz l ka kb"><strong class="js hj"># Python<br/>m.train_holiday_names</strong></span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es km"><img src="../Images/659cac2b758a254376ce415d19db2efa.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*GJpg-_Ir5JDwz9FB4tS46A.png"/></div></div></figure><p id="8214" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看一个例子——</p><blockquote class="kd ke kf"><p id="b1ac" class="if ig kc ih b ii ij ik il im in io ip kg ir is it kh iv iw ix ki iz ja jb jc hb bi translated"><em class="hi"> m = Prophet(mcmc_samples=1000，changepoint_prior_scale=0.07，seasonality _ mode= '乘法'，\<br/>yearly _ seasonity = 10，<br/>weekly _ seasonity = True，<br/>daily _ seasonity = False，change point _ range = 0.9)<br/>m . add _ seasonity(' quarterly '，period=91.25，fourier_order=10，mode = '加法')</em></p></blockquote><p id="a21f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码中，可以看到参数<strong class="ih hj"> <em class="kc">模式。</em> </strong> <em class="kc">根据您的数据集，您可以定义参数—</em><strong class="ih hj"><em class="kc">乘法或加法</em> </strong> <em class="kc">。您可以分别为每个季节性因素设置参数。</em></p><p id="5db1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"><em class="kc">MCMC _ samples</em></strong>—该参数用于得到季节性的不确定性。它使用贝叶斯抽样。你设置的越高，需要的时间就越多。从低(也许500)开始，然后你可以根据你想要多少时间有效的解决方案来增加它。(我倾向于1000以上，这同样取决于数据大小，因为这需要时间)</p><p id="885c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(上述代码的所有其他组件已在<a class="ae jd" rel="noopener" href="/@deepti.agl16/how-does-prophet-work-44addaab6148">第1部分</a>中讨论过)</p><p id="c308" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想要更深入的了解，你可以查看<a class="ae jd" href="https://facebook.github.io/prophet/docs/seasonality,_holiday_effects,_and_regressors.html#specifying-custom-seasonalities" rel="noopener ugc nofollow" target="_blank">官方指南</a>。</p><p id="f1d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">链接到我的GitHub库—<a class="ae jd" href="https://github.com/DeeptiAgl?tab=repositories" rel="noopener ugc nofollow" target="_blank">https://github.com/DeeptiAgl?tab=repositories</a></p><p id="9a97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您有任何问题，请分享您的反馈。我将尽力回答这些问题。</p></div></div>    
</body>
</html>