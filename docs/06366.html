<html>
<head>
<title>Unleash the power of Callbacks[Deeplearning]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">释放回调的力量[深度学习]</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/unleash-the-power-of-callbacks-deeplearning-67c35ac66027?source=collection_archive---------19-----------------------#2020-05-19">https://medium.com/analytics-vidhya/unleash-the-power-of-callbacks-deeplearning-67c35ac66027?source=collection_archive---------19-----------------------#2020-05-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e195" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你对深度学习感兴趣，并使用框架T2张量流，这篇文章会很有见地</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/4dccb5bab1f63aae1bcdb326a77e191a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XhEjtp9jVcfUcgul"/></div></div></figure><p id="73d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以使用<strong class="ih hj"> TensorFlow </strong>建立伟大的模型，使用<strong class="ih hj">深度学习</strong>可以<strong class="ih hj">对地球上任何该死的东西进行分类</strong>，但是有时候你可能会在训练时遇到很多问题<strong class="ih hj"/></p><ol class=""><li id="b216" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">减少调整和使用不同超参数的<strong class="ih hj">计算能力</strong></li><li id="4df0" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">在线Jupyter笔记本电脑断电或<strong class="ih hj">失去连接</strong></li><li id="b0a8" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">也许你<strong class="ih hj">不知道</strong>该用哪个<strong class="ih hj">学习率</strong></li><li id="3126" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">什么时候<strong class="ih hj">停止训练</strong>【用哪个历元数】。</li><li id="1b53" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">和<strong class="ih hj">更多问题</strong></li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kd"><img src="../Images/09534e5dfbc4e1e6162df4426ec2b2ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Kb55meMeBjSq_obG.jpg"/></div></div></figure><p id="0fcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你的救星来了，回调函数。这些都是著名的深度学习框架Tensorflow提供的。这些是帮助u到<strong class="ih hj">在训练时与<strong class="ih hj">网络</strong>交互</strong>甚至在训练时改变<strong class="ih hj">超参数</strong>的功能。</p><p id="b4c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章是关于充分利用回调函数来使你的<strong class="ih hj">训练更有效率。</strong></p><blockquote class="ke kf kg"><p id="5eba" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">奖金:</p><p id="bcb6" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">1.了解如何将任意数据集从<a class="ae kl" href="https://kaggle.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Kaggle </strong> </a>导入到<strong class="ih hj"/><a class="ae kl" href="https://colab.research.google.com/" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">Google Colab</strong></a></p><p id="b6c6" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">2.直接从文件夹中没有标签的图像上训练狗和猫的分类器</p></blockquote><p id="68f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据集可以从这里下载:<a class="ae kl" href="https://www.kaggle.com/tongpython/cat-and-dog" rel="noopener ugc nofollow" target="_blank">点击这里</a></p><h1 id="0fc6" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">该员额分为两个部分:</h1><ol class=""><li id="6ce4" class="jp jq hi ih b ii lk im ll iq lm iu ln iy lo jc ju jv jw jx bi translated">五大回调函数[我使用的]</li><li id="d762" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">使用这些回调构建分类器</li></ol><h1 id="1f44" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">我使用的前5个回调函数:</h1><p id="8642" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">在这里，我将谈论我在训练中经常使用的回调</p><p id="499f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a.<a class="ae kl" href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/ModelCheckpoint" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">【模型检查点()】</strong> </a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ls"><img src="../Images/753dd823a5410196d908790107c5db61.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/0*IzXRBCwY4Y9JybkZ.jpg"/></div></figure><p id="57c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你一定玩过很多有关卡的游戏，所以当你死在那里的时候你会复活，而不是从头开始。这里有一个类似的概念，ur模型每隔一段时间保存一次，最后只保存最佳模型，这意味着具有最佳训练参数的模型考虑了一个度量。</p><p id="621c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">示例:</p><pre class="je jf jg jh fd lt lu lv lw aw lx bi"><span id="5ee8" class="ly kn hi lu b fi lz ma l mb mc">tf.keras.callbacks.ModelCheckpoint(filepath='best_weights.hdf5',monitor='val_acc',save_best_only=True)</span></pre><p id="0863" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里. hdf5模型文件根据验证准确性以最佳权重保存，我认为这对更好的泛化很重要。要进一步检查出<a class="ae kl" href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/ModelCheckpoint" rel="noopener ugc nofollow" target="_blank">检查出<strong class="ih hj">这个</strong>检查出</a></p><p id="91cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b.<a class="ae kl" href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/EarlyStopping" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj"/></a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es md"><img src="../Images/2098bb6f6704e250b52bf17fe500275f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/0*dqJDe12kvR1-Buae.png"/></div></figure><p id="ab98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有时候你需要停止训练你的模型，否则你可能会毫无理由地浪费你的计算能力，因为精确度在很多时代都是恒定的，这可能会导致你毫无理由地为云服务付费。这个函数帮助你在类似的事情发生之前停止，基于一些标准，比如验证损失或准确性或其他任何东西。</p><p id="a928" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">示例:</p><pre class="je jf jg jh fd lt lu lv lw aw lx bi"><span id="d72e" class="ly kn hi lu b fi lz ma l mb mc">tf.keras.callbacks.EarlyStopping(monitor='val_loss',patience=3)</span></pre><p id="f0a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该功能将监控验证损失，如果验证损失在3个时期内没有变化，则停止，这就是耐心所指的。查看<a class="ae kl" href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/EarlyStopping" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">本</strong> </a> <strong class="ih hj"> </strong>了解更多详情</p><p id="4209" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">c.自定义函数使用<a class="ae kl" href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/Callback" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">回调</strong> </a> <strong class="ih hj"> </strong>类</p><p id="dee5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可能有一些不同类型的标准和条件，你想在训练时应用于网络，所以你需要建立一个回调函数的自定义条件，不用担心TensorFlow为你覆盖。你只需要提到你想什么时候应用条件或函数，比如在一个时期结束后，或者在一批图像处理结束时，等等。</p><p id="a495" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">示例:</p><pre class="je jf jg jh fd lt lu lv lw aw lx bi"><span id="56c6" class="ly kn hi lu b fi lz ma l mb mc">class c(Callback):</span><span id="6869" class="ly kn hi lu b fi me ma l mb mc">def on_epoch_end(self,epoch,logs={}):</span><span id="333d" class="ly kn hi lu b fi me ma l mb mc">if(logs.get('val_acc')&gt;0.95):</span><span id="1af7" class="ly kn hi lu b fi me ma l mb mc">print('Too much accuracy so exiting')</span><span id="7eeb" class="ly kn hi lu b fi me ma l mb mc">self.model.stop_training=True</span><span id="3654" class="ly kn hi lu b fi me ma l mb mc">if(logs.get('loss')&lt;0.1):</span><span id="0e29" class="ly kn hi lu b fi me ma l mb mc">print('Too much loss lost so exiting')</span><span id="c046" class="ly kn hi lu b fi me ma l mb mc">self.model.stop_training=True</span><span id="7e80" class="ly kn hi lu b fi me ma l mb mc">custom_callback = c()</span></pre><p id="fa36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你必须创建一个从TensorFlow继承回调的类，就像我之前说的，你需要指定你想什么时候应用条件，就像此后纪元结束一样。日志是指关于当前训练步骤的信息。这里，当损失低于0.1并且在一个时期结束时验证准确度高于95%时，我需要停止训练。更多关于回调函数的信息，点击<a class="ae kl" href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/Callback" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">这里</strong> </a></p><p id="d97a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">d.<a class="ae kl" href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/CSVLogger" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> CSVLogger() </strong> </a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mf"><img src="../Images/86174cb058310382b0d7a727b7d046dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hGzqZzZpa8ENkSwo.gif"/></div></div></figure><p id="c242" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，你需要构建web应用程序来展示你的培训和测试图，或者只是简单地保存关于培训的信息，甚至有一个内置的功能。这就像为您的模型构建一个日志文件，这样您甚至可以在以后使用<a class="ae kl" href="https://matplotlib.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Matplotlib </strong> </a>或<a class="ae kl" href="https://seaborn.pydata.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> seaborn </strong> </a>库进行绘图。</p><p id="41a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">示例:</p><pre class="je jf jg jh fd lt lu lv lw aw lx bi"><span id="1c83" class="ly kn hi lu b fi lz ma l mb mc">tf.keras.callbacks.CSVLogger('logfile.csv')</span></pre><p id="84dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里太简单了，只需给它日志文件的名字，简单吧？要了解更多<a class="ae kl" href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/CSVLogger" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">点击</strong> </a></p><p id="4f13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">e.<a class="ae kl" href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/LearningRateScheduler" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">learning rate scheduler()</strong></a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/b62872857f21f886c29ac0392f60fcc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XilMuv7IVHx4cZFw.gif"/></div></div></figure><p id="8bbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你是机器学习的新手，并且有<strong class="ih hj">零</strong> <strong class="ih hj">线索</strong>你的<strong class="ih hj">学习</strong> <strong class="ih hj">速率</strong>应该是多少，这将非常方便..有人<strong class="ih hj">帮忙</strong>！！！。别担心TensorFlow会来救你。</p><p id="0010" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个功能是我最喜欢的，因为它让你<strong class="ih hj">决定</strong>学习 <strong class="ih hj">速率</strong>每<strong class="ih hj">时期</strong>如果你想或超过任何其他<strong class="ih hj">条件</strong>。掌握决定学习速度的技巧并不容易，为什么不用这个呢</p><p id="f78f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">示例:</p><pre class="je jf jg jh fd lt lu lv lw aw lx bi"><span id="0af3" class="ly kn hi lu b fi lz ma l mb mc">def scheduler(epoch):<br/>    if epoch &lt; 10:<br/>        return 0.001<br/>    else:<br/>        return 0.001 * tf.math.exp(0.1 * (10 - epoch))</span><span id="97b2" class="ly kn hi lu b fi me ma l mb mc">tf.keras.callbacks.LearningRateScheduler(scheduler)</span></pre><p id="b093" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">定义一个函数，该函数接受一个输入参数，该参数在这里对应于纪元编号，利用该参数，并定义当您想要改变学习率并返回它时的条件。就像这里一样，我在前10个时期使用恒定的学习率0.001，然后逐渐降低学习率。更多信息请点击<a class="ae kl" href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/LearningRateScheduler" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">此处</strong> </a></p><h1 id="77e6" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">使用这些回调构建分类器</h1><p id="66fb" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">和我一直做的一样，这里是实现整个网络和玩不同回调函数的代码。</p><p id="1934" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我使用了猫和狗的数据集，我知道这是陈词滥调，但更重要的是向你展示如何使用不同的回调函数。这段代码是在<a class="ae kl" href="https://colab.research.google.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Google Colab </strong> </a>上执行的，</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mg"><img src="../Images/f7991db9de3a6e7521d886360a8463fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/0*9SR-JRk5JQD0v-QQ.png"/></div></figure><p id="b20b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个非常棒的免费工具，可以为不同的培训模型制作原型，并将代码扩展到任何其他高端付费云服务。因为如果你直接从那里开始，你可能最初只是为原型制作付费，这不是你想在原型制作时浪费的那种钱。</p><p id="cb35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第一步【可选】:</strong></p><p id="cd53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">验证你的Kaggle账户，直接下载数据到Google Colab </strong></p><p id="e523" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">一个</strong>。上传kaggle.json文件，您可以在kaggle个人资料的帐户部分找到该文件</p><pre class="je jf jg jh fd lt lu lv lw aw lx bi"><span id="605b" class="ly kn hi lu b fi lz ma l mb mc">from google.colab import files<br/>files.upload()</span></pre><p id="0ab1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Kaggle要求将你的文件放在一个特定的文件夹中，然后授予它使用权限</p><pre class="je jf jg jh fd lt lu lv lw aw lx bi"><span id="2ca2" class="ly kn hi lu b fi lz ma l mb mc">!mkdir -p  ~/.kaggle<br/>!cp kaggle.json ~/.kaggle/<br/>!chmod 600 ~/.kaggle/kaggle.json</span></pre><p id="f42a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下载并解压你的数据</p><pre class="je jf jg jh fd lt lu lv lw aw lx bi"><span id="f2f0" class="ly kn hi lu b fi lz ma l mb mc">!kaggle datasets download -d tongpython/cat-and-dog<br/>!unzip cat-and-dog.zip</span></pre><p id="570d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第二步:</strong></p><p id="3508" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">导入所有库</strong></p><pre class="je jf jg jh fd lt lu lv lw aw lx bi"><span id="e3bc" class="ly kn hi lu b fi lz ma l mb mc">import tensorflow as tf</span><span id="e12e" class="ly kn hi lu b fi me ma l mb mc">from tensorflow.keras.models import Sequential</span><span id="9bd3" class="ly kn hi lu b fi me ma l mb mc">from tensorflow.keras.layers import         Dense,Flatten,Conv2D,MaxPooling2D</span><span id="4706" class="ly kn hi lu b fi me ma l mb mc">from tensorflow.keras.optimizers import RMSprop,Adam</span><span id="b2ef" class="ly kn hi lu b fi me ma l mb mc">from tensorflow.keras.losses import binary_crossentropy,categorical_crossentropy</span><span id="c036" class="ly kn hi lu b fi me ma l mb mc">from tensorflow.keras.preprocessing.image import ImageDataGenerator,img_to_array</span><span id="6c8d" class="ly kn hi lu b fi me ma l mb mc">from tensorflow.keras.callbacks import Callback<br/>import matplotlib.pyplot as plt<br/>import random</span></pre><p id="29a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Tensorflow用于构建模型，Matplotlib用于绘图，random用于生成一些随机数</p><p id="fb22" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第三步:</strong></p><p id="dc46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">设置图像增强的图像生成器，并直接从代表标签的文件夹中加载这些图像。</strong></p><blockquote class="ke kf kg"><p id="6706" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">记住给出对应于不同类的不同文件夹所在的文件夹的路径</p></blockquote><pre class="je jf jg jh fd lt lu lv lw aw lx bi"><span id="3ac3" class="ly kn hi lu b fi lz ma l mb mc">train_data_gen = ImageDataGenerator(rescale = 1./255,shear_range = 0.2,zoom_range = 0.2,horizontal_flip = True)</span><span id="e5ef" class="ly kn hi lu b fi me ma l mb mc">train_gen=train_data_gen.flow_from_directory('training_set/training_set',target_size=(64,64),batch_size=32,class_mode='binary')</span><span id="997f" class="ly kn hi lu b fi me ma l mb mc">valid_data_gen =  ImageDataGenerator(rescale=1./255)</span><span id="c578" class="ly kn hi lu b fi me ma l mb mc">valid_gen=valid_data_gen.flow_from_directory('test_set/test_set',target_size=(64,64),batch_size=32,class_mode='binary')</span><span id="cfcd" class="ly kn hi lu b fi me ma l mb mc">'''<br/>Found 8005 images belonging to 2 classes. <br/>Found 2023 images belonging to 2 classes.<br/>'''</span></pre><p id="a15d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们希望我们的图像大小调整为64x64，并应用一些数据增强，如翻转和缩放。</p><p id="7152" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第四步:</strong></p><p id="d11a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">查看您的增强图像</strong></p><pre class="je jf jg jh fd lt lu lv lw aw lx bi"><span id="e9ef" class="ly kn hi lu b fi lz ma l mb mc">def disp():<br/>    x,y = train_gen.next()<br/>    id = random.randint(0,x.shape[0])<br/>    print("This belongs to class a "+str(y[1]))<br/>    plt.imshow(x[1])<br/>    plt.show()<br/>disp()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mh"><img src="../Images/727f0192acf2ad0e6e807cb29364d97d.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*MYFiGdo0OIgcuJVe94TpXA.png"/></div><figcaption class="mi mj et er es mk ml bd b be z dx translated">这属于1.0类</figcaption></figure><p id="e7b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第五步:</strong></p><p id="cbdb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">建立你的模型</strong></p><pre class="je jf jg jh fd lt lu lv lw aw lx bi"><span id="a7cf" class="ly kn hi lu b fi lz ma l mb mc">model = Sequential()<br/>model.add(Conv2D(input_shape=(64,64,3),filters=32,kernel_size=(3,3),activation='relu'))<br/>model.add(MaxPooling2D(2,2))<br/>model.add(Conv2D(filters=32,kernel_size=(3,3),activation='relu'))<br/>model.add(MaxPooling2D(2,2))<br/>model.add(Flatten())<br/>model.add(Dense(128,activation='relu'))<br/>model.add(Dense(1,activation='sigmoid'))<br/>model.compile(loss='binary_crossentropy',optimizer='adam',metrics=['acc'])</span><span id="936f" class="ly kn hi lu b fi me ma l mb mc">model.summary()</span></pre><p id="bbe5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">架构</strong></p><blockquote class="ke kf kg"><p id="b49c" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">型号:"顺序式" _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _图层(类型)输出形状Param # = = = = = = = = = = = = = = = = = = = = = = = = = = =</p><p id="db33" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">conv2d (Conv2D) (None，62，62，32)896 _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ max _ pool 2d(maxpool2d)(None，31，31，32)0 _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 1(conv 2d)(None，29，29，32) 9248 ____________________</p><p id="65ff" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">总参数:813，217可训练参数:813，217不可训练参数:0</p></blockquote><p id="9500" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第六步【重要】:</strong></p><p id="5d36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">宣布你的复试</strong></p><pre class="je jf jg jh fd lt lu lv lw aw lx bi"><span id="c260" class="ly kn hi lu b fi lz ma l mb mc">class c(Callback):<br/>    def on_epoch_end(self,epoch,logs={}):</span><span id="425c" class="ly kn hi lu b fi me ma l mb mc">if(logs.get('val_acc')&gt;0.95): <br/>           print('Too much accuracy so exiting')<br/>           self.model.stop_training=True</span><span id="a4ab" class="ly kn hi lu b fi me ma l mb mc">if(logs.get('loss')&lt;0.1):<br/>           print('Too much loss lost so exiting')<br/>           self.model.stop_training=True</span><span id="e839" class="ly kn hi lu b fi me ma l mb mc">custom_callback = c()</span><span id="c681" class="ly kn hi lu b fi me ma l mb mc">early_stopping = tf.keras.callbacks.EarlyStopping(monitor='val_loss',patience=3)</span><span id="62ab" class="ly kn hi lu b fi me ma l mb mc">checkpointer = tf.keras.callbacks.ModelCheckpoint(filepath='best_weights.hdf5',monitor='val_acc',save_best_only=True)</span><span id="1525" class="ly kn hi lu b fi me ma l mb mc">csv= tf.keras.callbacks.CSVLogger('logfile.csv')</span><span id="46bd" class="ly kn hi lu b fi me ma l mb mc">term_nan=tf.keras.callbacks.TerminateOnNaN()</span><span id="bfb3" class="ly kn hi lu b fi me ma l mb mc">def scheduler(epoch):<br/>    if epoch &lt; 10:<br/>        return 0.001<br/>    else:<br/>        return 0.001 * tf.math.exp(0.1 * (10 - epoch))</span><span id="d0a4" class="ly kn hi lu b fi me ma l mb mc">lr = tf.keras.callbacks.LearningRateScheduler(scheduler)</span></pre><p id="81fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有这些回调之前都讨论过</p><p id="1907" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第七步:</strong></p><p id="0e9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">训练开始</strong></p><pre class="je jf jg jh fd lt lu lv lw aw lx bi"><span id="3b20" class="ly kn hi lu b fi lz ma l mb mc">history = model.fit_generator(train_gen,steps_per_epoch=8005//32,epochs=50,validation_data=valid_gen,validation_steps=2023//32,callbacks=[custom_callback,early_stopping,checkpointer,csv,term_nan,lr])</span></pre><p id="e1f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里的步骤指的是我们在生成图像时声明的批量覆盖所有图像的步骤数</p><blockquote class="ke kf kg"><p id="6ce7" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">请使用Model.fit，它支持生成器。</p><p id="9948" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">纪元1/50 250/250[= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =]—33s 131 ms/step—loss:0.6877—ACC:0.5511—val _ loss:0.6743—val _ ACC:0.5724—lr:0.0010</p><p id="21bf" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">纪元2/50 250/250[= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =]—33s 131 ms/step—loss:0.6511—ACC:0.6166—val _ loss:0.6297—val _ ACC:0.6731—lr:0.0010</p><p id="ebaf" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">纪元3/50 250/250[= = = = = = = = = = = = = = = = = = = = = = = = = = = = = =]—33s 132 ms/步—损耗:0.6015—ACC:0.6733—val _ loss:0.5697—val _ ACC:0.6969—lr:0.0010</p><p id="d673" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">纪元4/50 250/250[= = = = = = = = = = = = = = = = = = = = = = = = = = = = = =]—33s 133 ms/step—loss:0.5625—ACC:0.7105—val _ loss:0.5571—val _ ACC:0.7197—lr:0.0010</p><p id="93ed" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">纪元5/50 250/250[= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =]—34s 134 ms/步—损耗:0.5343—ACC:0.7293—val _ loss:0.5374—val _ ACC:0.7376—lr:0.0010</p><p id="8a3e" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">纪元6/50 250/250[= = = = = = = = = = = = = = = = = = = = = = = = = = = = = =]—33s 133 ms/步—损耗:0.5142—ACC:0.7425—val _ loss:0.5054—val _ ACC:0.7584—lr:0.0010</p><p id="4bb9" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">纪元7/50 250/250[= = = = = = = = = = = = = = = = = = = = = = = = = = = = = =]—33s 133 ms/步—损耗:0.4785—ACC:0.7711—val _ loss:0.4850—val _ ACC:0.7748—lr:0.0010</p><p id="4b49" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">纪元8/50 250/250[= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =]—34s 134 ms/步—损耗:0.4599—ACC:0.7781—val _ loss:0.5026—val _ ACC:0.7738—lr:0.0010</p><p id="f0dd" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">纪元9/50 250/250[= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = 33s 134 ms/step—loss:0.4413—ACC:0.7941—val _ loss:0.4764—val _ ACC:0.7808—lr:0.0010纪元10/50 250/250[= = = = = = = = = = = = = = = = = = = = = = = = = = = = = 33s 133 ms/step</p><p id="c1bb" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">纪元11/50 250/250[= = = = = = = = = = = = = = = = = = = = = = = = = = = = = =]—33s 133 ms/步—损耗:0.4138—ACC:0.8060—val _ loss:0.4670—val _ ACC:0.7812—lr:0.0010</p><p id="f357" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">纪元12/50 250/250[= = = = = = = = = = = = = = = = = = = = = = = = = = = = = =]—33s 134 ms/step—loss:0.3900—ACC:0.8224—val _ loss:0.4950—val _ ACC:0.7827—lr:9.0484 e-04</p><p id="b465" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">纪元13/50 250/250[= = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =]—34s 134 ms/步—损耗:0.3767—ACC:0.8299—val _ loss:0.4581—val _ ACC:0.7877—lr:8.1873 e-04</p></blockquote><p id="7018" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">观察恒定的学习速率和10个周期后的变化，它实际上在<strong class="ih hj">第16个</strong>周期的<strong class="ih hj"> 50个周期</strong>之前就结束了训练。最后用的学习率是<strong class="ih hj"> LR: 8.1873e-04 </strong></p><p id="1235" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">最后一步:</strong></p><p id="804f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">评估模型</p><p id="b683" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">训练准确率为82%，验证准确率为78.7%</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mm"><img src="../Images/39343364d92e333ec5a32bcedce8b97d.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*3ZP7DmZ2a4eIQyq-RMLOXQ.png"/></div></figure><p id="de94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">训练损失为0.3767，验证损失为0.4581</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mn"><img src="../Images/51548d213a86b116f93a99872916486f.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*awhtNZEV6HG4uHAObhcrAg.png"/></div></figure><p id="614d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢你，为了想象你的回旋，请访问我以前的帖子</p><div class="mo mp ez fb mq mr"><a rel="noopener follow" target="_blank" href="/@krishshah99615/visualizing-convolution-neural-network-the-hidden-truth-c825d69f1832"><div class="ms ab dw"><div class="mt ab mu cl cj mv"><h2 class="bd hj fi z dy mw ea eb mx ed ef hh bi translated">可视化卷积神经网络[隐藏的真相]</h2><div class="my l"><h3 class="bd b fi z dy mw ea eb mx ed ef dx translated">对计算机视觉、深度学习感兴趣的人，这可能很有见地</h3></div><div class="mz l"><p class="bd b fp z dy mw ea eb mx ed ef dx translated">medium.com</p></div></div><div class="na l"><div class="nb l nc nd ne na nf jn mr"/></div></div></a></div><p id="2b67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这篇帖子对你有所帮助，快乐深度学习</p></div></div>    
</body>
</html>