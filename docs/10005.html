<html>
<head>
<title>Using Minikube for Local Deplyment of single node Kubernetes cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Minikube 进行单节点 Kubernetes 集群的本地部署</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/using-minikube-for-local-deplyment-of-single-node-kubernetes-cluster-25bb576d532b?source=collection_archive---------13-----------------------#2020-09-29">https://medium.com/analytics-vidhya/using-minikube-for-local-deplyment-of-single-node-kubernetes-cluster-25bb576d532b?source=collection_archive---------13-----------------------#2020-09-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/550d16653c3b8cccb73b46a8defcd04a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6zINvZwRec5Nc12i.png"/></div></div></figure><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es iq"><img src="../Images/c956760d2114d80bc601c6b99fed8795.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YfOYeYasY1vu3w1z.jpg"/></div></div></figure><p id="75b7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Kubernetes 是一个开源的容器编排平台，它自动化了许多涉及部署、管理和扩展容器化应用程序的手动过程。也被称为 k8s。</p><p id="7fad" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Kubernetes 最初是由谷歌开发和设计的，并于 2014 年开源。</p><p id="0cc3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Kubernetes 的优势:</p><ul class=""><li id="6610" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">跨多个主机编排容器。</li><li id="24aa" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">控制和自动化应用程序部署和更新。</li><li id="92b6" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">装载和添加存储以运行应用程序。</li><li id="133c" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">规模化容器化应用及其资源。</li><li id="2f4c" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">管理服务，保证部署的应用程序始终以您希望的方式运行。</li><li id="8d6a" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">通过自动放置、自动重启、自动复制和自动扩展，对您的应用进行运行状况检查和自我修复。</li></ul><p id="7b43" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Kubernetes 比 Swarm 复杂得多，需要更多的工作来部署。对于开发工作和较小的容器集群，Docker Swarm 提供了一个更简单的选择。</p><h2 id="2917" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">Kubernetes 建筑:Kubernetes 如何工作</h2><figure class="ir is it iu fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/580e2c4e91e65be689c473ee071bd88c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*cSwnQNtI9_BHCwYREpWEHw.png"/></div></figure><h2 id="c5c3" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated"><strong class="ak">主组件:</strong></h2><h2 id="160e" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">API 服务器</h2><p id="0f18" class="pw-post-body-paragraph iv iw hi ix b iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js hb bi translated">Kubernetes 是一个 API 服务器，它使用 API 提供集群上的所有操作。这基本上是一个切入点。</p><h2 id="d07d" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">控制器管理器</h2><p id="f728" class="pw-post-body-paragraph iv iw hi ix b iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js hb bi translated">该组件负责管理集群状态和执行任务的大多数收集器。</p><h2 id="dd68" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">调度程序</h2><p id="e69b" class="pw-post-body-paragraph iv iw hi ix b iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js hb bi translated">这是 Kubernetes master 的关键组件之一。它是 master 中的一项服务，负责分配工作负载。它负责跟踪集群节点上工作负载的利用率。</p><h2 id="7435" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">工作节点组件:</h2><ul class=""><li id="54ef" class="jt ju hi ix b iy ld jc le jg li jk lj jo lk js jy jz ka kb bi translated"><strong class="ix hj"> Kubelet: </strong> Kubelet 确保节点中的所有容器都在运行并处于健康状态。它还负责主节点和工作节点之间的通信。</li><li id="e09d" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><strong class="ix hj">容器:</strong>容器是最低级别的微服务，放置在 pod 内部，需要外部 IP 地址查看外部进程。</li><li id="e375" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">Kube 代理:它充当网络代理和负载平衡器。它将请求转发到集群中隔离网络上的正确 pod。</li></ul><p id="b2b3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以让我们从安装开始。在这个<a class="ae ll" href="https://docs.google.com/document/d/1-iC93GhUz1LvYAgjgDS6F3g01V0Vk2q4omTP_OifBkI/edit?usp=sharing" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj"> pdf </strong> </a> <strong class="ix hj"> </strong>中我已经添加了安装 docker、kubectl 和 minikube 的所有命令。</p><h2 id="34df" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">对于那些在虚拟机上工作的人:</h2><p id="7200" class="pw-post-body-paragraph iv iw hi ix b iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js hb bi translated">VirtualBox VM 上的 minikube 有一个问题:minikube 使用 VirtualBox 虚拟机管理程序进行虚拟化，因此需要主机上的 VT-X 支持。然而，VirtualBox 不支持 VT-X/AMD-v。这可以通过在主机上使用 vm-driver=none 选项和 Docker 来解决，并且至少分配 2 个 cpu 核心。</p><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/35848b778f81ae5ffda6617124ad9631.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pMIMjUFOdvQFU00xsuIBlA.png"/></div></div></figure><p id="4731" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们需要安装 conntrack 作为先决条件，使用</p><pre class="ir is it iu fd ln lo lp lq aw lr bi"><span id="f58d" class="kh ki hi lo b fi ls lt l lu lv">sudo apt-get install conntrack</span></pre><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/9d842542ee5e084bd87e66e6690264bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pONRbvf9FLeOUA_if2Jc7Q.png"/></div></div></figure><p id="56b5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Minikube 是开发面向 Kubernetes 的应用程序不可或缺的工具。</p><p id="98df" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要启动 minikube 使用</p><pre class="ir is it iu fd ln lo lp lq aw lr bi"><span id="28d2" class="kh ki hi lo b fi ls lt l lu lv">sudo minikube start --vm-driver=none</span></pre><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/416493ce3ff2b68f8afd8744702f1c68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HuARKYrAQrx5uuTY7L6fIQ.png"/></div></div></figure><h2 id="23c3" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">对于非虚拟机用户:</h2><pre class="ir is it iu fd ln lo lp lq aw lr bi"><span id="7c7c" class="kh ki hi lo b fi ls lt l lu lv">minikube start</span></pre><ol class=""><li id="dd90" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js ly jz ka kb bi translated">您可以输入<strong class="ix hj"> kubectl </strong>，如果您将看到所有可用的命令，这意味着“kubectl”正在工作。</li></ol><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/607dba993d2cdb9a34d6428dbd5a1f69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4HIxavrz4B4PYf5WtqKTFA.png"/></div></div></figure><p id="d999" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.验证 Minikube 正在运行。</p><pre class="ir is it iu fd ln lo lp lq aw lr bi"><span id="dedb" class="kh ki hi lo b fi ls lt l lu lv">sudo kubectl get node</span></pre><figure class="ir is it iu fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/1598b3ec2753e5b885c2ce41bdfb3039.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*FTVNu0BZM2egZHTVDNGj3A.png"/></div></figure><p id="8c39" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.现在我们开始在 Kubernetes 集群上进行部署。我们正在 docker hub 上部署一张<a class="ae ll" href="https://hub.docker.com/repository/docker/7985260261/magicalnginx" rel="noopener ugc nofollow" target="_blank"> docker 图片</a></p><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/84d96231251b8716720859ba982395a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aO0yhycbAvh2YnZmCFsFkA.png"/></div></div></figure><pre class="ir is it iu fd ln lo lp lq aw lr bi"><span id="f85d" class="kh ki hi lo b fi ls lt l lu lv">sudo kubectl create deployment &lt;Deployment_Name&gt; --image=&lt;Image_Name&gt;</span></pre><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/1cd352bd4124f80577e624740e177f17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w6ddvZr1inrDYXrzEjiKJA.png"/></div></div></figure><p id="801c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">4.获取正在运行的部署的信息</p><pre class="ir is it iu fd ln lo lp lq aw lr bi"><span id="919e" class="kh ki hi lo b fi ls lt l lu lv">sudo kubectl get deployments</span></pre><figure class="ir is it iu fd ij er es paragraph-image"><div class="er es md"><img src="../Images/5b261c00890084762a69a3dd82fbe65c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*Mjbk4tiSiFZvTQ2foIrMwQ.png"/></div></figure><p id="6125" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">5.获取正在运行的部署的完整描述</p><pre class="ir is it iu fd ln lo lp lq aw lr bi"><span id="6194" class="kh ki hi lo b fi ls lt l lu lv">sudo kubectl describe deployments magicalnginx</span></pre><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/143b6d7953f1db8f13fde75a65d8c425.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eErSpdU14WJDlEYWPu0Tig.png"/></div></div></figure><p id="d833" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">6.让 NGINX 容器可以通过互联网访问。</p><pre class="ir is it iu fd ln lo lp lq aw lr bi"><span id="4f21" class="kh ki hi lo b fi ls lt l lu lv">kubectl create service nodeport &lt;deployment_name&gt; --tcp=80:80</span></pre><p id="5701" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">7.运行以下命令以获取公开服务的 URL</p><pre class="ir is it iu fd ln lo lp lq aw lr bi"><span id="c045" class="kh ki hi lo b fi ls lt l lu lv">sudo kubectl get svc</span></pre><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/44d72b20cf44bb2b1fb779c5d1721b05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rJ5pZxeU96YEHIAQYtThtg.png"/></div></div></figure><p id="2b79" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">8.使用 curl 命令查看网页内容</p><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/04ffd45b0d80a3e152c3d8688fe2a0a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FQTOjVkTw4zNW1FGYBwPjA.png"/></div></div></figure><p id="b9d8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">9.Kubectl 命令:</p><ul class=""><li id="c657" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">要列出部署:<strong class="ix hj"> sudo kubectl get 部署</strong></li><li id="a5a0" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">删除服务:<strong class="ix hj">sudo ku bectl delete service magicalnginx</strong></li><li id="7e72" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">删除一个特定的部署:<strong class="ix hj">sudo ku bectl delete deployment magicalnginx</strong></li></ul><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es et"><img src="../Images/d135b9e5a851b6ab13bdff9473e1fade.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Ana60XFfQHr6enC_7mIpw.png"/></div></div></figure><ul class=""><li id="9a32" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">删除本地 Minikube 集群</li></ul><pre class="ir is it iu fd ln lo lp lq aw lr bi"><span id="ad6a" class="kh ki hi lo b fi ls lt l lu lv">sudo minikube delete</span></pre><p id="ed0b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在下一篇<a class="ae ll" rel="noopener" href="/@sarthak3398/using-kops-to-setup-up-kubernetes-cluster-f83d83139f6a">帖子</a>中，我将</p><h2 id="af18" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated"><strong class="ak">使用 Kops 在 AWS 上设置 Kubernetes 集群</strong></h2><p id="cb42" class="pw-post-body-paragraph iv iw hi ix b iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js hb bi translated">链接:<a class="ae ll" rel="noopener" href="/@sarthak3398/using-kops-to-setup-up-kubernetes-cluster-f83d83139f6a">https://medium . com/@ sarthak 3398/using-kops-to-setup-kubernetes-cluster-f83d 83139 f6a</a></p></div></div>    
</body>
</html>