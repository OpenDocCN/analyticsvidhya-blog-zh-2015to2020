<html>
<head>
<title>Learn AlphaGo &amp; Python (07)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习AlphaGo和Python (07)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/learn-alphago-python-07-95635d5f278a?source=collection_archive---------7-----------------------#2019-12-19">https://medium.com/analytics-vidhya/learn-alphago-python-07-95635d5f278a?source=collection_archive---------7-----------------------#2019-12-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hg hh ez fb hi hj er es paragraph-image"><div class="ab fe cl hk"><img src="../Images/4f9faf14d4f9871707f503db86e78de8.png" data-original-src="https://miro.medium.com/v2/format:webp/0*2j0SozSV1sDItjM-.png"/></div></figure><div class=""/><div class=""><h2 id="f396" class="pw-subtitle-paragraph im ho hp bd b in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd dx translated">人类对机器人，用Zobrist哈希加速游戏</h2></div><figure class="je jf jg jh fd hj er es paragraph-image"><div class="ab fe cl hk"><img src="../Images/7e14b112b1625e0ba2aa29c3605865df.png" data-original-src="https://miro.medium.com/v2/format:webp/0*AbaDkH7NpR501ac9.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">在这台mac上测试的代码</figcaption></figure><figure class="je jf jg jh fd hj er es paragraph-image"><div class="ab fe cl hk"><img src="../Images/cbc867ce686738a57d8f764ba1d00547.png" data-original-src="https://miro.medium.com/v2/format:webp/0*KcfsODNBaacReo_I.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">从这本书中学到的代码</figcaption></figure></div><div class="ab cl jm jn gp jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hb hc hd he hf"><p id="8caf" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">创建dlgo/utils.py，这样我们就可以移出电路板印刷代码等。来自bot_v_bot.py。</p><p id="6d2a" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">bot_v_bot.py:</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="7ce3" class="ku kv hp kq b fi kw kx l ky kz">from dlgo.agent import naive<br/>from dlgo import goboard_slow<br/>from dlgo import gotypes<br/>from dlgo.utils import print_board, print_move<br/>import time</span><span id="f1c7" class="ku kv hp kq b fi la kx l ky kz">def main():<br/>  board_size = 9<br/>  bots = {<br/>    gotypes.Player.black: naive.RandomBot(),<br/>    gotypes.Player.white: naive.RandomBot(),<br/>  }<br/>  game = goboard_slow.GameState.new_game(board_size)</span><span id="714b" class="ku kv hp kq b fi la kx l ky kz">while not game.is_over():<br/>    time.sleep(1.0)</span><span id="225a" class="ku kv hp kq b fi la kx l ky kz">print(chr(27) + "[2J")<br/>    print_board(game.board)<br/>    print()<br/>    bot_move = bots[game.next_player].select_move(game)<br/>    print_move(game.next_player, bot_move)<br/>    game = game.apply_move(bot_move)</span><span id="69c3" class="ku kv hp kq b fi la kx l ky kz">if __name__ == '__main__':<br/>  main()</span></pre><p id="c919" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">创建dlgo/utils.py:</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="9fd9" class="ku kv hp kq b fi kw kx l ky kz">🐍 vim dlgo/utils.py</span></pre><p id="0564" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">dlgo/utils.py</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="b84e" class="ku kv hp kq b fi kw kx l ky kz">from dlgo import gotypes<br/>  <br/>COLS = 'ABCDEFGHJKLMNOPQRST'<br/>STONE_TO_CHAR = {<br/>  None: '. ',<br/>  gotypes.Player.black: 'x ',<br/>  gotypes.Player.white: 'o ',<br/>}</span><span id="d5cc" class="ku kv hp kq b fi la kx l ky kz">def print_move(player, move):<br/>  if move.is_pass:<br/>    move_str = 'passes'<br/>  elif move.is_resign:<br/>    move_str = 'resigns'<br/>  else:<br/>    move_str = '%s%d' % (COLS[move.point.col - 1], move.point.row)<br/>  print('%s %s' % (player, move_str))</span><span id="4533" class="ku kv hp kq b fi la kx l ky kz">def print_board(board):<br/>  for row in range(board.num_rows, 0, -1):<br/>    bump = " " if row &lt;= 9 else ""<br/>    line = []<br/>    for col in range(1, board.num_cols + 1):<br/>      stone = board.get(gotypes.Point(row=row, col=col))<br/>      line.append(STONE_TO_CHAR[stone])<br/>    print('%s%d %s' % (bump, row, ''.join(line)))<br/>  print('   ' + ' '.join(COLS[:board.num_cols]))</span></pre></div><div class="ab cl jm jn gp jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hb hc hd he hf"><p id="645c" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">创建human_v_bot.py，这样人类就可以玩bot了。我们需要先在dlgo/utils.py中添加一个函数<code class="du lb lc ld kq b">point_from_coords(coords)</code>。</p><p id="05e3" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">dlgo/utils.py</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="3d73" class="ku kv hp kq b fi kw kx l ky kz">from dlgo import gotypes<br/>  <br/>COLS = 'ABCDEFGHJKLMNOPQRST'<br/>STONE_TO_CHAR = {<br/>  None: '. ',<br/>  gotypes.Player.black: 'x ',<br/>  gotypes.Player.white: 'o ',<br/>}</span><span id="ee04" class="ku kv hp kq b fi la kx l ky kz">def print_move(player, move):<br/>  if move.is_pass:<br/>    move_str = 'passes'<br/>  elif move.is_resign:<br/>    move_str = 'resigns'<br/>  else:<br/>    move_str = '%s%d' % (COLS[move.point.col - 1], move.point.row)<br/>  print('%s %s' % (player, move_str))</span><span id="e4e2" class="ku kv hp kq b fi la kx l ky kz">def print_board(board):<br/>  for row in range(board.num_rows, 0, -1):<br/>    bump = " " if row &lt;= 9 else ""<br/>    line = []<br/>    for col in range(1, board.num_cols + 1):<br/>      stone = board.get(gotypes.Point(row=row, col=col))<br/>      line.append(STONE_TO_CHAR[stone])<br/>    print('%s%d %s' % (bump, row, ''.join(line)))<br/>  print('   ' + ' '.join(COLS[:board.num_cols]))</span><span id="2acc" class="ku kv hp kq b fi la kx l ky kz"><strong class="kq hq">def point_from_coords(coords):<br/>  col = COLS.index(coords[0]) + 1<br/>  row = int(coords[1:])<br/>  return gotypes.Point(row=row, col=col)</strong></span><span id="d8f6" class="ku kv hp kq b fi la kx l ky kz">🐍 vim human_v_bot.py</span></pre><p id="f0c6" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">human_v_bot.py</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="22bf" class="ku kv hp kq b fi kw kx l ky kz">from dlgo.agent import naive<br/>from dlgo import goboard_slow<br/>from dlgo import gotypes<br/>from dlgo.utils import print_board, print_move, point_from_coords</span><span id="9faf" class="ku kv hp kq b fi la kx l ky kz">def main():<br/>  board_size = 9<br/>  game = goboard_slow.GameState.new_game(board_size)<br/>  bot = naive.RandomBot()</span><span id="f4e0" class="ku kv hp kq b fi la kx l ky kz">while not game.is_over():<br/>    print(chr(27) + "[2J")<br/>    print_board(game.board)<br/>    if game.next_player == gotypes.Player.black:<br/>      human_move = input('-- ')<br/>      point = point_from_coords(human_move.strip())<br/>      move = goboard_slow.Move.play(point)<br/>    else:<br/>      move = bot.select_move(game)<br/>    print_move(game.next_player, move)<br/>    game = game.apply_move(move)</span><span id="e1b9" class="ku kv hp kq b fi la kx l ky kz">if __name__ == '__main__':<br/>  main()</span></pre><p id="1e10" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">现在我们可以和我们的机器人比赛了。</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="fe54" class="ku kv hp kq b fi kw kx l ky kz">🐍 python3 human_v_bot.py</span><span id="59cc" class="ku kv hp kq b fi la kx l ky kz"> 9 . . . . . . . o . <br/> 8 . . . . . . . . . <br/> 7 . . . . . . . . . <br/> 6 . . . . . . . . . <br/> 5 . . . x . . . . . <br/> 4 . . . . . . . . . <br/> 3 . . . . . . . . . <br/> 2 . . . . . . . . . <br/> 1 . . . . . . . . . <br/>   A B C D E F G H J<br/>-- G4</span></pre></div><div class="ab cl jm jn gp jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hb hc hd he hf"><p id="ee3e" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">创建zobrist散列来提高性能。将dlgo/goboard_slow.py重命名为dlgo/goboard.py</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="73e6" class="ku kv hp kq b fi kw kx l ky kz">🐍 mv dlgo/goboard_slow.py dlgo/goboard.py</span></pre><p id="e6bd" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">创建generate_zobrist_hashes.py生成zobrist hash，保存在文件dlgo/zobrist.py中，有19 * 19 * 2 = 722个hash条目。</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="158b" class="ku kv hp kq b fi kw kx l ky kz">🐍 vim generate_zobrist_hashes.py<br/>🐍 python3 generate_zobrist_hashes.py &gt; dlgo/zobrist.py<br/>🐍 wc -l dlgo/zobrist.py <br/>     730 dlgo/zobrist.py</span></pre><p id="2506" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">generate_zobrist_hashes.py</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="788a" class="ku kv hp kq b fi kw kx l ky kz">import random<br/>  <br/>from dlgo.gotypes import Player, Point</span><span id="e01b" class="ku kv hp kq b fi la kx l ky kz">def to_python(player_state):<br/>  if player_state is None:<br/>    return 'None'<br/>  if player_state == Player.black:<br/>    return Player.black<br/>  return Player.white</span><span id="5f80" class="ku kv hp kq b fi la kx l ky kz">MAX63 = 0x7fffffffffffffff</span><span id="198f" class="ku kv hp kq b fi la kx l ky kz">table = {}<br/>empty_board = 0<br/>for row in range(1, 20):<br/>  for col in range(1, 20):<br/>    for state in (Player.black, Player.white):<br/>      code = random.randint(0, MAX63)<br/>      table[Point(row, col), state] = code</span><span id="3f80" class="ku kv hp kq b fi la kx l ky kz">print('from .gotypes import Player, Point')<br/>print('')<br/>print("__all__ = ['HASH_CODE', 'EMPTY_BOARD']")<br/>print('')<br/>print('HASH_CODE = {')<br/>for (pt, state), hash_code in table.items():<br/>  print(' (%r, %s): %r,' % (pt, to_python(state), hash_code))<br/>print('}')<br/>print('')<br/>print('EMPTY_BOARD = %d' % (empty_board,))</span></pre><p id="c4ed" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">显示dlgo/zobrist.py的前20行:</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="a67a" class="ku kv hp kq b fi kw kx l ky kz">🐍 head -n 20 dlgo/zobrist.py</span></pre><p id="aa69" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">dlgo/zobrist.py的前20行:</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="71e4" class="ku kv hp kq b fi kw kx l ky kz">from .gotypes import Player, Point</span><span id="4023" class="ku kv hp kq b fi la kx l ky kz">__all__ = ['HASH_CODE', 'EMPTY_BOARD']</span><span id="3c85" class="ku kv hp kq b fi la kx l ky kz">HASH_CODE = {<br/> (Point(row=1, col=1), Player.black): 1743318457860286132,<br/> (Point(row=1, col=1), Player.white): 6077592620268640577,<br/> (Point(row=1, col=2), Player.black): 5247304070065423072,<br/> (Point(row=1, col=2), Player.white): 3396283731204976049,<br/> (Point(row=1, col=3), Player.black): 8022707334311970093,<br/> (Point(row=1, col=3), Player.white): 2105848293139671387,<br/> (Point(row=1, col=4), Player.black): 1699706885907749284,<br/> (Point(row=1, col=4), Player.white): 3230500686802259798,<br/> (Point(row=1, col=5), Player.black): 7389518629523105701,<br/> (Point(row=1, col=5), Player.white): 7464805636137369601,<br/> (Point(row=1, col=6), Player.black): 959081238933504817,<br/> (Point(row=1, col=6), Player.white): 6047429569262711179,<br/> (Point(row=1, col=7), Player.black): 6961206778848968522,<br/> (Point(row=1, col=7), Player.white): 4609973287293947835,<br/> (Point(row=1, col=8), Player.black): 7590471621530264626,</span></pre><p id="7a41" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">显示dlgo/zobrist.py的最后20行:</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="2494" class="ku kv hp kq b fi kw kx l ky kz">🐍 tail -n 20 dlgo/zobrist.py</span></pre><p id="9e6e" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">dlgo/zobrist.py的最后20行:</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="aadd" class="ku kv hp kq b fi kw kx l ky kz"> (Point(row=19, col=11), Player.white): 7731002159384008752,<br/> (Point(row=19, col=12), Player.black): 8926271898120833506,<br/> (Point(row=19, col=12), Player.white): 3737940356998393611,<br/> (Point(row=19, col=13), Player.black): 6855143523350797896,<br/> (Point(row=19, col=13), Player.white): 3998144684427552885,<br/> (Point(row=19, col=14), Player.black): 1583619279007959424,<br/> (Point(row=19, col=14), Player.white): 8656479320519039671,<br/> (Point(row=19, col=15), Player.black): 7450373251714384625,<br/> (Point(row=19, col=15), Player.white): 1431220503631063432,<br/> (Point(row=19, col=16), Player.black): 3445681469884545256,<br/> (Point(row=19, col=16), Player.white): 1266150490074752899,<br/> (Point(row=19, col=17), Player.black): 2266936888251877784,<br/> (Point(row=19, col=17), Player.white): 2683496064820486440,<br/> (Point(row=19, col=18), Player.black): 8082726413353721878,<br/> (Point(row=19, col=18), Player.white): 6349636703857523885,<br/> (Point(row=19, col=19), Player.black): 8589908489541376170,<br/> (Point(row=19, col=19), Player.white): 6874551449332124093,<br/>}</span><span id="701d" class="ku kv hp kq b fi la kx l ky kz">EMPTY_BOARD = 0</span></pre></div><div class="ab cl jm jn gp jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hb hc hd he hf"><p id="4975" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">将dlgo/agent/naive.py中的“dlgo.goboard_slow”改为“dlgo.goboard”。</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="5e76" class="ku kv hp kq b fi kw kx l ky kz">🐍 git diff dlgo/agent/naive.py <br/>diff --git a/dlgo/agent/naive.py b/dlgo/agent/naive.py<br/>index 642957f..bfcc81a 100644<br/>--- a/dlgo/agent/naive.py<br/>+++ b/dlgo/agent/naive.py<br/>@@ -2,7 +2,7 @@ import random<br/> from dlgo.agent.base import Agent<br/> from dlgo.agent.helpers import is_point_an_eye<br/> from dlgo import gotypes<br/>-from dlgo.goboard_slow import Move<br/>+from dlgo.goboard import Move<br/> <br/> class RandomBot(Agent):<br/>   def select_move(self, game_state):<br/>🐍</span></pre><p id="ad39" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">在dlgo/goboard.py中使用zobrist.py哈希。</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="7daf" class="ku kv hp kq b fi kw kx l ky kz">import copy<br/>from dlgo.gotypes import Player<br/>from dlgo import zobrist</span><span id="aa55" class="ku kv hp kq b fi la kx l ky kz">class Move():<br/>  def __init__(self, point=None, is_pass=False, is_resign=False):<br/>    assert (point is not None) ^ is_pass ^ is_resign<br/>    self.point = point<br/>    self.is_play = (self.point is not None)<br/>    self.is_pass = is_pass<br/>    self.is_resign = is_resign</span><span id="7d97" class="ku kv hp kq b fi la kx l ky kz">  @classmethod<br/>  def play(cls, point):<br/>    return Move(point=point)</span><span id="ed3e" class="ku kv hp kq b fi la kx l ky kz">  @classmethod<br/>  def pass_turn(cls):<br/>    return Move(is_pass=True)</span><span id="177a" class="ku kv hp kq b fi la kx l ky kz">  @classmethod<br/>  def resign(cls):<br/>    return Move(is_resign=True)</span><span id="7750" class="ku kv hp kq b fi la kx l ky kz">class Board():<br/>  def __init__(self, num_rows, num_cols):<br/>    self.num_rows = num_rows<br/>    self.num_cols = num_cols<br/>    self._grid = {}<br/>    <strong class="kq hq">self._hash = zobrist.EMPTY_BOARD</strong></span><span id="4bd1" class="ku kv hp kq b fi la kx l ky kz">  def place_stone(self, player, point):<br/>    assert self.is_on_grid(point)<br/>    assert self._grid.get(point) is None<br/>    adjacent_same_color = []<br/>    adjacent_opposite_color = []<br/>    liberties = []<br/>    for neighbor in point.neighbors():<br/>      if not self.is_on_grid(neighbor):<br/>        continue<br/>      neighbor_string = self._grid.get(neighbor)<br/>      if neighbor_string is None:<br/>        liberties.append(neighbor)<br/>      elif neighbor_string.color == player:<br/>        if neighbor_string not in adjacent_same_color:<br/>          adjacent_same_color.append(neighbor_string)<br/>      else:<br/>        if neighbor_string not in adjacent_opposite_color:<br/>          adjacent_opposite_color.append(neighbor_string)<br/>    new_string = GoString(player, [point], liberties)</span><span id="cee8" class="ku kv hp kq b fi la kx l ky kz">    for same_color_string in adjacent_same_color:<br/>      new_string = new_string.merged_with(same_color_string)<br/>    for new_string_point in new_string.stones:<br/>      self._grid[new_string_point] = new_string</span><span id="400b" class="ku kv hp kq b fi la kx l ky kz">    <strong class="kq hq">self._hash ^= zobrist.HASH_CODE[point, player]</strong></span><span id="ef9f" class="ku kv hp kq b fi la kx l ky kz">    for other_color_string in adjacent_opposite_color:<br/>      <strong class="kq hq">replacement = other_color_string.without_liberty(point)<br/>      if replacement.num_liberties:<br/>        self._replace_string(replacement)<br/>      else:<br/>        self._remove_string(other_color_string)</strong></span><span id="c6b6" class="ku kv hp kq b fi la kx l ky kz"><strong class="kq hq">  def _replace_string(self, new_string):<br/>    for point in new_string.stones:<br/>      self._grid[point] = new_string</strong></span><span id="5a0a" class="ku kv hp kq b fi la kx l ky kz">  def _remove_string(self, string):<br/>    for point in string.stones:<br/>      for neighbor in point.neighbors():<br/>        neighbor_string = self._grid.get(neighbor)<br/>        if neighbor_string is None:<br/>          continue<br/>        <strong class="kq hq">if neighbor_string is not string:<br/>          self._replace_string(neighbor_string.with_liberty(point))<br/>      self._grid[point] = None</strong></span><span id="0776" class="ku kv hp kq b fi la kx l ky kz"><strong class="kq hq">      self._hash ^= zobrist.HASH_CODE[point, string.color]</strong></span><span id="ea52" class="ku kv hp kq b fi la kx l ky kz">  def is_on_grid(self, point):<br/>    return 1 &lt;= point.row &lt;= self.num_rows and \<br/>           1 &lt;= point.col &lt;= self.num_cols</span><span id="919f" class="ku kv hp kq b fi la kx l ky kz">  def get(self, point):<br/>    string = self._grid.get(point)<br/>    if string is None:<br/>      return None<br/>    return string.color</span><span id="cb65" class="ku kv hp kq b fi la kx l ky kz">  def get_go_string(self, point):<br/>    string = self._grid.get(point)<br/>    if string is None:<br/>      return None<br/>    return string</span><span id="9a8f" class="ku kv hp kq b fi la kx l ky kz">  <strong class="kq hq">def zobrist_hash(self):<br/>    return self._hash</strong></span><span id="367b" class="ku kv hp kq b fi la kx l ky kz">class GameState():<br/>  def __init__(self, board, next_player, previous, move):<br/>    self.board = board<br/>    self.next_player = next_player<br/>    self.previous_state = previous<br/>    if self.previous_state is None:<br/>      self.previous_states = frozenset()<br/>    else:<br/>      self.previous_states = frozenset(previous.previous_states |<br/>        {(previous.next_player, previous.board.zobrist_hash())})<br/>    self.last_move = move</span><span id="abbe" class="ku kv hp kq b fi la kx l ky kz">  def apply_move(self, move):<br/>    if move.is_play:<br/>      next_board = copy.deepcopy(self.board)<br/>      next_board.place_stone(self.next_player, move.point)<br/>    else:<br/>      next_board = self.board<br/>    return GameState(next_board, self.next_player.other, self, move)</span><span id="81c8" class="ku kv hp kq b fi la kx l ky kz">  @classmethod<br/>  def new_game(cls, board_size):<br/>    if isinstance(board_size, int):<br/>      board_size = (board_size, board_size)<br/>    board = Board(*board_size)<br/>    return GameState(board, Player.black, None, None)</span><span id="23ec" class="ku kv hp kq b fi la kx l ky kz">  def is_over(self):<br/>    if self.last_move is None:<br/>      return False<br/>    if self.last_move.is_resign:<br/>      return True<br/>    second_last_move = self.previous_state.last_move<br/>    if second_last_move is None:<br/>      return False<br/>    return self.last_move.is_pass and second_last_move.is_pass</span><span id="39fd" class="ku kv hp kq b fi la kx l ky kz">  def is_move_self_capture(self, player, move):<br/>    if not move.is_play:<br/>      return False<br/>    next_board = copy.deepcopy(self.board)<br/>    next_board.place_stone(player, move.point)<br/>    new_string = next_board.get_go_string(move.point)<br/>    return new_string.num_liberties == 0</span><span id="def1" class="ku kv hp kq b fi la kx l ky kz">  def does_move_violate_ko(self, player, move):<br/>    if not move.is_play:<br/>      return False<br/>    next_board = copy.deepcopy(self.board)<br/>    next_board.place_stone(player, move.point)<br/>    <strong class="kq hq">next_situation = (player.other, next_board.zobrist_hash())<br/>    return next_situation in self.previous_states</strong></span><span id="9328" class="ku kv hp kq b fi la kx l ky kz">  def is_valid_move(self, move):<br/>    if self.is_over():<br/>      return False<br/>    if move.is_pass or move.is_resign:<br/>      return True<br/>    return (<br/>      self.board.get(move.point) is None and<br/>      not self.is_move_self_capture(self.next_player, move) and<br/>      not self.does_move_violate_ko(self.next_player, move))</span><span id="6dc6" class="ku kv hp kq b fi la kx l ky kz">class GoString():<br/>  def __init__(self, color, stones, liberties):<br/>    self.color = color<br/>    self.stones = frozenset(stones)<br/>    self.liberties = frozenset(liberties)</span><span id="0e94" class="ku kv hp kq b fi la kx l ky kz">  def without_liberty(self, point):<br/>    new_liberties = self.liberties - set([point])<br/>    return GoString(self.color, self.stones, new_liberties)</span><span id="82f8" class="ku kv hp kq b fi la kx l ky kz">  def with_liberty(self, point):<br/>    new_liberties = self.liberties | set([point])<br/>    return GoString(self.color, self.stones, new_liberties)</span><span id="f09a" class="ku kv hp kq b fi la kx l ky kz">  def merged_with(self, go_string):<br/>    assert go_string.color == self.color<br/>    combined_stones = self.stones | go_string.stones<br/>    return GoString(self.color, combined_stones,<br/>      (self.liberties | go_string.liberties) - combined_stones)</span><span id="b340" class="ku kv hp kq b fi la kx l ky kz">  @property<br/>  def num_liberties(self):<br/>    return len(self.liberties)</span><span id="4a90" class="ku kv hp kq b fi la kx l ky kz">  def __eq__(self, other):<br/>    return isinstance(other, GoString) and \<br/>      self.color == other.color and \<br/>      self.stones == other.stones and \<br/>      self.liberties == other.liberties</span></pre><p id="9efb" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">玩机器人大战机器人看看性能提高。</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="133d" class="ku kv hp kq b fi kw kx l ky kz">🐍 python3 bot_v_bot.py</span><span id="228e" class="ku kv hp kq b fi la kx l ky kz"> 9 . x x o o o o o o <br/> 8 x x x o o . o . o <br/> 7 x x . x o o x o o <br/> 6 . x x x x x x o o <br/> 5 x x x o o o o o . <br/> 4 x . x x o x o o o <br/> 3 . x x x x x o . o <br/> 2 x x x x x o o o o <br/> 1 x . x . x o o o . <br/>   A B C D E F G H J</span><span id="38ce" class="ku kv hp kq b fi la kx l ky kz">Player.white passes<br/>🐍</span></pre></div><div class="ab cl jm jn gp jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hb hc hd he hf"><p id="f320" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated"><a class="ae le" href="https://github.com/zhijunsheng/go-py/commits/develop" rel="noopener ugc nofollow" target="_blank">源代码</a></p></div><div class="ab cl jm jn gp jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hb hc hd he hf"><p id="90ee" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated"><a class="ae le" rel="noopener" href="/@zhijunsheng/learn-alphago-python-01-96d360468042?source=friends_link&amp;sk=3a5637ebac3916b285124eaa59407bd6">学习AlphaGo &amp; Python (01) </a></p><p id="03a7" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated"><a class="ae le" rel="noopener" href="/@zhijunsheng/learn-alphago-python-02-8fd82d311f4d?source=friends_link&amp;sk=e8e31cd2ca3fe97a29fe1d9129b0b54e">学习AlphaGo &amp; Python (02) </a></p><p id="29c4" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated"><a class="ae le" rel="noopener" href="/@zhijunsheng/learn-alphago-python-03-c5a602fe584d?source=friends_link&amp;sk=d96741134456aceb7b4745f70f92d4e3">学习AlphaGo &amp; Python (03) </a></p><p id="afe6" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated"><a class="ae le" rel="noopener" href="/@zhijunsheng/learn-alphago-python-04-ed9d6713bcd6?sk=a9a0572ef5c2bf7b1bd36d92cabfd20c">学习AlphaGo &amp; Python (04) </a></p><p id="2bbd" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated"><a class="ae le" rel="noopener" href="/@zhijunsheng/learn-alphago-python-05-55b1f6979cc8?sk=3774fca42b4bddfd7128a57999086dcd">学习AlphaGo &amp; Python (05) </a></p><p id="01eb" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated"><a class="ae le" rel="noopener" href="/@zhijunsheng/learn-alphago-python-06-1420783eb748?sk=6dc7c6e825b56b9d23e26b557e7514e9">学习AlphaGo &amp; Python (06) </a></p><p id="0771" class="pw-post-body-paragraph jt ju hp jv b jw jx iq jy jz ka it kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated"><a class="ae le" rel="noopener" href="/@zhijunsheng/learn-alphago-python-07-95635d5f278a?sk=1357b105fab52b220246c832fb72602f">学习AlphaGo &amp; Python(07) </a></p></div></div>    
</body>
</html>