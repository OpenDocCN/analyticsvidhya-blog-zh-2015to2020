<html>
<head>
<title>Get rid of SSL errors with Jupyter Notebooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Jupyter笔记本消除SSL错误</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/get-rid-of-ssl-errors-with-jupyter-notebooks-1a80dd509988?source=collection_archive---------9-----------------------#2019-11-18">https://medium.com/analytics-vidhya/get-rid-of-ssl-errors-with-jupyter-notebooks-1a80dd509988?source=collection_archive---------9-----------------------#2019-11-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="e9ea" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">问题</h1><p id="bfef" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">每当我启动一个新的会话，连接到我的jupyter笔记本时，看到“您的连接不是私人的”的错误/警告，我觉得很烦。我总是需要额外点击几次才能进入我的笔记本。如果你想解决这个问题，那么这个方法就是给你的。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kb"><img src="../Images/31dde27a0219caae2554e90f107e87a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NZFshuFDuLeozHFN49Ilow.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">Safari中的警告</figcaption></figure><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kr"><img src="../Images/60e0e12937d0907673a1e7e1020ff57e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sr6esFOdZKSKNux5Cr9yHA.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">用铬警告</figcaption></figure><p id="369c" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated"><strong class="jf hj">T1】免责声明T3】</strong></p><p id="050d" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated"><em class="kx">不要在生产系统中使用这种方法。这种方法更适合需要快速和肮脏的jupyter笔记本来测试他们的想法和模型的数据科学家。对于生产系统，使用有效的CA或使用letsencrypt。</em></p><h1 id="3c33" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">形势</h1><p id="f3fc" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我先简述一下我的情况。我有一台定制的深度学习pc，上面安装了ubuntu (19.10)。我的jupyter笔记本在这台ubuntu机器上运行，这台机器托管在我自己的家庭网络中。我还通过动态dns跟踪我的家庭公共IP地址，这样我就可以从互联网远程连接到我的jupyter笔记本电脑。我大部分时间都是通过macbook pro连接这个jupyter笔记本。有时在我自己的家庭网络中(使用本地ip ),有时从远程位置使用我的动态dns (DDNS)主机名。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ky"><img src="../Images/e6688238b0795f79e45ec5e907246df7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pcEzPK7qzLMhzVphy_nMMQ.png"/></div></div></figure><h1 id="11ca" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">1)如果尚未安装openssl，请安装它。</h1><p id="2650" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在我的ubuntu系统上已经安装了。如果没有，您可以使用命令安装它:</p><pre class="kc kd ke kf fd kz la lb lc aw ld bi"><span id="bd1c" class="le ig hi la b fi lf lg l lh li"><strong class="la hj">sudo apt install openssl </strong></span></pre><h1 id="232c" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">2)修改macbook上的主机文件</h1><p id="fcd3" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">证书与完全合格的域名(FQDN)一起工作，例如www.amazon.com<a class="ae lj" href="http://www.amazon.com." rel="noopener ugc nofollow" target="_blank">而不是IP地址。因为我们想在我们的本地网络上建立这一点，我们需要在我们的macbook上编辑我们的主机文件。如果您已经为您的深度学习机器提供了主机名，您可以使用该名称。我的主机名= deeplearn，它的ip = 192.168.1.20</a></p><p id="cb75" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">使用vi或nano从您的终端调整macbook上的主机文件，如下所示:</p><pre class="kc kd ke kf fd kz la lb lc aw ld bi"><span id="8052" class="le ig hi la b fi lf lg l lh li">sudo vi /etc/hosts</span></pre><p id="0d9c" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">并将这一行添加到该文件中:</p><pre class="kc kd ke kf fd kz la lb lc aw ld bi"><span id="6b6f" class="le ig hi la b fi lf lg l lh li">192.168.1.20 deeplearn.local</span></pre><p id="2572" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">现在，您可以通过ping来测试该主机名:</p><pre class="kc kd ke kf fd kz la lb lc aw ld bi"><span id="f144" class="le ig hi la b fi lf lg l lh li">ping deeplearn.local</span></pre><h1 id="54ad" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">3)生成私钥和自签名证书</h1><p id="a2ba" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在我们将在我们的深度学习机器上生成我们的私钥和我们的证书。创建一个目录。ssl，这样我们可以将文件保存在这个新创建的目录中:</p><pre class="kc kd ke kf fd kz la lb lc aw ld bi"><span id="a0f7" class="le ig hi la b fi lf lg l lh li">mkdir ~/.ssl <br/>cd ~/.ssl</span></pre><p id="a212" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">由于我们希望匹配来自互联网(ddns主机名+域= deeplearn.chickenkiller.com)和本地网络(deeplearn.local)的主机，我们需要将这两个名称添加到distinguished_name字段中:</p><p id="155c" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">subject altname = DNS:<strong class="jf hj">deep learn . local</strong>，DNS:<strong class="jf hj">deeplearn.chickenkiller.com</strong></p><p id="c486" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">我们创建它的命令是:</p><pre class="kc kd ke kf fd kz la lb lc aw ld bi"><span id="34d4" class="le ig hi la b fi lf lg l lh li">openssl req -x509 -out deeplearn.crt -days 365 \<br/>-keyout deeplearn.key -newkey rsa:2048 -nodes -sha256 \<br/> -subj ‘/CN=<strong class="la hj">deeplearn.local</strong>’ -extensions EXT -config &lt;( \<br/> printf “[dn]\nCN=<strong class="la hj">deeplearn.local</strong>\n[req]\ndistinguished_name = dn\n[EXT]\nsubjectAltName=DNS:<strong class="la hj">deeplearn.local</strong>,DNS:<strong class="la hj">deeplearn.chickenkiller.com</strong>\nkeyUsage=digitalSignature\nextendedKeyUsage=serverAuth”)</span></pre><p id="5b26" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">对于jupyter笔记本电脑，我们还需要不同格式的证书(PEM而不是CRT)。执行此操作的方法是使用以下命令:</p><pre class="kc kd ke kf fd kz la lb lc aw ld bi"><span id="fc0c" class="le ig hi la b fi lf lg l lh li">openssl x509 -in <strong class="la hj">deeplearn.crt</strong> -out <strong class="la hj">deeplearn.pem</strong> -outform PEM</span></pre><p id="1ec2" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">现在你将有3个文件在你的。<strong class="jf hj"> ssl </strong>目录:</p><pre class="kc kd ke kf fd kz la lb lc aw ld bi"><span id="dd71" class="le ig hi la b fi lf lg l lh li">deeplearn.crt<br/>deeplearn.key<br/>deeplearn.pem</span></pre><h1 id="f0e2" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">4)在您的macbook上安装证书</h1><p id="d229" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">将证书deeplearn.crt下载到您的macbook上。用Finder打开文件并双击它。您将看到以下窗口:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lk"><img src="../Images/79887da91cf14f6c3cff215f65016d24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*axS1vxMODU0HPmwtbxwxTA.png"/></div></div></figure><p id="0533" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">确定在钥匙串下拉菜单中选择了“系统”,然后点按“添加”。现在你需要给出你的mac证书，你的证书将被添加到你的根证书中。</p><p id="9929" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">现在，通过Launchpad打开“钥匙串访问”应用程序，点击左侧的“系统”钥匙串，找到您的证书:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ll"><img src="../Images/99b2a4491c8390924d208727936c8d59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D6ZJ28_ACOi3boTBh6YDPg.png"/></div></div></figure><p id="fa08" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">双击该证书，展开“信任”三角形。它看起来会像这样:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lm"><img src="../Images/e1932eb1bd5ffb124dc13c28a165bbc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kJwd1iJR9g_m6UG5KhCsAw.png"/></div></div></figure><p id="2faa" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">从“使用此证书时”菜单的下拉菜单中选择“<strong class="jf hj">始终信任</strong>”并关闭窗口。它会再次询问您的mac凭据。现在，您的macos信任您的证书。</p><h1 id="2bdf" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">5)让Jupyter笔记本使用此证书</h1><p id="cf4c" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在，您可以使用这个新创建的证书运行jupyter笔记本，轻松测试您的设置:</p><pre class="kc kd ke kf fd kz la lb lc aw ld bi"><span id="cea3" class="le ig hi la b fi lf lg l lh li">jupyter notebook --certfile=~/.ssl/deeplearn.pem --keyfile=~/.ssl/deeplearn.key</span></pre><p id="9240" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">现在，通过将浏览器定向到笔记本的url(如https://deeplearn.local:8888)，从macbook测试证书是否有任何错误。应该能行。如果有效，那么您可以修改jupyter配置文件，这样您就不需要在每个新的jupyter命令后给出这些参数:</p><pre class="kc kd ke kf fd kz la lb lc aw ld bi"><span id="1adc" class="le ig hi la b fi lf lg l lh li">vi ~/.jupyter/jupyter_notebook_config.py</span></pre><p id="f2c3" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">并确保这两行指向正确的证书文件:</p><pre class="kc kd ke kf fd kz la lb lc aw ld bi"><span id="b509" class="le ig hi la b fi lf lg l lh li">c.NotebookApp.certfile = ‘/home/<strong class="la hj">your_username</strong>/.ssl/deeplearn.pem’<br/>c.NotebookApp.keyfile  = ‘/home/<strong class="la hj">your_username</strong>/.ssl/deeplearn.key’</span></pre><p id="5454" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">确保上面的<strong class="jf hj">你的_用户名</strong>是你在深度学习机器上的用户名。现在，您可以通过执行以下命令来打开jupyter笔记本:</p><pre class="kc kd ke kf fd kz la lb lc aw ld bi"><span id="e112" class="le ig hi la b fi lf lg l lh li">jupyter notebook</span></pre><p id="5562" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated"><em class="kx">如果你找不到上面的配置文件，这意味着它从未被创建过。您可以使用以下命令创建一个:</em></p><pre class="kc kd ke kf fd kz la lb lc aw ld bi"><span id="8750" class="le ig hi la b fi lf lg l lh li"><em class="kx">jupyter notebook --generate-config</em></span></pre><p id="964b" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated"><em class="kx">在该命令之后，您可以按照描述修改配置。</em></p><h1 id="c18f" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">6)享受</h1></div></div>    
</body>
</html>