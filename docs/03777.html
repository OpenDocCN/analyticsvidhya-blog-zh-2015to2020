<html>
<head>
<title>Auto Price Prediction from Scratch! Part 3: Feature Engineering</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">汽车价格预测从零开始！第3部分:特征工程</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/auto-price-prediction-from-scratch-part-3-feature-engineering-a903e2509643?source=collection_archive---------14-----------------------#2020-02-18">https://medium.com/analytics-vidhya/auto-price-prediction-from-scratch-part-3-feature-engineering-a903e2509643?source=collection_archive---------14-----------------------#2020-02-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/265426bdee9d5914dc0e0618fd87a769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AvUst0I80pO4s0lFTRJCrg.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="caa2" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated">为数据建模构建要素</h2></div><p id="de4d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我们想预测汽车价格。但是，我们没有数据——我们是从零开始。<a class="ae ke" rel="noopener" href="/analytics-vidhya/auto-price-prediction-from-scratch-part-2-data-collection-and-cleaning-a147b6375b2f"> <strong class="jk hu">在第二部分:数据收集和清洗</strong> </a>中，我们从web中提取并清洗数据。现在我们设计新的令人兴奋的功能！我们还使用一种被忽略的技术来编码分类数据。</p><p id="4b6f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">这是我们汽车价格预测项目的下一篇文章。请看<a class="ae ke" rel="noopener" href="/analytics-vidhya/auto-price-prediction-from-scratch-part-1-overview-a4f331aaad00"> <strong class="jk hu"> Part1:概述</strong> </a>了解大图。</p><h1 id="3b13" class="kf kg ht bd kh ki kj kk kl km kn ko kp iz kq ja kr jc ks jd kt jf ku jg kv kw bi translated">汽车功能概述</h1><p id="8343" class="pw-post-body-paragraph ji jj ht jk b jl kx iu jn jo ky ix jq jr kz jt ju jv la jx jy jz lb kb kc kd hb bi translated">我们从网站抓取中获得原始特征。它们是:</p><ul class=""><li id="c484" class="lc ld ht jk b jl jm jo jp jr le jv lf jz lg kd lh li lj lk bi translated"><strong class="jk hu"> URL_Vehicle </strong>是特定列表的网址。</li><li id="bc26" class="lc ld ht jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hu">标题</strong>是图片上方的大号粗体文本。</li><li id="0bbe" class="lc ld ht jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hu">价格</strong>嵌入<strong class="jk hu">标题</strong>中。</li><li id="17e4" class="lc ld ht jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hu"> SubLoc </strong>是标题中价格后的任何文字，如“(埃尔帕索)”。</li><li id="e3a1" class="lc ld ht jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hu">正文</strong>是照片下面的无结构文字。</li><li id="797c" class="lc ld ht jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hu"> AttribDictionary </strong>包含某些车辆属性。</li><li id="45d5" class="lc ld ht jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hu"> ImageDictionary </strong>是图片URL(不下载图片)。</li></ul><figure class="lr ls lt lu fd hk er es paragraph-image"><div class="er es lq"><img src="../Images/9b383374564bc604b8c38049b91fd33e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*wBE2LcQwwzCgTrNYyoz5sw.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">JSON原始特性</figcaption></figure><p id="387b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">接下来，我们使用正则表达式将原始特征转换成整齐的格式。这些功能包括以下内容:</p><ul class=""><li id="3009" class="lc ld ht jk b jl jm jo jp jr le jv lf jz lg kd lh li lj lk bi translated"><strong class="jk hu">车型</strong>是福特车辆的类型，例如野马、F-150、福克斯等。</li><li id="e26b" class="lc ld ht jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hu"> Trim </strong>是附加化妆品，技术，性能。例如，F-150国王牧场装饰增加了一个更大的发动机和类似镀铬格栅的化妆品。</li><li id="37ec" class="lc ld ht jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hu">年</strong>是车型年。</li><li id="ff46" class="lc ld ht jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hu">里程表</strong>是车辆上行驶的里程。</li><li id="2dd3" class="lc ld ht jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hu">卖方</strong>是业主或经销商。</li><li id="40fe" class="lc ld ht jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hu">位置</strong>是根据URL列出的汽车销售城市。</li></ul><p id="46bb" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">Regex细节在预处理Jupyter笔记本<a class="ae ke" href="https://github.com/jkmackie/car_price_prediction/tree/master/jupyter_notebooks" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><h2 id="c369" class="lz kg ht bd kh ma mb mc kl md me mf kp jr mg mh kr jv mi mj kt jz mk ml kv mm bi translated">工程模型_修剪特征并得到分层训练和测试</h2><p id="f416" class="pw-post-body-paragraph ji jj ht jk b jl kx iu jn jo ky ix jq jr kz jt ju jv la jx jy jz lb kb kc kd hb bi translated">我们需要多少数据来预测价格？对于每辆车，我们需要最少数量的样品。让我们假设最少是50个样本。所以对于逃跑的XLT，我们要50个样本；野马GT和F-150 XLT也是如此。但是，修剪“XLT”是共享的许多汽车模型！怎么办？</p><p id="eb62" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">将模型和修剪组合成一个名为Model_Trim的特征。“F-150_xlt”样本很多，但“escape_xlt”样本刚好低于最小值。</p><pre class="lr ls lt lu fd mn mo mp mq aw mr bi"><span id="34af" class="lz kg ht mo b fi ms mt l mu mv"><strong class="mo hu">#Model_Trim feature illustration:</strong></span><span id="5880" class="lz kg ht mo b fi mw mt l mu mv">f-150_xlt,f-250_super, mustang_gt,f-150_supercrew,f-150_lariat, focus_se, fusion_se, f-250_super duty, explorer_xlt, <br/>etc.</span></pre><p id="58d2" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">假设我们保持“escape_xlt ”,我们随机地将我们的车辆数据帧分成训练(90%数据)和测试(10%数据)。如果所有的“escape_xlt”都落入test only会怎么样？我们将如何拟合模型？</p><p id="e77d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">如果只有一辆便宜的“escape_xlt”在火车上掉下来怎么办？模型如何做出好的预测？</p><p id="fab0" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">分层抽样将数据分为训练集和测试集。它使类别比例与Model_Trim的整体类别比例保持一致。如果“模型_Trim1”是训练的5%,则它将是测试的5%(假设有足够的样本量)。</p><pre class="lr ls lt lu fd mn mo mp mq aw mr bi"><span id="0fa4" class="lz kg ht mo b fi ms mt l mu mv">from sklearn.model_selection import StratifiedShuffleSplit</span><span id="7321" class="lz kg ht mo b fi mw mt l mu mv">sss = StratifiedShuffleSplit(n_splits=1, test_size=0.1, random_state=22)</span><span id="17a7" class="lz kg ht mo b fi mw mt l mu mv">for train_index, test_index in sss.split(vehicle, vehicle['Model_Trim']):<br/>    train = vehicle.iloc[train_index]<br/>    test = vehicle.iloc[test_index]</span></pre><p id="f0b1" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">另一种我们可以分层的方法是根据价格，将价格从便宜到贵分为1-10个等级。例如，如果所有的廉价汽车都在列车上，这将防止数据偏差。幸运的是，由于最小样本量和分层抽样，培训和测试的平均价格在200美元以内。</p><blockquote class="mx"><p id="08f2" class="my mz ht bd na nb nc nd ne nf ng kd dx translated">尤达开的是什么车？一个玩具——小田</p></blockquote></div><div class="ab cl nh ni gp nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="hb hc hd he hf"><h1 id="eb4b" class="kf kg ht bd kh ki no kk kl km np ko kp iz nq ja kr jc nr jd kt jf ns jg kv kw bi translated">分类特征编码挑战</h1><p id="062c" class="pw-post-body-paragraph ji jj ht jk b jl kx iu jn jo ky ix jq jr kz jt ju jv la jx jy jz lb kb kc kd hb bi translated">分类特征在机器学习中是重要且具有挑战性的。在模型中工作之前，需要进行编码。通常，分类特征被一次性编码为每个类别的1和0。每个类别都有一列，增加了维度。随着维度变高，我们增加了过度拟合模型的机会。在高维空间中，成对的观测值变得几乎彼此等距。观察值变得更难聚类，离群值更难区分。</p><p id="13e0" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">高基数(高唯一性)特性的一个编码选项是用一个整数给每个类别编号。我们称之为整数编码。所以F-150、F-250、探险者、福克斯、野马等车型。被编号为0，1，2，3，4等。这种方法的一个问题是，我们对没有意义的类别强加了一个数字顺序。野马比探险者伟大吗？</p><p id="e820" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">如果类别是有序的，比如年轻人、中年人和老年人，那么整数编码是可以的。</p></div><div class="ab cl nh ni gp nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="hb hc hd he hf"><h2 id="5125" class="lz kg ht bd kh ma mb mc kl md me mf kp jr mg mh kr jv mi mj kt jz mk ml kv mm bi translated">目标编码</h2><p id="1476" class="pw-post-body-paragraph ji jj ht jk b jl kx iu jn jo ky ix jq jr kz jt ju jv la jx jy jz lb kb kc kd hb bi translated">在这个项目中，我们使用鲜为人知的方法叫做<a class="ae ke" href="https://contrib.scikit-learn.org/categorical-encoding/targetencoder.html" rel="noopener ugc nofollow" target="_blank">目标编码</a>。该特征被替换为(1)给定特征类的预期目标值和(2)所有训练数据的预期目标值的混合。目标是连续变量，价格。所有训练数据的值被称为<em class="nt">全球平均值</em>或<em class="nt">之前的</em>。</p><pre class="lr ls lt lu fd mn mo mp mq aw mr bi"><span id="daac" class="lz kg ht mo b fi ms mt l mu mv"><strong class="mo hu">Equation A: </strong>Encoding equation<strong class="mo hu"> </strong>for continuous or categorical target:</span><span id="e8b3" class="lz kg ht mo b fi mw mt l mu mv">Encoded_Class = ExpectedVal(trainTarget | FeatureClass) * <strong class="mo hu">smooth </strong><br/>+ ExpectedVal(trainTarget) * (1-<strong class="mo hu">smooth</strong>)</span><span id="978f" class="lz kg ht mo b fi mw mt l mu mv"><strong class="mo hu"><em class="nt">Where</em> </strong>ExpectedVal is the average for a continuous target (Price is continuous).  It is the probability for a categorical target.</span><span id="2bb4" class="lz kg ht mo b fi mw mt l mu mv"><strong class="mo hu"><em class="nt">Where</em> smooth </strong>=<br/>1/(1+e^-(class_count-min_samples_leaf)/smoothing_hyperparam)</span><span id="bace" class="lz kg ht mo b fi mw mt l mu mv"><strong class="mo hu"><em class="nt">Where</em> </strong>if class_count = 1, Encoded_Class = Global_Average</span><span id="656e" class="lz kg ht mo b fi mw mt l mu mv">-----------------------------------------------------------------<br/><strong class="mo hu">Equation B: </strong>Easy-to-read equation<strong class="mo hu"> </strong>for continuous target:</span><span id="90ce" class="lz kg ht mo b fi mw mt l mu mv">Encoded_Class = Class_Average * <strong class="mo hu">smooth </strong>+ Global_Average * (1-<strong class="mo hu">smooth</strong>)</span></pre><p id="a7ed" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">考虑模型类“野马”和<strong class="jk hu">方程B </strong>。野马得到平均野马价格混合整体模型价格。<em class="nt">但是，我们不是在利用价格作弊吗？</em>通过完全忽略测试价格来避免数据泄露。<strong class="jk hu">只有列车价格用于对测试中的特征进行编码。</strong></p><p id="2952" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">对于目标编码，必须减轻过拟合。我们不能通过在特征中编码来记忆价格。该模型在新数据上表现不佳。</p><p id="5737" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我们如下减轻过度拟合。用全局平均项约束(正则化)类平均项。这就是<strong class="jk hu">平滑</strong>发挥作用的地方。平滑是上面灰色框中的<code class="du nu nv nw mo b">Class_Average</code>重量。<code class="du nu nv nw mo b">Global_Average</code>得到(<strong class="jk hu">1-平滑</strong>)。如果<strong class="jk hu">平滑</strong>上升，(<strong class="jk hu">1-平滑</strong>)下降，反之亦然。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nx"><img src="../Images/1cedbd65076e6c00fb61a3dd7016fa11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cXDw6JH75NiJKJg33p_XbQ.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx translated"><strong class="bd kh"> smooth </strong>是用于混合Class_Average和Global_Average的权重。缺省的min_samples_leaf和smooth_hyp是1(左上)。提高min_samples_leaf和smooth_hyp分别通过使曲线变陡和变平来加强正则化。当<strong class="bd kh"> # </strong> class examples = 1时，平滑权重被覆盖:Encoded_Class获得Global_Average。</figcaption></figure><p id="e6d0" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">通过增加两个<strong class="jk hu">平滑</strong>超参数来加强正则化:min_samples_leaf和smooth_hyp。参见四个图表，这些图表通过#个类示例绘制了<strong class="jk hu">平滑</strong>。</p><blockquote class="mx"><p id="8a1c" class="my mz ht bd na nb nc nd ne nf ng kd dx translated">对于目标编码，必须减轻过拟合。我们通过用全局平均项约束(正则化)类平均项来减轻。</p></blockquote><p id="d6c5" class="pw-post-body-paragraph ji jj ht jk b jl ny iu jn jo nz ix jq jr oa jt ju jv ob jx jy jz oc kb kc kd hb bi translated">选择上面的<strong class="jk hu">平滑</strong>曲线。随着我们从左向右移动，这些类变得越来越常见。对于一个罕见的类，降低类平均权重(<strong class="jk hu">平滑</strong>)和提高全局平均权重(<strong class="jk hu">1-平滑</strong>)更安全。我们更加依赖全球平均水平。</p><p id="e6b9" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">相比之下，对于一个普通类，我们对全球平均值的依赖<em class="nt">要少</em>。公共课有很多例子可以平均。总之，稀有类比普通类获得更多的全局权重。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es od"><img src="../Images/574eaec84146c8efed15e3b019b7f254.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*zwdgZGA98nVUmIz05liYeg.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">目标编码示例。左表是原始的，右表是编码的。模型列使用train中的Class_Average进行编码。为了可读性，忽略train中Global_Average价格14，000的影响。</figcaption></figure><p id="acf7" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">如果目标是分类的而不是连续的，则使用概率而不是平均值。我们的目标价格是连续的，所以我们使用平均值。</p><p id="8b5e" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">目标编码不添加新列。当特性是高基数时，这尤其有益。此外，它不会给每个类别分配一个任意的数字。相反，这些类是用来自train的预期目标值编码的。换句话说，来自目标的信息被编码到类中。</p><p id="636f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">目标编码的缺点是类平均值和先验值的混合由两个超参数控制:min_samples_leaf和smoothing。当存在过度拟合时，更改默认的超参数非常重要。当设置低正则化时，普通类本质上获得Class_Average。</p><p id="6dd8" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">对于低基数特性来说，一键编码可能是更好的选择。当观测值的数量远大于编码后的最终特征数量时，这也可能是一个更好的选择。</p></div><div class="ab cl nh ni gp nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="hb hc hd he hf"><h2 id="efaf" class="lz kg ht bd kh ma mb mc kl md me mf kp jr mg mh kr jv mi mj kt jz mk ml kv mm bi translated">领域知识:驾驶室和残骸特征</h2><p id="305d" class="pw-post-body-paragraph ji jj ht jk b jl kx iu jn jo ky ix jq jr kz jt ju jv la jx jy jz lb kb kc kd hb bi translated">添加驾驶室功能可改善卡车预测和整体模型。对于卡车来说，超级卡车、超级驾驶室和普通驾驶室与卡车驾驶室相关，<strong class="jk hu">而非</strong>内饰。领域知识有助于快速识别这一事实。混合驾驶室与装饰恶化模型性能。</p><p id="da73" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">下面的技术给了我破坏特征的想法。在用算法对数据建模并计算残差之后，该方法是可用的。检查最差残差。这表明，与其他网站相比，某些预测是合理的，但CraigsList的价格比T4低得多。为什么？VIN互联网研究揭示汽车是在一次事故中，有时与照片！</p><blockquote class="mx"><p id="f85d" class="my mz ht bd na nb nc nd ne nf ng kd dx translated">当恐龙撞坏汽车时，你会得到什么？暴龙残骸</p></blockquote><p id="0c71" class="pw-post-body-paragraph ji jj ht jk b jl ny iu jn jo nz ix jq jr oa jt ju jv ob jx jy jz oc kb kc kd hb bi translated">为了对沉船场景建模，我们创建了一个名为wreck的新功能。这是一个包含事故相关关键词的分类特征:打捞、残骸、重建等。</p><p id="2545" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><code class="du nu nv nw mo b">regex_wreck=’(SALVAGE|WRECK|ACCIDENT|CRASH|COLLISION|REBUILT TITLE|REBUILD TITLE)’</code></p><figure class="lr ls lt lu fd hk er es paragraph-image"><div class="er es oe"><img src="../Images/4806f434383d59fb6bc4edd6ec679032.png" data-original-src="https://miro.medium.com/v2/resize:fit:308/format:webp/1*KudMUhfEcirfQl6b0B0BIg.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">残骸特征(左栏为索引)。</figcaption></figure><p id="9c0a" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">该列表被赋予事故关键字。如果没有关键字，列表将得到“None”。残骸然后被目标编码。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div class="er es of"><img src="../Images/f163184eea75fbdf163e2bbb1a8c5347.png" data-original-src="https://miro.medium.com/v2/resize:fit:376/format:webp/1*fP4PnqVNNiTuCBawvkDAZQ.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">目标编码后的残骸特征与价格。</figcaption></figure><h2 id="8bf8" class="lz kg ht bd kh ma mb mc kl md me mf kp jr mg mh kr jv mi mj kt jz mk ml kv mm bi translated">添加第三方数据</h2><p id="2ca8" class="pw-post-body-paragraph ji jj ht jk b jl kx iu jn jo ky ix jq jr kz jt ju jv la jx jy jz lb kb kc kd hb bi translated">我们设计了新的有效功能。万岁！我们现在有以下功能:<strong class="jk hu">里程表</strong>，<strong class="jk hu">年份**2 </strong>，<strong class="jk hu">车型_内饰</strong>，<strong class="jk hu">残骸</strong>，<strong class="jk hu">驾驶室</strong>，<strong class="jk hu">卖家</strong>，<strong class="jk hu">价格</strong>。</p><p id="c832" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我们的研究表明，马力和里程也是重要的特征。这些在CraigsList上通常会被忽略。但是，我们希望我们的价格预测尽可能准确。</p><p id="469b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我们做什么呢第三方数据库中提供了详细的马力和MPG(每加仑英里数)数据。EPA有排量(马力的代表)和里程数据<a class="ae ke" href="https://www.fueleconomy.gov/feg/epadata/vehicles.csv.zip" rel="noopener ugc nofollow" target="_blank">在这里</a>。我们的项目前提是没有第三方数据的预算。因此，我们将使用环保局的数据。</p><p id="abc2" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">请注意，EPA数据是<strong class="jk hu">模型级</strong> <em class="nt">，</em>而不是更细化的<strong class="jk hu">微调级</strong> <em class="nt"> </em>数据。</p><p id="aba3" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">在EPA文件vehicles.csv中，从model列提取有效的Ford车型，从comb08列提取MPG。然后按车型年对中值进行分组:</p><pre class="lr ls lt lu fd mn mo mp mq aw mr bi"><span id="55dc" class="lz kg ht mo b fi ms mt l mu mv">#Group median feature values by Model-Year.</span><span id="e3d8" class="lz kg ht mo b fi mw mt l mu mv">grouped = epa.groupby(['clean_model','year'])\<br/>             .agg({'displ' : 'median','comb08' : 'median'})\<br/>             .reset_index()</span></pre><p id="3494" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">分组结果格式:</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div class="er es og"><img src="../Images/a92d94a93f8aedfbe4d7ed9e2635710e.png" data-original-src="https://miro.medium.com/v2/resize:fit:454/format:webp/1*HkwGlWgW5gCa6YMU1towdw.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">EPA表。按车型年分组的排量和综合MPG特性。</figcaption></figure><p id="461d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">左连接车辆表到EPA表的型号和年份。</p><p id="0883" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><code class="du nu nv nw mo b">vehicle = vehicle.merge(epa, how=’left’, left_on=[‘Model’,’Year’], right_on=[‘clean_model’,’year’])</code></p><figure class="lr ls lt lu fd hk er es paragraph-image"><div class="er es oh"><img src="../Images/88fe9d51bf22ccd2f831082f8ab3ae05.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*s48cWNaCoYGuFPbnoEvqXA.jpeg"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">左连接返回蓝色记录。</figcaption></figure><p id="572f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">左加入得到<em class="nt">所有</em>车辆记录。包括所有汽车通用的<em class="nt">EPA记录。结果是具有我们新的里程和排量特性的车辆表！<code class="du nu nv nw mo b">right_on</code>列是多余的；放下它们。</em></p><p id="337d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">EPA数据忽略了F-250、F-250和F-450卡车数据。这些是商用级卡车，发动机排量大，里程表值通常很高。因此，这些卡车从数据中删除。</p><h2 id="f348" class="lz kg ht bd kh ma mb mc kl md me mf kp jr mg mh kr jv mi mj kt jz mk ml kv mm bi translated">带有转换的工程特征</h2><p id="e05d" class="pw-post-body-paragraph ji jj ht jk b jl kx iu jn jo ky ix jq jr kz jt ju jv la jx jy jz lb kb kc kd hb bi translated">良好的特征工程是高性能模型的基石。通过残骸和驾驶室功能，我们看到提高我们的知识会带来更好的功能。有效的特征工程可能对模型性能有很大的影响。</p><p id="fb6a" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">特征工程的另一种方法是用变换“重塑”特征。</p><p id="b6b2" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">如果你研究数据，你会发现价格分布是右偏的。我们的目标变量<strong class="jk hu">不</strong>具有正态分布。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div class="er es oi"><img src="../Images/726ef1a265ec7f13d6ebc4b8a9716259.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*_B2VE5bKvFZUtwg-67U1RQ.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">价格是右偏的。</figcaption></figure><p id="b973" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我们能把价格转换成大致的正态分布吗？如果是这样，模型性能可能会提高。试着取价格的对数或平方根。</p><blockquote class="mx"><p id="49c0" class="my mz ht bd na nb nc nd ne nf ng kd dx translated">交通灯对汽车说了什么？别看了，我要变了！</p></blockquote><p id="24d7" class="pw-post-body-paragraph ji jj ht jk b jl ny iu jn jo nz ix jq jr oa jt ju jv ob jx jy jz oc kb kc kd hb bi translated">让我们看看年份。直方图显示那一年是向左倾斜的。年份和我们的目标价格之间的关系是非线性的。</p><p id="b752" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">将Year提升到大于1的幂开始拉出右尾。这在理论上降低了偏斜，并使分布更加正常。如果年份是平方，与价格的相关性会增加一点。我们使用年份**2代替年份，因为模型分数提高了。</p><div class="lr ls lt lu fd ab cb"><figure class="oj hk ok ol om on oo paragraph-image"><img src="../Images/9e4d676df0b762698e7e9309ceaf5d0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*ZAahzMCRjy6Bqhynme8wzA.png"/></figure><figure class="oj hk op ol om on oo paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/179fd1ab6f815d05e0f5c4ff623d8a04.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*uOEhNU4IyZRmel5FE9klQQ.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx oq di or os translated">年份直方图向左倾斜。它与价格呈非线性关系。</figcaption></figure></div><p id="5fc8" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">将特征配对在一起——比如模型和修剪——可能会创建一个强大的新特征。假设这两个要素恰好在同一直线上(高度相关)，并且可以在不影响性能的情况下丢弃原始要素。在这种情况下，线性模型系数现在更容易解释，因为我们消除了共线特征。</p><p id="435d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">主成分分析(PCA)也通过组合变量来消除共线性。不幸的是，原来的特征混合在一起。这种转换阻碍了对特定功能影响的理解。</p><h2 id="e6ba" class="lz kg ht bd kh ma mb mc kl md me mf kp jr mg mh kr jv mi mj kt jz mk ml kv mm bi translated">离群值和异常值</h2><p id="3f81" class="pw-post-body-paragraph ji jj ht jk b jl kx iu jn jo ky ix jq jr kz jt ju jv la jx jy jz lb kb kc kd hb bi translated">对于非专业人士来说，找到一个真正的异常值可能很难。有很多关于这个主题的书。</p><p id="cc03" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">这里有两种方法来标记异常—可疑的异常值。第一种是配对绘制变量图，并直观地寻找异常。然后更详细地检查每个异常，以决定是否保留它。</p><pre class="lr ls lt lu fd mn mo mp mq aw mr bi"><span id="aa3d" class="lz kg ht mo b fi ms mt l mu mv">#Investigate outliers in train using pairplot.</span><span id="a090" class="lz kg ht mo b fi mw mt l mu mv">sns.set(font_scale=1.3)<br/>sns.pairplot(train[['Year^2', 'Wreck','Price']])<br/>plt.show()</span></pre><figure class="lr ls lt lu fd hk er es paragraph-image"><div class="er es ot"><img src="../Images/4d793d3b89e3340a0f7648ad2385fe28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*hDgy7us180av2SnCJ0VRcA.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">使用Seaborn的结对绘图示例。</figcaption></figure><p id="9463" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">第二种方法使用算法中的残差(观察值减去预测值)。如果残值超出平均值的三个标准偏差，则可能是异常(如果残值呈正态分布，则99.7%的值在三个标准偏差内)。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ou"><img src="../Images/b4585adccd0584adad60fed81f354c75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xj_nZcbt49YMfJLffEW4Xw.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">超过三个标准偏差的误差在橙色虚线之外。更多细节见算法<a class="ae ke" href="https://github.com/jkmackie/car_price_prediction/tree/master/jupyter_notebooks" rel="noopener ugc nofollow" target="_blank">笔记本</a>。</figcaption></figure><p id="e85c" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">请注意，不能保证异常是真正的异常值。如果决定是关键的，如医疗问题，请咨询专家。</p><p id="89c0" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">异常提供了对模型错误的洞察，并且可能提供了如何改进模型的洞察。下一篇文章，<strong class="jk hu">第4部分:算法和实验</strong>，包括异常的案例研究。</p><h2 id="c9d6" class="lz kg ht bd kh ma mb mc kl md me mf kp jr mg mh kr jv mi mj kt jz mk ml kv mm bi translated">将干净的数据表保存到数据库</h2><p id="d048" class="pw-post-body-paragraph ji jj ht jk b jl kx iu jn jo ky ix jq jr kz jt ju jv la jx jy jz lb kb kc kd hb bi translated">我们必须存储我们的数据。PostgreSQL 是大公司使用的商业级数据库。它可以存储JSON和JSON二进制格式的数据。下载并安装PostgreSQL。使用以下Python代码将数据帧写入Postgre表:</p><figure class="lr ls lt lu fd hk"><div class="bz dy l di"><div class="ov ow l"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">将数据帧写入Postgre表。</figcaption></figure><p id="ac4f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">建议使用小写的表名，因为Postgre区分大小写。由于在这段代码中出现了大小写混合的情况，所以当它出现在SQL语句中时，要在表的两边加上引号。比如<code class="du nu nv nw mo b">query 1 = ‘SELECT * from “trainClean”’</code>。对于小写，SQL简化为<code class="du nu nv nw mo b">query2 = ‘SELECT * from trainclean’</code>。</p><p id="9a65" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">在执行Python代码之前，请确保PostgreSQL服务器正在运行。在Windows 10上，我更喜欢通过在服务应用中右键单击来手动启动它。</p><p id="766f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">或者，将每个数据帧写入名为auto:</p><figure class="lr ls lt lu fd hk"><div class="bz dy l di"><div class="ov ow l"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">如何将dataframe写入SQLite3表。</figcaption></figure><p id="57fb" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">注意PostgreSQL允许一次进行多个并发写入。相比之下，SQLite3只允许一次写操作，限制了数据写入速度。</p><h2 id="dbf6" class="lz kg ht bd kh ma mb mc kl md me mf kp jr mg mh kr jv mi mj kt jz mk ml kv mm bi translated">数据存储和可追溯性</h2><p id="8c0b" class="pw-post-body-paragraph ji jj ht jk b jl kx iu jn jo ky ix jq jr kz jt ju jv la jx jy jz lb kb kc kd hb bi translated">原始数据和干净数据应进行版本控制，以便数据可审计。用日期戳对数据进行版本控制。为数据重组等步骤设置随机种子。</p><p id="ec4e" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">当原始数据通过处理管道运行时，清理的结果应该总是相同的！如果它改变了，就有问题了——代码改变了，洗牌种子改变了，或者可能使用了错误的数据。</p><p id="8050" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">代码中的数据帧索引被小心地保持完整。这样，编码后的观察结果可以追溯到人类友好的格式。这对于检查异常尤其有用。</p><p id="f0dd" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">当值追溯到最初的JSON时，您会放松下来。可追溯的观察像饮用水一样是强制性的。</p><h1 id="93d3" class="kf kg ht bd kh ki kj kk kl km kn ko kp iz kq ja kr jc ks jd kt jf ku jg kv kw bi translated">结论</h1><p id="2660" class="pw-post-body-paragraph ji jj ht jk b jl kx iu jn jo ky ix jq jr kz jt ju jv la jx jy jz lb kb kc kd hb bi translated">我们解决了特征工程问题，并用新的有效特征改进了模型。特征被编码并转换成模型友好的格式。我们增加了第三方环保局的数据，以填补我们的野外数据的空白。我们讨论了异常值并将可审计的数据保存到数据库中。</p><p id="6a87" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">从零开始，我们取得了巨大的进步！</p><p id="bc5f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><a class="ae ke" rel="noopener" href="/@jmackie_13883/auto-price-prediction-from-scratch-part-4-algorithms-and-experiments-e78aa2bf864f"> <strong class="jk hu">第四部分:算法和实验</strong> </a>将涵盖预测算法和评估结果！</p></div><div class="ab cl nh ni gp nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="hb hc hd he hf"><p id="c837" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><em class="nt">我欢迎反馈！联系我的最好方式是发表评论。在LinkedIn上私信我:</em><a class="ae ke" href="http://www.linkedin.com/in/justinmackie" rel="noopener ugc nofollow" target="_blank"><em class="nt">http://www.linkedin.com/in/justinmackie</em></a></p><h2 id="2cae" class="lz kg ht bd kh ma mb mc kl md me mf kp jr mg mh kr jv mi mj kt jz mk ml kv mm bi translated">尾注:</h2><p id="7a23" class="pw-post-body-paragraph ji jj ht jk b jl kx iu jn jo ky ix jq jr kz jt ju jv la jx jy jz lb kb kc kd hb bi translated">[1]如果Model_Trim样本的最小数量足够低——在训练中只有9个“escape_xlt ”,在测试中只有1个——训练和测试的平均价格可能不一致。</p><p id="84e8" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">[2] C .阿格沃尔。异常值分析。第17-18页。</p></div></div>    
</body>
</html>