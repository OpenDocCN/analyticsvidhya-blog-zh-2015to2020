<html>
<head>
<title>A Hands-On Guide to Automated Feature Engineering in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python自动化要素工程实践指南</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/a-hands-on-guide-to-automated-feature-engineering-in-python-13260eae9270?source=collection_archive---------2-----------------------#2018-08-22">https://medium.com/analytics-vidhya/a-hands-on-guide-to-automated-feature-engineering-in-python-13260eae9270?source=collection_archive---------2-----------------------#2018-08-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="54fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">任何参加过机器学习黑客马拉松和竞赛的人都可以证明特征工程是多么重要。往往就是进入排行榜前10和排在前50之外的区别！</p><p id="8027" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">自从我意识到特征工程的巨大潜力，我就一直是它的大力支持者。但是手动完成时，这可能是一个缓慢而艰巨的过程。我必须花时间集思广益，想出什么功能，并从不同的角度分析它们的可用性。现在，整个有限元过程可以自动化，我将在本文中向您展示如何实现。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/939d2a1cdc7ff4d3997811aa1ee445c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*8k3uF7kXJlkllKeo"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated"><em class="jp">来源:VentureBeat </em></figcaption></figure><p id="41af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用名为Featuretools的Python特征工程库来完成这项工作。但是在我们开始之前，我们将首先看看FE的基本构建模块，通过直观的例子来理解它们，然后最终使用<a class="ae jq" href="https://datahack.analyticsvidhya.com/contest/practice-problem-big-mart-sales-iii/" rel="noopener ugc nofollow" target="_blank"> BigMart销售数据集</a>深入到自动化特征工程的令人敬畏的世界。</p><h1 id="9a8c" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">目录</h1><ol class=""><li id="ce5c" class="kp kq hi ih b ii kr im ks iq kt iu ku iy kv jc kw kx ky kz bi translated">什么是特性？</li><li id="f58b" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc kw kx ky kz bi translated">什么是特征工程？</li><li id="1195" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc kw kx ky kz bi translated">为什么需要特征工程？</li><li id="263d" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc kw kx ky kz bi translated">自动化特征工程</li><li id="ccc2" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc kw kx ky kz bi translated">功能工具简介</li><li id="d0cf" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc kw kx ky kz bi translated">功能工具的实现</li><li id="8a8a" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc kw kx ky kz bi translated">功能工具可解释性</li></ol><h1 id="01e1" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">1.什么是特性？</h1><p id="2216" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">在机器学习的背景下，特征可以被描述为解释现象发生的一个特征或一组特征。当这些特征转换成某种可测量的形式时，就叫做特征。</p><p id="cb09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，假设您有一个学生列表。这个列表包含每个学生的名字，他们学习的小时数，他们的智商，以及他们在以前考试中的总分数。现在你得到了一个新学生的信息——他/她学习的小时数和他/她的智商，但是他/她的分数不见了。你必须估计他/她的可能分数。</p><p id="227d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，你可以使用智商和学习时间建立一个预测模型来估计这些缺失的分数。所以，智商和学习时间被称为这个模型的特征。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es li"><img src="../Images/66ad21713ad7c611b28a6f50911be3ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/0*bgilMjPqVrJUQnr0.png"/></div></figure><h1 id="d74a" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">2.什么是特征工程？</h1><p id="8a34" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">要素工程可以简单地定义为从数据集中的现有要素创建新要素的过程。让我们考虑一个样本数据，它包含一些商品的详细信息，比如它们的重量和价格。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lj"><img src="../Images/09cea0a4f30041fc27e93d358db6ab6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/0*b12-L9IhMjrUgVd5.png"/></div></figure><p id="ad41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，要创建一个新特性，我们可以使用Item_Weight和Item_Price。因此，让我们创建一个名为Price_per_Weight的特性。它只不过是物品的价格除以物品的重量。这个过程被称为特征工程。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lk"><img src="../Images/9651b04685403289f90806eaa420591c.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/0*guTLQjUkiw_sFBNK.png"/></div></figure><p id="68d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这只是一个从现有特性创建新特性的简单例子，但是在实践中，当我们有相当多的特性时，特性工程会变得相当复杂和麻烦。</p><p id="2130" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们再举一个例子。在流行的泰坦尼克号数据集中，有一个乘客姓名功能，以下是数据集中的一些姓名:</p><ul class=""><li id="ae81" class="kp kq hi ih b ii ij im in iq ll iu lm iy ln jc lo kx ky kz bi translated">约萨斯牧师蒙特维拉</li><li id="01aa" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc lo kx ky kz bi translated">格雷厄姆小姐。玛格丽特·伊迪丝</li><li id="e639" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc lo kx ky kz bi translated">约翰斯顿小姐。凯瑟琳·海伦《嘉莉》</li><li id="a5b3" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc lo kx ky kz bi translated">卡尔·豪厄尔先生</li><li id="9c20" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc lo kx ky kz bi translated">杜利，帕特里克先生</li></ul><p id="caa4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些名称实际上可以分解成更多有意义的特性。例如，我们可以提取相似的标题并将其分组到单个类别中。让我们来看看乘客姓名中独特的头衔数。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lp"><img src="../Images/55e9465f081af82580f1e8fe00129fa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:320/format:webp/0*6SZxbli9_-yoy-wx.png"/></div></figure><p id="b17c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">事实证明，像“夫人”、“夫人”、“伯爵夫人”、“上尉”、“上校”、“唐”、“博士”、“少校”、“牧师”、“先生”和“琼基尔”这样的头衔非常罕见，可以放在一个标签下。姑且称之为<em class="lq">稀有_称号</em>。除此之外，头衔“Mlle”和“Ms”可以放在“Miss”下面，“Mme”可以用“Mrs”代替。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lr"><img src="../Images/b2a35c611883929affb0be50be0f21a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/0*4aEVm_DYfqFXnGy6.png"/></div></figure><p id="64ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，新的标题功能将只有5个唯一值，如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ls"><img src="../Images/b7a393539bc5a4969d0e932f1d690f60.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/0*JmFUVZOu0XDYyoJQ.png"/></div></figure><p id="7628" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，这就是我们如何在特征工程的帮助下提取有用的信息，甚至是从最初看起来毫无意义的乘客姓名这样的特征中。</p><h1 id="c13c" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">3.为什么需要特征工程？</h1><p id="65a3" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">预测模型的性能在很大程度上取决于用于为该模型定型的数据集中的要素的质量。如果您能够创建新的特性来帮助为模型提供更多关于目标变量的信息，那么它的性能将会提高。因此，当我们的数据集中没有足够的高质量特征时，我们必须依靠特征工程。</p><p id="cc50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在最受欢迎的Kaggle比赛之一“自行车共享需求预测”中，参与者被要求根据与天气、时间和其他数据相关的历史使用模式来预测华盛顿特区的租赁需求。</p><p id="9036" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如在这篇<a class="ae jq" href="https://www.analyticsvidhya.com/blog/2015/06/solution-kaggle-competition-bike-sharing-demand/" rel="noopener ugc nofollow" target="_blank">文章</a>中所解释的，智能功能工程在确保排行榜前5%的位置中发挥了重要作用。下面给出了创建的一些特征:</p><ol class=""><li id="f5fc" class="kp kq hi ih b ii ij im in iq ll iu lm iy ln jc kw kx ky kz bi translated"><strong class="ih hj">小时箱</strong>:宁滨在决策树的帮助下创建了一个新功能<em class="lq">小时</em>功能</li><li id="6a54" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc kw kx ky kz bi translated"><strong class="ih hj">温度箱</strong>:类似地，温度变量的装箱特征</li><li id="5eb7" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc kw kx ky kz bi translated"><strong class="ih hj">年份库</strong>:创建了8个季度库，为期2年</li><li id="6ad2" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc kw kx ky kz bi translated"><strong class="ih hj">日类型</strong>:日分为“工作日”、“周末”或“假日”</li></ol><p id="8cba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建这样的功能并不容易——它需要大量的头脑风暴和广泛的数据探索。不是每个人都擅长特征工程，因为这不是你通过看书或看视频就能学会的。这就是为什么特征工程也被称为一门艺术。如果你擅长它，那么你在竞争中就有很大的优势。很像罗杰·费德勒，网球击球时的特征工程大师。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lt"><img src="../Images/9f30b71a722005b70b129a95d516d11b.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*0vEtASLidrl5bC6P.gif"/></div></figure><h1 id="ba24" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">4.自动化特征工程</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lu"><img src="../Images/11a3e3484784b6842bd95d1feb5951a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/0*vlkyyZr6p6qlwqSh.png"/></div></figure><p id="5eb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">分析上面显示的两幅图像。左图展示了20世纪早期一群人正在组装一辆汽车，右图展示了当今世界机器人做着同样的工作。任何流程的自动化都有可能使其更加高效和经济。出于类似的原因，特征工程可以并且已经在机器学习中实现了自动化。</p><p id="00fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">构建机器学习模型通常是一个艰苦而乏味的过程。它涉及许多步骤，因此如果我们能够自动完成一定比例的功能工程任务，那么数据科学家或领域专家就可以专注于模型的其他方面。听起来好得难以置信，对吧？</p><p id="c4e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">既然我们已经理解了自动化特征工程是当前的需要，下一个问题是——它将如何发生？嗯，我们有一个很好的工具来解决这个问题，它被称为功能工具。</p><h1 id="973f" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">5.功能工具简介</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es lv"><img src="../Images/7076722a686a63146057479f27e48005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pw09gIwnaukX1Mxy.png"/></div></div></figure><p id="a277" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Featuretools是一个用于执行自动化特征工程的开源库。这是一个非常棒的工具，旨在快速推进特征生成过程，从而将更多时间专注于机器学习模型构建的其他方面。换句话说，它让你的数据“机器学习就绪”。</p><p id="64d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在使用Featuretools之前，我们应该了解该软件包的三个主要组件:</p><ul class=""><li id="53fa" class="kp kq hi ih b ii ij im in iq ll iu lm iy ln jc lo kx ky kz bi translated">实体</li><li id="5be2" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc lo kx ky kz bi translated">深度特征综合(DFS)</li><li id="a1f8" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc lo kx ky kz bi translated">特征基元</li></ul><p id="35a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a)一个<strong class="ih hj">实体</strong>可以被认为是一个熊猫数据帧的表示。多个实体的集合被称为一个<strong class="ih hj">实体集</strong>。</p><p id="9c19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b) <strong class="ih hj">深度特征合成</strong> (DFS)与深度学习无关。别担心。DFS实际上是一种特征工程方法，是Featuretools的主干。它支持从单个以及多个数据帧创建新要素。</p><p id="6c59" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">c) DFS通过将<strong class="ih hj">特征原语</strong>应用于EntitySet中的实体关系来创建特征。这些图元是手动生成特征的常用方法。例如，原语“mean”将在聚合级别找到变量的平均值。</p><p id="aa08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">理解和熟悉Featuretools的最佳方式是将其应用于数据集。因此，我们将在下一节中使用来自我们的<a class="ae jq" href="https://datahack.analyticsvidhya.com/contest/practice-problem-big-mart-sales-iii/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> BigMart销售实践问题</strong> </a>的数据集来巩固我们的概念。</p><h1 id="d043" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">6.功能工具的实现</h1><p id="0375" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">BigMart销售挑战的目标是建立一个预测模型来估计特定商店中每种产品的销售额。这将有助于BigMart的决策者找出任何产品或商店的属性，这些属性在增加整体销售额中起着关键作用。请注意，在给定的数据集中，10家商店有1559种产品。</p><p id="e743" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下表显示了我们的数据中提供的功能:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es ma"><img src="../Images/262fb7c37e6de749f87cfa0b84853f93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QNWySmfy8otJENK6K44zBQ.png"/></div></div></figure><p id="44ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以从<a class="ae jq" href="https://datahack.analyticsvidhya.com/contest/practice-problem-big-mart-sales-iii/" rel="noopener ugc nofollow" target="_blank">这里</a>下载数据。</p><h1 id="e899" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">6.1.装置</h1><p id="f60d" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">Python 2.7、3.5和3.6版提供了Featuretools。您可以使用pip轻松安装Featuretools。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="8ea2" class="mg js hi mc b fi mh mi l mj mk">pip install featuretools</span></pre><h1 id="ab16" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">6.2.加载所需的库和数据</h1><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="fe2b" class="mg js hi mc b fi mh mi l mj mk">import featuretools as ft <br/>import numpy as np <br/>import pandas as pd </span><span id="118d" class="mg js hi mc b fi ml mi l mj mk">train = pd.read_csv("Train_UWu5bXk.csv") <br/>test = pd.read_csv("Test_u94Q5KV.csv")</span></pre><h1 id="148c" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">6.3.数据准备</h1><p id="239c" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">首先，我们将目标Item_Outlet_Sales存储在一个名为Sales的变量中，id变量存储在test_Item_Identifier和test_Outlet_Identifier中。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="ba80" class="mg js hi mc b fi mh mi l mj mk"># saving identifiers <br/>test_Item_Identifier = test['Item_Identifier'] test_Outlet_Identifier = test['Outlet_Identifier'] </span><span id="221a" class="mg js hi mc b fi ml mi l mj mk">sales = train['Item_Outlet_Sales'] <br/>train.drop(['Item_Outlet_Sales'], axis=1, inplace=True)</span></pre><p id="856f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们将组合训练集和测试集，因为这样可以省去我们两次执行相同步骤的麻烦。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="bf34" class="mg js hi mc b fi mh mi l mj mk">combi = train.append(test, ignore_index=True)</span></pre><p id="6a4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们检查数据集中缺失的值。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="5d93" class="mg js hi mc b fi mh mi l mj mk">combi.isnull().sum()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mm"><img src="../Images/a33c6f13de1a3c85739a7fbd210d9eab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/0*elmaQ8UcjSY-Euga.png"/></div></figure><p id="bfbd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Item_Weight和Outlet_size变量中有大量缺失值。让我们快速处理它们:</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="a46f" class="mg js hi mc b fi mh mi l mj mk"># imputing missing data </span><span id="a6ef" class="mg js hi mc b fi ml mi l mj mk">combi['Item_Weight'].fillna(combi['Item_Weight'].mean(), <br/>                            inplace = True) </span><span id="39aa" class="mg js hi mc b fi ml mi l mj mk">combi['Outlet_Size'].fillna("missing", inplace = True)</span></pre><h1 id="e841" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">6.4.数据预处理</h1><p id="9fc9" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">我不会做大量的预处理操作，因为这篇文章的目的是让你开始使用Featuretools。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="e0b0" class="mg js hi mc b fi mh mi l mj mk">combi['Item_Fat_Content'].value_counts()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mn"><img src="../Images/7976849506f75c4c6d13ee0f8f021f3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/0*h1P87Ph9YVXY4KC6.png"/></div></figure><p id="5be0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">似乎Item_Fat_Content只包含两个类别，即“低脂”和“普通”——其余的我们将认为是多余的。所以，我们把它转换成一个二进制变量。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="7423" class="mg js hi mc b fi mh mi l mj mk"># dictionary to replace the categories </span><span id="37d5" class="mg js hi mc b fi ml mi l mj mk">fat_content_dict = {'Low Fat':0, 'Regular':1, 'LF':0, 'reg':1, <br/>                    'low fat':0} </span><span id="465f" class="mg js hi mc b fi ml mi l mj mk">combi['Item_Fat_Content'] = combi['Item_Fat_Content'].replace(   <br/>                            fat_content_dict, regex=True)</span></pre><h1 id="00fc" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">6.5.使用特征工具的特征工程</h1><p id="7ca8" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">现在我们可以开始使用Featuretools来执行自动化的特征工程了！数据集中必须有一个唯一标识符特征(我们的数据集目前还没有)。因此，我们将为合并的数据集创建一个唯一的ID。如果您注意到，我们的数据中有两个IDs一个用于商品，另一个用于经销店。因此，简单地将两者连接起来将会给我们一个唯一的ID。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="8c9b" class="mg js hi mc b fi mh mi l mj mk">combi['id'] = combi['Item_Identifier'] + combi['Outlet_Identifier'] </span><span id="4058" class="mg js hi mc b fi ml mi l mj mk">combi.drop(['Item_Identifier'], axis=1, inplace=True)</span></pre><p id="8440" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，我已经删除了功能<em class="lq"> Item_Identifier </em>，因为不再需要它了。但是，我保留了功能<em class="lq"> Outlet_Identifier </em>，因为我打算以后使用它。</p><p id="95cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，在继续之前，我们必须创建一个EntitySet。EntitySet是包含多个数据帧以及它们之间的关系的结构。因此，让我们创建一个EntitySet并向其添加dataframe组合。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="c5e7" class="mg js hi mc b fi mh mi l mj mk"># creating and entity set 'es' <br/>es = ft.EntitySet(id = 'sales') </span><span id="2d73" class="mg js hi mc b fi ml mi l mj mk"># adding a dataframe <br/>es.entity_from_dataframe(entity_id = 'bigmart', <br/>                         dataframe = combi, <br/>                         index = 'id')</span></pre><p id="1e4f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的数据包含两个级别的信息——商品级别和经销店级别。Featuretools提供了将数据集分割成多个表的功能。我们根据Outlet ID<em class="lq">Outlet _ Identifier</em>从BigMart表中创建了一个新表‘Outlet’。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="fdba" class="mg js hi mc b fi mh mi l mj mk">es.normalize_entity(base_entity_id='bigmart', <br/>                    new_entity_id='outlet', <br/>                    index = 'Outlet_Identifier', <br/>                    additional_variables =   <br/>                    ['Outlet_Establishment_Year', 'Outlet_Size',  <br/>                     'Outlet_Location_Type', 'Outlet_Type'])</span></pre><p id="6d80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们检查一下我们的EntitySet的摘要。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="d1a6" class="mg js hi mc b fi mh mi l mj mk">print(es)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mo"><img src="../Images/2cf7b10e5222f8592e5c78910013fb55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/0*SmaadWC8udfqNWKI.png"/></div></figure><p id="7c40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您在上面看到的，它包含两个实体— bigmart和outlet。这两个表之间也形成了一种关系，由Outlet_Identifier连接。这种关系将在新功能的生成中发挥关键作用。</p><p id="2891" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将使用<strong class="ih hj">深度特征合成</strong>来自动创建新特征。回想一下，DFS使用功能原语，通过EntitySet中的多个表来创建功能。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="b19b" class="mg js hi mc b fi mh mi l mj mk">feature_matrix, feature_names = ft.dfs(entityset=es, <br/>                                       target_entity = 'bigmart', <br/>                                       max_depth = 2, <br/>                                       verbose = 1, <br/>                                       n_jobs = 3)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mo"><img src="../Images/36fe16bd0c72a8d4278fac47b91c8906.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/0*dg_nfMTDelTITMQ0.png"/></div></figure><p id="b6db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lq"> target_entity </em>只是我们希望为其创建新特征的实体ID(在本例中，它是实体‘bigmart’)。参数<em class="lq"> max_depth </em>控制通过堆叠图元生成的特征的复杂度。参数<em class="lq"> n_jobs </em>通过使用多个内核来帮助并行特征计算。</p><p id="38a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是使用Featuretools所要做的一切。它自己产生了一系列新功能。</p><p id="b6b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来看看这些新创建的功能。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="2314" class="mg js hi mc b fi mh mi l mj mk">feature_matrix.columns</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mp"><img src="../Images/a0353be45ac0953d57aea94ebd74eff6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/0*AafCRjcMfwXJpJ8X.png"/></div></figure><p id="1363" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">DFS在如此短的时间内创建了29个新功能。这是惊人的，因为手动操作会花费更长的时间。如果您的数据集包含多个相互关联的表，Featuretools仍然有效。在这种情况下，您不必规范化一个表，因为已经有多个表可用了。</p><p id="d3cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们打印feature_matrix的前几行。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="306d" class="mg js hi mc b fi mh mi l mj mk">feature_matrix.head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mq"><img src="../Images/ff226940f6504829eb1416cec2436f59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ANzyWhwouJzetbQJ.png"/></div></div></figure><p id="9153" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个数据帧有一个问题—排序不正确。我们必须根据<em class="lq">组合</em>数据框中的<em class="lq"> id </em>变量对其进行排序。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="7cfd" class="mg js hi mc b fi mh mi l mj mk">feature_matrix = feature_matrix.reindex(index=combi['id']) feature_matrix = feature_matrix.reset_index()</span></pre><p id="6445" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，数据框特征矩阵处于正确的顺序。</p><h1 id="63ee" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">6.6.模型结构</h1><p id="15f7" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">是时候检查这些生成的特性实际上有多大用处了。我们将使用它们来建立模型并预测Item_Outlet_Sales。因为我们的最终数据(feature_matrix)有许多分类特征，所以我决定使用CatBoost算法。它可以直接使用分类特征，并且本质上是可扩展的。你可以参考<a class="ae jq" href="https://www.analyticsvidhya.com/blog/2017/08/catboost-automated-categorical-data/" rel="noopener ugc nofollow" target="_blank">这篇文章</a>了解更多关于CatBoost的内容。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="cc04" class="mg js hi mc b fi mh mi l mj mk">from catboost import CatBoostRegressor</span></pre><p id="ffc7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">CatBoost要求所有分类变量都是字符串格式。因此，我们首先将数据中的分类变量转换为字符串:</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="8382" class="mg js hi mc b fi mh mi l mj mk">categorical_features = np.where(feature_matrix.dtypes =='object')[0] </span><span id="349a" class="mg js hi mc b fi ml mi l mj mk">for i in categorical_features: <br/>    feature_matrix.iloc[:,i]=feature_matrix.iloc[:,i].astype('str')</span></pre><p id="71f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们将feature_matrix拆分回训练集和测试集。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="f32c" class="mg js hi mc b fi mh mi l mj mk">feature_matrix.drop(['id'], axis=1, inplace=True) </span><span id="d865" class="mg js hi mc b fi ml mi l mj mk">train = feature_matrix[:8523] <br/>test = feature_matrix[8523:]</span><span id="802c" class="mg js hi mc b fi ml mi l mj mk"># removing uneccesary variables <br/>train.drop(['Outlet_Identifier'], axis=1, inplace=True) test.drop(['Outlet_Identifier'], axis=1, inplace=True)</span><span id="704f" class="mg js hi mc b fi ml mi l mj mk"># identifying categorical features categorical_features = np.where(train.dtypes == 'object')[0]</span></pre><p id="1872" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将训练数据分为训练集和验证集，以在本地检查模型的性能。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="2817" class="mg js hi mc b fi mh mi l mj mk">from sklearn.model_selection import train_test_split </span><span id="1c25" class="mg js hi mc b fi ml mi l mj mk"># splitting train data into training and validation set <br/>xtrain, xvalid, ytrain, yvalid = train_test_split(train, sales, <br/>                                                  test_size=0.25, <br/>                                                  random_state=11)</span></pre><p id="13fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们现在可以训练我们的模型。我们将使用的评估指标是RMSE(均方根误差)。</p><pre class="je jf jg jh fd mb mc md me aw mf bi"><span id="bbe1" class="mg js hi mc b fi mh mi l mj mk">model_cat = CatBoostRegressor(iterations=100, learning_rate=0.3, <br/>                              depth=6, eval_metric='RMSE',  <br/>                              random_seed=7) </span><span id="c4a2" class="mg js hi mc b fi ml mi l mj mk"># training model <br/>model_cat.fit(xtrain, ytrain, cat_features=categorical_features, <br/>              use_best_model=True)</span><span id="f274" class="mg js hi mc b fi ml mi l mj mk"># validation score <br/>model_cat.score(xvalid, yvalid)</span></pre><p id="776e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 1091.244 </strong></p><p id="bdcd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">验证集的RMSE分数约为1092.24。</p><p id="edd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">同款在大众排行榜上获得1155.12分。在没有任何特征工程的情况下，在验证集和公共排行榜上的分数分别为~1103和~1183。因此，由Featuretools创建的要素不仅仅是随机要素，它们是有价值和有用的。最重要的是，它在特征工程中节省的时间是不可思议的。</strong></p><h1 id="0e98" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">7.功能工具可解释性</h1><p id="88cd" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">使我们的数据科学解决方案可解释是执行机器学习的一个非常重要的方面。由Featuretools生成的特征即使对非技术人员来说也很容易解释，因为它们基于易于理解的图元。</p><p id="e8ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，特色<em class="lq">插座。SUM(bigmart。</em>【物品_重量】<em class="lq">出口。STD(bigmart。Item_MRP) </em>分别表示门店级别的物品重量和物品成本的标准差。</p><p id="9139" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这使得那些不是机器学习专家的人也可以根据他们的领域专长做出贡献。</p><h1 id="f8e8" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">结束注释</h1><p id="8bd0" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">featuretools包确实是机器学习领域的游戏规则改变者。虽然可以理解它的应用在行业用例中仍然有限，但它在黑客马拉松和ML竞赛中已经迅速变得非常流行。它所节省的时间，以及它所产生的有用的特性，真的赢得了我的心。</p><p id="90c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下次处理任何数据集时尝试一下，并在评论部分告诉我效果如何！</p></div><div class="ab cl mr ms gp mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hb hc hd he hf"><p id="e981" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lq">原载于2018年8月22日</em><a class="ae jq" href="https://www.analyticsvidhya.com/blog/2018/08/guide-automated-feature-engineering-featuretools-python/" rel="noopener ugc nofollow" target="_blank"><em class="lq">www.analyticsvidhya.com</em></a><em class="lq">。</em></p></div></div>    
</body>
</html>