<html>
<head>
<title>Poetry: Finally an all-in-one tool to manage Python packages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">诗歌:最终成为管理Python包的一体化工具</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/poetry-finally-an-all-in-one-tool-to-manage-python-packages-3c4d2538e828?source=collection_archive---------0-----------------------#2020-01-10">https://medium.com/analytics-vidhya/poetry-finally-an-all-in-one-tool-to-manage-python-packages-3c4d2538e828?source=collection_archive---------0-----------------------#2020-01-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a768091cc20e0065a962961f9e6e4d8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BUUIee-t1I2eqTm0RtDNHQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">丹·艾丁格。尼德缪勒</figcaption></figure><p id="56c9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">编辑:从诗歌1.2开始，关于如何安装包有了一些变化，我在这里<a class="ae js" href="https://lewoudar.medium.com/what-is-new-in-poetry-1-2-67af090f1cb4" rel="noopener">解释了一下</a>。至于其他方面，本教程仍然有效。</p><p id="1f7a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您是python编程的新手，有时在管理包依赖关系和在pypi或另一种形式的包注册表上发布项目时，您会感到不知所措。涉及到生态系统的工具太多了:<a class="ae js" href="https://virtualenv.pypa.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> virtualenv </a>，pip，<a class="ae js" href="https://pipenv.kennethreitz.org/en/latest/" rel="noopener ugc nofollow" target="_blank"> pipenv </a>，<a class="ae js" href="https://flit.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">调情</a>，<a class="ae js" href="https://twine.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">麻线</a>等等..这有点令人沮丧，因为您不知道从什么开始，并且您经常不得不在几个工具之间周旋以达到您的目的。</p><p id="bcde" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">幸运的是，一个新的工具已经到来并解决了所有这些问题，它叫做<a class="ae js" href="https://python-poetry.org/" rel="noopener ugc nofollow" target="_blank">诗歌</a>！本教程将基于2019年<a class="ae js" href="https://github.com/python-poetry/poetry/releases/tag/1.0.0" rel="noopener ugc nofollow" target="_blank">12月</a>发布的诗歌1.0.0。</p><h1 id="c719" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">装置</h1><p id="9b95" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">在windows上，您需要powershell来安装它:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="6ac4" class="lf ju hi lb b fi lg lh l li lj">&gt; (Invoke-WebRequest -Uri https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py -UseBasicParsing).Content | python</span></pre><p id="3599" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">之后，您将需要重启shell以使其运行。</p><p id="248b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在linux和其他posix系统上(包括mac):</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="dc18" class="lf ju hi lb b fi lg lh l li lj">$ curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python</span></pre><p id="4f1b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要检查其安装是否正确，您可以检查版本:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="d022" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry --version<br/>Poetry version 1.0.0</span></pre><p id="3d9b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这里，我们看到我们安装了1.0.0版。可能是最新的稳定版本没有安装安装脚本，要更新诗，可以运行:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="bf4e" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry self update</span></pre><p id="e911" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">请注意，您可以使用传统的<strong class="iw hj"> pip </strong>命令安装poem，但是poem将被限制为为已安装它的python版本创建虚拟环境。</p><h1 id="9bb3" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">初始化项目</h1><p id="0512" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">为了研究诗歌，我们将使用<em class="lk"> new </em>命令创建一个简单的项目<em class="lk"> poet </em>。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="451e" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry new poet</span></pre><p id="e53d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">创建的项目的树形结构如下所示。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="4b83" class="lf ju hi lb b fi lg lh l li lj">├── pyproject.toml<br/>├── README.rst<br/>├── poet<br/>│   └── __init__.py<br/>└── tests<br/>    ├── __init__.py<br/>    └── test_poet.py</span></pre><p id="a41c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里最重要的文件是<em class="lk"> pyproject.toml </em>，它包含了管理我们的包所需的所有信息。一开始看起来是这样的:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="2022" class="lf ju hi lb b fi lg lh l li lj">[tool.poetry]<br/>name = "poet"<br/>version = "0.1.0"<br/>description = ""<br/>authors = ["lewoudar &lt;XXX@XXX.com&gt;"]<br/><br/>[tool.poetry.dependencies]<br/>python = "^3.8"<br/><br/>[tool.poetry.dev-dependencies]<br/>pytest = "^5.2"<br/><br/>[build-system]<br/>requires = ["poetry&gt;=0.12"]<br/>build-backend = "poetry.masonry.api"</span></pre><p id="df33" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里我们定义了四个部分:</p><ul class=""><li id="1485" class="ll lm hi iw b ix iy jb jc jf ln jj lo jn lp jr lq lr ls lt bi translated">第一部分定义了与依赖包无关的所有元数据，如名称、版本等..</li><li id="7eb8" class="ll lm hi iw b ix lu jb lv jf lw jj lx jn ly jr lq lr ls lt bi translated">第二部分定义了项目所需的所有依赖项</li><li id="7793" class="ll lm hi iw b ix lu jb lv jf lw jj lx jn ly jr lq lr ls lt bi translated">第三部分定义了所有开发依赖项，这些依赖项不是构建项目所必需的，而是执行测试、构建、文档等其他操作所必需的..</li><li id="2773" class="ll lm hi iw b ix lu jb lv jf lw jj lx jn ly jr lq lr ls lt bi translated">第四部分定义了一个构建系统，如<a class="ae js" href="https://www.python.org/dev/peps/pep-0517/" rel="noopener ugc nofollow" target="_blank"> PEP 517 </a>所示。</li></ul><p id="3adb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你不喜欢诗歌为你初始化一个项目，或者如果你已经有一个你想用诗歌控制的项目，你可以使用<a class="ae js" href="https://python-poetry.org/docs/cli/#init" rel="noopener ugc nofollow" target="_blank"> <em class="lk"> init </em> </a>命令。您将获得一个交互式shell来配置您的项目。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="8f7f" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry init</span></pre><h1 id="3aa4" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">添加包</h1><p id="a824" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">好的，让我们假设我们想要使用<a class="ae js" href="https://2.python-requests.org/en/master/" rel="noopener ugc nofollow" target="_blank">请求</a>来执行一些api查询，使用诗歌，添加一个依赖是简单的。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="2d09" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry add requests</span></pre><p id="3d95" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果我们想安装一个开发依赖项，即不像pytest那样与您的项目直接相关，我们可以通过传递<em class="lk"> -D </em>选项来实现。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="5a8d" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry add -D pytest</span></pre><p id="4c3f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">名词（noun的缩写）b:如果您之前使用了<em class="lk"> new </em>命令，并像上面一样添加请求包，那么您可能已经安装了pytest，因此您将得到一个值错误，表明该包已经存在。所以不要惊讶:)</p><h1 id="a87d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">列出依赖关系</h1><p id="823e" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">如果我们想在某个时候发现所有已安装的依赖项，我们可以使用<em class="lk"> show </em>命令。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="e50d" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry show --tree<br/>pytest 5.3.2 pytest: simple powerful testing with Python<br/>|-- atomicwrites &gt;=1.0<br/>|-- attrs &gt;=17.4.0<br/>|-- colorama *<br/>|-- more-itertools &gt;=4.0.0<br/>|-- packaging *<br/>|   |-- pyparsing &gt;=2.0.2<br/>|   `-- six *<br/>|-- pluggy &gt;=0.12,&lt;1.0<br/>|-- py &gt;=1.5.0<br/>`-- wcwidth *<br/>requests 2.22.0 Python HTTP for Humans.<br/>|-- certifi &gt;=2017.4.17<br/>|-- chardet &gt;=3.0.2,&lt;3.1.0<br/>|-- idna &gt;=2.5,&lt;2.9<br/>`-- urllib3 &gt;=1.21.1,&lt;1.25.0 || &gt;1.25.0,&lt;1.25.1 || &gt;1.25.1,&lt;1.26</span></pre><p id="2774" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">前面的命令画出了我们所有依赖项以及依赖项的依赖项的图形..</p><p id="0b1f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果我们不确定我们是否有一个依赖项的最新版本，我们可以通过使用““<em class="lk">latest”</em>选项<em class="lk">告诉poems检查我们的包存储库是否有新版本。</em>我们<em class="lk"> </em>会得到列出了当前版本和最新发布版本的包。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="b1b5" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry show --latest<br/>atomicwrites   1.3.0      1.3.0      Atomic file writes.<br/>attrs          19.3.0     19.3.0     Classes Without Boilerplate<br/>certifi        2019.11.28 2019.11.28 Python package for providing Mozilla's CA Bundle.<br/>chardet        3.0.4      3.0.4      Universal encoding detector for Python 2 and 3<br/>colorama       0.4.3      0.4.3      Cross-platform colored terminal text.<br/>idna           2.8        2.8        Internationalized Domain Names <br/>...</span></pre><h1 id="1239" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">安装项目</h1><p id="da20" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">如果我们想在可编辑模式下安装项目，我们可以使用<em class="lk">安装</em>命令。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="8d8d" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry install</span></pre><p id="9642" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">请注意，如果我们有额外的依赖项，它们将不会随前面的命令一起安装。pyproject.toml文件中的额外依赖项如下所示(摘自官方文档):</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="5fe8" class="lf ju hi lb b fi lg lh l li lj">[tool.poetry.dependencies]<br/># These packages are mandatory and form the core of this package’s distribution.<br/>mandatory = "^1.0"<br/><br/># A list of all of the optional dependencies, some of which are included in the<br/># below `extras`. They can be opted into by apps.<br/>psycopg2 = { version = "^2.7", optional = true }<br/>mysqlclient = { version = "^1.3", optional = true }<br/><br/>[tool.poetry.extras]<br/>mysql = ["mysqlclient"]<br/>pgsql = ["psycopg2"]</span></pre><p id="4027" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，如果我们想安装项目和postgresql客户端，我们应该在终端中输入以下内容:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="d9fc" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry install -E pgsql</span></pre><p id="9e62" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果我们想要所有的数据库客户端:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="0567" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry install -E mysql -E pgsql</span></pre><h1 id="f695" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">处理虚拟环境</h1><p id="2c9e" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">当我们使用诗歌时，虚拟环境是在我们系统的某个地方自动创建的。确切的位置取决于我们的操作系统，但是我们可以通过运行<em class="lk"> env </em>命令和查找路径信息来找到它。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="508c" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry env info<br/>Virtualenv<br/>Python:         3.8.0<br/>Implementation: CPython<br/>Path:           C:\Users\rolla\AppData\Local\pypoetry\Cache\virtualenvs\poet-6mnhVs-j-py3.8<br/>Valid:          True</span><span id="304b" class="lf ju hi lb b fi lz lh l li lj">System<br/>Platform: win32<br/>OS:       nt<br/>Python:   C:\Users\rolla\AppData\Local\Programs\Python\Python38-32</span></pre><p id="72c2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">事实上，我们可以在前面的命令中添加““<em class="lk">path”</em>选项，以便只获取虚拟环境的路径；)</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="4f5c" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry env info --path<br/>C:\Users\rolla\AppData\Local\pypoetry\Cache\virtualenvs\poet-6mnhVs-j-py3.8</span></pre><p id="3335" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果我们想运行一个由我们的依赖项安装的脚本，我们需要一种方法来访问我们的虚拟环境，否则我们的操作系统会抱怨它不知道命令。为此，poem提供了一个<em class="lk"> run </em>命令来解决这个问题。它将在虚拟环境中自动运行传递给它的参数。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="fe15" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry run pytest<br/>===================================================================================== test session starts =====================================================================================<br/>platform win32 -- Python 3.8.0, pytest-5.3.2, py-1.8.1, pluggy-0.13.1<br/>rootdir: D:\projets\python\tutorials\poet<br/>collected 1 item</span><span id="2b25" class="lf ju hi lb b fi lz lh l li lj">tests\test_poet.py .                                                                                                                                                                     [100%]<br/>..</span></pre><p id="4e8d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">例如，我们也可以通过运行pip命令在可编辑模式下卸载项目。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="aa3b" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry run pip uninstall poet</span></pre><p id="8607" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果我们发现总是在我们想要使用的所有脚本命令前面添加一个<em class="lk">poem run</em>很烦人，poem提供了一个<em class="lk"> shell </em>命令，它可以直接在虚拟环境中生成一个新的shell。这样我们现在就可以调用<em class="lk"> pytest </em>命令，而不用在它前面运行<em class="lk">诗歌</em>。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="8824" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry shell<br/>&gt; pytest<br/>===================================================================================== test session starts =====================================================================================<br/>platform win32 -- Python 3.8.0, pytest-5.3.2, py-1.8.1, pluggy-0.13.1<br/>...</span></pre><p id="bb70" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要离开这个shell，我们可以运行<em class="lk"> exit。</em></p><p id="b7f8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你想管理多个python解释器，可以看看这个<a class="ae js" href="https://python-poetry.org/docs/managing-environments/" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><h1 id="1d7b" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">更新包</h1><p id="6dd2" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">为了更新所有的依赖关系，我们可以运行<em class="lk"> update </em>命令。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="0235" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry update</span></pre><p id="695a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果我们只想更新一些包，我们可以将它们指定为<em class="lk"> update </em>命令的参数。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="1e9d" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry update package1 package2</span></pre><h1 id="c9f4" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">取出包裹</h1><p id="c8cc" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">由于有了<em class="lk"> remove </em>命令，删除一个包也很简单。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="61b2" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry remove requests</span></pre><p id="1e97" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果是开发包，我们必须将-D选项传递给命令。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="cd6f" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry remove -D pytest</span></pre><h1 id="b8f0" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">构建最终的包</h1><h2 id="1d31" class="lf ju hi bd jv ma mb mc jz md me mf kd jf mg mh kh jj mi mj kl jn mk ml kp mm bi translated">向pyproject.toml添加一些有用的元数据</h2><p id="5d24" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">在构建项目之前，我们需要添加一些有用的元数据来分发和解释如何使用我们的包，如许可证、一些关键字和我们希望在最终构建中包含的包。我们的pyproject现在看起来像这样:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="469c" class="lf ju hi lb b fi lg lh l li lj">[tool.poetry]<br/>name = "poet"<br/>version = "0.1.0"<br/>description = ""<br/>authors = ["lewoudar &lt;XXX@XXX.com&gt;"]<br/>license  = "Apache-2"<br/>keywords = ["poet", "requests"]<br/>readme = "README.rst"<br/><br/>packages = [<br/>    { include = "poet" }<br/>]<br/><br/>[tool.poetry.dependencies]<br/>python = "^3.8"<br/>requests = "^2.22.0"<br/><br/>[tool.poetry.dev-dependencies]<br/>pytest = "^5.2"<br/><br/>[build-system]<br/>requires = ["poetry&gt;=0.12"]<br/>build-backend = "poetry.masonry.api"</span></pre><p id="9d17" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您想了解更多关于传递给pyproject.toml的不同元数据的信息，请看这个<a class="ae js" href="https://python-poetry.org/docs/pyproject/" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><h2 id="9e3e" class="lf ju hi bd jv ma mb mc jz md me mf kd jf mg mh kh jj mi mj kl jn mk ml kp mm bi translated">建设</h2><p id="d25a" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">为了构建一个包，我们运行..<em class="lk">建立</em>司令部！</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="0f3e" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry build<br/>Building poet (0.1.0)<br/> - Building sdist<br/> - Built poet-0.1.0.tar.gz</span><span id="e634" class="lf ju hi lb b fi lz lh l li lj">- Building wheel<br/> - Built poet-0.1.0-py3-none-any.whl</span></pre><p id="88cc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果我们想将构建限制到特定的类型，我们可以只使用-F选项。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="6efe" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry build -F wheel # or sdist</span></pre><h1 id="eb53" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">部署包</h1><h2 id="fb51" class="lf ju hi bd jv ma mb mc jz md me mf kd jf mg mh kh jj mi mj kl jn mk ml kp mm bi translated">配置存储库和凭据</h2><p id="0f93" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">如果我们没有在传统的<a class="ae js" href="https://pypi.org/" rel="noopener ugc nofollow" target="_blank"> pypi </a>上部署，我们应该配置我们想要上传包的仓库。为此目的创建了<em class="lk">配置</em>命令。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="be41" class="lf ju hi lb b fi lg lh l li lj">&gt; poetry config repositories.priv https://private.repository</span></pre><p id="2670" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在上面的例子中，我们用URL“https://private . repository”配置了名为“priv”的存储库。</p><p id="abf9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果我们想要存储这个私有存储库的凭证，我们也可以使用<em class="lk"> config </em>命令。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="42bf" class="lf ju hi lb b fi lg lh l li lj">poetry config http-basic.priv username password</span></pre><p id="a064" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在上面的命令中，“用户名”和“密码”对应于我们的..登录我们的私有存储库的用户名和密码。请注意，如果我们不指定密码，当我们部署包时，系统会提示我们输入密码。</p><p id="57d4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于pypi，我们也可以使用前面的命令来配置凭证，并将“priv”替换为“pypi ”,但是现在建议使用<a class="ae js" href="https://pypi.org/help/#apitoken" rel="noopener ugc nofollow" target="_blank"> API令牌</a>来通过pypi进行身份验证。我们可以这样配置它:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="2ade" class="lf ju hi lb b fi lg lh l li lj">poetry config pypi-token.pypi my-token</span></pre><p id="249c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">“my-token”代表我们在pypi上创建的令牌。</p><p id="2b1f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">注意，我们也可以使用<a class="ae js" href="https://python-poetry.org/docs/repositories/#configuring-credentials" rel="noopener ugc nofollow" target="_blank">环境变量</a>来配置我们的凭证。这在使用CI工具时特别有用。</p><h2 id="39b5" class="lf ju hi bd jv ma mb mc jz md me mf kd jf mg mh kh jj mi mj kl jn mk ml kp mm bi translated">部署</h2><p id="22c9" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">当我们完成配置后，我们可以使用<em class="lk"> publish </em>命令简单地部署我们的包。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="a832" class="lf ju hi lb b fi lg lh l li lj">poetry publish</span></pre><p id="9099" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果我们使用私有存储库，我们必须指定我们之前通过-r选项配置的名称。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="5042" class="lf ju hi lb b fi lg lh l li lj">poetry publish -r priv</span></pre><p id="b9d8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">请注意，我们可以使用“— build”选项在部署之前构建包。</p><h1 id="b4e9" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">c扩展</h1><p id="6069" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">目前对C扩展的支持还不能完全运行。你可以通过阅读这期<a class="ae js" href="https://github.com/python-poetry/poetry/issues/11" rel="noopener ugc nofollow" target="_blank">文章</a>得到一个草案解决方案，但是我会建议你继续使用像pip或pipenv这样的标准工具，除非poem完全支持它。</p><p id="e2c9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">本教程到此为止。希望你喜欢并学到很多:)</p></div></div>    
</body>
</html>