<html>
<head>
<title>Count Finger using OpenCV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用OpenCV计数手指</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/count-finger-using-opencv-c45e7339f167?source=collection_archive---------20-----------------------#2020-12-16">https://medium.com/analytics-vidhya/count-finger-using-opencv-c45e7339f167?source=collection_archive---------20-----------------------#2020-12-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e964" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在学习激励自己方面取得一些进步总是好的。我希望在我的系列文章中，我们能够读到一些非常基本的图像处理技术，如Canny边缘检测、形态学操作、分割、轮廓检测等。现在，它的时间向前移动一点，并尝试检测你的手指，数出你将要显示的数字。让我们试着动手做这件事。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/0e58837bddaf084c1da3c66fa53287d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_kSINB6jEw_GN_qOaYSnQg.jpeg"/></div></div></figure><p id="6554" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们有三个主要部分，首先尝试找到你的背景并积累背景值。第二步，我们必须使用轮廓检测来分割我们的手，最后找到手指的位置，并尝试分割图像中显示的手指数量。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="fcfa" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated"><strong class="ak">背景检测</strong></h1><p id="f6b7" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">在第一步中，我们将找到背景图像，并计算图像和目的地的加权和。因此目的地将是连续的帧序列。</p><pre class="je jf jg jh fd kz la lb lc aw ld bi"><span id="6c39" class="le jx hi la b fi lf lg l lh li">def cal_accum_avg(frame,accumulated_weight):<br/> <br/> global background<br/> <br/> if background is None:<br/> background = frame.copy().astype(‘float’)<br/> return None<br/> <br/> cv2.accumulateWeighted(frame,background,accumulated_weight)</span></pre><h1 id="ee7a" class="jw jx hi bd jy jz lj kb kc kd lk kf kg kh ll kj kk kl lm kn ko kp ln kr ks kt bi translated"><strong class="ak">分割ROI(手)</strong></h1><p id="ae32" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">第二步，从当前图像中减去背景图像。因此，将使用黑白图像中的轮廓来检测感兴趣的区域。</p><pre class="je jf jg jh fd kz la lb lc aw ld bi"><span id="1254" class="le jx hi la b fi lf lg l lh li">def segment(frame,threshold = 25):<br/> <br/> diff = cv2.absdiff(background.astype(‘uint8’),frame)<br/> <br/> ret,thresholded_img = cv2.threshold(diff,threshold,255,<br/> cv2.THRESH_BINARY)<br/> <br/> contours,hierarchy = cv2.findContours(thresholded_img.copy(),<br/> cv2.RETR_EXTERNAL,<br/> cv2.CHAIN_APPROX_SIMPLE)<br/> <br/> if len(contours) == 0:<br/>  return None<br/> <br/> else:<br/>  #Assuming the largest external contour in roi is the hand<br/> <br/>  hand_segment = max(contours,key = cv2.contourArea)<br/> <br/>  return (thresholded_img,hand_segment)</span></pre><h1 id="7150" class="jw jx hi bd jy jz lj kb kc kd lk kf kg kh ll kj kk kl lm kn ko kp ln kr ks kt bi translated"><strong class="ak">数手指</strong></h1><p id="7e44" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">主要棘手的部分是我们的最后阶段，现在你的手被检测到了，但基于你的手指来计数，我们仍然错过了分割单独的手指。只有当一个手指合拢时，我们才能跟踪并计算它。为此，我们将使用凸包函数。使用凸包，我们将能够找到你的检测手的极端点，然后根据轮廓和极端位置，我们的工作将变得更容易计数。</p><p id="732c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">#使用凸包计数手指的函数</p><pre class="je jf jg jh fd kz la lb lc aw ld bi"><span id="8410" class="le jx hi la b fi lf lg l lh li">def count_fingers(thresholded_img,hand_segment):<br/> <br/> conv_hull = cv2.convexHull(hand_segment)<br/> <br/> #most extreme top,bottom,left and right points<br/> top = tuple(conv_hull[conv_hull[:, :, 1].argmin()][0])<br/> bottom = tuple(conv_hull[conv_hull[:, :, 1].argmax()][0])<br/> left = tuple(conv_hull[conv_hull[:, :, 0].argmin()][0])<br/> right = tuple(conv_hull[conv_hull[:, :, 0].argmax()][0])<br/> <br/> #finding center point<br/> cx = (left[0] + right[0]) // 2<br/> cy = (top[1] + bottom[1]) // 2<br/> <br/> #calculate distance from center to all extreme points<br/> distance = pairwise.euclidean_distances([(cx,cy)],<br/> Y=[left,right,top,bottom])[0]<br/> <br/> #calculate one of the max distance<br/> max_distance = distance.max()<br/> <br/> #create circle <br/> radius = int(0.8 * max_distance)<br/> circumference = (2 * np.pi * radius)<br/> <br/> circular_roi = np.zeros(thresholded_img.shape[:2],dtype=’uint8')<br/> <br/> cv2.circle(circular_roi,(cx,cy),radius,255,10)<br/> <br/> circular_roi = cv2.bitwise_and(thresholded_img,thresholded_img,<br/> mask = circular_roi)<br/> <br/> contours,hierarchy= cv2.findContours(circular_roi.copy(),<br/> cv2.RETR_EXTERNAL,<br/> cv2.CHAIN_APPROX_NONE)<br/> <br/> count = 0<br/> <br/> for cnt in contours:<br/> (x,y,w,h) = cv2.boundingRect(cnt)<br/> <br/> out_of_wrist = ((cy + (cy * 0.25)) &gt; (y + h))<br/> <br/> limit_points = ((circumference * 0.25) &gt; cnt.shape[0])<br/> <br/> if out_of_wrist and limit_points:<br/> count += 1<br/> <br/> return count</span></pre><p id="4a6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们有所有必要的模块来开始计数我们的手指，现在将开始捕捉我们自己的视频并开始计数。</p><div class="je jf jg jh fd ab cb"><figure class="lo ji lp lq lr ls lt paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/543919d6fb2f2f6f09fd60b18b4b87fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*ynj3pEJsJZ3QNMOWpkAgsA.png"/></div></figure><figure class="lo ji lp lq lr ls lt paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/3aba65350b33b6a9c234358e715a2bc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Eh9NV1eoKSOD22EvqxBe1w.png"/></div></figure></div><pre class="je jf jg jh fd kz la lb lc aw ld bi"><span id="29a4" class="le jx hi la b fi lf lg l lh li">cam = cv2.VideoCapture(0)</span><span id="c7d9" class="le jx hi la b fi lu lg l lh li">num_frames = 0</span><span id="eab8" class="le jx hi la b fi lu lg l lh li">while True:<br/> <br/> ret,frame = cam.read()<br/> <br/> frame = cv2.flip(frame, 1)<br/> frame_copy = frame.copy()<br/> <br/> roi = frame[roi_top:roi_bottom,roi_right:roi_left]<br/> <br/> gray = cv2.cvtColor(roi,cv2.COLOR_BGR2GRAY)<br/> <br/> gray_blur = cv2.GaussianBlur(gray,(7,7),0)<br/> <br/> if num_frames &lt; 60:<br/> cal_accum_avg(gray_blur,accumulated_weight)<br/> <br/> if num_frames &lt;= 59:<br/> cv2.putText(frame_copy,’WAIT, GETTING BACKGROUND’,(200,300),<br/> cv2.FONT_HERSHEY_COMPLEX,1,(255,0,0),2)<br/> cv2.imshow(‘finger count’,frame_copy)<br/> <br/> else:<br/> hand = segment(gray_blur)<br/> <br/> if hand is not None:<br/> <br/> thresholded, hand_segment = hand<br/> <br/> #draw contours around real hand in live stream<br/> cv2.drawContours(frame_copy,<br/> [hand_segment+[roi_right,roi_top]],<br/> -1,<br/> (0,0,255),<br/> 5)<br/> fingers = count_fingers(thresholded,hand_segment)</span><span id="aada" class="le jx hi la b fi lu lg l lh li">cv2.putText(frame_copy,<br/> str(fingers),<br/> (70,50),<br/> cv2.FONT_HERSHEY_SIMPLEX,<br/> 1,<br/> (255,0,0),<br/> 2)<br/> <br/> cv2.imshow(‘thresholded’,thresholded)<br/> <br/> cv2.rectangle(frame_copy,<br/> (roi_left,roi_top),<br/> (roi_right,roi_bottom),<br/> (0,255,0),<br/> 5)<br/> <br/> num_frames += 1<br/> <br/> cv2.imshow(‘finger count’, frame_copy)<br/> <br/> k = cv2.waitKey(1) &amp; 0xFF<br/> <br/> if k == 27:<br/> break<br/> <br/>cv2.destroyAllWindows()<br/>cam.release()</span></pre><p id="52c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">快乐阅读！！！如果你喜欢这篇文章，请鼓掌！！</p><p id="b3db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Github: </strong></p><p id="064d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lv" href="https://github.com/RamjiB/Python-for-Computer-Vision-with-OpenCV-and-Deep-Learning/tree/master/8_Capston%20Project" rel="noopener ugc nofollow" target="_blank">https://github . com/RamjiB/Python-for-Computer-Vision-with-OpenCV-and-Deep-Learning/tree/master/8 _ Capston % 20 project</a></p></div></div>    
</body>
</html>