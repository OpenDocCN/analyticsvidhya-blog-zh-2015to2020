<html>
<head>
<title>Spring Boot — Accessing Data with JPA Hibernate and PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring Boot —使用 JPA Hibernate 和 PostgreSQL 访问数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/spring-boot-accessing-data-with-jpa-hibernate-and-postgresql-af68386363a4?source=collection_archive---------0-----------------------#2020-11-20">https://medium.com/analytics-vidhya/spring-boot-accessing-data-with-jpa-hibernate-and-postgresql-af68386363a4?source=collection_archive---------0-----------------------#2020-11-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/989bf6fc3492d8d822df01c065429875.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lljLS8ATT8se2QmoTph6uw.png"/></div></div></figure><p id="fadf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你好！我将讲述如何使用 Hibernate 和 PostgreSQL 创建一个 Spring Boot 项目。首先我想解释一下什么是 ORM，JPA，Hibernate。</p><p id="c039" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ORM(对象关系映射): ORM 是一种编程技术，它允许我们的模型类匹配关系数据库中的表。它可以被认为是应用程序和关系数据库之间的桥梁。</p><p id="75ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> JPA (Java 持久性 API): </strong> JPA 是一种规范。它是将大量数据持久存储到数据库中的类和方法的集合。它为 ORM 工具提供了通用的原型和功能。通过实现相同的规范，所有 ORM 工具(如 Hibernate、TopLink..)遵循共同标准。</p><p id="81f6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Hibernate: </strong> Hibernate 是 JPA 的一个实现。它是用于 Java 环境的 ORM(对象关系映射)解决方案。它遵循 JPA 提供的通用标准。</p><p id="4649" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">很快，由于有了<strong class="is hj"> Hibernate </strong>，我们将不用编写冗长的 SQL 查询就能进行数据库操作。</p><p id="fd0d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们创建一个名为 Covid 信息系统的简单应用程序。使用<strong class="is hj"> hibernate </strong>将患者添加到<strong class="is hj"> PostgreSQL </strong>数据库，列出所有患者并更新患者状态。</p><p id="8f38" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以在这里找到完整的代码:<a class="ae jo" href="https://github.com/minnela/SpringBootHibernateJPA" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">https://github.com/minnela/SpringBootHibernateJPA</strong></a></p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jp"><img src="../Images/4a239cca3c19d1af0d359a08e81b55d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uqcTdo1aWobV1GiK9XdJiA.png"/></div></div></figure><p id="37be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，您应该在 PC 上设置 PostgreSQL。你可以在这里下载:<a class="ae jo" href="https://www.postgresql.org/download/" rel="noopener ugc nofollow" target="_blank">https://www.postgresql.org/download/</a></p><p id="73da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">项目结构将是这样的:</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es ju"><img src="../Images/44a6c62115dcf26bc0970432fe21b342.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*YL06LSlelbVHewbERpljBQ.png"/></div></figure><p id="3372" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里是<strong class="is hj"> pom.xml </strong>文件<strong class="is hj"> : </strong></p><pre class="jq jr js jt fd jv jw jx jy aw jz bi"><span id="49af" class="ka kb hi jw b fi kc kd l ke kf">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;project <br/>         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br/>         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;<br/>    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br/>    &lt;parent&gt;<br/>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;<br/>        &lt;version&gt;2.3.2.RELEASE&lt;/version&gt;<br/>        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;<br/>    &lt;/parent&gt;<br/>    &lt;groupId&gt;org.example&lt;/groupId&gt;<br/>    &lt;artifactId&gt;covidInformationSystem&lt;/artifactId&gt;<br/>    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;<br/><br/>    &lt;properties&gt;<br/>        &lt;java.version&gt;1.8&lt;/java.version&gt;<br/>    &lt;/properties&gt;<br/><br/>    &lt;dependencies&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.postgresql&lt;/groupId&gt;<br/>            &lt;artifactId&gt;postgresql&lt;/artifactId&gt;<br/>            &lt;version&gt;42.2.17&lt;/version&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>            &lt;exclusions&gt;<br/>                &lt;exclusion&gt;<br/>                    &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;<br/>                    &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;<br/>                &lt;/exclusion&gt;<br/>            &lt;/exclusions&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;javax.validation&lt;/groupId&gt;<br/>            &lt;artifactId&gt;validation-api&lt;/artifactId&gt;<br/>            &lt;version&gt;1.1.0.Final&lt;/version&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;junit&lt;/groupId&gt;<br/>            &lt;artifactId&gt;junit&lt;/artifactId&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;junit&lt;/groupId&gt;<br/>            &lt;artifactId&gt;junit&lt;/artifactId&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>    &lt;/dependencies&gt;<br/><br/>    &lt;build&gt;<br/>        &lt;plugins&gt;<br/>            &lt;plugin&gt;<br/>                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;<br/>            &lt;/plugin&gt;<br/>        &lt;/plugins&gt;<br/>    &lt;/build&gt;<br/><br/><br/>&lt;/project&gt;</span></pre><p id="a4e1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在在<strong class="is hj"> application.properties </strong>文件中，我们将连接 PostgreSQL 并配置 hibernate 和 jpa:</p><pre class="jq jr js jt fd jv jw jx jy aw jz bi"><span id="fbe4" class="ka kb hi jw b fi kc kd l ke kf">server.port = 4567<br/>spring.jpa.database=<em class="kg">POSTGRESQL<br/></em>spring.datasource.platform= postgres<br/>spring.datasource.url=jdbc:postgresql://localhost:5432/postgres<br/>spring.datasource.username=postgres<br/>spring.datasource.password=admin<br/>spring.jpa.show-sql=true<br/>spring.jpa.generate-ddl=true<br/>spring.jpa.hibernate.ddl-auto=update<br/>spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation= true</span></pre><h1 id="dfdd" class="kh kb hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">型号</strong></h1><p id="18d5" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">让我们创建我们的实体类。<strong class="is hj"> @Entity </strong>注释会让 Spring Boot 创建我们的实体表。我们将创建<strong class="is hj"> Person </strong>类，Person 表将自动添加到 postgreSQL 中。</p><pre class="jq jr js jt fd jv jw jx jy aw jz bi"><span id="77d3" class="ka kb hi jw b fi kc kd l ke kf">@Entity<br/>public class Person {<br/><br/>    @Id<br/>    @GeneratedValue(strategy = GenerationType.<em class="kg">AUTO</em>)<br/>    @Column(name="id")<br/>    private int id;<br/><br/>    @Column(name="firstname")<br/>    private String name;<br/><br/>    @Column(name= "surname")<br/>    private String surname;<br/><br/>    @Column(name="age")<br/>    private int age;<br/><br/>    @Column(name="covidinfo")<br/>    private String covidInfo;</span></pre><p id="cccc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在 Person 类中添加构造函数、getter 和 setter 方法。</p><h1 id="3cd3" class="kh kb hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">储存库</strong></h1><p id="871e" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">现在是时候创建一个人员存储库了。这个存储库包含每个要添加到系统中的人。我们将创建一个 PersonRepository 接口，它将扩展 JPA Repository 类。JPA repository 有很多功能可以用于数据库操作。</p><pre class="jq jr js jt fd jv jw jx jy aw jz bi"><span id="8390" class="ka kb hi jw b fi kc kd l ke kf">@Repository<br/>public interface PersonRepository extends JpaRepository&lt;Person, Integer&gt; {</span><span id="fce1" class="ka kb hi jw b fi lj kd l ke kf">}</span></pre><h1 id="c0c9" class="kh kb hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">服务</h1><p id="86c1" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">服务是我们创建的一个层，用于封装控制器中的业务逻辑，它是控制器和模型之间的桥梁。</p><p id="1574" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们创建<strong class="is hj">人员服务:</strong></p><pre class="jq jr js jt fd jv jw jx jy aw jz bi"><span id="dffb" class="ka kb hi jw b fi kc kd l ke kf">public interface PersonService {<br/>    void addPerson(Person person);<br/>    List&lt;Person&gt; getAllPatients();<br/>    Person getPersonById(int id);<br/>    void updatePersonCovidInfo(int id);<br/>    void deletePersonById(int id);<br/>    <br/>}</span></pre><p id="9084" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们创建它的实现<strong class="is hj"> PersonServiceImpl。</strong>我们创建一个 PersonRepository 对象。要将一个人添加到数据库中，只需编写<strong class="is hj">person repository . save(person)</strong>即可。如您所见，我们不使用长 SQL 查询来保存人员:</p><pre class="jq jr js jt fd jv jw jx jy aw jz bi"><span id="62c3" class="ka kb hi jw b fi kc kd l ke kf">@Service<br/>public class PersonServiceImpl implements PersonService{<br/><br/>    PersonRepository personRepository;<br/><br/>    @Autowired<br/>    public PersonServiceImpl(PersonRepository personRepository) {<br/>        this.personRepository = personRepository;<br/>    }<br/><br/>    @Override<br/>    public void addPerson(Person person) {<br/>        personRepository.save(person);<br/>    }<br/><br/>    @Override<br/>    public List&lt;Person&gt; getAllPatients() {<br/>       List&lt;Person&gt; peopleList = personRepository.findAll();<br/>       return peopleList;<br/>    }<br/><br/>    @Override<br/>    public Person getPersonById(int id) {<br/>        return personRepository.getOne(id);<br/>    }</span></pre><h1 id="ded1" class="kh kb hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">控制器</strong></h1><p id="6fc1" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">为了将患者注册到系统中，我们将创建一个 PersonController 类并添加 PersonService 方法:</p><pre class="jq jr js jt fd jv jw jx jy aw jz bi"><span id="dd7f" class="ka kb hi jw b fi kc kd l ke kf">@Controller<br/>public class PersonController {<br/>   PersonService personService;<br/><br/>   @Autowired<br/>    public PersonController(PersonService personService) {<br/>        this.personService = personService;<br/>    }<br/><br/>    @RequestMapping("/register")<br/>    public ModelAndView getRegisterPage(){<br/>       return new ModelAndView("addUser", "person", new Person());<br/>    }<br/>    @RequestMapping(value="/register", method= RequestMethod.<em class="kg">POST</em>)<br/>    public String handleRegisterForm(@Valid @ModelAttribute("person") Person person, BindingResult bindingResult) throws SQLException {<br/>        if(bindingResult.hasErrors()){<br/>            return "addUser";<br/>        }<br/>        personService.addPerson(person);<br/><br/>        return "redirect:/";<br/>    }<br/><br/>    @RequestMapping("/patients")<br/>    public ModelAndView getUsersPage(){<br/>        return new ModelAndView("patients","patients",personService.getAllPatients());<br/>    }</span></pre><p id="2ad2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们可以在资源文件下添加一些可视化的视图。添加完视图 html 文件后，我们开始<strong class="is hj">localhost:4567/register</strong>address:</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/112267badbfcdd87e36aa3c27b4194a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ktx1JUONCaG2VNCJXEOAwQ.png"/></div></div></figure><p id="e35e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以在这里向系统添加一名患者，该患者将保存在<strong class="is hj"> PostgreSQL </strong>数据库中。然后我们可以在<strong class="is hj"> localhost: 5678/patient 列出数据库中的所有患者。</strong></p><p id="96e8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们将为所有患者添加一个更新按钮，以更改他们的 covid 状态。为此，我们将在 PersonRepository 类中使用<strong class="is hj"> @Query </strong>注释:</p><pre class="jq jr js jt fd jv jw jx jy aw jz bi"><span id="e5a9" class="ka kb hi jw b fi kc kd l ke kf">@Repository<br/>public interface PersonRepository extends JpaRepository&lt;Person, Integer&gt; {<br/>    @Transactional<br/>    @Modifying<br/>    @Query("update Person p set p.covidInfo = :covidInfo where p.id = :id")<br/>    void setCovidInfo(@Param("covidInfo") String covidInfo, @Param("id") int id);<br/><br/>    Person findByName(String name);<br/>}</span></pre><p id="11f1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里我们在 JPA 存储库中写一个更新方法。我们创建一个查询来更新患者的 covid 状态。让我们将其添加到服务、控制器和患者视图中:</p><h1 id="9f1c" class="kh kb hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">服务</h1><pre class="jq jr js jt fd jv jw jx jy aw jz bi"><span id="56a1" class="ka kb hi jw b fi kc kd l ke kf">@Override<br/>public void updatePersonCovidInfo(int id) {<br/>    personRepository.setCovidInfo("Negative",id);<br/>}</span></pre><h1 id="5d91" class="kh kb hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">控制器</h1><p id="9ca9" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">Spring Boot html 不允许我们使用 PUT 方法，所以这里我使用 POST 方法来更新患者的 covid 状态:</p><pre class="jq jr js jt fd jv jw jx jy aw jz bi"><span id="1591" class="ka kb hi jw b fi kc kd l ke kf">@RequestMapping(value="/updateCovidInfo/{id}", method= RequestMethod.<em class="kg">POST</em>)<br/>public String updateStatus(@PathVariable("id") int id){<br/>    personService.updatePersonCovidInfo(id);<br/>    return "redirect:/patients";<br/>}</span></pre><h1 id="652b" class="kh kb hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">视角</h1><pre class="jq jr js jt fd jv jw jx jy aw jz bi"><span id="aca1" class="ka kb hi jw b fi kc kd l ke kf">&lt;tr th:each="patient : ${patients}"&gt;<br/>    &lt;td th:text="${patient.name}"&gt;Patient name&lt;/td&gt;<br/>    &lt;td th:text="${patient.surname}"&gt;Patient surname&lt;/td&gt;<br/>    &lt;td th:text="${patient.age}"&gt;Patient age&lt;/td&gt;<br/>    &lt;td th:text="${patient.covidInfo}"&gt;Patient covid information&lt;/td&gt;<br/>    &lt;td&gt;<br/>        &lt;form action="#" th:action="@{'/updateCovidInfo/'+${patient.id}}" th:method="post" &gt;<br/>            &lt;input type="hidden" name="_method" value="post" /&gt;<br/>            &lt;button type="submit" id="Approve" name="Approve"&gt;Update Covid Info &lt;/button&gt;<br/>        &lt;/form&gt;<br/>    &lt;/td&gt;<br/><br/>    &lt;td&gt;<br/>        &lt;form action="#" th:action="@{'/deletePatient/'+${patient.id}}" th:method="post" &gt;<br/>            &lt;button type="submit" &gt;Delete Patient &lt;/button&gt;<br/>        &lt;/form&gt;<br/>    &lt;/td&gt;<br/>&lt;/tr&gt;</span></pre><p id="3b0e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，我用一个简单的项目向您解释了 Spring Boot Hibernate 的结构。有关更多详细信息，您可以检查项目的源代码:</p><div class="ll lm ez fb ln lo"><a href="https://github.com/minnela/SpringBootHibernateJPA" rel="noopener  ugc nofollow" target="_blank"><div class="lp ab dw"><div class="lq ab lr cl cj ls"><h2 class="bd hj fi z dy lt ea eb lu ed ef hh bi translated">明尼拉/斯普林布提伯纳特耶帕</h2><div class="lv l"><h3 class="bd b fi z dy lt ea eb lu ed ef dx translated">带有 Hibernate GitHub 的 Covid 信息 Spring Boot 系统是 5000 多万开发人员的家园，他们共同努力…</h3></div><div class="lw l"><p class="bd b fp z dy lt ea eb lu ed ef dx translated">github.com</p></div></div><div class="lx l"><div class="ly l lz ma mb lx mc io lo"/></div></div></a></div><p id="396c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢您的阅读:)</p></div></div>    
</body>
</html>