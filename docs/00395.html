<html>
<head>
<title>Web Scrapping Cricket ODI data from HowStat and Preprocessing the data Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Web废弃来自HowStat的Cricket ODI数据并预处理数据第1部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/web-scrapping-cricket-odi-data-from-howstat-and-preprocessing-the-data-part-1-a0353fc1bf3b?source=collection_archive---------0-----------------------#2019-05-26">https://medium.com/analytics-vidhya/web-scrapping-cricket-odi-data-from-howstat-and-preprocessing-the-data-part-1-a0353fc1bf3b?source=collection_archive---------0-----------------------#2019-05-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/ce24a2f3426e570bd0203e324d439c74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8l2hDkK-YGqe6FE7.png"/></div></div></figure><div class=""/><p id="92fb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi jo translated"><span class="l jp jq jr bm js jt ju jv jw di"> C </span>佝偻病是我最喜欢的运动之一(虽然我不能玩它来保命)。由于<strong class="is hu">世界杯</strong>日益临近，我相信数百万板球球迷正试图预测谁将把板球的荣耀带回家。我曾为在iplpredictormatches.pythonanywhere.com<strong class="is hu">举行的<strong class="is hu"> </strong> <a class="ae jx" href="http://iplpredictormatches.pythonanywhere.com" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">印度20板球联赛IPL进行过一些预测。我也希望为世界杯制造类似的预测机。而且，本文涵盖了这一过程的第一步—数据收集阶段。</strong></a></strong></p><blockquote class="jy jz ka"><p id="43d1" class="iq ir kb is b it iu iv iw ix iy iz ja kc jc jd je kd jg jh ji ke jk jl jm jn hb bi translated">数据收集阶段是一项任务，可能会占用任何项目总时间的70%到80%。为了收集数据，我将使用网络抓取，因为所有主要的板球数据都在网上，我们可以很容易地通过网络抓取来访问它。HowStat是一个优秀的结构化板球统计网站，我将在本文中使用它。另一个很好的选择是espncricinfo.com。</p></blockquote><p id="7ae5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于这篇文章，我将只执行两个任务<strong class="is hu"> — </strong></p><ol class=""><li id="cb0b" class="kf kg ht is b it iu ix iy jb kh jf ki jj kj jn kk kl km kn bi translated"><strong class="is hu">查找所有参加过ODI比赛的玩家</strong></li><li id="30da" class="kf kg ht is b it ko ix kp jb kq jf kr jj ks jn kk kl km kn bi translated">找出所有球员在每一年的分数，以及他们在那一年打了多少场比赛。</li></ol><p id="015c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们从第一个任务开始。对于web报废，我们需要首先导入以下基本库:</p><p id="7632" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">文件名:scrapping.py</p><figure class="ku kv kw kx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kt"><img src="../Images/c55990a77e9cfde00d52a024fbf8c311.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IuNU4uBR_xstPD0aXR7EAw.png"/></div></div></figure><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="16de" class="ld le ht kz b fi lf lg l lh li">import pandas as pd  # file operations<br/>from bs4 import BeautifulSoup as soup  #Scrapping tool<br/>from urllib.request import urlopen as ureq # For requesting data from link<br/>import numpy as np<br/>import re</span></pre><p id="6a6d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们将使用Beautiful Soup编写web抓取代码:</p><p id="fe3b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于URL，我去了HowStat网站，并决定首先获取从A开始的带有字母表的球员的数据——因为他们提供了不同组的球员的名字的起始字符。为简单起见，我们先取字符a。</p><p id="4d80" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">于是，网站网址为<a class="ae jx" href="http://howstat.com/cricket/Statistics/Players/PlayerList.asp?Country=ALL&amp;Group=A" rel="noopener ugc nofollow" target="_blank">http://howstat . com/cricket/Statistics/Players/player list . ASP？Country=ALL &amp; Group=A </a>。转到这个网站链接，按Ctrl+Shift+I检查HTML代码。通过这个，你就可以了解所需数据在HTML代码中的位置。这一点很重要，因为我们将通过HTML代码进行处理。接下来，由于我们需要所有可见玩家的数据，我们有两个选择。</p><ol class=""><li id="ecbb" class="kf kg ht is b it iu ix iy jb kh jf ki jj kj jn kk kl km kn bi translated">单独获取每个数据。</li><li id="f73c" class="kf kg ht is b it ko ix kp jb kq jf kr jj ks jn kk kl km kn bi translated">拿走整张桌子。</li></ol><p id="e393" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">显然，第二个想法更有吸引力，需要的代码也更少。</p><figure class="ku kv kw kx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lj"><img src="../Images/f2ab0ab8c9f966431d742ee7950d1b9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ukLLFNj7npzWQWA4zyLfkA.png"/></div></div></figure><p id="5885" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为此，我们需要在HTML代码中查看该表，并找到class属性的内容，以便我们的代码可以唯一地找到它。</p><figure class="ku kv kw kx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lk"><img src="../Images/46e765f8af43fa40ada43a66f060ca93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_RUBrPzzHyaJaVR21BmAtQ.png"/></div></div></figure><p id="e059" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上图中的table.tablelined显示，对于table标签，我们将class属性值设置为tablelined。</p><p id="6298" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，我们的代码变成了:</p><figure class="ku kv kw kx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kt"><img src="../Images/8d47af987e1d5330bf736865b1ab726b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UUt96mV4xHJH-ckrYSX_wQ.png"/></div></div></figure><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="df55" class="ld le ht kz b fi lf lg l lh li">url = "<a class="ae jx" href="http://howstat.com/cricket/Statistics/Players/PlayerList.asp?Group={" rel="noopener ugc nofollow" target="_blank">http://howstat.com/cricket/Statistics/Players/PlayerList.asp?Group=</a>A"<br/>pagehtml = ureq(url) #opening the URL<br/>soup = soup(pagehtml,"html.parser") #parse the html<br/>table = soup.find("table", { "class" : "TableLined" })</span></pre><p id="942c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们需要访问Table变量中这个表的各个单元格。我们需要两个for循环—一个遍历行，另一个遍历列。我们将把这些数据存储在新的变量数据中。</p><figure class="ku kv kw kx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ll"><img src="../Images/cbbd97410dbca4aef047d493e5ef1d23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QDwzpKHThVjZg9Nt9LJ_jg.png"/></div></div></figure><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="8560" class="ld le ht kz b fi lf lg l lh li">for x in table:<br/>    rows = table.find_all('tr') #find all tr tag(rows)<br/>for tr in rows:<br/>    data=[]<br/>    cols = tr.find_all('td') #find all td tags(columns)<br/>    for td in cols:<br/>        data.append(td.text.strip()) </span></pre><p id="397f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们将这些数据保存在CSV文件中。所以，我们对代码的修改产生了:</p><figure class="ku kv kw kx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lm"><img src="../Images/357b54eb4c33df1b9cd102b8f8df7add.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a51GAB1clxFux1_Fj0W_Qg.png"/></div></div></figure><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="212e" class="ld le ht kz b fi lf lg l lh li">with open('AZ.csv', 'a',newline='') as csvfile:<br/>    f = csv.writer(csvfile)</span><span id="9115" class="ld le ht kz b fi ln lg l lh li">for x in table:<br/>        rows = table.find_all('tr') #find all tr tag(rows)<br/>    for tr in rows:<br/>        data=[]<br/>        cols = tr.find_all('td') #find all td tags(co)<br/>        for td in cols:<br/>            data.append(td.text.strip()) <br/>        f.writerow(data)<br/>        print (data)</span></pre><p id="69da" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意:这里我们使用了append，即“a”作为操作符，这样每当我们需要添加新数据时，我们以前的数据不会被删除。</p><p id="b548" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您检查创建的CSV文件，您将从表中获得所有数据。</p><p id="f5af" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，让我们对这些数据进行预处理。</p><p id="5083" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您观察CSV文件，在应该出现“0”或“null”的区域，我们什么也没有。</p><p id="5001" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，让我们用“0”替换丢失的值。为此，我们使用熊猫图书馆。</p><p id="3a77" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这种情况下，我们首先读取csv文件，然后使用isNull()方法获取所有缺失的位置。True意味着该值为Null。</p><p id="2b38" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">之后，我们简单地用“0”替换空值。</p><p id="0300" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">代码如下:</p><figure class="ku kv kw kx fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kt"><img src="../Images/ab26fa435d3ac7c14937bc3343fad7cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gTwKhnTNVUrP-Te7jGKRoQ.png"/></div></div></figure><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="e80c" class="ld le ht kz b fi lf lg l lh li">df = pd.read_csv("AZ.csv",header = 1)<br/># Header is 1 so that unnecessary row is removed<br/>print (df['ODIs'])<br/>print (df['ODIs'].isnull())<br/>df['ODIs'].fillna(0, inplace=True)<br/>df['Tests'].fillna(0, inplace=True)<br/>df['T20s'].fillna(0, inplace=True)<br/>print (df)<br/>df.to_csv('AZ2.csv', index=False)</span></pre><p id="c48d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们只为字母表A的玩家编写了这段代码。</p><p id="7934" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们也遵循其他玩家的代码。代码中唯一的变化是在URL中，组标识符变成了A，B，C…z。</p><p id="f73b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，我们现在将把整个代码放在一个函数中，使用字母的ASCII值，并把它放在URL中。</p><p id="ac05" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，A为65，B为66，C为67等等。</p><p id="7825" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">查看新代码:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="34cd" class="ld le ht kz b fi lf lg l lh li">import csv # to do operations on CSV<br/>import pandas as pd  # file operations<br/>from bs4 import BeautifulSoup as soup  #Scrapping tool<br/>from urllib.request import urlopen as ureq # For requesting data from link<br/>import numpy as np<br/>import re</span><span id="b894" class="ld le ht kz b fi ln lg l lh li">def scrap(x):<br/>    global soup<br/>    x = chr(x)#to change integer into character</span><span id="07b0" class="ld le ht kz b fi ln lg l lh li">url = "<a class="ae jx" href="http://howstat.com/cricket/Statistics/Players/PlayerList.asp?Group=A" rel="noopener ugc nofollow" target="_blank">http://howstat.com/cricket/Statistics/Players/PlayerList.asp?Group=</a>{}".format(x)<br/>    pagehtml = ureq(url)<br/>    soup = soup(pagehtml,"html.parser") #parse the html<br/>    table = soup.find("table", { "class" : "TableLined" })<br/>    with open('AZ.csv', 'a',newline='') as csvfile:<br/>        f = csv.writer(csvfile)</span><span id="4f8a" class="ld le ht kz b fi ln lg l lh li">for x in table:<br/>            rows = table.find_all('tr') #find all tr tag(rows)<br/>        for tr in rows:<br/>            data=[]<br/>            cols = tr.find_all('td') #find all td tags(columns)<br/>            for td in cols:<br/>                data.append(td.text.strip()) <br/>            f.writerow(data)<br/>            print (data)</span><span id="ee4d" class="ld le ht kz b fi ln lg l lh li">#Handling the Missing Values using Pandas<br/>    df = pd.read_csv("AZ.csv",header = 1)#so that unnecessary row is removed<br/>    print (df['ODIs'])<br/>    print (df['ODIs'].isnull())<br/>    df['ODIs'].fillna(0, inplace=True)<br/>    df['Tests'].fillna(0, inplace=True)<br/>    df['T20s'].fillna(0, inplace=True)<br/>    print (df)<br/>    df.to_csv('AZ2.csv', index=False)</span></pre><p id="716d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们将通过给定值来调用<strong class="is hu"> scrap() </strong>函数。</p><p id="262c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，让玩家使用字母B:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="a3d8" class="ld le ht kz b fi lf lg l lh li">scrap(66)</span></pre><p id="5dea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">随后，我们可以对所有的字母进行这样的操作，球员数据将被附加到CSV文件中。</p><p id="5148" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意:我们有两个CSV文件—</p><ol class=""><li id="947e" class="kf kg ht is b it iu ix iy jb kh jf ki jj kj jn kk kl km kn bi translated">AZ.csv —包含原始数据。</li><li id="2036" class="kf kg ht is b it ko ix kp jb kq jf kr jj ks jn kk kl km kn bi translated">AZ2.csv包含预处理和清理的数据。</li></ol><p id="7888" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们找出至少参加过一次ODI比赛的球员。</p><p id="ffbb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">同样，对于测试和其他格式也可以这样做。</p><p id="a17d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">代码如下:</p><p id="1eca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4539是玩家总数。</p><p id="7da1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">文件名:odiplayers.csv</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="3f40" class="ld le ht kz b fi lf lg l lh li">import csv<br/>with open('AZ2.csv') as csvDataFile:<br/>    data=list(csv.reader(csvDataFile))<br/>#converting the data to list so we can access it easily<br/>    print ("The Players who Played ODI and the no. of times they played are:")<br/>    print("-------------------------------------------------------")<br/>    for i in range(1,4539):<br/>     <br/>      if data[i][4]!= "0.0":<br/>        print(data[i][0],data[i][4])</span></pre><p id="ae4b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在第二部分，我将解决第二个问题，即<strong class="is hu">找到所有球员每年的分数，以及他们在那一年打了多少场比赛。</strong></p></div></div>    
</body>
</html>