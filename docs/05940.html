<html>
<head>
<title>City Recommender System with Python [Part 2/3]: EDA — Finding my Schitt’s Creek</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Python的城市推荐系统[第2/3部分]:EDA——寻找我的Schitt’s Creek</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/city-recommender-system-with-python-part-2-finding-my-schitts-creek-da2f2cce2b5f?source=collection_archive---------18-----------------------#2020-05-06">https://medium.com/analytics-vidhya/city-recommender-system-with-python-part-2-finding-my-schitts-creek-da2f2cce2b5f?source=collection_archive---------18-----------------------#2020-05-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="5d80" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">还记得我们的问题吗？我们正试图为美国的城市创建一个推荐系统！为什么？为了更好地通知人们他们应该考虑在哪个城市工作，或者出于任何原因搬到哪个城市！</p><p id="8117" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这一部分中，我们简要探讨一下在<a class="ae jk" rel="noopener" href="/@melulfrescoelias/city-recommender-system-with-python-part-1-finding-my-schitts-creek-f362646280b3">第1部分</a>中搜集的数据。</p><h1 id="7a32" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">探索性数据分析</h1><p id="37c3" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated"><strong class="io hj">关于天气数据</strong></p><p id="09fb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">天气数据的表现和我们预期的一样。为了可视化这样的逻辑，在应用了Elbow方法来估计聚类数之后，我对数据进行了规范化，并使用KMeans对其进行了聚类。我还对数据使用了凝聚聚类和DBSCAN然而，知识分子似乎拥有最明显的<em class="ko">正确性</em>。</p><p id="dbe4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们首先定义一个函数来绘制elbow方法并返回规范化的数组。<em class="ko">注意，该函数假设分类变量(或索引)名为City。请随意更改和修改此功能！</em></p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="a3cb" class="ky jm hi ku b fi kz la l lb lc">def elbow_kmeans_city(data, maxRange = 10):<br/>    try:<br/>        X_w = data.drop('City',1)<br/>        X_w = MinMaxScaler().fit_transform(X_w)<br/>    except:<br/>        X_w = MinMaxScaler().fit_transform(data)</span><span id="ec98" class="ky jm hi ku b fi ld la l lb lc">    Error =[]<br/>    for i in range(1, maxRange+1):<br/>        kmeans = KMeans(n_clusters = i).fit(X_w)<br/>        kmeans.fit(X_w)<br/>        Error.append(kmeans.inertia_)</span><span id="fe2d" class="ky jm hi ku b fi ld la l lb lc">    plt.plot(range(1, maxRange+1), Error)<br/>    plt.title('Elbow method')<br/>    plt.xlabel('No of clusters')<br/>    plt.ylabel('Error')<br/>    plt.show()<br/>    <br/>    return(X_w)</span></pre><div class="kp kq kr ks fd ab cb"><figure class="le lf lg lh li lj lk paragraph-image"><img src="../Images/7d5e57aaa48eae08a5479bebccc61816.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*J_uZbrxLTNPjxnaq5lXf_Q.png"/></figure><figure class="le lf ln lh li lj lk paragraph-image"><img src="../Images/c98001e291a634e41087151a20fad149.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*Kc__jGhVUeL-bYm4CNSBgQ.png"/><figcaption class="lo lp et er es lq lr bd b be z dx ls di lt lu translated">图1:天气数据中的肘方法(左)，场馆数据中的肘方法</figcaption></figure></div><p id="b740" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">理想情况下，这种方法将显示出明显的'<em class="ko">'肘'</em>-即误差减少的突然、剧烈变化，使得添加集群的边际效益急剧降低。图1的右图显示了4处的清晰肘部。但是天气数据没有明确的<em class="ko">弯头</em>(图1左侧)。我决定应用5个集群。现在，让我们聚集和绘制数据！</p><p id="9510" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为此，我创建了这个函数。它需要规范化数组(nor MDF——<em class="ko">elbow _ k means _ city</em>函数的输出)、聚类数(k)、原始数据帧(regDF——在<em class="ko"> elbow_kmeans_city </em>函数中使用)以及包含纬度(lat)、经度(lng)和城市名称(CityName，STATE——即。纽约州纽约市)，你可以在这里下载。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="b246" class="ky jm hi ku b fi kz la l lb lc">def Map_KMeans(normDF, k, regDF, citiesLatLong):<br/>    w_mod = KMeans(n_clusters=k).fit(normDF)<br/>    temp_df = regDF<br/>    try:<br/>        temp_df = temp_df.drop('Clusters',1)<br/>    except:<br/>        pass<br/>    <br/>    temp_df.insert(0,'Clusters',w_mod.labels_)<br/>    <br/>    temp_df = temp_df.merge(citiesLatLong, how='inner',on='City')<br/>    <br/>    map_clusters = folium.Map(location=[37.0902,-95.7129], zoom_start=4)</span><span id="41a5" class="ky jm hi ku b fi ld la l lb lc"># set color scheme for the clusters<br/>    x = np.arange(k)<br/>    ys = [i + x + (i*x)**2 for i in range(k)]<br/>    colors_array = cm.rainbow(np.linspace(0, 1, len(ys)))<br/>    rainbow = [colors.rgb2hex(i) for i in colors_array]</span><span id="f594" class="ky jm hi ku b fi ld la l lb lc"># add markers to the map<br/>    markers_colors = []<br/>    for lat, lon, poi, cluster in zip(temp_df.lat, temp_df.lng, temp_df.City, temp_df['Clusters']):<br/>        label = folium.Popup(str(poi) + ' Cluster ' + str(cluster), parse_html=True)<br/>        folium.CircleMarker(<br/>            [lat, lon],<br/>            radius=4,<br/>            popup=label,<br/>            color=rainbow[cluster-1],<br/>            fill=True,<br/>            fill_color=rainbow[cluster-1],<br/>            fill_opacity=0.7).add_to(map_clusters)</span><span id="8761" class="ky jm hi ku b fi ld la l lb lc">return map_clusters, temp_df</span></pre><figure class="kp kq kr ks fd lf er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es lv"><img src="../Images/39d6cc324213f8290d6661ac6e6945b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LmWt5_622R5sqS49MOBV_A.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">图2:美国的天气集群</figcaption></figure><p id="da98" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">哇！看起来很合适。</p><ul class=""><li id="4a50" class="ma mb hi io b ip iq it iu ix mc jb md jf me jj mf mg mh mi bi translated">橙色—寒冷的冬天，潮湿的大陆城市(包括阿拉斯加，未显示)</li><li id="9adc" class="ma mb hi io b ip mj it mk ix ml jb mm jf mn jj mf mg mh mi bi translated">红色——温暖潮湿的亚热带城市</li><li id="a6c7" class="ma mb hi io b ip mj it mk ix ml jb mm jf mn jj mf mg mh mi bi translated">绿色——内陆、大摇摆、半干旱城市</li><li id="eb83" class="ma mb hi io b ip mj it mk ix ml jb mm jf mn jj mf mg mh mi bi translated">蓝色——温暖干旱的城市</li><li id="16bc" class="ma mb hi io b ip mj it mk ix ml jb mm jf mn jj mf mg mh mi bi translated">紫色——温和的夏季和冬季，年降水量丰富(海洋性西海岸气候)</li></ul><p id="f9d1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">定义好这些函数后，让我们将社会经济数据聚类的结果可视化吧！</p><p id="b8c3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">关于社会经济数据</strong></p><p id="1e9f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">由于收集数字中的指数有困难，我们失去了大部分为场地和天气数据列出的小城镇。尽管如此，它包括美国的600多个地方，包括大多数(如果不是全部的话)人口超过10万的大都市地区和城市。</p><figure class="kp kq kr ks fd lf er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mo"><img src="../Images/9876391a061b7944b844f6bde4081621.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kvAQKZhucxu_TLJI1qTOeg.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">图3:美国的一般社会经济数据集群</figcaption></figure><p id="a217" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从上面的地图中可以看出两件事。紫色圆点代表MSA，橙色代表贫困率高的高生活质量城市。</p><figure class="kp kq kr ks fd lf er es paragraph-image"><div class="er es mp"><img src="../Images/5022754934eb3bc3f2ddc86a7d040f9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*pdjMG7T__gcMx44L9NAqCg.png"/></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">图4:放大到纽约的罗切斯特和锡拉丘兹</figcaption></figure><p id="843b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将看看一些例子，包括锡拉丘兹、罗切斯特和哈里斯堡(橙色)，以及纽约和匹兹堡(紫色)。</p><div class="kp kq kr ks fd ab cb"><figure class="le lf mq lh li lj lk paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><img src="../Images/741e79bcf8887718b56c870eff38c4dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*M787xwY8OtuhYlY9Um_2tw.png"/></div></figure><figure class="le lf mr lh li lj lk paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><img src="../Images/1446f452d6e701e3bc024c26abbcc75b.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*uxMVAZmIZPt-JUdtquteLg.png"/></div></figure><figure class="le lf ms lh li lj lk paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><img src="../Images/c42f9abe004b41487bbf241fe950f26b.png" data-original-src="https://miro.medium.com/v2/resize:fit:676/format:webp/1*MbkSO6rHJgv0SazRlAUdKg.png"/></div><figcaption class="lo lp et er es lq lr bd b be z dx mt di mu lu translated">图5:纽约州锡拉丘兹、纽约州罗切斯特、宾夕法尼亚州哈里斯堡(橙色)</figcaption></figure></div><p id="527f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">低安全指数是橙色集群的常见分子。然而，让我们记住还有20多个变量包含在这个模型中，所以这可能<em class="ko">没有显示出全貌</em>！</p><div class="kp kq kr ks fd ab cb"><figure class="le lf mv lh li lj lk paragraph-image"><img src="../Images/ef14b526874560f74ec62570c72f4739.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*z7PeZxq8FoBkRYjrOBA3WA.png"/></figure><figure class="le lf mw lh li lj lk paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><img src="../Images/5457267575d135edf70900192c424694.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*v-Yy4aWPDwHbQ_EAdloy6Q.png"/></div><figcaption class="lo lp et er es lq lr bd b be z dx mx di my lu translated">图6:纽约州纽约市和宾夕法尼亚州匹兹堡市(紫色)</figcaption></figure></div><p id="115c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这种情况主要包括管理事务协议。那些不属于管理服务协议和中等/高生活费用的国家，由于对收集的数据进行插补，可能是异常值。这一群，紫色，显然有很高的购买力，但中等偏高的生活费用指数。然而，如前所述，还包括20多个变量！</p><p id="e71d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">关于场馆数据</strong></p><figure class="kp kq kr ks fd lf er es paragraph-image"><div class="er es mz"><img src="../Images/8f1dcc02424a05a78e61f6018d3c1e05.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*auyafLj6Yf5JP8eVGEwaWg.png"/></div></figure><p id="f7bc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这张帕累托图显示了我们数据集中排名前30位的场所类型(600+中),显示了美国对快餐店、披萨店、美式餐厅和三明治店的高度重视。根据城市的贫困程度和规模，你预计这些类型的餐厅在每个城市的前100名中会出现得更多还是更少？</p><figure class="kp kq kr ks fd lf er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es na"><img src="../Images/d7ac47b1663a46ae38a79b5cbbb8d6fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7wt6uWKHw0m9Md5BZNnWTA.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">图8:排名前100的顶级场馆</figcaption></figure><p id="1398" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">绿点主要代表MSA，我们认为它描绘了与美国大多数大陆城镇不同的文化特征。我们还看到，与国家东部的红色和紫色圆点密度相比，国家西部的蓝色圆点密度更大。</p><p id="e9e2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里有什么好玩的？这张图<em class="ko">证实了</em>每个城市排名前100的受评场馆在不同的城市和不同类型的城市中是不同的。这可能表明，基于城市的文化背景和经济(或迁移)状况，饮食和活动习惯有显著差异。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="1e85" class="jl jm hi bd jn jo nb jq jr js nc ju jv jw nd jy jz ka ne kc kd ke nf kg kh ki bi translated">关于数据的注释</h1><p id="a099" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">值得一提的是，数据是根据每个变量的分布进行转换的。我这样做是为了防止建模过程中的多重共线性。但是为什么我们在创建推荐系统之前要对数据建模呢？</p><h1 id="6ca8" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">建模</h1><p id="1e74" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">如果我们在没有事先建模的情况下使用推荐系统中的所有变量(这是由余弦相似性驱动的——在第3部分中有更多这方面的内容),我们将为数据的每个特征赋予相等的归一化权重。换句话说，两个向量(输入、可能的推荐)的点积将对每个变量进行同等加权。然而，你可能已经意识到，我们(人们)更关心我们的收入，而不是城市里披萨店的频率！因此，我们必须回归我们的数据，以确定每个特征的权重(系数)……但是基于什么呢？我们的因变量应该是什么！？</p><p id="e5be" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我首先考虑做一个接近购买力的指标——中值房产价值除以中值家庭收入。但是这个<em class="ko">‘值’</em>指标，效果并不好。我迭代了不同的模型并测试了它们...你猜怎么着？看起来表现最好的模型回归了<em class="ko">家庭收入中位数</em>！</p><p id="b2c1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，我使用了岭回归——由于变量的多重共线性仍然存在——家庭收入中位数的标准化变量，并将返回的系数乘以数据框！</p><p id="1838" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">厉害！现在，我们已经有了经过缩放的<a class="ae jk" href="https://s3.us-east-2.amazonaws.com/www.findingmyschittscreek.com/Data/normalized_df_sub.csv" rel="noopener ugc nofollow" target="_blank">数据</a>，可以构建推荐系统了！</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="7318" class="jl jm hi bd jn jo nb jq jr js nc ju jv jw nd jy jz ka ne kc kd ke nf kg kh ki bi translated">Github和数据链接</h1><ol class=""><li id="5ee6" class="ma mb hi io b ip kj it kk ix ng jb nh jf ni jj nj mg mh mi bi translated"><a class="ae jk" href="https://github.com/eliasmelul/finding_schitts/blob/master/EDA_FMSC.ipynb" rel="noopener ugc nofollow" target="_blank"> EDA笔记本</a> — <a class="ae jk" href="https://s3.us-east-2.amazonaws.com/www.findingmyschittscreek.com/Data/allDataCombined.csv" rel="noopener ugc nofollow" target="_blank">直接数据下载</a></li><li id="9610" class="ma mb hi io b ip mj it mk ix ml jb mm jf mn jj nj mg mh mi bi translated"><a class="ae jk" href="https://github.com/eliasmelul/finding_schitts/blob/master/modeling_LM_FMSC.ipynb" rel="noopener ugc nofollow" target="_blank">建模笔记本</a> — <a class="ae jk" href="https://s3.us-east-2.amazonaws.com/www.findingmyschittscreek.com/Data/normalized_df_sub.csv" rel="noopener ugc nofollow" target="_blank">直接数据下载</a></li></ol></div></div>    
</body>
</html>