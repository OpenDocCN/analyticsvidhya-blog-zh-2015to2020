<html>
<head>
<title>Model Ensembles For Survival Prediction..!!!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">生存预测的模型集成..！！！</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/model-ensembles-for-survival-prediction-a3ecc9f7c2ae?source=collection_archive---------30-----------------------#2020-04-13">https://medium.com/analytics-vidhya/model-ensembles-for-survival-prediction-a3ecc9f7c2ae?source=collection_archive---------30-----------------------#2020-04-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4317" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">泰坦尼克号生存预测——也许这是每个机器学习爱好者迈向数据科学的第一步。这可能是世界上被利用最多的数据集之一。随着时间的推移，它已经成为机器学习的游乐场，不仅对新手数据科学家来说如此，对有经验的联盟来说也是如此。</p><p id="63a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尽管有数百个关于同一主题的博客和解决方案，但这篇文章的全部目的是强调方法而不是排名。在本文中，我将给出一个简单的逐步指南来解决这个问题，并将最常用的机器学习模型平均在一起，以获得平均预测。</p><p id="375e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd">请从我的</em> </strong> <a class="ae je" href="https://github.com/raj1611/Titanic" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="jd"> GitHub资源库</em> </strong> </a> <strong class="ih hj"> <em class="jd">下载</em> </strong> <a class="ae je" href="https://github.com/raj1611/Titanic/blob/master/Model%20Ensembles%20For%20Survival%20Prediction.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="jd">代码</em> </strong> </a> <strong class="ih hj"> <em class="jd">。本文只展示了几个重要的代码。</em> </strong></p><h2 id="9366" class="jf jg hi bd jh ji jj jk jl jm jn jo jp iq jq jr js iu jt ju jv iy jw jx jy jz bi translated">背景—</h2><figure class="kb kc kd ke fd kf er es paragraph-image"><div class="er es ka"><img src="../Images/b351c761849ebe131106fcdf32b82b6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*k3uEhxZ4G2uKGUT2KpZNYg.jpeg"/></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">1912年4月15日凌晨，由白星航运公司运营的英国客轮泰坦尼克号在从南安普敦到纽约的处女航中撞上冰山后沉没在北大西洋。据估计，船上2224名乘客和船员中，超过1500人死亡，这使得沉船成为现代史上最致命的和平时期商业海上灾难之一。皇家邮轮泰坦尼克号是当时最大的船只，也是白星航运公司运营的三艘奥运级远洋客轮中的第二艘。她是由贝尔法斯特的哈兰和沃尔夫造船厂建造的。托马斯·安德鲁斯，当时造船厂的首席造船师，在灾难中死亡(来源维基)</figcaption></figure><p id="61a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Kaggle竞赛非常简单:使用机器学习来创建一个模型，预测哪些乘客在泰坦尼克号沉船事件中幸存。</p><p id="34aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">工作流程是怎样的？</p><p id="3fbe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我会保持简单明了，而不是使用时髦的词语。这将有助于你坚持下去。这是工作流程。</p><p id="597f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 1。问题识别</strong></p><p id="6992" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。我们有什么数据？</strong></p><p id="0e7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3。探索性数据分析</strong></p><p id="1a8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 4。数据准备包括特征工程</strong></p><p id="39d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 5。开发模型</strong></p><p id="9874" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 6。模型评估</strong></p><p id="1b3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 7。结论</strong></p><p id="79bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是解决数据科学问题所需的全部内容。</p><p id="3da4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 1。问题识别</strong></p><p id="31f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">最佳实践</strong> —任何项目最重要的部分是正确识别问题。在你像典型的数据科学家一样跳到“如何做到这一点”之前，先理解“做什么/为什么”这一部分。<br/>首先了解问题，然后从在一张纸上起草一个粗略的策略开始。写下诸如你期望做什么&amp;你可能需要什么数据或者说你计划使用什么算法之类的东西。</p><p id="3fdf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">目标是基于一组描述年龄、性别或船上乘客等级的变量来预测给定乘客的生存或死亡。</p><p id="de5d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以这是一个分类问题，你应该预测生存为1，死亡为0。</p><p id="3cdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。我们有什么数据？</strong></p><p id="15d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们导入必要的库&amp;首先在Python环境中引入数据集。一旦我们在Python环境中有了数据集，我们就可以对数据进行切片和切块，以了解我们有什么和缺少什么。</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="4fe4" class="jf jg hi ko b fi ks kt l ku kv"># Import the basic python libraries<br/>import pandas as pd<br/>import numpy as np<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt <br/>get_ipython().run_line_magic(‘matplotlib’, ‘inline’)<br/>sns.set(style=’white’, context=’notebook’, palette=’deep’)<br/>import warnings<br/>warnings.filterwarnings(‘ignore’)<br/># Read the datasets<br/>train = pd.read_csv(“../input/train.csv”)<br/>test = pd.read_csv(“../input/test.csv”)<br/>IDtest = test[“PassengerId”]<br/>train.info()<br/>test.info()</span></pre><p id="8cd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在训练数据集中有891个观察值和12列，在测试数据集中有418个观察值和11列。查看变量类型的组合。</p><p id="8db0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3。探索性数据分析</strong></p><p id="d641" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">机器学习的一个重要方面是确保变量在训练和测试数据中显示几乎相同的趋势。否则，将会导致过度拟合，因为模型表示的关系在测试数据集中不适用。</p><p id="55c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在这里举一个例子。当我们进行变量分析时，试着复制(在任何适用的地方)测试数据的代码，看看在数据分布中是否有任何主要的不同。</p><p id="2a0b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">示例—让我们从查找缺失值的数量开始。如果您比较输出，您将会看到缺失值百分比在训练和测试数据集之间变化不大。</p><p id="0b36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用分组/单变量/双变量分析方法比较培训和测试数据的分布。</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="cd7f" class="jf jg hi ko b fi ks kt l ku kv"># Check missing values in train data set<br/>train_na = (train.isnull().sum() / len(train)) * 100<br/>train_na = train_na.drop(train_na[train_na == 0].index).sort_values(ascending=False)[:30]<br/>miss_train = pd.DataFrame({‘Train Missing Ratio’ :train_na})<br/>miss_train.head()</span><span id="6764" class="jf jg hi ko b fi kw kt l ku kv"># Check missing values in train data set<br/>test_na = (test.isnull().sum() / len(test)) * 100<br/>test_na = test_na.drop(test_na[test_na == 0].index).sort_values(ascending=False)[:30]<br/>miss_test = pd.DataFrame({‘Test Missing Ratio’ :test_na})<br/>miss_test.head()</span><span id="0ae3" class="jf jg hi ko b fi kw kt l ku kv"># Fill empty and NaNs values with NaN<br/>train = train.fillna(np.nan)<br/>test = test.fillna(np.nan)</span></pre><p id="5de7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> PassengerId — </strong>与建模角度无关，因此我们稍后将删除该变量</p><p id="3751" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Pclass — </strong> Pclass是一个分类变量。我们来看看分布。</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="ae23" class="jf jg hi ko b fi ks kt l ku kv"># Analyze the Survival Probability by Pclass<br/>g = sns.barplot(x=”Pclass”,y=”Survived”,data=train)<br/>g = g.set_ylabel(“Survival Probability”)<br/>train[[‘Pclass’, ‘Survived’]].groupby([‘Pclass’]).mean().sort_values(by=’Survived’, ascending=False)</span></pre><figure class="kb kc kd ke fd kf er es paragraph-image"><div class="er es kx"><img src="../Images/ef810e3ba84c2aa09a9143c26992ab0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*SeMsz-5xAq8zarsfzvVO7g.png"/></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">大约62%的乘客幸存，其次是47%的乘客2</figcaption></figure><p id="2eb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">名称— </strong>与分析&amp;建模角度无关。在创建一个新变量作为标题后，我们将放弃这个特性。</p><p id="05ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">性别- </strong>根据以下分析，女性乘客比男性乘客有更大的生还机会。</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="14aa" class="jf jg hi ko b fi ks kt l ku kv"># Analyze the Survival Probability by Gender<br/>g = sns.barplot(x=”Sex”,y=”Survived”,data=train)<br/>g = g.set_ylabel(“Survival Probability”)<br/>train[[“Sex”, “Survived”]].groupby([‘Sex’]).mean().sort_values(by=’Survived’, ascending=False)</span></pre><figure class="kb kc kd ke fd kf er es paragraph-image"><div class="er es kx"><img src="../Images/94b8c6a27c6b844584b2dc8d129bdbcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*JUAGTwZsvx3EdojHFHifzg.png"/></div></figure><p id="c58e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">年龄- </strong>下面的洞察力连接回电影的“女士和小孩优先”场景。这表明很多婴儿和小孩存活了下来。</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="60f1" class="jf jg hi ko b fi ks kt l ku kv"># Let’s explore the distribution of age by response variable (Survived)<br/>fig = plt.figure(figsize=(10,8),)<br/>axis = sns.kdeplot(train.loc[(train[‘Survived’] == 1),’Age’] , color=’g’,shade=True, label=’Survived’)<br/>axis = sns.kdeplot(train.loc[(train[‘Survived’] == 0),’Age’] , color=’b’,shade=True,label=’Did Not Survived’)<br/>plt.title(‘Age Distribution — Surviver V.S. Non Survivors’, fontsize = 20)<br/>plt.xlabel(“Passenger Age”, fontsize = 12)<br/>plt.ylabel(‘Frequency’, fontsize = 12);</span></pre><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ky"><img src="../Images/4c0ab1f605f4a217a56035f922c2d220.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*LgL7LyItCUZ7bOzpNDsVoQ.png"/></div></div></figure><p id="a0be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> SibSP </strong> —该变量指船上兄弟姐妹/配偶的数量。SibSP = 1和SibSP = 2显示更高的存活机会。</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="ec6b" class="jf jg hi ko b fi ks kt l ku kv"># Analyze probability of survival by SibSP<br/>g = sns.factorplot(x=”SibSp”,y=”Survived”,data=train,kind=”bar”, size = 7 ,palette = “muted”)<br/>g.despine(left=True)<br/>g = g.set_ylabels(“survival probability”)<br/>train[[“SibSp”, “Survived”]].groupby([‘SibSp’]).mean().sort_values(by=’Survived’, ascending=False)</span></pre><figure class="kb kc kd ke fd kf er es paragraph-image"><div class="er es ld"><img src="../Images/2b2f10ca4112eab7b4fff63cccdaeb6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*CJZTDnmukmyuWEuU0utCRw.png"/></div></figure><p id="d769" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Parch表示泰坦尼克号上父母/孩子的数量。请注意，Parch = 3和Parch = 1显示了更高的生存概率。</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="cda3" class="jf jg hi ko b fi ks kt l ku kv"># Analyze the Survival Probability by Parch<br/>g = sns.factorplot(x=”Parch”,y=”Survived”,data=train,kind=”bar”, size = 7 ,palette = “muted”)<br/>g.despine(left=True)<br/>g = g.set_ylabels(“Survival Probability”)<br/>train[[“Parch”, “Survived”]].groupby([‘Parch’]).mean().sort_values(by=’Survived’, ascending=False)</span></pre><figure class="kb kc kd ke fd kf er es paragraph-image"><div class="er es ld"><img src="../Images/15b265a2f2f66cec0d5adda9d148bc75.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*qHJi-L_KObJLxZPlUr_xOQ.png"/></div></figure><p id="d3f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">门票</strong> -这个变量有一个字母数字值，可能与生存没有直接关系，但我们可以使用这个变量来创建一些额外的功能。</p><p id="77d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">票价</strong>——我们先看看分布情况。</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="853d" class="jf jg hi ko b fi ks kt l ku kv">from scipy import stats<br/>from scipy.stats import norm, skew #for some statistics<br/>sns.distplot(train[‘Fare’] , fit=norm);<br/># Get the fitted parameters used by the function<br/>(mu, sigma) = norm.fit(train[‘Fare’])<br/>print( ‘\n mu = {:.2f} and sigma = {:.2f}\n’.format(mu, sigma))<br/>#Now plot the distribution<br/>plt.legend([‘Normal dist. ($\mu=$ {:.2f} and $\sigma=$ {:.2f} )’.format(mu, sigma)],loc=’best’)<br/>plt.ylabel(‘Frequency’)<br/>plt.title(‘Fare distribution’)</span></pre><figure class="kb kc kd ke fd kf er es paragraph-image"><div class="er es le"><img src="../Images/f7e7b4e96968952e3e6efca73555865e.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*JIBi3iwxmmWBl_UDForQ6A.png"/></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">票价变量是右偏的。我们需要使用log函数来转换这个变量，并使其更符合正态分布。我们将在特征工程过程中完成这项工作。</figcaption></figure><p id="edc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">舱室</strong> —字母数字变量。687序列中的缺失值&amp; 327测试数据中的缺失值—需要处理。我们可以使用这个Cabin变量创建更多的功能。</p><p id="1e3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">登船</strong> — C =瑟堡，Q =皇后镇，S =南安普顿</p><p id="3431" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们用存活率来探讨这个变量。上船代表上船的港口。正如下面的分析输出所表明的，Emabrked C显示出很高的生存概率。</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="326c" class="jf jg hi ko b fi ks kt l ku kv"># Analyze the Survival Probability by Embarked<br/>g = sns.factorplot(x=”Embarked”,y=”Survived”,data=train,kind=”bar”, size = 7 ,palette = “muted”)<br/>g.despine(left=True)<br/>g = g.set_ylabels(“survival probability”)<br/>train[[“Embarked”, “Survived”]].groupby([‘Embarked’]).mean().sort_values(by=’Survived’, ascending=False)</span></pre><figure class="kb kc kd ke fd kf er es paragraph-image"><div class="er es ld"><img src="../Images/b968fb1658f9854c159f05ffca16e83d.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*JpKeTtmXiIKf7HEO-vsjWg.png"/></div></figure><p id="b9bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">附加分析</strong> —让我们创建几个附加图表，看看不同变量之间的关系。我们称之为多元分析。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div class="er es lf"><img src="../Images/407845410a4aef5151f8ede947ed5e22.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*vuVY8fzhjY8KDq6pKfP8EA.png"/></div></figure><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="3b7b" class="jf jg hi ko b fi ks kt l ku kv"># Age, Pclass &amp; Survival<br/>sns.lmplot(‘Age’,’Survived’,data=train,hue=’Pclass’)</span></pre><figure class="kb kc kd ke fd kf er es paragraph-image"><div class="er es lg"><img src="../Images/f20db967cfafa629d310a90964f63551.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*nVxDO5dV-JOGCH7MnG22LQ.png"/></div></figure><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="c274" class="jf jg hi ko b fi ks kt l ku kv"># Age, Embarked, Sex, Pclass<br/>g = sns.catplot(x=”Age”, y=”Embarked”, hue=”Sex”, row=”Pclass”, data=train[train.Embarked.notnull()], <br/>orient=”h”, height=2, aspect=3, palette=”Set3", kind=”violin”, dodge=True, cut=0, bw=.2)</span></pre><figure class="kb kc kd ke fd kf er es paragraph-image"><div class="er es ky"><img src="../Images/425ea8354c8f6696e669bf6d59a1f79c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*woCETPnfzYJ_NdfGP5IsXg.png"/></div></figure><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="39e8" class="jf jg hi ko b fi ks kt l ku kv"># Relation among Pclass, Gender &amp; Survival Rate<br/>g = sns.catplot(x=”Sex”, y=”Survived”, col=”Pclass”, data=train, saturation=.5, kind=”bar”, ci=None, aspect=.6)</span></pre><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lh"><img src="../Images/c4af763111bf4e81c221f6d43d57ebd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JBZUkPpT9uOcTbo_Gv1dVQ.png"/></div></div></figure><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="c759" class="jf jg hi ko b fi ks kt l ku kv"># Relation among SibSP, Gender &amp; Survival Rate<br/>g = sns.catplot(x=”Sex”, y=”Survived”, col=”SibSp”, data=train, <br/>saturation=.5,kind=”bar”, ci=None, aspect=.6)</span></pre><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lh"><img src="../Images/cdd87abaca53e2a23924672b5dad4ccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FgAhnyRLLTfOiAtSkHxEhQ.png"/></div></div></figure><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="2687" class="jf jg hi ko b fi ks kt l ku kv"># Relation among Parch, Gender &amp; Survival Rate<br/>g = sns.catplot(x=”Sex”, y=”Survived”, col=”Parch”, data=train, saturation=.5,kind=”bar”, ci=None, aspect=.6)</span></pre><p id="ea2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 4。包括特征工程在内的数据准备</strong></p><p id="3497" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建一个组合数据集，一次性复制训练和测试数据集的特征工程。我们需要做的是处理以下变量-</p><p id="0245" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">乘客ID </strong> —无需任何操作。我们可以去掉这个变量。</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="d1cb" class="jf jg hi ko b fi ks kt l ku kv"># PassengerID — Drop PassengerID<br/>combdata.drop(labels = [“PassengerId”], axis = 1, inplace = True)</span></pre><p id="1fcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> PClass </strong> —只有3个数值。我们将照原样使用它。</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="c675" class="jf jg hi ko b fi ks kt l ku kv"># Pclass — Use as it is<br/>combdata[‘Pclass’].unique()</span></pre><p id="9e09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">名称</strong> —可用于通过从名称中提取称呼来创建新的变量标题。</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="3113" class="jf jg hi ko b fi ks kt l ku kv"># Name — Extract Salutation from Name variable<br/>salutation = [i.split(“,”)[1].split(“.”)[0].strip() for i in combdata[“Name”]]<br/>combdata[“Title”] = pd.Series(salutation)<br/>combdata[“Title”].unique()</span><span id="6cb6" class="jf jg hi ko b fi kw kt l ku kv"># Convert other salutations to fixed Title <br/>combdata[“Title”] = combdata[“Title”].replace([‘Lady’, ‘the Countess’,’Countess’,’Capt’, ‘Col’,’Don’, ‘Dr’, ‘Major’, ‘Rev’, ‘Sir’, ‘Jonkheer’, ‘Dona’], ‘Rare’)<br/>combdata[“Title”] = combdata[“Title”].map({“Master”:0, “Miss”:1, “Ms” : 1 , “Mme”:1, “Mlle”:1, “Mrs”:1, “Mr”:2, “Rare”:3})<br/>combdata[“Title”] = combdata[“Title”].astype(int)<br/>combdata[“Title”].unique()</span></pre><p id="17cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">性别——创造虚拟变量</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="0198" class="jf jg hi ko b fi ks kt l ku kv"># Sex — Create dummy variables<br/>#combdata[“Sex”] = combdata[“Sex”].map({“male”: 0, “female”:1}) or<br/>combdata = pd.get_dummies(combdata, columns = [“Sex”])</span></pre><p id="3bad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">年龄</strong> —缺失值处理，随后创建虚拟变量</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="f43a" class="jf jg hi ko b fi ks kt l ku kv">## Fill Age with the median age of similar rows according to Sex, Pclass, Parch and SibSp<br/># Index of NaN age rows<br/>missing_index = list(combdata[“Age”][combdata[“Age”].isnull()].index)</span><span id="c8d7" class="jf jg hi ko b fi kw kt l ku kv">for i in missing_index :<br/> median_age = combdata[“Age”].median()<br/> filled_age = combdata[“Age”][((combdata[‘Sex’] == combdata.iloc[i][“Sex”]) &amp; <br/> (combdata[‘SibSp’] == combdata.iloc[i][“SibSp”]) &amp; <br/> (combdata[‘Parch’] == combdata.iloc[i][“Parch”]) &amp; <br/> (combdata[‘Pclass’] == combdata.iloc[i][“Pclass”]))].median()<br/> if not np.isnan(filled_age) :<br/> combdata[‘Age’].iloc[i] = filled_age<br/> else :<br/> combdata[‘Age’].iloc[i] = median_age</span></pre><p id="89d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> SibSP </strong> —创建虚拟变量</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="6529" class="jf jg hi ko b fi ks kt l ku kv"># SibSp — Create dummy variables<br/>combdata = pd.get_dummies(combdata, columns = [“SibSp”])</span></pre><p id="e44c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">烤盘</strong> —创建虚拟变量</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="1d5e" class="jf jg hi ko b fi ks kt l ku kv"># Parch — Create dummy variables<br/>combdata = pd.get_dummies(combdata, columns = [“Parch”])</span></pre><p id="4139" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">标签</strong> —创建虚拟变量发布特征工程</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="ce00" class="jf jg hi ko b fi ks kt l ku kv"># Ticket — Extracting the ticket prefix. This might be a representation of class/compartment.<br/># If there is no prefix replace with U (Unknown).</span><span id="3aae" class="jf jg hi ko b fi kw kt l ku kv">Ticket = []<br/>for i in list(combdata.Ticket):<br/> if not i.isdigit() :<br/> Ticket.append(i.replace(“.”,””).replace(“/”,””).strip().split(‘ ‘)[0])<br/> else:<br/> Ticket.append(“U”)<br/> <br/>combdata[“Ticket”] = Ticket<br/>combdata[“Ticket”].unique()</span><span id="6a09" class="jf jg hi ko b fi kw kt l ku kv">combdata = pd.get_dummies(combdata, columns = [“Ticket”], prefix=”T”)</span></pre><p id="d294" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Fare </strong> —缺失值处理后的日志归一化</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="c728" class="jf jg hi ko b fi ks kt l ku kv"># Fare — Check the number of missing value<br/>combdata[“Fare”].isnull().sum()</span><span id="8a21" class="jf jg hi ko b fi kw kt l ku kv"># Only 1 value is missing so we will fill the same with median<br/>combdata[“Fare”] = combdata[“Fare”].fillna(combdata[“Fare”].median())</span><span id="f787" class="jf jg hi ko b fi kw kt l ku kv"># Use the numpy fuction log1p which applies log(1+x) to all elements of the column<br/>combdata[“Fare”] = np.log1p(combdata[“Fare”])</span><span id="5ec1" class="jf jg hi ko b fi kw kt l ku kv">#Check the new distribution <br/>sns.distplot(combdata[‘Fare’] , fit=norm);</span></pre><p id="eff1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">舱室</strong>——创建虚拟变量后特征工程</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="4a32" class="jf jg hi ko b fi ks kt l ku kv"># Cabin — Replace the missing Cabin number by the type of cabin unknown ‘U’ and create dummy variables<br/>combdata[“Cabin”] = pd.Series([i[0] if not pd.isnull(i) else ‘U’ for i in combdata[‘Cabin’] ])</span></pre><p id="acf2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">已装载</strong>——创建虚拟变量</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="0969" class="jf jg hi ko b fi ks kt l ku kv"># Embarked — Find the number of missing values<br/>combdata[“Embarked”].isnull().sum()</span><span id="17ed" class="jf jg hi ko b fi kw kt l ku kv"># Fill Embarked missing values of dataset set with mode ‘S’<br/>combdata[“Embarked”] = combdata[“Embarked”].fillna(“S”)</span><span id="8337" class="jf jg hi ko b fi kw kt l ku kv"># Create dummy variables<br/>combdata = pd.get_dummies(combdata, columns = [“Embarked”], prefix=”Emb”)</span></pre><p id="b9e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 5。开发模型</strong></p><p id="8b93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导入所需的库&amp;分离训练和测试数据集。建立交叉验证策略。在所有特征工程步骤之后，训练和测试总共将有75列(特征)。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div class="er es li"><img src="../Images/5f8cd2f4ae90435386129650f94f8cf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*dvvxWrgIf_RC51bKMyJzRA.png"/></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">平均准确度的交叉验证分数</figcaption></figure><p id="4a38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 6。模型评估</strong></p><p id="a51c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Adaboost </strong> —准确率81.81%</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="ba5c" class="jf jg hi ko b fi ks kt l ku kv"># Adaboost<br/>DTC = DecisionTreeClassifier()</span><span id="261b" class="jf jg hi ko b fi kw kt l ku kv">adaDTC = AdaBoostClassifier(DTC, random_state=7)</span><span id="0960" class="jf jg hi ko b fi kw kt l ku kv">ada_param_grid = {“base_estimator__criterion” : [“gini”, “entropy”],<br/> “base_estimator__splitter” : [“best”, “random”],<br/> “algorithm” : [“SAMME”,”SAMME.R”],<br/> “n_estimators” :[1,2],<br/> “learning_rate”: [0.0001, 0.001, 0.01, 0.1, 0.2, 0.3,1.5]}</span><span id="2801" class="jf jg hi ko b fi kw kt l ku kv">gsadaDTC = GridSearchCV(adaDTC,param_grid = ada_param_grid, cv=kfold, scoring=”accuracy”, n_jobs= 4, verbose = 1)<br/>gsadaDTC.fit(X_train,Y_train)<br/>ada_best = gsadaDTC.best_estimator_<br/>gsadaDTC.best_score_</span></pre><p id="c1f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">额外树分类器</strong> —准确率83.16%</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="3f1a" class="jf jg hi ko b fi ks kt l ku kv">#ExtraTrees <br/>ExtC = ExtraTreesClassifier()</span><span id="e57e" class="jf jg hi ko b fi kw kt l ku kv">## Search grid for optimal parameters<br/>ex_param_grid = {“max_depth”: [None],<br/> “max_features”: [1, 3, 10],<br/> “min_samples_split”: [2, 3, 10],<br/> “min_samples_leaf”: [1, 3, 10],<br/> “bootstrap”: [False],<br/> “n_estimators” :[100,300],<br/> “criterion”: [“gini”]}</span><span id="2b99" class="jf jg hi ko b fi kw kt l ku kv">gsExtC = GridSearchCV(ExtC,param_grid = ex_param_grid, cv=kfold, scoring=”accuracy”, n_jobs= 4, verbose = 1)<br/>gsExtC.fit(X_train,Y_train)<br/>ExtC_best = gsExtC.best_estimator_</span><span id="09cc" class="jf jg hi ko b fi kw kt l ku kv"># Best score<br/>gsExtC.best_score_</span></pre><p id="1abd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">随机森林分类器</strong> —准确率83.38%</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="641c" class="jf jg hi ko b fi ks kt l ku kv"># RFC Parameters tunning <br/>RFC = RandomForestClassifier()</span><span id="a517" class="jf jg hi ko b fi kw kt l ku kv">## Search grid for optimal parameters<br/>rf_param_grid = {“max_depth”: [None],<br/> “max_features”: [1, 3, 10],<br/> “min_samples_split”: [2, 3, 10],<br/> “min_samples_leaf”: [1, 3, 10],<br/> “bootstrap”: [False],<br/> “n_estimators” :[100,300],<br/> “criterion”: [“gini”]}<br/>gsRFC = GridSearchCV(RFC,param_grid = rf_param_grid, cv=kfold, scoring=”accuracy”, n_jobs= 4, verbose = 1)<br/>gsRFC.fit(X_train,Y_train)<br/>RFC_best = gsRFC.best_estimator_</span><span id="4bfb" class="jf jg hi ko b fi kw kt l ku kv"># Best score<br/>gsRFC.best_score_</span></pre><p id="25de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">梯度增强</strong> —准确率83.50%</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="b080" class="jf jg hi ko b fi ks kt l ku kv"># Gradient boosting <br/>GBC = GradientBoostingClassifier()<br/>gb_param_grid = {‘loss’ : [“deviance”],<br/> ‘n_estimators’ : [100,200,300],<br/> ‘learning_rate’: [0.1, 0.05, 0.01],<br/> ‘max_depth’: [4, 8],<br/> ‘min_samples_leaf’: [100,150],<br/> ‘max_features’: [0.3, 0.1] <br/> }<br/>gsGBC = GridSearchCV(GBC,param_grid = gb_param_grid, cv=kfold, scoring=”accuracy”, n_jobs= 4, verbose = 1)<br/>gsGBC.fit(X_train,Y_train)<br/>GBC_best = gsGBC.best_estimator_</span><span id="7f68" class="jf jg hi ko b fi kw kt l ku kv"># Best score<br/>gsGBC.best_score_</span></pre><p id="c0d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> SVC分类器</strong> —准确率83.61%</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="18ea" class="jf jg hi ko b fi ks kt l ku kv">#  SVC classifier<br/>SVMC = SVC(probability=True)<br/>svc_param_grid = {‘kernel’: [‘rbf’], <br/> ‘gamma’: [ 0.001, 0.01, 0.1, 1],<br/> ‘C’: [1, 10, 50, 100,200,300, 1000]}<br/>gsSVMC = GridSearchCV(SVMC,param_grid = svc_param_grid, cv=kfold, scoring=”accuracy”, n_jobs= 4, verbose = 1)<br/>gsSVMC.fit(X_train,Y_train)<br/>SVMC_best = gsSVMC.best_estimator_</span><span id="a3be" class="jf jg hi ko b fi kw kt l ku kv"># Best score<br/>gsSVMC.best_score_</span></pre><p id="f193" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们找出这些算法使用的关键特征</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lj"><img src="../Images/3afb8625a5eb3d57681cca7791676ebd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9EKzS9i15H6LP8dpvjaAVg.png"/></div></div></figure><p id="6202" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看这些模型在测试数据集上的表现</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div class="er es lk"><img src="../Images/b813aa221827b451efb5622edaa9aa55.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/1*qLJImUmDQBfAA03g07UtGw.png"/></div></figure><p id="6b84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用投票分类器组合所有模型的预测能力。</p><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="cfba" class="jf jg hi ko b fi ks kt l ku kv">votingC = VotingClassifier(estimators=[(‘rfc’, RFC_best), (‘extc’, ExtC_best),<br/>(‘svc’, SVMC_best), (‘adac’,ada_best),(‘gbc’,GBC_best)], voting=’soft’, n_jobs=4)<br/>votingC = votingC.fit(X_train, Y_train)</span><span id="92b9" class="jf jg hi ko b fi kw kt l ku kv"># Predict and export the results<br/>test_Survived = pd.Series(votingC.predict(test), name=”Survived”)<br/>results = pd.concat([IDtest,test_Survived],axis=1)<br/>results.to_csv(“Final Submission File.csv”,index=False)</span></pre><p id="6dfa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 7。结论</strong></p><p id="39cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">头衔、性别_女性、费用和阶级似乎是分类的首选共同特征。</p><p id="02b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然标题和年龄特征表示乘客的年龄类别，但是诸如票价、等级、客舱等特征。代表经济地位。基于我们的发现，我们可以得出结论，年龄、性别和代表社会/经济地位的特征是影响乘客生存的主要因素。</p><p id="33b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种方法在排行榜上给出大约0.80的分数，这可以通过特征选择和/或神经网络来进一步改善。</p><p id="5a3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更多敬请期待，喜欢就鼓掌:)！！！</p></div></div>    
</body>
</html>