<html>
<head>
<title>Intrusion detection system using artificial neural networks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于人工神经网络的入侵检测系统</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/intrusion-detection-system-using-artificial-neural-networks-14afc2112be?source=collection_archive---------13-----------------------#2020-05-20">https://medium.com/analytics-vidhya/intrusion-detection-system-using-artificial-neural-networks-14afc2112be?source=collection_archive---------13-----------------------#2020-05-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="0d86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在不断变化的计算机技术世界和快速发展的网络威胁中，攻击者和防御者一直处于猫捉老鼠的循环中。在防御方方面，必须在他们的安全层中添加纵深防御策略，以有效检测高级持续网络威胁，其中入侵检测系统(IDS)是一个关键要素。在这篇文章中，我将试着把人工智能这个日益发展的领域应用到它上面。这个项目开发使用的所有代码都在Github上。见下面我附上的链接。[ <a class="ae jd" href="https://github.com/sepi1996/IDS-using-Neural-Networks" rel="noopener ugc nofollow" target="_blank"> Github存储库</a></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/b65ae53192c17408e7b8c21a919a4dcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/0*X7u9ad3tptQgoiFN"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">纵深防御战略</figcaption></figure></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><h1 id="36b9" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">介绍</h1><h2 id="5721" class="kv jy hi bd jz kw kx ky kd kz la lb kh iq lc ld kl iu le lf kp iy lg lh kt li bi translated">入侵检测系统</h2><p id="a656" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">广义地说，我们可以将入侵检测系统定义为监控网络或系统的恶意活动或违反策略的设备或软件应用程序。任何入侵或破坏活动通常会报告给管理员，或者使用事件管理和安全信息系统集中收集。</p><p id="4e37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我们在下图中看到的，根据功能的不同，有不同类型的id。我们将关注NIDS。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lo"><img src="../Images/240d5170bae6dd088b9c5ea606c872a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XOmaFChbyICBDaC8GwIHsg.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">id的类型</figcaption></figure><p id="045b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据使用的检测方法不同，有两种类型的NIDS。第一个，也是最早使用的，基于签名的NIDS，如<a class="ae jd" href="https://www.snort.org/" rel="noopener ugc nofollow" target="_blank"> Snort </a>和<a class="ae jd" href="https://suricata-ids.org/" rel="noopener ugc nofollow" target="_blank"> Suricata </a>，是目前使用最多的。基于签名的NIDS寻找网络流量中的模式，并将其与预先安装的已知攻击模式(称为规则)进行比较，这使得SNIDS成为检测已知攻击的真正伟大的解决方案，但它们无法检测新的或以前未识别的攻击。这个问题也适用于反病毒软件，因为它们依赖于持续的病毒签名更新来保持有效。第二种NIDS是基于异常的NIDS，它依靠各种统计机器学习模型来自动学习模式，并创建规则来区分正常流量和恶意攻击。总之，基于特征的NIDS寻找模式，而基于异常的NIDS分析行为。</p><p id="6d10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">说到这里，有人可能会问，如果基于异常的入侵检测系统能够识别已知和未知的攻击，那么为什么像Snort和Suricata这样基于特征的NIDS是最常用的呢？作为回答，基于异常的IDS也有一个重要的缺点，因为它的准确性依赖于训练模型时使用的数据，因此受到这些数据的限制。</p><p id="f43f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，关于NIDS，我将使用人工神经网络进行学习，特别是密集神经网络，其主要特征是两个相邻层之间的神经元完全成对连接，但单个层内的神经元不共享连接。</p><h2 id="cf41" class="kv jy hi bd jz kw kx ky kd kz la lb kh iq lc ld kl iu le lf kp iy lg lh kt li bi translated">资料组</h2><p id="e0c4" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">为了使神经网络能够区分正常流量和恶意流量，它需要一组分类输入值。因此，已经有一些数据集，如<a class="ae jd" href="https://www.ll.mit.edu/r-d/datasets/1998-darpa-intrusion-detection-evaluation-dataset" rel="noopener ugc nofollow" target="_blank"> DARPA1998 </a>或<a class="ae jd" href="http://kdd.ics.uci.edu/databases/kddcup99/kddcup99.html" rel="noopener ugc nofollow" target="_blank"> KDD99 </a>，但在这种情况下，我将使用由<a class="ae jd" href="https://www.unb.ca/cic/datasets/ids-2018.html" rel="noopener ugc nofollow" target="_blank">通信安全机构(CSE) &amp;加拿大网络安全研究所(CIC) </a>提供的数据集，主要是因为它是最新的。2018年的数据集包含不同类型的网络攻击，如DoS、web攻击等，但为了简单起见，我将重点关注SSH和FTP协议上的暴力攻击。</p><h2 id="d133" class="kv jy hi bd jz kw kx ky kd kz la lb kh iq lc ld kl iu le lf kp iy lg lh kt li bi translated">工作环境</h2><p id="8748" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">作为工作环境，将使用Anaconda和Jupyter作为开发环境。为了实现神经网络代码，我将使用Python编程语言及其用于神经网络的高级API <a class="ae jd" href="https://keras.io/" rel="noopener ugc nofollow" target="_blank"> Keras </a>。最后，其他库将用于数据可视化和管理，如Pandas、Numpy或Matplotlib。</p><h1 id="a632" class="jx jy hi bd jz ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku bi translated">构建人工神经网络</h1><h2 id="e201" class="kv jy hi bd jz kw kx ky kd kz la lb kh iq lc ld kl iu le lf kp iy lg lh kt li bi translated">数据分析和清理</h2><p id="9deb" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">下载相应的数据集后，我们分析数据以了解它们的特征，并在需要时进行清理。</p><ul class=""><li id="b503" class="ly lz hi ih b ii ij im in iq ma iu mb iy mc jc md me mf mg bi translated">行清理:数据集包含非数字值，这些值不能被类似“Nan”和“Infinity”的神经网络处理，因此这些行将被删除。下表显示了将要处理的最终行数。</li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mh"><img src="../Images/6aaa931e6ec7ebb2563f6e386aea1dcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*88MZAP0fVxo70zA-clkRKw.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">最终数据集内容</figcaption></figure><ul class=""><li id="ba3d" class="ly lz hi ih b ii ij im in iq ma iu mb iy mc jc md me mf mg bi translated">提取不必要的列:<a class="ae jd" href="http://netflowmeter.ca/" rel="noopener ugc nofollow" target="_blank">CIC流量计</a>(CSE&amp;CIC用来分析网络流量的工具)提取了79个不同列中的所有信息。由于其中一些对我们没有用，或者神经网络无法理解，所以它们也会被丢弃。</li><li id="6bf6" class="ly lz hi ih b ii mi im mj iq mk iu ml iy mm jc md me mf mg bi translated">混合数据:csv文件中的数据按照产生的顺序排列，也就是说，首先是一小块良性流量，然后是FTP上的暴力攻击块，然后是良性流量，然后是SSH上的暴力攻击块，最后是另一个良性流量块。这是神经网络的一个学习问题，因为最初，当接收到FTP上的193，354行暴力攻击时，网络将专门检测这种类型的输入。这导致在接收所有良性流量时时间流逝更长，并且在预测FTP上的攻击时总是出错<br/>为了避免这个问题，我将随机打乱所有行:</li><li id="d790" class="ly lz hi ih b ii mi im mj iq mk iu ml iy mm jc md me mf mg bi translated">归一化:根据特性的类型，其值相对于另一个特性的值有所不同，例如，流量IAT最大特性的值将始终大于流量IAT最小值，因此这两个特性处于不同的范围内。为了避免这个问题，将使用最小-最大归一化。</li><li id="2f38" class="ly lz hi ih b ii mi im mj iq mk iu ml iy mm jc md me mf mg bi translated">编码:在这个数据集中，我们有三种类型的流量:“FTP暴力”、“SSH暴力”和“良性”。也就是说，它们是分类数据，因为它们包含标签而不是数值，这是我们的神经网络无法解释的。为了解决这个问题，我们将使用One-Hot编码，通过它将这些分类变量转换成数值。在下图中，我们可以看到这种编码的示例:</li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mn"><img src="../Images/86e742a0a322b11daef19d50fc0edf61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7vKcBN7bv05xfXcNkTFA4A.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">一个热编码</figcaption></figure><blockquote class="mo mp mq"><p id="d533" class="if ig mr ih b ii ij ik il im in io ip ms ir is it mt iv iw ix mu iz ja jb jc hb bi translated">对应于数据预处理的代码在文件import.py中</p></blockquote><h2 id="64ef" class="kv jy hi bd jz kw kx ky kd kz la lb kh iq lc ld kl iu le lf kp iy lg lh kt li bi translated">获得最佳模型</h2><p id="97fa" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">当实现神经网络时，最困难的一点是它必须具有的体系结构，在隐藏层和这些层的每一层的神经元的级别，以及在激活函数、成本函数、过拟合等的级别，因为没有规则或协议指示我们应该使用的超参数来实现最佳结果。由于这是一个众所周知的问题，目前有各种各样的工具来简化这一过程。在这种情况下，我将使用<a class="ae jd" href="https://github.com/autonomio/talos" rel="noopener ugc nofollow" target="_blank"> Talos </a>工具。</p><p id="82c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Talos，我们用神经网络的可能参数定义一个字典，以便稍后我们可以分析获得的结果，并查看哪个神经网络获得了更高的命中率。执行后，在384个不同模型上获得的最佳结果如下:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mv"><img src="../Images/b8433d723cd51b43e19fae3659d0a1af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ix8E_VSDhsxHjrAgTTz9Vg.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">Tales结果</figcaption></figure><p id="671a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由此我们可以得出以下结论:</p><ol class=""><li id="ed6f" class="ly lz hi ih b ii ij im in iq ma iu mb iy mc jc mw me mf mg bi translated">该模型最适用于单个隐藏层。</li><li id="55e4" class="ly lz hi ih b ii mi im mj iq mk iu ml iy mm jc mw me mf mg bi translated">无需申请退学。</li><li id="8884" class="ly lz hi ih b ii mi im mj iq mk iu ml iy mm jc mw me mf mg bi translated">隐层神经元的最佳数目是256个神经元。</li><li id="8a0a" class="ly lz hi ih b ii mi im mj iq mk iu ml iy mm jc mw me mf mg bi translated">两个优化器获得相似的结果。</li><li id="bf35" class="ly lz hi ih b ii mi im mj iq mk iu ml iy mm jc mw me mf mg bi translated">输入层的神经元数量似乎无关紧要。</li></ol><p id="1f38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，从这些结果中，我们总结出最佳的神经网络架构是这样的:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mx"><img src="../Images/4191f31234ae8ac83508c293cb751ca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*RKj-8MHRjUlqEFjzECMxbg.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">最佳神经网络架构</figcaption></figure><blockquote class="mo mp mq"><p id="ef6d" class="if ig mr ih b ii ij ik il im in io ip ms ir is it mt iv iw ix mu iz ja jb jc hb bi translated">对应于Talos实现的代码在文件KerasTuner.py中</p></blockquote></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><h1 id="9e28" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">结果</h1><p id="35ba" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">最后，为了评估该算法，我们将数据集分为三个部分:</p><p id="f233" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">训练集:我们用来训练模型的实际数据集。模型看到这些数据并从中学习。对于这个集合，我们将使用81%的总数据。<br/>验证集:这是用于在调整模型的超参数时对训练数据集中的拟合模型提供公正评估的数据集。对于这个集合，我们将使用总数据的10%。<br/>测试集(Test set ):它是一个数据集，用于对训练数据集中拟合的最终模型提供公正的评估。对于这个集合，我们将使用总数据的9%。</p><p id="880f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在接下来的图片中，我们可以检查结果:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es my"><img src="../Images/7732c65c85d4432ad2e85d91562f56a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a3kx2xIZlFYzStJvkRxFng.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">结果取决于激活功能</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mz"><img src="../Images/7c36065cd500125978eb3b13051d02e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zk6RKPVPB7eACOYsGc-NVA.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">结果取决于优化器</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es na"><img src="../Images/9bac147839f819ed4384e689a76094dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oOswQVb2T_vDNPMIz549Gg.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">使用不同数量的时期的成功率</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es nb"><img src="../Images/fad4979870e7e1bc8fd2c12b967d29d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ombTul9ljj-1Pc-M-3vV2A.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">混淆矩阵结果</figcaption></figure><blockquote class="mo mp mq"><p id="64ec" class="if ig mr ih b ii ij ik il im in io ip ms ir is it mt iv iw ix mu iz ja jb jc hb bi translated">对应于最佳IDS和图形的代码在文件bestIDS.py中</p></blockquote><h1 id="0cdf" class="jx jy hi bd jz ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku bi translated">结论</h1><p id="ccf4" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">正如我们在结果部分看到的，我们开发的IDS的准确性非常好。</p><p id="f0b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个模型最好的激活函数是ReLu函数，最好的优化器是Adam优化器。获得最大成功率所需的时期数大约为10，因为如50个时期图像所示，10个时期后命中率不再提高。</p><p id="4428" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">混淆矩阵表明，该模型在FTP上有100%的准确性。也就是说，每当模型收到一个FTP攻击的样本时，它就预测它确实对应于FTP上的攻击。因此，FTP上的真实阳性率是1，而无论何时收到FTP攻击，它都不会预测到是另一种类型的流量。此外，即使有几次出错，它也能区分良性流量和对SSH的攻击</p><p id="8fa6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，在这个入侵检测系统中，我们尝试将两种类型的攻击分开，看看它们是否也可以被区分。这是以非常高的命中率实现的，但是IDS的目标是检测威胁。也就是说，区分不同类型的攻击并不重要，重要的是能够识别攻击，我们的最佳模型已经以一种几乎完美的方式做到了这一点，因为在超过602，462的流量中，它有两次没有识别出攻击。</p></div></div>    
</body>
</html>