<html>
<head>
<title>Linear Regression using PyTorch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PyTorch进行线性回归</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/linear-regression-using-pytorch-eacd3a87939d?source=collection_archive---------25-----------------------#2020-06-05">https://medium.com/analytics-vidhya/linear-regression-using-pytorch-eacd3a87939d?source=collection_archive---------25-----------------------#2020-06-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="f9f2" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">在这篇博客中，我们将根据某些参数来分析适用于个人的费用的保险数据集。</p></blockquote><h1 id="b9c8" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">简介:</h1><p id="0b97" class="pw-post-body-paragraph ii ij hi il b im kf io ip iq kg is it kh ki iw ix kj kk ja jb kl km je jf jg hb bi translated">保险是一种保护手段。保险有很多种，像健康保险、车辆保险、电话保险。人们购买保险是为了保护自己免受损失。今天，我们期待保险成本预测。我们通过线性回归预测客户未来需要支付的成本。对于这种预测，我们考虑某些参数，如<strong class="il hj">人的年龄</strong>，这是强制了解客户是否合格。<strong class="il hj">性别</strong>，要知道是男是女还是别人。<strong class="il hj">身体质量指数</strong>，这有助于估计你的保单将花费多少。它考虑了顾客的身高和体重等变量，并在一定的统计数据下得到验证。儿童数量，它有助于将父母的保险扩展到儿童。吸烟习惯，它会导致一些健康问题。预测每年的医疗账单的价格。</p><p id="7c90" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated">浏览数据集:</p><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ks kt l"/></div></figure><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><p id="1fbd" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated">在这个数据集中，我们有1271行和7列不同参数的形状，如年龄、性别、bmi、儿童、吸烟者、地区和费用。其中我们将“年龄、性别、bmi、儿童、吸烟者、地区”视为“输入”，将“费用”视为“输出”。我们有3个“分类栏”，即“性别、吸烟者、地区”。</p><p id="8d2a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated">数据的基本统计:</p><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><p id="dd20" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated">电荷分布(输出变量):</p><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><h1 id="9534" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">步骤2:为训练准备数据集</h1><ul class=""><li id="45d6" class="kv kw hi il b im kf iq kg kh kx kj ky kl kz jg la lb lc ld bi translated">我们需要将Pandas数据框中的数据转换为PyTorch张量以进行训练。</li><li id="8b7e" class="kv kw hi il b im le iq lf kh lg kj lh kl li jg la lb lc ld bi translated">为此，第一步是将它转换成numpy数组。</li><li id="0b64" class="kv kw hi il b im le iq lf kh lg kj lh kl li jg la lb lc ld bi translated">如果你已经填写了<code class="du lj lk ll lm b">input_cols</code>、<code class="du lj lk ll lm b">categorical_cols</code>和<code class="du lj lk ll lm b">output_cols</code> t</li><li id="6a72" class="kv kw hi il b im le iq lf kh lg kj lh kl li jg la lb lc ld bi translated">下面的函数将执行到numpy数组的转换。</li></ul><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><p id="ca70" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated">当数据帧被转换成numpy数组时。数组分为float 32和float64。将<code class="du lj lk ll lm b">inputs_array</code>和<code class="du lj lk ll lm b">targets_array</code>的numpy数组转换成PyTorch张量。</p><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><ul class=""><li id="5d63" class="kv kw hi il b im in iq ir kh ln kj lo kl lp jg la lb lc ld bi translated">确保数据类型为<strong class="il hj"> </strong> <code class="du lj lk ll lm b"><strong class="il hj">torch.float32.</strong></code>要转换我们使用的函数为“type (float32)”。</li></ul><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><p id="e552" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated">我们将在<code class="du lj lk ll lm b">0.1</code>和<code class="du lj lk ll lm b">0.2</code>之间取一个数来确定用于创建验证集的数据部分。然后，我们使用<code class="du lj lk ll lm b">random_split</code>来创建训练&amp;验证数据集</p><p id="a576" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated">最后，我们可以为培训和验证创建数据加载器。</p><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><p id="1769" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated">我们可以根据自己的意愿来决定批量大小，我选择了10个作为批量大小</p><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><p id="54e2" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated">现在，我们将train和val数据集的数据以及批量大小加载到train_loader和val_loader。</p><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><p id="1988" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated">我们正在验证批次数据是否正常工作。</p><h1 id="d089" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">步骤3:创建线性回归模型</h1><p id="cd24" class="pw-post-body-paragraph ii ij hi il b im kf io ip iq kg is it kh ki iw ix kj kk ja jb kl km je jf jg hb bi translated">我们的模型本身是一个相当直接的线性回归。</p><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><p id="d6e6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated">让我们使用<code class="du lj lk ll lm b">InsuranceModel</code>类创建一个模型。您可能需要稍后返回并重新运行下一个单元来重新初始化模型，以防损失变成<code class="du lj lk ll lm b">nan</code>或<code class="du lj lk ll lm b">infinity.</code>让我们使用<code class="du lj lk ll lm b">model.parameters</code>来检查模型的权重和偏差。</p><p id="61e8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated">步骤4:训练模型以适应数据:</p><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><p id="0ff7" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated">为了训练我们的模型，我们将使用相同的<code class="du lj lk ll lm b">fit</code>函数解释。这就是定义通用训练循环的好处——我们可以用它来解决任何问题。我们使用<strong class="il hj"> se的</strong> <code class="du lj lk ll lm b"><strong class="il hj">evaluate</strong></code> <strong class="il hj">函数来计算训练前验证集上的损失。</strong></p><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ks kt l"/></div></figure><p id="9d21" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated">我们现在准备训练模型。您可能需要多次运行训练循环，针对不同的时期数和不同的学习率，以获得良好的结果。此外，如果您的损失变得太大(或<code class="du lj lk ll lm b">nan</code>)，您可能需要通过运行单元<code class="du lj lk ll lm b">model = InsuranceModel()</code>来重新初始化模型。尝试一段时间，尽量降低损失。<strong class="il hj">我们将以不同的学习率(如0.1、0.01、0.001等)对模型进行4-5次训练&amp;以获得不同的历元数。检查所有时期模型的最终验证损失。</strong></p><p id="c8ef" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated">步骤5:使用训练好的模型进行预测</p><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><figure class="kn ko kp kq fd kr"><div class="bz dy l di"><div class="ku kt l"/></div></figure><p id="e5d4" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated">这是我在10级时遇到的可能性较小的目标。您可以检查不同级别的目标值，并查看较小的值。</p><p id="e867" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated"><strong class="il hj">最后的话</strong></p><p id="ee09" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated">如果你做到了这一步，感谢你的阅读。特别感谢来自<a class="ae lq" href="https://jovian.ml/" rel="noopener ugc nofollow" target="_blank"> Jovian.ml </a>的<a class="ae lq" rel="noopener" href="/@aakashns"> Aakash </a>提供<a class="ae lq" href="https://jovian.ml/forum/c/pytorch-zero-to-gans" rel="noopener ugc nofollow" target="_blank">深度学习与PyTorch课程</a>。如果您有兴趣了解更多信息，请注册该课程或浏览论坛开始学习。</p><p id="8d7f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated"><strong class="il hj">参考文献:</strong></p><p id="003b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kh iv iw ix kj iz ja jb kl jd je jf jg hb bi translated"><a class="ae lq" href="https://jovian.ml/sridedeepyanandamuri/02-insurance-linear-regression" rel="noopener ugc nofollow" target="_blank">https://jovian . ml/sridedeepyanandamuri/02-insurance-linear-regression</a></p></div></div>    
</body>
</html>