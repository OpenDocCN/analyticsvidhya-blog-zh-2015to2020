<html>
<head>
<title>Automating the collection of the blog for a web portal using python web scraping</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用python web scraping为门户网站自动收集博客</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/automating-the-blogs-collection-for-a-web-portal-using-python-web-scraping-94442dd98301?source=collection_archive---------10-----------------------#2020-01-31">https://medium.com/analytics-vidhya/automating-the-blogs-collection-for-a-web-portal-using-python-web-scraping-94442dd98301?source=collection_archive---------10-----------------------#2020-01-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3def" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将解释如何使用python web scraping自动收集“中型博客”,并将其显示在web门户中，而不必不断更新门户。要实现这一点，应该先了解关键的表达式——web抓取、web请求和中级python编程。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/3c1df5376718ab151ee67a7d9f27fb10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zB9EyTQyJwOC42QVfatjfg.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">网络抓取——谷歌图片</figcaption></figure><h1 id="f43f" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">实现背后的想法</h1><p id="0610" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">我最近开始在medium上写博客，我想如果我有自己的门户网站来描述我发表的项目和文章，那该多好。在开发门户时，我想到的一个问题是— <em class="kw">谁会经常更新门户？(介绍进来的新文章，丢弃旧的)。</em>这么想，我想出了这个可以自动更新门户的程序。</p><blockquote class="kx ky kz"><p id="184f" class="if ig kw ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated"><strong class="ih hj">注意</strong>:我已经用python web框架制作了我的门户。所以对我来说，这是一个自动更新页面的简单方法。</p></blockquote><h1 id="649a" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">程序和实施</h1><p id="e333" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">因为我在medium上写文章，所以我将解释与这个平台相关的过程。对于其他发布平台，可以遵循相同的过程。如果你有一个中等帐户和你写的文章，那么这将是很好的，很好地跟进。</p><p id="e0e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">跳转到您的个人资料，看起来类似于<code class="du ld le lf lg b">https://medium.com/@&lt;your_name&gt;</code>。</p><h2 id="5fa3" class="lh ju hi bd jv li lj lk jz ll lm ln kd iq lo lp kh iu lq lr kl iy ls lt kp lu bi translated">编程部分</h2><pre class="je jf jg jh fd lv lg lw lx aw ly bi"><span id="adbe" class="lh ju hi lg b fi lz ma l mb mc">&gt;&gt;&gt; import requests<br/>&gt;&gt;&gt; from bs4 import BeautifulSoup<br/>&gt;&gt;&gt; import string</span><span id="e5a5" class="lh ju hi lg b fi md ma l mb mc">&gt;&gt;&gt; URL = https://medium.com/@&lt;your_name&gt;<br/>&gt;&gt;&gt; page = requests.get(URL) # request status<br/>&gt;&gt;&gt; soup = BeautifulSoup(page.content, 'html.parser') # source</span></pre><p id="1183" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">页面的整个源代码存储在一个名为<code class="du ld le lf lg b">soup</code>的变量中。我们正在通过<code class="du ld le lf lg b">URL</code>发出一个web请求。如果我们仔细看，每篇文章的标题都是大而粗的。我们对特定的<code class="du ld le lf lg b">&lt;a&gt;...&lt;/a&gt;</code>更感兴趣，它包括关于文章的全部信息，即'<em class="kw">标题'</em>、'<em class="kw">链接'</em>和'<em class="kw">拇指_图像'</em>。</p><pre class="je jf jg jh fd lv lg lw lx aw ly bi"><span id="cd24" class="lh ju hi lg b fi lz ma l mb mc">&gt;&gt;&gt; anchors = soup.find_all('a', href=True)<br/>&gt;&gt;&gt; titles = soup.find_all('h1')<br/>&gt;&gt;&gt; article_section = []<br/>&gt;&gt;&gt; for a in anchors:<br/>...     for h in titles:<br/>...         if str(h.text) in str(a.h1):<br/>...             article_section.append(str(a))<br/>...</span></pre><p id="c088" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">article_section</code>是包含文章信息的列表。它基本上由用<code class="du ld le lf lg b">,</code>分隔的每篇文章的<code class="du ld le lf lg b">html</code>代码组成。下面是通过上面的代码获得的伪响应。</p><pre class="je jf jg jh fd lv lg lw lx aw ly bi"><span id="f662" class="lh ju hi lg b fi lz ma l mb mc">['&lt;a href="..." rel="noopener"&gt;<br/> &lt;div&gt;<br/>  &lt;div class="..."&gt;&lt;/div&gt;<br/>  &lt;section class="..."&gt;<br/>   &lt;div&gt;<br/>    &lt;h1 class="..." id="..."&gt;Title&lt;/h1&gt;<br/>   &lt;/div&gt;<br/>   &lt;figure class="..."&gt;<br/>    &lt;div class="..."&gt;<br/>     &lt;div class="..."&gt;<br/>      &lt;div class="..."&gt;<br/>       &lt;div class="..."&gt;<br/>        &lt;img class="..." height="210" role="presentation" src="..." width="700"/&gt;<br/>       &lt;/div&gt;<br/>       &lt;img class="..." height="210" role="presentation" width="700"/&gt;<br/>       &lt;noscript&gt;<br/>        &lt;img class="..." height="210" role="presentation" src="..." width="700"/&gt;<br/>       &lt;/noscript&gt;<br/>      &lt;/div&gt;<br/>     &lt;/div&gt;<br/>    &lt;/div&gt;<br/>   &lt;/figure&gt;<br/>   &lt;p class="..." id="..."&gt;content of the article&lt;/p&gt;<br/>  &lt;/section&gt;<br/> &lt;/div&gt;<br/>&lt;/a&gt;', '&lt;a&gt;...&lt;/a&gt;', '&lt;a&gt;...&lt;/a&gt;', ..., '&lt;a&gt;...&lt;/a&gt;']</span></pre><p id="aca6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要在门户网站上展示每一篇具有特定设计(CardView)的文章。有三件主要的事情可以满足这个需求。它们是——文章链接、缩略图和文章标题。</p><p id="6f94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要获得一篇文章的缩略图，我们必须获取每篇文章的源，并获取当文章打开时可以查看的图像链接。因此文章链接是必需的。</p><pre class="je jf jg jh fd lv lg lw lx aw ly bi"><span id="e3fe" class="lh ju hi lg b fi lz ma l mb mc">&gt;&gt;&gt; title_link = {}<br/>&gt;&gt;&gt; for each_anch in article_section:<br/>...     arty_soup = BeautifulSoup(each_anch, 'html.parser')<br/>...     arty_link = arty_soup.find('a', href=True)<br/>...     arty_title = arty_soup.find('h1')<br/>...     h_ref = arty_link['href'].split('?')[0]<br/>...     blog_link = 'https://medium.com' + str(h_ref)<br/>...     title_link[str(arty_title.text)] = blog_link<br/>...</span></pre><p id="26e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">title_link</code>是一个字典，其文章标题为<code class="du ld le lf lg b">key</code>，文章链接为<code class="du ld le lf lg b">value</code>。下面可以看到一个虚拟结果。</p><pre class="je jf jg jh fd lv lg lw lx aw ly bi"><span id="6ac6" class="lh ju hi lg b fi lz ma l mb mc">&gt;&gt;&gt; print(title_link)<br/>{'title 1': 'article_link 1', <br/> 'title 2': 'article_link 2',<br/> 'title 3': 'article_link 3',<br/> 'title 4': 'article_link 4',<br/> 'title 5': 'article_link 5'}</span></pre><p id="6d5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们有了所有的文章链接，很容易得到缩略图链接，同样的程序。</p><pre class="je jf jg jh fd lv lg lw lx aw ly bi"><span id="cbaf" class="lh ju hi lg b fi lz ma l mb mc">def get_img_link(blog_link):</span><span id="c463" class="lh ju hi lg b fi md ma l mb mc"> blog = requests.get(blog_link)<br/> soup = BeautifulSoup(blog.content, 'html.parser')<br/> metas = soup.find_all('meta')</span><span id="07fe" class="lh ju hi lg b fi md ma l mb mc"> cons = []<br/> for meta in metas:<br/>  if '.jpeg' in str(meta):<br/>   cons.append(str(meta['content']))<br/>  if '.png' in str(meta):<br/>   cons.append(str(meta['content']))<br/>  if '.jpg' in str(meta):<br/>   cons.append(str(meta['content']))</span><span id="2363" class="lh ju hi lg b fi md ma l mb mc"> con_len = len(cons)<br/> default_thumb_img = '...'<br/> if (con_len &lt;= 2) and (con_len &gt; 0):<br/>  thumb_img = cons[0]<br/> elif (con_len == 0):<br/>  thumb_img = default_thumb_img<br/> else:<br/>  thumb_img = default_thumb_img<br/> <br/> return thumb_img</span></pre><p id="ae6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的函数用于获取每篇文章的缩略图。</p><pre class="je jf jg jh fd lv lg lw lx aw ly bi"><span id="5afd" class="lh ju hi lg b fi lz ma l mb mc">&gt;&gt;&gt; ti_li_img = []<br/>&gt;&gt;&gt; for title, link in title_link.items():<br/>...     ti_li_img.append({title : [link, get_img_link(link)]})<br/>...</span></pre><p id="f034" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">ti_li_img</code>是一个包含所有3个重要因素的列表——标题、链接和图片，它们是制作卡片视图所必需的。这是一个具有字典值的列表，其中每个字典包含标题为<code class="du ld le lf lg b">key</code>和<code class="du ld le lf lg b">[link, image]</code>为<code class="du ld le lf lg b">value</code>。下面可以看到一个虚拟结果。</p><pre class="je jf jg jh fd lv lg lw lx aw ly bi"><span id="5bed" class="lh ju hi lg b fi lz ma l mb mc">&gt;&gt;&gt; print(ti_li_img)<br/>[<br/> {'title 1': ['article_link 1', 'image 1']},<br/> {'title 2': ['article_link 2', 'image 2']},<br/> {'title 3': ['article_link 3', 'image 3']},<br/> {'title 4': ['article_link 4', 'image 4']},<br/> {'title 5': ['article_link 5', 'image 5']},<br/>]</span></pre><p id="5c00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在一切都准备好了。我们准备开发博客页面，在CardView中显示所有文章。我们将利用<code class="du ld le lf lg b">dash_bootstrap_components</code>和<code class="du ld le lf lg b">dash_html_components</code>进行设计。</p><pre class="je jf jg jh fd lv lg lw lx aw ly bi"><span id="9966" class="lh ju hi lg b fi lz ma l mb mc">&gt;&gt;&gt; import dash_bootstrap_components as dbc<br/>&gt;&gt;&gt; import dash_html_components as html<br/>&gt;&gt;&gt; import dash</span><span id="535b" class="lh ju hi lg b fi md ma l mb mc">&gt;&gt;&gt; external_stylesheets = [<br/> dbc.themes.BOOTSTRAP, dbc.themes.GRID,<br/> '<a class="ae me" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css'" rel="noopener ugc nofollow" target="_blank">https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css'</a>,<br/>]<br/>&gt;&gt;&gt; external_scripts = [<br/> '<a class="ae me" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js'" rel="noopener ugc nofollow" target="_blank">https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js'</a>,<br/> '<a class="ae me" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js'" rel="noopener ugc nofollow" target="_blank">https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js'</a>,<br/>]</span><span id="5a63" class="lh ju hi lg b fi md ma l mb mc">&gt;&gt;&gt; app = dash.Dash(__name__,<br/>... external_scripts=external_scripts,<br/>... external_stylesheets=external_stylesheets)<br/>...</span></pre><p id="2532" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的代码用于设计CardView。</p><pre class="je jf jg jh fd lv lg lw lx aw ly bi"><span id="c6c0" class="lh ju hi lg b fi lz ma l mb mc">&gt;&gt;&gt; blogposts = []<br/>&gt;&gt;&gt; for blog in ti_li_img:<br/>...     for head, info in blog.items():<br/>...         blogposts.append(<br/>...             html.Div([<br/>...                 dbc.Card([<br/>...                     dbc.CardImg(src=str(info[1]), top=True, style={'height' : 230}),<br/>...                     dbc.CardBody([<br/>...                         html.P(str(head), className='card-text'),<br/>...                         html.A(dbc.Button("Read more", color='primary'), href=str(info[0]), target='_blank')<br/>...                     ])<br/>...                 ], style={'width' : '18rem'})<br/>...             ])<br/>...         )<br/>...</span></pre><p id="e409" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">blogposts</code>是一个列表，其中包含每篇文章的CardView设计。我已经限制了最多4篇文章显示在页面上，因为它将足够灵活，有2行，其中每行2篇文章。早些时候，我的个人资料中有四篇文章。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mf"><img src="../Images/cf88f19b3771b8b0944b8f657b695a5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uWkBpXLnHiAfR1eU5_CceQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">以前的结果</figcaption></figure><p id="30be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">发布新文章后，结果会按预期更新。Medium以堆栈形式存储文章，新文章放在顶部。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mg"><img src="../Images/de5e3cc89a1d442f30fa915ac3a65ae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yj3c81MuAZ6DNhiJXndwgw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">更新结果</figcaption></figure><p id="397d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每当我发表一篇新文章，门户网站就会自动更新，而无需我手动更新。</p></div></div>    
</body>
</html>