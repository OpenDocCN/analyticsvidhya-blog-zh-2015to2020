<html>
<head>
<title>AWS Step Function Tricks (part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWSé˜¶è·ƒå‡½æ•°æŠ€å·§(ç¬¬2éƒ¨åˆ†)</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/analytics-vidhya/aws-step-function-tricks-part-2-328fa3bc9e50?source=collection_archive---------5-----------------------#2020-09-28">https://medium.com/analytics-vidhya/aws-step-function-tricks-part-2-328fa3bc9e50?source=collection_archive---------5-----------------------#2020-09-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="c969" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">é”™è¯¯å¤„ç†å’Œé€’å½’å·¥ä½œæµ</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/af1cc7d9a4ba438263d6e47ec8ee6f6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OPimsVOoJ1XNsTnuS7MAaQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">AWSæ­¥éª¤åŠŸèƒ½çš„å®é™…åº”ç”¨</figcaption></figure><p id="7499" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">å¦‚æœä½ è¿˜æ²¡æœ‰ï¼Œä»æœ€åˆçš„<a class="ae kj" rel="noopener" href="/analytics-vidhya/aws-step-function-tricks-ffe7eef81a5e"> AWSæ­¥éª¤åŠŸèƒ½æŠ€å·§</a>æ•…äº‹å¼€å§‹ä½ çš„æ—…ç¨‹ï¼Œå¼€å§‹ä¸€äº›ä½ èƒ½åšçš„åŸºæœ¬æŠ€å·§ã€‚</p><p id="12c4" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•:</p><ul class=""><li id="9555" class="kk kl hi jp b jq jr jt ju jw km ka kn ke ko ki kp kq kr ks bi translated">ä»¥æ›´ç®€æ´çš„æ–¹å¼å¤„ç†é”™è¯¯ï¼Œä¿æŒæˆ‘ä»¬çš„å·¥ä½œæµç¨‹æ•´æ´</li><li id="1868" class="kk kl hi jp b jq kt jt ku jw kv ka kw ke kx ki kp kq kr ks bi translated">ä¸ºåŸºäºæ—¥æœŸçš„è¿ç»­ä½œä¸šæ„å»ºé€’å½’å·¥ä½œæµ</li></ul><h1 id="955e" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">é”™è¯¯å¤„ç†</h1><p id="4d7f" class="pw-post-body-paragraph jn jo hi jp b jq lq ij js jt lr im jv jw ls jy jz ka lt kc kd ke lu kg kh ki hb bi translated">æ‰€ä»¥åœ¨å¤§å¤šæ•°AWSæ­¥éª¤å‡½æ•°çŠ¶æ€ä¸­ï¼Œæ‚¨å¯ä»¥æŒ‡å®šä¸€ä¸ª<code class="du lv lw lx ly b">Catch</code>éƒ¨åˆ†æ¥å…è®¸æ‚¨å¤„ç†é”™è¯¯ã€‚é€šå¸¸ï¼Œæ‚¨å¸Œæœ›åœ¨å·¥ä½œæµç¨‹ä¸­å‘ç”Ÿæ„å¤–æƒ…å†µæ—¶é€šçŸ¥è‡ªå·±å’Œå›¢é˜Ÿâ€”â€”æ‰¹å¤„ç†ä½œä¸šå¤±è´¥ã€EMRé›†ç¾¤æ­»äº¡ã€Dockerå®¹å™¨å¯åŠ¨å¤±è´¥ã€Lambdaé”™è¯¯ç­‰ã€‚å› æ­¤ï¼Œæ‚¨çš„å·¥ä½œæµå¯èƒ½çœ‹èµ·æ¥åƒè¿™ä¸ª(çç¢çš„)ä¾‹å­ï¼Œå…¶ä¸­æ¯ä¸€æ­¥<code class="du lv lw lx ly b">Hello, World, Foo, Bar</code>æ‚¨éƒ½åœ¨æ•æ‰é”™è¯¯å¹¶åœ¨å·¥ä½œæµå¤±è´¥ä¹‹å‰é€šçŸ¥è‡ªå·±ã€‚</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lz"><img src="../Images/f45aaf3d6842f2681541bd2ce432fc7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X2YKuaNOkWAwxGBLXDCypQ.png"/></div></div></figure><p id="6419" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæ¯å¢åŠ ä¸€ä¸ªæ­¥éª¤ï¼Œå·¥ä½œæµç¨‹å°±ä¼šå˜å¾—æ›´åŠ ç³Ÿç³•ã€‚</p><p id="67f3" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">ä¸‹é¢æ˜¯ä¸€ä¸ªæ­¥éª¤å‡½æ•°å£°æ˜ï¼Œå®ƒå°†å¸¦æˆ‘ä»¬åˆ°è¾¾é‚£é‡Œ(<strong class="jp hj">ä¸è¦å¤åˆ¶è¿™ä¸ª</strong>):</p><pre class="iy iz ja jb fd ma ly mb mc aw md bi"><span id="3638" class="me kz hi ly b fi mf mg l mh mi">{<br/>  "Comment": "One handler per state",<br/>  "StartAt": "Hello",<br/>  "States": {<br/>    "Hello": {<br/>      "Type": "Task",<br/>      "Resource": "&lt;LAMBDA_FUNCTION_ARN&gt;",<br/>      "Next": "World",<br/>      "Catch": [<br/>        {<br/>          "ErrorEquals": [<br/>            "States.ALL"<br/>          ],<br/>          "ResultPath": "$.error",<br/>          "Next": "Send Failure Message"<br/>        }<br/>      ]<br/>    },<br/>    "World": {<br/>      "Type": "Task",<br/>      "Resource": "&lt;LAMBDA_FUNCTION_ARN&gt;",<br/>      "Next": "Foo",<br/>      "Catch": [<br/>        {<br/>          "ErrorEquals": [<br/>            "States.ALL"<br/>          ],<br/>          "ResultPath": "$.error",<br/>          "Next": "Send Failure Message"<br/>        }<br/>      ]<br/>    },<br/>    "Foo": {<br/>      "Type": "Task",<br/>      "Resource": "&lt;LAMBDA_FUNCTION_ARN&gt;",<br/>      "Next": "Bar",<br/>      "Catch": [<br/>        {<br/>          "ErrorEquals": [<br/>            "States.ALL"<br/>          ],<br/>          "ResultPath": "$.error",<br/>          "Next": "Send Failure Message"<br/>        }<br/>      ]<br/>    },<br/>    "Bar": {<br/>      "Type": "Task",<br/>      "Resource": "&lt;LAMBDA_FUNCTION_ARN&gt;",<br/>      "Next": "Job Succeeded",<br/>      "Catch": [<br/>        {<br/>          "ErrorEquals": [<br/>            "States.ALL"<br/>          ],<br/>          "ResultPath": "$.error",<br/>          "Next": "Send Failure Message"<br/>        }<br/>      ]<br/>    },<br/>    "Job Succeeded": {<br/>      "Type": "Succeed"<br/>    },<br/>    "Send Failure Message": {<br/>      "Type": "Pass",<br/>      "Next": "Fail Workflow"<br/>    },<br/>    "Fail Workflow": {<br/>      "Type": "Fail"<br/>    }<br/>  }<br/>}</span></pre><p id="6583" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">è¿™å¾ˆæ£’ï¼Œé™¤äº†æˆ‘ä»¬æ·»åŠ çš„æ¯ä¸€ä¸ªé¢å¤–æ­¥éª¤ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»åœ¨æ¯ä¸ªæ­¥éª¤ä¸­æ·»åŠ catchç»„ä»¶ã€‚è¿™ç»™æˆ‘ä»¬çœ‹èµ·æ¥å·²ç»å¾ˆç³Ÿç³•çš„å·¥ä½œæµç¨‹å¢åŠ äº†å¾ˆå¤šéº»çƒ¦ã€‚</p><p id="8a1c" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">å¦‚æœæˆ‘ä»¬é‡ç»„å®ƒï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸€ä¸ªåªéœ€è¦æ•æ‰ä¸€æ¬¡çš„å·¥ä½œæµã€‚æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå¤–éƒ¨å¼‚å¸¸å¤„ç†ç¨‹åºï¼Œä½ é€šå¸¸ä¼šåœ¨ä½ çš„ä»£ç ä¸­åˆ›å»ºå®ƒï¼Œé™¤äº†æˆ‘ä»¬æŠŠåŒæ ·çš„åŸåˆ™åº”ç”¨äºå·¥ä½œæµã€‚å¾ˆæ˜æ˜¾ï¼Œä¸€æ—¦ä½ çš„å·¥ä½œæµç¨‹ä¸­æœ‰äº†ä¸¤ä¸ªä»¥ä¸Šçš„çŠ¶æ€ï¼Œè¿™ç§æ•ˆç‡å°±ä¼šæé«˜ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code class="du lv lw lx ly b">Parallel</code>å·çš„åŠ›é‡æ¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ã€‚æˆ‘ä»¬æƒ³è¦æ›´åƒè¿™æ ·çš„ä¸œè¥¿:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mj"><img src="../Images/748ec8139ffba9457a34f14667329244.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AYwJhudqYjj6q_ILZhrAhQ.png"/></div></div></figure><p id="c941" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">æ›´å¥½çš„é”™è¯¯å¤„ç†æ­¥éª¤å‡½æ•°å£°æ˜ã€‚æ‚¨å¯ä»¥çœ‹åˆ°é‡Œé¢çš„çŠ¶æ€æ›´åŠ ç®€æ´ï¼Œä¹Ÿæ›´å®¹æ˜“ç®¡ç†ï¼Œå›¾è¡¨æ˜¯ã€‚çœ¼ç›ä¹Ÿå¥½çœ‹å¤šäº†ã€‚(<strong class="jp hj">ä¸€å®šè¦æŠ„è¿™ä¸ª</strong>)</p><pre class="iy iz ja jb fd ma ly mb mc aw md bi"><span id="bd1a" class="me kz hi ly b fi mf mg l mh mi">{<br/>  "Comment": "Better error handling",<br/>  "StartAt": "ErrorHandler",<br/>  "States": {<br/>    "ErrorHandler": {<br/>      "Type": "Parallel",<br/>      "Branches": [<br/>        {<br/>          "StartAt": "Hello",<br/>          "States": {<br/>            "Hello": {<br/>              "Type": "Pass",<br/>              "Result": "Hello",<br/>              "Next": "World"<br/>            },<br/>            "World": {<br/>              "Type": "Pass",<br/>              "Result": "World",<br/>              "Next": "Foo"<br/>            },<br/>            "Foo": {<br/>              "Type": "Pass",<br/>              "Result": "World",<br/>              "Next": "Bar"<br/>            },<br/>            "Bar": {<br/>              "Type": "Pass",<br/>              "Result": "World",<br/>              "End": true<br/>            }<br/>          }<br/>        }<br/>      ],<br/>      "Catch": [<br/>        {<br/>          "ErrorEquals": [<br/>            "States.ALL"<br/>          ],<br/>          "ResultPath": "$.error",<br/>          "Next": "Send Failure Message"<br/>        }<br/>      ],<br/>      "Next": "Job Succeeded"<br/>    },<br/>    "Job Succeeded": {<br/>      "Type": "Succeed"<br/>    },<br/>    "Send Failure Message": {<br/>      "Type": "Pass",<br/>      "Next": "Fail Workflow"<br/>    },<br/>    "Fail Workflow": {<br/>      "Type": "Fail"<br/>    }<br/>  }<br/>}</span></pre><p id="fc55" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">æ— å¤„ä¸åœ¨çš„<code class="du lv lw lx ly b">Catch</code>è¯­å¥ğŸ¤—ï¼›æˆ‘ä»¬å¯ä»¥æ·»åŠ æ–°çš„æ­¥éª¤ï¼Œè€Œä¸å¿…è®°ä½å°†æ¯ä¸ªæ­¥éª¤ç»‘å®šåˆ°é”™è¯¯å¤„ç†ã€‚</p></div><div class="ab cl mk ml gp mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hb hc hd he hf"><h1 id="725d" class="ky kz hi bd la lb mr ld le lf ms lh li io mt ip lk ir mu is lm iu mv iv lo lp bi translated">é€’å½’å·¥ä½œæµ</h1><p id="cac7" class="pw-post-body-paragraph jn jo hi jp b jq lq ij js jt lr im jv jw ls jy jz ka lt kc kd ke lu kg kh ki hb bi translated">æ‰€ä»¥AWSè¯´â€œä¸è¦è¿™æ ·â€ã€‚å°±ä»–ä»¬è€Œè¨€ï¼Œä½ â€œåº”è¯¥â€åˆ›å»ºçš„å›¾æ˜¯ä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ã€‚è¿™å¾ˆå¥½ï¼Œé™¤éä½ æƒ³é‡å¤åšæŸä»¶äº‹ï¼Œç›´åˆ°å®Œæˆä»»åŠ¡ã€‚ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ä»æ—¥æœŸAåˆ°æ—¥æœŸbå›å¡«ä¸€äº›æ•°æ®ã€‚</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mw"><img src="../Images/4217be624b1e0209206382ffaa8f53c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2o_rhSLwxOf9tNbmPVdkDw.png"/></div></div></figure><p id="ed7d" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">æ–¹ä¾¿çš„æ˜¯ï¼Œæˆ‘ä»¬å·²ç»ä»æœ¬æ–‡å‰é¢çš„é”™è¯¯å¤„ç†ç¤ºä¾‹ä¸­æå–å‡ºæ¥ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šæ„å»ºï¼Œå› æ­¤ä»»ä½•å¤±è´¥éƒ½ä¼šå‘æˆ‘ä»¬æ˜¾ç¤ºå®ƒä»¬çš„é”™è¯¯ğŸ˜‰ã€‚æˆ‘ä»¬è¿˜å°†åˆ©ç”¨AWS step functions(2020å¹´8æœˆå‘å¸ƒ)çš„ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œå³<code class="du lv lw lx ly b">TimestampLessThanEqualsPath</code>æ¯”è¾ƒå™¨ï¼Œæ¥æ¯”è¾ƒè¾“å…¥ä¸­çš„ä¸¤ä¸ªä¸åŒå˜é‡ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸€ä¸ª<code class="du lv lw lx ly b">startDate</code>å’Œ<code class="du lv lw lx ly b">endDate</code>æ¥é™å®šæˆ‘ä»¬å¸Œæœ›é€’å½’å·¥ä½œæµæ“ä½œçš„èŒƒå›´ã€‚</p><pre class="iy iz ja jb fd ma ly mb mc aw md bi"><span id="7737" class="me kz hi ly b fi mf mg l mh mi">{<br/>  "Comment": "Better error handling",<br/>  "StartAt": "ErrorHandler",<br/>  "States": {<br/>    "ErrorHandler": {<br/>      "Type": "Parallel",<br/>      "Branches": [<br/>        {<br/>          "StartAt": "Is Date &lt;= X",<br/>          "States": {<br/>            "Is Date &lt;= X": {<br/>              "Type": "Choice",<br/>              "Choices": [<br/>                {<br/>                  "Variable": "$.startDate",<br/>                  "TimestampLessThanEqualsPath": "$.endDate",<br/>                  "Next": "Run the job workflow"<br/>                }<br/>              ],<br/>              "Default": "Backfill complete"<br/>            },<br/>            "Backfill complete": {<br/>              "Type": "Pass",<br/>              "Result": "World",<br/>              "End": true<br/>            },<br/>            "Run the job workflow": {<br/>              "Type": "Task",<br/>              "Resource": "arn:aws:states:::states:startExecution.sync",<br/>              "Parameters": {<br/>                "StateMachineArn": "&lt;STATE_MACHINE_ARN&gt;",<br/>                "Input": {<br/>                  "date": "$.startDate",<br/>                  "AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$": "$$.Execution.Id"<br/>                }<br/>              },<br/>              "Next": "Add 1 day"<br/>            },<br/>            "Add 1 day": {<br/>              "Type": "Task",<br/>              "Resource": "&lt;LAMBDA_FUNCTION_ARN&gt;",<br/>              "Parameters": {<br/>                "date.$": "$.startDate"<br/>              },<br/>              "ResultPath": "$.startDate",<br/>              "Next": "Is Date &lt;= X"<br/>            }<br/>          }<br/>        }<br/>      ],<br/>      "Catch": [<br/>        {<br/>          "ErrorEquals": [<br/>            "States.ALL"<br/>          ],<br/>          "ResultPath": "$.error",<br/>          "Next": "Send Failure Message"<br/>        }<br/>      ],<br/>      "Next": "Job Succeeded"<br/>    },<br/>    "Job Succeeded": {<br/>      "Type": "Succeed"<br/>    },<br/>    "Send Failure Message": {<br/>      "Type": "Pass",<br/>      "Next": "Fail Workflow"<br/>    },<br/>    "Fail Workflow": {<br/>      "Type": "Fail"<br/>    }<br/>  }<br/>}</span></pre><p id="b221" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">åªè¦ç”¨ä¸€ä¸ª<code class="du lv lw lx ly b">{"startDate": "2020-09-01T00:00:00Z", "endDate": "2020-09-09T00:00:00Z"}</code>å¯åŠ¨è¿™ä¸ªå·¥ä½œæµï¼Œä½ å°†å¾—åˆ°9ä¸ªå·¥ä½œæµçš„è¿­ä»£ï¼Œæ¯ä¸ªè¿­ä»£çš„æ‰§è¡Œæ—¶é—´æœ‰1å¤©çš„å·®å¼‚ã€‚</p><p id="63bb" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">è¿™ä¸ªå·¥ä½œæµç¡®å®ä¾èµ–äºä¸€ä¸ªlambdaä»æ‚¨çš„æ—¥æœŸè¾“å…¥ä¸­å‡å»1å¤©æ¥è¦†ç›–<code class="du lv lw lx ly b">$.startDate</code>ï¼Œä½†æ˜¯æˆ‘å°†æŠŠå®ƒç•™ç»™æ‚¨æ¥å®ç°ã€‚æˆ‘å¾—ç»™ä½ ç•™äº›æœ‰è¶£çš„äº‹åšğŸ˜œ</p></div><div class="ab cl mk ml gp mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hb hc hd he hf"><h1 id="86e4" class="ky kz hi bd la lb mr ld le lf ms lh li io mt ip lk ir mu is lm iu mv iv lo lp bi translated">ç»“è®º</h1><p id="4112" class="pw-post-body-paragraph jn jo hi jp b jq lq ij js jt lr im jv jw ls jy jz ka lt kc kd ke lu kg kh ki hb bi translated">æœ‰å¯èƒ½æœ‰ä½“é¢çš„é”™è¯¯å¤„ç†ï¼Œä¸éœ€è¦å¤ªå¤šçš„åŠªåŠ›æ¥å®ç°ï¼Œå¹¶æ•æ‰å·¥ä½œæµä¸­çš„æ‰€æœ‰é”™è¯¯ã€‚ç°åœ¨ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿå®ç°é€’å½’å·¥ä½œæµï¼Œä½¿ç”¨ä¸€ä¸ªæ–°çš„å¯ç”¨é€‰æ‹©è¿ç®—ç¬¦æ¥æ‰§è¡ŒåŸºäºæ—¶é—´çš„æ“ä½œã€‚</p><p id="cfed" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">æ„Ÿè°¢é˜…è¯»ã€‚</p></div></div>    
</body>
</html>