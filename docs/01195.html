<html>
<head>
<title>Concordance Index as an Evaluation Metric</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">和谐指数作为评价指标</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/concordance-index-72298c11eac7?source=collection_archive---------0-----------------------#2019-10-08">https://medium.com/analytics-vidhya/concordance-index-72298c11eac7?source=collection_archive---------0-----------------------#2019-10-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b3c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">所有与本帖相关的代码都可以在</em> <a class="ae je" href="https://github.com/alonsosilvaallende/Concordance_Index" rel="noopener ugc nofollow" target="_blank"> <em class="jd">这里</em> </a> <em class="jd">找到。</em></p><p id="4791" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">一致性指数</em>或<em class="jd"> c-index </em>是评估算法所做预测的指标。它被定义为一致对的比例除以可能的评估对的总数。让我们通过一些例子来看看这个定义在实践中意味着什么。</p><p id="58b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们首先安装库生命线和通常的导入:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><p id="01cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设我们是一家电信运营商，有5个客户(Alice、Bob、Carol、Dave和Eve ),我们试图预测谁将首先取消订阅我们的服务(也称为流失)。假设爱丽丝在1年后被搅拌，鲍勃在2年后，卡罗尔在3年后，戴夫在4年后，夏娃在5年后。我们的算法做出了如下预测:1年后Alice会流失，2年后Bob会流失，3年后Carol会流失，4年后Dave会流失，5年后Eve会流失。</p><p id="dea8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个完美的预测。在这种情况下，和谐指数等于其最大值1。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jm"><img src="../Images/b05c396113339b2d28a1f2c4b499bdee.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*Dp3Cr29M1uBTqoDXstC9DQ.png"/></div></div></figure><p id="c4b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，和谐指数感兴趣的是预测的<strong class="ih hj">顺序，而不是预测本身。现在假设算法预测:爱丽丝将在2年后流失，鲍勃在3年后，卡罗尔在5年后，戴夫在8年后，夏娃在14年后。在这种情况下，和谐指数仍然等于其最大值1，因为预测的顺序是正确的(尽管事实上没有一个预测是孤立正确的！).</strong></p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jt"><img src="../Images/df89f3b22b2c26aad4c41fb09b34914c.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*LPehmdHtVxe7D0jlX8apjQ.png"/></div></figure><p id="1fd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这与其他评估方法如<a class="ae je" href="https://en.wikipedia.org/wiki/Mean_squared_error" rel="noopener ugc nofollow" target="_blank">均方误差</a>或<a class="ae je" href="https://en.wikipedia.org/wiki/Mean_absolute_error" rel="noopener ugc nofollow" target="_blank">平均绝对误差</a>有很大不同。实际上，对于客户流失次数的任何严格递增函数，和谐指数仍然等于1。以下是对数函数的一个示例:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ju"><img src="../Images/321730d188145cf505fb83f114df3d7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*dTZaXewrOwa5SM4bA1LwPQ.png"/></div></figure><p id="0929" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们考虑这样一种情况，算法得到的预测顺序完全错误。假设算法预测1年后Eve会先流失，2年后Dave会先流失，3年后Carol会先流失，4年后Bob会先流失，5年后Alice会先流失，这样顺序就完全颠倒了(虽然注意，3年后Carol确实离开了！).在这种情况下，和谐指数将等于其最小值0。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ju"><img src="../Images/2e59467c38a2731bdda730d9cde3d553.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*56wJjMS9lNmZMRSKvqZKaQ.png"/></div></figure><p id="cf96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实际上，对于流失时间的每个严格递减函数，一致性指数将为零。以下是乘法反函数的一个示例:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jv"><img src="../Images/b14e0cb27c66f81c0c5d0da5e18f0813.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*U3MN3SILuLJL55Ic49XgzA.png"/></div></figure><p id="9dec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在有趣的部分来了。当预测的顺序既不完全正确也不完全错误时，和谐指数会做什么？你给以下预测打几分？</p><p id="7f00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">预测1</em>:3年后爱丽丝会离开，2年后鲍勃会离开，1年后卡罗尔会离开，5年后戴夫会离开，4年后夏娃会离开。</p><p id="b76c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，索引列出了所有可能的配对，在我们的例子中有10个潜在的配对:(爱丽丝，鲍勃)，(爱丽丝，卡罗尔)，(爱丽丝，戴夫)，(爱丽丝，夏娃)，(鲍勃，卡罗尔)，(鲍勃，戴夫)，(鲍勃，夏娃)，(卡罗尔，戴夫)，(卡罗尔，夏娃)，(戴夫，夏娃)，然后它计算这些配对预测的顺序有多少是正确的。例如，对于<em class="jd">预测1 </em>:</p><ul class=""><li id="cfef" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated">爱丽丝被预测在鲍勃之后搅动，而鲍勃在爱丽丝之后搅动。</li><li id="510d" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">爱丽丝被预测在卡罗尔之后搅动，而卡罗尔在爱丽丝之后搅动。</li><li id="aa12" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">鲍勃被预测在卡罗尔之后搅动，而卡罗尔在鲍勃之后搅动。</li><li id="cb9d" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">戴夫被预言在夏娃之后搅动，而夏娃在戴夫之后搅动。</li></ul><p id="7281" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有其他对的预测都是正确的。10个可能的配对中有6个是一致的配对，所以一致指数等于6/10或0.6。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kk"><img src="../Images/34e57604c1543303590477ac96ea0704.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*SHblKwL1r8aquppe6GxFUw.png"/></div></figure><p id="e6b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">万一出现平局呢？您的预测中的关系被计为半一致对:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kl"><img src="../Images/7a0167240f09be0fa2788119b2e11384.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*TPkZ9kgviUB_OwMjNAa8WA.png"/></div></figure><p id="ebab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">索引的另一个有趣的特征是它支持正确的审查，也就是说，当研究结束时，感兴趣的事件(例如，在医学中“病人的死亡”或在我们的例子中“客户的流失”)只发生在观察的子集。注意，指定一个感兴趣的事件还没有发生给了我们一个信息:感兴趣的事件，如果发生了，它将在大于或等于指定时间的时间内发生。让我们通过一个例子来看看这一点。</p><p id="ba29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，我们从来没有指定我们的观察是否正确，因为索引默认选项是所有事件都被观察到。让我们改变这一点。</p><p id="af37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设爱丽丝在1年后被搅动，鲍勃在2年后，<strong class="ih hj"> <em class="jd">卡罗尔在3年后</em> </strong>没有被搅动，戴夫在4年后被搅动，夏娃在5年后被搅动。</p><p id="2fdf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的预测如下:</p><p id="7c1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">预测二</em>:1年后爱丽丝会流失，2年后鲍勃会流失，3年后卡罗尔会流失，5年后戴夫会流失，4年后夏娃会流失。</p><p id="f81a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，Carol在3年后没有搅动的事实给了我们这样的信息，即她的搅动时间，如果发生，将在大于或等于3年的时间内发生。因此，我们无法给两人一组(Carol，Dave)和(Carol，Eve)打分，因为我们根本不知道谁先搅拌。因此我们只有8个潜在的对。戴夫被预言在夏娃之后搅动，而夏娃在戴夫之后搅动。所有其他对的预测都是正确的。8个可能对中有7个一致对，所以一致指数等于7/8或0.875。</p><p id="fedb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的代码中，我们需要指定事件是否被观察到(True)或者事件是否没有被观察到(False):</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es km"><img src="../Images/cda3121b49baf54ff75b022260611d4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*tLtU-qHU1p2pLmujBGySFA.png"/></div></figure><p id="af6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们做随机预测，看看我们得到哪个一致指数。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es kn"><img src="../Images/a35dae225dc4bcc9285d9ee7f4d4b4ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GE7AXikZLJWe9diUWH_qYw.png"/></div></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ko"><img src="../Images/a234d29ee65b8dd6e0e13b9d9e325c44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*oMn_3G87SQgVL389Zb5xzg.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx translated">随机预测的一致指数。</figcaption></figure><p id="2b5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随机预测给出的平均和谐指数约为0.5。所以基本上一个没有学到任何东西的模型给出的平均一致指数是0.5。</p><h1 id="57c6" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">图书馆之间的索引差异:生命线，scikit-survival和PySurvival</h1><p id="7be4" class="pw-post-body-paragraph if ig hi ih b ii lr ik il im ls io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">为了进行这种比较，我们安装了PySurvival和scikit-survival:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><p id="3065" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，lifelines给出了实际事件时间和预测的<em class="jd">分数</em>之间的一致性，而scikit-survival给出了实际和预测的<em class="jd">风险</em>之间的一致性，因此在相同的列表中，它们是完全相反的。</p><p id="65e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和谐指数(生命线)= 1-和谐指数(sci kit-存活率)</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lw"><img src="../Images/8eef3a505423525899c459a5bff075ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/1*OG1nmm5GP_xJAunO2CHPcA.png"/></div></figure><p id="431a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Scikit-survival还提供了一致对的数量、不一致对的数量、具有相同估计风险的对的数量以及共享相同时间的可比对的数量。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es lx"><img src="../Images/d859aa4e303a0c657d81e1af7b630a5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lKrUlnPtz8_MfN43C1DyvQ.png"/></div></div></figure><p id="c8f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看一个更有趣的例子:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es ly"><img src="../Images/96bc6e113449b9dd4483358b99bf6945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ljDg-kHumNvyEZvmZduSLA.png"/></div></div></figure><p id="ea8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">PySurvival concordance index需要一个模型作为输入，所以很难看到它的concordance index做什么。让我们用一个随机生存森林来试试:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lz"><img src="../Images/66fcda51a51890fbb47fa2b130d17d26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*zIWasCYBipr-rMUkyuq7hQ.png"/></div></figure><p id="fb90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们注意到三个一致性指数给了我们相同的结果(注意我们在生命线的预测风险前面加了一个减号)。让我们看看PySurvival的和谐指数提供的额外结果:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es ma"><img src="../Images/d2ade633c92dd4e9c797dff41f30c717.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HAh2fbA8_vqSShvlAnh6OQ.png"/></div></div></figure><p id="278f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们注意到PySurvival对pairs(Alice，Bob)和(Bob，Alice)计数两次，而scikit-survival只计数一次。这解释了一致对数量的差异(558+43+179=780和780*2=1560)。类似地，PySurvival中一致对的数量将一致对和捆绑风险对视为半一致对(2*558+179=1295)。</p><h1 id="e0a8" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">结论</h1><p id="26f2" class="pw-post-body-paragraph if ig hi ih b ii lr ik il im ls io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">和谐指数是评估算法所做预测的有用度量。它可以考虑右删截的情况，即在研究结束时，感兴趣的事件(例如，在医学中“患者死亡”或在我们的例子中“客户流失”)只发生在观察的子集。我们已经看到三个库(lifelines、scikit-survival和PySurvival)实现了索引索引，但是有一些细微的差别。</p><h1 id="902a" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">来源</h1><ul class=""><li id="2761" class="jw jx hi ih b ii lr im ls iq mb iu mc iy md jc kb kc kd ke bi translated">Harrell F.E Jr .、Lee K.L .、Mark D.B .、<a class="ae je" href="https://doi.org/10.1002/(SICI)1097-0258(19960229)15:4%3C361::AID-SIM168%3E3.0.CO;2-4" rel="noopener ugc nofollow" target="_blank">“多变量预测模型:开发模型、评估假设和充分性以及测量和减少误差的问题”</a>，《医学统计》，15(4)，361–87，1996年。</li><li id="1352" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated"><a class="ae je" href="https://lifelines.readthedocs.io/en/latest/lifelines.utils.html#lifelines.utils.concordance_index" rel="noopener ugc nofollow" target="_blank">生命线的一致性指数</a></li><li id="192b" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated"><a class="ae je" href="https://scikit-survival.readthedocs.io/en/latest/generated/sksurv.metrics.concordance_index_censored.html#sksurv.metrics.concordance_index_censored" rel="noopener ugc nofollow" target="_blank">sci kit-生存和谐指数</a></li><li id="134c" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated"><a class="ae je" href="https://square.github.io/pysurvival/metrics/c_index.html" rel="noopener ugc nofollow" target="_blank"> PySurvival的和谐指数</a></li></ul></div></div>    
</body>
</html>