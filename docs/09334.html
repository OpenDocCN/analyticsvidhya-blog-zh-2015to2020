<html>
<head>
<title>PyTorch: Directly use pre-trained AlexNet for Image Classification and Visualization of the activation maps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PyTorch:直接使用预先训练的AlexNet进行图像分类和激活图的可视化</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/pytorch-directly-use-pre-trained-alexnet-for-image-classification-and-visualization-of-the-dea0de3eade9?source=collection_archive---------3-----------------------#2020-09-02">https://medium.com/analytics-vidhya/pytorch-directly-use-pre-trained-alexnet-for-image-classification-and-visualization-of-the-dea0de3eade9?source=collection_archive---------3-----------------------#2020-09-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/f84d598954a1904e514ce297cbd344a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*Va9CdBygXebZFJj2WHWQgQ.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">老虎信用图片:<a class="ae iq" href="https://phys.org/news/2019-11-indian-authorities-exaggerated-tiger.html" rel="noopener ugc nofollow" target="_blank">https://phys . org/news/2019-11-Indian-authorities-夸张-tiger.html </a> (CC0公共领域)</figcaption></figure><p id="2979" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">大家好。今天我要介绍最经典的卷积神经网络(CNN)，AlexNet [1]，这是第一个数据驱动的基于CNN(基于深度学习)的方法，赢得了2012年ImageNet对象分类。在这篇博客中，你将了解到:</p><ol class=""><li id="584b" class="jp jq hi it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx bi translated">直接用一个预先训练好的AlexNet进行类别预测(原来的AlexNet是能够分类1000个类别如老虎，自行车，鲨鱼等。)</li><li id="f711" class="jp jq hi it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx bi translated">可视化在AlexNet中选择哪些特征进行分类(我们将看到每一层的特征选择，并知道哪些特征被传递到下一层)</li></ol><p id="9e34" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">本博客的源代码:<a class="ae iq" href="https://gitlab.com/ronctli1012/blog1-pretrained-alexnet-and-visualization" rel="noopener ugc nofollow" target="_blank">https://git lab . com/ronctli 1012/blog 1-pre trained-Alex net-and-visualization</a></p><h1 id="3925" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">准备</h1><ul class=""><li id="eb7e" class="jp jq hi it b iu lb iy lc jc ld jg le jk lf jo lg jv jw jx bi translated">你应该对CNN有基本的了解(例如，你以前听说过AlexNet，知道一点它的结构)</li><li id="7e0f" class="jp jq hi it b iu jy iy jz jc ka jg kb jk kc jo lg jv jw jx bi translated">Anaconda (anaconda.com): 1。)我们通常使用Anaconda来创建开发环境；2.)所有需要的包都已经写在“requirement.txt”里和/或你可以使用提供的“torch_gpu.yml”直接为这个博客创建环境。详见我们的源代码</li><li id="1ab9" class="jp jq hi it b iu jy iy jz jc ka jg kb jk kc jo lg jv jw jx bi translated">Pytorch (pytorch.org): 1。)Pytorch是常用框架之一(p.s .我们还有TensorFlow，Keras等。)用于实现CNN2.)如果你没有GPU，你也可以通过安装Pytorch CPU版本来关注这个博客</li></ul><h1 id="4850" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">预处理输入</h1><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es if"><img src="../Images/ac8490356e78e5800258cc19bc768e39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*Sow0aAnie4jVV8tGybhkbQ.png"/></div></figure><p id="9508" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">数据转换:</strong>用于在输入到预先训练好的AlexNet之前对输入进行预处理。</p><ol class=""><li id="bf62" class="jp jq hi it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx bi translated"><strong class="it hj">变换。Resize((224，224)) : </strong>输入的大小调整为224x224</li><li id="6f9b" class="jp jq hi it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx bi translated"><strong class="it hj">变身。ToTensor() : </strong>将输入转换为张量格式，以便使用torch</li><li id="c238" class="jp jq hi it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx bi translated"><strong class="it hj">变换。标准化([平均值]，[标准偏差]) : </strong>使用[平均值]和[标准偏差]标准化输入</li></ol><h1 id="e681" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">读取和转换输入</h1><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es if"><img src="../Images/c6da14eb4808f4d770642f2de40b641c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*MRVHLN__t1BN-K7UcqdfDQ.png"/></div></figure><p id="8bb6" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj"> opt.test_img </strong>是输入参数，表示测试图像的文件名。请注意，测试图像应该存储在“alexnet_images”文件夹中。</p><h1 id="73a7" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">定义网络</h1><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es if"><img src="../Images/2c2023087cac9e15a3ea1ee85d076c9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*3LBrAm68Is65xq7K6yeZuw.png"/></div></div></figure><p id="19d9" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">在预处理输入之后，我们必须定义我们的模型。你可以看到我们只需要一行代码就可以得到预先训练好的AlexNet。由于我们只是在这个博客中进行测试，我们可以直接将模型移动到评估模式(即<strong class="it hj"> alexnet.eval() </strong>)。然后，我们可以将预处理后的输入输入到模型中，并获得预测结果。</p><p id="83af" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">visualize _ activation _ maps(batch _ img，alexnet) </strong>是将alexnet内部各层的特征选择可视化的函数。由于AlexNet内部有5层，因此该功能将生成5幅图像，这些图像将存储在您当前的工作目录中。</p><h1 id="3864" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">了解预测结果</h1><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es if"><img src="../Images/8f5fef117e5aa2bd145a01f09220b997.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*kT_d6iyYxHqVcDbXAybBkA.png"/></div></figure><p id="8879" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">正如我在最开始提到的，最初的AlexNet可以对1000类对象进行分类。因此，我们首先将类别与其对应的标签进行匹配，并尝试显示前5个类别标签。</p><p id="793b" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">注意，AlexNet的输出应该是一个长度为1000的向量。首先，我们将根据输出向量中每个元素的值对输出进行排序。然后，我们使用softmax函数将这个1000长度的向量归一化为概率向量。该概率向量中的每个元素表示类别概率(即输入属于该类别的可能性)。</p><p id="4f29" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">最后，我们显示概率最高的前5个类。</p><h1 id="debd" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">直接使用</h1><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es if"><img src="../Images/d817351eb4fa60c92f50c72768bd2767.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*PA1FMC-18CrhSBoZkG11Qg.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">示例:使用“tiger.jpg”输入图像运行“alexnet_main.py”脚本的输出</figcaption></figure><p id="685c" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">又来了！所有材料均可在<a class="ae iq" href="https://gitlab.com/ronctli1012/blog1-pretrained-alexnet-and-visualization" rel="noopener ugc nofollow" target="_blank">https://git lab . com/ronctli 1012/blog 1-pre trained-Alex net-and-visualization</a>找到</p><p id="8fc3" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">对于窗口用户，您可以通过在命令窗口中键入以下一行代码(即cmd)来运行脚本:</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es lp"><img src="../Images/527edff7e1a4f80d62a8af8f60c98e47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*jCyLJKvIaMVhLtxAoUTFiQ.png"/></div></figure><p id="1d9c" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">你可以看到预测的结果(91.6405%属于类“老虎，Panthera tigris”)和可视化的特征在AlexNet之间传递。</p><p id="a924" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">在你当前的工作目录中应该有5张图片。红色表示该层最重要的特征。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es if"><img src="../Images/4fef2bdc4a9476d046f6d41ef3d5a20c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*mzmytBNCTO3CEKtpCVxIRA.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">从左到右和从上到下:第一层、第二层、第三层、第四层和第五层最重要的特征</figcaption></figure><p id="233d" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">显然，简单的边缘特征在像层1这样的早期层被高度激活(即更重要)。在第5层，你可以看到老虎的头部被突出显示。这意味着模型(或AlexNet)认为这是将这个物体归类为老虎的重要特征。</p><p id="7963" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">希望下次我们能深入讨论模型内部的特征选择。特征表示是当今深度学习发展中一个非常重要的课题。</p><p id="ed38" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">现在，你可以尝试从网上下载一些图片，保存在“alexnet_images”文件夹内。然后，您可以在命令窗口中键入以下命令，</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/b6027e4a2649e5a32e9362fa66364174.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*PwM1rCFIKTcMRG2lDYY8sQ.png"/></div></figure><p id="0c8e" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">请注意，xxx.jpg是您的图像的文件名。让我们试试看你会得到什么样的预测结果！:)</p><h1 id="5571" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">参考</h1><p id="379c" class="pw-post-body-paragraph ir is hi it b iu lb iw ix iy lc ja jb jc lr je jf jg ls ji jj jk lt jm jn jo hb bi translated">[1]<a class="ae iq" href="https://papers.nips.cc/paper/4824-imagenet-classification-with-deep-convolutional-neural-networks" rel="noopener ugc nofollow" target="_blank">https://papers . nips . cc/paper/4824-imagenet-class ification-with-deep-convolutionary-neural-networks</a></p><p id="ef55" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">这是我第一次写博客来分享我所学到的东西。为什么我想这么做？因为我想改变一些事情。希望写作可以改变我的想法，在未来的日子里，我可以做我自己。</p><p id="e193" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">如果你喜欢，请在这里留下评论，告诉我你的想法！:)感谢您的关注，希望您喜欢这篇分享。回头见！</p></div></div>    
</body>
</html>