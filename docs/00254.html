<html>
<head>
<title>Deploying Your Machine Learning Model as a REST API Using Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Flask将机器学习模型部署为REST API</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploying-your-machine-learning-model-as-a-rest-api-using-flask-c2e6a0b574f5?source=collection_archive---------0-----------------------#2019-01-26">https://medium.com/analytics-vidhya/deploying-your-machine-learning-model-as-a-rest-api-using-flask-c2e6a0b574f5?source=collection_archive---------0-----------------------#2019-01-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/53fbae392ef88b25c9fefcc42d97560a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kxgDotilGf64NxG0"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">克里斯里德在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="54c3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有成千上万的在线课程教你如何建立和训练机器学习模型或深度神经网络，许多这些教程最终只会让你独自训练和建立模型。然而，这将导致您在本地计算机上拥有一个模型文件，这还不是故事的结尾:模型需要被部署，以便被客户端或最终用户使用。</p><p id="4771" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">作为一名web开发人员和数据科学家，我渴望构建Web应用程序来展示我的工作。尽管我很喜欢设计前端，但同时学习机器学习和web开发变得非常困难。因此，我必须找到一种解决方案，能够轻松地将我的机器学习模型与其他开发人员集成，这些开发人员能够比我更好地构建一个健壮的web应用程序。</p><p id="278c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过为我的模型构建REST API，我可以将我的代码与其他开发人员分开。这里有明确的分工，这有利于定义责任，并防止我直接阻止不参与项目机器学习方面的队友。另一个优点是，我的模型可以被在不同平台上工作的多个开发人员使用，比如web或mobile。</p><h1 id="e9aa" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">关于烧瓶</h1><p id="1eab" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated"><a class="ae iu" href="http://flask.pocoo.org" rel="noopener ugc nofollow" target="_blank"> Flask </a>是一个用于Python的微型web框架。它被称为微框架，因为它不需要特殊的工具或库。虽然看它的(简单的)概览页面你不会猜到这一点，但它是Pinterest的主要API技术。您可以使用Flask web服务来创建一个API调用，它可以由前端使用，甚至是一个完整的web应用程序。</p><p id="36dc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一个非常简单的flask应用程序应该是这样的:</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="b9f6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我将构建一个简单的Scikit-Learn模型，并使用<a class="ae iu" href="https://flask-restful.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> Flask RESTful </a>将其部署为REST API。本文特别面向没有广泛计算机科学背景的数据科学家。</p><p id="1395" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">它可以使用pip与终端一起安装</p><pre class="kw kx ky kz fd lc ld le lf aw lg bi"><span id="33de" class="lh ju hi ld b fi li lj l lk ll">pip install flask</span></pre><h1 id="b39a" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">获取数据集</h1><p id="6793" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">在这篇文章中，我使用了一个<a class="ae iu" href="https://archive.ics.uci.edu/ml/datasets/YouTube+Spam+Collection" rel="noopener ugc nofollow" target="_blank"> YouTube垃圾邮件收集数据集</a>，它是一个公共的垃圾邮件研究评论数据集。它有五个数据集，由从五个视频中提取的1，956条真实消息组成，这五个视频是在收集期间观看次数最多的10个视频之一。我将只使用五个数据集之一，即Youtube01-Psy.csv</p><h1 id="3806" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">Setting up your environment</h1><p id="706c" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">I created a new file and save it as <strong class="ix hj">app.py</strong></p><p id="55b8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">I then created two folders (<strong class="ix hj">templates</strong> and <strong class="ix hj">static</strong> )alongside the file app.py</p><p id="8be0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Then inside the folder static created I created another folder called CSS, which houses all our CSS files (<strong class="ix hj">style.css</strong>).</p><p id="b916" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">a little overview of the file structure:</p><pre class="kw kx ky kz fd lc ld le lf aw lg bi"><span id="1574" class="lh ju hi ld b fi li lj l lk ll">├── app.py  <strong class="ld hj"># Flask REST API script</strong><br/>└── data/<br/>    └── Youtube01-Psy.csv<strong class="ld hj"># data from UCI Machine learning Repository </strong><br/>├── templates<br/>      ├── home.html<br/>      └── result.html<br/>└── static<br/>    └── CSS<br/>         └── style.css</span></pre><h1 id="b787" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">Import Libraries</h1><p id="bb60" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">The code below contains our necessary libraries needed for the task</p><pre class="kw kx ky kz fd lc ld le lf aw lg bi"><span id="efef" class="lh ju hi ld b fi li lj l lk ll">from flask import Flask, render_template,url_for,request<br/>import pandas as pd<br/>import pickle<br/>from sklearn.feature_extraction.text import CountVectorizer<br/>from sklearn.naive_bayes import MultinomialNB<br/>from sklearn.externals import joblib</span></pre><h1 id="7252" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">Initialize The App</h1><pre class="kw kx ky kz fd lc ld le lf aw lg bi"><span id="61a3" class="lh ju hi ld b fi li lj l lk ll">app = Flask(__name__)</span><span id="bfe7" class="lh ju hi ld b fi lm lj l lk ll">#Machine Learning code goes here</span><span id="e02b" class="lh ju hi ld b fi lm lj l lk ll">if __name__ == '__main__':<br/> app.run(debug=True)</span></pre><p id="e40c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Building the App</p><p id="b1c9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Creating the homepage</p><p id="6a7b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">We need to create an HTML file in the templates folder, this is will be our homepage. I save mine as <strong class="ix hj">home.html</strong></p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="2f09" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Then I also update <strong class="ix hj">app.py</strong></p><pre class="kw kx ky kz fd lc ld le lf aw lg bi"><span id="8fb6" class="lh ju hi ld b fi li lj l lk ll"><a class="ae iu" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank"><br/>@app</a>.route('/')<br/>def home():<br/> return render_template('home.html')</span></pre><p id="f1f9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Creating the Result Web Page</p><p id="47d8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">I created an HTML file which is going to display the answer to the prediction if it a spam or not. I saved it with <strong class="ix hj">result.html</strong></p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="89e1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">I then updated <strong class="ix hj">app.py</strong> with another function decorator having the model inside.</p><pre class="kw kx ky kz fd lc ld le lf aw lg bi"><span id="cab3" class="lh ju hi ld b fi li lj l lk ll"><a class="ae iu" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/predict', methods = ['POST'])<br/>def predict():<br/> df = pd.read_csv("data/Youtube01-Psy.csv")<br/> df_data = df[['CONTENT', 'CLASS']]<br/> # Features and Labels<br/> df_x = df_data['CONTENT']<br/> df_y = df_data.CLASS<br/> #Extract the features with countVectorizer<br/> corpus = df_x<br/> cv = CountVectorizer()<br/> X = cv.fit_transform(corpus)<br/> from sklearn.model_selection import train_test_split</span><span id="5ad3" class="lh ju hi ld b fi lm lj l lk ll">X_train, X_test, y_train, y_test = train_test_split(X, df_y, test_size = 0.33, random_state = 42)</span><span id="88e7" class="lh ju hi ld b fi lm lj l lk ll">#Navie Bayes<br/> clf = MultinomialNB()<br/> clf.fit(X_train, y_train)<br/> clf.score(X_test, y_test)</span><span id="5dc4" class="lh ju hi ld b fi lm lj l lk ll">#Save Model<br/> joblib.dump(clf, 'model.pkl')<br/> print("Model dumped!")</span><span id="3ae4" class="lh ju hi ld b fi lm lj l lk ll">#ytb_model = open('spam_model.pkl', 'rb')<br/> clf = joblib.load('model.pkl')</span><span id="1618" class="lh ju hi ld b fi lm lj l lk ll">if request.method == 'POST':<br/>  comment = request.form['comment']<br/>  data = [comment]<br/>  vect = cv.transform(data).toarray()<br/>  my_prediction = clf.predict(vect)</span><span id="80c9" class="lh ju hi ld b fi lm lj l lk ll">return render_template('result.html', prediction = my_prediction)</span></pre><p id="c254" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Here is the full code</p><p id="a3bd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">App.py</strong></p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="6d98" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Run App.py</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/24361d5a3de39a9640e21e67c45005da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vWGbJCkIGwlvsXIJrfnSYg.png"/></div></div></figure><p id="52c9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Our flask server is running on <a class="ae iu" href="http://127.0.0.1:500/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:500/</a></p><p id="626f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">This is how it looks on a web browser:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/a935fded2905b64ede7426ca5e571ead.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6D37bvD3a9fhcek7lCTlWw.png"/></div></div></figure><p id="92a5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Below is the result of the comment entered into it</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/79752b5680d968002f4ce0963aa592f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mvIaLRK4-y1rObR_uV3FnQ.png"/></div></div></figure><p id="1c43" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Get the full code <a class="ae iu" href="https://github.com/emmapraise/deploying-ml-model-using-flask" rel="noopener ugc nofollow" target="_blank">here</a></p></div></div>    
</body>
</html>