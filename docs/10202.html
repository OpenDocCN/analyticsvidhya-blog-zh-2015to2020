<html>
<head>
<title>Time Series Analysis using ARIMA and LSTM(in Python and Keras)-Part1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ARIMA和LSTM的时间序列分析(Python和Keras版)-第1部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/time-series-analysis-using-arima-and-lstm-in-python-and-keras-part1-f987e11f9f8c?source=collection_archive---------4-----------------------#2020-10-09">https://medium.com/analytics-vidhya/time-series-analysis-using-arima-and-lstm-in-python-and-keras-part1-f987e11f9f8c?source=collection_archive---------4-----------------------#2020-10-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="28cf" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">时间序列分析的统计方法:ARIMA</h2></div><blockquote class="ix iy iz"><p id="343d" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><a class="ae jx" href="https://medium.com/p/74a79636568/edit" rel="noopener">【链接到第二部分】</a></p></blockquote><h2 id="184c" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">介绍</h2><p id="0b78" class="pw-post-body-paragraph ja jb hi jd b je kw ij jg jh kx im jj kj ky jm jn kn kz jq jr kr la ju jv jw hb bi translated">时间序列是一种序列数据，要通过统计方法(如ARIMA)或深度学习技术(如RNN、LSTM)对其进行分析，在这两种情况下都需要保持序列。具体来说，在分离训练集和测试集之前，不允许随机洗牌，不像非顺序类型，例如回归和分类。例如，如果我们正在处理2018年4月至2020年9月的Spotify每周股票数据(日期与开盘价:图1)，我们可以将2018年4月至2020年3月的数据范围作为建立模型的训练集，并将2020年4月至2020年9月作为预测(或验证)的测试集。如果我们打乱数据，序列信息就会丢失，分析算法就不会像预期的那样工作。我们总是根据过去的数据做一个训练模型，预测未来的数据。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es lb"><img src="../Images/7d6f502ac662ad65a46de0667ae61267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ni1XoyWYF5-MB7ls3flPLQ.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">图1: Spotify每周股票</figcaption></figure><h2 id="d66c" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">数据集和时间序列相关术语</h2><p id="facf" class="pw-post-body-paragraph ja jb hi jd b je kw ij jg jh kx im jj kj ky jm jn kn kz jq jr kr la ju jv jw hb bi translated">在本文中，选择了三个不同的数据集来展示不同的时间序列类型:</p><ol class=""><li id="4774" class="lr ls hi jd b je jf jh ji kj lt kn lu kr lv jw lw lx ly lz bi translated">Spotify股票:</li></ol><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es ma"><img src="../Images/d439e7e9b9ce9e9630ddda33e5b3cee1.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*gPI8gI7f_efyFZut9LkeYg.png"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">图1a: Spotify每周股票(2018年4月至2020年9月)</figcaption></figure><p id="1a3a" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">选择这个数据集的原因是向您展示一个既没有趋势也没有季节性的序列。我当时正在寻找这样一个新的数据集，不过让我检查一下Spotify，因为它是一家非常年轻的公司，可能还没有形成任何趋势(股票数据通常没有任何季节性)</p><p id="7e2a" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">2.谷歌股票:</p><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es mb"><img src="../Images/a5c2e6ec869dc4f71aff77e0b6b9ef75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*lLMjF_MhtQP3X8c-GreEHQ.png"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">图2:谷歌每周股票(2015年1月-2020年9月)</figcaption></figure><p id="dbad" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">你可能已经猜到了，它有上升的趋势。我分享了<a class="ae jx" href="https://docs.google.com/spreadsheets/d/1g8VDtUefw3pmfjCkpyQ_LU16WCl4MM2Lt4E3bqaA2ek/edit?usp=sharing" rel="noopener ugc nofollow" target="_blank">谷歌工作表链接</a>，这样你就可以更改日期并获得新的数据系列，以防你想做一些实验。</p><p id="c7b6" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">3.来自Kaggle( <a class="ae jx" href="https://www.kaggle.com/andreazzini/international-airline-passengers" rel="noopener ugc nofollow" target="_blank">数据集链接</a>)的航班乘客数据集:</p><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es mc"><img src="../Images/49fe45f58860afb19b8dc9db34db4383.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*58pygB1Rn9DKPOiPkwXP0g.png"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">图3:1949年1月至1960年12月每月国际航线乘客数量</figcaption></figure><p id="3e61" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">这是我们将应用ARIMA和LSTM的主要数据集。我选择它是因为它既有趋势性又有季节性。</p><p id="f16e" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">一个成熟的时间序列有三个组成部分:趋势、季节性和噪声(或残差)。</p><p id="c72e" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">趋势是序列平均值遵循的路径模式。在上面的图中，如果你想象一条线总是穿过时间序列的中间(像蓝色的虚线)，并问，我得到了任何一致的上升或下降模式吗？这足以想象出一种趋势。是啊！在这种情况下，这是一个上升趋势，但Spotify数据没有显示任何这样的一致趋势(另请注意图1a中的蓝色虚线。)</p><p id="3fe9" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">季节性是在一个时间序列中观察到的一系列相似的峰值或峰值。发生的<em class="jc">周期可以是每周、每月或每年</em>。在图3中，每年的峰值出现在每年的年中——是的！你猜对了；人们在夏天去度假:)</p><p id="69da" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">如果趋势和季节性从时间序列中分离出来，剩下的就是噪声或残差。</p><p id="7ca9" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">让我们来看一个航空公司数据的独立曲线图(也称为<em class="jc">分解</em>曲线图):</p><pre class="lc ld le lf fd md me mf mg aw mh bi"><span id="5954" class="jy jz hi me b fi mi mj l mk ml">components = seasonal_decompose(df, model='additive')<br/>components.plot()<br/>plt.show()</span></pre><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es mm"><img src="../Images/7b047eaa2ffd800e8d9a5c059ba5ccdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*rXM6uxjTSL5t8p8h252LEA.png"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">图4:航空公司数据的分解图</figcaption></figure><p id="f5f9" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">基于序列趋势，分解可以通过两种方式完成:加法和乘法。如果趋势是线性的，我们选择加法，否则对于非线性趋势，选择乘法分解。</p><p id="73f8" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">加法模型:Y[t] = T[t] + S[t] + e[t]</p><p id="6d17" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">乘法模型:Y[t] = T[t] * S[t] * e[t]</p><p id="e880" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">(Y=系列值，T =趋势，S =季节性，e=残差)</p><p id="b0fd" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">上面讨论的所有这些序列都是单变量的，即股票价格或乘客数量只取决于时间。本文将只讨论<em class="jc">单变量分析</em>。如果我们需要考虑除时间之外影响序列值的任何外部变量，那么它被称为外生变量，同时考虑外生变量的分析技术被称为外生时间序列分析。</p><blockquote class="ix iy iz"><p id="053b" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">不要错过疫情迅速传播后谷歌股票的暴跌，以及我们开始花更多时间在家时Spotify股票的飙升。这些都是外生效应。如果我们可以用数学方法转换这种影响，我们就可以在分析中应用它们。</p></blockquote><p id="cc5f" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">本文分为两部分。在第一部分，最流行的时间序列分析统计方法，ARIMA将被详细讨论。在第二部分中，将讨论用于时间序列分析的最流行的深度学习方法LSTM，并将其应用于航空公司数据，并将结果与从ARIMA获得的结果进行比较。还将讨论LSTM的超参数调谐。</p><p id="c6c1" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">MAE(平均绝对误差)和MAPE(平均绝对百分比误差)将是两种分析技术考虑的误差度量。RMSE的使用率也很高。</p><pre class="lc ld le lf fd md me mf mg aw mh bi"><span id="7be5" class="jy jz hi me b fi mi mj l mk ml"># Error function</span><span id="272d" class="jy jz hi me b fi mn mj l mk ml">def errors(prediction,actual):<br/>    <br/>    mae = np.mean(np.abs(prediction - actual))<br/>    <br/>    mape = np.mean(np.abs(prediction - actual)/np.abs(actual))<br/>    <br/>    rmse = np.mean((prediction - actual)**2)**0.5<br/>    <br/>    return({'mae':mae,'mape':mape,'rmse':rmse})</span></pre><p id="e0cc" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">我分享了Kaggle内核和的链接，可以在每个主题的开头找到。如果你在浏览相应的文章(或一部分)时浏览(或执行)一个内核，那将是最好的——你也可以同时跟随写在笔记本上的笔记。</p></div><div class="ab cl mo mp gp mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hb hc hd he hf"><h2 id="5c4a" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">ARIMA和萨里玛</h2><p id="b1b1" class="pw-post-body-paragraph ja jb hi jd b je kw ij jg jh kx im jj kj ky jm jn kn kz jq jr kr la ju jv jw hb bi translated"><a class="ae jx" href="https://www.kaggle.com/parijat2018/airline-passanger-sarima" rel="noopener ugc nofollow" target="_blank">【ARIMA内核】</a></p><p id="1fc0" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">ARIMA的基础条件是时间序列应该是<em class="jc">平稳的，</em>即不应该有任何趋势或季节性。当一个时间序列具有恒定的均值和相对恒定的方差时，即这些参数不随时间变化时，该时间序列称为平稳序列。</p><p id="1f98" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">我们已经讨论过时间序列可能由三部分组成:趋势、季节性和噪声。如果一个时间序列有趋势和季节性，那么它就不是一个平稳的时间序列，要将其转换为平稳的，必须通过<em class="jc">差分技术去除趋势和季节性。</em>差分技术有两种，分别是<em class="jc">常规(或简单)</em>和<em class="jc">季节性</em>。通常的差异仅消除趋势，但是如果序列具有季节性，则需要季节差异来消除趋势和季节性。</p><p id="8a65" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">通常的区别是从时间t的值(即当前周期的值)中减去时间t-1的值(即前一周期的值)。季节性差异是指减去当时的值t-s(其中s是季节性的周期，例如，对于该航空公司数据，我们应该选择t-12的滞后，因为它显示的是每年的季节性，而数据集时间线是每月的)</p><blockquote class="ix iy iz"><p id="b14f" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">差分的顺序用字母表示，<em class="hi"> d在ARIMA </em>中，即d，表示必须应用差分以使序列平稳的次数。有时，需要不止一次差分运算才能使序列平稳。</p></blockquote><p id="6158" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">作为做ARIMA的第一步，我们需要在应用差分之前确定一个序列是否已经是平稳的。如果它已经是一个稳定的，那么差分是不需要的，在这种情况下d=0。</p><p id="fde4" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">我们会用两种方式测试它。首先，通过观察线和序列的ACF(自相关函数或简称自相关)图，其次，通过执行检查平稳性的流行统计方法，即ADF(增强的Dickey-Fuller)测试。ADF检验的零假设h0是<em class="jc">时间序列是非平稳的</em>。因此，如果测试的p值小于显著性水平α(比如α=0.05)，那么我们可以拒绝零假设，并推断该时间序列是平稳的。相反的情况，当p值&gt;α时，我们需要求d的值使时间序列平稳。</p><p id="fe9a" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">ACF图只是相关系数与序列自身滞后的关系图。通过观察原图，我们已经知道该序列不是稳定的(即，同时具有趋势性和季节性)。现在，是时候应用统计工具来再次确认了。</p><p id="1b1a" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">让我们研究这两个图并进行ADF测试。</p><pre class="lc ld le lf fd md me mf mg aw mh bi"><span id="d28b" class="jy jz hi me b fi mi mj l mk ml">#ADF Test function<br/>def adf_test(series):<br/> result = adfuller(series.dropna())<br/> print(‘ADF Statistic: %f’ % result[0])<br/> print(‘p-value: %f’ % result[1])<br/> return result</span></pre><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es mv"><img src="../Images/956fd2c4b487eee774b6f4b0ee94eedd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sRARuGxCKU9RP_pHkkZYeQ.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">图5:原始系列的线条和ACF图</figcaption></figure><p id="9be9" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">ACF图中要检查的要点是，对于大量滞后，它是否显示正自相关(即，系数的正值)，那么可能需要更高阶的差分。在图5中，很明显需要一个差异，因为我们只能看到在滞后-13之前的正相关系数(在触及显著性带之前)。请注意，滞后从lag-0开始。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es mw"><img src="../Images/5524e88cd37b9481c7424f566aac115e.png" data-original-src="https://miro.medium.com/v2/resize:fit:392/format:webp/1*yumMO1xQVbMJXFKllEOKuA.png"/></div></figure><p id="57e2" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">另一方面，ADF测试也显示p值远大于0.05的显著性水平。所以，我们不能拒绝零假设。那么，让我们做第一个通常的区别。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es mx"><img src="../Images/ae7e8f69c30dde463ea398491a074c3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0A8VvcsDLO9qjHDe2enlhg.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">图6:第一次差分后原始系列的线、ACF和图</figcaption></figure><p id="1d8c" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">在系列的第一次常规差异(图6)之后，你还能注意到一些季节性吗？是啊！可以注意到。因此，在这种情况下，如果我们只进行通常的差分是不够的。我们还需要做季节差异。</p><p id="cd31" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">在这里，我应该提到季节性ARIMA结构，通常称为萨里玛，然后再进行季节性分析。</p><p id="a9f4" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">结构为:<strong class="jd hj">萨里玛(P，D，q) X (P，D，Q，s) </strong></p><p id="0fbc" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">其中P，D，Q是P，D，Q和s的季节对应，是周期性。</p><p id="d768" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">我还应该提到，偏自相关图或PCF图(参见图6)与ACF图类似。y轴代表偏自相关系数，仅此而已。</p><p id="13de" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">现在，让我们应用每年(s=12，因为时间线在数据集中是每月，季节性是每年)，第一个季节差异，并再次检查图和ADF测试结果。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es my"><img src="../Images/937ae8cf7b1bc04d1db753f26abccf84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UTdJsXNlW7v9g6s9GGuVHA.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">图7:第一次季节差异后原始系列的线、ACF和图</figcaption></figure><p id="208c" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">第一个季节差异图(图7)显示，在系列中没有留下趋势和季节性的痕迹。ACF图显示了显著的自相关系数，直到滞后-3(从滞后-4开始，它触及红色显著带)。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es mz"><img src="../Images/c12722b5e5ae95819e0e4ceafbab110b.png" data-original-src="https://miro.medium.com/v2/resize:fit:410/format:webp/1*o2cMWQv2EZoAifMvB89BOQ.png"/></div></figure><p id="c10a" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">ADF测试也显示p值小于0.05的显著性。</p><p id="5558" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">所以我们可以选择D=1和d=1。</p><p id="ff56" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">有时可能还需要第二个差异。在二阶和高阶差分中要检查什么？如果第二次差分显示过度差分，则需要将其恢复到第一次差分。我们如何识别过度差异？如果在第二次差分之后，lag-1自相关系数为零或负值，或者系数接近零且无模式，则该序列不需要任何进一步的差分，但是如果lag-1自相关系数为-0.5或更负，则该序列遭受过差分。它需要恢复到先前的低阶差分。</p><p id="c3df" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">现在我们来探究一下p和q，试着找出它们在这个问题中的值。首先，我们需要了解是将模型构建为AR、MR还是组合AR-MR，然后还需要找到自回归(AR)的阶数，即参数p的值，以及(或)移动平均(MR)的阶数，即参数q的值。</p><blockquote class="ix iy iz"><p id="82c3" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">p的值表示响应变量的先前值的滞后次数，而q的值表示预测时要考虑的误差项的滞后次数。</p></blockquote><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es na"><img src="../Images/792ab68a099bbe74268a5c2d9aae70cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*54zTwrIf8BMY2hy2fLLmKA.png"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">纯AR模型</figcaption></figure><p id="143b" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">在纯AR模型Yt中，响应变量在时间t处的值仅取决于响应变量在滞后-1至滞后-p处的值。在上述等式中，єt表示根据时间t-1至t-p处的滞后值预测值t处的误差项</p><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es nb"><img src="../Images/301356ffc1220fcd25137facc3ddcc76.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*sRu-JuGNcOwpgCVV6tENRQ.png"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">纯磁共振模型</figcaption></figure><p id="a160" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">在纯移动平均模型Yt中，响应变量t的值仅取决于AR模型的误差值，而预测则基于滞后值。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es nc"><img src="../Images/cdb289d12833e7cdb3065616de3dbdac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*IvFTOwIdw-3nbAife26Mdw.png"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">AR-MR模型</figcaption></figure><p id="d417" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">这是组合AR-ARIMA先生模型。这是一个线性回归模型，如果自变量与因变量高度相关，但彼此不相关，它就能很好地工作。</p><p id="d173" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">作为一个例子，如果最终模型是ARIMA(1，1，4)，即ARMR模型，则该等式看起来像:</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nd"><img src="../Images/d9655965d8e01d60e8c6c145d00e49a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R2UVYT05gGYkL0zOmuKSBA.png"/></div></div></figure><blockquote class="ix iy iz"><p id="4ab6" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">一个平稳时间序列的ARIMA(p，d，q)组合模型具有一个差分阶d，可以用文字描述为:</p><p id="7cf9" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">当时的预测值Yt，t =常数+y先前值的线性组合(最多，p个滞后值)+误差的线性组合，єs，由滞后预测生成(最多，q个滞后值)</p></blockquote><p id="e3ca" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">既然我们已经理解了P和q代表什么，下一个明显的步骤是找到P，q，P和q的值。</p><p id="cc5b" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">这一步是通过研究PACF(部分自相关系数与滞后)来找到P(和P)值，并研究ACF(自相关系数与滞后)图来找到Q(和Q)值。记住，对于两个图，滞后从滞后-0(零)开始。</p><p id="4146" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">首先，让我们从图6中找到p和q值:</p><p id="19f9" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">通过观察PACF图(图6 ),可以发现系数高于显著性带，直到第一个滞后，在这种情况下，p=1。</p><p id="eaa3" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">通过观察ACF图(图6 ),可以发现系数在第一个滞后之前都高于显著性带，因此，在这种情况下，q=1。</p><p id="b6e5" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">其次，让我们从图7中找到P和Q值:</p><p id="3672" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">通过观察PACF图(图7 ),可以发现系数高于显著性带，直到第一个滞后，在这种情况下，P=1。</p><p id="c739" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">通过观察ACF图(图7 ),可以发现系数高于显著性带，直到第三个滞后，因此，在这种情况下，Q=3。</p><p id="6caa" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">记住，我们已经找到了d=1和D=1。</p><p id="d177" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">干得好！我们已经找到了我们的最终模型:<strong class="jd hj"> SARIMA(1，1，1)X(1，1，3，12) </strong></p><p id="5378" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">现在，让我们对数据进行顺序分割并执行SARIMA。</p><pre class="lc ld le lf fd md me mf mg aw mh bi"><span id="cdcd" class="jy jz hi me b fi mi mj l mk ml">series=df['No of Passangers'] # Creating the Series</span><span id="05ac" class="jy jz hi me b fi mn mj l mk ml">train=series[:-24]<br/>test=series[-24:]</span><span id="3ce6" class="jy jz hi me b fi mn mj l mk ml">mod = sm.tsa.statespace.SARIMAX(series, order=(1,1,1), seasonal_order=(1,1,3,12))<br/>res=mod.fit()<br/># validating on the last 24 months of test data</span><span id="30c8" class="jy jz hi me b fi mn mj l mk ml">forecast=res.predict(start=120,end=143,dynamic=True)</span></pre><p id="b322" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">让我们看看这种手动分析方法中的验证错误:</p><pre class="lc ld le lf fd md me mf mg aw mh bi"><span id="670c" class="jy jz hi me b fi mi mj l mk ml">#Validation Error in the manual technique <br/>errors_manual=errors(forecast,test) #test=series[120:]<br/>errors_manual</span></pre><p id="b777" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">验证MAPE为13.85%</p><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es ne"><img src="../Images/8eaf7a6639e5e597c52f1356da262f0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/1*jfVQPhKN1SlnPMGWN7hq5g.png"/></div></figure><p id="dcd6" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">下图8显示了验证结果的曲线图。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nf"><img src="../Images/e3069d2fbe801e600022725b4d73043c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gb0i02CMxsjPFy6WPc4BAg.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">图8:验证结果图</figcaption></figure><h2 id="4e95" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">自动Arima</h2><p id="678b" class="pw-post-body-paragraph ja jb hi jd b je kw ij jg jh kx im jj kj ky jm jn kn kz jq jr kr la ju jv jw hb bi translated">在实际分析之前，你一定在想有很多工作要做:)你是绝对正确的。我第一次做的时候也是这么想的，但是总有更聪明的技巧，你可能已经猜到了。</p><p id="7bc1" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">让我让你们熟悉一下ARIMA分析中的网格搜索技术，叫做自动ARIMA。它会自动查找P、D、q、P、D和q的值。有两个Python库可用于Auto Arima，即pmdarima和pyramid.arima。我将使用pmdarima进行此分析。自动ARIMA通过选择具有最小AIC(赤池信息标准)值的模型来寻找最佳模型，与网格搜索通过选择误差最小或精度最高的生产模型来寻找最佳模型的方式类似。</p><pre class="lc ld le lf fd md me mf mg aw mh bi"><span id="d86d" class="jy jz hi me b fi mi mj l mk ml">! pip install pmdarima</span><span id="e6d1" class="jy jz hi me b fi mn mj l mk ml">import pmdarima as pm<br/>model = pm.auto_arima(train, start_p=1, start_q=1,<br/>                      test='adf',       <br/># use adftest to find optimal 'd'<br/>                      max_p=3, max_q=3, <br/># maximum p=3 and q=3<br/>                      m=12,              <br/># periodicity of 12 months as the data timeline is in months<br/>                      d=None,           <br/># let the model determine 'd'<br/>                      seasonal=True,   # Seasonality<br/>                      start_P=0, <br/>                      D=1, <br/>                      trace=True,<br/>                      error_action='ignore',  <br/>                      suppress_warnings=True, <br/>                      stepwise=True)</span><span id="876e" class="jy jz hi me b fi mn mj l mk ml">print(model.summary())</span></pre><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es ng"><img src="../Images/c6d39ed70660646534454edeefdb6bba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BemLR96O9YcVP6eaWZs7hg.png"/></div></div></figure><p id="b8b5" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">请注意，所选最佳模型的AIC值(=803.281)是所有组合中最小的。</p><p id="ec11" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">现在，让我们根据训练数据训练模型，并根据测试数据对其进行验证。</p><pre class="lc ld le lf fd md me mf mg aw mh bi"><span id="fb4e" class="jy jz hi me b fi mi mj l mk ml">model.fit(train)<br/>val_forecast=model.predict(n_periods=len(test))</span><span id="fa77" class="jy jz hi me b fi mn mj l mk ml">#Note:<br/>In case of Auto Arima the model has to be supplied with n_periods for prediction but for normal ARIMA is has to be supplied with (start,end,dynamic=True)</span><span id="072c" class="jy jz hi me b fi mn mj l mk ml"># creating series from the prediction array<br/>val_forecast=pd.Series(val_forecast,index=test.index)</span><span id="b670" class="jy jz hi me b fi mn mj l mk ml"># Errors<br/>errors_auto=errors(val_forecast,test)<br/>errors_auto</span></pre><p id="3964" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">验证MAPE为14.93%</p><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es nh"><img src="../Images/96daf5c991f82656c828cda8ef812bfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*wBILWxaABb95HeVylVv87A.png"/></div></figure><p id="8797" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">下图9显示了验证结果的曲线图。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es ni"><img src="../Images/7f3e43a60e5ac24ba951137546ba0735.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*90You0yN9VgCRX1fMLbpZA.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">图9:验证结果图-自动ARIMA</figcaption></figure><h2 id="f89d" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">预测</h2><p id="2e52" class="pw-post-body-paragraph ja jb hi jd b je kw ij jg jh kx im jj kj ky jm jn kn kz jq jr kr la ju jv jw hb bi translated">现在是有趣的部分！让我们在整个数据集上训练整个模型，并预测接下来的24个月。让我们使用自动ARIMA。</p><pre class="lc ld le lf fd md me mf mg aw mh bi"><span id="c483" class="jy jz hi me b fi mi mj l mk ml">from pandas.tseries.offsets import DateOffset<br/>n_periods=24 # Forecasting next 24 months<br/>fc= model.predict(n_periods=n_periods)</span><span id="f7bd" class="jy jz hi me b fi mn mj l mk ml">#Creating index for the forecast period<br/>fc_index=[series.index[-1]+DateOffset(months=x) for x in range(1,n_periods+1)]<br/>fc_series = pd.Series(fc, index=fc_index)</span></pre><p id="73f7" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">下面的图10显示了预测的图表。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nj"><img src="../Images/f41a0320a1cb1dbbe9f2b840730df0ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MSd0zTQwxyQWkjnIWRYjUQ.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">图10:未来24个月的预测图</figcaption></figure><p id="01b7" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated">在这一部分中，我们讨论了不同的时间序列项，尝试了经典的ARIMA方法、自动ARIMA方法，最后做了预测。我们发现自动ARIMA方法可以更快地获得基本结果。在下一部分中，我们将讨论LSTM深度学习技术并将其应用于同一飞机时间序列数据集，并将MAPE与我们从ARIMA分析中获得的结果进行比较。</p><blockquote class="ix iy iz"><p id="705c" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><a class="ae jx" href="https://medium.com/p/74a79636568/edit" rel="noopener">【链接到第二部分】</a></p></blockquote><p id="2d74" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated"><strong class="jd hj">T3】参考文献:T5】</strong></p><div class="nk nl ez fb nm nn"><a href="https://www.machinelearningplus.com/" rel="noopener  ugc nofollow" target="_blank"><div class="no ab dw"><div class="np ab nq cl cj nr"><h2 class="bd hj fi z dy ns ea eb nt ed ef hh bi translated">机器学习增强版——R &amp; Python中的简化教程</h2><div class="nu l"><h3 class="bd b fi z dy ns ea eb nt ed ef dx translated">Machine Learning Plus是为那些寻求人工智能/数据科学/ ML相关知识的人提供的教育资源。这里…</h3></div><div class="nv l"><p class="bd b fp z dy ns ea eb nt ed ef dx translated">www.machinelearningplus.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob ll nn"/></div></div></a></div><div class="nk nl ez fb nm nn"><a href="https://online.stat.psu.edu/" rel="noopener  ugc nofollow" target="_blank"><div class="no ab dw"><div class="np ab nq cl cj nr"><h2 class="bd hj fi z dy ns ea eb nt ed ef hh bi translated">在线统计|在线统计</h2><div class="nu l"><h3 class="bd b fi z dy ns ea eb nt ed ef dx translated">今天就在宾夕法尼亚州立大学世界校区注册，获得统计学认证学位或证书。</h3></div><div class="nv l"><p class="bd b fp z dy ns ea eb nt ed ef dx translated">online.stat.psu.edu</p></div></div><div class="nw l"><div class="oc l ny nz oa nw ob ll nn"/></div></div></a></div><p id="9cf2" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated"><a class="ae jx" href="https://www.stata.com/manuals13/tsarima.pdf" rel="noopener ugc nofollow" target="_blank">https://www.stata.com/</a></p><p id="2bd6" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kj jl jm jn kn jp jq jr kr jt ju jv jw hb bi translated"><a class="ae jx" href="https://www.statsmodels.org/" rel="noopener ugc nofollow" target="_blank">https://www.statsmodels.org/</a></p></div></div>    
</body>
</html>