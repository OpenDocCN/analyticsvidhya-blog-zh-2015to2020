<html>
<head>
<title>Introduction to Time Series Analysis and Forecasting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列分析和预测导论</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/introduction-to-time-series-analysis-and-forecasting-f68f61235c9c?source=collection_archive---------17-----------------------#2020-07-17">https://medium.com/analytics-vidhya/introduction-to-time-series-analysis-and-forecasting-f68f61235c9c?source=collection_archive---------17-----------------------#2020-07-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/a3291e395810bb7da09c25a35bc240ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:552/format:webp/1*M28TBih5nuR31-7plwdiDQ.jpeg"/></div></figure><p id="562f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">时间序列分析</strong>包括分析<strong class="io hj">时间序列</strong>数据的方法，以提取有意义的统计数据和数据的其他特征。<strong class="io hj">时间序列</strong>预测是利用模型来预测未来值。</p><h2 id="5082" class="jk jl hi bd jm jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke bi translated">在本文中，我们将基于“预测未来销售”数据集讨论这些结果及其背后的理论。</h2><p id="e695" class="pw-post-body-paragraph im in hi io b ip kf ir is it kg iv iw ix kh iz ja jb ki jd je jf kj jh ji jj hb bi translated">注意:要了解每一个细节和背后的详细理论，请查看本教程。</p><div class="kk kl ez fb km kn"><a href="http://mathematicacity.co.in/2020/07/introduction-to-time-series-analysis-and-forecasting%e2%80%8a-%e2%80%8ai/" rel="noopener  ugc nofollow" target="_blank"><div class="ko ab dw"><div class="kp ab kq cl cj kr"><h2 class="bd hj fi z dy ks ea eb kt ed ef hh bi translated">时间序列分析和预测导论(一)</h2><div class="ku l"><h3 class="bd b fi z dy ks ea eb kt ed ef dx translated">时间序列分析包括分析时间序列数据的方法，以提取有意义的统计和…</h3></div><div class="kv l"><p class="bd b fp z dy ks ea eb kt ed ef dx translated">mathematicacity.co.in</p></div></div><div class="kw l"><div class="kx l ky kz la kw lb ik kn"/></div></div></a></div><h2 id="10f5" class="jk jl hi bd jm jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke bi translated">数据集描述:</h2><p id="c198" class="pw-post-body-paragraph im in hi io b ip kf ir is it kg iv iw ix kh iz ja jb ki jd je jf kj jh ji jj hb bi translated">我们有:</p><ol class=""><li id="4115" class="lc ld hi io b ip iq it iu ix le jb lf jf lg jj lh li lj lk bi translated">日期——售出商品的每个日期</li><li id="d600" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">date_block_num —每月指定的数字</li><li id="0d92" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">shop_id —每个商店的唯一编号</li><li id="728e" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">item_id —每个项目的唯一编号</li><li id="99c6" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">item_price —每个项目的价格</li><li id="b51f" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">item_cnt_day —某一天售出的商品数量</li></ol><h2 id="549c" class="jk jl hi bd jm jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke bi translated">我们需要的包装:</h2><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="d038" class="jk jl hi lv b fi lz ma l mb mc">import warnings<br/>import itertools<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>warnings.filterwarnings("ignore")<br/>plt.style.use('fivethirtyeight')<br/>import pandas as pd<br/>import statsmodels.api as sm<br/>from statsmodels.tsa.arima_model import ARIMA<br/>from pandas.plotting import autocorrelation_plot<br/>from statsmodels.tsa.stattools import adfuller, acf, pacf,arma_order_select_ic</span><span id="95fb" class="jk jl hi lv b fi md ma l mb mc">import matplotlibmatplotlib.rcParams['axes.labelsize'] = 14<br/>matplotlib.rcParams['xtick.labelsize'] = 12<br/>matplotlib.rcParams['ytick.labelsize'] = 12<br/>matplotlib.rcParams['text.color'] = 'k'</span></pre><p id="6744" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">读取数据:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="646c" class="jk jl hi lv b fi lz ma l mb mc">df=pd.read_csv('sales_train.csv')</span><span id="ae0a" class="jk jl hi lv b fi md ma l mb mc">df.head()</span></pre><p id="80bd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">数据类型:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="cf8b" class="jk jl hi lv b fi lz ma l mb mc">date               object<br/>date_block_num      int64<br/>shop_id             int64<br/>item_id             int64<br/>item_price        float64<br/>item_cnt_day      float64<br/>dtype: object</span></pre><p id="6f5e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们必须将“日期”对象转换为字符串(YYYY-MM-DD)</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="2709" class="jk jl hi lv b fi lz ma l mb mc">import datetime</span><span id="32d0" class="jk jl hi lv b fi md ma l mb mc">df['date']=pd.to_datetime(df.date)</span></pre><h2 id="6cfb" class="jk jl hi bd jm jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke bi translated">可视化时间序列数据:</h2><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="7cad" class="jk jl hi lv b fi lz ma l mb mc">ts=df.groupby(["date_block_num"])["item_cnt_day"].sum()</span><span id="b4f5" class="jk jl hi lv b fi md ma l mb mc">ts.astype('float')</span><span id="ba63" class="jk jl hi lv b fi md ma l mb mc">plt.figure(figsize=(16,8))</span><span id="2396" class="jk jl hi lv b fi md ma l mb mc">plt.title('Total Sales of the company')</span><span id="a84d" class="jk jl hi lv b fi md ma l mb mc">plt.xlabel('Time')</span><span id="e627" class="jk jl hi lv b fi md ma l mb mc">plt.ylabel('Sales')</span><span id="d301" class="jk jl hi lv b fi md ma l mb mc">plt.plot(ts)</span></pre><figure class="lq lr ls lt fd ij er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es me"><img src="../Images/ab9aba1b078634df1c4b7095f9eb24fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zO_OacuaGKeQXpV7txHTrg.png"/></div></div></figure><p id="43b2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们取某一特定月份售出的商品总数(我们可以取平均值而不是总和。我尝试了这两种方法，但平均无法给出一个好结果)。</p><p id="2d06" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">注意:当我们绘制数据时，会出现一些不同的模式。该时间序列具有季节性。似乎也有一个趋势:似乎先略有上升，然后下降。换句话说，时间序列中有趋势和季节成分。</p><figure class="lq lr ls lt fd ij er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es mj"><img src="../Images/dbaa510251d3ac3359b33068e1c0ee4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aiAToVd_S3rQdYvTruHODA.jpeg"/></div></div></figure><h2 id="6955" class="jk jl hi bd jm jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke bi translated">移除趋势:</h2><p id="0326" class="pw-post-body-paragraph im in hi io b ip kf ir is it kg iv iw ix kh iz ja jb ki jd je jf kj jh ji jj hb bi translated">考虑数据时间序列的季节性成分的一种方法是从时间序列中移除趋势。这样你就可以很容易地调查季节性。</p><p id="66cd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">去除趋势的方法:</p><ol class=""><li id="551e" class="lc ld hi io b ip iq it iu ix le jb lf jf lg jj lh li lj lk bi translated">要消除趋势，可以从原始信号中减去滚动平均值。然而，这将取决于你平均了多少个数据点。</li><li id="d978" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">另一种去除趋势的方法是差分法，即查看连续数据点之间的差异。</li></ol><h1 id="fbef" class="mk jl hi bd jm ml mm mn jq mo mp mq ju mr ms mt jx mu mv mw ka mx my mz kd na bi translated">用ARIMA进行时间序列预测</h1><p id="c79d" class="pw-post-body-paragraph im in hi io b ip kf ir is it kg iv iw ix kh iz ja jb ki jd je jf kj jh ji jj hb bi translated">我们将应用一种最常用的时间序列预测方法，称为ARIMA，它代表自回归综合移动平均。</p><p id="bc6c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">ARIMA模型用符号<code class="du nb nc nd lv b">ARIMA(p, d, q)</code>表示。这三个参数说明了数据中的季节性、趋势和噪声。</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="86c2" class="jk jl hi lv b fi lz ma l mb mc">model = ARIMA(ts['count'].values, order=(1, 1, 1))</span><span id="db54" class="jk jl hi lv b fi md ma l mb mc">fit_model = model.fit(trend='c', full_output=True, disp=True)</span><span id="8e81" class="jk jl hi lv b fi md ma l mb mc">fit_model.summary()</span></pre><p id="fcc0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">AIC : 743.512</p><p id="25e5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们画出这个:</p><figure class="lq lr ls lt fd ij er es paragraph-image"><div class="er es ne"><img src="../Images/df8e4e92daa2cca7256ed60b565c127e.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*5kkVBeweyBgdJx9cEd6t2A.png"/></div></figure><p id="fe29" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我对结果很满意。</p><h1 id="ec72" class="mk jl hi bd jm ml mm mn jq mo mp mq ju mr ms mt jx mu mv mw ka mx my mz kd na bi translated">用PROPHET进行时间序列预测</h1><p id="faf9" class="pw-post-body-paragraph im in hi io b ip kf ir is it kg iv iw ix kh iz ja jb ki jd je jf kj jh ji jj hb bi translated">预测工具<a class="ae nf" href="https://research.fb.com/prophet-forecasting-at-scale/" rel="noopener ugc nofollow" target="_blank"> Prophet </a>由脸书于2017年发布，旨在分析时间序列，这些时间序列在不同的时间尺度上显示模式，如每年、每周和每天。它还具有高级功能，可以对节假日对时间序列的影响进行建模，并实现自定义的变点。因此，我们使用Prophet来启动并运行一个模型。</p><p id="342f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用prophet的结果:</p><figure class="lq lr ls lt fd ij er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es ng"><img src="../Images/0b1835d1d7331773bef3a2163d0ba794.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2IpGhURm9f9UF07DFQ7-8A.png"/></div></div></figure><p id="b358" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里我们可以看到销售额在波动。</p><h1 id="a830" class="mk jl hi bd jm ml mm mn jq mo mp mq ju mr ms mt jx mu mv mw ka mx my mz kd na bi translated">LSTM的结果:</h1><p id="c332" class="pw-post-body-paragraph im in hi io b ip kf ir is it kg iv iw ix kh iz ja jb ki jd je jf kj jh ji jj hb bi translated">LSTM建筑</p><ol class=""><li id="377f" class="lc ld hi io b ip iq it iu ix le jb lf jf lg jj lh li lj lk bi translated">忘记大门</li><li id="9258" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">输入门</li><li id="dc48" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">输出门</li></ol><h2 id="2b30" class="jk jl hi bd jm jn jo jp jq jr js jt ju ix jv jw jx jb jy jz ka jf kb kc kd ke bi translated">我们的方法:</h2><p id="cd64" class="pw-post-body-paragraph im in hi io b ip kf ir is it kg iv iw ix kh iz ja jb ki jd je jf kj jh ji jj hb bi translated">我们的特征将是商店每月售出的商品数量，不包括上个月的数据，因为这将是我们的标签，我们帮助我们的模型学习预测下一个序列。对于测试，将使用商店每月售出的商品数量，不包括第一个月，这样我们的数据维度保持不变。我们的模型将预测下一个序列，我们将是我们的结果。</p><p id="e89d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">数据集的准备:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="23ee" class="jk jl hi lv b fi lz ma l mb mc">X_train = np.expand_dims(dataset.values[:,:-1],axis = 2)<br/># the last column is our label<br/>y_train = dataset.values[:,-1:]</span><span id="32cc" class="jk jl hi lv b fi md ma l mb mc"># for test we keep all the columns execpt the first one<br/>X_test = np.expand_dims(dataset.values[:,1:],axis = 2)</span><span id="3f6c" class="jk jl hi lv b fi md ma l mb mc"># lets have a look on the shape <br/>print(X_train.shape,y_train.shape,X_test.shape)</span><span id="c11c" class="jk jl hi lv b fi md ma l mb mc">&gt;(424124, 33, 1) (424124, 1) (424124, 33, 1)<br/>y_test=dataset.values[:,:1]<br/>print(y_test.shape)</span></pre><p id="c70c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后让我们跳到模型构建部分:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="bf0a" class="jk jl hi lv b fi lz ma l mb mc">from keras.models import Sequential<br/>from keras.layers import LSTM,Dense,Dropout</span><span id="9451" class="jk jl hi lv b fi md ma l mb mc">my_model = Sequential()<br/>my_model.add(LSTM(units = 64,input_shape = (33,1)))<br/>my_model.add(Dropout(0.4))<br/>my_model.add(Dense(1))</span><span id="a998" class="jk jl hi lv b fi md ma l mb mc">my_model.compile(loss = 'mse',optimizer = 'adam', metrics = ['mean_squared_error'])<br/>my_model.summary()</span></pre><p id="6835" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后拟合模型:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="068e" class="jk jl hi lv b fi lz ma l mb mc">history=my_model.fit(X_train,y_train,batch_size = 4096,epochs = 10)</span></pre><p id="3a8f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在让我们来计算RMSE值:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="8c08" class="jk jl hi lv b fi lz ma l mb mc">from sklearn.metrics import mean_squared_error<br/>from numpy import sqrt<br/>rmse = sqrt(mean_squared_error(y_test,y_pred))<br/>print('Val RMSE: %.3f' % rmse)</span></pre><p id="8fb1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">瓦尔·RMSE:1.595</p><p id="8130" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">注:RMSE是残差方差的平方根。它表示模型与数据的绝对拟合度，即观察到的数据点与模型预测值的接近程度。</p><p id="bbce" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">即较低的RMSE值表示更好的拟合。</p><p id="fd87" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个分数不错。对！！！！！</p><p id="17ea" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请在评论区给我们你的想法和结果。</p><p id="bfd1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果你想了解先知，LSTM和数据准备及其背后的所有理论，请通过以下链接。</p><div class="kk kl ez fb km kn"><a href="http://mathematicacity.co.in/2020/07/introduction-to-time-series-analysis-and-forecasting-ii/" rel="noopener  ugc nofollow" target="_blank"><div class="ko ab dw"><div class="kp ab kq cl cj kr"><h2 class="bd hj fi z dy ks ea eb kt ed ef hh bi translated">时间序列分析和预测导论2</h2><div class="ku l"><h3 class="bd b fi z dy ks ea eb kt ed ef dx translated">在这一部分，我们将讨论与我们的销售广泛相关的预言家和LSTM的预测结果…</h3></div><div class="kv l"><p class="bd b fp z dy ks ea eb kt ed ef dx translated">mathematicacity.co.in</p></div></div><div class="kw l"><div class="nh l ky kz la kw lb ik kn"/></div></div></a></div><figure class="lq lr ls lt fd ij er es paragraph-image"><div class="er es ni"><img src="../Images/efb4c91b1a55669c9d069917f7ea24d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:536/format:webp/1*DEi2tZVv8qSb7ZdtAb4zKA.jpeg"/></div></figure><p id="d1bd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">谢谢大家！！！</p></div></div>    
</body>
</html>