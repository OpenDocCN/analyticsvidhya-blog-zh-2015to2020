<html>
<head>
<title>Time Series and ARIMA using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python实现时间序列和ARIMA</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/time-series-and-arima-using-python-bb8563ea29e3?source=collection_archive---------6-----------------------#2019-12-19">https://medium.com/analytics-vidhya/time-series-and-arima-using-python-bb8563ea29e3?source=collection_archive---------6-----------------------#2019-12-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9934" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本帖中，我们将使用python模块进行时间序列分析和预测。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/ec4685a0e9e88f307b106c1a98f13db1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KPt77koVMBQPIltK"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">照片由<a class="ae jt" href="https://unsplash.com/@chrisliverani?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克里斯·利维拉尼</a>在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="b546" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于我们开始，我们需要一个数据集来玩。我们选择了一个数据集来描述1959年加利福尼亚每天的女性出生人数。它包含365个条目。</p><p id="8bb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据集可以在这里找到—<a class="ae jt" href="https://raw.githubusercontent.com/jbrownlee/Datasets/master/daily-total-female-births.csv" rel="noopener ugc nofollow" target="_blank">https://raw . githubusercontent . com/jbrownlee/Datasets/master/daily-total-female-births . CSV</a></p><p id="d187" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将从导入必要的模块开始—</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="661a" class="kg kh hi kc b fi ki kj l kk kl">import pandas as pd<br/>import matplotlib.pyplot as plt </span><span id="fbcb" class="kg kh hi kc b fi km kj l kk kl">from statsmodels.tsa.stattools import adfullerfrom # to do ADF test<br/>from statsmodels.graphics.tsaplots import plot_acf, plot_pacf <br/>from statsmodels.tsa.arima_model import ARIMA # to do predictions</span><span id="a739" class="kg kh hi kc b fi km kj l kk kl">from sklearn.model_selection import train_test_split</span><span id="d5d4" class="kg kh hi kc b fi km kj l kk kl">from pmdarima.arima import auto_arima # a wrapper</span><span id="fd27" class="kg kh hi kc b fi km kj l kk kl">import requests, io</span></pre><p id="a7ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将继续解释模块和代码。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="46b6" class="kn kh hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">ARIMA自动</h1><p id="7373" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">我们现在需要从url获取数据集，并使用pandas读取它。由于我们只有365个条目，我们可以一次读完。</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="9dee" class="kg kh hi kc b fi ki kj l kk kl">url = "https://raw.githubusercontent.com/jbrownlee/Datasets/master/daily-total-female-births.csv"<br/>s = requests.get(url).content</span><span id="87ef" class="kg kh hi kc b fi km kj l kk kl">def parser(x):    <br/>    return pd.datetime.strptime(x,'%Y-%m-%d')</span><span id="5e01" class="kg kh hi kc b fi km kj l kk kl">birth = pd.read_csv(io.StringIO(s.decode('utf-8')), index_col=0, parse_dates=[0], date_parser=parser)</span></pre><p id="cf3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们必须在这里索引日期，因为这是时间序列分析所必需的。</p><p id="8444" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意——如果有一个很大的csv文件，无法在内存中加载，那么我们通过传递参数<code class="du lp lq lr kc b">chunksize</code>来读取该csv文件。</p><p id="32dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太好了！我们已经把数据转换成可用于分析的数据图表。</p><p id="f507" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们将尝试安装<code class="du lp lq lr kc b">auto_arima</code>，看看它的表现如何，然后我们将尝试如何手动安装ARIMA。</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="f79d" class="kg kh hi kc b fi ki kj l kk kl">model = auto_arima(birth, trace=True, error_action='ignore', suppress_warnings=True,stationary=True)<br/>model.fit(birth)</span></pre><p id="7ea1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在注意由<code class="du lp lq lr kc b">auto_arima</code>生成的AIC和BIC值。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/b7cca0a71ed3c996890ad162d6995c07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PcBuw9NaC5gCtSjU-Xe6pw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">auto_arima结果</figcaption></figure><p id="3e3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于ARIMA阶(1，0，1)，AIC和BIC值最低。这是最适合ARIMA的。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="a524" class="kn kh hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">手动ARIMA</h1><p id="2506" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">对ARIMA的详细解释超出了本文的范围。对于本教程的唯一目的，我们需要了解在ARIMA需要三个订单。</p><p id="9178" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">p = AR的阶数</p><p id="2422" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">d =使时间序列数据稳定的差值</p><p id="6a23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">q =毫安的顺序</p><p id="db7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们首先将所有数据绘制成线图，看看是否有可以观察到的趋势。</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="0e3e" class="kg kh hi kc b fi ki kj l kk kl">birth.plot()<br/>plt.show()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lt"><img src="../Images/aca100d8ab02134eef402ac08e2801b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*V8CSp7sYBq5BMIcszwheew.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">这里没有观察到趋势</figcaption></figure><p id="acfc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过观察图表，我们可以说数据看起来是稳定的。</p><p id="284f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将做一个扩展的Dickey Fuller测试，以确保数据是稳定的。</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="ad7f" class="kg kh hi kc b fi ki kj l kk kl">result = adfuller(birth.Births) # ADF is less than 1% value. print('ADF Statistic: %f' % result[0])</span><span id="ab63" class="kg kh hi kc b fi km kj l kk kl"># p-value &lt; 0.05, hence we reject the null hypothesis that data has unit root# It means data is stationary.# Hence d = 0</span><span id="7ad3" class="kg kh hi kc b fi km kj l kk kl">print('p-value: %f' % result[1])</span><span id="ac89" class="kg kh hi kc b fi km kj l kk kl">for key, value in result[4].items(): <br/>    print('\t%s: %.3f' % (key, value))</span></pre><p id="c647" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很好，现在我们知道数据是静态的。因此“d”的值将为零<code class="du lp lq lr kc b">(d=0)</code>。</p><p id="dfb9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们绘制pacf图和acf图，分别求出AR和MA的阶数。</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="8416" class="kg kh hi kc b fi ki kj l kk kl">plot_acf(birth)<br/>plot_pacf(birth)<br/>plt.show()</span></pre><p id="318c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是各自输出的样子——</p><div class="je jf jg jh fd ab cb"><figure class="lu ji lv lw lx ly lz paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/63eca389e12d84af3594c9528c7e6bd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*TIaV008JIhmDyjWGH50ZhQ.png"/></div></figure><figure class="lu ji ma lw lx ly lz paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/8bbf7ac6b8ab40f05457f9429646ab58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*anHwKNl5ODX_NudJmvRPuA.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx mb di mc md translated">左图为ACF图，右图为PACF图</figcaption></figure></div><p id="095e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以观察到只有一个明显高于p值区的滞后点。</p><p id="b100" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此“p”和“q”的值是1和1。</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="c652" class="kg kh hi kc b fi ki kj l kk kl">p = 1<br/>d = 0<br/>q = 1</span></pre><p id="4166" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经得到了ARIMA所需的所有订单。让我们现在适合ARIMA。</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="3b1d" class="kg kh hi kc b fi ki kj l kk kl">url = "https://raw.githubusercontent.com/jbrownlee/Datasets/master/daily-total-female-births.csv"</span><span id="8ecb" class="kg kh hi kc b fi km kj l kk kl">s = requests.get(url).content</span><span id="d6a2" class="kg kh hi kc b fi km kj l kk kl">series = pd.read_csv(io.StringIO(s.decode('utf-8')), index_col=0, parse_dates=[0], squeeze=True, date_parser=parser)</span><span id="cc86" class="kg kh hi kc b fi km kj l kk kl">model = ARIMA(series, order=(2,0,2))</span><span id="ecf5" class="kg kh hi kc b fi km kj l kk kl">model_fit = model.fit()print(model_fit.summary())</span></pre><p id="8c39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述代码的输出将是—</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es me"><img src="../Images/f82daaf8d700c4d05eb1effb99e4ca44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*l6r5v_J7GUhUJwNq_a79lg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">输出</figcaption></figure><p id="7852" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以观察到，这里观察到的AIC和BIC值与<code class="du lp lq lr kc b">auto_arima</code>给出的最低值相似。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="2799" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这篇文章能帮助你理解如何自动和手动地将arima与python相结合。</p><p id="e610" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mf">我希望你喜欢这篇文章！不断学习，分享知识。关注我</em><a class="ae jt" href="https://github.com/vaibhawvipul" rel="noopener ugc nofollow" target="_blank"><em class="mf">github</em></a><em class="mf"/><a class="ae jt" href="https://www.linkedin.com/in/vipulvaibhaw/" rel="noopener ugc nofollow" target="_blank"><em class="mf">LinkedIn</em></a><em class="mf">或</em><a class="ae jt" href="https://twitter.com/vaibhaw_vipul" rel="noopener ugc nofollow" target="_blank"><em class="mf">Twitter</em></a><em class="mf">。</em></p></div></div>    
</body>
</html>