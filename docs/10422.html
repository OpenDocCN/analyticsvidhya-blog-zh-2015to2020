<html>
<head>
<title>Scrape reviews from TripAdvisor user profiles using python and selenium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用python和selenium从猫途鹰用户档案中抓取评论</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/scrape-reviews-from-tripadvisor-user-profiles-using-python-and-selenium-4ec82a963a8d?source=collection_archive---------8-----------------------#2020-10-18">https://medium.com/analytics-vidhya/scrape-reviews-from-tripadvisor-user-profiles-using-python-and-selenium-4ec82a963a8d?source=collection_archive---------8-----------------------#2020-10-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div class="er es hg"><img src="../Images/cfee20ed51d09445c86af73dcd7fd515.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*WLinG06gtlOZfckbx1WrkA.png"/></div></figure><div class=""/><p id="a7f6" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这里，我将向您展示如何使用python和selenium在网站上抓取数据。在这里，我收集了Tripadvisor用户在其用户资料中发布的评论。</p><p id="d4f0" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，我们需要在您的机器上安装python和selenium。我假设你知道如何使用pip。</p><p id="c961" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下载Selenium很简单。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="a794" class="jt ju hp jp b fi jv jw l jx jy">pip install selenium</span></pre><p id="9c21" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以现在我们已经准备好用python selenium编码了。首先，我们需要导入以下库，因为我们需要在实现过程中使用它们。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="45b2" class="jt ju hp jp b fi jv jw l jx jy">from selenium import webdriver<br/>import csv<br/>import requests<br/>import re<br/>import time</span></pre><p id="204d" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如你所见，我们已经导入了web驱动程序，这里我们将使用chrome web驱动程序。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="9ccf" class="jt ju hp jp b fi jv jw l jx jy">driver = webdriver.Chrome()<br/>driver.set_page_load_timeout(1)</span></pre><p id="8744" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后我们通过使用<strong class="io hq"> <em class="jz"> driver.get() </em> </strong>函数给出用chrome浏览器打开的URL</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="939c" class="jt ju hp jp b fi jv jw l jx jy">driver.get(URL)<br/>#to maximize the the tab <br/>driver.maximize_window()</span></pre><p id="aaa5" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">抓取的数据将保存到CSV文件中。因此，我们需要事先创建一个CSV文件。我们可以使用<strong class="io hq"><em class="jz">driver . find _ element _ by _ class _ name(" class _ name ")</em></strong>方法找到Tripadvisor用户的名字。然后创建一个csv文件，将其命名为username.csv。然后为创建的CSV文件编写标题。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="7dcd" class="jt ju hp jp b fi jv jw l jx jy">username = driver.find_element_by_class_name(“gf69u3Nd”).text<br/>filename1 = username+”.csv”</span><span id="704d" class="jt ju hp jp b fi ka jw l jx jy">#open csv file and add titles<br/> with open(filename1, mode=’w’) as f:<br/> writer = csv.writer(f)<br/> writer.writerow([str(‘username’),str(‘reviewTitle’),str(‘reviewDetails’),str(‘reviewDate’),str(‘reviewFor’)])</span></pre><p id="7b9f" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您可以参考用户配置文件的源代码来查找类名。下面的HTML代码是我用来查找概要文件的用户名的类名的源代码片段。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="9539" class="jt ju hp jp b fi jv jw l jx jy">&lt;span class=”_2j2RGdBF _3O8v47Pw”&gt;<br/>&lt;span class=”_3BbDvcGq”&gt;<br/>&lt;h1&gt;<br/>&lt;span class=”_2wpJPTNc _345JQp5A”&gt;Alex Fernando&lt;/span&gt;<br/>&lt;/h1&gt;<br/>&lt;/span&gt;<br/>&lt;span class=”gf69u3Nd”&gt;wwkalex-fernando&lt;/span&gt;<br/>&lt;/span&gt;</span></pre><p id="c4a9" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们有了一个以写模式打开的CSV文件，让我们在上面写点东西吧！！</p><p id="1db6" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">转到用户资料后，我们需要转到reviews选项卡来查看用户发布的评论。因此，当我们将其自动化时，我们必须执行与手动步骤相似的步骤。因此，我们使用XPath找到review选项卡，然后单击它。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="37af" class="jt ju hp jp b fi jv jw l jx jy">reveiwstab= driver.find_element_by_xpath (<br/>‘//a[<a class="ae kb" href="http://twitter.com/data" rel="noopener ugc nofollow" target="_blank">@data</a>-tab-name=”Reviews”]’<br/>)<br/>reveiwstab.click()</span></pre><h1 id="eec1" class="kc ju hp bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">如何使用XPath查找元素</h1><p id="c9e7" class="pw-post-body-paragraph im in hp io b ip kz ir is it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj hb bi translated">我从下面的网站学到了很多东西。</p><div class="hh hi ez fb hj le"><a href="https://selenium-python.readthedocs.io/locating-elements.html" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab dw"><div class="lg ab lh cl cj li"><h2 class="bd hq fi z dy lj ea eb lk ed ef ho bi translated">4.定位元素- Selenium Python绑定2文档</h2><div class="ll l"><h3 class="bd b fi z dy lj ea eb lk ed ef dx translated">在页面中定位元素有多种策略。你可以根据自己的情况选择最合适的。</h3></div><div class="lm l"><p class="bd b fp z dy lj ea eb lk ed ef dx translated">selenium-python.readthedocs.io</p></div></div></div></a></div><p id="cb30" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了获得用户发布的所有评论，我们必须单击“显示更多”按钮，并进一步向下滚动网页，直到所有评论都已加载。所以我们会调查的。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="bbdd" class="jt ju hp jp b fi jv jw l jx jy">#click the "show more" button<br/>showmorebutton = driver.find_element_by_xpath(“//span[<a class="ae kb" href="http://twitter.com/class" rel="noopener ugc nofollow" target="_blank">@class</a>=’_1ogwMK0l’]”)<br/>showmorebutton.click()<br/>time.sleep(2)</span><span id="d18e" class="jt ju hp jp b fi ka jw l jx jy">#Scroll down the web page until 200 elements found</span><span id="cb02" class="jt ju hp jp b fi ka jw l jx jy">while driver.find_elements_by_xpath (<br/>"//div[<a class="ae kb" href="http://twitter.com/style" rel="noopener ugc nofollow" target="_blank">@style</a>='position:relative']/div"):</span><span id="c2a6" class="jt ju hp jp b fi ka jw l jx jy">     driver.execute_script(<br/>     "window.scrollTo(0, document.body.scrollHeight);"<br/>      )<br/>     review = driver.find_elements_by_xpath (<br/>     "//div[<a class="ae kb" href="http://twitter.com/style" rel="noopener ugc nofollow" target="_blank">@style</a>='position:relative']/div"<br/>      )<br/>     elementCount = len(review)<br/>     if (elementCount is 200):<br/>         print ('end')<br/>         break<br/>     else:<br/>         continue</span></pre><p id="e718" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在上面的滚动方法中，它向下滚动网页，直到加载了200个元素。我想您已经知道如何使用XPath查找元素了。在滚动过程中，加载的元素将被分配给review变量。我们可以通过使用<strong class="io hq"> <em class="jz"> len() </em> </strong>函数得到元素计数。</p><figure class="jk jl jm jn fd hk er es paragraph-image"><div class="er es ln"><img src="../Images/ee5e00f4c6315f347d410d675112cf76.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/format:webp/1*pWtEkm9IPHVo9Hd-cvWouw.png"/></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">捕获由保存在审阅变量中的元素组成的源代码</figcaption></figure><p id="2521" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们已经将所有元素保存到了review变量中。我们可以通过for循环访问每个元素。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="636c" class="jt ju hp jp b fi jv jw l jx jy">for j in range(elementCount):</span><span id="1e58" class="jt ju hp jp b fi ka jw l jx jy">try: <br/>reviewTitle = review[j].find_element_by_xpath(<br/>“.//div[contains(<a class="ae kb" href="http://twitter.com/class" rel="noopener ugc nofollow" target="_blank">@class</a>, ‘_3IEJ3tAK _2K4zZcBv’)]”).text <br/>reviewDate = review[j].find_element_by_xpath(<br/>“.//div[contains(<a class="ae kb" href="http://twitter.com/class" rel="noopener ugc nofollow" target="_blank">@class</a>, ‘_3Coh9OJA’)]”).text <br/>reviewFor = review[j].find_element_by_xpath(<br/>“.//div[contains(<a class="ae kb" href="http://twitter.com/class" rel="noopener ugc nofollow" target="_blank">@class</a>, ‘_2ys8zX0p ui_link’)]”).text<br/></span></pre><p id="745f" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">到目前为止，我已经检索了评审的详细信息，如评审标题、评审日期和被评审方，但没有检索到评审。因此，如果您访问过Tripadvisor的用户档案，您就会知道整个点评不会显示在用户档案中，而是显示在被点评方的档案中。因此，我们必须访问特定被审查方的个人资料，以检索整个审查。就这么办吧！！</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="2ea5" class="jt ju hp jp b fi jv jw l jx jy">reviewsummary = review[j].find_element_by_xpath(<br/>“.//div[contains(<a class="ae kb" href="http://twitter.com/class" rel="noopener ugc nofollow" target="_blank">@class</a>, ‘_1kKLd-3D’)]/a”).get_attribute(“href”)<br/> <br/> driver.execute_script(“window.open(‘’);”)<br/> driver.switch_to.window(driver.window_handles[1])<br/> driver.get(reviewsummary)<br/> time.sleep(2)</span><span id="1864" class="jt ju hp jp b fi ka jw l jx jy">if (check_exists_by_xpath(“//span[<a class="ae kb" href="http://twitter.com/class" rel="noopener ugc nofollow" target="_blank">@class</a>=’fullText hidden’]”)):<br/> <br/>  readMore = driver.find_elements_by_xpath( “//div[<a class="ae kb" href="http://twitter.com/class" rel="noopener ugc nofollow" target="_blank">@class</a>=’reviewSelector’]/div/div[2]/div[3]/div/p/span”)<br/>  readMore[2].click()<br/>  reviewText = readMore[1].text</span><span id="ceaa" class="jt ju hp jp b fi ka jw l jx jy">elif (check_exists_by_xpath(“//span[<a class="ae kb" href="http://twitter.com/class" rel="noopener ugc nofollow" target="_blank">@class</a>=’fullText ‘]”)):<br/> <br/>  readMore= driver.find_elements_by_xpath(   “//div[<a class="ae kb" href="http://twitter.com/class" rel="noopener ugc nofollow" target="_blank">@class</a>=’reviewSelector’]/div/div[2]/div[3]/div/p/span”)<br/>  reviewText = readMore[0].text<br/> <br/>else:<br/>  reviewdetails = driver.find_elements_by_xpath( “//div[<a class="ae kb" href="http://twitter.com/class" rel="noopener ugc nofollow" target="_blank">@class</a>=’reviewSelector’]/div/div[2]/div/div/div[3]/div/p”)<br/>  reviewText = reviewdetails[0].text<br/> <br/> driver.close()<br/> driver.switch_to.window(driver.window_handles[0])<br/> </span></pre><p id="d6b6" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">根据上述代码，reviewsummary将链接到被审查方的个人资料。然后，它将在一个新窗口中打开该链接，并获得完整的评论，最后将其保存到reviewtext变量中。完成任务后，第二个窗口将被关闭，来到主窗口。然后，它将进入用户配置文件的下一个审查，并将在一个新窗口中打开一个新审查的党。这个过程将反复发生，直到200条评论都被删除。</p><p id="2c8c" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，我们得到了所需的所有数据，剩下的工作就是将这些数据写入username.csv文件。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="c693" class="jt ju hp jp b fi jv jw l jx jy">def writecsv(c1,c2,c3,c4):<br/>   with open(filename, mode=’a’,newline=’’) as f:<br/>   writer = csv.writer(f)<br/>   writer.writerow([str(c1),str(c2),str(c3),str(c4)])</span></pre><p id="fc90" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们只需调用上述方法将数据写入CSV文件。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="b9ec" class="jt ju hp jp b fi jv jw l jx jy">writecsv(reviewTitle,reviewText,reviewDate,reviewFor)</span></pre><p id="b0d4" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">原来如此。你可以在这里找到完整的代码<a class="ae kb" href="https://github.com/Sanjanaekanayake/tripadvisor-user-profiles-scrapper" rel="noopener ugc nofollow" target="_blank"><strong class="io hq"><em class="jz"/></strong></a></p></div></div>    
</body>
</html>