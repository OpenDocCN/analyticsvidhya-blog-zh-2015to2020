# ç”¨ Kafka å’Œ Docker æ¨¡æ‹Ÿé›…åŠ è¾¾çš„ BRT å®æ—¶å…¬äº¤è·Ÿè¸ª

> åŸæ–‡ï¼š<https://medium.com/analytics-vidhya/simulating-jakartas-brt-real-time-bus-tracking-using-kafka-and-docker-3f09a96234ea?source=collection_archive---------14----------------------->

> æ›´å¥½åœ°åˆ©ç”¨æŠ€æœ¯ä½¿åŸå¸‚èƒ½å¤Ÿäº’åŠ¨ï¼Œå¹¶ä¸ºå¸‚æ°‘æä¾›æ›´å¥½çš„æœåŠ¡ã€‚ä¸–ç•Œå„åœ°åŸå¸‚çš„ä¸»è¦é—®é¢˜ä¹‹ä¸€ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬é›…åŠ è¾¾ï¼Œæ˜¯æµåŠ¨æ€§ã€‚é€šè¿‡ä»¥å°½å¯èƒ½ä½çš„å»¶è¿Ÿè·å–å…¬å…±äº¤é€šæ•°æ®ï¼Œå¦‚ä½ç½®æµå’Œå¯†åº¦ï¼Œè¿™å°†æ”¹å–„å¸‚æ°‘çš„é€šå‹¤ä½“éªŒï¼Œç”šè‡³æ”¹å–„å…¬å…±äº¤é€šä¹‹é—´çš„äº’æ“ä½œæ€§ã€‚æˆ‘ä»¬ä¸ºé›…åŠ è¾¾è‡ªå·±çš„å¿«é€Ÿå…¬äº¤ç³»ç»Ÿå»ºç«‹äº†ä¸€ä¸ªå®æ—¶å¯è§†åŒ–å¹³å°ï¼ŒTransjakarta(æ„Ÿè°¢ T2 äº¤é€šéƒ¨é—¨çš„å¯å‘)!).

![](img/96e051fb2dc27577ed107c694f7232d1.png)

é›…åŠ è¾¾å…¬äº¤å®æ—¶è·Ÿè¸ªç³»ç»Ÿ

åœ¨æˆ‘ä½œä¸ºä¿¡æ¯ç³»ç»Ÿå­¦ç”Ÿçš„æœ€åä¸€å¹´ï¼Œæˆ‘å‚åŠ äº†å¤§æ•°æ®ç®¡ç†è¯¾ç¨‹ã€‚å¯¹äºæœ€ç»ˆé¡¹ç›®ï¼Œæˆ‘ä»¬é¢ä¸´çš„æŒ‘æˆ˜æ˜¯ä½¿ç”¨æˆ‘ä»¬é€‰æ‹©çš„æŠ€æœ¯æ„å»ºå¤§æ•°æ®ç”¨ä¾‹çš„ä¹¦é¢å’Œæ¦‚å¿µè¯æ˜(PoC ),æ— è®ºæ˜¯æ•°æ®å·¥ç¨‹è¿˜æ˜¯åˆ†æå’Œé¢„æµ‹èŒƒå›´ã€‚æˆ‘ä»¬çš„ 4 äººå›¢é˜Ÿ(å‘ Wikanã€Usama å’Œ Edwin è‡´æ•¬ï¼)é€‰æ‹© Apache Kafka ä½œä¸ºæˆ‘ä»¬é¡¹ç›®çš„ä¸»è¦æŠ€æœ¯ã€‚

é¦–å…ˆï¼ŒApache Kafka æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµå¹³å°ï¼Œæ„å»ºåœ¨å‘å¸ƒå’Œè®¢é˜…çš„æ¶ˆæ¯é˜Ÿåˆ—æœºåˆ¶ä¹‹ä¸Šã€‚æ ¹æ® [Apache Kafka çš„å®˜æ–¹æ–‡æ¡£](https://kafka.apache.org/intro)ï¼ŒApache Kafka æ˜¯å®Œå…¨å¯æ‰©å±•ã€åˆ†å¸ƒå¼å’Œå®¹é”™çš„ã€‚è¿™æ„å‘³ç€å®ƒé€‚ç”¨äºé«˜å®¹é‡ä½†é«˜å¯ç”¨æ€§çš„ç”¨ä¾‹ï¼Œå¦‚å®æ—¶è·Ÿè¸ªã€‚

**è¯¥é¡¹ç›®çš„æ•´ä¸ªæ¶æ„çœ‹èµ·æ¥åƒè¿™æ ·**

![](img/9d306f81f40ec4765baf724debe012a3.png)

å¯¹äºæµç³»ç»Ÿï¼Œæˆ‘ä»¬è¿è¡Œ Apache Kafka çš„ä¸¤ä¸ªä»£ç†(å®ä¾‹)æ¥è¯æ˜ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ã€‚

ç”±äºæˆ‘ä»¬æ˜¯é€šè¿‡ REST API è·å–æ•°æ®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»æ¨¡æ‹Ÿä½œä¸ºç”Ÿäº§è€…çš„â€œå¼‚æ­¥â€éƒ¨åˆ†ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä½¿ç”¨ Apache æ°”æµï¼›ä¸€ä¸ªè°ƒåº¦ç¨‹åºå¹³å°ï¼Œæ¯äº”ç§’é’Ÿè·å–ä¸€æ¬¡ç«¯ç‚¹å¹¶å‘å¸ƒæ¶ˆæ¯ã€‚æ¨¡æ‹Ÿå™¨è„šæœ¬å°†æ¶ˆæ¯åˆ†æˆä¸‰ä¸ªä¸»é¢˜æµ:

*   **å…¬äº¤è½¦çš„ç»çº¬åº¦ï¼Œç›´æ¥ä»è„šæœ¬ä¸­äº§ç”Ÿã€‚**
*   **å•æ¬¡å‡ºè¡Œå’Œå…¬äº¤ä¿¡æ¯(å‡ºè¡Œ idã€å…¬äº¤ä»£ç ã€å…¬äº¤é¢œè‰²ã€å‡ºè¡Œèµ°å»Š)å­˜å‚¨åˆ° PostgresSQLï¼Œç›‘å¬é¢„å†™æ—¥å¿—(wal)å¹¶é€šè¿‡ Debezium ç”Ÿæˆã€‚**[**Debezium**](https://debezium.io/)**æ˜¯ä¸€ä¸ª Kafka è¿æ¥å™¨ï¼Œä»¥æµæ¶ˆæ¯çš„å½¢å¼æ•è·æŒä¹…æ€§æ•°æ®åº“(CDC)ä¸­çš„æ•°æ®å˜åŒ–ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†å±•ç¤ºå¯¹æŒä¹…æ•°æ®åº“(å¦‚ PostgreSQL)è¿›è¡Œæµå¤„ç†çš„èƒ½åŠ›ã€‚**

![](img/a4204923f16f697e72b5d8c3a3db356c.png)

Apache Airflow çš„ç”¨æˆ·ç•Œé¢ã€‚ç»¿è‰²åœ†ç‚¹è¡¨ç¤ºæˆåŠŸçš„ç”Ÿäº§è€…ä½œä¸šï¼Œè€Œé»„è‰²åœ†ç‚¹è¡¨ç¤ºæ­£åœ¨è¿è¡Œçš„ä½œä¸šã€‚

åœ¨æ¶ˆè´¹è€…æ–¹é¢ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªç”¨ä¾‹ã€‚ç¬¬ä¸€ä¸ªæ˜¯å¯è§†åŒ–å’Œå®æ—¶å…¬äº¤è·Ÿéšã€‚ç¬¬äºŒä¸ªæ˜¯æ•°æ®å­˜å‚¨ï¼Œæ¨¡æ‹Ÿæ•°æ®ä»“åº“ä¸­çš„æµæ•°æ®æ‘„å–ã€‚

![](img/047e193ce0ae1a907e1ef798efaecd56.png)

è·Ÿéšå¯è§†åŒ–å‰ç«¯ä¸Šçš„å•ä¸ªæ€»çº¿ä½ç½®ã€‚å¤šäºäº† websocket æŠ€æœ¯ğŸ‘

å¯¹äºæ•°æ®å­˜å‚¨ç”¨ä¾‹ï¼Œç”±äºæ—¶é—´é™åˆ¶ï¼Œæˆ‘ä»¬åªä½¿ç”¨ SQLite3 ä½œä¸ºæ•°æ®åº“(æˆ‘ä»¬æ‰¿è®¤ï¼Œå½“æ—¶æˆ‘ä»¬æ˜¯è‡´å‘½çš„ğŸ˜…).ç„¶è€Œï¼Œç”±äºè§¦å‘å™¨æ˜¯æœ€ç»ˆçš„ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰å¤„ç†ç³»ç»Ÿä¸­æ•°æ®ä¸¢å¤±çš„å¯èƒ½æƒ…å†µã€‚å¯¹äºæœªæ¥çš„æ”¹è¿›ï¼Œå¯ä»¥é€šè¿‡åœ¨æ¶ˆè´¹è€…å’Œä»£ç†ä¹‹é—´æäº¤æ¶ˆæ¯åç§»é‡æ¥å®ç°ã€‚

![](img/26af9f1d861342878383bd4d5107a79d.png)

æˆ‘ä»¬åœ¨ SQLite æ•°æ®åº“ä¸Šè®¿é—®æ€»çº¿æ•°æ®çš„å°è¯•

æˆ‘ä»¬åœ¨ä½¿ç”¨ Django æ„å»ºæ¶ˆè´¹è€…å¹³å°æ—¶è·å¾—äº†å¾ˆå¤šä¹è¶£ï¼Œå› ä¸ºæˆ‘ä»¬åº”ç”¨äº†å¾ˆå¤šæ–°äº‹ç‰©ï¼Œå¦‚çº¿ç¨‹ã€é˜Ÿåˆ—ã€Kafka çš„ Python API å’Œ websocketã€‚å¦å¤–ï¼Œ [Mapbox GL](https://docs.mapbox.com/mapbox-gl-js/api/) çš„ Javascript åº“æ˜¯è¿™ä¸ªé¡¹ç›®çš„ MVPğŸ”¥ğŸ”¥ğŸ”¥ã€‚

![](img/02d446ce75a537c771a92425ae76526a.png)

æˆ‘ä»¬åˆ¶ä½œè¿™ä¸ªå›¾è¡¨æ˜¯ä¸ºäº†æŒ‡å¯¼æˆ‘ä»¬å¦‚ä½•æ„å»ºæ¶ˆè´¹è€…å¹³å°

åœ¨è®¡ç®—èµ„æºå’Œå¼€å‘æ—¶é—´æœ‰é™çš„æƒ…å†µä¸‹ï¼ŒDocker å¸®åŠ©æˆ‘ä»¬æ„å»ºã€æä¾›å’Œç¼–æ’å®ä¾‹ã€‚æˆ‘ä»¬å·²ç»æˆåŠŸè¿è¡Œäº† Airflowã€PostgreSQLã€Zookeeperã€å¤šä¸ª Kafka brokersã€Djangoã€Redisã€Debezium(åŠ ä¸Š Kafka Connect)ï¼Œæ²¡æœ‰ä»»ä½•éº»çƒ¦(*ï¼Œé™¤äº†æ•°å°æ—¶è®¡ç®— docker-compose è„šæœ¬å’Œç½‘ç»œé…ç½®*

## æˆ‘ä»¬å»ºè®®ä»»ä½•æ²¡æœ‰å°è¯•è¿‡ Docker çš„äººå­¦ä¹ å¹¶åœ¨ä»»ä½•å³å°†åˆ°æ¥çš„é¡¹ç›®ä¸­ä½¿ç”¨å®ƒï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦å¤šä¸ªå®ä¾‹ç¼–æ’çš„é¡¹ç›®ä¸­ï¼

![](img/075bff181af8804441ff415d50fef9e4.png)

è§£è„±æ—¶åˆ»//é¡¹ç›®æ¼”ç¤º(æ„Ÿè°¢ Adil çš„è®°å½•ï¼)

> ä»é›†æ€å¹¿ç›Šåˆ°å±•ç¤ºé¡¹ç›®ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªé¡¹ç›®ä¸­è·å¾—äº†å¾ˆå¤šä¹è¶£ã€‚å¦‚æœä½ å¯¹è¿™ä¸ªé¡¹ç›®æˆ–æ•°æ®å·¥ç¨‹æœ‰ä»»ä½•åé¦ˆæˆ–åˆ†äº«ï¼Œè¯·é€šè¿‡**è¯„è®ºåŒº**è”ç³»æˆ‘ä»¬ã€‚ç”Ÿäº§è€…çš„æºä»£ç å¯ä»¥åœ¨è¿™é‡Œçš„ä¸­æ‰¾åˆ°[ï¼Œè¿™é‡Œçš„](http://github.com/vianhazman/bus-tracking-producer)[æ˜¯æ¶ˆè´¹è€…éƒ¨åˆ†çš„](http://github.com/wikansetiaji/KafkaFinalProject_Consumer)ã€‚è®©æˆ‘ä»¬åˆä½œå­¦ä¹ å§ğŸ˜€

æ¨èé˜…è¯»å’Œå‚è€ƒèµ„æ–™:

[ã€PDF ç”µå­ä¹¦ã€‘å¡å¤«å¡:æƒå¨æŒ‡å—](https://book.huihoo.com/pdf/confluent-kafka-definitive-guide-complete.pdf)

[[Medium]é€šè¿‡ç½‘ç»œå¥—æ¥å­—å°† Kafka æ¶ˆæ¯è·¯ç”±åˆ°æµè§ˆå™¨](/@amit.dhodi/routing-kafka-messages-to-browser-over-web-socket-e4d0cf4150a9)