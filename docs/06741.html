<html>
<head>
<title>Interactive Choropleth map in Python using Folium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用leav的Python交互式Choropleth地图</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/interactive-choropleth-map-in-python-using-folium-4e1479d9e568?source=collection_archive---------7-----------------------#2020-06-01">https://medium.com/analytics-vidhya/interactive-choropleth-map-in-python-using-folium-4e1479d9e568?source=collection_archive---------7-----------------------#2020-06-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/fabee252df99b000a6517253df719efc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J5myKttx4TL_LPoCGDB-cQ.png"/></div></div></figure><div class=""/><p id="127c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最近，我在做一个地理数据分析项目，在这个项目中，我需要创建一个覆盖了度量标准的交互式等值线图。所以，我想到和你分享我的学习。</p><p id="ac48" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">那么什么是Choropleth地图呢？先来了解一下。choropleth是一种<a class="ae jo" href="https://en.wikipedia.org/wiki/Thematic_map" rel="noopener ugc nofollow" target="_blank">专题地图</a>,其中区域按照统计变量的比例进行着色或图案化，该统计变量代表每个区域内地理特征的汇总，如人口密度、平均收入。</p><p id="9430" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在花了大量时间观看在线教程以获得用于choropleth地图的最简单的包，并在各种库之间周旋之后，我最终登陆了lyum。我花了一些时间四处游玩，探索不同的选择；我终于得到了我想要的。“叶子”非常适合我的任务。</p><p id="0d37" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要创建choropleth地图，您只需要一个描述地理特征的<a class="ae jo" href="https://geojson.org/" rel="noopener ugc nofollow" target="_blank"> geoJson </a>文件和一个保存要绘制的细节的文件。</p><p id="73b8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">理论知识够了！现在是时候用实际的东西弄脏我们的手了。</p><ol class=""><li id="902d" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated"><strong class="is hu">导入库</strong></li></ol><p id="a34b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我用一个Jupyter笔记本来完成我所有的编码部分。让我们从导入所有必需的库开始。在这里，我将与<a class="ae jo" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">熊猫</a>、<a class="ae jo" href="https://geopandas.org/" rel="noopener ugc nofollow" target="_blank">地质熊猫</a>和<a class="ae jo" href="https://python-visualization.github.io/folium/" rel="noopener ugc nofollow" target="_blank">树叶</a>一起工作。</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="a377" class="kh ki ht kd b fi kj kk l kl km"><em class="kn"># importing all necessary libraries</em><br/><strong class="kd hu">import</strong> <strong class="kd hu">folium</strong><br/><strong class="kd hu">import</strong> <strong class="kd hu">geopandas</strong> <strong class="kd hu">as</strong> <strong class="kd hu">gpd</strong><br/><strong class="kd hu">import</strong> <strong class="kd hu">pandas</strong> <strong class="kd hu">as</strong> <strong class="kd hu">pd</strong></span></pre><p id="a415" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是一个简单的概述-</p><p id="e2c3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="http://python-visualization.github.io/folium/" rel="noopener ugc nofollow" target="_blank"><strong class="is hu"/></a><strong class="is hu">:</strong>它允许我们在交互式单张地图上可视化数据并使用Python处理过的数据。</p><p id="28ea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> 2。导入数据相关性</strong></p><p id="4e45" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦安装了所有的库，现在是时候将我们的数据依赖关系加载到笔记本中了。由于我在悉尼工作，我将制作一张悉尼地图，显示郊区男性和女性的平均年收入。我在新南威尔士州数据仓库找到了这个数据集，我必须说他们在公开和访问数据方面做了惊人的工作。我从这个<a class="ae jo" href="https://data.gov.au/dataset/ds-dga-91e70237-d9d1-4719-a82f-e71b811154c6/details" rel="noopener ugc nofollow" target="_blank">位置</a>下载了geoJson文件，这将有助于创建地图。</p><p id="653f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们加载两个数据集(。csv和。geoJson文件)。</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="60ce" class="kh ki ht kd b fi kj kk l kl km">#<em class="kn">Loading data dependencies using geopandas</em><br/>syd_geo = gpd.read_file("suburb-10-nsw.geojson")<br/>syd_geo.head(1)</span></pre><figure class="jy jz ka kb fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ko"><img src="../Images/7b1015ef248333c356abc207116ef584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wpSRQr_ohE3RJzT-YUkWYw.png"/></div></div></figure><p id="f936" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是我的地理数据框的样子。虽然我只对从这个数据集中获取郊区名称(nsw_loca_2)和几何图形感兴趣。这是我的代码:</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="a9a2" class="kh ki ht kd b fi kj kk l kl km"># Extracting suburb name and geometry</span><span id="34f6" class="kh ki ht kd b fi kp kk l kl km">syd_geo=syd_geo[['nsw_loca_2','geometry']]</span></pre><p id="081c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们加载我们的CSV文件，它包含了郊区男性和女性的收入信息。我们将使用这些信息来创建choropleth地图，显示每个郊区男性和女性的平均年收入。</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="44bf" class="kh ki ht kd b fi kj kk l kl km"># Loading data dependencies using pandas</span><span id="41c8" class="kh ki ht kd b fi kp kk l kl km">syd_income = pd.read_csv("Sydney_income_by_postcode.csv")</span></pre><p id="9b87" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> 3。合并并创建一个geoPandas数据框</strong></p><p id="aa3d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">太好了！由于我已经在收入文件中对所有必要的计算进行了排序，并且我们在笔记本中有两个数据框，现在是时候将我们的地理数据与收入数据集合并了。让我们来看看。</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="4d12" class="kh ki ht kd b fi kj kk l kl km"># Make a geopandas data frame</span><span id="6711" class="kh ki ht kd b fi kp kk l kl km">sydgeo_gdf=syd_geo.merge(syd_income,on="nsw_loca_2")<br/>sydgeo_gdf.head(2)</span></pre><figure class="jy jz ka kb fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kq"><img src="../Images/ff5f9582ddd6cad4a2c04a14f34fa40a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nZ7geKvqfvq_buVR5lRung.png"/></div></div></figure><p id="db6e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是我最终的地理数据框的样子。现在我们一切就绪，让我们继续创建我们的地图。</p><p id="4873" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> 4。映射</strong></p><p id="464f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当我们创建一个叶子地图，重要的是告诉地图应该集中在哪里，即地图的质心坐标。因此，我们可以通过取平均值来分配坐标，而不是基于假设分配硬编码值，如下所示:</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="65c5" class="kh ki ht kd b fi kj kk l kl km"># Assigning centroids to map</span><span id="255b" class="kh ki ht kd b fi kp kk l kl km">x_map=sydgeo_gdf.centroid.x.mean()<br/>y_map=sydgeo_gdf.centroid.y.mean()</span><span id="f5c3" class="kh ki ht kd b fi kp kk l kl km">print(x_map,y_map)</span><span id="fa46" class="kh ki ht kd b fi kp kk l kl km">151.05959339241434 -33.81584647807083</span></pre><p id="2dba" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦我们有了质心，我们现在可以创建地图对象。在这里，我将使用<a class="ae jo" href="https://python-visualization.github.io/folium/modules.html" rel="noopener ugc nofollow" target="_blank"> CartoDB </a>地图瓦片。这完全取决于你想如何创造，你也可以选择一个以上的瓷砖。</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="f442" class="kh ki ht kd b fi kj kk l kl km"># Creating a map object</span><span id="9984" class="kh ki ht kd b fi kp kk l kl km">syd_inc_map = folium.Map(location=[y_map, x_map], zoom_start=6,tiles=<strong class="kd hu">None</strong>)</span><span id="9a43" class="kh ki ht kd b fi kp kk l kl km">folium.TileLayer('CartoDB positron',name="Light Map",control=<strong class="kd hu">False</strong>).add_to(syd_inc_map)</span></pre><p id="3708" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以舞台已经搭好了。现在，我们将通过传递以下<a class="ae jo" href="https://python-visualization.github.io/folium/modules.html" rel="noopener ugc nofollow" target="_blank">参数</a>将geoJson叠加应用于地图:</p><p id="fcd6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> geo_data: </strong> geopandas使用地理几何的数据框架</p><p id="4af9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">数据:</strong> Pandas数据框，包含需要在choropleth地图上显示的值</p><p id="d8e5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">列:</strong>包含要映射的键和值的列</p><p id="1858" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> key_on: </strong>这是geoJson文件中用于绑定数据的变量。它必须以“特征”开头</p><p id="d22d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> fill_color: </strong>可以传递十六进制颜色，或者任何调色板:' BuGn '，' BuPu '，' GnBu '，' OrRd '，' PuBu '，' PuBuGn '，' PuRd '，' RdPu '，' YlGn '，' YlGnBu '，' YlOrBr '和' YlOrRd '。</p><p id="a529" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> fill_opacity: </strong>区域填充-不透明度，范围0–1。</p><p id="8538" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> threshold_scale: </strong>可以通过给定不同的阈值标度。</p><p id="cc3e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">回到我们的笔记本-</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="93a1" class="kh ki ht kd b fi kj kk l kl km"># Creating choropleth map</span><span id="8b9d" class="kh ki ht kd b fi kp kk l kl km">syd_inc_map.choropleth(geo_data=sydgeo_gdf,<br/>             name='Choropleth',         <br/>             data=sydgeo_gdf,<br/>             columns=['nsw_loca_2','Over all average taxable income of suburb'], <br/>             key_on='feature.properties.nsw_loca_2', <br/>             fill_color='YlOrRd',<br/>             fill_opacity=0.6, <br/>             line_opacity=0.8,<br/>             legend_name='Over all average taxable income of suburb', <br/>             smooth_factor=0,     <br/>             highlight=<strong class="kd hu">True</strong><br/>                 )</span></pre><p id="27ce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们预览一下我们的地图。</p><figure class="jy jz ka kb fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kr"><img src="../Images/fa4086905816f0449202752e41860c57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mPDuVFMflnpdgkH-2lKqDg.png"/></div></div></figure><p id="a211" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">漂亮？我们已经成功地创建了一个带有适当图例的choropleth地图，显示了一系列收入。但是等等，还是少了点什么！这张地图完全是静态的。在地图上添加一些信息性的标注怎么样？</p><p id="ae36" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但问题是我们不能直接给多边形添加标签，因为follo pleth不允许我们这样做。</p><p id="a6a7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是不要难过！Folium为我们提供了使用folio . features . geo JSON叠加地理要素的自由。</p><p id="d138" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用以下参数向我们的choropleth地图添加标签-</p><p id="edb2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">1)工具提示</p><p id="8f6d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2)系统功能</p><p id="2eca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用<a class="ae jo" href="https://python-visualization.github.io/folium/modules.html" rel="noopener ugc nofollow" target="_blank">follow . features . geo JSON</a>Tooltip方法，该方法允许访问我们希望在地图上显示为标签的属性。这就是我们如何获得邮政编码、郊区名称和平均年薪的方法。</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="16af" class="kh ki ht kd b fi kj kk l kl km"># Adding labels to map<br/>style_function = lambda x: {'fillColor': '#ffffff', <br/>                            'color':'#000000', <br/>                            'fillOpacity': 0.1, <br/>                            'weight': 0.1}</span><span id="4da2" class="kh ki ht kd b fi kp kk l kl km">SuburbName = folium.features.GeoJson(<br/>    sydgeo_gdf,<br/>    style_function=style_function, <br/>    control=<strong class="kd hu">False</strong>,<br/>    tooltip=folium.features.GeoJsonTooltip(<br/>        fields=['Postcode'<br/>                ,'SuburbName'<br/>                ,'SA4_NAME'<br/>                ,'  Yearly average taxable income of Female   '<br/>                ,'  Yearly average taxable income of Male   '<br/>               ],<br/>        aliases=['Postcode: '<br/>                ,'SuburbName: '<br/>                ,'SA4_NAME: '<br/>                ,'  Yearly average taxable income of Female   : '<br/>                ,'  Yearly average taxable income of Male   : ' <br/>                 ],<br/>        style=("background-color: white; color: #333333; font-family: arial; font-size: 12px; padding: 10px;") <br/>    )<br/>)<br/>syd_inc_map.add_child(SuburbName)<br/>syd_inc_map.keep_in_front(SuburbName)<br/>folium.LayerControl().add_to(syd_inc_map)</span></pre><figure class="jy jz ka kb fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ks"><img src="../Images/2c0291055fcb3a0b90e644e4410d7fbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7_XaNn4auW63wydJUvBa5g.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">标记的Choropleth图</figcaption></figure><p id="93c0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">加油..！！我们成功了..！！</p><p id="1261" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后但同样重要的是，我们需要保存地图。下面的代码将图片保存为。超文本标记语言</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="c5ab" class="kh ki ht kd b fi kj kk l kl km"># Saving map</span><span id="4e11" class="kh ki ht kd b fi kp kk l kl km">syd_inc_map.save("syd_inc_map.html")</span></pre><p id="0f9c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">原来如此。这是我们用python制作的很酷的交互式choropleth地图。代码请随意下载我的Git资源库中的<a class="ae jo" href="https://github.com/ArchaDoriya/Interactive-Choropleth-Map-in-Python-and-Folium" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本</a>。</p><p id="a2c5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你也可以在https://python-visualization.github.io/folium/modules.html<a class="ae jo" href="https://python-visualization.github.io/folium/modules.html" rel="noopener ugc nofollow" target="_blank">上了解更多关于叶子的知识</a></p><p id="fbcc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数据源:</p><p id="82fd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">收入数据集:<a class="ae jo" href="https://www.abs.gov.au/AUSSTATS/abs@.nsf/DetailsPage/6524.0.55.0022011-12%20to%202016-17?OpenDocument" rel="noopener ugc nofollow" target="_blank">澳大利亚统计局</a></p><p id="34b0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Geojson文件:<a class="ae jo" href="https://data.gov.au/dataset/ds-dga-91e70237-d9d1-4719-a82f-e71b811154c6/details" rel="noopener ugc nofollow" target="_blank">https://data . gov . au/dataset/ds-DGA-91e 70237-d9d 1-4719-a82f-e71b 811154 C6/details</a></p><p id="10cd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下次再见，带着另一个有趣的话题，继续学习吧！</p></div></div>    
</body>
</html>