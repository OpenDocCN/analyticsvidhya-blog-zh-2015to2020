<html>
<head>
<title>Sending exceptions to mail in NodeJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向NodeJS中的邮件发送异常</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/sending-exceptions-to-mail-in-nodejs-e4e3deb291c3?source=collection_archive---------4-----------------------#2020-10-19">https://medium.com/analytics-vidhya/sending-exceptions-to-mail-in-nodejs-e4e3deb291c3?source=collection_archive---------4-----------------------#2020-10-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6da4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">在编写和维护一个应用程序开发的过程中，我们会面临无数的bug和错误。在开发时解决这些相对容易。应用程序部署后，我们仍然可能会面临一些意想不到的异常。不管怎样，我们必须找到一种方法来处理这些异常。</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/463df8fe0cdc6492708ef11ad4561f87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A9JEsJDwwJDtoUo4rITfyA.jpeg"/></div></div></figure><p id="4fd6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有许多更好的方法来处理这些异常(例如Sentry)。我们将使用一个不被推荐的捷径。我们将学习如何在NodeJS的帮助下将这些异常发送到邮件。</p><p id="5098" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用一个名为nodemailer的邮件模块。Nodemailer 是NodeJS世界中最流行的模块，用于在服务器之间发送电子邮件。它使发送电子邮件变得非常容易。</p><p id="d868" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们创建两个js文件。第一个文件将被命名为<strong class="ih hj"> mail_server.js </strong>。我们将把所有配置代码放在这个文件中，以便能够发送电子邮件。另一个就叫<strong class="ih hj"> app.js </strong>。在这个文件中，我们将编写一个try catch块，并使用<strong class="ih hj"> mail_server.js </strong>作为内部模块向声明的电子邮件地址发送错误。</p><p id="a41a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">创建文件</strong> <br/>让我们从创建一个文件开始，我们将在其中定义内容。创建一个新文件，命名为<strong class="ih hj"> mail_server.js </strong>。正如我上面提到的，我们需要一个名为nodemailer的包。因此，让我们通过在终端中运行以下命令来安装该模块。<br/> <code class="du jq jr js jt b">npm install nodemailer</code></p><p id="221b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，打开<strong class="ih hj"> mail_server.js </strong>，将nodemailer包导入其中。为此，我们在NodeJS中使用require命令。<br/> <code class="du jq jr js jt b">var nodemailer = require(‘nodemailer’);</code></p><p id="4a2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是创建一个包含发送电子邮件的所有配置的函数。我创建了一个名为<strong class="ih hj"> mailfunc </strong>的函数，它传递一个名为<strong class="ih hj"> errormessage </strong>的参数。</p><pre class="jf jg jh ji fd ju jt jv jw aw jx bi"><span id="8ea9" class="jy jz hi jt b fi ka kb l kc kd">var nodemailer = require(‘nodemailer’);</span><span id="552d" class="jy jz hi jt b fi ke kb l kc kd">function mailfunc(errormessage){<br/>  var transporter = nodemailer.createTransport({<br/>    service: ‘gmail’,<br/>    auth: {<br/>      user: ‘youremail@gmail.com’,<br/>      pass: ‘yourpassword’<br/>    }<br/>  });<br/>  var mailOptions = {<br/>    from: ‘youremail@gmail.com’,<br/>    to: ‘someoneelsesmail@outlook.com’,<br/>    subject: ‘Error Message’,<br/>    text: errormessage,<br/>  };<br/>  transporter.sendMail(mailOptions, function (error, info) {<br/>    if (error) {<br/>      console.log(error);<br/>    } else {<br/>      console.log(‘Email sent: ‘ + info.response);<br/>    }<br/> });<br/>}<br/>exports.mailfunc= mailfunc;</span></pre><p id="193c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Gmail将是我们在这个项目中使用的邮件服务器。要从我们的NodeJS应用程序等第三方应用程序使用Gmail作为服务发送电子邮件，我们必须在Gmail中启用“允许不太安全的应用程序”。点击<a class="ae kf" href="https://myaccount.google.com/lesssecureapps" rel="noopener ugc nofollow" target="_blank">此处</a>启用“允许不太安全的应用程序”。</p><p id="10bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有一件事要添加到文件中，这就是导出我们在<strong class="ih hj"> mail_server.js </strong>中创建的函数。供其他程序使用。<br/> <code class="du jq jr js jt b">exports.mailfunc= mailfunc;</code></p><p id="a928" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是时候为<strong class="ih hj"> app.js </strong>编写一些代码，并导入我们刚刚导出的<strong class="ih hj"> mail_server.js </strong>供其他程序像npm模块一样使用。我们需要做的就是像对其他模块一样要求它。<br/> <code class="du jq jr js jt b">const mail = require(‘./mail_server’);</code></p><p id="eba5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们将try catch块添加到我们的<strong class="ih hj"> app.js </strong>中，看看它是否真的在工作。</p><pre class="jf jg jh ji fd ju jt jv jw aw jx bi"><span id="44f7" class="jy jz hi jt b fi ka kb l kc kd">const mail = require(‘./mail_server’);</span><span id="caaa" class="jy jz hi jt b fi ke kb l kc kd">try {<br/>  throw ‘myException’; // generates an exception<br/>}<br/>catch (e) {<br/>  /*email exception object to specified mail address*/<br/>  mail.mailfunc(e.toString());<br/>  console.log(e);<br/>}</span></pre><p id="ed7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如你所见，我们需要做的就是在catch块中调用<strong class="ih hj"> mailfunc </strong>。仅此而已！！从现在开始，我们将通过电子邮件接收我们的应用程序错误，这些错误将在生产中显示出来。</p><p id="4e1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您的点击。</p></div></div>    
</body>
</html>