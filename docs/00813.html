<html>
<head>
<title>Calibration of Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模型的校准</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/calibration-of-models-afd2d8c1646f?source=collection_archive---------5-----------------------#2019-09-10">https://medium.com/analytics-vidhya/calibration-of-models-afd2d8c1646f?source=collection_archive---------5-----------------------#2019-09-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="568e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">校准意味着将变换分类器得分转化为类成员概率。</p><p id="bb4b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">校准模型给出了每个数据点属于特定类别的概率。</p><h1 id="88be" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated"><strong class="ak">需要校准</strong></h1><p id="2609" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">执行分类时，您不仅希望预测类别标签，还希望获得各个标签的概率。这个概率给了你对预测的某种信心。</p><p id="f64f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">概率分数为更高级的性能指标打开了一扇门。例如日志丢失。</p><p id="08c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">朴素贝叶斯等模型做出不切实际的独立性假设，将概率推向0和1。</p><p id="9f1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">支持向量机、提升的树和提升的树桩往往会将预测概率推离0和1。这损害了他们预测的概率的质量，并在预测的概率中产生特征性的s形失真。</p><p id="5f61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">贷款违约预测——银行通常会设置概率阈值，如果违约概率超过30%则自动拒绝，等等。</p><p id="a562" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">广告点击预测——决定显示什么广告，出价多少。你可以使用一个基线点击率(CTR ),并将你的预测与此进行比较，看看你愿意为这个广告印象多付多少钱。</p><h1 id="af2b" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">可靠性图表(校准曲线)</h1><p id="14c7" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">可靠性图是实际概率值(y轴)相对于预测概率值(x轴)的相对频率的线图。</p><p id="1811" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">制作可靠性图表的步骤:</p><ol class=""><li id="3d1e" class="kg kh hi ih b ii ij im in iq ki iu kj iy kk jc kl km kn ko bi translated">在交叉验证数据集上使用predict_proba()获得预测分数。</li><li id="0646" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">按升序排列。</li><li id="96c2" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">将它们分组到某个“k”大小的箱中，其中k个数据集:<a class="ae li" href="https://www.kaggle.com/snap/amazon-fine-food-reviews" rel="noopener ugc nofollow" target="_blank"/></li><li id="5108" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">让我们来看看这个数据集:</li><li id="d86d" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">我们的<strong class="ih hj">目标</strong>是给定每个产品的评论，将它们分为正面或负面。</li></ol><h2 id="368f" class="ku je hi bd jf kv kw kx jj ky kz la jn iq lb lc jr iu ld le jv iy lf lg jz lh bi translated">以下是分类的步骤:</h2><p id="859a" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated"><strong class="ih hj">预处理文本</strong>(停用词移除、词干、小写转换等)。)</p><p id="77ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<strong class="ih hj"> Tfidf将文本转换成矢量。</strong></p><p id="93df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应用SVM模型。</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lj"><img src="../Images/6d836e6e50138fbd7ecab0c641c4dce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xa2tIMoHxfhpbCSKr0aqEg.png"/></div></div></figure><p id="17bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们来到我们的主要目标，即绘制<strong class="ih hj">校准图。</strong></p><p id="143a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">按升序对预测的概率得分进行排序。</p><ol class=""><li id="92d8" class="kg kh hi ih b ii ij im in iq ki iu kj iy kk jc kl km kn ko bi translated">2.将排序的概率和实际y分成多个箱(箱大小=100)</li><li id="8f01" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">3.取每个箱的实际“y”和预测概率的平均值。</li><li id="4204" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">4.在y轴上绘制实际y的平均值，在x轴上绘制预测概率的平均值。</li></ol><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lv"><img src="../Images/c3d83a29c4480a240f7a3e48c3d59cd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D5Lh5Gj-GHCFGx1hnph9yg.png"/></div></div></figure><p id="b98c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到，交叉验证数据上的校准图偏离了理想直线。</p><ol class=""><li id="7bed" class="kg kh hi ih b ii ij im in iq ki iu kj iy kk jc kl km kn ko bi translated">扭曲的形状也是s形的。</li></ol><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lv"><img src="../Images/c436680de9a641b050ca29759acdecc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g4iaOVmaf3JpWSlHhfS8eQ.png"/></div></div></figure><p id="3c84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ak">为什么绘制校准曲线</strong></p><p id="17d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">校准曲线让我们了解模型预测的概率得分。</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lv"><img src="../Images/0c4fc9913daf76c913cce591cad4e4f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bFmntUU9B60HtUFI3_Ft0A.png"/></div></div></figure><p id="9a99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这对于确定何时使用校准非常有帮助。</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lv"><img src="../Images/3e45a4b1f1090d2152cc6e50ec03da81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vQhHBfPsyhJjsH9ilIgGDw.png"/></div></div></figure><p id="b053" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上图中，我们可以清楚地看到，SVM模型没有给出正确的概率得分。</p><p id="94b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">校准图对于选择校准技术也很有用。</p><h1 id="c234" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">因为失真是s形的，所以我们使用普拉特标度。</h1><p id="0a2a" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated"><strong class="ak">校准技术</strong></p><p id="55b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通常有两种用于校准的技术。</p><p id="447a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">普拉特校准</strong></p><p id="af6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">等渗回归</strong></p><p id="b0e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ak">普拉特校准</strong></p><h1 id="2f21" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">Platt (1999)提出将SVM预测通过一个sigmoid来转换成后验概率。</h1><p id="837c" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">设一个学习方法的输出是f(x)。要获得校准的概率，请将输出通过一个sigmoid:</p><ol class=""><li id="27bf" class="kg kh hi ih b ii ij im in iq ki iu kj iy kk jc kl km kn ko bi translated">P(y = 1|f(x)) = 1/( 1 + exp(A f(x) + B))</li><li id="886c" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">梯度下降用于找到A和B，使得它们是以下问题的解:</li></ol><h1 id="bdce" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">在这里，易是实际的标签。</h1><p id="5930" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">交叉验证数据集用于训练这个s形方程，并通过最小化对数损失找到正确的A和B。</p><p id="71d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们对上面的亚马逊美食评论数据集应用普拉特校准。</p><p id="42e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以清楚地看到，普拉特缩放提高了我们的概率得分。</p><p id="aee4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">校准曲线几乎更接近直线。</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lv"><img src="../Images/a59537c4f252acf047b9776cd40e0d9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IZ-aFaUVMc8-yGHCzoSV1g.png"/></div></div></figure><p id="724c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ak">保序回归</strong></p><p id="91cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">sigmoid变换对某些学习方法很有效，但对另一些则不适用。</p><p id="0519" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Zadrozny和Elkan (2001- 2002)成功地使用了一种基于保序回归的更通用的方法来校准来自支持向量机、朴素贝叶斯、增强朴素贝叶斯和决策树的预测。</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lw"><img src="../Images/8ffdc356ecf5b1f335d6c3eeb2de0f75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1E8qwAYW64aK66TiLj020g.png"/></div></div></figure><p id="d252" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种方法更一般，因为唯一的限制是映射函数是保序的(单调递增)。</p><p id="7e24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的校准图看起来不像s形曲线，但它是单调递增的，即满足f(x_i) &lt; f(x_j) fro x_i &lt; x_j. In other words, the data in the given training set is itself monotonically increasing with respect to x.</p><h1 id="ec84" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">That is, given the predictions f(xi) from a model and the true targets yi , the basic assumption in Isotonic Regression is that: yi = m(f(xi) + b,where m is an isotonic (monotonically increasing) function.</h1><p id="0644" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">Then, given a train set (f(xi) , yi), the Isotonic Regression problem is finding the isotonic function m such that</p><p id="eab9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">We use <strong class="ih hj">成对相邻违反者(PAV) </strong>算法来寻找解决方案。</p><p id="5e8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是步骤:</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lx"><img src="../Images/e9d59b1df54baac2f5c6b79960b50760.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f-tyCQee3Lww_7EoEyJd9A.png"/></div></div></figure><p id="a632" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据交叉验证数据上的fi对训练集(fi，yi)进行排序。</p><p id="fe5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">初始化m(i，i) = yi，w(i，i) = 1</p><p id="3fe7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当存在I使得m(k，i-1) &gt; m(i，l)时</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lj"><img src="../Images/ab7d05f6ebaa3b02b41c8c7c688d8102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LbiRVl2vfV3-QqIdX93Vcw.png"/></div></div></figure><p id="63bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">I .集合w(k，l)=w(k，i-1)+w(i，l)</p><p id="4571" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">二。集合m( k，l) = (w(k，i1)m(k，i1)+w(I，l)m( i，l)/w(k，l)</p><ol class=""><li id="5a32" class="kg kh hi ih b ii ij im in iq ki iu kj iy kk jc kl km kn ko bi translated">三。将m( k，i1)和m( i，l)替换为m( k，l)</li><li id="a221" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">4.输出步进常量。函数:m(f) = m( i，j)，对于fi<f/></li><li id="e930" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">让我们对亚马逊美食评论应用等渗回归:</li></ol><p id="9ac8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ak">结论:</strong></p><p id="3309" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当预测概率呈s形失真时，普拉特标度最有效。</p><p id="c160" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">保序回归是一种更强大的校准方法，可以校正任何单调失真。但是，保序回归容易过度拟合。</p><p id="3006" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一般来说，当我们有大量交叉验证数据时，我们应该使用保序回归，否则应该进行platt标度。</p><p id="6745" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ak">参考文献:</strong></p><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es ly"><img src="../Images/69e76d8657629aa4dcb9965fc807f6b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rWr9pWhN6TOA1RPqXeUPbw.png"/></div></div></figure><h1 id="ae70" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated"><a class="ae li" href="https://machinelearningmastery.com/calibrated-classification-model-in-scikit-learn/" rel="noopener ugc nofollow" target="_blank">https://machine learning mastery . com/calibrated-classification-model-in-scikit-learn/</a></h1><p id="3290" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated"><a class="ae li" href="https://jmetzen.github.io/2015-04-14/calibration.html" rel="noopener ugc nofollow" target="_blank">https://jmetzen.github.io/2015-04-14/calibration.html</a></p><p id="efd9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae li" href="http://danielnee.com/tag/isotonic-regression/" rel="noopener ugc nofollow" target="_blank">http://danielnee.com/tag/isotonic-regression/</a></p><p id="6e3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一般来说，当我们有大量交叉验证数据时，我们应该使用保序回归，否则应该进行platt标度。</p><h1 id="a1aa" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated"><strong class="ak">参考文献:</strong></h1><ol class=""><li id="e337" class="kg kh hi ih b ii kb im kc iq lz iu ma iy mb jc kl km kn ko bi translated"><a class="ae li" href="https://machinelearningmastery.com/calibrated-classification-model-in-scikit-learn/" rel="noopener ugc nofollow" target="_blank">https://machine learning mastery . com/calibrated-class ification-model-in-sci kit-learn/</a></li><li id="e1a1" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">【https://jmetzen.github.io/2015-04-14/calibration.html T4】</li><li id="c147" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated"><a class="ae li" href="http://danielnee.com/tag/isotonic-regression/" rel="noopener ugc nofollow" target="_blank">http://danielnee.com/tag/isotonic-regression/</a></li></ol></div></div>    
</body>
</html>