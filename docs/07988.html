<html>
<head>
<title>Customized Alerts for Hadoop jobs using Yarn Rest API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Yarn Rest API为Hadoop作业定制警报</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/customized-alerts-for-hadoop-jobs-using-yarn-rest-api-d79f64df192e?source=collection_archive---------31-----------------------#2020-07-13">https://medium.com/analytics-vidhya/customized-alerts-for-hadoop-jobs-using-yarn-rest-api-d79f64df192e?source=collection_archive---------31-----------------------#2020-07-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="80c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据Cloudera，Ambari是一个完全开源的管理平台，用于配置、管理、监控和保护Apache Hadoop集群。Apache Ambari消除了操作Hadoop的猜测。但是每个用户在Ambari上工作时都会遇到的一个问题是，它不提供作业级警报。因此，在Prod Hadoop集群中工作时，一些作业可能会运行超过预期时间，或者对资源的请求超过阈值。如果有很多工作，那么找到导致资源紧缺的具体工作就变得很困难。用户可能需要仔细检查每项工作，以确定根本原因。</p><p id="8284" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个问题可以通过使用自定义代码和调用Yarn提供的rest API来解决。下面是利用yarn-rest api获取作业细节的简单代码示例。您可以进一步定制您的代码，以获得分配的资源和其他详细信息。</p><h1 id="ed73" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">先决条件</h1><ul class=""><li id="afec" class="kb kc hi ih b ii kd im ke iq kf iu kg iy kh jc ki kj kk kl bi translated">SendGrid帐户/Gmail帐户</li><li id="3c44" class="kb kc hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">Json(解析来自yarn rest-api的json响应)，用于打开和读取URL的urlib包</li><li id="69cd" class="kb kc hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">电子邮件和smtp库发送电子邮件。</li></ul><p id="8b3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是可用于获取hadoop作业警报的python代码。要了解更多信息，您可以点击<a class="ae kr" href="http://thelearnguru.com/customized-alerts-for-hadoop-jobs-using-yarn-rest-api/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">链接。</strong>T3】</a></p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="669f" class="lb je hi kx b fi lc ld l le lf">import json, urllib.request<br/>from email.mime.multipart import MIMEMultipart<br/>from email.mime.text import MIMEText<br/>import smtplib<br/><br/><br/>#Email function<br/>def send_email(test):<br/>    loginuser = "send grid user"<br/>    loginpassword="send grid password"<br/>    fromaddr="source email "<br/>    toaddr = "target email id"<br/>    msg = MIMEMultipart()<br/>    msg['From'] = fromaddr<br/>    msg['To'] = toaddr<br/>    msg['Subject'] = "Alert"<br/>    body = "The list of long running job(s) are " + test<br/>    msg.attach(MIMEText(body, 'plain'))<br/>    server = smtplib.SMTP('smtp.sendgrid.net', 587)<br/>    server.starttls()<br/>    server.login(loginuser,loginpassword)<br/>    text = msg.as_string()<br/>    server.sendmail(fromaddr, toaddr, text)<br/>    server.quit()<br/><br/>link="http://&lt;rm host name&gt;:8088/ws/v1/cluster/apps?states=RUNNING"<br/>#Mention your threshold time in milliseconds<br/>Prescribed_limit=6000 <br/>with urllib.request.urlopen(link) as response:<br/>    result=json.loads(response.read().decode('utf8'))<br/># Below to parse the json<br/>for  jobs in result['apps']['app']:<br/>    if jobs['elapsedTime']&gt;prescribed_limit:<br/>         send_email(str("\nApp Name: {}".format(jobs['name']) +" with Application id: {}".format(jobs['id'])+" running for {} hours".format(round(jobs['elapsedTime']/1000/60/60))))<br/></span></pre><p id="165b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">礼貌:Subash Konar</p></div></div>    
</body>
</html>