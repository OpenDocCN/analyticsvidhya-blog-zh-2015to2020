<html>
<head>
<title>Let’s Talk about SQL — Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们来谈谈SQL —第3部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/lets-talk-about-sql-part-3-a89010cb86f2?source=collection_archive---------22-----------------------#2020-10-09">https://medium.com/analytics-vidhya/lets-talk-about-sql-part-3-a89010cb86f2?source=collection_archive---------22-----------------------#2020-10-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="00df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基本聚合函数</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/6b8b5c604470e1f68c5c70bc9b7829f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jMhTI9vl43WQJWuNOlhPug.png"/></div></div></figure><p id="7a9e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是SQL系列文章的第三篇。</p><p id="9cb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我关于SQL的第二篇文章概述了SELECT、FROM、WHERE和JOIN。你可以在这里阅读<a class="ae jp" rel="noopener" href="/@amandaspotter/lets-talk-about-sql-part-2-f2bc7eba88eb"/>。</p><p id="76a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">概括地说，在上一篇文章中，我带您构建了一个简单的查询，该查询从两个表中选择列并过滤条件</p><p id="3639" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用SQL编写:</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="152d" class="jv jw hi jr b fi jx jy l jz ka">SELECT date, state, county, deaths, FREQUENTLY, ALWAYS<br/>FROM counties<br/>JOIN mask_use on fips = countyfp<br/>WHERE state = ‘Texas’<br/>AND deaths &gt; ‘500’<br/>AND date = ‘2020–09–07’</span></pre><p id="35b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本帖中，我们将再次使用从《纽约时报》获得的数据来探索一些基本的聚合函数。原代码可以在这里查看<a class="ae jp" href="https://github.com/aspotter99/SQL_talk" rel="noopener ugc nofollow" target="_blank">。所以，我们开始吧！</a></p><p id="9954" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你的第一个问题可能是“什么是聚合函数？”非常简单，聚合函数从一组值中返回一个值。所有聚合函数中最简单的是COUNT。</p><p id="74fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">COUNT—</strong>COUNT关键字将返回符合条件的行数。</p><p id="ed92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们回到上一篇文章中的NYT数据。如果我只想知道9月7日报告500或更多死亡病例的县的数量，该怎么办？COUNT关键字将返回这个值。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="7b35" class="jv jw hi jr b fi jx jy l jz ka">SELECT COUNT (county)<br/>FROM counties<br/>WHERE deaths &gt;= ‘500’<br/>AND date = ‘2020–09–07’</span></pre><p id="9d5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该查询返回:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kb"><img src="../Images/fba2d6d3c886d9cbf8051a5175017839.png" data-original-src="https://miro.medium.com/v2/resize:fit:456/format:webp/1*pweCwVEU4t8p5OP59CxsvQ.png"/></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">简单。郡数。</figcaption></figure><p id="073b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">9月7日，73个县报告了500或更多的死亡人数。如果我想知道9月7日报告的最小死亡人数，或者最大或平均死亡人数，也许我想知道总人数，怎么办？SQL已经内置了这些功能！</p><p id="69ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> MIN — </strong>关键字MIN将从满足您的条件的行中返回最小值。</p><p id="8bb9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> MAX — </strong>关键字MAX将从满足您的条件的行中返回最大值。</p><p id="82bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> AVG — </strong>关键字AVG将返回符合条件的行的平均值。</p><p id="2292" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> SUM — </strong>关键字SUM将返回符合条件的行中所有值的总和。</p><p id="8d04" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来看看这些是如何运作的。我将进行查询，以找到9月7日报告死亡人数为500或更多的县中的县数(计数)、报告的最低死亡人数(最小)、最高死亡人数(最大)和报告的平均死亡人数。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="9b78" class="jv jw hi jr b fi jx jy l jz ka">SELECT COUNT (county), MIN (deaths), MAX (deaths), AVG (deaths), SUM (deaths)<br/>FROM counties<br/>WHERE deaths &gt;= ‘500’<br/>AND date = ‘2020–09–07’</span></pre><p id="33d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">退货:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kg"><img src="../Images/1f2543eef1d95c6c1c00f016d4f751b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PLgOBpkrw9PyNIHhRdvbcA.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">看看所有这些汇总数据！</figcaption></figure><p id="a99d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不错！我们看到在9月7日报告死亡人数500人及以上的73个县中，单个县死亡人数最低为502人，最高为23736人，那73个县平均死亡人数为1519.685人。</p><p id="43a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们更进一步，因为虽然这很有趣，但在任何真实世界的情况下都不是那么有用。如果我想查看所有相同的数据(计数、最小值、最大值、平均值和总和)，但又想查看这些数据是如何按州分类的，该怎么办？这就是GROUP BY子句发挥作用的地方。</p><p id="ec15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">分组依据— </strong>分组依据关键字说明应如何执行聚合计算。</p><p id="5c07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用GROUP BY，我们将按州汇总我们的数据。这听起来很奇妙，但是我们所做的只是告诉SQL我们希望对具有相同状态的行执行相同的计算。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="53b6" class="jv jw hi jr b fi jx jy l jz ka">SELECT state, COUNT (county), MIN (deaths), MAX(deaths), <br/>AVG (deaths), SUM (deaths)<br/>FROM counties<br/>WHERE deaths &gt;= ‘500’<br/>AND date == ‘2020–09–07’<br/>GROUP BY state</span></pre><p id="940e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">退货:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kh"><img src="../Images/be337fdb40ae57da6c76298fc903e771.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8sC-aBGKkIGz1n3PyTg7cQ.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">使用GROUP BY，我们可以看到各个州的数据。</figcaption></figure><p id="b6f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们得到一些更有用的东西-通过这个查询，我们可以看到新泽西州有最多的县报告500或更多的死亡人数(12)，纽约州有最多的县报告死亡人数(23，736)。</p><p id="0343" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还可以使用HAVING子句使用聚合函数来过滤数据。请记住，在上一篇文章中，WHERE被用作一个过滤器，它识别字段中的特定条件，以确定是否返回一行。例如，上面的查询有一个WHERE子句来指定我们感兴趣的死亡人数(500或更多)和我们想要查看的具体日期(2020年9月7日)。这与HAVING子句有一个显著的不同—数据将在聚合函数上进行筛选。</p><p id="f456" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">HAVING—</strong>HAVING关键字对<strong class="ih hj">聚合的</strong>数据进行过滤。</p><p id="fb6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个很大的单词，让我们来看看在行动中有。我将使用与上面相同的查询，但是将添加一个HAVING子句，只返回有超过五个县报告500或更多死亡的州。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="8c80" class="jv jw hi jr b fi jx jy l jz ka">SELECT state ,COUNT (county) ,MIN (deaths) ,MAX (deaths) ,AVG (deaths)<br/>FROM counties<br/>WHERE deaths &gt;= ‘500’<br/>AND date = ‘2020–09–07’<br/>GROUP BY state<br/>HAVING COUNT (county) &gt;= 5</span></pre><p id="4a45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">退货:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ki"><img src="../Images/5cfa6ef6cc06a7c47c96a5ad9fd34181.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TQL1h6KGp4wt4sFk1Up8CQ.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">太棒了。数据仍按州分类，但现在只返回拥有5个或更多县的州。</figcaption></figure><p id="c38a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2020年9月7日，正好有6个州有5个或更多的县报告了500例或更多的死亡病例。如果我们想在这个查询中添加mask_use，就像我们在第二课中做的那样，该怎么办呢？我们可以再次使用一个连接来获取mask_use表，并且我们可以使用相同的聚合器！因此，我们将添加mask_use表中的列，以找到报告说他们总是使用口罩的人的平均百分比。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="fc0c" class="jv jw hi jr b fi jx jy l jz ka">SELECT state, COUNT (county), MIN (deaths), MAX (deaths), AVG (deaths), AVG (ALWAYS)<br/>FROM counties<br/>JOIN mask_use ON fips = countyfp<br/>WHERE deaths &gt;= ‘500’<br/>AND date = ‘2020–09–07’<br/>GROUP BY state<br/>HAVING COUNT (county) &gt;= 5</span></pre><p id="9654" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">退货:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kj"><img src="../Images/15754f1bb295367f6a57ef570a096e65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pZ3UQrVQiUik6nIgIFZr6g.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">看看我们，跨多个表聚合数据！</figcaption></figure><p id="fb1b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就像WHERE一样，您可以对不在SELECT子句中的列使用HAVING子句。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="d827" class="jv jw hi jr b fi jx jy l jz ka">SELECT state, MIN (deaths), MAX (deaths), AVG (deaths), AVG (ALWAYS)<br/>FROM counties<br/>JOIN mask_use ON fips = countyfp<br/>WHERE deaths &gt;= ‘500’<br/>AND date = ‘2020–09–07’<br/>GROUP BY state<br/>HAVING COUNT (county) &gt;= 5</span></pre><p id="2736" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">退货:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kk"><img src="../Images/a6c96ece75b608471130844eae31a3de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LDpD83HOfK9jVvyHfjadCg.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">您不必在SELECT子句中筛选项目！</figcaption></figure><p id="77ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查询仍然根据县的数量进行过滤，但是我们的结果中没有列出这些县。</p><p id="34ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了使用关键字(计数、最小值、最大值、AVG、总和)之外，您还可以使用普通数学运算符创建计算字段。例如，如果我们想看到病例与死亡的比率，我们该怎么写呢？我们将创建一个值为“死亡/病例”的新列。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="0897" class="jv jw hi jr b fi jx jy l jz ka">SELECT state, COUNT (county), MIN (deaths), MAX (deaths), <br/>AVG (deaths), SUM (cases)/SUM (deaths) as ‘case/death ratio’, <br/>AVG (ALWAYS)<br/>FROM counties<br/>JOIN mask_use ON fips = countyfp<br/>WHERE deaths &lt;= ‘500’<br/>AND date = ‘2020–09–07’<br/>GROUP BY state<br/>HAVING COUNT (county) &gt;= 5</span></pre><p id="f984" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">退货:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kl"><img src="../Images/1cfa7f647eba0080425d503c88045573.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZRBYwOS-kLi3ZPi2HWej2w.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">只需几个聚合函数，您就可以对数据集有一些真正的了解！</figcaption></figure><p id="14b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如您所见，聚合函数真的可以帮助我们了解数据集中发生了什么！现在，您已经拥有了一些基本但强大的查询工具。在下一期文章中，我们将讨论一下子查询！我希望你和我一样兴奋！</p></div></div>    
</body>
</html>