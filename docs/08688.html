<html>
<head>
<title>Best way to Impute categorical data using Groupby — Mean &amp; Mode</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 group by-Mean &amp; Mode 估算分类数据的最佳方法</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/best-way-to-impute-categorical-data-using-groupby-mean-mode-2dc5f5d4e12d?source=collection_archive---------0-----------------------#2020-08-09">https://medium.com/analytics-vidhya/best-way-to-impute-categorical-data-using-groupby-mean-mode-2dc5f5d4e12d?source=collection_archive---------0-----------------------#2020-08-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/05008acc3883ae6b33ff8c12560bd1c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d0uxEglpbzX6Lgtena5eXg.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">来源:照片由 Nate Bell 在 Unsplash 上拍摄</figcaption></figure><div class=""/><p id="f9d1" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们知道可以使用 fillna()将 nan 值替换为均值或中值。如果 NAN 数据与另一个分类列相关，该怎么办？</p><p id="1f14" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果期望的 NAN 值是一个分类值呢？</p><p id="e61a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下面是一些处理 NAN 值的有用提示。</p><p id="62ab" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你肯定是和熊猫和熊猫一起做的。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="df8d" class="kb kc hx jx b fi kd ke l kf kg"><strong class="jx hy">import</strong> <strong class="jx hy">pandas</strong> <strong class="jx hy">as</strong> <strong class="jx hy">pd</strong><br/><strong class="jx hy">import</strong> <strong class="jx hy">numpy</strong> <strong class="jx hy">as</strong> <strong class="jx hy">np</strong></span></pre><h1 id="1cbb" class="kh kc hx bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">n 组</h1><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="4c0c" class="kb kc hx jx b fi kd ke l kf kg">cl = pd.DataFrame({<br/>'team':['A','A','A','A','A','B','B','B','B','B'],                   'class'['I','I','I','I','I','I','I','II','II','II'],<br/>'value': [1, np.nan, 2, 2, 3, 1, 3, np.nan, 3,1]})</span></pre><figure class="js jt ju jv fd hk er es paragraph-image"><div class="er es le"><img src="../Images/500fee9abc65ac8c3a11efb009c821aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:406/format:webp/1*z_wyPUb5I7NvX0J6vCHigQ.png"/></div></figure><p id="0e4d" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">假设您必须填写酒类消费率数据，如果没有其他相关数据，您可以填写。</p><p id="3bbf" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">但是如果给定了这个人的年龄，那么你可以看到年龄和消费率变量的模式。因为所有人的饮酒量不会处于同一水平。</p><p id="88d0" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">另一个例子是，工资的价值可能与年龄、职称和/或教育程度有关。</p><p id="561d" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在上面的例子中，假设列 test 和 class 与 value 相关。</p><p id="e70f" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">使用 ngroup，您可以用索引来命名组。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="7654" class="kb kc hx jx b fi kd ke l kf kg">cl['idx'] = cl.groupby(['team','class']).ngroup()</span></pre><figure class="js jt ju jv fd hk er es paragraph-image"><div class="er es lf"><img src="../Images/57340d9cac7273f5f4c7c6ecc8916bd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:494/format:webp/1*czxkkcPvxy7xOllFWj8W9w.png"/></div></figure><p id="bbac" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在你可以清楚地了解这些组了，我们用索引给这些组命名。如果您想在如此复杂的组中处理数据，这将很有帮助。例如具有 10 列复杂组的 fillna。</p><h1 id="29e9" class="kh kc hx bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">按两列分组，用平均值填充</h1><p id="18bb" class="pw-post-body-paragraph iu iv hx iw b ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr hb bi translated">让我们看看下面的数据:</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="74b8" class="kb kc hx jx b fi kd ke l kf kg">cl = pd.DataFrame({<br/>'team': 'A','A','A','A','A','B','B','B','B','B'],<br/>'class':['I','I','I','II','II','I','I','II','II','II'],<br/>'value': [1, np.nan, 2, 2, 3, 1, 3, np.nan, 3,1]})</span></pre><figure class="js jt ju jv fd hk er es paragraph-image"><div class="er es le"><img src="../Images/500fee9abc65ac8c3a11efb009c821aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:406/format:webp/1*z_wyPUb5I7NvX0J6vCHigQ.png"/></div></figure><p id="707f" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如前所述，现在我们要用团队和班级的平均值填充 nan。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="a2a9" class="kb kc hx jx b fi kd ke l kf kg">cl['value'] = cl.groupby(['team','class'], sort=False)['value'].apply(lambda x: x.fillna(x.mean()))</span></pre><figure class="js jt ju jv fd hk er es paragraph-image"><div class="er es ll"><img src="../Images/3d69d1bd0c71f2ee4f94c45221651b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:424/format:webp/1*E_iDmI1Qf3BNcAqZDkzUVw.png"/></div></figure><p id="3765" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">A 队和 I 级，1.0 和 2.0 的平均值是 1.5。类似地，其余的组。您可以看到这两个空值是用不同的方法估算的(黄色阴影值)。即每组的平均值。</p><h1 id="bcc0" class="kh kc hx bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">按两列分组，并用 mode 填充</h1><p id="cc0d" class="pw-post-body-paragraph iu iv hx iw b ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr hb bi translated">与均值和中值一样，模式与 fillna 不兼容。</p><p id="daf6" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Mean &amp; meadian 返回和工作方式相同，都返回一个系列。但是 mode 返回一个数据帧。</p><p id="3973" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要使用 fillna 模式，我们需要做一点小小的改变。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="df6f" class="kb kc hx jx b fi kd ke l kf kg">df = pd.DataFrame({'A': [1, 2, 1, 2, 1, 2, 3]})<br/><br/>a = df.mode()<br/>print(a.iloc[0])<br/>print(type(a))</span></pre><p id="1be7" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">A 1 <br/> Name: 0，dtype:int 64<br/>&lt;class ' pandas . core . frame . data frame '&gt;</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="f13f" class="kb kc hx jx b fi kd ke l kf kg">df = pd.DataFrame({'A': [1, 2, 1, 2, 1, 2, 3]})<br/><br/>a = df.mean()<br/>print(a)<br/>print(type(a))</span></pre><p id="e549" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">a 1.714286<br/>dtype:float 64<br/>&lt;class ' pandas . core . series . series '&gt;</p><p id="f36d" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在让我们用模式估算下述数据的 NAN 值。</p><figure class="js jt ju jv fd hk er es paragraph-image"><div class="er es le"><img src="../Images/500fee9abc65ac8c3a11efb009c821aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:406/format:webp/1*z_wyPUb5I7NvX0J6vCHigQ.png"/></div></figure><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="28e2" class="kb kc hx jx b fi kd ke l kf kg">cl['value'] = cl.groupby(['team','class'], sort=False)['value'].apply(lambda x: x.fillna(<strong class="jx hy">x.mode().iloc[0]</strong>))</span></pre><figure class="js jt ju jv fd hk er es paragraph-image"><div class="er es lm"><img src="../Images/1f79b47a76c976019292be314d4f6813.png" data-original-src="https://miro.medium.com/v2/resize:fit:428/format:webp/1*rai7eqt29CbcBhrYhV2qig.png"/></div></figure><p id="895a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">1，2，2，3 的模式是 2。</p><h1 id="ea95" class="kh kc hx bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">按 1 列和 fillna 分组</h1><p id="39a7" class="pw-post-body-paragraph iu iv hx iw b ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr hb bi translated">数据:</p><figure class="js jt ju jv fd hk er es paragraph-image"><div class="er es ln"><img src="../Images/29c62b58aba824ce22d633ddde732df8.png" data-original-src="https://miro.medium.com/v2/resize:fit:284/format:webp/1*nQcNt_U9nemAcHsvuh7wYQ.png"/></div></figure><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="71dd" class="kb kc hx jx b fi kd ke l kf kg">cl1['value'] = cl1.groupby('sec').transform(lambda x: x.fillna(x.mean()))</span></pre><p id="1dcf" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">以下语句也适用。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="caa7" class="kb kc hx jx b fi kd ke l kf kg">cl1['value'] = cl1.groupby('sec')['value'].transform(lambda x: x.fillna(x.mean()))</span></pre><p id="9963" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">结果:</p><figure class="js jt ju jv fd hk er es paragraph-image"><div class="er es lo"><img src="../Images/b7af847da319e748a9dc4cf62f206eed.png" data-original-src="https://miro.medium.com/v2/resize:fit:278/format:webp/1*DkbSCQqJPO-5feJ8NU4xIQ.png"/></div></figure><h1 id="4e6c" class="kh kc hx bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">结论:</h1><p id="e1f6" class="pw-post-body-paragraph iu iv hx iw b ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr hb bi translated">在这篇文章中，我们学习了更好的数据分组和填充方法。</p><p id="5c5b" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">希望你对实践我们现在所学的东西感到兴奋。</p><p id="8950" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们将看到 Python 中的一个新技巧。谢谢大家！👍</p><p id="403b" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">喜欢支持？只需点击拍手图标👏想吃多少就吃多少。</p><p id="1a87" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">编程快乐！🎈</p></div></div>    
</body>
</html>