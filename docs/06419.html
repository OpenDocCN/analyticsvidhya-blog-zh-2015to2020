<html>
<head>
<title>Traffic Count: Location Analytics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">流量计数:位置分析</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/traffic-count-location-analytics-d7a4fd71cc2f?source=collection_archive---------23-----------------------#2020-05-21">https://medium.com/analytics-vidhya/traffic-count-location-analytics-d7a4fd71cc2f?source=collection_archive---------23-----------------------#2020-05-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/467e5a1ec688328c71d0e92364bc6a4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Hfn_PN5QRA-bSWUx"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">桑吉夫·库甘在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure></div><div class="ab cl iv iw gp ix" role="separator"><span class="iy bw bk iz ja jb"/><span class="iy bw bk iz ja jb"/><span class="iy bw bk iz ja"/></div><div class="hb hc hd he hf"><blockquote class="jc jd je"><p id="99a3" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">你可以拥有没有信息的数据，但你不能拥有没有数据的信息</p><p id="2429" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">丹尼尔·凯斯·莫兰</p></blockquote><p id="6a7b" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">在本文中，让我们讨论如何使用传感器记录的数据，或商店的客户发票数据，或任何其他包含特定位置或地点的时间和人员等信息的数据集。</p><p id="d23c" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">并将这些原始数据转化为可操作的见解，以解决特定的业务问题。</p><h1 id="0d48" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">用例</h1><ul class=""><li id="c411" class="lf lg hi ji b jj lh jn li ke lj kf lk kg ll kd lm ln lo lp bi translated">预测繁忙道路的交通量</li><li id="6e4a" class="lf lg hi ji b jj lq jn lr ke ls kf lt kg lu kd lm ln lo lp bi translated">预测购物中心的高峰时间和繁忙时段</li><li id="1ebd" class="lf lg hi ji b jj lq jn lr ke ls kf lt kg lu kd lm ln lo lp bi translated">预测给定日期和时间机场的人数等。</li></ul><p id="dbee" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">我们将在这里构建的这个通用模型可以解决许多用例。</p><p id="de04" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">人数计数或交通计数可能取决于各种因素，例如一天中的时间或一周中的某一天、天气特征、附近事件等。</p><p id="d6e0" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">我们将带着UCI机器学习库的<a class="ae iu" href="https://archive.ics.uci.edu/ml/datasets/Metro+Interstate+Traffic+Volume" rel="noopener ugc nofollow" target="_blank">州际交通流量数据集。</a></p><p id="bb84" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">数据集包含MN DoT ATR站301的94号州际公路西行交通量的每小时信息及其天气特征，如温度、雨等。</p><p id="f68a" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated"><strong class="ji hj"> <em class="jh">那么，我们来码吧！</em>T9】</strong></p><p id="3e3f" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated"><strong class="ji hj">注意:</strong>在开始编写代码之前，了解您的数据集非常重要。</p><ol class=""><li id="8ea1" class="lf lg hi ji b jj jk jn jo ke lv kf lw kg lx kd ly ln lo lp bi translated"><strong class="ji hj">将数据集提取到数据帧中</strong></li></ol><p id="af74" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">使用pandas，将csv文件提取到数据帧中。文件格式可能不总是CSV，因此它也可以获取JSON、XML和其他文件格式。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="ae33" class="mi ki hi me b fi mj mk l ml mm">import pandas a pd<br/>df = pd.read_csv('Interstate_traffic.csv', sep=",")</span></pre><p id="5d90" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">2.<strong class="ji hj">执行数据转换</strong></p><p id="e276" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">您正在处理的数据可能不是可以直接分析的形式，因此，我们需要转换数据。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="a896" class="mi ki hi me b fi mj mk l ml mm">df.date_time = pd.to_datetime(.date_time)<br/>df['Day'] = df['date_time'].dt.dayofweek.replace([0,1,2,3,4,5,6],['monday','tuesday','wednesday','thursday','friday','saturday','sunday'])<br/>df['Hour'] = train_df['date_time'].dt.hour</span></pre><p id="8bd4" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">这里我们从时间戳中提取日期和时间。</p><p id="b05f" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">将分类数据转换成数字。您可以对其进行一次性编码，或者使用单词嵌入来获得更好的结果。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="423d" class="mi ki hi me b fi mj mk l ml mm">df['weather_type'] = pd.Categorical(df['weather_type'])<br/>df['weather_type'] = df.weather_type.cat.codes</span></pre><p id="e7d6" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">可视化相关矩阵，以确定可能影响交通量/交通量的不同因素之间的相关性。</p><figure class="lz ma mb mc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/3adbe56ace17b432bd85eb92986420b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PmtXAMGB6UfhUnd3N6kmuA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">显示其他属性如何影响交通量/计数的相关矩阵</figcaption></figure><figure class="lz ma mb mc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/b771ea2c14dfa079fc30e79f265ad201.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZgnIWsLUAYGxTevNwzXMgg.png"/></div></div></figure><p id="b227" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">正如我们所观察到的，从上面的图中可以看出，与周末相比，交通流量在工作日有一个明显的峰值。</p><p id="8466" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">这些高峰时间被认为是办公时间，因此会影响交通量。</p><p id="e723" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">3.<strong class="ji hj">数据缩放</strong></p><p id="04b6" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">我们在属性的数量上有很多变化。例如，交通流量可能高达5000，温度可能在280–300之间。</p><p id="21cf" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">为了解决这个问题，我们将使用最小最大缩放算法来缩放数据。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="e114" class="mi ki hi me b fi mj mk l ml mm"><strong class="me hj">def</strong> scale(df):<br/>    <strong class="me hj">return</strong> (df - df.min())/(df.max()-df.min())<br/><br/><strong class="me hj">for</strong> col <strong class="me hj">in</strong> df[['air_pollution_index','humidity','wind_speed','wind_direction','visibility_in_miles','dew_point','temperature','rain_p_h','clouds_all','weather_type','Hour','traffic_volume','Day']]:<br/>    df[col] = scale(df[col])</span></pre><p id="454d" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">应用最小最大缩放后，我们的数据将只在0-1范围内。</p><p id="d2a0" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">4.<strong class="ji hj">将数据分为训练和测试。</strong></p><p id="03e0" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">为模型分配输入和输出要素。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="9a33" class="mi ki hi me b fi mj mk l ml mm">x = df.loc[:,df.columns != 'traffic_volume'].values<br/>y = train_df['traffic_volume'].values</span></pre><p id="8b44" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">我们将对我们的数据执行70/30分割，分别用于训练和测试。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="b270" class="mi ki hi me b fi mj mk l ml mm">x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.3)</span></pre><p id="231a" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">5.<strong class="ji hj">创建和训练模型。</strong></p><p id="f1e0" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">我们将使用TensorFlow Keras高级API创建一个神经网络。</p><p id="ad55" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">我们将使用顺序API来构建这个模型。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="923f" class="mi ki hi me b fi mj mk l ml mm">model = tf.keras.Sequential() <br/>model.add(tf.keras.layers.Dense(13, input_dim = 13, activation = 'relu'))<br/>model.add(tf.keras.layers.Dense(26 , activation = 'relu'))<br/>model.add(tf.keras.layers.Dense(12 , activation = 'relu'))<br/>model.add(tf.keras.layers.Dense(5 , activation = 'relu'))<br/>model.add(tf.keras.layers.Dense(1, activation='linear'))<br/>model.summary()</span></pre><p id="32e8" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">我们已经建立了一个模型，包括4个隐藏层和1个具有ReLU激活的输入层。输出层包含1个具有线性激活的神经元，因为它是一个回归模型。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="fce3" class="mi ki hi me b fi mj mk l ml mm">model.compile(loss='mse', optimizer='adam', metrics=['mse','mae'])</span></pre><p id="218f" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">编译模型并为其定义损失度量。</p><p id="b0d1" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">这是回归问题中最常用的两种损失度量。</p><p id="55cc" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated"><strong class="ji hj">平均绝对误差(mae): </strong>实际值与预测值之差。</p><p id="9ee1" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated"><strong class="ji hj">均方误差(mse): </strong>是实际值和预测值的平方之差。</p><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="185e" class="mi ki hi me b fi mj mk l ml mm">history = model.fit(x_train, y_train, epochs=25, batch_size=15, verbose=1, validation_split=0.2)</span></pre><p id="c10c" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">为模型训练定义超参数，并使用model.fit()方法启动训练。</p><h2 id="f5ce" class="mi ki hi bd kj mp mq mr kn ms mt mu kr ke mv mw kv kf mx my kz kg mz na ld nb bi translated"><strong class="ak">比较培训和验证之间的损失曲线。</strong></h2><figure class="lz ma mb mc fd ij er es paragraph-image"><div class="er es nc"><img src="../Images/4dad6729acef6111c133685a6579c44e.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*20gQ6s8h784UGYFLoG8_Rg.png"/></div></figure><pre class="lz ma mb mc fd md me mf mg aw mh bi"><span id="a80a" class="mi ki hi me b fi mj mk l ml mm">print(history.history.keys())<br/>plt.plot(history.history['loss'])<br/>plt.plot(history.history['val_loss'])<br/>plt.title('model loss')<br/>plt.ylabel('loss')<br/>plt.xlabel('epoch')<br/>plt.legend(['train', 'validation'], loc='upper left')<br/>plt.show()</span></pre><p id="e94e" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">此外，您可以使用model.predict()方法来预测测试数据的流量，并将它们与实际值进行比较。</p></div><div class="ab cl iv iw gp ix" role="separator"><span class="iy bw bk iz ja jb"/><span class="iy bw bk iz ja jb"/><span class="iy bw bk iz ja"/></div><div class="hb hc hd he hf"><p id="7a3a" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">这是我的第一篇文章，我希望你喜欢阅读它！</p><p id="3257" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">随意分享吧。</p><p id="9f3b" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated">欢迎反馈和建议！</p><p id="c48a" class="pw-post-body-paragraph jf jg hi ji b jj jk jl jm jn jo jp jq ke js jt ju kf jw jx jy kg ka kb kc kd hb bi translated"><strong class="ji hj"> <em class="jh">谢谢</em> </strong></p></div></div>    
</body>
</html>