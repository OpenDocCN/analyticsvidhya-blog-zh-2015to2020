<html>
<head>
<title>Scraping Web Apps using Direct HTTP Request</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用直接HTTP请求抓取Web应用程序</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/scraping-web-apps-using-direct-http-request-f5c02a2874fe?source=collection_archive---------3-----------------------#2020-07-23">https://medium.com/analytics-vidhya/scraping-web-apps-using-direct-http-request-f5c02a2874fe?source=collection_archive---------3-----------------------#2020-07-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8de80445be1dc1200ed1a9eb33b97186.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kU-MPF6tlGTSvt5J"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">卢卡斯·布拉塞克在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="e506" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你有没有尝试过抓取一个网站，但从结果中没有得到任何数据？网站越来越动态化，并且呈现在客户端，并且通常情况下，抓取HTML DOM会导致空响应，因为数据是在接收到HTML之后加载的。</p><p id="de81" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">开始大数据研究之前的第一步，尤其是在网络平台和应用上，是收集数据。刮痧已经成为一种常用的数据收集方法，可用的刮痧方式有很多。最常见也是最常被教授的一种方法是使用自动化功能遍历HTML DOM，如Chrome扩展或通过puppeteer或nightmare编写无头浏览器脚本。</p><p id="c5f4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">还有一种不经常讨论但更新颖的方法，那就是通过向支持应用程序或网站的HTTP端点发出直接HTTP请求来进行抓取。这种技术实际上是web开发中的一种常见做法，我看到了将这种技术重新用于数据抓取的潜力。还有，这恰好是我最喜欢的刮痧方式。</p><p id="31fe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们进入抓取方法之前，有必要讨论一下当今网站和应用程序通常是如何构建的，以及服务器端和客户端渲染的区别。</p><h1 id="260e" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">术语</strong></h1><p id="f42e" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">这里有一些贯穿整篇文章的术语，可以帮助那些不太熟悉web开发的人加快速度。</p><ol class=""><li id="f825" class="kw kx hi ix b iy iz jc jd jg ky jk kz jo la js lb lc ld le bi translated">服务器端呈现—是应用程序通过在服务器上显示网页而不是在浏览器中呈现网页来做出贡献的能力。</li><li id="9011" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">客户端呈现—一种使用JavaScript在浏览器中呈现内容的技术。</li><li id="9a68" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">单页应用程序—是一种web应用程序或网站，它通过使用来自web服务器的新数据动态重写当前网页来与web浏览器进行交互，而不是使用浏览器加载整个新页面的默认方法。</li><li id="5e3c" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">HTTP端点—端点是公开数据、HTML文件或活动服务器页面的连接点。</li><li id="2d6c" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">HTML DOM(文档对象模型)—文档对象模型(DOM)是用于HTML和XML文档的编程API。它定义了文档的逻辑结构以及访问和操作文档的方式。</li><li id="2500" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">JSON (Javascript对象符号)— JSON (JavaScript对象符号)是一种轻量级数据交换格式。对人类来说，读和写很容易。机器很容易解析生成。</li></ol><h1 id="820d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">服务器端vs客户端渲染</strong></h1><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/6d6c94f9c8f92df15bcbb8d110a54451.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CQY6P6anDnx17xwov0A-OA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">说明服务器端和客户端呈现之间的差异。在PowerPoint中专业绘制:)</figcaption></figure><p id="dda5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">网站不再像以前那样简单。许多采用了应用程序的形式和功能，给用户带来了更丰富、更生动的体验。随着网站创建的发展，有许多工具和框架，如React.js和Vue.js，从根本上改变了网站的创建方式。Airbnb、Instagram和脸书等热门服务都建立在这些范式之上。随着这些变化，我们抓取和访问数据的方式可能也必须改变。</p><p id="446b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">服务器端渲染</strong>是网站通常的服务方式。当您打开一个URL链接时，您的浏览器会创建一个向服务器请求网站的请求。服务器通过返回网站的完整HTML标记做出响应，这些标记稍后会出现在浏览器上。大多数抓取方法都是为服务器端渲染网站而设计的。例如，使用Chrome扩展或无头浏览器鼓励您识别HTML元素并遍历它们来收集数据。</p><p id="5675" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">客户端渲染</strong>是一种越来越流行的服务网站的方式，尤其是那些拥有动态内容的网站。单页应用(SPA)指的是利用客户端渲染来提供动态内容的网站。通过SPA和客户端呈现，当我们的浏览器访问一个URL链接时，服务器返回的和我们最初收到的是一个没有内容的空壳HTML文件。然而，HTML中包含了一个Javascript文件，它将为空的HTML添加内容。这个合并和填充过程是通过在页面加载后对服务器进行额外的数据访问来完成的。</p><p id="16a7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是为什么从SPA和客户端渲染的网站抓取数据具有挑战性，因为大多数技术将向用户提供空数据。我们把网站和它的内容看作一个整体，因为我们的浏览器做了额外的请求和填充数据的工作。然而，我们的抓取工具很可能只能看到空的HTML外壳，而不能像浏览器那样发出额外的请求。即使我们调整scraper来发出额外的请求，抓取过程也会变得很慢。这也是为什么SPA和客户端渲染网站有SEO问题，因为爬虫也很难加载这些网站。</p><h1 id="55ae" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">直接HTTP请求</strong></h1><p id="bc84" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">给定客户端渲染网站的行为，直接HTTP请求的方法变得有趣。<strong class="ix hj">如果我们知道网站用来请求数据并直接发出请求的端点会怎样？</strong>这种方法利用了客户端呈现的站点向其服务器发出附加请求的过程。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/d0c676f9e4ccd45a91a904cfbbaeb62e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vH9HBXTd-4g3L1Pecr9HQg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">我们正在进入客户端渲染过程中的一个步骤，以执行直接HTTP请求</figcaption></figure><p id="136e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这种方法很有意思，并且有如下好处:</p><ol class=""><li id="6153" class="kw kx hi ix b iy iz jc jd jg ky jk kz jo la js lb lc ld le bi translated">抓取变得更快，因为我们直接进行HTTP请求，从来不需要加载整个网页。</li><li id="1785" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">我们收到的数据更丰富，因为服务器提供的数据往往比网站显示的更多。</li><li id="3e36" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">这就像发出一个HTTP请求一样简单。事实上，在识别并获得链接之后，我们可以在一个新的选项卡中打开该链接，并以裸露的形式看到结果(通常是JSON形式)。</li><li id="1a34" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">适用于客户端渲染的网站、SPA或包含无限加载的网站，尤其是那些严重依赖REST API或GraphQL的网站</li><li id="8ca7" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">我们从HTTP响应中获得结构化数据，可以立即下载到文件中。与将选择器匹配和映射到每个HTML DOM相比，这节省了大量时间(我个人讨厌这个过程)。</li></ol><p id="7964" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">它有自己强硬的警告:</p><ol class=""><li id="4b24" class="kw kx hi ix b iy iz jc jd jg ky jk kz jo la js lb lc ld le bi translated">我们必须确保我们试图抓取的网站实际上使用了填充数据的客户端渲染方法。</li><li id="2e22" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">识别HTTP端点需要一些尝试和错误，而且通常这不是一个通用的解决方案，因为每个网站都有不同的实现。</li><li id="1116" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">在发出HTTP请求时需要一些变通方法来检查保护措施，如跨源资源共享、同源策略、Cookies和身份验证令牌。</li><li id="2ddd" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">当网站更新其端点时，我们也需要更新我们的scraper算法和可访问的端点。</li></ol><p id="92a3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，我们将发出这些HTTP请求，就好像我们是客户端/网站本身一样，就像我们对自己的API应用程序所做的那样。这个方法其实比听起来容易。</p><h1 id="10d5" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">使用直接HTTP请求抓取Airbnb</strong></h1><p id="ac7c" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">现在我们已经了解了这种方法及其先决条件，让我们尝试在Airbnb上应用这种方法，看看我们可以获得什么数据。</p><p id="2781" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本练习的目的是根据我们在Airbnb中的搜索查询，从一个位置获取Airbnb房源数据。</p><p id="0766" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第一步是研究和识别HTTP端点。所以让我们首先打开Airbnb.com</p><p id="0ea7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，我们将在Airbnb上搜索一个位置。在这个练习中，入住和退房的日期可以是随机的，为了简单起见，我们就不使用过滤器了。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/d790bae03464dae9174e852fd43a690c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BGkOY_e36e-AJ4VtglH_FQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">在Airbnb上搜索…</figcaption></figure><p id="6cb6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们已经加载了我们的首选位置的Airbnb页面，让我们打开浏览器的开发工具。开发者工具是一套可以在你的浏览器上调试和检查网站的工具。本文将基于Chrome开发工具，但类似的过程也适用于Firefox和您喜欢的其他浏览器。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/9172f931973ba9cbb9e3810dbf654fb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IPhCl52MZlF-lpUzV6vQXQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">从菜单栏访问开发人员工具或使用快捷方式</figcaption></figure><p id="e76d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在Chrome开发者工具上，我们需要导航到网络选项卡。“网络”选项卡可以记录所有传入和传出的网络连接。这是我们标识HTTP端点的地方。如您所见，在页面加载之后，站点会发出和接收许多额外的请求。如果您看不到任何内容，您可能需要在打开开发者工具网络选项卡后刷新页面。其中一个请求包含Airbnb房源的数据集。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/b1c1f4956fa2f79d6236aaf5f9acf2f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0Z6XJj4H8pAM5sx3"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">导航到开发人员工具上的网络选项卡</figcaption></figure><p id="9c54" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">找到端点的简单方法是使用网络工具中的搜索功能。简单来说，尝试搜索Airbnb房产的标题。将出现包含列表数据的端点；这些数据通常以JSON格式返回。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/e73df6a128d05bd5adcef90029992bb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fN1rBQdDYWuEV72C"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">单击搜索结果会直接将我们带到我们需要的HTTP端点的传入请求</figcaption></figure><p id="019a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过点击结果，我们可以研究对HTTP端点的请求是如何完成的。我们可以看到JSON的内容、浏览器向这个HTTP端点发出的请求的结构以及端点返回的响应。请注意Request Headers部分下面的信息，因为我们稍后将需要它来发出请求。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/2efb136077f50483b9af918c09518fd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Gw-75SKqFHmA1U-r"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">请记下这些信息！</figcaption></figure><p id="a0e7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">单击Preview选项卡将允许我们使用更友好的用户界面来研究JSON响应。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/9340daca9c6efe6c325338b90a1df729.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LxxWBb4tnusKTolU"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">更容易阅读，而且可以点击</figcaption></figure><p id="39ee" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">需要注意的一点是，HTTP端点的响应为我们提供了关于Airbnb属性和搜索查询的更丰富的结构化数据。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/777147ef70e073e2367e1f679f5f6775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bLnGyvinaMWqYLePY7D0lQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">有些信息没有显示在网页上</figcaption></figure><p id="36fc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">基于这些信息，我们还可以研究Airbnb HTTP端点的模式和结构。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/1919bd722452f995efcc4073df9fef23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*r4pmX6D0uNl20Ve4"/></div></div></figure><p id="8fb8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们复制粘贴请求URL并研究端点的结构。复制请求URL为我们提供了如下所示的URL，但是很难阅读。</p><pre class="ll lm ln lo fd lx ly lz ma aw mb bi"><span id="a4a2" class="mc ju hi ly b fi md me l mf mg"><a class="ae iu" href="https://www.airbnb.com/api/v3/ExploreSearch?locale=en&amp;operationName=ExploreSearch&amp;currency=USD&amp;variables=%7B%22request%22%3A%7B%22metadataOnly%22%3Afalse%2C%22version%22%3A%221.7.6%22%2C%22itemsPerGrid%22%3A20%2C%22tabId%22%3A%22home_tab%22%2C%22checkin%22%3A%222020-07-23%22%2C%22refinementPaths%22%3A%5B%22%2Fhomes%22%5D%2C%22source%22%3A%22structured_search_input_header%22%2C%22checkout%22%3A%222020-07-31%22%2C%22searchType%22%3A%22pagination%22%2C%22neLat%22%3A%22-6.023133395497556%22%2C%22neLng%22%3A%22107.13100680175785%22%2C%22swLat%22%3A%22-6.303030653754502%22%2C%22swLng%22%3A%22106.47045382324222%22%2C%22searchByMap%22%3Atrue%2C%22federatedSearchSessionId%22%3A%2296c400d9-838a-45af-a625-426029e1fbe9%22%2C%22placeId%22%3A%22ChIJnUvjRenzaS4RILjULejFAAE%22%2C%22sectionOffset%22%3A2%2C%22itemsOffset%22%3A20%2C%22query%22%3A%22Jakarta%2C%20Indonesia%22%2C%22cdnCacheSafe%22%3Afalse%2C%22simpleSearchTreatment%22%3A%22simple_search_only%22%2C%22treatmentFlags%22%3A%5B%22stays_flexible_dates%22%2C%22simple_search_1_1%22%5D%2C%22screenSize%22%3A%22large%22%7D%7D&amp;extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%228c9b30efefd6746ad4471b4c7a38f65707d3bf6c4c0cee8cc1e45f829b734736%22%7D%7D" rel="noopener ugc nofollow" target="_blank">https://www.airbnb.com/api/v3/ExploreSearch?locale=en&amp;operationName=ExploreSearch&amp;currency=USD&amp;variables=%7B%22request%22%3A%7B%22metadataOnly%22%3Afalse%2C%22version%22%3A%221.7.6%22%2C%22itemsPerGrid%22%3A20%2C%22tabId%22%3A%22home_tab%22%2C%22checkin%22%3A%222020-07-23%22%2C%22refinementPaths%22%3A%5B%22%2Fhomes%22%5D%2C%22source%22%3A%22structured_search_input_header%22%2C%22checkout%22%3A%222020-07-31%22%2C%22searchType%22%3A%22pagination%22%2C%22neLat%22%3A%22-6.023133395497556%22%2C%22neLng%22%3A%22107.13100680175785%22%2C%22swLat%22%3A%22-6.303030653754502%22%2C%22swLng%22%3A%22106.47045382324222%22%2C%22searchByMap%22%3Atrue%2C%22federatedSearchSessionId%22%3A%2296c400d9-838a-45af-a625-426029e1fbe9%22%2C%22placeId%22%3A%22ChIJnUvjRenzaS4RILjULejFAAE%22%2C%22sectionOffset%22%3A2%2C%22itemsOffset%22%3A20%2C%22query%22%3A%22Jakarta%2C%20Indonesia%22%2C%22cdnCacheSafe%22%3Afalse%2C%22simpleSearchTreatment%22%3A%22simple_search_only%22%2C%22treatmentFlags%22%3A%5B%22stays_flexible_dates%22%2C%22simple_search_1_1%22%5D%2C%22screenSize%22%3A%22large%22%7D%7D&amp;extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%228c9b30efefd6746ad4471b4c7a38f65707d3bf6c4c0cee8cc1e45f829b734736%22%7D%7D</a></span></pre><p id="ee77" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个URL是经过编码的，我们首先必须对其进行解码。我们可以很容易地通过访问免费的在线网址解码器，如<a class="ae iu" href="https://urldecoder.org" rel="noopener ugc nofollow" target="_blank">urldecoder.org</a></p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/2d098851e296b1f0d807ab6c16fdc6f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YfgNpo9l4onsU-mc6LrJ0Q.png"/></div></div></figure><p id="ab6a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，我们获得如下所示的解码后的URL。</p><pre class="ll lm ln lo fd lx ly lz ma aw mb bi"><span id="51e1" class="mc ju hi ly b fi md me l mf mg"><a class="ae iu" href="https://www.airbnb.com/api/v3/ExploreSearch?locale=en&amp;operationName=ExploreSearch&amp;currency=USD&amp;variables={" rel="noopener ugc nofollow" target="_blank">https://www.airbnb.com/api/v3/ExploreSearch?locale=en&amp;operationName=ExploreSearch&amp;currency=USD&amp;variables={</a>"request":{"metadataOnly":false,"version":"1.7.6","<strong class="ly hj">itemsPerGrid</strong>":20,"tabId":"home_tab","<strong class="ly hj">checkin</strong>":"2020-07-23","refinementPaths":["/homes"],"source":"structured_search_input_header","<strong class="ly hj">checkout</strong>":"2020-07-31","searchType":"pagination","neLat":"-6.023133395497556","neLng":"107.13100680175785","swLat":"-6.303030653754502","swLng":"106.47045382324222","searchByMap":true,"federatedSearchSessionId":"96c400d9-838a-45af-a625-426029e1fbe9","placeId":"ChIJnUvjRenzaS4RILjULejFAAE","<strong class="ly hj">sectionOffset</strong>":2,"<strong class="ly hj">itemsOffset</strong>":20,"<strong class="ly hj">query</strong>":"Jakarta, Indonesia","cdnCacheSafe":false,"simpleSearchTreatment":"simple_search_only","treatmentFlags":["stays_flexible_dates","simple_search_1_1"],"screenSize":"large"}}&amp;extensions={"persistedQuery":{"version":1,"sha256Hash":"8c9b30efefd6746ad4471b4c7a38f65707d3bf6c4c0cee8cc1e45f829b734736"}}</span></pre><p id="3503" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，我们可以标识诸如itemsPerGrid、Checkin、Checkout、Query、sectionOffset和itemsOffset之类的字段。通过识别这些模式，我们可以通过简单地修改这些参数来探索Airbnb数据集。</p><p id="9813" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们有了这些信息，我们可以开始构建我们的脚本了。对于这个例子，我将使用Node.js，但是这个理论也适用于其他编程语言。</p><p id="aad6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将首先安装Axios来在Node.js中发出HTTP请求</p><pre class="ll lm ln lo fd lx ly lz ma aw mb bi"><span id="52c7" class="mc ju hi ly b fi md me l mf mg">npm install axios</span></pre><p id="3288" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，我需要将它们与fs包一起放在我的airbnb.js文件中，以便稍后将我的数据保存为文件。</p><pre class="ll lm ln lo fd lx ly lz ma aw mb bi"><span id="e192" class="mc ju hi ly b fi md me l mf mg">const axios = require("axios");</span><span id="0650" class="mc ju hi ly b fi mi me l mf mg">const fs = require("fs");</span></pre><p id="3c88" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，我们将使用Axios向端点发出一个HTTP GET请求。请注意，我们还包含了之前确定的标题信息。包含这些标题将允许Airbnb看到我们的请求，就好像我们是Airbnb.com从Airbnb的服务器请求数据一样。</p><figure class="ll lm ln lo fd ij"><div class="bz dy l di"><div class="mj mk l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">对Airbnb的端点执行HTTP请求的简单示例</figcaption></figure><p id="3b06" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们检索的数据可以在下面的链接中看到。</p><div class="ml mm ez fb mn mo"><a href="https://jsonblob.com/01465cc1-ccfa-11ea-ad1c-51ff5e7c449a" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab dw"><div class="mq ab mr cl cj ms"><h2 class="bd hj fi z dy mt ea eb mu ed ef hh bi translated">Airbnb端点响应</h2><div class="mv l"><h3 class="bd b fi z dy mt ea eb mu ed ef dx translated">JSON Blob是一个基于web的工具，用于创建、编辑、查看、格式化和共享JSON。它显示你的JSON并排在一个…</h3></div><div class="mw l"><p class="bd b fp z dy mt ea eb mu ed ef dx translated">jsonblob.com</p></div></div></div></a></div><p id="db52" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">更进一步，由于我们知道端点的模式，我们可以通过增加它的itemsOffset对数据集进行分页。这样，我们可以遍历端点中包含的整个数据集，而不必直接与Airbnb站点进行交互。这里，我创建了一个简单的循环来遍历端点。</p><figure class="ll lm ln lo fd ij"><div class="bz dy l di"><div class="mj mk l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">通过递增offset参数进行分页的简单示例</figcaption></figure><p id="9fad" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将结果打包成JSON，并通过fs.writeFile函数保存为一个文件。该文件可以通过在线提供的免费JSON到CSV转换器转换为CSV文件，数据集已准备好用于我们的大数据研究！</p><h1 id="5854" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">后续步骤</h1><p id="f8a0" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">这种方法简单易行。但是，在尝试和错误以及确定合适的终点方面有所投入。但是，一旦我们找到了正确的模式并固化了我们的脚本，我们就可以用它来搜索任何我们想要的查询和数据集！</p><p id="3778" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">除了本文中的示例，我们还可以找到其他端点，并从网站中检索不同的数据集。Airbnb使用其他HTTP端点来为其网站的不同部分填充数据。比如Airbnb使用不同的端点进行点评，我们也可以通过这种技术获得。提示:在打开Network选项卡的情况下使用开发人员工具，研究传入的请求。您可能会找到可以使用的独特的HTTP端点。</p><p id="8b53" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们还可以创建一个更好的算法来遍历端点。我们可以创建一个检查来增加偏移量，直到没有数据返回，而不是像示例中所示的固定数量的循环。最后，试验一下端点的参数，看看可以检索到什么数据。</p><p id="489c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这种方法非常通用，适用于许多其他流行的平台。YouTube和Instagram是许多其他利用这种客户端到服务器交互的网站中的少数几个。</p><h1 id="d8c5" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">数据点——人性化的刮痧App </strong></h1><p id="dd32" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">如果这篇文章对你有用，我制作了一个web应用程序，利用这种技术可以访问Airbnb列表和评论以及Tokopedia产品和评论数据集，而不需要编写代码和设置自己的脚本。这些抓取工具具有友好的界面、实时抓取进度状态、交互式数据集预览和即时下载到CSV格式。你可以在下面的30秒视频中看到数据点的作用，或者访问https://datapoint.marcelchristianis.com的<a class="ae iu" href="https://datapoint.marcelchristianis.com" rel="noopener ugc nofollow" target="_blank">亲自尝试一下。</a></p><figure class="ll lm ln lo fd ij"><div class="bz dy l di"><div class="mx mk l"/></div></figure><p id="e83c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">也就是说，我希望这篇文章值得您花费时间，并为您的数据收集库添加另一个工具。</p><p id="3c42" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">干杯，</p><p id="2682" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">波浪形卷发</p></div></div>    
</body>
</html>