<html>
<head>
<title>Develop a web-scraping script and run it on AWS periodically.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开发一个网页抓取脚本，并定期在 AWS 上运行。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/develop-a-web-scraping-script-and-run-it-on-aws-periodically-e2fdc94dbcaa?source=collection_archive---------4-----------------------#2020-11-22">https://medium.com/analytics-vidhya/develop-a-web-scraping-script-and-run-it-on-aws-periodically-e2fdc94dbcaa?source=collection_archive---------4-----------------------#2020-11-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="5c47" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">直接通过电子邮件获取 GGSIPU 学期成绩。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/b5d0082af72d6ed9d95094c3845c0762.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Tgsw1Rra0hh07p1X"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">Emile Perron 在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="7ad7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">良好的..这似乎很有趣，对吧！</p><p id="823d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">因此，基本上我们想做的是从公共网站获取一些数据，并根据我们的需要过滤掉，然后数据(在这种情况下是链接)需要通过电子邮件发送到请求的地址，这需要定期进行。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><p id="dc0d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">首先，技术堆栈。</p><p id="d73b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">&gt;我们将使用 Python3 编写脚本，你不需要成为这方面的大师，只需要基本的知识就足够了。</p><p id="eea9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">&gt; AWS EC2，用于始终启动和运行的服务器，这样我们就可以使用 cron 作业为 Linux 定期运行脚本。</p><blockquote class="kr ks kt"><p id="6f3b" class="jo jp ku jq b jr js ij jt ju jv im jw kv jy jz ka kw kc kd ke kx kg kh ki kj hb bi translated">不要担心，我们将只使用 EC2 的免费层，每月提供 750 小时的免费使用。</p></blockquote><h1 id="6d61" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated"><em class="lq">Python 脚本</em></h1><p id="4202" class="pw-post-body-paragraph jo jp hi jq b jr lr ij jt ju ls im jw jx lt jz ka kb lu kd ke kf lv kh ki kj hb bi translated">我们将瞄准 IPU 网站，让我们的学期成绩直接在我们的电子邮件上弹出。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lw"><img src="../Images/9655e205c14b6580226a624dc3e712bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*nKdq0iAU6hO7_yu1dRtDUw.png"/></div></figure><p id="3950" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们将需要包括这两个模块(<em class="ku"> beautifulsoup </em>和<em class="ku"> urllib </em>)，用于打开网页并从中提取数据。<br/>要打开 URL，使用<em class="ku"> urllib.request.urlopen </em>函数，将网址作为参数传递，如下图。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lx"><img src="../Images/d391a69f302e2243865d9188ae7f2fac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I3S2ociYkmn2qa6fL56Mgg.png"/></div></div></figure><p id="de07" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">使用底部的 BeautifulSoup 函数，可以解析在<em class="ku">响应</em>中提取的 HTML 页面，以便我们可以轻松地搜索所需的项目。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ly"><img src="../Images/7741eaa0379a9f7c913dfb547c867d6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xXiEt3CRfWEUHvR3t06Awg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><a class="ae jn" href="http://ggsipu.ac.in/ExamResults/ExamResultsmain.htm" rel="noopener ugc nofollow" target="_blank">http://ggsipu.ac.in/ExamResults/ExamResultsmain.htm</a></figcaption></figure><p id="dfb7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">该网页有一个表，上载时的结果显示在那里，所以我们需要在这个表中搜索我们想要的结果。</p><p id="ccef" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这可以通过对抓取的数据使用<em class="ku"> find_all </em>方法来完成，即<em class="ku"> data(在上面的代码片段中定义)</em>，然后在表格中搜索链接，即<em class="ku">一个带有超链接值的</em>标签，如图所示；</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lz"><img src="../Images/f23d68d8da97f474b3e3b16c6fee0cb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*qxBnOdJJLZ-vRVD4CPbwLQ.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">limit=12 定义了只获取前 12 个条目的函数。</figcaption></figure><p id="df87" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">此超链接值是指向结果 pdf 的链接，例如<a class="ae jn" href="http://ggsipu.ac.in/ExamResults/2020/221120/MBA%20(DM)%20Result%204th%20Semester%20ET%20Exam%20September%202020.pdf" rel="noopener ugc nofollow" target="_blank">http://ggs IPU . AC . in/exam results/2020/221120/MBA %20(DM)% 20 result % 204 th % 20 学期% 20ET %考试% 20 九月%202020.pdf </a></p><p id="5f6d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一旦我们能够找到结果的链接，我们将检查结果是否属于我们正在寻找的课程和学期，为此我们使用<em class="ku"> is_my_result() </em>函数，将结果的链接作为参数。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ma"><img src="../Images/492c043dfe433a31546289b3b2e56781.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bTh0m3rj5R_deGdsOFM88A.png"/></div></div></figure><p id="4467" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们使用<em class="ku"> re </em>模块中的搜索功能检查结果是否包含我们想要的关键字。</p><blockquote class="kr ks kt"><p id="c899" class="jo jp ku jq b jr js ij jt ju jv im jw kv jy jz ka kw kc kd ke kx kg kh ki kj hb bi translated">re <em class="hi">是 python3 中的一个内置模块，它为正则表达式操作提供了搜索等功能。</em></p></blockquote><p id="d3d1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">上面代码片段中的<code class="du mb mc md me b">substring1</code>和<code class="du mb mc md me b">substring2</code>表示我们正在寻找 B.Tech 第八学期的成绩。</p><p id="c37c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一旦链接符合我们的需求，我们就使用<code class="du mb mc md me b">send_email()</code> <em class="ku"> </em>功能发送电子邮件。</p><p id="bcd4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为了通过 python 脚本发送电子邮件，您需要包含这些模块。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mf"><img src="../Images/d6ca988dee046039a50c6262a7c33113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*kuqL1VQu9PX0X9TsKongzQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">发送电子邮件要包括的模块</figcaption></figure><p id="bd06" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">smtplib 模块将用于通过 python 脚本发送电子邮件。</p><blockquote class="kr ks kt"><p id="a07d" class="jo jp ku jq b jr js ij jt ju jv im jw kv jy jz ka kw kc kd ke kx kg kh ki kj hb bi translated">smptlib 有一个<em class="hi">类</em> <code class="du mb mc md me b">smtplib.<strong class="jq hj">SMTP</strong></code> ( <em class="hi"> host='' </em>，<em class="hi"> port=0 </em>，<em class="hi"> local_hostname=None </em>，[ <em class="hi"> timeout </em>，] <em class="hi"> source_address=None </em>)，<em class="hi">来发送邮件。</em></p></blockquote><p id="8220" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">使用这个类，我们能够设置发送电子邮件的主机和端口，例如，<br/>如果您使用 Gmail 帐户发送电子邮件，您将使用端口<code class="du mb mc md me b">587</code>的<code class="du mb mc md me b">smtp.gmail.com</code>，使用相同端口<code class="du mb mc md me b">587.</code>的 outlook <code class="du mb mc md me b">smtp-mail.outlook.com</code></p><p id="fb3d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">有几个端口号可以使用；</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mg"><img src="../Images/1b9ca1178eb7e1318607244cf0963c1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4s72CpF2l-E8Yj1T.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">来源:<a class="ae jn" href="https://www.sparkpost.com/blog/what-smtp-port/" rel="noopener ugc nofollow" target="_blank">https://www.sparkpost.com/blog/what-smtp-port/</a></figcaption></figure><p id="8d0d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">使用<em class="ku"> smtp </em>模块，我们能够构建一个函数，它有一个 from 地址、一个 to 地址、一个主题行和要发送的文本(这是我们的结果链接)。</p><p id="f5be" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们的电子邮件准备就绪后，我们将使用设置传输层安全性，并使用我们的电子邮件凭据登录。此后，我们将发送一封包含发件人地址、收件人地址和文本(消息)的电子邮件。最后，打印“邮件已发送”进行确认。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mh"><img src="../Images/12495972291263485999d132ec558f11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U2w2eb80wCHaJIAw7tzjzQ.png"/></div></div></figure><p id="fb77" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，如果您尝试运行该脚本，您会看到 Gmail 不允许您登录，并将向您发送一封电子邮件通知登录活动。</p><p id="58cb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为了绕过这一点，你必须允许不太安全的应用程序登录到你的帐户；<a class="ae jn" href="https://myaccount.google.com/lesssecureapps" rel="noopener ugc nofollow" target="_blank">https://myaccount.google.com/lesssecureapps</a>。</p><blockquote class="kr ks kt"><p id="652a" class="jo jp ku jq b jr js ij jt ju jv im jw kv jy jz ka kw kc kd ke kx kg kh ki kj hb bi translated">提示:你应该尝试使用非主要邮件，因为允许不太安全的应用程序登录可能会有安全风险。</p></blockquote><p id="81ef" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">完整的 python 脚本可从<a class="ae jn" href="https://gist.github.com/sterbon/8ad320507bbe3a4bf557d82001501833" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><h1 id="d4fc" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated"><strong class="ak">在图片中添加 AWS</strong></h1><p id="7018" class="pw-post-body-paragraph jo jp hi jq b jr lr ij jt ju ls im jw jx lt jz ka kb lu kd ke kf lv kh ki kj hb bi translated">脚本现在已经完成，是时候在 AWS EC2 上运行它了，这样我们就可以定期检查结果。</p><p id="3162" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为此，我们将启动一个 EC2 服务器(免费层),在那里上传我们的脚本，并以 2 分钟的间隔在 crontab 中运行 python 脚本。</p><p id="ba15" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">登录<a class="ae jn" href="http://aws.amazon.com" rel="noopener ugc nofollow" target="_blank"> AWS 控制台</a>并进入 EC2 服务。点击<strong class="jq hj">启动实例</strong>，创建一个实例。</p><p id="e7ca" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在自由层下面选择 Ubuntu Server 20.04 LTS。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mi"><img src="../Images/b5201b63506a87806c9e7369a96d644f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*99aBwP5psDTaYIZszTK_qQ.png"/></div></figure><p id="15cd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让它处于默认选项，并转到<em class="ku">查看和启动。<br/> </em>最后，点击启动。</p><p id="639a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果您没有密钥对，那么您必须创建一个新的密钥对并下载它，这样您就可以使用 Putty SSH 客户端连接到实例。</p><p id="054d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">同意这些条款，您的实例就启动并运行了。<br/>现在，您可以使用 Putty 和密匙对连接到 EC2 实例，一切就绪。</p><p id="da7e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为了能够在 EC2 机器上运行脚本，需要在那里添加脚本。为此，您将需要创建一个新文件触摸<br/> <code class="du mb mc md me b"> touch ipu.py</code>，将整个脚本复制到那里并保存。</p><p id="65ae" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在您已经让 EC2 与脚本一起运行了，您可以进行一些测试运行，看看一切都运行良好，并根据需要进行更改。</p><h1 id="dcdf" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">添加 Cron 作业</h1><p id="05cc" class="pw-post-body-paragraph jo jp hi jq b jr lr ij jt ju ls im jw jx lt jz ka kb lu kd ke kf lv kh ki kj hb bi translated">这里唯一要做的就是让脚本定期自动运行。为此，我们可以向 EC2 实例添加一个 cron 作业。</p><p id="d285" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">要添加 cron 作业，创建一个名为<code class="du mb mc md me b">ipu.cron</code>的新文件，并在其中写入<br/> <code class="du mb mc md me b">*/2 * * * * python3 ipu.py</code>，每 2 分钟运行一次脚本。</p><p id="c824" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在我们需要使用命令<br/> <code class="du mb mc md me b">crontab ipu.cron</code>将它添加到 crontab 中</p><p id="7dd3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">要检查所有活动的 cron 作业，请使用以下命令:<br/> <code class="du mb mc md me b">crontab -l</code></p><p id="715d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">要删除所有活动的 cron 作业，请使用命令；<br/>T5】</p><p id="a4ba" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">cronjob 是活动的，EC2 正在运行，您已经设置好了，只需坐等结果显示在您的电子邮件中。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><p id="104a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">感谢您花时间阅读这篇文章，祝您愉快！</p></div></div>    
</body>
</html>