<html>
<head>
<title>Web Scraping with python using BeautifulSoup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用python和BeautifulSoup进行网页抓取</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/web-scraping-with-python-using-beautifulsoup-b6e16850c268?source=collection_archive---------18-----------------------#2020-02-10">https://medium.com/analytics-vidhya/web-scraping-with-python-using-beautifulsoup-b6e16850c268?source=collection_archive---------18-----------------------#2020-02-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="d7e5" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">网页抓取简介</h2></div><p id="e80e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">网络抓取是一种用于从网站提取大量数据的技术，通过这种技术，数据被提取并以表格(电子表格)格式保存到您计算机中的本地文件或数据库中。这种技术主要关注于将web上的非结构化数据(HTML格式)转换成结构化数据(数据库或电子表格)。网页抓取也称为屏幕抓取、网页采集或网页数据提取。</p><p id="fda5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">大多数网站显示的数据只能使用网络浏览器查看。它们不提供保存该数据的副本以供个人使用的功能。唯一的选择是手动复制和粘贴数据，这是一项非常繁琐的工作，可能需要几个小时甚至几天才能完成。网络抓取是自动化这一过程的技术，因此网络抓取程序将在很短的时间内执行相同的任务，而不是手动从网站复制数据。</p><p id="fb00" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一个网页抓取程序会根据你的要求自动从网站的多个页面加载和提取数据。它可以是为特定网站定制的，也可以配置为适用于任何网站。只需点击一个按钮，您就可以轻松地将网站中的数据保存到您电脑中的文件中。一旦收集并以结构化且有意义的格式存储，这些数据可用于执行分析并获得有意义的见解。</p><h2 id="1470" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">刮擦规则</h2><ol class=""><li id="e2b0" class="ko kp hi iz b ja kq jd kr jg ks jk kt jo ku js kv kw kx ky bi translated">在你刮之前，你应该检查网站的条款和条件。请仔细阅读关于合法使用数据的声明。通常情况下，你搜集的数据不应该用于商业目的。</li><li id="6435" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated">不要用你的程序过于激进地从网站请求数据(也称为垃圾邮件)，因为这可能会破坏网站。确保你的程序以合理的方式运行(比如像人一样运行)。每秒请求一个网页是一个好习惯。</li><li id="33a2" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated">网站的布局可能会不时改变，所以请确保重新访问该网站，并根据需要重写您的代码。</li></ol><h2 id="ec92" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">抓取网页前要做的一些检查</h2><p id="6e21" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">在我们抓取一个网站之前，我们需要看一下他们的robots.txt，这个文件告诉我们网站是否允许抓取。要找到robots.txt，请键入基本URL并添加“/robots.txt”。例如，如果我们想抓取apartments.com，在网址框中输入<a class="ae lh" href="https://www.apartments.com/robots.txt" rel="noopener ugc nofollow" target="_blank">https://www.apartments.com/robots.txt</a>。如果robots.txt允许完全访问，则如下所示:</p><p id="2fde" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">用户代理:* <br/>不允许:</strong></p><p id="fc31" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果robots.txt阻止所有访问，则它包含以下内容:</p><p id="85d8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">用户代理:* <br/>不允许:/ </strong></p><p id="5012" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果robots.txt提供了部分访问权限，则它包含以下内容，其中section代表不被爬网的部分:</p><p id="195b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">用户代理:* <br/>不允许:/section/ </strong></p><p id="665a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在apartments.com的情况下，robots.txt包含以下内容，截至今天:#确保UTF-8无签名-无BOM</p><p id="1b08" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">用户代理:* <br/>不允许:/services/ </strong></p><p id="b5d9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">网站地图:<a class="ae lh" href="https://www.apartments.com/sitemapindex.xml.gz" rel="noopener ugc nofollow" target="_blank">【https://www.apartments.com/sitemapindex.xml.gz】T4</a></p><p id="532f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这意味着我们可以抓取网站上的所有部分，除了网址中有apartments.com/services/的部分。</p><h2 id="0930" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">HTML基础</h2><p id="eb70" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">在开始编写代码之前，让我们先了解HTML的基础知识。</p><p id="5dc0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"> <br/> &lt; html &gt; <br/> &lt;头&gt;&lt;/头&gt; <br/> &lt;体&gt; <br/> &lt; h1 &gt;首刮&lt;/h1&gt;<br/>&lt;p&gt;Hello World&lt;/p&gt;<br/>&lt;体&gt; <br/> &lt; /html &gt;</p><p id="a9f8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是HTML网页的基本语法。每个<tag>服务网页内的一个块:</tag></p><ol class=""><li id="5d43" class="ko kp hi iz b ja jb jd je jg lj jk lk jo ll js kv kw kx ky bi translated"> : HTML文档必须以类型声明开头。</li><li id="5109" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated">HTML文档包含在<html>和</html>之间。</li><li id="4449" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated">HTML文档的元和脚本声明在<head>和</head>之间。</li><li id="0948" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated">HTML文档的可见部分在<body>和</body>标签之间。</li><li id="1a23" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated">标题由<h1>到<h6>标签定义。</h6></h1></li><li id="c94c" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated">段落由<p>标签定义。其他有用的标签包括用于超链接的<a>，用于表格的</a></p><table>，用于表格行的<tr>，以及用于表格列的<td>。</td></tr></table></li></ol><p id="be2c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，HTML标签有时带有id或class属性。“id”属性为HTML标记指定唯一的id，并且该值在HTML文档中必须是唯一的。“class”属性用于为具有相同类的HTML标记定义相同的样式。我们可以利用这些id和类来帮助我们定位我们想要的数据。</p><h2 id="1313" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">使用的包和工具</h2><p id="59bf" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">web抓取没有通用的解决方案，因为每个网站上存储数据的方式通常是特定于该网站的。事实上，如果你想收集数据，你需要了解网站的结构，或者构建自己的解决方案，或者使用高度可定制的解决方案。然而，有许多软件包为您做了最多的工作。根据您的编程技能和您的预期用例，您可能会发现不同的包或多或少有些用处。</p><p id="3e3c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">美丽的声音和请求</strong></p><p id="e5a1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> BeautifulSoup </strong>是一个Python库，用于从HTML和XML文件中提取数据。它与您喜欢的解析器一起工作，提供导航、搜索和修改解析树的惯用方式。它通常为程序员节省数小时或数天的工作。除此之外，您还需要一个请求库来获取URL的内容。</p><p id="7f86" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">【BeautifulSoup是如何工作的？</p><p id="5654" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我们使用请求库获取URL的内容。它返回一个类型为<strong class="iz hj">‘requests . models . response’</strong>的对象</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div class="er es lm"><img src="../Images/010509aac24b36d0fb2a491df539c7cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*b-xhCMlzW-VlK1Eqvwbm1w.png"/></div></figure><p id="3e99" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们将把这个类型为<strong class="iz hj">‘requests . models . response’</strong>的对象转换成一个<strong class="iz hj">‘beautiful soup’</strong>对象。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div class="er es lu"><img src="../Images/12fcf973900b4b2e495ec17f1f0aa273.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*YIACQ8A2YLhzyj97fuivLQ.png"/></div></figure><p id="8f25" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以下是导航该数据结构的一些简单方法:</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es lv"><img src="../Images/4b85bed97ec5e6da40efbc437609b5de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6UPR4qsBxKA1wpLtHUJAcg.png"/></div></div></figure><h2 id="3796" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">使用Python对表进行Web抓取的示例</h2><p id="1914" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated"><strong class="iz hj">使用请求和美化组</strong></p><ol class=""><li id="0861" class="ko kp hi iz b ja jb jd je jg lj jk lk jo ll js kv kw kx ky bi translated">首先，我们将导入请求库。</li><li id="158f" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated">然后，我们分配网站的链接，通过该链接我们将抓取数据，并将其分配给名为“url”的变量。</li><li id="c845" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated"><strong class="iz hj">请求获取(网址)。text </strong>将ping一个网站并返回该网站的HTML。</li><li id="f170" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated">我们首先读取给定网页的源代码，并使用“BeautifulSoup”函数创建一个BeautifulSoup (soup)对象。</li><li id="be01" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated">然后，我们检查所有表格内容的HTML脚本，即我们打算在类“Wikitable Sortable”下提取的国家名称。</li></ol><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es ma"><img src="../Images/ec969cecd28fab23fa2595b77252eacd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ac_ZcGc6Ga7g8hUQsWna1A.png"/></div></div></figure><p id="2103" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">6.然后，我们在表的所有行上迭代一个循环，去掉html标记的元素，并将其转换为表中所有行的列表。</p><p id="afce" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">7.然后，我们使用<strong class="iz hj"> pandas </strong>库将这个列表转换成数据帧。</p><p id="4a4c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">8.最后，我们将这个数据帧输出到一个CSV文件中。</p><p id="b5b9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">刮码</strong></p><figure class="ln lo lp lq fd lr er es paragraph-image"><div class="er es mb"><img src="../Images/e95befe91ea473cceaa9e7183aa4b279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*_T8Hw9gL2YrFfZfbHszjkw.png"/></div></figure><p id="94b4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">数据帧</strong></p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mc"><img src="../Images/b0379a2075ae089080450bca4cee407f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L9hbV8rG8pk8JzL9SWfYcg.png"/></div></div></figure><p id="6c95" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> CSV文件</strong></p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es md"><img src="../Images/471e405faf8e03e9c5d5bde331967d3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*cqT37rGbJQpvlXvF7PUARQ.png"/></div></div></figure></div></div>    
</body>
</html>