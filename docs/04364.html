<html>
<head>
<title>Some Interesting Tricks in Python Pillow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python枕头中的一些有趣的技巧</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/some-interesting-tricks-in-python-pillow-8fe5acce6084?source=collection_archive---------7-----------------------#2020-03-16">https://medium.com/analytics-vidhya/some-interesting-tricks-in-python-pillow-8fe5acce6084?source=collection_archive---------7-----------------------#2020-03-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b565" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只是在时间片段，python图像处理库。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/a83fb1fc57ae72673d45c357bb9abec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kgwdVGtsJPYU59Aej0LNmA.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">马修·法斯纳赫特在<a class="ae jt" href="https://unsplash.com/s/photos/manipulation?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="17c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">照片由<a class="ae jt" href="https://unsplash.com/@dmarcinkowski?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">丹尼尔·马尔辛科夫斯基</a>在<a class="ae jt" href="https://unsplash.com/s/photos/panorama?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p><p id="0da9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图像处理基本上是一个将<em class="ju">数字化图像转换成期望图像的过程。大多数时候，当人们想到图像处理时，<em class="ju"> photoshop </em>会出现在脑海中。这是改变和改善图像最常用的工具之一。不过这个帖子重点是<a class="ae jt" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> <em class="ju"> Python </em> </a>图像操纵库，确切的说是枕头。</em></p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><blockquote class="kc kd ke"><p id="1d3e" class="if ig ju ih b ii ij ik il im in io ip kf ir is it kg iv iw ix kh iz ja jb jc hb bi translated">根据<a class="ae jt" href="https://docs.python-guide.org/scenarios/imaging/" rel="noopener ugc nofollow" target="_blank">Python的搭便车指南</a>，大多数图像处理和操作技术可以使用两个库有效地执行:Python图像库(PIL)和开源计算机视觉(OpenCV)。</p></blockquote></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><p id="a754" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Pillow是PIL (Python图像库)的一个分支，由<a class="ae jt" href="https://github.com/python-pillow/Pillow/graphs/contributors" rel="noopener ugc nofollow" target="_blank"> Alex Clark和贡献者</a>启动和维护。最初基于PIL法典，它演变成一个更好、更现代、更友好的PIL版本。它支持打开和操作许多不同文件格式的图像。</p><p id="a8ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你熟悉<a class="ae jt" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> <em class="ju"> Python编程语言</em> </a>，很有可能你已经遇到并可能使用过Pillow。</p><h2 id="a5bb" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated"><strong class="ak">基本安装</strong></h2><p id="7cbb" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">首先，你需要在你的机器上安装<em class="ju"> python </em>。还要确保<em class="ju">Python</em><a class="ae jt" href="https://pypi.org/project/pip/" rel="noopener ugc nofollow" target="_blank"><em class="ju">pip</em></a><em class="ju">(Python包索引)</em>已经安装并且是最新的。要安装<strong class="ih hj"><em class="ju"/></strong>枕头，运行下面的命令:</p><pre class="je jf jg jh fd li lj lk ll aw lm bi"><span id="476b" class="ki kj hi lj b fi ln lo l lp lq">$ pip install Pillow</span></pre><p id="d132" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在您已经成功安装了Pillow，下面有一些代码片段，您可能会觉得非常方便(至少我是这样)。<strong class="ih hj"> <em class="ju">注意</em> </strong> <em class="ju">下面的样本是基本的图像操作，如调整大小、模糊、灰度转换等等</em>。</p><h2 id="0b97" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated">转换为灰度(黑白)</h2><p id="6d71" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">下面的代码片段将图像(<em class="ju"> test_image.jpg </em>)转换为基本灰度。将其保存为新图像(<em class="ju">test _ image _ gray . jpg</em>)。</p><pre class="je jf jg jh fd li lj lk ll aw lm bi"><span id="4308" class="ki kj hi lj b fi ln lo l lp lq">from PIL import Image</span><span id="0145" class="ki kj hi lj b fi lr lo l lp lq"># open colour image<br/>img = Image.open("test_image.jpg")</span><span id="a2ba" class="ki kj hi lj b fi lr lo l lp lq"># convert image to black and white<br/>img = img.convert("1")</span><span id="3539" class="ki kj hi lj b fi lr lo l lp lq"># save new image<br/>img.save("test_image_grayscale.jpg")</span><span id="0663" class="ki kj hi lj b fi lr lo l lp lq"># show image in preview<br/>img.show()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/267f6289047ea3a2d8efef7a7e0665b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5wXlBcaL79SbBYlg6eSlDQ.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">照片由<a class="ae jt" href="https://www.instagram.com/sonne.ina/" rel="noopener ugc nofollow" target="_blank"> Ina Sonne </a>在<a class="ae jt" href="https://www.instagram.com/" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上拍摄</figcaption></figure><h2 id="27ea" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated">生成缩略图</h2><p id="4bf8" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">通常，我们需要快速缩略图几个图像。下面的片段就可以做到这一点。</p><pre class="je jf jg jh fd li lj lk ll aw lm bi"><span id="7a29" class="ki kj hi lj b fi ln lo l lp lq">from PIL import Image</span><span id="2f8a" class="ki kj hi lj b fi lr lo l lp lq"># open image<br/>img <strong class="lj hj">=</strong> Image.open("test_image.jpg")</span><span id="2417" class="ki kj hi lj b fi lr lo l lp lq"># set the maximum width and height for the thumbnail<br/>max_thumbnail_size <strong class="lj hj">=</strong> (200, 200)</span><span id="2867" class="ki kj hi lj b fi lr lo l lp lq"># applying size for thumbnail<br/>img.thumbnail(max_thumbnail_size)</span><span id="649c" class="ki kj hi lj b fi lr lo l lp lq"># creating thumbnail<br/>img.save("test_image_thumb.jpg")</span><span id="9594" class="ki kj hi lj b fi lr lo l lp lq"># show image in preview<br/>img.show()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lt"><img src="../Images/7b67ca15add677d033e09d7b30a4d831.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8d4Z0lcDNvG3BTdJCNm3Mg.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图片由<a class="ae jt" href="https://unsplash.com/@seefromthesky?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Ishan @seefromthesky </a>在<a class="ae jt" href="https://unsplash.com/s/photos/malaysia?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h2 id="9427" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated">替换颜色(RGB)</h2><p id="bb8f" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">下面的代码替换所有的白色像素，用黄色替换。为了调整多种颜色的图像，需要进行更多的调整。尽管如此，下面的代码片段对于纯色背景的图片来说效果很好。</p><pre class="je jf jg jh fd li lj lk ll aw lm bi"><span id="5137" class="ki kj hi lj b fi ln lo l lp lq">from PIL import Image</span><span id="fb68" class="ki kj hi lj b fi lr lo l lp lq"># open image<br/>img = Image.open("test_image.jpg")<br/>img = img.convert("RGB")</span><span id="cb9c" class="ki kj hi lj b fi lr lo l lp lq">datas = img.getdata()</span><span id="b6cc" class="ki kj hi lj b fi lr lo l lp lq">new_image_data = []</span><span id="e46a" class="ki kj hi lj b fi lr lo l lp lq">for item in datas:<br/>    # change all white (also shades of whites) pixels to yellow<br/>    if item[0] in list(range(190, 256)):<br/>        new_image_data.append((255, 204, 100))<br/>    else:<br/>        new_image_data.append(item)</span><span id="f81d" class="ki kj hi lj b fi lr lo l lp lq"># update image data<br/>img.putdata(new_image_data)</span><span id="4b36" class="ki kj hi lj b fi lr lo l lp lq"># save new image<br/>img.save("test_image_altered_background.jpg")</span><span id="41e5" class="ki kj hi lj b fi lr lo l lp lq"># show image in preview<br/>img.show()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lu"><img src="../Images/322f6ca27497d337822880a9bc8eab3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J1LQuQuViXutgpNQ7z3rtg.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图片来自<a class="ae jt" href="https://developers.google.com/sheets/api" rel="noopener ugc nofollow" target="_blank">谷歌电子表格API </a></figcaption></figure><h2 id="dd61" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated">添加边框</h2><p id="dad1" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">它接受应用于图像的边框的颜色和大小。边框可以是整数值，例如5，这表示所有边框(左、上、右和下)都具有相同的大小。它还接受元组，即(5，10，5，10)，每边具有不同的值。</p><pre class="je jf jg jh fd li lj lk ll aw lm bi"><span id="4f20" class="ki kj hi lj b fi ln lo l lp lq">from PIL import Image, ImageOps</span><span id="1897" class="ki kj hi lj b fi lr lo l lp lq"># open image<br/>img = Image.open("test_image.jpg")</span><span id="770e" class="ki kj hi lj b fi lr lo l lp lq"># border color<br/>color = "green"</span><span id="78a3" class="ki kj hi lj b fi lr lo l lp lq"># top, right, bottom, left<br/>border = (20, 10, 20, 10)</span><span id="8a36" class="ki kj hi lj b fi lr lo l lp lq">new_img = ImageOps.expand(img, border=border, fill=color)</span><span id="41bd" class="ki kj hi lj b fi lr lo l lp lq"># save new image<br/>new_img.save("test_image_result.jpg")</span><span id="ecfa" class="ki kj hi lj b fi lr lo l lp lq"># show new bordered image in preview<br/>new_img.show()</span></pre><p id="7e48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当如上所述对图像样本应用边框时，它应该如下图所示。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lv"><img src="../Images/c570f0726fe5de379e6c437286101953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XOkLYEKlAFgum8guAW_FDQ.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图片来自<a class="ae jt" href="https://developers.google.com/sheets/api" rel="noopener ugc nofollow" target="_blank">谷歌电子表格API </a></figcaption></figure><h2 id="4bdf" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated">添加模糊边缘</h2><p id="6e98" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">相对于前面的例子，本节由几个步骤组成。第一部分需要创建一个模糊的图像(蒙版)，并使用该图像作为原始图像的蒙版。下面将详细介绍如何创建<strong class="ih hj"> <em class="ju">模糊边缘图像</em> </strong>的步骤和过程。</p><pre class="je jf jg jh fd li lj lk ll aw lm bi"><span id="b668" class="ki kj hi lj b fi ln lo l lp lq">from PIL import Image, ImageFilter</span><span id="8248" class="ki kj hi lj b fi lr lo l lp lq"># blur radius and diameter<br/>radius, diameter = 20, 40</span><span id="1e62" class="ki kj hi lj b fi lr lo l lp lq"># open an image<br/>img = Image.open("test_image.jpg")</span><span id="b9e2" class="ki kj hi lj b fi lr lo l lp lq"># Paste image on white background<br/>background_size = (img.size[0] + diameter, img.size[1] + diameter)<br/>background = Image.new('RGB', background_size, (255, 255, 255))<br/>background.paste(img, (radius, radius))</span><span id="c746" class="ki kj hi lj b fi lr lo l lp lq"># create new images with white and black<br/>mask_size = (img.size[0] + diameter, img.size[1] + diameter)<br/>mask = Image.new('L', mask_size, 255)<br/>black_size = (img.size[0] - diameter, img.size[1] - diameter)<br/>black = Image.new('L', black_size, 0)</span><span id="8689" class="ki kj hi lj b fi lr lo l lp lq"># create blur mask<br/>mask.paste(black, (diameter, diameter))</span><span id="5ec3" class="ki kj hi lj b fi lr lo l lp lq"># Blur image and paste blurred edge according to mask<br/>blur = background.filter(ImageFilter.GaussianBlur(radius / 2))<br/>background.paste(blur, mask=mask)</span><span id="71b0" class="ki kj hi lj b fi lr lo l lp lq">background.save("test_image_blurred.jpg", quality=100))</span><span id="94e6" class="ki kj hi lj b fi lr lo l lp lq"># show blurred edged image in preview<br/>background.show()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/ef4969108881391a0d8ddcc03a9a9f26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_6tYVtD2krKgbwtR29qBGQ.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">照片由<a class="ae jt" href="https://www.instagram.com/sonne.ina/" rel="noopener ugc nofollow" target="_blank"> Ina Sonne </a>在<a class="ae jt" href="https://www.instagram.com/" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上拍摄</figcaption></figure><h2 id="ee39" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated">添加水印</h2><p id="c5d0" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">使用水印是书中最古老的防止图像被盗版的技巧之一。即使有几种新的方法来逃避图像上的水印(如果你好奇，可以了解一下)，它仍然非常有效。下面代码示例说明了如何在图像中添加连续水印。</p><pre class="je jf jg jh fd li lj lk ll aw lm bi"><span id="e233" class="ki kj hi lj b fi ln lo l lp lq">from PIL import Image, ImageDraw, ImageFont</span><span id="ce00" class="ki kj hi lj b fi lr lo l lp lq"># open image to apply watermark to<br/>img = Image.open("watermark_test.jpg")<br/>img.convert("RGB")</span><span id="a8ef" class="ki kj hi lj b fi lr lo l lp lq"># get image size<br/>img_width, img_height = img.size</span><span id="7316" class="ki kj hi lj b fi lr lo l lp lq"># 5 by 4 water mark grid<br/>wm_size = (int(img_width * 0.20), int(img_height * 0.25))<br/>wm_txt = Image.new("RGBA", wm_size, (255, 255, 255, 0))</span><span id="02d9" class="ki kj hi lj b fi lr lo l lp lq"># set text size, 1:40 of the image width<br/>font_size = int(img_width / 40)</span><span id="9515" class="ki kj hi lj b fi lr lo l lp lq"># load font e.g. <a class="ae jt" href="https://www.dafontfree.net/freefonts-gotham-f127516.htm" rel="noopener ugc nofollow" target="_blank">gotham-bold.ttf</a><br/>font = ImageFont.truetype(path.format("gotham-bold.ttf"), font_size)<br/>d = ImageDraw.Draw(wm_txt)</span><span id="058c" class="ki kj hi lj b fi lr lo l lp lq">wm_text = "Kuma Kum"</span><span id="9410" class="ki kj hi lj b fi lr lo l lp lq"># centralize text<br/>left = (wm_size[0] - font.getsize(wm_text)[0]) / 2<br/>top = (wm_size[1] - font.getsize(wm_text)[1]) / 2</span><span id="2d8e" class="ki kj hi lj b fi lr lo l lp lq"># RGBA(0, 0, 0, alpha) is black<br/># alpha channel specifies the opacity for a colour<br/>alpha = 75</span><span id="e795" class="ki kj hi lj b fi lr lo l lp lq"># write text on blank wm_text image<br/>d.text((left, top), wm_text, fill=(0, 0, 0, alpha), font=font)</span><span id="af97" class="ki kj hi lj b fi lr lo l lp lq"># uncomment to rotate watermark text<br/># wm_txt = wm_txt.rotate(15,  expand=1)<br/># wm_txt = wm_txt.resize(wm_size, Image.ANTIALIAS)</span><span id="6eb2" class="ki kj hi lj b fi lr lo l lp lq">for i in range(0, img_width, wm_txt.size[0]):<br/>    for j in range(0, img_height, wm_txt.size[1]):<br/>        img.paste(wm_txt, (i, j), wm_txt)</span><span id="f727" class="ki kj hi lj b fi lr lo l lp lq"># save image with watermark<br/>img.save("watermark-image.jpg")</span><span id="8a6c" class="ki kj hi lj b fi lr lo l lp lq"># show image with watermark in preview<br/>img.show()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lx"><img src="../Images/135e6fd41ad01e2604f3625dbdf0346f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gzUwlZbInaA1LIokF-E9_Q.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">照片由<a class="ae jt" href="https://unsplash.com/@kumakum?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">库马·库姆</a>在<a class="ae jt" href="https://unsplash.com/s/photos/ina-sonne?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><p id="9bf8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以你走吧！</p><p id="df4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用枕头库做更多事情。以上只是几个基本的样本，我经常使用，认为特别有用。自己尝试一下，完整的代码片段和更多…可以通过<a class="ae jt" href="https://gist.github.com/namieluss" rel="noopener ugc nofollow" target="_blank">点击这里</a>找到。</p></div></div>    
</body>
</html>