<html>
<head>
<title>Deploying Flask web app with Docker on Azure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Azure上使用Docker部署Flask web应用程序</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploying-flask-webapp-with-docker-on-azure-c48bee72ba0d?source=collection_archive---------16-----------------------#2020-07-06">https://medium.com/analytics-vidhya/deploying-flask-webapp-with-docker-on-azure-c48bee72ba0d?source=collection_archive---------16-----------------------#2020-07-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9c90cd0fa82a31e177815daec74730cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PRXkSSmO4VUkbd7BUf_-HQ.png"/></div></div></figure><p id="8d0a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我们将浏览docker的基本解释，创建一个flask web应用程序，然后使用docker在azure上部署该web应用程序。</p><h1 id="2e46" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">什么是Docker</h1><p id="cdd9" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">软件开发中的每个人都听说过docker(或者你可能听说过容器)。在docker之前，软件开发中的每个新人都要经历相同的过程——下载、提取、安装、重复。然后是DOCKER，它简化了整个系统依赖过程。最好的部分是，如果它在本地工作，它将在生产中工作。让我们看看docker是什么意思:</p><p id="9375" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">根据维基百科</p><p id="98e9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae kr" href="https://en.wikipedia.org/wiki/Docker_%28software%29" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> Docker </strong>是一套平台即服务(PaaS)产品，使用操作系统级虚拟化来交付称为容器的软件包中的软件。</a></p><p id="455a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在你知道docker了..对吗？？:P</p><p id="44ea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Docker让您创建一个特定的环境，您的代码可以在其中运行。您可以多次创建相同的环境，因为它允许构建副本。</p><p id="86c6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在你对docker有了一个概念，让我们来谈谈容器和图像。</p><h2 id="865d" class="ks jp hi bd jq kt ku kv ju kw kx ky jy jb kz la kc jf lb lc kg jj ld le kk lf bi translated">容器</h2><p id="8d78" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">Docker容器就像一个虚拟的运行时环境，它封装了所有的代码和依赖项。它可以是面向操作系统的容器或面向应用程序的容器。</p><h2 id="69ea" class="ks jp hi bd jq kt ku kv ju kw kx ky jy jb kz la kc jf lb lc kg jj ld le kk lf bi translated">图像</h2><p id="ef97" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">Docker映像是一个不可变的文件，由多个层组成。该映像是使用dockerfile文件中提到的所有指令构建的。每个dockerfile指令创建一个新层。</p><h1 id="d0dd" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">创建Flask Web应用程序</h1><p id="ed10" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">让我们从创建一个简单的flask web应用程序开始。你可以复制粘贴下面的代码，也可以从我的<a class="ae kr" href="https://github.com/nikskushwah/azure_flask_docker" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中克隆web应用。这些是创建web应用程序的步骤。</p><h2 id="026a" class="ks jp hi bd jq kt ku kv ju kw kx ky jy jb kz la kc jf lb lc kg jj ld le kk lf bi translated">要求</h2><p id="322c" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">Python，Flask，GitHub，Docker，Azure</p><p id="1e5c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">1)使用您的IDE选择创建一个空python文件(或者您可以使用可视代码)。</p><p id="f1d0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2)这是一个示例app.py</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="915c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3)使用以下代码创建一个index.html，并将其保存在templates文件夹中。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="6d9f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4)现在你可以将你正在使用的所有包保存在requirements.txt中，当你试图在azure上部署web应用时，在你的项目文件夹中有一个requirements.txt是非常重要的。</p><p id="2499" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lm ln lo lp b">pip freeze &gt; requirements.txt</code></p><p id="8d39" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面提到的命令将获取所有已安装的包，并将它们存储在requirements.txt中。更好的方法是固定您的依赖项，这意味着它应该有一个包含包名的版本。</p><p id="97de" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5)尝试通过运行命令在本地运行它</p><pre class="lg lh li lj fd lq lp lr ls aw lt bi"><span id="e4d1" class="ks jp hi lp b fi lu lv l lw lx">python app.py</span></pre><p id="89aa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">6)它应该是这样的:</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/5a2ee46b6430bfaccc0f69bfe1c0acc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kySJuMSI3jz65Fjv7uh-kw.png"/></div></div></figure><h2 id="64ab" class="ks jp hi bd jq kt ku kv ju kw kx ky jy jb kz la kc jf lb lc kg jj ld le kk lf bi translated"><strong class="ak">使用Docker在本地运行web应用</strong></h2><p id="9cdd" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">要在本地运行docker，你必须首先从<a class="ae kr" href="https://www.docker.com/products/docker-desktop" rel="noopener ugc nofollow" target="_blank">这里</a>安装docker-desktop。</p><p id="5125" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将通过各种步骤来创建docker文件，并了解一些关于docker命令的信息。</p><p id="8692" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">打开IDE并创建一个新文件。</p><p id="fb5e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以在下面找到web应用程序的docker文件。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="d5f4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将其保存为扩展名为on的Dockerfile。</p><p id="607f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们看看dockerfile中的这些指令是什么意思。记住，每个指令创建一个层。</p><p id="774f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> FROM </strong>:该指令将从python 3.6.1图像创建一个层。</p><p id="6342" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">运行</strong>:你知道它会做什么，它会运行命令。您可以在dockerfile文件中执行多个运行指令。</p><p id="a094" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">工作目录</strong>:工作目录会改变你正在工作的目录。因此，WORKDIR之后的任何指令都将只在该特定目录中执行。</p><p id="cb9b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">添加</strong>:它可以让你将文件复制到docker镜像中。</p><p id="c94b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> EXPOSE </strong>:该指令将公开docker文件中提到的端口号。</p><p id="78cf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> ENV </strong>:您可以使用该指令设置环境变量。</p><h1 id="5fd5" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">Docker命令</h1><p id="16a4" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我们将使用一些docker命令来测试我们的web应用程序是否在本地工作。您可以按此顺序运行这些命令，在最后一个命令之后，您将成功地将docker映像推送到docker hub注册表。</p><p id="b05f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">码头工人建造。</strong></p><p id="be21" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此命令允许您从dockerfile文件构建映像。文件必须存在于当前目录中(这就是点号所指的)。如果你想给你的图像命名，你可以在命令中添加-t(例如:- docker build -t flask-app。)</p><p id="04c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> docker运行&lt;image _ name&gt;T15】</strong></p><p id="d01a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以通过运行上述命令来运行docker构建的映像。</p><p id="48b0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> docker ps </strong></p><p id="5fc1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该命令将列出所有运行的容器及其名称和标签。</p><p id="6a06" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> docker标签&lt;image _ name&gt;T30】user _ name&gt;/&lt;image _ name&gt;:&lt;标签&gt; </strong></p><p id="6305" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此命令将用新的名称和标签标记图像。</p><p id="f1d6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">码头工人登录</strong></p><p id="0146" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在你需要登录到你的docker账户。运行此命令后，您需要输入您的docker id和密码。</p><p id="377b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> docker推送&lt;用户名&gt; / &lt;图片名&gt; : &lt;标签&gt; </strong></p><p id="a82a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它会将构建的映像推送到docker hub。我们这样做是为了让azure可以从docker hub访问图像。</p><h1 id="e30e" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">在Azure上部署</h1><p id="d2ff" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">为了在azure上部署这个web应用程序，我们需要在我们的项目文件夹中添加一些文件，并将其推送到docker hub。</p><p id="d842" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们将添加一个名为<em class="lz"> sshd_config </em>的文件。这个文件启用ssh，然后客户机可以与容器建立安全连接。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="98a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，是docker容器的启动脚本，我们将在其中启动ssh服务器。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="15d1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">添加完所有这些文件后，我们的项目结构如下所示</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/551892ea6f0837558fd3befe91b2ab1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*mb3PWDC1mhBcQwUQhRnM1w.png"/></div><figcaption class="mb mc et er es md me bd b be z dx translated">项目结构</figcaption></figure><p id="6e44" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们准备在azure上部署带有docker的flask web应用程序。</p><p id="fe44" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">转到您的azure门户，然后单击创建资源。</p><p id="5b00" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，您将看到一个类似的窗口，如下所示，您需要在其中输入有关web应用程序和azure帐户的详细信息(您可以选择SKU和大小中的免费层)。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/cd71a35ec9e46dea0c16c86e6c5ae5d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mNZyQaK6iTRENvC__rbgxQ.png"/></div></div></figure><p id="9f22" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">记住在发布选项中选择Docker容器，然后单击下一步。</p><p id="5065" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，一个带有选项的页面将会出现，azure必须从那里提取容器图像。因为您已经将docker映像推送到中心，所以选择Docker Hub作为您的映像源。然后，输入正确的图像和标签(例如:-nikskushwah 8/flask-application:update)。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/59bf3c13e9b793c65c2d114fa9b442fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2edFiHI2ch5mFdHkuYIWdg.png"/></div></div></figure><p id="b561" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击审核+创建，就这样。你已经在azure上用docker部署了一个全功能的web应用。</p><h1 id="e460" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结论</h1><p id="755b" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">在本文中，我们了解了如何使用docker在azure上创建一个简单的web应用程序。我们还在docker容器上启用了ssh。在下一篇博文中，我们将看到如何使用docker在azure上部署一个简单的CRUD应用程序。感谢所有反馈和建议。您可以在我的<a class="ae kr" href="https://github.com/nikskushwah/azure_flask_docker" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上查看本文中使用的完整代码。</p></div></div>    
</body>
</html>