<html>
<head>
<title>Tiny (Quick) Cheat-sheet to Python Concurrency</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python并发性的小(快速)备忘单</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/tiny-quick-cheat-sheet-to-python-concurrency-dc90ba6c5de?source=collection_archive---------15-----------------------#2020-03-09">https://medium.com/analytics-vidhya/tiny-quick-cheat-sheet-to-python-concurrency-dc90ba6c5de?source=collection_archive---------15-----------------------#2020-03-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e8a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们都读过术语<em class="jd">、</em>、<em class="jd">、【纵向扩展】、</em>；然而，确保在我们的日常编码实践中使用这些原则是很重要的。至少，我们应该尽可能地并行操作。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/a665d6c6f9e60bd09d948d49a88912a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/format:webp/1*S89tRNflI144RJ8gnPDn1Q.png"/></div></figure><p id="9038" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为什么你会问？</p><p id="ee83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据量正在增长。你不想几天都停留在预处理阶段吧！人们可能会想写懒惰的代码，认为“这已经足够好了！”——结果却发现并非如此。这可能是我们甚至没有注意到的瓶颈之一。当然，在实际的学习部分，库确实会处理并发性。</p><p id="79f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">— — — — — — — — — — — -</p><p id="7123" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">熊猫</strong>:</p><p id="ca5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jm jn jo jp b">pd.apply</code>是最通用的功能之一。Apply有点像<code class="du jm jn jo jp b">map</code>。文档在这里:<a class="ae jq" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html" rel="noopener ugc nofollow" target="_blank">https://pandas . pydata . org/pandas-docs/stable/reference/API/pandas。DataFrame.apply.html</a></p><p id="db5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你有一个将输入作为一行的函数时，使用<code class="du jm jn jo jp b">axis=1</code>。您可以从函数中返回一个<code class="du jm jn jo jp b">series</code>对象，结果将是一个dataframe。或者您可以返回一个值，并将它赋给正在操作的数据帧的一列。</p><p id="086e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有时，如果你的函数使用单个列值，<strong class="ih hj">将其矢量化</strong>。那是什么意思？使用<code class="du jm jn jo jp b">axis=0</code>，在一个系列上调用<code class="du jm jn jo jp b">apply</code>，即单个数据帧列。原因是:它比按行应用快两倍多。</p><p id="6f5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> &gt; &gt; </strong> <strong class="ih hj">什么不可以做？</strong>不要使用“df.iterrows()”。太慢了！</p><p id="9754" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您的数据帧很大，并且您想将它分块并同时处理这些块，该怎么办？</p><p id="f047" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jq" href="https://pypi.org/project/pandarallel/" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj"><em class="jd">pandarallel</em></strong></a>是一个你应该签出的库。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jr js l"/></div></figure><p id="3dab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">— — — — — — — — — — — — — — -</p><p id="1dc6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">常规平行度</strong></p><p id="5036" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Python有一套非常精细的并行内置支持。</p><p id="d897" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有两个非常好的图书馆</p><ol class=""><li id="f5d2" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated"><strong class="ih hj"> Joblib </strong></li><li id="ad59" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated"><strong class="ih hj">多重处理</strong></li></ol><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jr js l"/></div><figcaption class="kh ki et er es kj kk bd b be z dx translated"><em class="kl"> joblib </em>的简单应用</figcaption></figure><p id="1020" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了获得您想要的作业数量，而不是将其硬编码为您自己的开发机器上的CPU数量，让我们编写代码，以便您的代码可以使用所有内核，如果部署在具有更多或在某些情况下更少内核的机器上的话！。</p><p id="6de1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jm jn jo jp b">import multiprocessing</code></p><p id="56f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jm jn jo jp b">n_jobs = multiprocessing.cpu_count()</code></p><p id="b880" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就这么简单！</p><p id="f985" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">OOP呢？</strong></p><p id="a48d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">啊，我们写了一个类，里面有一个类函数。现在我们想并行调用这个函数。我们不能使用joblib。很遗憾，是吧？为什么你会问？简而言之，Joblib pickles一个对象，当一个类对象被直接pickle时会产生问题。</p><p id="2345" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<code class="du jm jn jo jp b">multiprocessing</code>。一个好的做法是使用<code class="du jm jn jo jp b">multiprocessing.Pool</code>。如图所示，将工作线程数设置为核心数。并将类方法设为静态。你可以通过使用装饰者<code class="du jm jn jo jp b">@staticmethod</code>来完成。</p><p id="4fed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简而言之，这可以帮助你开始。还有更多的可以说，但我们的目标是简洁。根据您的具体情况，查找文档中的正确用法，这样就万事俱备了。</p></div></div>    
</body>
</html>