<html>
<head>
<title>OneHotEncoding with dissimilar items in train and test set</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对训练集和测试集中的不同项目进行一次性编码</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/onehotencoding-with-dissimilar-items-in-train-and-test-set-ffe365f84a4c?source=collection_archive---------10-----------------------#2020-07-10">https://medium.com/analytics-vidhya/onehotencoding-with-dissimilar-items-in-train-and-test-set-ffe365f84a4c?source=collection_archive---------10-----------------------#2020-07-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8029b8de6365836fd47fd9535d673196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Sm4Lz7V5aak81_W2"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">克里斯汀娜·戈塔迪在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="4787" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">假设您在训练集中的某个特征中有A、B、C值。令人惊讶的是，你的测试集在那个特性中不包含A，此外它还有D。</p><p id="ca22" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你进入一个包含熊猫的get_dummies方法的解决方案，那么，好好享受这个旅程吧。</p><p id="9b51" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我更喜欢使用sklearn的OneHotEncoder，借助一些实用函数。这是我的解决方案……(你可以在这里找到笔记本<a class="ae iu" href="https://nbviewer.jupyter.org/github/VolkiTheDreamer/PythonRocks/blob/master/OneHotEncoding.ipynb" rel="noopener ugc nofollow" target="_blank">T5T7】</a></p><h2 id="6e63" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">获取数据</h2><p id="5b55" class="pw-post-body-paragraph iv iw hi ix b iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">注:我从<a class="ae iu" href="https://blog.cambridgespark.com/robust-one-hot-encoding-in-python-3e29bfcec77e" rel="noopener ugc nofollow" target="_blank">这里</a>得到的数据模板。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="2874" class="ju jv hi kz b fi ld le l lf lg">import pandas as pd<br/>from sklearn.preprocessing import OneHotEncoder<br/>import mlextension as ml #for the function returning onehot columns</span><span id="f20c" class="ju jv hi kz b fi lh le l lf lg">#train set<br/>df_train = pd.DataFrame([["London", "car", 20],<br/>                   ["Cambridge", "car", 10], <br/>                   ["Liverpool", "bus", 30]], <br/>                  columns=["city", "transport", "duration"])</span><span id="496b" class="ju jv hi kz b fi lh le l lf lg"># test set<br/>df_test = pd.DataFrame([["Manchester", "bike", 30], <br/>                        ["Cambridge", "car", 40], <br/>                        ["Liverpool", "bike", 10]], <br/>                       columns=["city", "transport", "duration"])</span></pre><h2 id="8596" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">一些准备</h2><p id="6380" class="pw-post-body-paragraph iv iw hi ix b iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">在我的解决方案中，主要的不同点是<strong class="ix hj">我们得到了整个集合的独特物品</strong>。因为我们可能在训练集和测试集中缺少一个项目，如本例所示。在train set中，我们在city列中没有曼彻斯特，在transport列中没有自行车，而在test set中，我们在city中没有London，在transport中没有bus。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="a35b" class="ju jv hi kz b fi ld le l lf lg">#which columns to encode<br/>cat_columns = ["city", "transport"]</span><span id="d40d" class="ju jv hi kz b fi lh le l lf lg">#train+test<br/>whole=pd.concat([df_train,df_test],axis=0)<br/>whole</span></pre><figure class="ku kv kw kx fd ij er es paragraph-image"><div class="er es li"><img src="../Images/f6232ca5bd77e773bd7d929fe0d6911f.png" data-original-src="https://miro.medium.com/v2/resize:fit:558/format:webp/1*GRKrHXM4DL8oniOfJ3DwOw.png"/></div></figure><p id="3d6d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">助手方法</strong></p><figure class="ku kv kw kx fd ij"><div class="bz dy l di"><div class="lj lk l"/></div></figure><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="95c8" class="ju jv hi kz b fi ld le l lf lg">cats=ml.getfullitemsforOHE(whole,cat_columns) #the last parameter is True as defaul, which sorts the items.<br/>#but it doesn't matter whether they are sorted or not,it is just a matter of preference<br/>cats<br/>#[['Cambridge', 'Liverpool', 'London', 'Manchester'], ['bike', 'bus', 'car']]</span></pre><h2 id="cfe6" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">编码时间</h2><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="69b4" class="ju jv hi kz b fi ld le l lf lg">ohe=OneHotEncoder(categories=cats, sparse=False,handle_unknown="ignore")<br/>X_trans=ohe.fit_transform(df_train[cat_columns])</span><span id="d458" class="ju jv hi kz b fi lh le l lf lg">#let's presnet them in a dataframe<br/>pd.DataFrame(X_trans,columns=ohe.get_feature_names(cat_columns))</span></pre><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/66333854a2a14f7d115a17b5e1b23d5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bfiDYpxrV565HzoeSP2XrA.png"/></div></div></figure><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="f77d" class="ju jv hi kz b fi ld le l lf lg">#let's transform the test set as well, only transform(not fit)<br/>x_test_trans=ohe.transform(df_test[cat_columns])<br/>pd.DataFrame(x_test_trans,columns=ohe.get_feature_names(cat_columns))</span></pre><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/31006a7c2d8c6e9df9cafc4806119e92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ILc-y2il73pFI8illfEn2w.png"/></div></div></figure><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="0d16" class="ju jv hi kz b fi ld le l lf lg">#now, we have a <strong class="kz hj">new dataset </strong>that has values neither train set nor test set has, let's see if any problems crop up<br/># Istanbul in place of Manchester, plane in place of second bike<br/>df_new = pd.DataFrame([["Istanbul", "bike", 30], <br/>                        ["Cambridge", "car", 40], <br/>                        ["Liverpool", "plane", 10]], <br/>                       columns=["city", "transport", "duration"])<br/>df_new</span></pre><figure class="ku kv kw kx fd ij er es paragraph-image"><div class="er es ln"><img src="../Images/68295717bbbed24182bc461ea4b2d1d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*cBNOSSIhPONMNu7JggsiMg.png"/></div></figure><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="8625" class="ju jv hi kz b fi ld le l lf lg">#thanks to handle_unknown="ignore" parameter no problems come up. remove that parameter, run again and see the error<br/>x_new_trans=ohe.transform(df_new[cat_columns])<br/>pd.DataFrame(x_new_trans,columns=ohe.get_feature_names(cat_columns))</span></pre><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/23d3e45c713f4a6d5352f5a6f223b3b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YYDuOhU5-oFhdeGzwyT08w.png"/></div></div></figure><p id="4fd4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你注意到，在第一行，所有的城市都是0，在最后一行，所有的交通工具都是0。</p></div><div class="ab cl lp lq gp lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hb hc hd he hf"><p id="48e4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">仅此而已。感谢阅读。跟我来拿更多的文件。</p></div></div>    
</body>
</html>