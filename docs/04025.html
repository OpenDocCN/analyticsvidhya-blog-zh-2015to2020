<html>
<head>
<title>Metaflow by Netflix — the good, the bad and the ugly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">网飞的元流——善、恶、丑</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/metaflow-by-netflix-the-good-the-bad-and-the-ugly-b7fc6a833484?source=collection_archive---------7-----------------------#2020-03-02">https://medium.com/analytics-vidhya/metaflow-by-netflix-the-good-the-bad-and-the-ugly-b7fc6a833484?source=collection_archive---------7-----------------------#2020-03-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="eb21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">【2019年12月，网飞开源metaflow  —一个为Python编写以人为中心的机器学习基础设施的框架。目标是抽象出ML建模的管理和工程方面，让数据科学家(可以说他不太擅长开发和编码最佳实践)专注于数据科学。它被网飞的数据科学团队广泛使用。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/8f4ad24a47511a62848507d48ef03e08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nqAcyGsENCYy1iGnOiOkKw.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">网飞数据科学公司对Metaflow的采用率正在飞速上升！</figcaption></figure><p id="1d4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是什么是元流呢？！根据<a class="ae jd" href="https://docs.metaflow.org/introduction/what-is-metaflow" rel="noopener ugc nofollow" target="_blank">官方文件</a>，</p><blockquote class="ju jv jw"><p id="0604" class="if ig jx ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated">Metaflow是一个对人类友好的Python库，可以帮助科学家和工程师构建和管理现实生活中的数据科学项目。Metaflow最初是在网飞开发的，旨在提高数据科学家的工作效率，这些科学家从事从经典统计到最先进的深度学习的各种项目。</p><p id="cc52" class="if ig jx ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated">Metaflow为执行数据科学项目(从原型到生产)所需的基础架构堆栈提供了统一的API。</p></blockquote><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kb"><img src="../Images/ad16b07cb75b21f2fcd29b40ec658999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QnkkXEFW3G-MC4GgosgxmA.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">学分:<a class="ae jd" href="https://www.slideshare.net/InfoQ/humancentric-machine-learning-infrastructure-netflix" rel="noopener ugc nofollow" target="_blank">https://www . slide share . net/InfoQ/human centric-machine-learning-infra structure-网飞</a></figcaption></figure><p id="66fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Metaflow引入了一个API，其中每个ML管道都被写成一个“流”。</p><p id="f4a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">流就像有向无环图(DAG)。它可以有步骤(节点)、分支和数据工件，如参数、文件等。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kb"><img src="../Images/260ee3fd126e1e4f5b8f0e3a551a05d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tef4VMFQCNW9hDFQWEY-mA.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">典型的(元)流！演职员表:<a class="ae jd" href="https://www.youtube.com/watch?v=XV5VGddmP24&amp;t=2374s" rel="noopener ugc nofollow" target="_blank">元流启动</a></figcaption></figure><p id="0272" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了更详细地理解这些概念，请参考<a class="ae jd" href="https://towardsdatascience.com/learn-metaflow-in-10-mins-netflixs-python-r-framework-for-data-scientists-2ef124c716e4" rel="noopener" target="_blank">这篇文章</a>，它很好地解释了这些组件。还有，<a class="ae jd" href="https://docs.metaflow.org/" rel="noopener ugc nofollow" target="_blank">官方文件</a>也很有帮助。</p><p id="5d09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最近，我在我的一个项目中使用了metaflow。以下是一份固执己见的利弊清单。</p><h1 id="21aa" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated"><strong class="ak">好人</strong></h1><ul class=""><li id="6353" class="la lb hi ih b ii lc im ld iq le iu lf iy lg jc lh li lj lk bi translated"><strong class="ih hj">Dag给出正确的模型</strong> <br/>大多数(ML)流水线可以(也应该)被认为是Dag。你有一些预处理和后处理，中间是一个模型。Metaflow重申了这个框架。</li><li id="ff2c" class="la lb hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated"><strong class="ih hj">类似于Airflow </strong> <br/> Airflow是一种流行的数据管道工具，用于编排ETL管道。元流使您能够以类似的方式考虑ML管道。</li><li id="6912" class="la lb hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated"><strong class="ih hj">对并行性的内置支持<br/> </strong>如果您的流程中有多个可以并行运行的“步骤”或功能，Metaflow会为它们提供开箱即用的支持，从而有效地利用您的计算。</li><li id="41c6" class="la lb hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated"><strong class="ih hj">面向对象编程<br/> </strong>告别管理这么多函数的脚本。欢迎一个通过逻辑图组织步骤(如那些函数)的类。</li><li id="7f3c" class="la lb hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated"><strong class="ih hj">广泛的日志记录和版本控制<br/> </strong>关于Metaflow最好的事情之一是，它记录你的每个流的每次运行。这使得在生产环境中调试工作流变得轻而易举。您不仅可以获得日志和流程中任何步骤可能发生的错误，还可以获得<em class="jx"> latest_run </em>，您可以用它来恢复上一次运行的状态。</li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lq"><img src="../Images/8608d8248d6ca648c0fe57f58ab34dc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*0gCQegP2iKmbo9hE9n5upw.jpeg"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">流程每次运行的日志</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lr"><img src="../Images/4d186df2350fca757f52234ac20618f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*EtEe2zfUDblrO08I9e8F5w.jpeg"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">运行的每个步骤的日志</figcaption></figure><ul class=""><li id="f367" class="la lb hi ih b ii ij im in iq ls iu lt iy lu jc lh li lj lk bi translated"><strong class="ih hj">可读性</strong> <br/>这可能是使用元流的最大优势——它让你的ML代码可读性更好。步骤带来的抽象非常棒。此外，您甚至可以在不运行/查看代码的情况下生成流的文档。只需运行:</li></ul><pre class="jf jg jh ji fd lv lw lx ly aw lz bi"><span id="1eea" class="ma kd hi lw b fi mb mc l md me">python my_flow.py show</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mf"><img src="../Images/0a2e069bddccd0a62e92128e32c67401.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0KnptfYOlIfZqgJH11QC9A.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">使用Metaflow的show命令生成文档</figcaption></figure><p id="a024" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很好，是吧？</p><h1 id="fe5f" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated"><strong class="ak">坏的(和丑陋的)</strong></h1><ul class=""><li id="d7df" class="la lb hi ih b ii lc im ld iq le iu lf iy lg jc lh li lj lk bi translated"><strong class="ih hj">有限的功能集和文档</strong> <br/>于2019年12月开源，该库仍处于非常活跃的开发中。目前，<a class="ae jd" href="https://github.com/Netflix/metaflow/issues/115" rel="noopener ugc nofollow" target="_blank">文档有些有限</a>，你必须依赖很多教程，甚至偷看库代码。也就是说，机器学习基础设施管理正在快速发展，该团队正在尽最大努力推出所需的功能。</li><li id="81fe" class="la lb hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated"><strong class="ih hj">Windows上不支持<br/> </strong> <a class="ae jd" href="https://github.com/Netflix/metaflow/issues/60" rel="noopener ugc nofollow" target="_blank">您目前无法在Windows上运行元流。然而，如果你熟悉Docker，这应该不成问题。只要确保在Docker文件中设置了一个用户名，因为Metaflow需要一个用户名来记录日志</a></li></ul><pre class="jf jg jh ji fd lv lw lx ly aw lz bi"><span id="e2ca" class="ma kd hi lw b fi mb mc l md me"># User needed for metaflow logging</span><span id="c7e7" class="ma kd hi lw b fi mg mc l md me">ENV USERNAME my_user</span></pre><ul class=""><li id="9d46" class="la lb hi ih b ii ij im in iq ls iu lt iy lu jc lh li lj lk bi translated">与AWS紧密结合网飞与AWS的合作是众所周知的。有些人甚至说，内容流平台对云平台今天的发展功不可没。因此，自然地，Metaflow内置了对AWS S3桶、EC2计算和其他云功能的支持。然而，有<a class="ae jd" href="https://github.com/Netflix/metaflow/issues/40" rel="noopener ugc nofollow" target="_blank">说对Azure </a>的支持即将到来。</li><li id="f8ec" class="la lb hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated"><strong class="ih hj">通过子流程<br/> </strong>调用这可能是元流最烦人的限制——不能通过创建流类的对象来启动运行。它必须通过终端运行。如果您有一个触发运行的队列，这应该不是问题。然而，如果您有一个服务请求的服务器，这可能是丑陋的。在python中，从代码运行终端命令通常是通过subprocess方法完成的，这也是元流作者推荐的<a class="ae jd" href="https://github.com/Netflix/metaflow/issues/116" rel="noopener ugc nofollow" target="_blank">方法。</a></li></ul><pre class="jf jg jh ji fd lv lw lx ly aw lz bi"><span id="c18a" class="ma kd hi lw b fi mb mc l md me">subprocess.run(['python', 'my_flow.py', 'run'])</span></pre><p id="1b5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仅此而已！虽然Metaflow似乎是朝着正确的方向迈出了一步，但在它准备好被普遍使用之前，还有很长的路要走。感谢您的阅读！</p></div></div>    
</body>
</html>