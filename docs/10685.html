<html>
<head>
<title>Market Basket Analysis In Python using Apriori Algorithm</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中使用Apriori算法的购物篮分析</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/in-technical-terms-apriori-used-in-the-market-basket-analysis-tries-to-find-out-which-items-are-78287911a4df?source=collection_archive---------2-----------------------#2020-10-30">https://medium.com/analytics-vidhya/in-technical-terms-apriori-used-in-the-market-basket-analysis-tries-to-find-out-which-items-are-78287911a4df?source=collection_archive---------2-----------------------#2020-10-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d712" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在技术术语中，Apriori(用于购物篮分析)试图找出哪些项目是一起购买的。因此，可以通过将他们安排在附近或建议用户上零售商网站来增强客户体验，基本上是为了让客户购买更多。(还记得网购网站上那些“这些物品一起买”的建议吗？)</p><p id="ecca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是它是如何工作的呢？当然，有一些相关的理论，但我们会在编码时研究。所以我们首先需要的是数据，我将使用来自Kaggle的数据。可以在这里找到(<a class="ae jd" href="https://www.kaggle.com/shazadudwadia/supermarket#GroceryStoreDataSet.csv" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/shazadudwadia/supermarket # grocerystoredataset . CSV</a>)。这是一个关于从一些商店购买的一些早餐项目的小型数据集。</p><ol class=""><li id="b53c" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated"><strong class="ih hj">数据预处理</strong>:这是最重要的一步。我在在线教程中观察到的一件事是，他们从这种形式的数据开始(类似于我们正在使用的数据)</li></ol><figure class="jo jp jq jr fd js er es paragraph-image"><div class="er es jn"><img src="../Images/a46b558a7d973f63c1a3411b73bfdb29.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/0*uFfaZwEf2YmAHDZA"/></div></figure><p id="85b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我担心的是，这不是任何记录事务的传统应用程序的输出，也不是我们编写SQL时的输出。所以我们需要把它改造成下面的形式</p><figure class="jo jp jq jr fd js er es paragraph-image"><div class="er es jv"><img src="../Images/c62a635d67bc4226503482b99d5c2183.png" data-original-src="https://miro.medium.com/v2/resize:fit:556/0*8qAtVPhuBH_PscDO"/></div></figure><p id="7457" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这可以在python中通过这里解释的方法实现<a class="ae jd" rel="noopener" href="/@sureshssarda/pandas-splitting-exploding-a-column-into-multiple-rows-b1b1d59ea12e">https://medium . com/@ sureshssarda/pandas-splitting-explosing-a-column-into-multi-rows-B1 B1 d 59 ea 12 e</a></p><p id="8b96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤1 </strong>:我们需要做的是拆分每一行，并为一个产品分配一个交易id。为简单起见，您也可以在excel中这样做</p><p id="4d00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于先验，我们需要以下形式的数据，以便Algo可以轻松地提取信息。因此，一列事务id和不同的产品列。1表示该产品是该事务的一部分。在上图中，c1包括牛奶、面包和饼干。同样的情况在下面用“1”表示。</p><figure class="jo jp jq jr fd js er es paragraph-image"><div class="er es jw"><img src="../Images/c082a2959ee39e2b41abc63de59af958.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/0*Pmlp9de_OW2jMBf2"/></div></figure><p id="303e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了实现这一点，我们需要编写一个小的python代码。我发现Pivot函数非常有用。但是首先我们需要一些库在代码下面运行。我用的是Spyder ( Python 3.7)。在代码下运行</p><p id="88e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jx jy jz ka b">##Import Libraries<br/>import pandas as pd<br/>from mlxtend.frequent_patterns import apriori<br/>from mlxtend.frequent_patterns import association_rules</code></p><p id="67f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您之前没有使用过Apriori，请在控制台中运行<strong class="ih hj"> "pip install mlxtend" </strong>,然后再次运行上述命令</p><figure class="jo jp jq jr fd js er es paragraph-image"><div class="er es kb"><img src="../Images/d43c714159ebaa64f7761a12b3a09a9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/0*W69Zj94CM5M8Z-aP"/></div></figure><p id="cbe7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们都准备好了。将数据加载到python中。您需要将我们在步骤1中准备的excel文件以csv格式保存为mydata.csv，并运行以下命令</p><p id="0b91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jx jy jz ka b">"##Load Data in python "<br/>d1 = pd.read_csv("mydata.csv")</code></p><p id="66cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在您需要在我们的数据框架中插入一列。该列将显示在一次交易中按值“1”购买的物品。在命令下运行</p><p id="c175" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jx jy jz ka b">"#add new column with constant value 1"<br/>d1['value'] = d1.apply(lambda x: 1, axis=1)</code></p><p id="94c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">python中的数据框应如下所示</p><figure class="jo jp jq jr fd js er es paragraph-image"><div class="er es kc"><img src="../Images/3c83cf7795a2625db8b678f9e861592f.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/0*N1S1uZB7_kDGnSow"/></div></figure><p id="fb7d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要重新塑造这个看起来像图1<strong class="ih hj">。我们将使用Python pivot函数。在代码下运行</strong></p><p id="0d4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jx jy jz ka b">"#Reshape data to pivot form"<br/>d2=pd.pivot_table(d1,index='id',columns='product',values='value')</code></p><p id="18e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您的数据框应该如下所示</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es kd"><img src="../Images/82b1b41517c378eba8be73302d8ac6d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/0*v1AtGPVprBfb2AZw"/></div></div></figure><p id="95ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“不适用于”表示特定项目不属于交易的一部分。例:“Bournvita”在c1中没有，所以用“nan”表示。我们需要去掉这些，用零来代替。在代码下运行</p><p id="fd46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jx jy jz ka b">"#remove 'nan' and replace it by 0"<br/>d3=d2.fillna(0)</code></p><figure class="jo jp jq jr fd js er es paragraph-image"><div class="er es ki"><img src="../Images/843363602eaaa00ebeba3e2599964edb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/0*_uNO7-3lTxq51QZG"/></div></figure><pre class="jo jp jq jr fd kj ka kk kl aw km bi"><span id="71ab" class="kn ko hi ka b fi kp kq l kr ks"><strong class="ka hj">2. Running Algo:</strong></span></pre><p id="0e0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是时候对该数据帧运行先验算法了。在代码下运行</p><p id="53ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jx jy jz ka b">"#run apriori algo"<br/>frequent_itemsets = apriori(d3, min_support=0.2, use_colnames=True)<br/>rules = association_rules(frequent_itemsets, metric="lift", min_threshold=1)</code></p><p id="11a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我稍后会解释这些参数(支撑和提升)。输出数据帧应该如下所示</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es kt"><img src="../Images/0b21cc2b408c1cfd41c6f7206fa91f06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kbyipKhnKLsO9ilw"/></div></div></figure><pre class="jo jp jq jr fd kj ka kk kl aw km bi"><span id="a553" class="kn ko hi ka b fi kp kq l kr ks"><strong class="ka hj">3. Theory and Interpretation:</strong></span></pre><p id="71cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">A.有两部分<strong class="ih hj"> a .前因b .后果</strong>。根据我们的数据，如果一个人购买面包(前因)，那么在同一时间同一笔交易中，同一个人可以购买牛奶(后果)</p><p id="1011" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">B.<strong class="ih hj">支持</strong> : <strong class="ih hj"> <em class="ku">支持=项目发生/总交易</em> </strong>。所以前因支持就是支持面包。它可以使用上面的等式和下面的数据中枢(为便于理解，准备在excel中)进行计算</p><figure class="jo jp jq jr fd js er es paragraph-image"><div class="er es kv"><img src="../Images/4baa5819f9af67e1385d4b6bc9d385ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/0*jhW1gwd7AXD1iVgx"/></div></figure><p id="b52e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你能计算一下面包和牛奶的支持度吗？为了更好地理解，我突出显示了这些单元格。请注意，高亮显示的单元格是成对的，表示它们是一起购买的。</p><figure class="jo jp jq jr fd js er es paragraph-image"><div class="er es kv"><img src="../Images/20479600f412e7189901d3eff1960d1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/0*9izHg1TgLGARJIZL"/></div></figure><p id="04e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您现在可能已经理解了我们在先验算法(<code class="du jx jy jz ka b">frequent_itemsets = apriori(d3, <strong class="ih hj">min_support=0.2</strong>, use_colnames=True)</code>)中输入的支持阈值。基本上我们过滤掉了其他不太频繁的交易。</p><p id="df6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">C.<strong class="ih hj">置信度:</strong>这个数字告诉你，相对于单次购买，有多少物品被一起购买。因此，如果一起购买的项目总和少于单次，那么发生可能是微不足道的。因此，与单一商品相比，更高的信心值意味着一起购买的几率更高。<strong class="ih hj">置信度=(支持一起购买的商品)/(支持分开购买的商品</strong></p><p id="6302" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如:根据我们之前的计算，一起购买牛奶和面包的可信度= 0.2/0.6，即根据我们在图2 中<strong class="ih hj">输出的代码，可信度为0.30769</strong></p><p id="4376" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">D.<strong class="ih hj"> Lift : </strong>表示任何规则的强度，即我们认为牛奶和面包是一起买的，但这种关联有多强？电梯号告诉我们这一点。<strong class="ih hj"> Lift =(支持一起买的物品)</strong> / <strong class="ih hj">(支持一件物品)*(支持另一件物品)</strong>。请注意，在保密情况下，我们将联合收割机支架划分为任意一个<strong class="ih hj">项目支架</strong>。在这里，我们正在划分两个项目的乘法支持。</p><p id="1966" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Ex Lift(牛奶面包)=支持牛奶面包(0.25) /(支持面包(0.65 ))*(支持牛奶(0.25)) = 1.23077与我们的python输出相同</p><p id="99e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，Lift越高，一起购买这些商品的可能性就越大。很少有其他参数来分析这些结果，但<strong class="ih hj">支持、信心和提升</strong>是最重要和最有解释力的。还要注意，Apriori将为您提供所有这些数字，如上面的输出所示，但我们还需要了解如何解释这些数字。这就是为什么我试图用解释来详细解释这些</p><p id="17b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是完整的代码供您参考</p><p id="bc9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jx jy jz ka b">"##Import Libraries "<br/>import pandas as pd<br/>from mlxtend.frequent_patterns import apriori<br/>from mlxtend.frequent_patterns import association_rules</code></p><p id="d3e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jx jy jz ka b">"##Load Data in python "<br/>d1 = pd.read_csv("mydata.csv")</code></p><p id="4417" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jx jy jz ka b">"#add new column with constant value 1"<br/>d1['value'] = d1.apply(lambda x: 1, axis=1)</code></p><p id="3af3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jx jy jz ka b">"#Reshape data to pivot form"<br/>d2=pd.pivot_table(d1,index='id',columns='product',values='value')<br/>"#remove 'nan' and replace it by 0"<br/>d3=d2.fillna(0)</code></p><p id="df93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jx jy jz ka b">"#run apriori algo"<br/>frequent_itemsets = apriori(d3, min_support=0.2, use_colnames=True)<br/>rules = association_rules(frequent_itemsets, metric="lift", min_threshold=1)</code></p><p id="a549" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我觉得同样的算法可以用来做类似客户反馈(这两个词是放在一起说的)这样的文本分析。你怎么想呢?。</p><p id="dea0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我知道你的建议和反馈。乐意帮忙。</p></div></div>    
</body>
</html>